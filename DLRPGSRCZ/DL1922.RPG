     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA i/c 0 rate fix days - file update')       *
     F*****************************************************************
     F*                                                               *
     F*  Midas  -  FRA/IRS Module                                     *
     F*                                                               *
     F*  DL1922 - DEALS FILE UPDATE IN I/C FOR FRA/IRSS WITH ZERO     *
     F*           RATE-FIX DAYS.                                      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD051554           Date 28Sep18               *
      *  Prev Amend No. MD051152           Date 02Aug18               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 AR996895           Date 25Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 08Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 244944             Date 10Jan07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 22Apr05               *
      *                 CDL028             Date 07Feb05               *
      *                 CAS008             Date 16Jun06               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 217684             Date 12May03               *
      *                 CAS004             Date 26Jun02               *
      *                 CRE009             Date 04Sep02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CIR008             Date 13Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CIR007             Date 11May01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 CIR006             Date 13Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 156954             Date 11Mar99               *
      *                 CEU003             Date 20Jan98               *
     F*                 126017             DATE 14NOV97               *
     F*                 121768             DATE 20FEB98               *
     F*                 CCB002             Date 05Sep96               *
     F*                 110874             DATE 25Nov96               *
     F*                 S01408             DATE 15AUG96               *
     F*                 100140             DATE 27JUN96               *
     F*                 097480             DATE 24JAN96               *  *
     F*                 095746             DATE 09NOV95               *
     F*                 CIR001             DATE 14SEP95               *
     F*                 065311             DATE 19JAN94               *
     F*                 051372             DATE 18MAY94               *
     F*                 064773             DATE 28FEB94               *
     F*                 055838             DATE 03FEB94               *
     F*                 060995             DATE 02FEB94               *
     F*                 046820             DATE 02FEB94               *
     F*                 042757             DATE 12JAN94               *
     F*                 046820             DATE 13DEC93               *
     F*                 046303             DATE 09DEC93               *
     F*                 E38323             DATE 30JUL92               *
     F*                 043304             DATE 13AUG92               *
     F*                 040318             DATE 07AUG92               *
     F*                 AUS021             DATE 07AUG92               *
     F*                 E35983 (FUJ808)    DATE 13FEB92               *
     F*                 E02378             DATE 20JAN92               *
     F*                 DT0082             DATE 13MAY91               *
     F*                 E23400             DATE 21NOV90               *
     F*                 E23407             DATE 19SEP90               *
     F*                 E22610             DATE 25JUL90               *
     F*                 E21624             DATE 03JUL90               *
     F*                 E21549             DATE 02MAY90               *
     F*                 S01195             DATE 27MAR90               *
     F*                 S01117             DATE 27MAR90               *
     F*                 S01194             DATE 27MAR90               *
     F*                 S01157             DATE 24/01/89              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD051554 - Leap Year Fix for interest calculation basis to   *
      *             be used for 1st Jan should not be present in      *
      *             FRA/IRS module                                    *
      *  MD051152 - FRA/IRS Interest Calculation Basis 6.             *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *      
      *  AR996895 - Incorrect accrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  244944 - In SR/TSTRTL, if settlement method is '00' then     *
      *           WRETL is left as 'Y' resulting in call to AOMEMSU0  *
      *           passing with blank account details                  *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CRE009 - Projected Account Movements for RE accounts         *
      *  CIR008 - FRA/IRS Deals Authorisation                         *
      *  CIR007 - Overnight Index Swaps                               *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  CIR006 - Amortisation of Caps/Collars/Floors and Individual  *
      *           Compounding.  Changed for individual compounding    *
      *           only.                                               *
      *  CIR004 - Dealing Calculation Method Change                   *
     F*  156954 - Fix 100140 is incomplete.  It doesn't consider if   *
     F*           date format is MMDDYY.                              *
     F*  CEU003 - Amended to include processing required by EMU       *
     F*           switchable feature CEU003.                          *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  CCB002 - COB Performance Enhancements                        *
     F*           Access now via access object                        *
     F*           MEMOS is now accessed via GL/RE key rather than old *
     F*           relative record number.                             *
     F*  110874 - For backvalued IRSs, interest settlement            *
     F*           confirmations are not produced on rerun as          *
     F*           they are suppressed by unnecessary conditions.      *
     F*  S01408 - Core Hook DL1922CCP8 Added                          *
     F*         - Core Hook DL1922CCP7 Added                          *
     F*         - Core Hook DL1922CCP6 Added                          *
     F*         - Core Hook DL1922CCP5 Added                          *
     F*         - Core Hook DL1922CCP4 Added                          *
     F*         - Core Hook DL1922CCP3 Added                          *
     F*         - Core Hook DL1922CCP2 Added                          *
     F*         - Core Hook DL1922CCP1 Added                          *
     F*  100140 - Looping problems caused by FRA's fixing on 29th Feb *
     F*           Fix is to ensure that when 1 year is added to 29th  *
     F*           Feb in a leap year, the result is 28th Feb.         *
     F*  097480 - Duplicate/spurious entries on Proj. A/C Movements.  *
     F*           Fix is to set Debit/Credit field DORC correctly     *
     F*           each time a record is written to RSACMTPD.          *
     F*  095746 - Retail ICD accessed prior to module access.         *
     F*           Condition on Retail ICD will never be met, so access*
     F*           moved to after access to AOMMODR0. Also, branch     *
     F*           code not set up for settlement type 14 in SR/TSTRTL.*
     F*  CIR001 - Interest Rate Calendars.                            *
     F*  065311 - Database error on Chain to ACCNT.                   *
     F*           BRCD from nostro not used in ACCKEY.                *
     F*  051372 - Incorrect FRA settlement amount calculated for      *
     F*           Australian formula (SETF='A') if deal amount is     *
     F*           greater than 99 Million.                            *
     F*  064773 - CONDITION CALL TO AORETLR0 ON RETAIL BEING PRESENT. *
     F*  055838 - RECORDS BEING OUTPUT TO RSACMTPD WITH ZERO VALUE AND*
     F*           POSTING DATES RESULTING IN ERRORS ON MOVEMENT ENQYS.*
     F*  060995 - Settlement sum in FRA was incorrect. Interest for   *
     F*           excess days (due to holidays, etc.) of a one year   *
     F*           calculation are calculated separately.  Applied     *
     F*           fix 031967 was change to have 10 days for number    *
     F*           of excess days.                                     *
     F*  031967 - PROBLEMS CAN OCCUR WITH SETTLEMENT SUMS FOR FRAS    *
     F*           ENTERED WITH MATURITY DATES JUST GREATER THAN 1     *
     F*           YEAR (DUE TO EXACTLY 1 YEAR BEING A NON-WORKING     *
     F*           DAY) AS MIDAS WILL CALCULATE THIS SUM USING         *
     F*           2 CALCULATIONS (1 YEAR CALC PLUS EXTRA DAYS         *
     F*           CALC) RATHER THAN 1 CALC.                           *
     F*           THIS CAUSES THE INCORRECT AMOUNTS.                  *
     F*  042757 - Projected Nostro account movement value dated on    *
     F*           a non-working day should be reflected on the next   *
     F*           working day (and not on the previous working day).  *
     F*  046820 - Deals which have generated Swift messages should    *
     F*           be extracted if they have been reversed, in order   *
     F*           to generate Cancellation Messages.                  *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  E38323 - Recompilation of the program done due to a change   *
     F*           in copy source ZFWDT subroutine                     *
     F*  043304 - FRA error in calulation of settlement amount for    *
     F*           Settlement formula - U.                             *
     F*  040318 - Settlement Formula for AUD (SETF=A) sometimes       *
     F*           outputs from DLRADS a negative amount; this causes  *
     F*           (eg.) a -ve Receipt which later becomes a Pay.      *
     F*  AUS021 - AUSTRALIAN PRODUCT. Includes two new settlement     *
     F*           formulas for FRAs. Initially includes one for       *
     F*           Australia and one for USA.                          *
     F*  E35983 - Calculation of discounted settlement amounts in     *
     F*           SR.DLRADS is done in wrong order which causes       *
     F*           half-adjust errors and consequent error of +/-      *
     F*           1 cent in settlement amount on confirmation         *
     F*  E02378 - Notice of Settlement for an FRA should always be    *
     F*           produced, regardless of the Maturity Confirmation   *
     F*           Requested Indicator.                                *
     F*  DT0082 - Update MEMOS only if retail present                 *
     F*  E23400 - Remove unnecessary use of bit 1 of UDSTI/TDSTI (was *
     F*           used to indicate negative rate but this field,      *
     F*           SUNII, removed by S01157).                          *
     F*  E23407 - Check for modules RE(RETAIL 2) or IA(INTEREST ON    *
     F*           ACCOUNTS), rather than RT(RETAIL 1).                *
     F*  E22610 - In SR DLRADS (calculates discounted settlement      *
     F*           amount for FRA's) discount factor for deals         *
     F*           longer than 1 year should use no. of days from      *
     F*           previous year, not current one.                     *
     F*  E21624 - PGMN & MDID are not being set up in CMTTXT          *
     F*           data structure.                                     *
     F*  E21549 - To output a copy of all Retail and Nostro           *
     F*           changes to a new shadow postings file RSACMTPD.     *
     F*           Equivalent to S01154 in DL1601/2/3/4 series pgms.   *
     F*  S01195 - NEW HOLIDAY PROCESSING                              *
     F*  S01117 - MULTIBRANCHING CHANGES                              *
     F*  S01194 - NEW STANDING DATA CHANGES                           *
     F*  S01157 - New program written for FRA/IRS enhancements.       *
     F*           This program has been written to allow I/C          *
     F*           settlement of FRA's with 0 rate fix days & so       *
     F*           contains large chunks of code which have been       *
     F*           lifted from COB processing.(DL0279)                 *
     F*                                                               *
     F*****************************************************************
     F*L1922P1O***F*****132     OF     PRINTER                            S01117
     FDL1922AUO   F     132     OF     PRINTER                            S01117
     F*ABDLEI*IF**E***        K        DISK                               S01194
     F**********  TABLETAF                          KIGNORE               S01194
     F***ICD*1****TABTB10F                          KIGNORE               S01194
     F***ICD*2****TABTB11F                          KIGNORE               S01194
     F***ICD*3****TABTB20F                          KIGNORE               S01194
     F***ICD*5****TABTB40F                          KIGNORE               S01194
     F**********  TABTB70F                          KIGNORE               S01194
     F**********  TABTE10F                          KIGNORE               S01194
     F**********  TABTE20F                          KIGNORE               S01194
     F**********  TABTG10F                          KIGNORE               S01194
     F**********  TABTG20F                          KIGNORE               S01194
     F**********  TABLETHF                          KIGNORE               S01194
     F**********  TABLETIF                          KIGNORE               S01194
     F**HOLIDAYS**TABLETJF                          KIGNORE               S01194
     F***BASE*RT**TABLETKF                          KIGNORE               S01194
     F***NOSTRO***TABLETLF                          KIGNORE               S01194
     F**********  TABLETMF                          KIGNORE               S01194
     F**********  TABLETPF                          KIGNORE               S01194
     F**BRANCHES**TABLETRF                          KIGNORE               S01194
     F**********  TABLETSF                          KIGNORE               S01194
     F**********  TABLET1F                          KIGNORE               S01194
     F**********  TABLET2F                          KIGNORE               S01194
     F**********  TABLET5F                          KIGNORE               S01194
     F**********  TABLETXF                          KIGNORE               S01194
     FDLCFSCPDIF  E           K        DISK                               CIR001
     FDLDTSCPDIF  E           K        DISK                               CIR001
     FDLINDHH O   F      40            DISK                      A
     FDLINDDM O   F      98            DISK                      A
     FDLINDZX O   F      40            DISK                      A
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     F*MEMOS**UF**E********************DISK                               DT0082
     F*MEMOS**UF**E                    DISK                        DT0 082CCB002
     F************                                  KCOMIT                CCB002
     FOLPOS   UF  E           K        DISK
     F            OLPOSHHF                          KIGNORE
     F            OLPOSOBF                          KIGNORE
     F                                              KCOMIT
     FPRONO   UF  E           K        DISK
     F            PRONOHHF                          KIGNORE
     F                                              KCOMIT
     FDLDLDGLEUF  E           K        DISK
     F            DEALSDGF                          KRENAMEZRFRADLF
     F                                              KCOMIT
     F***DLDLDGLCIP**E           K        DISK                            046820
     FDLDLDGLFIP  E           K        DISK                               046820
     FRSACMTPDO   E                    DISK                               E21549
     F                                              KCOMIT                E21549
     F/COPY WNCPYSRC,DL1922F001
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F********13******CHAIN*FAIL*FOR*BASE*RATE*TABLE*FILE*****            S01194
     F*       14      TELEX ALREADY PRODUCED INDICATOR (TLXI BIT 3 -ON).
     F*       16      INITIAL RATE SET (DNSI BIT 0 - ON).
     F********20******NEGATIVE*INTEREST*(UDSTI BIT 1 - ON).               E23400
     F********25******RETAIL*MODULE*PRESENT*ON*SYSTEM*(MODI1*BIT*2*-*ON)* S01194
     F*       25      RETAIL MODULE PRESENT ON SYSTEM (BGRTBN = 'Y')      S01194
      *       26      Seton if CIR008 is installed                    *                       CIR008
     F*       33      MATURITY CONFIRMATION REQUIRED.
     F*       34      INTEREST CONFIRMATION REQUIRED.
     F*       40      SKIP FIRST CYCLE PROCESSING.
     F*       55      WORK INDICATOR FOR FIELD UDNSI PF/DEALSDG.
     F*       56      WORK INDICATOR FOR FIELD TDNSI PF/DEALSDG.
     F*       60      CHAIN FAIL FOR PF/DEALSDG FOR UPDATE.
     F*       66      DEALS FILE UPDATE INDICATOR.
     F*       70      CHAIN FAIL FOR PF/MEMOS FOR UPDATE.
     F*       75      USED IN SUBROUTINE AB.(INTEREST CONF. IND.)
     F*       76      USED IN SUBROUTINE AB.(INTEREST AMOUNT *NE ZERO).
     F*       79      FLOATING RATE ALREADY SET IF ON.
     F********81******CHAIN*FAIL*FOR*LF/TABDLEI*PF/TABLETR****            S01194
     F*       84      CHAIN FAIL FOR LF/ACNUM.
     F********85******NEGATIVE*INTEREST*(UDSTI OR TDSTI BIT 1 - ON).      E23400
     F*       86      CONFIRMATION PRODUCTION INDICATOR.
     F*       87      INTEREST RECEIPT CONFIRMATIONS.
     F*       88      CHAIN FAIL FOR LF/ACCNT.
     F*       89      USED IN DLRADS SUBROUTINE.
      *
     F*       90      USED IN STANDARD SUBROUTINES.
     F*       91      USED IN STANDARD SUBROUTINES.
     F*       92      USED IN STANDARD SUBROUTINES.
     F*       93      USED IN STANDARD SUBROUTINES.
     F*       94      USED IN STANDARD SUBROUTINES.
     F*       95      USED IN STANDARD SUBROUTINES.
     F*       98      USED IN STANDARD SUBROUTINES.
     F*       99      USED IN STANDARD SUBROUTINES.
      *
     E/COPY ZSRSRC,ZDATE9Z1                                               CIR001
     E                    CPY@    1   1 80               COPYRIGHT ARRAY
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
      *
      ***Zdate5*array*****                                                S01195
     E**********          ZHC        50  3                                S01195
      *  Projected nostros Balances
     E                    PBAL        5 15 0
      *  Projected nostros Dates
     E                    PDAT        5  5 0A
      *  On line position Incoming Balances
     E                    OBLI       16 15 0
      *  On line position Outgoing Balances
     E                    OBLO       16 15 0
      *  On line position Dates
     E                    ODAT       16  5 0A
      *
     E/COPY ZSRSRC,ZHOLE                                                  S01195
      *
      /EJECT
      *
      **  Data structures :
      *
      ***Data*structure*for*setting*up*key*to*Table*file*****             S01194
     I**********  DS                                                      S01194
     I**********                              1  12 KEY                   S01194
     I**********                              8  12 WRK5                  S01194
     I**********                              9  12 WRK4                  S01194
     I**********                             10  12 WRK3                  S01194
     I**********                             11  12 WRK2                  S01194
      *
      *
      **  Data structure to define retail account
      *
     I            DS
     I                                        1  12 RACNO
     I                                        1   6 RCNUM
     I                                        7  10 RPCAC
     I                                       11  12 RSEQ
      *
      * Work fields DS for subroutine TSTRTL
     I            DS
     I**********                              1  15 ERRKEY                S01117
     I**********                              1  18 ERRKEY                             S01117 CGL029
     I                                        1  24 ERRKEY                                    CGL029
     I**********                              1   60WCNUM                                     CSD027
     I                                        1   6 WCNUM                                     CSD027
     I                                        7   9 WCCY
     I**********                             10  130WACOD                                     CGL029
     I**********                             14  150WACSQ                                     CGL029
     I                                       10  190WACOD                                     CGL029
     I                                       20  210WACSQ                                     CGL029
      * Include Booking Branch Code in ACCNT key                          S01117
     I**********                             16  18 WWBRCA                             S01117 CGL029
     I                                       22  24 WWBRCA                                    CGL029
      ** Split bank a/c for 'ACCNT' key
     I**********                             16  27 DBNKAC                S01117
     I**********                             16  210D16#21                S01117
     I**********                             22  250D22#25                S01117
     I**********                             26  27 D26#27                S01117
      * Fields renamed to be more meaningful                              S01117
     I**********                             19  30 DBNKAC                             S01117 CGL029
     I**********                             19  240W@CNUM                             S01117 CGL029
     I**********                             25  280W@ACOD                             S01117 CGL029
     I**********                             29  30 W@ACSQ                             S01117 CGL029
     I                                       25  42 DBNKAC                                    CGL029
     I**********                             25  300W@CNUM                             CGL029 CSD027
     I                                       25  30 W@CNUM                                    CSD027
     I                                       31  400W@ACOD                                    CGL029
     I                                       41  42 W@ACSQ                                    CGL029
      *
      **  Data structure for PRONO updating to redefine array PBAL as
      **  file field PNB  ( Prono balances )
      *
     I            DS
     I                                    P   1  400PBAL
     I                                        1  40 PNB
      *
      **  Data structure for PRONO updating to redefine array PDAT as
      **  file field PND  ( Prono dates )
      *
     I            DS
     I                                    P   1  150PDAT
     I                                        1  15 PND
      *
      **  Data structure for OLPOS updating to redefine array OBLI as
      **  file field OFI  ( Olpos incoming balances )
      *
     I            DS
     I                                    P   1 1280OBLI
     I                                        1 128 OFI
      *
      **  Data structure for OLPOS updating to redefine array OBLO as
      **  file field OFO  ( Olpos outgoing balances )
      *
     I            DS
     I                                    P   1 1280OBLO
     I                                        1 128 OFO
      *
      **  Data structure for OLPOS updating to redefine array ODAT as
      **  file field ODT  ( Olpos dates )
      *
     I            DS
     I                                    P   1  480ODAT
     I                                        1  48 ODT
      *
      **  Program status data structure for workstation ID &  user ID
      *
     IPSDS       SDS
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      254 263 USRID
      *
      **   Local data area to hold database error information
      *
     I*DA*********DS                            256                       S01194
     I**********                            134 138 DBFILE                S01194
     I**********                            139 167 DBKEY                 S01194
     I**********                            168 175 DBPGM                 S01194
     I**********                            176 1770DBASE                 S01194
     IDBERR       DS                            256                       S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
      *
      **  Data structure for commitment text.
      *
     ICMTTXT      DS
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCDX
     I                                       26  35 USRIDX
     I                                       51  70 BTEXT
     I/COPY WNCPYSRC,DL1922I001
      *
0392 ISDBANK    E DSSDBANKPD                                              S01194
0393 I* Bank details accessed via access program                          S01194
0393 I*                                                                   S01194
0392 ISDBSRT    E DSSDBSRTPD                                              S01194
0393 I* Base Rate code details accessed via access program                S01194
     I*                                                                   S01194
0392 ISDNOST    E DSSDNOSTPD                                              S01194
0393 I* Nostro code details accessed via access program                   S01194
     I*                                                                   S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     I* Retail details accessed via access program                        S01194
     I*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I* Module details accessed via access program                        S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     I* Dealing details accessed via access program                       S01194
     I*                                                                   CIR001
     I** DUMMY RECORD FORMAT FOR SAR DETAILS                              CIR001
     ISCSARD    E DSSCSARDPD                                              CIR001
     I*                                                                   CIR001
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     I*                                                                   S01194
     I* Dummy data structures used by access programs                     S01194
     I* (DSSDY only used if file record over 150 chars. long)             S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/COPY ZSRSRC,ZINTDYZ1                                               CIR001
     I/COPY ZSRSRC,ZDATE9Z2                                               CIR001
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      *
      *****************************************************************
      /TITLE MAIN LINE CODE
     C                     MOVEACPY@      BIS@   80
      *****************************************************************
      *
     C           *ENTRY    PLIST
     C                     PARM           RERUN   1
      *
      *
      **   Initialisation of program on 1st cycle only.
     C           *IN40     IFEQ '0'
     C                     EXSR INIT
     C                     END
      *
     C* CHAIN                                                             CIR001
     C           IRSCFL    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           PRDT                            CIR001
     C* SETLL                                                             CIR001
     C           IRSDTL    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           RCIP                            CIR001
     C                     KFLD           PRDT                            CIR001
     C* READE                                                             CIR001
     C           IRSDTP    KLIST                                          CIR001
     C                     KFLD           DLNO                            CIR001
     C                     KFLD           OTIN                            CIR001
     C                     KFLD           RCIP                            CIR001
      *
     C                     SETOF                     3334
      *                                                                                       CIR008
      ** Do not process if FRA/IRS Deals Authorisation is installed                           CIR008
      ** and Deal Authorisation Status is not "A".                                            CIR008
      *                                                                                       CIR008
     C           CIR008    IFEQ 'Y'                                                           CIR008
     C           FIDSTS    ANDNE'A'                                                           CIR008
     C                     ADD  1         WUNAUT                                              CIR008
     C                     ELSE                                                               CIR008
      *
      ** If this is a RERUN or if this is not a RERUN and the rate has
      ** not yet been fixed then do processing (else exit program).
      **
     C           CIR001    IFNE 'Y'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDNE'RS'                                      CIR001
     C           DTYP      ANDNE'RX'                                      CIR001
     C*                                                                   CIR001
     C           UBRTT     IFNE 0
     C                     TESTB'0'       UDNSI      80
     C                     ELSE
     C                     TESTB'0'       TDNSI      80
     C                     END
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C                     TESTB'34'      TLXI       80                   CIR001
     C                     END                                            CIR001
      *
     C           RERUN     IFEQ 'Y'
     C           RERUN     OREQ 'N'
     C           *IN80     ANDEQ'1'
      *
     C                     Z-ADD0         ZERO1  130
     C                     Z-ADD0         ZERO2  117
     C                     Z-ADD0         ZERO3   50
     C/COPY WNCPYSRC,DL1922C001
      *
      ** Perform FRA's processing
      *
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           DTYP      ANDEQ'RS'                                      CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDEQ'RX'                                      CIR001
     C                     EXSR IRS                                       CIR001
     C                     ELSE                                           CIR001
     C                     EXSR FRA
     C                     END                                            CIR001
      *
      ** Perform update of files if necessary.
      *
     C           *IN66     IFEQ '1'
      *
      ** Perform update of PF/DEALSDG.
      *
     C                     EXSR UPDATE
      *
      ** Perform update of PF/MEMOS - Shadow postings accounts.
      ** If the Retail Module is present and the Retail Account No. is used.
      *
     C***********          TESTB'2'       MODI1          25               E23407
     C***********          TESTB'7'       MODI2          25         E23407S01194
     C************IN25     IFEQ '0'                                 E23407S01194
     C***********          TESTB'2'       MODI5          25         E23407S01194
     C***********          END                                      E23407S01194
     C           BGRTBN    IFEQ 'Y'                                       S01194
     C           BGIOAC    OREQ 'Y'                                       S01194
     C                     MOVE '1'       *IN25                           S01194
     C                     END                                            S01194
     C           *IN25     IFEQ '1'
     C********** RACN      ANDEQ'Y'                                       S01194
     C           BMRANR    ANDEQ'Y'                                       S01194
     C           CIR001    IFNE 'Y'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDNE'RS'                                      CIR001
     C           DTYP      ANDNE'RX'                                      CIR001
     C                     EXSR UMEMAM
     C                     ELSE                                           CIR001
     C                     EXSR MEMIRS                                    CIR001
     C                     END                                            CIR001
     C                     END
      *
      ** Perform update of LF/PRONO - Projected Nostro Accounts.
      *
     C           CIR001    IFNE 'Y'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDNE'RS'                                      CIR001
     C           DTYP      ANDNE'RX'                                      CIR001
     C                     EXSR UPROAM
     C                     ELSE                                           CIR001
     C                     EXSR PROIRS                                    CIR001
     C                     END                                            CIR001
      *
      ** Perform update of LF/OLPOS - On Line Positions file.
      *
     C           CIR001    IFNE 'Y'                                       CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDNE'RS'                                      CIR001
     C           DTYP      ANDNE'RX'                                      CIR001
     C                     EXSR UOLPAM
     C                     ELSE                                           CIR001
     C                     EXSR OLPIRS                                    CIR001
     C                     END                                            CIR001
      *
      **   Commit details of changes to relevant files for each record.
      *
     C           CMTTXT    COMIT
     C*                                                                   046820
     C** Increment record count of PF/DEALSDG selected.                   046820
     C*                                                                   046820
     C           RECTOT    ADD  1         RECTOT                          046820
      *
      ** End of perform update of files if necessary.
     C                     END
     C***********                                                         046820
     C*****Increment*record*count*of*PF/DEALSDG*selected.**************   046820
     C***********                                                         046820
     C***********RECTOT    ADD  1         RECTOT                          046820
      *
     C                     END
      *                                                                                       CIR008
     C                     ENDIF                                                              CIR008
      *                                                                                       CIR008
     C/COPY WNCPYSRC,DL1922C002
      *
     C**If*no*records*read*from*PF/DLDLDGLC,*report*headings*******S01194 046820
     C*                                                                   046820
     C** If no records read from PF/DLDLDGLF, report headings             046820
     C** should still be set up                                           S01194
     C*                                                                   046820
     CLR         *IN40     IFEQ '0'                                       S01194
     CLR                   EXSR #ZZ                                       S01194
     CLR                   END                                            S01194
      *****************************************************************
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
      /TITLE FRA SUBROUTINE
      *****************************************************************
      *                                                               *
      *    FRA SR: TO CALCULATE INTEREST PAYMENT AMOUNTS IF           *
      *               APPLICABLE ,FOR FRA.                            *
      *                                                               *
      *    CALLED FROM : MAIN PROCESSING                              *
      *                                                               *
      *    CALLS : DLRADS, SUB01U, SUB01T                             *
      *                                                               *
      *****************************************************************
      *
     C           FRA       BEGSR
      *
      **  DEFINE FIELDS FOR SUBROUTINE
      *
     C                     MOVE '0'       *IN55
     C                     MOVE '0'       *IN56
     C                     MOVE '0'       *IN87
     C                     Z-ADD0         UEDAT   50
     C                     Z-ADD0         TEDAT   50
     C                     Z-ADD0         LTXDT   50
     C                     Z-ADD0         UTXDT   50
     C                     Z-ADD0         TTXDT   50
     C                     MOVE *BLANKS   PRINT   1
     C**********           MOVE ' '       PRTCF   1                       E02378
     C                     Z-ADD0         NAIANP 130
     C                     Z-ADD0         SZVDAT  50
     C                     Z-ADD0         SZMDAT  50
     C                     Z-ADD0         SZICB   10
     C                     Z-ADD0         SZPPL  130
     C                     Z-ADD0         SZIANP 130
     C                     Z-ADD0         SZFIX  117
     C                     Z-ADD0         SZFLT  117
     C                     Z-ADD0         WRK6   150
     C                     Z-ADD0         INTX   130
     C                     Z-ADD0         DSANOT 130
     C                     Z-ADD0         PAYD    50
     C                     Z-ADD0         TAXPY  130
     C                     Z-ADD0         @UBRTE 117
     C                     Z-ADD0         @TBRTE 117
     C                     MOVE *BLANKS   SETL    1
     C*********************SETOF*************        201466               E23400
     C                     SETOF                       1466               E23400
      *
      **  For FRA'S both our and their event dates = value date.
      *
     C                     Z-ADDVDAT      UEDAT
     C                     Z-ADDVDAT      TEDAT
      *
      *
      **  Identify all deals for which our or their pay/receive
      **  reporting or interest payment confirmations are required.
      *
      *
     C                     MOVE 'Y'       PRINT
      *
      ****i)*If*the*maturity confirmation indicator = Y                   E02378
      *******check*if*payment confirmations are to be produced.           E02378
      ********************                                                E02378
     C********** MCRI      IFEQ 'Y'                                       S01194
     C***********BNMCRI*** IFEQ 'Y'                                S01194 E02378
      ********************                                                E02378
      *******Produce*payment confirmations as next interest               E02378
      *******fix*date*is**LT next working day.(i.e. Today)                E02378
      ********************                                                E02378
     C******************** MOVE 'Y'       PRTCF                           E02378
      ********************                                                E02378
     C******************** END                                            E02378
      ********************                                                E02378
      ********************                                                E02378
      ****ii)*Payment*confirmations and telexes can only be done          E02378
      ********if*they*are*still outstanding,                              E02378
      ********so*in*addition to i) the following applies.                 E02378
      **      Payment confirmations and telexes can only be done          E02378
      **      if they are still outstanding :                             E02378
      *
     C** Check to see if telex or confirmations have been produced
     C*
     C                     TESTB'34'      TLXI         14
     C                     TESTB'23'      CNFI         16
     C*
      *
     C           UBRTT     IFNE 0
      *
     C           *IN14     IFEQ '1'
     C           *IN16     ANDEQ'1'
     C           RERUN     ANDEQ'N'
     C                     MOVE *BLANKS   PRINT
     C                     END
      *
     C                     ELSE
     C           *IN14     IFEQ '1'
     C           *IN16     ANDEQ'1'
     C           RERUN     ANDEQ'N'
     C                     MOVE *BLANKS   PRINT
     C                     END
      *
     C                     END
     C*                                                                   046820
     C** Check if cancellations have been produced for this deal, if      046820
     C** not output a record to DLINDDM.                                  046820
     C*                                                                   046820
     C           RERUN     IFEQ 'Y'                                       046820
     C           RECI      ANDEQ'R'                                       046820
     C                     TESTB'7'       TLXI           15               046820
     C*                                                                   046820
     C           LSWS      IFGT *ZEROS                                    046820
     C           *IN15     ANDEQ'0'                                       046820
     C                     MOVE 'Y'       PRINT                           046820
     C                     MOVEA'11'      *IN,75                          046820
     C                     ELSE                                           046820
     C                     MOVE *BLANKS   PRINT                           046820
     C                     END                                            046820
     C*                                                                   046820
     C                     END                                            046820
      *
      **  CALCULATE AMOUNTS OF INTEREST PAYABLE FOR THOSE DEALS
      **  IDENTIFIED ABOVE
      *
      **  ////////////////////////////
      **  FRA DEAL TYPE CALCULATIONS
      **  ////////////////////////////
      *
      *
      **  If our base rate code is not zero and the floating rate has
      **  not been set,or if our base rate code is not equal to zero
      **  ,and the input parameter RERUN is equal to  'Y' then:-
      **  Access floating rate for base rate using SR:SUB01U
      *
     C           PRINT     IFEQ 'Y'
      *
     C*********************Z-ADD0*********RATE       2079                 E23400
     C** Set RATE to zero and at the same time initalise *IN79            E23400
     C                     Z-ADD0         RATE         79                 E23400
      *
     C           UBRTT     IFNE 0
      *
     C*********************TESTB'1'*******UDSTI          20 ON-NEG. INT.  E23400
     C                     TESTB'0'       UDNSI          79 ON-RATE SET
      *
     C           *IN79     IFEQ '0'
     C           RERUN     OREQ 'Y'
      *
     C                     EXSR SUB01U
     C                     MOVE '1'       *IN55
     C                     Z-ADDRATE      UEINR
     C                     Z-ADDBBRTE     @UBRTE
      *
      ** If RERUN and *IN79 is off, then rate has not been previously
      ** set and hence deal shouldn't be reversed before re-fixing rate
      *
     C           RERUN     IFEQ 'Y'
     C           *IN79     ANDEQ'0'
     C                     MOVE 'N'       @PRVST  1
     C                     ELSE
     C                     MOVE 'Y'       @PRVST
     C                     END
      *
      ** Set on deals file update indicator.
     C           RECI      IFNE 'R'                                       046820
     C                     MOVE '1'       *IN66
     C                     END                                            046820
      *
      ** Increment count of deals with rate fixed.
     C                     ADD  1         RTFIX
     C***************************************                             E23400
     C************IN20*****IFEQ*'1'**********                             E23400
     C*********************Z-SUBRATE******UEINR                           E23400
     C*********************END***************                             E23400
      *
     C                     END
      *
     C                     END
      *
      *
      **  If their base rate code is not zero and the floating rate has
      **  not been set,or if their base rate code is not equal to zero
      **  ,and the input parameter RERUN is equal to  'Y' then:-
      **  Access floating rate for base rate using SR:SUB01T
      *
     C           TBRTT     IFNE 0
      *
     C*********************TESTB'1'*******TDSTI          20               E23400
     C                     TESTB'0'       TDNSI          79
      *
     C           *IN79     IFEQ '0'
     C           RERUN     OREQ 'Y'
      *
     C                     EXSR SUB01T
     C                     MOVE '1'       *IN56
     C                     Z-ADDRATE      TEINR
     C                     Z-ADDBBRTE     @TBRTE
      *
      ** If RERUN and *IN79 is off, then rate has not been previously
      ** set and hence deal shouldn't be reversed before re-fixing rate
      *
     C           RERUN     IFEQ 'Y'
     C           *IN79     ANDEQ'0'
     C                     MOVE 'N'       @PRVST
     C                     ELSE
     C                     MOVE 'Y'       @PRVST
     C                     END
      *
      ** Set on deals file update indicator.
     C           RECI      IFNE 'R'                                       046820
     C                     MOVE '1'       *IN66
     C                     END                                            046820
      *
      ** Increment count of deals with rate fixed.
     C                     ADD  1         RTFIX
     C***************************************                             E23400
     C************IN20*****IFEQ*'1'**********                             E23400
     C*********************Z-SUBRATE******TEINR                           E23400
     C*********************END***************                             E23400
      *
     C                     END
      *
     C                     END
      *
      **  ESTABLISH DISCOUNTED SETTLEMENT AMOUNT NET OF TAX AND WHICH
      **  SETTLEMENT INSTRUCTIONS WILL BE USED TO SETTLE THE PAYMENT
      *
      **  CALCULATE THE NET ACCRUED INTEREST ADJUSTMENTS NOT POSTED
      *
     C           UEINR     IFGE TEINR
     C           UAIAN     SUB  TAIAN     NAIANP
     C                     MOVE 'P'       SETL
     C                     ELSE
     C           TAIAN     SUB  UAIAN     NAIANP
     C                     MOVE 'R'       SETL
     C                     END
      *
      **  IF NEGATIVE INTEREST INDICATOR IS ON, REVERSE THE SIGN
      **  OF THE EFECTIVE INTEREST RATE - FOR DLRADS.
      *
     C                     Z-ADDUEINR     UEINRX 117
     C                     Z-ADDTEINR     TEINRX 117
     C***************************************                             E23400
     C************IN20*****IFEQ*'1'**********                             E23400
     C*********************Z-SUBUEINR*****UEINRX                          E23400
     C*********************Z-SUBTEINR*****TEINRX                          E23400
     C*********************END***************                             E23400
      *
      **  CALCULATE THE DISCOUNTED SETTLEMENT AMOUNT AS POSITIVE
      *
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDNAIANP    SZIANP
     C                     Z-ADDRATE      SZFLT
      *
     C           UBRTT     IFNE 0
     C                     MOVE UICBS     SZICB
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDTEINRX    SZFIX
     C                     Z-ADDUEINRX    SZFLT
      *
     C                     ELSE
      *
     C                     MOVE TICBS     SZICB
     C                     Z-ADDTPAMT     SZPPL
     C                     Z-ADDUEINRX    SZFIX
     C                     Z-ADDTEINRX    SZFLT
      *
     C                     END
      *
     C                     EXSR DLRADS
      *
      **  IF DEAL IS TAXABLE CALCULATE INT TAX ON DISCOUNTED
      **  SETTLEMENT AMOUNT
      *
     C           TAXI      IFEQ 'Y'
     C           SETL      ANDEQ'P'
     C********** SZDSA     MULT TAXR      WRK6                            S01194
     C           SZDSA     MULT BNHKTR    WRK6                            S01194
     C           WRK6      DIV  100       INTX
      *
     C                     END
      *
      **  CALCULATE THE DISCOUNTED SETTLEMENT AMOUNT NET OF TAX
      *
     C           SZDSA     SUB  INTX      DSANOT
      *
      * /////////////////////////////////////
      **  SET UP PAY/RECEIVE INSTRUCTIONS
      *
     C                     MOVE ' '       CNRQ
      *
     C                     EXSR AB                         EXSR **AB**
      *
     C                     Z-ADD0         PRI1    10
     C                     Z-ADD0         PRI2    10
     C                     Z-ADD0         PRI3    10
      *
      * /////////////////////////////////////
      **  SET UP INTEREST PAYMENT CONFIRMATIONS
      *
     C*********  PRTCF     CASEQ'Y'       BC               EXSR **BC**    E02378
     C*********            END                                            E02378
     C                     EXSR BC                                        E02378
      *
     C***********          END                             (PRINT = Y)    046820
      *
      /SPACE 3
      * /////////////////////////////////////
      **  SET UP INTEREST FIX CONFIRMATIONS
      *
     C                     EXSR BD
      *
     C                     END                             (PRINT = Y)    046820
     C           FRA9      ENDSR
      *
      *****************************************************************
      /TITLE SUB01U SUBROUTINE
      *****************************************************************
      *    SUB01U SR: TO PROCESS FRA DEAL TYPES                       *
      *    CALLED FROM : FRA                                          *
      *    CALLS :                                                    *
      *****************************************************************
     C           SUB01U    BEGSR
      *
      **  DEFINE FIELDS FOR SUBROUTINE
     C                     Z-ADD0         BRDAT   50
     C                     Z-ADD0         RATE   117
     C                     Z-ADD0         PCNT   137
     C**********           MOVE *BLANKS   KEY1   12                       S01194
     C                     MOVE *BLANKS   KEY2    5
      *
      ****ACCESS*BASE*RATE*RECORD****                                     S01194
     C**********           MOVEL'21'      KEY1                            S01194
     C                     MOVE UBRTT     KEY2
     C                     MOVELUCUCY     KEY2
      *                                                                   S01194
      * (KEY2 only used in case of DB error to set up LDA)                S01194
      *                                                                   S01194
      * Since UBRTT is a 2N field, move it to a 2A work field             S01194
      * for call to access object                                         S01194
     C                     MOVE UBRTT     @UBRTT  2                       S01194
      *                                                                   S01194
     C**********           MOVE KEY2      KEY1                            S01194
     C********** KEY1      CHAINTABDLEI              13                   S01194
      *                                                                   S01194
      * Get details for Our Base Rate Type/Currency using call            S01194
      * to access object                                                  S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM UCUCY     @UCUCY  3                       S01194
     C                     PARM           @UBRTT                          S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
      *                                                                   S01194
     C********** *IN13     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '05'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELKEY1      DBKEY            *      05     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'005'     DBASE            ***************S01194
     C                     MOVE 'SDBSRTPD'DBFILE           *   DBERROR   *S01194
     C                     MOVELKEY2      DBKEY            *      05     *S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END                                            S01194
      *
      **  OBTAIN CURRENT BASE RATE UNLESS NEW VALUE DATE OF RATE CHANGE
      **  IS LESS THAN OR EQUAL TO THE FIX DATE IN WHICH CASE OBTAIN
      **  NEW BASE RATE
     C********** VDNR      IFLE UINFD                                     S01194
     C           BAVDNR    IFLE UINFD                                     S01194
     C**********           Z-ADDNBRT      RATE                            S01194
     C                     Z-ADDBANBRT    RATE                            S01194
     C**********           Z-ADDVDNR      BRDAT                           S01194
     C                     Z-ADDBAVDNR    BRDAT                           S01194
     C                     END
     C           RATE      IFEQ 0
     C**********           Z-ADDBRTE      RATE                            S01194
     C                     Z-ADDBACBSR    RATE                            S01194
     C**********           Z-ADDVDRC      BRDAT                           S01194
     C                     Z-ADDBAVDRC    BRDAT                           S01194
     C                     END
      *
     C                     Z-ADDRATE      BBRTE  117
      *
      **  CALCULATE THE NEW EFFECTIVE INTEREST RATE
     C           USPIN     IFEQ 'A'
     C           RATE      ADD  URTSP     RATE
     C                     END
     C           USPIN     IFEQ 'S'
     C           RATE      SUB  URTSP     RATE
     C                     END
     C           USPIN     IFEQ 'P'
     C           RATE      MULT URTSP     PCNT
     C           PCNT      DIV  100       PCNT
     C           RATE      ADD  PCNT      RATE
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SUB01T SUBROUTINE
      *****************************************************************
      *    SUB01T SR: TO PROCESS FRA DEAL TYPES                       *
      *    CALLED FROM : FRA                                          *
      *    CALLS :                                                    *
      *****************************************************************
      *
     C           SUB01T    BEGSR
      *
      **  DEFINE FIELDS FOR SUBROUTINE
     C                     Z-ADD0         BRDAT   50
     C                     Z-ADD0         RATE   117
     C                     Z-ADD0         PCNT   137
     C**********           MOVE *BLANKS   KEY1   12                       S01194
     C                     MOVE *BLANKS   KEY2    5
      *
      ****ACCESS*BASE*RATE*RECORD****                                     S01194
     C**********           MOVEL'21'      KEY1                            S01194
     C                     MOVE TBRTT     KEY2
     C                     MOVELTCUCY     KEY2
      *                                                                   S01194
      * (KEY2 only used in case of DB error to set up LDA)                S01194
      *                                                                   S01194
      * Since TBRTT is a 2N field, move it to a 2A work field             S01194
      * for call to access object                                         S01194
     C                     MOVE TBRTT     @TBRTT  2                       S01194
      *                                                                   S01194
     C**********           MOVE KEY2      KEY1                            S01194
     C********** KEY1      CHAINTABDLEI              13                   S01194
      *
      * Get details for Their Base Rate Type/Currency using call          S01194
      * to access object                                                  S01194
     C                     CALL 'AOBSRTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY    '@OPTN                           S01194
     C                     PARM TCUCY     @TCUCY  3                       S01194
     C                     PARM           @TBRTT                          S01194
     C********** SDBSRT    PARM SDBSRT    DSFDY                     S01194CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
      *                                                                   S01194
     C********** *IN13     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '06'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELKEY1      DBKEY            *      06     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'006'     DBASE            ***************S01194
     C                     MOVE 'SDBSRTPD'DBFILE           *   DBERROR   *S01194
     C                     MOVELKEY2      DBKEY            *      06     *S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END                                            S01194
      *
      **  OBTAIN CURRENT BASE RATE UNLESS NEW VALUE DATE OF RATE CHANGE
      **  IS LESS THAN OR EQUAL TO THE FIX DATE IN WHICH CASE OBTAIN
      **  NEW BASE RATE
     C********** VDNR      IFLE TINFD                                     S01194
     C           BAVDNR    IFLE TINFD                                     S01194
     C**********           Z-ADDNBRT      RATE                            S01194
     C                     Z-ADDBANBRT    RATE                            S01194
     C**********           Z-ADDVDNR      BRDAT                           S01194
     C                     Z-ADDBAVDNR    BRDAT                           S01194
     C                     END
     C           RATE      IFEQ 0
     C**********           Z-ADDBRTE      RATE                            S01194
     C                     Z-ADDBACBSR    RATE                            S01194
     C**********           Z-ADDVDRC      BRDAT                           S01194
     C                     Z-ADDBAVDRC    BRDAT                           S01194
     C                     END
      *
     C                     Z-ADDRATE      BBRTE  117
      *
      **  CALCULATE THE NEW EFFECTIVE INTEREST RATE
     C           TSPIN     IFEQ 'A'
     C           RATE      ADD  TRTSP     RATE
     C                     END
     C           TSPIN     IFEQ 'S'
     C           RATE      SUB  TRTSP     RATE
     C                     END
     C           TSPIN     IFEQ 'P'
     C           RATE      MULT TRTSP     PCNT
     C           PCNT      DIV  100       PCNT
     C           RATE      ADD  PCNT      RATE
     C                     END
      *
     C                     ENDSR
      *****************************************************************
      /TITLE DLRADS SUBROUTINE
      *****************************************************************
      *                                                               *
      *   SR: DLRADS - TO CALCULATE DISCOUNTED SETTLED AMOUNT FOR FRA *
      *                                                               *
      *   CALLED FROM :- FRA                                          *
      *   CALLS       :- ZDATE1,ZDATE2                                *
      *                                                               *
      *****************************************************************
      *
     C           DLRADS    BEGSR                           ** DLRADS **
      *
     C                     Z-ADDSZVDAT    SZVDAT  50
     C                     Z-ADDSZMDAT    SZMDAT  50
     C                     Z-ADDSZPPL     SZPPL  130
     C                     Z-ADDSZFIX     SZFIX  117
     C                     Z-ADDSZFLT     SZFLT  117
     C                     Z-ADDSZICB     SZICB   10
     C                     Z-ADDSZIANP    SZIANP 130
     C                     Z-ADD0         SZICVL  30
     C                     Z-ADD0         SZSDAT  50
     C                     Z-ADD0         SZEDAT  50
     C                     Z-ADD0         SZPER   50
     C                     Z-ADD0         SPPER   50                                        MD051152
     C                     Z-ADD0         STYR    20
     C                     Z-ADD0         STTXDT  40
     C                     Z-ADD0         STDAY   20
     C                     Z-ADD0         STMTH   20
     C                     Z-ADD0         ENDYR   20
     C                     Z-ADD0         ENDWRK  40
     C                     Z-ADD0         ENDDAY  20
     C                     Z-ADD0         ENDMTH  20
     C                     Z-ADD0         YEAR1   40
     C                     Z-ADD0         STORE   40
     C                     Z-ADD0         CHK     10
     C                     Z-ADD0         YEAR2   40
     C                     Z-ADD0         MTHS    20
     C                     Z-ADD0         MTHS2   40
     C                     Z-ADD0         SZWRK1 117
     C**********           Z-ADD0         SZWRK2 157                      043304
     C                     Z-ADD0         SZWRK2 207                      043304
     C                     Z-ADD0         SZWRK3  50
     C                     Z-ADD0         SZWRK4 147
     C                     Z-ADD0         SZWRK5 147
     C**********           Z-ADD0         SZWRK6 159                      E35983
     C                     Z-ADD0         SZWRK6 150                      E35983
     C                     Z-ADD0         SZWRK7 129
     C                     Z-ADD0         SZWRK8 150                      AUS021
     C                     Z-ADD0         SZWRK9 157                      AUS021
     C***********          Z-ADD0         SZSETL 150                      051372
     C                     Z-ADD0         SZSETL 180                      051372
     C                     Z-ADD0         SZRDF  117
     C                     Z-ADD0         SZRSA  150
     C                     Z-ADD0         SZRDS  130
     C                     Z-ADD0         SZDISC 117
     C                     Z-ADD0         SZDSA  150
     C                     Z-ADD0         DATST   60
     C                     Z-ADD0         DATEND  60
     C                     Z-ADD0         SLEAP   50
     C                     Z-ADD0         ELEAP   50
     C                     Z-ADD0         CHK2    10
     C                     SETOF                     89
     C*                                                                   AUS021
     C**  CHECK IF AUSTRALIA FORMULA REQUIRED                             AUS021
     C*                                                                   AUS021
     C           SETF      IFEQ 'A'                                       AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING AUSTRALIAN         AUS021
     C*   FORMULA                                                         AUS021
     C*                                                                   AUS021
     C**  CALCULATE DAYS TO MATURITY                                      AUS021
     C*                                                                   AUS021
     C           SZMDAT    SUB  SZVDAT    SZWRK3                          AUS021
     C*                                                                   AUS021
     C**  MULTIPLY FACE VALUE BY (DAYS IN YEAR x 100)                     AUS021
     C*                                                                   AUS021
     C           SZPPL     MULT 36500     SZSETL                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE PROCEEDS FROM FLOATING RATE                           AUS021
     C*                                                                   AUS021
     C           SZWRK3    MULT SZFLT     SZWRK2                          AUS021
     C                     ADD  36500     SZWRK2                          AUS021
     C           SZWRK2    IFNE *ZEROS                                    AUS021
     C           SZSETL    DIV  SZWRK2    SZRSA     H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZRSA                           AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  CALCULATE PROCEEDS FROM FIXED AMOUNT                            AUS021
     C*                                                                   AUS021
     C           SZWRK3    MULT SZFIX     SZWRK2                          AUS021
     C                     ADD  36500     SZWRK2                          AUS021
     C           SZWRK2    IFNE *ZEROS                                    AUS021
     C           SZSETL    DIV  SZWRK2    SZWRK8    H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZWRK8                          AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT                          AUS021
     C*                                                                   AUS021
     C           SZRSA     IFGT SZWRK8                                    040318
     C           SZRSA     SUB  SZWRK8    SZRDS                           AUS021
     C                     ELSE                                           040318
     C           SZWRK8    SUB  SZRSA     SZRDS                           040318
     C                     END                                            040318
     C*                                                                   AUS021
     C                     ELSE                                           AUS021
     C*                                                                   AUS021
     C**  CHECK IF U.S.A FORMULA REQUIRED                                 AUS021
     C*                                                                   AUS021
     C           SETF      IFEQ 'U'                                       AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING U.S.A FORMULA      AUS021
     C*                                                                   AUS021
     C**  CALCULATE DAYS TO MATURITY                                      AUS021
     C*                                                                   AUS021
     C           SZMDAT    SUB  SZVDAT    SZWRK3                          AUS021
     C*                                                                   AUS021
     C**  MULTIPLY INTEREST SETTLEMENT RATE BY DAYS TO MATURITY           AUS021
     C**  AND ADD (DAYS IN YEAR x 100)                                    AUS021
     C*                                                                   AUS021
     C           SZFLT     MULT SZWRK3    SZWRK9                          AUS021
     C                     ADD  36000     SZWRK9                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE DIFFERENCE in RATES                                   AUS021
     C*                                                                   AUS021
     C           SZFLT     IFGT SZFIX                                     AUS021
     C           SZFLT     SUB  SZFIX     SZWRK1                          AUS021
     C                     ELSE                                           AUS021
     C           SZFIX     SUB  SZFLT     SZWRK1                          AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C**  MULTIPLY DIFFERENCE IN RATES BY DAYS TO MATURITY AND            AUS021
     C**  CONTRACT AMOUNT                                                 AUS021
     C*                                                                   AUS021
     C           SZWRK1    MULT SZWRK3    SZWRK2                          AUS021
     C           SZWRK2    MULT SZPPL     SZWRK2                          AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT                          AUS021
     C*                                                                   AUS021
     C           SZWRK9    IFNE *ZEROS                                    AUS021
     C           SZWRK2    DIV  SZWRK9    SZRDS     H                     AUS021
     C                     ELSE                                           AUS021
     C                     Z-ADD*ZEROS    SZRDS                           AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C                     ELSE                                           AUS021
     C*                                                                   AUS021
     C**  CALCULATE DISCOUNTED SETTLEMENT AMOUNT USING U.K. FORMULA       AUS021
     C*                                                                   AUS021
      *
      **  DETERMINE VALUE ASSOCIATED WITH INTEREST CALCULATION BASIS
      *
     C           SZICB     IFEQ 2
     C           SZICB     OREQ 3
     C           SZICB     OREQ 5
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C                     Z-ADD360       SZICVL
     C                     END
      *
     C           SZICB     IFEQ 1
     C           SZICB     OREQ 4
     C                     Z-ADD365       SZICVL
     C                     END
      *
     C           SZICB     IFEQ 6
     C                     Z-ADD366       SZICVL
     C                     END
      *
      **  SET START DATE EQUAL TO VALUE DATE
      *
     C                     Z-ADDSZVDAT    SZSDAT
      *
      **  PROCESS UNTIL END DATE IS GREATER THAN MATURITY DATE
      *
     C           *IN89     DOUEQ'1'
      *
      **  EXECUTE SUB-ROUTINE ZDATE2
      *
     C                     Z-ADDSZSDAT    ZDAYNO
      *
     C                     EXSR ZDATE2
      *
      **  INCREMENT YEAR BY 1
      *
     C                     ADD  1         ZYEAR
     C                     MOVE ZYEAR     ZDATE
     C*                                                                   100140
     C* 29th February does not exist in a non-leap year.                  100140
     C*                                                                   100140
     C           ZMTH      IFEQ 02                                        100140
     C           ZDAY      ANDEQ29                                        100140
     C                     Z-ADD28        ZDAY                            100140
     C           *IN98     IFEQ '0'                                       156954
     C                     MOVELZDAY      ZDATE                           100140
     C                     ELSE                                           156954
     C                     MOVE ZDAY      W@MDY   40P                     156954
     C                     MOVELZMTH      W@MDY                           156954
     C                     MOVELW@MDY     ZDATE                           156954
     C                     END                                            156954
     C                     END                                            100140
      *
      **  EXECUTE SUB-ROUTINE ZDATE1
      *
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SZEDAT
     C*                                                                   031967
     C**  CHECK TO SEE IF MATURITY DATE FALLS BETWEEN PERIOD END DATE     031967
     C****AND*PERIOD*END*DATE*+*5*(THIS*WILL*ONLY*HAPPEN*IF*AN*FRA**031967060995
     C**  AND PERIOD END DATE + 10 (THIS WILL ONLY HAPPEN IF AN FRA 031967060995
     C**  WAS ENTERED WITH AN INCREASED MATURITY DATE DUE TO THE          031967
     C**  ACTUAL MATURITY DATE FALLING ON A NON-WORKING DAY).             031967
     C**  IF IT DOES DO THE LATER DISCOUNTED SETTLEMENT AMOUNT            031967
     C**  CALCULATION UPTO MATURITY DATE OTHERWISE UPTO THE PERIOD        031967
     C**  END DATE. THE NUMBER 5 WAS CHOSEN AS THIS IS THE WORST          031967
     C**  POSIBLE CASE OF NON-WORKING DAYS IN A ROW (EASTER).             031967
     C*                                                                   031967
     C***********SZEDAT    ADD  5         #EDAT   50                031967060995
     C           SZEDAT    ADD  10        #EDAT   50                031967060995
      *
      **  IF END DATE IS GREATER THAN THE MATURITY DATE
      **  THEN REPLACE END DATE  BY MATURITY DATE
      *
     C           SZEDAT    IFGE SZMDAT
     C           SZEDAT    ORLT SZMDAT                                    031967
     C           #EDAT     ANDGESZMDAT                                    031967
     C                     SETON                     89
     C                     Z-ADDSZMDAT    SZEDAT
     C                     END
      *                                                                                       CIR013
     C           SZICB     IFEQ 9                                                             CIR013
     C           SZICB     OREQ 6                                                           MD051152
      * Convert start date to YYYYMMDD format                                                 CIR013
     C                     Z-ADDSZSDAT    @@DAYN  50                                          CIR013
     C                     EXSR ZDATE9                                                        CIR013
     C                     Z-ADD@@VDT     ZZDATA                                              CIR013
      *                                                                                       CIR013
      * Convert end date to YYYYMMDD format                                                   CIR013
     C                     Z-ADDSZEDAT    @@DAYN                                              CIR013
     C                     EXSR ZDATE9                                                        CIR013
     C                     Z-ADD@@VDT     ZZDATB                                              CIR013
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
      *                                                                                     MD051152
     C           SZICB     IFEQ 9                                                           MD051152
      *                                                                                       CIR013
     C                     EXSR #FEB29                                                        CIR013
      *                                                                                       CIR013
     C           #29FEB    IFEQ 'N'                                                           CIR013
     C                     Z-ADD365       SZICVL                                              CIR013
     C                     ELSE                                                               CIR013
     C                     Z-ADD366       SZICVL                                              CIR013
     C                     ENDIF                                                              CIR013
      *                                                                                       CIR013
     C                     ENDIF                                                              CIR013
      *
      **  CALCULATE THE PERIOD BETWEEN START DATE AND END DATE
      *
     C           SZICB     IFEQ 1
     C           SZICB     OREQ 2
     C           SZICB     OREQ 6
     C           SZICB     OREQ 9                                                             CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C           SZEDAT    SUB  SZSDAT    SZPER
     C                     END
      *                                                                                     MD051152
      ** Perform no. of days calculation for method 6                                       MD051152
     C           SZICB     IFEQ 6                                                           MD051152
      *                                                                                     MD051152
      ** If start and end date are in the same year, check if the                           MD051152
      ** year is a leap year and add no. of interest days to the                            MD051152
      ** relevant total                                                                     MD051152
     C           ZZYY1     IFEQ ZZYY2                                                       MD051152
     C           ZZYY1     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
     C                     Z-ADDSZPER     SPPER                                             MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
      ** else must break down the interest period into leap years                           MD051152
      ** and non-leap years                                                                 MD051152
     C                     ELSE                                                             MD051152
      ** Add 1 to starting year number                                                      MD051152
     C           ZZYY1     ADD  1         ZZYY2                                             MD051152
      * Get Midas day number for 1st Jan of year after start date                           MD051152
     C                     MOVE '01'      ZZMM2                                             MD051152
     C                     MOVE '01'      ZZDD2                                             MD051152
     C                     MOVE ZZDATB    ZZDTIN                                            MD051152
     C                     EXSR ZDAT10                                                      MD051152
     C                     Z-ADDZZMDNO    ZZENDW  50                                        MD051152
     C           ZZENDW    SUB  SZSDAT    SPPER                                             MD051152
      *                                                                                     MD051152
      ** Check if current year is a leap year                                               MD051152
     C           ZZYY1     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
      * Finally calculate the days for the last part-year up                                MD051152
      * to the end date                                                                     MD051152
      *                                                                                     MD051152
      * Get Midas day number for 1st Jan of current year                                    MD051152
     C                     MOVE '01'      ZZMM2                                             MD051152
     C                     MOVE '01'      ZZDD2                                             MD051152
     C                     MOVE ZZDATB    ZZDTIN                                            MD051152
     C                     EXSR ZDAT10                                                      MD051152
     C                     Z-ADDZZMDNO    ZZBEG   50                                        MD051152
     C           SZEDAT    SUB  ZZBEG     SPPER                                             MD051152
      *                                                                                     MD051152
      ** Check if year is a leap year                                                       MD051152
     C           ZZYY2     DIV  4         ZZWN5                                             MD051152
     C                     MVR            ZZWN5                                             MD051152
     C           ZZWN5     IFNE 0                                                           MD051152
     C                     Z-ADD365       SZICVL                                            MD051152
     C                     ELSE                                                             MD051152
     C                     Z-ADD366       SZICVL                                            MD051152
     C                     ENDIF                                                            MD051152
      *                                                                                     MD051152
      ** Calculate Settlement Amount                                                        MD051152
     C                     EXSR FRASR                                                       MD051152
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
     C                     ENDIF                                                            MD051152
      *
      **  IF THE END DATE IS LESS THAN OR EQUAL TO THE MATURITY DATE
      *
     C           *IN89     IFEQ '0'
      *
     C           SZICB     IFEQ 3
     C           SZICB     OREQ 4
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
     C           SZICB     OREQ 9                                                             CIR013
     C           #29FEB    ANDEQ'N'                                                           CIR013
     C                     Z-ADDSZICVL    SZPER
     C                     END
      *
     C           SZICB     IFEQ 5
     C                     Z-ADD365       SZPER
     C                     END
      *
     C                     ELSE
      *
      **  THE END DATE WAS REPLACED BY THE MATURITY DATE
      *
     C           SZICB     IFEQ 4
     C           SZICB     OREQ 5
     C           SZICB     OREQ 9                                                             CIR013
     C           #29FEB    ANDEQ'N'                                                           CIR013
     C           SZEDAT    SUB  SZSDAT    SZPER
      *
      **  CONVERT BOTH START AND END DAY NUMBERS TO DATES
      *
     C                     Z-ADDSZSDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATST
      *
     C                     Z-ADDSZEDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATEND
      *
      **  ATTEMPT TO CALCULATE THE DAY NUMBER FOR 29 FEB IN THE YEAR
      *
     C           *IN98     IFEQ '0'
     C                     MOVEL'2902'    DATST
     C                     MOVEL'2902'    DATEND
     C                     ELSE
     C                     MOVEL'0229'    DATST
     C                     MOVEL'0229'    DATEND
     C                     END
      *
     C                     Z-ADDDATST     ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    SLEAP
      *
      **  IF A DAY NUMBER IS FOUND CHECK IF IT LIES BETWEEN START DATE
      **  AND END DATE
      *
     C           *IN99     IFEQ '0'
      *
     C           SLEAP     IFGE SZSDAT
     C           SLEAP     ANDLESZEDAT
     C           SZPER     SUB  1         SZPER
     C                     END
     C                     END
      *
     C                     Z-ADDDATEND    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    ELEAP
      *
     C           *IN99     IFEQ '0'
      *
     C           ELEAP     IFGE SZSDAT
     C           ELEAP     ANDLESZEDAT
     C           SZPER     SUB  1         SZPER
     C                     END
     C                     END
      *
     C                     END
      *
      **  FOR METHOD 3 SPLIT BOTH START AND END DATES INTO THEIR
      **  RESPECTIVE DAY,MONTH AND YEAR PORTIONS
      *
     C           SZICB     IFEQ 3
     C           SZICB     OREQ 7                                         CIR004
     C           CIR004    ANDEQ'Y'                                       CIR004
      *
     C                     Z-ADD0         SZPER
      *
     C                     Z-ADDSZSDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATST
      *
     C                     MOVE DATST     STYR
     C                     MOVE DATST     STTXDT
     C           *IN98     IFEQ '0'
     C                     MOVELDATST     STDAY
     C                     MOVELSTTXDT    STMTH
     C                     ELSE
     C                     MOVELDATST     STMTH
     C                     MOVELSTTXDT    STDAY
     C                     END
      *
     C                     Z-ADDSZEDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     DATEND
      *
     C                     MOVE DATEND    ENDYR
     C                     MOVE DATEND    ENDWRK
     C           *IN98     IFEQ '0'
     C                     MOVELDATEND    ENDDAY
     C                     MOVELENDWRK    ENDMTH
     C                     ELSE
     C                     MOVELDATEND    ENDMTH
     C                     MOVELENDWRK    ENDDAY
     C                     END
      *
      **  CHECK START DATE FOR LEAP YEAR
      *
     C           STYR      ADD  1900      YEAR1
     C           YEAR1     DIV  4         STORE
     C                     MVR            CHK
      *
      **  CHECK END DATE FOR LEAP YEAR ALLOWING FOR CHANGE IN CENTURY
      *
     C           ENDYR     ADD  1900      YEAR2
     C           YEAR2     IFLT YEAR1
     C                     ADD  100       YEAR2
     C                     END
     C           YEAR2     DIV  4         STORE
     C                     MVR            CHK2
      *
      **  IF START MONTH DOES NOT EQUAL 2 SUBTRACT DAY PORTION FROM 30
      **  SETTING NEGATIVE RESULT TO ZERO FOR ACTUAL DAYS IN MONTH
      *
     C           STMTH     IFNE 2
     C           30        SUB  STDAY     SZPER
     C           SZPER     IFLT 0
     C                     Z-ADD0         SZPER
     C                     END
     C                     END
      *
      **  IF MONTH DOES EQUAL 2
      *
     C           STMTH     IFEQ 2
      *
      **  IF IT IS NOT A LEAP YEAR SUBTRACT DAY PORTION FROM 28
      *
     C           CHK       IFNE 0
     C           28        SUB  STDAY     SZPER
     C                     ELSE
      *
      **  IF IT IS A LEAP YEAR SUBTRACT DAY PORTION FROM 29
      *
     C           29        SUB  STDAY     SZPER
     C                     END
     C                     END
      *
      **  ADJUST START MONTH & YEAR TO CATER FOR YEAR END
      *
     C           STMTH     IFEQ 12
     C                     Z-ADD0         STMTH
     C                     ADD  1         YEAR1
     C                     END
      *
      **  IF END MONTH IS NOT EQUAL TO 2 AND END DAY IS 31; OR MONTH
      **  EQUALS 2 AND IT IS NOT A LEAP YEAR AND END DAY EQUALS 28;
      **  OR MONTH EQUALS 2 AND IT IS A LEAP YEAR AND END DAY
      **  EQUALS 29 THEN ADD 30 TO PERIOD COUNT
      *
     C           ENDMTH    IFNE 2
     C           ENDDAY    ANDEQ31
     C           ENDMTH    OREQ 2
     C           CHK2      ANDNE0
     C           ENDDAY    ANDEQ28
     C           SZICB     ANDEQ3                                         CIR004
     C           ENDMTH    OREQ 2
     C           CHK2      ANDEQ0
     C           ENDDAY    ANDEQ29
     C           SZICB     ANDEQ3                                         CIR004
      *
     C                     ADD  30        SZPER
      *
     C                     ELSE
      *
      **  ADD DAY NUMBER PORTION TO PERIOD COUNT
      *
     C                     ADD  ENDDAY    SZPER
      *
     C                     END
      *
      **  SUBTRACT 1 FROM END MONTH
      *
     C                     SUB  1         ENDMTH
      *
      **  IF START YEAR AND END YEAR ARE THE SAME SUBTRACT START
      **  MONTH FROM END MONTH
      *
     C           YEAR1     IFEQ YEAR2
     C           ENDMTH    SUB  STMTH     MTHS
     C                     ELSE
      *
      **  ADD END MTH TO THE RESULT OF SUBTRACTING START MONTH FROM 12
      *
     C           12        SUB  STMTH     MTHS
     C           ENDMTH    ADD  MTHS      MTHS
     C                     END
      *
      **  MULTIPLY THE NUMBER OF MONTHS BY 30 AND ADD TO THE PERIOD
      *
     C           MTHS      MULT 30        MTHS2
     C                     ADD  MTHS2     SZPER
      *
     C                     END
      *
     C                     END
      *
      **  CALCULATE THIS PERIOD'S DISCOUNTED SETTLEMENT AMOUNT USING
      **  THIS EQUATION WHERE SS = SETTLEMENT AMOUNT
      **                       D = PERIOD
      **
      **        SS = (BASE RATE - FIXED RATE) x D x PRINCIPAL
      **             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      **             (INTEREST CALC BASIS x 100) + (BASE RATE x D)
      *
     C           SZICB     IFNE 6                                                           MD051152
      *                                                                                     MD051152
     C           SZFLT     IFGE SZFIX
      *
     C           SZFLT     SUB  SZFIX     SZWRK1
      *
     C                     ELSE
      *
     C           SZFIX     SUB  SZFLT     SZWRK1
      *
     C                     END
      *
     C           SZWRK1    MULT SZPER     SZWRK2
      *                                                                   E35983
      * Multiply now by principal to get larger value for dividing        E35983
      * and avoid errors due to half-adjusting small numbers later        E35983
     C           SZWRK2    MULT SZPPL     SZWRK6                          E35983
      *                                                                   E35983
     C           SZICVL    MULT 100       SZWRK3
     C           SZFLT     MULT SZPER     SZWRK4
     C           SZWRK3    ADD  SZWRK4    SZWRK5
     C********** SZWRK2    DIV  SZWRK5    SZWRK6    H                     E35983
     C           SZWRK6    DIV  SZWRK5    SZSETL    H                     E35983
     C********** SZWRK6    MULT SZPPL     SZSETL    H                     E35983
      *                                                                                     MD051152
     C                     ENDIF                                                            MD051152
      *
      **  IF VALUE DATE = START DATE THEN FIRST PERIOD SO INITIALISE
      **  RUNNING DISCOUNT FACTOR TO 1
      *
     C           SZVDAT    IFEQ SZSDAT
      *
     C                     Z-ADD1         SZRDF
     C                     Z-ADDSZSETL    SZRDS
     C                     ELSE
     C**  DIVIDE THE DISCOUNTED SETTLEMENT AMOUNT BY THE RUNNING          E22610
     C**  DISCOUNT FACTOR TO REDISCOUNT THIS PERIOD'S SETTLEMENT AMOUNT   E22610
     C**  BACK TO START DATE                                              E22610
     C*                                                                   E22610
     C           SZSETL    DIV  SZRDF     SZRSA     H                     E22610
     C*                                                                   E22610
     C**  ADD THE REDISCOUNTED SETTLEMENT AMOUNT TO THE RUNNING           E22610
     C**  DISCOUNTED  SETTLEMENT TOTAL                                    E22610
     C*                                                                   E22610
     C           SZRSA     ADD  SZRDS     SZRDS                           E22610
     C*                                                                   E22610
     C                     END                                            E22610
      *                                                                                     MD051152
     C                     Z-ADD0         SZSETL                                            MD051152
      *
      **  CALCULATE THIS PERIOD'S DISCOUNT FACTOR USING THE EQUATION
      **
      **    FACTOR = 1 +     (D x BASE RATE)
      **                 ~~~~~~~~~~~~~~~~~~~~~~~~~~
      **                 (INTEREST CALC BASIS x 100)
      *
     C           SZWRK4    DIV  SZWRK3    SZWRK7    H
     C           1         ADD  SZWRK7    SZDISC    H
      *
      **  MULTIPLY THE DISCOUNT FACTOR BY THE RUNNING DISCOUNT FACTOR
      **  TO OBTAIN THE NEW RUNNING DISCOUNT FACTOR FOR REDISCOUNTING
      **  SETTLEMENT AMOUNTS BACK TO START DATE
      *
     C           SZDISC    MULT SZRDF     SZRDF     H
      *
     C****DIVIDE THE DISCOUNTED SETRTLEMENT AMOUNT BY THE RUNNING         E22610
     C****DISCOUNT FACTOR TO REDISCOUNT THIS PERIOD'S SETTLEMENT AMOUNT   E22610
     C****BACK TO START DATE                                              E22610
     C****                                                                E22610
     C****       SZSETL    DIV  SZRDF     SZRSA     H                     E22610
     C****                                                                E22610
     C****ADD THE REDISCOUNTED SETTLEMENT AMOUNT TO THE RUNNING           E22610
     C****DISCOUNTED  SETTLEMENT TOTAL                                    E22610
     C****                                                                E22610
     C****       SZRSA     ADD  SZRDS     SZRDS                           E22610
     C****                                                                E22610
     C****                 END                                            E22610
      *
      **  SET THE START DATE TO THE END DATE
      *
     C                     Z-ADDSZEDAT    SZSDAT
     C                     END
     C*                                                                   AUS021
     C                     END                                            AUS021
     C*                                                                   AUS021
     C                     END                                            AUS021
      *
      **  ADD THE NET ACCRUED INTEREST ADJUSTMENTS NOT POSTED TO THE
      **  RUNNING DISCOUNTED SETTLEMENT TOTAL TO GIVE THE DISCOUNTED
      **  SETTLEMENT AMOUNT TOTAL
      *
     C           SZIANP    ADD  SZRDS     SZDSA
      *
     C           DLRAD9    ENDSR
      *
     C**************************************************************************            MD051152
      /SPACE 5                                                                              MD051152
     C**************************************************************************            MD051152
     C           FRASR     BEGSR                                                            MD051152
      *                                                                                     MD051152
      **  Calculate this period's discounted settlement amount using                        MD051152
      **  this equation where SS = Settlement amount                                        MD051152
      **                       D = PERIOD                                                   MD051152
      **                                                                                    MD051152
      **        SS = (BASE RATE - FIXED RATE) x D x PRINCIPAL                               MD051152
      **             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                         MD051152
      **             (INTEREST CALC BASIS x 100) + (BASE RATE x D)                          MD051152
      *                                                                                     MD051152
     C           SZFLT     IFGE SZFIX                                                       MD051152
      *                                                                                     MD051152
     C           SZFLT     SUB  SZFIX     SZWRK1                                            MD051152
      *                                                                                     MD051152
     C                     ELSE                                                             MD051152
      *                                                                                     MD051152
     C           SZFIX     SUB  SZFLT     SZWRK1                                            MD051152
      *                                                                                     MD051152
     C                     END                                                              MD051152
      *                                                                                     MD051152
     C           SZWRK1    MULT SPPER     SZWRK2                                            MD051152
      *                                                                                     MD051152
      * Multiply now by principal to get larger value for dividing                          MD051152
      * and avoid errors due to half-adjusting small numbers later                          MD051152
     C           SZWRK2    MULT SZPPL     SZWRK6                                            MD051152
      *                                                                                     MD051152
     C           SZICVL    MULT 100       SZWRK3                                            MD051152
     C           SZFLT     MULT SZPER     SZWRK4                                            MD051152
     C           SZWRK3    ADD  SZWRK4    SZWRK5                                            MD051152
     C           SZWRK6    DIV  SZWRK5    W#SET6 180H                                       MD051152
      *                                                                                     MD051152
     C           W#SET6    ADD  SZSETL    SZSETL                                            MD051152
      *                                                                                     MD051152
     C                     ENDSR                                                            MD051152
      *                                                                                     MD051152
      *****************************************************************
      /TITLE AB SUBROUTINE
      *****************************************************************
      *                                                               *
      *    AB SR: FRA PAY/RECEIVE INSTRUCTIONS                        *
      *                                                               *
      *    CALLED FROM : FRA                                          *
      *                                                               *
      *    CALLS :                                                    *
      *                                                               *
      *****************************************************************
      *
     C           AB        BEGSR
      *
      **  DEFINE FIELDS FOR SUBROUTINE
      *
     C                     MOVEA'00'      *IN,75           *IN 75-76
     C                     MOVE *BLANKS   SETM    2
     C                     Z-ADD0         PIAMT  130
     C                     Z-ADD0         RIAMT  130
     C                     Z-ADD0         PRI1
     C                     Z-ADD0         PRI2
     C                     Z-ADD0         PRI3
     C                     Z-ADD0         EVDAT
     C                     Z-ADD0         TAXPY
     C                     Z-ADD0         UFIR                            CIR001
     C                     Z-ADD0         TFIR                            CIR001
      *
      **  A PAYMENT EVENT IS DUE TO BE REPORTED IF
      **  1) THE ASSOCIATED TELEX INDICATOR IS OFF
      *
     C           SETL      IFEQ 'P'
     C           SETL      OREQ 'B'                                       CIR001
     C                     Z-ADDUEDAT     PAYD                            CIR001
     C                     TESTB'3'       TLXI       75
     C                     MOVE PSETM     SETM
     C                     END
      *
     C           SETL      IFEQ 'R'
     C                     Z-ADDTEDAT     PAYD                            CIR001
     C                     TESTB'4'       TLXI       75
     C                     MOVE RSETM     SETM
     C                     END
      *
      ** If the programme is being RERUN produce Pay Receive Telexes.
     C           RERUN     IFEQ 'Y'
     C                     MOVE '1'       *IN75
     C                     END
      *
      **  2) A PAYMENT AMOUNT EXISTS (NET FOR 'FR')
      *
     C           DSANOT    IFNE 0
     C           DTYP      ANDEQ'FR'                                      CIR001
     C                     SETON                     76
     C                     END
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C           NETAMT    ANDNE0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ORNE 0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ORNE 0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      **  3) THE EVENT DATE IS LESS THAN OR EQUAL TO DATE OF NEXT
      **     WORKING DAY.
      *
      **  IF EVENT TO BE REPORTED.
      *
     C           *IN75     IFEQ '1'
     C           *IN76     ANDEQ'1'
      *                                                                   CIR001
      ** If deal is an IRS deal, update telex indicators accordingly.     CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           DTYP      ANDEQ'RS'                                      CIR001
     C           CIR001    OREQ 'Y'                                       CIR001
     C           DTYP      ANDEQ'RX'                                      CIR001
      *                                                                   CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
     C                     BITON'3'       TLXI                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                                           CIR007
     C                     BITON'4'       TLXI                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *
      **  CREATE A RECORD ON PF/DLINDDM
      *
      **  SET UP ACTION CODE
      *
     C                     MOVE 'I'       ACTC    1
     C                     MOVE 'I'       ACTCDX
      *
      **  Set up tax payable field.
      *
     C           DTYP      IFEQ 'FR'                                      CIR001
     C                     Z-ADDINTX      TAXPY
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C                     Z-ADDTAXC      TAXPY                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *
      ** Set up output record for PF/DLINDDM.
     C           DTYP      IFEQ 'FR'                                      CIR001
     C           SETL      IFEQ 'P'
      *
     C                     Z-ADDDSANOT    PIAMT
     C           DLCT      ADD  1         DLCT
     C                     Z-ADD1         PRI3
     C                     Z-ADDUEDAT     EVDAT
     C                     EXCPTOUR
      *
      * Else SETL is not equal to 'P'
     C                     ELSE
     C                     Z-ADDDSANOT    RIAMT
     C           DLCT      ADD  1         DLCT
     C                     Z-ADD1         PRI1
     C                     Z-ADDTEDAT     EVDAT
     C                     EXCPTTHEIR
      *
     C                     END
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' MATCHED DEAL RECORD                                 CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C                     Z-ADDNETAMT    PIAMT                           CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADD1         PRI3                            CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     EXCPTOUR                                       CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDNETAMT    RIAMT                           CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADD1         PRI1                            CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' UNMATCHED DEAL RECORDS                              CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADD1         PRI3                            CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     EXCPTOUR                                       CIR001
     C                     Z-ADD0         PIAMT                           CIR001
     C                     Z-ADD0         UFIR                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
     C                     Z-ADD1         PRI1                            CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RX' MATCHED DEAL RECORD                                 CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C           SETL      ANDEQ'B'                                       CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADD1         PRI1                            CIR001
     C                     Z-ADD1         PRI3                            CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     EXCPTBOTH                                      CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RX' UNMATCHED DEAL RECORDS                              CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADD1         PRI3                            CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     EXCPTOUR                                       CIR001
     C                     Z-ADD0         PIAMT                           CIR001
     C                     Z-ADD0         UFIR                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADD1         PRI1                            CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      ** Set on deals file update indicator.
     C           RECI      IFNE 'R'                                       046820
     C                     MOVE '1'       *IN66
     C                     END                                            046820
      *
     C                     END
      *
     C           AB9       ENDSR
      *
      *****************************************************************
      /TITLE BC SUBROUTINE
      *****************************************************************
      *                                                               *
      *    BC SR: INTEREST PAYMENT CONFIRMATIONS                      *
      *                                                               *
      *    CALLED FROM : FRA                                          *
      *                                                               *
      *    CALLS :                                                    *
      *                                                               *
      *****************************************************************
      ********************                                                E02378
      ****THE*FOLLOWING*CONDITIONS MUST BE SATISFIED FOR EACH             E02378
      ****PAYMENT*OR*RECEIVE CONFIRMATION TO BE PRODUCED                  E02378
      ********************                                                E02378
      ****1)*MATURITY*CONFIRMATIONS REQUIRED INDICATOR = Y                E02378
      ****2)*EVENT*DATE*MUST BE EQUAL OR LESS THAN                        E02378
      *******RUN*DATE*PLUS MATURITY CONFIRMATIONS TO GO WORKING DAYS      E02378
      ********************                                                E02378
      ****ABOVE*CONDITIONS (1 & 2) DETERMINED BEFORE ENTRY.               E02378
      *
     C           BC        BEGSR
      *
      **  DEFINE FIELDS FOR SUBROUTINE
      *
     C                     MOVEA'00'      *IN,75           *IN 75 & 76
     C                     MOVE *BLANKS   CNRQ    1
     C                     Z-ADD0         UFIR   117
     C                     Z-ADD0         EVDAT   50
     C                     Z-ADD0         TFIR   117
      *
      *  ///////////////////////
      **  PAYMENT CONFIRMATIONS
      *
     C           SETL      IFEQ 'P'
      *
      ****POINTS*1)*2)*,**SEE ABOVE 'BEGSR'                               E02378
      ****3)*THE*APPROPRIATE INTEREST CONFIRMATIION IND = 'OFF'           E02378
      ********************                                                E02378
      **  1) THE APPROPRIATE INTEREST CONFIRMATIION IND = 'OFF'           E02378
     C                     TESTB'2'       CNFI       75
      *
      ** If the programme is being RERUN produce Pay Receive Confirmations.
     C           RERUN     IFEQ 'Y'
     C                     MOVE '1'       *IN75
     C                     END
      *
      ****4)*THE*INTEREST*AMOUNT CALCULATED BEFORE MUST BE NON-ZERO       E02378
      *********************                                               E02378
      *   2) THE INTEREST AMOUNT CALCULATED BEFORE MUST BE NON-ZERO       E02378
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP1                                           S01408
     C*                                                                   S01408
     C           SZDSA     IFNE 0
     C           DTYP      ANDEQ'FR'                                      CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP2                                           S01408
     C*                                                                   S01408
     C                     SETON                     76
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP3                                           S01408
     C*                                                                   S01408
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C           UINTR     IFNE 0                                         CIR001
     C           TINTR     ORNE 0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C           UINTR     ANDNE0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UINTR     ANDNE0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      **  IF CONFIRMATION TO BE PRODUCED
      **  SET ON APPROPRIATE CONFIRMATION INDICATOR
      *
     C           *IN75     IFEQ '1'
     C           *IN76     ANDEQ'1'
     C                     SETON                     87
     C                     END
      *
     C                     END
      /SPACE 2
      *  ////////////////////////////////
      **  INTEREST RECEIPT CONFIRMATIONS
      *
     C           SETL      IFEQ 'R'
      *
      ****POINTS*1)*2),**SEE ABOVE 'BEGSR'                                E02378
      ****3)*THE*APPROPRIATE INTEREST CONFIRMATIION IND = 'OFF'           E02378
      **********************                                              E02378
      *   1) THE APPROPRIATE INTEREST CONFIRMATIION IND = 'OFF'           E02378
     C                     TESTB'3'       CNFI       75
      *
      ** If the programme is being RERUN produce Pay Receive Confirmations.
     C           RERUN     IFEQ 'Y'
     C                     MOVE '1'       *IN75
     C                     END
      *
      ****4)*THE*INTEREST*AMOUNT CALCULATED BEFORE MUST BE NON-ZERO       E02378
      ************************                                            E02378
      *   2) THE INTEREST AMOUNT CALCULATED BEFORE MUST BE NON-ZERO       E02378
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP5                                           S01408
     C*                                                                   S01408
     C           DSANOT    IFNE 0
     C           DTYP      ANDEQ'FR'                                      CIR001
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP6                                           S01408
     C*                                                                   S01408
     C                     SETON                     76
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP7                                           S01408
     C*                                                                   S01408
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL1922CCP8                                           S01408
     C*                                                                   S01408
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C           UINTR     IFNE 0                                         CIR001
     C           TINTR     ORNE 0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C           TINTR     ANDNE0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           TINTR     ANDNE0                                         CIR001
     C                     SETON                     76                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      **  IF CONFIRMATION TO BE PRODUCED
      **  SET ON APPROPRIATE CONFIRMATION INDICATOR
      *
     C           *IN75     IFEQ '1'
     C           *IN76     ANDEQ'1'
     C                     SETON                     87
     C                     END
      *
     C                     END
      *                                                                   CIR001
      ** If both sides are being processed, also set on *IN87.            CIR001
      *                                                                   CIR001
     C           SETL      IFEQ 'B'                                       CIR001
     C                     MOVE '1'       *IN87                           CIR001
     C                     END                                            CIR001
      *
      ***********
      *
      ** If Pay or Receive Confirmations are to be produced.
     C           *IN87     IFEQ '1'
      *
      *
     C           UBRTT     IFNE 0
     C                     TESTB'3'       UDNSI          86
     C                     ELSE
     C                     TESTB'3'       TDNSI          86
     C                     END
      *
     C           *IN86     IFEQ '1'
     C                     MOVE 'A'       ACTC
     C                     MOVE 'A'       ACTCDX
     C                     ELSE
     C                     MOVE 'I'       ACTC
     C                     MOVE 'I'       ACTCDX
     C                     END
      *
      **  SET UP TAX PAYABLE FIELD & INTEREST RATES
      *
     C           DTYP      IFEQ 'FR'                                      CIR001
     C                     Z-ADDINTX      TAXPY
     C                     Z-ADDUEINR     UFIR
     C                     Z-ADDTEINR     TFIR
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C                     Z-ADDTAXC      TAXPY                           CIR001
     C                     Z-ADDUEINS     UFIR                            CIR001
     C                     Z-ADDTEINS     TFIR                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      **  SET UP OF 'FR' RECORDS
      *
     C           DTYP      IFEQ 'FR'                                      CIR001
      *                                                                   CIR001
     C           SETL      IFEQ 'P'
     C                     MOVE 'E'       CNRQ
      *
     C                     Z-ADDDSANOT    PIAMT
      *
     C                     MOVE UEDAT     EVDAT
     C                     BITON'2'       CNFI
     C*
     C** UDNSI & TDNSI bit 3 should be set according to whether our or
     C** their side is floating and bit 2 or 3 of CNFI being on
     C*
     C           UBRTT     IFGT 0
     C                     BITOF'3'       UDNSI
     C                     ELSE
     C                     BITOF'3'       TDNSI
     C                     END
     C*
     C           DLCT      ADD  1         DLCT
     C                     EXCPTOUR
      *
     C                     ELSE
      *
     C                     MOVE 'G'       CNRQ
     C                     Z-ADDDSANOT    RIAMT
     C                     Z-ADDTEDAT     EVDAT
     C                     BITON'3'       CNFI
     C*
     C** UDNSI & TDNSI bit 3 should be set according to whether our or
     C** their side is floating and bit 2 or 3 of CNFI being on
     C*
     C           UBRTT     IFGT 0
     C                     BITOF'3'       UDNSI
     C                     ELSE
     C                     BITOF'3'       TDNSI
     C                     END
     C*
     C           DLCT      ADD  1         DLCT
     C                     EXCPTTHEIR
     C                     END
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' MATCHED RECORD                                      CIR001
     C**  (OUTPUT MADE ONLY IF EVENT DATE *GE RUN DATE)                   CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C                     MOVE 'E'       CNRQ                            CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     BITON'23'      CNFI                            CIR001
     C                     BITOF'3'       UDNSI                           CIR001
     C                     BITOF'3'       TDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTBOTH                                      CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C                     MOVE 'G'       CNRQ                            CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     BITON'23'      CNFI                            CIR001
     C                     BITOF'3'       UDNSI                           CIR001
     C                     BITOF'3'       TDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTBOTH                                      CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' UNMATCHED DEAL RECORDS                              CIR001
     C**  (OUTPUT MADE ONLY IF EVENT DATE *GE RUN DATE)                   CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
     C                     MOVE 'E'       CNRQ                            CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     BITON'2'       CNFI                            CIR001
     C                     BITOF'3'       UDNSI                           CIR001
     C*                                                                   CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTOUR                                       CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C                     MOVE 'G'       CNRQ                            CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     BITON'3'       CNFI                            CIR001
     C                     BITOF'3'       TDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RX' MATCHED DEAL RECORD                                 CIR001
     C**  (OUTPUT MADE ONLY IF EVENT DATE *GE RUN DATE)                   CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C                     MOVE 'J'       CNRQ                            CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     BITON'2'       CNFI                            CIR001
     C                     BITON'3'       CNFI                            CIR001
     C                     BITOF'3'       UDNSI                           CIR001
     C                     BITOF'3'       TDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTBOTH                                      CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RX' UNMATCHED DEAL RECORDS                              CIR001
     C**  (OUTPUT MADE ONLY IF EVENT DATE *GE RUN DATE)                   CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RX'                                      CIR001
     C           UEDAT     ANDNETEDAT                                     CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
     C                     MOVE 'E'       CNRQ                            CIR001
     C                     Z-ADDUINOT     PIAMT                           CIR001
     C                     Z-ADDUEDAT     EVDAT                           CIR001
     C                     BITON'2'       CNFI                            CIR001
     C                     BITOF'3'       UDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTOUR                                       CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C                     MOVE 'G'       CNRQ                            CIR001
     C                     Z-ADDTINOT     RIAMT                           CIR001
     C                     Z-ADDTEDAT     EVDAT                           CIR001
     C                     BITON'3'       CNFI                            CIR001
     C                     BITOF'3'       TDNSI                           CIR001
     C           EVDAT     IFGE BJRDNB                                    CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *
      ** Set on deals file update indicator.
     C           RECI      IFNE 'R'                                       046820
     C                     MOVE '1'       *IN66
     C                     END                                            046820
      *
     C                     END
      *
     C           BC9       ENDSR
      *
      *****************************************************************
      /TITLE BD SUBROUTINE
      *****************************************************************
      *                                                               *
      *    BD SR: INTEREST FIX CONFIRMATIONS                          *
      *                                                               *
      *    CALLED FROM : FRA                                          *
      *                                                               *
      *    CALLS : SUB01U, SUB01T                                     *
      *                                                               *
      *****************************************************************
      *
     C           BD        BEGSR
      *
     C                     Z-ADD0         TAXPY
     C                     Z-ADD0         PIAMT
     C                     Z-ADD0         RIAMT
     C                     Z-ADD0         UFIR
     C                     Z-ADD0         TFIR
     C                     BITOF'45'      CNFI
     C                     MOVE ' '       PRTIN   1
     C                     Z-ADD0         EVDAT
      *
      **  A RATE FIX CONFIRMATION IS DUE IF THE RATE FIX DATE IS
      **  BEFORE THE DATE OF NEXT WORKING DAY THEN OBTAIN NEW FIXED
      **  RATE VIA SR:SUB01 AND SET ON RELEVANT RATE FIX CONF. IND
      *
     C           UBRTT     IFNE 0
     C                     EXSR SUB01U
     C                     Z-ADDRATE      UFIR
     C                     BITON'4'       CNFI
     C                     MOVEL'U'       PRTIN
     C                     END
      *
     C           TBRTT     IFNE 0
     C                     EXSR SUB01T
     C                     Z-ADDRATE      TFIR
     C                     BITON'5'       CNFI
     C           PRTIN     IFEQ ' '                                       CIR001
     C                     MOVE 'T'       PRTIN
     C                     ELSE                                           CIR001
     C                     MOVE 'B'       PRTIN                           CIR001
     C                     END                                            CIR001
     C                     END
      *
      **  OUTPUT DETAILS TO PF/DLINDDM
      *
     C                     MOVE 'I'       ACTC
     C                     MOVE 'I'       ACTCDX
      *
      **  SET UP 'FR' DEAL RECORDS
      **  PRODUCE FR ONLY IF NOT PREVIOUSLY PRODUCED
      *
     C                     MOVE '0'       *IN87
      *
     C           UBRTT     IFNE 0
     C                     TESTB'0'       UDNSI      87
     C                     ELSE
     C                     TESTB'0'       TDNSI      87
     C                     END
      *
      ** If the programme is being RERUN produce Rate Fix Confirmations.
     C           RERUN     IFEQ 'Y'
     C                     MOVE '1'       *IN87
     C                     END
      *
     C           *IN87     IFEQ '1'
      *
     C           DTYP      ANDEQ'FR'                                      CIR001
     C*                                                                   CIR001
     C           PRTIN     IFEQ 'U'                         OUR DETAILS
     C                     MOVE 'D'       CNRQ
     C           DLCT      ADD  1         DLCT
     C                     Z-ADDUNICD     EVDAT
     C                     EXCPTOUR
     C                     END
     C           PRTIN     IFEQ 'T'                         THEIR
     C                     MOVE 'F'       CNRQ
     C           DLCT      ADD  1         DLCT
     C                     Z-ADDTNICD     EVDAT
     C                     EXCPTTHEIR
     C                     END
      *                                                                   CIR001
      ** Set on deals file update indicator.                              CIR001
      *                                                                   CIR001
     C           RECI      IFNE 'R'                                       CIR001
     C                     MOVE '1'       *IN66                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' MATCHED DEAL RECORD                                 CIR001
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C           PRTIN     IFEQ 'B'                         OURS & THEIRS CIR001
     C                     MOVE 'H'       CNRQ                            CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADDUNICD     EVDAT                           CIR001
     C                     EXCPTBOTH                                      CIR001
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  SET UP 'RS' UNMATCHED DEAL RECORDS                              CIR001
     C*                                                                   CIR001
     C           PRTIN     IFEQ 'U'                         OUR           CIR001
     C                     MOVE 'D'       CNRQ                            CIR001
0831 C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADDUNICD     EVDAT                           CIR001
     C                     EXCPTOUR                                       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           PRTIN     IFEQ 'T'                        THEIR          CIR001
     C                     MOVE 'F'       CNRQ                            CIR001
     C           DLCT      ADD  1         DLCT                            CIR001
     C                     Z-ADDTNICD     EVDAT                           CIR001
     C                     EXCPTTHEIR                                     CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *
      ** Set on deals file update indicator.
     C           RECI      IFNE 'R'                                       046820
     C                     MOVE '1'       *IN66
     C                     END                                            046820
      *
     C                     END
      *
     C           BD9       ENDSR                           ** DB9 ENDSR **
      *
      *****************************************************************
      /TITLE UPDATE SUBROUTINE
      *****************************************************************
      **                                                              *
      **   UPDATE SR. TO UPDATE THE PF/FILE DEALSDG FROM WITH         *
      **                                                              *
      **   THE VALUES PRODUCED IN THE CALCULATIONS.                   *
      **                                                              *
      *****************************************************************
      **
     C           UPDATE    BEGSR                           *** UPDATE ***
      *
      ** Save current value of fields to be updated.
      *
     C           *IN55     IFEQ '1'
     C                     BITON'0'       UDNSI
     C                     END
      *
     C           *IN56     IFEQ '1'
     C                     BITON'0'       TDNSI
     C                     END
      *
     C                     MOVE UDNSI     @UDNSI  1
     C                     MOVE TDNSI     @TDNSI  1
     C                     MOVE UEINR     @UEINR 117
     C                     MOVE TEINR     @TEINR 117
     C                     MOVELTLXI      @TLXI   1                       CIR001
     C                     MOVELCNFI      @CNFI   1                       CIR001
      *
      ** Access deals file for update.
     C           DLNO      CHAINZRFRADLF             60
      *
     C           *IN60     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '07'      DBASE                           S01194
     C                     MOVEL'007'     DBASE            ***************S01194
     C                     MOVE 'FRADL'   DBFILE           *   DBERROR   *
     C                     MOVELDLNO      DBKEY            *      07     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     END
      *
      ** Save file field values for updating MEMOS,OLPOS & PRONO.
     C                     MOVE UDNSI     #UDNSI  1
     C                     MOVE TDNSI     #TDNSI  1
     C                     MOVE UEINR     #UEINR 117
     C                     MOVE TEINR     #TEINR 117
      *
      *
      ** Move in values from calculations.
     C                     MOVE @UDNSI    UDNSI
     C                     MOVE @TDNSI    TDNSI
     C*                                                                   CIR001
     C           DTYP      IFEQ 'FR'                                      CIR001
     C                     MOVE @UBRTE    UBRTE
     C                     MOVE @TBRTE    TBRTE
     C                     MOVE @UEINR    UEINR
     C                     MOVE @TEINR    TEINR
     C                     END                                            CIR001
      *                                                                   CIR001
     C           CIR001    IFEQ 'Y'                                       CIR001
      *                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
      *                                                                   CIR001
     C           UINPM     IFEQ 'Y'                                       CIR001
     C           UINPM     OREQ 'D'                                       CIR001
     C                     MOVE @UBRTE    UBRTE                           CIR001
     C                     MOVE @UEINR    UEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           TINPM     IFEQ 'Y'                                       CIR001
     C           TINPM     OREQ 'D'                                       CIR001
     C                     MOVE @TBRTE    TBRTE                           CIR001
     C                     MOVE @TEINR    TEINR                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVEL@TLXI     TLXI                            CIR001
     C                     MOVEL@CNFI     CNFI                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *
      ** Update file.
     C                     EXCPTDLUPD
      **
     C           UPDAT9    ENDSR                           * UPDATE9 ENDSR*
      **
      *****************************************************************
      /TITLE UMEMAM SUBROUTINE
      *****************************************************************
      *                                                               *
      *  UMEMAM SR.    To update PF/MEMOS shadow postings file        *
      *                for an amended deal                            *
      *                                                               *
      *****************************************************************
      *
     C           UMEMAM    BEGSR                           *** UMEMAM ****
      *
      **   Determine whether PF/MEMOS requires reversing before updating
      *
      **   Since PF/DEALSDG has been updated, the current
      **   file field values are the 'new' versions (the '@_____' fields)
      **   and the 'old' values from the file at beginning of
      **   the programme are in the '#_____' fields.
      *
      **   Set up Spread/Rate work fields
      **   depending on which side of deal is fixed rate
      *
      **   ( Fixed side has Base rate type EQ 0,
      **   Rate/Spread is the Effective Interest Rate)
      *
     C           UBRTT     IFGT 0
     C                     Z-ADDTRTSP     WRTSPO 117
     C                     Z-ADD@TEINR    WRTSPN 117
     C                     ELSE
     C                     Z-ADDURTSP     WRTSPO
     C                     Z-ADD@UEINR    WRTSPN
     C                     END
      *
      ** Process if programme is being re-run, the base rate code is not
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.
      ** Otherwise no Memos reversal is required.
      *
     C           RERUN     IFEQ 'Y'
     C           UBRTE     ANDGT0
     C           *IN55     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
     C           RERUN     OREQ 'Y'
     C           TBRTE     ANDGT0
     C           *IN56     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
      *
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                             ( *IN74 ON = PAY )
     C           #UEINR    IFGE #TEINR
      *    ( PAY )
     C                     SETON                     74
      *
     C                     MOVE PSETM     SETM
     C**********           MOVE UPACC     WACC   12                                           CGL029
     C                     MOVE UPACC     WACC   18                                           CGL029
      *                                                                   S01117
      * Set up payment settlement branch work field for use               S01117
      * in TSTRTL                                                         S01117
     C                     MOVE POBR      WWBRCA                          S01117
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
      *
     C                     MOVE RSETM     SETM
     C                     MOVE URACC     WACC
      *                                                                   S01117
      * Set up receipt settlement branch work field for use               S01117
      * in TSTRTL                                                         S01117
     C                     MOVE ROBR      WWBRCA                          S01117
     C                     END
      *
      **   Only process Details if instructions settled through
      **   a retail account,
      **   ( Otherwise process new screen details )
      *
     C                     MOVE SETM      DSETM
     C**********           Z-ADDCNUM      DCNUM                                               CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      DDCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     DDCCY
     C                     ENDIF                                          CEU003
     C                     MOVE WACC      DBNKAC
      *
     C                     EXSR TSTRTL
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******CABEQ0         MEANEW               >>>>>>>>>> CCB002
     C           WRETL     IFEQ 'N'                                       CCB002
     C                     GOTO MEANEW                                    CCB002
     C                     ENDIF                                          CCB002
      *
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN  130
      *
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C***************************************                             E23400
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUB#UEINR****WUEINR                          E23400
     C*********************Z-SUB#TEINR****WTEINR                          E23400
     C*********************ELSE**************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADD#UEINR    WUEINR
     C                     Z-ADD#TEINR    WTEINR
     C*********************END***************                             E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP   54                      S01194
     C           BNHKTR    DIV  100       TAXRP   54                      S01194
     C           SZDSA     MULT TAXRP     INTTAX 130H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
     C           SZDSA     SUB  INTTAX    NETDSA 150
      *                                                                   E21549
      **  Move RUND and VDAT to shadow post later                         E21549
      **  Shadow post amount to RSACMTPD.                                 E21549
      *                                                                   E21549
     C**********           Z-ADDRUND      PTDT                     E21549 S01194
     C                     Z-ADDBJRDNB    PTDT                            S01194
     C                     Z-ADDVDAT      VUDT                            E21549
      *
      *****Access*PF/MEMOS*record                                         CCB002
      *                                                                   CCB002
     C*********************EXSR MEMCHN                                    CCB002
      *                                                                   CEU003
      **   Convert NETDSA to settlement currency if required              CEU003
      *                                                                   CEU003
     C                     MOVE 'N'       @CALL   1                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *    ( Pay )                                                        CEU003
     C           *IN74     IFEQ '1'                                       CEU003
     C           PSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
      *    ( Receive )                                                    CEU003
     C                     ELSE                                           CEU003
     C           RSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           @CALL     IFEQ 'Y'                                       CEU003
      *                                                                   CEU003
     C                     Z-ADDNETDSA    P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    NETDSA                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      **   Adjust Shadow Balances
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C*********************ADD  NETDSA    LDBLN                           CCB002
     C*********************ADD  NETDSA    CLBLN                           CCB002
     C                     Z-ADDNETDSA    #PAMT  150                      CCB002
     C***********          Z-ADD1         DORC                      E21549097480
     C                     Z-ADD0         DORC                            097480
      *
     C                     ELSE
      *    ( Receive )
     C*********************SUB  NETDSA    LDBLN                           CCB002
     C*********************SUB  NETDSA    CLBLN                           CCB002
     C                     Z-SUBNETDSA    #PAMT                           CCB002
     C***********          Z-ADD0         DORC                      E21549097480
     C                     Z-ADD1         DORC                            097480
      *
     C                     END
      *
      **   Update PF/MEMOS file
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD  7        I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO 100       O:Retail A/C NoCCB002
     C**********           PARM WCNUM     W0CNUM  60       O:Customer No.              CCB002 CSD027
     C                     PARM WCNUM     W0CNUM  6        O:Customer No.                     CSD027
     C                     PARM WCCY      W0CCY   3        O:Currency     CCB002
     C**********           PARM WACOD     W0ACOD  40       O:Account Code              CCB002 CGL029
     C                     PARM WACOD     W0ACOD 100                                          CGL029
     C                     PARM WACSQ     W0ACSQ  20       O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA  3        O:Branch       CCB002
     C                     PARM PTDT      W0PSTD  50       O:Posting date CCB002
     C                     PARM VUDT      W0VDAT  50       O:Value date   CCB002
     C                     PARM #PAMT     W0AMT  150       O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV  1        O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '15'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 15 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C005
     C*                                                                   E21549
     C* If not a nostro account then output posting details to RSACMTPD   E21549
     C*                                                                   E21549
     C           WNOST     IFEQ 'N'                                       E21549
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E21549
     C                     END                                            E21549
     C*                                                                   E21549
      *
     C                     END
      *
     C           MEANEW    TAG                             ** MEANEW TAG *
      *
      **   New deal details (the '@_____' fields)
      **
      *
      **   Set Value of New Interest Rates
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
      *
     C           UBRTT     IFEQ 0
      *
     C                     Z-ADD@TEINR    DTEINR 117
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUBURTSP*****DUEINR 117                      E23400
     C*********************ELSE**************                             E23400
     C*********************Z-ADDURTSP*****DUEINR                          E23400
     C*********************END***************                             E23400
     C                     Z-ADDURTSP     DUEINR 117
      *
     C                     ELSE
      *
     C                     Z-ADD@UEINR    DUEINR
     C           *IN85     IFEQ '1'
     C                     Z-SUBTRTSP     DTEINR
     C                     ELSE
     C                     Z-ADDTRTSP     DTEINR
     C                     END
      *
     C                     END
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                                 ( *IN74 ON = PAY )
     C           DUEINR    IFGE DTEINR
      *    ( Pay )
     C                     SETON                     74
      *
     C                     MOVE PSETM     SETM
     C                     MOVE UPACC     WACC
      *                                                                   S01117
      * Set up payment settlement branch work field for use               S01117
      * in TSTRTL                                                         S01117
     C                     MOVE POBR      WWBRCA                          S01117
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
      *
     C                     MOVE RSETM     SETM
     C                     MOVE URACC     WACC
      *                                                                   S01117
      * Set up receipt settlement branch work field for use               S01117
      * in TSTRTL                                                         S01117
     C                     MOVE ROBR      WWBRCA                          S01117
      *
     C                     END
      *
      **   Only process Details if instructions settled through
      **   a retail account,
      **   ( Otherwise End )
      *
     C                     MOVE SETM      DSETM
     C**********           Z-ADDCNUM      DCNUM                                               CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      DDCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     DDCCY
     C                     ENDIF                                          CEU003
     C                     MOVE WACC      DBNKAC
      *
     C                     EXSR TSTRTL
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )        CCB002
      *                                                                   CCB002
     C***********RRNM******CABEQ0         MEAEND               >>>>>>>>>> CCB002
     C           WRETL     IFEQ 'N'                                       CCB002
     C                     GOTO MEAEND                                    CCB002
     C                     ENDIF                                          CCB002
      *
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN
      *
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUBDUEINR****WUEINR                          E23400
     C*********************Z-SUBDTEINR****WTEINR                          E23400
     C*********************ELSE**************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADDDUEINR    WUEINR
     C                     Z-ADDDTEINR    WTEINR
     C*********************END***************                             E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP                           S01194
     C           BNHKTR    DIV  100       TAXRP                           S01194
     C           SZDSA     MULT TAXRP     INTTAX    H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
     C           SZDSA     SUB  INTTAX    NETDSA
      *                                                                   E21549
      **  Move VDAT and WNIPD to shadow post later                        E21549
      **  Shadow post amount to RSACMTPD.                                 E21549
      *                                                                   E21549
     C**********           Z-ADDRUND      PTDT                     E21549 S01194
     C                     Z-ADDBJRDNB    PTDT                            S01194
     C                     Z-ADDVDAT      VUDT                            E21549
      *
      *****Access*PF/MEMOS*record                                         CCB002
      *                                                                   CCB002
     C*********************EXSR MEMCHN                                    CCB002
      *                                                                   CEU003
      **   Convert NETDSA to settlement currency if required              CEU003
      *                                                                   CEU003
     C                     MOVE 'N'       @CALL                           CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *    ( Pay )                                                        CEU003
     C           *IN74     IFEQ '1'                                       CEU003
     C           PSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
      *    ( Receive )                                                    CEU003
     C                     ELSE                                           CEU003
     C           RSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           @CALL     IFEQ 'Y'                                       CEU003
      *                                                                   CEU003
     C                     Z-ADDNETDSA    P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    NETDSA                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      **   Adjust Shadow Balances
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C*********************SUB  NETDSA    LDBLN                           CCB002
     C*********************SUB  NETDSA    CLBLN                           CCB002
     C                     Z-SUBNETDSA    #PAMT                           CCB002
     C                     Z-ADD1         DORC                            097480
      *
     C                     ELSE
      *    ( Receive )
     C*********************ADD  NETDSA    LDBLN                           CCB002
     C*********************ADD  NETDSA    CLBLN                           CCB002
     C                     Z-ADDNETDSA    #PAMT                           CCB002
     C                     Z-ADD0         DORC                            097480
      *
     C                     END
      *
      **   Update PF/MEMOS file
      *
     C*********************UPDATMEMOSMDF                                  CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM WCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM WCCY      W0CCY            O:Currency     CCB002
     C                     PARM WACOD     W0ACOD           O:Account Code CCB002
     C                     PARM WACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '18'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 18 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C006
     C*                                                                   E21549
     C* If not a nostro account then output posting details to RSACMTPD   E21549
     C*                                                                   E21549
     C           WNOST     IFEQ 'N'                                       E21549
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E21549
     C                     END                                            E21549
      *
     C           MEAEND    TAG                             ** MEAEND TAG *
      *
     C                     ENDSR
      ********************************************************************
      /SPACE 3
      *****************************************************************   CCB002
      *                                                               *   CCB002
      ***MEMCHN*SR.****To*access*PF/MEMOS*record                      *   CCB002
      *                                                               *   CCB002
      *****************************************************************   CCB002
      *                                                                   CCB002
     C***********MEMCHN****BEGSR                           *** MEMCHN ****CCB002
      *                                                                   CCB002
     C***********RRNM******CHAINMEMOS                70                   CCB002
      *                                                                   CCB002
      ***End*if**detail*record*not*found                                  CCB002
     C************IN70*****IFEQ '1'                                       CCB002
     C***********RECI******ORNE 'D'                                       CCB002
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '15'      DBASE                           S01194
     C*********************MOVEL'015'     DBASE            *********S01194CCB002
     C*********************MOVE 'MEMOS'   DBFILE           *   DBERROR   *CCB002
     C*********************MOVELRRNM      DBKEY            *      15     *CCB002
     C**********           EXSR DBERR                      ***************S01194
     C*********************EXSR *PSSR                      *********S01194CCB002
     C*********************END                                            CCB002
      *                                                                   CCB002
     C*********************ENDSR                                          CCB002
      ********************************************************************CCB002
      /TITLE UOLPAM SUBROUTINE
      *****************************************************************
      *                                                               *
      *  UOLPAM SR.    To update PF/OLPOS on line positions file      *
      *                for an amended deal                            *
      *                                                               *
      *****************************************************************
      *
     C           UOLPAM    BEGSR                           *** UOLPAM ****
      *
      **   Determine whether PF/OLPOS requires updating
      *
      **   Since PF/DEALSDG has been updated, the current
      **   file field values are the 'new' versions (the '@_____' fields)
      **   and the 'old' values from the file at beginning of
      **   the programme are in the '#_____' fields.
      *
      **   Set up Spread/Rate work fields
      **   depending on which side of deal is fixed
      *
      **   ( Fixed side has Base rate type EQ 0,
      **   Rate/Spread is the Effective Interest Rate)
      *
     C           UBRTT     IFGT 0
     C                     Z-ADDTRTSP     WRTSPO 117
     C                     Z-ADD@TEINR    WRTSPN 117
     C                     ELSE
     C                     Z-ADDURTSP     WRTSPO
     C                     Z-ADD@UEINR    WRTSPN
     C                     END
      *
      **   Access Olpos record
      *
     C                     EXSR OLPCHN
      *
      **   Only process Details if a record is found
      **   ( Otherwise End )
      *
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
      *    Release PF/OLPOSOA record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELOL
     C                     END
      *
     C                     GOTO OLAEND                         >>>>>>>>>>
     C                     END
      *
      **   Set Date on PF/OLPOSOA to be amended ( 'P' )
      *
      **   Net Discounted Amounts are applied to the on line position
      **   balance whose occurrence is the greatest of the 16 dates
      **   which is less than, or equal to, the event date
      **   ( i.e. Value Date )
      *    NB..
      **   If event is earlier than the first of the 16th dates,
      **      use the first date
      **   If event is on or after the 16th date,
      **      use the 16th date ( Catchall )
      *
     C                     Z-ADD1         P       20
      *
     C           VDAT      IFGT ODAT,1
      *
     C           VDAT      IFGE ODAT,16
     C                     Z-ADD16        P
     C                     ELSE
     C           VDAT      LOKUPODAT,P                 8585
     C                     END
      *
     C                     END
      *
      ** Process if programme is being re-run, the base rate code is not
      ** zero and bit '0' UDNSI = '1'(ie. *IN55 or 56 = '1') and rate
      ** has been previously set.
      ** Otherwise no Olpos reversal is required.
      *
     C           RERUN     IFEQ 'Y'
     C           UBRTE     ANDGT0
     C           *IN55     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
     C           RERUN     OREQ 'Y'
     C           TBRTE     ANDGT0
     C           *IN56     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
      *
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                             ( *IN74 ON = PAY )
     C           #UEINR    IFGE #TEINR
      *    ( PAY )
     C                     SETON                     74
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN
      *
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUB#UEINR****WUEINR                          E23400
     C*********************Z-SUB#TEINR****WTEINR                          E23400
     C*********************ELSE**************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADD#UEINR    WUEINR
     C                     Z-ADD#TEINR    WTEINR
     C*********************END***************                             E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP                           S01194
     C           BNHKTR    DIV  100       TAXRP                           S01194
     C           SZDSA     MULT TAXRP     INTTAX    H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
     C           SZDSA     SUB  INTTAX    NETDSA
      *
      **   Adjust On Line Position balances
      *
      **   Adjust Balance for Date P
      *
      **   ( Adjust Outgoing balance for Payment, or
      **     Adjust Incoming balance for Receive )
      *
     C           *IN74     IFEQ '1'
      *    ( PAY )
     C                     SUB  NETDSA    OBLO,P
     C                     ELSE
      *    ( RECEIVE )
     C                     SUB  NETDSA    OBLI,P
     C                     END
      *
     C                     END
      *
      **   ( NB. Update record at end of routine )
      *
      **   New deal details (the '@_____' fields)
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                             ( *IN74 ON = PAY )
     C           @UEINR    IFGE @TEINR
      *    ( PAY )
     C                     SETON                     74
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN
      *
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
      *
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUB@UEINR****WUEINR 117                      E23400
     C*********************Z-SUB@TEINR****WTEINR 117                      E23400
     C*********************ELSE**************                             E23400
     C*********************Z-ADD@UEINR****WUEINR                          E23400
     C*********************Z-ADD@TEINR****WTEINR                          E23400
     C*********************END***************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADD@UEINR    WUEINR 117                      E23400
     C                     Z-ADD@TEINR    WTEINR 117                      E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP                           S01194
     C           BNHKTR    DIV  100       TAXRP                           S01194
     C           SZDSA     MULT TAXRP     INTTAX    H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
     C           SZDSA     SUB  INTTAX    NETDSA
      *
      **   Adjust On Line Position balances
      *
      **   Adjust Balance for Date P
      *
      **   ( Adjust Outgoing balance for Payment, or
      **     Adjust Incoming balance for Receive )
      *
     C           *IN74     IFEQ '1'
      *    ( PAY )
     C                     ADD  NETDSA    OBLO,P
     C                     ELSE
      *    ( RECEIVE )
     C                     ADD  NETDSA    OBLI,P
     C                     END
      *
      **   Update record
      *
     C                     UPDATOLPOSOAF
      *
     C           OLAEND    TAG                             ** OLAEND TAG *
      *
     C                     ENDSR
      ********************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  OLPCHN SR.    To access PF/OLPOS record                      *
      *                                                               *
      *****************************************************************
      *
     C           OLPCHN    BEGSR                           *** OLPCHN ****
      *
     C                     MOVE UCUCY     OLCCY
     C                     MOVE '02'      OLPNO
      *
     C           OLKEY     KLIST
      *                                                                   S01117
      * Booking Branch included in key for OLPOS                          S01117
     C                     KFLD           BRCA                            S01117
     C                     KFLD           OLCCY   3
     C                     KFLD           OLPNO   20
      *
     C           OLKEY     CHAINOLPOS                86
      *
     C                     ENDSR
      ********************************************************************
      /TITLE UPROAM SUBROUTINE
      *****************************************************************
      *                                                               *
      *  UPROAM SR.    To update PF/PRONO projected nostros file      *
      *                for an amended deal                            *
      *                                                               *
      *****************************************************************
      *
     C           UPROAM    BEGSR                           *** UPROAM ****
      **
      **   Determine whether PF/PRONO requires updating
      *
      **   Since PF/DEALSDG has been updated, the current
      **   file field values are the 'new' versions (the '@_____' fields)
      **   and the 'old' values from the file at beginning of
      **   the programme are in the '#_____' fields.
      *
      **   Set up Spread/Rate work fields
      **   depending on which side of deal is fixed
      *
      **   ( Fixed side has Base rate type EQ 0,
      **   Spread/Rate is the Effective Interest Rate)
      *
     C           UBRTT     IFGT 0
     C                     Z-ADDTRTSP     WRTSPO 117
     C                     Z-ADD@TEINR    WRTSPN 117
     C                     ELSE
     C                     Z-ADDURTSP     WRTSPO
     C                     Z-ADD@UEINR    WRTSPN
     C                     END
      *
      ** Process if programme is being re-run, the base rate code is not
      ** zero and bit '0' UDNSI = '1' and rate has been previously set
      ** Otherwise no Prono reversal is required.
      *
     C           RERUN     IFEQ 'Y'
     C           UBRTE     ANDGT0
     C           *IN55     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
     C           RERUN     OREQ 'Y'
     C           TBRTE     ANDGT0
     C           *IN56     ANDEQ'1'
     C           @PRVST    ANDEQ'Y'
      *
      **
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                             ( *IN74 ON = PAY )
     C           #UEINR    IFGE #TEINR
      *    ( PAY )
     C                     SETON                     74
     C                     MOVE PSETM     WSETM
     C                     MOVE UPACC     WACC
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
     C                     MOVE RSETM     WSETM
     C                     MOVE URACC     WACC
     C                     END
      *
      **   Only process details if settled through nostro
      **   ( Otherwise process New details )
      *
     C           WSETM     IFNE 01
     C           WSETM     ANDNE02
     C           WSETM     ANDNE07
     C           WSETM     ANDNE08
     C           WSETM     ANDNE12
     C                     GOTO PRANEW                         >>>>>>>>>>
     C                     END
      *
      **   Access Prono record
      *
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      PRCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     PRCCY
     C                     ENDIF                                          CEU003
     C                     MOVELWACC      PRNNO
      *
     C                     EXSR PROCHN
      *
      **   Only process Details if a record is found
      **   ( Otherwise process New details )
      *
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
      *    Release PF/PRONOPN record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
      *
     C                     GOTO PRANEW                         >>>>>>>>>>
     C                     END
      **
      *
      **   If Event Date is beyond Range End Date for nostro, release
      **   record, then no further processing for original file details
      **   Otherwise, calculate discuounted amount & update record.
      *
      **   NB Range End Date is up to the 6th working day
     C           PDAT,5    ADD  1         ZDAYNO
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     ZCCY
     C                     ENDIF                                          CEU003
     C**********           MOVE 'Y'       ZOPT                            S01195
      *                                                                   S01195
      * Set up nostro location code (ZLOC) for input to ZFWDT.SR          S01195
      *                                                                   S01195
      * Move nostro no. into 2A work field for call to access prog.       S01195
     C                     MOVELWACC      WRK2    2                       S01195
      *                                                                   S01195
      * Set up work field containing file key, in case of db error        S01195
     C***********          MOVELUCUCY     WRK5    5                S01195 CEU003
     C                     MOVELZCCY      WRK5    5                       CEU003
     C                     MOVE WRK2      WRK5                            S01195
      *                                                                   S01195
      * If nostro no. blanks, set ZLOC to blanks, otherwise call          S01195
      * access program to get nostro location                             S01195
     C           WRK2      IFEQ *BLANKS                                   S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     ELSE                                           S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*MSG   ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM ZCCY      @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C           @RTCD     IFNE *BLANKS                                   S01195
     C                     MOVE '016'     DBASE                           S01195
     C                     MOVE 'SDNOSTPD'DBFILE             *************S01195
     C                     MOVE WRK5      DBKEY              *  DBERROR  *S01195
     C                     EXSR *PSSR                        *    16     *S01195
     C                     ELSE                              *************S01195
     C                     MOVE A7NOSN    ZLOC                            S01195
      * (Last 3 chars. of customer shortname contains nostro loc.)        S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      * Check that value of ZDAYNO is a working day, if not get           S01195
      * the next working day after this date                              S01195
     C**********           EXSR ZDATE5                                    S01195
     C                     Z-ADD0         ZNRDYS  20                      S01195
     C                     EXSR ZFWDT                                     S01195
      *
     C           VDAT      IFGE ZDYNBR
      *
     C                     EXCPTRELPR
     C                     GOTO PRANEW                         >>>>>>>>>>
     C                     END
      *
      *
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUB#UEINR****WUEINR                          E23400
     C*********************Z-SUB#TEINR****WTEINR                          E23400
     C*********************ELSE**************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADD#UEINR    WUEINR
     C                     Z-ADD#TEINR    WTEINR
     C*********************END***************                             E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP                           S01194
     C           BNHKTR    DIV  100       TAXRP                           S01194
     C           SZDSA     MULT TAXRP     INTTAX    H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
     C           SZDSA     SUB  INTTAX    NETDSA
      **
      *
      **   Adjust Projected Nostro balances
      *
      **   Net Discounted Amounts are applied to the projected nostro
      **   balances whose occurrence matches the projected nostro dates
      **   which are GE the Event Date  ( i.e. Value Date )
      *
      *    NB..
      **   If event is earlier than the first of the 5 dates,
      **      use from the first date
     C*****If*event*is*after*the*5th*date,*but*before*the*6th************ 042757
     C********use*the*5th*date******************************************* 042757
      **   ( NB  Dates GE 6th date excluded in above validation )
      *
     C                     Z-ADD1         X       10
      *
     C           VDAT      IFGT PDAT,1
      *
     C***********VDAT      IFGE PDAT,5                                    042757
     C***********          Z-ADD5         X                               042757
     C           VDAT      IFGT PDAT,5                                    042757
     C                     Z-ADD6         X                               042757
     C                     ELSE
     C*                                                                   042757
     C** Access the date 'equal to' or 'greater than' the  value date     042757
     C*                                                                   042757
     C***********VDAT      LOKUPPDAT,X                 8585               042757
     C           VDAT      LOKUPPDAT,X               85  85               042757
     C                     END
      *
     C                     END
     C*                                                                   E21549
     C**  Move VDAT and PDAT to shadow post later                         E21549
     C*                                                                   E21549
     C                     Z-ADDPDAT,X    PTDT                            E21549
     C                     Z-ADDVDAT      VUDT                            E21549
      *                                                                   CEU003
      **   Convert NETDSA to settlement currency if required              CEU003
      *                                                                   CEU003
     C                     MOVE 'N'       @CALL   1                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *    ( Pay )                                                        CEU003
     C           *IN74     IFEQ '1'                                       CEU003
     C           PSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
      *    ( Receive )                                                    CEU003
     C                     ELSE                                           CEU003
     C           RSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           @CALL     IFEQ 'Y'                                       CEU003
      *                                                                   CEU003
     C                     Z-ADDNETDSA    P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    NETDSA                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      **   Adjust Balances for Entries X to 5
      *
     C           X         DOWLE5
      *
      **   ( Add for Payment, Subtract for Receive Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( PAY )
     C                     ADD  NETDSA    PBAL,X
     C                     ELSE
      *    ( RECEIVE )
     C                     SUB  NETDSA    PBAL,X
     C                     END
      *
     C                     ADD  1         X
     C                     END
      *
      **   Update record
      *
     C                     UPDATPRONOPNF
      *                                                                   E21549
      *  To indicate that the amount is debit or credit                   E21549
      *                                                                   E21549
     C           *IN74     IFEQ '1'                                       E21549
      *    ( PAY )                                                        E21549
     C***********          Z-ADD1         DORC    10                E21549097480
     C                     Z-ADD0         DORC    10                      097480
     C                     ELSE                                           E21549
      *    ( RECEIVE )                                                    E21549
     C***********          Z-ADD0         DORC                      E21549097480
     C                     Z-ADD1         DORC                            097480
     C                     END                                            E21549
     C*                                                                   E21549
     C* Output posting details to RSACMTPD                                E21549
     C*                                                                   E21549
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E21549
      *
     C                     END
      *
     C           PRANEW    TAG                             ** PRANEW TAG *
      *
      **   New deal details (the '@_____' fields)
      *
      **   Select Pay or Receive Instructions
      *
      **   If Our Effective Interest Rate GE Theirs, Then Pay
      **   Instructions used, Otherwise Receive Instructions
      *                                 ( *IN74 ON = PAY )
     C           @UEINR    IFGE @TEINR
      *    ( Pay )
     C                     SETON                     74
     C                     MOVE PSETM     WSETM
     C                     MOVE UPACC     WACC
      *
     C                     ELSE
      *    ( RECEIVE )
     C                     SETOF                     74
     C                     MOVE RSETM     WSETM   20
     C                     MOVE URACC     WACC
     C                     END
      *
      **   Only process details if settled through nostro
      **   ( Otherwise End )
      *
     C           WSETM     IFNE 01
     C           WSETM     ANDNE02
     C           WSETM     ANDNE07
     C           WSETM     ANDNE08
     C           WSETM     ANDNE12
     C                     GOTO PRAEND                         >>>>>>>>>>
     C                     END
      *
      **   Access Prono record
      *
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      PRCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     PRCCY
     C                     ENDIF                                          CEU003
     C                     MOVELWACC      PRNNO
      *
     C                     EXSR PROCHN
      *
      **   Only process Details if a record is found
      **   ( Otherwise End )
      *
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
      *    Release PF/PRONOPN record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
      *
     C                     GOTO PRAEND                         >>>>>>>>>>
     C                     END
      **
      *
      **   If Event Date is beyond Range End Date for nostro, release
      **   record, then no further processing
      **   Otherwise, calculate discuounted amount & update record.
      *
      **   NB Range End Date is up to the 6th working day
     C           PDAT,5    ADD  1         ZDAYNO
     C                     MOVE UCUCY     ZCCY
     C**********           MOVE 'Y'       ZOPT                            S01195
      *                                                                   S01195
      * Set up nostro location code (ZLOC) for input to ZFWDT.SR          S01195
      *                                                                   S01195
      * Move nostro no. into 2A work field for call to access prog.       S01195
     C                     MOVELWACC      WRK2                            S01195
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     ZCCY                            CEU003
     C                     ENDIF                                          CEU003
      *                                                                   S01195
      * If the nostro no. from last call to AONOSTR0 is same as           S01195
      * value in WRK2, no need for another call to access program         S01195
      * since currency key is the same as well, therefore use             S01195
      * same value of ZLOC                                                S01195
     C           WRK2      IFNE A7NONB                                    S01195
     C           ZCCY      ORNE A7CYCD                                    CEU003
      *                                                                   S01195
      * Set up work field containing file key, in case of db error        S01195
     C***********          MOVELUCUCY     WRK5                     S01195 CEU003
     C                     MOVELZCCY      WRK5                            CEU003
     C                     MOVE WRK2      WRK5                            S01195
      *                                                                   S01195
      * If nostro no. blanks, set ZLOC to blanks, otherwise call          S01195
      * access program to get nostro location                             S01195
     C           WRK2      IFEQ *BLANKS                                   S01195
     C                     MOVE *BLANKS   ZLOC                            S01195
     C                     ELSE                                           S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*MSG   ' @RTCD                           S01195
     C                     PARM '*KEY   ' @OPTN                           S01195
     C                     PARM *BLANK    @CUST   6        Customer No.   S01195
     C***********          PARM UCUCY     @CCY    3        CurrencyS01195 CEU003
     C                     PARM ZCCY      @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01195 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01195
     C                     PARM WRK2      @NOST   2        Nostro No.     S01195
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01195
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01195
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01195
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C*                                                                   S01195
     C           @RTCD     IFNE *BLANKS                                   S01195
     C                     MOVE '017'     DBASE                           S01195
     C                     MOVE 'SDNOSTPD'DBFILE             *************S01195
     C                     MOVE WRK5      DBKEY              *  DBERROR  *S01195
     C                     EXSR *PSSR                        *    17     *S01195
     C                     ELSE                              *************S01195
     C                     MOVE A7NOSN    ZLOC                            S01195
      * (Last 3 chars. of customer shortname contains nostro loc.)        S01195
     C                     END                                            S01195
     C                     END                                            S01195
     C                     END                                            S01195
      *                                                                   S01195
      * Check that value of ZDAYNO is a working day, if not get           S01195
      * the next working day after this date                              S01195
     C**********           EXSR ZDATE5                                    S01195
     C                     Z-ADD0         ZNRDYS  20                      S01195
     C                     EXSR ZFWDT                                     S01195
      *
     C           VDAT      IFGE ZDYNBR
      *
     C                     EXCPTRELPR
     C                     GOTO PRAEND                         >>>>>>>>>>
     C                     END
      **   Calculate Discounted Settlement Amount
      *
      **   Calculate Net Accrued Interest Adjustments Not Posted
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           UAIAN     SUB  TAIAN     WAIAN
     C                     ELSE
      *    ( Receive )
     C           TAIAN     SUB  UAIAN     WAIAN
     C                     END
      *
      **   Calculate Discounted Settlement Amount via DLRADS
      **   ( NB Fixed rate has zero base rate type )
      *
     C*****Set*Value*of*Work*Interest*Rates*( Set as positive )           E23400
     C***************************************                             E23400
     C*********************TESTB'1'*******UDSTI          85               E23400
     C************IN85*****IFEQ*'1'**********                             E23400
     C*********************Z-SUB@UEINR****WUEINR 117                      E23400
     C*********************Z-SUB@TEINR****WTEINR 117                      E23400
     C*********************ELSE**************                             E23400
      **   Set Value of Work Interest Rates                               E23400
     C                     Z-ADD@UEINR    WUEINR
     C                     Z-ADD@TEINR    WTEINR
     C*********************END***************                             E23400
      *
     C           UBRTT     IFEQ 0
     C                     Z-ADDWUEINR    SZFIX
     C                     Z-ADDWTEINR    SZFLT
     C                     ELSE
     C                     Z-ADDWTEINR    SZFIX
     C                     Z-ADDWUEINR    SZFLT
     C                     END
     C                     Z-ADDVDAT      SZVDAT
     C                     Z-ADDMDAT      SZMDAT
     C                     Z-ADDUPAMT     SZPPL
     C                     Z-ADDUICBS     SZICB
     C                     Z-ADDWAIAN     SZIANP
      *
     C                     EXSR DLRADS
      *
      *
      **   If taxable, calc. Interest Tax (INTTAX) on Gross Int. due
      **   ( Only tax Pay Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( Pay )
     C           TAXI      IFEQ 'Y'
     C********** TAXR      ANDNE0                                         S01194
     C           BNHKTR    ANDNE0                                         S01194
     C********** TAXR      DIV  100       TAXRP                           S01194
     C           BNHKTR    DIV  100       TAXRP                           S01194
     C           SZDSA     MULT TAXRP     INTTAX    H
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *    ( Receive )
     C                     ELSE
     C                     Z-ADD0         INTTAX
     C                     END
      *
      **   Net Discounted Settlement = Discounted Settlement SUB Tax
      *
     C           SZDSA     SUB  INTTAX    NETDSA
      *
      **   Adjust Projected Nostro balances
      *
      **   Net Discounted Amounts are applied to the projected nostro
      **   balances whose occurrence matches the projected nostro dates
      **   which are GE the Event Date  ( i.e. Value Date )
      *
      *    NB..
      **   If event is earlier than the first of the 5 dates,
      **      use from the first date
      **   If event is after the 5th date, but before the 6th
      **      use the 5th date
      **   ( NB  Dates GE 6th date excluded in above validation )
      *
     C                     Z-ADD1         X       10
      *
     C           VDAT      IFGT PDAT,1
      *
     C           VDAT      IFGE PDAT,5
     C                     Z-ADD5         X
     C                     ELSE
     C*                                                                   042757
     C** Access the date 'equal to' or 'greater than' the value date      042757
     C*                                                                   042757
     C***********VDAT      LOKUPPDAT,X                 8585               042757
     C           VDAT      LOKUPPDAT,X               85  85               042757
     C                     END
      *
     C                     END
     C*                                                                   055838
     C**  Move VDAT and PDAT to shadow post later                         055838
     C*                                                                   055838
     C                     Z-ADDPDAT,X    PTDT                            055838
     C                     Z-ADDVDAT      VUDT                            055838
      *                                                                   055838
      *  To indicate that the amount is debit or credit                   055838
      *                                                                   055838
     C           *IN74     IFEQ '1'                                       055838
      *    ( PAY )                                                        055838
     C                     Z-ADD1         DORC    10                      055838
     C                     ELSE                                           055838
      *    ( RECEIVE )                                                    055838
     C                     Z-ADD0         DORC                            055838
     C                     END                                            055838
     C*                                                                   055838
      *                                                                   CEU003
      **   Convert NETDSA to settlement currency if required              CEU003
      *                                                                   CEU003
     C                     MOVE 'N'       @CALL   1                       CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
      *    ( Pay )                                                        CEU003
     C           *IN74     IFEQ '1'                                       CEU003
     C           PSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
      *    ( Receive )                                                    CEU003
     C                     ELSE                                           CEU003
     C           RSCY      IFNE *BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     MOVE 'Y'       @CALL                           CEU003
     C                     ENDIF                                          CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C           @CALL     IFEQ 'Y'                                       CEU003
      *                                                                   CEU003
     C                     Z-ADDNETDSA    P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    NETDSA                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *
      **   Adjust Balances for Entries X to 5
      *
     C           X         DOWLE5
      *
      **   ( Subtract for Payment, Add for Receive Instructions )
      *
     C           *IN74     IFEQ '1'
      *    ( PAY )
     C                     SUB  NETDSA    PBAL,X
     C                     ELSE
      *    ( RECEIVE )
     C                     ADD  NETDSA    PBAL,X
     C                     END
      *
     C                     ADD  1         X
     C                     END
      *
      **   Update record
      *
     C                     UPDATPRONOPNF
     C*                                                                   E21549
     C* Output posting details to RSACMTPD                                E21549
     C*                                                                   E21549
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OUTPOS                                    E21549
      *
     C           PRAEND    TAG                             ** PRAEND TAG *
      *
      **
      *
     C                     ENDSR
      ********************************************************************
      /TITLE PROCHN SUBROUTINE
      *****************************************************************
      *                                                               *
      *  PROCHN SR.    To access PF/PRONO record                      *
      *                                                               *
      *****************************************************************
      *
     C           PROCHN    BEGSR                           *** PROCHN ****
      *
     C           PRKEY     KLIST
     C                     KFLD           PRCCY   3
     C                     KFLD           PRNNO   20
     C           PRKEY     CHAINPRONO                86
      **   If record not found, use 'unallocated' code
     C           *IN86     IFEQ '1'
     C           RECI      ORNE 'D'
      *    Release PF/PRONOPN record if record found, but not live
     C           *IN86     IFEQ '0'
     C                     EXCPTRELPR
     C                     END
      *
     C                     Z-ADD0         PRNNO
     C           PRKEY     CHAINPRONO                86
     C                     END
     C                     ENDSR
      ********************************************************************
      /TITLE SUBROUTINE TO WRITE TO SHADOW POSTINGS FILE
      *****************************************************************   E21549
      *                                                               *   E21549
      *  OUTPOS SR.    Output posting details to RSACMTPD.            *   E21549
      *                                                               *   E21549
      *****************************************************************   E21549
      *                                                                   E21549
     C           OUTPOS    BEGSR                           *** OUTPOS ****E21549
      *                                                                   E21549
      **   Only write a record if the amount is                           E21549
      **   not zero                                                       E21549
      *                                                                   E21549
     C           NETDSA    IFNE *ZEROS                                    E21549
     C*                                                                   E21549
     C*    For settlement through a nostro;                               E21549
     C*****Retrieve*currency*nostro*record*from*'TABDLEI'***       E21549 S01194
     C*                                                                   E21549
     C           WNOST     IFNE 'N'                                       E21549
     C**********           MOVEL'70'      KEY                      E21549 S01194
     C**********           MOVELUCUCY     WRK5                            E21549
     C                     MOVELPRNNO     WRK2                            E21549
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      WRK3    3                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     WRK3                            CEU003
     C                     ENDIF                                          CEU003
     C********** KEY       CHAINTABDLEI              85            E21549 S01194
     C*                                                                   E21549
     C* Call Access Program to retrieve currency nostro record            S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C***********          PARM UCUCY     @CCY    3        CurrencyS01194 CEU003
     C                     PARM WRK3      @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM WRK2      @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01154
     C********** *IN85     IFNE '1'                                E21549 S01194
     C********** RECI      ANDEQ'D'                                E21549 S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C*                                                                   E21549
     C******Use*fields*from*table*file*to*shadow*post***           E21549 S01194
     C* Use fields from nostros file to shadow post                       S01194
     C*                                                                   E21549
     C**********           MOVE CNUM      CUSN                     E21549 S01194
     C                     MOVE A7CUST    CUSN                            S01194
     C**********           MOVE CCY       CCYD                     E21549 S01194
     C                     MOVE A7CYCD    CCYD                            S01194
     C**********           MOVE ACOD      ACDE                     E21549 S01194
     C                     MOVE A7ACCD    ACDE                            S01194
     C**********           MOVE ACSQ      ASNC                     E21549 S01194
     C                     MOVE A7ACSN    ASNC                            S01194
     C                     MOVE A7BRCD    BRCA                            S01117
      *                                                                   E21549
     C                     ELSE                                           E21549
      *                                                                   E21549
      *  Else initialise account keys of unallocated nostros.             E21549
      *                                                                   E21549
     C**********           Z-ADD*ZEROS    CUSN                                         E21549 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C***********          MOVE UCUCY     CCYD                     E21549 CEU003
     C                     MOVE WRK3      CCYD                            CEU003
     C                     Z-ADD*ZEROS    ACDE                            E21549
     C                     Z-ADD*ZEROS    ASNC                            E21549
     C                     MOVE *BLANKS   BRCA                            S01117
      *                                                                   E21549
     C                     END                                            E21549
      *                                                                   CRE009
      ** If CRE009 is ON and account is RE, set the posting date the same CRE009
      ** as the value date when the latter is not less than the run date. CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
      *                                                                   CRE009
     C                     MOVE CUSN      WCNUM                           CRE009
     C                     MOVE CCYD      WCCY                            CRE009
     C                     MOVE ACDE      WACOD                           CRE009
     C                     MOVE ASNC      WACSQ                           CRE009
     C                     MOVE BRCA      WWBRCA                          CRE009
     C           ACCKEY    CHAINACCNT                88                   CRE009
     C           *IN88     IFEQ *OFF                                      CRE009
     C           ATYP      ANDEQ'R'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
      ** If CRE009 is ON and deal is not settled through a nostro         CRE009
      ** set the value date and posting date the same when the value      CRE009
      ** date is not less than the run date.                              CRE009
      *                                                                   CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
     C           WNOST     ANDEQ'N'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C                     MOVE DLNO      TNMR                            E21549
     C                     MOVE DTYP      TRYP                            E21549
      *                                                                   E21549
     C                     END                                            E21549
      *                                                                   E21549
     C                     Z-ADDNETDSA    MVAM                            E21549
      *                                                                   E21549
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  E21549
     C/COPY WNCPYSRC,DL1922C007
     C                     Z-ADD*ZEROS    MVAM                            E21549
      *                                                                   E21549
     C                     END                                            E21549
      *                                                                   E21549
      *                                                                   E21549
     C           OUTEND    ENDSR                                          E21549
      ********************************************************************E21549
     C/TITLE IRS SUBROUTINE                                               CIR001
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*    IRS SR: TO CALCULATE INTEREST PAYMENT AMOUNTS IF           *   CIR001
     C*               APPLICABLE ,FOR IRS.                            *   CIR001
     C*                                                               *   CIR001
     C*    CALLED FROM : MAIN PROCESSING                              *   CIR001
     C*                                                               *   CIR001
     C*    CALLS : DLRADS, SUB01U, SUB01T, SUB02, RL1, RL2, RL3       *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           IRS       BEGSR                                          CIR001
     C*                                                                   CIR001
     C**  DEFINE FIELDS FOR SUBROUTINE                                    CIR001
     C*                                                                   CIR001
     C                     MOVE '0'       *IN55                           CIR001
     C                     MOVE '0'       *IN56                           CIR001
     C                     MOVE '0'       *IN79                           CIR001
     C                     MOVE '0'       *IN87                           CIR001
     C                     Z-ADD0         UEDAT   50                      CIR001
     C                     Z-ADD0         TEDAT   50                      CIR001
     C                     Z-ADD0         LTXDT   50                      CIR001
     C                     Z-ADD0         UTXDT   50                      CIR001
     C                     Z-ADD0         TTXDT   50                      CIR001
     C                     MOVE *BLANKS   PRINT   1                       CIR001
     C                     MOVE ' '       UPRT    1                       CIR001
     C                     MOVE ' '       TPRT    1                       CIR001
     C                     Z-ADD0         DIFF   117                      CIR001
     C                     Z-ADD0         NAIANP 130                      CIR001
     C                     Z-ADD0         SZVDAT  50                      CIR001
     C                     Z-ADD0         SZMDAT  50                      CIR001
     C                     Z-ADD0         SZICB   10                      CIR001
     C                     Z-ADD0         SZPPL  130                      CIR001
     C                     Z-ADD0         SZIANP 130                      CIR001
     C                     Z-ADD0         SZFIX  117                      CIR001
     C                     Z-ADD0         SZFLT  117                      CIR001
     C                     Z-ADD0         WRK6   150                      CIR001
     C                     Z-ADD0         INTX   130                      CIR001
     C                     Z-ADD0         DSANOT 130                      CIR001
     C                     Z-ADD0         EINTR  152                      CIR001
     C                     Z-ADD0         ENDDT   50                      CIR001
     C                     Z-ADD0         ZTAXC  150                      CIR001
     C                     Z-ADD0         TAXC   130                      CIR001
     C                     Z-ADD0         UINOT  130                      CIR001
     C                     Z-ADD0         TINOT  130                      CIR001
     C                     Z-ADD0         NETAMT 130                      CIR001
     C                     Z-ADD0         SINTX  130                      CIR001
     C                     Z-ADD0         CINTX  130                      CIR001
     C                     Z-ADD0         SINOT  130                      CIR001
     C                     Z-ADD0         CINOT  130                      CIR001
     C                     Z-ADD0         NICD    50                      CIR001
     C                     Z-ADD0         EINT   130                      CIR001
     C                     Z-ADD0         CALINT 130                      CIR001
     C                     Z-ADD0         STINT  130                      CIR001
     C                     Z-ADD0         PAYD    50                      CIR001
     C                     Z-ADD0         UINTR  130                      CIR001
     C                     Z-ADD0         TINTR  130                      CIR001
     C                     Z-ADD0         TAXPY  130                      CIR001
     C                     Z-ADD0         @UBRTE 117                      CIR001
     C                     Z-ADD0         @TBRTE 117                      CIR001
     C                     Z-ADDUNICD     UINFD                           CIR001
     C                     Z-ADDTNICD     TINFD                           CIR001
     C                     MOVE *BLANKS   SETL    1                       CIR001
     C                     MOVE *BLANKS   KEY3    4                       CIR001
     C                     SETOF                     2014                 CIR001
     C*                                                                   CIR001
     C**  FOR DEAL TYPES RS AND RX IDENTIFY OUR AND THEIR                 CIR001
     C**  EVENT DATES (ie.PAYMENT DATES)                                  CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  FOR RS,RX DEAL TYPES THE EVENT DATES = NEXT INTEREST            CIR001
     C**  PAYMENT DATE IF PRESENT, OTHERWISE = NEXT INTEREST CHANGE       CIR001
     C**  DATE IF PRESENT, OTHERWISE = MATURITY DATE                      CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C*                                                                   CIR001
     C           UNIPD     IFNE 0                                         CIR001
     C                     Z-ADDUNIPD     UEDAT                           CIR001
     C                     END                                            CIR001
     C           UNICD     IFNE 0                                         CIR001
     C           UEDAT     ANDEQ0                                         CIR001
     C                     Z-ADDUNICD     UEDAT                           CIR001
     C                     END                                            CIR001
     C           UEDAT     IFEQ 0                                         CIR001
     C                     Z-ADDMDAT      UEDAT                           CIR001
     C                     END                                            CIR001
     C           TNIPD     IFNE 0                                         CIR001
     C                     Z-ADDTNIPD     TEDAT                           CIR001
     C                     END                                            CIR001
     C           TNICD     IFNE 0                                         CIR001
     C           TEDAT     ANDEQ0                                         CIR001
     C                     Z-ADDTNICD     TEDAT                           CIR001
     C                     END                                            CIR001
     C           TEDAT     IFEQ 0                                         CIR001
     C                     Z-ADDMDAT      TEDAT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   110874
     C                     MOVE *BLANK    UBACK   1                       110874
     C*                                                                   CIR001
     C*  IF OUR INTEREST IS UP FRONT (DISCOUNT OR YIELD)                  CIR001
     C*                                                                   CIR001
     C           UINPM     IFEQ 'D'                                       CIR001
     C           UINPM     OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     TESTB'1'       ACEI       86                   CIR001
     C*                                                                   CIR001
     C*  IF VALUE DATE OF DEAL HAS NOT YET ARRIVED                        CIR001
     C*                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C*                                                                   CIR001
     C*  OUR FIRST INTEREST PAYMENT DATE IS VALUE DATE                    CIR001
     C*  AND OUR INTEREST END DATE IS THE NEXT INTEREST PAYMENT DATE      CIR001
     C*                                                                   CIR001
     C                     Z-ADDVDAT      UEDAT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*  OUR INTEREST END DATE IS THE FOLLOWING INTEREST PAYMENT DATE     CIR001
     C*                                                                   CIR001
     C                     MOVEL'U'       OTIN                            CIR001
     C                     MOVEL'P'       RCIP                            CIR001
     C                     Z-ADDUEDAT     ZDAYNO                          CIR001
     C                     EXSR DETNDT                                    CIR001
     C                     Z-ADDZDAYNO    UNEDT   50                      CIR001
     C*                                                                   CIR001
     C**  If interest is up front, any interest payments from previous    CIR001
     C**  periods will already have been made therefore pay interest      CIR001
     C**  for current period only.                                        CIR001
     C*                                                                   CIR001
     C***********          MOVE *BLANK    UBACK   1                CIR001 110874
     C           UNEDT     DOWLEBJRDNB                                    CIR001
     C                     Z-ADDUNEDT     UEDAT                           CIR001
     C                     Z-ADDUEDAT     ZDAYNO                          CIR001
     C                     EXSR DETNDT                                    CIR001
     C                     Z-ADDZDAYNO    UNEDT                           CIR001
     C                     MOVE 'Y'       UBACK                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   110874
     C                     MOVE *BLANK    TBACK   1                       110874
     C*                                                                   CIR001
     C*  IF THEIR INTEREST IS UP FRONT (DISCOUNT OR YIELD)                CIR001
     C*                                                                   CIR001
     C           TINPM     IFEQ 'D'                                       CIR001
     C           TINPM     OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     TESTB'1'       ACEI       86                   CIR001
     C*                                                                   CIR001
     C*  IF VALUE DATE OF DEAL HAS NOT YET ARRIVED                        CIR001
     C*                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C*                                                                   CIR001
     C*  THEIR FIRST INTEREST PAYMENT DATE IS VALUE DATE                  CIR001
     C*  AND THEIR INTEREST END DATE IS THE NEXT INTEREST PAYMENT DATE    CIR001
     C*                                                                   CIR001
     C                     Z-ADDVDAT      TEDAT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*  THEIR INTEREST END DATE IS THE FOLLOWING INTEREST PAYMENT DATE   CIR001
     C*                                                                   CIR001
     C                     MOVEL'T'       OTIN                            CIR001
     C                     MOVEL'P'       RCIP                            CIR001
     C                     Z-ADDTEDAT     ZDAYNO                          CIR001
     C                     EXSR DETNDT                                    CIR001
     C                     Z-ADDZDAYNO    TNEDT   50                      CIR001
     C*                                                                   CIR001
     C**  If interest is up front, any interest payments from previous    CIR001
     C**  periods will already have been made therefore pay interest      CIR001
     C**  for current period only.                                        CIR001
     C*                                                                   CIR001
     C***********          MOVE *BLANK    TBACK   1                CIR001 110874
     C           TNEDT     DOWLEBJRDNB                                    CIR001
     C                     Z-ADDTNEDT     TEDAT                           CIR001
     C                     Z-ADDTEDAT     ZDAYNO                          CIR001
     C                     EXSR DETNDT                                    CIR001
     C                     Z-ADDZDAYNO    TNEDT                           CIR001
     C                     MOVE 'Y'       TBACK                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IDENTIFY ALL DEALS FOR WHICH OUR OR THEIR PAY/RECEIVE           CIR001
     C**  REPORTING OR INTEREST PAYMENT CONFIRMATIONS ARE REQUIRED        CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C** FOR DEAL TYPE 'RS' 'RX'                                          CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C           UEDAT     IFEQ BJRDNB                                    CIR001
     C                     MOVE 'Y'       UPRT                PRINT OUR   CIR001
     C                     MOVE 'Y'       PRINT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           TEDAT     IFEQ BJRDNB                                    CIR001
     C                     MOVE 'Y'       TPRT                PRINT THEIR CIR001
     C                     MOVE 'Y'       PRINT                           CIR001
     C                     END                                            CIR001
     C/COPY WNCPYSRC,DL1922C004
      *                                                                                       CIR007
      ** If Deal is an OIS, then do not do standard Input cycle                               CIR007
      ** settlement for FRA and IRS deals.                                                    CIR007
     C           UICFR     IFEQ 'O'                                                           CIR007
     C           UPRT      IFEQ 'Y'                                                           CIR007
     C           TPRT      ANDEQ'Y'                                                           CIR007
     C                     MOVE 'N'       TPRT                                                CIR007
     C                     ENDIF                                                              CIR007
     C                     MOVE 'N'       UPRT                                                CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           TICFR     IFEQ 'O'                                                           CIR007
     C           UPRT      IFEQ 'Y'                                                           CIR007
     C           TPRT      ANDEQ'Y'                                                           CIR007
     C                     MOVE 'N'       UPRT                                                CIR007
     C                     ENDIF                                                              CIR007
     C                     MOVE 'N'       TPRT                                                CIR007
     C                     ENDIF                                                              CIR007
      *                                                                                       CIR007
     C           UPRT      IFNE 'Y'                                                           CIR007
     C           TPRT      ANDNE'Y'                                                           CIR007
     C                     MOVE *BLANK    PRINT                                               CIR007
     C                     ENDIF                                                              CIR007
     C*                                                                   CIR001
     C**  ii) PAYMENT CONFIRMATIONS AND TELEXES CAN ONLY BE DONE          CIR001
     C**       FOR KNOWN DETAILS, OR IF THEY ARE STILL OUTSTANDING,       CIR001
     C**       SO IN ADDITION TO i) & ii) THE FOLLOWING APPLIES           CIR001
     C*                                                                   CIR001
     C*  Check to see if telex or confirmations have been produced        CIR001
     C*                                                                   CIR001
     C           UBRTT     IFNE 0                                         CIR001
     C                     TESTB'3'       TLXI           14               CIR001
     C                     TESTB'2'       CNFI           16               CIR001
     C*                                                                   CIR001
     C           *IN14     IFEQ '1'                                       CIR001
     C           *IN16     ANDEQ'1'                                       CIR001
     C           RERUN     ANDEQ'N'                                       CIR001
     C                     MOVE *BLANKS   UPRT                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           TBRTT     IFNE 0                                         CIR001
     C                     TESTB'4'       TLXI           14               CIR001
     C                     TESTB'3'       CNFI           16               CIR001
     C*                                                                   CIR001
     C           *IN14     IFEQ '1'                                       CIR001
     C           *IN16     ANDEQ'1'                                       CIR001
     C           RERUN     ANDEQ'N'                                       CIR001
     C                     MOVE *BLANKS   TPRT                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UPRT      IFNE 'Y'                                       CIR001
     C           TPRT      ANDNE'Y'                                       CIR001
     C                     MOVE *BLANKS   PRINT                           CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ***For*deal*types*"RS"*and*"RX",*if*this*is*a*re-run,*check  CIR001 110874
      *****that*thebase*rate*has*previously*been*set.*If*it*hasn't,CIR001 110874
      *****then*it*will*have*set*as*a*short-term*rate*manually*and CIR001 110874
      *****will*not*require*re-fixing.***************************  CIR001 110874
      ***********                                                  CIR001 110874
     C***********DTYP      IFEQ 'RS'                               CIR001 110874
     C***********DTYP      OREQ 'RX'                               CIR001 110874
      ***********                                                  CIR001 110874
     C***********RERUN     IFEQ 'Y'                                CIR001 110874
     C***********UBRTE     ANDEQ0                                  CIR001 110874
     C***********          MOVE *BLANKS   UPRT                     CIR001 110874
     C***********          END                                     CIR001 110874
      ***********                                                  CIR001 110874
     C***********RERUN     IFEQ 'Y'                                CIR001 110874
     C***********TBRTE     ANDEQ0                                  CIR001 110874
     C***********          MOVE *BLANKS   TPRT                     CIR001 110874
     C***********          END                                     CIR001 110874
      ***********                                                  CIR001 110874
     C***********RERUN     IFEQ 'Y'                                CIR001 110874
     C***********UBRTE     ANDEQ0                                  CIR001 110874
     C***********TBRTE     ANDEQ0                                  CIR001 110874
     C***********          MOVE *BLANKS   PRINT                    CIR001 110874
     C***********          END                                     CIR001 110874
      ***********                                                  CIR001 110874
     C***********          END                                     CIR001 110874
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  CALCULATE AMOUNTS OF INTEREST PAYABLE FOR THOSE DEALS           CIR001
     C**  IDENTIFIED ABOVE                                                CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C           PRINT     IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  ////////////////////////////                                    CIR001
     C**  RS,RX DEAL TYPES                                                CIR001
     C**  ////////////////////////////                                    CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C*                                                                   CIR001
     C**  PROCESS OUR DETAILS IF OUR EVENT DATE DUE   AND                 CIR001
     C**  IF PRINT FOR OUR DETAILS REQUESTED.                             CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      *   If our base rate code is not zero and the floating rate has     CIR001
      *   not been set,or if our base rate code is not equal to zero      CIR001
      *   ,and the input parameter RERUN is equal to  'Y' then:-          CIR001
      *   Access floating rate for base rate using SR:SUB01U              CIR001
     C*                                                                   CIR001
     C           UPRT      IFEQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C**  IF DETAILS RELATE TO A NON-ZERO BASE RATE TYPE AND THE EVENT    CIR001
     C**  DATE IS GREATER THAN THE RATE CHANGE DATE CALCULATE INTEREST    CIR001
     C**  RATE FOR THAT PERIOD VIA SR:SUB01U                              CIR001
     C*                                                                   CIR001
     C           UBRTT     IFNE 0                                         CIR001
     C*                                                                   CIR001
     C**  BIT '2' OF UDNSI SIGNIFIES SHORT TERM RATE SET. ONLY PAYMENTS   CIR001
     C**  DUE TODAY SELECTED SO IF UEINR N.E. TO '0' AND USTRT EQ '0'     CIR001
     C**  FLOATING RATE WAS SET ON PREVIOUS RUN AND SHOULD BE REVERSED.   CIR001
     C*                                                                   CIR001
     C           UEINR     IFNE 0                                         CIR001
     C           USTRT     ANDEQ0                                         CIR001
     C                     MOVE '1'       *IN79                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE '0'       *IN79                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     TESTB'2'       UDNSI          20               CIR001
      *                                                                   CIR001
      *  If RERUN and *IN79 is off, then rate has not been previously     CIR001
      *  set and hence deal shouldn't be reversed before re-fixing rate   CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           *IN79     IFEQ '0'                                       CIR001
     C                     MOVE 'N'       @PRVST  1                       CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'Y'       @PRVST                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Set on deals file update indicator.                              CIR001
     C                     MOVE '1'       *IN66                           CIR001
     C*                                                                   CIR001
      *  Increment count of deals with rate fixed.                        CIR001
     C                     ADD  1         RTFIX                           CIR001
     C*                                                                   CIR001
     C                     EXSR SUB01U                                    CIR001
     C                     MOVE '1'       *IN55                           CIR001
     C*                                                                   CIR001
     C           UINPM     IFEQ 'D'                                       CIR001
     C           UINPM     OREQ 'Y'                                       CIR001
     C                     Z-ADDRATE      UEINR                           CIR001
     C                     Z-ADDBBRTE     @UBRTE                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  USE SR:GLINTC TO CALCULATE THE END INTEREST FROM THE INTEREST   CIR001
     C**  CHANGE DATE UP TO BUT EXCLUDING THE EVENT DATE                  CIR001
     C*                                                                   CIR001
     C           UNICD     IFNE 0                                         CIR001
     C           UEDAT     ANDGTUNICD                                     CIR001
     C                     Z-ADDRATE      ZIRATE                          CIR001
     C           *IN20     IFEQ '1'                                       CIR001
     C                     Z-SUBRATE      ZIRATE                          CIR001
     C                     END                                            CIR001
     C                     Z-ADDUICBS     ZICALC                          CIR001
     C                     Z-ADDUNICD     ZIBEG                           CIR001
     C                     Z-ADDUEDAT     ZIEND                           CIR001
     C                     Z-ADDUPAMT     ZIAMT                           CIR001
     C                     EXSR GLINTC                                    CIR001
     C*                                                                   CIR001
     C                     Z-ADDZINTR     EINTR                           CIR001
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  OTHERWISE ZEROISE END INTEREST                                  CIR001
     C*                                                                   CIR001
     C                     Z-ADD0         EINTR                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET END DATE TO THE EVENT DATE OR THE RATE CHANGE DATE IF       CIR001
     C**  THIS IS BEFORE THE EVENT DATE                                   CIR001
     C*                                                                   CIR001
     C           UNICD     IFNE 0                                         CIR001
     C           UEDAT     ANDGTUNICD                                     CIR001
     C                     Z-ADDUNICD     ENDDT                           CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDUEDAT     ENDDT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF INTEREST IS UP FRONT CALCULATE INTEREST VIA SE: CALIUF, ELSE CIR001
     C**  CALCULATE INTEREST DUE VIA SR: SUB02                            CIR001
     C*                                                                   CIR001
     C                     EXSR USET                                      CIR001
     C*                                                                   CIR001
     C           UINPM     IFEQ 'D'                                       CIR001
     C           UINPM     OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDUNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     ELSE                                           CIR001
     C                     EXSR SUB02                                     CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  ADD THE END INTEREST TO THE INTEREST DUE                        CIR001
     C*                                                                   CIR001
     C           INTD      ADD  EINTR     EINTR                           CIR001
     C                     Z-ADDEINTR     UINTR     H                     CIR001
     C*                                                                   CIR001
     C**  IF THE DEAL IS TAX PAYABLE CALCULATE THE TAX ON THE INTEREST    CIR001
     C**  DUE                                                             CIR001
     C*                                                                   CIR001
     C           TAXI      IFEQ 'Y'                                       CIR001
     C           EINTR     MULT BNHKTR    ZTAXC     H                     CIR001
     C           ZTAXC     DIV  100       TAXC                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  CALCULATE THE INTEREST NET OF TAX(OUR INTEREST AMOUNT)          CIR001
     C*                                                                   CIR001
     C           EINTR     SUB  TAXC      UINOT     H                     CIR001
     C*                                                                   CIR001
     C**  SAVE THE EFFECTIVE INTEREST RATE  FOR LATER USE                 CIR001
     C                     Z-ADDUEINR     UEINS  117                      CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *   If their base rate code is not zero and the floating rate has   CIR001
      *   not been set,or if their base rate code is not equal to zero    CIR001
      *   ,and the input parameter RERUN is equal to  'Y' then:-          CIR001
      *   Access floating rate for base rate using SR:SUB01T              CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C**  PROCESS THEIR DETAILS IF THEIR EVENT DATE DUE AND               CIR001
     C**  IF PRINT FOR THEIR DETAILS REQUESTED.                           CIR001
     C*                                                                   CIR001
     C           TPRT      IFEQ 'Y'                                       CIR001
     C                     Z-ADD0         EINTR                           CIR001
     C*                                                                   CIR001
     C**  IF DETAILS RELATE TO A NON-ZERO BASE RATE TYPE AND THE EVENT    CIR001
     C**  DATE IS GREATER THAN THE RATE CHANGE DATE CALCULATE INTEREST    CIR001
     C**  RATE FOR THAT PERIOD VIA SR:SUB01T                              CIR001
     C*                                                                   CIR001
     C           TBRTT     IFNE 0                                         CIR001
     C*                                                                   CIR001
     C**  BIT '2' OF TDNSI SIGNIFIES SHORT TERM RATE SET. ONLY PAYMENTS   CIR001
     C**  DUE TODAY SELECTED SO IF TEINR N.E. TO '0' AND TSTRT EQ '0'     CIR001
     C**  FLOATING RATE WAS SET ON PREVIOUS RUN AND SHOULD BE REVERSED.   CIR001
     C*                                                                   CIR001
     C           TEINR     IFNE 0                                         CIR001
     C           TSTRT     ANDEQ0                                         CIR001
     C                     MOVE '1'       *IN79                           CIR001
     C                     ELSE                                           CIR001
     C                     MOVE '0'       *IN79                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     TESTB'2'       TDNSI          20               CIR001
      *                                                                   CIR001
      *  If RERUN and *IN79 is off, then rate has not been previously     CIR001
      *  set and hence deal shouldn't be reversed before re-fixing rate   CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           *IN79     IFEQ '0'                                       CIR001
     C                     MOVE 'N'       @PRVST  1                       CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'Y'       @PRVST                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      ** Set on deals file update indicator.                              CIR001
     C                     MOVE '1'       *IN66                           CIR001
     C*                                                                   CIR001
      *  Increment count of deals with rate fixed.                        CIR001
     C                     ADD  1         RTFIX                           CIR001
     C*                                                                   CIR001
     C                     EXSR SUB01T                                    CIR001
     C                     MOVE '1'       *IN56                           CIR001
     C*                                                                   CIR001
     C           TINPM     IFEQ 'D'                                       CIR001
     C           TINPM     OREQ 'Y'                                       CIR001
     C                     Z-ADDRATE      TEINR                           CIR001
     C                     Z-ADDBBRTE     @TBRTE                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           TNICD     IFNE 0                                         CIR001
     C           TEDAT     ANDGTTNICD                                     CIR001
     C*                                                                   CIR001
     C**  USE SR:GLINTC TO CALCULATE THE END INTEREST FROM THE INTEREST   CIR001
     C**  CHANGE DATE UP TO BUT EXCLUDING THE EVENT DATE                  CIR001
     C*                                                                   CIR001
     C                     Z-ADDRATE      ZIRATE                          CIR001
     C           *IN20     IFEQ '1'                                       CIR001
     C                     Z-SUBRATE      ZIRATE                          CIR001
     C                     END                                            CIR001
     C                     Z-ADDTICBS     ZICALC                          CIR001
     C                     Z-ADDTNICD     ZIBEG                           CIR001
     C                     Z-ADDTEDAT     ZIEND                           CIR001
     C                     Z-ADDTPAMT     ZIAMT                           CIR001
     C                     EXSR GLINTC                                    CIR001
     C*                                                                   CIR001
     C                     Z-ADDZINTR     EINTR                           CIR001
     C*                                                                   CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  OTHERWISE ZEROISE END INTEREST                                  CIR001
     C*                                                                   CIR001
     C                     Z-ADD0         EINTR                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  SET END DATE TO THE EVENT DATE OR THE RATE CHANGE DATE IF       CIR001
     C**  THIS IS BEFORE THE EVENT DATE                                   CIR001
     C*                                                                   CIR001
     C           TNICD     IFNE 0                                         CIR001
     C           TEDAT     ANDGTTNICD                                     CIR001
     C                     Z-ADDTNICD     ENDDT                           CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDTEDAT     ENDDT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF INTEREST IS UP FRONT CALCULATE INTEREST VIA SE: CALIUF, ELSE CIR001
     C**  CALCULATE INTEREST DUE VIA SR: SUB02                            CIR001
     C*                                                                   CIR001
     C                     EXSR TSET                                      CIR001
     C*                                                                   CIR001
     C           TINPM     IFEQ 'D'                                       CIR001
     C           TINPM     OREQ 'Y'                                       CIR001
     C                     Z-ADDTNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     ELSE                                           CIR001
     C                     EXSR SUB02                                     CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  ADD THE END INTEREST TO THE INTEREST DUE                        CIR001
     C*                                                                   CIR001
     C           INTD      ADD  EINTR     EINTR                           CIR001
     C                     Z-ADDEINTR     TINTR     H                     CIR001
     C*                                                                   CIR001
     C**  INTEREST IS RECEIVABLE THEREFORE NO TAX                         CIR001
     C*                                                                   CIR001
     C                     Z-ADDEINTR     TINOT     H                     CIR001
     C*                                                                   CIR001
     C**  SAVE THE EFFECTIVE INTEREST RATE  FOR LATER USE                 CIR001
     C                     Z-ADDTEINR     TEINS  117                      CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
      *                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     NETAMT                          CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     NETAMT                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C* /////////////////////////////////////                             CIR001
     C**  SET UP PAY/RECEIVE AND CONFIRMATIONS                            CIR001
     C*                                                                   CIR001
     C**  IF SETL = 'B' EXECUTE 'AB', 'BC' FOR  - SETL=P,  SETL=R         CIR001
     C*    ie. run twice through the routines.                            CIR001
     C*                                                                   CIR001
     C                     MOVE SETL      SESETL  1                       CIR001
     C                     Z-ADD1         X                               CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'B'                                       CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           X         DOUEQ0                             <<<<<<<<<   CIR001
     C*                                                                   CIR001
     C* /////////////////////////////////////                             CIR001
     C**  SET UP PAY/RECEIVE INSTRUCTIONS                                 CIR001
     C*                                                                   CIR001
     C                     MOVE ' '       CNRQ                            CIR001
     C*                                                                   CIR001
     C                     EXSR AB                         EXSR **AB**    CIR001
     C*                                                                   CIR001
     C                     Z-ADD0         PRI1    10                      CIR001
     C                     Z-ADD0         PRI2    10                      CIR001
     C                     Z-ADD0         PRI3    10                      CIR001
     C*                                                                   CIR001
     C* /////////////////////////////////////                             CIR001
     C**  SET UP INTEREST PAYMENT CONFIRMATIONS                           CIR001
     C*                                                                   CIR001
     C                     EXSR BC                         EXSR **BC**    CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C                     SUB  1         X                               CIR001
     C*                                                                   CIR001
     C           SETL      IFEQ 'B'                                       CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                             >>ENDDO>>>>    CIR001
     C/SPACE 3                                                            CIR001
     C* /////////////////////////////////////                             CIR001
     C**  SET UP INTEREST FIX CONFIRMATIONS                               CIR001
     C*                                                                   CIR001
     C                     EXSR BD                                        CIR001
     C*                                                                   CIR001
     C**   SET INDICATOR FOR DEALS FILE UPDATE                            CIR001
     C                     MOVE '1'       *IN66                           CIR001
     C*                                                                   CIR001
     C                     END                             (PRINT=Y)      CIR001
     C*                                                                   CIR001
     C                     ENDSR                                          CIR001
     C*                                                                   CIR001
     C*****************************************************************   CIR001
     C/TITLE SUB02 SUBROUTINE                                             CIR001
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*    SUB02  SR: TO PROCESS FRA/IRS DEAL TYPES                   *   CIR001
     C*                                                               *   CIR001
     C*    CALLED FROM : FRAIRS                                       *   CIR001
     C*                                                               *   CIR001
     C*    CALLS : TTXDT                                              *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           SUB02     BEGSR                                          CIR001
     C*                                                                   CIR001
     C**  DEFINE FIELDS FOR SUBROUTINE                                    CIR001
     C*                                                                   CIR001
     C                     Z-ADD0         SZAITD 130                      CIR001
     C                     Z-ADD0         INTD   130                      CIR001
     C*                                                                   CIR001
     C                     Z-ADDSZEDAT    ZIEND                           CIR001
     C                     Z-ADDSZPPL     ZIAMT                           CIR001
     C                     Z-ADDSZINR     ZIRATE                          CIR001
     C                     Z-ADDSZCBS     ZICALC                          CIR001
     C*                                                                   CIR001
     C**  IF DEAL TYPE = RS,RX OR (RR/RP/RF + AVE.RATE METHOD = N) CALC   CIR001
     C**  INTEREST FROM  AND INCLUDING INTEREST ACCRUAL CONTROL DATE      CIR001
     C**  TO BUT EXCLUDING END DATE                                       CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           DTYP      OREQ 'RX'                                      CIR001
     C           DTYP      OREQ 'RR'                                      CIR001
     C           SZAVRM    ANDEQ'N'                                       CIR001
     C           DTYP      OREQ 'RP'                                      CIR001
     C           SZAVRM    ANDEQ'N'                                       CIR001
     C           DTYP      OREQ 'RF'                                      CIR001
     C           SZAVRM    ANDEQ'N'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDSZAICD    ZIBEG                           CIR001
     C*                                                                   CIR001
     C* IF FREQ.IS NOT 'C' FOR CASH FLOW SCHEDULE USE GLINTC TO CALC INT. CIR001
     C*                                                                   CIR001
     C           SZIPFC    IFNE 'C'                                       CIR001
     C                     EXSR GLINTC                                    CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C* IF FREQ.IS 'C' DETEMINE PAYMENT DUE ON NEXT DATE FROM CASH FLW SCHCIR001
     C*                                                                   CIR001
     C           SZDIR     IFEQ 'P'                                       CIR001
     C                     MOVEL'U'       OTIN             * OURS         CIR001
     C                     ELSE                                           CIR001
     C                     MOVEL'T'       OTIN             * THEIRS       CIR001
     C                     END                                            CIR001
     C                     EXSR DETNCF                                    CIR001
     C                     Z-ADDCFLA      ZINTR                           CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF DTYP = RR/RP/RF AND AVERAGE RATE METHOD = Y. CALC INTEREST   CIR001
     C**  FROM AND INCLUDING START DATE CURRENT AVERAGING PERIOD TO       CIR001
     C**  BUT EXCLUDING END DATE                                          CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RR'                                      CIR001
     C           SZAVRM    ANDEQ'Y'                                       CIR001
     C           DTYP      OREQ 'RP'                                      CIR001
     C           SZAVRM    ANDEQ'Y'                                       CIR001
     C           DTYP      OREQ 'RF'                                      CIR001
     C           SZAVRM    ANDEQ'Y'                                       CIR001
     C                     Z-ADDSZSDCR    ZIBEG                           CIR001
     C                     EXSR GLINTC                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  ADD INTEREST ACCRUED TO CONTROL DATE,ACCRUED INTEREST ADJ.      CIR001
     C**  NOT POSTED AND ACCRUED INTEREST ADJ. POSTED TO INTEREST CALC    CIR001
     C**  TO GIVE ACCRUED INTEREST TO DATE                                CIR001
     C*                                                                   CIR001
     C           SZIACD    ADD  SZIANP    SZAITD                          CIR001
     C           SZAITD    ADD  SZAIAP    SZAITD                          CIR001
     C           SZAITD    ADD  ZINTR     SZAITD    H                     CIR001
     C*                                                                   CIR001
     C**  SUBTRACT INTEREST PAID/RECEIVED TO DATE FROM ACCRUED INTEREST   CIR001
     C**  TO DATE TO GIVE INTEREST DUE                                    CIR001
     C*                                                                   CIR001
     C           SZAITD    SUB  SZIPRD    INTD                            CIR001
     C*                                                                   CIR001
     C**  IF INTEREST IS TO BE CAPITALIZED                                CIR001
     C**   IF END DATE IS MATURITY                                        CIR001
     C**     ADD INTEREST PAID/RECEIVED TO DATE FOR TOTAL AMOUNT DUE      CIR001
     C**   IF END DATE IS NOT MATURITY                                    CIR001
     C**     THEN NO INTEREST IS PAYABLE                                  CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'C'                                       CIR001
     C           SZINPM    OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           SZEDAT    IFEQ MDAT                                      CIR001
     C                     ADD  SZIPRD    INTD                            CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADD*ZERO     INTD                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     ENDSR                                          CIR001
     C*                                                                   CIR001
     C*****************************************************************   CIR001
     C/TITLE DETNCF SUBROUTINE                                            CIR001
3886 C********************************************************************CIR001
     C*                                                                   CIR001
     C* DETERMINE NEXT CASH FLOW                                          CIR001
     C* FROM THE CASH FLOW SCHEDULE FILE                                  CIR001
     C*                                                                   CIR001
     C********************************************************************CIR001
     C           DETNCF    BEGSR                                          CIR001
     C                     Z-ADDZIEND     PRDT                            CIR001
     C           IRSCFL    CHAINDLCFSCPD             99    *              CIR001
     C           *IN99     IFEQ '1'                                       CIR001
     C                     Z-ADD*ZERO     CFLA                            CIR001
     C                     END                                            CIR001
     C                     ENDSR                                          CIR001
3886 C********************************************************************CIR001
     C/EJECT                                                              CIR001
3886 C********************************************************************CIR001
     C*                                                                   CIR001
     C* DETERMINE NEXT RATE CHANGE/PAYMENT DATE FROM DATE SCHEDULE FILE   CIR001
     C*                                                                   CIR001
     C********************************************************************CIR001
     C           DETNDT    BEGSR                                          CIR001
     C                     Z-ADDZDAYNO    PRDT                            CIR001
     C           IRSDTL    SETGTDLDTSCPD                                  CIR001
     C           IRSDTP    READEDLDTSCPD                 99*              CIR001
     C           *IN99     IFEQ '0'                                       CIR001
     C                     Z-ADDPRDT      ZDAYNO                          CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADDMDAT      ZDAYNO                          CIR001
     C                     END                                            CIR001
     C                     ENDSR                                          CIR001
3886 C********************************************************************CIR001
     C/EJECT                                                              CIR001
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*   SR: CALIUF - TO CALCULATE INTEREST UP FRONT                 *   CIR001
     C*                                                               *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           CALIUF    BEGSR                           ** CALIUF **   CIR001
     C*                                                                   CIR001
     C**  CALCULATE INTEREST FROM INTEREST ACCRUAL CONTROL DATE           CIR001
     C**  TO END DATE (THIS PAYMENT DATE TO NEXT PAYMENT DATE)            CIR001
     C*                                                                   CIR001
     C                     Z-ADDSZAICD    ZIBEG                           CIR001
     C                     Z-ADDSZEDAT    ZIEND                           CIR001
     C                     Z-ADDSZPPL     ZIAMT                           CIR001
     C                     Z-ADDSZINR     ZIRATE                          CIR001
     C                     Z-ADDSZCBS     ZICALC                          CIR001
     C                     EXSR GLINTC                                    CIR001
     C*                                                                   CIR001
     C** IF INTEREST IS YIELD BASED (METHOD IS 'Y') CALCULATE IT          CIR001
     C** (USING INFORMATION PROVIDED BY GLINTC)                           CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'Y'                                       CIR001
     C                     EXSR CALIYD                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  ADD INTEREST ACCRUED TO CONTROL DATE, ACCRUED INTEREST          CIR001
     C**  ADJUSTMENTS NOT POSTED, ACCRUED INTEREST ADJUSTMENTS POSTED     CIR001
     C**  AND THIS INTEREST AMOUNT TO OBTAIN THE ACCRUED INTEREST TO DATE CIR001
     C*                                                                   CIR001
     C           SZIACD    ADD  SZIANP    SZAITD 130                      CIR001
     C                     ADD  SZAIAP    SZAITD 130                      CIR001
     C                     ADD  ZINTR     SZAITD    H                     CIR001
     C*                                                                   CIR001
     C**  SUBTRACT INTEREST PAID/RECEIVED TO DATE FROM ACCRUED INTEREST   CIR001
     C**  TO DATE TO GIVE INTEREST DUE                                    CIR001
     C*                                                                   CIR001
     C           SZAITD    SUB  SZIPRD    INTD                            CIR001
     C*                                                                   CIR001
     C                     ENDSR                                          CIR001
2585 C********************************************************************CIR001
     C/EJECT                                                              CIR001
2896 C********************************************************************CIR001
     C           CALIYD    BEGSR                                          CIR001
     C*                                                                   CIR001
     C** INTEREST = PRINCIPAL ( 1 - 1 / ( 1 + RATE X NUMBER OF DAYS/360)) CIR001
     C**       I.E. PRINCIPAL ( 1 - 360 / ( 360 + RATE X NUMBER OF DAYS)) CIR001
     C*                                                                   CIR001
     C           ZICALC    IFEQ 2                                         CIR001
     C           ZICALC    OREQ 3                                         CIR001
     C           ZICALC    OREQ 5                                         CIR001
     C                     Z-ADD36000     ZIWRK3  50                      CIR001
     C                     ELSE                                           CIR001
     C           ZICALC    IFEQ 1                                         CIR001
     C           ZICALC    OREQ 4                                         CIR001
     C           ZICALC    OREQ 9                                                             CIR013
     C           #29FEB    ANDEQ'N'                                                           CIR013
     C                     Z-ADD36500     ZIWRK3                          CIR001
     C                     ELSE                                           CIR001
     C                     Z-ADD36600     ZIWRK3                          CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           ZICALC    IFEQ 6                                                             CIR013
     C           ZICALC    OREQ 9                                                             CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C           INT6DY    MULT ZIRATE    ZIWRK4 157                                          CIR013
     C                     ELSE                                                               CIR013
     C           ZZINDY    MULT ZIRATE    ZIWRK4 157                      CIR001
     C                     ENDIF                                                              CIR013
     C                     ADD  ZIWRK3    ZIWRK4                          CIR001
     C*                                                                   CIR001
     C           ZIWRK3    DIV  ZIWRK4    ZIWRK5 159H                     CIR001
     C           1         SUB  ZIWRK5    ZIWRK5                          CIR001
     C           ZIAMT     MULT ZIWRK5    ZINTR     H                     CIR001
     C                     ENDSR                                          CIR001
2896 C********************************************************************CIR001
     C/TITLE TSET SUBROUTINE                                              CIR001
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*    TSET  SR: TO SETUP THEIR FIELDS FOR SUB-ROUTINES           *   CIR001
     C*                                                               *   CIR001
     C*    CALLED FROM : FRAIRS,RL3                                   *   CIR001
     C*                                                               *   CIR001
     C*    CALLS :                                                    *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           TSET      BEGSR                                          CIR001
     C*                                                                   CIR001
     C                     Z-ADDTPAMT     SZPPL                           CIR001
     C                     Z-ADDTEINR     SZINR                           CIR001
     C                     Z-ADDTICBS     SZCBS                           CIR001
     C                     Z-ADDTIALC     SZLICD                          CIR001
     C                     Z-ADDTAITC     SZIACD                          CIR001
     C                     Z-ADDTAIAN     SZIANP                          CIR001
     C                     Z-ADDTAIAP     SZAIAP                          CIR001
     C                     Z-ADDTAIPD     SZIPTD                          CIR001
     C                     Z-ADDTIPRD     SZIPRD                          CIR001
     C                     Z-ADDTIACD     SZAICD                          CIR001
     C           TBACK     IFEQ 'Y'                                       CIR001
     C                     Z-ADDTEDAT     SZAICD                          CIR001
     C                     END                                            CIR001
     C                     TESTB'3'       TDSTI          81               CIR001
     C           *IN81     IFEQ '1'                                       CIR001
     C                     MOVE 'Y'       SZAVRM                          CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'N'       SZAVRM                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     Z-ADDENDDT     SZEDAT                          CIR001
     C                     Z-ADDSDCAR     SZSDCR                          CIR001
     C                     MOVEL'R'       SZDIR                           CIR001
     C                     MOVELTIPFR     SZIPFC                          CIR001
     C                     MOVELTINPM     SZINPM                          CIR001
     C*                                                                   CIR001
     C                     ENDSR                                          CIR001
     C*                                                                   CIR001
     C*****************************************************************   CIR001
     C/TITLE USET SUBROUTINE                                              CIR001
     C*****************************************************************   CIR001
     C*                                                               *   CIR001
     C*    USET  SR: TO SETUP OUR DETAIL FIELDS FOR SUBROUTINES       *   CIR001
     C*                                                               *   CIR001
     C*    CALLED FROM : FRAIRS,RL3                                   *   CIR001
     C*                                                               *   CIR001
     C*    CALLS :                                                    *   CIR001
     C*                                                               *   CIR001
     C*****************************************************************   CIR001
     C*                                                                   CIR001
     C           USET      BEGSR                                          CIR001
     C*                                                                   CIR001
     C                     Z-ADDUPAMT     SZPPL  130                      CIR001
     C                     Z-ADDUEINR     SZINR  117                      CIR001
     C                     Z-ADDUICBS     SZCBS   10                      CIR001
     C                     Z-ADDUIALC     SZLICD 130                      CIR001
     C                     Z-ADDUAITC     SZIACD 130                      CIR001
     C                     Z-ADDUAIAN     SZIANP 130                      CIR001
     C                     Z-ADDUAIAP     SZAIAP 130                      CIR001
     C                     Z-ADDUAIPD     SZIPTD 130                      CIR001
     C                     Z-ADDUIPRD     SZIPRD 130                      CIR001
     C                     Z-ADDUIACD     SZAICD  50                      CIR001
     C           UBACK     IFEQ 'Y'                                       CIR001
     C                     Z-ADDUEDAT     SZAICD                          CIR001
     C                     END                                            CIR001
     C                     TESTB'3'       UDSTI          81               CIR001
     C           *IN81     IFEQ '1'                                       CIR001
     C                     MOVE 'Y'       SZAVRM  1                       CIR001
     C                     ELSE                                           CIR001
     C                     MOVE 'N'       SZAVRM                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     Z-ADDENDDT     SZEDAT  50                      CIR001
     C                     Z-ADDSDCAR     SZSDCR  50                      CIR001
     C                     MOVEL'P'       SZDIR   1                       CIR001
     C                     MOVELUIPFR     SZIPFC  1                       CIR001
     C                     MOVELUINPM     SZINPM  1                       CIR001
     C*                                                                   CIR001
     C                     ENDSR                                          CIR001
     C*                                                                   CIR001
     C*****************************************************************   CIR001
      /TITLE MEMIRS SUBROUTINE                                            CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  MEMIRS SR.    To update PF/MEMOS shadow postings file        *   CIR001
      *                for an amended deal                            *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           MEMIRS    BEGSR                           *** UMEMAM ****CIR001
      *                                                                   CIR001
      **   SAVE NEW VALUES OF NET TOTALS                                  CIR001
     C                     Z-ADDUINOT     @UINOT 130                      CIR001
     C                     Z-ADDTINOT     @TINOT 130                      CIR001
     C                     Z-ADD0         UINOT                           CIR001
     C                     Z-ADD0         TINOT                           CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Determine whether PF/MEMOS requires reversing before updating  CIR001
      *                                                                   CIR001
      **   Since PF/DEALSDG has been updated, the current                 CIR001
      **   file field values are the 'new' versions (the '@_____' fields) CIR001
      **   and the 'old' values from the file at beginning of             CIR001
      **   the programme are in the '#_____' fields.                      CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.   CIR001
      ** Otherwise no Memos reversal is required.                         CIR001
      *                                                                   CIR001
      **   Only process Details if instructions settled through           CIR001
      **   a retail account.                                              CIR001
      *                                                                   CIR001
     C                     MOVE PSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      DDCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     DDCCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     MOVE UPACC     DBNKAC                          CIR001
     C                     MOVELPOBR      WWBRCA                          CIR001
      *                                                                   CIR001
     C                     EXSR TSTRTL                                    CIR001
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )  CIR001CCB002
      *                                                             CIR001CCB002
     C***********RRNM******IFEQ 0                                   CIR001CCB002
     C           WRETL     IFEQ 'N'                                       CCB002
     C                     MOVE 'N'       URET    1                       CIR001
     C                     GOTO MTHEIR                         >>>>>>>>>> CIR001
     C                     ELSE                                           CIR001
     C*********************Z-ADDRRNM      URRNM   50                CIR001CCB002
     C**********           Z-ADDWCNUM     UCNUM   60                                   CCB002 CSD027
     C                     MOVE WCNUM     UCNUM   6                                           CSD027
     C                     MOVE WCCY      UCCY    3                       CCB002
     C**********           Z-ADDWACOD     UACOD   40                                   CCB002 CGL029
     C                     Z-ADDWACOD     UACOD  100                                          CGL029
     C                     Z-ADDWACSQ     UACSQ   20                      CCB002
     C                     MOVE 'Y'       URET    1                       CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           UBRTE     ANDGT0                                         CIR001
     C           *IN55     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Calculate Net Accrued Interest Adjustments Not Posted          CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates ( Set as positive )           CIR001
      *                                                                   CIR001
     C                     Z-ADD#UEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDUNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF THE DEAL IS TAX PAYABLE CALCULATE THE TAX ON THE INTEREST    CIR001
     C**  DUE                                                             CIR001
     C*                                                                   CIR001
     C           TAXI      IFEQ 'Y'                                       CIR001
     C           BNHKTR    ANDNE0                                         CIR001
     C           INTD      MULT BNHKTR    ZTAXC     H                     CIR001
     C           ZTAXC     DIV  100       TAXC                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  CALCULATE THE INTEREST NET OF TAX(OUR INTEREST AMOUNT)          CIR001
     C*                                                                   CIR001
     C           INTD      SUB  TAXC      UINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
     C           MTHEIR    TAG                             ** MTHEIR TAG *CIR001
      *                                                                   CIR001
      **   Only process Details if instructions settled through           CIR001
      **   a retail account.                                              CIR001
      *                                                                   CIR001
     C                     MOVE RSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      DDCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE TCUCY     DDCCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     MOVE URACC     DBNKAC                          CIR001
     C                     MOVELROBR      WWBRCA                          CIR001
      *                                                                   CIR001
     C                     EXSR TSTRTL                                    CIR001
      *****(*RRNM*from*SR.*TSTRTL. If = 0, account is not retail )  CIR001CCB002
      *                                                             CIR001CCB002
     C***********RRNM******IFEQ 0                                   CIR001CCB002
     C           WRETL     IFEQ 'N'                                       CCB002
     C                     MOVE 'N'       TRET    1                       CIR001
     C                     GOTO MSET                           >>>>>>>>>> CIR001
     C                     ELSE                                           CIR001
     C*********************Z-ADDRRNM      TRRNM   50                CIR001CCB002
     C**********           Z-ADDWCNUM     TCNUM   60                                   CCB002 CSD027
     C                     MOVE WCNUM     TCNUM   6                                           CSD027
     C                     MOVE WCCY      TCCY    3                       CCB002
     C**********           Z-ADDWACOD     TACOD   40                                   CCB002 CGL029
     C                     Z-ADDWACOD     TACOD  100                                          CGL029
     C                     Z-ADDWACSQ     TACSQ   20                      CCB002
     C                     MOVE 'Y'       TRET    1                       CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   ( Fixed side has Base rate type EQ 0,                          CIR001
      **   Rate/Spread is the Effective Interest Rate)                    CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.   CIR001
      ** Otherwise no Memos reversal is required.                         CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           TBRTE     ANDGT0                                         CIR001
     C           *IN56     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
      *                             ( *IN74 ON = PAY )                    CIR001
      *    ( RECEIVE )                                                    CIR001
     C                     SETOF                     74                   CIR001
      *                                                                   CIR001
     C                     MOVE RSETM     SETM                            CIR001
     C                     MOVE URACC     WACC                            CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates                               CIR001
      *                                                                   CIR001
     C                     Z-ADD#TEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDTNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  NO END INTEREST BECAUSE INTEREST UP FRONT                       CIR001
     C**  INTEREST IS RECEIVABLE THEREFORE NO TAX                         CIR001
     C*                                                                   CIR001
     C                     Z-ADDINTD      TINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   Access PF/MEMOS record                                         CIR001
      *                                                                   CIR001
     C           MSET      TAG                             ** MSET   TAG *CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Shadow Balances                                         CIR001
      *                                                                   CIR001
      *    ( Pay )                                                        CIR001
     C           URET      IFEQ 'Y'                                       CIR001
     C           UINOT     ANDNE0                                         CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C*********************Z-ADDURRNM     RRNM                      CIR001CCB002
     C                     MOVE PSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE UCUCY     DDCCY                           CIR001
     C                     MOVE UPACC     DBNKAC                          CIR001
     C*********************EXSR MEMCHN                              CIR001CCB002
      *                                                                   CEU003
      **   Convert UINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     Z-ADDUINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    UINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Update PF/MEMOS file                                           CIR001
     C*********************ADD  UINOT     LDBLN                     CIR001CCB002
     C*********************ADD  UINOT     CLBLN                     CIR001CCB002
     C                     Z-ADDUINOT     #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM TCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM TCCY      W0CCY            O:Currency     CCB002
     C                     PARM TACOD     W0ACOD           O:Account Code CCB002
     C                     PARM TACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '21'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 21 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C008
      *                                                                   CIR001
      **If not a nostro account then output posting details to RSACMTPD   CIR001
      *                                                                   CIR001
     C           WNOST     IFEQ 'N'                                       CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELUCUCY     ##CCY   3                       CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDVDAT      VUDT                            CIR001
     C                     Z-ADDUINOT     NETDSA                          CIR001
     C                     Z-ADD0         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *    ( Receive )                                                    CIR001
     C           TRET      IFEQ 'Y'                                       CIR001
     C           TINOT     ANDNE0                                         CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C*********************Z-ADDTRRNM     RRNM                      CIR001CCB002
     C                     MOVE RSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE TCUCY     DDCCY                           CIR001
     C                     MOVE URACC     DBNKAC                          CIR001
     C*********************EXSR MEMCHN                              CIR001CCB002
      *                                                                   CEU003
      **   Convert TINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     Z-ADDTINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    TINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Update PF/MEMOS file                                           CIR001
     C*********************SUB  TINOT     LDBLN                     CIR001CCB002
     C*********************SUB  TINOT     CLBLN                     CIR001CCB002
     C                     Z-SUBTINOT     #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM TCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM TCCY      W0CCY            O:Currency     CCB002
     C                     PARM TACOD     W0ACOD           O:Account Code CCB002
     C                     PARM TACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '22'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 22 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C009
      *                                                                   CIR001
      **If not a nostro account then output posting details to RSACMTPD   CIR001
      *                                                                   CIR001
     C           WNOST     IFEQ 'N'                                       CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELTCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDVDAT      VUDT                            CIR001
     C                     Z-ADDTINOT     NETDSA                          CIR001
     C                     Z-ADD1         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           MIRNEW    TAG                             ** MIRNEW TAG *CIR001
      *                                                                   CIR001
      **   New deal details (the '@_____' fields)                         CIR001
      **                                                                  CIR001
      **   RESTORE SAVED VALUES AND UPDATE MEMOS BALANCES WITH NEW VALUES CIR001
      **                                                                  CIR001
     C                     Z-ADD@UINOT    UINOT                           CIR001
     C                     Z-ADD@TINOT    TINOT                           CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Shadow Balances                                         CIR001
      *                                                                   CIR001
      *    ( Pay )                                                        CIR001
     C           URET      IFEQ 'Y'                                       CIR001
     C           UINOT     ANDNE0                                         CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C*********************Z-ADDURRNM     RRNM                      CIR001CCB002
     C                     MOVE PSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE UCUCY     DDCCY                           CIR001
     C                     MOVE UPACC     DBNKAC                          CIR001
     C*********************EXSR MEMCHN                              CIR001CCB002
      *                                                                   CEU003
      **   Convert UINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
      *                                                                   CEU003
     C                     Z-ADDUINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    UINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Update PF/MEMOS file                                           CIR001
     C*********************SUB  UINOT     LDBLN                     CIR001CCB002
     C*********************SUB  UINOT     CLBLN                     CIR001CCB002
     C                     Z-SUBUINOT     #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM UCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM UCCY      W0CCY            O:Currency     CCB002
     C                     PARM UACOD     W0ACOD           O:Account Code CCB002
     C                     PARM UACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '23'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 23 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C010
      *                                                                   CIR001
      **If not a nostro account then output posting details to RSACMTPD   CIR001
      *                                                                   CIR001
     C           WNOST     IFEQ 'N'                                       CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELUCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDVDAT      VUDT                            CIR001
     C                     Z-ADDUINOT     NETDSA                          CIR001
     C                     Z-ADD1         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *    ( Receive )                                                    CIR001
     C           TRET      IFEQ 'Y'                                       CIR001
     C           TINOT     ANDNE0                                         CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C*********************Z-ADDTRRNM     RRNM                      CIR001CCB002
     C                     MOVE RSETM     DSETM                           CIR001
     C**********           Z-ADDCNUM      DCNUM                                        CIR001 CSD027
     C                     MOVE CNUM      DCNUM                                               CSD027
     C                     MOVE TCUCY     DDCCY                           CIR001
     C                     MOVE URACC     DBNKAC                          CIR001
     C*********************EXSR MEMCHN                              CIR001CCB002
      *                                                                   CEU003
      **   Convert TINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     Z-ADDTINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    TINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Update PF/MEMOS file                                           CIR001
     C*********************ADD  TINOT     LDBLN                     CIR001CCB002
     C*********************ADD  TINOT     CLBLN                     CIR001CCB002
     C                     Z-ADDTINOT     #PAMT                           CCB002
     C*********************UPDATMEMOSMDF                            CIR001CCB002
      *                                                                   CCB002
      ** Call access object AOMEMSU0 to update the MEMOS file             CCB002
      *                                                                   CCB002
     C                     CALL 'AOMEMSU0'                                CCB002
     C                     PARM *BLANKS   W0RTCD           I:Return code  CCB002
     C                     PARM *ZEROS    W0ACNO           O:Retail A/C NoCCB002
     C                     PARM UCNUM     W0CNUM           O:Customer No. CCB002
     C                     PARM UCCY      W0CCY            O:Currency     CCB002
     C                     PARM UACOD     W0ACOD           O:Account Code CCB002
     C                     PARM UACSQ     W0ACSQ           O:Account Seq. CCB002
     C                     PARM BRCA      W0BRCA           O:Branch       CCB002
     C                     PARM PTDT      W0PSTD           O:Posting date CCB002
     C                     PARM VUDT      W0VDAT           O:Value date   CCB002
     C                     PARM #PAMT     W0AMT            O:Movement amt CCB002
     C                     PARM 'N'       W0FTOV           O:FT override  CCB002
      *                                                                   CCB002
     C           W0RTCD    IFNE *BLANKS                                   CCB002
     C                     MOVE '24'      DBASE            *************  CCB002
     C                     MOVEL'AOMEMSU0'DBFILE           * DB ERR 24 *  CCB002
     C                     MOVELERRKEY    DBKEY            *************  CCB002
     C                     EXSR *PSSR                                     CCB002
     C                     ENDIF                                          CCB002
     C/COPY WNCPYSRC,DL1922C011
      *                                                                   CIR001
      **If not a nostro account then output posting details to RSACMTPD   CIR001
      *                                                                   CIR001
     C           WNOST     IFEQ 'N'                                       CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELTCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDVDAT      VUDT                            CIR001
     C                     Z-ADDTINOT     NETDSA                          CIR001
     C                     Z-ADD0         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
     C           MIREND    TAG                             ** MIREND TAG *CIR001
      *                                                                   CIR001
      ** Restore saved values for PRONO update.                        ES CIR001
      *                                                                   CIR001
     C                     Z-ADD@UINOT    UINOT                           CIR001
     C                     Z-ADD@TINOT    TINOT                           CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      ********************************************************************CIR001
      /TITLE OLPIRS SUBROUTINE                                            CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  OLPIRS SR.    To update PF/OLPOS on line positions file      *   CIR001
      *                for an amended deal                            *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           OLPIRS    BEGSR                           *** OLPIRS ****CIR001
      *                                                                   CIR001
      **   SAVE NEW VALUES OF NET TOTALS                                  CIR001
     C                     Z-ADDUINOT     @UINOT 130                      CIR001
     C                     Z-ADDTINOT     @TINOT 130                      CIR001
      *                                                                   CIR001
      **   Determine whether PF/OLPOS requires updating                   CIR001
      *                                                                   CIR001
      **   Since PF/DEALSDG has been updated, the current                 CIR001
      **   file field values are the 'new' versions (the '@_____' fields) CIR001
      **   and the 'old' values from the file at beginning of             CIR001
      **   the programme are in the '#_____' fields.                      CIR001
      *                                                                   CIR001
      **   Set Date on PF/OLPOSOA to be amended ( 'P' )                   CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1'(ie. *IN55 or 56 = '1') and rate     CIR001
      ** has been previously set.                                         CIR001
      ** Otherwise no Olpos reversal is required.                         CIR001
      *                                                                   CIR001
      **   Access Olpos record                                            CIR001
      *                                                                   CIR001
     C                     EXSR OLPCHN                                    CIR001
      *                                                                   CIR001
      **   Only process Details if a record is found                      CIR001
      **   ( Otherwise End )                                              CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
      *    Release PF/OLPOSOA record if record found, but not live        CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELOL                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'N'       UOLP    1                       CIR001
     C                     GOTO OTHEIR                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       UOLP                            CIR001
     C                     EXCPTRELOL                                     CIR001
      *                                                                   CIR001
      **   Net Settlement Amounts are applied to the on line position     CIR001
      **   balance whose occurrence is the greatest of the 16 dates       CIR001
      **   which is less than, or equal to, the event date                CIR001
      *    NB..                                                           CIR001
      **   If event is earlier than the first of the 16th dates,          CIR001
      **      use the first date                                          CIR001
      **   If event is on or after the 16th date,                         CIR001
      **      use the 16th date ( Catchall )                              CIR001
      *                                                                   CIR001
     C                     Z-ADD1         P       20                      CIR001
      *                                                                   CIR001
     C           UEDAT     IFGT ODAT,1                                    CIR001
      *                                                                   CIR001
     C           UEDAT     IFGE ODAT,16                                   CIR001
     C                     Z-ADD16        P                               CIR001
     C                     ELSE                                           CIR001
     C           UEDAT     LOKUPODAT,P                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           UBRTE     ANDGT0                                         CIR001
     C           *IN55     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      *                             ( *IN74 ON = PAY )                    CIR001
      *    ( PAY )                                                        CIR001
     C                     SETON                     74                   CIR001
      *                                                                   CIR001
      **   Calculate Net Accrued Interest Adjustments Not Posted          CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates ( Set as positive )           CIR001
      *                                                                   CIR001
     C                     Z-ADD#UEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDUNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF THE DEAL IS TAX PAYABLE CALCULATE THE TAX ON THE INTEREST    CIR001
     C**  DUE                                                             CIR001
     C*                                                                   CIR001
     C           TAXI      IFEQ 'Y'                                       CIR001
     C           BNHKTR    ANDNE0                                         CIR001
     C           INTD      MULT BNHKTR    ZTAXC     H                     CIR001
     C           ZTAXC     DIV  100       TAXC                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  CALCULATE THE INTEREST NET OF TAX(OUR INTEREST AMOUNT)          CIR001
     C*                                                                   CIR001
     C           INTD      SUB  TAXC      UINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
     C           OTHEIR    TAG                             ** OTHEIR TAG *CIR001
      *                                                                   CIR001
      **   Access Olpos record                                            CIR001
      *                                                                   CIR001
     C                     EXSR OLPTHR                                    CIR001
      *                                                                   CIR001
      **   Only process Details if a record is found                      CIR001
      **   ( Otherwise End )                                              CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
      *    Release PF/OLPOSOA record if record found, but not live        CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELOL                                     CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'N'       TOLP    1                       CIR001
     C                     GOTO OSET                           >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE 'Y'       TOLP                            CIR001
     C                     EXCPTRELOL                                     CIR001
      *                                                                   CIR001
      **   ( Fixed side has Base rate type EQ 0,                          CIR001
      **   Rate/Spread is the Effective Interest Rate)                    CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.   CIR001
      ** Otherwise no OLPOS reversal is required.                         CIR001
      *                                                                   CIR001
      **   Net Settlement Amounts are applied to the on line position     CIR001
      **   balance whose occurrence is the greatest of the 16 dates       CIR001
      **   which is less than, or equal to, the event date                CIR001
      *    NB..                                                           CIR001
      **   If event is earlier than the first of the 16th dates,          CIR001
      **      use the first date                                          CIR001
      **   If event is on or after the 16th date,                         CIR001
      **      use the 16th date ( Catchall )                              CIR001
      *                                                                   CIR001
     C                     Z-ADD1         R       20                      CIR001
      *                                                                   CIR001
     C           UEDAT     IFGT ODAT,1                                    CIR001
      *                                                                   CIR001
     C           UEDAT     IFGE ODAT,16                                   CIR001
     C                     Z-ADD16        R                               CIR001
     C                     ELSE                                           CIR001
     C           UEDAT     LOKUPODAT,R                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           TBRTE     ANDGT0                                         CIR001
     C           *IN56     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      *                             ( *IN74 ON = PAY )                    CIR001
      *    ( RECEIVE )                                                    CIR001
     C                     SETOF                     74                   CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates                               CIR001
      *                                                                   CIR001
     C                     Z-ADD#TEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDTNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  NO END INTEREST BECAUSE INTEREST UP FRONT                       CIR001
     C**  INTEREST IS RECEIVABLE THEREFORE NO TAX                         CIR001
     C*                                                                   CIR001
     C                     Z-ADDINTD      TINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Access PF/OLPOS record                                         CIR001
      *                                                                   CIR001
     C           OSET      TAG                             ** OSET   TAG *CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Shadow Balances                                         CIR001
      *                                                                   CIR001
      *    ( Pay )                                                        CIR001
     C           UOLP      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     EXSR OLPCHN                                    CIR001
      *                                                                   CIR001
      **   Update PF/OLPOS file                                           CIR001
     C                     SUB  UINOT     OBLO,P                          CIR001
     C                     UPDATOLPOSOAF                                  CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *    ( Receive )                                                    CIR001
     C           TOLP      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     EXSR OLPTHR                                    CIR001
      *                                                                   CIR001
      **   Update PF/MEMOS file                                           CIR001
     C                     SUB  TINOT     OBLI,R                          CIR001
     C                     UPDATOLPOSOAF                                  CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           OLANEW    TAG                             ** OLANEW TAG *CIR001
      *                                                                   CIR001
      **   New deal details (the '@_____' fields)                         CIR001
      **                                                                  CIR001
      **   RESTORE SAVED VALUES AND UPDATE MEMOS BALANCES WITH NEW VALUES CIR001
      **                                                                  CIR001
     C                     Z-ADD@UINOT    UINOT                           CIR001
     C                     Z-ADD@TINOT    TINOT                           CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Shadow Balances                                         CIR001
      *                                                                   CIR001
      *    ( Pay )                                                        CIR001
     C           URET      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     EXSR OLPCHN                                    CIR001
      *                                                                   CIR001
      **   Update PF/OLPOS file                                           CIR001
     C                     ADD  UINOT     OBLO,P                          CIR001
     C                     UPDATOLPOSOAF                                  CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *    ( Receive )                                                    CIR001
     C           TRET      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     MOVE RSETM     DSETM                           CIR001
      **   Update PF/MEMOS file                                           CIR001
     C*********************ADD  TINOT     LDBLN                     CIR001CCB002
     C*********************ADD  TINOT     CLBLN                     CIR001CCB002
      *                                                                   CIR001
     C                     EXSR OLPTHR                                    CIR001
      *                                                                   CIR001
      **   Update PF/OLPOS file                                           CIR001
     C                     ADD  UINOT     OBLI,R                          CIR001
     C                     UPDATOLPOSOAF                                  CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
     C           OIREND    TAG                             ** OIREND TAG *CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      ********************************************************************CIR001
      /SPACE 3                                                            CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  OLPTHR SR.    To access PF/OLPOS record                      *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           OLPTHR    BEGSR                           *** OLPTHR ****CIR001
      *                                                                   CIR001
     C                     MOVE TCUCY     OLCCY                           CIR001
     C                     MOVE '02'      OLPNO                           CIR001
      *                                                                   CIR001
     C           OLKEY     CHAINOLPOS                86                   CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      ********************************************************************CIR001
      /TITLE PROIRS SUBROUTINE                                            CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  PROIRS SR.    To update PF/PRONO projected nostros file      *   CIR001
      *                for an amended deal                            *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           PROIRS    BEGSR                           *** PROIRS ****CIR001
      *                                                                   CIR001
      **   SAVE NEW VALUES OF NET TOTALS                                  CIR001
     C                     Z-ADDUINOT     @UINOT 130                      CIR001
     C                     Z-ADDTINOT     @TINOT 130                      CIR001
      *                                                                   CIR001
      ** Initialise fields used for reversal.                             CIR001
      *                                                                   CIR001
     C                     Z-ADD0         UINOT                           CIR001
     C                     Z-ADD0         TINOT                           CIR001
     C                     MOVE *BLANKS   SETL                            CIR001
      *                                                                   CIR001
      **   Determine whether PF/PRONO requires updating                   CIR001
      *                                                                   CIR001
      **   Since PF/DEALSDG has been updated, the current                 CIR001
      **   file field values are the 'new' versions (the '@_____' fields) CIR001
      **   and the 'old' values from the file at beginning of             CIR001
      **   the programme are in the '#_____' fields.                      CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.   CIR001
      ** Otherwise no PRONO reversal is required.                         CIR001
      *                                                                   CIR001
      **   Access Prono record                                            CIR001
      *                                                                   CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      PRCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     PRCCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     MOVELUPACC     PRNNO                           CIR001
      *                                                                   CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
      **   Only process Details if a record is found                      CIR001
      **   ( Otherwise process New details )                              CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
      *    Release PF/PRONOPN record if record found, but not live        CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELPR                                     CIR001
     C                     MOVE 'N'       UPRO    1                       CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     GOTO PROTHR                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      **                                                                  CIR001
     C                     MOVE 'Y'       UPRO                            CIR001
     C                     EXCPTRELPR                                     CIR001
      **                                                                  CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           UBRTE     ANDGT0                                         CIR001
     C           *IN55     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
      *                             ( *IN74 ON = PAY )                    CIR001
      *    ( PAY )                                                        CIR001
     C                     SETON                     74                   CIR001
      *                                                                   CIR001
      **   Only process details if settled through nostro                 CIR001
      **   ( Otherwise process New details )                              CIR001
      *                                                                   CIR001
     C           PSETM     IFNE 01                                        CIR001
     C           PSETM     ANDNE02                                        CIR001
     C           PSETM     ANDNE07                                        CIR001
     C           PSETM     ANDNE08                                        CIR001
     C           PSETM     ANDNE12                                        CIR001
     C                     GOTO PROTHR                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   If Event Date is beyond Range End Date for nostro, release     CIR001
      **   record, then no further processing for original file details   CIR001
      **   Otherwise, calculate discuounted amount & update record.       CIR001
      *                                                                   CIR001
      **   NB Range End Date is up to the 6th working day                 CIR001
     C           PDAT,5    ADD  1         ZDAYNO                          CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE UCUCY     ZCCY                            CIR001
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      *                                                                   CIR001
      * Set up nostro location code (ZLOC) for input to ZFWDT.SR          CIR001
      *                                                                   CIR001
      * Move nostro no. into 2A work field for call to access prog.       CIR001
     C                     MOVELWACC      WRK2    2                       CIR001
      *                                                                   CIR001
      * Set up work field containing file key, in case of db error        CIR001
     C***********          MOVELUCUCY     WRK5    5                CIR001 CEU003
     C                     MOVELZCCY      WRK5    5                       CEU003
     C                     MOVE WRK2      WRK5                            CIR001
      *                                                                   CIR001
      * If nostro no. blanks, set ZLOC to blanks, otherwise call          CIR001
      * access program to get nostro location                             CIR001
     C           WRK2      IFEQ *BLANKS                                   CIR001
     C                     MOVE *BLANKS   ZLOC                            CIR001
     C                     ELSE                                           CIR001
     C                     CALL 'AONOSTR0'                                CIR001
     C                     PARM '*MSG   ' @RTCD                           CIR001
     C                     PARM '*KEY   ' @OPTN                           CIR001
     C                     PARM *BLANK    @CUST   6        Customer No.   CIR001
     C***********          PARM UCUCY     @CCY    3        CurrencyCIR001 CEU003
     C                     PARM ZCCY      @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    CIR001 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        CIR001
     C                     PARM WRK2      @NOST   2        Nostro No.     CIR001
     C                     PARM *BLANKS   @BRCD   3        Branch Code    CIR001
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameCIR001
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndCIR001
     C           SDNOST    PARM SDNOST    DSFDY                           CIR001
     C*                                                                   CIR001
     C           @RTCD     IFNE *BLANKS                                   CIR001
     C                     MOVE '026'     DBASE                           CIR001
     C                     MOVE 'SDNOSTPD'DBFILE             *************CIR001
     C                     MOVE WRK5      DBKEY              *  DBERROR  *CIR001
     C                     EXSR *PSSR                        *    26     *CIR001
     C                     ELSE                              *************CIR001
     C                     MOVE A7NOSN    ZLOC                            CIR001
      * (Last 3 chars. of customer shortname contains nostro loc.)        CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      * Check that value of ZDAYNO is a working day, if not get           CIR001
      * the next working day after this date                              CIR001
     C                     Z-ADD0         ZNRDYS  20                      CIR001
     C                     EXSR ZFWDT                                     CIR001
      *                                                                   CIR001
     C           VDAT      IFGE ZDYNBR                                    CIR001
      *                                                                   CIR001
     C                     GOTO PROSET                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Calculate Net Accrued Interest Adjustments Not Posted          CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates ( Set as positive )           CIR001
      *                                                                   CIR001
     C                     Z-ADD#UEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDUNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  IF THE DEAL IS TAX PAYABLE CALCULATE THE TAX ON THE INTEREST    CIR001
     C**  DUE                                                             CIR001
     C*                                                                   CIR001
     C           TAXI      IFEQ 'Y'                                       CIR001
     C           BNHKTR    ANDNE0                                         CIR001
     C           INTD      MULT BNHKTR    ZTAXC     H                     CIR001
     C           ZTAXC     DIV  100       TAXC                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  CALCULATE THE INTEREST NET OF TAX(OUR INTEREST AMOUNT)          CIR001
     C*                                                                   CIR001
     C           INTD      SUB  TAXC      UINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
     C           PROTHR    TAG                             ** PROTHR TAG *CIR001
      *                                                                   CIR001
      **   Access Prono record                                            CIR001
      *                                                                   CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      PRCCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVE TCUCY     PRCCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     MOVELURACC     PRNNO                           CIR001
      *                                                                   CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
      **   Only process Details if a record is found                      CIR001
      **   ( Otherwise process New details )                              CIR001
      *                                                                   CIR001
     C           *IN86     IFEQ '1'                                       CIR001
     C           RECI      ORNE 'D'                                       CIR001
      *    Release PF/PRONOPN record if record found, but not live        CIR001
     C           *IN86     IFEQ '0'                                       CIR001
     C                     EXCPTRELPR                                     CIR001
     C                     MOVE 'N'       TPRO    1                       CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     GOTO PROSET                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      **                                                                  CIR001
     C                     MOVE 'Y'       TPRO                            CIR001
     C                     EXCPTRELPR                                     CIR001
      *                                                                   CIR001
      ** Process if programme is being re-run, the base rate code is not  CIR001
      ** zero and bit '0' UDNSI = '1' and rate has been previously set.   CIR001
      ** Otherwise no Memos reversal is required.                         CIR001
      *                                                                   CIR001
     C           RERUN     IFEQ 'Y'                                       CIR001
     C           TBRTE     ANDGT0                                         CIR001
     C           *IN56     ANDEQ'1'                                       CIR001
     C           @PRVST    ANDEQ'Y'                                       CIR001
      *                                                                   CIR001
      **   Old ( pre-rerun file) deal details  (the '#_____' fields)      CIR001
      *                                                                   CIR001
      *                             ( *IN74 ON = PAY )                    CIR001
      *    ( RECEIVE )                                                    CIR001
     C                     SETOF                     74                   CIR001
      *                                                                   CIR001
      **   Only process details if settled through nostro                 CIR001
      **   ( Otherwise process New details )                              CIR001
      *                                                                   CIR001
     C           RSETM     IFNE 01                                        CIR001
     C           RSETM     ANDNE02                                        CIR001
     C           RSETM     ANDNE07                                        CIR001
     C           RSETM     ANDNE08                                        CIR001
     C           RSETM     ANDNE12                                        CIR001
     C                     GOTO PROSET                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      **   If Event Date is beyond Range End Date for nostro, release     CIR001
      **   record, then no further processing for original file details   CIR001
      **   Otherwise, calculate discuounted amount & update record.       CIR001
      *                                                                   CIR001
      **   NB Range End Date is up to the 6th working day                 CIR001
     C           PDAT,5    ADD  1         ZDAYNO                          CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      ZCCY                            CEU003
     C                     ELSE                                           CEU003
     C                     MOVE TCUCY     ZCCY                            CIR001
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      * Set up nostro location code (ZLOC) for input to ZFWDT.SR          CIR001
      *                                                                   CIR001
      * Move nostro no. into 2A work field for call to access prog.       CIR001
     C                     MOVELWACC      WRK2                            CIR001
      *                                                                   CIR001
      * If the nostro no. from last call to AONOSTR0 is same as           CIR001
      * value in WRK2, no need for another call to access program         CIR001
      * since currency key is the same as well, therefore use             CIR001
      * same value of ZLOC                                                CIR001
     C           WRK2      IFNE A7NONB                                    CIR001
     C           ZCCY      ORNE A7CYCD                                    CEU003
      *                                                                   CIR001
      * Set up work field containing file key, in case of db error        CIR001
     C***********          MOVELUCUCY     WRK5                     CIR001 CEU003
     C                     MOVELZCCY      WRK5                            CEU003
     C                     MOVE WRK2      WRK5                            CIR001
      *                                                                   CIR001
      * If nostro no. blanks, set ZLOC to blanks, otherwise call          CIR001
      * access program to get nostro location                             CIR001
     C           WRK2      IFEQ *BLANKS                                   CIR001
     C                     MOVE *BLANKS   ZLOC                            CIR001
     C                     ELSE                                           CIR001
     C                     CALL 'AONOSTR0'                                CIR001
     C                     PARM '*MSG   ' @RTCD                           CIR001
     C                     PARM '*KEY   ' @OPTN                           CIR001
     C                     PARM *BLANK    @CUST   6        Customer No.   CIR001
     C***********          PARM UCUCY     @CCY    3        CurrencyCIR001 CEU003
     C                     PARM ZCCY      @CCY    3        Currency       CEU003
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    CIR001 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        CIR001
     C                     PARM WRK2      @NOST   2        Nostro No.     CIR001
     C                     PARM *BLANKS   @BRCD   3        Branch Code    CIR001
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameCIR001
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndCIR001
     C           SDNOST    PARM SDNOST    DSFDY                           CIR001
     C*                                                                   CIR001
     C           @RTCD     IFNE *BLANKS                                   CIR001
     C                     MOVE '027'     DBASE                           CIR001
     C                     MOVE 'SDNOSTPD'DBFILE             *************CIR001
     C                     MOVE WRK5      DBKEY              *  DBERROR  *CIR001
     C                     EXSR *PSSR                        *    27     *CIR001
     C                     ELSE                              *************CIR001
     C                     MOVE A7NOSN    ZLOC                            CIR001
      * (Last 3 chars. of customer shortname contains nostro loc.)        CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      * Check that value of ZDAYNO is a working day, if not get           CIR001
      * the next working day after this date                              CIR001
     C                     Z-ADD0         ZNRDYS  20                      CIR001
     C                     EXSR ZFWDT                                     CIR001
      *                                                                   CIR001
     C           VDAT      IFGE ZDYNBR                                    CIR001
      *                                                                   CIR001
     C                     GOTO PROSET                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Set Value of Work Interest Rates                               CIR001
      *                                                                   CIR001
     C                     Z-ADD#TEINR    SZINR                           CIR001
      *                                                                   CIR001
     C*                                                                   CIR001
     C           SZINPM    IFEQ 'D'                                       CIR001
     C           SZINPM    OREQ 'Y'                                       CIR001
     C*                                                                   CIR001
     C                     Z-ADDTNEDT     SZEDAT                          CIR001
     C                     EXSR CALIUF                                    CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C**  NO END INTEREST BECAUSE INTEREST UP FRONT                       CIR001
     C**  INTEREST IS RECEIVABLE THEREFORE NO TAX                         CIR001
     C*                                                                   CIR001
     C                     Z-ADDINTD      TINOT                           CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
     C           PROSET    TAG                             ** PROSET TAG *CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C           TINOT     IFGE UINOT                                     CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Projected Nostro balances                               CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Net Discounted Amounts are applied to the projected nostro     CIR001
      **   balances whose occurrence matches the projected nostro dates   CIR001
      **   which are GE the Event Date.                                   CIR001
      *                                                                   CIR001
      *    NB..                                                           CIR001
      **   If event is earlier than the first of the 5 dates,             CIR001
      **      use from the first date                                     CIR001
      **   If event is after the 5th date, but before the 6th             CIR001
      **      use the 5th date                                            CIR001
      **   ( NB  Dates GE 6th date excluded in above validation )         CIR001
      *                                                                   CIR001
      *    ( Pay )                                                        CIR001
     C           UPRO      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     MOVE UCUCY     PRCCY                           CIR001
     C                     MOVELUPACC     PRNNO                           CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X       10                      CIR001
      *                                                                   CIR001
     C           UEDAT     IFGT PDAT,1                                    CIR001
      *                                                                   CIR001
     C           UEDAT     IFGE PDAT,5                                    CIR001
     C                     Z-ADD5         X                               CIR001
     C                     ELSE                                           CIR001
     C           UEDAT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
      **   Convert UINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     Z-ADDUINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    UINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Adjust Balances for Entries X to 5                             CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
      **   Update PF/PRONO file                                           CIR001
     C                     ADD  UINOT     PBAL,X                          CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C*                                                                   CIR001
     C* Output posting details to RSACMTPD                                CIR001
     C*                                                                   CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELUCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     MOVEL'Y'       WNOST                           CIR001
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDUEDAT     VUDT                            CIR001
     C                     Z-ADDUINOT     NETDSA                          CIR001
     C                     Z-ADD0         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *    ( Receive )                                                    CIR001
     C           TPRO      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     MOVE TCUCY     PRCCY                           CIR001
     C                     MOVELURACC     PRNNO                           CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X       10                      CIR001
      *                                                                   CIR001
     C           TEDAT     IFGT PDAT,1                                    CIR001
      *                                                                   CIR001
     C           TEDAT     IFGE PDAT,5                                    CIR001
     C                     Z-ADD5         X                               CIR001
     C                     ELSE                                           CIR001
     C           TEDAT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
      **   Convert TINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     Z-ADDTINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    TINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Adjust Balances for Entries X to 5                             CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
      **   Update PF/PRONO file                                           CIR001
     C                     SUB  TINOT     PBAL,X                          CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C*                                                                   CIR001
     C* Output posting details to RSACMTPD                                CIR001
     C*                                                                   CIR001
     C                     MOVEL'Y'       WNOST                           CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELTCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDTEDAT     VUDT                            CIR001
     C                     Z-ADDTINOT     NETDSA                          CIR001
     C                     Z-ADD1         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           PIRNEW    TAG                             ** PIRNEW TAG *CIR001
      *                                                                   CIR001
      **   New deal details (the '@_____' fields)                         CIR001
      **                                                                  CIR001
      **   RESTORE SAVED VALUES AND UPDATE MEMOS BALANCES WITH NEW VALUES CIR001
      **                                                                  CIR001
     C                     Z-ADD@UINOT    UINOT                           CIR001
     C                     Z-ADD@TINOT    TINOT                           CIR001
     C*                                                                   CIR001
     C**  FOR RS DEALS DETERMINE IF MATCHED, IF SO, CALCULATE THE NET     CIR001
     C**  AMOUNT (PAYMENT AMOUNT)                                         CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                                      CIR001
     C           UEDAT     ANDEQTEDAT                                     CIR001
     C*                                                                   CIR001
     C**  OUR NET INT GT. THEIR NET INT - PAY SETTLEMENT                  CIR001
     C*                                                                   CIR001
     C           UINOT     IFGE TINOT                                     CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C           UINOT     SUB  TINOT     UINOT                           CIR001
     C                     ELSE                                           CIR001
     C*                                                                   CIR001
     C**  THEIR NET INT GT. OUR NET INT - RECEIVE SETTLEMENT              CIR001
     C*                                                                   CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C           TINOT     SUB  UINOT     TINOT                           CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C*                                                                   CIR001
     C*  UNMATCHED 'RS' OR ANY 'RX'                                       CIR001
     C*                                                                   CIR001
     C           DTYP      IFEQ 'RS'                          RS          CIR001
     C           UEDAT     ANDNETEDAT                          NOT MATCH. CIR001
     C           DTYP      OREQ 'RX'                          RX          CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C                     MOVE 'P'       SETL                            CIR001
     C                     END                                            CIR001
     C           TINOT     IFNE 0                                         CIR001
     C                     MOVE 'R'       SETL                            CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           UINOT     IFNE 0                                         CIR001
     C           TINOT     ANDNE0                                         CIR001
     C                     MOVE 'B'       SETL                 BOTH       CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Adjust Projected Nostro balances                               CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Net Discounted Amounts are applied to the projected nostro     CIR001
      **   balances whose occurrence matches the projected nostro dates   CIR001
      **   which are GE the Event Date.                                   CIR001
      *                                                                   CIR001
      *    NB..                                                           CIR001
      **   If event is earlier than the first of the 5 dates,             CIR001
      **      use from the first date                                     CIR001
      **   If event is after the 5th date, but before the 6th             CIR001
      **      use the 5th date                                            CIR001
      **   ( NB  Dates GE 6th date excluded in above validation )         CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Only process details if settled through nostro                 CIR001
      **   ( Otherwise process Their details )                            CIR001
      *                                                                   CIR001
     C           PSETM     IFNE 01                                        CIR001
     C           PSETM     ANDNE02                                        CIR001
     C           PSETM     ANDNE07                                        CIR001
     C           PSETM     ANDNE08                                        CIR001
     C           PSETM     ANDNE12                                        CIR001
     C                     GOTO PRONOR                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *    ( Pay )                                                        CIR001
     C           UPRO      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'P'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     MOVE UCUCY     PRCCY                           CIR001
     C                     MOVELUPACC     PRNNO                           CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X       10                      CIR001
      *                                                                   CIR001
     C           UEDAT     IFGT PDAT,1                                    CIR001
      *                                                                   CIR001
     C           UEDAT     IFGE PDAT,5                                    CIR001
     C                     Z-ADD5         X                               CIR001
     C                     ELSE                                           CIR001
     C           UEDAT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
      **   Convert UINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE UCUCY     P@FRCY                          CEU003
     C                     MOVE PSCY      P@TOCY                          CEU003
     C                     Z-ADDUINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    UINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Adjust Balances for Entries X to 5                             CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
      **   Update PF/PRONO file                                           CIR001
     C                     SUB  UINOT     PBAL,X                          CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C*                                                                   CIR001
     C* Output posting details to RSACMTPD                                CIR001
     C*                                                                   CIR001
     C                     MOVEL'Y'       WNOST                           CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           PSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE PSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELUCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDUEDAT     VUDT                            CIR001
     C                     Z-ADDUINOT     NETDSA                          CIR001
     C                     Z-ADD1         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
      **   Only process details if settled through nostro                 CIR001
      **   ( Otherwise End )                                              CIR001
      *                                                                   CIR001
     C           PRONOR    TAG                                            CIR001
      *                                                                   CIR001
     C           RSETM     IFNE 01                                        CIR001
     C           RSETM     ANDNE02                                        CIR001
     C           RSETM     ANDNE07                                        CIR001
     C           RSETM     ANDNE08                                        CIR001
     C           RSETM     ANDNE12                                        CIR001
     C                     GOTO PROEND                         >>>>>>>>>> CIR001
     C                     END                                            CIR001
      *    ( Receive )                                                    CIR001
     C           TPRO      IFEQ 'Y'                                       CIR001
     C           SETL      IFEQ 'R'                                       CIR001
     C           SETL      OREQ 'B'                                       CIR001
      *                                                                   CIR001
     C                     MOVE TCUCY     PRCCY                           CIR001
     C                     MOVELURACC     PRNNO                           CIR001
     C                     EXSR PROCHN                                    CIR001
      *                                                                   CIR001
     C                     Z-ADD1         X       10                      CIR001
      *                                                                   CIR001
     C           TEDAT     IFGT PDAT,1                                    CIR001
      *                                                                   CIR001
     C           TEDAT     IFGE PDAT,5                                    CIR001
     C                     Z-ADD5         X                               CIR001
     C                     ELSE                                           CIR001
     C           TEDAT     LOKUPPDAT,X                 8585               CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CEU003
      **   Convert TINOT to settlement currency if required               CEU003
      *                                                                   CEU003
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE TCUCY     P@FRCY                          CEU003
     C                     MOVE RSCY      P@TOCY                          CEU003
     C                     Z-ADDTINOT     P@FRAM           TRANS AMT      CEU003
      *                                                                   CEU003
     C                     EXSR EUCONV                                    CEU003
      *                                                                   CEU003
     C                     Z-ADDP@OUTA    TINOT                           CEU003
      *                                                                   CEU003
     C                     ENDIF                                          CEU003
      *                                                                   CIR001
      **   Adjust Balances for Entries X to 5                             CIR001
      *                                                                   CIR001
     C           X         DOWLE5                                         CIR001
      *                                                                   CIR001
      **   Update PF/PRONO file                                           CIR001
     C                     ADD  TINOT     PBAL,X                          CIR001
     C                     ADD  1         X                               CIR001
     C                     END                                            CIR001
     C                     UPDATPRONOPNF                                  CIR001
     C*                                                                   CIR001
     C* Output posting details to RSACMTPD                                CIR001
     C*                                                                   CIR001
     C                     MOVEL'Y'       WNOST                           CIR001
     C           CEU003    IFEQ 'Y'                                       CEU003
     C           RSCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE RSCY      ##CCY                           CEU003
     C                     ELSE                                           CEU003
     C                     MOVELTCUCY     ##CCY                           CIR001
     C                     ENDIF                                          CEU003
     C                     Z-ADDBJRDNB    PTDT                            CIR001
     C                     Z-ADDTEDAT     VUDT                            CIR001
     C                     Z-ADDTINOT     NETDSA                          CIR001
     C                     Z-ADD0         DORC                            CIR001
      *                                                                                       CAP205
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       W#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     EXSR OPSIRS                                    CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C           PROEND    TAG                             ** PROEND TAG *CIR001
      *                                                                   CIR001
      ** Restore saved values for OLPOS update.                        ES CIR001
      *                                                                   CIR001
     C                     Z-ADD@UINOT    UINOT                           CIR001
     C                     Z-ADD@TINOT    TINOT                           CIR001
      *                                                                   CIR001
     C                     ENDSR                                          CIR001
      ********************************************************************CIR001
      /TITLE SUBROUTINE TO WRITE TO SHADOW POSTINGS FILE                  CIR001
      *****************************************************************   CIR001
      *                                                               *   CIR001
      *  OPSIRS SR.    Output posting details to RSACMTPD.            *   CIR001
      *                                                               *   CIR001
      *****************************************************************   CIR001
      *                                                                   CIR001
     C           OPSIRS    BEGSR                           *** OPSIRS ****CIR001
      *                                                                   CIR001
      **   Only write a record if the amount is                           CIR001
      **   not zero                                                       CIR001
      *                                                                   CIR001
     C           NETDSA    IFNE *ZEROS                                    CIR001
     C*                                                                   CIR001
     C*    For settlement through a nostro;                               CIR001
     C*                                                                   CIR001
     C           WNOST     IFNE 'N'                                       CIR001
     C                     MOVELPRNNO     WRK2                            CIR001
     C*                                                                   CIR001
     C* Call Access Program to retrieve currency nostro record            CIR001
     C*                                                                   CIR001
     C                     CALL 'AONOSTR0'                                CIR001
     C                     PARM *BLANKS   @RTCD                           CIR001
     C                     PARM '*KEY   ' @OPTN                           CIR001
     C                     PARM *BLANK    @CUST   6        Customer No.   CIR001
     C                     PARM ##CCY     @CCY    3        Currency       CIR001
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    CIR001 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        CIR001
     C                     PARM WRK2      @NOST   2        Nostro No.     CIR001
     C                     PARM *BLANKS   @BRCD   3        Branch Code    CIR001
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameCIR001
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndCIR001
     C           SDNOST    PARM SDNOST    DSFDY                           CIR001
     C*                                                                   CIR001
     C           @RTCD     IFEQ *BLANKS                                   CIR001
     C*                                                                   CIR001
     C* Use fields from nostros file to shadow post                       CIR001
     C*                                                                   CIR001
     C                     MOVE A7CUST    CUSN                            CIR001
     C                     MOVE A7CYCD    CCYD                            CIR001
     C                     MOVE A7ACCD    ACDE                            CIR001
     C                     MOVE A7ACSN    ASNC                            CIR001
     C                     MOVE A7BRCD    BRCA                            CIR001
      *                                                                   CIR001
     C                     ELSE                                           CIR001
      *                                                                   CIR001
      *  Else initialise account keys of unallocated nostros.             CIR001
      *                                                                   CIR001
     C**********           Z-ADD*ZEROS    CUSN                                         CIR001 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C                     MOVEL##CCY     CCYD                            CIR001
     C                     Z-ADD*ZEROS    ACDE                            CIR001
     C                     Z-ADD*ZEROS    ASNC                            CIR001
     C                     MOVE *BLANKS   BRCA                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
     C                     MOVE DLNO      TNMR                            CIR001
     C                     MOVE DTYP      TRYP                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CRE009
      ** If CRE009 is ON and account is RE, set the posting date the      CRE009
      ** same as the value date when the latter is not less than the run  CRE009
      ** date.                                                            CRE009
     C           CRE009    IFEQ 'Y'                                       CRE009
      *                                                                   CRE009
     C                     MOVE CUSN      WCNUM                           CRE009
     C                     MOVE CCYD      WCCY                            CRE009
     C                     MOVE ACDE      WACOD                           CRE009
     C                     MOVE ASNC      WACSQ                           CRE009
     C                     MOVE BRCA      WWBRCA                          CRE009
     C           ACCKEY    CHAINACCNT                88                   CRE009
     C           *IN88     IFEQ *OFF                                      CRE009
     C           ATYP      ANDEQ'R'                                       CRE009
     C           VUDT      IFGE BJRDNB                                    CRE009
     C                     Z-ADDVUDT      PTDT                            CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
     C                     Z-ADDNETDSA    MVAM                            CIR001
      *                                                                   CIR001
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'DL'      CMOD                                                CAP205
     C                     ELSE                                                               CAP205
     C                     MOVEL*BLANKS   CMOD                                                CAP205
     C                     ENDIF                                                              CAP205
     C                     MOVELW#MTYP    MTYP                                                CAP205
      *                                                                                       CAP205
     C                     WRITERSACMTPO                                  CIR001
     C/COPY WNCPYSRC,DL1922C012
     C                     Z-ADD*ZEROS    MVAM                            CIR001
      *                                                                   CIR001
     C                     END                                            CIR001
      *                                                                   CIR001
      *                                                                   CIR001
     C           OPSEND    ENDSR                                          CIR001
      ********************************************************************CIR001
     C/COPY ZSRSRC,GLINTCZ1                                               CIR001
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZINTDYZ2                                               CIR001
     C/COPY ZSRSRC,ZDATE9Z3                                               CIR001
     C/COPY ZSRSRC,ZFEB29                                                                     CIR013
      /TITLE TSTRTL SUBROUTINE
      ***************************************************************
      * SET UP THE KEY FOR THE CHAIN TO THE FILE 'ACCNT',           *
      * GET RECORD & IF FOUND,ACTIVE & RETAIL RETURN RRN            *
      * OF MEMO RECORD OTHERWISE RETURN RRN OF ZERO.                *
      *     FIELDS EXPECTED :-                                      *
      *                        DCNUM.....CUSTOMER NUMBER.           *
      *                        DDCCY.....DEAL CURRENCY.             *
      *                        DBNKAC....BANK A/C NUMBER.           *
      *                        DSETM.....SETTLEMENT TYPE.           *
      *                        WWBRCA....BRANCH CODE (ACCKEY)       *     S01117
      *                                                             *
      ***************************************************************
      *
     C           TSTRTL    BEGSR
      *
      ** SET ROUTINE FIELDS
      *
     C**********           Z-ADDDCNUM     DCNUM   60                                          CSD027
     C                     MOVE DCNUM     DCNUM   6                                           CSD027
     C                     MOVE DDCCY     DDCCY   3
      *
     C********** MBIN      IFNE 'Y'                                       S01194
     C                     MOVE '01'      DACSQ   2
     C**********           ELSE                                           S01194
      ***Set*up*Key*and*chain*to*Table*File**(PF/TABLETR)*******          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'10'      ZTABKY                          S01194
     C**********           MOVE BRCD      ZTABKY                          S01194
     C********** ZTABKY    CHAINTABDLEI              81                   S01194
      ***If*a*live*record*is*not*found******                              S01194
     C********** *IN81     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '08'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      08     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
     C**********           MOVE NSACS     DACSQ                           S01194
     C**********           END                                            S01194
      *
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'Y'       WRETL   1                       CCB002
     C*                                                                   E21549
     C* Initialise shadow postings work indicator                         E21549
     C*                                                                   E21549
     C                     MOVE 'N'       WNOST   1                       E21549
      *
      ** SETTLEMENT TYPES 01 02 07 08 & 12
      *
     C           DSETM     IFEQ '01'
     C           DSETM     OREQ '02'
     C           DSETM     OREQ '07'
     C           DSETM     OREQ '08'
     C           DSETM     OREQ '12'
     C*                                                                   E21549
     C* Settlement method is via a nostro set                             E21549
     C*                                                                   E21549
     C                     MOVE 'Y'       WNOST                           E21549
      *
      ** NOT RETAIL, IF NO DATA ENTERED
     C**********           MOVE *BLANK    KEY                             S01194
     C                     MOVELDBNKAC    WRK2
     C           WRK2      IFNE '  '
      *
      ***GET*CURRENCY*NOSTRO*RECORD*FROM*'TABDLEI'*PF/TABLETL***          S01194
     C**********           MOVEL'70'      KEY                             S01194
     C                     MOVELDDCCY     WRK5                            S01194
     C                     MOVE WRK2      WRK5                            S01194
      *                                                                   S01194
      * (WRK5 used to set up LDA in event of db error)                    S01194
     C********** KEY       CHAINTABDLEI              85                   S01194
     C*                                                                   S01194
     C* Call access program to get currency nostro record                 S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM *BLANK    @CUST   6        Customer No.   S01194
     C                     PARM DDCCY     @CCY    3        Currency       S01194
     C**********           PARM *BLANKS   @ACCD   4        A/C Code                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2        A/C Seq        S01194
     C                     PARM WRK2      @NOST   2        Nostro No.     S01194
     C                     PARM *BLANKS   @BRCD   3        Branch Code    S01194
     C                     PARM *BLANKS   @CSSN  10        Cust. ShortnameS01194
     C                     PARM *BLANKS   @PNOI   1        Prime Nost. IndS01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01194
     C*                                                                   S01194
      ***IF*RECORD*NOT*FOUND*OR*NOT*ACTIVE*DATABASE*ERROR******           S01194
     C********** *IN85     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '09'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELKEY       DBKEY            *      09     *S01194
     C**********           EXSR DBERR                      ***************S01194
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'009'     DBASE            ***************S01194
     C                     MOVE 'SDNOSTPD'DBFILE           *   DBERROR   *S01194
     C                     MOVELWRK5      DBKEY            *      09     *S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
      *
      ***USE*FIELDS*FROM*TABLE*FILE*&*DEFAULT*CCY*TO*GET*ACCNT*RECORD**   S01194
      * Use fields from nostros file & default ccy to get ACCNT record    S01194
     C**********           MOVE CNUM      WCNUM                           S01194
     C                     MOVE A7CUST    WCNUM                           S01194
     C                     MOVE DDCCY     WCCY
     C**********           MOVE ACOD      WACOD                           S01194
     C                     MOVE A7ACCD    WACOD                           S01194
     C**********           MOVE ACSQ      WACSQ                           S01194
     C                     MOVE A7ACSN    WACSQ                           S01194
     C                     MOVE A7BRCD    WWBRCA                          065311
      *                                                                   S01117
      **Branch*key*(WWBRCA)*already*set*up*before*routine*called****S01117065311
     C           ACCKEY    CHAINACCNT                88
      *
      ** IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN88     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
      *
      ** MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C**********           MOVE '10'      DBASE                           S01194
     C                     MOVEL'010'     DBASE            ***************S01194
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      10     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
      *
      ** IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
      *
     C                     END                             END ERR 01
     C                     END                             END ERR 02
     C                     END                             CHECK IF RETAIL
     C                     END                             01/02/07/08/12
      *
      *
      ** SETTLEMENT TYPE 14
     C           DSETM     IFEQ '14'
     C                     MOVELDBNKAC    ACNO
     C           ACNO      CHAINACNUM                84
      *
      ** IF ACNUM RECORD FOUND AND NOT ACTIVE DATABASE ERROR
     C           *IN84     IFEQ '0'                        RECORD FOUND
     C           RECI      IFNE 'D'                        NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '11'      DBASE                           S01194
     C                     MOVEL'011'     DBASE            ***************S01194
     C                     MOVE 'ACNUM'   DBFILE           *   DBERROR   *
     C                     MOVELACNO      DBKEY            *      11     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
      *
      ** IF 'ACNUM' RECORD FOUND & ACTIVE USE DATA TO ACCESS 'ACCNT'
     C                     MOVE CNUM      WCNUM
     C                     MOVE CCY       WCCY
     C                     MOVE ACOD      WACOD
     C                     MOVE ACSQ      WACSQ
     C                     MOVE BRCA      WWBRCA                          095746
      *                                                                   S01117
      * Branch key (WWBRCA) already set up before routine called          S01117
     C           ACCKEY    CHAINACCNT                88
      *
      ** IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN88     IFEQ '1'                        NOT FOUND
     C           RECI      ORNE 'D'                        OR NOT ACTIVE
     C********** *LOCK     IN   LDA                                       S01194
      *
      ** MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C**********           MOVE '12'      DBASE                           S01194
     C                     MOVE '012'     DBASE            ***************S01194
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      12     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   E21549
     C**   Move account details to shadow post later                      E21549
     C*                                                                   E21549
     C                     MOVE DLNO      TNMR                            E21549
     C                     MOVE DTYP      TRYP                            E21549
     C**********           Z-ADDCNUM      CUSN                                         E21549 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            E21549
     C                     Z-ADDACOD      ACDE                            E21549
     C                     Z-ADDACSQ      ASNC                            E21549
     C*                                                                   E21549
      *
      ** IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
      *
     C                     END                             END ERR 29
     C                     END                             END ERR 28
     C                     ELSE                            X NO REC
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END                             END NO REC
     C                     END                             END 14
      *
      *
      ** SETTLEMENT TYPE 04
     C           DSETM     IFEQ '04'
     C                     MOVE DCNUM     WCNUM
     C                     MOVE DDCCY     WCCY
     C**********           MOVE CADC      WACOD                           S01194
     C                     MOVE BMACCD    WACOD                           S01194
     C                     MOVE DACSQ     WACSQ
      *                                                                   S01117
      * Branch key (WWBRCA) already set up before routine called          S01117
     C           ACCKEY    CHAINACCNT                88
      *
      ** IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN88     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '13'      DBASE                           S01194
     C                     MOVE '013'     DBASE            ***************S01194
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      13     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   E21549
     C**   Move account details to shadow post later                      E21549
     C*                                                                   E21549
     C                     MOVE DLNO      TNMR                            E21549
     C                     MOVE DTYP      TRYP                            E21549
     C**********           Z-ADDCNUM      CUSN                                         E21549 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            E21549
     C                     Z-ADDACOD      ACDE                            E21549
     C                     Z-ADDACSQ      ASNC                            E21549
     C*                                                                   E21549
      *
      ** IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
     C                     END
      *
     C                     END                             END 04
      *
      *
      ** SETTLEMENT TYPE 05
     C           DSETM     IFEQ '05'
      *
      ** USE BANK A/C SPLIT FIELDS TO ACCESS 'ACCNT'
     C**********           MOVE D16#21    WCNUM                           S01117
     C                     MOVE W@CNUM    WCNUM                           S01117
     C                     MOVE DDCCY     WCCY
     C**********           MOVE D22#25    WACOD                           S01117
     C                     MOVE W@ACOD    WACOD                           S01117
      *
      ** IF ACCOUNT SEQUENCE IS ZERO OR BLANK USE DEFAULT SEQUENCE
     C********** D26#27    IFEQ *BLANK                                    S01117
     C********** D26#27    OREQ *ZERO                                     S01117
     C           W@ACSQ    IFEQ *BLANK                                    S01117
     C           W@ACSQ    OREQ *ZERO                                     S01117
     C                     MOVE DACSQ     WACSQ
     C                     ELSE
     C**********           MOVE D26#27    WACSQ                           S01117
     C                     MOVE W@ACSQ    WACSQ                           S01117
     C                     END
     C*                                                                   S01117
     C* WWBRCA (Branch Code) key already set up before call to TSTRTL     S01117
     C           ACCKEY    CHAINACCNT                88
      *
      ** IF RECORD NOT FOUND OR NOT ACTIVE DATABASE ERROR
     C           *IN88     IFEQ '1'
     C           RECI      ORNE 'D'
     C********** *LOCK     IN   LDA                                       S01194
      *
      ** MOVE KEY FIELDS INTO DS FIELDS FOR DB ERROR KEY
     C**********           MOVE '14'      DBASE                           S01194
     C                     MOVEL'014'     DBASE            ***************S01194
     C                     MOVE 'ACCNT'   DBFILE           *   DBERROR   *
     C                     MOVELERRKEY    DBKEY            *      14     *
     C**********           EXSR DBERR                      ***************S01194
     C                     EXSR *PSSR                      ***************S01194
     C                     ELSE
     C*                                                                   E21549
     C**   Move account details to shadow post later                      E21549
     C*                                                                   E21549
     C                     MOVE DLNO      TNMR                            E21549
     C                     MOVE DTYP      TRYP                            E21549
     C**********           Z-ADDCNUM      CUSN                                         E21549 CSD027
     C                     MOVE CNUM      CUSN                                                CSD027
     C                     MOVE CCY       CCYD                            E21549
     C                     Z-ADDACOD      ACDE                            E21549
     C                     Z-ADDACSQ      ASNC                            E21549
     C*                                                                   E21549
      ** IF RECORD ACTIVE & RETAIL RETURN MEMO RRN ELSE ZERO
      *
     C           ATYP      IFNE 'R'
     C*********************Z-ADD*ZERO     RRNM                            CCB002
     C                     MOVE 'N'       WRETL                           CCB002
     C                     END
      *
     C                     END                             END ERR 30
     C                     END                             END 05
      *                                                                                       244944
      ** If settlement type is '00' then change WRETL to be 'N'                               244944
      *                                                                                       244944
     C           DSETM     IFEQ '00'                                                          244944
     C                     MOVE 'N'       WRETL                                               244944
     C                     ENDIF                                                              244944
      *
      ** CLEAR PASSED FIELDS
     C                     MOVE *BLANK    DDCCY
     C                     MOVE *BLANK    DSETM   2
     C                     MOVE *BLANK    DBNKAC
     C**********           Z-ADDDCNUM     CNUM                                                CSD027
     C**********           Z-ADD*ZERO     DCNUM                                               CSD027
     C                     MOVE DCNUM     CNUM                                                CSD027
     C                     MOVE *BLANKS   DCNUM                                               CSD027
     C                     MOVE *BLANKS   WWBRCA                          S01117
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************   S01195
      **********                                                      *   S01195
      *****ZDATE5*SR**TO*DETERMINE*IF*A*DAY*NUMBER*DATE*IS*A*HOLIDAY***   S01195
      **********      IN GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY     *   S01195
      **********      AND IF REQUIRED, DETERMINE NEXT WORKING DAY.    *   S01195
      **********                                                      *   S01195
      *****************************************************************   S01195
      **********                                                          S01195
     C********** ZDATE5    BEGSR                           *** ZDATE5 *** S01195
      **********                                                          S01195
      *****CALCULATIONS*TO*DEFINE*INPUT*FIELDS***                         S01195
     C**********           Z-ADDZDAYNO    ZDAYNO  50                      S01195
     C**********           MOVE ZCCY      ZCCY    3                       S01195
     C**********           MOVE ZOPT      ZOPT    1                       S01195
      **********                                                          S01195
      *****CALCULATIONS*TO*DEFINE/CLEAR*WORKFIELDS***                     S01195
     C**********           MOVE '   '     ZHC                             S01195
      **********                                                          S01195
      *****RESET*INDICATOR***                                             S01195
     C**********           SETOF                     99                   S01195
      **********                                                          S01195
      *****CALCULATION*TO*DEFINE/SET*OUTPUT*FIELD***                      S01195
     C**********           Z-ADDZDAYNO    ZDYNBR  50                      S01195
      **********                                                          S01195
      *****DETERMINE*IF*HOLIDAY****                                       S01195
     C********** ZDHOL     TAG                             ** ZDHOL TAG **S01195
     C**********           SETOF                     91                   S01195
      **********                                                          S01195
      *****SET*KEY*FOR*FIRST*HOLIDAY*RECORD***                            S01195
     C**********           MOVEL'22      'ZTABKY 12                       S01195
     C**********           MOVELZDYNBR    ZWRK6   6                       S01195
     C**********           MOVE '1'       ZWRK6                           S01195
     C**********           MOVE ZWRK6     ZTABKY                          S01195
      **********                                                          S01195
      *****CHAIN*FOR*HOLIDAY*RECORD**RECORD*1*OR*2***                     S01195
     C********** ZDHCH5    TAG                             ** ZDHCH5 TAG *S01195
     C***********ZTABKY    CHAINTABDLI               90    ON NOT THERE   S01195
     C********** ZTABKY    CHAINTABDLEI              90    ON NOT THERE   S01195
     C**N90***** RECI      COMP 'D'                  9090  DELETED        S01195
      **********                                                          S01195
      *****STORE*CURRENCIES*IF*RECORD*FOUND***                            S01195
     C**N90N91**           MOVEAHCCY      ZHC,1                           S01195
     C***91N90**           MOVEAHCCY      ZHC,26                          S01195
      **********                                                          S01195
      *****GET*SECOND*RECORD**IF*NOT*ALREADY*DONE***                      S01195
     C**********           MOVE ZTABKY    ZWRK1N  10                      S01195
     C********** ZWRK1N    COMP 1                        91               S01195
     C**********           MOVE '2'       ZTABKY                          S01195
     C***91N90**           GOTO ZDHCH5                                    S01195
      **********                                                          S01195
      *****BYPASS*TO*END*IF*NO*FIRST*RECORD*FOUND***                      S01195
     C***90*91**           GOTO ZDEND5                                    S01195
      **********                                                          S01195
      *****DETERMINE*HOLIDAY*RECORD*TYPE****                              S01195
     C********** INEX      COMP 'E'                      92               S01195
     C********** INEX      COMP 'I'                      93               S01195
      **********                                                          S01195
      *****CHECK*IF*CURRENCY*ON*HOLIDAY****                               S01195
     C********** ZCCY      LOKUPZHC                      94               S01195
      **********                                                          S01195
      *****BYPASS*TO*END*IF*NOT*HOLIDAY*FOR*CURRENCY***                   S01195
     C***92*94**                                                          S01195
     C*R*93N94**           GOTO ZDEND5                                    S01195
      **********                                                          S01195
      *****SET*INDICATOR*FOR*HOLIDAY*FOR*DAY*NUMBER***                    S01195
     C**********           SETON                     99                   S01195
      **********                                                          S01195
      *****CHECK*IF*NEXT*WORKING*DAY*REQUIRED****                         S01195
     C********** ZOPT      COMP 'Y'                      95               S01195
     C***95***** ZDYNBR    ADD  1         ZDYNBR                          S01195
     C***95*****           GOTO ZDHOL                                     S01195
      **********                                                          S01195
      **********                                                          S01195
     C********** ZDEND5    ENDSR                           * ZDEND5 ENDSR*S01195
      **********                                                          S01195
      *****************************************************************   S01195
      /TITLE ZDATE2 SUBROUTINE
      *****************************************************************
      **                                                              *
      **   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.        *
      **                                                              *
      **   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.     *
      **                                                              *
      *****************************************************************
      **
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
      **
      **   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
      **
      **   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
      **
      **   DETERMINE YEAR NUMBER.
      **
      **   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
      **
      **   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
      **                                                   DAYS
      **   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
      **
      **   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
      **
      **   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
      **
      **   DETERMINE MONTH NUMBER.
      **
      **   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
      **
      **   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
      **
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
      **
      **   DETERMINE DAY OF MONTH.
      **
      **   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
      **
      **   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
      **
      **   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
      **
      **   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
      **
      **   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
      **
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
      **
      **
      *****************************************************************
      /TITLE ZDATE1 SUBROUTINE
      *****************************************************************
      **                                                              *
      **   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND                 *
      **              CONVERT TO A NUMBER OF DAYS.                    *
      **                                                              *
      **   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.     *
      **                                                              *
      *****************************************************************
      **
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
      **
      **   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
      **
      **   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
      **
      **   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
      **
      **   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
      **
      **   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
      **
      **   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
      **
      **   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
      **                                                   PAST FEB, 93 ON
      **   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
      **
      **   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
      **
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
      **                                                                  CEU003
      **                                                                  CEU003
      *****************************************************************   CEU003
      **                                                              *   CEU003
      **   EUCONV SR. TO CONVERT AMOUNT TO SETTLEMENT CURRENCY        *   CEU003
      **                                                              *   CEU003
      *****************************************************************   CEU003
      **                                                                  CEU003
     C           EUCONV    BEGSR                                          CEU003
      **                                                                  CEU003
      **   CALL EXTERNAL PROGRAM                                          CEU003
     C                     CALL 'EU0200'                                  CEU003
     C                     PARM *BLANKS   P@RTCD  7        RETURN CODE    CEU003
     C                     PARM           P@FRAM 183       TRANS AMT      CEU003
     C                     PARM           P@FRCY  3        TRANS CCY      CEU003
     C                     PARM           P@TOCY  3        SETTL CCY      CEU003
     C                     PARM           P@OUTA 150       SETTL AMT      CEU003
     C                     PARM           P@INTA 183       INT SET AMT    CEU003
     C                     PARM           P@EXRT 159       EXCH RATE      CEU003
     C                     PARM           P@MDIN  1        M/D IND        CEU003
      **                                                                  CEU003
      **   ERROR ROUTINE                                                  CEU003
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU003
     C                     Z-ADD28        DBASE            **********     CEU003
     C                     MOVE *BLANKS   DBOPTN           *  28    *     CEU003
     C                     MOVELP@FRCY    DBKEY            **********     CEU003
     C                     MOVEL'EU0200'  DBFILE                          CEU003
     C                     EXSR *PSSR                                     CEU003
     C                     ENDIF                                          CEU003
      **                                                                  CEU003
     C           XEUCNV    ENDSR                                          CEU003
      **
      **
      *****************************************************************
      /TITLE INIT SUBROUTINE
      *****************************************************************
      *                                                               *
      *  INIT SR.      To access I.C.D. information & check constant  *
      *                data                                           *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ****
      *
      ****Access*I*C*D**record*1***                                       S01194
      **********                                                          S01194
     C**********           EXSR ZSYSTM                                    S01194
      **********                                                          S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '01'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      01     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I*C*D**record*2**                                        S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '11'      ZTABKY                          S01194
      **********                                                          S01194
     C********** ZTABKY    CHAINTABDLEI              99                   S01194
      **********                                                          S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '02'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      02     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I*C*D**record*3***                                       S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '20'      ZTABKY                          S01194
      **********                                                          S01194
     C********** ZTABKY    CHAINTABDLEI              99                   S01194
      **********                                                          S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '03'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      03     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      **********                                                          S01194
      ****Access*I*C*D**record*5***                                       S01194
      **********                                                          S01194
     C**********           MOVE *BLANKS   ZTABKY                          S01194
     C**********           MOVEL'01'      ZTABKY                          S01194
     C**********           MOVE '40'      ZTABKY                          S01194
      **********                                                          S01194
     C********** ZTABKY    CHAINTABDLEI              99                   S01194
      **********                                                          S01194
     C********** *IN99     IFEQ '1'                                       S01194
     C********** RECI      ORNE 'D'                                       S01194
     C********** *LOCK     IN   LDA                                       S01194
     C**********           MOVE '04'      DBASE            ***************S01194
     C**********           MOVE 'TABLE'   DBFILE           *   DBERROR   *S01194
     C**********           MOVELZTABKY    DBKEY            *      04     *S01194
     C**********           EXSR DBERR                      ***************S01194
     C**********           END                                            S01194
      *                                                                   S01194
      * Initialize DBKEY to blanks in case db error occurs                S01194
     C                     MOVE *BLANKS   DBKEY                           S01194
     C*                                                                   S01194
     C* Call Access prog. for Bank Details.                               S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                      *************S01194
     C                     MOVEL'001'     DBASE              *  DBERROR  *S01194
     C                     MOVE 'SDBANKPD'DBFILE             *     01    *S01194
     C                     EXSR *PSSR                        *************S01194
     C                     END                                            S01194
     C*                                                             S01194095746
     C**Call*Access prog. for Retail Details.                       S01194095746
     C********** BGRTBN    IFEQ 'Y'                                 064773095746
     C********** BGIOAC    OREQ 'Y'                                 064773095746
     C**********           CALL 'AORETLR0'                          S01194095746
     C**********           PARM '*MSG   ' @RTCD   7                 S01194095746
     C**********           PARM '*FIRST ' @OPTN   7                 S01194095746
     C********** SDRETL    PARM SDRETL    DSFDY                     S01194095746
      **********                                                    064773095746
     C**********           END                                      064773095746
      **********                                                    S01194095746
      **Handle*database error                                       S01194095746
     C********** @RTCD     IFNE *BLANKS                *************S01194095746
     C**********           MOVEL'002'     DBASE        *  DBERROR  *S01194095746
     C**********           MOVE 'SDRETLPD'DBFILE       *     02    *S01194095746
     C**********           EXSR *PSSR                  *************S01194095746
     C**********           END                                      S01194095746
     C*                                                                   S01194
     C* Call Access prog. for Module Details.                             S01194
     C*                                                                   S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                      *************S01194
     C                     MOVEL'003'     DBASE              *  DBERROR  *S01194
     C                     MOVE 'SDMMODPD'DBFILE             *     03    *S01194
     C                     EXSR *PSSR                        *************S01194
     C                     END                                            S01194
     C*                                                                   095746
     C* Call Access prog. for Retail Details.                             095746
     C           BGRTBN    IFEQ 'Y'                                       095746
     C           BGIOAC    OREQ 'Y'                                       095746
     C                     CALL 'AORETLR0'                                095746
     C                     PARM '*MSG   ' @RTCD   7                       095746
     C                     PARM '*FIRST ' @OPTN   7                       095746
     C           SDRETL    PARM SDRETL    DSFDY                           095746
      *                                                                   095746
     C                     END                                            095746
      *                                                                   095746
      * Handle database error                                             095746
     C           @RTCD     IFNE *BLANKS                      *************095746
     C                     MOVEL'002'     DBASE              *  DBERROR  *095746
     C                     MOVE 'SDRETLPD'DBFILE             *     02    *095746
     C                     EXSR *PSSR                        *************095746
     C                     END                                            095746
     C*                                                                   S01194
     C* Call Access prog. for Dealing Details.                            S01194
     C*                                                                   S01194
     C**********           CALL 'AODEALR0'                                S01194              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01194              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
      *                                                                   S01194
      * Handle database error                                             S01194
     C           @RTCD     IFNE *BLANKS                      *************S01194
     C                     MOVEL'004'     DBASE              *  DBERROR  *S01194
     C                     MOVE 'SDDEALPD'DBFILE             *     04    *S01194
     C                     EXSR *PSSR                        *************S01194
     C                     END                                            S01194
      *                                                                   S01194
      * Check system date format, DDMMYY or MMDDYY                        S01194
      * *IN98 on if MMDDYY                                                S01194
     C           BJDFIN    IFEQ 'M'                                       S01194
     C                     MOVE '1'       *IN98                           S01194
     C                     END                                            S01194
     C*                                                                   CIR001
     C**  Access SAR details file to determine if Australian              CIR001
     C**  Modifications is switched on.                                   CIR001
     C*                                                                   CIR001
     C                     CALL 'AOSARDR0'                                CIR001
     C                     PARM *BLANKS   @RTCD                           CIR001
     C                     PARM '*VERIFY' @OPTN                           CIR001
     C                     PARM 'CIR001'  @SARD   6                       CIR001
     C           SCSARD    PARM SCSARD    DSFDY                           CIR001
     C*                                                                   CIR001
     C           @RTCD     IFNE *BLANKS                                   CIR001
     C           @RTCD     ANDNE'*NRF   '                                 CIR001
     C                     MOVEL'020     'DBASE            ***************CIR001
     C                     MOVE 'SCSARDPD'DBFILE           *DB ERROR 020 *CIR001
     C                     MOVEL'CIR001'  DBKEY            ***************CIR001
     C                     EXSR *PSSR                                     CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
     C           @RTCD     IFEQ *BLANKS                                   CIR001
     C                     MOVEL'Y'       CIR001  1                       CIR001
     C                     ELSE                                           CIR001
     C                     MOVEL'N'       CIR001                          CIR001
     C                     END                                            CIR001
     C*                                                                   CIR001
      *                                                                   CEU003
      ** Access AOSARDR0 to check if CEU003 is installed                  CEU003
      *                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM *BLANKS   @RTCD   7                       CEU003
     C                     PARM '*VERIFY' @OPTN   7                       CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
      *                                                                   CEU003
     C           @RTCD     IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     END                                            CEU003
      *                                                                   CIR004
      ** Access Switchable Features Details                               CIR004
      *                                                                   CIR004
     C                     CALL 'AOSARDR0'                                CIR004
     C                     PARM *BLANKS   PRTCD   7                       CIR004
     C                     PARM '*VERIFY 'POPTN   7                       CIR004
     C                     PARM 'CIR004'  PSARD   6                       CIR004
     C           SCSARD    PARM SCSARD    DSFDY                           CIR004
     C           PRTCD     IFEQ *BLANKS                                   CIR004
     C                     MOVE 'Y'       CIR004  1                       CIR004
     C                     ELSE                                           CIR004
     C                     MOVE 'N'       CIR004                          CIR004
     C                     ENDIF                                          CIR004
      *                                                                   CIR006
      ** Check if switchable feature CIR006 is switched on                CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY' @OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD   6                       CIR006
     C           SCSARD    PARM SCSARD    DSFDY                           CIR006
     C*                                                                   CIR006
     C           @RTCD     IFNE *BLANK                                    CIR006
     C           @RTCD     ANDNE'*NRF   '                                 CIR006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CIR006
     C                     MOVEL'30'      DBASE            * DB ERROR 30 *CIR006
     C                     MOVEL'CIR006'  DBKEY            ***************CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
      ** Access AOSARDR0 and check if CIR008 is installed                                     CIR008
      *                                                                                       CIR008
     C                     CALL 'AOSARDR0'                                                    CIR008
     C                     PARM *BLANKS   PRTCD                                               CIR008
     C                     PARM '*VERIFY' POPTN                                               CIR008
     C                     PARM 'CIR008'  PSARD                                               CIR008
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR008
      *                                                                                       CIR008
     C           PRTCD     IFNE *BLANKS                                                       CIR008
     C           PRTCD     ANDNE'*NRF    '                                                    CIR008
     C                     MOVE 'SCSARDPD'DBFILE                                              CIR008
     C                     MOVEL'031'     DBASE                                               CIR008
     C                     MOVEL'CIR008'  DBKEY                                               CIR008
     C                     EXSR *PSSR                                                         CIR008
     C                     ENDIF                                                              CIR008
      *                                                                                       CIR008
     C           PRTCD     IFEQ *BLANKS                                                       CIR008
     C                     MOVE 'Y'       CIR008  1                                           CIR008
     C                     MOVE *ON       *IN26                                               CIR008
     C                     Z-ADD0         WUNAUT  50                                          CIR008
     C                     ELSE                                                               CIR008
     C                     MOVE 'N'       CIR008                                              CIR008
     C                     MOVE *OFF      *IN26                                               CIR008
     C                     ENDIF                                                              CIR008
      *                                                                                       CRE009
      ** Access AOSARDR0 and check if CRE009 is installed                                     CRE009
      *                                                                                       CRE009
     C                     CALL 'AOSARDR0'                                                    CRE009
     C                     PARM *BLANKS   PRTCD                                               CRE009
     C                     PARM '*VERIFY' POPTN                                               CRE009
     C                     PARM 'CRE009'  PSARD                                               CRE009
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE009
      *                                                                                       CRE009
     C           PRTCD     IFEQ *BLANKS                                                       CRE009
     C                     MOVE 'Y'       CRE009  1                                           CRE009
     C                     ELSE                                                               CRE009
     C                     MOVE 'N'       CRE009                                              CRE009
     C                     ENDIF                                                              CRE009
      *
      ** Determine if SAR CAP205 Teller Related APIs - Account Balance Check                  CAP205
      ** is installed.                                                                        CAP205
      *                                                                                       CAP205
     C                     MOVEL'N'       CAP205  1                                           CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   @RTCD                                               CAP205
     C                     PARM '*VERIFY '@OPTN                                               CAP205
     C                     PARM 'CAP205'  @SARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
     C           @RTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVEL'Y'       CAP205                                              CAP205
     C                     ELSE                                                               CAP205
     C           @RTCD     IFNE *BLANKS                                                       CAP205
     C           @RTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP205
     C                     Z-ADD38        DBASE                                               CAP205
     C                     MOVEL'CAP205'  DBKEY                                               CAP205
     C                     EXSR *PSSR                                                         CAP205
     C                     ENDIF                                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C                     MOVEL*BLANK    W#MTYP  1                                           CAP205
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           EXSR *PSSR                                              MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      *                                                                                       CAP205
      ***Retrieve*system*value*setting****************                             MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C**********           MOVELWPARML    P@OP01                                   MD035545 MD051554
     C**********           CALL 'AOSVALR0'                                         MD035545 MD051554
     C**********           PARM *BLANKS   W0RTCD  7                                MD035545 MD051554
     C**********           PARM           P@OP01 20                                MD035545 MD051554
     C**********           PARM           P@VL01200                                MD035545 MD051554
     C**********           PARM           P@OP02 20                                MD035545 MD051554
     C**********           PARM           P@VL02200                                MD035545 MD051554
     C**********           PARM           P@OP03 20                                MD035545 MD051554
     C**********           PARM           P@VL03200                                MD035545 MD051554
     C**********           PARM           P@OP04 20                                MD035545 MD051554
     C**********           PARM           P@VL04200                                MD035545 MD051554
     C**********           PARM           P@OP05 20                                MD035545 MD051554
     C**********           PARM           P@VL05200                                MD035545 MD051554
     C**********           PARM           P@OP06 20                                MD035545 MD051554
     C**********           PARM           P@VL06200                                MD035545 MD051554
     C**********           PARM           P@OP07 20                                MD035545 MD051554
     C**********           PARM           P@VL07200                                MD035545 MD051554
     C**********           PARM           P@OP08 20                                MD035545 MD051554
     C**********           PARM           P@VL08200                                MD035545 MD051554
     C**********           PARM           P@OP09 20                                MD035545 MD051554
     C**********           PARM           P@VL09200                                MD035545 MD051554
     C**********           PARM           P@OP10 20                                MD035545 MD051554
     C**********           PARM           P@VL10200                                MD035545 MD051554
      **********                                                                   MD035545 MD051554
      ***If*system*value*is*not*found*then*default*value*to*'N'****                MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C********** W0RTCD    IFNE '       '                                          MD035545 MD051554
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD051554
     C**********           ELSE                                                    MD035545 MD051554
     C**********           MOVELP@VL01    WCALC6                                   MD035545 MD051554
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD051554
      *                                                                                     MD035545
      **  Set up fields for commitment text data structure.
      *
     C                     MOVE 'DL'      MDID                            E21624
     C                     MOVE 'DL1922'  PGMN                            E21624
     C                     MOVE WSID      WSIDX
     C                     MOVE USRID     USRIDX
     C                     MOVEL' SUBMITT'BTEXT
     C                     MOVE 'ED TO BA'BTEXT1  8
     C                     MOVE 'TCH '    BTEXT2  4
     C                     MOVELBTEXT1    BTEXT3 12
     C                     MOVE BTEXT2    BTEXT3
     C                     MOVE BTEXT3    BTEXT
      *
     C                     TIME           MTIME
      *
      **  Set up ACCKEY key list for ACCNT file.
      *
     C           ACCKEY    KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WCCY    3
     C**********           KFLD           WACOD   40                                          CGL029
     C                     KFLD           WACOD  100                                          CGL029
     C                     KFLD           WACSQ   20
     C                     KFLD           WWBRCA  3                       S01117
      *
      **   Set up record count for DLIND output file.
     C                     Z-ADD2         DLCT    50
      *
      **   Set up count for records read from DEALS file.
     C                     Z-ADD0         RECTOT  50
      *
      **   Set up count of deals with rates fixed.
     C                     Z-ADD0         RTFIX   50
      *
      **   Set up and output DLINDHH record.
     C                     EXCPTINUPD
      *
     C/COPY WNCPYSRC,DL1922C003
      **   Set on first cycle indicator.
     C                     MOVE '1'       *IN40
      *
     C           INIT9     ENDSR
      *
      ********************************************************************
      /EJECT
      *****************************************************************   S01194
      **********                                                      *   S01194
      ****ZSYSTM*SR**TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD**   S01194
      **********                                                      *   S01194
      *****************************************************************   S01194
      **********                                                          S01194
     C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
      **********                                                          S01194
      *****SET*UP*KEY*FOR*INSTALLATION*CONTROL*RECORD***                  S01194
     C**********           MOVEL'01      'ZTABKY 12                       S01194
     C**********           MOVE '  10'    ZTABKY                          S01194
      **********                                                          S01194
      ***********ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
     C********** ZTABKY    CHAINTABDLEI              99    ON NOT THERE   S01194
     C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
      **********                                                          S01194
      *****CHECK*SYSTEM*DATE*FORMAT**DDMMYY*OR*MMDDYY****                 S01194
     C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
      **********                                                          S01194
     C**********           ENDSR                                          S01194
      **********                                                          S01194
      *****************************************************************   S01194
      /SPACE 5
      *****************************************************************   S01194
      **********                                                      *   S01194
      ***DBERR**SR*****To*update*LDA*with*database*error*information***   S01194
      *****************&*exit*program**********************************   S01194
      **********                                                      *   S01194
      *****************************************************************   S01194
      **********                                                          S01194
     C********** DBERR     BEGSR                           ***  DBERR ****S01194
      **********                                                          S01194
     C********** *NAMVAR   DEFN           LDA                             S01194
     C**********           MOVEL'DL1922  'DBPGM                           S01194
     C**********           DUMP                                           S01194
     C**********           OUT  LDA                                       S01194
      **********                                                          S01194
     C**********           SETON                     U7U8LR               S01194
      **********                                                          S01194
     C**********           RETRN                                          S01194
      **********                                                          S01194
     C**********           ENDSR                                          S01194
      ********************************************************************S01194
      /EJECT
      *****************************************************************   S01194
      *                                                               *   S01194
      *  *PSSR SR.     To exit program upon database error            *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                                   S01194
     C           *PSSR     BEGSR                                          S01194
      *                                                                   S01194
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     MOVEL'DL1922'  DBPGM                           S01194
     C           *NAMVAR   DEFN LDA       @LDA  256                       S01194
     C           *LOCK     IN   @LDA                                      S01194
     C                     MOVE DBERR     @LDA                            S01194
     C                     OUT  @LDA                                      S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     ENDSR                                          S01194
      *****************************************************************   S01194
      /SPACE 3
      *****************************************************************   S01194
      *                                                               *   S01194
      *  #ZZ  SR.  Called  by main  processing during total time          S01194
      *            calculations if no records read and therefore      *   S01194
      *            SDBANKPD not read.                                 *   S01194
      *                                                               *   S01194
      *****************************************************************   S01194
      *                                                                   S01194
     C           #ZZ       BEGSR                                          S01194
      *                                                                   S01194
      ** If first cycle not performed set BANK details for headings       S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *  If database error...                                             S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVEL'SDBANKPD'DBFILE           ************   S01194
     C                     MOVEL'017'     DBASE            * DBERR 17 *   S01194
     C                     MOVEL@OPTN     DBOPTN  7        ************   S01194
     C                     SETON                     U7U8LR               S01194
     C                     EXSR *PSSR                                     S01194
     C                     END                                            S01194
      *                                                                   S01194
     C           #ZZ9      ENDSR                                          S01194
     C*****************************************************************   S01194
      /EJECT
      *****************************************************************
      *
     OZRFRADLFE                DLUPD
     O                         UDNSI
     O                         TDNSI
     O                         UBRTE
     O                         TBRTE
     O                         UEINR
     O                         TEINR
     O                         CNFI                                       CIR001
     O                         TLXI                                       CIR001
      *
     ODLINDHH EADD             INUPD
     O                                    8 'H 000000'
      *
     ODLINDDM EADD             OUR
     O                                    2 'DD'
     O                         DLNO       8
     O                                   16 '00000000'
     O                         ACTC      17
     O                         CNRQ      18
     O                                   27 '0'
     O                                   28 '0'
     O                         PRI3      29
     O                         BRCA      37                               S01117
     O*************************PIAMT     47P                              S01117
     O*************************ZERO1     54P                              S01117
     O*************************UFIR      60P                              S01117
     O*************************TFIR      66P                              S01117
     O*************************EVDAT     69P                              S01117
     O*************************TAXPY     76P                              S01117
     O                         PIAMT     50P                              S01117
     O                         ZERO1     57P                              S01117
     O                         UFIR      63P                              S01117
     O                         TFIR      69P                              S01117
     O                         EVDAT     72P                              S01117
     O                         TAXPY     79P                              S01117
      *
     ODLINDDM EADD             THEIR
     O                                    2 'DD'
     O                         DLNO       8
     O                                   16 '00000000'
     O                         ACTC      17
     O                         CNRQ      18
     O                         PRI1      27
     O                                   28 '0'
     O                                   29 '0'
     O                         BRCA      37                               S01117
     O*************************ZERO1     47P                              S01117
     O*************************RIAMT     54P                              S01117
     O*************************UFIR      60P                              S01117
     O*************************TFIR      66P                              S01117
     O*************************EVDAT     69P                              S01117
     O*************************ZERO1     76P                              S01117
     O                         ZERO1     50P                              S01117
     O                         RIAMT     57P                              S01117
     O                         UFIR      63P                              S01117
     O                         TFIR      69P                              S01117
     O                         EVDAT     72P                              S01117
     O                         ZERO1     79P                              S01117
     ODLINDDM EADD             BOTH                                       CIR001
     O                                    2 'DD'                          CIR001
     O                         DLNO       8                               CIR001
     O                                   16 '00000000'                    CIR001
     O                         ACTC      17                               CIR001
     O                         CNRQ      18                               CIR001
     O                         PRI1      27                               CIR001
     O                                   28 '0'                           CIR001
     O                         PRI3      29                               CIR001
     O                         PIAMT     50P                              CIR001
     O                         RIAMT     57P                              CIR001
     O                         UFIR      63P                              CIR001
     O                         TFIR      69P                              CIR001
     O                         EVDAT     72P                              CIR001
     O                         TAXPY     79P                              CIR001
      *
     ODLINDZX TADD     LR
     O                                    1 'T'
     O                         DLCT       6
      **   Release pronopn record
     OPRONOPNFE                RELPR
      **   Release Olpos record
     OOLPOSOAFE                RELOL
      *
     ODL1922AUT  203   LR                                                 S01117
     O*L1922P1T**203***LR****                                             S01117
     O**********                         22 'REFERENCE DL1922'            S01117
     O                                   24 'REFERENCE DL1922AU'          S01117
     O**********               TITL      89                               S01194
     O                         BJURPT    89                               S01194
     O                                  104 'DATE'
     O**********               RUNA     112                               S01194
     O                         BJMRDT   112                               S01194
     O                                  122 'PAGE'
     O                         PAGE  Z  127
     O********T  1     LR                                                 S01117
     O        T  1     LRNU7NU8                                           S01117
     O                                   59 'FRAS OF ZERO RATE-F'
     O                                   82 'IX DAYS - FILE CONTROLS'
     O********T  3     LR
     O        T  3     LRNU7NU8                                           S01117
     O                                   59 '-------------------'
     O                                   82 '-----------------------'
     O********T  1     LR
     O        T  1     LRNU7NU8                                           S01117
     O                                   29 'DLDLDGLC - RUN CONTROLS'
     O                                   60 'NUMBER'
     O********T  2     LR
     O        T  2     LRNU7NU8                                           S01117
     O                                   29 '-----------------------'
     O                                   60 'OF RECORDS'
     O********T  3     LR
     O        T  3     LRNU7NU8                                           S01117
     O                                   30 'TOTAL RECORDS SELECTED'
     O                         RECTOT3   60
     O********T  3     LR
     O        T  3     LRNU7NU8                                           S01117
     O                                   30 'DEALS WITH RATES FIXED'
     O                         RTFIX 3   60
      *                                                                                       CIR008
     O        T  3     LRNU7NU8                                                               CIR008
     O       AND       26                                                                     CIR008
     O                                   26 'UNAUTHORISED DEALS'                              CIR008
     O                                   35 'EXCLUDED'                                        CIR008
     O                         WUNAUT3   60                                                   CIR008
      *                                                                                       CIR008
     O/COPY WNCPYSRC,DL1922O001
     O********T  130   LR
     O        T  130   LRNU7NU8                                           S01117
     O                                   29 'S/DLIND - RUN CONTROLS'
     O********T  2     LR
     O        T  2     LRNU7NU8                                           S01117
     O                                   29 '----------------------'
     O********T  3     LR
     O        T  3     LRNU7NU8                                           S01117
     O                                   30 'TOTAL RECORDS ON FILE'
     O                         DLCT  3   60
     O        T 33     LR U7 U8                                           S01117
     O                                   44 'DATABASE ERROR'              S01117
     O                         DBASE Z   48                               S01117
     O                                   59 'IN PROGRAM'                  S01117
     O                         DBPGM     70                               S01117
     O        T        LR U7 U8                                           S01117
     O                                   34 'FILE'                        S01117
     O                         DBFILE    43                               S01117
     O                                   48 ', KEY'                       S01117
     O                         DBKEY     84                               S01117
     O********T*3      LR                                                 S01117
     O**********                         62 '***   END OF REPORT'         S01117
     O**********                         68 '***'                         S01117
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CIR001
00366007310109601461                                                      CIR001
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CIR001
00000000310005900090001200015100181002120024300273003040033400365         CIR001
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
