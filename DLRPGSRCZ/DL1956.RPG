     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL IRS revaluation report')                      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - FRA/IRS Module                                       *
     F*                                                               *
     F*  DL1956 - REVALUATION REPORT                                  *
     F*                                                               *
      *  NOTE: Check IR1956 for changes that may apply to it if there *                       CAS005
      *        are amendments done to this program.                   *                       CAS005
      *                                                               *                       CAS005
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD053295           Date 13Apr19               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 CDL099             Date 06Oct17               *      
      *                 CGL187             Date 06Oct17               *      
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 AR996895           Date 25Nov12               *
      *                 CRE073             Date 06Dec10               *
      *                 245132             Date 31Jan07               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER048             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247544             Date 16May07               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CDL049             Date 05Jul06               *
      *                 216768             Date 06Jun06               *
      *                 CIR014             Date 11May06               *
      *                 CSD031             Date 10Apr06               *
      *                 237260             Date 14Dec05               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 22Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229406             Date 07Sep04               *
      *                 228543             Date 03Sep04               *
      *                 228922             Date 17Aug04               *
      *                 CAS008             Date 16Jun04               *
      *                 227838             Date 01Jul04               *
      *                 226170             Date 05Apr04               *
      *                 225531             Date 30Mar04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 223933             Date 19Dec03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 217684             Date 12May03               *
      *                 CAS004             Date 26Jun02               *
      *                 202405             Date 28Mar02               *
      *                 207278             Date 26Jun02               *
      *                 207277             Date 26Jun02               *
      *                 207276             Date 26Jun02               *
      *                 207275             Date 26Jun02               *
      *                 207274             Date 26Jun02               *
      *                 207272             Date 26Jun02               *
      *                 207271             Date 26Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 208939             Date 09Sep02               *
      *                 186412             Date 20Jun02               *
      *                 193718             Date 04Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 CAS002             Date 14Jan02               *
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 182370             Date 05Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CIR006             Date 13Sep00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 163136             Date 08Jul99               *
     F*                 137276             DATE 18Jun98               *
     F*                 126017             DATE 17Nov97               *
     F*                 101662             DATE 04APR96               *
     F*                 101577             DATE 03APR96               *
     F*                 100963             DATE 19MAR96               *
     F*                 100951             DATE 18MAR96               *
     F*                 100447             DATE 05MAR96               *
     F*                 100317             DATE 13MAR96               *
     F*                 100298             DATE 05MAR96               *
     F*                 100287             DATE 05MAR96               *
     F*                 100284             DATE 05MAR96               *
     F*                 CIR001 *CREATE     DATE 13JUN95               *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL187 - Amendment to Net Trading Position Report            *      
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  245132 - Call DLZNPV2 instead of DLZNPV, with additional     *
      *           parameter. DLZNPV2 created from DLZNPV.             *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  216768 - Single Revaluation report displays RATE MISSING -   *
      *           NOT VALUED if NPV is 0.  Applied the same concept   *
      *           as fix 216925.                                      *
      *  CIR014 - Mark to Market Cross-currency Interest Rate Swaps   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  237260 - Do not print 'CURVE MISSING -  NOT REVALUED' if     *
      *           CAS005 is not switched on.                          *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229406 - Report shows value in OCI column related to FRA     *
      *           transaction which is not valid.                     *
      *  228543 - Upfront fees should be included in the computation  *
      *           of NPV even it is future dated.                     *
      *  228922 - DLC1950 failed component.                           *
      *  CAS008 - IAS 39 Enhancements                                 *
      *  227838 - If all periods for one side of a deal have zero     *
      *           cashflow, do not print Our/Their total of '0.00'.   *
      *  226170 - UP/UL fields for RX deals should be in base ccy.    *
      *  225531 - Swap with zero rate is not revalued because rates   *
      *           are missing.  It should still be revalued, but zero *
      *           cashflow should not be reported.                    *
      *           Also print 'Rates Missing' if forward yield curve   *
      *           combination was not found.                          *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  223933 - Divide by Zero Error on DL1956                      *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAS004 - Hedge Accounting Phase A                            *
      *  202405 - Include manual adjustment to accrued interest       *
      *           for the current period.                             *
      *  207278 - Include up-front fees valuation                     *
      *  207277 - Final total of adjusted amount in DL1956P1 wrong    *
      *  207276 - Add new line to DL1956P2 to reflect adjustment for  *
      *           accrued interest                                    *
      *  207275 - Did not take into adjustment to "accrued interest"  *
      *  207274 - Correct half-adjust problems caused by 207272       *
      *  207272 - Different ways of calculating interest in DL1956    *
      *  207271 - Calculation method not set up accordingly           *
      *  208939 - Amend parameters passed to DLZNPV changed by CAS001 *
      *  186412 - Interest adjustment for FRA/IRS deals are being     *
      *           carried over to the next period.                    *
      *  193718 - Remove fix 101662. Interest must be calculated from *
      *           last int payment date up to next int payment date,  *
      *           regardless of the value of int accrual control date.*
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  CAS002 - Hedge Strategy/Linkage                              *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  182370 - Incorrect calculation of number of days for calcu-  *
      *           lation basis 6. Amended /COPY such that for calcu-  *
      *           lation basis 6, the number of days per year is      *
      *           equal to 366 when the year in question is a leap    *
      *           year, and 365 days/year for non-leap years. Calcu-  *
      *           lation was made so that processing would be in-line *
      *           with that of /COPY ZINTDY.                          *
      *  CIR006 - Amortisation of Caps/Collars/Floors and Individual  *
      *           Compounding Swaps.                                  *
      *         - Change done was only for Individual Compounding     *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CIR004 - Dealing Calculation Method Change                   *
      *         - Recompiled due to GLINTC, ZINTDY AND ZCBDYS changes *
     F*  163136 - Interest Calculation Method '6'  showing incorrect -*
     F*           ZERO - amount . Addition to Core #126017 which dealt*
     F*           with the issue. It introduced an additional  INT6DY *
     F*           field in  Core  s-routine  ZINTDY in  /COPY ZSRSRC/ *
     F*           ZINTDYZ2 w/ch is usually called from GLINTC s-routine
     F*           in /COPY  ZSRSRC/ GLINTCZ1 .  However, there are at *
     F*           least a dozen other pgms that use ZINTDY but do     *
     F*           GLINTC-processing within the pgms calculation specs *
     F*           and therefore need to make use of INT6DY  field .   *
     F*  137276 - There is no 'END OF REPORT'.                        *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  101662 - For the first period, any rate or principal changes *
     F*           that have already been actioned are ignored. The    *
     F*           accrued interest to control date must be calculated *
     F*           in this case and added to it the interest for the   *
     F*           remainder of the period.                            *
     F*  101577 - Capitalising swaps should add the interest to the   *
     F*           principal each interest payment date. The amounts   *
     F*           should not be NPV'd each paymnet date, but totalled *
     F*           and NPV'd at maturity only.                         *
     F*  100963 - On change of branch and currency, the currency name *
     F*           of the previous currency was reported.              *
     F*  100951 - If deal is backvalued the UIACD in I/C calculates   *
     F*           the incorrect Adjustment to Accrued Interest. The   *
     F*           accrual should be calculated for this period only   *
     F*           and so should be from the greater of the control    *
     F*           date and the period start date.                     *
     F*  100447 - Adjustments to the accrued interest should be       *
     F*           included in the cash-flow for the first period.     *
     F*  100317 - The straight-line method of interpolating discount  *
     F*           factors using SR/ZINTPL did not provide satisfatory *
     F*           results. As the discount factors curve is           *
     F*           exponential, an PL1 program (ZEXPIN) is used to     *
     F*           perform an exponential interpolation. This program  *
     F*           amended to pass spot date to PGM/DLZNPV.            *
     F*  100298 - Do not output any cash-flows dated prior to the     *
     F*           run date. Any cash-flows dated prior to the spot    *
     F*           date should not be NPV'd.                           *
     F*  100287 - Compounding of Interest switchable feature (CIR002) *
     F*           must be included.                                   *
     F*  100284 - Report does not correctly handle the cash-flows     *
     F*           dated upto spot date. Any cash-flow event that is   *
     F*           part-way through the period must have the accrual   *
     F*           that will be posted tonight calculated and removed  *
     F*           from the P/L posted. Also, any cash-flows dated     *
     F*           between run date and spot date must not be NPV'd.   *
     F*  CIR001 - Interest Rate Calendars                             *
     F*                                                               *
     F*****************************************************************
     FDLACTVPDIF  E           K        DISK         KINFSR *PSSR
     FDLCFEVPDIF  E           K        DISK         KINFSR *PSSR
     FDEALALL UF  E           K        DISK         KINFSR *PSSR
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDCF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F            DEALSDGF                          KRENAMEDEALSUF
     FDEALS   IF  E           K        DISK         KINFSR *PSSR
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDCF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
      *                                                                                       CAS008
     FSDYLDRL1IF  E           K        DISK         KINFSR *PSSR                              CAS008
      ** Yield Rates File                                                                     CAS008
      *                                                                                       CAS008
      *                                                                                       CIR014
     FDLDEALL5IF  E           K        DISK         KINFSR *PSSR                              CIR014
     F            DLDLDBD0                          KIGNORE                                   CIR014
     F            DLDLDCD0                          KIGNORE                                   CIR014
      *                                                                                       CIR014
     FDL1956P1O   E                    PRINTER      KINFDS SPOOL1     UC
     F                                              KINFSR *PSSR
     FDL1956P2O   E                    PRINTER      KINFDS SPOOL2     UC
     F                                              KINFSR *PSSR
     FDL1956AUO   E                    PRINTER      KINFDS SPOOLU     UC
     F                                              KINFSR *PSSR
     FRSCFLAPDO   E                    DISK         KINFSR *PSSR                              CAS008
     FRXCFLAPDO   E                    DISK         KINFSR *PSSR                              CAS008
      *                                                                                       CAS002
      ***Revalued*IRS*File*********************************************                CAS002 CAS005
      ** Midas IR Revalued SIRS File                                                          CAS005
      *                                                                                       CAS002
     F***IRNPVLL0UF  E           K        DISK         KINFSR *PSSR A                  CAS002 CAS005
     FIRNPVAL0UF  E           K        DISK         KINFSR *PSSR A                            CAS005
      *                                                                                       CAS005
     FRXNPVAL0UF  E           K        DISK         KINFSR *PSSR A                            CAS005
      ** Midas IR Revalued CIRS File                                                          CAS005
      *                                                                                       CAS005
     FDLIRSCPDO   E                    DISK         KINFSR *PSSR      UC                      CGL187
      *                                                                                       CGL187
     F/COPY WNCPYSRC,DL1956F001
      *----------------------------------------------------------------
      *
      * ID  F  C  H  L    FUNCTION OF INDICATORS
      *       10          CROSS CURRENCY SWAP REPORT
      *       30          RATES MISSING - NOT REVALUED
      *       31          CURVE MISSING - NOT REVALUED                                        CAS005
      *       35          At least 1 cashflow written for one side                            227838
      *       90-99       STANDARD SUBROUTINES
      *
      *       U7          DATABASE ERROR
      *----------------------------------------------------------------
      /SPACE 5
     E                    CPY@    1   1 80
     E                    POWER   1   7  7 3
     E**********          ZF29   14  32  5 0                                                  CAS004
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZHOLE                                                  100317
     E/COPY ZSRSRC,ZDATE9Z1                                               100284
     I/COPY ZSRSRC,ZSEDITZ2
      /SPACE 5
     I            DS                                                                          207276
     I                                        1 111 @FDTL2                                    207276
     I                                        1   6 RDLNO                                     207276
     I                                        7  11 ROTNAR                                    207276
     I                                       12  16 RFFNAR                                    207276
     I                                       17  23 RSLIP                                     207276
     I                                       24  30 RNIPD                                     207276
     I                                       31  37 RPYDT                                     207276
     I                                       38  40 RCCY                                      207276
     I                                       41  59 RPRIN                                     207276
     I                                       60  60 RYLD                                      207276
     I                                       61  72 RRATE                                     207276
     I                                       73  73 RAFNAR                                    207276
     I                                       74  92 RAMNT                                     207276
     I                                       93 111 RNPV                                      207276
     ISPOOL1      DS
      ***  File Information Data Structure for DL1956P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
      *
     ISPOOL2      DS
      ***  File Information Data Structure for DL1956P2.
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
     I                                    B 188 1890OFLLN2
     I                                    B 367 3680PRTLN2
      *
     ISPOOLU      DS
      ***  File Information Data Structure for DL1956AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     ISDBANK    E DSSDBANKPD
      * BANK DETAILS ACCESSED VIA ACCESS PROGRAM
     ISDCURR    E DSSDCURRPD
      * CURRENCY DETAILS ACCESSED VIA ACCESS PROGRAM
     ISDBRCH    E DSSDBRCHPD
      * BRANCH DETAILS ACCESSED VIA ACCESS PROGRAM
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          #DFAC1                                    CGL029
      * CUSTOMER DETAILS ACCESSED VIA ACCESS PROGRAM
     ISDGELR    E DSSDGELRPD                                              100284
      * General Ledger Details accessed via access program                100284
     ISCSARD    E DSSCSARDPD                                              100287
      * Switchable Features Details accessed via access program           100287
     IDSFDY     E DSDSFDY
     IDSSDY     E DSDSSDY
     I*
     I**   Local data area to hold database error information
     I*
     IDBERR       DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I/COPY WNCPYSRC,DL1956I001
     I/COPY ZSRSRC,ZINTDYZ1
     I/COPY ZSRSRC,ZHOLI                                                  100317
     I/COPY ZSRSRC,ZDATE9Z2                                               100284
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
      *                                                                   182370
      ***Data*structure*for*subroutine*ZCBDYS**************************                182370 CAS005
     I**********  DS                                                                   182370 CAS005
     I**********                              1   80ZZDAT1                             182370 CAS005
     I**********                              1   40ZZYYA                              182370 CAS005
     I**********                              5   60ZZMMA                              182370 CAS005
     I**********                              7   80ZZDDA                              182370 CAS005
      *                                                                   182370
     I**********  DS                                                                   182370 CAS005
     I**********                              1   80ZZDAT2                             182370 CAS005
     I**********                              1   40ZZYYB                              182370 CAS005
     I**********                              5   60ZZMMB                              182370 CAS005
     I**********                              7   80ZZDDB                              182370 CAS005
      *                                                                   182370
     ILDA         DS                            256                                           CAS002
      *                                                                                       CAS002
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I**************************************************************************
      /EJECT
     C**************************************************************************
     C                     MOVEACPY@      BIS@   80
     C*
     C** INITIAL PROCESSING
     C*
     C                     EXSR INIT
     C*
     C** MAIN PROCESSING
     C*
     C                     EXSR MAIN
     C*
     C** OUTPUT AUDIT REPORT AND END PROGRAM
     C*
     C                     EXSR AUDIT
     C**************************************************************************
      /SPACE 5
     C********************************************************************
     C* MAIN PROCESSING
     C********************************************************************
     C           MAIN      BEGSR
     C*
     C** READ CASHFLOW EVENTS
     C*
     C           *LOVAL    SETLLDLCFEVD0
     C                     READ DLCFEVD0                 LR*
     C*
     C** DO WHILE NOT END OF FILE
     C*
     C           *INLR     DOWEQ'0'
     C*------------------------------------------------------------------
     C*
     C** END OF PREVIOUS OUR/THEIR INDICATOR PROCESSING
     C*
     C           CFOTIN    IFNE ##OTIN
     C           CFDLNO    ORNE ##DLNO
     C           ##OTIN    IFNE *BLANK
     C                     EXSR PROTIN
     C                     END
     C                     END
     C*------------------------------------------------------------------
     C*
     C** END OF PREVIOUS DEAL PROCESSING
     C*
     C           CFDLNO    IFNE ##DLNO
     C           ##DLNO    ANDNE*ZERO
     C                     EXSR PRDEAL
     C                     END
     C*------------------------------------------------------------------
     C*
     C** END OF PREVIOUS BOOK PROCESSING
     C*
     C           CFBOKC    IFNE @BOKC
     C           @BOKC     ANDNE*BLANK
     C           CFRCCY    ORNE @RCCY
     C           @RCCY     ANDNE*BLANK
     C           CFBRCA    ORNE @BRCA
     C           @BRCA     ANDNE*BLANK
     C                     EXSR PRBOKC
     C                     END
     C*------------------------------------------------------------------
     C*
     C** END OF PREVIOUS REPORT CURRENCY PROCESSING
     C*
     C           CFRCCY    IFNE @RCCY
     C           @RCCY     ANDNE*BLANK
     C           CFBRCA    ORNE @BRCA
     C           @BRCA     ANDNE*BLANK
     C                     EXSR PRRCCY
     C                     END
     C*------------------------------------------------------------------
     C*
     C** END OF PREVIOUS BRANCH PROCESSING
     C*
     C           CFBRCA    IFNE @BRCA
     C           @BRCA     ANDNE*BLANK
     C                     EXSR PRBRCA
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW BRANCH PROCESSING
     C*
     C           CFBRCA    IFNE @BRCA
     C                     EXSR NWBRCA
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW REPORT CURRENCY PROCESSING
     C*
     C           CFRCCY    IFNE @RCCY
     C           CFBRCA    ORNE @BRCA                                     100963
     C                     EXSR NWRCCY
     C                     MOVELCFBRCA    @BRCA   3                       100963
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW BOOK PROCESSING
     C*
     C           CFBOKC    IFNE @BOKC
     C                     EXSR NWBOKC
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW (DEAL) CURRENCY PROCESSING
     C*
     C           CFCCY     IFNE @CCY
     C                     EXSR NWCCY
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW DEAL PROCESSING
     C*
     C           CFDLNO    IFNE ##DLNO
     C                     EXSR NWDEAL
     C                     Z-ADDCFDLNO    ##DLNO
     C                     END
     C*------------------------------------------------------------------
     C*
     C** NEW OUR/THEIR INDICATOR PROCESSING
     C*
     C           CFOTIN    IFNE ##OTIN
     C                     MOVELCFOTIN    ##OTIN
     C                     Z-ADD0         ##INTC 150                      101577
      *                                                                                       227838
      ** Initialise indicator at start of new Our/Their processing                            227838
      *                                                                                       227838
     C                     MOVE '0'       *IN35                                               227838
      *                                                                                       207276
      ** Add a new line for the adjustment of the accrued interest                            207276
      **  for the deal types "RS"                                                             207276
      *                                                                                       207276
     C           CFBRTT    IFNE *ZEROS                                                        207276
     C           UPAMT     ANDNETPAMT                                                         207276
     C           DTYP      ANDEQ'RS'                                                          207276
     C                     MOVEL'Y'       @FNEW   1        NEW LINE                           207276
     C                     MOVEL'Y'       @FNEW1           NPV CALCS                          207276
     C                     MOVEL'Y'       @FNEW2  1        ACR ADJ                            207276
     C                     ENDIF                                                              207276
      *                                                                                       207276
     C/COPY WNCPYSRC,DL1956C005
     C                     END
     C*------------------------------------------------------------------
     C*
     C** IF NO INTEREST CALCULATION METHOD, DEFAULT IT FOR DEAL CURRENCY
     C** (REQUIRED IF CASHFLOW SWAP - FREQUENCY 'C')
     C*
     C           CFINCL    IFEQ ' '
     C           CFINCL    OREQ '0'
     C                     MOVELDLINCL    CFINCL
     C                     END
      *------------------------------------------------------------------ 100284
      *                                                                   100284
      ** If the cash-flow period has already started, calculate the       100284
      **   accrual posted to event control date.                          100284
      *                                                                   100284
     C           CFSLIP    IFLE ##EVCD                                    100284
     C           CFSPIN    ANDEQ*BLANKS                                   100284
      *                                                                   100287
      ** If CIR002 is on, initialise unsettled interest.                  100287
      ** For CIR006, do this if interest processing method is             CIR006
      ** 'A', 'I' or 'L'.                                                 CIR006
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1956C016
     C           CFOTIN    IFEQ 'U'                                       100287
     C                     Z-ADD##OUSI    ##UNSI                          100287
     C                     ELSE                                           100287
     C                     Z-ADD##TUSI    ##UNSI                          100287
     C                     ENDIF                                          100287
     C                     ENDIF                                          100287
      *                                                                   100287
     C                     EXSR DETACR                                    100284
      *                                                                   100284
     C                     ENDIF                                          100284
     C*
     C** IF UNKNOWN CASHFLOW, DETERMINE IT
     C*
     C           CFAMNT    IFEQ *ZERO
      **********                                                                       101662 193718
      ***Check*if*the*interest*accrual*control*date*is*greater*than****                101662 193718
      *****the*period*start*date.*If*it*is,*calculate*the*accrued******                101662 193718
      *****interest*to*control*date*and*start*SR/DETAMT*from*this*date.                101662 193718
      **********                                                                       101662 193718
     C********** CFOTIN    IFEQ 'U'                                                    101662 193718
      **********                                                                       101662 193718
     C********** UIACD     IFGT CFSLIP                                                 101662 193718
     C**********           Z-ADDUIACD     ##SLIP  50                                   101662 193718
     C********** UAITC     SUB  UIPRD     ##TOTI 150                                   101662 193718
     C**********           ELSE                                                        101662 193718
     C**********           Z-ADDCFSLIP    ##SLIP                                       101662 193718
     C**********           Z-ADD*ZERO     ##TOTI                                       101662 193718
     C**********           ENDIF                                                       101662 193718
      **********                                                                       101662 193718
     C**********           ELSE                                                        101662 193718
      **********                                                                       101662 193718
     C********** TIACD     IFGT CFSLIP                                                 101662 193718
     C**********           Z-ADDTIACD     ##SLIP                                       101662 193718
     C********** TAITC     SUB  TIPRD     ##TOTI                                       101662 193718
     C**********           ELSE                                                        101662 193718
     C**********           Z-ADDCFSLIP    ##SLIP                                       101662 193718
     C**********           Z-ADD*ZERO     ##TOTI                                       101662 193718
     C**********           ENDIF                                                       101662 193718
      **********                                                                       101662 193718
     C**********           ENDIF                                                       101662 193718
      **********                                                                       101662 193718
     C                     Z-ADDCFSLIP    ##SLIP  50                                          193718
     C                     Z-ADDCFNIPD    ##INED  50                      100284
     C                     MOVEL*BLANK    ##CSHF  3
     C                     EXSR DETAMT
     C                     ELSE
     C                     MOVEL'YES'     ##CSHF
     C                     END
      *                                                                   100447
      ** Add the adjustment to the total and then initialise it.          100447
      *                                                                   100447
     C/COPY WNCPYSRC,DL1956C012
      *                                                                                       207275
      ** Add the adj for the 1st period only if Acc int to                                    207275
      ** control date is zero. This will exclude adj. for the                                 207275
      ** prior periods.                                                                       207275
     C           CFOTIN    IFEQ 'U'                                       100447
     C           UAITC     IFEQ 0                                                             207275
     C                     ADD  ##UADJ    CFAMNT                          100447
     C                     ENDIF                                                              207275
     C                     Z-ADD*ZERO     ##UADJ                          100447
     C                     ELSE                                           100447
     C           TAITC     IFEQ 0                                                             207275
     C                     ADD  ##TADJ    CFAMNT                          100447
     C                     ENDIF                                                              207275
     C                     Z-ADD*ZERO     ##TADJ                          100447
     C                     ENDIF                                          100447
     C/COPY WNCPYSRC,DL1956C013
      *                                                                   101577
      ** If the swap is capitalising, maintain a running total of the     101577
      **   cash-flow amounts to add to the principal.                     101577
      ** Include also processing methods 'A', 'I' if CIR006 is on.        CIR006
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     ADD  CFAMNT    ##INTC                          101577
     C                     ENDIF                                          101577
      *                                                                   100287
      ** If CIR002 is on, initialise the unsettled interest.              100287
      ** For CIR006, do this if interest processing method is             CIR006
      ** 'A', 'I' or 'L'.                                                 CIR006
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1956C017
      *                                                                   100287
     C           CFOTIN    IFEQ 'U'                                       100287
     C                     Z-ADD*ZEROS    ##OUSI                          100287
     C                     ELSE                                           100287
     C                     Z-ADD*ZEROS    ##TUSI                          100287
     C                     ENDIF                                          100287
      *                                                                   100287
     C                     Z-ADD*ZEROS    ##UNSI                          100287
      *                                                                   100287
     C                     ENDIF                                          100287
     C*
     C** CALCULATE NET PRESENT VALUE OF CASH FLOW AMOUNT
     C*
      *                                                                                       207276
      ** Add adjustment for accrued interest                                                  207276
      *                                                                                       207276
     C           @FNEW     IFEQ 'Y'                                                           207276
     C           UPAMT     SUB  TPAMT     @FINT  150                                          207276
     C           CFOTIN    IFEQ 'U'                                                           207276
     C           @FINT     ANDGT0                                                             207276
     C           CFOTIN    OREQ 'T'                                                           207276
     C           @FINT     ANDLT0                                                             207276
     C                     Z-SUB@FINT     @FINT                                               207276
     C                     ENDIF                                                              207276
     C                     ENDIF                                                              207276
      *                                                                                       207276
     C           DTYP      IFEQ 'RS'                                                          207277
     C           UPAMT     ANDEQTPAMT                                                         207277
     C                     Z-ADD*ZERO     @FINT                                               207277
     C                     ENDIF                                                              207277
      *                                                                                       CAS008
      ** Use Spot Days in the yield curve file in calculating for                             CAS008
      ** the spot dates.                                                                      CAS008
      *                                                                                       CAS008
     C           CAS008    IFEQ 'Y'                                                           CAS008
     C                     MOVELCFYLDC    WYLDC   5                                           CAS008
      *                                                                                       CAS008
      ** Access Yield Rates File                                                              CAS008
      *                                                                                       CAS008
     C           WYLDC     IFNE *BLANKS                                                       CAS008
     C                     MOVE CFCCY     KCCY                                                CAS008
     C                     MOVE CFINCL    KICM                                                CAS008
     C           KYLDR     CHAINSDYLDRL1             12                                       CAS008
      *                                                                                       CAS008
     C           *IN12     IFEQ *ON                                                           CAS008
      *                                                                                       CAS008
      ** If Yield Curve is applicable to all currencies                                       CAS008
      *                                                                                       CAS008
     C                     MOVE *BLANKS   KCCY                                                CAS008
     C           KYLDR     CHAINSDYLDRL1             12                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           *IN12     IFEQ *ON                                                           CAS008
     C                     Z-ADDA6SPDY    ZNRDYS                                              CAS008
     C                     ELSE                                                               CAS008
     C                     Z-ADDFSSPDY    ZNRDYS                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ELSE                                                               CAS008
     C                     Z-ADDA6SPDY    ZNRDYS                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     MOVE CFCCY     ZCCY                                                CAS008
     C                     MOVE *BLANKS   ZLOC                                                CAS008
     C                     Z-ADDBJRDNB    ZDAYNO                                              CAS008
     C                     EXSR ZFWDT                                                         CAS008
     C                     Z-ADDZDYNBR    ##SPDT                                              CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     EXSR CALNPV
      *                                                                                       CAS008
      ** Output cashflows to file RSCFLAPD and RXCFLAPD.                                      CAS008
      *                                                                                       CAS008
     C           CAS008    IFEQ 'Y'                                                           CAS008
     C           PICCB     ANDEQ'2'                                                           CAS008
     C           CAS008    OREQ 'Y'                                                           CAS008
     C           PICCB     ANDEQ'4'                                                           CAS008
      *                                                                                       CAS008
     C                     EXSR SRUCFF                                                        CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
     C*
     C** REPORT CASH FLOW
      ** only if cash flow is not zero                                                        225531
      ** or if rates/curves are missing                                                       229406
     C*
     C           CFAMNT    IFNE 0                                                             225531
     C           *IN30     ANDEQ*OFF                                                          229406
     C           *IN31     ANDEQ*OFF                                                          229406
     C           *IN30     OREQ *ON                                                           229406
     C           *IN31     OREQ *ON                                                           229406
      *                                                                                       227838
      ** Set on indicator if at least one cashflow is reported                                227838
      *                                                                                       227838
     C                     MOVE '1'       *IN35                                               227838
      *                                                                                       227838
     C                     EXSR REPCSF
     C                     ENDIF                                                              225531
     C*
     C** READ CASHFLOW EVENTS
     C*
     C                     READ DLCFEVD0                 LR*
     C/COPY WNCPYSRC,DL1956C027
     C                     END
     C*
     C** END OF PREVIOUS DEAL PROCESSING
     C*
     C           ##DLNO    IFNE *ZERO
     C                     EXSR PROTIN                     * OUR/THEIR
     C                     EXSR PRDEAL                     * DEAL
     C                     EXSR PRBOKC                     * BOOK
     C                     EXSR PRRCCY                     * REP.CCY
     C                     EXSR PRBRCA                     * BRANCH
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C** REPORT CASH FLOW
     C********************************************************************
     C           REPCSF    BEGSR
     C*
     C** 'OUR' PAYMENTS/NET PRESENT VALUE ARE OUTGOING IE SIGNED NEGATIVE
     C*
     C           CFOTIN    IFEQ 'U'
     C                     Z-SUBCFAMNT    CFAMNT
     C                     Z-SUBZNPOUT    ZNPOUT
     C                     END
     C*
     C** 'RATES MISSING'
     C*
      ** If capitalising swap, only final cash-flow will be NPV'd.        101577
      **                                                                  101577
      *                                                                   101577
     C           ZNPOUT    IFEQ *ZERO
     C           CFINPM    ANDNE'C'                                       101577
     C           CFINPM    ANDNE'K'                                       101577
     C           CFINPM    ANDNE'A'                                       CIR006
     C           CFINPM    ANDNE'I'                                       CIR006
     C           ##AMNT    ANDNE*ZERO                                                         216768
      *                                                                   101577
     C           ZNPOUT    OREQ *ZERO                                     101577
     C           CFINPM    ANDEQ'C'                                       101577
     C           CFNIPD    ANDEQMDAT                                      101577
     C           CFSPIN    ANDEQ' '                                       101577
     C           ##AMNT    ANDNE*ZERO                                                         216768
      *                                                                   101577
     C           ZNPOUT    OREQ *ZERO                                     101577
     C           CFINPM    ANDEQ'K'                                       101577
     C           CFNIPD    ANDEQMDAT                                      101577
     C           CFSPIN    ANDEQ' '                                       101577
     C           ##AMNT    ANDNE*ZERO                                                         216768
      *                                                                   101577
     C           ZNPOUT    OREQ *ZERO                                     CIR006
     C           CFINPM    ANDEQ'A'                                       CIR006
     C           CFNIPD    ANDEQMDAT                                      CIR006
     C           CFSPIN    ANDEQ' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           ##AMNT    ANDNE*ZERO                                                         216768
      *                                                                   CIR006
     C           ZNPOUT    OREQ *ZERO                                     CIR006
     C           CFINPM    ANDEQ'I'                                       CIR006
     C           CFNIPD    ANDEQMDAT                                      CIR006
     C           CFSPIN    ANDEQ' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           ##AMNT    ANDNE*ZERO                                                         216768
      *                                                                   CIR006
     C                     MOVE '1'       *IN30
      *                                                                   101577
     C                     END
      *                                                                                       CAS005
     C           CFYLDC    IFEQ *BLANK                                                        CAS005
     C           CAS005    ANDEQ'Y'                                                           237260
     C                     MOVE '1'       *IN31                                               CAS005
     C                     ENDIF                                                              CAS005
     C*
     C** DEAL NUMBER
     C*
     C                     MOVELCFDLNO    RDLNO
     C*
     C** OUR/THEIR NARRATIVE
     C*
     C                     MOVEL*BLANK    ROTNAR
     C           CFOTIN    IFEQ 'U'
     C                     MOVEL'OUR'     ROTNAR
     C                     ELSE
     C                     MOVEL'THEIR'   ROTNAR
     C                     END
     C*
     C** FIX/FLOATING NARRATIVE
     C*
     C           CFBRTT    IFNE *ZERO
     C                     MOVEL'FLOAT'   RFFNAR
     C                     ELSE
     C                     MOVEL'FIXED'   RFFNAR
     C                     END
     C*
     C** FROM DATE
     C*
     C                     Z-ADDCFSLIP    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RSLIP
     C*
     C** TO DATE
     C*
     C                     Z-ADDCFNIPD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RNIPD
     C*
     C** PAYMENT DATE
     C*
     C                     Z-ADDCFPYDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RPYDT
     C*
     C** CURRENCY
     C*
     C                     MOVELCFCCY     RCCY
     C*
     C** PRINCIPAL
     C*
     C           ##CSHF    IFEQ 'YES'
     C                     MOVE *BLANK    RPRIN
     C                     ELSE
     C                     Z-ADD##PCPL    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELDLCDP     ZDECS            * DEAL CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPRIN
     C                     END
     C*
     C** YIELD/DISCOUNT
     C*
     C           CFINPM    IFEQ 'D'
     C           CFINPM    OREQ 'Y'
     C                     MOVELCFINPM    RYLD
     C                     ELSE
     C                     MOVEL*BLANK    RYLD
     C                     END
     C*
     C** RATE
     C*
     C           ##CSHF    IFEQ 'YES'
     C                     MOVE *BLANK    RRATE
     C                     ELSE
     C*
     C** THE RATE IS EITHER A SPREAD OR AN EFFECTIVE INTEREST RATE
     C** (FROM THE DEAL ACTIVITY FILE)
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C           CFSPIN    IFNE *BLANK
     C                     MOVE CFRTSP    ZFLD15
     C                     ELSE
     C                     MOVE ##EINR    ZFLD15
     C                     END
     C                     MOVE ' '       ZECODE
     C                     MOVEL7         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RRATE
     C                     END
     C*
     C** ACTUAL/FORWARD/SPREAD
     C*
     C           ##CSHF    IFEQ 'YES'
     C                     MOVE *BLANK    RAFNAR
     C                     ELSE
     C           CFSPIN    IFEQ *BLANK
     C                     MOVEL##RTTP    RAFNAR
     C                     ELSE
     C                     MOVEL'S'       RAFNAR
     C                     END
     C                     END
     C*
     C** CASH FLOW AMOUNT
     C*
     C                     Z-ADDCFAMNT    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELDLCDP     ZDECS            * DEAL CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RAMNT
     C*
     C** NET PRESENT VALUE
     C*
      *                                                                   101577
      ** Output a blank if the amount is zero amd the swap is             101577
      **   capitalising.                                                  101577
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           ZNPOUT    ANDEQ*ZEROS                                    101577
     C           CFINPM    OREQ 'K'                                       101577
     C           ZNPOUT    ANDEQ*ZEROS                                    101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           ZNPOUT    ANDEQ*ZEROS                                    CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           ZNPOUT    ANDEQ*ZEROS                                    CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     MOVEL*BLANKS   RNPV                            101577
     C                     ELSE                                           101577
     C                     Z-ADDZNPOUT    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELDLCDP     ZDECS            * DEAL CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RNPV
     C                     ENDIF                                          101577
     C*
     C** WRITE DEAL DETAIL LINE
     C*
     C           P2LCNT    IFGE 57
     C                     WRITEPAGHD2
     C                     Z-ADD12        P2LCNT
     C                     END
     C           @FNEW     IFEQ 'Y'                                                           207276
     C                     EXSR SRXNEW                                                        207276
     C                     ENDIF                                                              207276
     C                     WRITEDDETL2
     C                     ADD  1         P2LCNT
      *                                                                                       207278
     C           CIR001    IFEQ 'Y'                                                           207278
     C********** CFBRTT    ANDEQ*ZEROS                                                 207278 228543
      *                                                                                       207278
     C           UPVD      IFNE *ZEROS                                                        207278
     C********** UPVD      ANDLE##EVCD                                                 207278 228543
     C           CFNIPD    ANDGEUPVD                                                          228543
     C           UPVD      ANDGECFSLIP                                                        228543
     C           UPVD      ANDGTBJRDNB                                                        228543
     C           RAFNAR    ANDNE'S'                                                           228543
      *                                                                                       228543
     C           UPPR      IFEQ 'P'                                                           228543
     C           CFOTIN    ANDEQ'U'                                                           228543
     C           UPPR      OREQ 'R'                                                           228543
     C           CFOTIN    ANDEQ'T'                                                           228543
     C                     EXSR SRUPVL                                                        207278
     C                     ENDIF                                                              228543
      *                                                                                       207278
     C********** CFSLIP    IFLE ##EVCD                                                 207278 228543
     C********** UPVD      ANDLE##EVCD                                                 208543 228543
     C**********           EXSR SRAMPM                                                 207278 228543
     C**********           ENDIF                                                       207278 228543
     C                     ENDIF                                                              207278
     C                     ENDIF                                                              207278
     C/COPY WNCPYSRC,DL1956C026
     C*
     C** ACCUMULATE NET PRESENT VALUE
     C*
     C           CFOTIN    IFEQ 'U'
     C                     ADD  ZNPOUT    ##UTOT
     C                     ELSE
     C                     ADD  ZNPOUT    ##TTOT
     C                     END
     C                     ENDSR
      *****************************************************************                       207276
      *                                                               *                       207276
      *  SRXNEW - Print a line for the adjustment of accrued int      *                       207276
      *                                                               *                       207276
      *****************************************************************                       207276
     C           SRXNEW    BEGSR                                                              207276
      *                                                                                       207276
      ** Save the current values of the detail line                                           207276
      *                                                                                       207276
     C                     MOVEL@FDTL2    @F111 111                                           207276
     C                     MOVEL'0'       @F2     2 P                                         207276
     C                     MOVE @F2       RPRIN     P                                         207276
     C                     MOVE @F2       RRATE     P                                         207276
     C                     MOVEL'A'       RAFNAR                                              207276
     C                     MOVEL*BLANKS   RNPV                                                207276
     C                     Z-ADDCFSLIP    ZDAYNO                                              207276
     C                     EXSR ZDATE2                                                        207276
     C                     MOVELZADATE    RNIPD                                               207276
     C                     MOVELZADATE    RPYDT                                               207276
      *                                                                                       207276
     C                     Z-ADDVDAT      ZDAYNO                                              207276
     C                     EXSR ZDATE2                                                        207276
     C                     MOVELZADATE    RSLIP                                               207276
      *                                                                                       207276
      ** Cash flow amount                                                                     207276
      *                                                                                       207276
     C                     Z-ADD@FINT     ZFLD15                                              207276
     C                     MOVE 'J'       ZECODE                                              207276
     C                     MOVELDLCDP     ZDECS                                               207276
     C                     EXSR ZSEDIT                                                        207276
     C                     MOVE ZOUT21    RAMNT                                               207276
      *                                                                                       207276
     C                     WRITEDDETL2                                                        207276
     C                     ADD  1         P2LCNT                                              207276
     C                     MOVEL@F111     @FDTL2                                              207276
     C                     MOVEL' '       @FNEW                                               207276
      *                                                                                       207276
     C                     ENDSR                                                              207276
     C*****************************************************************                       207276
      *                                                               *                       207278
      * SRUPVL - Amortize the Upfront fees and NPV the amortized amt  *                       207278
      *                                                               *                       207278
      *****************************************************************                       207278
     C           SRUPVL    BEGSR                                                              207278
      *                                                                                       207278
      ** Clear unrelated detail line fields.                                                  207278
      *                                                                                       207278
     C                     MOVE *BLANKS   RPRIN                                               207278
     C                     MOVE *BLANKS   RYLD                                                207278
     C                     MOVE *BLANKS   RRATE                                               207278
     C                     MOVEL'D'       RAFNAR                                              207278
      *                                                                                       207278
      ** Calculate amortisation total period                                                  207278
      *                                                                                       207278
     C           MDAT      SUB  UPVD      PER1    50                                          207278
      *                                                                                       207278
      ** Calculate amortisation per day                                                       207278
      *                                                                                       207278
     C           UPPR      IFEQ 'P'                                                           207278
     C           UPFE      MULT -1        UPFEX  130                                          207278
     C                     ELSE                                                               207278
     C                     Z-ADDUPFE      UPFEX                                               207278
     C                     END                                                                207278
     C           UPFEX     DIV  PER1      DACCR  130H                                         207278
      *                                                                                       207278
      ** Calculate the number of days in the whole period.                                    207278
      *                                                                                       207278
     C           UPVD      IFGT CFSLIP                                                        228543
     C           CFNIPD    SUB  UPVD      ##DEN                                               228543
     C                     Z-ADDUPVD      ZDAYNO                                              228543
     C                     EXSR ZDATE2                                                        228543
     C                     MOVELZADATE    RSLIP                                               228543
     C                     MOVELZADATE    RNIPD                                               228543
     C                     MOVELZADATE    RPYDT                                               228543
     C                     ELSE                                                               228543
     C           CFNIPD    SUB  CFSLIP    ##DEN   50                                          207278
     C                     ENDIF                                                              228543
      *                                                                                       207278
      ** Calculate total fee amortised in this period                                         207278
      *                                                                                       207278
     C           DACCR     MULT ##DEN     AMORT  130H                                         207278
      *                                                                                       207278
      ***Edit*amortised*upfront*fees***********************************                207278 228543
      ** Upfront fees should not be amortised.                                                228543
      *                                                                                       207278
     C**********           Z-ADDAMORT     ZFLD15                                       207278 228543
     C                     Z-ADDUPFEX     ZFLD15                                              228543
     C                     MOVE 'J'       ZECODE                                              207278
     C                     MOVELDLCDP     ZDECS                                               207278
     C                     EXSR ZSEDIT                                                        207278
     C                     MOVE ZOUT21    RAMNT                                               207278
      *                                                                                       207278
      ** Net present value                                                                    207278
      ** The NPV is the inverse of future interest income                                     207278
      *                                                                                       207278
     C**********           CALL 'DLZNPV'                                               228543 245132
     C                     CALL 'DLZNPV2'                                                     245132
     C                     PARM *BLANK    XNPRTC  5                                           228543
     C                     PARM CFCCY     XNPCCY  3        * CURRENCY                         228543
     C                     PARM CFINCL    XNPINC  1        * INT.CALC.METH.                   228543
     C                     PARM ##SPDT    XNPSDT  50       * SPOT DATE    100317              228543
     C                     PARM UPVD      XNPFDT  50       * FORWARD DATE                     228543
     C                     PARM *ZERO     XNPAMT 130       * AMOUNT       101577              228543
     C                     PARM *ZERO     XNPRAT 117                                          228543
     C                     PARM *ZERO     XNPDF  139                                          228543
     C                     PARM *ZERO     XNPOUT 130                                          228543
     C                     PARM           CFYLDC                                              228543
     C                     PARM           AS001C  1                                           245132
     C                     PARM           CAS008  1                                           245132
     C                     PARM           CIR004  1                                           245132
     C*                                                                                       228543
     C           XNPRTC    IFEQ '*ERR*'                                                       228543
     C                     MOVE 'DLZNPV  'DBFILE           ***************                    228543
     C                     Z-ADD091       DBASE            * DB ERROR 91 *                    228543
     C                     MOVELDLNO      DBKEY            ***************                    228543
     C                     EXSR *PSSR                                                         228543
     C                     END                                                                228543
      *                                                                                       228543
     C           XNPDF     IFNE *ZEROS                                                        228543
     C********** ZNPDF     IFNE *ZEROS                                                 223933 228543
     C********** AMORT     DIV  ZNPDF     NPAMOT 130H                                  207278 228543
     C           UPFEX     MULT XNPDF     NPAMOT 130H                                         228543
     C                     ELSE                                                               223933
     C                     Z-ADD*ZEROS    NPAMOT                                              223933
     C                     ENDIF                                                              223933
      *                                                                                       207278
      ** Output a blank if the amount is zero and the swap is                                 207278
      ** capitalising.                                                                        207278
      *                                                                                       207278
     C           CFINPM    IFEQ 'C'                                                           207278
     C           ZNPOUT    ANDEQ*ZEROS                                                        207278
     C           CFINPM    OREQ 'K'                                                           207278
     C           ZNPOUT    ANDEQ*ZEROS                                                        207278
     C                     MOVEL*BLANKS   RNPV                                                207278
     C                     ELSE                                                               207278
     C                     Z-ADDNPAMOT    ZFLD15                                              207278
     C                     MOVE 'J'       ZECODE                                              207278
     C                     MOVELDLCDP     ZDECS            * DEAL CCY DECP                    207278
     C                     EXSR ZSEDIT                                                        207278
     C                     MOVE ZOUT21    RNPV                                                207278
     C                     ENDIF                                                              207278
      *                                                                                       207278
     C                     WRITEDDETL2                                                        207278
     C                     ADD  1         P2LCNT                                              207278
      *                                                                                       207278
      ** Accumulate net present value                                                         207278
      *                                                                                       207278
     C           CFOTIN    IFEQ 'U'                                                           207278
     C                     ADD  NPAMOT    ##UTOT                                              207278
     C                     ELSE                                                               207278
     C                     ADD  NPAMOT    ##TTOT                                              207278
     C                     END                                                                207278
      *                                                                                       207278
     C                     ENDSR                                                              207278
      *****************************************************************                       207278
      /EJECT                                                                                  207278
      *****************************************************************                       207278
      *                                                               *                       207278
      * SRAMPM - Calculate the Amortized Premium or Discount for the  *                       207278
      *          current period                                       *                       207278
      *                                                               *                       207278
      *****************************************************************                       207278
      *                                                                                       207278
     C           SRAMPM    BEGSR                                                              207278
      *                                                                                       207278
      ** Calculate the number of days in period gone.                                         207278
      *                                                                                       207278
     C                     Z-ADDCFSLIP    ZZBEG                                               207278
     C                     Z-ADD##EVCD    ZZEND                                               207278
      *                                                                                       207278
      ** If accruing on first day, add one day to period.                                     207278
      *                                                                                       207278
     C           BKALDI    IFNE 'Y'                                                           207278
     C                     ADD  1         ZZEND                                               207278
     C                     ENDIF                                                              207278
      *                                                                                       207278
     C           ZZEND     SUB  ZZBEG     ##DAY   50                                          207278
      *                                                                                       207278
      ** Calculate total fee amortised in this period                                         207278
      *                                                                                       207278
     C           DACCR     MULT ##DAY     IAMT   130H                                         207278
      *                                                                                       207278
     C                     ENDSR                                                              207278
     C********************************************************************
     C/COPY WNCPYSRC,DL1956C006
      /SPACE 5
     C********************************************************************
     C* DETERMINE CASHFLOW AMOUNT
     C********************************************************************
     C           DETAMT    BEGSR
     C*
     C** DETERMINE PRINCIPAL & RATE AS AT LAST INTEREST PAYMENT DATE
     C*
     C                     Z-ADDCFDLNO    ACDLNO
     C                     MOVE CFOTIN    ACOTIN
     C**********           Z-ADDCFSLIP    ACPRDT                          100284
     C                     Z-ADD##SLIP    ACPRDT                          100284
     C           DLACTK    SETGTDLACTVD0
     C           DLACTP    REDPEDLACTVD0                 99*
     C*
     C           *IN99     IFEQ '1'
     C           DLACTK    SETLLDLACTVD0
     C           DLACTP    READEDLACTVD0                 99*
     C                     END
     C/COPY WNCPYSRC,DL1956C010
     C*
     C** SET PRINCIPAL & RATE AS AT LAST INTEREST PAYMENT DATE
     C** AND DATE INTEREST CALCULATED TO
     C*
     C                     Z-ADDACPCPL    ##PCPL 150
     C                     Z-ADDACEINR    ##EINR 117
     C                     MOVELACRTTP    ##RTTP  1
     C*
     C**********           Z-ADDCFSLIP    ##IACD  50                      100284
     C                     Z-ADD##SLIP    ##IACD  50                      100284
      *                                                                   101577
      ** Add the total interest capitalised to the principal for          101577
      **   capitalised swaps.                                             101577
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     ADD  ##INTC    ##PCPL                          101577
     C                     ENDIF                                          101577
     C*
     C** RESET TOTAL INTEREST
     C*
     C**********           Z-ADD*ZERO     ##TOTI 150                      101662
     C                     Z-ADD*ZERO     ##TOTI 150                                          193718
     C*
     C** REPOSITION POINTER TO AFTER RECORD JUST READ
     C*
     C           DLACTK    SETGTDLACTVD0
     C*
     C** READ FROM THE DEAL ACTIVITY FILE
     C*
     C           DLACTP    READEDLACTVD0                 99*
     C*
     C** READ UP TO CASHFLOW NEXT INTEREST PAYMENT DATE
     C*
     C           *IN99     DOWEQ'0'
     C********** ACPRDT    ANDLTCFNIPD                                    100284
     C           ACPRDT    ANDLT##INED                                    100284
     C*
     C** CALCULATE INTEREST FROM LAST DATE TO DEAL ACTIVITY DATE.
     C** RATE USED IS EFFECTIVE INTEREST RATE OFF DEAL ACTIVITY
     C** FILE IF CASH FLOW EVENT IS NOT A SPREAD PAYMENT.
     C** OTHERWISE, THE SPREAD RATE IS USED.
     C*
     C***********          Z-ADD##PCPL    ZDLAMT                                              207272
     C                     Z-ADD##PCPL    ZIAMT                                               207272
      *                                                                                       CIR014
      ** If CIR014 is on, replace principal amount with new principal                         CIR014
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           F1NPRI    ANDNE##PCPL                                                        CIR014
      *                                                                                       CIR014
     C           ACPRDT    IFGT UNIPD                                                         CIR014
     C           F1PRVI    ANDEQ'O'                                                           CIR014
     C           ACPRDT    ORGT TNIPD                                                         CIR014
     C           F1PRVI    ANDEQ'T'                                                           CIR014
     C                     Z-ADDF1NPRI    ZIAMT                                               CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     ENDIF                                                              CIR014
      *                                                                   100287
      ** If CIR002 is on, add unsettled interest to amount.               100287
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1956C018
     C***********          ADD  ##UNSI    ZDLAMT                                       100287 207272
     C                     ADD  ##UNSI    ZIAMT                                               207272
     C                     ENDIF                                          100287
      *                                                                   100287
     C           CFSPIN    IFEQ *BLANK
     C***********          Z-ADD##EINR    ZDLRAT                                              207272
     C                     Z-ADD##EINR    ZIRATE                                              207272
     C                     ELSE
     C***********          Z-ADDCFRTSP    ZDLRAT                                              207272
     C                     Z-ADDCFRTSP    ZIRATE                                              207272
     C                     END
     C***********          Z-ADD##IACD    ZCBSDT                                              207272
     C***********          Z-ADDACPRDT    ZCBEDT                                              207272
     C***********          MOVELCFINCL    ZCBCBS                                              207272
     C                     Z-ADD##IACD    ZIBEG                                               207272
     C                     Z-ADDACPRDT    ZIEND                                               207272
     C                     MOVELCFINCL    ZICALC                                              207272
     C/COPY WNCPYSRC,DL1956C024
     C           CFINPM    IFNE 'Y'
     C***********          EXSR ZDLINT                     * DISC./INT.                       207272
     C                     EXSR GLINTC                     * DISC./INT.                       207272
     C                     ELSE
     C                     EXSR CALIYD                     * YIELD
     C                     END
     C*
     C***********          ADD  ZDLOUT    ##TOTI                                              207272
     C                     ADD  ZINTR     ##TOTI    H                                         207274
      *                                                                   100287
      ** If CIR002 is on, and record was a change of interest rate,       100287
      **   maintain the unsettled interest.                               100287
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           ACEINR    ANDNE##EINR                                    100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C           ACEINR    ANDNE##EINR                                    CIR006
     C/COPY WNCPYSRC,DL1956C019
     C                     Z-ADD##TOTI    ##UNSI                          100287
     C                     ENDIF                                          100287
     C/COPY WNCPYSRC,DL1956C007
      *                                                                   100287
     C*
     C** SET PRINCIPAL & RATE
     C** AND DATE INTEREST CALCULATED TO
     C*
     C                     Z-ADDACPCPL    ##PCPL
     C                     Z-ADDACEINR    ##EINR
     C                     MOVELACRTTP    ##RTTP
     C                     Z-ADDACPRDT    ##IACD
      *                                                                   101577
      ** Add the total interest capitalised to the principal for          101577
      **   capitalised swaps.                                             101577
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     ADD  ##INTC    ##PCPL                          101577
     C                     ENDIF                                          101577
     C*
     C** READ FROM THE DEAL ACTIVITY FILE
     C*
     C           DLACTP    READEDLACTVD0                 99*
     C                     END
     C*
     C** CALCULATE INTEREST FROM LAST DATE TO NEXT INTEREST PAYMENT DATE
     C** RATE USED IS EFFECTIVE INTEREST RATE OFF DEAL ACTIVITY
     C** FILE IF CASH FLOW EVENT IS NOT A SPREAD PAYMENT.
     C** OTHERWISE, THE SPREAD RATE IS USED.
     C*
     C********** ##IACD    IFLT CFNIPD                                    100284
     C           ##IACD    IFLT ##INED                                    100284
     C**********           Z-ADD##PCPL    ZDLAMT                                              207272
     C                     Z-ADD##PCPL    ZIAMT                                               207272
      *                                                                   100287
      ** If CIR002 is on, add unsettled interest to amount.               100287
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1956C020
     C**********           ADD  ##UNSI    ZDLAMT                                       100287 207272
     C                     ADD  ##UNSI    ZIAMT                                               207272
     C                     ENDIF                                          100287
      *                                                                   100287
     C           CFSPIN    IFEQ *BLANK
     C**********           Z-ADD##EINR    ZDLRAT                                              207272
     C                     Z-ADD##EINR    ZIRATE                                              207272
     C                     ELSE
     C**********           Z-ADDCFRTSP    ZDLRAT                                              207272
     C                     Z-ADDCFRTSP    ZIRATE                                              207272
     C                     END
     C**********           Z-ADD##IACD    ZCBSDT                                              207272
     C                     Z-ADD##IACD    ZIBEG                                               207272
     C**********           Z-ADDCFNIPD    ZCBEDT                          100284
     C**********           Z-ADD##INED    ZCBEDT                                       100284 207272
     C                     Z-ADD##INED    ZIEND                                               207272
     C**********           MOVELCFINCL    ZCBCBS                                              207272
     C                     MOVELCFINCL    ZICALC                                              207272
     C/COPY WNCPYSRC,DL1956C025
     C           CFINPM    IFNE 'Y'
     C**********           EXSR ZDLINT                     * DISC./INT.                       207272
     C                     EXSR GLINTC                     * DISC./INT.                       207272
     C                     ELSE
     C                     EXSR CALIYD                     * YIELD
     C                     END
     C**********           ADD  ZDLOUT    ##TOTI                                       100284 207272
     C                     ADD  ZINTR     ##TOTI    H                                  207272 207274
     C                     END
     C*
     C** SET CASHFLOW AMOUNT
     C*
     C                     Z-ADD##TOTI    CFAMNT
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           DTYP      ANDEQ'RX'                                                          CIR014
     C           F1PRVR    ANDNE0                                                             CIR014
     C           *IN41     ANDEQ*ON                                                           CIR014
      *                                                                                       CIR014
      ** Ours                                                                                 CIR014
      *                                                                                       CIR014
     C           F1PRVI    IFEQ 'O'                                                           CIR014
     C           CFOTIN    ANDEQ'U'                                                           CIR014
     C           UNIPD     ANDEQCFNIPD                                                        CIR014
     C           UINPM     ANDNE'C'                                                           CIR014
     C           UINPM     ANDNE'K'                                                           CIR014
     C           UINPM     ANDNE'A'                                                           CIR014
     C           UINPM     ANDNE'I'                                                           CIR014
     C                     ADD  F1PCHA    CFAMNT                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
      ** Theirs                                                                               CIR014
      *                                                                                       CIR014
     C           F1PRVI    IFEQ 'T'                                                           CIR014
     C           CFOTIN    ANDEQ'T'                                                           CIR014
     C           TNIPD     ANDEQCFNIPD                                                        CIR014
     C           TINPM     ANDNE'C'                                                           CIR014
     C           TINPM     ANDNE'K'                                                           CIR014
     C           TINPM     ANDNE'A'                                                           CIR014
     C           TINPM     ANDNE'I'                                                           CIR014
     C                     ADD  F1PCHA    CFAMNT                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       225531
      ** If forward rate is zero, this means that no valid combination                        225531
      ** exists.  Report this as 'Rates Missing'.                                             225531
      *                                                                                       225531
     C           ##RTTP    IFEQ 'F'                                                           225531
     C           ##EINR    ANDEQ0                                                             225531
     C                     MOVE '1'       *IN30                                               225531
     C                     ENDIF                                                              225531
      *                                                                                       225531
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* NEW BRANCH PROCESSING
     C********************************************************************
     C           NWBRCA    BEGSR
     C*
     C** OPEN PRINTER FILES & LOG TO RCF
     C*
      *
     C                     OPEN DL1956P1
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM           WPARM   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
      *
     C                     OPEN DL1956P2
      *
     C                     Z-ADDSFNUM2    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM           WPARM   3
     C                     PARM           SFILE2
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C** GET BRANCH NAME
     C*
     C**********           MOVE CFBRCA    @BRCA                           100963
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C**********           PARM           @BRCA   3                       100963
     C                     PARM           CFBRCA                          100963
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDBRCHPD'DBFILE           ***************
     C                     Z-ADD010       DBASE            * DB ERROR 10 *
     C**********           MOVEL@BRCA     DBKEY            ***************100963
     C                     MOVELCFBRCA    DBKEY            ***************100963
     C                     EXSR *PSSR
     C                     END
      *                                                                   100963
      ** Set up branch fields for output.                                 100963
      *                                                                   100963
     C                     MOVELCFBRCA    RBRCA                           100963
     C                     MOVELA8BRNM    RBRNM                           100963
     C*
     C** RESET BRANCH TOTAL
     C*
     C                     Z-ADD*ZERO     #BRTOT 150
     C                     Z-ADD*ZERO     @BRTOT 150                      100284
     C                     Z-ADD*ZERO     @CYTOT                          100284
     C                     Z-ADD*ZERO     @BKTOT                          100284
      *                                                                   100284
      ** Reset currency control field for new branch.                     100284
      *                                                                   100284
     C                     MOVEL*BLANKS   @RCCY                           100284
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* END OF PREVIOUS BRANCH PROCESSING
     C********************************************************************
     C           PRBRCA    BEGSR
     C**********                                                         100963
     C***CLOSE*PRINTER FILES IF NOT LAST RECORD PROCESSING               100963
     C**********                                                         100963
     C********** *INLR     IFEQ '0'                                      100963
     C**********           CLOSEDL1956P1                                 100963
     C**********           CLOSEDL1956P2                                 100963
     C**********           END                                           100963
     C*
     C** FORMAT BRANCH FOR OUTPUT
     C*
     C                     MOVEL@BRCA     RBRCA1
     C*
     C** FORMAT BRANCH TOTAL FOR OUTPUT
     C*
     C                     Z-ADD#BRTOT    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELBSCDP     ZDECS            * BASE CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RBRTOT
     C*                                                                   100284
     C                     Z-ADD@BRTOT    ZFLD15                          100284
     C                     MOVE 'J'       ZECODE                          100284
     C                     MOVELBSCDP     ZDECS            * BASE CCY DECP100284
     C                     EXSR ZSEDIT                                    100284
     C                     MOVE ZOUT21    ZBRTOT                          100284
     C*
     C** OUTPUT BRANCH TOTAL
     C*
     C           P1LCNT    IFGE 54
     C                     MOVEL@BRCA     RBRCA                           100963
     C                     WRITEPAGHD1
     C                     Z-ADD12        P1LCNT
     C                     END
     C                     WRITEBRTOT1
     C                     ADD  4         P1LCNT
     C*                                                                  100963
     C** CLOSE PRINTER FILES IF NOT LAST RECORD PROCESSING               100963
     C*                                                                  100963
     C           *INLR     IFEQ '0'                                      100963
     C                     WRITEENDBRC1                                  137276
     C                     WRITEENDBRC2                                  137276
     C                     CLOSEDL1956P1                                 100963
     C                     CLOSEDL1956P2                                 100963
     C                     ELSE                                          137276
     C                     WRITEENDRPT1                                  137276
     C                     WRITEENDRPT2                                  137276
     C                     END                                           100963
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* NEW REPORT CURRENCY PROCESSING
     C********************************************************************
     C           NWRCCY    BEGSR
     C*
     C** GET REPORT CURRENCY DETAILS
     C*
     C                     MOVELCFRCCY    @RCCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           @RCCY   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCURRPD'DBFILE           ***************
     C                     Z-ADD011       DBASE            * DB ERROR 11 *
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *                                                                   100963
      ** Set up currency fields for output.                               100963
      *                                                                   100963
     C                     MOVELCFRCCY    RRCCY                           100963
     C                     MOVELA6CYNM    RCYNM                           100963
     C/COPY WNCPYSRC,DL1956C028
     C*
     C** OUTPUT NEW PAGE FOR CURRENCY
     C*
     C                     WRITEPAGHD1
     C                     Z-ADD12        P1LCNT
     C*
     C                     WRITEPAGHD2
     C                     Z-ADD12        P2LCNT
     C*
     C                     Z-ADDA6NBDP    RPCDP   10
     C*
     C** RESET CURRENCY TOTAL
     C*
     C                     Z-ADD*ZERO     #CYTOT 150
     C                     Z-ADD*ZERO     @CYTOT 150                      100284
     C                     Z-ADD*ZERO     #BKTOT                          100284
     C                     Z-ADD*ZERO     @BKTOT                          100284
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* END OF PREVIOUS REPORT CURRENCY PROCESSING
     C********************************************************************
     C           PRRCCY    BEGSR
     C*
     C** FORMAT CURRENCY FOR OUTPUT
     C*
     C                     MOVEL@RCCY     RRCCY1
     C*
     C** FORMAT CURRENCY TOTAL FOR OUTPUT
     C*
     C                     Z-ADD#CYTOT    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELRPCDP     ZDECS            * REP CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RCYTOT
     C*                                                                   100284
     C                     Z-ADD@CYTOT    ZFLD15                          100284
     C                     MOVE 'J'       ZECODE                          100284
     C                     MOVELRPCDP     ZDECS            * REP CCY DECP 100284
     C                     EXSR ZSEDIT                                    100284
     C                     MOVE ZOUT21    ZCYTOT                          100284
     C*
     C** OUTPUT CURRENCY TOTAL
     C*
     C           P1LCNT    IFGE 54
     C                     MOVEL@RCCY     RRCCY                           100963
     C                     WRITEPAGHD1
     C                     Z-ADD12        P1LCNT
     C                     END
     C                     WRITECYTOT1
     C                     ADD  4         P1LCNT
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* NEW (DEAL) CURRENCY PROCESSING
     C********************************************************************
     C           NWCCY     BEGSR
     C*
     C** GET (DEAL) CURRENCY DETAILS
     C*
     C                     MOVELCFCCY     @CCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCURRPD'DBFILE           ***************
     C                     Z-ADD012       DBASE            * DB ERROR 12 *
     C                     MOVEL@CCY      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6NBDP    DLCDP   10
     C                     MOVELA6DICB    DLINCL  1
      *                                                                   100317
      ** Calculate the currency spot date.                                100317
      *                                                                   100317
     C           CAS008    IFNE 'Y'                                                           CAS008
     C                     MOVE CFCCY     ZCCY                            100317
     C                     MOVE *BLANKS   ZLOC                            100317
     C                     Z-ADDBJRDNB    ZDAYNO                          100317
     C                     Z-ADDA6SPDY    ZNRDYS                          100317
     C                     EXSR ZFWDT                                     100317
     C                     Z-ADDZDYNBR    ##SPDT  50                      100317
     C                     ENDIF                                                              CAS008
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* NEW BOOK PROCESSING
     C********************************************************************
     C           NWBOKC    BEGSR
     C                     MOVELCFBOKC    @BOKC   2
     C*
     C** RESET BOOK TOTAL
     C*
     C                     Z-ADD*ZERO     #BKTOT 150
     C                     Z-ADD*ZERO     @BKTOT 150                      100284
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* END OF PREVIOUS BOOK PROCESSING
     C********************************************************************
     C           PRBOKC    BEGSR
     C*
     C** FORMAT BOOK FOR OUTPUT
     C*
     C                     MOVEL@BOKC     RBOKC1
     C*
     C** FORMAT BOOK TOTAL FOR OUTPUT
     C*
     C                     Z-ADD#BKTOT    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELRPCDP     ZDECS            * REP CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RBKTOT
     C*                                                                   100284
     C                     Z-ADD@BKTOT    ZFLD15                          100284
     C                     MOVE 'J'       ZECODE                          100284
     C                     MOVELRPCDP     ZDECS            * REP CCY DECP 100284
     C                     EXSR ZSEDIT                                    100284
     C                     MOVE ZOUT21    ZBKTOT                          100284
     C*
     C** OUTPUT BOOK TOTAL
     C*
     C           P1LCNT    IFGE 54
     C                     WRITEPAGHD1
     C                     Z-ADD12        P1LCNT
     C                     END
     C                     WRITEBKTOT1
     C                     ADD  4         P1LCNT
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C** END OF PREVIOUS OUR/THEIR INDICATOR
     C********************************************************************
     C           PROTIN    BEGSR
     C/COPY WNCPYSRC,DL1956C008
     C*
     C** FORMAT APPROPRIATE TOTAL FOR OUTPUT
     C*
     C           ##OTIN    IFEQ 'U'
     C                     Z-ADD##UTOT    ZFLD15
     C                     ELSE
     C                     Z-ADD##TTOT    ZFLD15
     C                     END
     C                     MOVE 'J'       ZECODE
     C                     MOVELDLCDP     ZDECS            * DEAL CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    ROTTOT
     C*
     C** WRITE OUR/THEIR TOTAL LINE
     C*
     C           P2LCNT    IFGE 57
     C                     WRITEPAGHD2
     C                     Z-ADD12        P2LCNT
     C                     END
      *                                                                                       227838
      ** Print Our/Their Totals only if cashflows were written                                227838
      *                                                                                       227838
     C           *IN35     IFEQ '1'                                                           227838
      *                                                                                       227838
     C                     WRITEOTTOT2
     C                     ADD  1         P2LCNT
      *                                                                                       227838
     C                     ENDIF                                                              227838
      *                                                                                       227838
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C** NEW DEAL PROCESSING
     C********************************************************************
     C           NWDEAL    BEGSR
     C                     Z-ADD*ZERO     ##UTOT 150
     C                     Z-ADD*ZERO     ##TTOT 150
     C                     Z-ADD*ZEROS    IAMT   130       AMORT. PRM                         207278
      *                                                                   CIR006
      ** Determine compounding interest for CIR006                        CIR006
      *                                                                   CIR006
     C           CIR006    IFEQ 'Y'                                       CIR006
      *                                                                   CIR006
     C           CFINPM    IFEQ 'A'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CFINPM    OREQ 'L'                                       CIR006
     C                     MOVE 'Y'       WCMPN   1                       CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       WCMPN                           CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C                     ENDIF                                          CIR006
     C*
     C** GET DEAL
     C*
     C           CFDLNO    CHAINDEALSDGF             99    *
     C           *IN99     IFEQ '1'
     C                     MOVE 'DEALSDG 'DBFILE           ***************
     C                     Z-ADD013       DBASE            * DB ERROR 13 *
     C                     MOVELCFDLNO    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C           DTYP      ANDEQ'RX'                                                          CIR014
      *                                                                                       CIR014
      ** Retrieve extention file                                                              CIR014
      *                                                                                       CIR014
     C                     MOVE CFDLNO    DLNOA   6                                           CIR014
     C           DLNOA     CHAINDLDEALL5             99                                       CIR014
      *                                                                                       CIR014
     C           *IN99     IFNE '0'                                                           CIR014
     C                     MOVEL'DLDEALL5'DBFILE           ***************                    CIR014
     C                     Z-ADD27        DBASE            * DB ERROR 27 *                    CIR014
     C                     MOVELDLNOA     DBKEY            ***************                    CIR014
     C                     EXSR *PSSR                                                         CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
     C*
     C** GET OUR CURRENCY DETAILS USED FOR BASE CCY CONVERSION
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*KEY    '@OPTN
     C                     PARM           UCUCY
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCURRPD'DBFILE           ***************
     C                     Z-ADD014       DBASE            * DB ERROR 14 *
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6NBDP    UDCDP   10
     C                     MOVELA6MDIN    UDMDIN  1
     C                     Z-ADDA6SPRT    UDSPRT 138
     C*
     C** GET THEIR CURRENCY DETAILS USED FOR BASE CCY CONVERSION
     C*
     C           DTYP      IFEQ 'RX'
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM           TCUCY
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCURRPD'DBFILE           ***************
     C                     Z-ADD015       DBASE            * DB ERROR 15 *
     C                     MOVEL@RCCY     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
     C                     END
     C*
     C                     Z-ADDA6NBDP    TDCDP   10
     C                     MOVELA6MDIN    TDMDIN  1
     C                     Z-ADDA6SPRT    TDSPRT 138
      *                                                                   100284
      ** Initiase the total of accrued interest for the deal.             100284
      *                                                                   100284
     C                     Z-ADD*ZERO     ##UACR 150                      100284
     C                     Z-ADD*ZERO     ##TACR 150                      100284
      *                                                                   100447
      ** If no accrual will be posted in tonight's COB, set the           100447
      **   adjustment to that already posted only.                        100447
      *                                                                   100447
     C           BKAPDT    IFGT ##EVCD                                    100447
     C                     Z-ADDTAIAP     ##TADJ 150                      100447
     C                     Z-ADDUAIAP     ##UADJ 150                      100447
     C                     ELSE                                           100447
     C           TAIAP     ADD  TAIAN     ##TADJ                          100447
      *                                                                   186412
      **  Needed to reset TAIAP and TAIAN as they are used later to       186412
      **  recalculate ##TADJ                                              186412
      *                                                                   186412
     C           TNIPD     IFLT BJRDNB                                    186412
     C                     Z-ADD0         TAIAP                           186412
     C                     Z-ADD0         TAIAN                           186412
     C                     Z-ADD0         ##TADJ                          186412
     C                     ENDIF                                          186412
     C           UAIAP     ADD  UAIAN     ##UADJ                          100447
      *                                                                   186412
      **  Needed to reset UAIAP and UAIAN as they are used later to       186412
      **  recalculate ##UADJ                                              186412
      *                                                                   186412
     C           UNIPD     IFLT BJRDNB                                    186412
     C                     Z-ADD0         UAIAP                           186412
     C                     Z-ADD0         UAIAN                           186412
     C                     Z-ADD0         ##UADJ                          186412
     C                     ENDIF                                          186412
     C                     ENDIF                                          100447
      *                                                                   100287
      ** If CIR002 is on, initialise unsettled interest.                  100287
      *                                                                   100287
     C           CIR002    IFEQ 'Y'                                       100287
     C           CIR006    OREQ 'Y'                                       CIR006
     C           WCMPN     ANDEQ'Y'                                       CIR006
     C/COPY WNCPYSRC,DL1956C021
     C           OUSI      ADD  OUSA      ##OUSI 150                      100287
     C           TUSI      ADD  TUSA      ##TUSI 150                      100287
     C                     Z-ADD*ZEROS    ##UNSI 150                      100287
     C                     ENDIF                                          100287
      *                                                                   100287
     C*
     C** INCREMENT COUNT OF DEALS READ
     C*
     C                     ADD  1         RNORE
     C*
     C** RESET 'RATES MISSING' INDICATOR
     C*
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31                                               CAS005
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C** END OF PREVIOUS DEAL PROCESSING
     C********************************************************************
     C           PRDEAL    BEGSR
     C*
     C** DEAL NUMBER
     C*
     C                     MOVELDLNO      RDLNO
     C                     MOVELDLNO      RDLNO1                          100284
     C*
     C** COUNTERPARTY & NAME
     C*
     C                     MOVELCNUM      RCNUM
     C                     MOVELCNUM      @CUNR
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CUNR  10
     C                     PARM *BLANK    @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCUSTPD'DBFILE           ***************
     C                     Z-ADD016       DBASE            * DB ERROR 16 *
     C                     MOVEL@CUNR     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C** BOOK CODE
     C*
     C                     MOVELBOKC      RBOKC
     C*
     C** DEAL VALUE DATE
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RVDAT
     C*
     C** DEAL MATURITY DATE
     C*
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    RMDAT
     C*
     C** DEAL PRINCIPAL(S) AND CURRENCIES
     C*
     C                     Z-ADDUPAMT     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELUDCDP     ZDECS            * OUR CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RUPAMT
     C                     MOVE UCUCY     RUCUCY
     C           DTYP      IFEQ 'RX'
     C                     Z-ADDTPAMT     ZFLD15
     C                     MOVELTDCDP     ZDECS            * THEIR CCY DECP
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RTPAMT
     C                     MOVE TCUCY     RTCUCY
     C                     ELSE
     C                     MOVE *BLANK    RTPAMT
     C                     MOVE *BLANK    RTCUCY
     C                     END
     C/COPY WNCPYSRC,DL1956C001
     C**********                                                          100284
     C***OUR/THEIR SPOT RATES                                             100284
     C**********                                                          100284
     C**********           Z-ADD*ZERO     ZFLD15                          100284
     C**********           MOVE UDSPRT    ZFLD15                          100284
     C**********           MOVE ' '       ZECODE                          100284
     C**********           MOVEL8         ZDECS                           100284
     C**********           EXSR ZSEDIT                                    100284
     C**********           MOVE ZOUT21    RUDSPR                          100284
     C**********           MOVE '  '      RUDSPR                          100284
     C**********           MOVE UDMDIN    RUDSPR                          100284
     C**********                                                          100284
     C**********           MOVE *BLANK    RTDSPR                          100284
     C********** DTYP      IFEQ 'RX'                                      100284
     C**********           Z-ADD*ZERO     ZFLD15                          100284
     C**********           MOVE TDSPRT    ZFLD15                          100284
     C**********           MOVE ' '       ZECODE                          100284
     C**********           MOVEL8         ZDECS                           100284
     C**********           EXSR ZSEDIT                                    100284
     C**********           MOVE ZOUT21    RTDSPR                          100284
     C**********           MOVE '  '      RTDSPR                          100284
     C**********           MOVE TDMDIN    RTDSPR                          100284
     C**********           END                                            100284
     C*
     C** CONVERT OUR & THEIR TOTALS TO BASE CURRENCY AT SPOT RATE
     C*
     C                     EXSR CNVTOT
     C*
     C** DEAL TOTAL = OUR + THEIR TOTAL (CONVERTED TO BASE IF 'RX' DEAL)
     C*
     C           DTYP      IFEQ 'RX'
     C           ##OTOB    ADD  ##TTOB    ##TOT            * BASE CCY EQ.
     C           ##TTAB    SUB  ##OTAB    ##ACR            * BASE CCY EQ. 100284
     C                     ELSE
     C           ##UTOT    ADD  ##TTOT    ##TOT  150
     C           ##TACR    SUB  ##UACR    ##ACR  150                      100284
     C                     END
      ***** INCLUDE ADJUSTMENT FOR THE ACCRUED INTEREST IN THE CALCS                          207276
     C           @FNEW2    IFEQ 'Y'                                                           207276
     C                     ADD  @FINT     ##ACR                                               207276
     C                     MOVEL' '       @FNEW2                                              207276
     C                     ENDIF                                                              207276
      *  Including the amortized premium or discount in this period                           207278
     C                     ADD  IAMT      ##ACR                                               207278
      *                                                                                       CAS005
      ** Separately calculate the Unrealised P/L and Accrued Interest                         CAS005
      ** sides if CAS005 is enabled and Deal Type = 'RX'.                                     CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           DTYP      ANDEQ'RX'                                                          CAS005
      *                                                                                       CAS005
     C                     Z-ADD*ZERO     WUACR                                               CAS005
     C                     Z-ADD*ZERO     WTACR                                               CAS005
     C********** ##UTOT    ADD  ##UACR    WUURL  150                                   CAS005 226170
     C********** ##TTOT    SUB  ##TACR    WTURL  150                                   CAS005 226170
     C**********           SUB  ##UACR    WUACR  150                                   CAS005 226170
     C**********           ADD  ##TACR    WTACR  150                                   CAS005 226170
      *                                                                                       226170
      ** FSUURL and FSTURL should be in base ccy for RX deals.                                226170
      *                                                                                       226170
     C           ##OTOB    ADD  ##OTAB    WUURL  150                                          226170
     C           ##TTOB    SUB  ##TTAB    WTURL  150                                          226170
     C                     SUB  ##OTAB    WUACR  150                                          226170
     C                     ADD  ##TTAB    WTACR  150                                          226170
      *                                                                                       CAS005
     C           CFOTIN    IFEQ 'U'                                                           CAS005
     C                     ADD  IAMT      WUURL                                               CAS005
     C                     ADD  IAMT      WUACR                                               CAS005
     C                     ELSE                                                               CAS005
     C                     ADD  IAMT      WTURL                                               CAS005
     C                     ADD  IAMT      WTACR                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                   100284
      ** Calculate adjusted total.                                        100284
      *                                                                   100284
     C           ##TOT     SUB  ##ACR     ##ADJ  150                      100284
     C*
     C** IF 'RATES MISSING' - REPORT NO VALUE
     C*
     C           *IN30     IFEQ '1'
     C           *IN31     OREQ '1'                                                           CAS005
     C                     Z-ADD*ZERO     ##TOT
     C                     Z-ADD*ZERO     ##OTOB
     C                     Z-ADD*ZERO     ##TTOB
     C                     Z-ADD*ZERO     ##ADJ                           100284
     C                     Z-ADD*ZERO     ##OTAB                          100284
     C                     Z-ADD*ZERO     ##TTAB                          100284
     C                     END
     C*
     C** FORMAT DEAL TOTAL FOR OUTPUT
     C*
     C                     Z-ADD##TOT     ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     MOVELRPCDP     ZDECS            * REP CCY DECPL
     C                     EXSR ZSEDIT                     (=BASE CCY IF
     C                     MOVE ZOUT21    RDTOT              RX DEAL)
     C/COPY WNCPYSRC,DL1956C029
      *                                                                   100284
      ** Format total accrual for output.                                 100284
      *                                                                   100284
     C                     Z-ADD##ACR     ZFLD15                          100284
     C                     MOVE 'J'       ZECODE                          100284
     C                     MOVELRPCDP     ZDECS            * REP CCY DECPL100284
     C                     EXSR ZSEDIT                     (=BASE CCY IF  100284
     C                     MOVE ZOUT21    RDACR              RX DEAL)     100284
      *                                                                   100284
      ** Format adjusted total for output.                                100284
      *                                                                   100284
     C                     Z-ADD##ADJ     ZFLD15                          100284
     C                     MOVE 'J'       ZECODE                          100284
     C                     MOVELRPCDP     ZDECS            * REP CCY DECPL100284
     C                     EXSR ZSEDIT                     (=BASE CCY IF  100284
     C                     MOVE ZOUT21    RDADJ              RX DEAL)     100284
     C/COPY WNCPYSRC,DL1956C015
     C*
     C** WRITE DEAL TOTAL LINE TO DL1956P1
     C*
     C           P1LCNT    IFGE 56
     C                     WRITEPAGHD1
     C                     Z-ADD12        P1LCNT
     C                     END
     C                     WRITEDTOT1
     C                     ADD  2         P1LCNT
     C*
     C** WRITE DEAL TOTAL LINE TO DL1956P2
     C*
     C********** P2LCNT    IFGE 55                                        100284
     C           P2LCNT    IFGE 51                                        100284
     C                     WRITEPAGHD2
     C                     Z-ADD12        P2LCNT
     C                     END
      *                                                                                       CGL187
     C           CGL187    IFEQ 'Y'                                                           CGL187
      *                                                                                       CGL187
     C           PSXCY     IFEQ 'S'                                                           CGL187
     C                     MOVELRDLNO     REDLNO                                              CGL187
     C                     MOVELRUCUCY    RECCY                                               CGL187
     C                     Z-ADD##ACR     REDACR                                              CGL187
     C                     WRITEDLIRSCD0                                                      CGL187
     C                     ENDIF                                                              CGL187
      *                                                                                       CGL187
     C                     ENDIF                                                              CGL187
      *                                                                                       CGL187
     C                     WRITEDTOT2
     C**********           ADD  3         P2LCNT                          100284
     C                     ADD  7         P2LCNT                          100284
     C*
     C** ACCUMMULATE TOTALS
     C*
     C**********           ADD  ##OTOB    #BRTOT           * BASE CCY EQ. 100284
     C**********           ADD  ##TTOB    #BRTOT           * BASE CCY EQ. 100284
     C**********           ADD  ##TOT     #CYTOT                          100284
     C**********           ADD  ##TOT     #BKTOT                          100284
     C           DTYP      IFEQ 'RS'                                                          207277
     C                     SUB  @FINT     #BRTOT           * BASE CCY EQ.                     207277
     C                     ENDIF                                                              207277
      *                                                                   100284
     C                     ADD  ##OTOB    #BRTOT           * BASE CCY EQ. 100284
     C                     ADD  ##TTOB    #BRTOT           * BASE CCY EQ. 100284
     C                     ADD  ##OTAB    #BRTOT           * BASE CCY EQ. 100284
     C                     SUB  ##TTAB    #BRTOT           * BASE CCY EQ. 100284
     C                     ADD  ##ADJ     #CYTOT                          100284
     C                     ADD  ##ADJ     #BKTOT                          100284
     C                     ADD  ##OTOB    @BRTOT           * BASE CCY EQ. 100284
     C                     ADD  ##TTOB    @BRTOT           * BASE CCY EQ. 100284
     C                     ADD  ##TOT     @CYTOT                          100284
     C                     ADD  ##TOT     @BKTOT                          100284
     C*
     C** UPDATE UNREALIZED P/L ON DEAL IF PROGRAM RUN IN COB
     C*
     C********** PICCB     IFEQ 'C'                                                           228922
     C           PICCB     IFEQ '1'                                                           228922
     C           CAS004    ANDEQ'N'                                                           CAS004
     C           PICCB     OREQ '2'                                                           CAS004
     C           CAS004    ANDEQ'Y'                                                           CAS004
     C           PICCB     OREQ '4'                                                           CAS004
     C           CAS004    ANDEQ'Y'                                                           CAS004
     C           DLNO      CHAINDEALSUF              99    *
     C           *IN99     IFEQ '1'
     C                     MOVE 'DEALSDG 'DBFILE           ***************
     C                     Z-ADD017       DBASE            * DB ERROR 17 *
     C                     MOVELDLNO      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *                                                                   100284
      ** Use adjusted amount for output to deals file.                    100284
      *                                                                   100284
     C**********           Z-ADD##TOT     UNRL                            100284
     C                     Z-ADD##ADJ     UNRL                            100284
      *                                                                                       CAS005
      ** Save the separated Unrealised Profit and Loss sides if CAS005                        CAS005
      ** is enabled, Deal Type = 'RX', and UNRL <> zero.                                      CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
     C           DTYP      ANDEQ'RX'                                                          CAS005
     C           UNRL      ANDNE*ZERO                                                         CAS005
     C                     Z-ADDWUURL     FSUURL                                              CAS005
     C                     Z-ADDWTURL     FSTURL                                              CAS005
     C                     ELSE                                                               CAS005
     C                     Z-ADD*ZERO     FSUURL                                              CAS005
     C                     Z-ADD*ZERO     FSTURL                                              CAS005
     C                     Z-ADD*ZERO     WUURL                                               CAS005
     C                     Z-ADD*ZERO     WTURL                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C/COPY WNCPYSRC,DL1956C014
     C                     EXCPTUDEAL
     C*
     C                     END
      *                                                                                       CAS002
      ***Store*information*from*Summary*Report*to*IRNPVLPD*************                CAS002 CAS005
      ** Store information from Summary Report to IRNPVAPD                                    CAS005
      *                                                                                       CAS002
     C           CAS002    IFEQ 'Y'                                                           CAS002
     C********** PICCB     ANDEQ'C'                                                    CAS002 228922
     C           PICCB     ANDEQ'1'                                                           228922
     C           CAS004    ANDEQ'N'                                                           CAS004
     C           PICCB     OREQ '2'                                                           CAS004
     C           CAS004    ANDEQ'Y'                                                           CAS004
     C           PICCB     OREQ '4'                                                           CAS004
     C           CAS004    ANDEQ'Y'                                                           CAS004
      *                                                                                       CAS002
     C                     MOVE RDLNO     KDLNO   60                                          CAS002
      *                                                                                       CAS005
      ** Separately capture IR Rev. CIRS and SIRS if CAS005 is enabled.                       CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
     C                     SELEC                                                              CAS005
     C           DTYP      WHEQ 'RS'                                                          CAS005
     C           KDLNO     CHAINIRNPVAL0             77                                       CAS005
     C           DTYP      WHEQ 'RX'                                                          CAS005
     C           KDLNO     CHAINRXNPVAL0             77                                       CAS005
     C                     ENDSL                                                              CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C********** KDLNO     CHAINIRNPVLL0             77                                CAS002 CAS005
     C           KDLNO     CHAINIRNPVAL0             77                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           *IN77     IFEQ '1'                                                           CAS002
     C                     MOVE RBRCA     IRBRCA                                              CAS002
     C                     MOVE RUCUCY    IRCYCD                                              CAS002
     C                     MOVE RBOKC     IRBOKC                                              CAS002
     C                     MOVE DTYP      IRDTYP                                              CAS002
     C                     MOVE DLST      IRDLST                                              CAS002
     C                     MOVE CLAS      IRCLAS                                              CDL038
     C                     MOVE RDLNO     IRDLNO                                              CAS002
     C                     MOVE RCNUM     IRCNUM                                              CAS002
     C                     MOVE FSOYLC    IRYLDC                                              CAS002
     C                     Z-ADDUPAMT     IRPAMT                                              CAS002
     C                     Z-ADD##TOT     IRNPVA                                              CAS002
     C                     Z-ADD##ACR     IRAINT                                              CAS002
     C                     Z-ADD##ADJ     IRURPL                                              CAS002
     C                     Z-ADD0         IRPUPL                                              CAS002
     C                     Z-ADDIRURPL    IRTUPL                                              CAS002
     C                     Z-ADD0         IRYUPL                                              CAS002
     C********** DTYP      IFEQ 'RX'                                                   CAS002 CAS005
     C**********           MOVE FSTYLC    IRTYLC                                       CAS002 CAS005
     C**********           Z-ADDTPAMT     IRTAMT                                       CAS002 CAS005
     C**********           ELSE                                                        CAS002 CAS005
     C**********           MOVE *BLANKS   IRTYLC                                       CAS002 CAS005
     C**********           Z-ADD0         IRTAMT                                       CAS002 CAS005
     C**********           ENDIF                                                       CAS002 CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
     C                     SELEC                                                              CAS005
     C           DTYP      WHEQ 'RS'                                                          CAS005
     C                     WRITEIRNPVAD0                                                      CAS005
     C           DTYP      WHEQ 'RX'                                                          CAS005
      *                                                                                       CAS005
      ** Separately write the 'Our' and 'Their' information if Deal                           CAS005
      ** Type = 'RX'.                                                                         CAS005
      *                                                                                       CAS005
     C                     Z-ADDUPAMT     IRPAMT                                              CAS005
     C**********           Z-ADD##UTOT    IRNPVA                                       CAS005 226170
     C                     Z-ADD##OTOB    IRNPVA                                              226170
     C                     Z-ADDWUURL     IRURPL                                              CAS005
     C                     Z-ADDWUACR     IRAINT                                              CAS005
     C                     Z-ADDIRURPL    IRTUPL                                              CAS005
     C                     WRITERXNPVAD0                                                      CAS005
      *                                                                                       CAS005
     C                     MOVE RTCUCY    IRCYCD                                              CAS005
     C                     Z-ADDTPAMT     IRPAMT                                              CAS005
     C**********           Z-ADD##TTOT    IRNPVA                                       CAS005 226170
     C                     Z-ADD##TTOB    IRNPVA                                              226170
     C                     Z-ADDWTURL     IRURPL                                              CAS005
     C                     Z-ADDWTACR     IRAINT                                              CAS005
     C                     Z-ADDIRURPL    IRTUPL                                              CAS005
     C                     WRITERXNPVAD0                                                      CAS005
      *                                                                                       CAS005
     C                     ENDSL                                                              CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C**********           WRITEIRNPVLD0                                               CAS002 CAS005
     C                     WRITEIRNPVAD0                                                      CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS002
     C                     MOVE DLST      IRDLST                                              CDL038
     C                     MOVE CLAS      IRCLAS                                              CDL038
     C                     Z-ADDUPAMT     IRPAMT                                              CAS002
     C                     Z-ADD##TOT     IRNPVA                                              CAS002
     C                     Z-ADD##ACR     IRAINT                                              CAS002
     C                     Z-ADDIRURPL    IRPUPL                                              CAS002
     C                     Z-ADD##ADJ     IRURPL                                              CAS002
     C                     Z-ADDIRURPL    IRTUPL                                              CAS002
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
     C                     SELEC                                                              CAS005
     C           DTYP      WHEQ 'RS'                                                          CAS005
     C                     UPDATIRNPVAD0                                                      CAS005
     C           DTYP      WHEQ 'RX'                                                          CAS005
      *                                                                                       CAS005
      ** Separately update the NPV sides if Deal Type = 'RX'.                                 CAS005
      *                                                                                       CAS005
     C**********           Z-ADD##UTOT    IRNPVA                                       CAS005 226170
     C                     Z-ADD##OTOB    IRNPVA                                              226170
     C                     Z-ADDWUURL     IRURPL                                              CAS005
     C                     Z-ADDIRURPL    IRTUPL                                              CAS005
     C                     Z-ADDWUACR     IRAINT                                              CAS005
     C                     UPDATRXNPVAD0                                                      CAS005
      *                                                                                       CAS005
     C           KDLNO     READERXNPVAL0                 77                                   CAS005
     C**********           Z-ADD##TTOT    IRNPVA                                       CAS005 226170
     C                     MOVE DLST      IRDLST                                              CDL038
     C                     MOVE CLAS      IRCLAS                                              CDL038
     C                     Z-ADD##TTOB    IRNPVA                                              226170
     C                     Z-ADDIRURPL    IRPUPL                                              CAS005
     C                     Z-ADDWTURL     IRURPL                                              CAS005
     C                     Z-ADDIRURPL    IRTUPL                                              CAS005
     C                     Z-ADDWTACR     IRAINT                                              CAS005
      *                                                                                       CAS005
     C           *IN77     IFEQ *OFF                                                          CAS005
     C                     UPDATRXNPVAD0                                                      CAS005
     C                     ELSE                                                               CAS005
     C                     MOVEL'RXNPVAPD'DBFILE                                              CAS005
     C                     MOVELDLNO      DBKEY                                               CAS005
     C                     Z-ADD24        DBASE                                               CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDSL                                                              CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C**********           UPDATIRNPVLD0                                               CAS002 CAS005
     C                     UPDATIRNPVAD0                                                      CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS002
     C                     ENDIF                                                              CAS002
      *                                                                                       CAS002
     C/COPY WNCPYSRC,DL1956C002
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C********************************************************************
     C* CALCULATE NET PRESENT VALUE OF AN AMOUNT
     C********************************************************************
     C           CALNPV    BEGSR
      *                                                                   101577
      ** For capitalised swaps, only NPV the final total cash-flow.       101577
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           CFNIPD    ANDEQMDAT                                      101577
     C           CFSPIN    ANDEQ' '                                       101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFNIPD    ANDEQMDAT                                      101577
     C           CFSPIN    ANDEQ' '                                       101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CFNIPD    ANDEQMDAT                                      CIR006
     C           CFSPIN    ANDEQ' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CFNIPD    ANDEQMDAT                                      CIR006
     C           CFSPIN    ANDEQ' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     Z-ADD##INTC    ##AMNT                          101577
     C           @FNEW1    IFEQ 'Y'                                                           207276
     C           CFOTIN    IFEQ 'T'                                                           207276
     C                     ADD  @FINT     ##AMNT                                              207276
     C                     ELSE                                                               207276
     C                     SUB  @FINT     ##AMNT                                              207276
     C                     ENDIF                                                              207276
     C                     MOVEL' '       @FNEW1  1                                           207276
     C                     ENDIF                                                              207276
     C                     ELSE                                           101577
     C                     Z-ADDCFAMNT    ##AMNT                          101577
     C                     ENDIF                                          101577
      *                                                                   101577
      ** For capitalised swaps, only NPV the final total cash-flow.       101577
      *                                                                   101577
     C           CFINPM    IFEQ 'C'                                       101577
     C           CFNIPD    ANDLTMDAT                                      101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFNIPD    ANDLTMDAT                                      101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CFNIPD    ANDLTMDAT                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CFNIPD    ANDLTMDAT                                      CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
      *                                                                   CIR006
     C           CFINPM    OREQ 'C'                                       101577
     C           CFSPIN    ANDNE' '                                       101577
     C           CFINPM    OREQ 'K'                                       101577
     C           CFSPIN    ANDNE' '                                       101577
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CFSPIN    ANDNE' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C           CFINPM    OREQ 'I'                                       CIR006
     C           CFSPIN    ANDNE' '                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
     C                     Z-ADD0         ZNPOUT                          101577
     C                     ELSE                                           101577
      *                                                                   100298
      ** If cash-flow payment date is prior to the spot date, do not      100298
      **   NPV the amount.                                                100298
      *                                                                   100298
     C           CFPYDT    IFLE ##SPDT                                    100298
     C**********           Z-ADDCFAMNT    ZNPOUT                    100298101577
     C                     Z-ADD##AMNT    ZNPOUT                          101577
     C                     ELSE                                           100298
      *                                                                   100298
     C**********           CALL 'DLZNPV'                                                      245132
     C                     CALL 'DLZNPV2'                                                     245132
     C                     PARM *BLANK    ZNPRTC  5
     C                     PARM CFCCY     ZNPCCY  3        * CURRENCY
     C                     PARM CFINCL    ZNPINC  1        * INT.CALC.METH.
     C**********           PARM BJRDNB    ZNPSDT  50       * SPOT DATE    100317
     C                     PARM ##SPDT    ZNPSDT  50       * SPOT DATE    100317
     C                     PARM CFPYDT    ZNPFDT  50       * FORWARD DATE
     C**********           PARM CFAMNT    ZNPAMT 130       * AMOUNT       101577
     C                     PARM ##AMNT    ZNPAMT 130       * AMOUNT       101577
     C                     PARM *ZERO     ZNPRAT 117
     C**********           PARM *ZERO     ZNPDF  119                                          208939
     C                     PARM *ZERO     ZNPDF  139                                          208939
     C                     PARM *ZERO     ZNPOUT 130
     C                     PARM           CFYLDC                                              CAS001
     C                     PARM           AS001C  1                                           245132
     C                     PARM           CAS008  1                                           245132
     C                     PARM           CIR004  1                                           245132
     C/COPY WNCPYSRC,DL1956C011
     C*
     C           ZNPRTC    IFEQ '*ERR*'
     C                     MOVE 'DLZNPV  'DBFILE           ***************
     C                     Z-ADD090       DBASE            * DB ERROR 90 *
     C                     MOVELDLNO      DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *                                                                   100298
     C                     ENDIF                                          100298
      *                                                                   100298
     C                     ENDIF                                          101577
      *                                                                   101577
     C                     ENDSR
     C**************************************************************************
     C/COPY WNCPYSRC,DL1956C009
      /SPACE 5
     C**************************************************************************
     C* CALCULATE INTEREST ON A YIELD BASIS
     C********************************************************************
     C           CALIYD    BEGSR
     C*
     C* INITIALIZE FIELDS
     C*
     C***********          Z-ADDZDLAMT    ZDLAMT                                              207272
     C***********          Z-ADDZDLRAT    ZDLRAT                                              207272
     C***********          Z-ADD*ZERO     ZDLOUT                                              207272
     C                     Z-ADDZIAMT     ZIAMT                                               207272
     C                     Z-ADDZIRATE    ZIRATE                                              207272
     C                     Z-ADD*ZERO     ZINTR                                               207272
     C*
     C* FIND NO. OF DAYS IN PERIOD AND YEAR
     C*
     C**********           EXSR ZCBDYS                                                        207272
     C                     Z-ADDZIBEG     ZZBEG                                               207272
     C                     Z-ADDZIEND     ZZEND                                               207272
     C                     MOVE ZICALC    ZZCALC                                              207272
     C                     EXSR ZINTDY                                                        207272
      *                                                                                       207272
     C                     Z-ADD1         ZCBDIV  30                                          207272
      *                                                                                       207272
      ***  365 Days - Calculation Basis = 1 or 4.                                             207272
      *                                                                                       207272
     C           ZZCALC    IFEQ '1'                                                           207272
     C           ZZCALC    OREQ '4'                                                           207272
     C           ZZCALC    OREQ '9'                                                           CIR013
     C           #29FEB    ANDEQ'N'                                                           CIR013
     C                     Z-ADD365       ZCBDIV                                              207272
     C                     END                                                                207272
      *                                                                                       207272
      ***  360 Days - Calculation Basis = 2, 3 or 5.                                          207272
      *                                                                                       207272
     C           ZZCALC    IFEQ '2'                                                           207272
     C           ZZCALC    OREQ '3'                                                           207272
     C           ZZCALC    OREQ '5'                                                           207272
     C                     Z-ADD360       ZCBDIV                                              207272
     C                     END                                                                207272
      *                                                                                       207272
      ***  366 Days - Calculation Basis = 6.                                                  207272
      *                                                                                       207272
     C           ZZCALC    IFEQ '6'                                                           207272
     C           ZZCALC    OREQ '9'                                                           CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C                     Z-ADD366       ZCBDIV                                              207272
     C                     END                                                                207272
     C*
     C** INTEREST = PRINCIPAL ( 1 - 1 / ( 1 + RATE X NUMBER OF DAYS/360))
     C**       I.E. PRINCIPAL ( 1 - 360 / ( 360 + RATE X NUMBER OF DAYS))
     C*
     C           ZCBDIV    MULT 100       ZIWRK3  50
     C*
     C********** ZCBDAY    MULT ZDLRAT    ZIWRK4 157                                          207272
     C           ZZCALC    IFEQ '6'                                                           CIR013
     C           ZZCALC    OREQ '9'                                                           CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C           INT6DY    MULT ZIRATE    ZIWRK4 157                                          CIR013
     C                     ELSE                                                               CIR013
     C           ZZINDY    MULT ZIRATE    ZIWRK4 157                                          207272
     C                     ENDIF                                                              CIR013
     C                     ADD  ZIWRK3    ZIWRK4
     C*
     C           ZIWRK4    IFNE *ZERO
     C           ZIWRK3    DIV  ZIWRK4    ZIWRK5 159H
     C           1         SUB  ZIWRK5    ZIWRK5
     C********** ZDLAMT    MULT ZIWRK5    ZDLOUT    H                                         207272
     C           ZIAMT     MULT ZIWRK5    ZINTR     H                                         207272
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C**************************************************************************
     C* CONVERT OUR & THEIR TOTALS TO BASE CURRENCY AT SPOT RATE
     C*****************************************************************
      *
     C           CNVTOT    BEGSR
     C*
     C                     Z-ADD*ZERO     ##OTOB 150
     C                     Z-ADD*ZERO     ##TTOB 150
     C                     Z-ADD*ZERO     ##OTAB 150                      100284
     C                     Z-ADD*ZERO     ##TTAB 150                      100284
     C*
     C** CONVERT OUR TOTAL TO BASE CURRENCY
     C*
     C           ##UTOT    IFNE *ZERO
     C                     Z-ADD##UTOT    ZAMTCI
     C                     Z-ADDUDCDP     ZCDPI
     C                     Z-ADDBSCDP     ZCDPO
     C                     Z-ADDUDSPRT    ZEXCH
     C                     MOVE UDMDIN    ZMD
     C                     EXSR ZCONVN
     C                     Z-ADDZAMTCO    ##OTOB
     C                     END
     C*
     C** CONVERT THEIR TOTAL TO BASE CURRENCY
     C*
     C           ##TTOT    IFNE *ZERO
     C                     Z-ADD##TTOT    ZAMTCI
     C                     Z-ADDTDCDP     ZCDPI
     C                     Z-ADDBSCDP     ZCDPO
     C                     Z-ADDTDSPRT    ZEXCH
     C                     MOVE TDMDIN    ZMD
     C                     EXSR ZCONVN
     C                     Z-ADDZAMTCO    ##TTOB
     C                     END
      *                                                                   100284
      ** Convert our total accrual to base currency.                      100284
      *                                                                   100284
     C           ##UACR    IFNE *ZERO                                     100284
     C                     Z-ADD##UACR    ZAMTCI                          100284
     C                     Z-ADDUDCDP     ZCDPI                           100284
     C                     Z-ADDBSCDP     ZCDPO                           100284
     C                     Z-ADDUDSPRT    ZEXCH                           100284
     C                     MOVE UDMDIN    ZMD                             100284
     C                     EXSR ZCONVN                                    100284
     C                     Z-ADDZAMTCO    ##OTAB                          100284
     C                     END                                            100284
      *                                                                   100284
      ** Convert their total accrual to base currency.                    100284
      *                                                                   100284
     C           ##TACR    IFNE *ZERO                                     100284
     C                     Z-ADD##TACR    ZAMTCI                          100284
     C                     Z-ADDTDCDP     ZCDPI                           100284
     C                     Z-ADDBSCDP     ZCDPO                           100284
     C                     Z-ADDTDSPRT    ZEXCH                           100284
     C                     MOVE TDMDIN    ZMD                             100284
     C                     EXSR ZCONVN                                    100284
     C                     Z-ADDZAMTCO    ##TTAB                          100284
     C                     END                                            100284
      *                                                                   100284
     C                     ENDSR
     C********************************************************************
      /SPACE 5
     C**************************************************************************
     C* PRODUCE AUDIT REPORT AND END PROGRAM
     C*****************************************************************
      *
     C           AUDIT     BEGSR
     C/COPY WNCPYSRC,DL1956C003
     C*
     C** OPEN AUDIT PRINTER FILE & LOG TO RCF
     C*
     C                     OPEN DL1956AU
     C*
     C                     Z-ADDSFNUMU    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM *BLANKS   WPARM
     C                     PARM           SFILEU
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END
     C*
     C** Output Report Header and File Controls.
     C*
     C                     WRITEHEADAU
     C                     WRITECONTROL
     C*
     C***  If there is a DB Error, Output the DB Error Information.
     C*
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
     C*
     C***  Or, if no valid records read, Output "No Details" message.
     C*
     C           RNORE     IFEQ *ZERO
     C                     WRITENODTLS
     C                     END
     C                     END
     C*
     C***  End Program and Return.
     C*
     C                     SETON                     LR
     C                     RETRN
     C*
     C                     ENDSR
     C*****************************************************************
      /SPACE 5
     C********************************************************************
     C* INITIAL PROCESSING
     C********************************************************************
     C           INIT      BEGSR
      *
      ***  Receive Parameter List:
      ***   PSXCY - ('S' or 'X'), Single or Cross Currency.
      ***   PICCB - ('I' or 'C'), Input Cycle or Close of Business.
      *
     C           *ENTRY    PLIST
     C                     PARM           PSXCY   1
     C                     PARM           PICCB   1
     C                     PARM           SEQ     5
     C/COPY WNCPYSRC,DL1956C023
     C*
     C** SINGLE CURRENCY/CROSS CURRENCY ?
     C*
     C           PSXCY     IFEQ 'X'
     C                     MOVE '1'       *IN10
     C                     END
     C*
     C** KEY LISTS FOR ACCESS OF DEAL ACTIVITY
     C*
     C           DLACTK    KLIST
     C                     KFLD           ACDLNO
     C                     KFLD           ACOTIN
     C                     KFLD           ACPRDT
     C*
     C           DLACTP    KLIST
     C                     KFLD           ACDLNO
     C                     KFLD           ACOTIN
      *                                                                                       CAS008
      ** Key lists for Yield Rate file                                                        CAS008
      *                                                                                       CAS008
     C           KYLDR     KLIST                                                              CAS008
     C                     KFLD           WYLDC                                               CAS008
     C                     KFLD           KCCY    3                                           CAS008
     C                     KFLD           KICM    1                                           CAS008
      *
      ** CALL ACCESS PROGRAM FOR BANK DETAILS
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR  '@RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDBANKPD'DBFILE           ***************
     C                     Z-ADD001       DBASE            * DB ERROR 01 *
     C                     MOVEL@OPTN     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ** GET BASE CURRENCY DECIMAL PLACES
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*KEY    '@OPTN   7
     C                     PARM           BJCYCD
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDCURRPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            * DB ERROR 02 *
     C                     MOVELBJCYCD    DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C                     Z-ADDA6NBDP    BSCDP   10
      *
      **  Set Date Format Indicator
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
      *                                                                   100284
      ** Call access program for General Ledger details.                  100284
      *                                                                   100284
     C**********           CALL 'AOGELRR0'                                100284              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR  '@RTCD   7                       100284
     C                     PARM '*FIRST  '@OPTN   7                       100284
     C********** SDGELR    PARM SDGELR    DSFDY                           100284              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   100284
     C           @RTCD     IFNE *BLANK                                    100284
     C                     MOVE 'SDGELRPD'DBFILE           ***************100284
     C                     Z-ADD018       DBASE            * DB ERROR 18 *100284
     C                     MOVEL@OPTN     DBKEY            ***************100284
     C                     EXSR *PSSR                                     100284
     C                     END                                            100284
      *                                                                                       CAS004
      ** Check if Hedge Accounting is installed                                               CAS004
      *                                                                                       CAS004
     C                     CALL 'AOSARDR0'                                                    CAS004
     C                     PARM *BLANKS   PRTCD                                               CAS004
     C                     PARM '*VERIFY' POPTN                                               CAS004
     C                     PARM 'CAS004'  PSARD                                               CAS004
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS004
      *                                                                                       CAS004
     C           PRTCD     IFEQ *BLANKS                                                       CAS004
     C                     MOVE 'Y'       CAS004  1                                           CAS004
     C                     MOVE *ON       *IN40                                               CAS004
     C                     ELSE                                                               CAS004
     C                     MOVE 'N'       CAS004                                              CAS004
     C                     MOVE *OFF      *IN40                                               CAS004
     C           PRTCD     IFNE '*NRF   '                                                     CAS004
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS004
     C                     Z-ADD22        DBASE                                               CAS004
     C                     MOVEL'CAS004'  DBKEY                                               CAS004
     C                     EXSR *PSSR                                                         CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                   100284
      ** Calculate the event control date.                                100284
      *                                                                   100284
     C           BJDNWD    SUB  1         ##EVCD  50                      100284
     C                     Z-ADD##EVCD    WEVCD   50                                          CAS004
      *                                                                   100284
     C           CAS004    IFEQ 'N'                                                           CAS004
     C           BKANWD    IFEQ '2'                                       100284
     C           BKAPDT    ANDLT##EVCD                                    100284
     C                     Z-ADDBKAPDT    ##EVCD                          100284
     C                     ENDIF                                          100284
     C                     ELSE                                                               CAS004
     C           BKAPDT    IFLT ##EVCD                                                        CAS004
     C           PICCB     ANDNE'I'                                                           CAS004
     C                     Z-ADDBKAPDT    ##EVCD                                              CAS004
     C                     ENDIF                                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                   100287
      ** Call access program for Switchable Features.                     100287
      *                                                                   100287
     C                     CALL 'AOSARDR0'                                100287
     C                     PARM *BLANKS   @RTCD                           100287
     C                     PARM '*VERIFY' @OPTN                           100287
     C                     PARM 'CIR002'  @SARD   6                       100287
     C           SCSARD    PARM SCSARD    DSFDY                           100287
      *                                                                   100287
     C           @RTCD     IFEQ *BLANK                                    100287
     C                     MOVEL'Y'       CIR002  1                       100287
     C                     ELSE                                           100287
      *                                                                   100287
     C           @RTCD     IFEQ '*NRF    '                                100287
     C                     MOVEL'N'       CIR002                          100287
     C                     ELSE                                           100287
      *                                                                   100287
     C                     MOVE 'SCSARDPD'DBFILE           ***************100287
     C                     Z-ADD019       DBASE            * DB ERROR 19 *100287
     C                     MOVEL'CIR002'  DBKEY            ***************100287
     C                     EXSR *PSSR                                     100287
     C                     ENDIF                                          100287
     C                     ENDIF                                          100287
      *                                                                   CIR006
      ** Check if switchable feature CIR006 is switched on                CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY' @OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD   6                       CIR006
     C           SCSARD    PARM SCSARD    DSFDY                           CIR006
     C*                                                                   CIR006
     C           @RTCD     IFNE *BLANK                                    CIR006
     C           @RTCD     ANDNE'*NRF   '                                 CIR006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CIR006
     C                     Z-ADD20        DBASE            * DB ERROR 20 *CIR006
     C                     MOVEL'CIR006'  DBKEY            ***************CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                                       CAS002
      ** Check if switchable feature CAS002 is switched on                                    CAS002
      *                                                                                       CAS002
     C           *NAMVAR   DEFN           LDA                                                 CAS002
      *                                                                                       CAS002
     C                     CALL 'AOSARDR0'                                                    CAS002
     C                     PARM *BLANKS   PRTCD   7                                           CAS002
     C                     PARM '*VERIFY' POPTN   7                                           CAS002
     C                     PARM 'CAS002'  PSARD   6                                           CAS002
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS002
      *                                                                                       CAS002
     C           PRTCD     IFNE *BLANK                                                        CAS002
     C           PRTCD     ANDNE'*NRF   '                                                     CAS002
     C           *LOCK     IN   LDA                                                           CAS002
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS002
     C                     Z-ADD21        DBASE                                               CAS002
     C                     MOVEL'CAS002'  DBKEY                                               CAS002
     C                     OUT  LDA                                                           CAS002
     C                     EXSR *PSSR                                                         CAS002
     C                     ENDIF                                                              CAS002
      *                                                                                       CAS002
     C           PRTCD     IFEQ *BLANKS                                                       CAS002
     C                     MOVE 'Y'       CAS002  1                                           CAS002
     C                     ELSE                                                               CAS002
     C                     MOVE 'N'       CAS002                                              CAS002
     C                     ENDIF                                                              CAS002
      *                                                                                       CAS002
      ** Access switchable features file for CGL187                                           CGL187
      *                                                                                       CGL187
     C                     CALL 'AOSARDR0'                                                    CGL187
     C                     PARM *BLANKS   @RTCD                                               CGL187
     C                     PARM '*VERIFY' @OPTN                                               CGL187
     C                     PARM 'CGL187'  @SARD                                               CGL187
      *                                                                                       CGL187
     C                     MOVE 'N'       CGL187  1                                           CGL187
     C           @RTCD     IFEQ *BLANK                                                        CGL187
     C                     MOVE 'Y'       CGL187                                              CGL187
     C                     OPEN DLIRSCPD                                                      CGL187
     C                     ENDIF                                                              CGL187
      *                                                                                       CGL187
     C                     CALL 'AOSARDR0'                                                    207278
     C                     PARM *BLANKS   @RTCD                                               207278
     C                     PARM '*VERIFY' @OPTN                                               207278
     C                     PARM 'CIR001'  @SARD   6                                           207278
     C           SCSARD    PARM SCSARD    DSFDY                                               207278
      *                                                                                       207278
     C           @RTCD     IFEQ *BLANK                                                        207278
     C                     MOVEL'Y'       CIR001  1                                           207278
     C                     ELSE                                                               207278
     C           @RTCD     IFEQ '*NRF    '                                                    207278
     C                     MOVEL'N'       CIR001                                              207278
     C                     ELSE                                                               207278
      *                                                                                       207278
     C                     MOVE 'SCSARDPD'DBFILE           ***************                    207278
     C                     Z-ADD022       DBASE            * DB ERROR 20 *                    207278
     C                     MOVEL'CIR001'  DBKEY            ***************                    207278
     C                     EXSR *PSSR                                                         207278
     C                     ENDIF                                                              207278
     C                     ENDIF                                                              207278
      *                                                                                       CAS005
      ** Access SAR details to see if CAS005 is enabled.                                      CAS005
      *                                                                                       CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY' POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS005
      *                                                                                       CAS005
     C                     MOVE 'N'       CAS005  1                                           CAS005
     C           PRTCD     IFEQ *BLANK                                                        CAS005
     C                     MOVE 'Y'       CAS005                                              CAS005
     C                     ELSE                                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE '*NRF'                                                        CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS005
     C                     Z-ADD23        DBASE                                               CAS005
     C                     MOVEL'CAS005'  DBKEY                                               CAS005
     C                     OUT  LDA                                                           CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS008
      ** Access SAR details to see if CAS008 is enabled.                                      CAS008
      *                                                                                       CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   PRTCD                                               CAS008
     C                     PARM '*VERIFY' POPTN                                               CAS008
     C                     PARM 'CAS008'  PSARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C                     MOVE 'N'       CAS008  1                                           CAS008
     C           PRTCD     IFEQ *BLANK                                                        CAS008
     C                     MOVE 'Y'       CAS008                                              CAS008
     C                     ELSE                                                               CAS008
      *                                                                                       CAS008
     C           PRTCD     IFNE '*NRF'                                                        CAS008
     C           *LOCK     IN   LDA                                                           CAS008
     C                     MOVE 'SCSARDPD'DBFILE                                              CAS008
     C                     Z-ADD25        DBASE                                               CAS008
     C                     MOVEL'CAS008'  DBKEY                                               CAS008
     C                     OUT  LDA                                                           CAS008
     C                     EXSR *PSSR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CIR014
      ** Determine if Mark to Market Cross-currency Interest Rate Swaps is switched on.       CIR014
      *                                                                                       CIR014
     C                     MOVE *BLANK    CIR014  1                                           CIR014
     C                     CALL 'AOSARDR0'                                                    CIR014
     C                     PARM *BLANKS   PRTCD                                               CIR014
     C                     PARM '*VERIFY' POPTN                                               CIR014
     C                     PARM 'CIR014'  PSARD                                               CIR014
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR014
      *                                                                                       CIR014
     C           PRTCD     IFEQ *BLANKS                                                       CIR014
     C                     MOVE 'Y'       CIR014                                              CIR014
     C                     ELSE                                                               CIR014
     C           PRTCD     IFNE '*NRF   '                                                     CIR014
     C                     Z-ADD26        DBASE                                               CIR014
     C                     MOVEL'CIR014  'DBKEY                                               CIR014
     C                     MOVEL'SCSARDPD'DBFILE                                              CIR014
     C                     EXSR *PSSR                                                         CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CAS004
      ** Set the header                                                                       CAS004
      *                                                                                       CAS004
     C                     MOVEA'00'      *IN,41                                              CAS004
     C           CAS004    IFEQ 'Y'                                                           CAS004
      *                                                                                       CAS004
     C           PICCB     IFEQ '1'                                                           CAS004
     C           PICCB     OREQ '3'                                                           CAS004
     C                     MOVE *ON       *IN41                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
     C           PICCB     IFEQ '2'                                                           CAS004
     C           PICCB     OREQ '4'                                                           CAS004
     C                     MOVE *ON       *IN42                                               CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS004
      ** Convert the event control date to DDMMMYY                                            CAS004
      *                                                                                       CAS004
     C           PICCB     IFEQ '2'                                                           CAS004
     C           ##EVCD    ADD  1         ZDAYNO                                              CAS004
     C                     ELSE                                                               CAS004
     C                     Z-ADDBJDNWD    ZDAYNO                                              CAS004
     C                     ENDIF                                                              CAS004
     C                     EXSR ZDATE2                                                        CAS004
     C                     MOVELZADATE    REVCD                                               CAS004
      *                                                                                       CAS004
      ** Convert rundate to control date to DDMMMYY                                           CAS004
      *                                                                                       CAS004
     C           PICCB     IFEQ '3'                                                           CAS004
     C           PICCB     OREQ '1'                                                           CAS004
     C                     Z-ADD##EVCD    ZDAYNO                                              CAS004
     C                     ELSE                                                               CAS004
     C                     Z-ADDBJRDNB    ZDAYNO                                              CAS004
     C                     ENDIF                                                              CAS004
     C                     EXSR ZDATE2                                                        CAS004
     C                     MOVELZADATE    REVCDE                                              CAS004
     C                     ENDIF                                                              CAS004
      *                                                                                       CAS002
     C/COPY WNCPYSRC,DL1956C022
      *
      ** Initialize
      *
     C                     Z-ADD*ZERO     RNORE   50
     C                     Z-ADD99        P1LCNT  30
     C                     Z-ADD99        P2LCNT  30
     C                     Z-ADD*ZERO     ##DLNO  60
     C                     MOVEL*BLANK    ##OTIN  1
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C*
     C/COPY WNCPYSRC,DL1956C004
     C                     ENDSR
     C**************************************************************************
      /SPACE 5                                                            100284
     C********************************************************************100284
     C* Calculate accrual for deal.                                      *100284
     C********************************************************************100284
     C           DETACR    BEGSR                                          100284
      *                                                                   100284
      ** If no accrual will be posted in tonight's COB, set the           100284
      **   accrual to that already posted.                                100284
      *                                                                   100284
     C           BKAPDT    IFGT ##EVCD                                    100284
      *                                                                   100284
     C           CFOTIN    IFEQ 'U'                                       100284
     C           UAIPD     SUB  UIPRD     ##UACR                          100284
     C                     ADD  ##UADJ    ##UACR                          100447
     C                     ELSE                                           100284
     C           TAIPD     SUB  TIPRD     ##TACR                          100284
     C                     ADD  ##TADJ    ##TACR                          100447
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     ELSE                                           100284
      *                                                                   100284
      ** If an accual is to be posted in tonight's COB,                   100284
      *                                                                   100284
     C           CFOTIN    IFEQ 'U'                                       100284
      *                                                                   100284
      ** If this is the first accrual calculated:                         100284
      *                                                                   100284
     C           ##UACR    IFEQ 0                                         100284
      *                                                                   100284
      ** Set the accrual to the accrual to control date for this          100284
      **   period.                                                        100284
      *                                                                   100284
     C           UAITC     SUB  UIPRD     ##UACR                          100284
      *                                                                   100447
      ** Add to this the accrual adjustment.                              100447
      *                                                                   100447
     C           UAIAP     ADD  UAIAN     ##UADJ                                              202405
     C                     ADD  ##UADJ    ##UACR                          100447
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
      ** Add to this the accrual from the control date to the event       100284
      **   control date. If the cash-flow is unknown, use SR/DETAMT       100284
      **   or if a cash-flow schedule is used, use SR/DETCFA.             100284
      *                                                                   100284
     C           CFAMNT    IFEQ 0                                         100284
      *                                                                   100284
      ** The accrual should be calculated from the greater of the         100951
      **   interest accrual control date and the period start date.       100951
      *                                                                   100951
     C           UIACD     IFGT CFSLIP                                    100951
     C                     Z-ADDUIACD     ##SLIP                          100951
     C                     ELSE                                           100951
     C                     Z-ADDCFSLIP    ##SLIP                          100951
     C                     ENDIF                                          100951
      *                                                                   100951
      ** .... and upto the lesser of the event control date and           100951
      **   the speriod end date.                                          100951
      *                                                                   100951
     C           CFNIPD    IFLT ##EVCD                                    100951
     C                     Z-ADDCFNIPD    ##INED                          100951
     C                     ELSE                                           100951
     C                     Z-ADD##EVCD    ##INED                          100284
     C                     ENDIF                                          100951
      *                                                                   100284
      ** If accruing on first day, add one day to period unless           100284
      **   accruing upto last day itself.                                 100284
      *                                                                   100284
     C           BKALDI    IFNE 'Y'                                       100284
     C           ##INED    ANDNECFNIPD                                    100284
     C                     ADD  1         ##INED                          100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C**********           Z-ADD*ZERO     ##TOTI                                       101662 193718
     C                     EXSR DETAMT                                    100284
     C                     ADD  CFAMNT    ##UACR                          100284
     C                     Z-ADD0         CFAMNT                          100284
      *                                                                   100284
     C                     ELSE                                           100284
      *                                                                   100284
     C                     EXSR DETCFA                                    100284
     C                     ADD  ##AMNT    ##UACR                          100284
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     ELSE                                           100284
      *                                                                   100284
      ** If this is the first accrual calculated:                         100284
      *                                                                   100284
     C           ##TACR    IFEQ 0                                         100284
      *                                                                   100284
      ** Set the accrual to the accrual to control date for this          100284
      **   period.                                                        100284
      *                                                                   100284
     C           TAITC     SUB  TIPRD     ##TACR                          100284
      *                                                                   100284
      ** Add to this the accrual adjustment.                              100284
      *                                                                   100284
     C           TAIAP     ADD  TAIAN     ##TADJ                          100284
     C                     ADD  ##TADJ    ##TACR                          100284
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
      ** Add to this the accrual from the control date to the event       100284
      **   control date. If the cash-flow is unknown, use SR/DETAMT       100284
      **   or if a cash-flow schedule is used, use SR/DETCFA.             100284
      *                                                                   100284
     C           CFAMNT    IFEQ 0                                         100284
      *                                                                   100284
      ** The accrual should be calculated from the greater of the         100951
      **   interest accrual control date and the period start date.       100951
      *                                                                   100951
     C           TIACD     IFGT CFSLIP                                    100951
     C                     Z-ADDTIACD     ##SLIP                          100951
     C                     ELSE                                           100951
     C                     Z-ADDCFSLIP    ##SLIP                          100951
     C                     ENDIF                                          100951
      *                                                                   100951
      ** .... and upto the lesser of the event control date and           100951
      **   the speriod end date.                                          100951
      *                                                                   100951
     C           CFNIPD    IFLT ##EVCD                                    100951
     C                     Z-ADDCFNIPD    ##INED                          100951
     C                     ELSE                                           100951
     C                     Z-ADD##EVCD    ##INED                          100284
     C                     ENDIF                                          100951
      *                                                                   100284
      ** If accruing on first day, add one day to period unless           100284
      **   accruing upto last day itself.                                 100284
      *                                                                   100284
     C           BKALDI    IFNE 'Y'                                       100284
     C           ##INED    ANDNECFNIPD                                    100284
     C                     ADD  1         ##INED                          100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C**********           Z-ADD*ZERO     ##TOTI                                       101662 193718
     C                     EXSR DETAMT                                    100284
     C                     ADD  CFAMNT    ##TACR                          100284
     C                     Z-ADD0         CFAMNT                          100284
      *                                                                   100284
     C                     ELSE                                           100284
      *                                                                   100284
     C                     EXSR DETCFA                                    100284
     C                     ADD  ##AMNT    ##TACR                          100284
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     ENDSR                                          100284
     C********************************************************************100284
      *                                                                   100284
      /SPACE 5                                                            100284
     C********************************************************************100284
     C* Calculate accrual for deal with known cash-flow.                 *100284
     C********************************************************************100284
     C           DETCFA    BEGSR                                          100284
      *                                                                   100284
      ** Calculate the number of days in period gone.                     100284
      *                                                                   100284
     C                     Z-ADDCFSLIP    ZZBEG                           100284
     C                     Z-ADD##EVCD    ZZEND                           100284
      *                                                                   100284
      ** If accruing on first day, add one day to period.                 100284
      *                                                                   100284
     C           CFNIPD    IFLT ##EVCD                                    100284
     C           BKALDI    ANDNE'Y'                                       100284
     C                     ADD  1         ZZEND                           100284
     C                     ENDIF                                          100284
      *                                                                   100284
     C                     MOVELCFINCL    ZZCALC                                              207271
     C                     EXSR ZINTDY                                    100284
      *                                                                   100284
      * For calculation Method '6'  use new field INT6DY  introduced by   163136
      * core  #126017  in  ZINTDY .                                       163136
      *                                                                   163136
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C                     Z-ADDINT6DY    ##DAY                           163136
     C                     ELSE                                           163136
      *                                                                   163136
     C                     Z-ADDZZINDY    ##DAY   50                      100284
     C                     END                                            163136
      *                                                                   163136
      ** Calculate the number of days in the whole period.                100284
      *                                                                   100284
     C                     Z-ADDCFSLIP    ZZBEG                           100284
     C                     Z-ADDCFNIPD    ZZEND                           100284
     C                     MOVELCFINCL    ZZCALC                          100284
      *                                                                   100284
     C                     EXSR ZINTDY                                    100284
      *                                                                   100284
      * For calculation Method '6'  use new field INT6DY  introduced by   163136
      * core  #126017  in  ZINTDY .                                       163136
      *                                                                   163136
     C           ZZCALC    IFEQ '6'                                       163136
     C           ZZCALC    OREQ '9'                                                           CIR013
     C           #29FEB    ANDEQ'Y'                                                           CIR013
     C                     Z-ADDINT6DY    ##DEN                           163136
     C                     ELSE                                           163136
      *                                                                   163136
     C                     Z-ADDZZINDY    ##DEN   50                      100284
     C                     END                                            163136
      *                                                                   100284
      ** Pro-rata the amount by the proportion of days gone.              100284
      *                                                                   100284
     C           ##DAY     DIV  ##DEN     ##WRK1 159H                     100284
     C           CFAMNT    MULT ##WRK1    ##AMNT 150H                     100284
      *                                                                   100284
     C                     ENDSR                                          100284
      /SPACE 5
      ******************************************************************                      CAS008
      *                                                                *                      CAS008
      *  SRUCFF - Output cashflows to file RSCFLAPD and RXCFLAPD       *                      CAS008
      *                                                                *                      CAS008
      ******************************************************************                      CAS008
      *                                                                                       CAS008
     C           SRUCFF    BEGSR                                                              CAS008
      *                                                                                       CAS008
      ** Initialise Rates/Curve Missing Field.                                                CAS008
      *                                                                                       CAS008
     C                     MOVE *BLANKS   IRMISS                                              CAS008
      *                                                                                       CAS008
     C                     MOVELCFDLNO    IRDLNO                                              CAS008
     C                     MOVELDTYP      IRDTYP                                              CAS008
     C                     MOVELDLST      IRDLST                                              CAS008
     C                     MOVELCLAS      IRCLAS                                              CDL038
     C                     Z-ADDCFPYDT    IRFLDT                                              CAS008
      *                                                                                       CAS008
      ** Convert payment date to DDMMMYY or MMMDDYY                                           CAS008
      *                                                                                       CAS008
     C                     Z-ADDCFPYDT    ZDAYNO                                              CAS008
     C                     EXSR ZDATE2                                                        CAS008
     C           *IN98     IFEQ *ON                                                           CAS008
     C                     MOVELZADATE    WDATE2  5                                           CAS008
     C                     MOVELWDATE2    WDAY    2                                           CAS008
     C                     MOVE WDATE2    WMONTH  3                                           CAS008
     C                     MOVELWMONTH    WDATE2                                              CAS008
     C                     MOVE WDAY      WDATE2                                              CAS008
     C                     MOVELWDATE2    ZADATE                                              CAS008
     C                     MOVELZADATE    IRDATE                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVELZADATE    IRDATE                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           CFPYDT    SUB  ##EVCD    IRNDYP                                              CAS008
      *                                                                                       CAS008
      **  No of days in int. yr. depending on int. calculation basis.                         CAS008
      *                                                                                       CAS008
      *                                                                                       CAS008
      *** 365 Days - Calculation Basis = 1 or 4.                                              CAS008
      *                                                                                       CAS008
     C           CFINCL    IFEQ '1'                                                           CAS008
     C           CFINCL    OREQ '4'                                                           CAS008
     C                     Z-ADD365       IRNDYY                                              CAS008
     C                     END                                                                CAS008
      *                                                                                       CAS008
      ***  360 Days - Calculation Basis = 2, 3, 5 or 7.                                       CAS008
      *                                                                                       CAS008
     C           CFINCL    IFEQ '2'                                                           CAS008
     C           CFINCL    OREQ '3'                                                           CAS008
     C           CFINCL    OREQ '5'                                                           CAS008
     C           CFINCL    OREQ '7'                                                           CAS008
     C                     Z-ADD360       IRNDYY                                              CAS008
     C                     END                                                                CAS008
      *                                                                                       CAS008
      ***  366 Days - Calculation Basis = 6.                                                  CAS008
      *                                                                                       CAS008
     C           CFINCL    IFEQ '6'                                                           CAS008
     C                     Z-ADD366       IRNDYY                                              CAS008
     C                     END                                                                CAS008
      *                                                                                       CAS008
     C                     Z-ADDCFAMNT    IRCAMT                                              CAS008
     C                     MOVEL'INTP'    IRFTYP                                              CAS008
     C                     Z-ADD##EINR    IRIRAT                                              CAS008
     C                     Z-ADDCFRTSP    IRSPRR                                              CAS008
     C                     MOVELRAFNAR    IRSPIN                                              CAS008
     C                     MOVELCFYLDC    IRYLDC                                              CAS008
      *                                                                                       CAS008
     C           CFOTIN    IFEQ 'U'                                                           CAS008
     C                     MOVELFSOFYC    IRFYLD                                              CAS008
     C                     MOVEL'O'       IRIOIN                                              CAS008
     C                     MOVE UCUCY     IRCYCD                                              CAS008
     C                     ELSE                                                               CAS008
     C                     MOVELFSTFYC    IRFYLD                                              CAS008
     C                     MOVEL'I'       IRIOIN                                              CAS008
     C                     MOVE TCUCY     IRCYCD                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     Z-ADDZNPDF     IRDSCF                                              CAS008
     C                     Z-ADDZNPOUT    IRNPVA                                              CAS008
     C                     MOVELCNUM      IRCNUM                                              CAS008
     C                     MOVELBRCA      IRBRCA                                              CAS008
     C                     MOVELBOKC      IRBKCD                                              CAS008
      *                                                                                       CAS008
     C                     MOVE CFINCL    IRICBS                                              CAS008
      *                                                                                       CAS008
     C           *IN30     IFEQ *ON                                                           CAS008
     C                     MOVEL'R'       IRMISS                                              CAS008
     C                     ENDIF                                                              CAS008
     C           *IN31     IFEQ *ON                                                           CAS008
     C                     MOVEL'C'       IRMISS                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           DTYP      IFEQ 'RS'                                                          CAS008
     C                     WRITERSCFLAD0                                                      CAS008
     C                     ELSE                                                               CAS008
     C                     WRITERXCFLAD0                                                      CAS008
     C                     ENDIF                                                              CAS008
     C                     ENDSR                                                              CAS008
      /SPACE 5                                                                                CAS008
     C**************************************************************************
     C* *PSSR      - Error Subroutine                                 *
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C** If not yet run, then do error processing
     C*
     C           WWRUN     IFNE 'Y'
     C                     MOVEL'Y'       WWRUN   1
     C                     MOVEL'DL1956'  DBPGM
     C           *NAMVAR   DEFN LDA       @LDA  256
     C           *LOCK     IN   @LDA
     C                     MOVELDBERR     @LDA
     C                     OUT  @LDA
     C                     SETON                     U7U8
     C                     DUMP
     C                     EXSR AUDIT
     C                     END
      *
      ***  If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
     C           PSSR9     ENDSR
     C*****************************************************************
      /SPACE 5
     C/COPY ZSRSRC,ZDATE2Z2
      /SPACE 5
     C/COPY ZSRSRC,ZSEDITZ3
      /SPACE 5
     C**OPY ZSRSRC,ZDLINTZ1                                                                   207272
      /SPACE 5
     C**OPY ZSRSRC,ZCBDYSZ1                                                                   207272
      /SPACE 5
     C/COPY ZSRSRC,ZCONVNZ1
      /SPACE 5
     C/COPY ZSRSRC,ZFWDT                                                  100317
      /SPACE 5                                                            100317
     C/COPY ZSRSRC,ZACCH                                                  100317
      /SPACE 5                                                            100317
     C/COPY ZSRSRC,ZINTDYZ2                                               100284
      /SPACE 5                                                            100284
     C/COPY ZSRSRC,ZDATE9Z3                                               100284
      /SPACE 5                                                            100284
     C/COPY ZSRSRC,GLINTCZ1                                                                   207272
      /SPACE 5                                                                                207272
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     ODEALSUF E                UDEAL
     O                         UNRL
     O                         FSUURL                                                         CAS005
     O                         FSTURL                                                         CAS005
**  CPY@
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    100284
00366007310109601461                                                      100284
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       100284
00000000310005900090001200015100181002120024300273003040033400365         100284
