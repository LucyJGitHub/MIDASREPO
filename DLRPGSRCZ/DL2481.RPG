0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Deals by Customer Print')                     *
0002 F*****************************************************************
0004 F*                                                               *
0003 F*  Midas - Dealing Module                                       *
0004 F*                                                               *
0005 F*  DL2481  -  DEALS BY CUSTOMER PRINT BY BRANCH REPORT          *
0006 F*                                                               *
0008 F*  THIS PROGRAM HAS BEEN GENERATED FROM DL2480                  *
0006 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
0008 F*                                                               *
      *  Last Amend No. MD057842           Date 06Apr21               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 117478             DATE 26May06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 237063             Date 20Nov05               *
      *                 CDL038             Date 10May05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL021             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 068210             Date 25OCT94               *
     F*                 068208             DATE 25OCT94               *
     F*                 S01444             DATE 22SEP93               *
     F*                 065625             DATE 18MAR94               *
     F*                 065877             DATE 15FEB94               *
     F*                 S01453             DATE 14DEC93               *
     F*                 S01378             DATE 15OCT92               *
     F*                 E35494             DATE 05FEB92               *
     F*                 E27537             DATE 04SEP91               *
     F*                 E26358             DATE 17JUL91               *
     F*                 E26357             DATE 17JUL91               *
     F*                 E26292             DATE 11JUL91               *
     F*                 E26291             DATE 11JUL91               *
     F*                 E25586             DATE 21JUN91               *
     F*                 LN0746             DATE 18SEP90               *
     F*                 LN0101             DATE 03MAY90               *
     F*                 E257               DATE 16MAR90               *
     F*                 E242               DATE 06MAR90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD057842 - Various CSD103 related errors                     *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
     F*  117478 - Deal type CI(certificate of deposit issued) is      *
     F*           being reported against the internal customer.       *
     F*           It should be picked up via the counterparty         *
     F*           which on DEALSDC is held in field CHNA so new       *
     F*           format on DEALSDC needs handling.                   *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL038 - Extended Deal Sub Type                              *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL021 - Reports by Deal Type                                *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  CSD007 - Customer Closing                                    *
      *  CIR005 - FRA/IRS Business Day Conventions CACUSDL1 Recompile *
     F*  068210 - Field used for maturity not cleared correctly.      *
     F*  068208 - Incorrect deal type is shown in DL2481 Report.      *
     F*           Midas Deal Type (**MTYP) is now being used instead  *
     F*           of the field **TYPE for MM DRS files.               *
     F*  S01444 - The deals file has been amended to include          *
     F*           all the historic deals files.                       *
     F*  065625 - Erroneous characters appearing on 2nd line.         *
     F*  065877 - Remove conditioning of read of month names file     *
     F*           FDMNTHL0 on FD indicator, file is set up when       *
     F*           indicator off.                                      *
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction (was MOF53). Include details            *
     F*           for parcelled trades.                               *
     F*  E35494 - Files FDPMNTLL and FDINSTLL were made redundant by  *
     F*           project Harry (S01319), and should have been        *
     F*           removed from this program.                          *
     F*  E27537 - FORMAT THE INTEREST RATE SPREAD IF THE BASE RATE    *
     F*           CODE IS EITHER BLANK OR '00' AS SOME DEALS EXIST    *
     F*           WITH '00' AS A BASE RATE CODE                       *
     F*  E26358 - 'NO DETAILS' AND 'END OF REPORT' ARE THE WRONG WAY  *
     F*           ROUND                                               *
     F*  E26357 - IF THERE ARE NO DEALS FOR THE PARTICULAR CUSTOMER   *
     F*           THE REPORT IS FOR THEN SHOULD PRODUCE 'NO DETAILS'  *
     F*           INSTEAD OF DATABASE ERROR 05                        *
     F*  E26292 - FOR EACH NEW PRINTER FILE THE COUNT OF RECORDS ON   *
     F*           A PAGE NEEDS TO BE SET TO ZERO                      *
     F*  E26291 - HAVE TO MAKE SURE USING DEAL STATUS AND DEAL TYPE   *
     F*           FIELDS FROM THE CORRECT RECORD AND NOT ONE READ     *
     F*           PREVIOUSLY                                          *
     F*  E25586 - CHANGE DEALSLL TO CACUSDL1 AS THIS IS MORE          *
     F*           APPROPRIATE IE CORRECT SELECTS AND OMITS            *
     F*  LN0746 - P1 FILE CHANGED TO SAME NAME AS PROGRAM             *
     F*           DUMMY FILES CREATED                                 *
     F*  LN0101 - MUST LOCK DATA AREA LDA WHEN USING IN OPERATION     *
     F*  E257   - PRINTER FILE SHOULD BE CHANGED TO DL2480 REPORT     *
     F*  E242   - CHANGE RECORDS PER PAGE COUNT TO 13 AS NOT ENOUGH   *
     F*            SPACE FOR EXACTLY 14 RECORDS AND END MESSAGE.      *
     F*                                                               *
0010 F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0011 F/SPACE 3
0012 F***DEALSLL*IF**E           K        DISK         KINFSR *PSSR   UC  E25586
0012 FCACUSDL1IF  E           K        DISK         KINFSR *PSSR      UC  E25586
     F            DLBHISD0                          KRENAMECACHIBD0       S01444
     F            DLCHISD0                          KRENAMECACHICD0       S01444
     F            DLDHISD0                          KRENAMECACHIDD0       S01444
     F            DLEHISD0                          KRENAMECACHIED0       S01444
     F            DLGHISD0                          KRENAMECACHIGD0       S01444
     F                                              KINFDS INGDS
0015 F**DL2481P1O   F     132     OF     PRINTER      KINFDS SPOOL      UCE257
0015 F***480P1O   F     132     OF     PRINTER      KINFDS SPOOL  UC E257 LN0746
0015 FDL2481P1O   F     132     OF     PRINTER      KINFDS SPOOL      UC  LN0746
     FDL2481AUO   F     132            PRINTER      KINFDS SPOOLU     UC  E26357
     F*FDPMNTLLIF*E********************DISK         KINFSR *PSSR      UC  E35494
     FFDMNTHLLIF  E                    DISK         KINFSR *PSSR      UC  E35494
     F*FDINSTLLIF*E********************DISK         KINFSR *PSSR      UC  E35494
     F/COPY WNCPYSRC,DLH00254
0016 F/SPACE 3
0017 F* ID F  C  H  L    FUNCTION OF INDICATORS
0025 F**01*******     DEALSLL B RECORD - FX                               E25586
0026 F**02*******     DEALSLL C RECORD - LOANS/DEPOSITS                   E25586
0027 F**03*******     DEALSLL D RECORD - NA PURCHASED                     E25586
0028 F**04*******     DEALSLL E RECORD - NA SOLD                          E25586
     F* 01            CACUSDL1 B RECORD - FX                              E25586
     F* 02            CACUSDL1 C RECORD - LOANS/DEPOSITS                  E25586
     F* 03            CACUSDL1 D RECORD - NA PURCHASED                    E25586
     F* 04            CACUSDL1 E RECORD - NA SOLD                         E25586
     F* 11            CACUSDL1 G RECORD - FRA'S AND IRS'S                 E25586
     F*    23         MATURITY DATE ZERO
     F********29*     DEALSLL RECORD NOT FOUND                            E25586
     F********30*     DEALSLL END OF FILE                                 E25586
     F*       29      CACUSDL1 RECORD NOT FOUND                           E25586
     F*       30      CACUSDL1 END OF FILE                                E25586
     F*       31      LIVE RECORDS SELECTED
     F*       32      MATURED RECORDS SELECTED
     F*      N31N32   LIVE AND MATURED SELECTED
     F*       34      OPTION DEAL
     F*       35      NOSTRO TRANSFER
0025 F*       40      1ST CYCLE IND.
0027 F*       42      MATURED DEAL
0030 F*       44      NO DETAIL RECORDS
0031 F*       46      DEAL TYPE C1
     F*       50      PRTF DL2481P1 OPEN FOR OUTPUT
     F*       51      PRTF DL2481P1 HAS BEEN OPENED AT SOME STAGE         E26357
0031 F*       54      DISPLAY BUY/SELL INDICATOR
0058 F*       55      FEDERAL FUND DEAL
0059 F*       56      DEAL IN DOLLARS
1111 F*       57      FEDERAL FUND SALE
0061 F*       58      SALE IN DOLLARS
0043 F*       80      I/P CYCLE RUN
     F*          U7U8 DATABASE ERROR
     E                    CPY@    1   1 80
0045 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0046 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0047 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E********************TXT     1   5 56               TEXT             S01378
     E********************TXT     1   6 56               TEXT      S01378 065625
     E                    TXT     1   6 60               TEXT             065625
     E**********          LIN       100  1               LINE02 SR ARRAY  S01378
     E                    LIN       111  1               LINE02 SR ARRAY  S01378
     E*    ARRAYS FOR EDITING AN AMOUNT ACCORDING TO NO. OF DPS.
     E                    ZEDT        5  4               EDITED AMOUNT
     E                    ZED2        6  3               AMT WITH NO COMMA
     E                    ZAMT        5  3               AMOUNT FIELD
     E                    Z3          3  1               DUMMY 3 CHAR FLD
     E                    ZCOM    1   4 20               EDT CHARS FOR AMT
     E                    RAT        11  1 0             EDITED AMOUNT
     E                    OUT        12  1               EDITED AMOUNT
     E*
     E**  ARRAY OF MONTH NAMES
     E                    @MN        12  3
     E*
     E** ARRAY FOR ALLIGN AND VALIDATION
     E                    @A1        10  1
     E                    @A2        10  1
     E*
     E** ARRAYS USED IN SR.ZA0750
     E*
     E** ARRAY FOR AMOUNT INPUT
     E                    @D         15  1
     E*
     E** ARRAY FOR DISPLAY AMOUNT
     E                    @E         21  1
     E*
     E** WORK ARRAY
     E                    @C         21  1
     E*
     E** ARRAY USED BY STANDARD SR.MM1013
     E                    @W         13  1
     E*
     E*
     E** TABLE FOR DEAL STATUS NARRATIVE
     E                    TABA    1   6  1   TABB    7
     E*                                                                   S01378
     E** @IN, @OUT used to format parcel size (drop leading zeros)        S01378
     E                    @IN         5  1                                S01378
     E                    @OUT        5  1                                S01378
0051 E/EJECT
      *
0053 IDEALSDBF    01
0109 I                                              OTDT            23
0053 ICACHIBD0    01                                                      S01444
0109 I                                              OTDT            23    S01444
0054 I*
0055 IDEALSDCF    02
0109 I                                              MDAT            23
0055 ICACHICD0    02                                                      S01444
0109 I                                              MDAT            23    S01444
0074 I*
0055 IDLSDCFCI    02                                                      117478
0109 I                                              MDAT            23    117478
0074 I*                                                                   117478
0075 IDEALSDDF    03
0109 I                                              MDAT            23
0075 ICACHIDD0    03                                                      S01444
0109 I                                              MDAT            23    S01444
0084 I*
0085 IDEALSDEF    04
     I*
0085 ICACHIED0    04                                                      S01444
     I*                                                                   S01444
     IDEALSDGF    11
     I*    DETAIL - FRA/IRS
     I                                              MDAT            23
     ICACHIGD0    11                                                      S01444
     I*  HISTORIC DETAIL - FRA/IRS                                        S01444
     I                                              MDAT            23    S01444
     I*
     IFXDEALP0
0099 I              FHDDLT                          DLREC
0099 I              FHDSTS                          DLSTS
0099 I              FHMBCA                          BRCA
     I              FHTYPE                          DTYP                  E26291
     I*
     IMMDELDP0
0099 I              HKDDLT                          DLREC
0099 I              HKDSTS                          DLSTS
0099 I              HKBRCA                          BRCA
     I**************HKTYPE                          DTYP            E26291068208
     I              HKMTYP                          DTYP                  068208
     I*
     IMMDENBP0
0099 I              HLDDLT                          DLREC
0099 I              HLDSTS                          DLSTS
0099 I              HLBRCA                          BRCA
     I**************HLTYPE                          DTYP            E26291068208
     I              HLMTYP                          DTYP                  068208
     I*
     IMMDENSP0
0099 I              HMDDLT                          DLREC
0099 I              HMDSTS                          DLSTS
0099 I              HMBRCA                          BRCA
     I**************HMTYPE                          DTYP            E26291068208
     I              HMMTYP                          DTYP                  068208
     I/COPY WNCPYSRC,DLH00255
     I*
0088 I*
     I*FDPMNTL1***                                                        E35494
     IFDMNTHP0                                                            E35494
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I*
     I*
     IINGDS       DS
     I** INFORMATION DATA STRUCTURE,FOR FORMAT ACCESSED
     I                                     *RECORD  RECGMT
     I/COPY WNCPYSRC,DLH00256
     I*
     IMMODS       DS                            256
     I** DATA STRUCTURE FOR MODULES PRESENT
     I                                       11  11 MODFD
     I*
     I            DS
     I**  Used by ZA0660 - Date input in YYYYMMDD format
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I*
     I            DS
     I** DRS - DL VALUE DATE DATA STRUCTURE
     I                                        1   80@VDAT
     I                                        1   40FHVDYY
     I                                        1   40HKVDYY
     I                                        1   40HLVDYY
     I                                        1   40HMVDYY
     I                                        5   60FHVDMM
     I                                        5   60HKVDMM
     I                                        5   60HLVDMM
     I                                        5   60HMVDMM
     I                                        7   80FHVDDD
     I                                        7   80HKVDDD
     I                                        7   80HLVDDD
     I                                        7   80HMVDDD
     I*
     I*
     I            DS
     I** DRS - DL OPTION END DATE DATA STRUCTURE.
     I                                        1   80@ODAT
     I                                        1   40FHDOEY
     I                                        5   60FHDOEM
     I                                        7   80FHDOED
     I*
     I            DS
     I** DRS - DL DONE DATE DATA STRUCTURE.
     I                                        1   80@DDAT
     I                                        1   40FHDDYY
     I                                        1   40HKDDYY
     I                                        1   40HLDDYY
     I                                        1   40HMDDYY
     I                                        5   60FHDDMM
     I                                        5   60HKDDMM
     I                                        5   60HLDDMM
     I                                        5   60HMDDMM
     I                                        7   80FHDDDD
     I                                        7   80HKDDDD
     I                                        7   80HLDDDD
     I                                        7   80HMDDDD
     I            DS
     I** DRS - DL MATURITY  DATE STRUCTURE.
     I                                        1   80@MDAT
     I                                        1   40HKMDYY
     I                                        1   40HLMDYY
     I                                        1   40HMMDYY
     I                                        5   60HKMDMM
     I                                        5   60HLMDMM
     I                                        5   60HMMDMM
     I                                        7   80HKMDDD
     I                                        7   80HLMDDD
     I                                        7   80HMMDDD
     I*
     I* DATSTRUCTURE USED IN SUBROUTINE ZA0750
     I* DATASTUCTURE TO CONVERT 7@IAMT DECIMAL FIELD TO ALPHA FIELD
     I*
     I@@AMDS      DS                             15
     I                                        1  150@@IAMT
0383 I**   DATA STRUCTURE FOR RATE AMOUNT
0384 I            DS
     I                                        1  110RAT
     I                                        1  117ZRATE
 544 I*
0543 I** LOCAL DATA AREA TO IDENTIFY DATABASE ERRORS
0545 ILDA        UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     ISPOOL       DS
     I** FILE INFORMATION DATA STRUCTURE
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
     ISPOOLU      DS                                                      E26357
     I** FILE INFORMATION DATA STRUCTURE                                  E26357
     I                                       83  92 SFILEU                E26357
     I                                    B 123 1240SFNUMU                E26357
     I*
     I@BANK     E DSSDBANKPD
     I** DUMMY RECORD FORMAT FOR BANK DETAILS
     I*
     I@CURR     E DSSDCURRPD
     I** DUMMY RECORD FORMAT FOR CURRENCY DETAILS
     I*
     I@CUST     E DSSDCUSTPD
     I** DUMMY RECORD FORMAT FOR CUSTOMER DETAILS
     I*
     I@TRAD     E DSSDTRADPD
     I** DUMMY RECORD FORMAT FOR TRADING DATA DETAILS
     I*
     ISDDEAL    E DSSDDEALPD                                              E35494
     I** EXTERNAL DS FOR DEALING DETAILS                                  E35494
     I              QQACCD                          QQACD1                                    CGL029
     I*                                                                   E35494
     I@BRCH     E DSSDBRCHPD
     I** DUMMY RECORD FORMAT FOR BRANCH DETAILS
     I              QQDFAC                          #DFAC1                                    CGL029
      *                                                                   CSD007
     ISCSARD    E DSSCSARDPD                                              CSD007
      ** External Data Structure for Switchable Features                  CSD007
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
0113 I/EJECT
0114 C* 1 S T   C Y C L E   P R O C E S S I N G
     C*
     C           *ENTRY    PLIST
     C                     PARM           SEQ     5
     C                     PARM           BRNCH   3                       E5
     C                     PARM           CUSTNO  6
     C***************      PARM           BRNCH   3                       E5
     C                     PARM           LIVOPT  1
     C                     PARM           MATOPT  1
     C                     PARM           TYP1    2                       CDL021
     C                     PARM           TYP2    2                       CDL021
     C                     PARM           TYP3    4                       CDL038
     C*
     C           CUSKY2    KLIST
     C                     KFLD           CUSKEY
     C                     KFLD           KFLD2   3
      *
0115 C   40                GOTO START
0116 C                     SETON                     4044
     C** FOR DATABASE ERROR REFERENCE
     C*
     C                     MOVEACPY@      BIS@   80
     C                     MOVE ' '       BLANKS 29
     C                     MOVE BLANKS    DBKEY
     C           *NAMVAR   DEFN           LDA
     C******               IN   LDA                                       LN0101
     C           *LOCK     IN   LDA                                       LN0101
     C*
     C** CALL ACCESS PROGRAM FOR BANK DETAILS
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           @BANK     PARM @BANK     DSFDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBANKPD'DBFILE            *************
     C                     MOVEL'04'      DBASE             *DBERROR 004*
     C                     MOVEL@OPTN     DBOPTN  7         *************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C*****                OPEN DL2481P1                                  E257
     C***********          OPEN DL2480P1                             E257 LN0746
     C                     OPEN DL2481P1                                  LN0746
     C                     SETON                     50
     C                     SETON                     51                   E26357
     C                     GOTO END
     C                     END
0381 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0382 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON
     C*
     C** INITIAL PROCESSING FOR DRS
     C                     EXSR #A
     C*
     C** IF DATABASE ERROR GOTO TO END
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     GOTO END                        *1
     C                     END                             E1
     C*
0120 C/SPACE 2
0121 C* M A I N   P R O C E S S I N G
0122 C           START     TAG                             ** START TAG **
     C**
     C**    ACCESS DEALS FOR THE CUSTOMER NUMBER
     C**
     C**********           MOVE CUSTNO    CUSKEY  60                                          CSD027
     C                     MOVE CUSTNO    CUSKEY  6                                           CSD027
     C                     MOVEA'00'      *IN,31
     C*
     C** RESET THE POINTER IN THE DEALS FILE.
     C*
     C/COPY WNCPYSRC,DLH00257
     C           BRNCH     IFEQ 'ALL'
     C***********CUSKEY    SETLLDEALSLL                  29*1             E25586
     C           CUSKEY    SETLLCACUSDL1                 29               E25586
     C                     ELSE
     C                     MOVE BRNCH     KFLD2
     C***********CUSKY2    SETLLDEALSLL                  29               E25586
     C           CUSKY2    SETLLCACUSDL1                 29               E25586
     C                     END
     C/COPY WNCPYSRC,DLH00258
     C*
     C***********                                                         E26357
     C******IF*NO*RECORD*FOUND*-*ERROR                                    E26357
     C************IN29     IFEQ '0'                                       E26357
     C***********          MOVE '05'      DBASE            *************  E26357
     C***********BRNCH     IFEQ 'ALL'                      *DBERR 005***  E26357
     C***********          MOVELCUSTNO    DBKEY1  9        *************  E26357
     C***********          ELSE                                           E26357
     C***********          MOVELCUSTNO    DBKEY1                          E26357
     C***********          MOVE KFLD2     DBKEY1                          E26357
     C***********          END                                            E26357
     C***********          MOVE *BLANKS   DBOPTN                          E26357
     C***********          MOVE 'DEALSLL' DBFILE           *1             E25586
     C***********          MOVE 'CACUSDL1'DBFILE                    E25586E26357
     C***********                                                         E26357
     C***********          EXSR *PSSR                                     E26357
     C***********          SETON                     LRU7U8               E26357
     C******               OPEN DL2481P1                                  E257
     C***********          OPEN DL2480P1                             E257 LN0746
     C***********          OPEN DL2481P1                            LN0746E26357
     C***********          SETON                     50                   E26357
     C***********          EXCPTHEAD                                      E26357
     C***********          GOTO END                                       E26357
     C***********          END                                            E26357
     C*
     C**    SET INDICATORS FOR THE OPTION PARAMETERS PASSED
     C           LIVOPT    IFEQ 'Y'
     C           MATOPT    ANDEQ'Y'
     C                     GOTO HEADF
     C                     END
     C           LIVOPT    IFEQ 'Y'
     C                     MOVE '1'       *IN31
     C                     ELSE
     C                     MOVE '1'       *IN32
     C                     END
     C*
0122 C           HEADF     TAG                             ** HEADF TAG **
     C*
     C** CALL ACCESS PROGRAM FOR CUSTOMER DETAILS FOR REPORT HEADINGS
     C***********          CALL 'AOCUSTR0'
     C                     CALL 'AOCUSTR2'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM CUSTNO    @AENB  10
     C                     PARM *BLANKS   @KYST   7
     C***********@CUST     PARM @CUST     DSSDY
     C           @CUST     PARM @CUST     DSLDY
     C*
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           @RTCD     ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCUSTPD'DBFILE            *************
     C                     MOVEL'06'      DBASE             *DBERROR 006*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELCUSTNO    DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C******               OPEN DL2481P1                                  E257
     C***********          OPEN DL2480P1                             E257 LN0746
     C                     OPEN DL2481P1                                  LN0746
     C                     SETON                     50
     C                     SETON                     51                   E26357
     C                     EXCPTHEAD
     C                     GOTO END
     C                     END
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
     C*
     C           TYP1      IFNE *BLANKS                                   CDL021
     C           TYP1      ANDNE'**'                                      CDL021
     C                     MOVE '1'       *IN88                           CDL021
     C           TYP2      IFNE *BLANKS                                   CDL021
     C           TYP2      ANDNE'**'                                      CDL021
     C                     MOVE '1'       *IN89                           CDL021
     C                     ENDIF                                          CDL021
     C                     ENDIF                                          CDL021
     C**    PRINT HEADINGS
     C                     EXCPTHEAD
     C*
0122 C           READF     TAG                             ** READF TAG **
     C*
     C                     MOVEA'0000'    *IN,01
     C                     MOVE '0'       *IN42
     C                     MOVEA'0000000' *IN,70
     C*
     C* RESET TEXT FIELD FOR FRA/IRS DEALS
     C*
     C                     MOVE *BLANK    @TEXT
     C*                                                                   E26291
     C** Reset fields which are on DL files but not on FX/MM files        E26291
     C** and on FX/MM files and not DL files otherwise the report         E26291
     C** will never show correct details.                                 E26291
     C*                                                                   E26291
     C                     MOVE *BLANKS   HLTYPE                          CDL021
     C                     MOVE *BLANKS   HLSTYP                          CDL021
     C                     MOVE *BLANKS   HLCLAS                          CDL038
     C                     MOVE *BLANKS   HMTYPE                          CDL021
     C                     MOVE *BLANKS   HMSTYP                          CDL021
     C                     MOVE *BLANKS   HMCLAS                          CDL038
     C                     MOVE *BLANKS   HKTYPE                          CDL021
     C                     MOVE *BLANKS   HKSTYP                          CDL021
     C                     MOVE *BLANKS   HKCLAS                          CDL038
     C                     MOVE *BLANKS   DTYP                            CDL021
     C                     MOVE *BLANKS   DLST                            CDL038
     C                     MOVE *BLANKS   CLAS                            CDL038
     C                     MOVE *BLANKS   FHSTYP                          CDL021
     C                     MOVE *BLANKS   FHCLAS                          CDL038
     C                     MOVE *BLANKS   RECI                            E26291
     C                     MOVE *BLANKS   DLSTS                           E26291
     C**    READ A RECORD
     C*
     C***********CUSKEY    READEDEALSLL                  30               E25586
     C/COPY WNCPYSRC,DLH00259
     C           CUSKEY    READECACUSDL1                 30               E25586
     C*
     C                     MOVE RECGMT    @INDS   8
     C/COPY WNCPYSRC,DLH00260
     C*
     C           *IN30     IFEQ '1'
     C                     MOVE '1'       *INLR
     C                     EXCPT
     C                     EXCPTENDRPT
     C                     GOTO END
     C                     END
     C**
     C           TYP1      IFNE *BLANKS                                   CDL021
     C           TYP1      ANDNE'**'                                      CDL021
     C           TYP2      ANDNE*BLANKS                                   CDL021
     C           TYP2      ANDNE'**'                                      CDL021
     C           DTYP      IFEQ TYP1                                      CDL021
     C           DLST      ANDEQTYP2                                      CDL021
     C           CLAS      ANDEQTYP3                                      CDL038
     C           DTYP      OREQ TYP1                                      CDL021
     C           FHSTYP    ANDEQTYP2                                      CDL021
     C           FHCLAS    ANDEQTYP3                                      CDL038
     C***********HKTYPE    OREQ TYP1                               CDL021 CDL038
     C           DTYP      OREQ TYP1                                      CDL038
     C           HKSTYP    ANDEQTYP2                                      CDL021
     C           HKCLAS    ANDEQTYP3                                      CDL038
     C***********HLTYPE    OREQ TYP1                               CDL021 CDL038
     C           DTYP      OREQ TYP1                                      CDL038
     C           HLSTYP    ANDEQTYP2                                      CDL021
     C           HLCLAS    ANDEQTYP3                                      CDL038
     C***********HMTYPE    OREQ TYP1                               CDL021 CDL038
     C           DTYP      OREQ TYP1                                      CDL038
     C           HMSTYP    ANDEQTYP2                                      CDL021
     C           HMCLAS    ANDEQTYP3                                      CDL038
     C                     ELSE                                           CDL021
     C                     GOTO READF                                     CDL021
     C                     END                                            CDL021
     C                     END                                            CDL021
     C*                                                                   CDL021
     C           TYP1      IFNE *BLANKS                                   CDL021
     C           TYP1      ANDNE'**'                                      CDL021
     C           TYP2      ANDEQ'**'                                      CDL021
     C           DTYP      IFEQ TYP1                                      CDL021
     C***********HKTYPE    OREQ TYP1                               CDL021 CDL038
     C***********HLTYPE    OREQ TYP1                               CDL021 CDL038
     C***********HMTYPE    OREQ TYP1                               CDL021 CDL038
     C                     ELSE                                           CDL021
     C                     GOTO READF                                     CDL021
     C                     END                                            CDL021
     C                     END                                            CDL021
     C**    MATURED RECORD READ                                           E26357
     C           RECI      IFEQ 'M'                                       E26357
     C           RECI      OREQ 'N'                                       E26357
     C*                                                                   E26357
     C** CHECK FOR DRS DEAL STATUS                                        E26357
     C           DLSTS     OREQ 'M'                                       E26357
     C                     MOVE '1'       *IN42                           E26357
     C           *IN32     IFEQ '1'                                       E26357
     C                     GOTO VALREC                                    E26357
     C                     END                                            E26357
     C           *IN31     IFEQ '1'                                       E26357
     C                     GOTO READF                                     E26357
     C                     END                                            E26357
     C                     END                                            E26357
     C           *IN32     IFEQ '1'                                       E26357
     C                     GOTO READF                                     E26357
     C                     END                                            E26357
     C*                                                                   E26357
     C           VALREC    TAG                             **VALREC TAG **E26357
     C**
     C** IF A REQUIRED BRANCH AND A LEVEL BREAK, OPEN DL0831P1
     C           BRCA      IFNE BRCAL
     C                     EXCPT                                          E26358
     C                     EXCPTENDRPT
     C*****                CLOSEDL2481P1                                  E257
     C***********          CLOSEDL2480P1                             E257 LN0746
     C                     CLOSEDL2481P1                                  LN0746
     C           BRNCH     IFEQ 'ALL'
     C           BRNCH     OREQ BRCA
     C***********          SETON                     50                   E26357
     C                     SETON                     5044                 E26357
     C                     SETON                     51                   E26357
     C******               OPEN DL2481P1                                  E257
     C***********          OPEN DL2480P1                             E257 LN0746
     C                     OPEN DL2481P1                                  LN0746
     C                     Z-ADD0         COUNT                           E26292
     C* REPORT SPOOL FILE GENERATION
     C                     Z-ADDSFNUM     ZSNUM   60
     C                     OUT  LDA
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ
     C                     PARM BRCA      @PARM   3
     C                     PARM           SFILE
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
     C******               IN   LDA                                       LN0101
     C           *LOCK     IN   LDA                                       LN0101
     C*
     C           ZSERR     IFEQ 'Y'                         B3
     C* Error during ZSFILE processing, return to calling program.
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     END                              E3
     C*
     C**
     C** READ BRANCH DETAILS VIA ACCESS PROGRAM FOR BRANCH NAME
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM BRCA      @DSNB   3
     C********** @BRCH     PARM @BRCH     DSFDY                                               CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     MOVEL'07'      DBASE            * DBERR 007*
     C                     MOVEL@OPTN     DBOPTN           ************
     C                     MOVELBRCA      DBKEY  29
     C                     EXSR *PSSR
     C                     GOTO END
     C                     END
     C*
     C**    PRINT HEADINGS
     C                     Z-ADD0         PAGE
     C                     EXCPTHEAD
     C*
     C                     ELSE
     C                     SETOF                     50
     C                     END
     C                     END
     C                     MOVE BRCA      BRCAL   3
     C*
     C******CHECK*OVERFLOW*I.E.*14*RECORDS*PRINTED                          E242
     C***********COUNT*****IFEQ 14                                          E242
     C**    CHECK OVERFLOW I.E. 13 RECORDS PRINTED                          E242
     C           COUNT     IFEQ 13                                          E242
     C                     MOVE '1'       *INOF
     C                     EXCPTHEAD
     C                     Z-ADD0         COUNT
     C                     MOVE '0'       *INOF
     C                     END
     C***********                                                         E26357
     C******MATURED RECORD READ                                           E26357
     C***********RECI      IFEQ 'M'                                       E26357
     C***********RECI      OREQ 'N'                                       E26357
     C***********                                                         E26357
     C***CHECK*FOR DRS DEAL STATUS                                        E26357
     C***********DLSTS     OREQ 'M'                                       E26357
     C***********          MOVE '1'       *IN42                           E26357
     C************IN32     IFEQ '1'                                       E26357
     C***********          GOTO VALREC                                    E26357
     C***********          END                                            E26357
     C************IN31     IFEQ '1'                                       E26357
     C***********          GOTO READF                                     E26357
     C***********          END                                            E26357
     C***********          END                                            E26357
     C************IN32     IFEQ '1'                                       E26357
     C***********          GOTO READF                                     E26357
     C***********          END                                            E26357
     C***********                                                         E26357
0122 C***********VALREC    TAG                             **VALREC TAG **E26357
     C*
     C**   FORMAT DETAILS FOR OUTPUT
     C*
     C* FRA/IRS DETAILS
     C*
     C           DTYP      IFEQ 'FR'
     C           DTYP      OREQ 'RR'
     C           DTYP      OREQ 'RP'
     C           DTYP      OREQ 'RF'
     C           DTYP      OREQ 'RS'
     C           DTYP      OREQ 'RX'
     C*
     C           DTYP      IFEQ 'RS'
     C           DTYP      OREQ 'RX'
     C                     EXSR #IRS
     C                     ELSE
     C                     EXSR #FRA
     C                     END
     C*
     C                     ADD  1         COUNT
     C*
     C                     ELSE
     C*
     C                     EXSR LINE01
     C                     EXSR LINE02
     C                     ADD  1         COUNT   20
     C**
     C**   PRINT DETAILS
     C                     MOVE '0'       *IN44
     C                     EXCPTDETAIL
     C                     END
     C*
     C                     GOTO READF
0122 C           END       TAG                             ** END   TAG **
     C*                                                                   E26357
     CLR         *IN51     IFEQ '0'                                       E26357
     CLR         *IN44     ANDEQ'1'                                       E26357
     CLR                   OPEN DL2481AU                                  E26357
     C*                                                                   E26357
     C** REPORT SPOOL FILE GENERATION                                     E26357
     C*                                                                   E26357
     CLR                   Z-ADDSFNUMU    ZSNUMU  60                      E26357
     CLR                   OUT  LDA                                       E26357
     CLR                   CALL 'ZSFILE'                                  E26357
     CLR                   PARM           SEQ                             E26357
     CLR                   PARM *BLANKS   @PARM                           E26357
     CLR                   PARM           SFILEU                          E26357
     CLR                   PARM           ZSNUMU                          E26357
     CLR                   PARM *BLANKS   ZSERR                           E26357
     CLR         *LOCK     IN   LDA                                       E26357
     C*                                                                   E26357
     CLR         ZSERR     IFEQ 'Y'                                       E26357
     C*                                                                   E26357
     C** Error during ZSFILE processing, return to calling program.       E26357
     C*                                                                   E26357
     CLR                   SETON                     U7U8                 E26357
     CLR                   RETRN                                          E26357
     CLR                   END                                            E26357
     C*                                                                   E26357
     C**    PRINT HEADINGS                                                E26357
     C*                                                                   E26357
     CLR                   EXCPTAUDIT                                     E26357
     CLR                   END                                            E26357
0179 C/EJECT
     C********************************************************************
     C**
     C**    LINE01 SR TO FORMAT DETAILS OF DEAL FOR LINE 1 OF DETAIL
     C**
     C**    CALLED FROM    MAIN
     C**    CALLS          ZDATE2
     C**
     C           LINE01    BEGSR                           *** DETAIL ***
     C*
     C** INITIALISE ALL REPORT FIELD
     C                     MOVE *BLANKS   DTYPW   5
     C                     MOVE *BLANKS   CLASW   4                       CDL038
     C                     MOVE *BLANKS   STWK    3
0614 C                     MOVEL*BLANKS   NARR1   8
     C                     MOVE *BLANK    FFIN
0614 C                     MOVEL*BLANKS   RDNO    6
     C*
     C** FORMAT DRS DEALS ACCORDING TO FORMAT READ
     C*
     C** CHECK RECORD IDENTIFIER FOR F-X OR MONEY MARKET.
     C           @INDS     IFEQ 'FXDEALP0'                 B1
     C/COPY WNCPYSRC,DLH00261
     C***********@INDS     OREQ 'FXDEALP1'                 X1             E25586
     C                     EXSR #B                         *1
     C                     GOTO ENDDET                     *1
     C                     END                             E1
     C*
     C** FORMAT NON - FX DRS DEALS ************************************
     C*
     C************ DRS DEPOSITS ***************************************
     C*
     C           @INDS     IFEQ 'MMDELDP0'                 B1
     C/COPY WNCPYSRC,DLH00262
     C***********@INDS     OREQ 'MMDELDP1'                 X1             E25586
     C*
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?
     C                     EXSR #C                         *1
     C                     GOTO ENDDET                     *1
     C                     END                             E1
     C*
     C************ NEGOTIABLE ASSETS BOUGHT.***************************
     C*
     C           @INDS     IFEQ 'MMDENBP0'                 B1
     C/COPY WNCPYSRC,DLH00263
     C***********@INDS     OREQ 'MMDENBP1'                 X1             E25586
     C                     EXSR #D                         *1
     C                     GOTO ENDDET                     *1
     C                     END                             E1
     C*
     C************ NEGOTIABLE ASSETS SOLD.*****************************
     C*
     C           @INDS     IFEQ 'MMDENSP0'                 B1
     C/COPY WNCPYSRC,DLH00264
     C***********@INDS     OREQ 'MMDENSP1'                 X1             E25586
     C                     EXSR #E                         *1
     C                     GOTO ENDDET                     *1
     C                     END                             E1
     C**
0563 C**
     C**
     C**   DEAL TYPE TEXT
     C                     MOVELDTYP      DTYPW
     C                     MOVEL'-'       STWK
     C                     MOVE DLST      STWK
     C                     MOVE STWK      DTYPW
     C                     MOVE CLAS      CLASW                           CDL038
     C*
     C** DETERMINE WHICH DEALS TO HAVE BUY/SELL INDICATOR DISPLAYED -
     C** ONLY CAPS, COLLARS, FLOORS AND FRAS
     C**
     C                     MOVE '0'       *IN54
     C           DTYP      IFEQ 'RR'
     C           DTYP      OREQ 'RP'
     C           DTYP      OREQ 'RF'
     C           DTYP      OREQ 'FR'
     C                     MOVE '1'       *IN54
     C                     END
     C*
0564 C**   FX - CHECK FOR OPTION.
0565 C           DTYP      COMP 'OP'                     34
0564 C**   FX - CHECK FOR NOSTRO TRANSFER
0565 C           DTYP      COMP 'NX'                     35
0566 C**   GET DEAL AMOUNT.
0567 C   01                Z-ADDPUAM      AMT1   130
0568 C   02                Z-ADDPCPL      AMT1
0569 C   03                Z-ADDFVAL      AMT1
0570 C   04                Z-ADDSAPR      AMT1
0573 C* IS DEAL FEDERAL FUND
0574 C                     SETOF                     5658
0575 C                     SETON                     5557
0576 C  N01      CCY       COMP BLCYCD                   56
0577 C   01      PUCY      COMP BLCYCD                   56
0578 C   01N56   SLCY      COMP BLCYCD                   58
0579 C   56                TESTB'2'       DSTI       55
0580 C   58                TESTB'3'       DSTI       57
0581 C*    FOR C1 DO NOT SHOW YIELD
0582 C           DTYP      COMP 'C1'                     46
0583 C   46                Z-ADD0         YRAT
0584 C**
0585 C**   GET NO. OF DECIMAL PLACES.
0586 C  N01                GOTO CCY1
     C*
     C** CALL ACCESS PROGRAM
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM SLCY      @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL'08'      DBASE             *DBERROR 008*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELSLCY      DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO ENDDET
     C                     ELSE
0595 C*
     C                     Z-ADDA6NBDP    XDECP   10
     C                     END
     C*
     C*
     C**   SAVE SALE CCY DECIMAL PLACES
     C*
     C                     Z-ADDXDECP     SCCDP   10
0596 C           CCY1      TAG                             ** CCY1 **
0597 C   01                MOVE PUCY      XXCCY   3
0598 C  N01                MOVE CCY       XXCCY
     C*
     C** CALL ACCESS PROGRAM
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM XXCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL'09'      DBASE             *DBERROR 009*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELXXCCY     DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO ENDDET
0595 C*
     C                     ELSE
     C                     Z-ADDA6NBDP    XDECP
     C                     END
     C*
0584 C**
0585 C**  EDIT AMOUNT
0587 C                     Z-ADDAMT1      ZAMNT
0587 C                     MOVE 'Y'       ZCOMMA
0587 C                     MOVE 'N'       ZMINUS
0587 C                     Z-ADDXDECP     ZCDP
     C                     EXSR ZEDIT
     C                     MOVE ZAMNTA    AMT1W  17
0600 C**   FORMAT DATES.
0601 C                     Z-ADDDDAT      ZDAYNO           DEAL DATE
0602 C                     EXSR ZDATE2
0603 C                     MOVE ZADATE    DDATE   7
0604 C*
0605 C                     Z-ADDVDAT      ZDAYNO           VALUE DATE
0606 C                     EXSR ZDATE2
0607 C                     MOVE ZADATE    VDATE   7
0608 C*
0609 C   04
0610 COR 23                GOTO NARDET
0611 C                     Z-ADDMDAT      ZDAYNO           MATURITY OR
0612 C   01                Z-ADDOTDT      ZDAYNO
0613 C                     EXSR ZDATE2                     OPTION TO DATE
0614 C                     MOVE ZADATE    MDATE   7
     C*
     C           NARDET    TAG                             **NARDET TAGSR*
0615 C**
0615 C**  DETERMINE NARR1 FIELD
0614 C   01N35             MOVEL'PURCHASE'NARR1
0610 C   02      MDAT      IFNE 0
0614 C                     MOVELMDATE     NARR1
0610 C                     ELSE
0614 C                     MOVELNOTD      NARR1
0610 C                     END
0614 C   03                MOVELMDATE     NARR1
0615 C**
0615 C**  DETERMINE CCY   FIELD
0614 C   01                MOVELPUCY      CCY
0615 C**
0615 C**  DETERMINE FFIN  FIELD
     C  N55                MOVE 'F'       FFIN    1
0615 C**
0615 C**  DETERMINE RDNO  FIELD
0610 C   01      SODN      IFNE 0
0614 C                     MOVELSODN      RDNO
0610 C                     END
0610 C   02      RODN      IFNE 0
0614 C                     MOVELRODN      RDNO
0610 C                     END
0610 C   02      RBDN      IFNE 0
0614 C                     MOVELRBDN      RDNO
0610 C                     END
0610 C   03      ASDN      IFNE 0
0614 C                     MOVELASDN      RDNO
0610 C                     END
0610 C   04      RPDN      IFNE 0
0614 C                     MOVELRPDN      RDNO
0610 C                     END
0615 C*
     C           ENDDET    ENDSR                           **ENDDET ENDSR*
     C**
     C**
0721 C********************************************************************
0120 C/SPACE 2
0721 C********************************************************************
     C**
     C**
0722 C*    LINE02 SR TO FORMAT DEAL DETAILS FOR LINE 2 OF DETAIL
     C**   CALLED FROM   MAIN
     C**   CALLS SR  ZEDIT RTEDIT
0723 C           LINE02    BEGSR                           ** LIN2SR  ***
0725 C**********           MOVE *BLANKS   LINE2 100                       S01378
     C                     MOVE *BLANKS   LINE2 111                       S01378
0725 C                     MOVEA*BLANKS   LIN
     C                     MOVE *BLANKS   TEXT
     C*
     C** FORMAT DRS DEALS FOR LINE02 ACCORDING TO FORMAT READ
     C*
     C** CHECK RECORD IDENTIFIER FOR F-X OR MONEY MARKET.
     C           @INDS     IFEQ 'FXDEALP0'                 B1
     C/COPY WNCPYSRC,DLH00265
     C***********@INDS     OREQ 'FXDEALP1'                 X1             E25586
     C                     EXSR #F                         *1
     C                     GOTO ENDDT2                     *1
     C                     END                             E1
     C*
     C** FORMAT NON - FX DRS DEALS ************************************
     C*
     C************ DRS DEPOSITS ***************************************
     C*
     C           @INDS     IFEQ 'MMDELDP0'                 B1
     C/COPY WNCPYSRC,DLH00266
     C***********@INDS     OREQ 'MMDELDP1'                 X1             E25586
     C*
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?
     C                     EXSR #G                         *1
     C                     GOTO ENDDT2                     *1
     C                     END                             E1
     C*
     C************ NEGOTIABLE ASSETS BOUGHT.***************************
     C*
     C           @INDS     IFEQ 'MMDENBP0'                 B1
     C/COPY WNCPYSRC,DLH00267
     C***********@INDS     OREQ 'MMDENBP1'                 X1             E25586
     C                     EXSR #H                         *1
     C                     GOTO ENDDT2                     *1
     C                     END                             E1
     C*
     C************ NEGOTIABLE ASSETS SOLD.*****************************
     C*
     C           @INDS     IFEQ 'MMDENSP0'                 B1
     C/COPY WNCPYSRC,DLH00268
     C***********@INDS     OREQ 'MMDENSP1'                 X1             E25586
     C                     EXSR #I                         *1
     C                     GOTO ENDDT2                     *1
     C                     END                             E1
0571 C*    IS DEAL REVERSED
0572 C           RECI      IFEQ 'R'
     C                     MOVE 'REVERSED'TEXT
     C                     END
     C*    OR MATURED
     C           *IN42     IFEQ '1'
     C                     MOVEL'MATURED' TEXT    8
     C                     END
      *  Foreign exchange trades (*IN01)                                  S01378
0726 C           *IN01     IFEQ '1'
0725 C                     MOVEATEXT      LIN,15
0584 C**
0585 C**  EDIT AMOUNT
0587 C                     Z-ADDSLAM      ZAMNT
0587 C                     MOVE 'Y'       ZCOMMA
0587 C                     MOVE 'N'       ZMINUS
0587 C                     Z-ADDSCCDP     ZCDP
0602 C                     EXSR ZEDIT
0603 C                     MOVE ZAMNTA    SLAMWF 17
0725 C   34                MOVEATXT,1     LIN,27
0725 C  N35                MOVEATXT,2     LIN,54
0725 C   34                MOVEAMDATE     LIN,38
0725 C  N35                MOVEASLCY      LIN,63
     C  N57                MOVEA'F'       LIN,72
0725 C  N35                MOVEASLAMWF    LIN,82
0728 C                     ELSE
      * loans/deposits (*IN02)                                            S01378
0726 C           *IN02     IFEQ '1'
0725 C                     MOVEATEXT      LIN,15
     C                     Z-ADDRTSP      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    RTSPXX
0725 C                     MOVEATXT,3     LIN,27
0725 C                     MOVEATXT,4     LIN,52
     C                     MOVE BRTT      BRTTWF  2
0725 C                     MOVEABRTTWF    LIN,39
0725 C                     MOVEARTSPXX    LIN,87
0728 C                     ELSE
      * NA's purchased (*IN03)                                            S01378
0726 C           *IN03     IFEQ '1'
0725 C                     MOVEATEXT      LIN,15
     C                     Z-ADDRTSP      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    RTSPXX 12
     C                     Z-ADDYRAT      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    YRATXX 12
0725 C                     MOVEATXT,5     LIN,27
0725 C                     MOVEATXT,4     LIN,52
0725 C                     MOVEAYRATXX    LIN,33
0725 C                     MOVEARTSPXX    LIN,87
     C*                                                                   S01378
     C** If parcelled NA set up parcel details (remove leading 0's)       S01378
     C           PCLI      IFEQ 'P'                                       S01378
     C                     Z-ADD102       I                               S01378
     C                     MOVEATXT,6     LIN,I                           S01378
     C                     Z-ADDPSZE      @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     Z-ADD107       I                               S01378
     C                     MOVEA@OUTCR    LIN,I                           S01378
     C*                                                                   S01378
     C** If not parcelled must blank out parcelling bit of LIN            S01378
     C                     ELSE                                           S01378
     C                     Z-ADD108       I                               S01378
     C                     MOVEA*BLANKS   LIN,I                           S01378
     C                     END                                            S01378
0728 C                     ELSE
      * NA's sold (*IN04)                                                 S01378
0726 C           *IN04     IFEQ '1'
0725 C                     MOVEATEXT      LIN,15
     C                     Z-ADDYRAT      ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    YRATXX 12
0725 C                     MOVEATXT,5     LIN,27
0725 C                     MOVEAYRATXX    LIN,33
     C*                                                                   S01378
     C** If parcelled NA set up parcel details                            S01378
     C           PCLI      IFEQ 'P'                                       S01378
     C                     Z-ADD102       I       30                      S01378
     C                     MOVEATXT,6     LIN,I                           S01378
     C                     Z-ADDPSZE      @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     Z-ADD107       I                               S01378
     C                     MOVEA@OUTCR    LIN,I                           S01378
     C*                                                                   S01378
     C** If not parcelled must blank out parcelling bit of LIN            S01378
     C                     ELSE                                           S01378
     C                     Z-ADD108       I                               S01378
     C                     MOVEA*BLANKS   LIN,I                           S01378
     C                     END                                            S01378
     C*                                                                   S01378
0728 C                     END
0728 C                     END
0728 C                     END
0728 C                     END
0727 C*
     C           ENDDT2    TAG                             **ENDDT2 ENDSR*
0727 C*
0725 C                     MOVEALIN       LINE2
0727 C*
0728 C                     ENDSR
     C**
0721 C********************************************************************
0120 C/SPACE 2
0746 C********************************************************************
0846 C**
0846 C**
     C*  RTEDIT SR SUBROUTINE TO EDIT A RATE FIELD FOR OUTPUT
     C*
     C*  CALLED BY: LINE02
     C*
     C*  THIS SUBROUTINE CONTERTS AN 11,7 RATE FIELD INTO A 12 ALPHAMERIC
     C*  FIELD WITH LEADING AND TRAILING ZEROS DELETED. IF THE RATE IS
     C*  LESS THAN 1 THEN A ZERO IS PLACED BEFORE THE DECIMAL POINT.
     C*
     C*
     C*  INPUT FIELDS:
     C*                    ZRATE  11 7    AMOUNT FIELD TO BE EDITED
     C*
     C*  OUTPUT FIELDS:
     C*                    ZRATEA 12 A    EDITED AMOUNT FIELD
     C*
     C*  INDICATOR USED:
     C*                    *IN94          SETON IF NON-ZERO CHARACTER
     C*                                   FOUND IN THE AMOUNT
     C*
     C           RTEDIT    BEGSR                           ***  RTEDIT ***
     C*
     C                     Z-ADDZRATE     ZRATE  117       I/P FIELD
     C                     MOVE *BLANK    ZRATEA 12        O/P FIELD
     C                     MOVE '0'       *IN94
     C*
     C                     MOVEA*BLANKS   OUT
     C                     Z-ADD1         J       20
     C*
     C*  CLEAR LEADING ZEROS
     C           J         DOWLE4
     C           *IN94     IFEQ '0'
     C           RAT,J     IFEQ 0
     C                     MOVE ' '       OUT,J
     C                     ELSE
     C                     MOVE RAT,J     OUT,J
     C                     SETON                     94
     C                     END
     C                     ELSE
     C                     MOVE RAT,J     OUT,J
     C                     END
     C                     ADD  1         J
     C                     END
     C*
     C*  MOVE IN DECIMAL POINT
     C           J         IFEQ 5
     C           *IN94     IFEQ '0'
     C                     MOVE '0'       OUT,4
     C                     END
     C                     MOVE '.'       OUT,J
     C                     END
     C*
     C*  POSITION DECIMALS,ADD TRAILING ZEROS
     C                     MOVE '0'       *IN94
     C                     Z-ADD11        J
     C                     Z-ADD12        K       20
     C           J         DOWGE5
     C           *IN94     IFEQ '0'
     C           RAT,J     IFEQ 0
     C                     MOVE '0'       OUT,K
     C                     ELSE
     C                     MOVE RAT,J     OUT,K
     C                     SETON                     94
     C                     END
     C                     ELSE
     C                     MOVE RAT,J     OUT,K
     C                     END
     C                     SUB  1         J
     C                     SUB  1         K
     C                     END
     C*
     C*  FINALLY MOVE  EDITED FIELD INTO O/P FIELD
     C                     MOVEAOUT       ZRATEA
     C*
     C*
     C                     ENDSR
0846 C**
0721 C********************************************************************
0120 C/SPACE 2
0746 C********************************************************************
     C*
     C*    #FRA - DEAL TYPES FR;RR;RP;RF
     C*
     C*****************************************************************
     C*
     C           #FRA      BEGSR
     C*
     C* FORMAT DEAL DATE , VALUE DATE , MATURITY DATE
     C*
     C                     Z-ADDDDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @DLDAT  8
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @VLDAT  8
     C*
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @MTDAT  8
     C*
     C* FORMAT REL DEAL NO.
     C*
     C           LNKDN     IFEQ 0
     C                     MOVE *BLANK    @LNKDN  6
     C                     ELSE
     C                     MOVE LNKDN     @LNKDN
     C                     END
     C*
     C* SET CONDITIONING INDICATOR FOR BUY/SELL FIELD
     C*
     C                     MOVE '1'       *IN70
     C*
     C* SET FED FUNDS INDICATOR
     C*
     C           UCUCY     IFEQ 'USD'
     C                     MOVE '1'       *IN74
     C*
     C                     TESTB'2'       UDSTI          76
     C           *IN76     IFEQ '1'
     C                     MOVE 'Y'       @FEDF   1
     C                     ELSE
     C                     MOVE *BLANK    @FEDF
     C                     END
     C*
     C                     END
     C*
     C* RETRIEVE  NO. DEC PLACES
     C*
     C                     MOVE UCUCY     XXCCY
     C*
     C** CALL ACCESS PROGRAM
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM XXCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL'10'      DBASE             *DBERROR 010*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELXXCCY     DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO #FRA9
0595 C*
     C                     ELSE
     C                     Z-ADDA6NBDP    XDECP
     C                     END
     C*
     C*
     C* FORMAT DEAL AMOUNT
     C*
     C                     Z-ADDUPAMT     ZAMNT
     C                     Z-ADDXDECP     ZCDP
     C                     MOVE 'Y'       ZCOMMA
     C                     MOVE 'N'       ZMINUS
     C                     EXSR ZEDIT
     C                     MOVE ZAMNTA    @DLAMT 17
     C*
     C* IF DEAL REVERSED
     C*
     C           RECI      IFEQ 'R'
     C                     MOVE 'REVERSED'@TEXT   8
     C                     END
     C*
     C* MATURED
     C*
     C           *IN42     IFEQ '1'
     C                     MOVEL'MATURED' @TEXT
     C                     END
     C*
     C* DEAL TYPE RF/RR FORMAT FLOOR RATE
     C*
     C           DTYP      IFEQ 'RF'
     C           DTYP      OREQ 'RR'
     C*
     C                     Z-ADDFLRAT     ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    @CLRAT 12
     C                     MOVE ZRATEA    @FLRAT 12
     C                     END
     C*
     C* DEAL TYPE RP/RR FORMAT CEILING RATE
     C*
     C           DTYP      IFEQ 'RP'
     C           DTYP      OREQ 'RR'
     C*
     C                     Z-ADDCLRAT     ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    @CLRAT
     C                     MOVE '1'       *IN71
     C                     END
     C*
     C* SET FLOOR RATE TEXT FOR RR DEALS
     C*
     C           DTYP      IFEQ 'RR'
     C                     MOVE '1'       *IN72
     C                     END
     C*
     C* SETUP BASE RATE & INTEREST/SPREAD RATE , SPREAD IND
     C*  1. FOR RR RP RF - IE NOT FR
     C*
     C           DTYP      IFNE 'FR'
     C*
     C           DTYP      IFEQ 'RP'
     C           BYSL      ANDEQ'B'
     C           DTYP      OREQ 'RR'
     C           BYSL      ANDEQ'B'
     C           DTYP      OREQ 'RF'
     C           BYSL      ANDEQ'S'
     C*
     C                     MOVE TSPIN     @SPIN   2
     C                     MOVE TBRTT     @BTYP   2
     C                     Z-ADDTRTSP     ZRATE
     C*
     C                     ELSE
     C*
     C                     MOVE USPIN     @SPIN
     C                     MOVE UBRTT     @BTYP
     C                     Z-ADDURTSP     ZRATE
     C*
     C                     END
     C*
     C* ELSE -  2. DTYP IS FR
     C*
     C                     ELSE
     C*
     C           BYSL      IFEQ 'B'
     C*
     C                     MOVE TBRTT     @BTYP
     C                     Z-ADDURTSP     ZRATE
     C*
     C* ELSE FR IS SOLD
     C*
     C                     ELSE
     C*
     C                     MOVE UBRTT     @BTYP
     C                     Z-ADDTRTSP     ZRATE
     C*
     C                     END
     C*
     C                     END
     C*
     C* FORMAT SPREAD/INTEREST RATE , AKA CONTRACT RATE
     C*
     C           ZRATE     IFEQ 0
     C                     MOVE *BLANK    @RATE
     C                     ELSE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    @RATE  12
     C                     END
     C*
     C* PRINT DETAILS
     C*
     C                     MOVE '0'       *IN44
     C                     EXCPTCOMMON
     C*
     C           DTYP      IFEQ 'FR'
     C                     EXCPTFRDET
     C                     ELSE
     C                     EXCPTRRDET
     C                     END
     C*
     C           #FRA9     ENDSR
     C*
0746 C********************************************************************
0120 C/SPACE 2
0746 C********************************************************************
     C*
     C*    #IRS - DEAL TYPES RS/RX
     C*
0746 C********************************************************************
     C*
     C           #IRS      BEGSR
     C*
     C*
     C* FORMAT DEAL DATE , VALUE DATE , MATURITY DATE
     C*
     C                     Z-ADDDDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @DLDAT
     C*
     C                     Z-ADDVDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @VLDAT
     C*
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    @MTDAT
     C*
     C* FORMAT OUR/THEIR BASE RATE
     C*
     C********** UBRTT     IFEQ 0                                                             CSD103
     C           UBRTT     IFEQ *BLANKS                                                       CSD103
     C                     MOVE *BLANK    @UBRTT  2
     C                     ELSE
     C                     MOVE UBRTT     @UBRTT
     C                     END
     C*
     C********** TBRTT     IFEQ 0                                                             CSD103
     C           TBRTT     IFEQ *BLANKS                                                       CSD103
     C                     MOVE *BLANK    @TBRTT  2
     C                     ELSE
     C                     MOVE TBRTT     @TBRTT
     C                     END
     C*
     C* SET FED FUNDS INDICATOR
     C*
     C           UCUCY     IFEQ 'USD'
     C                     MOVE '1'       *IN74
     C*
     C                     TESTB'2'       UDSTI          76
     C           *IN76     IFEQ '1'
     C                     MOVE 'Y'       @FEDF   1
     C                     ELSE
     C                     MOVE *BLANK    @FEDF
     C                     END
     C*
     C                     END
     C*
     C* RETRIEVE  NO. DEC PLACES FOR OUR SIDE
     C*
     C                     MOVE UCUCY     XXCCY
     C*
     C** CALL ACCESS PROGRAM
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM XXCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL'11'      DBASE             *DBERROR 011*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELXXCCY     DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO #IRS9
0595 C*
     C                     ELSE
     C                     Z-ADDA6NBDP    XDECP
     C                     END
     C*
     C*
     C* FORMAT OUR SIDE DEAL AMOUNT
     C*
     C                     Z-ADDUPAMT     ZAMNT
     C                     Z-ADDXDECP     ZCDP
     C                     MOVE 'Y'       ZCOMMA
     C                     MOVE 'N'       ZMINUS
     C                     EXSR ZEDIT
     C                     MOVE ZAMNTA    @DLAMT 17
     C*
     C* IF DEAL REVERSED
     C*
     C           RECI      IFEQ 'R'
     C                     MOVE 'REVERSED'@TEXT   8
     C                     END
     C*
     C* MATURED
     C*
     C           *IN42     IFEQ '1'
     C                     MOVEL'MATURED' @TEXT
     C                     END
     C*
     C* IF DEAL IS RX - FORMAT THEIR AMOUNT & OUTPUT THEIR CCY
     C*
     C           DTYP      IFEQ 'RX'
     C*
     C                     MOVE '1'       *IN73
     C*
     C* SET FED FUNDS INDICATOR
     C*
     C           TCUCY     IFEQ 'USD'
     C                     MOVE '1'       *IN75
     C*
     C                     TESTB'2'       TDSTI          76
     C           *IN76     IFEQ '1'
     C                     MOVE 'Y'       @FEDF   1
     C                     ELSE
     C                     MOVE *BLANK    @FEDF
     C                     END
     C*
     C                     END
     C*
     C* THEIR AMT
     C*
     C*
     C* RETRIEVE  NO. DEC PLACES FOR THEIR SIDE
     C*
     C                     MOVE TCUCY     XXCCY
     C*
     C** CALL ACCESS PROGRAM
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM XXCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL'12'      DBASE             *DBERROR 012*
     C                     MOVEL@OPTN     DBOPTN            *************
     C                     MOVELXXCCY     DBKEY
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     GOTO #IRS9
     C                     ELSE
     C                     Z-ADDA6NBDP    XDECP
     C                     END
     C*
     C*
     C* FORMAT THEIR SIDE DEAL AMOUNT
     C*
     C                     Z-ADDTPAMT     ZAMNT
     C                     Z-ADDXDECP     ZCDP
     C                     MOVE 'Y'       ZCOMMA
     C                     MOVE 'N'       ZMINUS
     C                     EXSR ZEDIT
     C                     MOVE ZAMNTA    @RXAMT 17
     C*
     C                     END
     C*
     C* FORMAT OUR & THEIR INTEREST/SPREAD
     C*
     C           URTSP     IFEQ 0
     C                     MOVE *BLANK    @ORATE
     C                     ELSE
     C                     Z-ADDURTSP     ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    @ORATE 12
     C                     END
     C*
     C           TRTSP     IFEQ 0
     C                     MOVE *BLANK    @TRATE
     C                     ELSE
     C                     Z-ADDTRTSP     ZRATE
     C                     EXSR RTEDIT
     C                     MOVE ZRATEA    @TRATE 12
     C                     END
     C*
     C* PRINT DETAILS
     C*
     C                     MOVE '0'       *IN44
     C                     EXCPTCOMMON
     C                     EXCPTRXDET
     C*
     C           #IRS9     ENDSR
     C*
0746 C********************************************************************
0120 C/SPACE 2
0746 C********************************************************************
0846 C**
     C*
     C*  ZEDIT SR. SUBROUTINE TO EDIT AN AMOUNT FIELD FOR OUTPUT
     C*
     C*  CALLED BY: BASFMT, ENQFMT
     C*
     C*  INPUT FIELDS:
     C*                    ZAMNT  15 0    AMOUNT FIELD TO BE EDITED
     C*                    ZCDP    1,0    NO. OF DECIMAL PLACES
     C*                    ZCOMMA  1 A    COMMAS WANTED ('Y' OR 'N')
     C*                    ZMINUS  1 A    MINUS SIGN WANTED ('Y' OR 'N')
     C*
     C*  OUTPUT FIELDS:
     C*                    ZAMNTA 21 A    EDITED AMOUNT FIELD
     C*
     C*  INDICATOR USED:
     C*                    *IN94          SETON IF NON-ZERO CHARACTER
     C*                                   FOUND IN THE AMOUNT
     C*
     C           ZEDIT     BEGSR                           ***  ZEDIT  ***
     C*
     C                     Z-ADDZAMNT     ZAMNT  150       I/P FIELD
     C                     MOVE ZCOMMA    ZCOMMA  1        VALUE Y OR N
     C                     MOVE ZMINUS    ZMINUS  1        VALUE Y OR N
     C                     Z-ADDZCDP      ZCDP    10       NO. OF DPs.
     C                     MOVE *BLANK    ZAMNTA 21        O/P FIELD
     C                     MOVE '0'       *IN94
     C*
     C                     MOVE *BLANK    ZAMNTB 16        NON-COMMA EDIT
     C                     MOVE *BLANK    ZAMNTC 20        NON-COMMA EDIT
     C                     MOVE *BLANK    ZAMNTD 17        NON-COMMA EDIT
     C                     MOVE *BLANK    ZFLD3  16        NON-COMMA EDIT
     C                     MOVE '00000000'ZFLD1  15
     C                     MOVEL'0000000' ZFLD1
     C                     MOVE *BLANK    ZFLD2  20
     C                     MOVE ' '       ZMINS   1        MINUS CHARCTER
     C                     MOVEA*BLANK    ZEDT
     C                     MOVEA*BLANK    ZED2
     C                     MOVEA*BLANK    ZAMT
     C                     MOVEA*BLANK    Z3
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C*  PROCESS AMOUNT AS A POSTIVE NUMBER EVEN IF NEGATIVE
     C           ZMINUS    IFEQ 'Y'                        **** B1
     C           ZAMNT     IFLT 0                          **** B2
     C                     MOVE '-'       ZMINS
     C                     Z-SUBZAMNT     ZAMNT
     C                     ELSE                            **** X2
     C                     MOVE ' '       ZMINS
     C                     END                             **** E2
     C                     ELSE                            **** X2
     C           ZAMNT     IFLT 0                          **** B2
     C                     Z-SUBZAMNT     ZAMNT
     C                     END                             **** E2
     C                     END                             **** E1
     C*
     C*  SEPARATE INTEGER AND DECIMAL PARTS OF AMOUNT
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B1
     C                     MOVE ZAMNT     ZFLD1
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B2
     C                     MOVE ZAMNT     ZDEC1   1
     C                     MOVELZAMNT     ZAMT1  14
     C                     MOVE ZAMT1     ZFLD1
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B3
     C                     MOVE ZAMNT     ZDEC2   2
     C                     MOVELZAMNT     ZAMT2  13
     C                     MOVE ZAMT2     ZFLD1
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B4
     C                     MOVE ZAMNT     ZDEC3   3
     C                     MOVELZAMNT     ZAMT3  12
     C                     MOVE ZAMT3     ZFLD1
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B5
     C                     MOVE ZAMNT     ZDEC8   8
     C                     MOVELZAMNT     ZAMT8   7
     C                     MOVE ZAMT8     ZFLD1
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C                     END                             **** E1
     C*
     C*  MOVE THE INTEGER FIELD INTO A 5X3 ARRAY FOR EDITING
     C                     MOVEAZFLD1     ZAMT
     C*
     C/SPACE 3
     C*
     C****
     C*
     C*  CHECK IF COMMAS ARE NEEDED OR NOT
     C*
     C****
     C           ZCOMMA    IFEQ 'Y'                        **** E1
     C****
     C*
     C*  IF ZCOMMA  IS 'Y' MOVE COMMAS ETC. INTO A 5X4 EDITED ARRAY
     C*  (FOR ZERO DECIMAL PLACES DO NOT WANT A DECIMAL POINT)
     C*
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVEAZCOM,1    ZEDT
     C                     ELSE
     C                     MOVEAZCOM,2    ZEDT
     C                     END                             **** E2
     C*
     C*
     C*  READ THROUGH AMOUNT ARRAY SO AS TO PLACE EDITED DIGITS
     C*  INTO ZEDT. THE ARRAY IS READ 3 CHARACTERS AT A TIME.
     C*  ALL LEADING ZEROES ARE SUPPRESSED.
     C                     DO   5         Z       10       **** B2
     C*
     C           *IN94     IFEQ '1'                        **** B3
     C                     MOVELZAMT,Z    ZEDT,Z
     C                     ELSE
     C*
     C*  BLANK OUT EDITED FIELD IF ZEROES ARE FOUND
     C           ZAMT,Z    IFEQ '000'                      **** B4
     C           Z         IFNE 5                          **** B5
     C                     MOVE '    '    ZEDT,Z
     C                     END                             **** E5
     C                     ELSE
     C*
     C*  WHEN FIRST NON ZERO CHARACTERS ARE REACHED REMOVE LEADING
     C*  ZEROES. READ ARRAY ELEMENT 1 CHARACTER AT A TIME.
     C                     MOVE '1'       *IN94
     C                     Z-ADD1         ZN      10
     C                     MOVEAZAMT,Z    Z3
     C           Z3,ZN     DOWEQ'0'                        **** B5
     C                     MOVE ' '       Z3,ZN
     C                     ADD  1         ZN
     C                     END                             **** E5
     C                     MOVEAZ3        ZEDT,Z
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  PLACE EDITED ARRAY INTO ALPHA FIELD TO INCLUDE DECIMALS.
     C                     MOVEAZEDT      ZFLD2
     C*
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVELZFLD2     ZAMT0  19
     C                     MOVE ZAMT0     ZAMNTC
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B3
     C                     MOVE ZFLD2     ZAMT1A 19
     C                     MOVELZAMT1A    ZAMNTC
     C                     MOVE ZDEC1     ZAMNTC
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B4
     C                     MOVE ZFLD2     ZAMT2A 18
     C                     MOVELZAMT2A    ZAMNTC
     C                     MOVE ZDEC2     ZAMNTC
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B5
     C                     MOVE ZFLD2     ZAMT3A 17
     C                     MOVELZAMT3A    ZAMNTC
     C                     MOVE ZDEC3     ZAMNTC
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B6
     C                     MOVE ZFLD2     ZAMT8A 12
     C                     MOVELZAMT8A    ZAMNTC
     C                     MOVE ZDEC8     ZAMNTC
     C                     END                             **** E6
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C           ZMINUS    IFEQ 'Y'                        **** B2
     C                     MOVELZAMNTC    ZAMNTA
     C                     MOVE ZMINS     ZAMNTA
     C                     ELSE                            **** X2
     C                     MOVE ZAMNTC    ZAMNTA
     C                     END                             **** E2
     C*
     C****                                                 ****
     C*
     C                     ELSE                            **** X1
     C*
     C****                                                 ****
     C*
     C*  ELSE IF ZCOMMA EQUAL 'N':
     C*  MOVE FORMAT LEFT INTO A 6X3 ARRAY - 6TH ELEMENT CONTAINS D.P.
     C*  (FOR ZERO DECIMAL PLACES DO NOT WANT A DECIMAL POINT)
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVEAZCOM,3    ZED2
     C                     ELSE
     C                     MOVEAZCOM,4    ZED2
     C                     END                             **** E2
     C*
     C*
     C*  READ THROUGH AMOUNT ARRAY SO AS TO PLACE EDITED DIGITS
     C*  INTO ZED2. THE ARRAY IS READ 3 CHARACTERS AT A TIME.
     C*  ALL LEADING ZEROES ARE SUPPRESSED.
     C                     DO   5         Z       10       **** B2
     C*
     C           *IN94     IFEQ '1'                        **** B3
     C                     MOVELZAMT,Z    ZED2,Z
     C                     ELSE
     C*
     C*  SEARCH FOR FIRST NONE-ZERO CHARACTERS
     C           ZAMT,Z    IFNE '000'                      **** B4
     C*
     C*  WHEN FIRST NON ZERO CHARACTERS ARE REACHED REMOVE LEADING
     C*  ZEROES. READ ARRAY ELEMENT 1 CHARACTER AT A TIME.
     C                     MOVE '1'       *IN94
     C                     Z-ADD1         ZN      10
     C                     MOVEAZAMT,Z    Z3
     C           Z3,ZN     DOWEQ'0'                        **** B5
     C                     MOVE ' '       Z3,ZN
     C                     ADD  1         ZN
     C                     END                             **** E5
     C                     MOVEAZ3        ZED2,Z
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  PLACE EDITED ARRAY INTO ALPHA FIELD TO INCLUDE DECIMALS.
     C                     MOVEAZED2      ZFLD3
     C*
     C*  - ZERO DECIMAL PLACES
     C           ZCDP      IFEQ 0                          **** B2
     C                     MOVELZFLD3     ZAMT0B 15
     C                     MOVE ZAMT0B    ZAMNTB
     C                     ELSE
     C*
     C*  - ONE DECIMAL PLACE
     C           ZCDP      IFEQ 1                          **** B3
     C                     MOVE ZFLD3     ZAMT1B 15
     C                     MOVELZAMT1B    ZAMNTB
     C                     MOVE ZDEC1     ZAMNTB
     C                     ELSE
     C*
     C*  - TWO DECIMAL PLACES
     C           ZCDP      IFEQ 2                          **** B4
     C                     MOVE ZFLD3     ZAMT2B 14
     C                     MOVELZAMT2B    ZAMNTB
     C                     MOVE ZDEC2     ZAMNTB
     C                     ELSE
     C*
     C*  - THREE DECIMAL PLACES
     C           ZCDP      IFEQ 3                          **** B5
     C                     MOVE ZFLD3     ZAMT3B 13
     C                     MOVELZAMT3B    ZAMNTB
     C                     MOVE ZDEC3     ZAMNTB
     C                     ELSE
     C*
     C*  - EIGHT DECIMAL PLACES
     C           ZCDP      IFEQ 8                          **** B6
     C                     MOVE ZFLD3     ZAMT8B  8
     C                     MOVELZAMT8B    ZAMNTB
     C                     MOVE ZDEC8     ZAMNTB
     C                     END                             **** E6
     C                     END                             **** E5
     C                     END                             **** E4
     C                     END                             **** E3
     C                     END                             **** E2
     C*
     C*  INCLUDE MINUS SIGN IF NEEDED
     C           ZMINUS    IFEQ 'Y'                        **** B2
     C                     MOVELZAMNTB    ZAMNTD
     C                     MOVE ZMINS     ZAMNTD
     C                     ELSE                            **** X2
     C                     MOVE ZAMNTB    ZAMNTD
     C                     END                             **** E2
     C*
     C*  FINALLY MOVE NON-COMMA EDITED FIELD INTO O/P FIELD
     C                     MOVE ZAMNTD    ZAMNTA
     C*
     C****
     C                     END
     C****
     C                     ENDSR
     C*
0721 C********************************************************************
0120 C/SPACE 2
0180 C********************************************************************
0181 C**
0182 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
0183 C**
0184 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
0185 C**
0186 C           ZDATE2    BEGSR                           *** ZDATE2 ***
0187 C**
0188 C**   CLEAR DATE FIELDS.
0189 C                     Z-ADD0         ZDATE   60
0190 C                     MOVEL'       ' ZADATE  7
0191 C**
0192 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
0193 C                     Z-ADDZDAYNO    ZDAYNO  50
0194 C**
0195 C**   DETERMINE YEAR NUMBER.
0196 C**
0197 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
0198 C           ZDAYNO    SUB  1         ZDAYN1  50   99
0199 C   99                GOTO ZDEND2
0200 C**
0201 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
0202 C           ZDAYN1    DIV  1461      ZLYR    20
0203 C                     MVR            ZDAYN1           SAVE REMAINING
0204 C**                                                   DAYS
0205 C**   CALCULATE NUMBER OF REMAINING YEARS.
0206 C                     Z-ADD1         ZWRK2   20
0207 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
0208 C           ZDAYN1    COMP ZYDY,ZWRK2             90
0209 C  N90      ZWRK2     ADD  1         ZWRK2
0210 C  N90                GOTO ZDTAG1
0211 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
0212 C**
0213 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
0214 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
0215 C**
0216 C**   CALCULATE ACTUAL YEAR NUMBER.
0217 C           ZLYR      MULT 4         ZWRK3   30
0218 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
0219 C                     Z-ADDZWRK3     ZYEAR   20
0220 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
0221 C**
0222 C**   DETERMINE MONTH NUMBER.
0223 C**
0224 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
0225 C                     SETOF                     9293
0226 C   91      ZDAYN1    COMP 59                     9293
0227 C   91N92   ZDAYN1    SUB  1         ZDAYN1
0228 C**
0229 C**   CALCULATE MONTH NUMBER.
0230 C                     Z-ADD2         ZWRK2
0231 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
0232 C           ZDAYN1    COMP ZMDY,ZWRK2             94
0233 C  N94      ZWRK2     ADD  1         ZWRK2
0234 C  N94                GOTO ZDTAG2
0235 C           ZWRK2     SUB  1         ZWRK2
0236 C**
0237 C                     Z-ADDZWRK2     ZMTH    20       MONTH
0238 C**
0239 C**   DETERMINE DAY OF MONTH.
0240 C**
0241 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
0242 C           ZDAYN1    ADD  1         ZDAYN1
0243 C**
0244 C**   CALCULATE DAY OF MONTH.
0245 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
0246 C**
0247 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
0248 C   93      ZDAY      ADD  1         ZDAY
0249 C**
0250 C**   FORMAT DATE, DDMMYY OR MMDDYY.
0251 C  N98                MOVELZDAY      ZWRK4   40
0252 C   98                MOVE ZDAY      ZWRK4
0253 C  N98                MOVE ZMTH      ZWRK4
0254 C   98                MOVELZMTH      ZWRK4
0255 C                     MOVELZWRK4     ZDATE
0256 C                     MOVE ZYEAR     ZDATE
0257 C**
0258 C**   FORMAT ALPHA DATE, DDMMMYY.
0259 C           ZDAY      COMP 10                     95
0260 C                     MOVELZDAY      ZWRK5   5
0261 C   95                MOVEL' '       ZWRK5
0262 C                     MOVE ZMNM,ZMTH ZWRK5
0263 C                     MOVELZWRK5     ZADATE
0264 C                     MOVE ZYEAR     ZADATE
0265 C**
0266 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
0267 C**
0268 C**
0269 C********************************************************************
0270 C/SPACE 2
     C***************************************************************
     C*
     C* #A        -  DRS INITIAL PROCESSING
     C*
     C* CALLS       -
     C*
     C* CALLED BY   - MAIN PROGRAM
     C*
     C* FLDS USED   -
     C*
     C***************************************************************
     C           #A        BEGSR
     C*
     C** SET UP PROGRAM NAME
     C                     MOVEL'DL2481'  DBPGM
     C*
     C** RETRIEVE THE EXTERNAL DATAAREA MMOD
     C           *NAMVAR   DEFN MMOD      MMODS
     C                     IN   MMODS
     C*
     C***********MODFD     IFEQ 'Y'                        B1             065877
     C***********          OPEN FDPMNTLL                   *1             E35494
     C                     OPEN FDMNTHLL                   *1             E35494
     C***********          OPEN FDINSTLL                   *1             E35494
     C*
     C***ACCESS*DRS*INSTALLATION*CONTROL*DATA*****************************E35494
     C***********1         SETLLFDINSTLL                   *1             E35494
     C***********          READ FDINSTLL                 61*1             E35494
     C***********                                                         E35494
     C***IF*RECORD*NOT*FOUND*DATABASE*ERROR*******************************E35494
     C************IN61     IFEQ '1'                        B*2            E35494
     C***********IDDLTF    OREQ '*'                        **2            E35494
     C**********           CALL 'AODEALR0'                                E35494              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       E35494
     C                     PARM '*FIRST ' @OPTN   7                       E35494
     C********** SDDEAL    PARM SDDEAL    DSFDY                           E35494              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                    B1             E35494
     C                     MOVE '001'     DBASE            ***************
     C*********************MOVEL'FDINSTLL'DBFILE**************************E35494
     C                     MOVEL'SDDEALPD'DBFILE           *             *E35494
     C                     MOVE *BLANKS   DBKEY            * DBERROR 001 *
     C                     MOVE '1'       *INU7            *             *
     C                     MOVE '1'       *INU8            ***************
     C                     EXSR *PSSR
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*
     C** ACCESS MONTH NAME FILE
     C***********1*********SETLLFDPMNTLL********************1*************E35494
     C*********************READ*FDPMNTLL*****************61*1*************E35494
     C           1         SETLLFDMNTHLL                   *1             E35494
     C                     READ FDMNTHLL                 61*1             E35494
     C*
     C** IF RECORD NOT FOUND DATABASE ERROR
     C           *IN61     IFEQ '1'                        B*2
     C***********IDDLTF    OREQ '*'                        **2            E35494
     C                     MOVE '002'     DBASE            ***************
     C***********          MOVEL'FDPMNTLL'DBFILE           *             *E35494
     C                     MOVEL'FDMNTHLL'DBFILE           *             *E35494
     C                     MOVE *BLANKS   DBKEY            * DBERROR 002 *
     C                     MOVE '1'       *INU7            *             *
     C                     MOVE '1'       *INU8            ***************
     C                     EXSR *PSSR
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*
0757 C*
     C** CALL ACCESS PROGRAM FOR TRADING DATA DETAILS
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*FIRST  '@OPTN
     C           @TRAD     PARM @TRAD     DSFDY
     C*
     C** IF RECORD NOT FOUND DATABASE ERROR
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDTRADPD'DBFILE
     C                     MOVEL@OPTN     DBOPTN
     C                     MOVE '003'     DBASE            ***************
     C                     MOVE *BLANKS   DBKEY            * DBERROR 003 *
     C                     MOVE '1'       *INU7            *             *
     C                     MOVE '1'       *INU8            ***************
     C                     EXSR *PSSR
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*
     C***********          END                             E1             065877
     C*
     C***********          OPEN DEALSLL                    *1             E25586
     C                     OPEN CACUSDL1                                  E25586
      *                                                                   CSD007
      ** Access Switchable Features file and check if CSD007              CSD007
      ** is switched on or not.                                           CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD   7                       CSD007
     C                     PARM '*VERIFY' @OPTN   7                       CSD007
     C                     PARM 'CSD007'  @SARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
      *                                                                   CSD007
      ** Database Error, if Return Code is not blanks or *NRF             CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVEL'007'     DBASE                           CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'CSD007  'DBKEY                           CSD007
     C                     MOVE *ON       *INU7                           CSD007
     C                     MOVE *ON       *INU8                           CSD007
     C                     MOVE *ON       *INLR                           CSD007
     C                     EXSR *PSSR                                     CSD007
     C                     GOTO END                                       CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
     C*
     C*
     C/COPY WNCPYSRC,DLH00269
     C           #A9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#B**********-**FORMAT*FXDEALP0*OR*FXDEALP1*FOR*LINE01*********    E25586
     C* #B          -  FORMAT FXDEALP0 FOR LINE01                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C**   DEAL TYPE TEXT
     C***********          MOVELFHTYPE    DTYPW                           E26291
     C                     MOVELDTYP      DTYPW                           E26291
     C                     MOVEL'-'       STWK
     C                     MOVE FHSTYP    STWK
     C                     MOVE STWK      DTYPW
     C                     MOVE FHCLAS    CLASW                           CDL038
     C*
     C                     MOVE FHDN38    DLNO
     C*
     C** FORMAT REMAINING F-X FIELDS.
     C*
     C** FORMAT DEAL VALUE AND DEAL DONE DATE.
     C                     EXSR #K
     C*
     C** SET UP NARRATIVE
     C                     MOVEL'PURCHASE'NARR1
     C*
     C** OBTAIN BUY/SELL CURRENCY AND AMOUNT.
     C                     EXSR ZA0670
     C*
     C** ACCESS*CURRENCY*TABLE*
      * ACCESS CURRENCY DETAILS VIA ACCESS PGM
     C                     MOVE @@DBCC    SSCCY   3
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM SSCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL@OPTN     DBOPTN            * DBERR 013*
     C                     MOVELSSCCY     DBKEY             *************
     C                     MOVEL'013'     DBASE
     C                     EXSR *PSSR
     C                     SETON                     U7U8LR
     C                     GOTO #B9
     C                     END
     C*
     C*
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY
     C           FHFEDF    IFEQ 'Y'                        B1
     C           @@DBCC    IFEQ BLCYCD                     B*2
     C                     MOVE 'F'       FFIN             **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C*
     C** FORMAT THE PURCHASE AMOUNT
     C                     MOVE @@DBCC    @@CCY
     C                     Z-ADDA6NBDP    @@CDP
     C                     Z-ADD@@DBAM    @@IAMT
     C                     Z-ADD16        @@CRET
     C                     EXSR ZA0750
     C                     MOVE @@ADSP    AMT1W
     C*
     C                     MOVE FHDADN    RDNO
     C*
     C           #B9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#C**********-**FORMAT*MMDELDP0*OR*MMDELDP1*FOR*LINE01**********   E25586
     C* #C          -  FORMAT MMDELDP0 FOR LINE01                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?
     C*
     C**   DEAL TYPE TEXT
     C***********          MOVELHKTYPE    DTYPW                           E26291
     C                     MOVELDTYP      DTYPW                           E26291
     C                     MOVEL'-'       STWK
     C                     MOVE HKSTYP    STWK
     C                     MOVE STWK      DTYPW
     C                     MOVE HKCLAS    CLASW                           CDL038
     C                     MOVE HKDN38    DLNO
     C*
     C** FORMAT THE DATES
     C                     EXSR #K
     C                     MOVEL@MDT      NARR1
     C                     MOVE HKCCY     CCY
     C*
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY
     C           HKFEDF    IFEQ 'Y'                        B1
     C           CCY       IFEQ BLCYCD                     B*2
     C                     MOVE 'F'       FFIN             **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** TAKE LDI AMOUNT AND EDIT.
     C                     Z-ADDHKAMNP    @@IAMT 150
     C                     MOVE HKCCY     @@CCY   3
     C                     Z-ADD16        @@CRET  20
     C                     Z-ADDHKCYDP    @@CDP   10
     C                     EXSR ZA0750
     C                     MOVE @@ADSP    AMT1W
     C*
     C** SET ASSOCIATED DEAL NUMBER
     C                     MOVELHKDADN    RDNO
     C*
     C*
     C           #C9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#D**********-**FORMAT*MMDENBP0*OR*MMDENBP1*FOR*LINE01**********   E25586
     C* #D          -  FORMAT MMDENBP0 FOR LINE01                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #D        BEGSR
     C*
     C**   DEAL TYPE TEXT
     C***********          MOVELHLTYPE    DTYPW                           E26291
     C                     MOVELDTYP      DTYPW                           E26291
     C                     MOVEL'-'       STWK
     C                     MOVE HLSTYP    STWK
     C                     MOVE STWK      DTYPW
     C                     MOVE HLCLAS    CLASW                           CDL038
     C                     MOVE HLDN38    DLNO
     C*
     C** FORMAT ASSOCIATED DATES
     C                     EXSR #K
     C                     MOVEL@MDT      NARR1
     C                     MOVE HLCCY     CCY
     C*
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY
     C           HLFEDF    IFEQ 'Y'                        B1
     C           CCY       IFEQ BLCYCD                     B*2
     C                     MOVE 'F'       FFIN             **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** TAKE NAB AMOUNT AND EDIT.
     C                     MOVE HLAMNP    @@IAMT 150
     C                     MOVE HLCCY     @@CCY   3
     C                     Z-ADD16        @@CRET  20
     C                     MOVE HLCYDP    @@CDP   10
     C                     EXSR ZA0750
     C                     MOVE @@ADSP    AMT1W
     C*
     C** SET ASSOCIATED DEAL NUMBER
     C                     MOVELHLDADN    RDNO
     C*
     C           #D9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#E**********-**FORMAT*MMDENSP0*OR*MMDENSP1*FOR*LINE01**********   E25586
     C* #E          -  FORMAT MMDENSP0 FOR LINE01                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -  LINE01                                         *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #E        BEGSR
     C*
     C**   DEAL TYPE TEXT
     C***********          MOVELHMTYPE    DTYPW                           E26291
     C                     MOVELDTYP      DTYPW                           E26291
     C                     MOVEL'-'       STWK
     C                     MOVE HMSTYP    STWK
     C                     MOVE STWK      DTYPW
     C                     MOVE HMCLAS    CLASW                           CDL038
     C                     MOVE HMDN38    DLNO
     C*
     C** FORMAT ASSOCIATED DATES
     C                     EXSR #K
     C                     MOVEL@MDT      NARR1
     C                     MOVE HMCCY     CCY
     C*
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY
     C           HMFEDF    IFEQ 'Y'                        B1
     C           CCY       IFEQ BLCYCD                     B*2
     C                     MOVE 'F'       FFIN             **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** TAKE NAS AMOUNT AND EDIT.
     C                     Z-ADDHMAMNP    @@IAMT
     C                     MOVE HMCCY     @@CCY
     C                     Z-ADD16        @@CRET
     C                     Z-ADDHMCYDP    @@CDP
     C                     EXSR ZA0750
     C                     MOVE @@ADSP    AMT1W
     C*
     C** SET ASSOCIATED DEAL NUMBER
     C                     MOVE HMDADN    RDNO
     C*
     C           #E9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#F**********-**FORMAT*FXDEALP0*OR*FXDEALP1**FOR*LINE02*********   E25586
     C* #F          -  FORMAT FXDEALP0 FOR LINE02                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #F        BEGSR
     C*
     C** SET UP DEAL STATUS INDICATORS
     C                     EXSR #J
     C*
     C** CHECK DEAL TYPE FOR F-X.IS IT AN OPTION...?
     C***********FHTYPE    IFEQ 'OP'                       B1             E26291
     C           DTYP      IFEQ 'OP'                       B1             E26291
     C                     MOVEATXT,1     LIN,27           *1
     C*
     C** FORMAT OPTION TO DATE
     C                     Z-ADD@ODAT     @@DTIN           *1
     C                     EXSR ZA0660                     *1
     C                     MOVEA@@DATE    LIN,38           *1
     C*
     C                     END                             E1
     C*
     C** SET UP FIELD FOR THE DISPLAY.
     C                     MOVEATXT,2     LIN,54
     C                     MOVEA@@DSCC    LIN,63
     C*
     C** IF FEDERAL FUNDS INDICATOR ON AND CURRENCY EQUAL US CURRENCY
     C           FHFEDF    IFEQ 'Y'                        B1
     C           @@DSCC    IFEQ BLCYCD                     B*2
     C                     MOVEA'F'       LIN,72           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C                     MOVE @@DSCC    SSCCY   3
     C*
      * ACCESS CURRENCY DETAILS VIA ACCESS PGM
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG    '@RTCD
     C                     PARM '*KEY    '@OPTN
     C                     PARM SSCCY     @AJCD   3
     C           @CURR     PARM @CURR     DSSDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVEL'SDCURRPD'DBFILE            *************
     C                     MOVEL@OPTN     DBOPTN            * DBERR 014
     C                     MOVELSSCCY     DBKEY             *************
     C                     MOVEL'014'     DBASE
     C                     EXSR *PSSR
     C                     SETON                     U7U8LR
     C                     GOTO #F9
     C                     END
     C*
     C*
     C*
     C*
     C** FORMAT THE PURCHASE AMOUNT
     C                     MOVE @@DSCC    @@CCY
     C                     Z-ADDA6NBDP    @@CDP
     C                     Z-ADD@@DSAM    @@IAMT
     C                     Z-ADD16        @@CRET
     C                     EXSR ZA0750
     C*
     C** @@ADSP  21A FIELD IS MOVED IN TO  SLAMWF 17A FIELD
     C** AS SALE AMOUNT DOESN'T ALIGN WITH PURCHASE AMOUNT
0725 C                     MOVE @@ADSP    SLAMWF
     C                     MOVEASLAMWF    LIN,82
     C*
     C** MOVE PURCHASE CURRENCY IN TO PRINT FIELD
     C                     MOVE @@DBCC    CCY
     C*
     C           #F9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#G**********-**FORMAT*MMDELDP0*OR*MMDELDP1*FOR*LINE02**********   E25586
     C* #G          -  FORMAT MMDELDP0 FOR LINE02                     *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #G        BEGSR
     C*
     C** FORMAT FOR LOANS/DEPOSIT/CD ISSUE?
     C*
     C** SET UP DEAL STATUS INDICATORS
     C                     EXSR #J
     C*
     C** FORMAT BASE RATE FIELD
     C                     MOVEATXT,3     LIN,27
     C*
     C** FORMAT THE INTEREST RATE/SPREAD
     C                     MOVEATXT,4     LIN,52
     C           HKBSRC    IFEQ *BLANKS                    B1
     C********** HKBSRC    OREQ '00'                       *1                          E27537 CSD103
     C           HKBSRC    OREQ '00'                       *1                               MD057842
     C**********           MOVEA'00'      LIN,39           *1
     C                     MOVEA'  '      LIN,39                                            MD057842
     C                     MOVE HKIIRT    @@INPR           *1
     C                     EXSR MM1013                     *1
     C                     MOVEA@@OUTR    LIN,87           *1
     C*
     C                     ELSE                            X1
     C                     MOVEAHKBSRC    LIN,39           *1
     C                     MOVE HKSPRD    @@INPR           *1
     C                     EXSR MM1013                     *1
     C                     MOVEA@@OUTR    LIN,87           *1
     C                     END                             E1
     C*
     C           #G9       ENDSR
     C*****************************************************************
     C/EJECT                                                              S01378
     C*****************************************************************   S01378
     C*                                                               *   S01378
     C* PFMT        -  Format 5,0 field to a 5A field with            *   S01378
     C*                leading zeros suppressed                       *   S01378
     C* CALLS                                                         *   S01378
     C*                                                               *   S01378
     C* CALLED BY   -                                                 *   S01378
     C*                                                               *   S01378
     C* FLDS USED                                                     *   S01378
     C*                                                               *   S01378
     C*****************************************************************   S01378
     C           PFMT      BEGSR                                          S01378
      *                                                                   S01378
      ** reset work fields                                                S01378
     C                     MOVE *BLANKS   @OUT                            S01378
     C                     Z-ADD*ZERO     J                               S01378
      *                                                                   S01378
      ** transfer numeric input field to character array                  S01378
     C           *LIKE     DEFN PSZE      @INNUM                          S01378
     C                     MOVE @INNUM    @INCHR  5                       S01378
     C                     MOVEA@INCHR    @IN                             S01378
      *                                                                   S01378
      ** work through field looking for first non zero character          S01378
     C           J         DOUEQ5                          B1             S01378
     C                     ADD  1         J                *1             S01378
      *                                                                   S01378
      ** once first non zero character is found fill up @OUT and exit     S01378
     C           @IN,J     IFNE '0'                        B*2            S01378
     C                     MOVEA@IN,J     @OUT,J           **2            S01378
     C                     Z-ADD5         J                **2            S01378
     C                     END                             E*2            S01378
     C                     END                             E1             S01378
     C                     MOVEA@OUT      @OUTCR  5                       S01378
      *                                                                   S01378
     C                     ENDSR                                          S01378
     C*****************************************************************   S01378
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C**#H**********-**FORMAT*MMDENBP0*OR*MMDENBP1*LINE*02*************   E25586
     C* #H          -  FORMAT MMDENBP0 LINE02                         *   E25586
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -                                                 *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #H        BEGSR
     C*
     C** SET UP DEAL STATUS INDICATORS          .
     C                     EXSR #J
     C*
     C** FORMAT THE YIELD.
     C                     MOVEATXT,5     LIN,27
     C                     MOVE HLINTR    @@INPR
     C                     EXSR MM1013
     C                     MOVEA@@OUTR    LIN,33
     C*
     C** FORMAT THE INTEREST RATE/SPREAD.
     C                     MOVEATXT,4     LIN,52
     C                     MOVE HLFRAT    @@INPR
     C                     EXSR MM1013
     C                     MOVEA@@OUTR    LIN,87
     C*                                                                   S01378
     C** If parcelled NA set up parcel fields                             S01378
     C           HLPCLI    IFEQ 'P'                                       S01378
     C                     Z-ADD102       I                               S01378
     C                     MOVEATXT,6     LIN,I                           S01378
     C                     Z-ADDHLPSZE    @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     Z-ADD107       I                               S01378
     C                     MOVEA@OUTCR    LIN,I                           S01378
     C*                                                                   S01378
     C** If not parcelled must blank out parcelling bit of LIN            S01378
     C                     ELSE                                           S01378
     C                     Z-ADD108       I                               S01378
     C                     MOVEA*BLANKS   LIN,I                           S01378
     C                     END                                            S01378
     C*
     C           #H9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #I          -  FORMAT MMDENSP0 OR MMDENSP1                    *
     C*                                                               *
     C* CALLS                                                         *
     C*                                                               *
     C* CALLED BY   -  LINE01                                         *
     C*                                                               *
     C* FLDS USED                                                     *
     C*                                                               *
     C*****************************************************************
     C           #I        BEGSR
     C*
     C** SET UP DEAL STATUS INDICATORS
     C                     EXSR #J
     C*
     C** FORMAT THE YIELD.
     C                     MOVEATXT,5     LIN,27
     C                     MOVE HMINTR    @@INPR
     C                     EXSR MM1013
     C                     MOVEA@@OUTR    LIN,33
     C*                                                                   S01378
     C** If parcelled NA set up parcelling fields                         S01378
     C           HMPCLI    IFEQ 'P'                                       S01378
     C                     Z-ADD102       I                               S01378
     C                     MOVEATXT,6     LIN,I                           S01378
     C                     Z-ADDHMPSZE    @INNUM                          S01378
     C                     EXSR PFMT                                      S01378
     C                     Z-ADD107       I                               S01378
     C                     MOVEA@OUTCR    LIN,I                           S01378
     C*                                                                   S01378
     C** If not parcelled must blank out parcelling bit of LIN            S01378
     C                     ELSE                                           S01378
     C                     Z-ADD108       I                               S01378
     C                     MOVEA*BLANKS   LIN,I                           S01378
     C                     END                                            S01378
     C*
     C           #I9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #K          - FORMATING OF DEAL DONE AND VALUE DATE           *
     C*                                                               *
     C* CALLS       - ZA0660                                          *
     C*                                                               *
     C* CALLED BY   - #B                                              *
     C*             - #C                                              *
     C*             - #D                                              *
     C*             - #E                                              *
     C*                                                               *
     C* FLDS USED   @VDAT   - VALUE DATE                              *
     C*             @DDAT   - DEAL DONE DATE                          *
     C*             @MDAT   - MATURITY DATE                           *
     C*             @@DTIN  - INPUT DATE TO ZA0660                    *
     C*             @@DATE  - OUTPUT DATE FROM ZA0660                 *
     C*             DDATE   - DEAL DONE DATE                          *
     C*             VDATE   - VALUE DATE                              *
     C*             ODATE   - OPTION TO DATE                          *
     C*                                                               *
     C*****************************************************************
     C           #K        BEGSR
     C*
     C** FORMAT DEAL VALUE AND DEAL DONE DATE.
     C                     MOVE @VDAT     @@DTIN
     C                     EXSR ZA0660
     C                     MOVE @@DATE    VDATE
     C*
     C                     MOVE @DDAT     @@DTIN
     C                     EXSR ZA0660
     C                     MOVE @@DATE    DDATE
     C*
     C           @INDS     IFEQ 'MMDELDP0'                 B1
     C/COPY WNCPYSRC,DLH00270
     C           @INDS     OREQ 'MMDENBP0'                 X1
     C/COPY WNCPYSRC,DLH00271
     C***********@INDS     OREQ 'MMDELDP1'                 X1             E25586
     C***********@INDS     OREQ 'MMDENBP1'                 X1             E25586
     C*
     C           @MDAT     IFNE *ZEROS                     B*2
     C                     MOVE @MDAT     @@DTIN           **2
     C                     EXSR ZA0660                     **2
     C                     MOVE @@DATE    @MDT    7        **2
     C                     ELSE                            X*2
     C*
     C           @INDS     IFEQ 'MMDELDP0'                 B**3
     C/COPY WNCPYSRC,DLH00272
     C***********@INDS     OREQ 'MMDELDP1'                 X**3           E25586
     C*
     C           HKNTCE    IFEQ 000                        B***4
     C                     MOVE ' CALL  ' @MDT             ****4
     C                     ELSE                            X***4
     C                     MOVE *BLANKS   @MDT                            068210
     C                     MOVE HKNTCE    @MDT             ****4
     C                     END                             E***4
     C*
     C                     ELSE                            X**3
     C*
     C                     MOVE ' CALL  ' @MDT             ***3
     C*
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #K9       ENDSR
     C****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #J          - SET UP DEAL STATUS                              *
     C*                                                               *
     C* CALLS       -                                                 *
     C*                                                               *
     C* CALLED BY   - #F                                              *
     C*             - #G                                              *
     C*             - #H                                              *
     C*             - #I                                              *
     C*                                                               *
     C* FLDS USED   TEXT    - DISPLAY FIELD                           *
     C*             @FEDF   - FEDERAL FUND WORK FIELD                 *
     C*                                                               *
     C*****************************************************************
     C           #J        BEGSR
     C*
     C** CHECK IF DEAL HAS BEEN DELETED
     C           DLREC     IFEQ 'D'                        B1
     C                     MOVE 'DELETED 'TEXT             *1
     C                     ELSE                            X1
     C*
     C** SET UP DEAL STATUS INDICATORS
     C           DLSTS     LOKUPTABA      TABB           56
     C           *IN56     IFEQ '1'                        B1
     C                     MOVE TABB      TEXT             *1
     C                     END                             E*2
     C                     END                             E1
     C*
     C                     MOVEATEXT      LIN,15
     C*
     C           #J9       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*       SUBROUTINE ZA0670 - THIS SUBROUTINE IS USED TO FIND     *
     C*       WHICH CCY AND WHICH AMOUNT IS BUY AND WHICH IS SELL.    *
     C*                                                               *
     C*       IF DEAL FIRST AMOUNT IS >0 THEN FIRST IS BUY            *
     C*       ELSE FIRST IS SELL.                                     *
     C*                                                               *
     C*                                                               *
     C*       CALLED BY: #B                                           *
     C*                : #C                                           *
     C*                : #D                                           *
     C*                : #E                                           *
     C*                                                               *
     C*       CALLS:                                                  *
     C*       INPUT: FHDAM1 - DEAL FIRST AMOUNT                       *
     C*              FHDAM2 - DEAL SECOND AMOUNT                      *
     C*              FHCCY1 - DEAL FIRST CURRENCY                     *
     C*              FHCCY2 - DEAL SECOND CURRENCY                    *
     C*      OUTPUT: @@DBAM - DEAL BUY AMOUNT                         *
     C*              @@DSAM - DEAL SELL AMOUNT                        *
     C*              @@DBCC - DEAL BUY CURRENCY                       *
     C*              @@DSCC - DEAL SELL CURRENCY                      *
     C*        USES:                                                  *
     C*                                                               *
     C*****************************************************************
     C*
     C*
     C           ZA0670    BEGSR
     C           FHDAM1    IFGT 0
     C                     Z-ADDFHDAM1    @@DBAM 150
     C                     MOVE FHCCY1    @@DBCC  3
     C                     Z-SUBFHDAM2    @@DSAM 150
     C                     MOVE FHCCY2    @@DSCC  3
     C                     ELSE
     C                     Z-SUBFHDAM1    @@DSAM
     C                     MOVE FHCCY1    @@DSCC
     C                     Z-ADDFHDAM2    @@DBAM
     C                     MOVE FHCCY2    @@DBCC
     C                     END
     C*
     C           ZA0679    ENDSR
     C*****************************************************************
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*                                                              *
     C*     MIDAS/DRS - STANDING DATA MODULE                         *
     C*                                                              *
     C*     ZA0750 -  CONVERT AMOUNT TO DISPLAY -38                  *
     C*                                                              *
     C*     AMEND NO. 000001                  DATE   04/07/86        *
     C*                                                              *
     C*       CALLED BY: #B                                          *
     C*                : #C                                           *
     C*                : #D                                           *
     C*                : #E                                           *
     C*                                                              *
     C*       CALLS:                                                 *
     C*                                                              *
     C*       INPUT: @@IAMT 15,0 (INPUT AMOUNT)                      *
     C*              @@CCY  3A   (INPUT CURRENCY)                    *
     C*              @@CRET 2,0  (NUMBER OF CHARACTERS TO RETURN)    *
     C*              @@CDP  1,0  (CURRENCY DECIMAL PLACES)           *
     C*                                                              *
     C*      OUTPUT: @@ADSP 21A    (AMOUNT TO DISPLAY)               *
     C*                                                              *
     C*        USES:                                                 *
     C*                                                              *
     C****************************************************************
     C*
     C           ZA0750    BEGSR
     C*
     C*          INITIALISE ARRAYS
     C*
     C                     MOVEA*BLANKS   @E
     C                     MOVEA*BLANKS   @C
     C*
     C*          MOVE SIGN TO DISPLAY AMOUNT
     C*
     C           @@IAMT    IFGT 0                          B1
     C                     MOVE '+'       @E,21            *1
     C                     END                             E1
     C*
     C*          AFTER '-' SIGN PLACED IN  @E CHANGE @@IAMT TO +VE
     C*
     C           @@IAMT    IFLT 0                          B1
     C                     MOVE '-'       @E,21            *1
     C                     Z-SUB@@IAMT    @@IAMT           *1
     C                     END                             E1
     C*
     C           @@IAMT    IFEQ 0                          B1
     C                     MOVE ' '       @E,21            *1
     C                     END                             E1
     C*
     C*          MOVE INPUT AMOUNT TO @D
     C*
     C                     MOVEA@@AMDS    @D
     C*
     C*          MOVE DECIMAL PORTION OF AMOUNT TO @E
     C*
     C                     Z-ADD15        @@C     20
     C                     Z-ADD20        @@D     20
     C*
     C           20        SUB  @@CDP     @@MAX   20
     C           @@D       DOWGT@@MAX                      B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C*          MOVE DECIMAL SEPARATOR TO @E
     C*
     C           @@CDP     IFNE 0                          B1
     C***********          MOVE IDDCSP    @E,@@D           *1             E35494
     C                     MOVE BNDCSP    @E,@@D           *1             E35494
     C                     SUB  1         @@D              *1
     C                     END                             E1
     C*
     C*          FIND POSITION OF LAST CHARACTER TO BE MOVED
     C*
     C                     Z-ADD1         @@E     20
     C*
     C           @@E       DOWLT15                         B1
     C           @D,@@E    ANDEQ'0'                        *1
     C                     ADD  1         @@E              *1
     C                     END                             E1
     C*
     C*          MOVE INTEGER PORTION OF AMOUNT TO @E
     C*
     C                     Z-ADD0         @@CNT1  20
     C                     Z-ADD0         @@CNT2  20
     C*
     C           @@C       DOWGT@@E                        B1
     C                     MOVE @D,@@C    @E,@@D           *1
     C                     ADD  1         @@CNT1           *1
     C                     SUB  1         @@C              *1
     C                     SUB  1         @@D              *1
     C*
     C*          INSERT THOUSAND SEPARATORS
     C*
     C           @@CNT1    DIV  3         @@RES   20       *1
     C                     MVR            @@REMD  10       *1
     C           @@REMD    IFEQ 0                          B*2
     C           @@CNT2    ANDLT5                          **2
     C***********          MOVE IDTHSP    @E,@@D           **2            E35494
     C                     MOVE BNTHSP    @E,@@D           **2            E35494
     C                     ADD  1         @@CNT2           **2
     C                     Z-ADD@@D       @@F     20       **2
     C                     SUB  1         @@D              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C*          MOVE LAST CHARACTER
     C*
     C                     MOVE @D,@@C    @E,@@D
     C*
     C*          IF NUMBER OF CHARACTERS MOVED IS GREATER THAN NUMBER
     C*        TO BE RETURNED DROP THOUSAND SEPARATORS TILL SATISFIED
     C*
     C           22        SUB  @@D       @@CMOV  20
     C           @@CMOV    SUB  @@CRET    @@DIFF  20
     C           @@DIFF    IFGT 0                          B1
     C                     DO   @@DIFF                     B*2
     C                     Z-ADD1         @@G     20       **2
     C                     Z-ADD2         @@H     20       **2
     C           @@G       DOWLE21                         B**3
     C                     MOVE @E,@@G    @C,@@H           ***3
     C                     ADD  1         @@G              ***3
     C                     ADD  1         @@H              ***3
     C           @@G       IFEQ @@F                        B***4
     C                     ADD  1         @@G              ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     MOVEA@C        @E               **2
     C                     ADD  4         @@F              **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C*          MOVE @E TO DISPLAY FIELD
     C*
     C                     MOVEA@E        @@ADSP 21
     C           ZA0759    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* MM1013 - Subroutine to convert a rate to display, with sign   *
     C*                                                               *
     C* CALLED BY: #B                                                 *
     C*          : #C                                                 *
     C*          : #D                                                 *
     C*          : #E                                                 *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@INPR Rate to be edited.                            *
     C*                                                               *
     C* OUTPUT : @@OUTR Edited output rate.                           *
     C*                                                               *
     C* USES :   @@INPR Rate to be edited.                            *
     C*          @@OUTR Edited output rate.                           *
     C*          @@DECS Field to hold decimal digits for input rate.  *
     C*          @@INTS Field to hold integers for input rate.        *
     C*          @@N    Counter field.                                *
     C*          @@Q    Second counter field.                         *
     C*          @@STRP Rate start position after zero suppression.   *
     C*          @W     Work array.                                   *
     C*                                                               *
     C*****************************************************************
     C           MM1013    BEGSR
     C*
     C**  Define fields used.
     C                     Z-ADD@@INPR    @@INPR 117
     C                     MOVE *BLANKS   @@OUTR 13
     C                     MOVE *BLANKS   @@DECS  7
     C                     MOVE *BLANKS   @@INTS  4
     C                     Z-ADD0         @@N     20
     C                     Z-ADD0         @@Q     20
     C                     Z-ADD0         @@STRP  20
     C*
     C**  Initialise work array.
     C                     MOVEA*BLANKS   @W
     C*
     C**  If the rate is negative the sign must be printed.
     C           @@INPR    IFLT 0                          B1
     C                     MOVE '-'       @W,13            *1
     C                     Z-SUB@@INPR    @@INPR           *1
     C                     END                             E1
     C*
     C**  Seperate integers and decimal digits into two fields.
     C                     MOVE @@INPR    @@DECS
     C                     MOVEL@@INPR    @@INTS
     C*
     C**  Move integers, decimal seperator and decimal digits into
     C**  work array.
     C                     MOVEA@@INTS    @W
     C***********          MOVE IDDCSP    @W,5                            E35494
     C                     MOVE BNDCSP    @W,5                            E35494
     C                     MOVEA@@DECS    @W,6
     C*
     C**  Remove leading zeros from the rate and replace with blanks.
     C                     Z-ADD1         @@N
     C           @@N       DOWLE3                          B1
     C           @W,@@N    ANDEQ'0'                        X1
     C                     MOVE *BLANK    @W,@@N           *1
     C                     ADD  1         @@N              *1
     C                     END                             E1
     C*
     C                     Z-ADD@@N       @@STRP
     C*
     C**  Truncate trailing zeros and replace with blanks. If rate is
     C**  an integer a single zero after the decimal place should be
     C**  displayed.
     C                     Z-ADD12        @@N
     C           @@N       DOWGE7                          B1
     C           @W,@@N    ANDEQ'0'                        X1
     C                     MOVE *BLANK    @W,@@N           *1
     C                     SUB  1         @@N              *1
     C                     END                             E1
     C*
     C**  Right justify the array.
     C                     Z-ADD12        @@Q
     C           @@N       IFNE @@Q                        B1
     C           @@N       DOWGE@@STRP                       B2
     C                     MOVE @W,@@N    @W,@@Q             *2
     C                     MOVE *BLANK    @W,@@N             *2
     C                     SUB  1         @@N                *2
     C                     SUB  1         @@Q                *2
     C                     END                               E1
     C                     END                             E2
     C*
     C**  Move the final array into the output field.
     C                     MOVEA@W        @@OUTR
     C*
     C           M10139    ENDSR                           **M10139**
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* ZA0660 - THIS SUBROUTINE CONVERTS DATE FORMAT YYYYMMDD TO     *
     C*          DDMMMYY FORMAT                                       *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@DTIN DATE INPUT (YYYYMMDD)  - IN DATA STRUCTURE    *
     C*                                                               *
     C* OUTPUT : @@DATE DATE OUTPUT (DDMMMYY)                         *
     C*                                                               *
     C* USES :   @@MTH  MONTH NUMBER                                  *
     C*          @@MNM  MONTH SHORTNAME                               *
     C*          @@DAY  DAY NUMBER                                    *
     C*          @@YYYY YEAR (4 CHARACTER)                            *
     C*          @@DAT5 5A WORKFIELD                                  *
     C*          @MN    ARRAY OF MONTH SHORTNAMES                     *
     C*                                                               *
     C*     LAST AMEND NO. ME1257              DATE 02/04/87          *
     C*     When date input is zero set output date to blanks         *
     C*                                                               *
     C*****************************************************************
     C           ZA0660    BEGSR
     C*
     C           @@DTIN    IFNE 0                          B1
     C                     MOVE @@YYYY    @@DATE  7        *1
     C                     MOVE @MN,@@MTH @@DAT5  5        *1
     C                     MOVEL@@DAY     @@DAT5           *1
     C                     MOVEL@@DAT5    @@DATE           *1
     C                     ELSE                            X1
     C                     MOVE *BLANKS   @@DATE           *1
     C                     END                             E1
     C*
     C           ZA0669    ENDSR                           **ZA0669 TAG **
     C/EJECT
     C*****************************************************************
     C*
     C* *PSSR    -   ROUTINE CALLED ON FILE / PROGRAM ERROR
     C*
     C* CALLS           -
     C*
     C* CALLED BY       -
     C*
     C* FLDS USED       -
     C*
     C*****************************************************************
     C           *PSSR     BEGSR
     C*
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
0501 C/EJECT
0502 O***DL2481P1E  203   50      HEAD                                    E257
     O***DL2480P1E  203   50      HEAD                               E257 LN0746
     ODL2481P1E  203   50      HEAD                                       LN0746
0503 O                                   24 'REFERENCE DL2481P1'
0504 O                         BJURPT    89
0505 O                                  122 'DATE              PAGE'
0506 O                         BJMRDT   112
0507 O                         PAGE  Z  127
0508 O        E  1     50      HEAD
0510 O                                   65 'DEALS BY CUSTOMER'
     O                 88                73 '- TYPE '                     CDL021
     O                 88      TYP1      76                               CDL021
     O                 88 89   TYP2      79                               CDL021
     O                 88 89   TYP3      83                               CDL038
0512 O        E  2     50      HEAD
0514 O                                   65 '-----------------'
0508 O        E  2     50      HEAD
     O                                   12 'BRANCH'
     O                         BRCA      16
     O                         A8BRNM    48
0508 O        E  1     50      HEAD
     O                                   12 'CUSTOMER'
     O                         BBCUST    20
     O                         BBCRNM    44
     O                         BBCSSN    58
0512 O        E  2     50      HEAD
     O                         BBCRTN    34
0508 O        E  1     50      HEAD
     O                                  111 'RELATED'
0516 O        E  3     50      HEAD
0517 O                                   22 'TYPE      DEAL NO.'
0518 O                                   44 'DEAL       VALUE'
0519 O                                   74 'MATURITY    CCY      F/F'
0520 O                                  112 'AMOUNT        DEAL NO.'
0521 O        E  1     50      DETAIL
     O                         DTYPW      9
     O                         CLASW     13                               CDL038
     O*****************54******BYSL      10                               CDL038
     O                         DLNO      21
     O                         DDATE     33
     O                         VDATE     44
     O                         NARR1     57
     O                         CCY       65
     O                         FFIN      73
     O                         AMT1W     98
     O                         RDNO     110
     O        E  2     50      DETAIL
     O**********               LINE2    100                               S01378
     O                         LINE2    111                               S01378
0527 O*
     O*
     O*FRA/IRS FIELDS
     O*
     O        E  1     50      COMMON
     O                         DTYP       6
     O                                    7 '-'
     O                         DLST       9
     O                         CLAS      13                               CDL038
     O                 70      BYSL      14                               CDL038
     O*****************70******BYSL      10                        S01157 CDL038
     O                         DLNO      21
     O                         @DLDAT    33
     O                         @VLDAT    44
     O                         @MTDAT    57
     O                         UCUCY     65
     O                 74      @FEDF     73
     O                         @DLAMT    98
     O                         @LNKDN   110
     O*
     O* FR TYPE DEALS
     O*
     O        E  1     50      FRDET
     O                         @TEXT     16
     O                                   35 'REFERENCE RATE'
     O                         @BTYP     38
     O                                   75 'CONTRACT RATE'
     O                         @RATE     88
     O*
     O* CAPS COLLARS & FLOORS
     O*
     O        E  1     50      RRDET
     O                 71                75 'CEILING RATE'
     O                N71                75 'FLOOR RATE'
     O                         @CLRAT    88
     O        E  1     50      RRDET
     O                         @TEXT     16
     O                                   35 'BASE RATE'
     O                         @BTYP     38
     O                                   75 'INTEREST/SPREAD'
     O                         @RATE     88
     O                         @SPIN     98
     O        E  1     72 50   RRDET
     O                                   75 'FLOOR RATE'
     O                         @FLRAT    88
     O*
     O* SINGLE CCY & CROSS CCY (RS & RX)
     O*
     O        E  1     50      RXDET
     O                         @TEXT     16
     O                                   35 'OUR BASE RATE'
     O                         @UBRTT    38
     O                                   75 'INTEREST/SPREAD'
     O                         @ORATE    88
     O        E  1     73 50   RXDET
     O                         TCUCY     65
     O                 75 50   @FEDF     73
     O                         @RXAMT    98
     O*
     O        E  1     50      RXDET
     O                                   35 'THEIR BASE RATE'
     O                         @TBRTT    38
     O                                   75 'INTEREST/SPREAD'
     O                         @TRATE    88
     O*
     O*
     O        E 3      50 44NU7                                           E26358
     O                                   63 '***   NO DETAILS TO REPO'    E26358
     O                                   71 'RT   ***'                    E26358
     O*                                                                   E26358
     O        E   57   50      ENDRPT
0318 O**********                         71 '*** END OF BRANCH REPORT'
     O**********                         75 '***'
     O                                   66 '*** END OF REPORT FOR'
     O                                   77 ' BRANCH ***'
      *
0563 O********E*3      50 44NU7                                           E26358
0564 O***********                        63 '***   NO DETAILS TO REPO'    E26358
0565 O***********                        71 'RT   ***'                    E26358
0566 O***********                                                         E26358
0638 O        T  3     LR U7 U8
     O       AND       50
     O                                   71 '*** PRINT TERMINATED ***'
     O        T 2      LR U7 U8
     O       AND       50
     O                                   57 'DATABASE ERROR'
     O                         DBASE     61
     O                                   67 'FILE'
     O                         DBFILE    78
     O        T 13     LR U7 U8
     O       AND       50
     O                                   49 'OPTION'
     O                         DBOPTN    57
     O                                   66 'KEY'
     O                         DBKEY     96
     ODL2481AUE  203           AUDIT                                      E26357
     O                                   24 'REFERENCE DL2481AU'          E26357
     O                         BJURPT    89                               E26357
     O                                  122 'DATE              PAGE'      E26357
     O                         BJMRDT   112                               E26357
     O                         PAGE  Z  127                               E26357
     O        E  1             AUDIT                                      E26357
     O                                   65 'DEALS BY CUSTOMER AUDIT'     E26357
     O                 88                73 '- TYPE '                     CDL021
     O                 88      TYP1      76                               CDL021
     O                 88 89   TYP2      79                               CDL021
     O                 88 89   TYP3      83                               CDL038
     O        E  2             AUDIT                                      E26357
     O                                   65 '-----------------------'     E26357
     O        E  1             AUDIT                                      E26357
     O                                   12 'CUSTOMER'                    E26357
     O                         BBCUST    20                               E26357
     O                         BBCRNM    44                               E26357
     O                         BBCSSN    58                               E26357
     O        E  2             AUDIT                                      E26357
     O                         BBCRTN    34                               E26357
     O        E  1             AUDIT                                      E26357
     O                                  111 'RELATED'                     E26357
     O        E  3             AUDIT                                      E26357
     O                                   22 'TYPE      DEAL NO.'          E26357
     O                                   44 'DEAL       VALUE'            E26357
     O                                   74 'MATURITY    CCY      F/F'    E26357
     O                                  112 'AMOUNT        DEAL NO.'      E26357
     O        E 3              AUDIT                                      E26357
     O                                   63 '***   NO DETAILS TO REPO'    E26357
     O                                   71 'RT   ***'                    E26357
     O*                                                                   E26357
     O        E   57           AUDIT                                      E26357
     O                                   66 '*** END OF REPORT ***'       E26357
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** TXT
OPTION TO
SALE
BASE RATE
INTEREST/SPREAD
YIELD
P'SZ                                                                      S01378
** ZCOM - EDIT FORMAT FOR AMOUNT FIELD
   ,   ,   ,   ,  0
   ,   ,   ,   ,  0.
              0
              0.
** TABLE TABA & TABB FOR DEAL STATUS NARRATIVES
IINCOMP
CCOMP
AAUTH
RREAUTH
EEXPIRED
MMATURED
