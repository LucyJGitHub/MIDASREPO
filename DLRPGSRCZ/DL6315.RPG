     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Pay/receive message extraction')              *
      *****************************************************************
      *                                                               *
      *   Midas - DEALING MODULE                                      *
      *                                                               *
      *   DL6315 - PAY/RECEIVE MESSAGE EXTRACTION                     *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD057450A          Date 13May22               *
      *  Prev Amend No. MD058285           Date 22Jun21               *
      *                 MD057450           Date 11Feb21               *
      *                 MD051264           Date 27Jun18               *
      *                 MD050842           Date 22May18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD034285           Date 14Feb17               *
      *                 MD037148           Date 19Jan16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CLE148             Date 23Jul12               *
      *                 CSW212             Date 03May12               *
      *                 CCB020             Date 06Aug12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 236190 (REOPENED)  Date 25May06               *
      *                 236190             Date 26Oct05               *
      *                 172477             Date 06Jun06               *
      *                 CDL038             Date 10May05               *
      *                 BUG7821R           Date 27Jul05               *
      *                 BUG7821            Date 14Jul05               *
      *                 CAS009             Date 04May04               *
      *                 BUG7538            Date 15Jun05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 BUG6076            Date 04Mar05               *
      *                 BUG6479            Date 05Apr05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CDL025             Date 27Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222458             Date 22Oct03               *
      *                 219146             Date 30Jun03               *
      *                 219243             Date 01Jul03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 194643             Date 08Jul02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 156788             Date 25Sep01               *
      *                 190328             Date 14Aug01               *
      *                 175754             Date 23Jul01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 195091             Date 11Jul01               *
      *                 169025             Date 05Jul01               *
      *                 179461             Date 30Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 141571             Date 13Feb01               *
      *                 183930             Date 18Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 180814             Date 28Aug00               *
      *                 CFT013             Date 25May00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 167507             Date 05Jul00               *
      *                 167729             Date 28Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                   110231           Date 05Oct99               *
      *                   136030           Date 05Oct99               *
      *                   134254           Date 05Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                   157756           Date 14Jul99               *
      *                   CEU003           Date 19Dec97               *
      *                   105901           DATE 17Feb98               *
      *                   S01408           DATE 25Nov96               *
      *                   105577           DATE 23JUL97               *
      *                   105343           DATE 21JUL97               *
      *                   099441           DATE 19AUG97               *
      *                   CDL002           DATE 17SEP97               *
      *                   099917           DATE 10APR97               *
      *                   S01408           DATE 17OCT96               *
      *                   S01408           DATE 27SEP96               *
      *                   CSW096           DATE 03JUN96               *
      *                   092784           DATE 17MAY96               *
      *                   085770           DATE 18APR96               *
      *                   S01408           DATE 24JAN96               *
      *                   S01408           DATE 11DEC95               *
      *                   097960           DATE 04JAN96               *
      *                   087655           DATE 23OCT95               *
      *                   085620           DATE 21JUN95               *
      *                   084182           DATE 21JUN95               *
      *                   081540           DATE 31JAN95               *
      *                   079035           DATE 06DEC94               *
      *                   079138           DATE 20DEC94               *
      *                   S01408           DATE 18MAY94               *
      *                   S01453           DATE 14DEC93               *
      *                   S01434           DATE 17NOV93               *
      *                   042844           DATE 11OCT93               *
      *                   E29588           DATE 07OCT91               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD057450A- FX: Payment in MMM has not been deleted after     *
      *             changing FX Netting Settlement details from 08/29 *
      *             to 01/29.                                         *
      *           - Include PREX1PH in SRFXNT subroutine.             *
      *           - Remove condition SETP = '01', any record in       *
      *             PREXnPH is considered as 'CANC'.                  *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD057450 - FX: Payment in MMM has not been deleted after     *
      *             changing FX Netting Settlement details from 08/29 *
      *             to 01/29.                                         *
      *           - Create SRFXNT subr for PRSX2PH and PRESX3PH.      *
      *  MD051264 - Allow cancellation processing for FX netting      *
      *             deals. Fix patterned after BUG7538.               *
      *  MD050842 - Condition fields 33B and 36 by System Value.
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD034285 - New SWIFT message not generated after PD event.   *
      *  MD037148 - Error on SI deal amendment when interest is       *
      *             negative. DBASE error in DLC0400.                 *
      *             Instead of Pay, system produced Receive message   *
      *             due to negative interest,but receipt instructions *
      *             are not provided for SI.                          *
      *           - Applied for MD-38972.                             *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSW212 - SWIFT 2012 Changes                                  *
      *  CCB020 - COB Restructure - Secondary COB Infrastracture      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  172477 - Do not blank out Account With Institution when same *
      *           as Nostro Customer.  Applied fix 170449.            *
      *  236190 (REOPEN) - Generate message of IPDS deal.             *
      *  236190 - MT292 cancellation message not produced for Deams.  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  BUG7821R- Suppress zero amount MT103s on FX Option Takedowns *
      *  BUG7821- Suppress zero amount MT103s on FX Option Takedowns  *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  BUG7538- No MT292 generated for rolled over MM deal.         *
      *           Force system to generate cancellation message.      *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  BUG6076- Cancellation processing for interest and cover      *
      *           messages not working in MMM.                        *
      *  BUG6479- when option takedown is enter, not cancel and       *
      *           amendement messages are produce for the option      *
      *           for MMM.                                            *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CDL025 - FX Netting Payment Generation                       *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222458 - Complete fix 219243                                 *
      *  219146 - MM messages suppressed because CLS flag not reset   *
      *           after CLS FX deal processed.                        *
      *  219243 - Fields 33B and 36 for FX Deals                      *
      *  194643 - Multiple MT100 messages generated because Receipt   *
      *           branch is used in MGKEY instead of the Pay branch.  *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type & suppress cancel       *
      *  156788 - Wrong DEST If Interest paid separately and interest *
      *           settlement method different.                        *
      *  190328 - Reinitialize MGPIBN and MGPIBA to blanks to avoid   *
      *           field 56 being repeated from previous deal in an    *
      *           MT203.                                              *
      *  175754 - If INOS (10 char) is a customer shortname, retrieve *
      *           corresponding customer number and store it to       *
      *           MGAWBN field (8 char).                              *
      *  195091 - Payment message is not generated when receipt       *
      *           settlement is '00' (to be decided). Caused by core  *
      *           fix 167729 which skips the entire message           *
      *           generation processing if either receipt or payment  *
      *           side settlement is '00'.                            *
      *  169025 - Remove fix 157756 as it is causing problems under   *
      *           the dealing module.                                 *
      *  179461 - Sending branch of the separate interest message     *
      *           MT202 is wrong. It gets the branch from the         *
      *           payment settlement account.                         *
      *  141571 - Duplicate MT100 messages produced for rolled over   *
      *           deal.                                               *
      *  183930 - Incorrect incorporation of 134254 caused Dbase      *
      *           error 012 at SDNOSTPD.                              *
      *  180814 - Pay/Receives not being generated due to fix 110231  *
      *           Remove fix 110231                                   *
      *  CFT013 - Straight-through Processing Phase 2 MT103 Messages  *
      *           Generation for non-FT.                              *
      *  CDL008 - Continuous Linked Settlement                        *
      *  167507 - Reinitialise MGBENA to *BLANKS in SR/FMTO so that   *
      *           the second part of an MT203 message would not have  *
      *           an incorrect field 58.                              *
      *  167729 - Database Error 006, No message generation if        *
      *           settlement method is 00.     Applied fix 118565.    *
      *  110231 - Incomplete Deal produced MT202 because it read      *
      *           details in DEALS file record with the complete      *
      *           details although it should be for the next run.     *
      *  136030 - Bill sold before maturity does not cancel original  *
      *           pay/receive message.                                *
      *  134254 - MT210 of OP deal not cancelled when Option Taken    *
      *           before option to date.                              *
      *     157756 - Additional parameter to match parameters in      *
      *              deletion/cancellation control program MG9200.    *
      *     CEU003 - EMU - Settlement Currency Conversion             *
      *     105901 - Swift rules : if field 56 is present field       *
      *              field 57 should also be present.                 *
      *              Consequently, only blank out AWBN if PIBN        *
      *              is also blank.                                   *
      *     S01408 - Duplicate hooks DL6315C003/C011 replaced (DBAR2) *
      *              Addition of core hook DL6315CP13                 *
      *              Addition of core hook DL6315CP12                 *
      *     105577 - Integrate fix 82042                              *
      *              PUT CORRECT RELATED REF IN COVER MT202           *
      *     105343 - If deal has been amended then previous message   *
      *              for this deal should be deleted.                 *
      *              Amend criteria so that the cancellation process  *
      *              is also executed if:-                            *
      *              (Last chg type = 'A' and the record type = 'D'). *
      *              ie. (CHTP='A' and PRCDT='D').                    *
      *     099441 - Replace bank/non-bank flag with financial        *
      *              institution flag.                                *
      *     CDL002 - FX Netting                                       *
      *     099917 - DEALS file being accessed when DEAM settlement   *
      *              instructions were not blank and payment is a     *
      *              credit (PYRC = 'C')                              *
      *     S01408 - Addition of core hook DL6315CP10                 *
      *              Addition of core hook DL6315CCP9                 *
      *     S01408 - Addition of core hook DL6315CCP8                 *
      *              Addition of core hook DL6315CCP7                 *
      *              Addition of core hook DL6315CCP6                 *
      *              Addition of core hook DL6315CCP5                 *
      *              Addition of core hook DL6315CCP4                 *
      *              Addition of core hook DL6315CCP3                 *
      *     CSW096   Swift Changes 1996:                              *
      *              Set the value of MGAWBN, MGPIBN and new field    *
      *              MGAWBB for msg MT202.                            *
      *     092784 - Prevent database error 001 when there are        *
      *              rollover messages for deal that went matured.    *
      *     085770 - Settlement details taken from DEALS file         *
      *              instead of DEAMS file for deal amendments.       *
      *              This is because PYRC is mistaken to be 'R'       *
      *              instead of 'C'.                                  *
      *     S01408 - Core hook DL6315CCP2 added                       *
      *     S01408 - Core hook DL6315FFP1 added                       *
      *              Core hook DL6315CCP1 added                       *
      *     097960 - Replace line inadvertently removed during        *
      *              incorporation of 087655 - this line was deleted  *
      *              instead of being asterisked out.                 *
      *     087655 - Deletion/Cancellation of maturity messages not   *
      *              working properly.                                *
      *     085620 - When a cancellation is requested for a rolled    *
      *              over deal ie PRCDT = R, only cancel messages     *
      *              for the value date of the request which will be  *
      *              the maturity date of the rolled over deal        *
      *              Also do not do any cancelling when the Change    *
      *              Type of the deal is A and the Record Type, PRCDT *
      *              is S,R or I, all of which apply to rollovers only*
      *     084182 - Suppression of SWIFT Message if counterparty is  *
      *              the nostro                                       *
      *     081540 - Prevent blank branch code being written to       *
      *              MGFnnnPD                                         *
      *     079035 - Reverse out fix 042844 as duplicate confirmations*
      *              result                                           *
      *     079138 - Interest Counterparty Nostro needs to be moved   *
      *              left in MGAWBN                                   *
      *     S01408 - Core hook DL6315VS1 added                        *
      *              Core hook DL6315VSR added                        *
      *              Core hook DL6315VSF added                        *
      *     S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY *
      *              POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)  *
      *     S01434 - Enhanced processing for 'Rollover Deals'         *
      *                                                               *
      *     042844 - The system produced a payment message for the    *
      *              principal amount of a new, rollover loan. It     *
      *              should have produced an MT210 for the interest   *
      *              only. A PREXPH record with record type 'R' will  *
      *              produce cancellation of maturity date            *
      *              pay/receives for the rolled over deal.           *
      *     E29588 - POST COLLECTION SWIFT RATIONALISATION FIXES         *
      *                                                               *
      *****************************************************************
     FPRSX5   IF  E           K        DISK
     F            PREXHHF                           KIGNORE
     F            PREXZZF                           KIGNORE
     FPRSX2   IF  E           K        DISK                                                 MD057450
     F            PREXPHF                           KRENAMEPREX2HF                          MD057450
     F            PREXHHF                           KIGNORE                                 MD057450
     F            PREXZZF                           KIGNORE                                 MD057450
     FPRSX3   IF  E           K        DISK                                                 MD057450
     F            PREXPHF                           KRENAMEPREX3HF                          MD057450
     F            PREXHHF                           KIGNORE                                 MD057450
     F            PREXZZF                           KIGNORE                                 MD057450
     FPRSX1   IF  E           K        DISK                                                MD057450A
     F            PREXPHF                           KRENAMEPREX1HF                         MD057450A
     F            PREXHHF                           KIGNORE                                MD057450A
     F            PREXZZF                           KIGNORE                                MD057450A
     FDEALS   IF  E           K        DISK
     FDEAMS   IF  E           K        DISK
     FDLFEEDL1UF  E           K        DISK                                                   CAS009
     F/COPY WNCPYSRC,DL6315F002
     F*DTRIXL3IF  E           K        DISK                        110231 180814
     F*********   DTRIXDF                           KRENAMEDTRIXD3 110231 180814
     F*DTRIXL4 IF E           K        DISK                        110231 180814
     F*********   DTRIXDF                           KRENAMEDTRIXD4 110231 180814
     F*DTRIXL5 IF E           K        DISK                        110231 180814
     F*********   DTRIXDF                           KRENAMEDTRIXD5 110231 180814
     FFXNETMPDIF  E           K        DISK                               CDL002
     FFXNETSL0IF  E           K        DISK                               CDL025
     FPREX5L1 IF  E           K        DISK                                                 MD034285
     F*MGF100PDO***E***                 DISK                                                  141571
     FMGF100L0UF  E           K        DISK                      A                            141571
     F                                              KCOMIT
     FMGF200PDO   E                    DISK
     F                                              KCOMIT
     F*MGF202PDO   E                    DISK                              087655
     FMGF202L0UF  E           K        DISK                      A        087655
     F                                              KCOMIT
     F*MGF210PDO   E                    DISK                              087655
     FMGF210L0UF  E           K        DISK                      A        087655
     F                                              KCOMIT
     FSDCGRPL1IF  E           K        DISK                               CDL002
     FDL6315AUO   E                    PRINTER                        UC
     FSDCUSTL6IF  E           K        DISK                               175754
      *
     F/COPY WNCPYSRC,DL6315FFP1                                           S01408
      *                                                                   S01408
      * ID C  F  H  L    Function of indicators
      *    10            EOF PRSX5
      *    11            EOF DEALS
      *    12            EOF DEAMS
      *    20            Message type not generated
      *    21            Message group not generated
      *    22            Message category not generated
      *****23**          Record Match in DTRIXL3/L4/L5             110231 180814
      *    25            MGF202/MGF210 NRF indicator                      087655
      *    26            EoF on FXNETPD                                   CDL002
      *    27            CHAIN fail on SDCGRPL1                           CDL002
      *    U7U8LR        DB error
     E                    NGN        15  3               Msg types not gen
     E/COPY WNCPYSRC,DL6315E001
     E                    CPY@    1   1 80
      *
     IPREXPHF
     I              RECI                            PRECI
     I              CCY                             PCCY
     I              VDAT                            PVDAT
     I              CNUM                            PCNUM
     I              RCDT                            PRCDT
     I              DASN                            PDASN
     I              BRCA                            PBRCA
     IPREXPHF1
     I              RECI                            PRECI
     I              CCY                             PCCY
     I              VDAT                            PVDAT
     I              CNUM                            PCNUM
     I              RCDT                            PRCDT
     I              DASN                            PDASN
     I              BRCA                            PBRCA
     IPREXPHF2
     I              RECI                            PRECI
     I              CCY                             PCCY
     I              VDAT                            PVDAT
     I              CNUM                            PCNUM
     I              RCDT                            PRCDT
     I              DASN                            PDASN
     I              BRCA                            PBRCA
     IPREX2HF                                                                               MD057450
     I              RECI                            PRECI                                   MD057450
     I              CCY                             PCCY                                    MD057450
     I              VDAT                            PVDAT                                   MD057450
     I              CNUM                            PCNUM                                   MD057450
     I              RCDT                            PRCDT                                   MD057450
     I              DASN                            PDASN                                   MD057450
     I              BRCA                            PBRCA                                   MD057450
     IPREX3HF                                                                               MD057450
     I              RECI                            PRECI                                   MD057450
     I              CCY                             PCCY                                    MD057450
     I              VDAT                            PVDAT                                   MD057450
     I              CNUM                            PCNUM                                   MD057450
     I              RCDT                            PRCDT                                   MD057450
     I              DASN                            PDASN                                   MD057450
     I              BRCA                            PBRCA                                   MD057450
     IPREX1HF                                                                              MD057450A
     I              RECI                            PRECI                                  MD057450A
     I              CCY                             PCCY                                   MD057450A
     I              VDAT                            PVDAT                                  MD057450A
     I              CNUM                            PCNUM                                  MD057450A
     I              RCDT                            PRCDT                                  MD057450A
     I              DASN                            PDASN                                  MD057450A
     I              BRCA                            PBRCA                                  MD057450A
      **  Rename conflicting PRSX5 fields
      *
     IDEAMSDHF
     I              RECI                            DRECI
     I              VDAT                            DVDAT
     I              DASN                            DDASN
     IDEAMSDIF
     I              RECI                            DRECI
     I              VDAT                            DVDAT
     I              DASN                            DDASN
     I              CCY                             DCCY
     I              CNUM                            DCNUM
     I              LSWC                            DLSWC
     I/COPY WNCPYSRC,DL6315I002
     IDEAMSDJF
     I              RECI                            DRECI
     I              VDAT                            DVDAT
     I              DASN                            DDASN
     IPREX5PHF                                                                              MD034285
     I              DLNO                            P5DLNO                                  MD034285
     I              RCDT                            P5RCDT                                  MD034285
     I              PRI2                            P5PRI2                                  MD034285
     I/COPY WNCPYSRC,DL6315I003
      **  Rename conflicting DEAMS fields
      *
     I*MPHAS****   DS                                                                         CCB020
     I**********                              1   1 STATUS                                    CCB020
      **  Data structure to check MPHAS for Close of Business
      *
     IUSBTB       DS                                                      CSW096
     I                                        1   5 USRCB                 CSW096
     I                                        6  13 USBN1                 CSW096
     I                                       14  16 USBN2                 CSW096
      *                                                                   CSW096
     ISDBANK    E DSSDBANKPD
      **  Data structure for bank file
      *
     ISDCUST    E DSSDCUSTPD
      **  Data structure for customer file
      *
     ISDBRCH    E DSSDBRCHPD
      **  Data structure for branch file
      *
     I              QQDFAC                          QQDFC1                                    CGL029
     ISDNOST    E DSSDNOSTPD
      **  Data structure for nostro file
      *
     ISCSARD    E DSSCSARDPD                                              CFT013
      **  Data structure for switchable features details file             CFT013
      *                                                                   CFT013
     IDSFDY     E DSDSFDY
      **  Short data structure for access programs
      *
     IDSSDY     E DSDSSDY
      **  Long data structure for access programs
      *
     I            DS
     I                                        1  14 DMERR
     I                                        1   60KDLNO
     I                                        7  110PVDAT
     I                                       12  140PDASN
     I            DS                                                                          CAS009
     I                                        1   9 FEERR                                     CAS009
     I                                        1   60DLNO                                      CAS009
     I                                        7   80WFSEQ                                     CAS009
     I            DS                                                                          CAS009
     I                                        1  11 WKTNUM                                    CAS009
     I                                        1   2 WKMODI                                    CAS009
     I                                        3   8 WKDLNO                                    CAS009
     I                                        9   9 WKFEER                                    CAS009
     I                                       10  110WKFSEQ                                    CAS009
     I            DS                                                                          CAS009
     I                                        1   9 WKTRN                                     CAS009
     I                                        1   6 WKMTRN                                    CAS009
     I                                        7   7 WKFEE                                     CAS009
     I                                        8   90WKSEQ                                     CAS009
      **  Data structure for DEAMS db error reporting
      *
     ILDA         DS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **  Local data area
      *
      *                                                                                     MD050842
      **  System Values Constant                                                            MD050842
      *                                                                                     MD050842
     I              'Supprs33B36inFXMT103'C         P@DL                                    MD050842
     I/COPY WNCPYSRC,DL6315I001
     C/EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *   main process                                                *
      *   INIT  - initial process                                     *
      *   INIF  - initialisation process of common fields             *
      *   TYPE  - determine message type                              *
      *   DEST  - determine destination customer                      *
      *   CANC  - generate cancellation for destination customer      *
      *   VALD  - determine if message type is required by destination*
      *   FMTO  - format and output record  for generation            *
      *   *PSSR - error handling                                      *
      *****************************************************************
     C/EJECT
      *****************************************************************
      *   main process                                                *
      *   Calls - INIT initial process                                *
      *           INIF initialisation process of common fields        *
      *           TYPE determine message type                         *
      *           DEST determine destination customer                 *
      *********** CANC generate cancellation for destination custome042844079035
      *           VALD generate message for destination customer ?    *
      *           FMTO format and output record  for generation       *
      *****************************************************************
      *                                                                   087655
      **  KLIST AREA                                                      087655
     C           MGKEY     KLIST                                          087655
     C                     KFLD           @MOD                            087655
     C**********           KFLD           KDEST   60                                   087655 CSD027
     C                     KFLD           KDEST   6                                           CSD027
     C                     KFLD           RPOBR   3                       087655
     C                     KFLD           KVDAT   50                      087655
      *
      **  Perform initial process
     C                     EXSR INIT
      *
      **  Read first pay/receive extract record
     C                     READ PRSX5                    10
      *
      **  Do until EOF
     C           *IN10     DOWEQ'0'                                   1
      *
     C                     Z-ADDDLNO      SDLNO   60
     C                     Z-ADDPDASN     SDASN   30
     C                     Z-ADDPVDAT     SVDAT   50
     C                     MOVE CVMI      SCVMI   1
     C                     MOVE PYRC      SPYRC   1
     C**********           MOVE PRCDT     SRCDT   1                 042844079035
     C                     MOVE PRCDT     SRCDT   1                       087655
      ***If*the*a new record has been inserted in DTRIX file, ignor110231 180814
      ***this*PREX record as it will be processed next P/R run.    110231 180814
     C********   @KYDT     KLIST                                   110231 180814
     C********             KFLD           DLNO                     110231 180814
     C********             KFLD           @VDAT   50               110231 180814
     C********             KFLD           PDASN                    110231 180814
     C********   PDASN     IFEQ 0                                  110231 180814
     C********             Z-ADD0         @VDAT                    110231 180814
     C********             ELSE                                    110231 180814
     C********             Z-ADDPVDAT     @VDAT                    110231 180814
     C********             END                                     110231 180814
     C********             MOVE '0'       *IN23                    110231 180814
     C********             SELEC                                   110231 180814
     C********   PRI1      WHEQ 1                                  110231 180814
     C********   @KYDT     SETLLDTRIXL3                  23        110231 180814
     C********   PRI2      WHEQ 1                                  110231 180814
     C********   @KYDT     SETLLDTRIXL4                  23        110231 180814
     C********   PRI3      WHEQ 1                                  110231 180814
     C********   @KYDT     SETLLDTRIXL5                  23        110231 180814
     C********             END                                     110231 180814
     C********   *IN23     IFEQ '1'                                110231 180814
     C********             GOTO BYPASS                             110231 180814
     C********             END                                     110231 180814
      *
      **  Initialise common fields
      *
     C                     EXSR INIF
     C/COPY WNCPYSRC,DL6315C077
      *                                                                   CDL002
      **  If net record with a net ref get details                        CDL002
      **  from net master file                                            CDL002
      *                                                                   CDL002
     C           PRCDT     IFEQ 'N'                                       CDL002
     C           CDL002    ANDEQ'Y'                                       CDL002
      ** Split Netting ?                                                  CDL025
     C           CDL025    IFEQ 'Y'                                       CDL025
     C           SSEQ      ANDNE0                                         CDL025
     C                     EXSR SRSPLT                                    CDL025
     C                     ELSE                                           CDL025
     C                     EXSR SRRNET                                    CDL002
     C                     ENDIF                                          CDL025
      *                                                                   CDL025
     C                     ELSE                                           CDL002
      *
      **  Access corresponding deal record
     C           DLNO      CHAINDEALS                11
     C                     MOVE CHTP      @CHG    1                                           CSW025
      *
     C           *IN11     IFEQ '1'                                   2
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'R'
     C           RECI      ANDNE'M'                                       092784
     C           *LOCK     IN   LDA
     C                     MOVE '001'     DBASE            * * * * * * * *
     C                     MOVELDLNO      DBKEY            *  DBERR 001  *
     C                     MOVEL'DEALS'   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E2
     C/COPY WNCPYSRC,DL6315C078
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                                       219243
      ** Move purchase currency and amount from DEALSDB to MGF100PD.                          219243
      *                                                                                       219243
     C           RCDT      IFEQ 'B'                                                           219243
     C           SPPRSF    ANDEQ'N'                                                         MD050842
     C                     MOVELPUCY      MGICCY                                              219243
     C                     Z-ADDPUAM      MGIAMT                                              219243
     C                     Z-ADDEXRT      MGEXRT                                              222458
     C                     ELSE                                                               219243
     C                     MOVEL*BLANKS   MGICCY                                              219243
     C                     Z-ADD0         MGIAMT                                              219243
     C                     Z-ADD0         MGEXRT                                              222458
     C                     ENDIF                                                              219243
     C*                                                                   167729
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C                     ELSE                                                               CAS009
     C           RSTM      IFEQ 0                                         167729
     C           PYRC      ANDEQ'R'                                       195091
     C           PSTM      OREQ 0                                         167729
     C           PYRC      ANDEQ'P'                                       195091
     C                     GOTO NEXT                                      167729
     C                     END                                            167729
     C                     ENDIF                                                              CAS009
      *                                                                   CDL002
     C/COPY WNCPYSRC,DL6315C013
      *
      **  If not an FRA/IRS deal (processed by DL6320)
     C           RCDT      IFNE 'G'                                   2
     C***********          Z-ADD0         MGAVDT                    085620097960
     C                     Z-ADDPVDAT     MGAVDT                          085620
      *
      **  If a deal amendment
      **  Access corresponding deal amendment record
     C           PRCDT     IFEQ 'A'                                   3
     C                     Z-ADDDLNO      KDLNO
     C           DMKEY     CHAINDEAMS                12
     C                     MOVE CHTP      @CHG                                                CSW025
      *
     C           *IN12     IFEQ '1'                                   4
     C           DRECI     ORNE 'D'
     C           DRECI     ANDNE'R'                                       E29588
     C           *LOCK     IN   LDA
     C                     MOVE '002'     DBASE            * * * * * * * *
     C                     MOVELDMERR     DBKEY            *  DBERR 002  *
     C                     MOVEL'DEAMS'   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E4
      *                                                                   E29588
     C                     MOVE AMTP      MGAMTP                          E29588
     C/COPY WNCPYSRC,DL6315C014
     C                     Z-ADDDVDAT     MGAVDT                          E29588
     C                     Z-ADDDDASN     MGASEQ                          E29588
     C/COPY WNCPYSRC,DL6315C015
     C                     END                                       E3
     C**********                                                    042844079035
     C***Produce*CANCEL*messages*for*rolled*over*deals.             042844079035
     C**********                                                    042844079035
     C********** PRCDT     IFEQ 'R'                                 042844079035
     C**********           SETON                     13             042844079035
     C**********           END                                      042844079035
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
      *                                                                                       CAS009
     C                     Z-ADDPDASN     WFSEQ                                               CAS009
     C           KFEE      CHAINDLFEEDL1             12                                       CAS009
      *                                                                                       CAS009
     C           *IN12     IFEQ '1'                                                           CAS009
     C           DFRECI    ORNE 'D'                                                           CAS009
     C           DFRECI    ANDNE'R'                                                           CAS009
     C           *LOCK     IN   LDA                                                           CAS009
     C                     MOVE '021'     DBASE                                               CAS009
     C                     MOVELFEERR     DBKEY                                               CAS009
     C                     MOVEL'DLFEEDL1'DBFILE                                              CAS009
     C                     OUT  LDA                                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR SRFEE                                                         CAS009
     C                     ENDIF                                                              CAS009
      *
      **  Determine message type
     C/COPY WNCPYSRC,DL6315C004
     C                     EXSR TYPE
     C/COPY WNCPYSRC,DL6315C005
      *                                                                   CDL008
      ** CLS Settlement                                                   CDL008
      *                                                                   CDL008
     C           CDL008    IFEQ 'Y'                                       CDL008
     C           RCDT      ANDEQ'B'                                                           219146
     C                     MOVE CLSS      @CLSS   1                       CDL008
     C                     ELSE                                           CDL008
     C                     MOVE *BLANKS   @CLSS                           CDL008
     C                     ENDIF                                          CDL008
      *
      **  Determine destination customer
     C                     EXSR DEST
      *
      **  Set module code
      **  If net record, module is NT                                     CDL002
      *                                                                   CDL002
     C           PRCDT     IFEQ 'N'                                       CDL002
     C           CDL002    ANDEQ'Y'                                       CDL002
     C                     MOVE 'NT'      @MOD    2                       CDL002
     C                     ELSE                                           CDL002
     C                     MOVE 'DL'      @MOD    2
     C                     ENDIF                                          CDL002
      ** If option taken, check if pay/receive messages have been         134254
      ** generated for corresponding OP deal.                             134254
     C                     SETOF                     30                   134254
     C                     Z-ADD0         SDLNO1  60                      134254
     C                     MOVE *BLANKS   SDTYP   2                       183930
     C           DTYP      IFEQ 'OT'                                      134254
     C                     MOVE DLNO      SDLNO1                          134254
     C                     MOVE DTYP      SDTYP                           183930
     C           SODN      CHAINDEALS                11                   134254
     C           *IN11     IFEQ '1'                                   2   134254
     C           RECI      ORNE 'D'                                       134254
     C           RECI      ANDNE'R'                                       134254
     C           RECI      ANDNE'M'                                       134254
     C           *LOCK     IN   LDA                                       134254
     C                     MOVE '001'     DBASE            * * * * * * * *134254
     C                     MOVELSODN      DBKEY            *  DBERR 001  *134254
     C                     MOVEL'DEALS'   DBFILE           * * * * * * * *134254
     C                     OUT  LDA                                       134254
     C                     EXSR *PSSR                                     134254
     C                     END                                       E2   134254
     C                     TESTB'1'       TLXI           30               134254
     C           *IN30     IFEQ '1'                                       134254
     C                     Z-ADDMGAVDT    SMGVDT  50                      134254
     C                     Z-ADDOTDT      MGAVDT                          134254
     C                     END                                            134254
     C                     END                                            134254
      *                                                                                     MD034285
      ** When Principal Increase/Decrease is Insert                                         MD034285
      *                                                                                     MD034285
     C                     MOVE 'N'       WDEAM   1                                         MD034285
     C           DLNO      CHAINPREX5L1              59                                     MD034285
     C           *IN59     IFEQ *OFF                                                        MD034285
     C           PRCDT     ANDEQ'A'                                                         MD034285
     C           CHTP      ANDEQ'I'                                                         MD034285
     C           MGAMTP    IFEQ 'PD'                                                        MD034285
     C           MGAMTP    OREQ 'PI'                                                        MD034285
     C                     MOVE 'Y'       WDEAM                                             MD034285
     C                     ENDIF                                                            MD034285
     C                     ENDIF                                                            MD034285
      *
      **  Do Deletion/cancellation processing when:-                      E29588
      **  i.  input cycle                                                 E29588
      **  ii. COB and deal amendment extract record                       E29588
      *                                                                   E29588
     C                     MOVE *BLANKS   REVNX
     C********** COB       IFNE 'C'                                                           CCB020
     C           @RTPHS    IFEQ '*NO '                                                        CCB020
     C********** COB       OREQ 'C'                                                    E29588 CCB020
     C           @RTPHS    OREQ '*YES'                                                        CCB020
     C           PRCDT     ANDEQ'A'
     C           *IN30     OREQ '1'                                       134254
     C           PRCDT     OREQ 'F'                                       136030
     C           CAS009    OREQ 'Y'                                                           CAS009
     C********** COB       ANDEQ'C'                                                    CAS009 CCB020
     C           @RTPHS    ANDEQ'*YES'                                                        CCB020
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C/COPY WNCPYSRC,DL6315C079
      *
     C           CHTP      IFEQ 'A'                                   3
     C********** PRCDT     ANDEQ'R'                                                    087655 141571
     C***********PRCDT     ANDNE'R'                                 085620087655
     C***********PRCDT     ANDNE'S'                                 085620087655
     C***********PRCDT     ANDNE'I'                                 085620087655
     C           CHTP      OREQ 'R'
     C           WDEAM     OREQ 'Y'                                                         MD034285
     C********** PRCDT     OREQ 'R'                                 042844079035
     C********** CHTP      OREQ 'A'                                                    105343 141571
     C********** PRCDT     ANDEQ'D'                                                    105343 141571
     C/COPY WNCPYSRC,DL6315C072
     C           *IN30     OREQ '1'                                       134254
     C           PRCDT     OREQ 'F'                                       136030
     C           CAS009    OREQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C           CSW025    IFNE 'Y'                                                           CSW025
     C           CSW025    OREQ 'Y'                                                          BUG7538
     C           PRCDT     ANDEQ'R'                                                          BUG7538
      *                                                                                       236190
     C           CSW025    OREQ 'Y'                                                           236190
     C           PRCDT     ANDEQ'A'                                                           236190
     C           MGAMTP    ANDEQ'PD'                                                          236190
      *                                                                                       236190
     C           CSW025    OREQ 'Y'                                                           236190
     C           PRCDT     ANDEQ'A'                                                           236190
     C           MGAMTP    ANDEQ'PI'                                                          236190
      *                                                                                     MD051264
     C           CSW025    OREQ 'Y'                                                         MD051264
     C           CDL002    ANDEQ'Y'                                                         MD051264
     C           PRCDT     ANDEQ'N'                                                         MD051264
     C                     EXSR CANC
     C                     EXSR MGCANC                                                        141571
     C                     ENDIF                                                              CSW025
     C                     END                                       E3
      *
     C********** CHTP      IFEQ 'A'                                                    087655 141571
     C********** PRCDT     ANDEQ'S'                                                    087655 141571
     C**********           EXSR MGCANC                                                 087655 141571
     C**********           END                                                         087655 141571
      *                                                                   087655
     C                     END
      ** Chain back to the deal being processed.                          134254
     C************IN30     IFEQ '1'                                134254 183930
     C           SDTYP     IFEQ 'OT'                                      183930
     C           SDLNO1    CHAINDEALS                11                   134254
     C           *IN11     IFEQ '1'                                   2   134254
     C           RECI      ORNE 'D'                                       134254
     C           RECI      ANDNE'R'                                       134254
     C           RECI      ANDNE'M'                                       134254
     C           *LOCK     IN   LDA                                       134254
     C                     MOVE '001'     DBASE            * * * * * * * *134254
     C                     MOVELSODN      DBKEY            *  DBERR 001  *134254
     C                     MOVEL'DEALS'   DBFILE           * * * * * * * *134254
     C                     OUT  LDA                                       134254
     C                     EXSR *PSSR                                     134254
     C                     END                                       E2   134254
     C                     Z-ADDSMGVDT    MGAVDT                          134254
     C                     END                                            134254
      *
      **  Continue with message generation if not processing a
      **  reversal, or if cancellation processing was just run for a
      **  nostro transfer message that had been transmitted
     C           CHTP      IFNE 'R'                                   3
     C********** PRCDT     ANDNE'R'                                 042844079035
     C           PRCDT     ANDNE'R'                                       087655
     C           PRCDT     ANDNE'F'                                       136030
     C           REVNX     OREQ 'Y'
      *
      **  If message is reversed nostro transfer, reverse branch and
      **  counterparty information on pay/rcv to back out the transfer
     C           REVNX     IFEQ 'Y'                                   4
      *
     C                     MOVELRIBN      @WK8    8
     C                     MOVELAWBN      RIBN
     C                     MOVEL@WK8      AWBN
      *
     C                     MOVELPONS      @WK2    2
     C                     MOVELRONS      PONS
     C                     MOVEL@WK2      RONS
      *
     C/COPY WNCPYSRC,DL6315C016
     C                     MOVELPOBR      @WK3    3
     C                     MOVELROBR      POBR
     C                     MOVEL@WK3      ROBR
     C/COPY WNCPYSRC,DL6315C017
      *
     C           @TYP      IFEQ '210'                                 5
     C/COPY WNCPYSRC,DL6315C018
     C                     MOVELROBR      BRCA
     C/COPY WNCPYSRC,DL6315C019
     C                     MOVELAWBN      @DEST
     C                     END                                       E5
     C           @TYP      IFEQ '200'                                 5
     C/COPY WNCPYSRC,DL6315C020
     C                     MOVELPOBR      BRCA
     C/COPY WNCPYSRC,DL6315C021
     C                     MOVELRIBN      @DEST
     C                     END                                       E5
      *
     C                     END                                       E4
      *
      **  Determine if message type is to be generated for
      **  customer
     C                     EXSR VALD
      *
      **  If message is required for destination, format and output
      **  to generation driver files (PF/MGFnnnPD)
     C           *IN20     IFEQ '0'                                  B4
     C           *IN21     ANDEQ'0'
     C           *IN22     ANDEQ'0'
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP9                                           S01408
     C*                                                                   S01408
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C           DFLCDT    ANDEQ'D'                                                           CAS009
     C                     ELSE                                                               CAS009
     C                     EXSR FMTO
     C                     ENDIF                                                              CAS009
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CP10                                           S01408
     C*                                                                   S01408
     C                     END                                       E4
      *
     C                     END                                       E3
     C                     END                                       E2
     C/COPY WNCPYSRC,DL6315C012
     C********   BYPASS    TAG                                     110231 180814
      *
      **  Read next pay/receive extract record
     C           *IN10     DOUEQ'1'                                   2
     C           DLNO      ORNE SDLNO
     C           PDASN     ORNE SDASN
     C           PVDAT     ORNE SVDAT
     C           CVMI      ORNE SCVMI
     C           PYRC      ORNE SPYRC
     C********** PRCDT     ORNE SRCDT                               042844079035
     C           PRCDT     ORNE SRCDT                                     087655
     C           NEXT      TAG                                            167729
     C                     READ PRSX5                    10
     C                     END                                       E2
     C/COPY WNCPYSRC,DL6315C022
     C                     END                                       E1
      ** READ FX Netting Change                                                             MD057450
     C           CDL002    IFEQ 'Y'                                                         MD057450
     C                     EXSR SRFXNT                                                      MD057450
     C                     ENDIF                                                            MD057450
     C/COPY WNCPYSRC,DL6315C001
      *
      **  Terminate program
     C                     SETON                     LR
     C/EJECT
      *****************************************************************
      *   INIT - inital process                                       *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
     C                     MOVEACPY@      BIS@   80
      *
      **  Set up LDA
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'DL6315'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      **********                                                                              CCB020
      ****Set*up MPHAS data area                                                              CCB020
      **********                                                                              CCB020
     C********** *NAMVAR   DEFN           MPHAS                                               CCB020
     C********** *LOCK     IN   MPHAS                                                         CCB020
     C**********           MOVE STATUS    COB     1                                           CCB020
     C**********           OUT  MPHAS                                                         CCB020
     C                     MOVEL'CBC00100'@CLPRM  9                                           CCB020
     C                     MOVE '1'       @CLPRM                                              CCB020
     C                     CALL @CLPRM                                                        CCB020
     C                     PARM *BLANKS   @RTPHS  4                                           CCB020
      *
      **  Access SDBANKPD for report title
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C/COPY WNCPYSRC,DL6315C006
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS                               1
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY            *  DBERR 003  *
     C                     MOVEL'SDBANKPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
     C**                                                                  CDL002
     C** Access SAR Details file to determine if CDL002 installed         CDL002
     C**                                                                  CDL002
     C                     CALL 'AOSARDR0'                                CDL002
     C                     PARM '       ' @RTCD                           CDL002
     C                     PARM '*VERIFY' @OPTN                           CDL002
     C                     PARM 'CDL002'  @SARD   6                       CDL002
     C           @RTCD     IFNE *BLANK                                    CDL002
     C           @RTCD     ANDNE'*NRF   '                                 CDL002
     C                     MOVEL'SCSARDPD'DBFILE           ************** CDL002
     C                     MOVEL'016'     DBASE            * DBERROR 016  CDL002
     C                     MOVEL@RTCD     DBKEY            ************** CDL002
     C                     SETON                     U7U8                 CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     END                                            CDL002
     C           @RTCD     IFEQ *BLANK                                    CDL002
     C                     MOVE 'Y'       CDL002  1                       CDL002
     C                     END                                            CDL002
     C*                                                                   084182
     C** Access SAR Details file to determine if CDL025 installed         CDL025
     C                     CALL 'AOSARDR0'                                CDL025
     C                     PARM '       ' @RTCD                           CDL025
     C                     PARM '*VERIFY' @OPTN                           CDL025
     C                     PARM 'CDL025'  @SARD   6                       CDL025
      *                                                                   CDL025
     C           @RTCD     IFNE *BLANK                                    CDL025
     C           @RTCD     ANDNE'*NRF   '                                 CDL005
     C                     MOVEL'SCSARDPD'DBFILE           ************** CDL025
     C                     MOVEL'020'     DBASE            * DBERROR 020  CDL025
     C                     MOVEL@RTCD     DBKEY            ************** CDL025
     C                     SETON                     U7U8                 CDL025
     C                     EXSR *PSSR                                     CDL025
     C                     END                                            CDL025
      *                                                                   CDL025
     C           @RTCD     IFEQ *BLANK                                    CDL025
     C                     MOVE 'Y'       CDL025  1                       CDL025
     C                     ELSE                                           CDL025
     C                     MOVE 'N'       CDL025                          CDL025
     C                     ENDIF                                          CDL025
     C*                                                                   CDL025
     C** Determine if CSW002 (Suppression of SWIFT Message if counterparty084182
     C** is a nostro) is switched on                                      084182
     C*                                                                   084182
     C                     CALL 'AOSARDR0'                                084182
     C                     PARM *BLANKS   @RTCD                           084182
     C                     PARM '*VERIFY' @OPTN                           084182
     C                     PARM 'CSW002'  @SARD   6                       084182
     C*                                                                   084182
     C           @RTCD     IFEQ *BLANKS                                   084182
     C                     MOVE 'Y'       CSW002  1                       084182
     C                     ELSE                                           084182
     C                     MOVE 'N'       CSW002                          084182
     C           @RTCD     IFNE '*NRF'                                    084182
     C           *LOCK     IN   LDA                                       084182
     C                     MOVE '015'     DBASE            * * * * * * * *084182
     C                     MOVEL'CSW002'  DBKEY            *  DBERR 015  *084182
     C                     MOVEL'SCSARDPD'DBFILE           * * * * * * * *084182
     C                     OUT  LDA                                       084182
     C                     EXSR *PSSR                                     084182
     C                     END                                            084182
     C                     END                                            084182
      *                                                                   CFT013
      ** Access SAR file to determine if CFT013 is installed.             CFT013
      *                                                                   CFT013
     C                     CALL 'AOSARDR0'                                CFT013
     C                     PARM *BLANKS   PRTCD   7                       CFT013
     C                     PARM '*VERIFY' POPTN   7                       CFT013
     C                     PARM 'CFT013'  PSARD   6                       CFT013
     C           SCSARD    PARM SCSARD    DSFDY                           CFT013
      *                                                                   CFT013
      ** An NRF (No Record Found) return code is valid.                   CFT013
      ** Issue database error only for error return codes.                CFT013
      *                                                                   CFT013
     C           PRTCD     IFNE *BLANKS                                   CFT013
     C           PRTCD     ANDNE'*NRF   '                                 CFT013
     C           *LOCK     IN   LDA                                       CFT013
     C                     MOVEL'CFT013'  DBKEY                           CFT013
     C                     MOVEL'SCSARDPD'DBFILE                          CFT013
     C                     Z-ADD19        DBASE                           CFT013
     C                     OUT  LDA                                       CFT013
     C                     EXSR *PSSR                                     CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
     C           PRTCD     IFEQ *BLANK                                    CFT013
     C                     MOVEL'Y'       CFT013  1                       CFT013
     C                     ELSE                                           CFT013
     C                     MOVEL'N'       CFT013                          CFT013
     C                     ENDIF                                          CFT013
     C/COPY WNCPYSRC,DL6315C007
      *                                                                   CDL008
      ** Check if CDL008 (Continuous Linked Settlement) is installed      CDL008
      *                                                                   CDL008
     C                     MOVE 'N'       CDL008  1                       CDL008
     C                     CALL 'AOSARDR0'                                CDL008
     C                     PARM *BLANKS   @RTCD                           CDL008
     C                     PARM '*VERIFY' @OPTN                           CDL008
     C                     PARM 'CDL008'  @SARD                           CDL008
     C           SCSARD    PARM SCSARD    DSFDY                           CDL008
      *                                                                   CDL008
     C           @RTCD     IFNE *BLANKS                                   CDL008
     C           @RTCD     ANDNE'*NRF   '                                 CDL008
     C           *LOCK     IN   LDA                                       CDL008
     C                     Z-ADD019       DBASE             ************* CDL008
     C                     MOVEL'SCSARDPD'DBFILE            * DBERR 019 * CDL008
     C                     MOVEL@SARD     DBKEY             ************* CDL008
     C                     OUT  LDA                                       CDL008
     C                     EXSR *PSSR                                     CDL008
     C                     ENDIF                                          CDL008
     C           @RTCD     IFEQ *BLANK                                    CDL008
     C                     MOVEL'Y'       CDL008                          CDL008
     C                     ENDIF                                          CDL008
      *
      ** Is CSW025 installed?                                                                 CSW025
      *                                                                                       CSW025
     C                     CALL 'AOSARDR0'                                                    CSW025
     C                     PARM '       ' @RTCD                                               CSW025
     C                     PARM '*VERIFY' @OPTN                                               CSW025
     C                     PARM 'CSW025'  @SARD                                               CSW025
     C           @RTCD     IFNE *BLANK                                                        CSW025
     C           @RTCD     ANDNE'*NRF   '                                                     CSW025
     C                     MOVEL'SCSARDPD'DBFILE                                              CSW025
     C                     MOVEL'020'     DBASE                                               CSW025
     C                     MOVEL@RTCD     DBKEY                                               CSW025
     C                     MOVE *ON       *INU7                                               CSW025
     C                     MOVE *ON       *INU8                                               CSW025
     C                     EXSR *PSSR                                                         CSW025
     C                     ENDIF                                                              CSW025
     C           @RTCD     IFEQ *BLANK                                                        CSW025
     C                     MOVE 'Y'       CSW025  1                                           CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       CSW025
      *                                                                                       CAS009
      ** Determine if CAS009 is installed                                                     CAS009
      *                                                                                       CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   @RTCD                                               CAS009
     C                     PARM '*VERIFY' @OPTN                                               CAS009
     C                     PARM 'CAS009'  @SARD                                               CAS009
     C           @RTCD     IFNE *BLANK                                                        CAS009
     C           @RTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     MOVEL'022'     DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     MOVE *ON       *INU7                                               CAS009
     C                     MOVE *ON       *INU8                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
     C           @RTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Check if SWIFT Changes 2012 (CSW212) is installed                                    CSW212
      *                                                                                       CSW212
     C                     CALL 'SWIF2012'                                                    CSW212
     C                     PARM *BLANKS   @RTCD                                               CSW212
      *                                                                                       CSW212
     C           @RTCD     IFEQ 'CSW2012'                                                     CSW212
     C                     MOVE 'Y'       CSW212  1                                           CSW212
     C                     ELSE                                                               CSW212
     C                     MOVE 'N'       CSW212                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C           DMKEY     KLIST
     C                     KFLD           KDLNO   60
     C                     KFLD           PVDAT
     C                     KFLD           PDASN
      *                                                                   CDL002
     C           GRPKEY    KLIST                                          CDL002
     C                     KFLD           SETNO   1                       CDL002
     C                     KFLD           GRPCOD  4                       CDL002
     C                     MOVE '*'       SETNO                           CDL002
      *                                                                                       CAS009
     C           KFEE      KLIST                                                              CAS009
     C                     KFLD           DLNO                                                CAS009
     C                     KFLD           WFSEQ                                               CAS009
      *                                                                                     MD050842
      ** Retrieve System Value                                                              MD050842
     C                     CALL 'AOSVALR0'                                                  MD050842
     C                     PARM *BLANKS   P@RTCD  7                                         MD050842
     C                     PARM P@DL      P@OP01 20                                         MD050842
     C                     PARM           P@VL01200                                         MD050842
     C                     PARM           P@OP02 20                                         MD050842
     C                     PARM           P@VL02200                                         MD050842
     C                     PARM           P@OP03 20                                         MD050842
     C                     PARM           P@VL03200                                         MD050842
     C                     PARM           P@OP04 20                                         MD050842
     C                     PARM           P@VL04200                                         MD050842
     C                     PARM           P@OP05 20                                         MD050842
     C                     PARM           P@VL05200                                         MD050842
     C                     PARM           P@OP06 20                                         MD050842
     C                     PARM           P@VL06200                                         MD050842
     C                     PARM           P@OP07 20                                         MD050842
     C                     PARM           P@VL07200                                         MD050842
     C                     PARM           P@OP08 20                                         MD050842
     C                     PARM           P@VL08200                                         MD050842
     C                     PARM           P@OP09 20                                         MD050842
     C                     PARM           P@VL09200                                         MD050842
     C                     PARM           P@OP10 20                                         MD050842
     C                     PARM           P@VL10200                                         MD050842
      *                                                                                     MD050842
     C                     MOVE *BLANKS   SPPRSF  1                                         MD050842
     C           P@RTCD    IFEQ *BLANKS                                                     MD050842
     C                     MOVELP@VL01    SPPRSF                                            MD050842
     C                     ENDIF                                                            MD050842
      *                                                                                     MD050842
     C/COPY WNCPYSRC,DL6315C002
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   INIF - initalisation process of common fields               *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           INIF      BEGSR
      *
      **  Clear generation driver file fields
     C                     MOVE *BLANKS   MGDEST
     C                     MOVE *BLANKS   MGTNUM
     C                     MOVE *BLANKS   MGMODI
     C                     Z-ADD0         MGVDAT
     C                     MOVE *BLANKS   MGCCY
     C                     Z-ADD0         MGEAMT
     C                     MOVE *BLANKS   MGTTYP
     C                     MOVE *BLANKS   MGTSTP
     C                     MOVE *BLANKS   MGBRCA
     C                     MOVE *BLANKS   MGAMTP
     C                     Z-ADD0         MGAVDT                          E29588
     C                     Z-ADD0         MGASEQ                          E29588
     C                     MOVE *BLANKS   MGCHTP
     C**********           Z-ADD0         MGCNUM                                              CSD027
     C                     MOVE *BLANKS   MGCNUM                                              CSD027
      *
     C**********           Z-ADD0         MGPOCN                                              CSD027
     C**********           Z-ADD0         MGPOBN                                              CSD027
     C                     MOVE *BLANKS   MGPOCN                                              CSD027
     C                     MOVE *BLANKS   MGPOBN                                              CSD027
     C/COPY WNCPYSRC,DL6315C023
     C                     MOVE *BLANKS   MGRVNO
     C                     MOVE *BLANKS   MGRCRN
     C                     MOVE *BLANKS   MGRCRA
     C                     MOVE *BLANKS   MGPIBN
     C                     MOVE *BLANKS   MGPIBA
     C                     MOVE *BLANKS   MGPONS
     C                     MOVE *BLANKS   MGRONS
     C                     MOVE *BLANKS   MGPOBR
     C                     MOVE *BLANKS   MGROBR
     C/COPY WNCPYSRC,DL6315C024
     C                     MOVE *BLANKS   MGAWBN
     C                     MOVE *BLANKS   MGAWBA
     C                     MOVE *BLANKS   MGBENN
     C                     MOVE *BLANKS   MGBENA
     C                     MOVE *BLANKS   MGDTP1
     C                     MOVE *BLANKS   MGDTP2
     C                     MOVE *BLANKS   MGDTP3
     C                     MOVE *BLANKS   MGDTP4
     C/COPY WNCPYSRC,DL6315C025
     C                     MOVE *BLANKS   MGDCHG
     C/COPY WNCPYSRC,DL6315C026
     C                     MOVE *BLANKS   MGBTB1
     C                     MOVE *BLANKS   MGBTB2
     C                     MOVE *BLANKS   MGBTB3
     C                     MOVE *BLANKS   MGBTB4
     C                     MOVE *BLANKS   MGBTB5
     C                     MOVE *BLANKS   MGBTB6
     C                     MOVE *BLANKS   MGCVMI  1                       105577
     C/COPY WNCPYSRC,DL6315C027
     C                     Z-ADD0         MGSETP
     C                     Z-ADD0         MGRATE
     C/COPY WNCPYSRC,DL6315C008
      *
     C                     ENDSR
      /EJECT                                                              CDL002
      *****************************************************************   CDL002
      *                                                               *   CDL002
      * SRRNET - Access Net Master file for Nets settlements          *   CDL002
      *          details, fill DEALS fields with Net data.            *   CDL002
      *                                                               *   CDL002
      * Called by: Main Processing                                    *   CDL002
      *                                                               *   CDL002
      * Calls: None                                                   *   CDL002
      *                                                               *   CDL002
      *****************************************************************   CDL002
      *                                                                   CDL002
     C           SRRNET    BEGSR                                          CDL002
      *                                                                   CDL002
      **  Access net master file                                          CDL002
     C           NTRF      CHAINFXNETMPD             26                   CDL002
      *                                                                   CDL002
     C           *IN26     IFEQ '1'                                       CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '015'     DBASE            * * * * * * * *CDL002
     C                     MOVELNTRF      DBKEY            *  DBERR 015  *CDL002
     C                     MOVEL'FXNETMPD'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      **  Access net Customer no.                                         CDL002
      *                                                                   CDL002
     C                     MOVE *BLANKS   @KEY1                           CDL002
     C                     MOVELAMDCSN    @KEY1                           CDL002
     C                     CALL 'AOCUSTR0'                                CDL002
     C                     PARM '*BLANK ' @RTCD                           CDL002
     C                     PARM '*KEY   ' @OPTN                           CDL002
     C                     PARM           @KEY1                           CDL002
     C                     PARM *BLANKS   @KYST                           CDL002
     C           SDCUST    PARM SDCUST    DSSDY                           CDL002
      *                                                                   CDL002
     C           @RTCD     IFNE *BLANKS                                   CDL002
     C           @RTCD     ANDNE'*NRF   '                                 CDL002
     C           @RTCD     ANDNE'*KEY   '                                 CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '017'     DBASE            * * * * * * * *CDL002
     C                     MOVELAMDCSN    DBKEY            *  DBERR 017  *CDL002
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
     C           @RTCD     IFEQ *BLANKS                                   CDL002
     C                     MOVELBBCUST    CNUM                            CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      **  If GROUP number then chain to SDCGRPL1                          CDL002
      *                                                                   CDL002
     C           @RTCD     IFEQ '*NRF   '                                 CDL002
     C           @RTCD     OREQ '*KEY   '                                 CDL002
     C                     MOVELAMDCSN    GRPCOD                          CDL002
     C           GRPKEY    CHAINSDCGRPL1             27                   CDL002
     C           *IN27     IFEQ *ON                                       CDL002
     C           *LOCK     IN   LDA                                       CDL002
     C                     MOVE '018'     DBASE            * * * * * * * *CDL002
     C                     MOVELAMDCSN    DBKEY            *  DBERR 018  *CDL002
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *CDL002
     C                     OUT  LDA                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ELSE                                           CDL002
     C                     MOVELD6NTCU    CNUM                            CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
      *   set up netting data into fields used in program                 CDL002
      *     receive instructions                                          CDL002
     C           AMBSIN    IFEQ 'B'                                       CDL002
     C/COPY WNCPYSRC,DL6315C067                                           S01408
     C                     MOVE AMSETM    RSTM                            CDL002
     C                     MOVE AMOURN    RONS                            CDL002
     C                     MOVE AMONOB    ROBR                            CDL002
     C                     MOVE AMIBNK    RIBN                            CDL002
     C                     MOVE AMIBNA    RIBA                            CDL002
     C                     MOVE AMOBNK    ROBN                            CDL002
     C                     MOVE AMORDC    ROCN                            CDL002
      *                                                                   CDL002
      *     pay instructions                                              CDL002
     C                     ELSE                                           CDL002
     C                     MOVE AMSETM    PSTM                            CDL002
     C                     MOVE AMOURN    PONS                            CDL002
     C                     MOVE AMONOB    POBR                            CDL002
     C                     MOVE AMIBNK    PIBN                            CDL002
     C                     MOVE AMIBNA    PIBA                            CDL002
     C                     MOVE AMOBNK    POBN                            CDL002
     C                     MOVE AMORDC    POCN                            CDL002
     C                     MOVELAMRCRN    RCRN                            CDL002
     C                     MOVELAMRCRA    RCRA                            CDL002
     C                     MOVELAMRVNO    RVNO                            CDL002
     C                     MOVELAMAWBN    AWBN                            CDL002
     C                     MOVELAMAWBA    AWBA                            CDL002
     C                     MOVELAMBENN    BENN                            CDL002
     C                     MOVELAMBENA    BENA                            CDL002
     C                     MOVELAMDTP1    DTP1                            CDL002
     C                     MOVELAMDTP2    DTP2                            CDL002
     C                     MOVELAMDTP3    DTP3                            CDL002
     C                     MOVELAMDTP4    DTP4                            CDL002
     C                     MOVELAMDCHG    DCHG                            CDL002
     C                     MOVELAMBTB1    BTB1                            CDL002
     C                     MOVELAMBTB2    BTB2                            CDL002
     C                     MOVELAMBTB3    BTB3                            CDL002
     C                     MOVELAMBTB4    BTB4                            CDL002
     C                     MOVELAMBTB5    BTB5                            CDL002
     C                     MOVELAMBTB6    BTB6                            CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     MOVELAMBRCA    BRCA                            CDL002
     C                     MOVELAMCHTY    CHTP                            CDL002
     C                     MOVE 'N'       RCDT                            CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
      *                                                                   CDL002
     C/EJECT
      *****************************************************************                  CDL025
      *                                                               *                  CDL025
      * SRSPLT - Access Split Net file for Nets settlements           *                  CDL025
      *          details, fill DEALS fields with Net data.            *                  CDL025
      *                                                               *                  CDL025
      * Called by: Main Processing                                    *                  CDL025
      *                                                               *                  CDL025
      * Calls: None                                                   *                  CDL025
      *                                                               *                  CDL025
      *****************************************************************                  CDL025
      *                                                                                  CDL025
     C           SRSPLT    BEGSR                                                         CDL025
      *                                                                                  CDL025
     C           KSPLT     KLIST                                                         CDL025
     C                     KFLD           NTRF                                           CDL025
     C                     KFLD           SSEQ                                           CDL025
      *                                                                                  CDL025
      **  Access net master file                                                         CDL025
     C           KSPLT     CHAINFXNETSL0             26                                  CDL025
      *                                                                                  CDL025
     C           *IN26     IFEQ '1'                                                      CDL025
     C           *LOCK     IN   LDA                                                      CDL025
     C                     MOVE '021'     DBASE            * * * * * * * *               CDL025
     C                     MOVELNTRF      DBKEY            *  DBERR 021  *               CDL025
     C                     MOVEL'FXNETSL0'DBFILE           * * * * * * * *               CDL025
     C                     OUT  LDA                                                      CDL025
     C                     EXSR *PSSR                                                    CDL025
     C                     ENDIF                                                         CDL025
      *                                                                                  CDL025
      **  Access net Customer no.                                                        CDL025
     C                     MOVE *BLANKS   @KEY1                                          CDL025
     C                     MOVELASDCSN    @KEY1                                          CDL025
     C                     CALL 'AOCUSTR0'                                               CDL025
     C                     PARM '*BLANK ' @RTCD                                          CDL025
     C                     PARM '*KEY   ' @OPTN                                          CDL025
     C                     PARM           @KEY1                                          CDL025
     C                     PARM *BLANKS   @KYST                                          CDL025
     C           SDCUST    PARM SDCUST    DSSDY                                          CDL025
      *                                                                                  CDL025
     C           @RTCD     IFNE *BLANKS                                                  CDL025
     C           @RTCD     ANDNE'*NRF   '                                                CDL025
     C           @RTCD     ANDNE'*KEY   '                                                CDL025
     C           *LOCK     IN   LDA                                                      CDL025
     C                     MOVE '022'     DBASE            * * * * * * * *               CDL025
     C                     MOVELASDCSN    DBKEY            *  DBERR 022  *               CDL025
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *               CDL025
     C                     OUT  LDA                                                      CDL025
     C                     EXSR *PSSR                                                    CDL025
     C                     ENDIF                                                         CDL025
     C           @RTCD     IFEQ *BLANKS                                                  CDL025
     C                     MOVELBBCUST    CNUM                                           CDL025
     C                     ENDIF                                                         CDL025
      *                                                                                  CDL025
      **  If GROUP number then chain to SDCGRPL1                                         CDL025
      *                                                                                  CDL025
     C           @RTCD     IFEQ '*NRF   '                                                CDL025
     C           @RTCD     OREQ '*KEY   '                                                CDL025
     C                     MOVELASDCSN    GRPCOD                                         CDL025
     C           GRPKEY    CHAINSDCGRPL1             27                                  CDL025
     C           *IN27     IFEQ *ON                                                      CDL025
     C           *LOCK     IN   LDA                                                      CDL025
     C                     MOVE '023'     DBASE            * * * * * * * *               CDL025
     C                     MOVELASDCSN    DBKEY            *  DBERR 023  *               CDL025
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *               CDL025
     C                     OUT  LDA                                                      CDL025
     C                     EXSR *PSSR                                                    CDL025
     C                     ELSE                                                          CDL025
     C                     MOVELD6NTCU    CNUM                                           CDL025
     C                     ENDIF                                                         CDL025
     C                     ENDIF                                                         CDL025
      *                                                                                  CDL025
      *   set up netting data into fields used in program                                CDL025
      *     receive instructions                                                         CDL025
     C           ASBSIN    IFEQ 'B'                                                      CDL025
     C                     MOVE ASSETM    RSTM                                           CDL025
     C                     MOVE ASOURN    RONS                                           CDL025
     C                     MOVE ASONOB    ROBR                                           CDL025
     C                     MOVE ASIBNK    RIBN                                           CDL025
     C                     MOVE ASIBNA    RIBA                                           CDL025
     C                     MOVE ASOBNK    ROBN                                           CDL025
     C                     MOVE ASORDC    ROCN                                           CDL025
      *                                                                                  CDL025
      *     pay instructions                                                             CDL025
     C                     ELSE                                                          CDL025
     C                     MOVE ASSETM    PSTM                                           CDL025
     C                     MOVE ASOURN    PONS                                           CDL025
     C                     MOVE ASONOB    POBR                                           CDL025
     C                     MOVE ASIBNK    PIBN                                           CDL025
     C                     MOVE ASIBNA    PIBA                                           CDL025
     C                     MOVE ASOBNK    POBN                                           CDL025
     C                     MOVE ASORDC    POCN                                           CDL025
     C                     MOVELASRCRN    RCRN                                           CDL025
     C                     MOVELASRCRA    RCRA                                           CDL025
     C                     MOVELASRVNO    RVNO                                           CDL025
     C                     MOVELASAWBN    AWBN                                           CDL025
     C                     MOVELASAWBA    AWBA                                           CDL025
     C                     MOVELASBENN    BENN                                           CDL025
     C                     MOVELASBENA    BENA                                           CDL025
     C                     MOVELASDTP1    DTP1                                           CDL025
     C                     MOVELASDTP2    DTP2                                           CDL025
     C                     MOVELASDTP3    DTP3                                           CDL025
     C                     MOVELASDTP4    DTP4                                           CDL025
     C                     MOVELASDCHG    DCHG                                           CDL025
     C                     MOVELASBTB1    BTB1                                           CDL025
     C                     MOVELASBTB2    BTB2                                           CDL025
     C                     MOVELASBTB3    BTB3                                           CDL025
     C                     MOVELASBTB4    BTB4                                           CDL025
     C                     MOVELASBTB5    BTB5                                           CDL025
     C                     MOVELASBTB6    BTB6                                           CDL025
     C                     ENDIF                                                         CDL025
      *                                                                                  CDL025
     C                     MOVELASBRCA    BRCA                                           CDL025
     C                     MOVELASCHTY    CHTP                                           CDL025
     C                     MOVE 'N'       RCDT                                           CDL025
      *                                                                                  CDL025
     C                     ENDSR                                                         CDL025
      *                                                                                  CDL025
     C/EJECT                                                                             CDL025
      *****************************************************************
      *   TYPE - determine message type                               *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           TYPE      BEGSR
      *
      **  If receive message
     C           PYRC      IFEQ 'R'                                   1
     C                     MOVE '210'     @TYP    3
     C                     END                                       E1
      *
      **  If pay message
     C           PYRC      IFEQ 'P'
     C           PYRC      OREQ 'C'                                   1
      *
      **  If nostro transfer
     C           DTYP      IFEQ 'NX'                                  2
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP2                                           S01408
     C*                                                                   S01408
     C                     MOVE '200'     @TYP
     C/COPY WNCPYSRC,DL6315C030
      *
      **  If cover message
     C                     ELSE                                      X2
     C           CVMI      IFEQ 'S'                                   3
     C                     MOVE '202'     @TYP
      *
      **  If benificiary or ordering customer is non bank
     C                     ELSE                                      X3
      *
      **  Check if ordering customer is non-bank
      *
     C                     MOVE 'Y'       @BNBI   1
     C********** POCN      IFNE *ZEROS                                                        CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELPOCN      @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS                               4
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVELPOCN      DBKEY            *  DBERR 004  *
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E4
      *
     C**********           MOVE BBBNBI    @BNBI                           099441
     C                     MOVE BBSWFI    @BNBI                           099441
     C/COPY WNCPYSRC,DL6315C073
     C                     END                                       E4
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL6315VSF                                            S01408
     C*                                                                   S01408
      *
      **  Check if beneficiary is non-bank
      **  Test if customer number (numeric) or counterparty nostro
      *
     C***********          MOVELBENN      HOLD6   6                                           CSD027
     C***********          TESTN          HOLD6      3132                                     CSD027
     C************IN31     IFEQ '1'                                                           CSD027
     C************IN32     OREQ '1'                                                           CSD027
      *
     C                     MOVE *BLANKS   @KEY1
     C                     MOVELBENN      @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @KEY1  10
     C                     PARM *BLANKS   @KYST   7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS                               4
     C************LOCK     IN   LDA                                                           CSD027
     C***********          MOVE '005'     DBASE            * * * * * * * *                    CSD027
     C***********          MOVELBENN      DBKEY            *  DBERR 005  *                    CSD027
     C***********          MOVEL'SDCUSTPD'DBFILE           * * * * * * * *                    CSD027
     C***********          OUT  LDA                                                           CSD027
     C***********          EXSR *PSSR                                                         CSD027
     C***********          END                                       E4                       CSD027
     C/COPY WNCPYSRC,DL6315C074
      *
      **  Counterparty nostro (hence bank)
     C**********           ELSE                                                               CSD027
     C**********           MOVE 'Y'       BBBNBI                          099441
     C                     MOVE 'Y'       BBSWFI  1                       099441
     C/COPY WNCPYSRC,DL6315C075
     C                     END
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL6315VSR                                            S01408
     C*                                                                   S01408
      *
      *
      **  If BENN and POCN are banks OR
      **  BENN is a bank and POCN is blank  -  MT202
     C********** BBBNBI    IFEQ 'Y'                                       099441
     C           BBSWFI    IFEQ 'Y'                                       099441
     C/COPY WNCPYSRC,DL6315C076
     C           @BNBI     ANDEQ'Y'
     C                     MOVE '202'     @TYP
      *
      **  If BENN or POCN are non-bank  -  MT100
     C                     ELSE                                      X4
     C                     MOVE '100'     @TYP
     C                     END                                       E4
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL6315VS1                                            S01408
     C*                                                                   S01408
     C                     END                                       E3
     C                     END                                       E2
     C                     END                                       E1
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,DL6315CCP1                                           S01408
     C*                                                                   S01408
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,DL6315C009
      *****************************************************************
      *   DEST - determine destination customer                       *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           DEST      BEGSR
     C/COPY WNCPYSRC,DL6315C068
      *
      **  If receive message
      **  Access SDNOSTPD for receive nostro account
     C           @TYP      IFEQ '210'                                 1
     C                     MOVE *BLANKS   P@NONB
     C                     MOVELRONS      P@NONB
      *
     C           IPDS      IFEQ 'Y'                                       156788
     C           INSA      ANDNE*BLANKS                                   156788
     C           PRCDT     ANDEQ'I'                                       156788
     C                     MOVELINSA      P@NONB                          156788
     C                     ENDIF                                          156788
      *
      ** If SI deal amendment and interest is negative                                      MD037148
      ** a receipt is produced instead of pay,                                              MD037148
      ** but no receipt instruction is entered,                                             MD037148
      ** use pay instruction to prevent dbase error                                         MD037148
      *                                                                                     MD037148
     C           PRCDT     IFEQ 'A'                                                         MD037148
     C           @TYP      ANDEQ'210'                                                       MD037148
     C           AMTP      ANDEQ'SI'                                                        MD037148
     C           P@NONB    ANDEQ*BLANKS                                                     MD037148
     C           RONS      ANDEQ*BLANKS                                                     MD037148
     C                     MOVELPONS      P@NONB                                            MD037148
     C                     ENDIF                                                            MD037148
      *                                                                                     MD037148
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   P@CUST  6
     C                     PARM PCCY      P@CYCD  3
     C**********           PARM *BLANKS   P@ACCD  4                                           CGL029
     C                     PARM *BLANKS   P@ACCD 10                                           CGL029
     C                     PARM *BLANKS   P@ACSN  2
     C                     PARM           P@NONB  2
     C                     PARM *BLANKS   P@BRCD  3
     C                     PARM *BLANKS   P@CSSN 10
     C                     PARM *BLANKS   P@PNOI  1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           @RTCD     IFNE *BLANKS                               2
     C           *LOCK     IN   LDA
     C                     MOVE '006'     DBASE
     C                     MOVE PCCY      @WK5    5
     C                     MOVELRONS      @WK5             * * * * * * * *
     C                     MOVEL@WK5      DBKEY            *  DBERR 006  *
     C                     MOVEL'SDNOSTPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E2
      *
      **  Destination is the customer of our receive nostro
     C                     MOVELA7CUST    @DEST
      **  Save branch of nostro for later use
     C                     MOVE A7BRCD    WKRVBR  3
     C                     MOVE A7BRCD    WRKVAR  3                       179461
      *
      **  If recipient of payment entered & main payment message
      **  destination is receiver number
     C                     ELSE                                      X1
     C           RVNO      IFNE *BLANKS                               2
     C           CVMI      ANDNE'S'
     C                     MOVELRVNO      @DEST   6
      *
      **  Otherwise
      **  Access SDNOSTPD for pay nostro account
     C                     ELSE                                      X2
     C                     MOVE *BLANKS   P@NONB
     C                     MOVELPONS      P@NONB
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C/COPY WNCPYSRC,DL6315C034
     C           IPDS      IFEQ 'Y'                                       S01434
     C           INSA      ANDNE*BLANKS                                   S01434
     C                     MOVELINSA      P@NONB                          S01434
     C/COPY WNCPYSRC,DL6315C035
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           PRCDT     IFEQ 'A'                                                         MD037148
     C           AMTP      ANDEQ'SI'                                                        MD037148
     C           P@NONB    ANDEQ*BLANKS                                                     MD037148
     C           PONS      ANDEQ*BLANKS                                                     MD037148
     C                     MOVELRONS      P@NONB                                            MD037148
     C                     ENDIF                                                            MD037148
      *                                                                                     MD037148
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   P@CUST
     C                     PARM PCCY      P@CYCD
     C                     PARM *BLANKS   P@ACCD
     C                     PARM *BLANKS   P@ACSN
     C                     PARM           P@NONB
     C                     PARM *BLANKS   P@BRCD
     C                     PARM *BLANKS   P@CSSN
     C                     PARM *BLANKS   P@PNOI
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           @RTCD     IFNE *BLANKS                               3
     C           *LOCK     IN   LDA
     C                     MOVE '007'     DBASE
     C                     MOVE PCCY      @WK5
     C                     MOVELPONS      @WK5             * * * * * * * *
     C                     MOVEL@WK5      DBKEY            *  DBERR 007  *
     C                     MOVEL'SDNOSTPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E3
      *
     C                     MOVELA7CUST    @DEST
      **  Save branch of nostro for later use
     C                     MOVE A7BRCD    WKPYBR  3
     C                     MOVE A7BRCD    WRKVAR  3                       179461
     C/COPY WNCPYSRC,DL6315C054
     C                     END                                       E2
     C                     END                                       E1
      *
     C/COPY WNCPYSRC,DL6315C069
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   CANC - Generate cancellation for destination customer ?     *
      *   Calls - MG9200 cancellation/deletion program                *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           CANC      BEGSR
      *
      ** If Calling Prog Id equals 'PA', do deal amendment processing
      ** in MG9200 else do deal pay/receive processing
      *
     C           PRCDT     IFEQ 'A'
     C                     MOVE 'PA'      CALLP
     C                     ELSE
     C                     MOVE 'PR'      CALLP
     C                     END
      *                                                                                     MD034285
     C           WDEAM     IFEQ 'Y'                                                         MD034285
     C                     MOVE 'PX'      CALLP                                             MD034285
     C                     ENDIF                                                            MD034285
      *                                                                   CDL002
      **  If net record type then call with 'PN' net processing           CDL002
      *   MODID is set to NT, whereas previously it was always 'DL'       CDL002
     C           PRCDT     IFEQ 'N'                                       CDL002
     C           CDL002    ANDEQ'Y'                                       CDL002
     C                     MOVE 'PN'      CALLP                           CDL002
     C                     MOVE 'NT'      WFMODI  2                       CDL002
     C                     ELSE                                           CDL002
     C                     MOVE 'DL'      WFMODI                          CDL002
     C                     ENDIF                                          CDL002
      *
      ****Call*cancellation*program with parameters of the deal number    E29588
      ****program*type*(PR*= pay/receive), module id, an indicator to     E29588
      ****determine*if*further processing is required for Nostro          E29588
      ****Transfers*and*a*Return Code ('E' indicates a DB error)          E29588
      **********************                                              E29588
      **  Call cancellation program with parameters of the deal number    E29588
      **  program type,                                                   E29588
      **  module id,                                                      E29588
      **  deal amendment value date,                                      E29588
      **  deal amendment sequence number,                                 E29588
      **  an indicator to determine if further processing is              E29588
      **   Nostro Transfers,                                              E29588
      **  return Code ('E' indicates a DB error)                          E29588
      *                                                                   E29588
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C                     MOVE 'DL'      WKMODI                                              CAS009
     C                     MOVE DLNO      WKDLNO                                              CAS009
     C                     MOVE 'F'       WKFEER                                              CAS009
     C                     Z-ADDDFFSEQ    WKFSEQ                                              CAS009
     C                     MOVE *BLANKS   PTRNM1 14                                           CAS009
     C                     MOVELWKTNUM    PTRNM1                                              CAS009
     C                     CALL 'MG9300'               15                                     CAS009
     C                     PARM           PTRNM1                                              CAS009
     C                     PARM           CALLP                                               CAS009
     C                     PARM 'DL'      MODID                                               CAS009
     C                     PARM MGAVDT    TRVDT                                               CAS009
     C                     PARM MGASEQ    TRSEQ                                               CAS009
     C                     PARM *BLANKS   @RTNC                                               CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE DLNO      TRNUM                                               CLE148
     C                     CALL 'MG9200'               97
     C**********           PARM DLNO      TRNUM   60                                          CLE148
     C                     PARM           TRNUM   6                                           CLE148
     C                     PARM           CALLP   2                       E29588
     C***********          PARM 'DL'      MODID   2                 E29588CDL002
     C                     PARM WFMODI    MODID   2                       CDL002
     C                     PARM MGAVDT    TRVDT   50                      E29588
     C                     PARM MGASEQ    TRSEQ   30                      E29588
     C                     PARM *BLANKS   REVNX   1
     C                     PARM *BLANKS   @RTNC   1                       E29588
     C***********          PARM @TYP      @TYPE   3                157756 169025
     C                     PARM           @CLSS                           CDL008
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *
      **  If Cancs/Dels programs ended with a DB error, use the LDA
      **  entries set up for that error
      *
     C           @RTNC     IFEQ 'E'                                       E29588
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
      ** If CALL to Cancs/Dels programs ended abnormally
      *
     C           *IN97     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVE '008'     DBASE            * * * * * * * *
     C                     MOVEL'MG9200'  DBKEY            *  DBERR 008  *
     C                     MOVEL*BLANKS   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     ENDSR
     C/EJECT
      *****************************************************************   087655
      *   MGCANC - Delete duplicate record from MGF files if          *   087655
      *            necessary.                                         *   087655
      *   Called by - main process                                    *   087655
      *****************************************************************   087655
      *                                                                   087655
     C           MGCANC    BEGSR                                          087655
      *                                                                   087655
      **  MOVE COMMON FIELD                                               087655
      *                                                                   087655
     C                     MOVE @DEST     KDEST                           087655
     C           PVDAT     IFNE 0                                         087655
     C                     Z-ADDPVDAT     KVDAT                           087655
     C                     ELSE                                           087655
     C                     Z-ADDVDAT      KVDAT                           087655
     C                     END                                            087655
      *                                                                   087655
      **  CHECK TYPE TO DELETE                                            087655
     C           @TYP      IFEQ '100'                                                         141571
      *                                                                                       141571
      ** Move appropriate fields to appropriate fields for chain                              141571
      ** to file involved.                                                                    141571
      *                                                                                       141571
      *                                                                                       141571
     C**********           MOVE ROBR      RPOBR                                        141571 194643
     C                     MOVE POBR      RPOBR                                               194643
     C           RPOBR     IFEQ *BLANKS                                                       141571
     C                     MOVE WKRVBR    RPOBR                                               141571
     C                     END                                                                141571
      *                                                                                       141571
      ** Set low limit to MGF210 file and find equivalent record.                             141571
      *                                                                                       141571
     C           MGKEY     SETLLMGF100L0                                                      141571
     C           MGKEY     READEMGF100L0                 25                                   141571
     C           *IN25     DOWEQ'0'                                                           141571
      *                                                                                       141571
      ** Check if it is similar record. If it is delete and comit                             141571
      ** and get out of the loop.                                                             141571
      *                                                                                       141571
     C                     MOVELMGTNUM    TTNUM   6                                           141571
     C                     MOVE DLNO      TDLNO   6                                           141571
     C           TDLNO     IFEQ TTNUM                                                         141571
     C           MGEAMT    ANDEQEAMT                                                          141571
     C                     DELETMGF100D0                                                      141571
     C                     COMIT                                                              141571
     C                     SETON                     25                                       141571
     C                     ELSE                                                               141571
     C           MGKEY     READEMGF100L0                 25                                   141571
     C                     END                                                                141571
      *                                                                                       141571
     C                     END                                                                141571
      *                                                                                       141571
     C                     ELSE                                                               141571
      *                                                                                       141571
     C           @TYP      IFEQ '210'                                     087655
      *                                                                   087655
      **  MOVE APPROPRIATE FIELDS TO APPROPRIATE FIELDS FOR CHAIN         087655
      **  TO FILE INVOLVED.                                               087655
      *                                                                   087655
      *                                                                   087655
     C                     MOVE ROBR      RPOBR                           087655
     C           RPOBR     IFEQ *BLANKS                                   087655
     C                     MOVE WKRVBR    RPOBR                           087655
     C                     END                                            087655
      *                                                                   087655
      **  SET LOW LIMIT TO MGF210 FILE AND FIND EQUIVALENT RECORD.        087655
      *                                                                   087655
     C           MGKEY     SETLLMGF210L0                                  087655
     C           MGKEY     READEMGF210L0                 25               087655
     C           *IN25     DOWEQ'0'                                       087655
      *                                                                   087655
      **  CHECK IF IT IS SIMILAR RECORD.  IF IT IS DELETE AND COMIT       087655
      **  AND GET OUT OF THE LOOP.                                        087655
      *                                                                   087655
     C                     MOVELMGTNUM    TTNUM   6                       087655
     C                     MOVE DLNO      TDLNO   6                       087655
     C           TDLNO     IFEQ TTNUM                                     087655
     C           MGEAMT    ANDEQEAMT                                      087655
     C                     DELETMGF210D0                                  087655
     C/COPY WNCPYSRC,DL6315C010
     C                     COMIT                                          087655
     C                     SETON                     25                   087655
     C                     ELSE                                           087655
     C           MGKEY     READEMGF210L0                 25               087655
     C                     END                                            087655
      *                                                                   087655
     C                     END                                            087655
      *                                                                   087655
     C                     ELSE                                           087655
      *                                                                   087655
      **  MOVE APPROPRIATE FIELDS TO APPROPRIATE FIELDS FOR CHAIN         087655
      **  TO FILE INVOLVED.                                               087655
      *                                                                   087655
      *                                                                   087655
     C                     MOVE POBR      RPOBR                           087655
     C           RPOBR     IFEQ *BLANKS                                   087655
     C                     MOVE WKPYBR    RPOBR                           087655
     C                     END                                            087655
      *                                                                   087655
      **  SET LOW LIMIT TO MGF210 FILE AND FIND EQUIVALENT RECORD.        087655
      *                                                                   087655
     C           MGKEY     SETLLMGF202L0                                  087655
     C           MGKEY     READEMGF202L0                 25               087655
     C           *IN25     DOWEQ'0'                                       087655
      *                                                                   087655
      **  CHECK IF IT IS SIMILAR RECORD.  IF IT IS DELETE AND COMIT       087655
      **  AND GET OUT OF THE LOOP.                                        087655
      *                                                                   087655
     C                     MOVELMGTNUM    TTNUM   6                       087655
     C                     MOVE DLNO      TDLNO   6                       087655
     C           TDLNO     IFEQ TTNUM                                     087655
     C           MGEAMT    ANDEQEAMT                                      087655
     C                     DELETMGF202D0                                  087655
     C                     COMIT                                          087655
     C                     SETON                     25                   087655
     C                     ELSE                                           087655
     C           MGKEY     READEMGF202L0                 25               087655
     C                     END                                            087655
      *                                                                   087655
     C                     END                                            087655
      *                                                                   087655
     C                     END                                            087655
      *                                                                   087655
     C                     END                                                                141571
      *                                                                                       141571
     C                     ENDSR                                          087655
     C/EJECT                                                              087655
      *****************************************************************
      *   VALD - determine if message type is to be generated for     *
      *          the destination customer
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           VALD      BEGSR
      *
      **  Set up wildcard for message group (eg 1**)
     C                     MOVEL@TYP      @WLD
     C                     MOVE '**'      @WLD    3
      *
      **  and for message category (eg 20*)
     C                     MOVEL@TYP      @WLDR
     C                     MOVE '*'       @WLDR   3
      *
      **  Access Customer details using the destination customer
      **  calculated in Subroutine DEST
     C                     MOVE *BLANKS   @KEY1
     C                     MOVEL@DEST     @KEY1
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @KEY1
     C                     PARM *BLANKS   @KYST
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS                               1
     C           *LOCK     IN   LDA
     C                     MOVE '009'     DBASE            * * * * * * * *
     C                     MOVEL@DEST     DBKEY            *  DBERR 009  *
     C                     MOVEL'SDCUSTPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
     C/COPY WNCPYSRC,DL6315C028
      *
      **  Load array NGN with all message types that are not
      **  to be generated for this customer
     C                     MOVE BBNG01    NGN,1
     C                     MOVE BBNG02    NGN,2
     C                     MOVE BBNG03    NGN,3
     C                     MOVE BBNG04    NGN,4
     C                     MOVE BBNG05    NGN,5
     C                     MOVE BBNG06    NGN,6
     C                     MOVE BBNG07    NGN,7
     C                     MOVE BBNG08    NGN,8
     C                     MOVE BBNG09    NGN,9
     C                     MOVE BBNG10    NGN,10
     C                     MOVE BBNG11    NGN,11
     C                     MOVE BBNG12    NGN,12
     C                     MOVE BBNG13    NGN,13
     C                     MOVE BBNG14    NGN,14
     C                     MOVE BBNG15    NGN,15
      *
      **  Determine if message type is not to be generated for the
      **  for the destination customer, using both message type
      **  and wildcard to check against array entries
     C           @TYP      LOKUPNGN                      20
     C           @WLD      LOKUPNGN                      21
     C           @WLDR     LOKUPNGN                      22
     C/COPY WNCPYSRC,DL6315C029
      *
      ** If either indicator is on message will not be generated
      **  (see main processing)
      *
     C           RVNO      IFNE *BLANKS                                   081540
     C           CVMI      ANDNE'S'                                       081540
     C                     MOVE BBBRCD    WKPYBR                          081540
     C                     ENDIF                                          081540
      *                                                                   081540
      ** Set off *IN20. Suppression will be dealt in pgm/MG0100.          CFT013
      *                                                                   CFT013
     C           CFT013    IFEQ 'Y'                                       CFT013
     C           *IN20     ANDEQ*ON                                       CFT013
     C           @TYP      IFEQ '100'                                     CFT013
     C           @TYP      OREQ '103'                                     CFT013
     C                     MOVE *OFF      *IN20                           CFT013
     C                     ENDIF                                          CFT013
     C                     ENDIF                                          CFT013
      *                                                                   CFT013
      ** If FX deal is settled through CLS, suppress pay/receives         CDL008
      *                                                                   CDL008
     C           @CLSS     IFEQ 'Y'                                       CDL008
     C                     MOVE *ON       *IN20                           CDL008
     C                     ENDIF                                          CDL008
      *                                                                   CDL008
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *   FMTO - format and output record for message generation      *
      *   Called by - main process                                    *
      *****************************************************************
      *
     C           FMTO      BEGSR
      *
     C/COPY WNCPYSRC,DL6315C062
      **  Format common fields
     C                     MOVE *BLANKS   MGBENA                          167507
     C                     MOVE *BLANKS   MGPIBN                                              190328
     C                     MOVE *BLANKS   MGPIBA                                              190328
     C                     MOVE @DEST     MGDEST
     C                     MOVELDLNO      MGTNUM
      *
     C                     MOVE @MOD      MGMODI
     C                     Z-ADDPVDAT     MGVDAT
     C           PVDAT     IFEQ 0
     C                     Z-ADDVDAT      MGVDAT
     C                     END
     C                     MOVE PCCY      MGCCY
     C/COPY WNCPYSRC,DL6315C063
     C                     Z-ADDEAMT      MGEAMT
     C/COPY WNCPYSRC,DL6315C064
     C                     MOVE DTYP      MGTTYP
     C                     MOVE DLST      MGTSTP
     C                     MOVE BRCA      MGBRCA
     C                     MOVE CHTP      MGCHTP
     C**********           Z-ADDCNUM      MGCNUM                                              CSD027
     C                     MOVE CNUM      MGCNUM                                              CSD027
     C                     Z-ADDSETP      MGSETP
     C                     Z-ADDOTRA      MGOTRA                          CEU003
     C                     MOVE OTRC      MGOTRC                          CEU003
      *                                                                   175754
      ** If INOS is a customer shortname, search for equivalent           175754
      ** customer number and store it to a variable, otherwise            175754
      ** store INOS.                                                      175754
      *                                                                   175754
     C           INOS      IFNE *BLANKS                                   175754
     C                     MOVE INOS      WTINOS  2                       175754
     C                     MOVE *BLANKS   WINOS                           175754
     C           WTINOS    IFNE *BLANKS                                   175754
     C                     MOVELINOS      KBCSSN 10                       175754
     C           KBCSSN    CHAINSDCUSTL6             11                   175754
     C           *IN11     IFEQ '0'                                       175754
     C                     MOVELBBCUST    WINOS  10                       175754
     C                     ENDIF                                          175754
     C                     ELSE                                           175754
     C                     MOVELINOS      WINOS                           175754
     C                     ENDIF                                          175754
     C                     ENDIF                                          175754
     C/COPY WNCPYSRC,DL6315C060
      *
      **  Format exchange /interest rate for MT202 & MT210
     C           RCDT      IFEQ 'B'                                  B1
     C/COPY WNCPYSRC,DL6315C065
     C                     Z-ADDEXRT      MGRATE
     C/COPY WNCPYSRC,DL6315C066
     C                     ELSE
     C                     Z-ADDINTR      MGRATE
     C                     END                                       E1
     C           RCDT      IFEQ 'N'                                       CDL002
     C                     Z-ADD0         MGRATE                          CDL002
     C                     END                                            CDL002
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PRCDT     ANDEQ'M'                                                           CAS009
     C                     MOVE DFLCDT    MGCHTP                                              CAS009
     C                     MOVELDLNO      WKMTRN                                              CAS009
     C                     MOVE 'F'       WKFEE                                               CAS009
     C                     Z-ADDDFFSEQ    WKSEQ                                               CAS009
     C                     MOVE *BLANKS   MGTNUM                                              CAS009
     C                     MOVELWKTRN     MGTNUM                                              CAS009
     C                     ENDIF                                                              CAS009
      *
      **   The following set of code re-access the DEALS file to
      **  obtain the settlement instruction if the settlement
      **  instruction has not been entered on the DEAMS file.
      **   This is done by Checking PSTM & RSTM on the DEAMS file.
      *
     C           PRCDT     IFEQ 'A'
      *
     C           PYRC      IFEQ 'P'
     C           PYRC      OREQ 'C'                                       099917
     C           PSTM      IFEQ 0
      *
      **  Access deal record again.
      *
     C           DLNO      CHAINDEALS                11
      *
     C           *IN11     IFEQ '1'
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'R'
     C           *LOCK     IN   LDA
     C                     MOVE '010'     DBASE            * * * * * * * *
     C                     MOVELDLNO      DBKEY            *  DBERR 010  *
     C                     MOVEL'DEALS'   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C***********          ELSE                                           085770
     C                     END                                            085770
     C           PYRC      IFEQ 'R'                                       085770
     C           RSTM      IFEQ 0
      *
      **  Access deal record again.
      *
     C           DLNO      CHAINDEALS                11
      *
     C           *IN11     IFEQ '1'
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'R'
     C           *LOCK     IN   LDA
     C                     MOVE '011'     DBASE            * * * * * * * *
     C                     MOVELDLNO      DBKEY            *  DBERR 011  *
     C                     MOVEL'DEALS'   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     END
     C                     END
     C                     END
      *
      **  Access nostro customer for payment message
      *
     C           PYRC      IFEQ 'P'
     C                     MOVELPONS      @NSKYE
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C/COPY WNCPYSRC,DL6315C036
     C           IPDS      IFEQ 'Y'                                       S01434
     C           INSA      ANDNE*BLANKS                                   S01434
     C                     MOVELINSA      @NSKYE                          S01434
     C/COPY WNCPYSRC,DL6315C037
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM *BLANKS   @NSKYA  6
     C                     PARM PCCY      @NSKYB  3
     C**********           PARM *BLANKS   @NSKYC  4                                           CGL029
     C                     PARM *BLANKS   @NSKYC 10                                           CGL029
     C                     PARM *BLANKS   @NSKYD  2
     C                     PARM           @NSKYE  2
     C                     PARM *BLANKS   @KEYF   3
     C                     PARM *BLANKS   @KEYG  10
     C                     PARM *BLANKS   @KEYH   1
     C           SDNOST    PARM SDNOST    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS                               1
     C           *LOCK     IN   LDA
     C                     MOVE '012'     DBASE            * * * * * * * *
     C                     MOVELPCCY      DBKY6   6        *  DBERR 012  *
     C                     MOVE PONS      DBKY6            * * * * * * * *
     C           PRCDT     IFEQ 'I'                                       S01434
     C/COPY WNCPYSRC,DL6315C038
     C           IPDS      IFEQ 'Y'                                       S01434
     C           INSA      ANDNE*BLANKS                                   S01434
     C                     MOVE INSA      DBKY6                           S01434
     C/COPY WNCPYSRC,DL6315C039
     C                     END                                            S01434
     C                     END                                            S01434
     C                     MOVELDBKY6     DBKEY
     C                     MOVEL'SDNOSTPD'DBFILE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                                       E1
      *
      **  A/C with institute is not output, if equal to nostro customer
      *
     C********** A7CUST    IFEQ AWBN                                                          172477
     C********** DTYP      ANDNE'NX'                                  2                       172477
     C********** PIBN      ANDEQ*BLANKS                                                105901 172477
     C**********           MOVE *BLANKS   AWBN                                                172477
     C**********           END                                                                172477
     C                     END
      *
      **  Format fields for MT100 - Customer transfer
     C           @TYP      IFEQ '100'                                B1
      *                                                                   E29588
      **  Default POCN if not set up on deal                              E29588
     C********** POCN      IFEQ *ZEROS                               B2                E29588 CSD027
     C**********           Z-ADDMGCNUM    MGPOCN                                       E29588 CSD027
     C           POCN      IFEQ *BLANKS                              B2                       CSD027
     C                     MOVE MGCNUM    MGPOCN                                              CSD027
     C                     ELSE                                      X2   E29588
     C**********           Z-ADDPOCN      MGPOCN                                              CSD027
     C                     MOVE POCN      MGPOCN                                              CSD027
     C                     END                                       E2   E29588
     C**********           Z-ADDPOBN      MGPOBN                                              CSD027
     C                     MOVE POBN      MGPOBN                                              CSD027
     C                     MOVELRVNO      MGRVNO
     C                     MOVELRCRN      MGRCRN
     C                     MOVELRCRA      MGRCRA
     C                     MOVELPIBN      MGPIBN
     C                     MOVELPIBA      MGPIBA
     C                     MOVELPONS      MGPONS
     C                     MOVELPOBR      MGPOBR
     C                     MOVELAWBN      MGAWBN
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,DL6315C040
     C           @CHG      IFEQ 'A'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C           @CHG      OREQ 'I'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C                     MOVE 'I'       MGTNUM                                              236190
     C                     ENDIF                                                              236190
      *                                                                                       236190
     C           IPDS      IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C********** @CHG      IFEQ 'A'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C********** @CHG      OREQ 'I'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C**********           MOVE 'I'       MGTNUM                                      BUG6076 236190
     C**********           ENDIF                                                      BUG6076 236190
      **********                                                                      BUG6076 236190
     C           INSA      IFNE *BLANKS                                   S01434
     C                     MOVELINSA      MGPONS                          S01434
     C           IMET      IFEQ '05'                                      S01434
     C                     MOVE INSA      MGPOBR                          S01434
     C                     ELSE                                           179461
     C                     MOVE WRKVAR    MGPOBR                          179461
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           INOS      IFNE *BLANKS                                   S01434
     C***********          MOVE INOS      MGAWBN                    S01434079138
     C**********           MOVELINOS      MGAWBN                   079138 175754
     C                     MOVELWINOS     MGAWBN                          175754
     C/COPY WNCPYSRC,DL6315C041
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     MOVELAWBA      MGAWBA
     C                     MOVELBENN      MGBENN
     C/COPY WNCPYSRC,DL6315C056
     C                     MOVELBENA      MGBENA
     C/COPY WNCPYSRC,DL6315C057
     C                     MOVELDTP1      MGDTP1
     C                     MOVELDTP2      MGDTP2
     C                     MOVELDTP3      MGDTP3
     C                     MOVELDTP4      MGDTP4
     C                     MOVELDCHG      MGDCHG
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP3                                           S01408
     C*                                                                   S01408
     C                     MOVELBTB1      MGBTB1
     C                     MOVELBTB2      MGBTB2
     C                     MOVELBTB3      MGBTB3
     C                     MOVELBTB4      MGBTB4
     C                     MOVELBTB5      MGBTB5
     C                     MOVELBTB6      MGBTB6
     C                     MOVELCVMI      MGCVMI                          105577
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP4                                           S01408
     C*                                                                   S01408
     C           MGPOBR    IFEQ *BLANKS
     C                     MOVE WKPYBR    MGPOBR
     C                     END
     C/COPY WNCPYSRC,DL6315C061
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
     C           MGEAMT    IFEQ 0                                                           BUG7821R
     C                     MOVE 'Z'       MGCHTP                                            BUG7821R
     C                     ENDIF                                                            BUG7821R
     C                     WRITEMGF100D0
     C/COPY WNCPYSRC,DL6315C050
     C                     END                                       E1
      *
      **  Format fields for MT200 - Bank transfer for its own account
      **  Suppress SWIFT generation if counterparty is the nostro and this084182
      **  feature is available                                            084182
     C           @TYP      IFEQ '200'
     C           CSW002    IFEQ 'N'                                       084182
     C           CSW002    OREQ 'Y'                                       084182
     C           PCNUM     ANDNEMGDEST                                    084182
     C                     MOVELPIBN      MGPIBN
     C                     MOVELPIBA      MGPIBA
     C                     MOVELPONS      MGPONS
     C                     MOVELRONS      MGRONS
     C                     MOVELPOBR      MGPOBR
     C                     MOVELAWBN      MGAWBN
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,DL6315C042
     C           IPDS      IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C           INSA      IFNE *BLANKS                                   S01434
     C                     MOVELINSA      MGPONS                          S01434
     C           IMET      IFEQ '05'                                      S01434
     C                     MOVE INSA      MGPOBR                          S01434
     C                     ELSE                                           179461
     C                     MOVE WRKVAR    MGPOBR                          179461
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           INOS      IFNE *BLANKS                                   S01434
     C***********          MOVE INOS      MGAWBN                    S01434079138
     C**********           MOVELINOS      MGAWBN                   079138 175754
     C                     MOVELWINOS     MGAWBN                          175754
     C/COPY WNCPYSRC,DL6315C043
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     MOVELAWBA      MGAWBA
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP5                                           S01408
     C*                                                                   S01408
     C                     MOVELBTB1      MGBTB1
     C                     MOVELBTB2      MGBTB2
     C                     MOVELBTB3      MGBTB3
     C                     MOVELBTB4      MGBTB4
     C                     MOVELBTB5      MGBTB5
     C                     MOVELBTB6      MGBTB6
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP6                                           S01408
     C*                                                                   S01408
     C           MGPOBR    IFEQ *BLANKS
     C                     MOVE WKPYBR    MGPOBR
     C                     END
      *
      **  Pay Ordering Bank Number is equal to the Branch Int. Customer
      **  number of the branch of the deal, when the branch of the deal
      **  is not equal to the pay branch
      *
     C           MGBRCA    IFNE MGPOBR
      *
      **  Access SDBRCHPD using branch code
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM MGBRCA    @BRCD   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Branch record not found - Error
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '013'     DBASE            * * * * * * * *
     C                     MOVELMGBRCA    DBKEY            *  DBERR 013  *
     C                     MOVEL'SDBRCHPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELA8BICN    MGPOBN
     C                     END
     C*CO*Y WN*PY*RC*DL6315C011                                           S01408
     C/COPY WNCPYSRC,DL6315CP12                                           S01408
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
     C                     WRITEMGF200D0
     C                     END                                            084182
     C                     END
     C*CO*Y WN*PY*RC*DL6315C003                                           S01408
     C/COPY WNCPYSRC,DL6315CP13                                           S01408
      *
      **  Format fields for MT202 - Bank transfer in favour of third bank
      **  Suppress SWIFT generation if counterparty is the nostro and this084182
      **  feature is available                                            084182
     C           @TYP      IFEQ '202'                                B1
     C           CSW002    IFEQ 'N'                                       084182
     C           CSW002    OREQ 'Y'                                       084182
     C           PCNUM     ANDNEMGDEST                                    084182
     C/COPY WNCPYSRC,DL6315C033
     C**********           Z-ADDPOBN      MGPOBN                                              CSD027
     C                     MOVE POBN      MGPOBN                                              CSD027
     C                     MOVELPONS      MGPONS
     C                     MOVELPOBR      MGPOBR
      *
     C           CVMI      IFNE 'S'                                  B2
     C                     MOVELRVNO      MGRVNO
     C                     MOVELRCRN      MGRCRN
     C                     MOVELRCRA      MGRCRA
     C                     MOVELPIBN      MGPIBN
     C                     MOVELPIBA      MGPIBA
     C                     MOVELAWBN      MGAWBN
     C                     MOVELAWBA      MGAWBA
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,DL6315C044
     C           @CHG      IFEQ 'A'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C           @CHG      OREQ 'I'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C                     MOVE 'I'       MGTNUM                                              236190
     C                     ENDIF                                                              236190
      *                                                                                       236190
     C           IPDS      IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C********** @CHG      IFEQ 'A'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C********** @CHG      OREQ 'I'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C**********           MOVE 'I'       MGTNUM                                      BUG6076 236190
     C**********           ENDIF                                                      BUG6076 236190
      **********                                                                      BUG6076 236190
     C           INSA      IFNE *BLANKS                                   S01434
     C                     MOVELINSA      MGPONS                          S01434
     C           IMET      IFEQ '05'                                      S01434
     C                     MOVE INSA      MGPOBR                          S01434
     C                     ELSE                                           179461
     C                     MOVE WRKVAR    MGPOBR                          179461
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           INOS      IFNE *BLANKS                                   S01434
     C***********          MOVE INOS      MGAWBN                    S01434079138
     C**********           MOVELINOS      MGAWBN                   079138 175754
     C                     MOVELWINOS     MGAWBN                          175754
     C/COPY WNCPYSRC,DL6315C045
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C                     MOVELBENN      MGBENN
     C/COPY WNCPYSRC,DL6315C058
     C                     MOVELBENA      MGBENA
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP7                                           S01408
     C*                                                                   S01408
     C                     MOVELBTB1      MGBTB1
     C                     MOVELBTB2      MGBTB2
     C                     MOVELBTB3      MGBTB3
     C                     MOVELBTB4      MGBTB4
     C                     MOVELBTB5      MGBTB5
     C                     MOVELBTB6      MGBTB6
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL6315CCP8                                           S01408
     C*                                                                   S01408
     C                     ELSE                                      X2
     C/COPY WNCPYSRC,DLH00101
     C                     MOVELRCRN      MGAWBN
     C                     MOVELRCRA      MGAWBA
     C/COPY WNCPYSRC,DLH00102
     C                     MOVELRVNO      MGBENN
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,DL6315C046
     C           @CHG      IFEQ 'A'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C           @CHG      OREQ 'I'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C                     MOVE 'I'       MGTNUM                                              236190
     C                     ENDIF                                                              236190
      *                                                                                       236190
     C           IPDS      IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C********** @CHG      IFEQ 'A'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C********** @CHG      OREQ 'I'                                                   BUG6076 236190
     C********** CSW025    ANDEQ'Y'                                                   BUG6076 236190
     C**********           MOVE 'I'       MGTNUM                                      BUG6076 236190
     C**********           ENDIF                                                      BUG6076 236190
      **********                                                                      BUG6076 236190
     C           INSA      IFNE *BLANKS                                   S01434
     C                     MOVELINSA      MGPONS                          S01434
     C           IMET      IFEQ '05'                                      S01434
     C                     MOVE INSA      MGPOBR                          S01434
     C                     ELSE                                           179461
     C                     MOVE WRKVAR    MGPOBR                          179461
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           INOS      IFNE *BLANKS                                   S01434
     C***********          MOVE INOS      MGAWBN                    S01434079138
     C**********           MOVELINOS      MGAWBN                   079138 175754
     C                     MOVELWINOS     MGAWBN                          175754
     C/COPY WNCPYSRC,DL6315C047
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C/COPY WNCPYSRC,DL6315C032
     C*                                                                   S01434
     C                     MOVEL*BLANKS   USBTB                           CSW096
     C                     Z-ADD1         USLIN   10                      CSW096
     C*                                                                   CSW096
     C           USLIN     DOWLE6                                         CSW096
     C*                                                                   CSW096
     C                     SELEC                                          CSW096
     C           USLIN     WHEQ 1                                         CSW096
     C                     MOVELBTB1      USBTB                           CSW096
     C           USLIN     WHEQ 2                                         CSW096
     C                     MOVELBTB2      USBTB                           CSW096
     C           USLIN     WHEQ 3                                         CSW096
     C                     MOVELBTB3      USBTB                           CSW096
     C           USLIN     WHEQ 4                                         CSW096
     C                     MOVELBTB4      USBTB                           CSW096
     C           USLIN     WHEQ 5                                         CSW096
     C                     MOVELBTB5      USBTB                           CSW096
     C           USLIN     WHEQ 6                                         CSW096
     C                     MOVELBTB6      USBTB                           CSW096
     C                     ENDSL                                          CSW096
     C*                                                                   CSW096
     C                     ADD  1         USLIN                           CSW096
     C*                                                                   CSW096
     C           USRCB     IFEQ '/RCB/'                                   CSW096
     C                     MOVELUSBN1     MGAWBN                          CSW096
     C           USBN2     IFNE *BLANKS                                   CSW096
     C                     MOVELUSBN2     MGAWBB                          CSW096
     C                     ELSE                                           CSW096
     C                     MOVEL'XXX'     MGAWBB                          CSW096
     C                     ENDIF                                          CSW096
     C                     MOVEL*BLANKS   MGAWBA                          CSW096
     C                     MOVELRCRN      MGPIBN                          CSW096
     C                     MOVELRCRA      MGPIBA                          CSW096
      *                                                                   CSW096
      * Leave DO loop as /RCB/ found                                      CSW096
      *                                                                   CSW096
     C                     LEAVE                                          CSW096
      *                                                                   CSW096
     C                     ENDIF                                          CSW096
      *                                                                   CSW096
     C                     ENDDO                                          CSW096
     C*                                                                   CSW096
      ** Bank to Bank Information for FX transaction                                          CSW212
      *                                                                                       CSW212
     C           CSW212    IFEQ 'Y'                                                           CSW212
     C           RCDT      ANDEQ'B'                                                           CSW212
     C                     MOVELDSR1      MGBTB1                                              CSW212
     C                     MOVELDSR2      MGBTB2                                              CSW212
     C                     MOVELDSR3      MGBTB3                                              CSW212
     C                     MOVELDSR4      MGBTB4                                              CSW212
     C                     MOVELDSR5      MGBTB5                                              CSW212
     C                     MOVELDSR6      MGBTB6                                              CSW212
     C                     ENDIF                                                              CSW212
      *                                                                                       CSW212
     C/COPY WNCPYSRC,DL6315C031
     C                     END                                       E2
     C                     MOVELCVMI      MGCVMI                          105577
     C           MGPOBR    IFEQ *BLANKS
     C                     MOVE WKPYBR    MGPOBR
     C                     END
     C/COPY WNCPYSRC,DL6315C055
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
     C           MGEAMT    IFEQ 0                                                            BUG6479
     C**********           MOVE 'C'       MGCHTP                                     BUG6479 BUG7821
     C                     MOVE 'Z'       MGCHTP                                             BUG7821
     C                     ENDIF                                                             BUG6479
     C                     WRITEMGF202D0
     C/COPY WNCPYSRC,DL6315C051
      *                                                                   CSW096
      * Clear A/C with Bank BIC Branch field                              CSW096
      *                                                                   CSW096
     C                     MOVEL*BLANKS   MGAWBB                          CSW096
     C                     END                                            084182
     C                     END                                       E1
      *
      **  Format fields for MT210 - Notice to receive
      **  Suppress SWIFT generation if counterparty is the nostro and this084182
      **  feature is available                                            084182
     C           @TYP      IFEQ '210'                                B1
     C           CSW002    IFEQ 'N'                                       084182
     C           CSW002    OREQ 'Y'                                       084182
     C           PCNUM     ANDNEMGDEST                                    084182
     C/COPY WNCPYSRC,DL6315C070
     C**********           Z-ADDROCN      MGROCN                                              CSD027
     C**********           Z-ADDROBN      MGROBN                                              CSD027
     C                     MOVE ROCN      MGROCN                                              CSD027
     C                     MOVE ROBN      MGROBN                                              CSD027
     C                     MOVELRIBN      MGRIBN
     C                     MOVELRIBA      MGRIBA
     C                     MOVELRONS      MGRONS
     C                     MOVELROBR      MGROBR
     C*                                                                   S01434
     C           PRCDT     IFEQ 'I'                                       S01434
     C*                                                                   S01434
     C/COPY WNCPYSRC,DL6315C048
     C           @CHG      IFEQ 'A'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C           @CHG      OREQ 'I'                                                           236190
     C           CSW025    ANDEQ'Y'                                                           236190
     C                     MOVE 'I'       MGTNUM                                              236190
     C                     ENDIF                                                              236190
      *                                                                                       236190
     C           IPDS      IFEQ 'Y'                                       S01434
     C*                                                                   S01434
     C           INSA      IFNE *BLANKS                                   S01434
     C                     MOVELINSA      MGPONS                          S01434
     C           IMET      IFEQ '05'                                      S01434
     C                     MOVE INSA      MGPOBR                          S01434
     C                     ELSE                                           179461
     C                     MOVE WRKVAR    MGPOBR                          179461
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           INOS      IFNE *BLANKS                                   S01434
     C***********          MOVE INOS      MGAWBN                    S01434079138
     C**********           MOVELINOS      MGAWBN                   079138 175754
     C                     MOVELWINOS     MGAWBN                          175754
     C/COPY WNCPYSRC,DL6315C049
     C*                                                                   S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C                     END                                            S01434
     C*                                                                   S01434
     C           MGROBR    IFEQ *BLANKS
     C                     MOVE WKRVBR    MGROBR
     C                     END
      *
      **  Receive Ordering Bank Number is equal to the Branch Int.
      **  Customer Number of the branch of the deal, when the branch
      **  is not equal to the receive branch of a 'NX' transaction
      *
     C           MGBRCA    IFNE MGROBR
     C           DTYP      ANDEQ'NX'
      *
      **  Access SDBRCHPD using branch code
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM MGBRCA    @BRCD   3
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
      ** Branch record not found - Error
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '014'     DBASE            * * * * * * * *
     C                     MOVELMGBRCA    DBKEY            *  DBERR 014  *
     C                     MOVEL'SDBRCHPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     MOVELA8BICN    MGROBN
     C                     END
     C/COPY WNCPYSRC,DL6315C011
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
     C           MGEAMT    IFEQ 0                                                            BUG6479
     C**********           MOVE 'C'       MGCHTP                                     BUG6479 BUG7821
     C                     MOVE 'Z'       MGCHTP                                             BUG7821
     C                     ENDIF                                                             BUG6479
     C                     WRITEMGF210D0
     C/COPY WNCPYSRC,DL6315C052
     C                     END                                            084182
     C                     END                                       E1
     C/COPY WNCPYSRC,DL6315C003
      *
     C                     COMIT
      *
     C                     ENDSR
     C/COPY WNCPYSRC,DL6315C053
     C/EJECT
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRFEE - Format details for Fees                              *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
     C           SRFEE     BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     SELEC                                                              CAS009
     C           DFPYON    WHEQ 'S'                                                           CAS009
     C           DFPYON    OREQ ' '                                                           CAS009
     C                     Z-ADDDFPSTD    MGAVDT                                              CAS009
     C           DFPYON    WHEQ 'E'                                                           CAS009
     C           DFPYON    OREQ 'N'                                                           CAS009
     C           DFNPYD    ANDEQ0                                                             CAS009
     C                     Z-ADDDFPEND    MGAVDT                                              CAS009
     C                     OTHER                                                              CAS009
     C                     Z-ADDDFNPYD    MGAVDT                                              CAS009
     C                     ENDSL                                                              CAS009
      *                                                                                       CAS009
     C                     Z-ADDDFFSEQ    MGASEQ                                              CAS009
     C                     MOVELDFLCDT    CHTP                                                CAS009
     C**********           Z-ADDDFCUST    CNUM                                         CAS009 CSD027
     C                     MOVE DFCUST    CNUM                                                CSD027
     C                     MOVELDFDTYP    DTYP                                                CAS009
     C                     MOVELDFSTYP    DLST                                                CAS009
     C                     MOVELDFBRCA    BRCA                                                CAS009
      *                                                                                       CAS009
     C                     MOVELDFOSDB    ROBR                                                CAS009
     C                     MOVELDFOMDB    POBR                                                CAS009
     C                     MOVELDFRSTM    RSTM                                                CAS009
     C                     MOVELDFRONS    RONS                                                CAS009
     C                     MOVELDFRIBN    RIBN                                                CAS009
     C                     MOVELDFRIBA    RIBA                                                CAS009
     C                     MOVELDFROBN    ROBN                                                CAS009
     C                     MOVELDFROCN    ROCN                                                CAS009
     C                     MOVELDFPSTM    PSTM                                                CAS009
     C                     MOVELDFPONS    PONS                                                CAS009
     C                     MOVELDFPIBN    PIBN                                                CAS009
     C                     MOVELDFPIBA    PIBA                                                CAS009
     C                     MOVELDFPOBN    POBN                                                CAS009
     C                     MOVELDFPOCN    POCN                                                CAS009
     C                     MOVELDFRCRN    RCRN                                                CAS009
     C                     MOVELDFRCRA    RCRA                                                CAS009
     C                     MOVELDFRVNO    RVNO                                                CAS009
     C                     MOVELDFAWBN    AWBN                                                CAS009
     C                     MOVELDFAWBA    AWBA                                                CAS009
     C                     MOVELDFBENN    BENN                                                CAS009
     C                     MOVELDFBENA    BENA                                                CAS009
     C                     MOVELDFDTP1    DTP1                                                CAS009
     C                     MOVELDFDTP2    DTP2                                                CAS009
     C                     MOVELDFDTP3    DTP3                                                CAS009
     C                     MOVELDFDTP4    DTP4                                                CAS009
     C                     MOVELDFDCHG    DCHG                                                CAS009
     C                     MOVELDFBTB1    BTB1                                                CAS009
     C                     MOVELDFBTB2    BTB2                                                CAS009
     C                     MOVELDFBTB3    BTB3                                                CAS009
     C                     MOVELDFBTB4    BTB4                                                CAS009
     C                     MOVELDFBTB5    BTB5                                                CAS009
     C                     MOVELDFBTB6    BTB6                                                CAS009
     C                     MOVELDFCVMR    CVMR                                                CAS009
      *                                                                                       CAS009
     C                     MOVEL'X'       DFSWRI                                              CAS009
     C                     UPDATDLFEEDD0                                                      CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
     C/EJECT                                                                                MD057450
      *****************************************************************                     MD057450
      *                                                               *                     MD057450
      *  SRFXNT  - FX NET CHANGE                                      *                     MD057450
      *                                                               *                     MD057450
      *****************************************************************                     MD057450
     C           SRFXNT    BEGSR                                                            MD057450
      *                                                                                     MD057450
     C                     Z-ADD0         X1      20                                        MD057450
      *                                                                                     MD057450
     C********** X1        DOWLE2                                                          MD057450A
     C           X1        DOWLE3                                                          MD057450A
     C                     ADD  1         X1                                                MD057450
     C           X1        IFEQ 1                                                           MD057450
     C                     READ PRSX2                    10                                 MD057450
     C                     ENDIF                                                            MD057450
     C           X1        IFEQ 2                                                           MD057450
     C                     READ PRSX3                    10                                 MD057450
     C                     ENDIF                                                            MD057450
     C           X1        IFEQ 3                                                          MD057450A
     C                     READ PRSX1                    10                                MD057450A
     C                     ENDIF                                                           MD057450A
      *                                                                                     MD057450
     C           *IN10     DOWEQ'0'                                                         MD057450
      *                                                                                     MD057450
     C********** SETP      IFEQ 01                                                MD057450 MD057450A
     C                     Z-ADDPVDAT     MGAVDT                                            MD057450
     C                     Z-ADD0         MGASEQ                                            MD057450
      *                                                                                     MD057450
      **  If net record with a net ref get details                                          MD057450
      **  from net master file                                                              MD057450
      *                                                                                     MD057450
     C           PRCDT     IFEQ 'N'                                                         MD057450
     C                     EXSR SRRNET                                                      MD057450
     C                     ENDIF                                                            MD057450
      *                                                                                     MD057450
     C           CSW025    IFEQ 'Y'                                                         MD057450
     C           CDL002    ANDEQ'Y'                                                         MD057450
     C           PRCDT     ANDEQ'N'                                                         MD057450
     C                     EXSR CANC                                                        MD057450
     C                     ENDIF                                                            MD057450
      *                                                                                     MD057450
     C***********          ENDIF                                                  MD057450 MD057450A
      *                                                                                     MD057450
     C           X1        IFEQ 1                                                           MD057450
     C                     READ PRSX2                    10                                 MD057450
     C                     ENDIF                                                            MD057450
     C           X1        IFEQ 2                                                           MD057450
     C                     READ PRSX3                    10                                 MD057450
     C                     ENDIF                                                            MD057450
     C           X1        IFEQ 3                                                          MD057450A
     C                     READ PRSX1                    10                                MD057450A
     C                     ENDIF                                                           MD057450A
      *                                                                                     MD057450
     C                     ENDDO                                                            MD057450
      *                                                                                     MD057450
     C                     ENDDO                                                            MD057450
      *                                                                                     MD057450
     C                     ENDSR                                                            MD057450
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      **  Report database error
      *
     C                     OPEN DL6315AU
     C                     WRITEHEADER
     C                     WRITEDBERROR
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
     C/COPY WNCPYSRC,DL6315C059
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
