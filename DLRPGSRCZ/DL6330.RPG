     H        1
     F*****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL FRA/IRS rate fix and settlement conf')        *
      *****************************************************************
      *                                                               *
      *  Midas - Dealing Module                                       *
      *                                                               *
      *  DL6330 - FRA/IRS Rate Fix and Settlement Confirmations       *
      *                                                               *
      *  Function:  This new program will extract all of the details  *
      *             required for the FRA and IRS Rate Fix and         *
      *             Settlement Confirmations MT341 and MT362.         *
      *                                                               *
      *  (phase(s)) - Close of Business                               *
      *                                                               *
      *  Called By: DLC0603 - DL COB Confirmation Processing.         *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055733           Date 03Jul20               *
      *  Prev Amend No. MD054957           Date 11Dec19               *
      *                 MD051554           Date 28Sep18               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CSW216             Date 14Mar16               *
      *                 CGL165             Date 17Feb15               *
      *                 MD029694           Date 25Nov14               *
      *                 MD029258           Date 25Nov14               *
      *                 MD028991           Date 25Nov14               *
      *                 MD028335           Date 25Nov14               *
      *                 MD027782           Date 25Nov14               *
      *                 CSW214             Date 25Nov14               *
      *                 CDL096             Date 22Sep14               *
      *                 CIR018             Date 12Aug14               *
      *                 CDL094             Date 11Jun14               *
      *                 CIR017             Date 10Apr14               *
      *                 MD023278           Date 11Nov13               *
      *                 MD023529           Date 19Nov13               *
      *                 CSW213             Date 03Jun13               *
      *                 CCB020             Date 06Aug12               *
      *                 CRE073             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247544             Date 16May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 239386             Date 09Aug06               *
      *                 BUG11276 (Reopen)  Date 09May06               *
      *                 CDL049             Date 05Jul06               *
      *                 BUG11267           Date 04May06               *
      *                 CIR014             Date 11May06               *
      *                 CSD031             Date 10Apr06               *
      *                 BUG11276           Date 07Jun06               *
      *                 227642             Date 23Aug04               *
      *                 198698             Date 25Oct01               *
      *                 237296             Date 23Jan06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG11283           Date 27Apr06               *
      *                 CDL038             Date 10May05               *
      *                 BUG7873            Date 13Jul05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CAS008             Date 16Jun04               *
      *                 BUG5771            Date 14Mar05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA101             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 217684             Date 12May03               *
      *                 215724             Date 14Apr03               *
      *                 CAS004             Date 26Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSW025             Date 26Mar02               *
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      *                 195947             Date 02Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 196042             Date 20Jul01               *
      *                 195765             Date 16Jul01               *
      *                 182370             Date 11Sep00               *
      *                 195928             Date 19Jul01               *
      *                 195306             Date 07Jul01               *
      *                 CSW201             Date 02May01               *
      *                 192081             Date 10Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CIR006             Date 13Sep00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 184003             Date 02Oct00               *
      *                 181962             Date 31Oct00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSW200             Date 21Aug00               *
      *                 180466             Date 27Jun00               *
      *                 178282             Date 17Apr00               *
      *                 177329             Date 17Apr00               *
      *                 176346             Date 21Mar00               *
      *                 CIR005             Date 21Jan00               *
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 171312             Date 04Jan00               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 167426             Date 13Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSW097             Date 07Sep97               *
      *                 137909             Date 17Jul98               *
      *                 CSW005  *Create    Date 01Aug96               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  MD054957 - RBRU SP21 Compatibility Patch (Recompile)         *
      *  MD051554 - Leap Year Fix for interest calculation basis to   *
      *             be used for 1st Jan should not be present in      *
      *             FRA/IRS module                                    *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *      
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *      
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CSW216 - SWIFT Changes 2016 (Recompile)                      *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  MD029694 - Underlying product identifier in MGF341TR is      *
      *             inconsistent with the value generated on MT341    *
      *             message                                           *
      *  MD029258 - MGF341TR archive file captured 77H agreement type *
      *             value                                             *
      *  MD028991 - Field tag generated for UTI Namespace/Issuer Code *
      *  MD028335 - Amended trade repository created 2 MT341 archives *
      *             both with 'type of Last change' field = A         *
      *  MD027782 - DLC1921 fails due to lock in DEALS                *
      *  CSW214 - SWIFT Changes 2014                                  *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CIR018 - Daily Rate Change Frequency on SIRS                 *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CIR017 - SIRS Business Day Conventions for both legs         *
      *  MD023278 - Incorrect value of tags 20 and 21 in MT341        *
      *  MD023529 - DLC0603 seq 00001 failed in COB                   *
      *  CSW213 - SWIFT Changes 2013                                  *
      *  CCB020 - COB Restructure - Secondary COB Infrastracture      *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  247544 - Increase definition of W@NLP2 to match w/ ZINTDYZ2  *
      *           processing as amended by 242286.  (Recompile)       *
      *  239386 - Fixed incorrect codeword in field 22A: and 21: of   *
      *           MT341 message.                                      *
      *  BUG11276 - (Reopen) Read DEALSDC after DEALSDG               *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  BUG11267 - Back-valued IRS deals do not correctly generate   *
      *             MT362 for the current interest period.            *
      *             Partially applied due to some codes affected      *
      *             already catered by 227642.                        *
      *  CIR014 - Mark to Market Cross-currency Interest Rate Swaps   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG11276 - Read DEALSDC after DEALSDG                        *
      *           - Rename DEALSDC fields                             *
      *           - Add condition for CF deals                        *
      *  227642 - Incorrect period start and end date for MT362 for   *
      *           backvalued deal.  If event date from ECONXCY is     *
      *           equal to USLIP/TSLIP, show current period.          *
      *  198698 - MGRSCY and MGPSCY should be blank if Settlement     *
      *           Currency for deal is blank                          *
      *  237296 - Access object AOFAISR0 should not be called if FRA/ *
      *           IRS module is switched off.                         *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG11283- Ensure 34E for MT341 has correct amount            *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  BUG7873- Field 33F of MT362 shows previous principal amount  *
      *           Get the correct Principal Amount from PF/DLPCSCPD   *
      *           fix patterned after 233098 & 221972                 *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZDLINT and ZCBDYS.                   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CAS008 - IAS 39 Enhancements (Recompile)                     *
      *  BUG5771- If Short Term Rate is entered; 37G should show the  *
      *           Effective Interest Rate and 37R is 0. Otherwise,    *
      *           field 37G should show the base rate used and field  *
      *           37R should show the transaction's spread rate.      *
      *           Different values are reflected for fields 32H and   *
      *           32M due to core fix 181962. Perform subroutine      *
      *           SRCADJ only if Accrued Interest Adjustment fields   *
      *           have non-zero value. Applied 204785 & 204381        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA101 - After and Before image data structure (Z#AST        *
      *           and Z#BST) used in program is short FRA/IRS         *
      *           transaction.  (Recompile)                           *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  215724 - Incorrect period start and end date (tag 30X and    *
      *           30Q) for MT362s generated for backvalued deal.      *
      *  CAS004 - Hedge Accounting Phase A (Recompile)                *
      *  CSW025 - Midas Message Manager                               *
      *           - Pass original change type                         *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  195947 - Chain to PF/ECONXCY should only be done if corres-  *
      *           ponding effective interest rate UEINR (OUR) or      *
      *           TEINR (THEIR) is not equal to the base rate. There  *
      *           should be no Pay/Receive message for a break-even   *
      *           deal.                                               *
      *  196042 - If change type is amend and event type 1 is         *
      *           FB; or FT/FU and other side is fixed, then          *
      *           perform netting.                                    *
      *  195765 - Error on DLC1921 when clearing MGX36NPD.  Should    *
      *           generate MT362 even when previous msgs already dltd *
      *  182370 - Incorrect calculation of number of days for calcu-  *
      *           lation basis 6. Amended /COPY such that for calcu-  *
      *           lation basis 6, the number of days per year is      *
      *           equal to 366 when the year in question is a leap    *
      *           year, and 365 days/year for non-leap years. Calcu-  *
      *           lation was made so that processing would be in-line *
      *           with that of /COPY ZINTDY.                          *
      *  195928 - Fixing for initial period for MT362 should only be  *
      *           done if value date is equal or greater than rundate *
      *  195306 - Wrong available date in MT362s.                     *
      *  CSW201 - SWIFT 2001 Standards Update                         *
      *  192081 - Database error in DLPCSCPD and MGF341PD, at 035.    *
      *  CIR006 - Amortisation of Caps/Collars/Floors and Individual  *
      *           Compounding Swaps.                                  *
      *  184003 - 30Q should contain the earlier date between the     *
      *           unadjusted rate change date (base date) and the     *
      *           adjusted rate change date when interest is          *
      *           calculated to the actual unadjusted interest payment*
      *           date                                                *
      *  181962 - Include any interest adjustments on interest        *
      *           amounts reported in  Sequences C or E.              *
      *  CDL008 - Continuous Linked Settlement (Recompiled)           *
      *  CSW200 - Swift 2000 Changes                                  *
     F*           Now only create MT341 for FRA deals with agreement  *
     F*           types of 'ISDA','FRABBA','AFB' or 'DERV' and not    *
     F*           create MT362 for any FRA deals.                     *
     F*           Note if CSW005 is on, then both subroutines SRFRA   *
     F*           and SRIRS could be called. If CSW011 is on ( and so *
     F*           CSW005 is off), the ISDA fields are not available   *
     F*           unless Swift 2000 is on. So as the ISDA Agreement   *
     F*           type is blanks, only subroutine SRFRA can be called *
     F*           When CSW011 and CSW200 are on, only SRFRA can be    *
     F*           called.                                             *
      *  180466 - Change in program DLZFRQ. Additional parameter      *
      *           ZFRZBD inserted for DLZFRQ.                         *
      *  178282 - On Seq E and C, output only payment dates           *
      *           between the rate fixing period, excluding any       *
      *           payment dates that have already been reported       *
      *           on the previous MT362s.                             *
      *  177329 - Field MGTCCY overwritten for RX deal.               *
      *           Part of fix 177312 wrongly positioned.              *
      *  176346 - For RS and RX, if TNICD is 0 assume that            *
      *  CIR005 - FRA/IRS Business Day Conventions                    *
      *  CIR004 - Dealing Calculation Method Change (Recompiled for   *
      *           change in ZCBDYSZ1)                                 *
     F*  171312 - CSW097/CSW005 related fixes                         *
     F*           1. Remove changes made by 167426.                   *
     F*              and do not fill in settlement ccy fields if      *
     F*              balnk from DEALSDG.                              *
     F*           2. Put MGY36NPD and MGX36NPD in commitment control  *
     F*           3. Enhanced conditions to output information        *
     F*              on first rate fix period.                        *
     F*           4. Do not output Sequences C and E if that side     *
     F*              is floating but not fixed (RXs only)             *
     F*           5. Put CSW011 and CSW005 files in user control      *
     F*              to avoid DLC0603 from falling over.              *
     F*           6. FR for MT360s should put out seq C or E accdg    *
     F*              to amount being receivable or payable.           *
      *  167426 - Reverse parameter mismatch caused by fix CSW097     *
      *  CSW097 - MT34*, MT36* Message Generation for IRA/IRS.        *
      *  137909 - New settlement currency fields added to confirmation*
      *           messages. Only use if CEU003 is on.                 *
      *  CSW005 - MG34n and MG36n Message Generation.                 *
      *                                                               *
      *****************************************************************
     FECONXCY IF  E           K        DISK
     FDEALS   UF  E           K        DISK
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F**********  DEALSDCF                          KIGNORE                                 BUG11276
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F                                              KCOMIT
     FECONXCL0IF  E           K        DISK
     F            CONEXCYF                          KRENAMEECONLF0F
     FDLDTSCPDIF  E           K        DISK                           UC
     FDLPCSCPDIF  E           K        DISK                           UC
     FDLOLCFL1UF  E           K        DISK                           UC  CSW097
     FDLOLACPDIF  E           K        DISK                           UC  CSW097
     F***MGX36NPDO***E        K        DISK                        CSW097 171312
     F***MGY36NL0UF**E        K        DISK                      A CSW097 171312
     FMGX36NPDO   E           K        DISK         KCOMIT            UC  171312
     FMGY36NL0UF  E           K        DISK         KCOMIT       A    UC  171312
     F***MGF341PDO***E                 DISK                               171312
     FMGF341PDO   E                    DISK                           UC  171312
     F                                              KCOMIT
     F***MGF362PDO***E                 DISK                               171312
     FMGF362PDO   E                    DISK                           UC  171312
     F                                              KCOMIT
     FDLDEALL5IF  E           K        DISK                           UC                      CIR014
     F            DLDLDBD0                          KIGNORE                                   CIR014
     F            DLDLDCD0                          KIGNORE                                   CIR014
     FDLRPIFL1IF  E           K        DISK                                                   CSW213
     FMGHISTL5IF  E           K        DISK                                                 MD023278
     FDL6330AUO   E                    PRINTER                        UC
     F/COPY WNCPYSRC,DL6330F001
      *
      /TITLE FUNCTION OF INDICATORS
      *****************************************************************
      *                                                               *
      *  F U N C T I O N    O F   I N D I C A T O R S                 *
      *                                                               *
      *   10      EOF in PF/ECONXCY.                                  *
      *   11      EOF in LF/DEALS.                                    *
      *   30      Process message event type indicator.               *
      *   31      MT341 or MT362 not to be generated.                 *
      *   32      MT3** not to be generated.                          *
      *   33      MT34* or MT36* not to be generated.                 *
      *   70      EOF in LF/ECONXCL0.                                 *
      *   71      EOF in DLDTSCPD and DLPCSCPD.                       *
      *   97      Error in calling RPG/MG9220.                        *
      *   98      Midas date format indicator.                        *
      *   U7      Database error                                      *
      *   U8      Databse error                                       *
      *   LR      Exit program                                        *
      *****************************************************************
      /EJECT
      /TITLE SUBROUTINE INDEX
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Initial Processing.                                 *
      *  SRDLDG - Access deals record.                                *
      *  SRCLIR - Initialise fields of PF/MGF341PD and                *
      *              PF/MGF362PD.                                     *
      *  SRCOMM - Set up common output fields.                        *
      *  SRFRA  - Process record for FRA.                             *
      *  SRIRS  - Determine processing type for IRS.                  *
      ***SRIRUS*-*Process*settlement*record*for*IRS*-*Our*side.********   CSW097
      ***SRIRTS*-*Process*settlement*record*for*IRS*-*Their*side.******   CSW097
      *  SRIRUF - Process rate fix record for IRS - Our side.         *
      *  SRIRTF - Process rate fix record for IRS - Their side.       *
      *  SRCOMF - Common Routine - Set Up Rate Fixing Details.        *
      *  SRCOMO - Output common GDF fields.                           *
      *  SRFRAO - Output to PF/MGF341PD.                              *
      ***SRIROS*-*Output*to*PF/MGF362PD*for*Settlement.****************   CSW097
      *  SRIROF - Output to PF/MGF362PD for Rate Fix.                 *
      *  SRDGUP - Update deals record.                                *
      *  SRCURR - Access SDCURRPD.                                    *
      *  SRDEST - Access SDCUSTPD for Destination customer details.   *
      *  SRECON - Access ECONXCL0.                                    *
      *  SRINIW - Initialise workfields.                              *
      *  SRSTCY - Set up settlement currency for MT341.               *   137909
      *  SRVALD - Check if allowed to generate message type.          *
      *  SREND  - Final routines before ending program.               *
      *  ZDLINT - Standard Subroutine to Calculate the Interest       *
      *           Accruing between two Dates. (Dealing version).      *
      *  ZCBDYS - Standard Subroutine to Calculate the Number of Days *
      *           between two Dates and the Number of Days in Year,   *
      *           for a Calculation Basis, (Dealing version).         *
      *  ZDATE2 - To convert a day number to date formats.            *
      *  *PSSR  - Error handling                                      *
      *                                                               *
      *****************************************************************
      /EJECT
      *
     E                    CPY@    1   1 80
     E                    ZF29   14  32  5 0
     E/COPY ZSRSRC,ZDATE2Z1
      *
      **  Array of text to format MG34n and MG36n messages
      *
     E***********         DCF     1  06 20                                          CSW097
      *
      **  Array of message types not generated for customer.
      *
     E                    NGN        15  3
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZFRQB2Z1                                               CIR005
     E/COPY ZSRSRC,ZDATE9Z1                                               182370
     E                    TSTAM   1   1 26                                                    CSW213
      *
      /EJECT
      *
     I/SPACE 3
      *
      **  Rename conflicting ECONXCY fields.
      *
     ICONEXCYF
     I              RECI                            CRECI
     I              RCDT                            CRCDT
     I              DLNO                            CDLNO
     I              VDAT                            CVDAT
     I              BRCA                            CBRCA
     I              CHTP                            CCHTP
      *
      **  Rename conflicting DEALS fields
      *
     IDEALSDGF
     I              RECI                            DRECI
     I              DLNO                            DDLNO
     I              RCDT                            DRCDT
     I              VDAT                            DVDAT
     I              BRCA                            DBRCA
     I              SETF                            DSETF
      *
     I***DEALSDCF                                                                  BUG11276 BUG11276
     I**********    RECI                            DCRECI                         BUG11276 BUG11276
      *                                                                                     BUG11276
      **  Rename ECONXCL0 fields.
      *
     IECONLF0F
     I              RECI                            ERECI
     I              RCDT                            ERCDT
     I              DLNO                            EDLNO
     I              VDAT                            EVDAT
     I              DASN                            EDASN
     I              CNRQ                            ECNRQ
     I              INTA                            EINTA
     I              MGEN                            EMGEN
     I              BRCA                            EBRCA
     I              INTO                            EINTO
     I              UFIR                            EUFIR
     I              TFIR                            ETFIR
     I              CHTP                            ECHTP
      *
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     I            DS
     I                                        1   20DD
     I                                        3   40MM
     I                                        5   60YY
     I                                        1   60ZDATE
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM ##PGM
     I                                      244 253 WSID
     I                                      254 263 USER
      *
      ** Data structure for FRA Confirmation GDF
      *
     I***MDS341*     DS                                                                       CSW214
     I**********                              1   3 MGBRCA                                    CSW214
     I**********                              4   90MGCNUM                                    CSD027
     I**********                              4   9 MGCNUM                             CSD027 CSW214
     I**********                             10  11 MGMODI                                    CSW214
     I**********                             12  26 MGTNUM                                    CSW214
     I**********                             27  42 MGRREF                                    CSW214
     I**********                          P  43  450MGTDAT                                    CSW214
     I**********                          P  46  480MGFDAT                                    CSW214
     I**********                          P  49  510MGMDAT                                    CSW214
     I**********                             52  54 MGCCY                                     CSW214
     I**********                          P  55  610MGNOAM                                    CSW214
     I**********                             62  62 MGBORS                                    CSW214
     I**********                          P  63  650MGSDAT                                    CSW214
     I**********                          P  66  720MGSAMT                                    CSW214
     I**********                             73  73 MGPORR                                    CSW214
     I**********                          P  74  797MGCRAT                                    CSW214
     I**********                          P  80  857MGSRAT                                    CSW214
     I**********                             86  890MGCPER                                    CSW214
     I**********                             90 124 MGCON1                                    CSW214
     I**********                            125 159 MGCON2                                    CSW214
     I**********                            160 194 MGCON3                                    CSW214
     I**********                            195 229 MGCON4                                    CSW214
     I**********                            230 264 MGCON5                                    CSW214
     I**********                            265 299 MGCON6                                    CSW214
     I**********                            300 334 MGS2R1                                    CSW214
     I**********                            335 369 MGS2R2                                    CSW214
     I**********                            370 404 MGS2R3                                    CSW214
     I**********                            405 439 MGS2R4                                    CSW214
     I**********                            440 474 MGS2R5                                    CSW214
     I**********                            475 509 MGS2R6                                    CSW214
     I**********                            510 521 MGPONS                                    CGL029
     I**********                            510 521 QQPONS                             CGL029 CSW214
     I**********                            522 529 MGRVNO                                    CSW214
     I**********                            530 537 MGPIBN                                    CSW214
     I**********                            538 572 MGPIBA                                    CSW214
     I**********                            573 580 MGAWBN                                    CSW214
     I**********                            581 615 MGAWBA                                    CSW214
     I**********                            616 627 MGRONS                                    CGL029
     I**********                            616 627 QQRONS                             CGL029 CSW214
     I**********                            628 635 MGRIBN                                    CSW214
     I**********                            636 670 MGRIBA                                    CSW214
     I**********                            671 678 MGBENN                                    CSW214
     I**********                            679 713 MGBENA                                    CSW214
     I**********                            714 717 MGBRKC                                    CSW214
     I**********                            718 719 MGTTYP                                    CSW214
     I**********                            720 721 MGTSTP                                    CSW214
     I**********                            722 724 MGPOBR                                    CSW214
     I**********                            725 726 MGEVTP                                    CSW214
     I**********                            727 727 MGCHTP                                    CSW214
     I**********                            728 730 MGROBR                                    CSW214
     I**********                            731 7320MGPSTM                                    CSW214
     I**********                            733 7340MGRSTM                                    CSW214
     I**********                            744 761 MGPONS                             CGL029 CSW214
     I**********                            762 779 MGRONS                             CGL029 CSW214
      *                                                                                       CSW213
      ***SWIFT*2013*added*fields***                                                    CSW213 CSW214
      *                                                                                       CSW213
     I**********                            780 783 MGAPID                             CSW213 CSW214
     I**********                            784 799 MGTRRF                             CSW213 CSW214
     I**********                            800 815 MGLNRF                             CSW213 CSW214
     I**********                            816 821 MGCPID                             CSW213 CSW214
     I**********                            822 823 MGDTYP                             CSW213 CSW214
     I**********                            824 825 MGDLST                             CSW213 CSW214
     I**********                            826 831 MGTRID                             CSW213 CSW214
     I**********                            832 837 MGCCPI                             CSW213 CSW214
     I**********                            838 871 MGCCPA                             CSW213 CSW214
     I**********                            872 877 MGCEPI                             CSW213 CSW214
     I**********                            878 911 MGCEPA                             CSW213 CSW214
     I**********                            912 946 MGCBCI                             CSW213 CSW214
     I**********                            947 981 MGCBPI                             CSW213 CSW214
     I**********                            9821016 MGPRID                             CSW213 CSW214
     I**********                           10171051 MGEXVE                             CSW213 CSW214
     I**********                           10521057 MGUPID                             CSW213 CSW214
     I**********                           10581092 MGRJ01                             CSW213 CSW214
     I**********                           10931127 MGRJ02                             CSW213 CSW214
     I**********                           11281162 MGRJ03                             CSW213 CSW214
     I**********                           11631197 MGRJ04                             CSW213 CSW214
     I**********                           11981203 MGRP01                             CSW213 CSW214
     I**********                           12041209 MGRP02                             CSW213 CSW214
     I**********                           12101215 MGRP03                             CSW213 CSW214
     I**********                           12161221 MGRP04                             CSW213 CSW214
     I**********                           12221255 MGRA01                             CSW213 CSW214
     I**********                           12561289 MGRA02                             CSW213 CSW214
     I**********                           12901323 MGRA03                             CSW213 CSW214
     I**********                           13241357 MGRA04                             CSW213 CSW214
     I**********                           13581377 MGRN01                             CSW213 CSW214
     I**********                           13781397 MGRN02                             CSW213 CSW214
     I**********                           13981417 MGRN03                             CSW213 CSW214
     I**********                           14181437 MGRN04                             CSW213 CSW214
     I**********                           14381447 MGRC01                             CSW213 CSW214
     I**********                           14481457 MGRC02                             CSW213 CSW214
     I**********                           14581467 MGRC03                             CSW213 CSW214
     I**********                           14681477 MGRC04                             CSW213 CSW214
     I**********                           14781488 MGRS01                             CSW213 CSW214
     I**********                           14891499 MGRS02                             CSW213 CSW214
     I**********                           15001510 MGRS03                             CSW213 CSW214
     I**********                           15111521 MGRS04                             CSW213 CSW214
     I**********                           15221541 MGRL01                             CSW213 CSW214
     I**********                           15421561 MGRL02                             CSW213 CSW214
     I**********                           15621581 MGRL03                             CSW213 CSW214
     I**********                           15821601 MGRL04                             CSW213 CSW214
     I**********                           16021611 MGUT01                             CSW213 CSW214
     I**********                           16121621 MGUT02                             CSW213 CSW214
     I**********                           16221631 MGUT03                             CSW213 CSW214
     I**********                           16321641 MGUT04                             CSW213 CSW214
     I**********                           16421673 MGTN01                             CSW213 CSW214
     I**********                           16741705 MGTN02                             CSW213 CSW214
     I**********                           17061737 MGTN03                             CSW213 CSW214
     I**********                           17381769 MGTN04                             CSW213 CSW214
     I**********                           17701770 MGTI01                             CSW213 CSW214
     I**********                           17711771 MGTI02                             CSW213 CSW214
     I**********                           17721772 MGTI03                             CSW213 CSW214
     I**********                           17731773 MGTI04                             CSW213 CSW214
     I**********                           17741774 MGET01                             CSW213 CSW214
     I**********                           17751775 MGET02                             CSW213 CSW214
     I**********                           17761776 MGET03                             CSW213 CSW214
     I**********                           17771777 MGET04                             CSW213 CSW214
     I**********                           17781778 MGCGTI                             CSW213 CSW214
     I**********                           17791779 MGALLI                             CSW213 CSW214
     I**********                           17801780 MGCLLI                             CSW213 CSW214
     I**********                           17811781 MGNORS                             CSW213 CSW214
     I**********                           178217890MGGEDT                             CSW213 CSW214
     I**********                           179017950MGGETM                             CSW213 CSW214
     I**********                           17961796 MGUSGN                             CSW213 CSW214
     I**********                           179718000MGUTCT                             CSW213 CSW214
     I**********                           18011842 MGLSID                             CSW213 CSW214
     I**********                           18431877 MGAR01                             CSW213 CSW214
     I**********                           18781912 MGAR02                             CSW213 CSW214
     I**********                           19131947 MGAR03                             CSW213 CSW214
     I**********                           19481982 MGAR04                             CSW213 CSW214
     I**********                           19832017 MGAR05                             CSW213 CSW214
     I**********                           20182052 MGAR06                             CSW213 CSW214
     I**********                           20532087 MGAR07                             CSW213 CSW214
     I**********                           20882122 MGAR08                             CSW213 CSW214
     I**********                           21232157 MGAR09                             CSW213 CSW214
     I**********                           21582192 MGAR10                             CSW213 CSW214
     I**********                           21932227 MGAR11                             CSW213 CSW214
     I**********                           22282262 MGAR12                             CSW213 CSW214
     I**********                           22632297 MGAR13                             CSW213 CSW214
     I**********                           22982332 MGAR14                             CSW213 CSW214
     I**********                           23332367 MGAR15                             CSW213 CSW214
     I**********                           23682402 MGAR16                             CSW213 CSW214
     I**********                           24032437 MGAR17                             CSW213 CSW214
     I**********                           24382472 MGAR18                             CSW213 CSW214
     I**********                           24732507 MGAR19                             CSW213 CSW214
     I**********                           25082542 MGAR20                             CSW213 CSW214
     I**********                           25432562 MGFOID                             CSW213 CSW214
     I**********                           25632582 MGAFOI                             CSW213 CSW214
     I**********                           25832583 MGCFRQ                             CSW213 CSW214
     I**********                           25842584 MGCFGN                             CSW213 CSW214
     I**********                           258525870MGCFNR                             CSW213 CSW214
     I**********                           25882593 MGPRED                             CSW213 CSW214
     I**********                           25942596 MGBCCY                             CSW213 CSW214
     I**********                           25972597 MGBPMI                             CSW213 CSW214
     I**********                           25982600 MGSCCY                             CSW213 CSW214
     I**********                           26012601 MGSPMI                             CSW213 CSW214
     I**********                           260226060MGLCD                              CSW213 CSW214
     I**********                           26072632 MGTMST                             CSW213 CSW214
     I**********                           26332633 MGACMI                             CSW213 CSW214
     I**********                           26342639 MGPTYA                             CSW213 CSW214
     IMDS341    E DSMGF341PD                                                                  CSW214
     I              MGSTCY                          XXSTCY                                    CSW214
     I              MGAGTY                          XXAGTY                                    CSW214
      *
      **  Data structure for IRS Reset GDF - common fields are already
      **  defined in DS/MDS341 above.
      *
     IMDS362      DS
     I                                    P   1   30MGTSDT
     I                                    P   4   60MGAVDT
     I                                        7   9 MGTCCY
     I                                    P  10  160MGTPCL
     I***************************************17  23 MGTDCF                CSW097
     I                                    P  24  260MGTCRD
     I                                    P  27  290MGTNRD
     I                                    P  30  357MGTBAR
     I                                    P  36  417MGTSPR
     I                                    P  42  477MGTTTR
     I                                    P  48  540MGTPIA
     I                                    P  55  610MGTPAM
     I                                    P  62  640MGTPDT
     I************************************P  65  710MGTIAM                CSW097
     I                                       72  74 MGOCCY
     I                                    P  75  810MGOPCL
     I***************************************82  88 MGODCF                CSW097
     I                                    P  89  910MGOCRD
     I                                    P  92  940MGONRD
     I                                    P  95 1007MGOBAR
     I                                    P 101 1067MGOSPR
     I                                    P 107 1127MGOTTR
     I                                    P 113 1190MGOPIA
     I                                    P 120 1260MGOPAM
     I                                    P 127 1290MGOPDT
     I************************************P 130 1360MGOIAM                CSW097
      *                                                                   CIR005
     IWCCYD2      DS                                                      CIR005
     I                                        1   3 WCYP1                 CIR005
     I                                        4   6 WCYP2                 CIR005
     I                                        7   9 WCYP3                 CIR005
     I                                       10  12 WCYP4                 CIR005
     I                                       13  15 WCYP5                 CIR005
     I                                       16  18 WCYP6                 CIR005
     I                                       19  21 WCYP7                 CIR005
     I                                       22  24 WCYP8                 CIR005
     I                                       25  27 WCYP9                 CIR005
     I                                       28  30 WCYP0                 CIR005
      *
     ISDBANK    E DSSDBANKPD
      *
      ** SD Bank Details
      *
     ISDBSRT    E DSSDBSRTPD                                                                  195947
      *                                                                                       195947
      ** SD Base Rate Details                                                                 195947
      *                                                                                       195947
     ISDCURR    E DSSDCURRPD
      *
      ** SD Currency Code Details
      *
     ISDCUST    E DSSDCUSTPD
      *
      ** SD Customer Details
      *
     ISDGELR    E DSSDGELRPD
      *
      ** SD General Ledger Details
      *
     ISDMMOD    E DSSDMMODPD                                                                  237296
      *                                                                                       237296
      ** Data structure for MIDAS modules                                                     237296
      *                                                                                       237296
     ISCSARD    E DSSCSARDPD
      *
      ** SC Switchable Features Details
      *
     ISDFAIS    E DSSDFAISPD
      **  Data structure for FRAIRS ICD details
      *
     ISDTRAD    E DSSDTRADPD
      **  Data structure for Trading details
      *
     I              QQACCD                          QQACC1                                    CGL029
     IDSFDY     E DSDSFDY
      *
      ** Short Data Structure
      *
     IDSSDY     E DSDSSDY
      *
      ** Long Data Structure
      *
     ISDDEAL    E DSSDDEALPD                                              CSW097
     I              QQACCD                          QQACC2                                    CGL029
     IIRDEAL    E DSDEALSDG                                               CSW097
     I              LCD                             ILCD
     I                                     20972126 WCCYD1                CIR005
     IZ#ASTS    E DSZ#AST                                                 CSW097
     I***********   'DEFGHJ'              C         CNRQFI                CSW097
     I              'DFH'                 C         CNRQFI                CSW097
     I@IRCK2      DS                                                      CSW097
     I                                        1   6 @K2DL                 CSW097
     I                                        7   7 @K2OT                 CSW097
     I                                        8   8 @K2RC                 CSW097
     I                                        9  13 @K2PR                 CSW097
      *
      **  CNRQ values for FRA/IRS.
      *
     I/COPY ZSRSRC,ZHOLI
      *                                                                   182370
      ** Data structure for subroutine ZCBDYS                             182370
     I            DS                                                      182370
     I                                        1   80ZZDAT1                182370
     I                                        1   40ZZYYA                 182370
     I                                        5   60ZZMMA                 182370
     I                                        7   80ZZDDA                 182370
      *                                                                   182370
     I            DS                                                      182370
     I                                        1   80ZZDAT2                182370
     I                                        1   40ZZYYB                 182370
     I                                        5   60ZZMMB                 182370
     I                                        7   80ZZDDB                 182370
      *                                                                   182370
     I/COPY ZSRSRC,ZDATE9Z2                                               182370
     I/COPY ZSRSRC,ZDAT10Z1                                               182370
      *                                                                                       239386
      ** Data Structure for MPHAS                                                             239386
      *                                                                                       239386
     I*MPHAS****   DS                              1                                   239386 CCB020
     I**********                              1   1 WPHAS                              239386 CCB020
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      /EJECT
      /TITLE Main Processing
      *****************************************************************
      * P R O G R A M    S T A R T
      *****************************************************************
      *
      **  Perform initial process
      *
     C                     EXSR SRINIT
      *
      **  Read first confirmation extract record
      *
     C                     READ ECONXCY                  10
      *
     C           *IN10     DOWEQ'0'
      *
      **  Process only records for FRA/IRS.  OKS will be greater
      **  than zero if not valid.
      *
     C                     MOVE 'N'       NXTREC  1
     C           CNRQFI    CHECKCNRQ      OKS     10
      *
     C           OKS       IFEQ *ZERO
      *
      ****Check*for*money*market*deals*********************************            BUG11276 BUG11276
      ****Bypass*processing*if*deal*found*in*DEALSDC*******************            BUG11276 BUG11276
      *                                                                            BUG11276 BUG11276
     C********** CDL033    IFEQ 'Y'                                                BUG11276 BUG11276
      *                                                                            BUG11276 BUG11276
     C********** CDLNO     CHAINDEALSDCF             12                            BUG11276 BUG11276
     C********** *IN12     IFEQ '1'                                                BUG11276 BUG11276
     C********** DRECI     ORNE 'D'                                                BUG11276 BUG11276
     C********** DRECI     ANDNE'R'                                                BUG11276 BUG11276
     C********** DCRECI    ORNE 'D'                                                BUG11276 BUG11276
     C********** DCRECI    ANDNE'R'                                                BUG11276 BUG11276
     C********** *LOCK     IN   LDA                                                BUG11276 BUG11276
     C**********           Z-ADD007       DBASE            * * * * * * * *         BUG11276 BUG11276
     C**********           MOVELCDLNO     DBKEY     P      * DB ERROR 07 *         BUG11276 BUG11276
     C**********           MOVEL'DEALS'   DBFILE    P      * * * * * * * *         BUG11276 BUG11276
     C**********           OUT  LDA                                                BUG11276 BUG11276
     C**********           EXSR *PSSR                                              BUG11276 BUG11276
     C**********           ENDIF                                                   BUG11276 BUG11276
     C**********           ELSE                                                    BUG11276 BUG11276
      *                                                                            BUG11276 BUG11276
      **  Access deal details, initialise status fields and save deal no.
      *
     C                     EXSR SRDLDG
      *                                                                                     BUG11276
      **  Continue processing if deal found in DEALSDG                                      BUG11276
      *                                                                                     BUG11276
     C           *IN11     IFEQ '0'                                                         BUG11276
     C                     MOVE CHTP      @CHG    1                                           CSW025
      *                                                                                       CSW213
     C********** RPTI      IFEQ 'Y'                                                  CSW213 MD023278
      *                                                                                       CSW213
     C**********           MOVE CNUM      MGTRID                                     CSW213 MD023278
     C**********           MOVE 'Y'       MGACMI                                     CSW213 MD023278
     C**********           MOVE CNUM      MGPTYA                                     CSW213 MD023278
      *                                                                                       CSW213
     C                     MOVELDTYP      KDTYP   2                                         MD023278
     C                     MOVELDDLNO     KLDLNO 16                                         MD023278
     C           RPIFKY    CHAINDLRPIFL1             13                                     MD023278
      *                                                                                     MD023278
     C           *IN13     IFEQ '0'                                                         MD023278
     C           RPTI      ANDEQ'Y'                                                         MD023278
      *                                                                                     MD023278
     C           WPRID     IFEQ 'N'                                                         MD023278
     C                     MOVE RITRID    CNUM                                              MD023278
     C                     ENDIF                                                            MD023278
     C                     ENDIF                                                            MD023278
     C**********           ENDIF                                                     CSW213 MD023278
      *
      **  Access Destination customer details and determine if message
      **  to be generated.
      *
     C                     EXSR SRDEST
     C                     EXSR SRVALD
      *
     C           MVALD     IFEQ '000'
      *
      **  Initialise status fields and save deal no.
      *
     C                     MOVE 'N'       UPDDLG  1
     C                     MOVE '0'       OURSET  1
     C                     Z-ADD*ZEROS    OURIAM 130
     C                     MOVE '0'       THRSET  1
     C                     Z-ADD*ZEROS    THRIAM 130
     C                     Z-ADDCDLNO     SVDLNO  60
     C                     MOVE RPTI      SVRPTI  1                                         MD023278
      *
      **  Process each records with the same deal number.
      *
     C           *IN10     DOWEQ'0'
     C           CDLNO     ANDEQSVDLNO
     C           RPTI      ANDEQSVRPTI                                                      MD023278
      *                                                                   CSW097
     C           OKS       IFEQ *ZERO                                     CSW097
      *
      **  Clear generation driver file fields.
      *
     C                     EXSR SRCLIR
      *                                                                                       CSW213
     C           RPTI      IFEQ 'Y'                                                           CSW213
      *                                                                                       CSW213
     C                     MOVE CNUM      MGTRID                                              CSW213
     C                     MOVE 'Y'       MGACMI                                              CSW213
     C                     MOVE CNUM      MGPTYA                                              CSW213
      *                                                                                       CSW213
     C                     ENDIF                                                              CSW213
      *
      **  Set up common output fields.
      *
     C                     EXSR SRCOMM
      *
      **  Process according to deal type.
      *
     C***********DTYP      CASEQ'FR'      SRFRA                           CSW097
     C***********DTYP      CASEQ'RS'      SRIRS                           CSW097
     C***********DTYP      CASEQ'RX'      SRIRS                           CSW097
     C***********          ENDCS                                          CSW097
      *                                                                   CSW097
      ***Generate*an*MT341*message*for*an*"FR"*deal*that*is*NOT*****CSW097CSW200
      ***covered*by*either*an*"ISDA"*or*"AFB"*Master Agreement.*****CSW097CSW200
      *                                                                   CSW200
      ** Generate an MT341 message for any "FR" deal                      CSW200
      *                                                                   CSW200
     C           DTYP      IFEQ 'FR'                                      CSW097
     C           AGTY      ANDNE'ISDA'                                    CSW097
     C           AGTY      ANDNE'AFB'                                     CSW097
     C           CSW200    ANDEQ'N'                                       CSW200
     C           DTYP      OREQ 'FR'                                      CSW200
     C           CSW200    ANDEQ'Y'                                       CSW200
     C                     EXSR SRFRA                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ***Generate*an*MT362*message*for*an*"FR"*deal*that*is********       CSW097 CSW200
      ***covered*by*either*an*"ISDA"*or*"AFB"*Master Agreement.****       CSW097 CSW200
      *                                                                   CSW200
      ** Not generate MT362 for FRA deals (SWIFT 2000 Changes)            CSW200
     C           DTYP      IFEQ 'FR'                                      CSW097
     C           AGTY      ANDEQ'ISDA'                                    CSW097
     C           CSW200    ANDEQ'N'                                       CSW200
     C           DTYP      OREQ 'FR'                                      CSW097
     C           AGTY      ANDEQ'AFB'                                     CSW097
     C           CSW200    ANDEQ'N'                                       CSW200
     C                     EXSR SRIRS                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Generate an MT362 message for "RS" and "RX" deals                CSW097
     C           DTYP      IFEQ 'RS'                                      CSW097
     C           DTYP      OREQ 'RX'                                      CSW097
     C                     EXSR SRIRS                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                                     MD023278
     C           RPTI      IFEQ 'Y'                                                         MD023278
     C           RIPRED    ANDNE*BLANKS                                                     MD023278
     C           WPRID     ANDEQ'N'                                                         MD023278
      *                                                                                     MD023278
     C                     MOVE RIPRED    CNUM                                              MD023278
     C                     EXSR SRDEST                                                      MD023278
     C                     EXSR SRVALD                                                      MD023278
     C           MVALD     IFEQ '000'                                                       MD023278
     C                     MOVE 'R'       CHTP                                              MD023278
     C                     MOVELCDLNO     WDLNO   6                                         MD023278
     C                     MOVE 'C'       RICHTP                                            MD028335
     C           HSTKEY    KLIST                                                            MD023278
     C                     KFLD           WDLNO                                             MD023278
     C                     KFLD           RIPRED                                            MD023278
     C                     KFLD           SEQ     3                                         MD023278
     C                     MOVEL'999'     SEQ                                               MD023278
     C           HSTKEY    SETLLMGHISTL5                                                    MD023278
     C                     READPMGHISTL5                 14                                 MD023278
     C           *IN14     IFEQ '0'                                                         MD023278
     C                     MOVELHSSEQ     RICFNR                                            MD023278
     C                     ENDIF                                                            MD023278
     C                     MOVE 'Y'       WPRID                                             MD023278
     C                     ITER                                                             MD023278
     C                     ENDIF                                                            MD023278
     C                     ENDIF                                                            MD023278
      *
      **  Process next record.
      *
     C                     READ ECONXCY                  10
     C                     MOVE 'Y'       NXTREC
     C                     MOVE 'N'       WPRID                                             MD023278
      *                                                                   CSW097
     C           CNRQFI    CHECKCNRQ      OKS     10                      CSW097
      *
     C                     ENDDO
      *
      **  Update Deal details.
      *
     C           UPDDLG    IFEQ 'Y'
     C                     EXSR SRDGUP
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF                                                            BUG11276
     C                     ENDIF
      *
      **  Read next record if not yet read.
      *
     C           NXTREC    IFEQ 'N'
     C                     READ ECONXCY                  10
     C                     ENDIF
      *
     C                     ENDDO
      *
      **  Final routines.
      *
     C                     EXSR SREND
      *
      **  Terminate program.
      *
     C                     MOVE '1'       *INLR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRINIT - Initial Processing.                              *
      *                                                               *
      *  Called by: Main Processing Routine                           *
      *                                                               *
      *  Calls: RPG/AOBANKR0 - Access object for SDBANKPD             *
      *         RPG/AOGELRR0 - Access object for SDGELRPD             *
      *         RPG/AOSARDR0 - Access object for SCSARDPD             *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
     C                     MOVEACPY@      MKI@   80
      *
      **  Set up LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'DL6330'  DBPGM
     C                     MOVE *BLANKS   DBASE
     C                     OUT  LDA
      *
      **  Access SDBANKPD for report title.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD001       DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY     P      * DB ERROR 01 *
     C                     MOVEL'SDBANKPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Set Date Format Indicator.
      *
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     ENDIF
      *
      **  Access SDGELRPD.
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD002       DBASE            * * * * * * * *
     C                     MOVEL'FIRST'   DBKEY     P      * DB ERROR 02 *
     C                     MOVEL'SDGELRPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       237296
      ** Access MIDAS modules file                                                            237296
      *                                                                                       237296
     C                     CALL 'AOMMODR0'                                                    237296
     C                     PARM '*MSG '   @RTCD   7                                           237296
     C                     PARM '*FIRST ' @OPTN   7                                           237296
     C           SDMMOD    PARM SDMMOD    DSFDY                                               237296
      *                                                                                       237296
     C           @RTCD     IFNE *BLANKS                                                       237296
     C           *LOCK     IN   LDA                                                           237296
     C                     MOVE '012'     DBASE            * * * * * * * *                    237296
     C                     MOVEL'CONFS'   DBKEY            * DB ERROR 12 *                    237296
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * * *                    237296
     C                     OUT  LDA                                                           237296
     C                     EXSR *PSSR                                                         237296
     C                     ENDIF                                                              237296
      *
      ** Call Access Program for FRA/IRS I.C.D. details
      *
     C           BGFIIN    IFEQ 'Y'                                                           237296
     C                     CALL 'AOFAISR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDFAIS    PARM SDFAIS    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '003'     DBASE            * * * * * * * *
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 03 *
     C                     MOVEL'SDFAISPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       237296
     C                     ENDIF                                                              237296
      *
      ** Call Access Program for Trading details
      *
     C                     CALL 'AOTRADR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDTRAD    PARM SDTRAD    DSFDY
     C*
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE '004'     DBASE            * * * * * * * *
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 04 *
     C                     MOVEL'SDTRADPD'DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   CSW097
      * Call Access prog. for Tax rate.                                   CSW097
      *                                                                   CSW097
     C**********           CALL 'AODEALR0'                                CSW097              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           CSW097
     C                     PARM '*FIRST ' @OPTN                           CSW097
     C********** SDDEAL    PARM SDDEAL    DSFDY                           CSW097              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
      *                                                                   CSW097
      * Handle database error                                             CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C           *LOCK     IN   LDA                                       CSW097
     C                     MOVEL'031'     DBASE            * * * * * * * *CSW097
     C                     MOVEL@OPTN     DBKEY            * DB ERROR 031*CSW097
     C                     MOVEL'SDDEALPD'DBFILE           * * * * * * * *CSW097
     C                     OUT  LDA                                       CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     ENDIF                                          CSW097
      *
      **  Access Switchable Features file for Interest Rates Calendar.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CIR001'  @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVEL'Y'       CIR001  1
     C                     ELSE
     C           @RTCD     IFEQ '*NRF   '
     C                     MOVEL'N'       CIR001
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     Z-ADD005       DBASE            * * * * * * * *
     C                     MOVEL@SARD     DBKEY     P      * DB ERROR 05 *
     C                     MOVEL'SCSARDPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      **  Open files for Interest Rates Calendar feature.
      *
     C           CIR001    IFEQ 'Y'
     C                     OPEN DLDTSCPD
     C                     OPEN DLPCSCPD
     C                     ENDIF
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CIR002'  @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVEL'Y'       CIR002  1
     C                     ELSE
     C           @RTCD     IFEQ '*NRF   '
     C                     MOVEL'N'       CIR002
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     Z-ADD006       DBASE            * * * * * * * *
     C                     MOVEL@SARD     DBKEY     P      * DB ERROR 06 *
     C                     MOVEL'SCSARDPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *                                                                                     BUG11276
      **  Access Switchable Features file for Floating Rate CDs Issued                      BUG11276
      *                                                                                     BUG11276
     C                     CALL 'AOSARDR0'                                                  BUG11276
     C                     PARM *BLANKS   @RTCD                                             BUG11276
     C                     PARM '*VERIFY' @OPTN                                             BUG11276
     C**********           PARM 'CDL002'  @SARD   6                                BUG11276 BUG11276
     C                     PARM 'CDL033'  @SARD   6                                         BUG11276
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG11276
      *                                                                                     BUG11276
     C           @RTCD     IFEQ *BLANKS                                                     BUG11276
     C                     MOVEL'Y'       CDL033  1                                         BUG11276
     C                     ELSE                                                             BUG11276
     C           @RTCD     IFEQ '*NRF   '                                                   BUG11276
     C                     MOVEL'N'       CDL033                                            BUG11276
     C                     ELSE                                                             BUG11276
     C           *LOCK     IN   LDA                                                         BUG11276
     C                     Z-ADD033       DBASE            * * * * * * * *                  BUG11276
     C                     MOVEL@SARD     DBKEY     P      * DB ERROR 33 *                  BUG11276
     C                     MOVEL'SCSARDPD'DBFILE    P      * * * * * * * *                  BUG11276
     C                     OUT  LDA                                                         BUG11276
     C                     EXSR *PSSR                                                       BUG11276
     C                     ENDIF                                                            BUG11276
     C                     ENDIF                                                            BUG11276
     C/COPY WNCPYSRC,DL6330C001
      *
      **  Declare keylists for DLTSCPD and DLPCSCPD
     C           IRCKY1    KLIST
     C                     KFLD           DDLNO
     C                     KFLD           WOTIN   1
     C                     KFLD           WPRDT   50
     C           IRCKY2    KLIST
     C                     KFLD           DDLNO
     C                     KFLD           WOTIN
     C                     KFLD           WRCIP   1
     C                     KFLD           WPRDT
     C           IRCKY3    KLIST                                                             BUG7873
     C                     KFLD           DDLNO                                              BUG7873
     C                     KFLD           WWOTIN  1                                          BUG7873
     C                     KFLD           WWPRDT  50                                         BUG7873
      *
      **  Keylist for accessing ECONXCL0.
     C           ECONKY    KLIST
     C                     KFLD           DDLNO
     C                     KFLD           CKCNRQ  1
     C                     KFLD           RPTI                                              MD023278
      *
      **  Declare saved Destination Customer field.
     C                     MOVE *BLANKS   SVDEST  8
      *                                                                   137909
      **  Access Switchable Features file for CEU003                      137909
      *                                                                   137909
     C                     CALL 'AOSARDR0'                                137909
     C                     PARM *BLANKS   @RTCD                           137909
     C                     PARM '*VERIFY' @OPTN                           137909
     C                     PARM 'CEU003'  @SARD   6                       137909
     C           @RTCD     IFEQ *BLANKS                                   137909
     C                     MOVEL'Y'       CEU003  1                       137909
     C                     ELSE                                           137909
     C                     MOVEL'N'       CEU003                          137909
     C                     ENDIF                                          137909
      *                                                                   171312
     C                     CALL 'AOSARDR0'                                171312
     C                     PARM *BLANKS   @RTCD                           171312
     C                     PARM '*VERIFY' @OPTN                           171312
     C                     PARM 'CSW011'  @SARD                           171312
     C           SCSARD    PARM SCSARD    DSFDY                           171312
      *                                                                   171312
     C           @RTCD     IFNE *BLANKS                                   171312
     C           @RTCD     ANDNE'*NRF   '                                 171312
     C                     MOVEL'SCSARDPD'DBFILE           ***************171312
     C                     MOVEL'032'     DBASE            * DB ERROR 32 *171312
     C                     MOVEL'CSW011'  DBKEY            ***************171312
     C                     EXSR *PSSR                                     171312
     C                     ENDIF                                          171312
      *                                                                   171312
     C           @RTCD     IFEQ *BLANKS                                   171312
     C                     MOVEL'Y'       CSW011  1                       171312
     C                     ELSE                                           171312
     C                     MOVEL'N'       CSW011                          171312
     C                     ENDIF                                          171312
      *                                                                   CSW097
     C                     CALL 'AOSARDR0'                                CSW097
     C                     PARM *BLANKS   @RTCD                           CSW097
     C                     PARM '*VERIFY' @OPTN                           CSW097
     C                     PARM 'CSW005'  @SARD                           CSW097
     C           SCSARD    PARM SCSARD    DSFDY                           CSW097
      *                                                                   CSW097
     C           @RTCD     IFNE *BLANKS                                   CSW097
     C           @RTCD     ANDNE'*NRF   '                                 CSW097
     C                     MOVEL'SCSARDPD'DBFILE           ***************CSW097
     C                     MOVEL'019'     DBASE            * DB ERROR 19 *CSW097
     C                     MOVEL'CSW005'  DBKEY            ***************CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           @RTCD     IFEQ *BLANKS                                   CSW097
     C                     MOVEL'Y'       CSW005  1                       CSW097
     C                     ELSE                                           CSW097
     C                     MOVEL'N'       CSW005                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW200
     C                     CALL 'SWIF2000'                                CSW200
     C                     PARM *BLANKS   @RTCD   7                       CSW200
      *                                                                   CSW200
     C           @RTCD     IFEQ 'CSW200'                                  CSW200
     C                     MOVE 'Y'       CSW200  1                       CSW200
     C                     ELSE                                           CSW200
     C                     MOVE 'N'       CSW200                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
      *                                                                   CIR005
      **  Access Switchable Features file for CIR005                      CIR005
      *                                                                   CIR005
     C                     CALL 'AOSARDR0'                                CIR005
     C                     PARM *BLANKS   PRTCD                           CIR005
     C                     PARM '*VERIFY' POPTN   7                       CIR005
     C                     PARM 'CIR005'  PSARD   6                       CIR005
      *                                                                   CIR005
     C           PRTCD     IFNE *BLANKS                                   CIR005
     C           PRTCD     ANDNE'*NRF   '                                 CIR005
     C                     MOVEL'SCSARDPD'DBFILE           ***************CIR005
     C                     MOVEL'020'     DBASE            * DB ERROR 20 *CIR005
     C                     MOVEL'CIR005'  DBKEY            ***************CIR005
     C                     EXSR *PSSR                                     CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C           PRTCD     IFEQ *BLANKS                                   CIR005
     C                     MOVEL'Y'       CIR005  1                       CIR005
     C                     ELSE                                           CIR005
     C                     MOVEL'N'       CIR005                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
      ** Check if switchable feature CIR006 is switched on                CIR006
      *                                                                   CIR006
     C                     CALL 'AOSARDR0'                                CIR006
     C                     PARM *BLANKS   @RTCD                           CIR006
     C                     PARM '*VERIFY' @OPTN                           CIR006
     C                     PARM 'CIR006'  @SARD   6                       CIR006
     C           SCSARD    PARM SCSARD    DSFDY                           CIR006
     C*                                                                   CIR006
     C           @RTCD     IFNE *BLANK                                    CIR006
     C           @RTCD     ANDNE'*NRF   '                                 CIR006
     C                     MOVEL'SCSARDPD'DBFILE           ***************CIR006
     C                     MOVEL'32'      DBASE            * DB ERROR 32 *CIR006
     C                     MOVEL'CIR006'  DBKEY            ***************CIR006
     C                     EXSR *PSSR                                     CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C           @RTCD     IFEQ *BLANKS                                   CIR006
     C                     MOVE 'Y'       CIR006  1                       CIR006
     C                     ELSE                                           CIR006
     C                     MOVE 'N'       CIR006                          CIR006
     C                     ENDIF                                          CIR006
      *                                                                   CIR006
     C**                                                                                      CIR017
      ** Check if CIR017 - Separate Business Day Convention for SIRS                          CIR017
     C                     CALL 'AOSARDR0'                                                    CIR017
     C                     PARM *BLANKS   PRTCD                                               CIR017
     C                     PARM '*VERIFY' POPTN                                               CIR017
     C                     PARM 'CIR017'  PSARD                                               CIR017
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR017
      **                                                                                      CIR017
     C           PRTCD     IFEQ *BLANKS                                                       CIR017
     C                     MOVE 'Y'       CIR017  1                                           CIR017
     C                     ELSE                                                               CIR017
     C                     MOVE 'N'       CIR017                                              CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
      ** Check if CIR018 - Daily Rate Change Frequency on SIRS                                CIR018
     C                     CALL 'AOSARDR0'                                                    CIR018
     C                     PARM *BLANKS   PRTCD                                               CIR018
     C                     PARM '*VERIFY' POPTN                                               CIR018
     C                     PARM 'CIR018'  PSARD                                               CIR018
     C           SCSARD    PARM SCSARD    DSFDY                                               CIR018
      **                                                                                      CIR018
     C           PRTCD     IFEQ *BLANKS                                                       CIR018
     C                     MOVE 'Y'       CIR018  1                                           CIR018
     C                     ELSE                                                               CIR018
     C                     MOVE 'N'       CIR018                                              CIR018
     C                     ENDIF                                                              CIR018
     C**                                                                                      CIR018
      ** Is CSW025 installed?                                                                 CSW025
      *                                                                                       CSW025
     C                     CALL 'AOSARDR0'                                                    CSW025
     C                     PARM '       ' @RTCD                                               CSW025
     C                     PARM '*VERIFY' @OPTN                                               CSW025
     C                     PARM 'CSW025'  @SARD                                               CSW025
     C           @RTCD     IFNE *BLANK                                                        CSW025
     C           @RTCD     ANDNE'*NRF   '                                                     CSW025
     C                     MOVEL'SCSARDPD'DBFILE                                              CSW025
     C                     MOVEL'020'     DBASE                                               CSW025
     C                     MOVEL@RTCD     DBKEY                                               CSW025
     C                     MOVE *ON       *INU7                                               CSW025
     C                     MOVE *ON       *INU8                                               CSW025
     C                     EXSR *PSSR                                                         CSW025
     C                     ENDIF                                                              CSW025
     C           @RTCD     IFEQ *BLANK                                                        CSW025
     C                     MOVE 'Y'       CSW025  1                                           CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       CSW025
     C                     CALL 'SWIF2001'                                                    CSW201
     C                     PARM *BLANKS   @RTCD                                               CSW201
      *                                                                                       CSW201
     C           @RTCD     IFEQ 'CSW2001'                                                     CSW201
     C                     MOVE 'Y'       CSW201  1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVE 'N'       CSW201                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           *LIKE     DEFN TEINR     @EINR                           CSW097
     C           *LIKE     DEFN UICBS     @ICBS                           CSW097
     C                     Z-ADD0         MGSEQN                          CSW097
      *                                                                   CSW097
     C           CSW011    IFEQ 'Y'                                       171312
     C                     OPEN MGF341PD                                  171312
     C                     ENDIF                                          171312
      *                                                                   171312
     C           CSW005    IFEQ 'Y'                                       CSW097
      *                                                                   CSW097
     C                     OPEN DLOLACPD                                  CSW097
     C                     OPEN DLOLCFL1                                  CSW097
     C                     OPEN MGX36NPD                                  171312
     C                     OPEN MGY36NL0                                  171312
     C           CSW011    IFNE 'Y'                                       192081
     C                     OPEN MGF341PD                                  171312
     C                     ENDIF                                          192081
     C                     OPEN MGF362PD                                  171312
      *                                                                   CSW097
      **  Define KLIST to access LF/MGY36NL0                              CSW097
     C           GYL0KY    KLIST                                          CSW097
     C                     KFLD           MGSEQN                          CSW097
     C                     KFLD           K@MSSQ  1                       CSW097
     C                     KFLD           CFPYDT                          CSW097
      *                                                                   CSW097
      ** Define KLIST to access DLOLCFL1 and DLOLACPD                     CSW097
      *                                                                   CSW097
     C           OLXKY1    KLIST                                          CSW097
     C                     KFLD           WBEAF   1                       CSW097
     C                     KFLD           DDLNO                           CSW097
     C                     KFLD           WOTIN                           CSW097
     C                     KFLD           WPRDT                           CSW097
      *                                                                   CSW097
     C           OLXKY2    KLIST                                          CSW097
     C                     KFLD           WBEAF                           CSW097
     C                     KFLD           DDLNO                           CSW097
      *                                                                   CSW097
     C           OLXKY3    KLIST                                          CSW097
     C                     KFLD           WBEAF                           CSW097
     C                     KFLD           DDLNO                           CSW097
     C                     KFLD           WOTIN                           CSW097
      *                                                                   CSW097
     C           DLOLAK    KLIST                                          CSW097
     C                     KFLD           ACBEAF                          CSW097
     C                     KFLD           ACDLNO                          CSW097
     C                     KFLD           ACOTIN                          CSW097
     C                     KFLD           ACPRDT                          CSW097
     C*                                                                   CSW097
     C           DLOLAP    KLIST                                          CSW097
     C                     KFLD           ACBEAF                          CSW097
     C                     KFLD           ACDLNO                          CSW097
     C                     KFLD           ACOTIN                          CSW097
      *                                                                   CSW097
     C                     MOVE 'Y'       W@OLAC  1                       CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
      ** Check if switchable feature CIR014 is ON                                             CIR014
      *                                                                                       CIR014
     C                     CALL 'AOSARDR0'                                                    CIR014
     C                     PARM '       ' @RTCD                                               CIR014
     C                     PARM '*VERIFY' @OPTN                                               CIR014
     C                     PARM 'CIR014'  @SARD                                               CIR014
     C           @RTCD     IFNE *BLANK                                                        CIR014
     C           @RTCD     ANDNE'*NRF   '                                                     CIR014
     C                     MOVEL'SCSARDPD'DBFILE                                              CIR014
     C                     MOVEL'021'     DBASE                                               CIR014
     C                     MOVEL@RTCD     DBKEY                                               CIR014
     C                     EXSR *PSSR                                                         CIR014
     C                     ENDIF                                                              CIR014
     C           @RTCD     IFEQ *BLANK                                                        CIR014
     C                     MOVE 'Y'       CIR014  1                                           CIR014
     C                     OPEN DLDEALL5                                                      CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       239386
      ** Check Midas is in Input Cycle                                                        239386
      *                                                                                       239386
     C*********  *NAMVAR   DEFN           MPHAS                                        239386 CCB020
     C*********            IN   MPHAS                                                  239386 CCB020
     C                     MOVEL'CBC00100'@CLPRM  9                                           CCB020
     C                     MOVE '1'       @CLPRM                                              CCB020
     C                     CALL @CLPRM                                                        CCB020
     C                     PARM *BLANKS   @RTPHS  4                                           CCB020
      *                                                                                       CSW213
      ** Test if SWIFT Changes 2013 is on and set accordingly                                 CSW213
      *                                                                                       CSW213
     C                     CALL 'SWIF2013'                                                  MD023529
     C                     PARM *BLANKS   @RTCD                                             MD023529
      *                                                                                     MD023529
     C           @RTCD     IFEQ 'CSW2013'                                                     CSW213
     C                     MOVE 'Y'       CSW213  1                                           CSW213
     C                     ELSE                                                               CSW213
     C                     MOVE 'N'       CSW213                                              CSW213
     C                     END                                                                CSW213
      *                                                                                       CSW213
      ** Setup key for DLRPIFPD                                                               CSW213
      *                                                                                       CSW213
     C           RPIFKY    KLIST                                                              CSW213
     C                     KFLD           KDTYP                                               CSW213
     C                     KFLD           KLDLNO                                              CSW213
      *                                                                                     MD023278
      ** Set WPRID = 'N'                                                                    MD023278
      *                                                                                     MD023278
     C                     MOVE 'N'       WPRID   1                                         MD023278
      *                                                                                       239386
      ***Retrieve*system*value*setting**********************                       MD035545 MD035545
      **********                                                                   MD035545 MD051554
     C**********           MOVELWPARML    P@OP01                                   MD035545 MD051554
     C**********           CALL 'AOSVALR0'                                         MD035545 MD051554
     C**********           PARM *BLANKS   W0RTCD  7                                MD035545 MD051554
     C**********           PARM           P@OP01 20                                MD035545 MD051554
     C**********           PARM           P@VL01200                                MD035545 MD051554
     C**********           PARM           P@OP02 20                                MD035545 MD051554
     C**********           PARM           P@VL02200                                MD035545 MD051554
     C**********           PARM           P@OP03 20                                MD035545 MD051554
     C**********           PARM           P@VL03200                                MD035545 MD051554
     C**********           PARM           P@OP04 20                                MD035545 MD051554
     C**********           PARM           P@VL04200                                MD035545 MD051554
     C**********           PARM           P@OP05 20                                MD035545 MD051554
     C**********           PARM           P@VL05200                                MD035545 MD051554
     C**********           PARM           P@OP06 20                                MD035545 MD051554
     C**********           PARM           P@VL06200                                MD035545 MD051554
     C**********           PARM           P@OP07 20                                MD035545 MD051554
     C**********           PARM           P@VL07200                                MD035545 MD051554
     C**********           PARM           P@OP08 20                                MD035545 MD051554
     C**********           PARM           P@VL08200                                MD035545 MD051554
     C**********           PARM           P@OP09 20                                MD035545 MD051554
     C**********           PARM           P@VL09200                                MD035545 MD051554
     C**********           PARM           P@OP10 20                                MD035545 MD051554
     C**********           PARM           P@VL10200                                MD035545 MD051554
      **********                                                                   MD035545 MD051554
      ***If*system value is not found then default value to 'N'                    MD035545 MD051554
      **********                                                                   MD035545 MD051554
     C********** W0RTCD    IFNE '       '                                          MD035545 MD051554
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD051554
     C**********           ELSE                                                    MD035545 MD051554
     C**********           MOVELP@VL01    WCALC6                                   MD035545 MD051554
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD051554
      *                                                                                     MD035545
      *                                                                                       CSW214
      ** Check if SWIFT 2014  is on                                                           CSW214
      *                                                                                       CSW214
     C                     CALL 'SWIF2014'                                                    CSW214
     C                     PARM *BLANKS   PRTCD                                               CSW214
      *                                                                                       CSW214
     C           PRTCD     IFEQ 'CSW2014'                                                     CSW214
     C                     MOVEL'Y'       CSW214  1                                           CSW214
     C                     ELSE                                                               CSW214
     C                     MOVEL'N'       CSW214                                              CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRDLDG - Access deals record.                             *
      *                                                               *
      *  Called by: Main Processing Routine                           *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRDLDG    BEGSR
      *
      **  Access corresponding deal record.
      *
     C********** CDLNO     CHAINDEALS                11                                     BUG11276
     C********** CDLNO     CHAINDEALSDGF             11                            BUG11276 MD027782
     C           CDLNO     CHAINDEALSDGF            N11                                     MD027782
      *
     C           *IN11     IFEQ '1'
     C           DRECI     ORNE 'D'
     C           DRECI     ANDNE'R'
      *                                                                                     BUG11276
      **  If deal number is not found in DEALSDG, look for it in DEALSDC                    BUG11276
      **  only if CDL033 = 'Y'                                                              BUG11276
      *                                                                                     BUG11276
     C           CDL033    IFEQ 'Y'                                                         BUG11276
     C           CDLNO     CHAINDEALSDCF             12                                     BUG11276
      *                                                                                     BUG11276
     C           *IN12     IFEQ '1'                                                         BUG11276
     C           *LOCK     IN   LDA                                                         BUG11276
     C                     Z-ADD034       DBASE            * * * * * * * *                  BUG11276
     C                     MOVELCDLNO     DBKEY     P      * DB ERROR 34 *                  BUG11276
     C                     MOVEL'DEALS'   DBFILE    P      * * * * * * * *                  BUG11276
     C                     OUT  LDA                                                         BUG11276
     C                     EXSR *PSSR                                                       BUG11276
     C                     ELSE                                                             BUG11276
      *                                                                                     BUG11276
      **  If deal is found in DEALSDC, skip processing and read next record.                BUG11276
      *                                                                                     BUG11276
     C                     READ ECONXCY                  10                                 BUG11276
     C                     MOVE 'Y'       NXTREC                                            BUG11276
      *                                                                                     BUG11276
     C           CNRQFI    CHECKCNRQ      OKS     10                                        BUG11276
     C                     ENDIF                                                            BUG11276
      *                                                                                     BUG11276
     C                     ELSE                                                             BUG11276
      *                                                                                     BUG11276
      **  CDL033 = 'N' and deal number not in DEALSDG                                       BUG11276
      *                                                                                     BUG11276
     C           *LOCK     IN   LDA
     C                     Z-ADD007       DBASE            * * * * * * * *
     C                     MOVELCDLNO     DBKEY     P      * DB ERROR 07 *
     C                     MOVEL'DEALS'   DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                                                            BUG11276
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCLIR - Initialise fields of PF/MGF341PD and             *
      *              PF/MGF362PD.                                     *
      *                                                               *
      *  Called by: Main Processing Routine                           *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRCLIR    BEGSR
      *
     C                     CLEARMDS341
     C                     CLEARMDS362
     C                     MOVEATSTAM     MGTMST                                              CSW213
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCOMM - Set up common output fields.                     *
      *                                                               *
      *  Called by: Main Processing.                                  *
      *                                                               *
      *  Calls: SR/SRINIW  - Initialise workfields.                   *
      *         RPG/MG9215 - IRS Rate Fix and Settlement Msg Deletion *
      *         RPG/MG9220 - FRA Rate Fix and Settlement Msg Deletion *
      *                                                               *
      *****************************************************************
      *
     C           SRCOMM    BEGSR
      *
      **  Initialise workfields.
      *
     C                     EXSR SRINIW
      *
      **  For amend, call corresponding msg deletion program.
      *                                                                                       CSW213
     C           RPTI      IFEQ 'Y'                                                           CSW213
      *                                                                                       CSW213
     C           CCHTP     IFEQ 'A'                                                           CSW213
     C           DTYP      ANDEQ'FR'                                                          CSW213
      *                                                                                       CSW213
     C           AGTY      ANDNE'ISDA'                                                        CSW213
     C           AGTY      ANDNE'AFB'                                                         CSW213
     C           CSW200    ANDEQ'N'                                                           CSW213
     C           DTYP      OREQ 'FR'                                                          CSW213
     C           CSW200    ANDEQ'Y'                                                           CSW213
      *                                                                                       CSW213
      **  Module Id, transaction no. and message type parameters.                             CSW213
      *                                                                                       CSW213
     C           CSW025    IFNE 'Y'                                                           CSW213
     C                     MOVE 'FI'      PKMODI                                              CSW213
     C                     Z-ADDCDLNO     PKTRAN                                              CSW213
     C                     MOVE '341'     PKMTYP                                              CSW213
      *                                                                                       CSW213
     C                     MOVELCNUM      PTRID                                               CSW213
      *                                                                                       CSW213
     C                     CALL 'MG922000'             97                                     CSW213
     C                     PARM           PKTRAN  60                                          CSW213
     C                     PARM           PTRID   6                                           CSW213
     C                     PARM           PKMODI  2                                           CSW213
     C                     PARM           PKMTYP  3                                           CSW213
     C                     PARM *BLANKS   PKTREF 16                                           CSW213
     C                     PARM *BLANK    PKRTNC  1                                           CSW213
      *                                                                                       CSW213
      **  If Cancs/Dels program ended with a DB error, use the LDA                            CSW213
      **  entries set up for that error                                                       CSW213
      *                                                                                       CSW213
     C           PKRTNC    IFEQ 'E'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           *IN97     IFEQ '1'                                                           CSW213
     C           *LOCK     IN   LDA                                                           CSW213
     C                     Z-ADD8         DBASE            *************                      CSW213
     C                     MOVEL'MG922000'DBKEY     P      * DBERR 008 *                      CSW213
     C                     MOVEL*BLANKS   DBFILE           *************                      CSW213
     C                     OUT  LDA                                                           CSW213
     C                     EXSR *PSSR                                                         CSW213
     C                     ENDIF                                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
      **  Set Change Type                                                                     CSW213
      *                                                                                       CSW213
     C           CHTP      IFEQ 'R'                                                           CSW213
     C           PKRTNC    ANDEQ'C'                                                           CSW213
     C                     MOVE 'C'       MGCHTP                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C           MGCHTP    IFEQ *BLANK                                                        CSW213
     C                     MOVELCHTP      MGCHTP                                              CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ELSE                                                               CSW213
      *                                                                                       CSW213
     C           CCHTP     IFEQ 'A'
     C           DTYP      IFEQ 'FR'
      *                                                                   CSW097
      ****and*NOT*covered*by*either*"ISDA"*or*"AFB"*Master*Agreement***   CSW097 CSW200
     C           AGTY      ANDNE'ISDA'                                    CSW097
     C           AGTY      ANDNE'AFB'                                     CSW097
     C           CSW200    ANDEQ'N'                                       CSW200
     C           DTYP      OREQ 'FR'                                      CSW200
     C           CSW200    ANDEQ'Y'                                       CSW200
      *
      **  Module Id, transaction no. and message type parameters.
     C           CSW025    IFNE 'Y'                                                           CSW025
     C                     MOVE 'FI'      PKMODI
     C                     Z-ADDCDLNO     PKTRAN
     C                     MOVE '341'     PKMTYP
      *
     C                     CALL 'MG9220'               97
     C                     PARM           PKTRAN  60
     C                     PARM           PKMODI  2
     C                     PARM           PKMTYP  3
     C                     PARM *BLANKS   PKTREF 16
     C                     PARM *BLANK    PKRTNC  1
      *
      **  If Cancs/Dels program ended with a DB error, use the LDA
      **  entries set up for that error
     C           PKRTNC    IFEQ 'E'
     C           *LOCK     IN   LDA
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           *IN97     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD008       DBASE            * * * * * * * *
     C                     MOVEL'MG9220'  DBKEY     P      *  DBERR 008  *
     C                     MOVEL*BLANKS   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF                                                              CSW025
      *
      **  Set Change Type                                                 CSW200
     C           CHTP      IFEQ 'R'                                       CSW200
     C           PKRTNC    ANDEQ'C'                                       CSW200
     C                     MOVE 'C'       MGCHTP                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           MGCHTP    IFEQ *BLANK                                    CSW200
     C                     MOVELCHTP      MGCHTP                          CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C                     ELSE
      *
      **  Module Id, deal no., deal type, event type and event date paramters.
     C                     MOVE 'FI'      PKMODI
     C                     Z-ADDCDLNO     PKDLNO
     C                     MOVELDTYP      PKDTYP
     C                     SELEC
     C           CNRQ      WHEQ 'D'
     C                     MOVE 'FU'      PKEVTP
     C**********           Z-ADDUNICD     PKEDAT                                              195306
     C                     TESTB'0'       UDNSI          41                                   195306
     C                     Z-ADDUNICD     WNICD   50                                          195306
     C           CNRQ      WHEQ 'F'
     C                     MOVE 'FT'      PKEVTP
     C**********           Z-ADDTNICD     PKEDAT                                              195306
     C                     TESTB'0'       TDNSI          41                                   195306
     C                     Z-ADDTNICD     WNICD                                               195306
     C           CNRQ      WHEQ 'H'
     C                     MOVE 'FB'      PKEVTP
     C**********           Z-ADDUNICD     PKEDAT                                              195306
     C                     TESTB'0'       UDNSI          41                                   195306
     C                     Z-ADDUNICD     WNICD                                               195306
     C***********CNRQ      WHEQ 'E'                                       CSW097
     C***********          MOVE 'SU'      PKEVTP                          CSW097
     C***********DVDAT     IFGT BJDNWD                                    CSW097
     C***********          Z-ADDDVDAT     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********UNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDUNIPD     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      PKEDAT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
     C***********CNRQ      WHEQ 'G'                                       CSW097
     C***********          MOVE 'ST'      PKEVTP                          CSW097
     C***********DVDAT     IFGT BJDNWD                                    CSW097
     C***********          Z-ADDDVDAT     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********TNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDTNIPD     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      PKEDAT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
     C***********CNRQ      WHEQ 'J'                                       CSW097
     C***********          MOVE 'SB'      PKEVTP                          CSW097
     C***********DVDAT     IFGT BJDNWD                                    CSW097
     C***********          Z-ADDDVDAT     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********UNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDUNIPD     PKEDAT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      PKEDAT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
     C                     ENDSL
      *                                                                                       195306
     C                     TESTB'1'       ACEI           40                                   195306
     C                     EXSR SREDAT                                                        195306
      *
      ****If*only*one*side*settling,*check*if*netting:*                   CSW097
      ***********                                                         CSW097
     C***********PKEVTP    IFEQ 'ST'                                      CSW097
     C***********PKEVTP    OREQ 'SU'                                      CSW097
     C***********          EXSR SRCNET                                    CSW097
     C***********          ENDIF                                          CSW097
      *
     C           CSW025    IFNE 'Y'                                                           CSW025
     C                     CALL 'MG9215'               97
     C                     PARM           PKMODI  2
     C                     PARM           PKDLNO  60
     C                     PARM           PKDTYP  2
     C                     PARM           PKEVTP  2
     C                     PARM           PKEDAT  50
     C                     PARM           PKSNET  1
     C                     PARM *BLANKS   OEVTP1  2
     C                     PARM *BLANK    OCANC1  1
     C                     PARM *BLANKS   OTRNO1 16
     C                     PARM *BLANKS   OEVTP2  2
     C                     PARM *BLANK    OCANC2  1
     C                     PARM *BLANKS   OTRNO2 16
     C                     PARM           OERROR  1
      *
     C           *IN97     IFEQ '1'
     C           OERROR    ORNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD009       DBASE            * * * * * * * *
     C                     MOVEL'MG9215'  DBKEY     P      *  DBERR 009  *
     C                     MOVEL*BLANKS   DBFILE           * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF                                                              CSW025
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF                                                              CSW213
      *                                                                                       CSW213
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRFRA  - Process record for FRA.                          *
      *                                                               *
      *  Called by: Main Processing Routine                           *
      *                                                               *
      *  Calls: SR/SRECON - Access ECONXCL0.                          *
      *         SR/SRCURR - Access SDCURRPD.                          *
      *         SR/SRCOMF - Set up rate fixing details.               *
      *         SR/SRCOMO - Output common GDF fields.                 *
      *         SR/SRFRAO - Output record to PF/MGF341PD.             *
      *                                                               *
      *****************************************************************
      *
     C           SRFRA     BEGSR
      *
      **  Process only confirmation request for Our/Their Rate Fixing.
      *
     C           CNRQ      IFEQ 'D'
     C           CNRQ      OREQ 'F'
      *
      **  Settlement rate, contract rate workfields.
     C           CNRQ      IFEQ 'D'
     C                     Z-ADDUFIR      WKSRAT
     C                     Z-ADDTEINR     WKCRAT
     C                     ELSE
     C                     Z-ADDTFIR      WKSRAT
     C                     Z-ADDUEINR     WKCRAT
     C                     ENDIF
      *
      **  Fixing date workfield
     C           CNRQ      IFEQ 'D'
     C                     Z-ADDUFRFD     ZRFDY
     C                     ELSE
     C                     Z-ADDTFRFD     ZRFDY
     C                     ENDIF
      *
      **    If 'currency for rate fix holiday' flag from FRA/IRS I.C.D.
      **    is 'F', 'L' or 'D', set currency code to 'sterling code',
      **    'local currency code' or 'screen currency code' respectively
      *
     C                     SELEC
     C           BQCRFH    WHEQ 'F'
     C                     MOVE BLCYCD    ZCCY
     C           BQCRFH    WHEQ 'L'
     C                     MOVE BJLCCY    ZCCY
     C           BQCRFH    WHEQ 'D'
     C           BQCRFH    OREQ ' '
     C                     MOVE UCUCY     ZCCY
     C                     ENDSL
     C*
     C**     Initialise Work Field
     C                     Z-ADD0         WFDAT   50
     C                     MOVE *BLANKS   ZLOC
     C                     Z-ADDZRFDY     ZRFDY   50
     C                     MOVE ZCCY      ZCCY    3
     C                     Z-ADD0         ZWKFLD  50
     C                     MOVE '0'       *IN99
     C*
     C**     Set Rate Fix Date equal to Deal Value Date
     C                     Z-ADDDVDAT     WFDAT
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           L1CYR1    ANDNE*BLANKS                                   CIR005
     C                     MOVEL'IRRTFX'  WCALL   9                       CIR005
     C                     MOVE 'CNV'     WCALL                           CIR005
     C                     CALL WCALL                                     CIR005
     C                     PARM WFDAT     PFDAT   50                      CIR005
     C                     PARM ZRFDY     PRFDY   20                      CIR005
     C                     PARM ZLOC      PLOCN   3                       CIR005
     C                     PARM WCCYD1    PCURR  30                       CIR005
     C                     PARM *ZEROS    PFXDT   50                      CIR005
      *                                                                   CIR005
     C                     Z-ADDPFXDT     WFDAT                           CIR005
      *                                                                   CIR005
     C                     ELSE                                           CIR005
     C*
     C**     Perform the following processing until the work field is
     C**     greater than or equal to the Rate Fix Days
     C           ZWKFLD    DOUGEZRFDY
     C*
     C**     If the Rate Fix Days are not equal to zero subtract 1
     C**     from the Rate Fix Date
     C           ZRFDY     IFNE 0
     C                     SUB  1         WFDAT
     C                     END
      *
      **     The following is repeated until the resultant date is
      **         proved to be a working day in the relevant currency
      **         and the relevent location.
      **     ZCHKH checks the Rate Fix Date for a holiday.
      *
     C           ZIND      DOUEQ'W'
     C                     Z-ADDWFDAT     ZDAYNO
     C                     EXSR ZCHKH
      *
      **     If the date is a holiday, subtract 1 from the Rate Fix Date
     C           ZIND      IFEQ 'H'
     C                     SUB  1         WFDAT
     C                     END
     C                     ENDDO
     C*
     C**     When a working day has been found, add 1 to the Work Field
     C                     ADD  1         ZWKFLD
     C                     ENDDO
      *
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     Z-ADDWFDAT     WKFDAT
      *
      ** Parameter setup for AOBSRTR0                                                         195947
      *                                                                                       195947
     C           UBRTT     IFNE 0                                                             195947
     C                     MOVE UBRTT     @WBSRT  2                                           195947
     C                     MOVE UCUCY     @WCCY   3                                           195947
     C                     Z-ADDTEINR     XEINR  117                                          195947
     C                     ELSE                                                               195947
     C                     MOVE TBRTT     @WBSRT                                              195947
     C                     MOVE TCUCY     @WCCY                                               195947
     C                     Z-ADDUEINR     XEINR                                               195947
     C                     ENDIF                                                              195947
      *                                                                                       195947
      ** Call access program AOBSRTR0 to get value of Base Rate                               195947
      *                                                                                       195947
     C                     CALL 'AOBSRTR0'                                                    195947
     C                     PARM '*MSG   ' @RTCD   7                                           195947
     C                     PARM '*KEY   ' @OPTN   7                                           195947
     C                     PARM @WCCY     @BCCY   3                                           195947
     C                     PARM @WBSRT    @BBSRT  2                                           195947
     C           SDBSRT    PARM SDBSRT    DSFDY                                               195947
      *                                                                                       195947
      **  Access settlement records with CNRQ equal to 'E' or 'G' to
      **  determine pay or receive.
      **  There will only be a settlement record if the contract rate                       BUG11283
      **  is not equal to the settlement rate.                                              BUG11283
      *                                                                                     BUG11283
     C           WKCRAT    IFNE WKSRAT                                                      BUG11283
      *                                                                                     BUG11283
     C           BANBRT    IFNE XEINR                                                         195947
     C                     MOVE 'E'       CKCNRQ
     C                     EXSR SRECON
     C           CKRTCD    IFEQ '*NRF'
     C                     MOVE 'G'       CKCNRQ
     C                     EXSR SRECON
     C           CKRTCD    IFEQ '*NRF'
     C********** *LOCK     IN   LDA                                                           195947
     C**********           Z-ADD010       DBASE            * * * * * * * *                    195947
     C**********           MOVELCDLNO     DBKEY     P      *  DBERR 010  *                    195947
     C**********           MOVEL'ECONXCY' DBFILE    P      * * * * * * * *                    195947
     C**********           OUT  LDA                                                           195947
     C**********           EXSR *PSSR                                                         195947
     C                     MOVE *BLANK    WKPORR                                              195947
     C                     Z-ADD0         WKSAMT                                              195947
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                                              195947
      *
     C           CKRTCD    IFNE '*NRF'                                                        195947
     C           ECNRQ     IFEQ 'E'
     C                     MOVE 'P'       WKPORR
     C                     Z-ADDEINTA     WKSAMT
     C                     ELSE
     C                     MOVE 'R'       WKPORR
     C                     Z-ADDEINTO     WKSAMT
     C                     ENDIF
     C                     ENDIF                                                              195947
      *                                                                                     BUG11283
     C                     ELSE                                                             BUG11283
      *                                                                                     BUG11283
     C                     MOVE *BLANK    WKPORR                                            BUG11283
     C                     Z-ADD0         WKSAMT                                            BUG11283
      *                                                                                     BUG11283
     C                     ENDIF                                                            BUG11283
      *
      **  Currency workfields.
     C                     MOVE UCUCY     PKCCY
     C                     Z-ADD011       DBASEP  30
     C                     EXSR SRCURR
     C                     MOVE A6SWCY    WKCCY
      *
      **  Output common fields.
     C                     EXSR SRCOMO
      *
      **  Output record to PF/MGF341PD.
     C                     EXSR SRFRAO
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRIRS  - Determine processing type for IRS.               *
      *                                                               *
      *  Called by: Main Processing Routine                           *
      *                                                               *
      *  Calls: SR/SRCOMO - Output common GDF fields.                 *
      **********SR/SRIRUS*-*Process*settlement*record*for*IRS*-*Ours***   CSW097
      **********SR/SRIRTS*-*Process*settlement*record*for*IRS*-*Theirs*   CSW097
      **********SR/SRIROS*-*Output*record*to*PF/MGF362PD*-*settlement**   CSW097
      *         SR/SRIRUF - Process fix record for IRS - Ours         *
      *         SR/SRIRTF - Process fix record for IRS - Theirs       *
      *         SR/SRIROF - Output record to PF/MGF362PD - fix        *
      *                                                               *
      *****************************************************************
      *
     C           SRIRS     BEGSR
      *                                                                   CSW097
      **  Sequence Number                                                 CSW097
      *                                                                   CSW097
     C                     ADD  1         MGSEQN                          CSW097
      *
      **  Output common fields.
     C                     EXSR SRCOMO
      *                                                                   CSW097
      ** Build IRS activity and cashflow file                             CSW097
     C           DTYP      IFNE 'FR'                                      CSW097
     C                     EXSR SRBILD                                    CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       196042
      ** Initialise work variable event type                                                  196042
     C                     MOVE *BLANK    WEVTP   2                                           196042
      *
      **  Action not amend.
     C           CCHTP     IFNE 'A'
      *                                                                                       196042
      ** Set up work variable for event type                                                  196042
     C                     SELEC                                                              196042
     C           CNRQ      WHEQ 'D'                                                           196042
     C                     MOVE 'FU'      WEVTP                                               196042
     C           CNRQ      WHEQ 'F'                                                           196042
     C                     MOVE 'FT'      WEVTP                                               196042
     C           CNRQ      WHEQ 'H'                                                           196042
     C                     MOVE 'FB'      WEVTP                                               196042
     C                     ENDSL                                                              196042
      *
      **  Processing steps depends on the confirmation request.
     C                     SELEC
     C***********CNRQ      WHEQ 'E'                                       CSW097
     C***********CNRQ      OREQ 'G'                                       CSW097
     C***********CNRQ      OREQ 'J'                                       CSW097
      ***********                                                         CSW097
     C***********CNRQ      IFEQ 'E'                                       CSW097
     C***********CNRQ      OREQ 'J'                                       CSW097
     C***********          EXSR SRIRUS                                    CSW097
     C***********          ENDIF                                          CSW097
     C***********CNRQ      IFEQ 'G'                                       CSW097
     C***********CNRQ      OREQ 'J'                                       CSW097
     C***********          EXSR SRIRTS                                    CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          EXSR SRIROS                                    CSW097
      *
     C           CNRQ      WHEQ 'D'
     C           CNRQ      OREQ 'F'
     C           CNRQ      OREQ 'H'
      *
     C           CNRQ      IFEQ 'D'
     C           CNRQ      OREQ 'H'
      *                                                                   CSW097
     C                     EXSR SRIRUF
      *                                                                   CSW097
      ** If Our Side has been fixed (CNRQ='D'), only seq E record         CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq C record.                                      CSW097
     C           CNRQ      IFEQ 'D'                                       CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           TBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           TBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'T'       ZOTIN                           CSW097
     C                     MOVE 'C'       W#MSSQ                          CSW097
     C                     Z-ADDMGOCRD    W#CRDT                          CSW097
     C                     Z-ADDMGONRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Their currency.                                                 CSW097
     C                     MOVE TCUCY     PKCCY                           CSW097
     C                     Z-ADD015       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGTCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *                                                                   CSW097
     C           CNRQ      IFEQ 'F'
     C           CNRQ      OREQ 'H'
      *                                                                   CSW097
     C                     EXSR SRIRTF
      *                                                                   CSW097
      ** If Their Side has been fixed (CNRQ='F'), only seq C record       CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq E record.                                      CSW097
     C           CNRQ      IFEQ 'F'                                       CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           UBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           UBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'U'       ZOTIN                           CSW097
     C                     MOVE 'E'       W#MSSQ                          CSW097
     C                     Z-ADDMGTCRD    W#CRDT                          CSW097
     C                     Z-ADDMGTNRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Our currency.                                                   CSW097
     C                     MOVE UCUCY     PKCCY                           CSW097
     C                     Z-ADD014       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGOCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *
     C                     EXSR SRIROF
      *
     C                     ENDSL
      *
      **  Action is amend.
     C                     ELSE
      *
      **  Processing steps depends on the returned field from
      **  RPG/MG9215 - Generate message event type 1.
      *
      **  Set indicator to generate message event type 1.
     C                     MOVE '0'       *IN30
     C                     MOVE OEVTP1    WEVTP                                               196042
     C                     SELEC
     C***********OEVTP1    WHEQ 'SU'                                      CSW097
     C***********OEVTP1    OREQ 'ST'                                      CSW097
     C***********OEVTP1    OREQ 'SB'                                      CSW097
      ***********                                                         CSW097
     C***********OEVTP1    IFEQ 'SU'                                      CSW097
     C***********OEVTP1    OREQ 'SB'                                      CSW097
     C***********          EXSR SRIRUS                                    CSW097
     C***********          ENDIF                                          CSW097
     C***********OEVTP1    IFEQ 'ST'                                      CSW097
     C***********OEVTP1    OREQ 'SB'                                      CSW097
     C***********          EXSR SRIRTS                                    CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          EXSR SRIROS                                    CSW097
      *
     C           OEVTP1    WHEQ 'FU'
     C           OEVTP1    OREQ 'FT'
     C           OEVTP1    OREQ 'FB'
      *
     C           OEVTP1    IFEQ 'FU'
     C           OEVTP1    OREQ 'FB'
      *                                                                   CSW097
     C                     EXSR SRIRUF
      *                                                                   CSW097
      ** If Our side has been fixed (CNRQ='FU'), only seq E record        CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq C record.                                      CSW097
     C           OEVTP1    IFEQ 'FU'                                      CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           TBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           TBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'T'       ZOTIN                           CSW097
     C                     MOVE 'C'       W#MSSQ                          CSW097
     C                     Z-ADDMGOCRD    W#CRDT                          CSW097
     C                     Z-ADDMGONRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Their currency.                                                 CSW097
     C                     MOVE TCUCY     PKCCY                           CSW097
     C                     Z-ADD015       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGTCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *                                                                   CSW097
     C           OEVTP1    IFEQ 'FT'
     C           OEVTP1    OREQ 'FB'
      *                                                                   CSW097
     C                     EXSR SRIRTF
      *                                                                   CSW097
      ** If Their Side has been fixed (CNRQ='FT'), only seq C record      CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq E record.                                      CSW097
     C           OEVTP1    IFEQ 'FT'                                      CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           UBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           UBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'U'       ZOTIN                           CSW097
     C                     MOVE 'E'       W#MSSQ                          CSW097
     C                     Z-ADDMGTCRD    W#CRDT                          CSW097
     C                     Z-ADDMGTNRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Our currency.                                                   CSW097
     C                     MOVE UCUCY     PKCCY                           CSW097
     C                     Z-ADD014       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGOCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *
     C                     EXSR SRIROF
      *
     C                     ENDSL
      *
      **  Processing steps depends on the returned field from
      **  RPG/MG9215 - Generate message event type 2.
      *
      **  Set indicator to generate message event type 2.
     C                     MOVE '1'       *IN30
     C                     MOVE OEVTP2    WEVTP                                               196042
      *
      **  Clear some fields to separate Our and Their details of
      **  message event type 1 above.
     C                     CLEARMDS362
      *
     C                     SELEC
     C***********OEVTP2    WHEQ 'SU'                                      CSW097
     C***********OEVTP2    OREQ 'ST'                                      CSW097
     C***********OEVTP2    OREQ 'SB'                                      CSW097
      ***********                                                         CSW097
     C***********OEVTP2    IFEQ 'SU'                                      CSW097
     C***********OEVTP2    OREQ 'SB'                                      CSW097
     C***********          EXSR SRIRUS                                    CSW097
     C***********          ENDIF                                          CSW097
     C***********OEVTP2    IFEQ 'ST'                                      CSW097
     C***********OEVTP2    OREQ 'SB'                                      CSW097
     C***********          EXSR SRIRTS                                    CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          EXSR SRIROS                                    CSW097
      *
     C           OEVTP2    WHEQ 'FU'
     C           OEVTP2    OREQ 'FT'
     C           OEVTP2    OREQ 'FB'
      *
     C           OEVTP2    IFEQ 'FU'
     C           OEVTP2    OREQ 'FB'
      *                                                                   CSW097
     C                     EXSR SRIRUF
      *                                                                   CSW097
      ** If Our Side has been fixed (CNRQ='FU'), only seq E record        CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq C record.                                      CSW097
     C           OEVTP2    IFEQ 'FU'                                      CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           TBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           TBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'T'       ZOTIN                           CSW097
     C                     MOVE 'C'       W#MSSQ                          CSW097
     C                     Z-ADDMGOCRD    W#CRDT                          CSW097
     C                     Z-ADDMGONRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Their currency.                                                 CSW097
     C                     MOVE TCUCY     PKCCY                           CSW097
     C                     Z-ADD015       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGTCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *                                                                   CSW097
     C           OEVTP2    IFEQ 'FT'
     C           OEVTP2    OREQ 'FB'
      *                                                                   CSW097
     C                     EXSR SRIRTF
      *                                                                   CSW097
      ** If Our side has been fixed (CNRQ='FT'), only seq C record        CSW097
      ** was output to MGY36NPD. The following call to SRY36N will        CSW097
      ** try to output seq E record.                                      CSW097
     C           OEVTP2    IFEQ 'FT'                                      CSW097
     C           DTYP      ANDNE'FR'                                      CSW097
      *                                                                   171312
      **  Do not output payment details if other side is floating         171312
      **   but not fixed - RXs only                                       171312
     C           DTYP      IFEQ 'RS'                                      171312
     C           UBRTT     ANDEQ0                                                             196042
     C           DTYP      OREQ 'RS'                                                          196042
     C           WEVTP     ANDEQ'FB'                                                          196042
     C           DTYP      OREQ 'RX'                                      171312
     C           UBRTT     ANDEQ0                                         171312
      *                                                                   CSW097
     C                     MOVE 'U'       ZOTIN                           CSW097
     C                     MOVE 'E'       W#MSSQ                          CSW097
     C                     Z-ADDMGTCRD    W#CRDT                          CSW097
     C                     Z-ADDMGTNRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
      **  Our currency.                                                   CSW097
     C                     MOVE UCUCY     PKCCY                           CSW097
     C                     Z-ADD014       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGOCCY                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          171312
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF
      *
     C                     EXSR SRIROF
      *
     C                     ENDSL
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***SR/SRIRUS*-*Process*settlement*record*for*IRS*-*Our*side.*****   CSW097
      *****************************************************************   CSW097
      ***Called*by:*SR/SRIRS-*Determine*processing*type*for*IRS.*******   CSW097
      *****************************************************************   CSW097
      ***Calls:*SR/SRCURR*-*Access*SDCURRPD.***************************   CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***********                                                         CSW097
     C***********SRIRUS    BEGSR                                          CSW097
      ***********                                                         CSW097
      ****Our*currency.************************************************   CSW097
     C***********          MOVE UCUCY     PKCCY                           CSW097
     C***********          Z-ADD012       DBASEP                          CSW097
     C***********          EXSR SRCURR                                    CSW097
     C***********          MOVE A6SWCY    MGOCCY                          CSW097
      ***********                                                         CSW097
      ****Our*current*principal*amount.*******************************    CSW097
     C***********          Z-ADDUPAMT     MGOPCL                          CSW097
      ***********                                                         CSW097
      ****Our*pay*date.***********************************************    CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********UINPM     ANDEQ'D'                                       CSW097
     C***********DVDAT     ORGE BJRDNB                                    CSW097
     C***********UINPM     ANDEQ'Y'                                       CSW097
     C***********          Z-ADDDVDAT     MGOPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********UNIPD     IFNE *ZEROS                                    CSW097
     C***********          Z-ADDUNIPD     MGOPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      MGOPDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Their*pay*date*for*netting*comparison***********************    CSW097
     C***********TNIPD     IFEQ *ZEROS                                    CSW097
     C***********          Z-ADDMDAT      WWTPDT  50                      CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDTNIPD     WWTPDT                          CSW097
     C***********          ENDIF                                          CSW097
      **  Our interest payment amount workfield.                          CSW097
     C***********MGOPDT    IFEQ WWTPDT                                    CSW097
     C***********CNRQ      ANDNE'J'                                       CSW097
     C***********DVDAT     ORGE BJRDNB                                    CSW097
     C***********CNRQ      ANDNE'J'                                       CSW097
     C***********INTA      SUB  INTO      MGOIAM                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDINTA      MGOIAM                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*indicator*that*Our*side*settlement*was*processed.*******    CSW097
     C***********OURSET    IFEQ '0'                                       CSW097
     C***********UINPM     ANDEQ'D'                                       CSW097
     C***********OURSET    OREQ '0'                                       CSW097
     C***********UINPM     ANDEQ'Y'                                       CSW097
     C***********          MOVE '1'       OURSET                          CSW097
     C***********          Z-ADDINTA      OURIAM                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*up*available*date*field*which*is*used*to*find*the*correct   CSW097
      ****message*to*reference*on*a*refix******************************   CSW097
     C***********DVDAT     IFGT BJDNWD                                    CSW097
     C***********          Z-ADDDVDAT     MGAVDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********UNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDUNIPD     MGAVDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      MGAVDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          ENDSR                                          CSW097
      ***********                                                         CSW097
      */EJECT****                                                         CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***SR/SRIRTS*-*Process*settlement*record*for*IRS*-*Their*side.***   CSW097
      *****************************************************************   CSW097
      ***Called*by:*SR/SRIRS-*Determine*processing*type*for*IRS.*******   CSW097
      *****************************************************************   CSW097
      ***Calls:*SR/SRCURR*-*Access*SDCURRPD.***************************   CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***********                                                         CSW097
     C***********SRIRTS    BEGSR                                          CSW097
      ***********                                                         CSW097
      ****Their*currency*workfield.************************************   CSW097
     C***********          MOVE TCUCY     PKCCY                           CSW097
     C***********          Z-ADD013       DBASEP                          CSW097
     C***********          EXSR SRCURR                                    CSW097
     C***********          MOVE A6SWCY    MGTCCY                          CSW097
      ***********                                                         CSW097
      ****Their*current*principal*amount*workfield.********************   CSW097
     C***********          Z-ADDTPAMT     MGTPCL                          CSW097
      ***********                                                         CSW097
      ****Their*pay*date*workfield.************************************   CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********TINPM     ANDEQ'D'                                       CSW097
     C***********DVDAT     ORGE BJRDNB                                    CSW097
     C***********TINPM     ANDEQ'Y'                                       CSW097
     C***********          Z-ADDDVDAT     MGTPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********TNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDTNIPD     MGTPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      MGTPDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Our*pay*date*for*netting*comparison**************************   CSW097
     C***********UNIPD     IFEQ *ZEROS                                    CSW097
     C***********          Z-ADDMDAT      WWOPDT  50                      CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDUNIPD     WWOPDT                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Their*interest*payment*amount*workfield.*********************   CSW097
     C***********MGTPDT    IFEQ WWOPDT                                    CSW097
     C***********CNRQ      ANDNE'J'                                       CSW097
     C***********DVDAT     ORGE BJRDNB                                    CSW097
     C***********CNRQ      ANDNE'J'                                       CSW097
     C***********INTO      SUB  INTA      MGTIAM                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDINTO      MGTIAM                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*indicator*that*Their*side*settlement*was*processed.******   CSW097
     C***********THRSET    IFEQ '0'                                       CSW097
     C***********TINPM     ANDEQ'D'                                       CSW097
     C***********THRSET    OREQ '0'                                       CSW097
     C***********TINPM     ANDEQ'Y'                                       CSW097
     C***********          MOVE '1'       THRSET                          CSW097
     C***********          Z-ADDINTO      THRIAM                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*up*available*date*field*which*is*used*to*find*the*correct   CSW097
      ****message*to*reference*on*a*refix******************************   CSW097
     C***********DVDAT     IFGT BJDNWD                                    CSW097
     C***********          Z-ADDDVDAT     MGAVDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********TNIPD     IFNE 0                                         CSW097
     C***********          Z-ADDTNIPD     MGAVDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMDAT      MGAVDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
     C***********                                                         CSW097
     C***********          ENDSR                                          CSW097
      ***********                                                         CSW097
      */EJECT****                                                         CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***SR/SRIRUF*-*Process*rate*fix*record*for*IRS*-*Our*side.*******   CSW097
      *****************************************************************   CSW097
      ***Called*by:*SR/SRIRS-*Determine*processing*type*for*IRS.*******   CSW097
      *****************************************************************   CSW097
      ***Calls:*SR/SRCOMF*-*Set*up*rate*fixing*details.****************   CSW097
      **********SR/SRCURR*-*Access*SDCURRPD.***************************   CSW097
      **********SR/ZDLINT*-*Calculate*interest*accruing*between********   CSW097
      **********************two*dates.*********************************   CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***********                                                         CSW097
     C***********SRIRUF    BEGSR                                          CSW097
      ***********                                                         CSW097
      ****Interest*calculation*basis*workfield*parameter.**************   CSW097
     C***********          Z-ADDUICBS     CKCALB  10                      CSW097
      ***********                                                         CSW097
      ****Interest*payment*date*workfield*parameter.*******************   CSW097
     C***********          Z-ADDUNIPD     CKIPD   50                      CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*date*workfield*parameter.***************   CSW097
     C***********          Z-ADDUNICD     CKNICD  50                      CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*frequency*workfield*parameter.**********   CSW097
     C***********          MOVE UICFR     CKICFR  1                       CSW097
      ***********                                                         CSW097
      ****Our/Their*indicator*workfield*parameter.*********************   CSW097
     C***********          MOVE 'U'       CKOORT  1                       CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*frequency*day*workfield*parameter.******   CSW097
     C***********          Z-ADDUICFD     CKICFD  20                      CSW097
      ***********                                                         CSW097
      ****Settlement*method*workfield*parameter.***********************   CSW097
     C***********          Z-ADDPSTM      CKSETM  20                      CSW097
      ***********                                                         CSW097
      ****Currency*workfield*parameter.********************************   CSW097
     C***********          MOVE UCUCY     CKCCY   3                       CSW097
      ***********                                                         CSW097
      ****Pay/Receive*account*workfield*parameter.*********************   CSW097
     C***********          MOVELPONS      CKACC  12 P                     CSW097
      ***********                                                         CSW097
      ****Process*rate*fixing*details.*********************************   CSW097
     C***********          EXSR SRCOMF                                    CSW097
      ***********                                                         CSW097
      ****Set*rate*fix*fields*for*output*to*PF/MGF362PD.***************   CSW097
      ****Our*-*daycount*fraction,*current*rate*change*date,***********   CSW097
      ****next*rate*change*date,*base*rate*value,*spread*rate,*********   CSW097
      ****total*rate.**************************************************   CSW097
     C***********          MOVELCKDCF     MGODCF                          CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********          Z-ADDDVDAT     MGOCRD                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDUNICD     MGOCRD                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          SELEC                                          CSW097
      ***********                                                         CSW097
     C***********USPIN     WHEQ 'S'                                       CSW097
     C***********UFIR      ADD  URTSP     MGOBAR                          CSW097
     C***********          Z-SUBURTSP     MGOSPR                          CSW097
     C***********USPIN     WHEQ 'P'                                       CSW097
     C***********          Z-ADD*ZEROS    WSPRT  117                      CSW097
     C***********URTSP     DIV  100       WSPRT                           CSW097
     C***********          ADD  1         WSPRT                           CSW097
     C***********UFIR      DIV  WSPRT     MGOBAR                          CSW097
     C***********UFIR      SUB  MGOBAR    MGOSPR                          CSW097
     C***********          OTHER                                          CSW097
     C***********UFIR      SUB  URTSP     MGOBAR                          CSW097
     C***********          Z-ADDURTSP     MGOSPR                          CSW097
     C***********          ENDSL                                          CSW097
      ***********                                                         CSW097
     C***********UINPM     IFEQ 'D'                                       CSW097
     C***********UINPM     OREQ 'Y'                                       CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********          Z-ADDDVDAT     MGOPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDUNIPD     MGOPDT                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********UNICD     ORLT UNIPD                                     CSW097
      ***********                                                         CSW097
     C***********          Z-ADDUNIPD     MGOPDT                          CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Prepare*work*fields*to*set*up*payment*date*for*interest*in*arreaCSW097
     C***********          Z-ADDUNIPD     CKNIPD  50                      CSW097
     C***********          MOVE UIPFR     CKIPFR  1                       CSW097
     C***********          Z-ADDUIPFD     CKIPFD  20                      CSW097
     C***********          MOVELUINPM     CKINPM  1                       CSW097
      ***********                                                         CSW097
     C***********          EXSR SRPDAT                                    CSW097
     C***********          Z-ADDCKPDT     MGOPDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          Z-ADDUFIR      MGOTTR                          CSW097
      ***********                                                         CSW097
      ****Our*currency.************************************************   CSW097
     C***********          MOVE UCUCY     PKCCY                           CSW097
     C***********          Z-ADD014       DBASEP                          CSW097
     C***********          EXSR SRCURR                                    CSW097
     C***********          MOVE A6SWCY    MGOCCY                          CSW097
      ***********                                                         CSW097
      ****Our*projected*interest*amount.*                                 CSW097
      ************                                                        CSW097
     C************URSET    IFEQ '1'                                       CSW097
     C***********          Z-ADDOURIAM    MGOPIA                          CSW097
      ***********                                                         CSW097
      ****Use*SR/ZDLINT*to*calculate.*                                    CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ***Calculate*any*unpaid*interest*for*last*rate*period*if*interest*noCSW097
      ***up*front*                                                        CSW097
     C***********          Z-ADD0         WAITD                           CSW097
     C***********          Z-ADDUPAMT     ZDLAMT                          CSW097
     C***********CIR002    IFEQ 'Y'                                       CSW097
     C***********          ADD  OUSI      ZDLAMT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********UINPM     IFNE 'D'                                       CSW097
     C***********UINPM     ANDNE'Y'                                       CSW097
     C***********UNICD     ANDNEUNIPD                                     CSW097
     C***********          Z-ADDUEINR     ZDLRAT                          CSW097
     C***********UNICD     IFLT UNIPD                                     CSW097
     C***********          Z-ADDUIACD     ZCBSDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDUNIPD     ZCBSDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          Z-ADDMGOCRD    ZCBEDT                          CSW097
     C***********          Z-ADDUICBS     ZCBCBS                          CSW097
     C***********          EXSR ZDLINT                                    CSW097
      ***********                                                         CSW097
      ****Add*Interest*Accrued*to*Control*Date,*Accrued*Interest*Adj***   CSW097
      ****not*posted*and*accrued*Interest*Adj.*Posted*to*Interest*just*   CSW097
      ****calculated*to*give*accrued*interest*to*date******************   CSW097
      ***********                                                         CSW097
     C***********UNICD     IFLT UNIPD                                     CSW097
     C***********UAITC     ADD  UAIAN     WAITD  130                      CSW097
     C***********WAITD     ADD  UAIAP     WAITD                           CSW097
     C***********WAITD     ADD  ZDLOUT    WAITD                           CSW097
     C***********WAITD     SUB  UIPRD     WAITD                           CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDZDLOUT    WAITD                           CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Calculate*interest*for*the*current*period.*******************   CSW097
      ***********                                                         CSW097
     C***********          Z-ADDMGOTTR    ZDLRAT                          CSW097
     C***********          Z-ADDMGOCRD    ZCBSDT                          CSW097
     C***********UINPM     IFNE 'D'                                       CSW097
     C***********UINPM     ANDNE'Y'                                       CSW097
     C***********          Z-ADDMGOPDT    ZCBEDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMGONRD    ZCBEDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          Z-ADDUICBS     ZCBCBS                          CSW097
     C***********          EXSR ZDLINT                                    CSW097
      ***********                                                         CSW097
      ****Total*payment*amount*is*accrued*interest*to*date*plus********   CSW097
      ****interest*calculated*for*the*current*period.******************   CSW097
      ***********                                                         CSW097
     C***********ZDLOUT    ADD  WAITD     MGOPIA                          CSW097
      ***********                                                         CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Our*current*principal*amount.********************************   CSW097
     C***********          Z-ADDUPAMT     MGOPCL                          CSW097
      ***********                                                         CSW097
      ****Our*principal*payment*amount*if*Interest*Rates*Calendar******   CSW097
      ****feature*is*switched*on,*a*cross-ccy*deal*and*it*has**********   CSW097
      ****our*next*principal*change*date.******************************   CSW097
     C***********CIR001    IFEQ 'Y'                                       CSW097
     C***********DTYP      ANDEQ'RX'                                      CSW097
     C***********UNPCD     ANDGT*ZERO                                     CSW097
      ***********                                                         CSW097
      ****Note:**DDLNO*is*used*here.***********************************   CSW097
     C***********          MOVE 'U'       WOTIN                           CSW097
     C***********          Z-ADDUNICD     WPRDT                           CSW097
     C***********IRCKY1    CHAINDLPCSCD0             71                   CSW097
      ***********                                                         CSW097
     C************IN71     IFEQ '0'                                       CSW097
     C***********PDEI      ANDEQ'Y'                                       CSW097
     C***********UPAMT     SUB  PAMT      WKPAMT 130                      CSW097
     C***********WKPAMT    IFLT 0                                         CSW097
     C***********          Z-SUBWKPAMT    MGOPAM                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDWKPAMT    MGOPAM                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*up*available*date*field*which*is*used*to*find*the*correct   CSW097
      ****message*to*reference*on*a*refix******************************   CSW097
     C***********          Z-ADDUNICD     MGAVDT                          CSW097
      ***********                                                         CSW097
     C***********          ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      *                                                               *   CSW097
      *  SR/SRIRUF - Process rate fix record for IRS - Our side.      *   CSW097
      *                                                               *   CSW097
      *  Called by: SR/SRIRS- Determine processing type for IRS.      *   CSW097
      *                                                               *   CSW097
      *  Calls: SR/SRCOMF - Set up rate fixing details.               *   CSW097
      *         SR/SRCURR - Access SDCURRPD.                          *   CSW097
      *         SR/ZDLINT - Calculate interest accruing between       *   CSW097
      *                     two dates.                                *   CSW097
      *                                                               *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRIRUF    BEGSR                                          CSW097
      *                                                                   CSW097
      **  Our/Their indicator workfield parameter.                        CSW097
     C                     MOVE 'U'       ZOTIN   1                       CSW097
      *                                                                   CSW097
      **  Settlement method workfield parameter.                          CSW097
     C                     Z-ADDPSTM      ZFRSET                          CSW097
      *                                                                   CSW097
      **  Currency workfield parameter.                                   CSW097
     C**********           MOVE PSCY      ZSTCY                    CSW097 167426
     C                     MOVE PSCY      ZSTCY   3                       167426
     C                     MOVE UCUCY     ZFRCCY                          CSW097
      *                                                                   CSW097
      **  Pay/Receive account workfield parameter.                        CSW097
     C                     MOVELPONS      ZFRNOS    P                     CSW097
      *                                                                   CSW097
      **  Our currency.                                                   CSW097
     C                     MOVE UCUCY     PKCCY                           CSW097
     C                     Z-ADD014       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGOCCY                          CSW097
      *                                                                   CSW097
      **  Our current principal amount.                                   CSW097
     C                     Z-ADDUPAMT     MGOPCL                          CSW097
      *                                                                   CSW097
      ** If FRA Deal                                                      CSW097
     C           DTYP      IFEQ 'FR'                                      CSW097
      *                                                                   CSW097
     C           BYSL      IFEQ 'S'                                       CSW097
     C                     Z-ADDDVDAT     MGOCRD                          CSW097
     C                     Z-ADDMDAT      MGONRD                          CSW097
     C***********          Z-ADDUBRTE     MGOBAR                   CSW097 171312
     C                     Z-ADDUFIR      MGOBAR                          171312
     C                     Z-ADDURTSP     MGOSPR                          CSW097
     C                     Z-ADDUFIR      MGOTTR                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     Z-ADDINTA      MGOPIA                          CSW097
     C                     Z-ADDDVDAT     MGOPDT                          CSW097
      *                                                                   CSW097
      ** Otherwise , 'RS' and 'RX' deal                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   171312
     C                     TESTB'1'       ACEI           40               171312
     C                     TESTB'0'       UDNSI          41               171312
      *                                                                   CSW097
      ***Current*and*Next*Rate*Change*Date****************************                 CSW097 227642
     C*******for*the*initial*rate*fixing*period***********************                 171312 227642
     C***********DVDAT     IFGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C********** *IN40     IFEQ '0'                                                    171312 227642
     C********** *IN41     ANDEQ'1'                                                    171312 227642
     C********** DVDAT     ANDGEBJRDNB                                                 195928 215724
      *                                                                                       227642
      ** If event dare is equal to last int payment date, current                             227642
      ** period should be printed.                                                            227642
      *                                                                                       227642
     C           CVDAT     IFEQ USLIP                                                         227642
      *                                                                   CSW097
     C**********           Z-ADDDVDAT     MGOCRD                                       CSW097 227642
     C                     Z-ADDUSLIP     MGOCRD                                              227642
     C           UNICD     IFNE *ZERO                                     CSW097
     C                     Z-ADDUNICD     MGONRD                          CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDMDAT      MGONRD                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      ** Current and Next Rate Change Date                                171312
     C**     for the current rate fixing period                           171312
      *                                                                   176346
     C           UNICD     IFNE *ZERO                                     176346
     C                     Z-ADDUNICD     MGOCRD                          CSW097
     C                     MOVE 'R'       ZRCIP   1                       CSW097
     C                     Z-ADDMGOCRD    ZFRDAT                          CSW097
     C                     MOVE UICFR     ZFRFRQ                          CSW097
     C                     Z-ADDUICFD     ZFRBAS                          CSW097
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C                     MOVELL1PDCN    WPDCN   2                       CIR005
     C                     MOVELL1AMCN    WAMCN   2                       184003
     C                     MOVELL1CYP1    WCYP1                           CIR005
     C                     MOVELL1CYP2    WCYP2                           CIR005
     C                     MOVELL1CYP3    WCYP3                           CIR005
     C                     MOVELL1CYP4    WCYP4                           CIR005
     C                     MOVELL1CYP5    WCYP5                           CIR005
     C                     MOVELL1CYP6    WCYP6                           CIR005
     C                     MOVELL1CYP7    WCYP7                           CIR005
     C                     MOVELL1CYP8    WCYP8                           CIR005
     C                     MOVELL1CYP9    WCYP9                           CIR005
     C                     MOVELL1CYP0    WCYP0                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     EXSR SRCOMF                                    CSW097
     C                     Z-ADDZNXTD     MGONRD                          CSW097
      *                                                                   176346
     C                     ELSE                                           176346
     C                     Z-ADDDVDAT     MGOCRD                          176346
     C                     Z-ADDMDAT      MGONRD                          176346
     C                     ENDIF                                          176346
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Base and Spread Rate                                             CSW097
     C***********          TESTB'1'       ACEI           40        CSW097 171312
     C***********          TESTB'4'       CNFI           41        CSW097 171312
     C***********          TESTB'5'       CNFI           42        CSW097 171312
     C***********DVDAT     IFGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C************IN40     ANDEQ'0'                                CSW097 171312
     C********** *IN40     IFEQ '0'                                                  171312 BUG11267
     C********** *IN41     ANDEQ'1'                                                  CSW097 BUG11267
     C********** DVDAT     ANDGEBJRDNB                                                 195928 215724
     C********** UEINR     ANDNE0                                                   BUG5771 BUG11267
     C***********DVDAT     ORGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C************IN40     ANDEQ'0'                                CSW097 171312
     C************IN42     ANDEQ'1'                                CSW097 171312
     C           CVDAT     IFEQ USLIP                                                         227642
     C                     Z-ADDUFIR      MGOBAR                          CSW097
     C                     Z-ADD*ZERO     MGOSPR                          CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDUBRTE     MGOBAR                          CSW097
     C                     SELEC                                          171312
     C           USPIN     WHEQ 'P'                                       171312
     C           URTSP     DIV  100       WRTSPQ 117                      171312
     C           WRTSPQ    MULT UBRTE     MGOSPR                          171312
     C           USPIN     WHEQ 'S'                                       171312
     C***********USPIN     IFEQ 'S'                                CSW097 171312
     C                     Z-SUBURTSP     MGOSPR                          171312
     C                     OTHER                                          171312
     C***********          ELSE                                    CSW097 171312
     C                     Z-ADDURTSP     MGOSPR                          CSW097
     C                     ENDSL                                          171312
     C***********          ENDIF                                   CSW097 171312
     C                     ENDIF                                                              227642
      *                                                                   CSW097
      ** Effective Interest Rate                                          CSW097
     C                     Z-ADDUFIR      MGOTTR                          CSW097
      *                                                                   CSW097
      ** Next Payment Date after current rate change date                 CSW097
     C                     MOVE 'A'       WBEAF                           CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDMGOCRD    WPRDT                           CSW097
     C           OLXKY1    SETGTDLOLCFL1                                  CSW097
     C           OLXKY3    READEDLOLCFL1            N    60               CSW097
     C           *IN60     IFEQ *OFF                                      CSW097
     C                     Z-ADDCFPYDT    MGOPDT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Our Projected Interest Amount                                   CSW097
     C           MGOPDT    IFLE MGONRD                                    CSW097
     C                     Z-ADD*ZERO     W#TPIA 130                      CSW097
     C                     Z-ADD*ZERO     W#PCPL 130                      CSW097
     C                     Z-ADDMGOTTR    W#RATE 117                      CSW097
     C                     Z-ADDMGOCRD    W#SDAT  50                      CSW097
     C                     Z-ADDMGOPDT    W#EDAT  50                      CSW097
     C                     Z-ADDUICBS     W#ICBS  10                      CSW097
     C                     EXSR SRCPIA                                    CSW097
     C                     Z-ADDW#TPIA    MGOPIA                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Our principal payment amount if Interest Rates Calendar         CSW097
      **  feature is switched on, a cross-ccy deal and it has             CSW097
      **  our next principal change date.                                 CSW097
     C           CIR001    IFEQ 'Y'                                       CSW097
     C           DTYP      ANDEQ'RX'                                      CSW097
     C           UNPCD     ANDGT*ZERO                                     CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDMGOCRD    WPRDT                           CSW097
     C                     EXSR SRPAMT                                    CSW097
     C                     Z-ADDZZPAMT    MGOPAM                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                      BUG7873
     C           CIR001    IFEQ 'Y'                                                          BUG7873
     C           UNPCD     ANDGT0                                                            BUG7873
     C           UNPCD     ANDLEMGOCRD                                                       BUG7873
     C                     Z-ADDMGOCRD    WWPRDT                                             BUG7873
     C           DTYP      IFEQ 'RS'                                                         BUG7873
     C                     MOVE ' '       WWOTIN                                             BUG7873
     C                     ELSE                                                              BUG7873
     C                     MOVE 'U'       WWOTIN                                             BUG7873
     C                     ENDIF                                                             BUG7873
     C                     EXSR SRPCPL                                                       BUG7873
     C           ZZPCPL    IFNE 0                                                            BUG7873
     C                     Z-ADDZZPCPL    MGOPCL                                             BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                      BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C                     MOVE DDLNO     KDDLNO  6                                           CIR014
     C           DTYP      IFEQ 'RX'                                                          CIR014
     C           KDDLNO    CHAINDLDEALL5             55                                       CIR014
     C           *IN55     IFEQ *OFF                                                          CIR014
     C           F1PRVI    ANDEQ'O'                                                           CIR014
     C           F1NPRI    ANDNE*ZERO                                                         CIR014
     C                     Z-ADDF1NPRI    MGOPCL                                              CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                   CSW097
     C                     ENDIF                           DTYP = FR      CSW097
      *                                                                   CSW097
      **  Set up available date field which is used to find the correct   CSW097
      **  message to reference on a refix                                 CSW097
     C**********           Z-ADDUNICD     MGAVDT                                       CSW097 195306
     C                     Z-ADDMGOCRD    MGAVDT                                              195306
      *                                                                   CSW097
      **  Output to payment details file.                                 CSW097
     C                     MOVE 'E'       W#MSSQ  1                       CSW097
     C                     Z-ADDMGOCRD    W#CRDT  50                      CSW097
     C                     Z-ADDMGONRD    W#NRDT  50                      CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      */EJECT*                                                            CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***SR/SRIRTF*-*Process*rate*fix*record*for*IRS*-*Their*side.*****   CSW097
      *****************************************************************   CSW097
      ***Called*by:*SR/SRIRS-*Determine*processing*type*for*IRS.*******   CSW097
      *****************************************************************   CSW097
      ***Calls:*SR/SRCOMF*-*Set*up*rate*fixing*details.****************   CSW097
      **********SR/SRCURR*-*Access*SDCURRPD.***************************   CSW097
      **********SR/ZDLINT*-*Calculate*interest*accruing*between********   CSW097
      **********************two*dates.*********************************   CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***********                                                         CSW097
     C***********SRIRTF    BEGSR                                          CSW097
      ***********                                                         CSW097
      ****Interest*calculation*basis*workfield*parameter.**************   CSW097
     C***********          Z-ADDTICBS     CKCALB                          CSW097
      ***********                                                         CSW097
      ****Interest*payment*date*workfield*parameter.*******************   CSW097
     C***********          Z-ADDTNIPD     CKIPD                           CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*date*workfield*parameter.***************   CSW097
     C***********          Z-ADDTNICD     CKNICD                          CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*frequency*workfield*parameter.**********   CSW097
     C***********          MOVE TICFR     CKICFR                          CSW097
      ***********                                                         CSW097
      ****Our/Their*indicator*workfield*parameter.*********************   CSW097
     C***********          MOVE 'T'       CKOORT                          CSW097
      ***********                                                         CSW097
      ****Interest*rate*change*frequency*day*workfield*parameter.******   CSW097
     C***********          Z-ADDTICFD     CKICFD                          CSW097
      ***********                                                         CSW097
      ****Settlement*method*workfield*parameter.***********************   CSW097
     C***********          Z-ADDRSTM      CKSETM                          CSW097
      ***********                                                         CSW097
      ****Currency*workfield*parameter.********************************   CSW097
     C***********          MOVE TCUCY     CKCCY                           CSW097
      ***********                                                         CSW097
      ****Pay/Receive*account*workfield*parameter.*********************   CSW097
     C***********          MOVELRONS      CKACC     P                     CSW097
      ***********                                                         CSW097
      ****Process*rate*fixing*details.*********************************   CSW097
     C***********          EXSR SRCOMF                                    CSW097
      ***********                                                         CSW097
      ****Set*rate*fix*fields*for*output*to*PF/MGF362PD.***************   CSW097
      ****Their*-*daycount*fraction,*current*rate*change*date,*********   CSW097
      ****next*rate*change*date,*base*rate*value,*spread*rate,*********   CSW097
      ****total*rate.**************************************************   CSW097
     C***********          MOVELCKDCF     MGTDCF                          CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********          Z-ADDDVDAT     MGTCRD                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDTNICD     MGTCRD                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          Z-ADDCKNRD     MGTNRD                          CSW097
      ***********                                                         CSW097
     C***********          SELEC                                          CSW097
     C***********TSPIN     WHEQ 'S'                                       CSW097
     C***********TFIR      ADD  TRTSP     MGTBAR                          CSW097
     C***********          Z-SUBTRTSP     MGTSPR                          CSW097
      ***********                                                         CSW097
     C***********TSPIN     WHEQ 'P'                                       CSW097
     C***********          Z-ADD*ZEROS    WSPRT                           CSW097
     C***********TRTSP     DIV  100       WSPRT                           CSW097
     C***********          ADD  1         WSPRT                           CSW097
     C***********TFIR      DIV  WSPRT     MGTBAR                          CSW097
     C***********TFIR      SUB  MGTBAR    MGTSPR                          CSW097
     C***********          OTHER                                          CSW097
     C***********TFIR      SUB  TRTSP     MGTBAR                          CSW097
     C***********          Z-ADDTRTSP     MGTSPR                          CSW097
     C***********          ENDSL                                          CSW097
      ***********                                                         CSW097
     C***********TINPM     IFEQ 'D'                                       CSW097
     C***********TINPM     OREQ 'Y'                                       CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********          Z-ADDDVDAT     MGTPDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDTNIPD     MGTPDT                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
     C***********DVDAT     IFGE BJRDNB                                    CSW097
     C***********TNICD     ORLT TNIPD                                     CSW097
      ***********                                                         CSW097
     C***********          Z-ADDTNIPD     MGTPDT                          CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ****Prepare*work*fields*to*set*up*payment*date**for*interest*in*arreCSW097
     C***********          Z-ADDTNIPD     CKNIPD  50                      CSW097
     C***********          MOVE TIPFR     CKIPFR  1                       CSW097
     C***********          Z-ADDTIPFD     CKIPFD  20                      CSW097
     C***********          MOVELTINPM     CKINPM  1                       CSW097
      ***********                                                         CSW097
     C***********          EXSR SRPDAT                                    CSW097
     C***********          Z-ADDCKPDT     MGTPDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          Z-ADDTFIR      MGTTTR                          CSW097
      ***********                                                         CSW097
      ****Their*currency.**********************************************   CSW097
     C***********          MOVE TCUCY     PKCCY                           CSW097
     C***********          Z-ADD015       DBASEP                          CSW097
     C***********          EXSR SRCURR                                    CSW097
     C***********          MOVE A6SWCY    MGTCCY                          CSW097
      ***********                                                         CSW097
      ****Their*projected*interest*amount.*****************************   CSW097
     C***********THRSET    IFEQ '1'                                       CSW097
     C***********          Z-ADDTHRIAM    MGTPIA                          CSW097
      ***********                                                         CSW097
      ****Use*SR/ZDLINT*to*calculate.**********************************   CSW097
      ***********                                                         CSW097
     C***********          ELSE                                           CSW097
      ***********                                                         CSW097
      ***Calculate*any*unpaid*interest*for*last*rate*period*if*interest noCSW097
      ***up*front******************************************************   CSW097
      ***********                                                         CSW097
     C***********          Z-ADD0         WAITD  130                      CSW097
     C***********          Z-ADDTPAMT     ZDLAMT                          CSW097
     C***********CIR002    IFEQ 'Y'                                       CSW097
     C***********          ADD  TUSI      ZDLAMT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********TINPM     IFNE 'D'                                       CSW097
     C***********TINPM     ANDNE'Y'                                       CSW097
     C***********TNICD     ANDNETNIPD                                     CSW097
     C***********          Z-ADDTEINR     ZDLRAT                          CSW097
     C***********TNICD     IFLT TNIPD                                     CSW097
     C***********          Z-ADDTIACD     ZCBSDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDUNIPD     ZCBSDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          Z-ADDMGTCRD    ZCBEDT                          CSW097
     C***********          Z-ADDTICBS     ZCBCBS                          CSW097
     C***********          EXSR ZDLINT                                    CSW097
      ***********                                                         CSW097
      ****Add*Interest*Accrued*to*Control*Date,*Accrued*Interest*Adj***   CSW097
      ****not*posted*and*accrued*Interest*Adj.*Posted*to*Interest*just*   CSW097
      ****Calculated*to*give*accrued*interest*to*date******************   CSW097
      ***********                                                         CSW097
     C***********TNICD     IFLT TNIPD                                     CSW097
     C***********TAITC     ADD  TAIAN     WAITD  130                      CSW097
     C***********WAITD     ADD  TAIAP     WAITD                           CSW097
     C***********WAITD     ADD  ZDLOUT    WAITD                           CSW097
     C***********WAITD     SUB  TIPRD     WAITD                           CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDZDLOUT    WAITD                           CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Calculate*interest*for*the*current*period.*******************   CSW097
      ***********                                                         CSW097
     C***********          Z-ADDMGTTTR    ZDLRAT                          CSW097
     C***********          Z-ADDMGTCRD    ZCBSDT                          CSW097
     C***********TINPM     IFNE 'D'                                       CSW097
     C***********TINPM     ANDNE'Y'                                       CSW097
     C***********          Z-ADDMGTPDT    ZCBEDT                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDMGTNRD    ZCBEDT                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          Z-ADDTICBS     ZCBCBS                          CSW097
     C***********          EXSR ZDLINT                                    CSW097
      ***********                                                         CSW097
      ****Total*payment*amount*is*accrued*interest*to*date*plus********   CSW097
      ****interest*calculated*for*the*current*period.******************   CSW097
      ***********                                                         CSW097
     C***********WAITD     ADD  ZDLOUT    MGTPIA                          CSW097
      ***********                                                         CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Their*current*principal*amount.******************************   CSW097
     C***********          Z-ADDTPAMT     MGTPCL                          CSW097
      ***********                                                         CSW097
      ****Their*principal*payment*amount*if*Interest*Rates*Calendar****   CSW097
      ****feature*is*switched*on,*a*cross-ccy*deal*and*it*has**********   CSW097
      ****our*next*principal*change*date.******************************   CSW097
     C***********CIR001    IFEQ 'Y'                                       CSW097
     C***********DTYP      ANDEQ'RX'                                      CSW097
     C***********TNPCD     ANDGT*ZERO                                     CSW097
      ***********                                                         CSW097
      ****Note:**DDLNO*is*used*here.***********************************   CSW097
     C***********          MOVE 'T'       WOTIN                           CSW097
     C***********          Z-ADDTNICD     WPRDT                           CSW097
     C***********IRCKY1    CHAINDLPCSCD0             71                   CSW097
      ***********                                                         CSW097
     C************IN71     IFEQ '0'                                       CSW097
     C***********PDEI      ANDEQ'Y'                                       CSW097
     C***********TPAMT     SUB  PAMT      WKPAMT                          CSW097
     C***********WKPAMT    IFLT 0                                         CSW097
     C***********          Z-SUBWKPAMT    MGTPAM                          CSW097
     C***********          ELSE                                           CSW097
     C***********          Z-ADDWKPAMT    MGTPAM                          CSW097
     C***********          ENDIF                                          CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
     C***********          ENDIF                                          CSW097
      ***********                                                         CSW097
      ****Set*up*available*date*field*which*is*used*to*find*the*correct   CSW097
      ****message*to*reference*on*a*refix******************************   CSW097
     C***********          Z-ADDTNICD     MGAVDT                          CSW097
      ***********                                                         CSW097
     C***********          ENDSR                                          CSW097
      *****************************************************************   CSW097
     C/EJECT                                                              CSW097
      *****************************************************************   CSW097
      *                                                               *   CSW097
      *  SR/SRIRTF - Process rate fix record for IRS - Their side.    *   CSW097
      *                                                               *   CSW097
      *  Called by: SR/SRIRS- Determine processing type for IRS.      *   CSW097
      *                                                               *   CSW097
      *  Calls: SR/SRCOMF - Set up rate fixing details.               *   CSW097
      *         SR/SRCURR - Access SDCURRPD.                          *   CSW097
      *         SR/ZDLINT - Calculate interest accruing between       *   CSW097
      *                     two dates.                                *   CSW097
      *                                                               *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRIRTF    BEGSR                                          CSW097
      *                                                                   CSW097
      **  Our/Their indicator workfield parameter.                        CSW097
     C                     MOVE 'T'       ZOTIN                           CSW097
      *                                                                   CSW097
      **  Settlement method workfield parameter.                          CSW097
     C                     Z-ADDRSTM      ZFRSET                          CSW097
      *                                                                   CSW097
      **  Currency workfield parameter.                                   CSW097
     C                     MOVE RSCY      ZSTCY                           CSW097
     C                     MOVE TCUCY     ZFRCCY                          CSW097
      *                                                                   CSW097
      **  Pay/Receive account workfield parameter.                        CSW097
     C                     MOVELRONS      ZFRNOS    P                     CSW097
      *                                                                   CSW097
      **  Their currency.                                                 CSW097
     C                     MOVE TCUCY     PKCCY                           CSW097
     C                     Z-ADD015       DBASEP                          CSW097
     C                     EXSR SRCURR                                    CSW097
     C                     MOVE A6SWCY    MGTCCY                          CSW097
      *                                                                   CSW097
      ** Their current principal amount.                                  CSW097
     C                     Z-ADDTPAMT     MGTPCL                          CSW097
      *                                                                   CSW097
      ** If FRA deal                                                      CSW097
     C           DTYP      IFEQ 'FR'                                      CSW097
      *                                                                   CSW097
     C           BYSL      IFEQ 'B'                                       CSW097
     C                     Z-ADDDVDAT     MGTCRD                          CSW097
     C                     Z-ADDMDAT      MGTNRD                          CSW097
     C***********          Z-ADDTBRTE     MGTBAR                   CSW097 171312
     C                     Z-ADDTFIR      MGTBAR                          171312
     C                     Z-ADDTRTSP     MGTSPR                          CSW097
     C                     Z-ADDTFIR      MGTTTR                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     Z-ADDINTO      MGTPIA                          CSW097
     C                     Z-ADDDVDAT     MGTPDT                          CSW097
      *                                                                   CSW097
      ** Otherwise, "RS" and "RX"                                         CSW097
     C                     ELSE                                           CSW097
      *                                                                   171312
     C                     TESTB'1'       ACEI           40               171312
     C                     TESTB'0'       TDNSI          41               171312
      *                                                                   CSW097
      ***Current*and*Next*Rate*Change*Date****************************                 CSW097 227642
     C*******for*the*initial*rate*fixing*period***********************                 171312 227642
     C********** *IN40     IFEQ '0'                                                    171312 227642
     C********** *IN41     ANDEQ'1'                                                    171312 227642
     C********** DVDAT     ANDGEBJRDNB                                                 195928 215724
     C***********DVDAT     IFGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C           CVDAT     IFEQ TSLIP                                                         227642
      *                                                                   CSW097
     C**********           Z-ADDDVDAT     MGTCRD                          CSW097              227642
     C                     Z-ADDTSLIP     MGTCRD                                              227642
     C           TNICD     IFNE *ZERO                                     CSW097
     C                     Z-ADDTNICD     MGTNRD                          CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDMDAT      MGTNRD                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   176346
     C           TNICD     IFNE *ZERO                                     176346
     C                     Z-ADDTNICD     MGTCRD                          CSW097
     C                     MOVE 'R'       ZRCIP                           CSW097
     C                     Z-ADDMGTCRD    ZFRDAT                          CSW097
     C                     MOVE TICFR     ZFRFRQ                          CSW097
     C                     Z-ADDTICFD     ZFRBAS                          CSW097
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           DTYP      IFEQ 'RX'                                      CIR005
     C                     MOVELL2PDCN    WPDCN                           CIR005
     C                     MOVELL2AMCN    WAMCN                           184003
     C                     MOVELL2CYP1    WCYP1                           CIR005
     C                     MOVELL2CYP2    WCYP2                           CIR005
     C                     MOVELL2CYP3    WCYP3                           CIR005
     C                     MOVELL2CYP4    WCYP4                           CIR005
     C                     MOVELL2CYP5    WCYP5                           CIR005
     C                     MOVELL2CYP6    WCYP6                           CIR005
     C                     MOVELL2CYP7    WCYP7                           CIR005
     C                     MOVELL2CYP8    WCYP8                           CIR005
     C                     MOVELL2CYP9    WCYP9                           CIR005
     C                     MOVELL2CYP0    WCYP0                           CIR005
     C                     ELSE                                           CIR005
     C                     MOVELL1PDCN    WPDCN                           CIR005
     C                     MOVELL1AMCN    WAMCN                           184003
     C                     MOVELL1CYP1    WCYP1                           CIR005
     C                     MOVELL1CYP2    WCYP2                           CIR005
     C                     MOVELL1CYP3    WCYP3                           CIR005
     C                     MOVELL1CYP4    WCYP4                           CIR005
     C                     MOVELL1CYP5    WCYP5                           CIR005
     C                     MOVELL1CYP6    WCYP6                           CIR005
     C                     MOVELL1CYP7    WCYP7                           CIR005
     C                     MOVELL1CYP8    WCYP8                           CIR005
     C                     MOVELL1CYP9    WCYP9                           CIR005
     C                     MOVELL1CYP0    WCYP0                           CIR005
     C                     ENDIF                                          CIR005
      *                                                                                       CIR017
     C           CIR017    IFEQ 'Y'                                                           CIR017
     C           DTYP      ANDEQ'RS'                                                          CIR017
     C                     MOVE L2PDCN    WPDCN                                               CIR017
     C                     MOVE L2AMCN    WAMCN                                               CIR017
     C                     ENDIF                                                              CIR017
      *                                                                                       CIR017
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     EXSR SRCOMF                                    CSW097
     C                     Z-ADDZNXTD     MGTNRD                          CSW097
      *                                                                   176346
     C                     ELSE                                           176346
     C                     Z-ADDDVDAT     MGTCRD                          176346
     C                     Z-ADDMDAT      MGTNRD                          176346
     C                     ENDIF                                          176346
      *                                                                   176346
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Base and Spread Rate                                             CSW097
     C***********          TESTB'1'       ACEI           40        CSW097 171312
     C***********          TESTB'4'       CNFI           41        CSW097 171312
     C***********          TESTB'5'       CNFI           42        CSW097 171312
     C***********DVDAT     IFGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C************IN40     ANDEQ'0'                                CSW097 171312
     C********** *IN40     IFEQ '0'                                                  171312 BUG11267
     C********** *IN41     ANDEQ'1'                                                  CSW097 BUG11267
     C********** DVDAT     ANDGEBJRDNB                                                 195928 215724
     C********** TEINR     ANDNE0                                                   BUG5771 BUG11267
     C***********DVDAT     ORGE BJRDNB                             CSW097 171312
     C***********DVDAT     ANDEQCVDAT                              CSW097 171312
     C************IN40     ANDEQ'0'                                CSW097 171312
     C************IN42     ANDEQ'1'                                CSW097 171312
     C           CVDAT     IFEQ TSLIP                                                         227642
     C                     Z-ADDTFIR      MGTBAR                          CSW097
     C                     Z-ADD*ZERO     MGTSPR                          CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDTBRTE     MGTBAR                          CSW097
     C                     SELEC                                          171312
     C           TSPIN     WHEQ 'P'                                       171312
     C           TRTSP     DIV  100       WRTSPQ                          171312
     C           WRTSPQ    MULT TBRTE     MGTSPR                          171312
     C           TSPIN     WHEQ 'S'                                       171312
     C***********TSPIN     IFEQ 'S'                                CSW097 171312
     C                     Z-SUBTRTSP     MGTSPR                          CSW097
     C                     OTHER                                          171312
     C***********          ELSE                                    CSW097 171312
     C                     Z-ADDTRTSP     MGTSPR                          CSW097
     C                     ENDSL                                          171312
     C***********          ENDIF                                   CSW097 171312
     C                     ENDIF                                                              227642
      *                                                                   CSW097
      ** Effective Interest Rate                                          CSW097
     C                     Z-ADDTFIR      MGTTTR                          CSW097
      *                                                                   CSW097
      ** Payment Date                                                     CSW097
     C                     MOVE 'A'       WBEAF                           CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDMGTCRD    WPRDT                           CSW097
     C           OLXKY1    SETGTDLOLCFL1                                  CSW097
     C           OLXKY3    READEDLOLCFL1            N    60               CSW097
     C           *IN60     IFEQ *OFF                                      CSW097
     C                     Z-ADDCFPYDT    MGTPDT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Their Projected Interest Amount                                  CSW097
     C           MGTPDT    IFLE MGTNRD                                    CSW097
     C                     Z-ADD*ZERO     W#TPIA 130                      CSW097
     C                     Z-ADD*ZERO     W#PCPL 130                      CSW097
     C                     Z-ADDMGTTTR    W#RATE 117                      CSW097
     C                     Z-ADDMGTCRD    W#SDAT  50                      CSW097
     C                     Z-ADDMGTPDT    W#EDAT  50                      CSW097
     C                     Z-ADDTICBS     W#ICBS  10                      CSW097
     C                     EXSR SRCPIA                                    CSW097
     C                     Z-ADDW#TPIA    MGTPIA                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      **  Their principal payment amount if Interest Rates Calendar       CSW097
      **  feature is switched on, a cross-ccy deal and it has             CSW097
      **  our next principal change date.                                 CSW097
     C           CIR001    IFEQ 'Y'                                       CSW097
     C           DTYP      ANDEQ'RX'                                      CSW097
     C           TNPCD     ANDGT*ZERO                                     CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDMGTCRD    WPRDT                           CSW097
     C                     EXSR SRPAMT                                    CSW097
     C                     Z-ADDZZPAMT    MGTPAM                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                      BUG7873
     C           CIR001    IFEQ 'Y'                                                          BUG7873
     C           TNPCD     ANDGT0                                                            BUG7873
     C           TNPCD     ANDLEMGTCRD                                                       BUG7873
     C                     Z-ADDMGTCRD    WWPRDT                                             BUG7873
     C           DTYP      IFEQ 'RS'                                                         BUG7873
     C                     MOVE ' '       WWOTIN                                             BUG7873
     C                     ELSE                                                              BUG7873
     C                     MOVE 'T'       WWOTIN                                             BUG7873
     C                     ENDIF                                                             BUG7873
     C                     EXSR SRPCPL                                                       BUG7873
     C           ZZPCPL    IFNE 0                                                            BUG7873
     C                     Z-ADDZZPCPL    MGTPCL                                             BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                      BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                       CIR014
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C                     MOVE DDLNO     KDDLNO                                              CIR014
     C           DTYP      IFEQ 'RX'                                                          CIR014
     C           KDDLNO    CHAINDLDEALL5             55                                       CIR014
     C           *IN55     IFEQ *OFF                                                          CIR014
     C           F1PRVI    ANDEQ'T'                                                           CIR014
     C           F1NPRI    ANDNE*ZERO                                                         CIR014
     C                     Z-ADDF1NPRI    MGTPCL                                              CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
     C                     ENDIF                                                              CIR014
      *                                                                   CSW097
     C                     ENDIF                           DTYP = FR      CSW097
      *                                                                   CSW097
      **  Set up available date field which is used to find the correct   CSW097
      **  message to reference on a refix                                 CSW097
     C**********           Z-ADDTNICD     MGAVDT                                       CSW097 195306
     C                     Z-ADDMGTCRD    MGAVDT                                              195306
      *                                                                   CSW097
      **  Output to payment details file.                                 CSW097
     C                     MOVE 'C'       W#MSSQ                          CSW097
     C                     Z-ADDMGTCRD    W#CRDT                          CSW097
     C                     Z-ADDMGTNRD    W#NRDT                          CSW097
     C                     EXSR SRY36N                                    CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCOMF - Common Routine - Set Up Rate Fixing Details.     *
      *                                                               *
      *  Called by: SR/SRIRUF - Process rate fix for IRS - Our        *
      *             SR/SRIRTF - Process rate fix for IRS - Their      *
      *                                                               *
      *  Calls: RPG/DLZFRQ - IR Dealing Frequency Calculation.        *
      *                                                               *
      *****************************************************************
      *
     C           SRCOMF    BEGSR
      *
      ****Daycount*workfield*comes*from*the*table*DCF.*                             CSW097
     C***********          MOVELDCF,CKCALBCKDCF   7                                 CSW097
      ***********                                                                   CSW097
      ****If*value*date*has*not*gone*past*yet,*                                     CSW097
      ***********                                                                   CSW097
     C***********DVDAT     IFGE BJRDNB                                              CSW097
      ***********                                                                   CSW097
     C***********          Z-ADDCKIPD     CKNRD                                     CSW097
      ***********                                                                   CSW097
     C***********          ELSE                                                     CSW097
      ***********                                                                   CSW097
      ****Next*rate*change*date*workfield.*                                         CSW097
     C***********CIR001    IFEQ 'Y'                                                 CSW097
     C***********CKICFR    ANDEQ'Z'                                                 CSW097
      ***********                                                                   CSW097
      ****Access*PF/DLDTSCPD.**Note:**DDLNO*is*used*here.*                          CSW097
     C***********          MOVE CKOORT    WOTIN                                     CSW097
     C***********          MOVE 'R'       WRCIP                                     CSW097
     C***********          Z-ADDCKNICD    WPRDT                                     CSW097
     C***********IRCKY2    SETGTDLDTSCD0                                            CSW097
     C***********          READ DLDTSCD0                 71                         CSW097
     C************IN71     IFEQ '0'                                                 CSW097
     C***********DDLNO     ANDEQDLNO                                                CSW097
     C***********WOTIN     ANDEQOTIN                                                CSW097
     C***********WRCIP     ANDEQRCIP                                                CSW097
     C***********          Z-ADDPRDT      CKNRD   50                                CSW097
     C***********          ELSE                                                     CSW097
     C***********          Z-ADDMDAT      CKNRD                                     CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
      ****Otherwise,*call*RPG/DLZFRQ*to*calculate.*                                 CSW097
     C***********          ELSE                                                     CSW097
      ***********                                                                   CSW097
      ****Determine*next*interest*payment*according*to*frequency*                   CSW097
     C***********          CALL 'DLZFRQ'                                            CSW097
     C***********          PARM *BLANK    ZFRRTC  5                                 CSW097
     C***********          PARM CKNICD    ZFRDAT  50       * DATE                   CSW097
     C***********          PARM CKICFR    ZFRFRQ  1        * FREQUENCY              CSW097
     C***********          PARM CKICFD    ZFRBAS  20       * BASE DAY               CSW097
     C***********          PARM CKSETM    ZFRSET  20       * SETT.METH.             CSW097
     C***********          PARM CKCCY     ZFRCCY  3        * CURRENCY               CSW097
     C***********          PARM CKACC     ZFRNOS  2        * NOSTRO                 CSW097
     C***********          PARM MDAT      ZFRMDT  50       * MAT.DATE               CSW097
     C***********          PARM           BKAPDT                                    CSW097
     C***********          PARM           BJSLCD                                    CSW097
     C***********          PARM           BJLCCY                                    CSW097
     C***********          PARM *ZERO     ZFRNXD  50       * NEXT DATE              CSW097
      ***********                                                                   CSW097
     C***********ZFRRTC    IFEQ '*ERR*'                                             CSW097
     C************LOCK     IN   LDA                                                 CSW097
     C***********          Z-ADD016       DBASE            * * * * * * * *          CSW097
     C***********          MOVELZFRRTC    DBKEY     P      *  DBERR 016  *          CSW097
     C***********          MOVEL'DLZFRQ'  DBFILE    P      * * * * * * * *          CSW097
     C***********          OUT  LDA                                                 CSW097
     C***********          EXSR *PSSR                                               CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
      ****New*interest*date*                                                        CSW097
     C***********ZFRNXD    IFLT MDAT                                                CSW097
     C***********          Z-ADDZFRNXD    CKNRD                                     CSW097
     C***********          ELSE                                                     CSW097
     C***********          Z-ADDMDAT      CKNRD                                     CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
     C***********          ENDIF                                                    CSW097
      *                                                                             CSW097
      ** Determine Next Rate Change/Int Payment Date from a given date              CSW097
     C           CIR001    IFEQ 'Y'                                                 CSW097
     C           ZFRFRQ    ANDEQ'Z'                                                 CSW097
      *                                                                             CSW097
      **  Access PF/DLDTSCPD.  Note:  DDLNO is used here.                           CSW097
     C                     MOVE ZOTIN     WOTIN                                     CSW097
     C                     MOVE ZRCIP     WRCIP                                     CSW097
     C                     Z-ADDZFRDAT    WPRDT                                     CSW097
     C           IRCKY2    SETGTDLDTSCD0                                            CSW097
     C                     READ DLDTSCD0                 71                         CSW097
     C           *IN71     IFEQ '0'                                                 CSW097
     C           DDLNO     ANDEQDLNO                                                CSW097
     C           WOTIN     ANDEQOTIN                                                CSW097
     C           WRCIP     ANDEQRCIP                                                CSW097
     C                     Z-ADDPRDT      ZNXTD   50                                CSW097
     C                     ELSE                                                     CSW097
     C                     Z-ADDMDAT      ZNXTD                                     CSW097
     C                     ENDIF                                                    CSW097
      *                                                                             CSW097
      **  Otherwise, call RPG/DLZFRQ to calculate.                                  CSW097
     C                     ELSE                                                     CSW097
      *                                                                                       CIR018
      ** If Daily Rate Change Frequency then simply add 1 to next                             CIR018
      ** change date                                                                          CIR018
     C           CIR018    IFEQ 'Y'                                                           CIR018
     C           ZFRFRQ    ANDEQ'D'                                                           CIR018
     C           ZFRDAT    ADD  1         ZFRNXD                                              CIR018
     C                     ELSE                                                               CIR018
      *                                                                   CIR005
     C           CIR005    IFEQ 'Y'                                       CIR005
     C           WCYP1     ANDNE*BLANKS                                   CIR005
     C           ZFRFRQ    IFEQ *BLANKS                                   CIR005
     C                     Z-ADDMDAT      ZFRNXD                          CIR005
     C                     ELSE                                           CIR005
     C                     Z-ADDZFRBAS    ZMDAY                           CIR005
     C                     Z-ADDZFRDAT    ZDAYNO                          CIR005
     C                     MOVELZFRFRQ    ZFREQ                           CIR005
     C                     MOVELBJSLCD    ZLOC                            CIR005
     C                     EXSR ZFRQB3                                    CIR005
      *                                                                   CIR005
     C                     CALL 'DLZIRP'                                  CIR005
     C                     PARM           ZDAYNO                          CIR005
     C                     PARM WCCYD2    PCURR                           CIR005
     C                     PARM WPDCN     PPDCN   2                       CIR005
     C                     PARM ZLOC      PLOCN                           CIR005
     C                     PARM           BJDFIN                          CIR005
     C                     PARM *ZEROS    PAJDT   50                      CIR005
     C                     PARM *ZEROS    PBSDT   50                      CIR005
      *                                                                   CIR005
     C                     Z-ADDPAJDT     ZFRNXD                          CIR005
      *                                                                   CIR005
      ** Do not return adjusted date if it is equal to or earlier than    CIR005
      ** previous date (only happens for 'previous' date calculations);   CIR005
      ** instead use the base date                                        CIR005
      *                                                                   CIR005
     C           ZFRDAT    IFGE ZFRNXD                                    CIR005
     C           PBSDT     ORLT PAJDT                                     184003
     C           WAMCN     ANDEQ'A '                                      184003
     C                     Z-ADDPBSDT     ZFRNXD                          CIR005
     C                     ENDIF                                          CIR005
     C                     ENDIF                                          CIR005
      *                                                                   CIR005
     C                     ELSE                                           CIR005
      *                                                                             CSW097
      **  Determine next interest payment according to frequency                    CSW097
     C                     CALL 'DLZFRQ'                                            CSW097
     C                     PARM *BLANK    ZFRRTC  5                                 CSW097
     C                     PARM           ZFRDAT  50       * DATE                   CSW097
     C                     PARM           ZFRFRQ  1        * FREQUENCY              CSW097
     C                     PARM           ZFRBAS  20       * BASE DAY               CSW097
     C                     PARM           ZFRSET  20       * SETT.METH.             CSW097
     C                     PARM           ZFRCCY  3        * CURRENCY               CSW097
     C**********           PARM           ZSTCY   3        * SETTL CCY       CSW097 167426
     C**********           PARM 'P'       ZRCIP   1        * R/P             CSW097 167426
     C                     PARM           ZSTCY   3        * SETTL CCY    171312
     C                     PARM 'P'       ZRCIP   1        * R/P          171312
     C                     PARM           ZFRNOS  2        * NOSTRO                 CSW097
     C                     PARM MDAT      ZFRMDT  50       * MAT.DATE               CSW097
     C                     PARM           BKAPDT                                    CSW097
     C                     PARM           BJSLCD                                    CSW097
     C                     PARM           BJLCCY                                    CSW097
     C                     PARM *ZERO     ZFRZBD  50       * BASE DATE    180466
     C                     PARM *ZERO     ZFRNXD  50       * NEXT DATE              CSW097
      *                                                                             CSW097
     C           ZFRRTC    IFEQ '*ERR*'                                             CSW097
     C           *LOCK     IN   LDA                                                 CSW097
     C                     Z-ADD016       DBASE            * * * * * * * *          CSW097
     C                     MOVELZFRRTC    DBKEY     P      *  DBERR 016  *          CSW097
     C                     MOVEL'DLZFRQ'  DBFILE    P      * * * * * * * *          CSW097
     C                     OUT  LDA                                                 CSW097
     C                     EXSR *PSSR                                               CSW097
     C                     ENDIF                                                    CSW097
     C                     ENDIF                                          CIR005
     C*                                                                                       CIR018
     C                     ENDIF                                                              CIR018
      *                                                                             CSW097
      **  New interest date                                                         CSW097
     C           ZFRNXD    IFLT MDAT                                                CSW097
     C                     Z-ADDZFRNXD    ZNXTD                                     CSW097
     C                     ELSE                                                     CSW097
     C                     Z-ADDMDAT      ZNXTD                                     CSW097
     C                     ENDIF                                                    CSW097
      *                                                                             CSW097
     C                     ENDIF                                                    CSW097
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************             CSW097
      *****************************************************************             CSW097
      ***SR/SRPDAT*-*Common*Routine*-*Set*Up*Payment*date**************             CSW097
      *****************************************************************             CSW097
      ***Called*by:*SR/SRIRUF*-*Process*rate*fix*for*IRS*-*Our*********             CSW097
      **************SR/SRIRTF*-*Process*rate*fix*for*IRS*-*Their*******             CSW097
      *****************************************************************             CSW097
      ***Calls:*RPG/DLZFRQ*-*IR*Dealing*Frequency*Calculation.*********             CSW097
      *****************************************************************             CSW097
      *****************************************************************             CSW097
      ***********                                                                   CSW097
     C***********SRPDAT    BEGSR                                                    CSW097
      ***********                                                                   CSW097
      ****Next*Pay*date*date*workfield.********************************             CSW097
     C***********CIR001    IFEQ 'Y'                                                 CSW097
     C***********CKIPFR    ANDEQ'Z'                                                 CSW097
      ***********                                                                   CSW097
      ****Access*PF/DLDTSCPD.**Note:**DDLNO*is*used*here.**************             CSW097
     C***********          MOVE CKOORT    WOTIN                                     CSW097
     C***********          MOVE 'P'       WRCIP                                     CSW097
     C***********          Z-ADDCKNIPD    WPRDT                                     CSW097
     C***********IRCKY2    SETGTDLDTSCD0                                            CSW097
     C***********          READ DLDTSCD0                 71                         CSW097
      ***********                                                                   CSW097
     C************IN71     IFEQ '0'                                                 CSW097
     C***********DDLNO     ANDEQDLNO                                                CSW097
     C***********WOTIN     ANDEQOTIN                                                CSW097
     C***********WRCIP     ANDEQRCIP                                                CSW097
     C***********          Z-ADDPRDT      CKPDT   50                                CSW097
     C***********          ELSE                                                     CSW097
     C***********          Z-ADDMDAT      CKPDT                                     CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
      ****Otherwise,*call*RPG/DLZFRQ*to*calculate.*********************             CSW097
     C***********          ELSE                                                     CSW097
      ***********                                                                   CSW097
      ****Determine*next*interest*payment*according*to*frequency*******             CSW097
     C***********          CALL 'DLZFRQ'                                            CSW097
     C***********          PARM *BLANK    ZFRRTC  5                                 CSW097
     C***********          PARM CKNIPD    ZFRDAT  50       * DATE                   CSW097
     C***********          PARM CKIPFR    ZFRFRQ  1        * FREQUENCY              CSW097
     C***********          PARM CKIPFD    ZFRBAS  20       * BASE DAY               CSW097
     C***********          PARM CKSETM    ZFRSET  20       * SETT.METH.             CSW097
     C***********          PARM CKCCY     ZFRCCY  3        * CURRENCY               CSW097
     C***********          PARM CKACC     ZFRNOS  2        * NOSTRO                 CSW097
     C***********          PARM MDAT      ZFRMDT  50       * MAT.DATE               CSW097
     C***********          PARM           BKAPDT                                    CSW097
     C***********          PARM           BJSLCD                                    CSW097
     C***********          PARM           BJLCCY                                    CSW097
     C***********          PARM *ZERO     ZFRNXD  50       * NEXT DATE              CSW097
      ***********                                                                   CSW097
     C***********ZFRRTC    IFEQ '*ERR*'                                             CSW097
     C************LOCK     IN   LDA                                                 CSW097
     C***********          Z-ADD017       DBASE            * * * * * * * *          CSW097
     C***********          MOVELZFRRTC    DBKEY     P      *  DBERR 017  *          CSW097
     C***********          MOVEL'DLZFRQ'  DBFILE    P      * * * * * * * *          CSW097
     C***********          OUT  LDA                                                 CSW097
     C***********          EXSR *PSSR                                               CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
      ****New*interest*date********************************************             CSW097
     C***********ZFRNXD    IFLT MDAT                                                CSW097
     C***********          Z-ADDZFRNXD    CKPDT                                     CSW097
     C***********          ELSE                                                     CSW097
     C***********          Z-ADDMDAT      CKPDT                                     CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
     C***********          ENDIF                                                    CSW097
      ***********                                                                   CSW097
     C***********          ENDSR                                                    CSW097
      *****************************************************************             CSW097
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCOMO - Output common GDF fields.                        *
      *                                                               *
      *  Called by: SR/SRFRA  - Process record for FRA.               *
      *             SR/SRIRS  - Determine processing type for IRS.    *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRCOMO    BEGSR
      *
      **  Branch code, customer number, module ID, transaction number,
      **  transaction date, maturity date.
     C                     MOVELDBRCA     MGBRCA
     C**********           Z-ADDCNUM      MGCNUM                                              CSD027
     C                     MOVE CNUM      MGCNUM                                              CSD027
     C                     MOVE 'FI'      MGMODI
     C                     MOVELDDLNO     MGTNUM
     C                     Z-ADDDDAT      MGTDAT
     C                     Z-ADDMDAT      MGMDAT
      *
      **  Sender to Receiver information lines.
     C                     MOVELSSR1      MGS2R1
     C                     MOVELSSR2      MGS2R2
     C                     MOVELSSR3      MGS2R3
     C                     MOVELSSR4      MGS2R4
     C                     MOVELSSR5      MGS2R5
     C                     MOVELSSR6      MGS2R6
      *
      **  Pay-our nostro, receiver number, pay-intermediary bank,
      **  pay-intermediary bank a/c line, account with bank, account with
      **  bank a/c line, receive-our nostro, receive-intermediary bank,
      **  receive-intermediary bank a/c line, beneficiary number,
      **  beneficiary a/c line.
     C                     MOVELPONS      MGPONS
     C                     MOVELRVNO      MGRVNO
     C                     MOVELPIBN      MGPIBN
     C                     MOVELPIBA      MGPIBA
     C                     MOVELAWBN      MGAWBN
     C                     MOVELAWBA      MGAWBA
     C                     MOVELRONS      MGRONS
     C                     MOVELRIBN      MGRIBN
     C                     MOVELRIBA      MGRIBA
     C                     MOVELBENN      MGBENN
     C                     MOVELBENA      MGBENA
      *
      **  Broker code, transaction type, transaction sub-type,
      **  our pay branch, our receive branch, pay-settlement method,
      **  receive-settlement method.
     C                     MOVELBRKC      MGBRKC
     C                     MOVELDTYP      MGTTYP
     C                     MOVELDLST      MGTSTP
     C                     MOVELPOBR      MGPOBR
     C                     MOVELROBR      MGROBR
     C                     Z-ADDPSTM      MGPSTM
     C                     Z-ADDRSTM      MGRSTM
      *                                                                   CSW097
     C           PSCY      IFNE *BLANK                                    CSW097
     C                     MOVE PSCY      MGPSCY                          CSW097
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE UCUCY     MGPSCY                   CSW097 171312
     C                     ELSE                                                               198698
     C                     MOVE *BLANKS   MGPSCY                                              198698
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           RSCY      IFNE *BLANK                                    CSW097
     C                     MOVE RSCY      MGRSCY                          CSW097
     C***********          ELSE                                    CSW097 171312
     C***********          MOVE TCUCY     MGRSCY                   CSW097 171312
     C                     ELSE                                                               198698
     C                     MOVE *BLANKS   MGRSCY                                              198698
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           CSW005    IFEQ 'Y'                                       CSW097
     C           CSW200    ANDEQ'N'                                       CSW200
     C           CSW005    OREQ 'Y'                                       CSW200
     C           CSW200    ANDEQ'Y'                                       CSW200
     C           WMTYP     ANDEQ'362'                                     CSW200
     C                     MOVE *BLANKS   MGSTYP                          CSW097
     C                     WRITEMGX36ND0                                  CSW097
      *                                                                                       195765
      ** If change type is Amend and previous msgs already deleted,                           195765
      ** change CHTP to 'I' to generate MT362 messages.                                       195765
      *                                                                                       195765
     C           CCHTP     IFEQ 'A'                                                           195765
     C           OEVTP1    ANDEQ*BLANKS                                                       195765
     C           OEVTP2    ANDEQ*BLANKS                                                       195765
     C                     MOVE 'I'       CCHTP                                               195765
     C                     ENDIF                                                              195765
     C                     ENDIF                                          CSW097
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRFRAO - Output to PF/MGF341PD.                           *
      *                                                               *
      *  Called by: SR/SRFRA  - Process record for FRA.               *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRFRAO    BEGSR
      *
      **  Note: Output record fields were initiliased using CLEAR.
      *
      *
      **  Related reference number.
     C           CCHTP     IFEQ 'A'
     C                     MOVELPKTREF    MGRREF
     C                     ENDIF
      *
      **  Fixing date, currency, notional amount, buy/sell indicator,
      **  settlement date, settlement amount, pay/receive indicator,
      **  settlement rate, contract period.
     C                     Z-ADDWKFDAT    MGFDAT
     C                     MOVE WKCCY     MGCCY
     C                     Z-ADDUPAMT     MGNOAM
     C                     MOVE BYSL      MGBORS
     C                     Z-ADDDVDAT     MGSDAT
     C                     Z-ADDWKSAMT    MGSAMT
     C                     MOVE WKPORR    MGPORR
     C                     Z-ADDWKCRAT    MGCRAT
     C                     Z-ADDWKSRAT    MGSRAT
     C           MDAT      SUB  DVDAT     MGCPER
      *
      **  Condition lines.
     C                     MOVELCND1      MGCON1
     C                     MOVELCND2      MGCON2
     C                     MOVELCND3      MGCON3
     C                     MOVELCND4      MGCON4
     C                     MOVELCND5      MGCON5
     C                     MOVELCND6      MGCON6
      *
      **  Event type, type of last change.
     C                     MOVE *BLANKS   MGEVTP
     C           CCHTP     IFEQ 'A'
     C           PKRTNC    ANDEQ'C'
     C                     MOVE 'A'       MGCHTP
     C                     ENDIF
      *
      ** Move settlement currencies.                                      137909
     C           CEU003    IFEQ 'Y'                                       137909
     C                     EXSR SRSTCY                                    137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C           CSW200    IFEQ 'Y'                                       CSW200
     C           AGTY      ANDNE'ISDACN'                                                    MD029258
     C                     MOVELAGTY      MGAGTY                          CSW200
     C                     END                                            CSW200
      *                                                                   CSW200
      **  Output record.
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
      *                                                                                       239386
      ** Check MPHAS to determine system phase.  If in COB, set MGCHTP to I                   239386
      ** to make field 22A have a value of SETT.  Also, blank out MGRREF to                   239386
      ** make field 21 not included in the to be generated MT341                              239386
      *                                                                                       239386
     C********** WPHAS     IFNE 'A'                                                    239386 CCB020
     C********** WPHAS     OREQ 'A'                                                    239386 CCB020
     C           @RTPHS    IFEQ '*YES'                                                        CCB020
     C           @RTPHS    OREQ '*NO'                                                         CCB020
     C           CCHTP     ANDEQ'I'                                                           239386
     C                     MOVE 'I'       MGCHTP                                              239386
     C                     MOVEL*BLANKS   MGRREF                                              239386
     C                     ENDIF                                                              239386
      *                                                                                       239386
      *                                                                                       CSW213
     C                     EXSR SRREPI                                                        CSW213
      *                                                                                       CSW213
     C                     WRITEMGF341D0
      *
      **  Set flag to update deal.
     C                     MOVE 'Y'       UPDDLG
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      ***SR/SRIROS*-*Output*to*PF/MGF362PD*for*Settlement.*************   CSW097
      *****************************************************************   CSW097
      ***Called by:*SR/SRIRS-*Process*record*for*IRS.******************   CSW097
      *****************************************************************   CSW097
      ***Calls:********************************************************   CSW097
      *****************************************************************   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C***********SRIROS    BEGSR                                          CSW097
      *                                                                   CSW097
      ****Note:*Output*record*fields*were*initiliased*using*CLEAR.*****   CSW097
      *                                                                   CSW097
      *                                                                   CSW097
      ****Related*reference*number.************************************   CSW097
     C***********CCHTP     IFEQ 'A'                                       CSW097
      *                                                                   CSW097
      ****Use*appropriate*message*event*type.**************************   CSW097
     C************IN30     IFEQ '0'                                       CSW097
     C***********          MOVELOTRNO1    MGRREF                          CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVELOTRNO2    MGRREF                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ****Start*date.**************************************************   CSW097
     C***********          Z-ADDDVDAT     MGTSDT                          CSW097
      *                                                                   CSW097
     C***********          MOVE *BLANKS   MGTDCF                          CSW097
     C***********          Z-ADD*ZEROS    MGTCRD                          CSW097
     C***********          Z-ADD*ZEROS    MGTNRD                          CSW097
     C***********          Z-ADD*ZEROS    MGTBAR                          CSW097
     C***********          Z-ADD*ZEROS    MGTSPR                          CSW097
     C***********          Z-ADD*ZEROS    MGTTTR                          CSW097
     C***********          Z-ADD*ZEROS    MGTPIA                          CSW097
     C***********          Z-ADD*ZEROS    MGTPAM                          CSW097
      *                                                                   CSW097
     C***********          MOVE *BLANKS   MGODCF                          CSW097
     C***********          Z-ADD*ZEROS    MGOCRD                          CSW097
     C***********          Z-ADD*ZEROS    MGONRD                          CSW097
     C***********          Z-ADD*ZEROS    MGOBAR                          CSW097
     C***********          Z-ADD*ZEROS    MGOSPR                          CSW097
     C***********          Z-ADD*ZEROS    MGOTTR                          CSW097
     C***********          Z-ADD*ZEROS    MGOPIA                          CSW097
     C***********          Z-ADD*ZEROS    MGOPAM                          CSW097
      *                                                                   CSW097
      ****Event*type.**************************************************   CSW097
     C***********CCHTP     IFEQ 'A'                                       CSW097
      *                                                                   CSW097
      ****Use*appropriate*message*event*type.**************************   CSW097
     C************IN30     IFEQ '0'                                       CSW097
     C***********          MOVE OEVTP1    MGEVTP                          CSW097
     C***********          ELSE                                           CSW097
     C***********          MOVE OEVTP2    MGEVTP                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ELSE                                           CSW097
     C***********          SELEC                                          CSW097
     C***********CNRQ      WHEQ 'E'                                       CSW097
     C***********          MOVE 'SU'      MGEVTP                          CSW097
     C***********CNRQ      WHEQ 'G'                                       CSW097
     C***********          MOVE 'ST'      MGEVTP                          CSW097
     C***********CNRQ      WHEQ 'J'                                       CSW097
     C***********          MOVE 'SB'      MGEVTP                          CSW097
     C***********          ENDSL                                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      **   Type of last change.                                           CSW097
     C***********CCHTP     IFEQ 'A'                                       CSW097
     C************IN30     ANDEQ'0'                                       CSW097
     C***********OCANC1    ANDEQ'C'                                       CSW097
     C***********CCHTP     OREQ 'A'                                       CSW097
     C************IN30     ANDEQ'1'                                       CSW097
     C***********OCANC2    ANDEQ'C'                                       CSW097
     C***********          MOVE 'A'       MGCHTP                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
      ****Output*record.***********************************************   CSW097
     C***********          WRITEMGF362D0                                  CSW097
      *                                                                   CSW097
      ****Set*flag*to*update*deal.*************************************   CSW097
     C***********UPDDLG    IFEQ 'N'                                       CSW097
     C***********          MOVE 'Y'       UPDDLG                          CSW097
     C***********          ENDIF                                          CSW097
      *                                                                   CSW097
     C***********          ENDSR                                          CSW097
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRIROF - Output to PF/MGF362PD for Rate Fix.              *
      *                                                               *
      *  Called by: SR/SRIRS- Process record for IRS.                 *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRIROF    BEGSR
      *
      **  Note: Output record fields were initiliased using CLEAR.
      *
      *
      **  Related reference number.
     C           CCHTP     IFEQ 'A'
      *
      **  Use appropriate message event type.
     C           *IN30     IFEQ '0'
     C                     MOVELOTRNO1    MGRREF
     C                     ELSE
     C                     MOVELOTRNO2    MGRREF
     C                     ENDIF
      *
     C                     ENDIF
      *
      **  Start date.
     C                     Z-ADDDVDAT     MGTSDT
      *
     C***********          Z-ADDINTO      MGTIAM                          CSW097
      *
     C***********          Z-ADDINTA      MGOIAM                          CSW097
      *
      **  Event type.
     C           CCHTP     IFEQ 'A'
      *
      **  Use appropriate message event type.
     C           *IN30     IFEQ '0'
     C                     MOVE OEVTP1    MGEVTP
     C                     ELSE
     C                     MOVE OEVTP2    MGEVTP
     C                     ENDIF
      *
     C                     ELSE
     C                     SELEC
     C           CNRQ      WHEQ 'D'
     C                     MOVE 'FU'      MGEVTP
     C           CNRQ      WHEQ 'F'
     C                     MOVE 'FT'      MGEVTP
     C           CNRQ      WHEQ 'H'
     C                     MOVE 'FB'      MGEVTP
     C                     ENDSL
     C                     ENDIF
      *
      **  Type of last change.
     C           CCHTP     IFEQ 'A'
     C           *IN30     ANDEQ'0'
     C           OCANC1    ANDEQ'C'
     C           CCHTP     OREQ 'A'
     C           *IN30     ANDEQ'1'
     C           OCANC2    ANDEQ'C'
     C                     MOVE 'A'       MGCHTP
     C                     ENDIF
      *
      **  Processing for FUID (Further Processing Indicator)              CSW097
      *                                                                   CSW097
     C           CSW005    IFEQ 'Y'                                       CSW097
      *                                                                   CSW097
     C                     MOVE *BLANKS   MGFUID                          CSW097
     C           DTYP      IFEQ 'FR'                                      CSW097
     C           AGTY      ANDEQ'ISDA'                                    CSW097
     C           DTYP      OREQ 'FR'                                      CSW097
     C           AGTY      ANDEQ'AFB'                                     CSW097
      *                                                                   177329
      ** For FRs, output currency for both sides                          177329
     C                     SELEC                                          177329
     C           MGOCCY    WHNE *BLANKS                                   177329
     C                     MOVE MGOCCY    MGTCCY                          177329
     C           MGTCCY    WHNE *BLANKS                                   177329
     C                     MOVE MGTCCY    MGOCCY                          177329
     C                     ENDSL                                          177329
      *                                                                   CSW097
     C           BYSL      IFEQ 'B'                                       CSW097
     C                     MOVEL'FRABUYER'MGFUID                          CSW097
     C                     ELSE                                           CSW097
     C           'FRASELLE'CAT  'R':0     MGFUID                          CSW097
     C                     ENDIF                                          CSW097
     C                     ELSE                                           CSW097
     C           UBRTT     IFEQ 0                                         CSW097
     C           TBRTT     ANDEQ0                                         CSW097
     C           'FIXEDFIX'CAT  'ED':0    MGFUID                          CSW097
     C                     ENDIF                                          CSW097
     C           UBRTT     IFEQ 0                                         CSW097
     C           TBRTT     ANDNE0                                         CSW097
     C           'FIXEDFLO'CAT  'AT':0    MGFUID                          CSW097
     C                     ENDIF                                          CSW097
     C           UBRTT     IFNE 0                                         CSW097
     C           TBRTT     ANDEQ0                                         CSW097
     C           'FLOATFIX'CAT  'ED':0    MGFUID                          CSW097
     C                     ENDIF                                          CSW097
     C           UBRTT     IFNE 0                                         CSW097
     C           TBRTT     ANDNE0                                         CSW097
     C           'FLOATFLO'CAT  'AT':0    MGFUID                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      **For*FRs,*output*currency*for*both*sides******************  171312 177329
     C***********          SELEC                                   171312 177329
     C***********MGOCCY    WHNE *BLANKS                            171312 177329
     C***********          MOVE MGOCCY    MGTCCY                   171312 177329
     C***********MGTCCY    WHNE *BLANKS                            171312 177329
     C***********          MOVE MGTCCY    MGOCCY                   171312 177329
     C***********          ENDSL                                   171312 177329
      *
      **  Output record.
     C           MGCHTP    IFEQ *BLANK                                                        CSW025
     C                     MOVE @CHG      MGCHTP                                              CSW025
     C                     ENDIF                                                              CSW025
     C                     WRITEMGF362D0
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *
      **  Set flag to update deal.
     C           UPDDLG    IFEQ 'N'
     C                     MOVE 'Y'       UPDDLG
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRDGUP - Update deals record.                             *
      *                                                               *
      *  Called by: Main Processing Routine.                          *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRDGUP    BEGSR
      *
     C           SVDLNO    CHAINDEALS                11
      *
     C           *IN11     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD018       DBASE            * * * * * * * *
     C                     MOVELSVDLNO    DBKEY     P      * DB ERROR 18 *
     C                     MOVEL'DEALS'   DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      **  Our and Their forced settlement indicator.
      *
     C                     MOVE ' '       UFRRF
     C                     MOVE ' '       TFRRF
      *
     C                     UPDATDEALSDGF
      *
     C                     COMIT
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCURR - Access SDCURRPD.                                 *
      *                                                               *
      *  Called by: SR/SRFRA  - Process records for FRA.              *
      **************SR/SRIRUS*-*Process*settlements*for*IRS*-*Our******   CSW097
      **************SR/SRIRTS*-*Process*settlements*for*IRS*-*Their****   CSW097
      *             SR/SRIRUF - Process rate fixing for IRS - Our     *
      *             SR/SRIRTF - Process rate fixing for IRS - Their   *
      *                                                               *
      *  Calls: RPG/AOCURRR0 - Access SDCURRPD.                       *
      *                                                               *
      *****************************************************************
      *
     C           SRCURR    BEGSR
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           PKCCY   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADDDBASEP    DBASE            * * * * * * * *
     C                     MOVELPKCCY     DBKEY     P      *  DBERR XXX  *
     C                     MOVEL'SDCURRPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRDEST - Access SDCUSTPD for Destination customer details.*
      *                                                               *
      *  Called by: Main Processing.                                  *
      *                                                               *
      *  Calls: RPG/AOCUSTR0 - Access SDCUSTPD.                       *
      *                                                               *
      *****************************************************************
      *
     C           SRDEST    BEGSR
      *
      **  Using customer no. of deal
      *
     C                     MOVELCNUM      WDEST   8 P
      *
      **  Access SDCUSTPD with access object if details was changed.
      *
     C           WDEST     IFNE SVDEST
      *
     C                     MOVELWDEST     SVDEST    P
     C                     MOVE *BLANKS   @KEY1  10
     C                     MOVE *BLANKS   @KYST   7
      *
     C                     CALL 'AOCUSTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM WDEST     @KEY1
     C                     PARM           @KYST
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD019       DBASE            * * * * * * * *
     C                     MOVELWDEST     DBKEY     P      *  DBERR 019  *
     C                     MOVEL'SDCUSTPD'DBFILE    P      * * * * * * * *
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Load array with fields containing message types not to be
      ** generated for this customer.
      *
     C                     MOVE BBNG01    NGN,1
     C                     MOVE BBNG02    NGN,2
     C                     MOVE BBNG03    NGN,3
     C                     MOVE BBNG04    NGN,4
     C                     MOVE BBNG05    NGN,5
     C                     MOVE BBNG06    NGN,6
     C                     MOVE BBNG07    NGN,7
     C                     MOVE BBNG08    NGN,8
     C                     MOVE BBNG09    NGN,9
     C                     MOVE BBNG10    NGN,10
     C                     MOVE BBNG11    NGN,11
     C                     MOVE BBNG12    NGN,12
     C                     MOVE BBNG13    NGN,13
     C                     MOVE BBNG14    NGN,14
     C                     MOVE BBNG15    NGN,15
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRECON - Access ECONXCL0.                                 *
      *                                                               *
      *  Called by: SR/SRFRA - Process record for FRA.                *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRECON    BEGSR
      *
     C                     MOVE *BLANKS   CKRTCD  4
     C           ECONKY    CHAINECONLF0F             70
     C           *IN70     IFEQ '1'
     C                     MOVE '*NRF'    CKRTCD
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRINIW - Initialise workfields.                           *
      *                                                               *
      *  Called by: SR/SRCOMM - Set up common output fields.          *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRINIW    BEGSR
      *
     C                     MOVE *BLANKS   WKCCY   3
     C                     Z-ADD*ZEROS    WKCRAT 117
     C                     Z-ADD*ZEROS    WKFDAT  50
     C                     MOVE *BLANK    WKPORR  1
     C                     Z-ADD*ZEROS    WKSAMT 130
     C                     Z-ADD*ZEROS    WKSRAT 117
     C                     MOVEL*BLANKS   PKSNET  1
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRCNET - Check if this payment advice is netting          *
      *                                                               *
      *  Called by: SR/SRCOMM - Set up common output fields.          *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SRCNET    BEGSR
      *
      **  Our pay date.
     C           UNIPD     IFEQ *ZEROS
     C                     Z-ADDMDAT      WOUR    50
     C                     ELSE
     C                     Z-ADDUNIPD     WOUR
     C                     ENDIF
      *
      **  Their pay date
     C           TNIPD     IFEQ *ZEROS
     C                     Z-ADDMDAT      WTHEIR  50
     C                     ELSE
     C                     Z-ADDTNIPD     WTHEIR
     C                     ENDIF
      *
     C           WOUR      IFEQ WTHEIR
     C           CNRQ      ANDNE'J'
     C           INTA      ANDNE*ZEROS
     C           INTO      ANDNE*ZEROS
     C           DVDAT     ORGE BJRDNB
     C           CNRQ      ANDNE'J'
     C           INTA      ANDNE*ZEROS
     C           INTO      ANDNE*ZEROS
     C                     MOVE 'Y'       PKSNET
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SRVALD - Check if allowed to generate message type.       *
      *                                                               *
      *  Called by: Main Processing.                                  *
      *                                                               *
      *  Calls: SR/SRCOMM - Common Output fields.                     *
      *                                                               *
      *****************************************************************
      *
     C           SRVALD    BEGSR
      *
      **  Set Message type.
      *
     C                     MOVE *BLANKS   WMTYP   3
     C                     MOVE '0'       *IN50                           CSW097
     C                     SELEC
     C           DTYP      WHEQ 'FR'
     C           CSW200    IFEQ 'N'                                       CSW200
     C           AGTY      IFEQ 'ISDA'                                    CSW097
     C           AGTY      OREQ 'AFB'                                     CSW097
     C                     MOVEL'362'     WMTYP                           CSW097
     C                     MOVE '1'       *IN50                           CSW097
     C                     ELSE                                           CSW097
     C                     MOVE '341'     WMTYP
     C                     ENDIF                                          CSW097
     C                     ELSE                                           CSW200
     C                     MOVEL'341'     WMTYP                           CSW200
     C                     ENDIF                                          CSW200
      *                                                                   CSW200
     C           DTYP      WHEQ 'RS'
     C           DTYP      OREQ 'RX'
     C                     MOVE '362'     WMTYP
     C                     ENDSL
      *
      **  Check if to be generated.
      *
     C                     MOVEA'000'     *IN,31
     C           WMTYP     IFNE *BLANKS
     C           WMTYP     LOKUPNGN                      31
     C           '3**'     LOKUPNGN                      32
     C                     MOVE WMTYP     WGROUP  3
     C                     MOVE '*'       WGROUP
     C           WGROUP    LOKUPNGN                      33
     C                     ENDIF
     C/COPY WNCPYSRC,DL6330C002
     C                     MOVEA*IN,31    MVALD   3
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SR/SREND  - Final routines before ending program.            *
      *                                                               *
      *  Called by: Main Processing Routine.                          *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           SREND     BEGSR
      *
      **  Close files for Interest Rates Calendar feature.
      *
     C           CIR001    IFEQ 'Y'
     C                     CLOSEDLDTSCPD
     C                     CLOSEDLPCSCPD
     C                     ENDIF
      *
     C           CIR014    IFEQ 'Y'                                                           CIR014
     C                     CLOSEDLDEALL5                                                      CIR014
     C                     ENDIF                                                              CIR014
      *                                                                                       CIR014
     C                     ENDSR
      *
     C/EJECT
      *****************************************************************   137909
      *****************************************************************   137909
      *   SRSTCY-If CEU003 (EMU enhancement) is on set up payment     *   137909
      *          settlement currency.                                 *   137909
      *   Called by - SRFRAO                                          *   137909
      *****************************************************************   137909
      *                                                                   137909
     C           SRSTCY    BEGSR                                          137909
      *                                                                   137909
      ** Use payment settlement currency if entered. Otherwise use        137909
      ** our currency.                                                    137909
     C           PSCY      IFNE *BLANKS                                   137909
     C                     MOVE PSCY      MGSTCY                          137909
     C                     ELSE                                           137909
     C                     MOVE UCUCY     MGSTCY                          137909
     C                     ENDIF                                          137909
      *                                                                   137909
     C                     ENDSR                                          137909
     C/EJECT                                                              137909
      *****************************************************************   137909
      *****************************************************************
      *   *PSSR - error handling                                      *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C                     OPEN DL6330AU
      *
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
      *
     C                     WRITEDL6330D0
     C                     WRITEDL6330D1
     C                     DUMP
      *
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      *                                                               *   CSW097
      *  SR/SRY36N - Output Interest Payment Details.                 *   CSW097
      *                                                               *   CSW097
      *  Called by: SRIRUS, SRIRTF                                    *   CSW097
      *                                                               *   CSW097
      *  Calls:                                                       *   CSW097
      *                                                               *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRY36N    BEGSR                                          CSW097
      *                                                                   CSW097
      ** Check if Interest is calculated up-front                         CSW097
      *                                                                   CSW097
     C                     MOVE *BLANK    W@OUF                           CSW097
     C                     MOVE *BLANK    W@TUF                           CSW097
      *                                                                   CSW097
     C           W#MSSQ    IFEQ 'E'                                       CSW097
     C           UINPM     IFEQ 'D'                                       CSW097
     C           UINPM     OREQ 'Y'                                       CSW097
     C                     MOVE 'Y'       W@OUF   1                       CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           W#MSSQ    IFEQ 'C'                                       CSW097
     C           TINPM     IFEQ 'D'                                       CSW097
     C           TINPM     OREQ 'Y'                                       CSW097
     C                     MOVE 'Y'       W@TUF   1                       CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** "FR" deal                                                        CSW097
     C           DTYP      IFEQ 'FR'                                      CSW097
     C                     Z-ADDDVDAT     MGPDAT                          CSW097
     C                     MOVE W#MSSQ    MGMSSQ                          CSW097
     C***********W#MSSQ    IFEQ 'E'                                CSW097 171312
     C***********          Z-ADDINTA      MGPAMT                   CSW097 171312
     C***********          ELSE                                    CSW097 171312
     C***********          Z-ADDINTO      MGPAMT                   CSW097 171312
     C***********          ENDIF                                   CSW097 171312
     C* Message sequence depends if amount is payable (INTA<>0)           171312
     C* or receivable (INTO<>0)                                           171312
     C                     SELEC                                          171312
     C           INTA      WHNE 0                                         171312
     C                     MOVE 'E'       MGMSSQ                          171312
     C                     Z-ADDINTA      MGPAMT                          171312
     C                     OTHER                                          171312
     C                     MOVE 'C'       MGMSSQ                          171312
     C                     Z-ADDINTO      MGPAMT                          171312
     C                     ENDSL                                          171312
     C                     WRITEMGY36ND0                                  CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           DTYP      IFEQ 'RS'                                      CSW097
     C           DTYP      OREQ 'RX'                                      CSW097
      *                                                                   181962
      * Calculate any interest adjustments                                181962
     C                     Z-ADD0         WADJA                                              BUG5771
     C           UAIAN     IFNE 0                                                            BUG5771
     C           UAIAP     ORNE 0                                                            BUG5771
     C           TAIAN     ORNE 0                                                            BUG5771
     C           TAIAP     ORNE 0                                                            BUG5771
     C                     EXSR SRCADJ                                    181962
     C                     ENDIF                                                             BUG5771
      *                                                                   181962
     C                     MOVE 'N'       WFRST   1                       181962
      *                                                                   CSW097
     C                     MOVE 'A'       WBEAF                           CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDW#CRDT    WPRDT                           CSW097
     C                     Z-ADDW#CRDT    WPRDT                           178282
     C           OLXKY1    SETLLDLOLCFL1                                  CSW097
     C***********OLXKY2    READEDLOLCFL1            N    60        CSW097 171312
     C           OLXKY3    READEDLOLCFL1            N    60               171312
      *                                                                                       CSW201
      ** If no record found, set payment date to next rate change date.                       CSW201
      *                                                                                       CSW201
     C           *IN60     IFEQ *ON                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
      ** Get interest processing method.                                                      CSW201
     C           ZOTIN     IFEQ 'U'                                                           CSW201
     C           UINPM     IFEQ 'A'                                                           CSW201
     C           UINPM     OREQ 'I'                                                           CSW201
     C           UINPM     OREQ 'L'                                                           CSW201
     C                     MOVELUINPM     CFINPM                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           ZOTIN     IFEQ 'T'                                                           CSW201
     C           TINPM     IFEQ 'A'                                                           CSW201
     C           TINPM     OREQ 'I'                                                           CSW201
     C           TINPM     OREQ 'L'                                                           CSW201
     C                     MOVELTINPM     CFINPM                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           CFINPM    IFEQ 'L'                                                           CSW201
     C                     Z-ADD*ZERO     CFAMNT                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     Z-ADDW#NRDT    CFPYDT                                              CSW201
     C                     MOVEL*OFF      *IN60                                               CSW201
     C           ZOTIN     IFEQ 'U'                                                           CSW201
     C                     Z-ADDW#NRDT    MGOPDT                                              CSW201
     C                     ELSE                                                               CSW201
     C                     Z-ADDW#NRDT    MGTPDT                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     MOVEL*BLANK    WNOPAY                                              CSW201
     C                     MOVEL*BLANK    WPROC                                               CSW201
      *                                                                                       CSW201
     C           *IN60     DOWEQ*OFF                                      CSW097
      *                                                                                       CSW201
     C           CFINPM    IFEQ 'C'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CFINPM    OREQ 'A'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CFINPM    OREQ 'K'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CFINPM    OREQ 'I'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVEL'Y'       WCAKI   1                                           CSW201
     C                     ELSE                                                               CSW201
     C                     MOVEL'N'       WCAKI                                               CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C           CFINPM    IFEQ 'A'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CFINPM    OREQ 'I'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C           CFINPM    OREQ 'L'                                                           CSW201
     C           WMTYP     ANDEQ'362'                                                         CSW201
     C           CSW201    ANDEQ'Y'                                                           CSW201
      *                                                                                       CSW201
     C                     MOVEL'Y'       WAIL    1                                           CSW201
      *                                                                                       CSW201
      ** If no payment within the rate period, set payment date                               CSW201
      ** equal to next rate change date.                                                      CSW201
      *                                                                                       CSW201
     C           CFPYDT    IFGT W#NRDT                                                        CSW201
     C           WNOPAY    ANDNE'N'                                                           CSW201
     C           WPROC     ANDEQ*BLANK                                                        CSW201
     C                     MOVEL'Y'       WPROC   1                                           CSW201
     C           CFINPM    IFEQ 'L'                                                           CSW201
     C                     Z-ADD*ZERO     CFAMNT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     Z-ADDW#NRDT    CFPYDT                                              CSW201
     C           ZOTIN     IFEQ 'U'                                                           CSW201
     C                     Z-ADDW#NRDT    MGOPDT                                              CSW201
     C                     ELSE                                                               CSW201
     C                     Z-ADDW#NRDT    MGTPDT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ELSE                                                               CSW201
     C                     MOVEL'N'       WAIL                                                CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW097
     C           W#MSSQ    IFEQ 'E'                                       CSW097
     C           W@OUF     ANDNE'Y'                                       CSW097
     C           CFPYDT    ANDLEW#NRDT                                    CSW097
      *                                                                   CSW097
     C           W#MSSQ    OREQ 'E'                                       CSW097
     C           W@OUF     ANDEQ'Y'                                       CSW097
     C           CFPYDT    ANDLTW#NRDT                                    CSW097
      *                                                                   CSW097
     C           W#MSSQ    OREQ 'C'                                       CSW097
     C           W@TUF     ANDNE'Y'                                       CSW097
     C           CFPYDT    ANDLEW#NRDT                                    CSW097
      *                                                                   CSW097
     C           W#MSSQ    OREQ 'C'                                       CSW097
     C           W@TUF     ANDEQ'Y'                                       CSW097
     C           CFPYDT    ANDLTW#NRDT                                    CSW097
      *                                                                                       CSW201
     C                     MOVEL'N'       WNOPAY  1                                           CSW201
      *                                                                   178282
      ** If interest paid in arrears, do not include payment              178282
      ** date equal to period start as this would have already            178282
      ** been reported on previous MT362.                                 178282
     C           W#MSSQ    IFEQ 'E'                                       178282
     C           W@OUF     ANDNE'Y'                                       178282
     C           CFPYDT    ANDEQW#CRDT                                    178282
     C           W#MSSQ    OREQ 'C'                                       178282
     C           W@TUF     ANDNE'Y'                                       178282
     C           CFPYDT    ANDEQW#CRDT                                    178282
     C                     MOVEL'Y'       WNOPAY                                              CSW201
     C                     GOTO NXTRD                                     178282
     C                     ENDIF                                          178282
      * Add any interest adjustments to the first payment after           181962
      * the current rate change date                                      181962
     C           WFRST     IFEQ 'N'                                       181962
     C                     ADD  WADJA     CFAMNT                          181962
     C                     ENDIF                                          181962
      *                                                                                       CSW201
      ** If SWIFT 2001 is installed, and interest payment is                                  CSW201
      ** 'C' or 'A', and payment is not yet maturity date, or                                 CSW201
      ** 'K' or 'I', then zeroise payment amount.                                             CSW201
      *                                                                                       CSW201
     C           WCAKI     IFEQ 'Y'                                                           CSW201
     C           CFINPM    IFNE 'C'                                                           CSW201
     C           CFINPM    ANDNE'A'                                                           CSW201
     C           CFPYDT    ORNE MDAT                                                          CSW201
     C                     Z-ADD*ZERO     CFAMNT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                   CSW097
      ** "RS" Netting                                                     CSW097
     C           DTYP      IFEQ 'RS'                                      CSW097
      *                                                                   CSW097
     C***********CFOTIN    IFEQ 'U'                                CSW097 171312
      *                                                                                       196042
      ** Perform netting only if event type 1 is FB; or                                       196042
      ** FT/FU and other side is fixed.                                                       196042
      *                                                                                       196042
     C           CSW201    IFEQ 'N'                                                           196042
     C           WEVTP     OREQ 'FB'                                                          196042
     C           WEVTP     OREQ 'FT'                                                          196042
     C           UBRTT     ANDEQ0                                                             196042
     C           TBRTT     ANDNE0                                                             196042
     C           WEVTP     OREQ 'FU'                                                          196042
     C           TBRTT     ANDEQ0                                                             196042
     C           UBRTT     ANDNE0                                                             196042
      *                                                                                       196042
     C           ZOTIN     IFEQ 'U'                                       171312
     C                     MOVE 'C'       K@MSSQ                          CSW097
     C                     ELSE                                           CSW097
     C                     MOVE 'E'       K@MSSQ                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                                       196042
     C                     ELSE                                                               196042
     C                     MOVELW#MSSQ    K@MSSQ                                              196042
     C                     ENDIF                                                              196042
      *                                                                   CSW097
     C           GYL0KY    CHAINMGY36NL0             61                   CSW097
      *                                                                   CSW097
      ** Record found                                                     CSW097
     C           *IN61     IFEQ *OFF                                      CSW097
     C           CFAMNT    SUB  MGPAMT    W@DIFF 130                      CSW097
     C           W@DIFF    IFGT *ZERO                                     CSW097
     C***********CFOTIN    IFEQ 'U'                                CSW097 171312
     C           ZOTIN     IFEQ 'U'                                       171312
     C                     MOVE 'E'       MGMSSQ                          CSW097
     C                     ELSE                                           CSW097
     C                     MOVE 'C'       MGMSSQ                          CSW097
     C                     ENDIF                                          CSW097
     C                     Z-ADDW@DIFF    MGPAMT                          CSW097
     C                     UPDATMGY36ND0                                  CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           W@DIFF    IFEQ *ZERO                                     CSW097
     C           CSW201    IFEQ 'Y'                                                           CSW201
     C                     Z-ADD*ZERO     MGPAMT                                              CSW201
     C                     UPDATMGY36ND0                                                      CSW201
     C                     ELSE                                                               CSW201
     C                     DELETMGY36ND0                                  CSW097
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           W@DIFF    IFLT *ZERO                                     CSW097
     C           W@DIFF    MULT -1        MGPAMT                          CSW097
     C                     UPDATMGY36ND0                                  CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Record not found                                                 CSW097
     C                     ELSE                                           CSW097
     C           CFAMNT    IFNE *ZERO                                     CSW097
     C           WCAKI     OREQ 'Y'                                                           CSW201
     C           WAIL      OREQ 'Y'                                                           CSW201
     C                     MOVE W#MSSQ    MGMSSQ                          CSW097
     C                     Z-ADDCFPYDT    MGPDAT                          CSW097
     C                     Z-ADDCFAMNT    MGPAMT                          CSW097
      *                                                                                       196042
      ** Set up event type in file.                                                           196042
     C                     MOVELWEVTP     MGETYP                                              196042
      *                                                                                       196042
     C                     WRITEMGY36ND0                                  CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           DTYP      IFEQ 'RX'                                      CSW097
     C           CFAMNT    IFNE *ZERO                                     CSW097
     C           WCAKI     OREQ 'Y'                                                           CSW201
     C           WAIL      OREQ 'Y'                                                           CSW201
     C                     MOVE W#MSSQ    MGMSSQ                          CSW097
     C                     Z-ADDCFAMNT    MGPAMT                          CSW097
     C                     Z-ADDCFPYDT    MGPDAT                          CSW097
      *                                                                                       196042
      ** Set up event type in file.                                                           196042
     C                     MOVELWEVTP     MGETYP                                              196042
      *                                                                                       196042
     C                     WRITEMGY36ND0                                  CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
     C                     LEAVE                                          CSW097
     C                     ENDIF                                          CSW097
     C*                                                                   178282
     C           NXTRD     TAG                                            178282
      *                                                                   CSW097
     C***********OLXKY2    READEDLOLCFL1            N    60        CSW097 171312
     C           OLXKY3    READEDLOLCFL1            N    60               171312
      *                                                                                       CSW201
      ** If no more record found and previous record is already reported                      CSW201
      ** or there is no record within the rate fix period, then set                           CSW201
      ** payment date equal to end date.                                                      CSW201
      *                                                                                       CSW201
     C           *IN60     IFEQ *ON                                                           CSW201
     C           WAIL      ANDEQ'Y'                                                           CSW201
     C           WNOPAY    ANDNE'N'                                                           CSW201
     C           CFINPM    IFEQ 'L'                                                           CSW201
     C                     Z-ADD*ZERO     CFAMNT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     Z-ADDW#NRDT    CFPYDT                                              CSW201
     C                     MOVEL*OFF      *IN60                                               CSW201
     C           ZOTIN     IFEQ 'U'                                                           CSW201
     C                     Z-ADDW#NRDT    MGOPDT                                              CSW201
     C                     ELSE                                                               CSW201
     C                     Z-ADDW#NRDT    MGTPDT                                              CSW201
     C                     ENDIF                                                              CSW201
     C                     ENDIF                                                              CSW201
      *                                                                                       CSW201
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      *                                                               *   CSW097
      *  SR/SRBILD - Build IRS activity and cashflow file.            *   CSW097
      *                                                               *   CSW097
      *  Called by: SRIRS                                             *   CSW097
      *                                                               *   CSW097
      *  Calls: DL2900                                                *   CSW097
      *                                                               *   CSW097
      *****************************************************************   CSW097
      *                                                                   CSW097
     C           SRBILD    BEGSR                                          CSW097
      *                                                                   CSW097
      ** Call DL2900 to output all principal change dates and             CSW097
      ** rate change dates to DLOLACPD and payment dates to               CSW097
      ** DLOLCFPD.                                                        CSW097
     C           W@OLAC    IFEQ 'Y'                                       CSW097
     C                     CLOSEDLOLACPD                                  CSW097
     C                     MOVE 'N'       W@OLAC                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     MOVELIRDEAL    Z#ASTS    P                     CSW097
     C                     MOVE DDLNO     PDLNO   6                       CSW097
     C                     CALL 'DL2900'                                  CSW097
     C                     PARM *BLANKS   PRTCD   7                       CSW097
     C                     PARM           PDLNO                           CSW097
     C                     PARM 'A'       PBEAF   1                       CSW097
      *                                                                   CSW097
      ** If error occur in DL2900                                         CSW097
     C           PRTCD     IFNE *BLANKS                                   CSW097
     C           *LOCK     IN   LDA                                       CSW097
     C                     Z-ADD030       DBASE            ***************CSW097
     C                     MOVEL'DL2900  'DBFILE           *DB ERROR 030 *CSW097
     C                     MOVEL*BLANKS   DBKEY            ***************CSW097
     C                     OUT  LDA                                       CSW097
     C                     EXSR *PSSR                                     CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Call DL2900 again to close open files.                           CSW097
     C                     CALL 'DL2900'                                  CSW097
     C                     PARM '*CLOSE'  PRTCD                           CSW097
     C                     PARM '      '  PDLNO                           CSW097
     C                     PARM ' '       PBEAF                           CSW097
      *                                                                   CSW097
     C           W@OLAC    IFNE 'Y'                                       CSW097
     C                     OPEN DLOLACPD                                  CSW097
     C                     MOVE 'Y'       W@OLAC                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** DL2900 will not update payment amount unless                     CSW097
      ** Payment Frequency is "C". The processing below                   CSW097
      ** will try to calculate and update DLOLCFPD with                   CSW097
      ** the calculated payment amount if not zero.                       CSW097
     C                     MOVE 'A'       WBEAF                           CSW097
     C                     MOVE *BLANK    UCHK    1                       CSW097
     C                     MOVE *BLANK    TCHK    1                       CSW097
      *                                                                   CSW097
     C                     Z-ADDOUSI      WOUSI  150                      CSW097
     C                     Z-ADDOUSA      WOUSA  150                      CSW097
     C                     Z-ADDTUSI      WTUSI  150                      CSW097
     C                     Z-ADDTUSA      WTUSA  150                      CSW097
     C                     Z-ADDUIPRD     WUIPRD 130                      CSW097
     C                     Z-ADDTIPRD     WTIPRD 130                      CSW097
      *                                                                   CSW097
     C           OLXKY2    SETLLDLOLCFL1                                  CSW097
     C           OLXKY2    READEDLOLCFL1                 60               CSW097
     C           *IN60     DOWEQ*OFF                                      CSW097
      *                                                                   CSW097
     C           CFAMNT    IFEQ *ZERO                                     CSW097
      *                                                                   CSW097
      ** Determine Cashflow Amount                                        CSW097
     C                     EXSR SRDETC                                    CSW097
      *                                                                   CSW097
     C           CFAMNT    IFEQ *ZERO                                     CSW097
      *                                                                   CSW097
      ** If cash flow amounts = zero for both sides have been met,        CSW097
      ** then no further cash payments can be inferred, else              CSW097
      ** continue on until this condition is met or there are             CSW097
      ** no more records to process.                                      CSW097
      *                                                                   CSW097
     C           TCHK      IFEQ 'Y'                                       CSW097
     C           UCHK      ANDEQ'Y'                                       CSW097
     C                     LEAVE                                          CSW097
     C                     ELSE                                           CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C                     MOVEL'Y'       UCHK                            CSW097
     C                     ELSE                                           CSW097
     C                     MOVEL'Y'       TCHK                            CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Cashflow Amount is NOT Zero                                      CSW097
     C           CFAMNT    IFNE *ZERO                                     CSW097
      *                                                                   CSW097
      ** If interest is capitalised and paid on maturity, maintain        CSW097
      **   total of interest paid/received until maturity.                CSW097
      *                                                                   CSW097
     C           CFINPM    IFEQ 'C'                                       CSW097
     C           CFINPM    OREQ 'A'                                       CIR006
     C           CIR006    ANDEQ'Y'                                       CIR006
      *                                                                   CSW097
     C           CFPYDT    IFEQ MDAT                                      CSW097
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C           WUIPRD    ADD  CFAMNT    CFAMNT                          CSW097
     C                     ELSE                                           CSW097
     C           WTIPRD    ADD  CFAMNT    CFAMNT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C                     ADD  CFAMNT    WUIPRD                          CSW097
     C                     ELSE                                           CSW097
     C                     ADD  CFAMNT    WTIPRD                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     Z-ADD0         CFAMNT                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Calculate the tax payable and deduct this from the cash-flow     CSW097
      **   amount.                                                        CSW097
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C           TAXI      ANDEQ'Y'                                       CSW097
      *                                                                   CSW097
     C           CFAMNT    MULT BNHKTR    W#WK01 309                      CSW097
     C           W#WK01    DIV  100       CFTAXA    H                     CSW097
     C           CFAMNT    SUB  CFTAXA    CFAMNT                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADD*ZERO     CFTAXA                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Update the cash-flow record with the amount calculated.          CSW097
      *                                                                   CSW097
     C                     UPDATDLOLCFD0                                  CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
     C                     UNLCKDLOLCFL1                                  CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           OLXKY2    READEDLOLCFL1                 60               CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
     C           SREXIT    ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      * Subroutine  :  SRCPIA                                         *   CSW097
      * Function    :  Calculate Projected Interest Amount            *   CSW097
      *                                                               *   CSW097
      * Called by   :  SRIRUF, SRIRTF                                 *   CSW097
      * Calls       :  ZDLINT                                         *   CSW097
      *****************************************************************   CSW097
     C           SRCPIA    BEGSR                                          CSW097
      *                                                                   CSW097
      ** Determine Principal as at Current Rate Change Date               CSW097
      *                                                                   CSW097
     C                     MOVE 'A'       WBEAF                           CSW097
     C                     MOVE ZOTIN     WOTIN                           CSW097
     C                     Z-ADDW#SDAT    WPRDT                           CSW097
     C           OLXKY1    SETGTDLOLACD0                                  CSW097
     C           OLXKY3    REDPEDLOLACD0                 61               CSW097
      *                                                                   CSW097
     C           *IN61     IFEQ '1'                                       CSW097
     C           OLXKY1    SETLLDLOLACD0                                  CSW097
     C           OLXKY3    READEDLOLACD0                 61               CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Set Principal as at Current Rate Change Date                     CSW097
      *                                                                   CSW097
     C                     Z-ADDACPCPL    W#PCPL                          CSW097
      *                                                                   CSW097
      ** Reposition pointer to after record just read                     CSW097
      *                                                                   CSW097
     C           OLXKY1    SETGTDLOLACD0                                  CSW097
      *                                                                   CSW097
      ** Read from the deal actitity file                                 CSW097
      *                                                                   CSW097
     C           OLXKY3    READEDLOLACD0                 61               CSW097
      *                                                                   CSW097
      ** Read up to Pay Date                                              CSW097
      *                                                                   CSW097
     C           *IN61     DOWEQ'0'                                       CSW097
     C           ACPRDT    ANDLTW#EDAT                                    CSW097
      *                                                                   CSW097
      ** Calculate interest from last date to deal activity date.         CSW097
      *                                                                   CSW097
     C                     Z-ADDW#PCPL    ZDLAMT                          CSW097
     C                     Z-ADDW#RATE    ZDLRAT                          CSW097
     C                     Z-ADDW#SDAT    ZCBSDT                          CSW097
     C                     Z-ADDACPRDT    ZCBEDT                          CSW097
     C                     MOVELW#ICBS    ZCBCBS                          CSW097
     C                     EXSR ZDLINT                                    CSW097
     C                     ADD  ZDLOUT    W#TPIA                          CSW097
      *                                                                   CSW097
      ** Set Principal and Date to                                        CSW097
      *                                                                   CSW097
     C                     Z-ADDACPCPL    W#PCPL                          CSW097
     C                     Z-ADDACPRDT    W#SDAT                          CSW097
      *                                                                   CSW097
      ** Read from the deal actitity file                                 CSW097
      *                                                                   CSW097
     C           OLXKY3    READEDLOLACD0                 61               CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
      ** Calculate interest from last date to payment date                CSW097
      *                                                                   CSW097
     C           W#SDAT    IFLT W#EDAT                                    CSW097
     C                     Z-ADDW#PCPL    ZDLAMT                          CSW097
     C                     Z-ADDW#RATE    ZDLRAT                          CSW097
     C                     Z-ADDW#SDAT    ZCBSDT                          CSW097
     C                     Z-ADDW#EDAT    ZCBEDT                          CSW097
     C                     MOVELW#ICBS    ZCBCBS                          CSW097
     C                     EXSR ZDLINT                                    CSW097
     C                     ADD  ZDLOUT    W#TPIA                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      * Subroutine  :  SRDETC                                         *   CSW097
      * Function    :  Determine Cashflow amount                      *   CSW097
      *                                                               *   CSW097
      * Called by   :  Various                                        *   CSW097
      * Calls       :  None                                           *   CSW097
      *****************************************************************   CSW097
     C           SRDETC    BEGSR                                          CSW097
      *                                                                   CSW097
      **  If the interest accrual control date is after the cash-flow     CSW097
      **    start date, calulate the interest to the control date. Then   CSW097
      **    use the rest of this routine to calculate the interest        CSW097
      **    from there to the end date.                                   CSW097
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
      *                                                                   CSW097
     C           UIACD     IFGT CFSLIP                                    CSW097
     C                     Z-ADDUIACD     ##IACD  50                      CSW097
     C           UAITC     SUB  WUIPRD    ##TOTI 150                      CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDCFSLIP    ##IACD                          CSW097
     C                     Z-ADD*ZERO     ##TOTI                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ELSE                                           CSW097
      *                                                                   CSW097
     C           TIACD     IFGT CFSLIP                                    CSW097
     C                     Z-ADDTIACD     ##IACD                          CSW097
     C           TAITC     SUB  WTIPRD    ##TOTI                          CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDCFSLIP    ##IACD                          CSW097
     C                     Z-ADD*ZERO     ##TOTI                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Determine Principal & Rate as at Last Interest Payment Date      CSW097
      *                                                                   CSW097
     C                     MOVELCFBEAF    ACBEAF                          CSW097
     C                     Z-ADDCFDLNO    ACDLNO                          CSW097
     C                     MOVE CFOTIN    ACOTIN                          CSW097
     C                     Z-ADDCFSLIP    ACPRDT                          CSW097
     C           DLOLAK    SETGTDLOLACD0                                  CSW097
     C           DLOLAP    REDPEDLOLACD0                 61               CSW097
      *                                                                   CSW097
     C           *IN61     IFEQ '1'                                       CSW097
     C           DLOLAK    SETLLDLOLACD0                                  CSW097
     C           DLOLAP    READEDLOLACD0                 61               CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Set Principal & Rate as at Last Interest Payment Date            CSW097
      ** and Date Interest Calculated to                                  CSW097
      *                                                                   CSW097
     C                     Z-ADDACPCPL    ##PCPL 150                      CSW097
     C                     Z-ADDACEINR    ##EINR 117                      CSW097
     C                     MOVELACRTTP    ##RTTP  1                       CSW097
      *                                                                   CSW097
      ** Reposition pointer to after record just read                     CSW097
      *                                                                   CSW097
     C           DLOLAK    SETGTDLOLACD0                                  CSW097
      *                                                                   CSW097
      ** Read from the deal actitity file                                 CSW097
      *                                                                   CSW097
     C           DLOLAP    READEDLOLACD0                 61               CSW097
      *                                                                   CSW097
      ** Read up to cashflow next interest payment date                   CSW097
      *                                                                   CSW097
     C           *IN61     DOWEQ'0'                                       CSW097
     C           ACPRDT    ANDLTCFNIPD                                    CSW097
      *                                                                   CSW097
      ** Calculate interest from last date to deal activity date.         CSW097
      ** Rate used is effective interest rate of deal actitity            CSW097
      *                                                                   CSW097
     C                     Z-ADD##PCPL    ZDLAMT                          CSW097
      *                                                                   CSW097
      ** If CIR002 is switched on, add unsettled interest to principal.   CSW097
      *                                                                   CSW097
     C           CIR002    IFEQ 'Y'                                       CSW097
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'L'                                       CIR006
     C/COPY WNCPYSRC,DL6330C003
      *                                                                   CSW097
     C           ACOTIN    IFEQ 'U'                                       CSW097
     C                     ADD  WOUSI     ZDLAMT                          CSW097
     C                     ADD  WOUSA     ZDLAMT                          CSW097
     C                     ELSE                                           CSW097
     C                     ADD  WTUSI     ZDLAMT                          CSW097
     C                     ADD  WTUSA     ZDLAMT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     Z-ADD##EINR    ZDLRAT                          CSW097
     C                     Z-ADD##IACD    ZCBSDT                          CSW097
     C                     Z-ADDACPRDT    ZCBEDT                          CSW097
     C                     MOVELCFINCL    ZCBCBS                          CSW097
     C           CFINPM    IFNE 'Y'                                       CSW097
     C                     EXSR ZDLINT                     * DISC./INT.   CSW097
     C                     ELSE                                           CSW097
     C                     EXSR SRCIYD                     * YIELD        CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ADD  ZDLOUT    ##TOTI                          CSW097
      *                                                                   CSW097
      ** Set Principal & Rate                                             CSW097
      ** and Date Interest calculated to                                  CSW097
      *                                                                   CSW097
     C                     Z-ADDACPCPL    ##PCPL                          CSW097
     C                     Z-ADDACEINR    ##EINR                          CSW097
     C                     MOVELACRTTP    ##RTTP                          CSW097
     C                     Z-ADDACPRDT    ##IACD                          CSW097
      *                                                                   CSW097
      ** Read from the deal actitity file                                 CSW097
      *                                                                   CSW097
     C           DLOLAP    READEDLOLACD0                 61               CSW097
     C                     ENDDO                                          CSW097
      *                                                                   CSW097
      ** Calculate interest from last date to next interest payment date. CSW097
      ** Rate used is effective interest rate of deal acitivity file.     CSW097
      *                                                                   CSW097
     C           ##IACD    IFLT CFNIPD                                    CSW097
     C                     Z-ADD##PCPL    ZDLAMT                          CSW097
      *                                                                   CSW097
      ** If CIR002 is switched on, add unsettled interest to principal.   CSW097
      *                                                                   CSW097
     C           CIR002    IFEQ 'Y'                                       CSW097
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'A'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'I'                                       CIR006
     C           CIR006    OREQ 'Y'                                       CIR006
     C           CFINPM    ANDEQ'L'                                       CIR006
     C/COPY WNCPYSRC,DL6330C004
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C                     ADD  WOUSI     ZDLAMT                          CSW097
     C                     ADD  WOUSA     ZDLAMT                          CSW097
     C                     ELSE                                           CSW097
     C                     ADD  WTUSI     ZDLAMT                          CSW097
     C                     ADD  WTUSA     ZDLAMT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     Z-ADD##EINR    ZDLRAT                          CSW097
     C                     Z-ADD##IACD    ZCBSDT                          CSW097
     C                     Z-ADDCFNIPD    ZCBEDT                          CSW097
     C                     MOVELCFINCL    ZCBCBS                          CSW097
     C           CFINPM    IFNE 'Y'                                       CSW097
     C                     EXSR ZDLINT                     * DISC./INT.   CSW097
     C                     ELSE                                           CSW097
     C                     EXSR SRCIYD                     * YIELD        CSW097
     C                     ENDIF                                          CSW097
     C                     ADD  ZDLOUT    ##TOTI                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
      ** Set Cashflow Amount                                              CSW097
      *                                                                   CSW097
     C                     Z-ADD##TOTI    CFAMNT                          CSW097
      *                                                                   CSW097
      ** If CIR002 is switched on, zeroise the unsettled interest         CSW097
      **   once it has been used.                                         CSW097
      *                                                                   CSW097
     C           CIR002    IFEQ 'Y'                                       CSW097
     C           CIR006    OREQ 'Y'                                       CIR006
     C/COPY WNCPYSRC,DL6330C005
      *                                                                   CSW097
     C           CFOTIN    IFEQ 'U'                                       CSW097
     C                     Z-ADD0         WOUSI                           CSW097
     C                     Z-ADD0         WOUSA                           CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADD0         WTUSI                           CSW097
     C                     Z-ADD0         WTUSA                           CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
     C/EJECT                                                              CSW097
      *****************************************************************   CSW097
      * Subroutine  :  SRCIYD                                         *   CSW097
      * Function    :  Calculate Interest on a Yield Basis            *   CSW097
      *                                                               *   CSW097
      * Called by   :  SRDETC                                         *   CSW097
      * Calls       :  None                                           *   CSW097
      *****************************************************************   CSW097
     C           SRCIYD    BEGSR                                          CSW097
      *                                                                   CSW097
      ** Initialise fields                                                CSW097
      *                                                                   CSW097
     C                     Z-ADDZDLAMT    ZDLAMT                          CSW097
     C                     Z-ADDZDLRAT    ZDLRAT                          CSW097
     C                     Z-ADD*ZERO     ZDLOUT                          CSW097
      *                                                                   CSW097
      ** Find no. of days in period and year                              CSW097
      *                                                                   CSW097
     C                     EXSR ZCBDYS                                    CSW097
      *                                                                   CSW097
      ** INTEREST = PRINCIPAL ( 1 - 1 / ( 1 + RATE X NUMBER OF DAYS/360)) CSW097
      **       I.E. PRINCIPAL ( 1 - 360 / ( 360 + RATE X NUMBER OF DAYS)) CSW097
      *                                                                   CSW097
     C           ZCBDIV    MULT 100       ZIWRK3  50                      CSW097
      *                                                                   CSW097
     C           ZCBDAY    MULT ZDLRAT    ZIWRK4 157                      CSW097
     C                     ADD  ZIWRK3    ZIWRK4                          CSW097
      *                                                                   CSW097
     C           ZIWRK4    IFNE *ZERO                                     CSW097
     C           ZIWRK3    DIV  ZIWRK4    ZIWRK5 159H                     CSW097
     C           1         SUB  ZIWRK5    ZIWRK5                          CSW097
     C           ZDLAMT    MULT ZIWRK5    ZDLOUT    H                     CSW097
     C                     END                                            CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   CSW097
      /EJECT                                                              CSW097
      *****************************************************************   CSW097
      * Subroutine  :  SRPAMT                                         *   CSW097
      * Function    :  Calculate Principal Amount (RX only)           *   CSW097
      *                                                               *   CSW097
      * Called by   :  SRIRUF, SRIRTF                                 *   CSW097
      * Calls       :                                                 *   CSW097
      *****************************************************************   CSW097
     C           SRPAMT    BEGSR                                          CSW097
      *                                                                   CSW097
     C           IRCKY1    CHAINDLPCSCD0             71                   CSW097
     C           *IN71     IFEQ '0'                                       CSW097
     C           PDEI      ANDEQ'Y'                                       CSW097
      *                                                                   CSW097
     C           WOTIN     IFEQ 'U'                                       CSW097
     C           UPAMT     SUB  PAMT      WKPAMT 130                      CSW097
     C                     ELSE                                           CSW097
     C           TPAMT     SUB  PAMT      WKPAMT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C           WKPAMT    IFLT 0                                         CSW097
     C                     Z-SUBWKPAMT    ZZPAMT 130                      CSW097
     C                     ELSE                                           CSW097
     C                     Z-ADDWKPAMT    ZZPAMT                          CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDIF                                          CSW097
      *                                                                   CSW097
     C                     ENDSR                                          CSW097
      *****************************************************************   181962
      /EJECT                                                              181962
      *****************************************************************   181962
      * Subroutine  :  SRCADJ                                         *   181962
      * Function    :  Determine any interest adjustments             *   181962
      * Called by   :  SRY36N                                         *   181962
      * Calls       :                                                 *   181962
      *****************************************************************   181962
     C           SRCADJ    BEGSR                                          181962
      *                                                                   181962
      * Interest Adjustments                                              181962
     C                     Z-ADD0         WADJA  130                      181962
      * Accrued interest as at last payment date                          181962
     C                     Z-ADD0         WAINT  130                      181962
      *                                                                   181962
      *   Determine first payment date after current rate change          181962
      *   date                                                            181962
     C                     MOVE 'A'       WBEAF                           181962
     C                     MOVE ZOTIN     WOTIN                           181962
     C                     Z-ADDW#CRDT    WPRDT                           181962
      *                                                                   181962
     C                     MOVE 'N'       FOUND   1                       181962
      *                                                                   181962
     C           OLXKY1    SETLLDLOLCFL1                                  181962
     C           OLXKY3    READEDLOLCFL1            N    60               181962
      *                                                                   181962
     C           *IN60     DOWEQ*OFF                                      181962
     C           FOUND     ANDEQ'N'                                       181962
      *                                                                   181962
     C           W#MSSQ    IFEQ 'E'                                       181962
     C           W@OUF     ANDNE'Y'                                       181962
     C           CFPYDT    ANDLEW#NRDT                                    181962
      *                                                                   181962
     C           W#MSSQ    OREQ 'E'                                       181962
     C           W@OUF     ANDEQ'Y'                                       181962
     C           CFPYDT    ANDLTW#NRDT                                    181962
      *                                                                   181962
     C           W#MSSQ    OREQ 'C'                                       181962
     C           W@TUF     ANDNE'Y'                                       181962
     C           CFPYDT    ANDLEW#NRDT                                    181962
      *                                                                   181962
     C           W#MSSQ    OREQ 'C'                                       181962
     C           W@TUF     ANDEQ'Y'                                       181962
     C           CFPYDT    ANDLTW#NRDT                                    181962
      *                                                                   181962
      ** If interest paid in arrears, do not include payment              181962
      ** date equal to period start as this would have already            181962
      ** been reported on previous MT362.                                 181962
     C           W#MSSQ    IFEQ 'E'                                       181962
     C           W@OUF     ANDNE'Y'                                       181962
     C           CFPYDT    ANDEQW#CRDT                                    181962
     C           W#MSSQ    OREQ 'C'                                       181962
     C           W@TUF     ANDNE'Y'                                       181962
     C           CFPYDT    ANDEQW#CRDT                                    181962
     C                     ELSE                                           181962
     C                     MOVE 'Y'       FOUND                           181962
     C                     ENDIF                                          181962
      *                                                                   181962
     C                     ENDIF                                          181962
      *                                                                   181962
     C           OLXKY3    READEDLOLCFL1            N    60               181962
     C                     ENDDO                                          181962
      *                                                                   181962
      * First payment date found, accumulate previous                     181962
      * payments to get unadjusted accrued interest as at last            181962
      * payment date.                                                     181962
      *                                                                   181962
     C           FOUND     IFEQ 'Y'                                       181962
     C           OLXKY3    REDPEDLOLCFL1            N    60               181962
     C*                                                                   181962
     C           *IN60     DOWEQ'0'                                       181962
     C                     ADD  CFAMNT    WAINT                           181962
     C           OLXKY3    REDPEDLOLCFL1            N    60               181962
     C                     ENDDO                                          181962
      *                                                                   181962
      * Interest adjustment is                                            181962
      *  Int Paid/received to date - Accrued Interest as at last payment  181962
      *  date + Adjustments not posted.                                   181962
     C           WOTIN     IFEQ 'U'                                       181962
     C           WAINT     ADD  UAIAN     WADJA                           181962
     C                     ADD  UAIAP     WADJA                           181962
     C                     SUB  UIPRD     WADJA                           181962
     C                     ELSE                                           181962
     C           WAINT     ADD  TAIAN     WADJA                           181962
     C                     ADD  TAIAP     WADJA                           181962
     C                     SUB  TIPRD     WADJA                           181962
     C                     ENDIF                                          181962
     C                     ENDIF                                          181962
      *                                                                   181962
     C                     ENDSR                                          181962
      /EJECT                                                                                  195306
      *****************************************************************                       195306
      *                                                               *                       195306
      *  SREDAT - Determine the event date to be deleted              *                       195306
      *                                                               *                       195306
      * Called by   :  SRCOMM                                         *                       195306
      * Calls       :  None                                           *                       195306
      *                                                               *                       195306
      *****************************************************************                       195306
     C           SREDAT    BEGSR                                                              195306
      *                                                                                       195306
     C           *IN40     IFEQ '0'                                                           195306
     C           *IN41     ANDEQ'1'                                                           195306
     C           DVDAT     ANDGEBJRDNB                                                        195306
      *                                                                                       195306
     C                     Z-ADDDVDAT     PKEDAT                                              195306
     C                     ELSE                                                               195306
      *                                                                                       195306
     C           WNICD     IFNE *ZERO                                                         195306
     C                     Z-ADDWNICD     PKEDAT                                              195306
     C                     ELSE                                                               195306
     C                     Z-ADDDVDAT     PKEDAT                                              195306
     C                     ENDIF                                                              195306
      *                                                                                       195306
     C                     ENDIF                                                              195306
      *                                                                                       195306
     C                     ENDSR                                                              195306
      *****************************************************************                       CSW213
     C/EJECT                                                                                  CSW213
      *****************************************************************                       CSW213
      *                                                               *                       CSW213
      *   SRREPI - Reporting Information Subroutine                   *                       CSW213
      *                                                               *                       CSW213
      *****************************************************************                       CSW213
      *                                                                                       CSW213
     C           SRREPI    BEGSR                                                              CSW213
      *                                                                                       CSW213
     C           CSW213    IFEQ 'Y'                                                         MD023529
      *                                                                                     MD023529
     C**********           MOVELDTYP      KDTYP   2                                  CSW213 MD023278
     C**********           MOVELDDLNO     KLDLNO 16                                  CSW213 MD023278
     C********** RPIFKY    CHAINDLRPIFL1             13                              CSW213 MD023278
      **********                                                                     CSW213 MD023278
     C********** *IN13     IFEQ '0'                                                  CSW213 MD023278
      *                                                                                       CSW213
     C                     MOVE RIAPID    MGAPID                                              CSW213
     C                     MOVE RITRRF    MGTRRF                                              CSW213
     C                     MOVE RILNRF    MGLNRF                                              CSW213
     C                     MOVE RICPID    MGCPID                                              CSW213
     C                     MOVE RIDTYP    MGDTYP                                              CSW213
     C                     MOVE RIDLST    MGDLST                                              CSW213
     C                     MOVE RITRID    MGTRID                                              CSW213
     C                     MOVE RICCPI    MGCCPI                                              CSW213
     C                     MOVE RICCPA    MGCCPA                                              CSW213
     C                     MOVE RICEPI    MGCEPI                                              CSW213
     C                     MOVE RICEPA    MGCEPA                                              CSW213
     C                     MOVE RICBCI    MGCBCI                                              CSW213
     C                     MOVE RICBPI    MGCBPI                                              CSW213
     C                     MOVE RIPRID    MGPRID                                              CSW213
     C                     MOVE RIEXVE    MGEXVE                                              CSW213
     C                     MOVE RIUPID    MGUPID                                              CSW213
     C           RIUPID    IFEQ 'IRFRAG'                                                    MD029694
     C                     MOVE 'IRFRAF'  MGUPID                                            MD029694
     C                     ENDIF                                                            MD029694
      *                                                                                       CSW213
      ** Sort fields of 01                                                                    CSW213
      *                                                                                       CSW213
     C                     MOVE RIRJ01    MGRJ01                                              CSW213
     C                     MOVE RIRP01    MGRP01                                              CSW213
     C                     MOVE RIRN01    MGRN01                                              CSW213
     C                     MOVE RIRC01    MGRC01                                              CSW213
     C                     MOVE RIRS01    MGRS01                                              CSW213
     C                     MOVE RIRL01    MGRL01                                              CSW213
     C                     MOVE RIRA01    MGRA01                                              CSW213
     C                     MOVE RITIT1    MGTI01                                              CSW213
     C                     MOVE RIUT01    MGUT01                                              CSW213
     C                     MOVE RITNI1    MGTN01                                              CSW213
      *                                                                                       CSW213
      ** Sort fields of 02                                                                    CSW213
      *                                                                                       CSW213
     C                     MOVE RIRJ02    MGRJ02                                              CSW213
     C                     MOVE RIRP02    MGRP02                                              CSW213
     C                     MOVE RIRN02    MGRN02                                              CSW213
     C                     MOVE RIRC02    MGRC02                                              CSW213
     C                     MOVE RIRS02    MGRS02                                              CSW213
     C                     MOVE RIRL02    MGRL02                                              CSW213
     C                     MOVE RIRA02    MGRA02                                              CSW213
     C                     MOVE RITIT2    MGTI02                                              CSW213
     C                     MOVE RIUT02    MGUT02                                              CSW213
     C                     MOVE RITNI2    MGTN02                                              CSW213
      *                                                                                       CSW213
      ** Sort fields of 03                                                                    CSW213
      *                                                                                       CSW213
     C                     MOVE RIRJ03    MGRJ03                                              CSW213
     C                     MOVE RIRP03    MGRP03                                              CSW213
     C                     MOVE RIRN03    MGRN03                                              CSW213
     C                     MOVE RIRC03    MGRC03                                              CSW213
     C                     MOVE RIRS03    MGRS03                                              CSW213
     C                     MOVE RIRL03    MGRL03                                              CSW213
     C                     MOVE RIRA03    MGRA03                                              CSW213
     C                     MOVE RITIT3    MGTI03                                              CSW213
     C                     MOVE RIUT03    MGUT03                                              CSW213
     C                     MOVE RITNI3    MGTN03                                              CSW213
      *                                                                                       CSW213
      ** Sort fields of 04                                                                    CSW213
      *                                                                                       CSW213
     C                     MOVE RIRJ04    MGRJ04                                              CSW213
     C                     MOVE RIRP04    MGRP04                                              CSW213
     C                     MOVE RIRN04    MGRN04                                              CSW213
     C                     MOVE RIRC04    MGRC04                                              CSW213
     C                     MOVE RIRS04    MGRS04                                              CSW213
     C                     MOVE RIRL04    MGRL04                                              CSW213
     C                     MOVE RIRA04    MGRA04                                              CSW213
     C**********           MOVE RITIT1    MGTI04                                     CSW213 MD028991
     C                     MOVE RITIT4    MGTI04                                            MD028991
     C                     MOVE RIUT04    MGUT04                                              CSW213
     C                     MOVE RITNI4    MGTN04                                              CSW213
      *                                                                                       CSW213
     C                     MOVE RIETT1    MGET01                                              CSW213
     C                     MOVE RIETT2    MGET02                                              CSW213
     C                     MOVE RIETT3    MGET03                                              CSW213
     C                     MOVE RIETT4    MGET04                                              CSW213
     C                     MOVE RICGTI    MGCGTI                                              CSW213
     C                     MOVE RIALLI    MGALLI                                              CSW213
     C                     MOVE RICLLI    MGCLLI                                              CSW213
     C                     MOVE RINORS    MGNORS                                              CSW213
     C                     Z-ADDRIGEDT    MGGEDT                                              CSW213
     C                     Z-ADDRIGETM    MGGETM                                              CSW213
     C                     MOVE RIUSGN    MGUSGN                                              CSW213
     C                     Z-ADDRIUTCT    MGUTCT                                              CSW213
     C                     MOVE RILSID    MGLSID                                              CSW213
     C                     MOVE RIAR01    MGAR01                                              CSW213
     C                     MOVE RIAR02    MGAR02                                              CSW213
     C                     MOVE RIAR03    MGAR03                                              CSW213
     C                     MOVE RIAR04    MGAR04                                              CSW213
     C                     MOVE RIAR05    MGAR05                                              CSW213
     C                     MOVE RIAR06    MGAR06                                              CSW213
     C                     MOVE RIAR07    MGAR07                                              CSW213
     C                     MOVE RIAR08    MGAR08                                              CSW213
     C                     MOVE RIAR09    MGAR09                                              CSW213
     C                     MOVE RIAR10    MGAR10                                              CSW213
     C                     MOVE RIAR11    MGAR11                                              CSW213
     C                     MOVE RIAR12    MGAR12                                              CSW213
     C                     MOVE RIAR13    MGAR13                                              CSW213
     C                     MOVE RIAR14    MGAR14                                              CSW213
     C                     MOVE RIAR15    MGAR15                                              CSW213
     C                     MOVE RIAR16    MGAR16                                              CSW213
     C                     MOVE RIAR17    MGAR17                                              CSW213
     C                     MOVE RIAR18    MGAR18                                              CSW213
     C                     MOVE RIAR19    MGAR19                                              CSW213
     C                     MOVE RIAR20    MGAR20                                              CSW213
     C                     MOVE RIFOID    MGFOID                                              CSW213
     C                     MOVE RIAFOI    MGAFOI                                              CSW213
     C                     MOVE RICFRQ    MGCFRQ                                              CSW213
     C                     MOVE RICFGN    MGCFGN                                              CSW213
     C                     Z-ADDRICFNR    MGCFNR                                              CSW213
     C                     MOVE RIPRED    MGPRED                                              CSW213
     C                     MOVE RIBCCY    MGBCCY                                              CSW213
     C                     MOVE RIBPMI    MGBPMI                                              CSW213
     C                     MOVE RISCCY    MGSCCY                                              CSW213
     C                     MOVE RISPMI    MGSPMI                                              CSW213
     C                     MOVE RICHTP    MGCHTP                                              CSW213
     C                     Z-ADDRILCD     MGLCD                                               CSW213
     C                     MOVE RITMST    MGTMST                                              CSW213
      *                                                                                       CSW213
     C           CSW214    IFEQ 'Y'                                                           CSW214
     C                     MOVELRIFNCI    MGFNCI                                              CSW214
     C                     MOVELRICOPI    MGCOPI                                              CSW214
     C                     MOVELRICOPC    MGCOPC                                              CSW214
     C                     MOVELRIPOCI    MGPOCI                                              CSW214
     C                     MOVELRICOSI    MGCOSI                                              CSW214
     C                     MOVELRITNEI    MGTNEI                                              CSW214
     C                     MOVELRIIGTI    MGIGTI                                              CSW214
     C                     MOVELRICTFI    MGCTFI                                              CSW214
     C                     ENDIF                                                              CSW214
      *                                                                                       CSW214
     C**********           ENDIF                                                     CSW213 MD023278
      *                                                                                       CSW213
     C                     ENDIF                                                            MD023529
      *                                                                                     MD023529
     C                     ENDSR                                                              CSW213
      *****************************************************************
      /EJECT
      *****************************************************************                      BUG7873
      * Subroutine  :  SRPCPL                                         *                      BUG7873
      * Function    :  Calculate Principal Amount (RS only)           *                      BUG7873
      *                                                               *                      BUG7873
      * Called by   :  SRIRUF, SRIRTF                                 *                      BUG7873
      * Calls       :                                                 *                      BUG7873
      *****************************************************************                      BUG7873
     C           SRPCPL    BEGSR                                                             BUG7873
      *                                                                                      BUG7873
     C                     Z-ADD0         ZZPCPL 130                                         BUG7873
     C           IRCKY3    SETGTDLPCSCD0                                                     BUG7873
     C           DDLNO     REDPEDLPCSCD0                 71                                  BUG7873
     C           *IN71     IFEQ '0'                                                          BUG7873
      *                                                                                      BUG7873
     C                     Z-ADDPAMT      WKPCPL 130                                         BUG7873
     C           WKPCPL    IFLT 0                                                            BUG7873
     C                     Z-SUBWKPCPL    ZZPCPL                                             BUG7873
     C                     ELSE                                                              BUG7873
     C                     Z-ADDWKPCPL    ZZPCPL                                             BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                      BUG7873
     C                     ENDIF                                                             BUG7873
      *                                                                                      BUG7873
     C                     ENDSR                                                             BUG7873
      *****************************************************************                      BUG7873
      /EJECT                                                                                 BUG7873
     C/COPY ZSRSRC,ZDLINTZ1
      /EJECT
     C/COPY ZSRSRC,ZCBDYSZ1
     C/EJECT
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZACCH
     C/COPY ZSRSRC,ZCHKH
     C/COPY ZSRSRC,ZDATE9Z3                                               182370
     C/COPY ZSRSRC,ZDAT10Z2                                               182370
     C/COPY ZSRSRC,ZFRQB3                                                 CIR005
     C/COPY ZSRSRC,ZDATE1Z2                                               CIR005
     C/EJECT
      *****************************************************************
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                 CIR005
312831303130313130313031                                                  CIR005
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                        182370
00366007310109601461                                                                          182370
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                           182370
00000000310005900090001200015100181002120024300273003040033400365                             182370
** TSTAM - Dummy timestamp                                                                    CSW213
0001-01-01-00.00.00.000000                                                                    CSW213