     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Domestic MM brokerage account keys')          *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Dealing Module                                   *
     F*                                                               *
     F*  DL8100 - BROKERAGE ACCRUAL FILE UPDATE                       *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD058815           Date 19Jun23               *
      *  Prev Amend No. MD055733           Date 03Jul20               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *      
      *                 CGL184             Date 07Dec16               *
      *                 MD040431           Date 17Aug16               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER016A            Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 237063             Date 20Nov05               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 BUG7411            Date 01Jun05               *
      *                 CDL028             Date 07Feb05               *
      *                 229544             Date 15Sep04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CGL020             Date 08Nov02               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 199674             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CEU003             Date 28Mar98               *
      *                 121768             Date 19Feb98               *
     F*                 109932             DATE 03FEB98               *
     F*                 126017             DATE 17NOV97               *
     F*                 097885             DATE 31JAN97               *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 052258             DATE 26APR94               *
     F*                 066550             DATE 04FEB94               *
     F*                 046985             DATE 17MAR93               *
     F*                 S01390             DATE 14JUL92               *
     F*                 SA002              DATE 27/02/89              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Applied for MD061152. (Recompile)                 *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components.                                       *
      *           - Redeliver of MD050139.                            *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *      
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD040431 - Missing class reported on DL0295P2.  Output deal  *
      *             class on account key.                             *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  237063 - EU Tax fixes upgrade to MP build 103 (Recompile).   *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  BUG7411- CDL028 fields missing from DLGHISPD (Recompile)     *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  229544 - Recompiled due to inserted fields in DLCHISPD.      *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CGL020 - Midas Compliance Watch - Anti Money Laundering      *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDELDPP, MMDENBPP AND MMDENSPP .                 *
      *  199674 - Delete record from BKRATAA if deal no longer exists *
      *           on deals file                                       *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  CDL006 - Dealing Fiduciary (Recompile)                       *
     F*  CEU003 - EMU DL Settlement Currency Conversion:              *
     F*           Include processing required by EMU switchable       *
     F*           feature CEU003.                                     *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  109932 - Use DEALSALL instead of DEALALL as this includes    *
     F*           historic deals.                                     *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  052258 - Historic deals being excluded causing Database      *
     F*           error in Close of Business                          *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  046985 - BROKERAGE ACCRUED AMOUNT NOT ADDED BACD FIELD       *
     F*  S01390 - Release 10 Changes for Australianisation            *
     F*  SA002  - AUSTRALIAN BROKERAGE                                *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***TABDLEI*IF**E           K        DISK                            S01390
     F*********** TABLETAF                          KIGNORE               S01390
     F*********** TABTB20F                          KIGNORE               S01390
     F*********** TABTB70F                          KIGNORE               S01390
     F*********** TABTE10F                          KIGNORE               S01390
     F*********** TABTE20F                          KIGNORE               S01390
     F*********** TABTG20F                          KIGNORE               S01390
     F*********** TABLETHF                          KIGNORE               S01390
     F*********** TABLETIF                          KIGNORE               S01390
     F*********** TABLETKF                          KIGNORE               S01390
     F*********** TABLETLF                          KIGNORE               S01390
     F*********** TABLETMF                          KIGNORE               S01390
     F*********** TABLETPF                          KIGNORE               S01390
     F*********** TABLETRF                          KIGNORE               S01390
     F*********** TABLETSF                          KIGNORE               S01390
     F*********** TABLET1F                          KIGNORE               S01390
     F*********** TABLET2F                          KIGNORE               S01390
     F*********** TABLET5F                          KIGNORE               S01390
     F*********** TABLETXF                          KIGNORE               S01390
     FDAMSX   IF  E           K        DISK
     FBKRAT   UF  E           K        DISK
     F***DEALSC**IF**E           K        DISK                            052258
     F***DEALALL IF  E           K        DISK                      052258109932
     FDEALSALLIF  E           K        DISK                               109932
     F********    DEALSDAF                          KIGNORE         052258109932
     F            DEALSDBF                          KIGNORE               052258
     F            DEALSDDF                          KIGNORE               052258
     F            DEALSDEF                          KIGNORE               052258
     F            DEALSDGF                          KIGNORE               052258
     F********    DEALSDFF                          KIGNORE         052258109932
     F            DLBHISD0                          KIGNORE               109932
     F            DLDHISD0                          KIGNORE               109932
     F            DLEHISD0                          KIGNORE               109932
     F            DLGHISD0                          KIGNORE               109932
     F            MMDENBP0                          KIGNORE               109932
     F            MMDENSP0                          KIGNORE               109932
     F            MMDELDP0                          KIGNORE               109932
     F            FXDEALP0                          KIGNORE               109932
     F***DL8100P1O***E             75     PRINTER                      C  S01390
     FDL8100P1O   E             75     PRINTER      KINFDS SPOOL      UC  S01390
     FDL8100AUO   E                    PRINTER      KINFDS SPOOLU         S01390
     FBRKEYHH O   F     128            DISK                      A
     F***BRKEYDP O   F     128            DISK                      A                         CGL020
     F*BRKEYDP*O***F*****307************DISK**********************A                    CGL020 CDL038
     FBRKEYDP O   F     339            DISK                      A                            CDL038
     FBRKEYZZ O   F     128            DISK                      A
     F/COPY WNCPYSRC,DL8100F001
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F********************************************************************
     E**
     E                    AKY        10  1
     E***********         HCY        25  3               HOLIDAY CURENCIESS01390
     E***********         ZHC        50  3               ZFREQ SR. ARRAY  S01390
     E***********         ZFMD   12  12  2               ZFREQ SR. ARRAY  S01390
     E***********         ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYS01390
     E***********         ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYS01390
     E***********         ZMNM   12  12  3               ZDATE2 SR. ARRAY S01390
     E                    ZAR1       20  1               FORMAT SR. ARRAY
     E                    ZAR2       20  1               FORMAT SR. ARRAY
     E/COPY ZSRSRC,ZFREQBZ1                                               S01390
     E/COPY ZSRSRC,ZDATE2Z1                                               S01390
     E/COPY ZSRSRC,ZHOLE                                                  S01390
     E                    CPY@    1   1 80                                S01390
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E**
     E/COPY WNCPYSRC,DL8100E001
     IBKRATAAF
     I*
     I*    BROKERAGE ACCRUALS FILE.
     I*
     I              RECI                            RECIB
     I              DLNO                            DLNOB
     IDEAMSDHF    07
     I*
     I*    DEAL AMENDMENTS FILE - HEADER RECORD.
     I*
     I              RECI                            RECIDM
     I              DLNO                            DLNODM
     I              VDAT                            VDATDM
     I              PAQI                            ACRIND
     I*
     IDEAMSDIF    08
     I*
     I*    DEALS AMENDMENT FILE - DETAIL RECORD.
     I*
     I              RECI                            RECIDM
     I              DLNO                            DLNODM
     I              VDAT                            VDATDM
     I              DASN                            DASNDM
     I              DTYP                            DTYPDM
     I              DLST                            DLSTDM
     I              BRTT                            BRTTDM
     I              RTSP                            RTSPDM
     I              CCY                             CCYDM
     I              CNUM                            CNUMDM
     IDAMBRDIF    08
     I*
     I*    DEALS AMENDMENT FILE - DETAIL RECORD.
     I*
     I              RECI                            RECIDM
     I              DLNO                            DLNODM
     I              VDAT                            VDATDM
     I              DASN                            DASNDM
     I              DTYP                            DTYPDM
     I              DLST                            DLSTDM
     I              BRTT                            BRTTDM
     I              RTSP                            RTSPDM
     I              CCY                             CCYDM
     I              CNUM                            CNUMDM
     IDEAMSDJF    09
     I*
     I*    DEALS AMENDMENT FILE - TRAILER RECORD.
     I*
     I              RECI                            RECIDM
     I              DLNO                            DLNODM
     I              VDAT                            VDATDM
     I              DASN                            DASNDM
     I              NORE                            NORDAM
     I              NLRA                            NLRADM
     I              VLBF                            VLBFDM
     I              VLBL                            VLBLDM
     I              VLAF                            VLAFDM
     I              VLAL                            VLALDM
     IDAMBRDJF    09
     I*
     I*    DEALS AMENDMENT FILE - TRAILER RECORD.
     I*
     I              RECI                            RECIDM
     I              DLNO                            DLNODM
     I              VDAT                            VDATDM
     I              DASN                            DASNDM
     I              NORE                            NORDAM
     I              NLRA                            NLRADM
     I              VLBF                            VLBFDM
     I              VLBL                            VLBLDM
     I              VLAF                            VLAFDM
     I              VLAL                            VLALDM
     I            DS
     I**********                              1  10 AKEY                                    MD040431
     I                                        1  14 AKEY                                    MD040431
     I                                        1   2 ACKY01
     I                                        3   3 ACKY02
     I                                        4   5 ACKY03
     I                                        6   9 ACKY04
     I                                       10  10 ACKY05
     I                                       11  14 CLAS                                    MD040431
     I*********** DS                                                      S01390
     I***********                             1  75 HCCY                  S01390
     I***********                             1  75 HCY                   S01390
     I*
     I***LDA******* UDS                            256                    S01390
     I***********                           131 141 DBFILE                S01390
     ILDA         DS                            256                       S01390
     I                                      134 141 DBFILE                S01390
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I***********                           181 183 DBASE                 S01390
     I                                      181 1830DBASE                 S01390
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     ISDCURR    E DSSDCURRPD                                              S01390
     I* Currency Details Accesses Via Access Program                      S01390
     I*                                                                   S01390
     ISDGELR    E DSSDGELRPD                                              S01390
     I* General Ledger Details Accesses Via Access Program                S01390
     I*                                                                   S01390
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*                                                                   S01390
     IDSSDY     E DSDSSDY                                                 S01390
     I* Second DS For Access Programs, Long Data Structure                S01390
     I*                                                                   S01390
     ISPOOL       DS                                                      S01390
     I**    SPOOL FILE INFORMATION DATA STRUCTURE                         S01390
     I                                       83  92 SFILE                 S01390
     I                                    B 123 1240SFNUM                 S01390
     I*                                                                   S01390
     ISPOOLU      DS                                                      S01390
     I**    SPOOL FILE INFORMATION DATA STRUCTURE                         S01390
     I                                       83  92 SFILEU                S01390
     I                                    B 123 1240SFNUMU                S01390
     I*                                                                   S01390
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/SPACE 3                                                            S01390
     I/COPY ZSRSRC,ZHOLI                                                  S01390
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I*
     I/EJECT
     I/COPY WNCPYSRC,DL8100I001
     C*
     C*    FIRST CYCLE PROCESSING
     C*
     C           *IN10     IFEQ '0'
     C                     EXSR FIRSTC
     C                     END
     C*
     C                     READ BKRAT                    LR
     C           *INLR     IFEQ '0'
     C***********DLNOB     CHAINDEALSDCF             60                   052258
     C***********DLNOB     CHAINDEALALL              60             052258109932
     C           DLNOB     CHAINDEALSALL             60                   109932
     C           *IN60     IFEQ '1'
     C                     DELETBKRATAAF                                                      199674
     C********** *LOCK     IN   LDA                                                    S01390 199674
     C**********           MOVEL'DEALS'   DBFILE                                              199674
     C**********           MOVELDLNOB     DBKEY                                               199674
     C***********          MOVE '004'     DBASE                           S01390
     C**********           Z-ADD4         DBASE                                        S01390 199674
     C**********           OUT  LDA                                                    S01390 199674
     C**********           MOVE ON        *INLR                                               199674
     C**********           MOVE ON        *INU8                                               199674
     C                     ELSE
     C*
     C/COPY WNCPYSRC,DL8100C018
     C           VDAT      IFLE ECD                                       E36405
     C*
     C*    SET UP STANDARD INFORAMTION.
     C*
     C                     Z-ADDIACD      TIACD   50
     C                     Z-ADDNIDT      TNIDT   50
     C                     Z-ADDDAVD      TDAVD   50
     C                     Z-ADDPCPL      TPCPL  130
     C                     Z-ADD0         INTRST
     C                     Z-ADD0         BROKGE
     C                     ADD  1         INREC   50
     C*
     C*    REVERSAL PROCESSING?.
     C*
     C           RECI      IFEQ 'R'
     C                     EXSR REVSAL
     C                     ELSE
     C*
     C*    PROCESS BROKERAGE DEPENDANT ON A RATE.
     C*
     C           RACD      IFEQ 'R'
     C                     EXSR PROCRT
     C                     ELSE
     C*
     C*    PROCESS BROKERAGE DEPENDANT ON A FIXED AMOUNT.
     C*
     C           RACD      IFEQ 'A'
     C                     EXSR PROCAM
     C                     END
     C*
     C                     END
     C*
     C*    OUTPUT UPDATED BROKERAGE RECORD.
     C*
     C                     UPDATBKRATAAF
     C*
     C                     END
     C*
     C                     ELSE
     C                     EXCPTBKREL#
     C                     END
     C                     END                                            E36405
     C                     END
     C*
     C*    OUTPUT TRAILER TO BROKERAGE ACCOUNT KEYS FILE.
     C*
     CLR                   EXCPTBRKEYT
     C*
     C*    OUTPUT END OF REPORT.
     C*
     CLR         FILOPN    IFEQ 'Y'                                       S01390
     CLR         *INU8     IFEQ '1'                                       S01390
     CLR                   WRITEP1ERR                                     S01390
     CLR                   END                                            S01390
     CLR                   WRITEP1TOT1
     CLR                   END                                            S01390
     C*                                                                   S01390
     CLR         *INU8     IFEQ '1'                                       S01390
     CLR         *IN70     OREQ '1'                                       S01390
     CLR                   Z-ADD0         PAGE                            S01390
     CLR                   WRITEAUFMT                                     S01390
     CLR         *INU8     IFEQ '1'                                       S01390
     CLR                   WRITEAUDBER                                    S01390
     CLR                   END                                            S01390
     C*                                                                   S01390
     C** Report printer file to RCF via ZSFILE                            S01390
     C*                                                                   S01390
     CLR                   Z-ADDSFNUMU    ZSNUM   60                      S01390
     CLR                   CALL 'ZSFILE'                                  S01390
     CLR                   PARM           SEQ                             S01390
     CLR                   PARM *BLANKS   @ENT    3                       S01390
     CLR                   PARM           SFILEU                          S01390
     CLR                   PARM           ZSNUM                           S01390
     CLR                   PARM *BLANKS   ZSERR   1                       S01390
     C*                                                                   S01390
     C** Error during ZSFILE processing, return to calling program        S01390
     C*                                                                   S01390
     CLR         ZSERR     IFEQ 'Y'                                       S01390
     CLR                   SETON                     U7U8LR               S01390
     CLR                   END                                            S01390
     CLR                   END                                            S01390
     C*
     C/EJECT
     C********************************************************************
     C*
     C*      FIRST IS A SUBROUTINE TO PERFORM ALL FIRST CYCLE
     C*      CALCULATIONS.
     C*
     C           FIRSTC    BEGSR                           ** FIRST TAG **
     C*                                                                   E36337
     C*    PARAMETER LIST.                                                E36337
     C*                                                                   E36337
     C/COPY WNCPYSRC,DL8100C019
     C           *ENTRY    PLIST                                          E36337
     C                     PARM           RUNTYP  4        EGEN OR ANWD?  E36337
     C                     PARM           SEQ     5        SEQUENCE       S01390
     C*
     C*    KEY LIST FOR DEAMS FILE.
     C*
     C           DEAMKY    KLIST
     C                     KFLD           DKY1    60       DEAL NO.
     C                     MOVEACPY@      BIS@   80                       S01390
     C           *NAMVAR   DEFN           LDA                             S01390
     C*
     C*    GET INSTALLATION CONTROL RECS.
     C*
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'DLBROKR' DBPGM
     C                     OUT  LDA                                       S01390
     C                     MOVE '1'       ON      1
     C                     MOVE '0'       OFF     1
     C                     MOVE ON        *IN70
     C                     MOVE ON        *IN10
     C                     Z-ADD0         Z130   130
     C                     Z-ADD0         Z138   138
     C                     Z-ADD0         Z117   117
     C*
     C*****ICD.*1*********************************************************S01390
     C** READ BANK DETAILS VIA ACCESS PROGRAM                             S01390
     C*
     C***********          EXSR ZSYSTM                                    S01390
     C************IN99     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTABKY    DBKEY                           S01390
     C***********          MOVE '001'     DBASE                           S01390
     C***********          MOVE ON        *INLR                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          GOTO ENDFC                                     S01390
     C***********          END                                            S01390
     C                     CALL 'AOBANKR0'                                S01390
     C                     PARM '*DBERR ' RTCD    7                       S01390
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C           BJDFIN    IFEQ 'M'                                       S01390
     C                     SETON                     98                   S01390
     C                     END                                            S01390
     C*                                                                   CEU003
     C**   Check EMU switchable feature CEU003 in SCSARDPD file.          CEU003
     C*                                                                   CEU003
     C                     CALL 'AOSARDR0'                                CEU003
     C                     PARM '*MSG   ' RTCD                            CEU003
     C                     PARM '*VERIFY' OPTN                            CEU003
     C                     PARM 'CEU003'  @SARD   6                       CEU003
     C*                                                                   CEU003
     C           RTCD      IFEQ *BLANKS                                   CEU003
     C                     MOVE 'Y'       CEU003  1                       CEU003
     C                     ELSE                                           CEU003
     C                     MOVE 'N'       CEU003                          CEU003
     C                     ENDIF                                          CEU003
     C/COPY WNCPYSRC,DL8100C001
      *                                                                                       CGL020
      ** Initialise work variables                                                            CGL020
      *                                                                                       CGL020
     C                     Z-ADD0         ZERO13 130                                          CGL020
     C                     Z-ADD0         ZERO5   52                                          CGL020
     C                     MOVE *BLANKS   QQAKEY 10                                         MD040431
     C*
     C*****ICD.*2*********************************************************S01390
     C** READ GENERAL LEDGER DETAILS VIA ACCESS PROGRAM                   S01390
     C*
     C***********          MOVE ZTABKY    ZTAB2  12                       S01390
     C***********          MOVE '11'      ZTAB2                           S01390
     C***********ZTAB2     CHAINTABDLEI              18                   S01390
     C************IN18     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTAB2     DBKEY                           S01390
     C***********          MOVE '002'     DBASE                           S01390
     C***********          MOVE ON        *INLR                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          GOTO ENDFC                                     S01390
     C***********          END                                            S01390
     C*                                                                   S01390
     C**********           CALL 'AOGELRR0'                                S01390              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' RTCD                            S01390
     C                     PARM '*FIRST ' OPTN                            S01390
     C********** SDGELR    PARM SDGELR    DSFDY                           S01390              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
     C*    ICD. DEALING
     C*
     C***********          MOVE '40'      ZTAB2                           S01390
     C***********ZTAB2     CHAINTABDLEI              18                   S01390
     C************IN18     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTAB2     DBKEY                           S01390
     C***********          MOVE '003'     DBASE                           S01390
     C***********          MOVE ON        *INLR                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          GOTO ENDFC                                     S01390
     C***********          END                                            S01390
     C*
     C*****GET*NUMBER*OF*DECIMAL*POSITIONS*OF*LOCY************************S01390
     C*    GET NUMBER OF DECIMAL POSITIONS OF BJLCCY                      S01390
     C*
     C***********          MOVE *BLANKS   ZTAB2                           S01390
     C***********          MOVEL'20'      ZTAB2                           S01390
     C***********          MOVELLOCY      TEMP4   4                       S01390
     C***********          MOVE '1'       TEMP4                           S01390
     C***********          MOVE TEMP4     ZTAB2                           S01390
     C***********ZTAB2     CHAINTABDLEI              18                   S01390
     C                     CALL 'AOCURRR0'                                S01390
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM '*KEY   ' OPTN                            S01390
     C                     PARM BJLCCY    KYCY    3                       S01390
     C           SDCURR    PARM SDCURR    DSSDY                           S01390
     C*                                                                   S01390
     C************IN18     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTAB2     DBKEY                           S01390
     C***********          MOVE '010'     DBASE                           S01390
     C           RTCD      IFNE *BLANKS                                   S01390
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'SDCURRPD'DBFILE                          S01390
     C                     MOVELBJLCCY    DBKEY                           S01390
     C                     Z-ADD10        DBASE                           S01390
     C                     OUT  LDA                                       S01390
     C                     MOVE ON        *INLR
     C                     MOVE ON        *INU8
     C                     EXSR *PSSR                                     S01390
     C                     GOTO ENDFC
     C                     ELSE
     C***********          Z-ADDCDP       DEC     10                      S01390
     C                     Z-ADDA6NBDP    DEC     10                      S01390
     C                     END
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C*
     C*    OUTPUT DKEYS HEADER RECORD AND OUTPUT REPORT HEADER REC.
     C*
     C***********          WRITEP1HEAD                                    S01390
     C                     EXCPTBRKEYH
     C           TOTNDT    ADD  1         TOTNDT  50
     C           DKREC     ADD  1         DKREC
     C           TOTDLS    ADD  1         TOTDLS  50
     C*
     C*    CALCULATE MONTH END DATE
     C*
     C***********          Z-ADDRUND      ZDAYNO                          S01390
     C                     Z-ADDBJRDNB    ZDAYNO                          S01390
     C                     EXSR ZDATE2
     C                     MOVE ZFMD,ZMTH TEMP2   20
     C*
     C           *IN91     IFEQ ON                         LEAP YEAR
     C           ZMTH      ANDEQ02                         FEBRUARY
     C                     ADD  1         TEMP2
     C                     END
     C*
     C           *IN98     IFEQ OFF                        DDMMYY
     C                     MOVELTEMP2     ZDATE
     C                     ELSE                            MMDDYY
     C                     MOVE TEMP2     ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     END
     C*
     C                     EXSR ZDATE1                     MONTH END
     C                     Z-ADDZDAYNO    MEND    50       DATE
     C*
     C*    EVENT CONTROL DATE = THE EARLIER OF EITHER THE 'ACCRUAL
     C*      PROFIT DATE' OR 'THE DATE OF NEXT WORKING DAY - 1'.
     C*
     C***********DNWD      SUB  1         ECD     50                      S01390
     C***********APDA      IFLT ECD                                       S01390
     C***********          Z-ADDAPDA      ECD                             S01390
     C           BJDNWD    SUB  1         ECD     50                      S01390
     C           BKAPDT    IFLT ECD                                       S01390
     C                     Z-ADDBKAPDT    ECD                             S01390
     C                     END
     C*
     C*    ESTABLISH IF BROKERAGE SHOULD BE PAID.
     C*
     C                     MOVE 'N'       BTBP                            E36337
     C           MEND      IFLE ECD
     C           RUNTYP    ANDEQ'EGEN'                                    E36337
     C                     MOVE 'Y'       BTBP    1
     C*                    ELSE                                           E36337
     C*                    MOVE 'N'       BTBP                            E36337
     C                     END
     C*
     C*    INITILIZE PARAMETERS FOR FORMAT SUBROUTINE.
     C*
     C                     Z-ADD17        ZCHRO
     C                     MOVE ' '       ZSIGNT
     C                     MOVE 'N'       ZSIGN
     C                     MOVE 'Y'       ZCOMA
     C*
     C/COPY WNCPYSRC,DL8100C009
     C           ENDFC     ENDSR                           ** ENDFC  ** **
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    REVSAL SR. REVERSAL OF BROKERAGE ACCRUALS AND PAYMENTS.
     C*
     C           REVSAL    BEGSR                           ** REVSAL ****
     C*
     C*    ACCUMULATE NUMBER OF RECORDS REVERSED.
     C*
     C                     ADD  1         RVREC   50
     C*
     C*    SET UP ACCRUAL REVERSAL INFORMATION.
     C*
     C***********          Z-ADDRUND      EDAT    50                      S01390
     C                     Z-ADDBJRDNB    EDAT    50                      S01390
     C                     Z-ADD1         REVI    10
     C                     Z-ADDBAPD      EAMT   130
     C                     MOVE 'Y'       RVSL
     C*
     C*    OUTPUT REVERSAL OF ACCRUAL KEY TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxAyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'A'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C*    SET UP PAYMENT REVERSAL INFORMATION.
     C*
     C                     Z-ADDBRPD      EAMT
     C*
     C*    OUTPUT REVERSAL OF PAYMENT KEY TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxPyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'P'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C*      DELETE THE APPROPRIATE RECORD FROM BKRAT FILE.
     C*
     C                     DELETBKRATAAF
     C                     MOVE ' '       RVSL
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCRT SR. PROCESS BROKERAGE RATE.
     C*
     C           PROCRT    BEGSR                           ** PROCRT ****
     C*
     C*    CALCULATE BROKERAGE RATE.
     C*
     C                     MOVE BAGE      RBAGE  137
     C*
     C*    SET LOWER LIMITS ON DEAMS FILE.
     C*
     C           TDAVD     IFNE 0
     C                     Z-ADDDLNO      DKY1
     C           DEAMKY    SETLLDAMSX
     C*
     C*    READ THE DEAL AMENDMENT RECORD.
     C*
     C                     MOVEA'000'     *IN,07
     C           DEAMKY    READEDAMSX                    42
     C           *IN42     IFEQ ON
     C                     Z-ADD0         TDAVD
     C                     ELSE
     C*
     C*    IF AMEND TYPE = CO THEN END OF AMENDMENTS
     C*
     C           AMTP      IFEQ 'CO'
     C                     Z-ADD0         TDAVD
     C                     END
     C                     END
     C                     END
     C*
     C*    HAS THE DEAL MATURED?
     C*
     C           RECI      IFEQ 'M'
     C           RECI      OREQ 'N'                                       052258
     C*
     C*     PRODUCE PAID A/C KEYS. PERFORM MATURITY DATE PROCESSING
     C*
     C           BTBP      IFEQ 'Y'
     C                     EXSR MDATSR
     C                     END
     C                     ELSE
     C*
     C*    CHECK DATE PROCESSING.
     C*
     C           *IN31     DOUEQOFF
     C                     Z-ADDECD       TEMP    50
     C                     MOVEA'000000'  *IN,26
     C*
     C           ECD       IFLE TEMP
     C           BTBP      ANDEQ'Y'
     C                     Z-ADDECD       TEMP
     C                     MOVE ON        *IN30
     C                     END
     C*
     C           MEND      IFLE TEMP
     C           BTBP      ANDEQ'Y'                                       E36337
     C                     Z-ADDMEND      TEMP
     C                     MOVE ON        *IN29
     C                     END
     C*
     C           TNIDT     IFGT 0
     C           TNIDT     ANDLETEMP
     C                     Z-ADDTNIDT     TEMP
     C                     MOVE ON        *IN28
     C                     MOVE ON        *IN31
     C                     END
     C*
     C           MDAT      IFGT 0
     C           MDAT      ANDLETEMP
     C           RECIB     ANDNE'M'                                       E36375
     C                     Z-ADDMDAT      TEMP
     C                     MOVE ON        *IN27
     C                     MOVE OFF       *IN31
     C                     END
     C*
     C           TDAVD     IFGT 0
     C           TDAVD     ANDLETEMP
     C                     Z-ADDTDAVD     TEMP
     C                     MOVE ON        *IN26
     C                     MOVE ON        *IN31
     C                     END
     C*
     C           *IN26     IFEQ ON
     C*     PERFORM NEXT DEAL AMMENDMENT DATE PROCESSING
     C                     EXSR DEAMSR
     C                     ELSE
     C*
     C           *IN27     IFEQ ON
     C*     PERFORM MATURITY DATE PROCESSING
     C                     EXSR MDATSR
     C                     ELSE
     C*
     C           *IN28     IFEQ ON
     C*     PERFORM NEXT INTEREST DATE PROCESSING
     C                     EXSR NIDTSR
     C                     ELSE
     C*
     C           *IN29     IFEQ ON
     C*     PERFORM END OF MONTH DATE PROCESSING
     C                     EXSR MENDSR
     C                     ELSE
     C*
     C           *IN30     IFEQ ON
     C*     PERFORM EVENT CONTROL DATE PROCESSING
     C                     EXSR ECDSR
     C                     ELSE
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     END                             ENDDO
     C*
     C                     END
     C*
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCAM SR. PROCESS BROKERAGE AMOUNT
     C*
     C           PROCAM    BEGSR                           ** PROCAM ****
     C*
     C*    PRODUCE ACCRUAL KEY IN EITHER ONE (BUT NOT BOTH) OF THE
     C*       THE FOLLOWING SITUATIONS;
     C*       1/  A DEAL MATURES BEFORE IT HITS IT'S FIRST MONTH END,
     C*       2/  A DEAL HAS NOT MATURED BEFORE IT HITS IT'S FIRST
     C*              MONTH END DATE AND BROKERAGE IS TO BE PAID.
     C*
     C*          MDAT      IFLE MEND                                      E36365
     C**         VDAT      IFLE ECD                                E36369 E36405
     C           MDAT      IFLE ECD                                       E36365
     C           BAPD      ANDEQ0
     C           BTBP      OREQ 'Y'
     C           BAPD      ANDEQ0
     C*
     C*    PRODUCE ACCRUAL KEYS.
     C*
     C                     Z-ADDBAGE      BACD
     C                     Z-ADDBAGE      BAPD
     C                     MOVE 'D'       RECIB
     C                     Z-ADD0         REVI
     C                     Z-ADDBAPD      EAMT
     C           MDAT      IFLE MEND
     C*
     C*      IF DEAL MATURING THEN SET RECORD ID TO 'M'
     C*
     C                     Z-ADDMDAT      EDAT
     C                     MOVE 'M'       RECIB
     C                     ELSE
     C                     Z-ADDMEND      EDAT
     C                     END
     C*
     C*    OUTPUT ACCRUAL KEY TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxAyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'A'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C                     END
     C*
     C*    PRODUCE PAYMENT KEY IN THE ON THE FIRST MONTH END DATE.
     C*
     C           BTBP      IFEQ 'Y'
     C           BRPD      ANDEQ0                                         E36365
     C*
     C*    SET UP PAYMENT INFORMATION.
     C*
     C                     Z-ADDBAPD      BRPD
     C                     MOVE 'D'       RECIB
     C                     Z-ADD0         REVI
     C                     Z-ADDBRPD      EAMT
     C                     Z-ADDMEND      EDAT
     C*
     C*    OUTPUT PAYMENT KEY TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxPyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'P'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C                     END
     C**                   END                                     E36369 E36405
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    OUTKEY SR. OUTPUT RECORKD TO BROKERAGE KEYS FILE.
     C*
     C           OUTKEY    BEGSR                           ** OUTKEY ****
     C*
     C*    DO NOT OUTPUT BLANK EVENT AMOUNT
     C*
     C********   EAMT      IFGT 0
     C           EAMT      IFNE 0
     C*
     C*    OUTPUT ACCOUNT KEY.
     C*
     C                     EXCPTBRKEYD
     C                     MOVE OFF       *IN70
     C*
     C*    UPDATE TOTALS FOR TRAILER RECORD.
     C*
     C                     ADD  1         DKREC   50
     C*
     C           EAMT      DIV  1000      ZZAMT
     C           ZZAMT     IFLT 0
     C                     Z-SUBZZAMT     ZZAMT
     C                     END
     C                     Z-ADDTOTDKI    ZZTOTI                CONTROLS
     C                     Z-ADDTOTDKD    ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    TOTDKI 150
     C                     Z-ADDZZTOTD    TOTDKD  30
     C*
     C*    FORMAT AND OUTPUT ACCOUNT KEY INFORMATION TO REPORT.
     C*
     C           FILOPN    IFNE 'Y'                                       S01390
     C                     OPEN DL8100P1                                  S01390
     C                     Z-ADD0         PAGE1                           S01390
     C                     SETOF                     75                   S01390
     C                     WRITEP1HEAD                                    S01390
     C                     MOVEL'Y'       FILOPN  1                       S01390
     C*                                                                   S01390
     C** Report printer file to RCF via ZSFILE                            S01390
     C*                                                                   S01390
     C                     Z-ADDSFNUM     ZSNUM   60                      S01390
     C                     CALL 'ZSFILE'                                  S01390
     C                     PARM           SEQ                             S01390
     C                     PARM *BLANKS   @ENT                            S01390
     C                     PARM           SFILE                           S01390
     C                     PARM           ZSNUM                           S01390
     C                     PARM *BLANKS   ZSERR                           S01390
     C*                                                                   S01390
     C** Error during ZSFILE processing, return to calling program        S01390
     C*                                                                   S01390
     C           ZSERR     IFEQ 'Y'                                       S01390
     C                     SETON                     U7U8LR               S01390
     C                     END                                            S01390
     C                     END                                            S01390
     C*                                                                   S01390
     C*      CHECK FOR OVERFLOW.
     C*
     C           *IN75     IFEQ ON
     C                     WRITEP1HEAD
     C                     MOVE OFF       *IN75
     C                     END
     C*
     C*      FORMAT EVENT DATE.
     C*
     C                     Z-ADDEDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     Z-ADDZDATE     EDATE   60
     C*
     C*      FORMAT EVENT AMOUNT.
     C*
     C                     MOVE EAMT      ZNUMIN
     C                     Z-ADDDEC       ZDEC
     C                     EXSR FORMAT
     C                     MOVE ZNUMOT    EAMTA  17
     C*
     C*      OUTPUT TO REPORT.
     C*
     C                     WRITEP1DET1
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    DEAMSR SR. PERFORM DEAL AMENDMENT PROCESSING.
     C*
     C           DEAMSR    BEGSR                           ** DEAMSR ****
     C/COPY WNCPYSRC,DL8100C005
     C*
     C*    CALCULATE INTEREST FROM TIACD TO TDAVD.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C                     Z-ADDTDAVD     ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDINTR      ZIRATE
     C/COPY WNCPYSRC,DL8100C010
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL8100C011
     C***********          Z-ADDWKINT     INTRST 130                      S01390
     C                     Z-ADDZINTR     INTRST 130H                     S01390
     C*
     C*    CALCULATE BROKERAGE FROM TIACD TO TDAVD.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C                     Z-ADDTDAVD     ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDRBAGE     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDWKINT     BROKGE 130                      S01390
     C                     Z-ADDZINTR     BROKGE 130H                     S01390
     C*
     C*    IF AMENDMENT TYPE NOT SETTLE INTEREST (SI) PERFORM ACCRUAL
     C*
     C           AMTP      IFNE 'SI'
     C*      1/ ADD INTEREST TO IACD AMOUNT
     C                     ADD  INTRST    AITC
     C*      2/ RESET TIACD TO TDAVD
     C                     Z-ADDTDAVD     TIACD
     C*      3/ ADD BROKERAGE TO BROKERAGE ACD AMOUNT
     C                     ADD  BROKGE    BACD
     C*      4/ INITILIZE INT CALC'D AND BROK CALC'D
     C                     Z-ADD0         INTRST
     C                     Z-ADD0         BROKGE
     C*
     C*    IF PRINCIPLE INCREASE THEN INCREASE PRINCIPLE.
     C*
     C           AMTP      IFEQ 'PI'
     C                     ADD  DAAM      TPCPL
     C                     ELSE
     C*
     C*    IF PRINCIPLE DECREASE THEN DECREASE PRINCIPLE.
     C*
     C           AMTP      IFEQ 'PD'
     C                     SUB  DAAM      TPCPL
     C                     ELSE
     C*
     C*    IF AMENDMENT IS CAPITILISE INT. THEN UPDATE PRINCIPLE
     C*
     C           AMTP      IFEQ 'CI'
     C*      1/ ADD INTEREST ACCRUED AND ADJUSTMENTS TO PRINCIPLE
     C                     ADD  AITC      TPCPL
     C                     ADD  AIAN      TPCPL
     C                     ADD  AIAP      TPCPL
     C*      2/ SUBTRACT INTEREST PAID/RECEIVED TO DATE FROM PRINCIPLE
     C                     SUB  IPRD      TPCPL
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*    READ THE NEXT DEAL AMENDMENT RECORD.
     C*
     C                     MOVEA'000'     *IN,07
     C           DEAMKY    READEDAMSX                    42
     C           *IN42     IFEQ ON
     C                     Z-ADD0         TDAVD
     C                     ELSE
     C*
     C*    IF AMEND TYPE = CO THEN END OF AMENDMENTS
     C*
     C           AMTP      IFEQ 'CO'
     C                     Z-ADD0         TDAVD
     C                     ELSE
     C*
     C*    REPLACE TDAVD WITH NEXT DEAL AMENDMENT EVENT DATE
     C*
     C                     Z-ADDVDATDM    TDAVD
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    MDATSR SR. PERFORM MATURITY DATE PROCESSING.
     C*
     C           MDATSR    BEGSR                           ** MDATSR ****
     C/COPY WNCPYSRC,DL8100C006
     C*                                                                   E36371
     C*    The code enclosed by the following IF statement has been       E36371
     C*    inserted to conform with the updating of the IACD field        E36371
     C*    in DL0280 & should be amended in accordance with amendments    E36371
     C*    to that program.                                               E36371
     C*                                                                   E36371
     C           IPFR      IFEQ 'N'                                       E36371
     C*
     C*    CALCULATE INTEREST FROM TIACD TO MDAT.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C                     Z-ADDMDAT      ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDINTR      ZIRATE
     C/COPY WNCPYSRC,DL8100C012
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL8100C013
     C***********          Z-ADDWKINT     INTRST 130                      S01390
     C                     Z-ADDZINTR     INTRST 130H                     S01390
     C*
     C*    CALCULATE BROKERAGE FROM TIACD TO MDAT.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C                     Z-ADDMDAT      ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDRBAGE     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDWKINT     BROKGE 130                      S01390
     C                     Z-ADDZINTR     BROKGE 130H                     S01390
     C*
     C*    PERFORM INTEREST ACCRUAL.
     C*
     C*      1/ ADD INTEREST TO IACD AMOUNT
     C                     ADD  INTRST    AITC
     C*      2/ RESET TIACD TO MDAT
     C                     Z-ADDMDAT      TIACD
     C*      3/ ADD BROKERAGE TO BROKERAGE ACD AMOUNT
     C                     ADD  BROKGE    BACD
     C*
     C                     END                                            E36371
     C*
     C*      4/ INITILIZE INT CALC'D AND BROK CALC'D
     C                     Z-ADD0         INTRST
     C                     Z-ADD0         BROKGE
     C*
     C*    REPLACE TIACD WITH MDAT .
     C*
     C*                    Z-ADDMDAT      TIACD                           E36371
     C*
     C*    IF BROKERAGE TO BE PAID THEN PRODUCE KEY.
     C*
     C           BTBP      IFEQ 'Y'
     C                     EXSR MENDSR
     C                     ELSE
     C*
     C*    OTHERWISE CALCULATE BROKERAGE TO BE ACCRUED ONLY
     C*
     C                     EXSR ECDSR
     C                     END
     C*
     C*    SET THE BROKERAGE ACCRUAL RECORD TO 'M' (MATURED)
     C*
     C                     MOVE 'M'       RECIB
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    NIDTSR SR. PERFORM NEXT INTEREST DATE PROCESSING.
     C*
     C           NIDTSR    BEGSR                           ** NIDTSR ****
     C/COPY WNCPYSRC,DL8100C007
     C*
     C*    CALCULATE INTEREST FROM TIACD TO TNIDT.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C           TNIDT     ADD  1         ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDINTR      ZIRATE
     C/COPY WNCPYSRC,DL8100C014
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL8100C015
     C***********          Z-ADDWKINT     INTRST 130                      S01390
     C                     Z-ADDZINTR     INTRST 130H                     S01390
     C*
     C*    CALCULATE BROKERAGE FROM TIACD TO TNIDT.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C           TNIDT     ADD  1         ZIEND
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDRBAGE     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDWKINT     BROKGE 130                      S01390
     C                     Z-ADDZINTR     BROKGE 130H                     S01390
     C*
     C*    IF INTEREST CAP. IND. = 'Y' CALCULATE INT. TO CAPITILISE.
     C*
     C           INTC      IFEQ 'Y'
     C*      1/ ADD INTEREST TO IACD AMOUNT
     C                     ADD  INTRST    AITC
     C*      2/ RESET TIACD TO TNIDT
     C           TNIDT     ADD  1         TIACD
     C*      3/ ADD BROKERAGE TO BROKERAGE ACD AMOUNT
     C                     ADD  BROKGE    BACD
     C*      4/ INITILIZE INT CALC'D AND BROK CALC'D
     C                     Z-ADD0         INTRST
     C                     Z-ADD0         BROKGE
     C*
     C*    CAPITILISE INTEREST ACCRUED.
     C*
     C*      1/ ADD AITC TO PRINCIPLE
     C                     ADD  AITC      TPCPL
     C*      2/ ADD ADJUSTMENTS TO PRINCIPLE
     C                     ADD  AIAN      TPCPL
     C                     ADD  AIAP      TPCPL
     C*      3/ SUBTRACT INTEREST PAID/RECEIVED TO DATE FROM PRINCIPLE
     C                     SUB  IPRD      TPCPL
     C*
     C*
     C*    REPLACE TIACD WITH TNIDT.
     C*
     C           TNIDT     ADD  1         TIACD
     C                     END
     C*
     C*    CALCULATE NEW NIDT.
     C*
     C           IPFR      IFNE ' '
     C*
     C*      CALCULATE NEXT NIDT.
     C*
     C           IPFR      IFEQ 'N'                        CHANGE AUST.
     C                     MOVE 'L'       IPFR             FREQ 'N' TO
     C                     END                             FREQ 'L'
     C                     MOVE IPFR      ZFREQ
     C                     Z-ADDTNIDT     ZDAYNO
     C                     Z-ADDINTF      ZMDAY
      *                                                                   CEU003
      * Prior to calling sr/ZFREQB, amend the setting of input field      CEU003
      *  ZCCY to ISCY or STCY basing on CEU003 flag and IPDS (Interest    CEU003
      *  paid separately).                                                CEU003
      *                                                                   CEU003
     C                     SELEC                                          CEU003
     C           CEU003    WHEQ 'Y'                                       CEU003
     C           IPDS      ANDEQ'Y'                                       CEU003
     C           ISCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE ISCY      ZCCY                            CEU003
     C           CEU003    WHEQ 'Y'                                       CEU003
     C           IPDS      ANDNE'Y'                                       CEU003
     C           STCY      ANDNE*BLANKS                                   CEU003
     C                     MOVE STCY      ZCCY                            CEU003
     C                     OTHER                                          CEU003
     C                     MOVE CCY       ZCCY
     C                     ENDSL                                          CEU003
      *                                                                   CEU003
     C/COPY WNCPYSRC,DL8100C002
     C                     EXSR ZFREQB
     C/COPY WNCPYSRC,DL8100C003
     C                     Z-ADDZDAYNO    NNIDT   50
     C*
     C*    IF MDAT > 0 AND NEW NIDT <= MDAT THEN RESET TNIDT
     C*
     C           MDAT      IFGT 0
     C           NNIDT     ANDLEMDAT
     C                     Z-ADDNNIDT     TNIDT
     C                     ELSE
     C                     Z-ADD0         TNIDT
     C                     END
     C*
     C                     ELSE
     C                     Z-ADD0         TNIDT
     C                     END
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    MENDSR SR. PERFORM MONTH END DATE PROCESSING.
     C*
     C           MENDSR    BEGSR                           ** MENDSR ****
     C*
     C*    PERFORM BROKERAGE ACCRUAL PROCESSING.
     C*
     C                     EXSR ECDSR
     C*
     C*    CALCULATE BROKERAGE TO BE PAID.
     C*
     C*      SUTRACT BROKERAGE PAID FROM BROKERAGE ACCRUED TO DATE.
     C*
     C           BRATD     SUB  BRPD      BRTBP  130
     C*
     C*    FORMAT EVENT INFORMATION.
     C*
     C*      EVENT DATE DEPENDS ON THE EVENT BEING PROCESSED.
     C*
     C           *IN27     IFEQ ON
     C                     Z-ADDMDAT      EDAT
     C                     ELSE
     C                     Z-ADDMEND      EDAT
     C                     END
     C                     Z-ADD0         REVI
     C                     Z-ADDBRTBP     EAMT
     C*
     C*    OUTPUT PAYMENT KET TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxPyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'P'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C*    CALCULATE BROKERAGE PAID TO DATE.
     C*
     C*      ADD 'BROKERAGE TO BE PAID' TO BROKERAGE PAID.
     C                     ADD  BRTBP     BRPD
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    ECDSR SR. PERFORM ACCRUAL DATE PROCESSING.
     C*
     C           ECDSR     BEGSR                           ** ECDSR  ****
     C/COPY WNCPYSRC,DL8100C008
     C*
     C*    CALCULATE BROKERAGE FROM TIACD TO ECD.
     C*
     C                     Z-ADDTIACD     ZIBEG
     C           ECD       ADD  1         ZIEND
     C           MDAT      IFGT 0
     C           MDAT      ANDLEECD
     C                     Z-ADDMDAT      ZIEND
     C                     END
     C                     Z-ADDTPCPL     ZIAMT
     C                     Z-ADDICBS      ZICALC
     C                     Z-ADDRBAGE     ZIRATE
     C/COPY WNCPYSRC,DL8100C016
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,DL8100C017
     C***********          Z-ADDWKINT     BROKGE                          S01390
     C                     Z-ADDZINTR     BROKGE 130H                     S01390
     C*
     C*      ADD BROKERAGE CALCULATED TO BROKERAGE ACCRUED TO
     C*        CONTROL DATE TO GIVE BROKERAGE ACCRUED TO DATE.
     C*
     C           BACD      ADD  BROKGE    BRATD  130
     C**                                                                  046985
     C**    SHOULD ALSO ADD TO BROKERAGE ACCRUED TO CONTROL DATE          046985
     C**                                                                  046985
     C           BACD      ADD  BROKGE    BACD                            046985
     C*
     C*    CALCULATE BROKERAGE TO BE ACCRUED.
     C*
     C*      SUBTRACT BROKERAGE ACCRUALS POSTED TO DATE TO GIVE
     C*        BROKERAGE TO BE ACCRUED.
     C*
     C           BRATD     SUB  BAPD      BRTBA  130
     C*
     C*    FORMAT EVENT INFORMATION.
     C*
     C*      EVENT DATE DEPENDS ON THE EVENT BEING PROCESSED.
     C*
     C           *IN27     IFEQ ON
     C                     Z-ADDMDAT      EDAT
     C                     ELSE
     C           *IN29     IFEQ ON
     C                     Z-ADDMEND      EDAT
     C                     ELSE
     C                     Z-ADDECD       EDAT
     C                     END
     C                     END
     C                     Z-ADD0         REVI
     C                     Z-ADDBRTBA     EAMT
     C*
     C*    OUTPUT ACCRUAL KEY TO ACCOUNT KEYS FILE
     C*
     C*      THE FORMAT OF THE KEY IS xxAyynnnnB WHERE;
     C*          xx   = DEAL TYPE
     C*          yy   = DEAL SUB-TYPE
     C*          nnnn = BROKER CODE
     C*
     C                     MOVE DTYP      ACKY01
     C                     MOVE 'A'       ACKY02
     C                     MOVE DLST      ACKY03
     C                     MOVE BRKC      ACKY04
     C                     MOVE 'B'       ACKY05
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C*    CALCULATE TOTAL BROKERAGE POSTED TO DATE.
     C*
     C*      ADD BROKERAGE TO BE ACCRUED TO BROKERAGE POSTED TO DATE.
     C*
     C                     ADD  BRTBA     BAPD
     C*
     C*      OUTPUT THE ACCOUNT KEY RECORD TO THE FILE.
     C*
     C                     EXSR OUTKEY
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    FORMAT SR. FORMAT FIELDS FOR OUTPUT.
     C*
     C*  PARAMETERS IN;
     C*              ZNUMIN : ALPHA FIELD CONTAINING THE NUMBER TO BE
     C*                       CONVERTED. THE NUMBER IS RIGHT JUSTIFIED.
     C*              ZDEC   : NUMBER OF DECIMAL PLACES
     C*              ZSIGNT : THE SIGN REQUIRED
     C*                        (ASSUME SIGN BLANK)
     C*              ZSIGN  : WHETHER A SIGN SHOULD APPEAR
     C*                        (ASSUME SIGN IS NOT REQUIRED)
     C*              ZCOMA  : WHETHER COMMA'S SHOULD APPEAR
     C*                        (ASSUME COMMA'S ARE REQUIRED)
     C*              ZCHRO  : MAXIMUM NUMBER OF OUTPUT CHARACTERS
     C*                        (ASSUME 17 IE. 13 CHARACTERS
     C*                          WITH COMMA'S AND DECIMAL POINT)
     C* * * * * * * * * * *  W A R N I N G  * * * * * * * * * * *
     C*        ZSIGN, ZSIGNT, ZCOMA AND ZCHRO SHOULD BE INILILIZED
     C*        WITH DEFAULT VALUES IN THE FIRST CYCLE SUBROUTINE.
     C*
     C*  PARAMETERS OUT;
     C*              ZNUMOT : ARRAY CONTAINING FORMATTED NUMBER
     C*                        THE NUMBER IS RIGHT JUSTIFIED.
     C*              *IN89  : ERROR INDICATOR.
     C*
     C*  VARIABLES USED;
     C*              U      : WORK.
     C*              V      : USED TO CALCULATE IF A COMMA IS REQUIRED.
     C*              W      : STARTING POSITION OF THE NUMBER IN ZAR1.
     C*              X      : CURRENT ELEMENT IN ZAR1 BEING PROCESSED.
     C*              Y      : NEXT ELEMENT AVAILABLE IN ZAR2.
     C*              ZAR1   : ARRAY CONTAINING THE NUMBER TO BE
     C*                        FORMATTED. RIGHT JUSTIFIED.
     C*              ZAR2   : ARRAY CONTAINING THE FORMATTED NUMBER.
     C*                        RIGHT JUSTIFIED.
     C*
     C*
     C           FORMAT    BEGSR                           *** FORMAT ***
     C*
     C*    MOVE THE NUMBER COMING IN TO ARRAY 1.
     C*
     C                     MOVEA*BLANKS   ZAR1
     C                     MOVEA*BLANKS   ZAR2
     C                     MOVE *BLANKS   ZNUMOT 20
     C                     Z-ADDZDEC      ZDEC    10
     C*
     C*    MOVE THE NUMBER COMING IN TO ARRAY 1.
     C*
     C                     MOVEAZNUMIN    ZAR1
     C*
     C*    FIND FIRST NUMBER IN INTEREST AMOUNT.
     C*
     C                     Z-ADD0         W       20
     C           20        SUB  ZDEC      U       20
     C                     MOVE OFF       *IN50
     C           *IN50     DOUEQON
     C                     ADD  1         W
     C*
     C*        FOUND FIRST NON '0' OR ' ' CHARACTER.
     C*
     C           ZAR1,W    IFNE ' '
     C           ZAR1,W    ANDNE'0'
     C                     MOVE ON        *IN50
     C                     END
     C*
     C*        IF NO CHARACTERS FOUND THEN SET W TO DECIMAL
     C*            PLACES + 1.
     C*
     C           W         IFEQ U
     C                     MOVE ON        *IN50
     C                     END
     C                     END
     C*
     C*    MOVE SIGN INTO OUTPUT FIELD.
     C*
     C                     Z-ADD20        X       20
     C                     Z-ADD20        Y       20
     C           ZSIGN     IFEQ 'Y'
     C                     MOVE ZSIGNT    ZAR2,Y
     C                     SUB  1         Y
     C                     END
     C*
     C*    PROCESS NUMBER.
     C*
     C*    DECIMAL PORTION, (IF REQUIRED).
     C*
     C           ZDEC      IFGT 0
     C                     DO   ZDEC                       LOOP
     C                     MOVE ZAR1,X    ZAR2,Y
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     END
     C                     MOVE '.'       ZAR2,Y
     C                     SUB  1         Y
     C                     Z-ADD0         V
     C                     END
     C*
     C*    PROCESS REST OF NUMBER.
     C*
     C                     MOVE OFF       *IN50
     C           *IN50     DOUEQON                         LOOP
     C*
     C*    COMMA'S.
     C*
     C           Y         IFGT 0
     C           ZCOMA     IFEQ 'Y'
     C           V         ANDGE3
     C                     MOVE ','       ZAR2,Y
     C                     SUB  1         Y
     C                     Z-ADD0         V       20
     C                     END
     C                     END
     C*
     C*    MOVE NUMERICS.
     C*
     C           Y         IFGT 0
     C                     MOVE ZAR1,X    ZAR2,Y
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     ADD  1         V
     C                     END
     C*
     C           X         IFLT W                          PROCESSED
     C                     MOVE ON        *IN50            ALL NUMBERS
     C                     ELSE
     C           Y         IFLE 0                          NUMBER IS
     C                     MOVE ON        *IN50            TO BIG FOR
     C                     MOVE ON        *IN89            OUTPUT
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*    IS OUTPUT VALUE TO LARGE
     C*
     C           21        SUB  Y         U
     C           U         IFGT ZCHRO
     C                     MOVE ON        *IN89
     C                     END
     C*
     C*    MOVE FORMATTED AMOUNT TO OUTPUT FIELD.
     C*
     C                     MOVEAZAR2      ZNUMOT 20
     C*
     C*    INITILIZE INPUT PARAMETERS.
     C*
     C                     Z-ADD17        ZCHRO   20
     C                     MOVE *BLANKS   ZNUMIN 20
     C                     MOVE ' '       ZSIGNT  1
     C                     MOVE 'N'       ZSIGN   1
     C                     MOVE 'Y'       ZCOMA   1
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD.***S01390
     C***********                                                         S01390
     C***********ZSYSTM    BEGSR                           *** ZSYSTM *** S01390
     C***********                                                         S01390
     C*****SET*UP*KEY*FOR*INSTALLATION*CONTROL*RECORD.********************S01390
     C***********          MOVEL'01      'ZTABKY 12                       S01390
     C***********          MOVE '  10'    ZTABKY                          S01390
     C***********                                                         S01390
     C***********ZTABKY    CHAINTABDLEI              99    ON NOT THERE   S01390
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01390
     C***********                                                         S01390
     C*****CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.********************S01390
     C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****GLINTC*SR.*TO*CALCULATE*INTEREST*BETWEEN*ANY*TWO*DAY*NUMBERS.**S01390
     C***********                                                         S01390
     C*****THIS*VERSION*REPLACES*THE*ORIGINAL*GLINTC*SR.*NOW*NAMED********S01390
     C*****GLINTO.********************************************************S01390
     C***********                                                         S01390
     C*****CALCULATION*METHODS*ARE*-**************************************S01390
     C*****1**ACTUAL/365**************************************************S01390
     C*****2**ACTUAL/360**************************************************S01390
     C*****3**360/360*(SOMETIMES*CALLED*30/360)***************************S01390
     C*****4**365/365*(EXCLUDING*29/02)***********************************S01390
     C*****5**365/360*(EXCLUDING*29/02)***********************************S01390
     C*****6**ACTUAL/366**************************************************S01390
     C***********                                                         S01390
     C*****REQUIRES*SUBRS.*-*ZDATE2,*ZSAVE,*&*ZRSTOR.*********************S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C***********GLINTC    BEGSR                           ** GLINTC  **  S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************S01390
     C***********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  S01390
     C***********          Z-ADDZIEND     ZIEND   50       FINISHING DATE S01390
     C***********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    S01390
     C***********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      S01390
     C***********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST S01390
     C***********                                                         S01390
     C****TO*DETERMINE*NUMBER*OF*DAYS*INTEREST*TO*BE*CALCULATED***********S01390
     C***********ZIEND     SUB  ZIBEG     ZDAYN1  50                      S01390
     C***********                                                         S01390
     C****CHECK*FOR*INTEREST*CALCULATION*BASIS****************************S01390
     C*****USE*OF*INDICATRS***********************************************S01390
     C*****1,92**2,90**3,91**4,97**5,96**6,95*****************************S01390
     C***********          SETOF                     959697               S01390
     C***********ZICALC    COMP 2                    919290               S01390
     C**N91******          GOTO ZICAL                                     S01390
     C***********ZICALC    COMP 5                    959796               S01390
     C***97******ZICALC    COMP 3                    97  91               S01390
     C***95******                                                         S01390
     C***OR*96******          SETOF                     91                S01390
     C**N91******          GOTO ZILPCK                                    S01390
     C***********                                                         S01390
     C*****THIS*CODING*WILL*CALCULATE*THE*NUMBER*OF*DAYS*TO*USE*WHEN******S01390
     C*****USING*THE*30/360*BASIS*-*METHOD*3.*****************************S01390
     C***********          EXSR ZSAVE                                     S01390
     C***********          Z-ADDZIBEG     ZDAYNO                          S01390
     C***********          EXSR ZDATE2                                    S01390
     C***********          MOVE ZDAY      ZISD    20                      S01390
     C***********          MOVE ZMTH      ZISM    20                      S01390
     C***********          MOVE ZYEAR     ZISY    20                      S01390
     C***********          Z-ADDZIEND     ZDAYNO                          S01390
     C***********          EXSR ZDATE2                                    S01390
     C***********          MOVE ZDAY      ZIFD    20                      S01390
     C***********          MOVE ZMTH      ZIFM    20                      S01390
     C***********          MOVE ZYEAR     ZIFY    20                      S01390
     C***********          EXSR ZRSTOR                                    S01390
     C***********          SETOF                     93                   S01390
     C****IN*ORDER*FOR*THE*FINISH*YEAR*TO*BE*LESS*THAN*THE*START*YEAR*IF**S01390
     C****ZIEND*IS*GREATER*THAN*ZIBEG,THEN*THE*DATE*ZIEND*MUST*BE*IN*A****S01390
     C****DIFFERENT*CENTURY*TO*ZIBEG.IF*SO*ADD*100*YEARS*TO*IT.***********S01390
     C***********ZIEND     COMP ZIBEG                93                   S01390
     C***93******ZIFY      COMP ZISY                   93                 S01390
     C***********          Z-ADDZISY      ZISY2   30                      S01390
     C**N93******          Z-ADDZIFY      ZIFY2   30                      S01390
     C***93******ZIFY      ADD  100       ZIFY2                           S01390
     C***********                                                         S01390
     C*****DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*******S01390
     C*****MONTH*IS*FEBRUARY.*********************************************S01390
     C***********                                                         S01390
     C**N98******          BITOF'0'       ZGLBIT  1                 E80945S01390
     C***98******          BITON'0'       ZGLBIT                    E80945S01390
     C***********ZISY2     ADD  1900      ZLYCHK  40                      S01390
     C***********ZLYCHK    DIV  4         ZLYCHK                          S01390
     C***********          MVR            ZLYREM  20                      S01390
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     S01390
     C***********ZISM      COMP 2                        99*FEBRUARY      S01390
     C**N99******30        SUB  ZISD      ZID1    50   93                 S01390
     C**N99*93***          Z-ADD0         ZID1                            S01390
     C***99N98***28        SUB  ZISD      ZID1                            S01390
     C***99*98***29        SUB  ZISD      ZID1                            S01390
     C***********ZISM      COMP 12                       93               S01390
     C***93******          Z-ADD0         ZISM                            S01390
     C***93******ZISY      ADD  1         ZISY                            S01390
     C***93******ZISY2     ADD  1         ZISY2                           S01390
     C***********                                                         S01390
     C*****DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTH*****S01390
     C*****IS*FEBRUARY.***************************************************S01390
     C***********                                                         S01390
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      S01390
     C***********ZLYCHK    DIV  4         ZLYCHK                          S01390
     C***********          MVR            ZLYREM  20                      S01390
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     S01390
     C***********ZIFM      COMP 2                        99*FEBRUARY      S01390
     C**N99******ZIFD      COMP 31                       93               S01390
     C***99N98***ZIFD      COMP 28                       93               S01390
     C***99*98***ZIFD      COMP 29                       93               S01390
     C***********          SETOF                     98                   S01390
     C***********          TESTB'0'       ZGLBIT         98               S01390
     C***93******ZID1      ADD  30        ZID1                            S01390
     C**N93******ZID1      ADD  ZIFD      ZID1                            S01390
     C***********ZIFM      SUB  1         ZIFM                            S01390
     C***********ZISY      COMP ZIFY                     93               S01390
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      S01390
     C***93******          GOTO ZIOUT                                     S01390
     C***********12        SUB  ZISM      ZIM1    20                      S01390
     C***********          Z-ADD1         ZISM                            S01390
     C*****USE*ENLARGED*FIELDS*THAT*CAN*HANDLE*1999*ONWARDS***************S01390
     C***********ZISY2     ADD  1         ZISY2                           S01390
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      S01390
     C***********ZIY1      MULT 12        ZIM2    30                      S01390
     C***********ZIM2      ADD  ZIFM      ZIM2                            S01390
     C***********ZIM1      ADD  ZIM2      ZINOM                           S01390
     C***********ZIOUT     TAG                             * ZIOUT TAG *  S01390
     C***********ZINOM     MULT 30        ZID2    50                      S01390
     C***********ZID2      ADD  ZID1      ZDAYN1                          S01390
     C***********          SETOF                     93                   S01390
     C***********ZILPCK    TAG                             * ZILPCK TAG * S01390
     C**N96N97***          GOTO ZICAL                                     S01390
     C*****THE*FOLLOWING*CODING*APPLIES*FOR*METHODS*4*AND*5*ONLY.*********S01390
     C*****1*DAY*IS*SUBTRACTED*FROM*ZDAYN1*FOR*EACH*OCCURANCE*OF*29*FEB***S01390
     C*****IN*THE*INTEREST*CALCULATION*PERIOD*INCLUSIVE*OF*ZIBEG,*&*ZIEND.S01390
     C***********                                                         S01390
     C*****FIND*NO*OF*4*YEAR*PERIODS*BETWEEN*DATES************************S01390
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      S01390
     C***********          MVR            ZIREM   50                      S01390
     C*****FIND*NEXT*29*FEB*DAY*NO.*ON*OR*AFTER*ZIBEG.********************S01390
     C***********ZIBEG     SUB  60        ZIBW1   50                      S01390
     C***********ZIBW1     DIV  1461      ZIDW1   20                      S01390
     C***********          MVR            ZIDREM  50                      S01390
     C***********ZIDREM    COMP 0                        94               S01390
     C***94******          Z-ADDZIBEG     ZIDW2   50                      S01390
     C***94******          GOTO ZILP1                                     S01390
     C*****ROUND*UP*RESULT************************************************S01390
     C***********ZIDW1     ADD  1         ZIDW2                           S01390
     C*****CALCULATE*NEXT*29*FEB.*****************************************S01390
     C***********ZIDW2     MULT 1461      ZIDW2                           S01390
     C***********ZIDW2     ADD  60        ZIDW2                           S01390
     C***********ZILP1     TAG                             * ZILP1 TAG *  S01390
     C*****IF*THIS*NEXT*29*FEB.*DAYNO*-*ZIBEG*IS*GR.*TH.*OR*EQ.*TO********S01390
     C*****ZIREM*THEN*ADD*1*TO*ZIMAN.*************************************S01390
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      S01390
     C***********ZIREM     COMP ZILPCP               94  94               S01390
     C***94******ZIMAN     ADD  1         ZIMAN                           S01390
     C*****SUBTRACT*ZIMAN*FROM*ZDAYN1*TO*GIVE*VALUE*OF*ZDAYN1*************S01390
     C*****REQUIRED*FOR*THIS*INTEREST*CALCULATION.************************S01390
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          S01390
     C***********          SETOF                     94                   S01390
     C***********ZICAL     TAG                             * ZICAL TAG *  S01390
     C***********                                                         S01390
     C****CALCULATE*INTEREST**********************************************S01390
     C***90******                                                         S01390
     C***OR*91******                                                      S01390
     C***OR*96******ZIAMT     DIV  36000     ZIWRK1 155H                  S01390
     C***92******                                                         S01390
     C***OR*97******ZIAMT     DIV  36500     ZIWRK1    H                  S01390
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     S01390
     C***********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     S01390
     C***********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST S01390
     C***********                                                         S01390
     C***********          SETOF                     909192               S01390
     C***********          SETOF                     959697               S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C*****AMENDMENT*FOR*THIS*PROGRAM*ONLY********************************S01390
     C*****ROUND*INTEREST*AMOUNT*TO*ZERO*DEC*PL***************************S01390
     C***********                                                         S01390
     C***********          Z-ADDZINTR     WKINT  130H                     S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZSAVE*SR.*TO*MEMORISE*THE*SETTINGS*AND*TO*SET*OFF*INDICATORS***S01390
     C****************90*-*97*BEFORE*EXECUTION*OF*A*Z-SUBROUTINE.*********S01390
     C***********                                                         S01390
     C*****THIS*SR.*IS*REQUIRED*ONLY*IF*INDICATORS************************S01390
     C*****90*-*97*ARE*USED*ELSEWHERE*IN*A*PROGRAM.***********************S01390
     C***********                                                         S01390
     C***********ZSAVE     BEGSR                           *** ZSAVE ***  S01390
     C***********                                                         S01390
     C***********          BITOF'01234567'ZBITS   1                       S01390
     C***90******          BITON'0'       ZBITS                           S01390
     C***91******          BITON'1'       ZBITS                           S01390
     C***92******          BITON'2'       ZBITS                           S01390
     C***93******          BITON'3'       ZBITS                           S01390
     C***94******          BITON'4'       ZBITS                           S01390
     C***95******          BITON'5'       ZBITS                           S01390
     C***96******          BITON'6'       ZBITS                           S01390
     C***97******          BITON'7'       ZBITS                           S01390
     C***********                                                         S01390
     C***********          SETOF                     909192               S01390
     C***********          SETOF                     939495               S01390
     C***********          SETOF                     9697                 S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZRSTOR*SR.*TO*RESTORE*INDICATORS*90*-*97*TO*THE*SETTINGS*******S01390
     C****************THEY*HAD*BEFORE*THE*EXECUTION*OF*SR.*ZSAVE.*********S01390
     C***********                                                         S01390
     C***********ZRSTOR    BEGSR                           *** ZRSTOR *** S01390
     C***********                                                         S01390
     C***********          TESTB'0'       ZBITS          90               S01390
     C***********          TESTB'1'       ZBITS          91               S01390
     C***********          TESTB'2'       ZBITS          92               S01390
     C***********          TESTB'3'       ZBITS          93               S01390
     C***********          TESTB'4'       ZBITS          94               S01390
     C***********          TESTB'5'       ZBITS          95               S01390
     C***********          TESTB'6'       ZBITS          96               S01390
     C***********          TESTB'7'       ZBITS          97               S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C*
     C*    RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C*
     C*    IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C********************************************************************
     C***********                                                         S01390
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************S01390
     C***********                                                         S01390
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01390
     C***********                                                         S01390
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01390
     C***********                                                         S01390
     C*****CLEAR*DATE*FIELDS.*********************************************S01390
     C***********          Z-ADD0         ZDATE   60                      S01390
     C***********          MOVEL'       ' ZADATE  7                       S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************S01390
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01390
     C***********                                                         S01390
     C*****DETERMINE*YEAR*NUMBER.*****************************************S01390
     C***********                                                         S01390
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************S01390
     C***********ZDAYNO    SUB  1         ZDAYN1  50   99                 S01390
     C***99******          GOTO ZDEND2                                    S01390
     C***********                                                         S01390
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************S01390
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01390
     C***********          MVR            ZDAYN1           SAVE REMAINING S01390
     C***********                                          DAYS           S01390
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************S01390
     C***********          Z-ADD1         ZWRK2   20                      S01390
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01390
     C***********ZDAYN1    COMP ZYDY,ZWRK2             90                 S01390
     C**N90******ZWRK2     ADD  1         ZWRK2                           S01390
     C**N90******          GOTO ZDTAG1                                    S01390
     C***********ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON S01390
     C***********                                                         S01390
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************S01390
     C**N91******ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01390
     C***********                                                         S01390
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************S01390
     C***********ZLYR      MULT 4         ZWRK3   30                      S01390
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01390
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01390
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01390
     C***********                                                         S01390
     C*****DETERMINE*MONTH*NUMBER.****************************************S01390
     C***********                                                         S01390
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********S01390
     C***********          SETOF                     9293                 S01390
     C***91******ZDAYN1    COMP 59                     9293               S01390
     C***91N92***ZDAYN1    SUB  1         ZDAYN1                          S01390
     C***********                                                         S01390
     C*****CALCULATE*MONTH*NUMBER.****************************************S01390
     C***********          Z-ADD2         ZWRK2                           S01390
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01390
     C***********ZDAYN1    COMP ZMDY,ZWRK2             94                 S01390
     C**N94******ZWRK2     ADD  1         ZWRK2                           S01390
     C**N94******          GOTO ZDTAG2                                    S01390
     C***********ZWRK2     SUB  1         ZWRK2                           S01390
     C***********                                                         S01390
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01390
     C***********                                                         S01390
     C*****DETERMINE*DAY*OF*MONTH.****************************************S01390
     C***********                                                         S01390
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************S01390
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01390
     C***********                                                         S01390
     C*****CALCULATE*DAY*OF*MONTH.****************************************S01390
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01390
     C***********                                                         S01390
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******S01390
     C***93******ZDAY      ADD  1         ZDAY                            S01390
     C***********                                                         S01390
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************S01390
     C**N98******          MOVELZDAY      ZWRK4   40                      S01390
     C***98******          MOVE ZDAY      ZWRK4                           S01390
     C**N98******          MOVE ZMTH      ZWRK4                           S01390
     C***98******          MOVELZMTH      ZWRK4                           S01390
     C***********          MOVELZWRK4     ZDATE                           S01390
     C***********          MOVE ZYEAR     ZDATE                           S01390
     C***********                                                         S01390
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************S01390
     C***********ZDAY      COMP 10                     95                 S01390
     C***********          MOVELZDAY      ZWRK5   5                       S01390
     C***95******          MOVEL' '       ZWRK5                           S01390
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01390
     C***********          MOVELZWRK5     ZADATE                          S01390
     C***********          MOVE ZYEAR     ZADATE                          S01390
     C***********                                                         S01390
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZDATE3*SR*MODIFIED*&*RENAMED*TO*FDATE*TO*CALC*FED*FUND*VAL.DATES01390
     C***********                                                         S01390
     C*****ZDATE3*SR.*TO*CALCULATE*ANY*NUMBER*OF*WORKING******************S01390
     C****************DAYS*FORWARD*IN*ANY*CURRENCY.***********************S01390
     C***********                                                         S01390
     C*********THIS*SR.*CAN*BE*USED*WHEN*THE*INPUT*CYCLE*IS*RUNNING*AS****S01390
     C*********HOLIDAY*RECORDS*ARE*ACCESSED*BY*CHAIN.*THEREFORE*NEWLY*****S01390
     C*********ADDED*RECORDS*IN*THE*OVERFLOW*AREA*CAN*ALSO*BE*ACCESSED.***S01390
     C***********                                                         S01390
     C***********FDATE     BEGSR                           *** FDATE ***  S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************S01390
     C***********          Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  S01390
     C***********          MOVE ZCCY      ZCCY    3        DATE CURRENCY  S01390
     C***********          Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING S01390
     C***********                                          DAYS FORWARD   S01390
     C*****CLEAR*COUNT*OF*NBR*OF*DAYS*ADDED,*&*DEFINE*ZDYNBR.*************S01390
     C***********          Z-ADD0         ZDCNT   20                      S01390
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01390
     C***********                                                         S01390
     C*****LOOP*TO*INCREMENT*DAY*NUMBER*AND*CHECK*FOR*HOLIDAY.************S01390
     C***********ZDLOP1    TAG                             ** ZDLOP1 TAG *S01390
     C***********                                                         S01390
     C***********          SETOF                     9596                 S01390
     C***********ZDYNBR    ADD  1         ZDYNBR                          S01390
     C**N63******ZDYNBR    ADD  1         ZDYNBR                          S01390
     C***63******ZDYNBR    SUB  1         ZDYNBR                          S01390
     C***********                                                         S01390
     C*****SET*KEY*FOR*FIRST*HOLIDAY*RECORD.******************************S01390
     C***********          MOVEL'22    '  ZDHKEY 12                       S01390
     C***********          MOVELZDYNBR    ZWRK6   6                       S01390
     C***********          MOVE '1'       ZWRK6                           S01390
     C***********          MOVE ZWRK6     ZDHKEY                          S01390
     C***********                                                         S01390
     C*****CHAIN*FOR*HOLIDAY*RECORD,*RECORD*1*OR*2************************S01390
     C***********ZDHCHN    TAG                             ** ZDHCHN TAG *S01390
     C***********                                                         S01390
     C***********ZDHKEY    CHAINTABDLEI              90    ON NOT THERE   S01390
     C**N90******RECI      COMP 'D'                  9090  DELETED        S01390
     C***********                                                         S01390
     C*****NO*RECORD*1*FOUND,*IS*NOT*A*HOLIDAY****************************S01390
     C***90N95***          GOTO ZDOAGN                                    S01390
     C***********                                                         S01390
     C*****NO*RECORD*2*FOUND**********************************************S01390
     C***90*95*96          GOTO ZDLOP1                     EXC. NOT FOUND S01390
     C***90*95N96          GOTO ZDOAGN                     INC. NOT FOUND S01390
     C***********                                                         S01390
     C*****DETERMINE*TYPE*FOUND,*INCLUDE*OR*EXCLUDE***********************S01390
     C***********INEX      COMP 'E'                  92  91               S01390
     C***********                                                         S01390
     C*****CHECK*IF*DAY*IS*HOLIDAY*FOR*CURRENCY.**************************S01390
     C***********ZCCY      LOKUPHCY                      93               S01390
     C***91*93***          GOTO ZDOAGN                     EXCLUDE FOUND  S01390
     C***92*93***          GOTO ZDLOP1                     INCLUDE FOUND  S01390
     C***********                                                         S01390
     C*****IF*EXCLUDE*OR*INCLUDE*NOT*FOUND*CHECK**************************S01390
     C*****FOR*SECOND*HOLIDAY*RECORD,*IF*REQUIRED.************************S01390
     C***********'   '     LOKUPHCY                      94ON IF NO RCD.2 S01390
     C***********          MOVE ZDHKEY    ZWRK1H  1                       S01390
     C***********ZWRK1H    COMP '1'                      95               S01390
     C***91*95***          SETON                     96                   S01390
     C***95N94***          MOVE '2'       ZDHKEY                          S01390
     C***95N94***          GOTO ZDHCHN                     GET SECOND REC S01390
     C***********                                                         S01390
     C***91******          GOTO ZDLOP1                     EXC. NOT FOUND S01390
     C***92******          GOTO ZDOAGN                     INC. NOT FOUND S01390
     C***********                                                         S01390
     C*****INCREMENT*COUNT*AND*CHECK*IF*REQUIRED*NUMBER*OF*DAYS***********S01390
     C*****HAVE*BEEN*ADDED.*IF*NOT,*GO*THROUGH*LOOP1*AGAIN.***************S01390
     C***********ZDOAGN    TAG                             ** ZDOAGN TAG *S01390
     C***********                                                         S01390
     C***********ZDCNT     ADD  1         ZDCNT                           S01390
     C***********ZDCNT     COMP ZNRDYS                 97                 S01390
     C***97******          GOTO ZDLOP1                                    S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZDATE1*SR.*TO*VALIDATE*DATES*SUBMITTED*AND*********************S01390
     C****************CONVERT*TO*A*NUMBER*OF*DAYS.************************S01390
     C***********                                                         S01390
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01390
     C***********                                                         S01390
     C***********ZDATE1    BEGSR                           *** ZDATE1 *** S01390
     C***********                                                         S01390
     C*****CLEAR*DAY*NUMBER.**********************************************S01390
     C***********          Z-ADD0         ZDAYNO  50                      S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE*INPUT*DATE*FIELD.************************S01390
     C***********          Z-ADDZDATE     ZDATE   60                      S01390
     C***********                                                         S01390
     C*****GET*INDIVIDUAL*DAY,*MONTH*AND*YEAR*FIELDS.*********************S01390
     C***********          MOVE ZDATE     ZYEAR   20                      S01390
     C**N98******          MOVELZDATE     ZDAY    20                      S01390
     C***98******          MOVELZDATE     ZMTH    20                      S01390
     C***********          MOVE ZDATE     ZWRK4   40                      S01390
     C**N98******          MOVELZWRK4     ZMTH                            S01390
     C***98******          MOVELZWRK4     ZDAY                            S01390
     C***********                                                         S01390
     C*****ENSURE*MONTH*IS*VALID.*****************************************S01390
     C***********ZMTH      COMP 0                      9999               S01390
     C**N99******ZMTH      COMP 12                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****CHECK*FOR*30*DAY*MONTHS.***************************************S01390
     C***********ZMTH      COMP 4                        90IF 90 ON, 30   S01390
     C**N90******ZMTH      COMP 6                        90DAY MONTH.     S01390
     C**N90******ZMTH      COMP 9                        90               S01390
     C**N90******ZMTH      COMP 11                       90               S01390
     C***********                                                         S01390
     C*****ENSURE*DAY*IS*VALID.*******************************************S01390
     C***********ZDAY      COMP 0                      9999               S01390
     C***90N99***ZDAY      COMP 30                   99                   S01390
     C**N90N99***ZDAY      COMP 31                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****CHECK*FOR*LEAP*YEAR*AND*FEBRUARY.******************************S01390
     C***********ZYEAR     ADD  28        ZYEAR                           S01390
     C***********ZYEAR     DIV  4         ZLYR    20                      S01390
     C***********          MVR            ZLY     10     91LEAP YR, 91 ON S01390
     C***********ZMTH      COMP 2                    93  92FEB., 92 ON    S01390
     C***********                                          PAST FEB, 93 ONS01390
     C*****IF*FEBUARY*FURTHER*VALIDATE*DAY.*******************************S01390
     C**N91*92***ZDAY      COMP 28                   99                   S01390
     C***91*92***ZDAY      COMP 29                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****DETERMINE*NUMBER*OF*DAYS*FROM*31/12/1971.**** NO.OF*4*YR.*SPANSS01390
     C***********ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.S01390
     C**N91******ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRS01390
     C***91*93***ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.S01390
     C***********ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR S01390
     C***********ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHS01390
     C***********                                                         S01390
     C***********ZDEND1    ENDSR                           * ZDEND1 ENDSR*S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZDATE5*SR.*TO*DETERMINE*IF*A*DAY*NUMBER*DATE*IS*A*HOLIDAY******S01390
     C****************IN*GIVEN*CURRENCY,*AND,*IF*DAY*IS*A*HOLIDAY*********S01390
     C****************AND*IF*REQUIRED,*DETERMINE*NEXT*WORKING*DAY.********S01390
     C***********                                                         S01390
     C***********ZDATE5    BEGSR                           *** ZDATE5 *** S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************S01390
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01390
     C***********          MOVE ZCCY      ZCCY    3                       S01390
     C***********          MOVE ZOPT      ZOPT    1                       S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE/CLEAR*WORKFIELDS.***********************S01390
     C***********          MOVE '   '     ZHC                             S01390
     C***********                                                         S01390
     C*****RESET*INDICATOR.***********************************************S01390
     C***********          SETOF                     99                   S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE/SET*OUTPUT*FIELD.************************S01390
     C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01390
     C***********                                                         S01390
     C*****DETERMINE*IF*HOLIDAY*******************************************S01390
     C***********ZDHOL     TAG                             ** ZDHOL TAG **S01390
     C***********          SETOF                     91                   S01390
     C***********                                                         S01390
     C*****SET*KEY*FOR*FIRST*HOLIDAY*RECORD.******************************S01390
     C***********          MOVEL'22      'ZTABKY 12                       S01390
     C***********          MOVELZDYNBR    ZWRK6   6                       S01390
     C***********          MOVE '1'       ZWRK6                           S01390
     C***********          MOVE ZWRK6     ZTABKY                          S01390
     C***********                                                         S01390
     C*****CHAIN*FOR*HOLIDAY*RECORD,*RECORD*1*OR*2.***********************S01390
     C***********ZDHCH5    TAG                             ** ZDHCH5 TAG *S01390
     C***********ZTABKY    CHAINTABDLEI              90    ON NOT THERE   S01390
     C**N90******RECI      COMP 'D'                  9090  DELETED        S01390
     C***********                                                         S01390
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************S01390
     C**N90N91***          MOVEAHCY       ZHC,1                           S01390
     C***91N90***          MOVEAHCY       ZHC,26                          S01390
     C***********                                                         S01390
     C*****GET*SECOND*RECORD,*IF*NOT*ALREADY*DONE.************************S01390
     C***********          MOVE ZTABKY    ZWRK1   10                      S01390
     C***********ZWRK1     COMP 1                        91               S01390
     C***********          MOVE '2'       ZTABKY                          S01390
     C***91N90***          GOTO ZDHCH5                                    S01390
     C***********                                                         S01390
     C*****BYPASS*TO*END*IF*NO*FIRST*RECORD*FOUND.************************S01390
     C***90*91***          GOTO ZDEND5                                    S01390
     C***********                                                         S01390
     C*****DETERMINE*HOLIDAY*RECORD*TYPE.*********************************S01390
     C***********INEX      COMP 'E'                      92               S01390
     C***********INEX      COMP 'I'                      93               S01390
     C***********                                                         S01390
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************S01390
     C***********ZCCY      LOKUPZHC                      94               S01390
     C***********                                                         S01390
     C*****BYPASS*TO*END*IF*NOT*HOLIDAY*FOR*CURRENCY.*********************S01390
     C***92*94***                                                         S01390
     C***OR*93N94***          GOTO ZDEND5                                 S01390
     C***********                                                         S01390
     C*****SET*INDICATOR*FOR*HOLIDAY*FOR*DAY*NUMBER.**********************S01390
     C***********          SETON                     99                   S01390
     C***********                                                         S01390
     C*****CHECK*IF*NEXT*WORKING*DAY*REQUIRED.****************************S01390
     C***********ZOPT      COMP 'Y'                      95               S01390
     C***95******ZDYNBR    ADD  1         ZDYNBR                          S01390
     C***95******          GOTO ZDHOL                                     S01390
     C***********                                                         S01390
     C***********ZDEND5    ENDSR                           * ZDEND5 ENDSR*S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZFREQB-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A*****************S01390
     C***************PERIOD*VALUE*DETERMINED*BY*A*CODE.*******************S01390
     C***********                                                         S01390
     C***********ZFREQB    BEGSR                           *** ZFREQB *** S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE/CLEAR*FIELDS.***************************S01390
     C***********          MOVE ZFREQ     ZFREQ   1                       S01390
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01390
     C***********          Z-ADDZMDAY     ZMDAY   20                      S01390
     C***********          MOVE ZCCY      ZCCY    3                       S01390
     C***********                                                         S01390
     C***********          MOVE '   '     ZHC                             S01390
     C***********          MOVE ' '       ZTABKY 12                       S01390
     C***********                                                         S01390
     C*************FIELDS*USED*FOR*PERIOD*CODES*M,T,Q,X,Y*****************S01390
     C***********                                                         S01390
     C***********          MOVE '  '      ZINDE   2                       S01390
     C***********          Z-ADD0         ZINTO   20                      S01390
     C***********                                                         S01390
     C*****CONVERT*DAY*NUMBER*TO*DATE.************************************S01390
     C***********          EXSR ZDATE2                                    S01390
     C***********          SETOF                     90                   S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*D-DAILY-WORKING*DAY.**********S01390
     C***********ZFREQ     COMP 'D'                      91               S01390
     C***91******ZDAYNO    ADD  1         ZDAYNO                          S01390
     C***91******          GOTO ZFHCHK                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*W-WEEKLY.*********************S01390
     C***********ZFREQ     COMP 'W'                      91               S01390
     C***91******ZDAYNO    ADD  7         ZDAYNO                          S01390
     C***91******          GOTO ZFEND                                     S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*F-FORTNIGHTLY.****************S01390
     C***********ZFREQ     COMP 'F'                      91               S01390
     C***91******ZDAYNO    ADD  14        ZDAYNO                          S01390
     C***91******          GOTO ZFEND                                     S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*S-SEMI-MONTHLY.***************S01390
     C***********ZFREQ     COMP 'S'                      91               S01390
     C***91******ZDAY      COMP 15                   939292               S01390
     C***91*92***          Z-ADD31        ZDAY                            S01390
     C***91*93***          Z-ADD15        ZDAY                            S01390
     C***91*93***ZMTH      ADD  1         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*M-MONTHLY.********************S01390
     C***********ZFREQ     COMP 'M'                      91               S01390
     C***91******          MOVE 'IN'      ZINDE                           S01390
     C***91******          Z-ADDZMDAY     ZDAY                            S01390
     C***91******ZMTH      ADD  1         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*R-SIX*DAYS*BEFORE*END*OF*MONTHS01390
     C***********ZFREQ     COMP 'R'                      91               S01390
     C***91******          Z-ADD31        ZDAY                            S01390
     C***91******ZMTH      ADD  1         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*T-BIMONTHLY.******************S01390
     C***********ZFREQ     COMP 'T'                      91               S01390
     C***91******          MOVE 'IN'      ZINDE                           S01390
     C***91******          Z-ADDZMDAY     ZDAY                            S01390
     C***91******ZMTH      ADD  2         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*Q-QUARTERLY.******************S01390
     C***********ZFREQ     COMP 'Q'                      91               S01390
     C***91******          MOVE 'IN'      ZINDE                           S01390
     C***91******          Z-ADDZMDAY     ZDAY                            S01390
     C***91******ZMTH      ADD  3         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*X-SIX*MONTHLY.****************S01390
     C***********ZFREQ     COMP 'X'                      91               S01390
     C***91******          MOVE 'IN'      ZINDE                           S01390
     C***91******          Z-ADDZMDAY     ZDAY                            S01390
     C***91******ZMTH      ADD  6         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*Y-YEARLY.*********************S01390
     C***********ZFREQ     COMP 'Y'                      91               S01390
     C***91******          MOVE 'IN'      ZINDE                           S01390
     C***91******          Z-ADDZMDAY     ZDAY                            S01390
     C***91******ZYEAR     ADD  1         ZYEAR                           S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*L-LAST*CALENDAR*DAY*OF*MONTH.*S01390
     C***********ZFREQ     COMP 'L'                      91               S01390
     C***91******          Z-ADD31        ZDAY                            S01390
     C***91******ZMTH      ADD  1         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*B-LAST*WORKING*DAY*OF*MONTH.**S01390
     C***********ZFREQ     COMP 'B'                      91               S01390
     C***91******          Z-ADD31        ZDAY                            S01390
     C***91******ZMTH      ADD  1         ZMTH                            S01390
     C***91******          GOTO ZFDATE                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*AND*INCREMENT*FOR*CODE*A-MONTHLY*ACCRUAL/PROFIT*DATE.S01390
     C***********ZFREQ     COMP 'A'                      91               S01390
     C***********          MOVEL'01    '  ZTABKY                          S01390
     C***91******          MOVEL'01    '  ZTABKY                          S01390
     C***91******          MOVE '    11'  ZTABKY                          S01390
     C***91******ZTABKY    CHAINTABDLEI              99    ON NOT THERE   S01390
     C**N99******RECI      COMP '*'                      99               S01390
     C***91N99***          Z-ADDAPDA      ZDAYNO                          S01390
     C***********                                                         S01390
     C*****BYPASS*IF*ZFREQ*IS*'A'*OR*ANY*OTHER*VALUE**********************S01390
     C***********          GOTO ZFEND                                     S01390
     C***********                                                         S01390
     C*****REFORMAT*DATE*AND*ENSURE*VALID.********************************S01390
     C***********ZFDATE    TAG                             ** ZFDATE TAG* S01390
     C***********                                                         S01390
     C*****VALIDATE*MONTH.************************************************S01390
     C***********ZMTH      COMP 12                   91                   S01390
     C***91******ZMTH      SUB  12        ZMTH                            S01390
     C***91******ZYEAR     ADD  1         ZYEAR                           S01390
     C***********                                                         S01390
     C*****CHECK*FOR*LEAP*YEAR.*******************************************S01390
     C***********ZYEAR     DIV  4         ZLYR    20                      S01390
     C***********          MVR            ZLY     10     92LEAP YEAR-92 ONS01390
     C***********                                                         S01390
     C*****VALIDATE*DAY*NUMBER.*******************************************S01390
     C***********          MOVE ZFMD,ZMTH ZWRK2   20                      S01390
     C***********ZMTH      COMP 2                        93               S01390
     C***92*93***          Z-ADD29        ZWRK2                           S01390
     C***********                                                         S01390
     C***********ZDAY      COMP ZWRK2                94                   S01390
     C***94******          Z-ADDZWRK2     ZDAY                            S01390
     C***********                                                         S01390
     C*****CHECK*IF*CODE*R,*TO*SUBTRACT*6*DAYS.***************************S01390
     C***********ZFREQ     COMP 'R'                      91               S01390
     C***91******ZDAY      SUB  6         ZDAY                            S01390
     C***********                                                         S01390
     C*****REFORMAT*DATE,*DDMMYY*OR*MMDDYY,*AND*CONVERT*TO*DAY*NUMBER.****S01390
     C***********          MOVELZDAY      ZWRK4   40                      S01390
     C***********          MOVE ZMTH      ZWRK4                           S01390
     C***98******          MOVELZMTH      ZWRK4                           S01390
     C***98******          MOVE ZDAY      ZWRK4                           S01390
     C***********          MOVELZWRK4     ZDATE                           S01390
     C***********          MOVE ZYEAR     ZDATE                           S01390
     C***********          EXSR ZDATE1                                    S01390
     C***********                                                         S01390
     C**NO*HOLIDAY*CHECK*FOR*FREQ.*'N'*(THIS*LINE*APPLY*ONLY*TO*DL0280)***S01390
     C***********IPFR      CABEQ'N'       ZFEND                           S01390
     C***********                                                         S01390
     C*****CHECK*IF*CODE*B,*OR*M,T,Q,X,Y*TO*BE*CHECKED*FOR*HOLIDAY.*******S01390
     C***********ZFREQ     COMP 'B'                      91               S01390
     C***********ZINDE     COMP 'IN'                     92               S01390
     C***92N99***                                                         S01390
     C***OR*91N99***          GOTO ZFHCHK                                 S01390
     C***********                                                         S01390
     C***********          GOTO ZFEND                                     S01390
     C***********                                                         S01390
     C*****CHECK*IF*DAY*NUMBER*IS*A*HOLIDAY.******************************S01390
     C***********                                                         S01390
     C***********ZFHCHK    TAG                             ** ZFHCHK TAG *S01390
     C***********          SETOF                     94                   S01390
     C***********ZFREQ     COMP 'D'                      91               S01390
     C***********ZFREQ     COMP 'B'                      92               S01390
     C***91******                                                         S01390
     C***OR*92******          GOTO ZSETK                                  S01390
     C***********                                                         S01390
     C****FOR*CODES*M,T,Q,X,Y,*CHECK*ZINDE*-*'IN'*TO*INCREMENT,***********S01390
     C*************************************-*'DE'*TO*DECREMENT************S01390
     C***********                                                         S01390
     C***********ZINDE     COMP 'IN'                     90               S01390
     C***********ZINDE     COMP 'IN'                     91               S01390
     C***********ZINDE     COMP 'DE'                     92               S01390
     C***********                                                         S01390
     C*****SET*KEY*FOR*FIRST*HOLIDAY*RECORD.******************************S01390
     C***********ZSETK     TAG                             ** ZSETK TAG **S01390
     C***********          MOVEL'22    '  ZTABKY                          S01390
     C***********          MOVELZDAYNO    ZWRK6   6                       S01390
     C***********          MOVE 1         ZWRK6                           S01390
     C***********          MOVE ZWRK6     ZTABKY                          S01390
     C***********                                                         S01390
     C*****GET*HOLIDAY*RECORD.********************************************S01390
     C***********ZFHCHN    TAG                             ** ZFHCHN TAG* S01390
     C***********ZTABKY    CHAINTABDLEI              93    ON NOT THERE   S01390
     C**N93******RECI      COMP '*'                      93               S01390
     C**N94******          MOVE '   '     ZHC                             S01390
     C***********                                                         S01390
     C*****STORE*CURRENCIES*IF*RECORD*FOUND.******************************S01390
     C**N94N93***          MOVEAHCY       ZHC,1                           S01390
     C***94N93***          MOVEAHCY       ZHC,26                          S01390
     C***********                                                         S01390
     C*****GET*SECOND*RECORD,*IF*NOT*ALREADY*DONE.************************S01390
     C***********          MOVE ZTABKY    ZWRK1N  10                      S01390
     C***********ZWRK1N    COMP 1                        94               S01390
     C***********          MOVE '2'       ZTABKY                          S01390
     C***94N93***          GOTO ZFHCHN                                    S01390
     C***********                                                         S01390
     C*****BYPASS*TO*END*IF*NO*FIRST*RECORD*FOUND.************************S01390
     C***93*94***          GOTO ZFEND                                     S01390
     C***********                                                         S01390
     C*****DETERMINE*HOLIDAY*RECORD*TYPE.*********************************S01390
     C***********INEX      COMP 'E'                      95               S01390
     C***********INEX      COMP 'I'                      96               S01390
     C***********                                                         S01390
     C*****CHECK*IF*CURRENCY*ON*HOLIDAY.**********************************S01390
     C***********ZCCY      LOKUPZHC                      97               S01390
     C***********                                                         S01390
     C*****BYPASS*IF*NOT*HOLIDAY*FOR*CURRENCY.****************************S01390
     C***95*97***                                          EXCLUDE FOUND  S01390
     C***OR*96N97***          GOTO ZFEND                   INCL. NOT FOUNDS01390
     C***********                                                         S01390
     C***********                                                         S01390
     C***92******          GOTO ZDECR                                     S01390
     C***********                                                         S01390
     C*****INCREMENT*OR*DECREMENT*DAY*NUMBER*AS*REQUIRED.*****************S01390
     C***91******ZDAYNO    ADD  1         ZDAYNO                          S01390
     C***********                                                         S01390
     C*****ONLY*FOR*PERIOD*CODE*=*M,T,Q,X*OR*Y,*IF*INCREMENTATION*********S01390
     C*****TAKES*THE*OUTPUT*DATE*INTO*THE*FOLLOWING*MONTH,*RETURN*TO******S01390
     C*****THE*INPUT*DATE*AND*DECREMENT*-*92*ON.**************************S01390
     C***********                                                         S01390
     C***90*91***ZINTO     ADD  1         ZINTO                           S01390
     C***90*91***ZINTO     ADD  ZDAY      ZINTOT  20                      S01390
     C***90*91***          MOVE ZINTOT    ZINTOA  2                       S01390
     C**TO*ALLOW*29*FEB*ON*LEAP*YEARS*TO*PASS*****************************S01390
     C***********          SETOF                     93                   S01390
     C***90*91***ZYEAR     DIV  4         ZLYR                            S01390
     C***90*91***          MVR            ZLY            92               S01390
     C***90*91*92ZMTH      COMP 2                        93               S01390
     C***93******ZINTOA    COMP '29'                 92                   S01390
     C***90*91N93ZINTOA    COMP ZFMD,ZMTH            92                   S01390
     C***90*91*92ZDAYNO    SUB  ZINTO     ZDAYNO                          S01390
     C***90*91*92          MOVE 'DE'      ZINDE                           S01390
     C***********                                                         S01390
     C***********ZDECR     TAG                             ** ZDECR TAG **S01390
     C***92*95N97                                          EXCL. NOT FOUNDS01390
     C***OR*92*96*97ZDAYNO    SUB  1         ZDAYNO        INCLUDE FOUND  S01390
     C***********          GOTO ZFHCHK                                    S01390
     C***********                                                         S01390
     C***********ZFEND     ENDSR                           * ZFEND ENDSR *S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C*                                                                   S01390
     C*  ERROR DUMP SUB-ROUTINE                                           S01390
     C           *PSSR     BEGSR                           *** *PSSR  *** S01390
     C*                                                                   S01390
     C           @RUN      IFEQ *BLANK                                    S01390
     C                     MOVE 'Y'       @RUN    1                       S01390
     C                     DUMP                                           S01390
     C                     OUT  LDA                                       S01390
     C                     END                                            S01390
     C                     ENDSR                           * *PSSR  ENDSR*S01390
     C*                                                                   S01390
     C********************************************************************S01390
     C/EJECT
     C/COPY ZSRSRC,GLINTCZ1                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZACCH                                                  S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZCHKH                                                  S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZDATE1Z2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZDATE2Z2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZFREQBZ2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZFWDT                                                  S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZRSTORZ1                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZSAVEZ1                                                S01390
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/SPACE 3                                                            S01390
     C/COPY WNCPYSRC,DL8100C004
     O*
     OBRKEYHH EADD             BRKEYH
     O                                    1 'H'
     O*
     OBRKEYDP EADD             BRKEYD
     O                                    1 'D'
     O**********               AKEY      11                                                 MD040431
     O                         QQAKEY    11                                                 MD040431
     O**********               DTYP       3                                                 MD040431
     O                         DLNO      17
     O                         CNUM      23
     O***********              BRCD      26                               S01390
     O                         BRCA      26                               S01390
     O                         CDAS      28
     O                         EDAT      31P
     O                         EAMT      38P
     O                         CCY       41
     O                                   43 '00'
     O                         REVI      56
     O                         Z130      63P
     O                         Z138      73P
     O                         VDAT      76P
     O                         SLID      79P
     O                         MDAT      82P
     O                         BRTT      84
     O                         BRTE      90P
     O                         RTSP      96P
     O                         INTR     102P
     O                         EDAT     105P
     O                         Z117     111P
     O                                  129 ' '                                               CGL020
     O                         ZERO13   136P                                                  CGL020
     O                         ZERO5    141                                                   CGL020
     O**********               AKEY     335                                          CDL038 MD040431
     O                         AKEY     339                                                 MD040431
     O*
     OBRKEYZZ EADD             BRKEYT
     O                                    1 'Z'
     O                         DKREC      6
     O                         TOTDKI    14P
     O                         TOTDKD    16P
     O*
     OBKRATAAFE                BKREL#
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Finastra International Limited 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
     X/COPY WNCPYSRC,DL8100X001
