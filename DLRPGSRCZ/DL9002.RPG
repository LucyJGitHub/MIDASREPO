     H        1                                                           S01390
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Purge History File of Reversed Deals')        *
     F********************************************************************
     F*                                                                  *
     F*  Midas - Dealing Module
     F*                                                                  *
     F*     DL9002 - PURGE REVERSED DEALS FROM HISTORY FILE, HIST1       *
     F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                                  *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CER059             Date 19Jul10               *
      *                 CER054             Date 07Apr09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01390             Date 04AUG92               *
     F*                 AUS006 (AUE137)    Date 12JUN91               *
     F*                 S36008                      DATE  01/02/90       *
     F*                 AUS006                      DATE  18DEC90        *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  CER048 - German Features - Taxes (Recompile)                 *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                     *
     F*  S01390 - Release 10 Changes for Australianisation               *
     F*  AUS006 - (AUE137) OUTPUT 0 IF NO DEALS REVERSED                 *
     F*  S36008 - INTEREST HISTORY ENQUIRY AND PURGE                     *
     F*  AUS006 - AUSTRALIAN PRODUCT - INTEREST HISTORY                  *
     F*                                                                  *
     F********************************************************************
      ***/EJECT*****
      ***************FFFFFFFFFFFFFF***************************************S01390
      ***************FFFFFFFFFFFFFF***************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFFFFFFF*********************************************S01390
      ***************FFFFFFFF*********************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
     F*
     F* INPUT FILES
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FDEALSDC IF  E                    DISK
     F***TABTB10*IF**E                    DISK                            S01390
     F*
     F* UPDATE FILES
     FHIST1   UF  E           K        DISK
     FDLRTS   UF  E           K        DISK
     F/COPY WNCPYSRC,DL9002F001
     F*
     F* OUTPUT FILES
     F***DL9002P1O***E                    PRINTER                         S01390
     FDL9002AUO   E                    PRINTER                            S01390
      /EJECT
     E***************EEEEEEEEEEEEEE***************************************S01390
     E***************EEEEEEEEEEEEEE***************************************S01390
     E***************EEE**************************************************S01390
     E***************EEE**************************************************S01390
     E***************EEEEEEEE*********************************************S01390
     E***************EEEEEEEE*********************************************S01390
     E***************EEE**************************************************S01390
     E***************EEE**************************************************S01390
     E***************EEEEEEEEEEEEEE***************************************S01390
     E***************EEEEEEEEEEEEEE***************************************S01390
     E***********                                                         S01390
     E                    CPY@    1   1 80                                S01390
      ***/EJECT******                                                     S01390
     I***************IIIIIIIIIIIIII***************************************S01390
     I***************IIIIIIIIIIIIII***************************************S01390
     I********************III*********************************************S01390
     I********************III*********************************************S01390
     I********************III*********************************************S01390
     I********************III*********************************************S01390
     I********************III*********************************************S01390
     I********************III*********************************************S01390
     I***************IIIIIIIIIIIIII***************************************S01390
     I***************IIIIIIIIIIIIII***************************************S01390
     I***********                                                         S01390
     IHISTSAAF
     I              PCPL                            PCPL1
     I              ICBS                            ICBS1                 S36008
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*                                                                   S01390
      /EJECT
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C*
     C                     EXSR #INIT                      INITIALISATION
     C*
     C           *IN99     DOWEQ#OFF
     C*                                                     READS DEALS
     C                     READ DEALSDC                  99  FILE UNTIL
     C           *IN99     IFEQ #OFF                          END
     C*                                                     KEEP COUNT
     C                     ADD  1         DLCNT              OF REVERSALS
     C                     MOVE #OFF      *IN98
     C*
     C* READ THRU ALL HISTORY RECORDS FOR THIS DEAL AND DELETE ALL
     C* RECORDS FOUND.
     C           DLNO      SETLLHIST1
     C           *IN98     DOWEQ#OFF
     C           DLNO      READEHIST1                    98
     C           *IN98     IFEQ #OFF
     C                     DELETHIST1
     C/COPY WNCPYSRC,DL9002C001
     C                     END
     C                     END
     C*
     C           DLNO      SETLLDLRTS
     C           *IN97     DOWEQ#OFF
     C           DLNO      READEDLRTS                    97
     C           *IN97     IFEQ #OFF
     C                     DELETDLRTSAAF
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C* WRITE AUDIT REPORT.
     C                     WRITEAUDIT
     C*
     C                     MOVE #ON       *INLR
      /TITLE INITIALISACTION ROUTINE
     C           #INIT     BEGSR
      **--------------------------------------------------------#INIT
      **                                                           **
      ** #INIT - INITIALISATION ROUTINE.                           **
      **                                                           **
      **-----------------------------------------------------------**
      *
     C                     MOVE '1'       #ON     1
     C                     MOVE '0'       #OFF    1
     C                     Z-ADD0         DLCNT
     C                     MOVEACPY@      BIS@   80                       S01390
     C*
     C                     TIME           TIME    60
     C*
     C***********          READ TABTB10                  H1               S01390
     C                     CALL 'AOBANKR0'                                S01390
     C                     PARM '*DBERR ' RTCD    7                       S01390
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C/COPY WNCPYSRC,DL9002C002
     C*
     C                     ENDSR
      ***/EJECT*****                                                      S01390
     O***************OOOOOOOOOOOOOO***************************************S01390
     O***************OOOOOOOOOOOOOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOO********OOO***************************************S01390
     O***************OOOOOOOOOOOOOO***************************************S01390
     O***************OOOOOOOOOOOOOO***************************************S01390
     O***********                                                         S01390
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Misys International Banking Systems Ltd. 2001
