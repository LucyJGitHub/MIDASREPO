     H        1                                                           S01390
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Adjustment Processing - Service Fee')         *
      ***************************************************************
      **                                                           **
      *  Midas - Dealing Module                                       *
      **                                                           **
      ** DL9003 - ADJUSTMENTS PROCESSING FOR HISTORY               **
      **          UPDATE FOR SERVICE FEE.                          **
      **                                                           **
      *  (c) Finastra International Limited 2001                      *
      **                                                           **
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CDL099             Date 06Oct17               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 05Jul06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CDL028             Date 07Feb05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01408             Date 27Aug96               *
      *                 S01390             Date 04Aug92               *
      *                   S36008      DATE 01/02/90                 *
      *                   AUS006      DATE 18DEC90                  *     AUS006
      *                   AUS005      DATE 18DEC90                  *     AUS005
      *                   EA001       DATE 01/07/88                 *
      *                                                             *
      *-------------------------------------------------------------*
      *                                                             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *    S01408 - Add hook  DL9003FFP1 to core                    *
      *           - Add hook  DL9003CCP1 to core                    *
      *           - Add hook  DL9003CCP2 to core                    *
      *           - Add hook  DL9003CCP3 to core                    *
      *           - Add hook  DL9003CCP4 to core                    *
      *           - Add hook  DL9003CCP5 to core                    *
      *           - Add hook  DL9003CCP6 to core                    *
      *           - Add hook  DL9003CCP7 to core                    *
      *    S01390 - Release 10 Changes for Australianisation        *
      *    S36008 - INTEREST HISTORY ENQUIRY AND PURGE              *
      *    AUS006 - AUSTRALIAN PRODUCT - INTEREST HISTORY           *     AUS006
      *    AUS005 - AUSTRALIAN PRODUCT - FID PROCESSING             *     AUS005
      *             PRIOR TO R22 ALL FID FIELDS WERE DEFINED WITH   *
      *             DECIMAL POINT ON FILE. FROM R22 THESE FIELDS    *
      *             WILL BE REDEFINED WITH ZERO DECIMAL POINT (NOT  *
      *             RATE FIELDS) TO CONFORM WITH MIDAS STANDTARD.   *
      *    EA001  - AUSTRALIAN RELEASE ERROR FIX                    *
      *             IGNORE FRA/IRS DEALS FILE                       *
      *                                                             *
      ***************************************************************
      ***/EJECT*****                                                      S01390
      ***************FFFFFFFFFFFFFF***************************************S01390
      ***************FFFFFFFFFFFFFF***************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFFFFFFF*********************************************S01390
      ***************FFFFFFFF*********************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
      ***************FFF**************************************************S01390
     F*
     F* INPUT FILES
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FFTRANAA IF  E                    DISK
     F/COPY WNCPYSRC,DL9003FFP1                                           S01408
     F***TABTB10*IF**E                    DISK                            S01390
     FDEALS   IF  E           K        DISK
     F            DEALSDAF                          KIGNORE
     F            DEALSDBF                          KIGNORE
     F            DEALSDDF                          KIGNORE
     F            DEALSDEF                          KIGNORE
EA001F            DEALSDGF                          KIGNORE
     F            DEALSDFF                          KIGNORE
     F*
     F* OUTPUT FILES
     FHISTSAA O   E                    DISK
     F***DL9003P1O***E                    PRINTER                         S01390
     FDL9003AUO   E                    PRINTER                            S01390
      /SPACE 3                                                            S01390
     E                    CPY@    1   1 80                                S01390
      ***/EJECT*****                                                      S01390
     I***********    IIIIIIIIIIIIII                                       S01390
     I***********    IIIIIIIIIIIIII                                       S01390
     I***********         III                                             S01390
     I***********         III                                             S01390
     I***********         III                                             S01390
     I***********         III                                             S01390
     I***********         III                                             S01390
     I***********         III                                             S01390
     I***********    IIIIIIIIIIIIII                                       S01390
     I***********    IIIIIIIIIIIIII                                       S01390
     I***********                                                         S01390
     I*                                                                   PS0040
     IDEALSDCF
     I              PCPL                            PCPL1
     I              ICBS                            ICBS1                 S36008
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*                                                                   S01390
      /EJECT
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCC**************************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C***************CCCCCCCCCCCCCC***************************************S01390
     C*
     C                     EXSR #INIT                      INITIALISATION
     C*
     C           *IN20     IFEQ #OFF
     C*
     C           *IN20     DOWEQ#OFF
     C*
     C/COPY WNCPYSRC,DL9003CCP2                                           S01408
     C                     READ FTRANAA                  20
     C/COPY WNCPYSRC,DL9003CCP3                                           S01408
     C*
     C           *IN20     IFEQ #OFF
     C*
     C                     ADD  1         RECRED
     C*
     C/COPY WNCPYSRC,DL9003CCP4                                           S01408
     C           DLNO      CHAINDEALS                77
     C/COPY WNCPYSRC,DL9003CCP5                                           S01408
     C                     CAS            HISTA
     C                     END
     C*
     C                     ADD  1         RECOUT
     C*
     C                     WRITEHISTSAAF
     C*
     C                     CAS            HISTB
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C* WRITE AUDIT REPORT.
     C           RECRED    COMP 0                        50
     C                     WRITEAUDIT
     C*
     C                     MOVE #ON       *INLR
      /TITLE INITIALISACTION ROUTINE
     C           #INIT     BEGSR
      **--------------------------------------------------------#INIT
      **                                                           **
      ** #INIT - INITIALISATION ROUTINE.                           **
      **                                                           **
      **-----------------------------------------------------------**
      *
     C                     MOVE '1'       #ON     1
     C                     MOVE '0'       #OFF    1
     C                     MOVEACPY@      BIS@   80                       S01390
     C*
     C                     TIME           TIME    60
     C*
     C***********          READ TABTB10                  99               S01390
     C                     CALL 'AOBANKR0'                                S01390
     C                     PARM '*DBERR ' RTCD    7                       S01390
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C*
     C/COPY WNCPYSRC,DL9003CCP1                                           S01408
     C*
     C                     ENDSR
      /TITLE PREPARE HISTORY RECORD
     C           HISTA     BEGSR
      **--------------------------------------------------------HISTA
      **                                                           **
      ** HISTA - MOVE VALUES TO HISTORY FILE FIELDS BEFORE A       **
      **         RECORD IS WRITTEN TO THE HISTORY FILE.            **
      **                                                           **
      **-----------------------------------------------------------**
      *
     C                     MOVE 'FA'      RTYP
     C***********          Z-ADDRUND      EDAT                            S01390
     C                     Z-ADDBJRDNB    EDAT                            S01390
     C                     Z-ADDPCPL1     PCPL
     C                     Z-ADDINTR      NRAT
     C                     Z-ADDINTR      ORAT
     C                     MOVE NOTD      TERM
     C                     Z-ADD13        SQNO
     C/COPY WNCPYSRC,DL9003CCP6                                           S01408
     C           SIGN      IFEQ '+'
     C*********  AMNT      MULT 100       EAMT      H
     C                     Z-ADDAMNT      EAMT
     C                     ELSE
     C           SIGN      IFEQ '-'
     C********   AMNT      MULT -100      EAMT      H
     C                     Z-SUBAMNT      EAMT
     C                     END
     C                     END
     C/COPY WNCPYSRC,DL9003CCP7                                           S01408
     C                     MOVE 'N'       CHQI
     C                     MOVE ICBS1     ICBS                            S36008
     C*
     C                     ENDSR
      /TITLE BLANK OUT DEALS RECORD FIELDS AFTER HISTORY RECORD OUTPUT
     C           HISTB     BEGSR
      **--------------------------------------------------------HISTB
      **                                                           **
      ***HISTB*-*BALNK*OUT*ALL*FIELDS*FROM*DEALS*RECORD*USED*IN******     S01390
      ** HISTB - BLANK OUT ALL FIELDS FROM DEALS RECORD USED IN    **     S01390
      **         THE PROGRAM ONCE THE HISTORY RECORD HAS BEEN      **
      **         OUTPUT.                                           **
      **                                                           **
      **-----------------------------------------------------------**
      *
     C                     Z-ADD0         PCPL1
     C                     Z-ADD0         INTR
     C                     Z-ADD0         NOTD
     C                     MOVE '  '      DTYP
     C                     MOVE '  '      DLST
     C***********          Z-ADD0         BRCD                            S01390
     C                     MOVEL*BLANKS   BRCA                            S01390
     C                     Z-ADD0         MDAT
     C                     MOVE '   '     CCY
     C                     MOVE ' '       INTC
     C                     MOVE ' '       ICBS1                           S36008
     C                     MOVE '    '    CLAS                                                CDL038
     C*
     C                     ENDSR
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Finastra International Limited 2001
