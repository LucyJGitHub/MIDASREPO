     H        1                                                           S01390
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Reval of backvalued deals on history')
     H***********                                                         S01390
     F********************************************************************
     F*                                                                  *
     F*  Midas - Dealing Module
     F*                                                                  *
     F*     DL9006 - HISTORY FILE REVALUATION FOR BACKDATED DEALS.       *
     F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD027             Date 09Dec05               *
      *  Prev Amend No. CDL038             Date 10May05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01390             Date 05AUG92               *AUS006
     F*                 AUS006             Date 18DEC90               *AUS006
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type                              *
     F*    S01390 - Release 10 Changes for Australianisation             *
     F*    AUS006 - AUSTRALIAN PRODUCT - INTEREST HISTORY                *AUS006
     F*                                                                  *
     F********************************************************************
     F*
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FHIST3   UF  E           K        DISK
     F*
     FHSTRVAA IP  E                    DISK
     F*
     F***TABDLEE*IF**E           K        DISK                            S01390
     F*********** TABLETAF                          KIGNORE               S01390
     F*********** TABTB20F                          KIGNORE               S01390
     F*********** TABTB40F                          KIGNORE               S01390
     F*********** TABTG20F                          KIGNORE               S01390
     F*********** TABLETHF                          KIGNORE               S01390
     F*********** TABLETIF                          KIGNORE               S01390
     F*********** TABLETKF                          KIGNORE               S01390
     F*********** TABLETLF                          KIGNORE               S01390
     F*********** TABLETMF                          KIGNORE               S01390
     F*********** TABLETPF                          KIGNORE               S01390
     F*********** TABLETSF                          KIGNORE               S01390
     F*********** TABLET1F                          KIGNORE               S01390
     F*********** TABLET2F                          KIGNORE               S01390
     F*********** TABLET5F                          KIGNORE               S01390
     F*
     F*
     F/EJECT
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F********************************************************************
     F*
     F*       10         AT LEAST 1 RECORD READ TO BE PROCESSED.
     F*             11   LEVEL BREAK ON BRANCH  (L4).
     F*             12   LEVEL BREAK ON CCY  (L3).
     F*             13   LEVEL BREAK ON CUSTOMER  (L2).
     F*             14   LEVEL BREAK ON DEAL NUMBER  (L1).
     F*       20         AT LEAST 1 RECORD READ IN ERROR PROCESSING
     F*       21         AT LEAST 1 EXCEPTION STATEMENT OCCURED.
     F*       30         END OF STHSTAA INDICATOR.
     F*       31         END OF STHSTAA IN ERROR ROUTINE.
     F*       50         WORK INDICATOR.
     F*       51         WORK INDICATOR.
     F********80*********CHAIN*FAIL*TO*CLINT*FILE.************************S01390
     F*       85         SIGN REQUIRED FOR FORMATTED OUTPUT FIELD
     F*       86         DECIMAL POINT INPUT TO FORMATTED OUTPUT FIELD
     F*       89         ERROR OCCURED WHEN FORMATTING OUTPUT FIELD
     F*     90-99        STANDARD SUBROUTINE INDICATORS.
     F*
     F*
     F/EJECT
     E                    CPY@    1   1 80                                S01390
     IHSTRVAAF
     I              DLNO                            HVDLNO
     I              ORAT                            HVORAT
     I              EAMT                            HVEAMT
     I              TERM                            HVTERM
     I*
     I***LDA********UDS                            256                    S01390
     I***********                           129 133 DBFILE                S01390
     I***********                           134 162 DBKEY                 S01390
     I***********                           163 170 DBPGM                 S01390
     I***********                           171 172 DBASE                 S01390
     ILDA         DS                            256                       S01390
     I*                                                                   S01390
     I** Local Data Area To Identify Database Errors                      S01390
     I*                                                                   S01390
     I                                      134 141 DBFILE                S01390
     I                                      142 170 DBKEY                 S01390
     I                                      171 180 DBPGM                 S01390
     I                                      181 1830DBASE                 S01390
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*
     I*
     I/EJECT
     C********************************************************************
     C*
     C*    M A I N L I N E.
     C*
     C*    FIRST CYCLE PROCESSING
     C*
     C                     EXSR FIRSTC
     C*
     C*    EQUATE OLD RATE AND NEW RATE.
     C*
     C                     Z-ADDHVORAT    HVNRAT 138
     C*
     C*    SET UP LOOP TO READ FILE
     C*
     C           *INLR     IFEQ OFF
     C           KYHST     SETLLHIST3
     C                     MOVE OFF       *IN30
     C           KYHST     READEHIST3                    30
     C           *IN30     DOWEQOFF
     C*
     C*    UPDATE INFORMATION FOR DEAL MOVEMENTS
     C*
     C                     Z-ADDHVNRAT    HVORAT
     C           RTYP      IFEQ 'PI'
     C                     ADD  EAMT      HVEAMT
     C                     ELSE
     C           RTYP      IFEQ 'PD'
     C                     SUB  EAMT      HVEAMT
     C                     ELSE
     C           RTYP      IFEQ 'IP'
     C           INTC      IFEQ 'Y'
     C           MDAT      IFEQ 0
     C           MDAT      ORGT EDAT
     C                     ADD  EAMT      HVEAMT
     C                     END
     C                     END
     C                     ELSE
     C           RTYP      IFEQ 'SC'
     C           TERM      IFNE '   '
     C                     MOVE TERM      HVTERM
     C                     END
     C                     Z-ADDORAT      HVORAT
     C                     Z-ADDNRAT      HVNRAT
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*    UPDATE BALANCE AND OUTPUT.
     C*
     C                     Z-ADDHVORAT    ORAT
     C                     Z-ADDHVNRAT    NRAT
     C                     MOVE HVTERM    TERM
     C                     Z-ADDHVEAMT    PCPL
     C                     UPDATHISTSAAF
     C           KYHST     READEHIST3                    30
     C                     END
     C                     END
     C*
     C/EJECT
     C********************************************************************
     C*
     C*      FIRST IS A SUBROUTINE TO PERFORM ALL FIRST CYCLE
     C*      CALCULATIONS.
     C*
     C           FIRSTC    BEGSR                           *** FIRSTC ***
     C*
     C*    INITILIZE STANDARD VARIABLES & FIRST CYCLE AMOUNT
     C*
     C           *NAMVAR   DEFN           LDA                             S01390
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'DL9006'  DBPGM
     C                     OUT  LDA                                       S01390
     C                     MOVE '1'       ON      1
     C                     MOVE '0'       OFF     1
     C                     MOVEACPY@      BIS@   80                       S01390
     C*
     C*    KEY LIST FOR HIST3 FILE.
     C*
     C           KYHST     KLIST
     C                     KFLD           HVDLNO
     C*
     C*****ICD.*1*  ******************************************************S01390
     C**   ACCESS BANK INFORMATION                                        S01390
     C*
     C***********          EXSR ZSYSTM                                    S01390
     C************IN99     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTABKY    DBKEY                           S01390
     C***********          MOVE '01'      DBASE                           S01390
     C***********          MOVE ON        *INLR                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          END                                            S01390
     C                     CALL 'AOBANKR0'                                S01390
     C                     PARM '*DBERR ' RTCD    7                       S01390
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C*
     C           ENDFC     ENDSR                           *** ENDFC  ***
     C*
     C********************************************************************
     C***/EJECT*****                                                      S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD.***S01390
     C***********                                                         S01390
     C***********ZSYSTM    BEGSR                           *** ZSYSTM *** S01390
     C***********                                                         S01390
     C*****SET*UP*KEY*FOR*INSTALLATION*CONTROL*RECORD.********************S01390
     C***********          MOVEL'01      'ZTABKY 12                       S01390
     C***********          MOVE '  10'    ZTABKY                          S01390
     C***********                                                         S01390
     C***********ZTABKY    CHAINTABDLEE              99    ON NOT THERE   S01390
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01390
     C***********                                                         S01390
     C*****CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.********************S01390
     C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***/EJECT*****                                                      S01390
     O***********                                                         S01390
     O***********                                                         S01390
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Misys International Banking Systems Ltd. 2001
