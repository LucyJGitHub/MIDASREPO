     H        1                                                           S01390
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Dealing interest history enquiry')            *
     H***********                                                         S01390
     F*****************************************************************
     F*                                                               *
     F*  Midas - Dealing Module                                       *
     F*                                                               *
     F*  DL9100 - DEALING INTEREST HISTORY ENQUIRY                    *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD058815           Date 28Sep21               *
      *  Prev Amend No. MD058285           Date 22Jun21               *
      *                 253911             Date 01Jun20               *
      *                 MD053295           Date 13Apr19               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 AR1055654          Date 07Jul15               *
      *                 MD031577           Date 12Feb15               *
      *                 MD031118           Date 12Feb15               *
      *                 MD031187           Date 25Nov14               *
      *                 MD026743           Date 25Nov14               *
      *                 MD027602           Date 19Aug14               *
      *                 MD025769           Date 14Apr14               *
      *                 MD024870           Date 21Feb14               *
      *                 AR996895           Date 25Nov12               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26296           Date 06Oct09               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248296             Date 28Jun07               *
      *                 246141             Date 26Mar07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 233276             Date 28Apr05               *
      *                 CGL031             Date 05Jul04               *
      *                 CDL038             Date 10May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 29Mar04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 199975             Date 18Apr02               *
      *                 186258             Date 17Apr02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 192749             Date 18Jun01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 152851            DATE 14Jan99                *
     F*                 132635            DATE 22Apr98                *
     F*                 121768            DATE 19FEB98                *
     F*                 092304            DATE 08JAN98                *
     F*                 128425            DATE 06JAN98                *
     F*                 046953            DATE 06JAN98                *
     F*                 036945            DATE 06JAN98                *
     F*                 114447            DATE 21NOV97                *
     F*                 073175            DATE 21NOV97                *
     F*                 126017            DATE 17NOV97                *
     F*                 097784            DATE 30OCT97                *
     F*                 092574            DATE 30OCT97                *
     F*                 097885            DATE 31JAN97                *
     F*                 S01408            DATE 29AUG96                *
     F*                 S01408            DATE 06JUN96                *
     F*                 084838            DATE 22MAY96                *
     F*                 085050            DATE 22MAY96                *
     F*                 095244            DATE 01NOV95                *
     F*                 095238            DATE 31OCT95                *
     F*                 053074            DATE 09MAY94                *
     F*                 066550            DATE 04FEB94                *
     F*                 048632            DATE 26JAN93                *
     F*                 S01390            DATE 11AUG92                *
     F*                 AUS006            DATE 18DEC90                *
     F*                 S36008            DATE 01DEC89                *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD058815 - Dealing interest Calculation type 6 have different*
      *             interest amount for Calculation type 1 for non-   *
      *             leap year interest period with same parameters.   *
      *             Based from MD052690. (Recompile)                  *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  253911 - Extend field length of Balance and Amount to 18A    *
      *           characters to support 1Billion and up value.        *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  AR1055654 - Rate changes reflected incorrectly in enquiries. *
      *  MD031577 - Last digit of interest amount for Interest Due    *
      *             becomes 'M' instead of 4.                         *
      *           - Convert value of OEAMT to positive before MOVE    *
      *             operation to prevent incorrect amount to be       *
      *             displayed.                                        *
      *  MD031118 - Interest History enquiry does not show the minus  *
      *             sign on the rates. Use Edit Code M in field ORATE *
      *             to display the '-' sign when rate is negative.    *
      *             (Recompile)                                       *
      *  MD031187 - Last digit and sign of interest/tax amount in     *
      *             last row of the screen is cut off. Recompile due  *
      *             to changes on DSPF/DL9100FM.                      *
      *  MD026743 - Enquiry shows wrong interest days and amount.     *
      *             Remove codes that adds 1 to interest days.        *
      *  MD027602 - Wrong interest rate in row with Opening Balance   *
      *  MD025769 - Error on Dealing Interest History enquiry         *
      *  MD024870 - CGL035+CER048+CER054 in Interest History Enquiry  *
      *             3 tax lines show wrong amounts in wrong columns   *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26296 - Add new processing  Daily Update of History with  *
      *           Dealing Events                                      *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  248296 - Remove a interest part at LD coding of 233276.      *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  233276 - Adjust the enquiry screen on DL9100                 *
      *  CGL031 - Taxation on Savings Income                          *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (Recompile).                      *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  199975 - OB record not displayed if selection with           *
      *           'From Date' used. Days & interest in B/FWD should   *
      *           not be displayed.                                   *
      *  186258 - Days and interest shown are incorrect for deals     *
      *           set to mature earlier than run date.  Set end date  *
      *           to maturity date.                                   *
      *  192749 - Negative amount reported with Alpha characters.     *
      *  CSD007 - Customer Closing                                    *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
     F*  152851 - Take out fix 092304, as it shouldn't have been      *
     F*           put into core.                                      *
     F*  132635 - 097784 not fully incorporated.                      *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  092304 - Only Call Deals should be included as per FS.       *
     F*  128425 - Half-adjust interest amounts.                       *
     F*         - Opening Balance not being shown correctly.          *
     F*  046953 - Interest History Enquiry problems.                  *
     F*    Note - This fix was previously in core but went AWOL.      *
     F*  036945 - Set on SECLT when first, rather than second, valid  *
     F*           record found, else deal doesn't appear on enquiry   *
     F*           if selection is by Cust/Deal No and deal has only   *
     F*           one history record.                                 *
     F*  114447 - Amount and balance fields in Interest History       *
     F*           Enquiry Screen truncate leading digit - change      *
     F*           amount fields from 13A to 14A.                      *
     F*  073175 - Interest History Enquiry Print loops if more than   *
     F*           one user takes the option since both write records  *
     F*           with the same RRN - fix is to create a new member   *
     F*           for each user.                                      *
     F*         - Enquiry and print include items from previous       *
     F*           requests - fix is to clear HISTEAA member between   *
     F*           requests.                                           *
     F*         - Pass parameter of DLC9105 fo RCF when calling pgm,  *
     F*           to match record on FCREPTL1.                        *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  097784 - The wordings TERM, 11AM and 24HR should only be     *
     F*           applicable for the Australian market                *
     F*  092574 - Don't perform the 053074 check when there           *
     F*           is a change of deal number                          *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
     F*  S01408 - Insertion of Hook DL9100CCP8                        *
     F*           Insertion of Hook DL9100CCP9                        *
     F*           Insertion of Hook DL9100CP10                       *
     F*           Insertion of Hook DL9100CP11                       *
     F*           Insertion of Hook DL9100CP12                       *
     F*           Insertion of Hook DL9100CP13                       *
     F*           Insertion of Hook DL9100CP14                       *
     F*           Insertion of Hook DL9100CP15                       *
     F*           Insertion of Hook DL9100CP16                       *
     F*           Insertion of Hook DL9100CP17                       *
     F*           Insertion of Hook DL9100CP18                       *
     F*           Insertion of Hook DL9100CP19                       *
     F*           Insertion of Hook DL9100CP20                       *
     F*           Insertion of Hook DL9100CP21                       *
     F*           Insertion of Hook DL9100CP22                       *
     F*           Insertion of Hook DL9100CP23                       *
     F*           Insertion of Hook DL9100CP24                       *
     F*           Insertion of Hook DL9100CP25                       *
     F*           Insertion of Hook DL9100CP26                       *
     F*           Insertion of Hook DL9100CP27                       *
     F*           Insertion of Hook DL9100CP28                       *
     F*           Insertion of Hook DL9100CP29                       *
     F*           Insertion of Hook DL9100CP30                       *
     F*           Insertion of Hook DL9100CP31                       *
     F*           Insertion of Hook DL9100CP32                       *
     F*           Insertion of Hook DL9100CP33                       *
     F*           Insertion of Hook DL9100CP34                       *
     F*           Insertion of Hook DL9100FFP1                       *
     F*           Insertion of Hook DL9100FFP2                       *
     F*  S01408 - Insertion of Hook DL9100EEP2                        *
     F*           Insertion of Hook DL9100EEP1                        *
     F*           Insertion of Hook DL9100CCP7                        *
     F*           Insertion of Hook DL9100CCP6                        *
     F*           Insertion of Hook DL9100CCP5                        *
     F*           Insertion of Hook DL9100CCP4                        *
     F*           Insertion of Hook DL9100CCP3                        *
     F*           Insertion of Hook DL9100CCP2                        *
     F*           Insertion of Hook DL9100CCP1                        *
     F*  084838 - Interest Statement (MM) carries with wrong          *
     F*           Opening Balance with back-value deals               *
     F*  085050 - Currency of the deal should be display on screen.   *
     F*         - Show correct no of days and interest for Front Up   *
     F*           Interest deals.                                     *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*  053074 - If No. of Days = 0 for Opening Balance, ignore      *
     F*           record.  Also test for numeric deal number on       *
     F*           screen 1.                                           *
     F*  066550 - GLINTC has had historical problems and inaccuracies *
     F*           and is now externaly descibed and changed to use    *
     F*           ZINTDYZ1. See document atached to error no on GEMS  *
     F*  048632 - Error Messages non standard.                        *
     F*           F9 should be used for Print Option not F10.         *
     F*  S01390 - Release 10 Changes for Australianisation            *
     F*  AUS006 - AUSTRALIAN PRODUCT - INTEREST HISTORY               *
     F*  S36008 - INTEREST HISTORY ENQUIRY AND PURGE                  *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F********************************************************************
     F*       05         CLEAR SUBFILE
     F*      N05         DISPLAY SUBFILE
     F*       07         SUBFILE END
     F*             14   LEVEL BREAK ON DEAL NUMBER  (L1).
     F*       40         CAPITALISE INTEREST                              128425
     F*       50         CUSTOMER INPUT ERROR - HIGHLIGHT
     F*       51         DEPOSIT/LOAD INDICATOR INPUT ERROR - HIGHLIGHT
     F*       52         CURRENCY INPUT ERROR - HIGHLIGHT
     F*       53         DEAL NUMBER INPUT ERROR - HIGHLIGHT
     F*       54         FROM DATE INPUT ERROR - HIGHLIGHT
     F*       55         TO DATE INPUT ERROR - HIGHLIGHT
     F*       56         SCREEN FIELDS IN ERROR - HIGHLIGHT ERRMSG
     F/COPY WNCPYSRC,DL9100FFP2                                           S01408
     F*       89         ERROR OCCURED WHEN FORMATTING OUTPUT FIELD
     F*       99         CHAIN FAIL INDICATOR
     F/EJECT
     F*
     F/COPY WNCPYSRC,DL9100FFP1                                           S01408
     FDL9100FMCF  E                    WORKSTN
     F                                              KINFDS WSTNDS
     F****************************************RRN   KSFILE SUBR01         085050
     F                                        RRND  KSFILE SUBR01         085050
     F*
     F***SNAME***IF**E           K        DISK                            S01390
     F*********** CLINTCBF                          KRENAMESHORTNMF       S01390
     F***********                                                         S01390
     F***CLINT***IF**E           K        DISK                            S01390
     F***********                                                         S01390
     F***TABDLEE*IF**E           K        DISK                            S01390
     F*********** TABLETAF                          KIGNORE               S01390
     F*********** TABTB20F                          KIGNORE               S01390
     F*********** TABTB40F                          KIGNORE               S01390
     F*********** TABTG20F                          KIGNORE               S01390
     F*********** TABLETHF                          KIGNORE               S01390
     F*********** TABLETIF                          KIGNORE               S01390
     F*********** TABLETKF                          KIGNORE               S01390
     F*********** TABLETLF                          KIGNORE               S01390
     F*********** TABLETMF                          KIGNORE               S01390
     F*********** TABLETPF                          KIGNORE               S01390
     F*********** TABLETSF                          KIGNORE               S01390
     F*********** TABLET1F                          KIGNORE               S01390
     F*********** TABLET2F                          KIGNORE               S01390
     F*********** TABLET5F                          KIGNORE               S01390
     F*
     FHIST4   IF  E           K        DISK
     FSDCSINLDIF  E           K        DISK                                                 MD024870
     FSDSTAAL1IF  E           K        DISK                                                 MD025769
     F*
     FDEALALL IF  E           K        DISK                                                 MD025769
     F            DEALSDAF                          KIGNORE                                 MD025769
     F            DEALSDBF                          KIGNORE                                 MD025769
     F            DEALSDDF                          KIGNORE                                 MD025769
     F            DEALSDEF                          KIGNORE                                 MD025769
     F            DEALSDFF                          KIGNORE                                 MD025769
     F            DEALSDGF                          KIGNORE                                 MD025769
     F*                                                                                     MD025769
     F***DL9111P1O   E             18     PRINTER                         S01390
     F***HISTEAA*O   E                    DISK                     S01390 073175
     FHISTEAA O   E                    DISK                           UC  073175
     F*
     F/EJECT
     E*
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    ZAR1       20  1               AMOUNT ARRAY 1
     E                    ZAR2       20  1               AMOUNT ARRAY 2
0069 E                    ZA1        16  1               ZALIGN SR. ARRAY
0070 E                    ZA2        16  1               ZALIGN SR. ARRAY
     E                    REC1    1   2 79               RECORD MESSAGES 1
     E                    ERRC       20  4               ERROR CODES
     E*                                                                   S01408
     E*                                                                   S01408
     E/COPY WNCPYSRC,DL9100EEP1                                           S01408
     E*                                                                   S01408
     E*                                                                   S01408
     E**********          NRTP    1  14  2   NRDS   11   NARRATIVES                           CGL031
     E**********          NRTP    1  15  2   NRDS   11   NARRATIVES                  CGL031 BUG26296
     E                    NRTP    1  17  2   NRDS   11   NARRATIVES                         BUG26296
     E*                                                                   S01408
     E*                                                                   S01408
     E/COPY WNCPYSRC,DL9100EEP2                                           S01408
     E*                                                                   S01408
     E*                                                                   S01408
     E***********         LONT    5   5  2               LOAN TYPES       092304
     E***********         DEPT    4   4  2               DEPOSIT TYPES    092304
     E                    LONT    5   5  2               LOAN TYPES       152851
     E                    DEPT    4   4  2               DEPOSIT TYPES    152851
     E                    CPY@    1   1 80                                S01390
     E                    CLRPFM  1   1 36               CLRPFM Command   073175
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
     E*
     E/EJECT
     I*
     I*
     IHISTSAAF
     I              CNUM                            HCNUM
      *                                                                                     MD025769
     IDEALSDCF                                                                              MD025769
     I              RECI                            DRECI                                   MD025769
     I              INTR                            DINTR                                   MD025769
     I              PCPL                            DPCPL                                   MD025769
     I              ICBS                            DICBS                                   MD025769
     I*                                                                                     MD025769
     I***CLINTCBF                                                         S01390
     I***********   BRCD                            BRCC                  S01390
     I***LDA********UDS                            256                    S01390
     I***********                           129 133 DBFILE                S01390
     I***********                           134 162 DBKEY                 S01390
     I***********                           163 170 DBPGM                 S01390
     I***********                           171 172 DBASE                 S01390
     ILDA         DS                            256                       S01390
     I*                                                                   S01390
     I** Local Data Area To Identify Database Errors                      S01390
     I*                                                                   S01390
     I                                      134 141 DBFILE                S01390
     I                                      142 170 DBKEY                 S01390
     I                                      171 180 DBPGM                 S01390
     I                                      181 1830DBASE                 S01390
     I*                                                                   S01390
     IRUNDT       DS                                                      S01390
     I                                       13  13 MBIN                  S01390
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     ISDBRCH    E DSSDBRCHPD                                              S01390
     I* Branch Details Accessed Via Access Program                        S01390
     I*                                                                   S01390
     ISDCURR    E DSSDCURRPD                                              S01390
     I* Currency Details Accessed Via Access Program                      S01390
     I*                                                                   S01390
     ISDCUST    E DSSDCUSTPD                                              S01390
     I* Customer Details Accessed Via Access Program                      S01390
     I              QQDFAC                          #DFAC1                                    CGL029
     I*                                                                   S01390
     ISCSARD    E DSSCSARDPD                                              S01390
     I* SAR Details Accessed Via Access Program                           S01390
     I*                                                                   S01390
     I***SDGELR*   E DSSDGELRPD                                                    MD035545 MD047993
     I**GENERAL*LEDGER*DETAILS*ACCESSED*VIA*ACCESS*PROGRAM*************            MD035545 MD047993
     I**********    QQACCD                          ACCDQQ                         MD035545 MD047993
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*                                                                   S01390
     IDSSDY     E DSDSSDY                                                 S01390
     I* Second DS For Access Programs, Long Data Structure                S01390
     I*
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
     I*********** DS                                                      S01390
     I***********                             1  12 TABKY                 S01390
     I***********                             1   2 TABKY1                S01390
     I***********                             9  11 TABKY2                S01390
     I***********                            12  12 TABKY3                S01390
     I***********                            10  12 TABKY4                S01390
     I*
     IWSTNDS      DS
     I                                      197 206 WRKSTN
     I*
     I            DS
     I**********                              1  72 RECORD                                    253911
     I                                        1  79 RECORD                                    253911
     I                                        1   7 ODATE
     I                                        8  18 ONARRA
     I**********                             19  32 OAMT                               114447 253911
     I                                       19  36 OAMT                                      253911
     I**********                             33  46 OBAL                               114447 253911
     I                                       37  54 OBAL                                      253911
     I**********                             58  70 OINTR                              114447 253911
     I                                       67  79 OINTR                                     253911
     I***************************************19  31 OAMT                  114447
     I***************************************32  44 OBAL                  114447
     I***************************************56  68 OINTR                 114447
     I            DS
     I*    DATA STRUCTURE CONTAINING NEW RECORD
     I**                                      1  96 NREC                  E36489
     I                                        1 104 NREC                  E36489
     I                                        1   2 RTYP
     I                                        3   70EDAT
     I                                        8  130DLNO
     I                                       14  280PCPL
     I                                       29  418NRAT
     I                                       42  548ORAT
     I***********                            55  570BRCD                  S01390
     I                                       55  57 BRCA                  S01390
     I                                       58  60 CCY
     I                                       61  61 INTC
     I                                       62  760EAMT
     I***********                            77  790BRCC                  S01390
     I                                       77  79 BRCC                  S01390
     I                                       80  87 CASK
     I                                       88  88 ICBS
     I                                       89  930MDAT
     I                                       94  96 TERM
     I**********                             97 1020CNUM                  E36489              CSD027
     I                                       97 102 CNUM                                      CSD027
     I                                      103 104 DTYP
     I            DS
     I*    DATA STRUCTURE CONTAINING OLD RECORD
     I**                                      1  96 OREC                  E36489
     I                                        1 104 OREC                  E36489
     I                                        1   2 ORTYP
     I                                        3   70OEDAT
     I                                        8  130ODLNO
     I                                       14  280OPCPL
     I                                       29  418ONRAT
     I                                       42  548OORAT
     I***********                            55  570OBRCD                 S01390
     I                                       55  57 OBRCA                 S01390
     I                                       58  60 OCCY
     I                                       61  61 OINTC
     I                                       62  760OEAMT
     I***********                            77  790OBRCC                 S01390
     I                                       77  79 OBRCC                 S01390
     I                                       80  87 OCASK
     I                                       88  88 OICBS
     I                                       89  930OMDAT
     I                                       94  96 OTERM
     I**********                             97 1020OCNUM                              E36489 CSD027
     I                                       97 102 OCNUM                                     CSD027
     I                                      103 104 ODTYP
      *                                                                   073175
      **  Clear Physical File with a specified name member                073175
      *                                                                   073175
     I            DS                                                      073175
     I                                        1  36 CLRPFM                073175
     I                                       26  35 NAME                  073175
     I*                                                                   073175
     I              'GR. INT DUE'         C         WNARRA                                  MD024870
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I/EJECT
     I/COPY WNCPYSRC,DL9100I002
     C********************************************************************
     C*
     C*     M A I N L I N E
     C*                                                                   073175
     C           *ENTRY    PLIST                                          073175
     C                     PARM           MBRNAM  9                       073175
     C/COPY WNCPYSRC,DL9100C010
     C*                                                                   073175
     C                     MOVELMBRNAM    NAME                            073175
     C                     MOVELMBRNAM    NAMEPM100                       073175
     C*
     C*     INITIALISATION PROCESSING
     C*
     C                     EXSR INIT
     C*
     C*     MAIN PROCESSING
     C*
     C           *INLR     IFNE '1'                                       S01390
     C                     EXSR MAIN
     C*
     C*     END PROCESSING
     C*
     C                     EXSR END
     C                     END                                            S01390
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*     SUBROUTINE: INITIALISATION
     C*
     C           INIT      BEGSR                           *** INIT SUBR *
     C                     CALL 'AOSARDR0'                                S01390
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM '*VERIFY' OPTN                            S01390
     C                     PARM 'AUS006'  KYSAR   6                       S01390
     C           SCSARD    PARM SCSARD    DSFDY                           S01390
     C*                                                                   S01390
     C           RTCD      IFNE *BLANKS                                   S01390
     C                     SETON                     LR                   S01390
     C                     GOTO INTEND                                    S01390
     C                     END                                            S01390
      *                                                                   CSD007
      ** Access Switchable Features file and check if CSD007              CSD007
      ** is switched on or not.                                           CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   RTCD    7                       CSD007
     C                     PARM '*VERIFY' OPTN    7                       CSD007
     C                     PARM 'CSD007'  KYSAR   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           RTCD      IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
      *                                                                   CSD007
      ** Database Error, if Return Code is not blanks or *NRF             CSD007
      *                                                                   CSD007
     C           RTCD      IFNE '*NRF   '                                 CSD007
     C           *LOCK     IN   LDA                                       CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'007'     DBASE                           CSD007
     C                     MOVEL'CSD007  'DBKEY                           CSD007
     C                     OUT  LDA                                       CSD007
     C                     MOVE *ON       *INLR                           CSD007
     C                     GOTO INTEND                                    CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
     C*
      ** Access Switchable Features file and check if CER048                                BUG26296
      ** is switched on or not.                                                             BUG26296
      *                                                                                     BUG26296
     C                     CALL 'AOSARDR0'                                                  BUG26296
     C                     PARM *BLANKS   RTCD                                              BUG26296
     C                     PARM '*VERIFY' OPTN                                              BUG26296
     C                     PARM 'CER048'  KYSAR                                             BUG26296
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG26296
      *                                                                                     BUG26296
     C           RTCD      IFEQ *BLANKS                                                     BUG26296
     C                     MOVE 'Y'       CER048  1                                         BUG26296
      *                                                                                     BUG26296
     C                     ELSE                                                             BUG26296
     C                     MOVE 'N'       CER048                                            BUG26296
      *                                                                                     BUG26296
      ** Database Error, if Return Code is not blanks or *NRF                               BUG26296
      *                                                                                     BUG26296
     C           RTCD      IFNE '*NRF   '                                                   BUG26296
     C           *LOCK     IN   LDA                                                         BUG26296
     C                     MOVEL'SCSARDPD'DBFILE                                            BUG26296
     C                     MOVEL'008'     DBASE                                             BUG26296
     C                     MOVEL'CER048  'DBKEY                                             BUG26296
     C                     OUT  LDA                                                         BUG26296
     C                     MOVE *ON       *INLR                                             BUG26296
     C                     GOTO INTEND                                                      BUG26296
     C                     ENDIF                                                            BUG26296
     C                     ENDIF                                                            BUG26296
      *                                                                                     BUG26296
      ** Access Switchable Features file and check if CER054                                BUG26296
      ** is switched on or not.                                                             BUG26296
      *                                                                                     BUG26296
     C                     CALL 'AOSARDR0'                                                  BUG26296
     C                     PARM *BLANKS   RTCD                                              BUG26296
     C                     PARM '*VERIFY' OPTN                                              BUG26296
     C                     PARM 'CER054'  KYSAR                                             BUG26296
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG26296
      *                                                                                     BUG26296
     C           RTCD      IFEQ *BLANKS                                                     BUG26296
     C                     MOVE 'Y'       CER054  1                                         BUG26296
      *                                                                                     BUG26296
     C                     ELSE                                                             BUG26296
     C                     MOVE 'N'       CER054                                            BUG26296
      *                                                                                     BUG26296
      ** Database Error, if Return Code is not blanks or *NRF                               BUG26296
      *                                                                                     BUG26296
     C           RTCD      IFNE '*NRF   '                                                   BUG26296
     C           *LOCK     IN   LDA                                                         BUG26296
     C                     MOVEL'SCSARDPD'DBFILE                                            BUG26296
     C                     MOVEL'009'     DBASE                                             BUG26296
     C                     MOVEL'CER054  'DBKEY                                             BUG26296
     C                     OUT  LDA                                                         BUG26296
     C                     MOVE *ON       *INLR                                             BUG26296
     C                     GOTO INTEND                                                      BUG26296
     C                     ENDIF                                                            BUG26296
     C                     ENDIF                                                            BUG26296
      *                                                                                     BUG26296
     C                     MOVE 'N'       CDL088  1                                        AR1055654
     C                     CALL 'AOSARDR0'                                                 AR1055654
     C                     PARM *BLANKS   WRTCD   7                                        AR1055654
     C                     PARM '*VERIFY' WOPTN   7                                        AR1055654
     C                     PARM 'CDL088'  WSARD   6                                        AR1055654
     C           SCSARD    PARM SCSARD    DSFDY                                            AR1055654
      *                                                                                    AR1055654
     C           WRTCD     IFEQ *BLANKS                                                    AR1055654
     C                     MOVE 'Y'       CDL088                                           AR1055654
     C                     ENDIF                                                           AR1055654
      *                                                                                    AR1055654
     C*     INITIALISE STANDARD VARIABLES
     C*
     C           *NAMVAR   DEFN           LDA                             S01390
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'DL9100'  DBPGM
     C                     OUT  LDA                                       S01390
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01390
     C                     IN   RUNDT                                     S01390
     C                     MOVEACPY@      BIS@   80                       S01390
     C                     MOVE '1'       ON      1
     C                     MOVE *ZERO     OFF     1
     C***********          MOVE OFF       SC1     1                       048632
     C                     MOVE OFF       SC2     1
     C***********          Z-ADD1         A       20                      048632
     C                     MOVE OFF       HISREC  1
     C                     MOVE *ALL'*'   ASTERX 14
     C                     Z-ADD*ZERO     RRN     50
     C                     Z-ADD*ZERO     RRND    50                      085050
      *                                                                   048632
      **  Initialise screen msg queue.                                    048632
     C                     MOVEL'*'       DDPGMQ                          048632
      *                                                                   048632
      **  Set on Message Subfile end indicator.                           048632
     C                     MOVE '1'       *IN59                           048632
     C***********                                                         S01390
     C******KEY*LIST*FOR*CLIENT*FILE**************************************S01390
     C***********                                                         S01390
     C***********CLTKY     KLIST                                          S01390
     C***********          KFLD           CLKY01  60       CUST NO        S01390
     C***********          KFLD           CLKY02  1        REC TYPE       S01390
     C*
     C*     KEY LISTS FOR HISTORY FILE
     C*
     C           HISKY1    KLIST
     C**********           KFLD           HISK01  60       CUST NO                            CSD027
     C                     KFLD           HISK01  6        CUST NO                            CSD027
     C                     KFLD           HISK02  60       DEAL NO
     C*
     C           HISKY2    KLIST
     C**********           KFLD           HISK01  60       CUST NO                            CSD027
     C                     KFLD           HISK01  6        CUST NO                            CSD027
     C*
     C           HISKY3    KLIST
     C**********           KFLD           HISK01  60       CUST NO                            CSD027
     C                     KFLD           HISK01  6        CUST NO                            CSD027
     C                     KFLD           HISK02  60       DEAL NO
     C                     KFLD           HISK03  50       EVENT DATE
     C                     KFLD           HISK04  20       SEQUENCE NO
     C*
     C******INSTALLATION*CONTROL*RECORD*1.********************************S01390
     C*     ACCESS BANK DETAILS                                           S01390
     C*
     C***********          EXSR ZSYSTM                                    S01390
     C                     CALL 'AOBANKR0'                                S01390
     C                     PARM '*DBERR ' RTCD    7                       S01390
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C************IN99     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELZTABKY    DBKEY                           S01390
     C***********          MOVE '01'      DBASE                           S01390
     C***********          MOVE ON        *INU7                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          END                                            S01390
     C*
     C***********          MOVE RUNA      RUNDAT                          S01390
     C                     MOVE BJMRDT    RUNDAT                          S01390
      *****************************************************************            MD035545 MD047993
      ***Call*access*program*for*General*Ledger*details.***************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
     C********** @RTCD     IFNE *BLANK                                             MD035545 MD047993
     C**********           MOVEL'SDGELRPD'DBFILE                                   MD035545 MD047993
     C**********           MOVEL'062'     DBASE                                    MD035545 MD047993
     C**********           MOVEL@OPTN     DBKEY                                    MD035545 MD047993
     C**********           MOVE ON        *INLR                                    MD035545 MD047993
     C**********           MOVE ON        *INU8                                    MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting                                                      MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD  7                                         MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'                             MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C*
     C*     INITIALISE PARAMETERS FOR FORMAT SUBROUTINE.
     C*
      **  Display amounts on screen as 999,999,999.99.                    114447
      *                                                                   114447
     C***********          Z-ADD13        ZCHRO                           114447
     C**********           Z-ADD14        ZCHRO                                        114447 253911
     C                     Z-ADD20        ZCHRO                                               253911
     C                     MOVE *BLANK    ZSIGNT
     C                     MOVE *BLANK    ZSIGN
     C                     MOVE 'Y'       ZCOMA
     C*
     C*     GET FIRST SCREEN INFORMATION
     C*
     C                     EXSR SCREN1
     C*
     C           INTEND    TAG                                            S01390
     C                     ENDSR                           *** END INIT **
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    MAIN PROCESSING SUBROUTINE
     C*
     C           MAIN      BEGSR                           ** MAIN SUBR **
     C*
     C           *INLR     DOWNEON
     C*
     C           SC2       CASEQON        SCREN1           ** SCREEN 1 ***
     C***********SC1       CASEQON        SCREN2           ** SCREEN 2 ***048632
     C           *IN56     CASEQOFF       SCREN2           ** SCREEN 2 ***
     C                     END
     C*
     C                     END
     C*
     C           ENDMAN    ENDSR                           ** END OF MAIN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    END PROCESSING SUBROUTINE
     C*
     C           END       BEGSR                           *** END SUBR  *
     C*
     C                     SETON                     LR                                     MD025769
      *                                                                                     MD025769
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    SCREEN 1 SUBROUTINE - GETS FIRST SCREEN DETAILS AND VALIDATES
     C*
     C           SCREN1    BEGSR
     C*
     C*    SET OFF BOTH SCREEN INDICATORS
     C*
     C***********          MOVE OFF       SC1                             048632
     C                     MOVE OFF       SC2
     C                     MOVE OFF       *IN50
     C                     MOVE ON        *IN56                           048632
     C                     MOVE *BLANKS   CUSTNO
     C                     MOVE *BLANKS   DLIND
     C                     MOVE *BLANKS   CCYINP
     C                     MOVE *BLANKS   DEALNO
     C                     MOVE *BLANKS   FRDTIN
     C                     MOVE *BLANKS   TODTIN
     C*
     C*    SCREEN 1 LOOP UNTIL VALID SCREEN READ
     C*
     C***********SC1       DOWEQOFF                        ** START LOOP 1048632
     C           *IN56     DOWEQON                         ** START LOOP 1048632
     C*
     C*    DISPLAY SCREEN 1 ERRORS / READ SCREEN 1 DETAILS
     C*
     C                     WRITEDL9100S0                                  048632
     C                     EXFMTFORMT1
     C***********                                                         048632
     C*****SET*ON SCREEN READ INDICATOR                                   048632
     C***********                                                         048632
     C***********          MOVE ON        SC1                             048632
     C*
     C*    RESET ERROR CODES ARRAY/INDEX
     C*
     C***********          MOVE *BLANKS   ERRC                            048632
     C***********          Z-ADD1         A                               048632
     C                     MOVE OFF       *IN56
     C*
     C*    CHECK FOR EXIT KEY PRESSED (CMD-1)
     C*
     C           *INKC     IFEQ ON
     C                     MOVE ON        *INLR
     C                     ELSE
     C*
     C*    IF NO EXIT KEY PRESSED EXECUTE SCREEN 1 VALIDATION ROUTINE.
     C*
     C                     EXSR VALSC1
     C                     END
     C***********                                                         048632
     C*****IF*SCREEN 1 IS INVALID LOOP AROUND AND DISPLAY ERROR CODES     048632
     C***********                                                         048632
     C***********A         IFGT 1                                         048632
     C***********          MOVE OFF       SC1                             048632
     C***********          MOVE ON        *IN56                           048632
     C***********          END                                            048632
     C*
     C                     END                             ** END LOOP 1 *
     C*
     C           ENDSC1    ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    SCREEN 2 SUBROUTINE - DISPLAY HISTORY DETAILS
     C*
     C           SCREN2    BEGSR
     C*
     C*    SET OFF BOTH SCREEN INDICATORS AND HISTORY RECORDS COUNTER
     C*
     C***********          MOVE OFF       SC1                             048632
     C                     MOVE OFF       SC2
     C                     MOVE OFF       *IN07
     C                     MOVE OFF       *IN14
     C                     MOVE OFF       SELCT   1
     C                     Z-ADD*ZERO     RRN
     C                     Z-ADD*ZERO     RRND                            085050
     C                     MOVE *ZERO     ODLNO
     C*
     C*    CLEAR SCREEN SUBFILE DETAILS
     C*
     C                     MOVE ON        *IN05
     C*
     C                     CALL 'QCMDEXC'                                 073175
     C                     PARM           CLRPFM                          073175
     C                     PARM 36        CMD    155                      073175
     C*
     C*    FORMAT SCREEN 2 HEADER FIELDS FOR OUTPUT
     C*
     C                     EXSR FMTHDR
     C*
     C*    WRITE OUT TEMPORARY SCREEN
     C*
     C                     WRITEFORMT2
     C                     WRITEFORMT3
     C                     MOVE OFF       *IN05
     C*
     C*    PROCESS HISTORY RECORDS UNTIL FIRST RECORD TO BE DISPLAYED
     C*
     C                     EXSR FSTREC
     C*
     C*    LOOP WHILE VALID HISTORY RECORDS READ
     C*
     C           HISREC    DOWEQON
     C*
     C*    READ NEXT VALID HISTORY RECORD
     C*
     C                     EXSR READHR
     C*
     C*    PROCESS PREVIOUS HISTORY RECORD
     C*
     C           SELCT     IFEQ ON
     C                     EXSR PROCSS
     C*
     C*    FORMAT PREVIOUS HISTORY RECORD AND WRITE OUT TO SUBFILE
     C*
     C                     EXSR FMTREC
     C*
     C*   CHANGE OF DEAL NUMBER
     C*
     C           *IN14     IFEQ ON
     C/COPY WNCPYSRC,DL9100C006
     C                     EXSR DEALSR
     C                     MOVE OFF       *IN14
     C           *IN07     CASEQOFF       FSTREC
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*    END LOOP
     C*
     C                     END
     C*
     C*
     C*    OUTPUT HISTORY SCREEN DETAILS
     C*
     C                     MOVE *BLANKS   OMSG
     C*
     C           SELCT     IFEQ OFF
     C                     MOVE ON        *IN05
     C                     MOVELREC1,2    OMSG
     C                     END
     C*
     C***********RRN       IFEQ *ZERO                                     085050
     C           RRND      IFEQ *ZERO                                     085050
     C                     MOVE ON        *IN05
     C                     END
     C*
     C           DSPLY     TAG
     C*
     C                     WRITEFORMT3
     C                     EXFMTFORMT2
     C*
     C                     MOVE ON        SC2
     C*
     C*    CHECK COMMAND KEYS
     C*
     C           *INKC     IFEQ ON
     C                     MOVE ON        *INLR
     C                     GOTO ENDSC2
     C                     END
     C*
     C           *INKL     CABEQON        ENDSC2
     C*
     C************INKJ     IFEQ ON                                        048632
     C           *INKI     IFEQ ON                                        048632
     C                     EXSR REPORT
     C                     GOTO ENDSC2
     C                     END
     C*
     C                     GOTO DSPLY
     C*
     C           ENDSC2    ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    VALIDATE SCREEN 1 DETAILS.
     C*
     C           VALSC1    BEGSR
     C*
     C*    VALIDATES - CUSTOMER NUMBER
     C*              - DEAL NUMBER
     C*              - DEPOSIT / LOAN INDICATOR
     C*              - CURRENCY CODE
     C*              - FROM DATE
     C*              - TO DATE
     C*
     C*    SET OFF SCREEN ERROR INDICATORS
     C*
     C                     MOVE OFF       *IN50
     C                     MOVE OFF       *IN51
     C                     MOVE OFF       *IN52
     C                     MOVE OFF       *IN53
     C                     MOVE OFF       *IN54
     C                     MOVE OFF       *IN55
     C***********                                                         048632
     C*****CLEAR*OUT SCREEN ERROR CODES                                   048632
     C***********                                                         048632
     C***********          MOVE *BLANKS   ERRMSG                          048632
     C***********          MOVEA*BLANKS   ERRC                            048632
      *                                                                   048632
      **  Clear screen message queue.                                     048632
     C                     CALL 'ZA0250'                                  048632
     C*
     C*    VALIDATE CUSTOMER NUMBER
     C*
     C*    CUSTOMER NUMBER - MANDATORY ENTRY.
     C*                    - MUST BE A VALID CUSTOMER NUMBER OR
     C*                      VALID CUSTOMER SHORTNAME.
     C*                    - CUSTOMER MUST NOT BE A PARENT.
     C*                    - CUSTOMER MUST HAVE RECORDS ON HISTORY FILE.
     C*
     C           CUSTNO    IFEQ *BLANKS
     C                     MOVE ON        *IN50
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '034'     ERRC,A                          048632
     C***********          ADD  1         A                               048632
     C                     MOVEL'DLM0034' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C                     ELSE
0452 C***********                                                         S01390
0453 C*****IS*CUSTOMER*NO*OR*SHORTNAME*ENTERED.***************************S01390
     C***********                                                         S01390
0454 C***********          Z-ADD0         ZADEC                           S01390
 455 C***********          Z-ADD6         ZADIG                           S01390
0456 C***********          MOVE '        'ZFIELD                          S01390
0457 C***********          MOVEL'        'ZFIELD                          S01390
0458 C***********          MOVE CUSTNO    ZFIELD                          S01390
0459 C***********          EXSR ZALIGN                                    S01390
0460 C************IN99     IFEQ ON                                        S01390
0467 C*
0468 C*****IF*SNAME*ENTERED,*CHECK*IT*IS*ON*SHORT*NAME*FILE.**************S01390
     C*    CHECK CUSTOMER IS ON FILE.                                     S01390
     C*
0471 C***********CUSTNO    CHAINSNAME                98                   S01390
     C                     MOVE CUSTNO    KYCN   10                       S01390
     C***********          CALL 'AOCUSTR0'                         S01390 CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM '*KEY   ' OPTN                            S01390
     C                     PARM           KYCN                            S01390
     C                     PARM *BLANKS   KYST    7                       S01390
     C***********SDCUST    PARM SDCUST    DSSDY                    S01390 CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
0472 C************IN98     IFEQ ON                                        S01390
      *                                                                   CSD007
      ** If CSD007 is on, allow processing of a closed record (return     CSD007
      ** code '*NRF' and date deleted equal to zero).                     CSD007
      *                                                                   CSD007
     C           CSD007    IFEQ 'Y'                                       CSD007
     C           RTCD      ANDEQ'*NRF'                                    CSD007
     C           BBDTDL    ANDEQ*ZERO                                     CSD007
     C                     MOVELBBCUST    CNUM                            CSD007
     C                     MOVELBBCUST    CUSTNO                          CSD007
      *                                                                   CSD007
     C                     ELSE                                           CSD007
      *                                                                   CSD007
     C           RTCD      IFNE *BLANKS                                   S01390
     C                     MOVE ON        *IN50
     C                     MOVE ON        *IN56                           048632
     C           KYST      IFEQ '*CSHT  '                                 S01390
     C***********          MOVE '035'     ERRC,A                          048632
     C                     MOVEL'DLM0035' @MSGID 10                       048632
     C                     ELSE                                           S01390
     C***********          MOVE '034'     ERRC,A                    S01390048632
     C                     MOVEL'DLM0007' @MSGID 10                       048632
     C                     END                                            S01390
     C***********          ADD  1         A                               048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          END                                            S01390
     C                     ELSE
     C***********          MOVELCUSTNO    CNUM                            S01390
     C                     MOVELBBCUST    CNUM                            S01390
     C                     MOVELBBCUST    CUSTNO                          046953
     C                     END
      *                                                                   CSD007
     C                     ENDIF                                          CSD007
      *                                                                   CSD007
     C*
0461 C*    CHECK CUSTOMER RECORDS ON THE HISTORY FILE
     C*
0462 C                     MOVELCNUM      HISK01
     C                     MOVE ON        HISREC
     C           HISKY2    SETLLHIST4                    98
     C           *IN98     IFEQ OFF
     C                     MOVE OFF       HISREC
     C                     MOVE ON        *IN50
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '034'     ERRC,A                          048632
     C                     MOVEL'DLM0037' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     ELSE
     C           HISKY2    READEHIST4                    98
     C           *IN98     IFEQ ON
     C                     MOVE OFF       HISREC
     C                     MOVE ON        *IN50
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '034'     ERRC,A                          048632
     C                     MOVEL'DLM0037' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C***********          ELSE                                           S01390
     C***********                                                         S01390
     C*****CHECK*CUSTOMER*RECORDS*ON*CLIENT*FILE.*************************S01390
     C***********                                                         S01390
     C***********          MOVE 'A'       CLKY02                          S01390
     C***********          MOVE HCNUM     CLKY01                          S01390
     C***********CLTKY     CHAINCLINT                98                   S01390
     C************IN98     IFEQ ON                                        S01390
     C***********          MOVE ON        *IN50                           S01390
     C***********          MOVE '034'     ERRC,A                          S01390
     C***********          ADD  1         A                               S01390
     C***********          END                                            S01390
     C                     END
     C                     END
     C                     END
     C*
     C*    CHECK CUSTOMER IS NOT A PARENT
     C*
     C           *IN50     IFEQ OFF
     C***********          TESTB'2'       CMIN           50               S01390
     C           BBPAIN    IFEQ 'P'                                       S01390
     C                     SETON                     50                   S01390
     C                     END                                            S01390
     C           *IN50     IFEQ ON
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '036'     ERRC,A                          048632
     C                     MOVEL'DLM0037' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     END
     C                     END
     C*
     C*    VALIDATE DEAL NUMBER
     C*
     C*    DEAL NO. - NON MANDATORY.
     C*             - MUST BE NUMERIC.
     C*             - MUST EXIST ON THE DEALS FILE AND HISTORY FILE FOR
     C*               THE CUSTOMER NUMBER SELECTED.
     C*
     C*
     C*    CHECK DEAL NO. IS NUMERIC.
     C*
     C           DEALNO    IFNE *BLANKS
     C                     TESTN          DEALNO     6263                 053074
     C           *IN62     IFEQ '0'                                       053074
     C           *IN63     ANDEQ'0'                                       053074
     C***********          MOVE *BLANKS   ZFIELD                          053074
0458 C***********          MOVE DEALNO    ZFIELD                          053074
0459 C***********          EXSR ZALIGN                                    053074
0460 C************IN99     IFEQ ON                                        053074
     C                     MOVE ON        *IN53
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '022'     ERRC,A                          048632
     C                     MOVEL'DLM0022' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     END
     C*
     C*    CHECK DEAL NO EXISTS ON HISTORY FILE FOR CUSTOMER NUMBER ENTERED
     C*
     C           *IN52     IFEQ OFF
     C           *IN50     ANDNEON
     C                     MOVE HCNUM     HISK01
     C                     MOVE DEALNO    HISK02
     C                     MOVE ON        HISREC
     C           HISKY1    SETLLHIST4                    99
     C           *IN99     IFEQ ON
     C           HISKY1    READEHIST4                    99
     C                     END
     C           *IN99     IFEQ ON
     C                     MOVE OFF       HISREC
     C                     MOVE ON        *IN53
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '024'     ERRC,A                          048632
     C                     MOVEL'DLM0024' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     END
     C                     END
     C                     END
     C*
     C*    VALIDATE DEPOSIT/LOAN INDICATOR FIELD
     C*
     C*    DEPOSIT/LOAN INDICATOR - NOT MANDATORY.
     C*                           - MUST BE 'D', 'L' OR BLANK.
     C*                           - DOES NOT MATCH TYPE OF SELECTED DEAL NO.
     C*
     C           DLIND     IFNE *BLANK
     C           DLIND     ANDNE'D'
     C           DLIND     ANDNE'L'
     C***********          MOVE '137'     ERRC,A
     C                     MOVEL'DLM0137' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     MOVE ON        *IN51
     C                     MOVE ON        *IN56                           048632
     C                     END
     C*
     C*    CHECK DEPOSIT/LOAN INDICATOR MATCHES DEAL TYPE OF DEAL NO INPUT
     C*
     C           DLIND     IFNE *BLANK
     C           *IN51     ANDNEON
     C           DEALNO    ANDNE*BLANK
     C           *IN53     ANDNEON
     C*
     C           DLIND     IFEQ 'L'
     C***********DTYP      LOKUPLONT                     99               092304
     C***********DTYP      IFEQ 'CL'                                092304152851
     C***********          MOVE ON        *IN99                     092304152851
     C***********          END                                      092304152851
     C           DTYP      LOKUPLONT                     99               152851
     C                     ELSE
     C***********DTYP      LOKUPDEPT                     99               092304
     C***********DTYP      IFEQ 'CD'                                092304152851
     C***********          MOVE ON        *IN99                     092304152851
     C           DTYP      LOKUPDEPT                     99               152851
     C***********          END                                      092304152851
     C                     END
     C*
     C           *IN99     IFNE ON
     C***********          MOVE '138'     ERRC,A                          048632
     C                     MOVEL'DLM0138' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     MOVE ON        *IN51
     C                     MOVE ON        *IN56                           048632
     C                     END
     C                     END
     C*
     C*    VALIDATE CURRENCY CODE
     C*
     C*    CURRENCY - NON MANDATORY.
     C*             - MUST BE A VALID DEALING CURRENCY.
     C*             - MUST MATCH CURRENCY OF SELECTED DEAL NO.
     C*
     C           CCYINP    IFNE *BLANK
     C***********          MOVE *BLANKS   TABKY                           S01390
     C***********          MOVE '20'      TABKY1                          S01390
     C***********          MOVE CCYINP    TABKY2                          S01390
     C***********          MOVE '1'       TABKY3                          S01390
     C***********TABKY     CHAINTABDLEE              52                   S01390
     C                     CALL 'AOCURRR0'                                S01390
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM '*KEY   ' OPTN                            S01390
     C                     PARM CCYINP    KYCY    3                       S01390
     C           SDCURR    PARM SDCURR    DSSDY                           S01390
     C************IN52     IFEQ ON                                        S01390
     C           RTCD      IFNE *BLANKS                                   S01390
     C                     SETON                     52                   S01390
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '109'     ERRC,A                          048632
     C                     MOVEL'DLM0109' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     ELSE
     C                     MOVE A6CYCD    CCYINP                          046953
     C*
     C*    CURRENCY MUST BE SAME AS CURRENCY OF DEAL NO. IF SELECTED.
     C*
     C           DEALNO    IFNE *BLANKS
     C           *IN53     ANDNEON
     C           CCYINP    IFNE CCY
     C***********          MOVE '110'     ERRC,A
     C                     MOVEL'DLM0110' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     MOVE ON        *IN52
     C                     MOVE ON        *IN56                           048632
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C*    VALIDATE FROM DATE IF INPUT
     C*
     C*    FROM DATE - NON MANDATORY
     C*              - MUST BE IN VALID DATE FORMAT
     C*              - MUST NOT BE LATER THAN RUNDATE
     C*
     C                     MOVE *BLANKS   FRDATE
     C                     Z-ADD*ZERO     FRDAYN
     C           FRDTIN    IFNE *BLANKS
     C                     MOVE FRDTIN    DATE    6
     C                     EXSR DATCHK
     C           *IN99     IFEQ ON
     C                     MOVE ON        *IN54
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '026'     ERRC,A
     C                     MOVEL'DLM0026' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     ELSE
     C                     MOVE ZDAYNO    FRDAYN  50
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    FRDATE
     C*
     C*    FROM DATE MUST BE BEFORE RUN DATE
     C*
     C***********FRDAYN    IFGT RUND                                      S01390
     C           FRDAYN    IFGT BJRDNB                                    S01390
     C***********          MOVE '027'     ERRC,A
     C                     MOVEL'DLM0027' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     MOVE ON        *IN54
     C                     MOVE ON        *IN56                           048632
     C                     END
     C                     END
     C                     ELSE
     C                     MOVE ' START ' FRDATE
     C                     Z-ADD*LOVAL    FRDAYN
     C                     END
     C*
     C*    VALIDATE TO DATE IF INPUT
     C*
     C*    TO DATE - NON MANDATORY
     C*            - MUST BE IN A VALID FORMAT
     C*            - MUST NOT BE LATER THAN RUNDATE
     C*            - MUST BE EARLIER THAN FROM DATE
     C*
     C                     MOVE *BLANKS   TODATE
     C                     Z-ADD*ZERO     TODAYN
     C           TODTIN    IFNE *BLANKS
     C                     MOVE TODTIN    DATE    6
     C                     EXSR DATCHK
     C                     MOVE ZDAYNO    TODAYN  50
     C           *IN99     IFEQ ON
     C                     MOVE ON        *IN55
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '036'     ERRC,A                          048632
     C                     MOVEL'DLM0028' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     ELSE
     C                     MOVE ZDAYNO    TODAYN  50
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    TODATE
     C*
     C*    TO DATE MUST BE BEFORE RUN DATE
     C*
     C***********TODAYN    IFGT RUND                                      S01390
     C           TODAYN    IFGT BJRDNB                                    S01390
     C***********          MOVE '037'     ERRC,A                          048632
     C                     MOVEL'DLM0029' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     MOVE ON        *IN55
     C                     MOVE ON        *IN56                           048632
     C                     END
     C                     END
     C                     ELSE
     C                     MOVE '  END  ' TODATE
     C                     Z-ADD*HIVAL    TODAYN
     C                     END
     C*
     C*    TO DATE MUST BE LATER THAN THE FROM DATE
     C*
     C           FRDAYN    IFNE *ZERO
     C           TODAYN    ANDNE*ZERO
     C           FRDAYN    ANDGETODAYN
     C                     MOVE ON        *IN55
     C                     MOVE ON        *IN56                           048632
     C***********          MOVE '038'     ERRC,A
     C                     MOVEL'DLM0030' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     END
     C***********                                                         048632
     C*****MOVE*ERROR CODES TO SCREEN DISPLAY                             048632
     C***********                                                         048632
     C***********          MOVEAERRC      ERRMSG                          048632
     C*
     C           ENDVS1    ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    FORMAT SCREEN 2 HEADER DETAILS
     C*
     C           FMTHDR    BEGSR
     C*
     C                     MOVE *BLANKS   DEPLON
     C***********          MOVE CRNM      CNAME                           S01390
     C***********          MOVE CSNM      SHORTN                          S01390
     C                     MOVE BBCRNM    CNAME                           S01390
     C                     MOVE BBCSSN    SHORTN                          S01390
     C           DLIND     IFEQ 'D'
     C                     MOVEL'DEPOSITS'DEPLON
     C                     END
     C           DLIND     IFEQ 'L'
     C                     MOVEL'LOANS   'DEPLON
     C                     END
     C           DLIND     IFEQ *BLANK
     C                     MOVEL'ALL DEAL'DEPLON
     C                     MOVE 'S'       DEPLON
     C                     END
     C*
     C*    MOVE WAIT MESSAGE ONTO LAST LINE
     C*
     C                     MOVE REC1,1    OMSG
     C*
     C                     Z-ADD*ZERO     OINT   130
     C                     Z-ADD*ZERO     RINT   130
     C                     Z-ADD*ZERO     RFEE   130
     C                     ENDSR
     C*
     C**********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    READ VALID HISTORY RECORDS
     C*
     C           READHR    BEGSR
     C*
     C                     MOVE OFF       HISREC
     C                     MOVE OFF       *IN07
     C                     MOVE OFF       *IN14
     C*
     C           HISREC    DOUEQON
     C           *IN07     OREQ ON
     C*
     C           HISKY2    READEHIST4                    07
     C*
     C           OREC      IFEQ NREC                                                        MD025769
     C           ORTYP     IFEQ RTYP                                                        MD025769
     C           MDAT      IFLT BJRDNB                                                      MD025769
     C                     Z-ADDMDAT      NXTDAT                                            MD025769
     C                     ELSE                                                             MD025769
     C                     MOVE ON        *IN14                                             MD025769
     C                     ENDIF                                                            MD025769
     C                     ENDIF                                                            MD025769
     C                     GOTO ENDRED                                                      MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C*    IF LAST RECORD READ THEN END READ LOOP
     C*
     C           *IN07     IFEQ ON
     C                     MOVE ON        *IN14
     C                     GOTO ENDRED
     C                     END
     C*
     C                     MOVE ON        HISREC
     C*
     C*    CHECK FOR CHANGE OF DEAL NUMBER                             PUT
     C*
     C           DLNO      IFNE ODLNO
     C                     MOVE ON        *IN14
     C                     END
     C*
     C*    CHECK THAT RECORD DEAL NUMBER MATCHES THAT OF DEAL NUMBER INPUT
     C*
     C                     MOVE DLNO      HDLNO   6
     C           DEALNO    IFNE *BLANKS
     C           DEALNO    ANDNEHDLNO
     C                     MOVE OFF       HISREC
     C                     GOTO ENDRED
     C                     END
     C*
     C*    CHECK THAT RECORD CURRENCY MATCHES CURRENCY INPUT
     C*
     C           CCYINP    IFNE *BLANKS
     C           CCYINP    ANDNECCY
     C                     MOVE OFF       HISREC
     C                     GOTO ENDRED
     C                     END
     C*
     C*    CHECK THAT DEAL TYPE MATCHES THAT OF DEAL TYPE INPUT
     C*
     C           DLIND     IFEQ 'L'
     C***********DTYP      ANDNE'CL'                                092304152851
     C***********DTYP      LOKUPLONT                     99               092304
     C************IN99     IFNE ON                                        092304
     C           DTYP      LOKUPLONT                     99               152851
     C           *IN99     IFNE ON                                        152851
     C                     MOVE OFF       HISREC
     C                     GOTO ENDRED
     C***********          END                                            092304
     C                     END                                            152851
     C                     END
     C*
     C           DLIND     IFEQ 'D'
     C***********DTYP      ANDNE'CD'                                092304152851
     C***********DTYP      LOKUPDEPT                     99               092304
     C************IN99     IFNE ON                                        092304
     C           DTYP      LOKUPDEPT                     99               152851
     C           *IN99     IFNE ON                                        152851
     C                     MOVE OFF       HISREC
     C                     GOTO ENDRED
     C***********          END                                            092304
     C                     END                                            152851
     C                     END
     C*                                                                   053074
     C** Check that record type 'OB' follows an 'IP' record               053074
     C*                                                                   053074
     C           *IN14     IFEQ OFF                                       092574
     C           RTYP      IFEQ 'OB'                                      053074
     C           SAVTYP    ANDNE'IP'                                      053074
     C           SAVTYP    ANDNE*BLANKS                                   199975
     C                     MOVE OFF       HISREC                          053074
     C                     GOTO ENDRED                                    053074
     C                     END                                            053074
     C                     END                                            092574
     C*
     C*    CHECK THAT DATE FALLS BETWEEN THE DATES INPUT
     C*
     C           EDAT      IFLT FRDAYN
     C                     MOVE OFF       HISREC
     C                     GOTO ENDRED
     C                     END
     C*
     C           EDAT      IFGT TODAYN
     C                     MOVE OFF       HISREC
     C                     END
     C*
     C*    END READ LOOP
     C*
     C                     MOVE ON        SELCT
     C*                                                                   053074
     C                     MOVE RTYP      SAVTYP  2                       053074
     C*
     C           ENDRED    TAG
     C                     END
     C*
     C                     ENDSR
     C*
     C**********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    DATE CHECK SUBROUTINE. CHECKS THAT DATE ENTERED BEFORE RUN DATE
     C*
     C           DATCHK    BEGSR                           ***  DATCHK   ***
     C*
     C                     MOVE OFF       *IN99
0454 C                     Z-ADD0         ZADEC
 455 C                     Z-ADD6         ZADIG
0456 C                     MOVE '        'ZFIELD
0457 C                     MOVEL'        'ZFIELD
0458 C                     MOVE DATE      ZFIELD
0459 C                     EXSR ZALIGN
     C           *IN99     IFEQ OFF
     C                     MOVE DATE      ZDATE
     C***********DATF      COMP 'M'                      98               S01390
     C           BJDFIN    COMP 'M'                      98               S01390
     C                     EXSR ZDATE1
     C                     END
     C*
     C*    DATE INPUT MUST BE LESS THAN RUN DATE
     C*
     C***********ZDAYNO    IFGE RUND                                      S01390
     C           ZDAYNO    IFGE BJRDNB                                    S01390
     C                     MOVE ON        *IN99
     C                     END
     C*
     C                     ENDSR                           ** END DATCHK ***
     C*
     C**********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*      PROCSS SR  FORMAT PREVIOUS EVENT RECORD.
     C*
     C           PROCSS    BEGSR                           *** PROCSS ***
     C*
     C*    IF LAST EVENT FOR DEAL USE RUND AS NEXT EVENT DATE
     C*
     C           *IN14     IFEQ ON
     C***********          Z-ADDRUND      NXTDAT  50                      S01390
     C***********TODAYN    IFLT RUND                                      S01390
     C                     Z-ADDBJRDNB    NXTDAT  50                      S01390
     C           TODAYN    IFLT BJRDNB                                    S01390
     C                     Z-ADDTODAYN    NXTDAT
     C                     END
     C                     ELSE
     C           OINTC     IFEQ 'F'                                       085050
     C                     Z-ADDOMDAT     NXTDAT                          085050
     C                     ELSE                                           085050
     C                     Z-ADDEDAT      NXTDAT
     C                     END                                            085050
     C                     END
     C*
     C*    BLANK OUT AMOUNT HOLDING FIELDS
     C*
     C                     MOVE *BLANKS   HAMT   20
     C                     MOVE *BLANKS   HBAL   20
     C                     MOVE *BLANKS   HINT   20
      *                                                                                     MD027602
     C           ORTYP     IFEQ 'SC'                                                        MD027602
     C                     Z-ADDONRAT     SAVRAT 138                                        MD027602
     C                     Z-ADDODLNO     SAVDLN  60                                        MD027602
     C                     ENDIF                                                            MD027602
     C**********                                                                     053074 MD025769
     C***Make*'OB'*record*same*Event*Date*as*'IP'*for*enquiry*to**********           053074 MD025769
     C***correct*interest*calculation.************************************           053074 MD025769
     C**********                                                                     053074 MD025769
     C********** ORTYP     IFEQ 'OB'                                                 053074 MD025769
     C**********           SUB  1         OEDAT                                      053074 MD025769
      *                                                                                     MD027602
     C           ODLNO     IFEQ SAVDLN                                                      MD027602
     C                     Z-ADDSAVRAT    ONRAT                                             MD027602
     C                     ENDIF                                                            MD027602
     C**********           END                                                       053074 MD025769
     C*
     C*    FORMAT EVENT DATE.
     C*
     C                     Z-ADDOEDAT     WDATE   50                                        MD024870
     C                     Z-ADDOEDAT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    ODATE
     C*
     C*
     C*    GET CURRENCY DECIMAL PLACES
     C*
     C***********          MOVE *BLANKS   TABKY                           S01390
     C***********          MOVE '20'      TABKY1                          S01390
     C***********          MOVE OCCY      TABKY2                          S01390
     C***********          MOVE '1'       TABKY3                          S01390
     C***********TABKY     CHAINTABDLEE              99                   S01390
     C                     CALL 'AOCURRR0'                                S01390
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM '*KEY   ' OPTN                            S01390
     C                     PARM OCCY      KYCY    3                       S01390
     C           SDCURR    PARM SDCURR    DSSDY                           S01390
     C************IN99     IFEQ ON                                        S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELTABKY     DBKEY                           S01390
     C***********          MOVE '02'      DBASE                           S01390
     C           RTCD      IFNE *BLANKS                                   S01390
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'SDCURRPD'DBFILE                          S01390
     C                     MOVELOCCY      DBKEY                           S01390
     C                     Z-ADD2         DBASE                           S01390
     C                     OUT  LDA                                       S01390
     C                     MOVE ON        *INU7
     C                     MOVE ON        *INU8
     C                     END
     C***********          Z-ADDCDP       ZDEC                            S01390
     C                     Z-ADDA6NBDP    ZDEC                            S01390
     C*
     C*    NARRATIVE.
     C*
     C                     MOVE *BLANKS   ONARRA
     C                     Z-ADD1         X       20
     C           ORTYP     LOKUPNRTP,X                   50
     C                     MOVELNRDS,X    ONARRA
     C*
     C* CHECK IF DEAL TYPE A LOAN ORA DEPOSIT
     C*
     C                     MOVE *BLANK    DLFLAG  1
     C***********ODTYP     LOKUPLONT                     99               092304
     C************IN99     IFEQ ON                                        092304
     C***********ODTYP     IFEQ 'CL'                                092304152851
     C           ODTYP     LOKUPLONT                     99               152851
     C           *IN99     IFEQ ON                                        152851
     C                     MOVE 'L'       DLFLAG
     C           ORTYP     IFEQ 'LD'
     C                     MOVE *BLANKS   ONARRA
     C                     MOVEL'LOAN'    ONARRA
     C                     END
     C                     ELSE                                           092304
     C***********ODTYP     LOKUPDEPT                     99               092304
     C************IN99     IFEQ ON                                        092304
     C***********ODTYP     IFEQ 'CD'                                092304152851
     C           ODTYP     LOKUPDEPT                     99               152851
     C           *IN99     IFEQ ON                                        152851
     C                     MOVE 'D'       DLFLAG
     C                     END
     C                     END
     C*
     C*    LOAN PROCESSING
     C*
     C           DLFLAG    IFEQ 'L'
     C*
     C*    PROCESSING FOR RECORD TYPE LD (LODGEMENT), IB
     C*       (INTERIM BALANCE) OR OB (OPENING BALANCE).
     C*
     C           ORTYP     IFEQ 'LD'
     C           ORTYP     OREQ 'IB'
     C           ORTYP     OREQ 'OB'
     C                     EXSR PROCOB
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE PI (PRINCIPLE INCREASE)
     C*
     C           ORTYP     IFEQ 'PI'
     C                     EXSR PROCPI
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE PD (PRINCIPLE DECREASE)
     C*
     C           ORTYP     IFEQ 'PD'
     C                     EXSR PROCPD
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE IA (INTEREST ADJUSTMENT)
     C*
     C           ORTYP     IFEQ 'IA'
     C                     EXSR PROCIA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE FA (SERVICE CHARGES)
     C*
     C           ORTYP     IFEQ 'FA'
     C                     EXSR PROCFA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE SC (RATE RENEGOTIATION)
     C*
     C           ORTYP     IFEQ 'SC'
     C                     EXSR PROCSC
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE MA (MATUTITY)
     C*
     C           ORTYP     IFEQ 'MA'
     C                     EXSR PROCMA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE IP (INTEREST PAYMENT)
     C*
     C           ORTYP     IFEQ 'IP'
     C                     EXSR PROCIP
     C/COPY WNCPYSRC,DL9100C007
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE CB (CLOSING BALANCE)
     C*
     C           ORTYP     IFEQ 'CB'
     C                     EXSR PROCCB
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE RO (ROLLOVER)
     C*
     C           ORTYP     IFEQ 'RO'
     C                     EXSR PROCRO
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*  DEPOSIT PROCESSING
     C*
     C           DLFLAG    IFEQ 'D'
     C*
     C*    PROCESSING FOR RECORD TYPE LD (LODGEMENT), IB
     C*       (INTERIM BALANCE) OR OB (OPENING BALANCE).
     C*
     C           ORTYP     IFEQ 'LD'
     C           ORTYP     OREQ 'IB'
     C           ORTYP     OREQ 'OB'
     C                     EXSR PRDCOB
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE PI (PRINCIPLE INCREASE)
     C*
     C           ORTYP     IFEQ 'PI'
     C                     EXSR PRDCPI
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE PD (PRINCIPLE DECREASE)
     C*
     C           ORTYP     IFEQ 'PD'
     C                     EXSR PRDCPD
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE IA (INTEREST ADJUSTMENT)
     C*
     C           ORTYP     IFEQ 'IA'
     C                     EXSR PRDCIA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE FA (SERVICE CHARGE ADJUSTMENT)
     C*
     C           ORTYP     IFEQ 'FA'
     C                     EXSR PRDCFA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE FD (SERVICE CHARGES)
     C*
     C           ORTYP     IFEQ 'FD'
     C                     EXSR PRDCFD
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE SC (RATE RENEGOTIATION)
     C*
     C           ORTYP     IFEQ 'SC'
     C                     EXSR PRDCSC
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE TX (WITHHOLDING TAX)
     C*
     C           ORTYP     IFEQ 'TX'
     C           ORTYP     OREQ 'EU'                                                          CGL031
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP1                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** CER048    IFEQ 'Y'                                                BUG26296 MD024870
     C           CER048    OREQ 'Y'                                                         MD024870
     C           ORTYP     ANDEQ'ST'                                                        BUG26296
     C           CER054    OREQ 'Y'                                                         BUG26296
     C           ORTYP     ANDEQ'CT'                                                        BUG26296
     C                     EXSR PRDCTX
     C**********           ENDIF                                                   BUG26296 MD024870
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE MA (MATUTITY)
     C*
     C           ORTYP     IFEQ 'MA'
     C                     EXSR PRDCMA
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE IP (INTEREST PAYMENT)
     C*
     C           ORTYP     IFEQ 'IP'
     C                     EXSR PRDCIP
     C/COPY WNCPYSRC,DL9100C008
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE CB (CLOSING BALANCE)
     C*
     C           ORTYP     IFEQ 'CB'
     C                     EXSR PRDCCB
     C                     ELSE
     C*
     C*    PROCESSING FOR RECORD TYPE RO (ROLLOVER)
     C*
     C           ORTYP     IFEQ 'RO'
     C                     EXSR PRDCRO
     C/COPY WNCPYSRC,DL9100CP33                                           S01408
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C                     END
     C*
     C                     END
      *                                                                                    AR1055654
     C           CDL088    IFEQ 'Y'                                                        AR1055654
      *                                                                                    AR1055654
     C           DLFLAG    IFNE 'L'                                                        AR1055654
     C           DLFLAG    ANDNE'D'                                                        AR1055654
     C           ORTYP     ANDEQ'SC'                                                       AR1055654
     C                     EXSR PROCSC                                                     AR1055654
     C                     ENDIF                                                           AR1055654
      *                                                                                    AR1055654
     C                     ENDIF                                                           AR1055654
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*
     C*    DLBRK SR. SET UP NEW DEAL INFORMATION.
     C*
     C           DLBRK     BEGSR                           *** DLBRK  ***
     C*
     C*    SAVE VALUES IF START DATE ENTERED
     C*
     C           FRDAYN    IFNE *LOVAL
     C***********          MOVE OBAL      BBAL   13                       114447
     C**********           MOVE OBAL      BBAL   14                                    114447 253911
     C                     MOVE OBAL      BBAL   18                                           253911
     C                     MOVE OINTR     BINTR  13
     C                     MOVE BAL       BBALH  20
     C                     MOVE INTR      BINTH  20
     C                     MOVE ORATE     BRATE   85
     C                     MOVE ODAYS     BDAYS   30
     C                     END
     C*
     C*    CLEAR SUBFILE FIELDS
     C*
     C                     MOVE *BLANKS   RECORD
     C                     Z-ADD*ZERO     ODAYS
     C                     Z-ADD*ZERO     ORATE
     C*
     C           *IN07     IFEQ OFF
     C                     MOVE CCY       OCCY
     C                     MOVEL'DEAL'    ONARRA
     C                     MOVE DLNO      ONARRA
     C                     ADD  1         RRN
     C                     ADD  1         RRND                            085050
     C                     WRITESUBR01
     C                     OPEN HISTEAA                                   073175
     C                     WRITEHISTEAAF                                  S01390
     C                     CLOSEHISTEAA                                   073175
     C                     MOVE *BLANKS   ONARRA
     C*                                                                   085050
     C** Write the currency of the deal                                   085050
     C                     MOVE CCY       ONARRA                          085050
     C                     ADD  1         RRND                            085050
     C                     WRITESUBR01                                    085050
     C                     MOVE *BLANKS   ONARRA                          085050
     C*                                                                   085050
     C********** TERM      IFEQ '99R'                                                       MD025769
     C*      PRINT 'FXD-NNAAANN'
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    MDATE   7
     C                     MOVEL'FXD -'   ONARRA
     C                     MOVE MDATE     ONARRA
     C**********           ELSE                                                             MD025769
     C*                                                                   132635
     C** Check if it is an Australian market and currency used is AUD     132635
     C*                                                                   132635
     C           CCY       IFEQ 'AUD'                                     132635
     C           BJCYCD    ANDEQ'AUD'                                     132635
     C                     MOVEL'TERM'    ONARRA
     C           TERM      IFEQ '000'
     C                     MOVE '11AM  '  ONARRA
     C                     ELSE
     C           TERM      IFEQ '001'
     C                     MOVE '24HR  '  ONARRA
     C                     ELSE
     C                     MOVE TERM      ONARRA
     C                     END
     C                     END
     C                     END                                            132635
     C**********           END                                                              MD025769
     C                     ADD  1         RRN
     C                     ADD  1         RRND                            085050
     C                     WRITESUBR01
     C                     OPEN HISTEAA                                   073175
     C                     WRITEHISTEAAF                                  S01390
     C                     CLOSEHISTEAA                                   073175
     C                     END
     C                     MOVE *BLANKS   ONARRA
     C           FRDAYN    IFNE *LOVAL
     C           FSTFLG    ANDEQON
     C           DLNO      ANDEQODLNO
     C                     MOVE *BLANKS   ONARRA
     C                     MOVEL'B/FWD'   ONARRA
     C                     MOVELFRDATE    ODATE
     C                     MOVE *BLANKS   AMT
     C                     MOVE *BLANKS   OAMT
     C                     MOVE BBAL      OBAL
     C**********           MOVE BINTR     OINTR                           199975
     C                     MOVE *BLANKS   OINTR                           199975
     C                     MOVE BRATE     ORATE
     C**********           MOVE BDAYS     ODAYS                           199975
     C                     Z-ADD*ZEROS    ODAYS                           199975
     C                     MOVE BBALH     BAL
     C                     MOVE BINTH     INTR
     C                     ADD  1         RRN
     C                     ADD  1         RRND                            085050
     C                     WRITESUBR01
     C                     OPEN HISTEAA                                   073175
     C                     WRITEHISTEAAF                                  S01390
     C                     CLOSEHISTEAA                                   073175
     C                     END
     C/COPY WNCPYSRC,DL9100CCP8                                           S01408
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCOB SR. PROCESS LODGEMNT OR OPENING BALENCE RECORD.
     C*
     C           PROCOB    BEGSR                           *** PROCOB ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           ORTYP     IFEQ 'LD'                                      084838
     C           ORTYP     OREQ 'OB'                                      128425
     C                     MOVE OEAMT     ZNUMIN
     C                     ELSE                                           084838
     C                     MOVE RBAL      ZNUMIN                          084838
     C                     END                                            084838
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT             IN CASE RESET  E36383
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C           ORTYP     IFEQ 'LD'                                      084838
     C           ORTYP     OREQ 'OB'                                      128425
     C                     Z-ADDOEAMT     RBAL
     C                     MOVE OEAMT     ZNUMIN
     C                     ELSE                                           084838
     C                     MOVE RBAL      ZNUMIN                          084838
     C                     END                                            084838
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL             IN CASE RESET  E36383
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'OB'                                                        MD025769
     C           ORATE     ANDEQ*ZERO                                                       MD025769
      *                                                                                     MD025769
     C           DLNO      CHAINDEALALL              45                                     MD025769
     C           *IN45     IFEQ '0'                                                         MD025769
     C           DRECI     ANDEQ'D'                                                         MD025769
     C                     Z-ADDDINTR     ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
     C                     ENDIF                                                            MD025769
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CCP9                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
     C*                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C/COPY WNCPYSRC,DL9100C004
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP10                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C                     Z-ADDZINTR     WKINT  130H                     S01390
     C                     ADD  WKINT     DINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C                     MOVE WKINT     WTMP                                              MD025769
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
      *                                                                   186258
      ** Store deal's maturity date.                                      186258
      *                                                                   186258
     C           ORTYP     IFEQ 'LD'                                      186258
     C           ORTYP     OREQ 'OB'                                      186258
     C                     Z-ADDOMDAT     MDATC   50                      186258
     C                     ENDIF                                          186258
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCPI SR. PROCESS PRINCIPLE INCREASE RECORD.
     C*
     C           PROCPI    BEGSR                           *** PROCPI ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     ADD  OEAMT     RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           MDATC     IFLT NXTDAT                                    186258
     C           MDATC     ANDNE0                                         186258
     C                     Z-ADDMDATC     NXTDAT                          186258
     C                     ENDIF                                          186258
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP11                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
     C*
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP18                                           S01408
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     DINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCPD SR. PROCESS PRINCIPLE DECREASE RECORD.
     C*
     C           PROCPD    BEGSR                           *** PROCPD ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     SUB  OEAMT     RBAL
     C           RBAL      IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBRBAL      RBAL                            192749
     C                     MOVE 'A'       ZSIGN                           192749
     C                     END                                            192749
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP19                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP20                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     DINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCIA SR. PROCESS INTEREST ADJUSTMENT RECORD.
     C*
     C           PROCIA    BEGSR                           *** PROCIA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           OEAMT     IFLT 0
     C                     Z-SUBOEAMT     TMP130 130
     C                     MOVE TMP130    ZNUMIN
     C                     MOVE 'B'       ZSIGN
     C                     MOVE '-'       ZSIGNT
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE '1'       *IN88            IN CASE RESET  E36383
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    HAMT
     C                     ELSE
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     END
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP21                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP22                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  OEAMT     WKINT
     C                     ADD  WKINT     DINT
     C                     ELSE
     C                     Z-ADDOEAMT     WKINT
     C                     ADD  WKINT     DINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     ELSE
     C           WKINT     IFLT 0
     C                     MOVE '-'       ZSIGNT
     C                     Z-SUBWKINT     WKINT
     C                     END
     C                     END
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCFA SR. PROCESS SERVICE FEE RECORD.
     C*
     C           PROCFA    BEGSR                           *** PROCFA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE. (USE PREVOIUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP23                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP24                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     DINT
     C                     ADD  OEAMT     WKINT
     C                     ADD  OEAMT     DFEE
     C                     ELSE
     C                     Z-ADDOEAMT     WKINT
     C                     ADD  OEAMT     DFEE
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCSC SR. PROCESS RENOGIATION RECORD.
     C*
     C           PROCSC    BEGSR                           *** PROCSC ***
     C*
     C*    COMPLETE NARRITIVE.
     C*
     C*                                                                   097784
     C**  Check for Australian market                                     097784
     C*                                                                   097784
     C           CCY       IFEQ 'AUD'                                     097784
     C           BJCYCD    ANDEQ'AUD'                                     097784
     C           OTERM     IFEQ '000'
     C                     MOVE '11AM '   ONARRA
     C                     ELSE
     C           OTERM     IFEQ '001'
     C                     MOVE '24HR '   ONARRA
     C                     END
     C                     END
     C                     END                                            097784
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP25                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP26                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     DINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCMA SR. PROCESS MATURITY RECORD.
     C*
     C           PROCMA    BEGSR                           *** PROCMA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     Z-ADD0         RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                                            E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADD0         ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     MOVE *BLANKS   OINTR
     C                     MOVE *BLANKS   INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCIP SR. PROCESS INTEREST DUE/CAPITILISATION RECORD.
     C*
     C           PROCIP    BEGSR                           *** PROCIP ***
     C*
     C*    CAPITILISE INTEREST IF OINTC = Y AND DEAL NOT MATURED AT
     C*      THE TIME OF THIS INTEREST PAYMENT.
     C*
     C                     MOVE OFF       *IN40
     C           OINTC     IFEQ 'Y'
     C           OMDAT     IFEQ 0
     C           OMDAT     ORGT OEDAT
     C                     MOVE ON        *IN40
     C                     END
     C                     END
     C*
     C*    COMPLETE NARRITIVE.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE 'DUE    ' ONARRA
     C                     ELSE
     C                     MOVE 'CAP    ' ONARRA
     C                     END
     C*
     C*    UPDATE AMOUNT.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C                     ELSE
     C           OEAMT     IFLT 0                                         192749
     C                     Z-SUBOEAMT     TMP130                          192749
     C                     MOVE TMP130    ZNUMIN                          192749
     C                     MOVE 'B'       ZSIGN                           192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     ELSE                                           192749
     C                     MOVE OEAMT     ZNUMIN
     C                     END                                            192749
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     END
     C*
     C*    UPDATE BALANCE.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE *BLANKS   OBAL
     C                     MOVE *BLANKS   BAL
     C                     ELSE
     C                     ADD  OEAMT     RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C                     END
     C*
     C*    UPDATE RATE.
     C*
     C           *IN40     IFEQ OFF
     C                     Z-ADD0         ORATE
     C                     ELSE
     C                     Z-ADDONRAT     ORATE
     C                     END
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     SUB  RESIDU    OEAMT
     C                     SUB  RESIDU    DINT                            E99998
     C                     ADD  OEAMT     OINT
     C           OEAMT     IFLT 0                                                           MD031577
     C                     MULT -1        OEAMT                                             MD031577
     C                     MOVE OEAMT     ZNUMIN
     C                     MULT -1        OEAMT                                             MD031577
     C                     ELSE                                                             MD031577
     C                     MOVE OEAMT     ZNUMIN                                            MD031577
     C                     ENDIF                                                            MD031577
     C                     MOVE 'A'       ZSIGN
     C           OEAMT     IFNE 0
     C           *IN40     IFEQ OFF
     C                     MOVE '-'       ZSIGNT
     C                     ELSE
     C                     MOVE '+'       ZSIGNT
     C                     END
     C                     END
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ZNUMOT    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C*    IF INTEREST IS CAPITILISED THEN RESET INTEREST PAID
     C*
     C           *IN40     IFEQ ON
     C                     Z-ADD0         OINT
     C                     Z-ADD0         DINT
     C                     Z-ADD0         DFEE
     C                     END
     C                     MOVE OEAMT     ZNUMIN
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCCB SR. PROCESS CLOSING BALANCE RECORD.
     C*
     C           PROCCB    BEGSR                           *** PROCCB ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     Z-ADD0         WKINT
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCRO SR. PROCESS ROLLOVER RECORD.
     C*
     C           PROCRO    BEGSR                           *** PROCRO ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           OEAMT     IFGT OPCPL
     C                     Z-ADDOPCPL     RAMT
     C                     ELSE
     C                     Z-ADDOEAMT     RAMT
     C                     END
      *                                                                                     MD025769
     C           RAMT      IFGT 0                                                           MD025769
     C                     MOVE '+'       ZSIGNT                                            MD025769
     C                     MOVE 'A'       ZSIGN                                             MD025769
     C                     ENDIF                                                            MD025769
     C*                                                                                     MD025769
     C                     MOVE RAMT      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     MOVE *BLANKS   OBAL
     C                     MOVE *BLANKS   BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADD0         ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           OEAMT     IFGT OPCPL
     C           OEAMT     SUB  OPCPL     WKINT
     C                     ADD  WKINT     RESIDU
     C*                    MOVE '+'       ZSIGNT                          E99998
     C                     MOVE '-'       ZSIGNT                          E99998
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PROCOB SR. PROCESS LODGEMNT OR OPENING BALENCE RECORD.
     C*
     C           PRDCOB    BEGSR                           *** PROCOB ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           ORTYP     IFEQ 'LD'                                      084838
     C           ORTYP     OREQ 'OB'                                      128425
      *                                                                                       233276
     C           ORTYP     IFEQ 'LD'                                                          233276
     C                     MOVE '+'       ZSIGNT                                              233276
     C                     MOVE 'A'       ZSIGN                                               233276
     C                     ENDIF                                                              233276
      *                                                                                       233276
     C                     MOVE OEAMT     ZNUMIN
     C                     ELSE                                           084838
     C                     MOVE RBAL      ZNUMIN                          084838
     C                     END                                            084838
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C           ORTYP     IFEQ 'LD'                                      084838
     C           ORTYP     OREQ 'OB'                                      128425
     C                     Z-ADDOEAMT     RBAL
     C                     MOVE OEAMT     ZNUMIN
     C                     ELSE                                           084838
     C                     MOVE RBAL      ZNUMIN                          084838
     C                     END                                            084838
     C                     MOVE ' '       ZSIGN                                               233276
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'OB'                                                        MD025769
     C           ORATE     ANDEQ*ZERO                                                       MD025769
      *                                                                                     MD025769
     C           DLNO      CHAINDEALALL              45                                     MD025769
     C           *IN45     IFEQ '0'                                                         MD025769
     C           DRECI     ANDEQ'D'                                                         MD025769
     C                     Z-ADDDINTR     ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
     C                     ENDIF                                                            MD025769
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP12                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C/COPY WNCPYSRC,DL9100C005
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP27                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
      *                                                                                     MD025769
     C           FRCD      IFEQ ON                                                          MD025769
     C           RTYP      ANDEQ'OB'                                                        MD025769
     C                     Z-ADD*ZERO     ZIRATE                                            MD025769
     C                     MOVE OFF       FRCD                                              MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     RINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C                     MOVE RINT      WTMP                                              MD025769
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
      *                                                                                233276 248296
     C********** ORTYP     IFEQ 'LD'                                                   233276 248296
     C**********           MOVE *BLANKS   OINTR                                        233276 248296
     C**********           MOVE *BLANKS   INTR                                         233276 248296
     C**********           ENDIF                                                       233276 248296
      *                                                                   186258
      ** Store deal's maturity date.                                      186258
      *                                                                   186258
     C           ORTYP     IFEQ 'LD'                                      186258
     C           ORTYP     OREQ 'OB'                                      186258
     C                     Z-ADDOMDAT     MDATC                           186258
     C                     ENDIF                                          186258
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCPI SR. PROCESS PRINCIPLE INCREASE RECORD.
     C*
     C           PRDCPI    BEGSR                           *** PROCPI ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     ADD  OEAMT     RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           MDATC     IFLT NXTDAT                                    186258
     C           MDATC     ANDNE0                                         186258
     C                     Z-ADDMDATC     NXTDAT                          186258
     C                     ENDIF                                          186258
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP13                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP28                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     RINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCPD SR. PROCESS PRINCIPLE DECREASE RECORD.
     C*
     C           PRDCPD    BEGSR                           *** PROCPD ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     SUB  OEAMT     RBAL
     C           RBAL      IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     MOVE 'A'       ZSIGN                           192749
     C                     Z-SUBRBAL      RBAL                            192749
     C                     END                                            192749
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP14                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP29                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     RINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCIA SR. PROCESS INTEREST ADJUSTMENT RECORD.
     C*
     C           PRDCIA    BEGSR                           *** PROCIA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           OEAMT     IFLT 0
     C                     Z-SUBOEAMT     TMP130 130
     C                     MOVE TMP130    ZNUMIN
     C                     MOVE 'B'       ZSIGN
     C                     MOVE '-'       ZSIGNT
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     ELSE
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     END
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP15                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP5                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP30                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  OEAMT     WKINT
     C                     ADD  WKINT     RINT
     C                     ELSE
     C                     Z-ADDOEAMT     WKINT
     C                     ADD  WKINT     RINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     ELSE
     C           WKINT     IFLT 0
     C                     MOVE '-'       ZSIGNT
     C                     Z-SUBWKINT     WKINT
     C                     END
     C                     END
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCFA SR. PROCESS SERVICE CHARGE ADJUSTMENT RECORD.
     C*
     C           PRDCFA    BEGSR                           *** PRDCFA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           OEAMT     IFLT 0
     C                     Z-SUBOEAMT     TMP130 130
     C                     MOVE TMP130    ZNUMIN
     C                     MOVE 'B'       ZSIGN
     C                     MOVE '-'       ZSIGNT
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     ELSE
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     END
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP16                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP31                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     RINT
     C***********          ADD  OEAMT     WKINT                           E36401
     C                     ADD  OEAMT     RFEE
     C                     ELSE
     C***********          Z-ADDOEAMT     WKINT                           E36401
     C                     ADD  OEAMT     RFEE
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     ELSE
     C           WKINT     IFLT 0
     C                     MOVE '-'       ZSIGNT
     C                     Z-SUBWKINT     WKINT
     C                     END
     C                     END
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C*
     C                     MOVE ZNUMOT    INTR
     C                     ENDSR
     C*
     C/COPY WNCPYSRC,DL9100CP34                                           S01408
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCTX SR. PROCESS WITHHOLDING TAX RECORD.
     C*
     C           PRDCTX    BEGSR                           *** PROCTX ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    PRINT THE EVENT AMOUNT IN THE INTEREST FIELD.
     C*
     C                     Z-ADDOEAMT     WKINT
     C**********           MOVE '-'       ZSIGNT                                              233276
     C                     MOVE '+'       ZSIGNT                                              233276
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C                     MOVE ZNUMOT    OINTR
     C                     MOVE ZNUMOT    INTR
      *                                                                                     MD025769
      *    Get tax amount and tax rate                                                      MD025769
      *      Where Transaction type equals to 'TX'                                          MD025769
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'TX'                                                        MD025769
     C                     READ SDSTAAL1                 21                                 MD025769
     C           *IN21     IFEQ *OFF                                                        MD025769
     C                     MOVE WTMP      ZNUMIN                                            MD025769
      *                                                                                     MD025769
     C           WTMP      IFGT 0                                                           MD025769
     C                     MOVE '+'       ZSIGNT                                            MD025769
     C                     MOVE 'A'       ZSIGN                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C                     EXSR FORMAT                                                      MD025769
     C           *IN89     IFEQ '1'                                                         MD025769
     C                     MOVE ASTERX    OAMT                                              MD025769
     C                     ELSE                                                             MD025769
     C                     MOVE ZNUMOT    OAMT                                              MD025769
     C                     ENDIF                                                            MD025769
     C                     MOVE ZNUMOT    AMT                                               MD025769
      *                                                                                     MD025769
     C                     Z-ADDETXR1     ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
      *      where transaction type equal to 'EU', 'ST', 'CT'                               MD025769
      *                                                                                     MD025769
     C                     Z-ADD0         WTMP   150                                        MD025769
     C                     MOVEL*BLANKS   ZNUMIN                                            MD025769
      *                                                                                     MD025769
     C           ODLNO     SETLLSDCSINLD                                                    MD025769
     C           ODLNO     CHAINSDCSINLD             25                                     MD025769
     C           *IN25     IFEQ *OFF                                                        MD025769
      *                                                                                     MD025769
      *    If main tax                                                                      MD025769
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'EU'                                                        MD025769
     C                     MOVE TSGINT    ZNUMIN                                            MD025769
      *                                                                                     MD025769
     C                     MOVE OEAMT     WTMP                                              MD025769
     C           TSGINT    DIV  WTMP      WRATE  152H                                       MD025769
     C                     Z-ADDWRATE     ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
      *    If secondary tax                                                                 MD025769
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'ST'                                                        MD025769
     C                     MOVE TSTXSR    ZNUMIN                                            MD025769
     C                     Z-ADDTSSTRA    ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
      *    If third tax (Church tax)                                                        MD025769
      *                                                                                     MD025769
     C           ORTYP     IFEQ 'CT'                                                        MD025769
     C                     MOVE TSTXSR    ZNUMIN                                            MD025769
     C                     Z-ADDTSTTRA    ORATE                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C           ZNUMIN    IFNE *BLANKS                                                     MD025769
      *                                                                                     MD025769
     C                     MOVE ZNUMIN    WTMP                                              MD025769
     C           WTMP      IFGT 0                                                           MD025769
     C                     MOVE '+'       ZSIGNT                                            MD025769
     C                     MOVE 'A'       ZSIGN                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C                     EXSR FORMAT                                                      MD025769
     C           *IN89     IFEQ '1'                                                         MD025769
     C                     MOVE ASTERX    OAMT                                              MD025769
     C                     ELSE                                                             MD025769
     C                     MOVE ZNUMOT    OAMT                                              MD025769
     C                     ENDIF                                                            MD025769
     C                     MOVE ZNUMOT    AMT                                               MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCFD SR. PROCESS SERVICE FEE RECORD.
     C*
     C           PRDCFD    BEGSR                           *** PROCFD ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE. (USE PREVOIUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    PRINT THE EVENT AMOUNT IN THE INTEREST FIELD.
     C*
     C           OEAMT     IFLT 0                                         E36380
     C                     Z-SUBOEAMT     WKINT
     C                     MOVE '+'       ZSIGNT                          E36400
     C                     ELSE                                           E36380
     C                     Z-ADDOEAMT     WKINT                           E36380
     C                     MOVE '-'       ZSIGNT
     C                     END                                            E36380
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C                     MOVE ZNUMOT    OINTR
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCSC SR. PROCESS RENOGIATION RECORD.
     C*
     C           PRDCSC    BEGSR                           *** PROCSC ***
     C*
     C*    COMPLETE NARRITIVE.
     C*
     C*                                                                   097784
     C**  Check for Australian market                                     097784
     C*                                                                   097784
     C           CCY       IFEQ 'AUD'                                     097784
     C           BJCYCD    ANDEQ'AUD'                                     097784
     C           OTERM     IFEQ '000'
     C                     MOVE '11AM '   ONARRA
     C                     ELSE
     C           OTERM     IFEQ '001'
     C                     MOVE '24HR '   ONARRA
     C                     END
     C                     END
     C                     END                                            097784
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE. (USE PREVIOUS BALANCE)
     C*
     C                     MOVE SBAL      OBAL                            E36324
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C           NXTDAT    SUB  OEDAT     ODAYS
     C/COPY WNCPYSRC,DL9100CP17                                           S01408
     C*
     C           DLNO      IFEQ ODLNO                                                       MD025769
      *                                                                                     MD025769
     C*    IF NEXT RECORD TO PROCESS IS AN INTEREST PAYMENT (IP),
     C*      A WITHHOLDING TAX PAYMENT (TX) A SERVICE CHARGE (FD)
     C*      AND THE DEAL HAS NOT MATURED THEN INCREASE DAYS BY
     C*      1 TO INCLUDE THE MONTH END DAY.
     C*
     C           RTYP      IFEQ 'IP'
     C           RTYP      OREQ 'TX'
     C           RTYP      OREQ 'EU'                                                          233276
     C           RTYP      OREQ 'FD'
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,DL9100CCP7                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C********** OMDAT     IFEQ 0                                                           MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           ELSE                                                             MD026743
     C********** EDAT      IFLT OMDAT                                                       MD026743
     C**********           ADD  1         ODAYS                                             MD026743
     C**********           ADD  1         NXTDAT                                            MD026743
     C**********           END                                                              MD026743
     C**********           END                                                              MD026743
     C                     END
      *                                                                                     MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C/COPY WNCPYSRC,DL9100CP32                                           S01408
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           ODAYS     IFGT 0
     C                     Z-ADDOEDAT     ZIBEG
     C                     Z-ADDNXTDAT    ZIEND
     C                     Z-ADDRBAL      ZIAMT
     C                     MOVE OICBS     ZICALC
     C                     Z-ADDONRAT     ZIRATE
     C                     EXSR GLINTC
     C***********          Z-ADDZINTR     WKINT                    S01390 128425
     C                     Z-ADDZINTR     WKINT     H                     128425
     C                     ADD  WKINT     RINT
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C           WKINT     IFGT 0
     C                     MOVE '+'       ZSIGNT
     C                     END
     C           WKINT     IFLT 0                                         192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     Z-SUBWKINT     WKINT                           192749
     C                     END                                            192749
     C                     MOVE 'A'       ZSIGN
     C                     MOVE WKINT     ZNUMIN
     C                     EXSR FORMAT
     C                     MOVE ZNUMOT    OINTR
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCMA SR. PROCESS MATURITY RECORD.
     C*
     C           PRDCMA    BEGSR                           *** PROCMA ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C**********           MOVE OEAMT     ZNUMIN                                              233276
     C                     Z-ADDOEAMT     WKINT                                               233276
     C                     MOVE '-'       ZSIGNT                                              233276
     C                     MOVE 'A'       ZSIGN                                               233276
     C                     MOVE WKINT     ZNUMIN                                              233276
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     Z-ADD0         RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                                            E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADD0         ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     MOVE *BLANKS   OINTR
     C                     MOVE *BLANKS   INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCIP SR. PROCESS INTEREST DUE/CAPITILISATION RECORD.
     C*
     C           PRDCIP    BEGSR                           *** PROCIP ***
     C*
     C*    CAPITILISE INTEREST IF OINTC = Y AND DEAL NOT MATURED AT
     C*      THE TIME OF THIS INTEREST PAYMENT.
     C*
     C                     MOVE OFF       *IN40
     C           OINTC     IFEQ 'Y'
     C           OMDAT     IFEQ 0
     C           OMDAT     ORGT OEDAT
     C                     MOVE ON        *IN40
     C                     END
     C                     END
     C*
     C*    COMPLETE NARRITIVE.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE 'DUE    ' ONARRA
     C                     ELSE
     C                     MOVE 'CAP    ' ONARRA
     C                     END
     C*
     C*    UPDATE AMOUNT.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C                     ELSE
     C           OEAMT     IFLT 0                                         192749
     C                     Z-SUBOEAMT     TMP130                          192749
     C                     MOVE TMP130    ZNUMIN                          192749
     C                     MOVE 'B'       ZSIGN                           192749
     C                     MOVE '-'       ZSIGNT                          192749
     C                     ELSE                                           192749
     C                     MOVE OEAMT     ZNUMIN
     C                     END                                            192749
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C                     END
     C*
     C*    UPDATE BALANCE.
     C*
     C           *IN40     IFEQ OFF
     C                     MOVE *BLANKS   OBAL
     C                     MOVE *BLANKS   BAL
     C                     ELSE
     C                     ADD  OEAMT     RBAL
     C                     MOVE RBAL      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C                     END
     C*
     C*    UPDATE RATE.
     C*
     C           *IN40     IFEQ OFF
     C                     Z-ADD0         ORATE
     C                     ELSE
     C                     Z-ADDONRAT     ORATE
     C                     END
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     SUB  RESIDU    OEAMT
     C                     SUB  RESIDU    DINT                            E99998
     C                     ADD  OEAMT     OINT
     C*                    MOVE OEAMT     ZNUMIN                          E36576
     C                     Z-ADDOEAMT     WKINT                           E36576
     C                     MOVE 'A'       ZSIGN
      *                                                                                     MD024870
      ** Check if interest is Gross Interest Due                                            MD024870
      *                                                                                     MD024870
     C                     Z-ADD0         WKGINT                                            MD024870
     C           ODLNO     SETLLSDCSINLD                                                    MD024870
     C           ODLNO     READESDCSINLD                 20                                 MD024870
     C           *IN20     DOWEQ'0'                                                         MD024870
      *                                                                                     MD024870
     C           WDATE     IFEQ TSRDNB                                                      MD024870
     C           TSGINT    ADD  WKGINT    WKGINT 150                                        MD024870
     C                     ENDIF                                                            MD024870
      *                                                                                     MD024870
     C           ODLNO     READESDCSINLD                 20                                 MD024870
     C                     ENDDO                                                            MD024870
      *                                                                                     MD024870
     C           WKINT     IFEQ WKGINT                                                      MD024870
     C                     MOVELWNARRA    ONARRA                                            MD024870
     C                     ENDIF                                                            MD024870
      *                                                                                     MD024870
     C*          OEAMT     IFNE 0                                         E36576
     C           WKINT     IFGT 0                                         E36576
     C**         *IN40     IFEQ OFF                                       E36502
     C                     MOVE '-'       ZSIGNT
     C**                   ELSE                                           E36502
     C**                   MOVE '+'       ZSIGNT                          E36502
     C**                   END                                            E36502
     C                     ELSE                                           E36576
     C           WKINT     IFLT 0                                         E36576
     C                     MOVE '+'       ZSIGNT                          E36576
     C                     Z-SUBWKINT     WKINT                           E36576
     C                     END                                            E36576
     C                     END
     C                     MOVE WKINT     ZNUMIN                          E36576
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C*    IF INTEREST IS CAPITILISED THEN RESET INTEREST PAID
     C*
     C           *IN40     IFEQ ON
     C                     Z-ADD0         OINT
     C                     Z-ADD0         DINT
     C                     Z-ADD0         DFEE
     C                     END
     C                     MOVE OEAMT     ZNUMIN
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCCB SR. PROCESS CLOSING BALANCE RECORD.
     C*
     C           PRDCCB    BEGSR                           *** PROCCB ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C                     MOVE *BLANKS   OAMT
     C                     MOVE *BLANKS   AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     MOVE OEAMT     ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OBAL
     C                     ELSE
     C                     MOVE ZNUMOT    OBAL
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADDONRAT     ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C                     Z-ADD0         WKINT
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     MOVE ' '       ZSIGNT
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                            E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    PRDCRO SR. PROCESS ROLLOVER RECORD.
     C*
     C           PRDCRO    BEGSR                           *** PROCRO ***
     C*
     C*    UPDATE AMOUNT.
     C*
     C           OEAMT     IFGT OPCPL
     C                     Z-ADDOPCPL     RAMT
     C                     ELSE
     C                     Z-ADDOEAMT     RAMT
     C                     END
      *                                                                                     MD025769
     C           RAMT      IFGT 0                                                           MD025769
     C                     MOVE '+'       ZSIGNT                                            MD025769
     C                     MOVE 'A'       ZSIGN                                             MD025769
     C                     ENDIF                                                            MD025769
      *                                                                                     MD025769
     C                     MOVE RAMT      ZNUMIN
     C                     EXSR FORMAT
     C           *IN89     IFEQ '1'                        SAVE ERROR IND.E36383
     C                     MOVE ASTERX    OAMT
     C                     ELSE
     C                     MOVE ZNUMOT    OAMT
     C                     END                             BEFORE END SR. E36383
     C                     MOVE ZNUMOT    AMT
     C*
     C*    UPDATE BALANCE.
     C*
     C                     MOVE *BLANKS   OBAL
     C                     MOVE *BLANKS   BAL
     C*
     C*    UPDATE RATE.
     C*
     C                     Z-ADD0         ORATE
     C*
     C*    CALCULATE DAYS.
     C*
     C                     Z-ADD0         ODAYS
     C*
     C*    CALCULATE INTEREST FROM PREVIOUS EDAT TO CURRENT EDAT.
     C*
     C           OEAMT     IFGT OPCPL
     C           OEAMT     SUB  OPCPL     WKINT
     C                     ADD  WKINT     RESIDU
     C*                    MOVE '+'       ZSIGNT                          E99998
     C                     MOVE '-'       ZSIGNT                          E99998
     C                     ELSE
     C                     Z-ADD0         WKINT
     C                     END
     C                     MOVE WKINT     ZNUMIN
     C                     MOVE 'A'       ZSIGN
     C                     EXSR FORMAT
     C           *IN88     IFEQ '1'                        ENSURE ERROR   E36383
     C                     MOVE ASTERX    OINTR
     C                     ELSE
     C                     MOVE ZNUMOT    OINTR
     C                     END                                         IF E36383
     C                     MOVE ZNUMOT    INTR
     C*
     C                     ENDSR
     C*
     C*
     C/EJECT
     C********************************************************************
     C*
     C*      DEALSR SR  ACCUMULATE DEAL TOTALS.
     C*
     C           DEALSR    BEGSR                           *** DEALSR ***
     C*
     C*    ADD TO CUSTOMER TOTALS.
     C*
     C                     ADD  DINT      RINT
     C                     ADD  DFEE      RFEE
     C*
     C*    ZEROISE BALANCE FIELD.
     C*
     C                     Z-ADD0         RBAL   130
     C                     Z-ADD0         RAMT   130
     C                     Z-ADD0         DINT   130
     C                     Z-ADD0         DFEE   130
     C                     Z-ADD0         RESIDU 130
     C*
     C                     MOVE *BLANKS   OINTR
     C                     MOVE *BLANKS   OBAL
     C                     Z-ADD*ZEROS    ORATE
     C                     Z-ADD*ZEROS    ODAYS
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    FORMAT HISTORY RECORDS FOR OUTPUT
     C*
     C           FMTREC    BEGSR
     C*
     C*    FORMAT RECORDS FOR LODGEMENT RECORD
     C*
     C                     MOVE OBAL      SBAL   14
     C*
     C*     WRITE OUT RECORD TO SUB FILE
     C*
     C                     ADD  1         RRN
     C                     ADD  1         RRND                            085050
     C                     WRITESUBR01
     C                     OPEN HISTEAA                                   073175
     C                     WRITEHISTEAAF                                  S01390
     C                     CLOSEHISTEAA                                   073175
     C*
     C/COPY WNCPYSRC,DL9100C009
     C                     MOVE NREC      OREC
     C*
     C           FMTEND    ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
     C*    READ THRU HISTORY RECORDS UNTIL FIRST RECORD TO BE DISPLAYED
     C*    IS FOUND
     C           FSTREC    BEGSR
     C                     MOVE OFF       *IN07
     C                     MOVE OFF       FSTFLG  1
     C                     MOVE OFF       FRCD    1                                         MD025769
     C*
     C           *IN07     DOUEQON
     C*
     C*    CHECK THAT RECORD DEAL NUMBER MATCHES THAT OF DEAL NUMBER INPUT
     C*
     C                     MOVE DLNO      HDLNO   6
     C           DEALNO    IFNE *BLANKS
     C           DEALNO    CABNEHDLNO     FSTR1
     C                     END
     C*
     C*    CHECK THAT RECORD CURRENCY MATCHES CURRENCY INPUT
     C*
     C           CCYINP    IFNE *BLANKS
     C           CCYINP    CABNECCY       FSTR1
     C                     END
     C*
     C*    CHECK THAT DEAL TYPE MATCHES THAT OF DEAL TYPE INPUT
     C*
     C           DLIND     IFEQ 'L'
     C***********DTYP      LOKUPLONT                     99               092304
     C************IN99     CABNEON        FSTR1                           092304
     C***********DTYP      CABNE'CL'      FSTR1                     092304152851
     C           DTYP      LOKUPLONT                     99               152851
     C           *IN99     CABNEON        FSTR1                           152851
     C                     END
     C*
     C           DLIND     IFEQ 'D'
     C***********DTYP      LOKUPDEPT                     99               092304
     C************IN99     CABNEON        FSTR1                           092304
     C***********DTYP      CABNE'CD'      FSTR1                     092304152851
     C           DTYP      LOKUPDEPT                     99               152851
     C           *IN99     CABNEON        FSTR1                           152851
     C                     END
     C*
     C*    CHECK THAT DATE FALLS BETWEEN THE DATES INPUT
     C*
     C           EDAT      IFLT FRDAYN
     C           FSTFLG    IFEQ ON
     C                     EXSR PROCSS
     C                     MOVE OBAL      SBAL
     C                     ELSE
     C                     MOVE TERM      SVTERM  3
     C                     END
     C                     MOVE ON        FSTFLG
     C                     MOVE NREC      OREC
     C                     MOVE ON        FRCD                                              MD025769
     C                     ELSE
     C           EDAT      CABGTTODAYN    FSTR1
     C*
     C*   FIRST RECORD TO BE DISPLAYED OUTPUT DEAL HEADINGS
     C*
     C           FRDAYN    IFNE *LOVAL
     C           FSTFLG    ANDEQON
     C                     Z-ADDFRDAYN    OEDAT
     C                     EXSR PROCSS
     C                     MOVE OBAL      SBAL
     C                     MOVE SVTERM    TERM
     C                     END
     C           DLNO      IFNE ODLNO                                                       MD025769
     C                     EXSR DLBRK
     C                     ENDIF                                                            MD025769
     C                     MOVE NREC      OREC
     C                     MOVE ON        FRCD                                              MD025769
     C*                                                                   036945
     C*   SETON SELCT ON FIRST VALID RECORD OF SELECTION CRITERIA         036945
     C*                                                                   036945
     C                     MOVE ON        SELCT                           036945
     C                     GOTO FSTR99
     C                     END
     C*
     C*    READ NEXT HISTORY RECORD
     C*
     C           FSTR1     TAG
     C           HISKY2    READEHIST4                    07
     C           DLNO      IFNE ODLNO
     C                     EXSR DEALSR
     C                     END
     C                     END
     C*
     C           FSTR99    ENDSR
     C*
     C**********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    FORMAT SR. FORMAT FIELDS FOR OUTPUT.
     C*
     C*  PARAMETERS IN;
     C*              ZNUMIN : ALPHA FIELD CONTAINING THE NUMBER TO BE
     C*                       CONVERTED. THE NUMBER IS RIGHT JUSTIFIED.
     C*              ZDEC   : NUMBER OF DECIMAL PLACES
     C*              ZSIGNT : THE SIGN REQUIRED
     C*                        (ASSUME SIGN BLANK)
     C*              ZSIGN  : WHETHER A SIGN SHOULD APPEAR
     C*                        'A' = SIGN APPEARS AFTER THE NUMBER
     C*                        'B' = SIGN APPEARS BEFORE THE NUMBER
     C*                        ' ' = NO SIGN TO APPEAR.
     C*                        (ASSUME SIGN IS NOT REQUIRED)
     C*              ZCOMA  : WHETHER COMMA'S SHOULD APPEAR
     C*                        (ASSUME COMMA'S ARE REQUIRED)
     C*              ZCHRO  : MAXIMUM NUMBER OF OUTPUT CHARACTERS
     C*                        (ASSUME 14 I.E. 11 NUMBERS                 114447
     C*                          WITH COMMAS AND DECIMAL POINT)           114447
     C*************************(ASSUME*13*IE.*10*NUMBERS***************   114447
     C***************************WITH*COMMA'S*AND*DECIMAL*POINT)*******   114447
     C* * * * * * * * * * *  W A R N I N G  * * * * * * * * * * *
     C*        ZSIGN, ZSIGNT, ZCOMA AND ZCHRO SHOULD BE INILILIZED
     C*        WITH DEFAULT VALUES IN THE FIRST CYCLE SUBROUTINE.
     C*
     C*  PARAMETERS OUT;
     C*              ZNUMOT : ARRAY CONTAINING FORMATTED NUMBER
     C*                        THE NUMBER IS RIGHT JUSTIFIED.
     C*              *IN89  : ERROR INDICATOR.
     C*
     C*  VARIABLES USED;
     C*              U      : WORK.
     C*              V      : USED TO CALCULATE IF A COMMA IS REQUIRED.
     C*              W      : STARTING POSITION OF THE NUMBER IN ZAR1.
     C*              X      : CURRENT ELEMENT IN ZAR1 BEING PROCESSED.
     C*              Y      : NEXT ELEMENT AVAILABLE IN ZAR2.
     C*              ZAR1   : ARRAY CONTAINING THE NUMBER TO BE
     C*                        FORMATTED. RIGHT JUSTIFIED.
     C*              ZAR2   : ARRAY CONTAINING THE FORMATTED NUMBER.
     C*                        RIGHT JUSTIFIED.
     C*
     C*
     C           FORMAT    BEGSR                           *** FORMAT ***
     C*
     C*    MOVE THE NUMBER COMING IN TO ARRAY 1.
     C*
     C                     MOVEA*BLANKS   ZAR1
     C                     MOVEA*BLANKS   ZAR2
     C                     MOVE *BLANKS   ZNUMOT 20
     C                     Z-ADDZDEC      ZDEC    10
     C                     MOVE OFF       *IN89
     C*
     C*    MOVE THE NUMBER COMING IN TO ARRAY 1.
     C*
     C                     MOVEAZNUMIN    ZAR1
     C*
     C*    FIND FIRST NUMBER IN INTEREST AMOUNT.
     C*
     C                     Z-ADD0         W       20
     C           20        SUB  ZDEC      U       20
     C                     MOVE OFF       *IN50
     C           *IN50     DOUEQON
     C                     ADD  1         W
     C*
     C*        FOUND FIRST NON '0' OR ' ' CHARACTER.
     C*
     C           ZAR1,W    IFNE ' '
     C           ZAR1,W    ANDNE'0'
     C                     MOVE ON        *IN50
     C                     END
     C*
     C*        IF NO CHARACTERS FOUND THEN SET W TO DECIMAL
     C*            PLACES + 1.
     C*
     C           W         IFEQ U
     C                     MOVE ON        *IN50
     C                     END
     C                     END
     C*
     C*    MOVE SIGN INTO OUTPUT FIELD. (APPEARS AFTER THE NUMBER)
     C*
     C                     Z-ADD20        X       20
     C                     Z-ADD20        Y       20
     C           ZSIGN     IFEQ 'A'
     C                     MOVE ZSIGNT    ZAR2,Y
     C                     SUB  1         Y
     C                     END
     C*
     C*    PROCESS NUMBER.
     C*
     C*    DECIMAL PORTION, (IF REQUIRED).
     C*
     C           ZDEC      IFGT 0
     C                     DO   ZDEC                       LOOP
     C                     MOVE ZAR1,X    ZAR2,Y
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     END
     C                     MOVE '.'       ZAR2,Y
     C                     SUB  1         Y
     C                     END
     C                     Z-ADD0         V
     C*
     C*    PROCESS REST OF NUMBER.
     C*
     C                     MOVE OFF       *IN50
     C           *IN50     DOUEQON                         LOOP
     C*
     C*    COMMA'S.
     C*
     C           Y         IFGT 0
     C           ZCOMA     IFEQ 'Y'
     C           V         ANDGE3
     C                     MOVE ','       ZAR2,Y
     C                     SUB  1         Y
     C                     Z-ADD0         V       20
     C                     END
     C                     END
     C*
     C*    MOVE NUMERICS.
     C*
     C           Y         IFGT 0
     C                     MOVE ZAR1,X    ZAR2,Y
     C                     SUB  1         X
     C                     SUB  1         Y
     C                     ADD  1         V
     C                     END
     C*
     C           X         IFLT W                          PROCESSED
     C                     MOVE ON        *IN50            ALL NUMBERS
     C                     ELSE
     C********** Y         IFLE 0                          NUMBER IS                          253911
     C           Y         IFLT 0                          NUMBER IS                          253911
     C                     MOVE ON        *IN50            TO BIG FOR
     C                     MOVE ON        *IN89            OUTPUT
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*    MOVE SIGN INTO OUTPUT FIELD. (APPEARS BEFORE THE NUMBER)
     C*
     C           Y         IFGT 0
     C           ZSIGN     IFEQ 'B'
     C                     MOVE ZSIGNT    ZAR2,Y
     C                     SUB  1         Y
     C                     END
     C                     ELSE
     C                     MOVE ON        *IN89
     C                     END
     C*
     C*    IS OUTPUT VALUE TO LARGE
     C*
     C           20        SUB  Y         U
     C           U         IFGT ZCHRO
     C                     MOVE ON        *IN89
     C                     END
     C*
     C*    MOVE FORMATTED AMOUNT TO OUTPUT FIELD.
     C*
     C                     MOVEAZAR2      ZNUMOT 20
     C*
     C*    INITILIZE INPUT PARAMETERS.
     C*
      **  Display amounts on screen as 999,999,999.99                     114447
      *                                                                   114447
     C***********          Z-ADD13        ZCHRO   20                      114447
     C**********           Z-ADD14        ZCHRO   20                                   114447 253911
     C                     Z-ADD20        ZCHRO   20                                          253911
     C                     MOVE *BLANKS   ZNUMIN 20
     C                     MOVE ' '       ZSIGNT  1
     C                     MOVE 'N'       ZSIGN   1
     C                     MOVE 'Y'       ZCOMA   1
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    REPORT SR. OUTPUT SELECTED RECORDS TO STATEMENT FILE AND
     C*               CALL PRINT PROGRAM
     C********************************************************************
     C           REPORT    BEGSR                           *** ZSYSTM ***
     C*
     C***********          Z-ADD0         PAGE                            S01390
     C***********          MOVE OFF       *IN51                           S01390
     C***********          MOVE OFF       *IN07                           S01390
     C***********                                                         S01390
     C*****CHAIN*TO*BRANCH*REC*ON*TABLE*FILE.*****************************S01390
     C***********                                                         S01390
     C***********          MOVE *BLANKS   TABKY                           S01390
     C***********          MOVE '10'      TABKY1                          S01390
     C***********          MOVE BRCC      TABKY4                          S01390
     C***********TABKY     CHAINTABDLEE              99                   S01390
     C************IN99     IFEQ ON                                        S01390
     C***********RECI      ORNE 'D'                                       S01390
     C***********          MOVEL'TABLE'   DBFILE                          S01390
     C***********          MOVELTABKY     DBKEY                           S01390
     C***********          MOVE '02'      DBASE                           S01390
     C***********          MOVE ON        *INLR                           S01390
     C***********          MOVE ON        *INU8                           S01390
     C***********          END                                            S01390
     C***********          Z-ADD1         RRN                             S01390
     C***********                                                         S01390
     C************IN07     DOUEQON                                        S01390
     C***********                                                         S01390
     C***********RRN       CHAINSUBR01               07                   S01390
     C***********                                                         S01390
     C************IN07     IFEQ OFF                                       S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C***********RRN       IFEQ 1                                         S01390
     C***********          MOVE OCCY      CCY                             S01390
     C***********          WRITECUHEAD                                    S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****CHECK*IF*NEW*DEAL*RECORD************************************PUTS01390
     C***********                                                         S01390
     C***********          MOVELONARRA    FLD4    4                       S01390
     C***********FLD4      IFEQ 'DEAL'                                    S01390
     C***********OCCY      IFNE CCY                                       S01390
     C***********          MOVE OCCY      CCY                             S01390
     C***********          WRITECUHEAD                                    S01390
     C***********          END                                            S01390
     C***********          MOVE ONARRA    DLNO                            S01390
     C***********                                                         S01390
     C*****PROCESS*TERM*RECORD                                            S01390
     C***********                                                         S01390
     C***********          ADD  1         RRN                             S01390
     C***********RRN       CHAINSUBR01               07                   S01390
     C************IN07     IFEQ OFF                                       S01390
     C***********          MOVELONARRA    TERMA                           S01390
     C***********          WRITEDLHEAD                                    S01390
     C***********          GOTO REP01                                     S01390
     C***********          END                                            S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****PROCESS*ALL*OTHER*SUB-FILE*RECORDS*****************************S01390
     C***********                                                         S01390
     C***********          MOVE ODATE     EDATE                           S01390
     C***********          MOVELONARRA    NARR                            S01390
     C***********          MOVE ORATE     RATE                            S01390
     C***********          MOVE ODAYS     DAYS                            S01390
     C***********          MOVE AMT       PAMT                            S01390
     C***********          MOVE BAL       PBAL                            S01390
     C***********          MOVE INTR      PINT                            S01390
     C***********          WRITEDETLIN                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*PAGE*OVERFLOW****************************************S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C************IN18     IFEQ ON                                        S01390
     C***********          WRITECUHEAD                                    S01390
     C***********          WRITEDLHEAD                                    S01390
     C***********          MOVE OFF       *IN18                           S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C***********REP01     TAG                                            S01390
     C***********                                                         S01390
     C***********          ADD  1         RRN                             S01390
     C***********                                                         S01390
     C***********          END                                            S01390
     C***********          END                                            S01390
     C                     CALL 'FC0040X'                                 S01390
     C                     PARM *BLANKS   RTCD                            S01390
     C                     PARM 'DL9105'  RNAM   10                       S01390
     C***********          PARM 'DL9105'  CNAM   10                S01390 073175
     C                     PARM 'DLC9105' CNAM   10                       073175
     C                     PARM '10001'   CSEQ    5                       S01390
     C***********          PARM *BLANKS   RPARM 100                S01390 073175
     C                     PARM NAMEPM    RPARM 100                       073175
     C                     PARM MBIN      RMBIN   1                       S01390
     C                     PARM 'B'       RLEV    1                       S01390
     C                     PARM BRCC      RENT    3                       S01390
     C*                                                                   S01390
     C           RTCD      IFNE *BLANKS                                   S01390
     C                     MOVE ON        *IN50                           S01390
     C***********          MOVE '050'     ERRC,A                    S01390048632
     C                     MOVEL'DLM0031' @MSGID 10                       048632
     C                     CALL 'ZA0240'                                  048632
     C                     PARM           @MSGID                          048632
     C***********          ADD  1         A                               048632
     C                     END                                            S01390
     C*
     C                     ENDSR
     C********************************************************************
     C***/EJECT*****                                                      S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZSYSTM*SR.*TO*CHAIN*TO*THE*INSTALLATION*CONTROL*DATA*RECORD.***S01390
     C***********                                                         S01390
     C***********ZSYSTM    BEGSR                           *** ZSYSTM *** S01390
     C***********                                                         S01390
     C*****SET*UP*KEY*FOR*INSTALLATION*CONTROL*RECORD.********************S01390
     C***********          MOVEL'01      'ZTABKY 12                       S01390
     C***********          MOVE '  10'    ZTABKY                          S01390
     C***********                                                         S01390
     C***********ZTABKY    CHAINTABDLEE              99    ON NOT THERE   S01390
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01390
     C***********                                                         S01390
     C*****CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.********************S01390
     C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***/EJECT*****                                                      S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****GLINTC*SR.*TO*CALCULATE*INTEREST*BETWEEN*ANY*TWO*DAY*NUMBERS.**S01390
     C***********                                                         S01390
     C*****THIS*VERSION*REPLACES*THE*ORIGINAL*GLINTC*SR.*NOW*NAMED********S01390
     C*****GLINTO.********************************************************S01390
     C***********                                                         S01390
     C*****CALCULATION*METHODS*ARE*-**************************************S01390
     C*****1**ACTUAL/365**************************************************S01390
     C*****2**ACTUAL/360**************************************************S01390
     C*****3**360/360*(SOMETIMES*CALLED*30/360)***************************S01390
     C*****4**365/365*(EXCLUDING*29/02)***********************************S01390
     C*****5**365/360*(EXCLUDING*29/02)***********************************S01390
     C*****6**ACTUAL/366**************************************************S01390
     C***********                                                         S01390
     C*****REQUIRES*SUBRS.*-*ZDATE2,*ZSAVE,*&*ZRSTOR.*********************S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C***********GLINTC    BEGSR                           ** GLINTC  **  S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE*INPUT*FIELDS.***************************S01390
     C***********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  S01390
     C***********          Z-ADDZIEND     ZIEND   50       FINISHING DATE S01390
     C***********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    S01390
     C***********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      S01390
     C***********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST S01390
     C***********                                                         S01390
     C****TO*DETERMINE*NUMBER*OF*DAYS*INTEREST*TO*BE*CALCULATED***********S01390
     C***********ZIEND     SUB  ZIBEG     ZDAYN1  50                      S01390
     C***********                                                         S01390
     C****CHECK*FOR*INTEREST*CALCULATION*BASIS****************************S01390
     C*****USE*OF*INDICATRS***********************************************S01390
     C*****1,92**2,90**3,91**4,97**5,96**6,95*****************************S01390
     C***********          SETOF                     959697               S01390
     C***********ZICALC    COMP 2                    919290               S01390
     C**N91******          GOTO ZICAL                                     S01390
     C***********ZICALC    COMP 5                    959796               S01390
     C***97******ZICALC    COMP 3                    97  91               S01390
     C***95******                                                         S01390
     C***OR*96******          SETOF                     91                S01390
     C**N91******          GOTO ZILPCK                                    S01390
     C***********                                                         S01390
     C*****THIS*CODING*WILL*CALCULATE*THE*NUMBER*OF*DAYS*TO*USE*WHEN******S01390
     C*****USING*THE*30/360*BASIS*-*METHOD*3.*****************************S01390
     C***********          EXSR ZSAVE                                     S01390
     C***********          Z-ADDZIBEG     ZDAYNO                          S01390
     C***********          EXSR ZDATE2                                    S01390
     C***********          MOVE ZDAY      ZISD    20                      S01390
     C***********          MOVE ZMTH      ZISM    20                      S01390
     C***********          MOVE ZYEAR     ZISY    20                      S01390
     C***********          Z-ADDZIEND     ZDAYNO                          S01390
     C***********          EXSR ZDATE2                                    S01390
     C***********          MOVE ZDAY      ZIFD    20                      S01390
     C***********          MOVE ZMTH      ZIFM    20                      S01390
     C***********          MOVE ZYEAR     ZIFY    20                      S01390
     C***********          EXSR ZRSTOR                                    S01390
     C***********          SETOF                     93                   S01390
     C****IN*ORDER*FOR*THE*FINISH*YEAR*TO*BE*LESS*THAN*THE*START*YEAR*IF**S01390
     C****ZIEND*IS*GREATER*THAN*ZIBEG,THEN*THE*DATE*ZIEND*MUST*BE*IN*A****S01390
     C****DIFFERENT*CENTURY*TO*ZIBEG.IF*SO*ADD*100*YEARS*TO*IT.***********S01390
     C***********ZIEND     COMP ZIBEG                93                   S01390
     C***93******ZIFY      COMP ZISY                   93                 S01390
     C***********          Z-ADDZISY      ZISY2   30                      S01390
     C**N93******          Z-ADDZIFY      ZIFY2   30                      S01390
     C***93******ZIFY      ADD  100       ZIFY2                           S01390
     C***********                                                         S01390
     C*****DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*******S01390
     C*****MONTH*IS*FEBRUARY.*********************************************S01390
     C***********                                                         S01390
     C**N98******          BITOF'0'       ZGLBIT  1                       S01390
     C***98******          BITON'0'       ZGLBIT                          S01390
     C***********ZISY2     ADD  1900      ZLYCHK  40                      S01390
     C***********ZLYCHK    DIV  4         ZLYCHK                          S01390
     C***********          MVR            ZLYREM  20                      S01390
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     S01390
     C***********ZISM      COMP 2                        99*FEBRUARY      S01390
     C**N99******30        SUB  ZISD      ZID1    50   93                 S01390
     C**N99*93***          Z-ADD0         ZID1                            S01390
     C***99N98***28        SUB  ZISD      ZID1                            S01390
     C***99*98***29        SUB  ZISD      ZID1                            S01390
     C***********ZISM      COMP 12                       93               S01390
     C***93******          Z-ADD0         ZISM                            S01390
     C***93******ZISY      ADD  1         ZISY                            S01390
     C***93******ZISY2     ADD  1         ZISY2                           S01390
     C***********                                                         S01390
     C*****DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTH*****S01390
     C*****IS*FEBRUARY.***************************************************S01390
     C***********                                                         S01390
     C***********ZIFY2     ADD  1900      ZLYCHK  40                      S01390
     C***********ZLYCHK    DIV  4         ZLYCHK                          S01390
     C***********          MVR            ZLYREM  20                      S01390
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAR     S01390
     C***********ZIFM      COMP 2                        99*FEBRUARY      S01390
     C**N99******ZIFD      COMP 31                       93               S01390
     C***99N98***ZIFD      COMP 28                       93               S01390
     C***99*98***ZIFD      COMP 29                       93               S01390
     C***********          SETOF                     98                   S01390
     C***********          TESTB'0'       ZGLBIT         98               S01390
     C***93******ZID1      ADD  30        ZID1                            S01390
     C**N93******ZID1      ADD  ZIFD      ZID1                            S01390
     C***********ZIFM      SUB  1         ZIFM                            S01390
     C***********ZISY      COMP ZIFY                     93               S01390
     C***93******ZIFM      SUB  ZISM      ZINOM   30                      S01390
     C***93******          GOTO ZIOUT                                     S01390
     C***********12        SUB  ZISM      ZIM1    20                      S01390
     C***********          Z-ADD1         ZISM                            S01390
     C*****USE*ENLARGED*FIELDS*THAT*CAN*HANDLE*1999*ONWARDS***************S01390
     C***********ZISY2     ADD  1         ZISY2                           S01390
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      S01390
     C***********ZIY1      MULT 12        ZIM2    30                      S01390
     C***********ZIM2      ADD  ZIFM      ZIM2                            S01390
     C***********ZIM1      ADD  ZIM2      ZINOM                           S01390
     C***********ZIOUT     TAG                             * ZIOUT TAG *  S01390
     C***********ZINOM     MULT 30        ZID2    50                      S01390
     C***********ZID2      ADD  ZID1      ZDAYN1                          S01390
     C***********          SETOF                     93                   S01390
     C***********ZILPCK    TAG                             * ZILPCK TAG * S01390
     C**N96N97***          GOTO ZICAL                                     S01390
     C*****THE*FOLLOWING*CODING*APPLIES*FOR*METHODS*4*AND*5*ONLY.*********S01390
     C*****1*DAY*IS*SUBTRACTED*FROM*ZDAYN1*FOR*EACH*OCCURANCE*OF*29*FEB***S01390
     C*****IN*THE*INTEREST*CALCULATION*PERIOD*INCLUSIVE*OF*ZIBEG,*&*ZIEND.S01390
     C***********                                                         S01390
     C*****FIND*NO*OF*4*YEAR*PERIODS*BETWEEN*DATES************************S01390
     C***********ZDAYN1    DIV  1461      ZIMAN   20                      S01390
     C***********          MVR            ZIREM   50                      S01390
     C*****FIND*NEXT*29*FEB*DAY*NO.*ON*OR*AFTER*ZIBEG.********************S01390
     C***********ZIBEG     SUB  60        ZIBW1   50                      S01390
     C***********ZIBW1     DIV  1461      ZIDW1   20                      S01390
     C***********          MVR            ZIDREM  50                      S01390
     C***********ZIDREM    COMP 0                        94               S01390
     C***94******          Z-ADDZIBEG     ZIDW2   50                      S01390
     C***94******          GOTO ZILP1                                     S01390
     C*****ROUND*UP*RESULT************************************************S01390
     C***********ZIDW1     ADD  1         ZIDW2                           S01390
     C*****CALCULATE*NEXT*29*FEB.*****************************************S01390
     C***********ZIDW2     MULT 1461      ZIDW2                           S01390
     C***********ZIDW2     ADD  60        ZIDW2                           S01390
     C***********ZILP1     TAG                             * ZILP1 TAG *  S01390
     C*****IF*THIS*NEXT*29*FEB.*DAYNO*-*ZIBEG*IS*GR.*TH.*OR*EQ.*TO********S01390
     C*****ZIREM*THEN*ADD*1*TO*ZIMAN.*************************************S01390
     C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      S01390
     C***********ZIREM     COMP ZILPCP               94  94               S01390
     C***94******ZIMAN     ADD  1         ZIMAN                           S01390
     C*****SUBTRACT*ZIMAN*FROM*ZDAYN1*TO*GIVE*VALUE*OF*ZDAYN1*************S01390
     C*****REQUIRED*FOR*THIS*INTEREST*CALCULATION.************************S01390
     C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          S01390
     C***********          SETOF                     94                   S01390
     C***********ZICAL     TAG                             * ZICAL TAG *  S01390
     C***********                                                         S01390
     C****CALCULATE*INTEREST**********************************************S01390
     C***90******                                                         S01390
     C***OR*91******                                                      S01390
     C***OR*96******ZIAMT     DIV  36000     ZIWRK1 155H                  S01390
     C***92******                                                         S01390
     C***OR*97******ZIAMT     DIV  36500     ZIWRK1    H                  S01390
     C***95******ZIAMT     DIV  36600     ZIWRK1    H                     S01390
     C***********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     S01390
     C***********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST S01390
     C***********                                                         S01390
     C***********          SETOF                     909192               S01390
     C***********          SETOF                     959697               S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C*****AMENDMENT*FOR*THIS*PROGRAM*ONLY********************************S01390
     C*****ROUND*INTEREST*AMOUNT*TO*ZERO*DEC*PL***************************S01390
     C***********                                                         S01390
     C***********          Z-ADDZINTR     WKINT  130H                     S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZSAVE*SR.*TO*MEMORISE*THE*SETTINGS*AND*TO*SET*OFF*INDICATORS***S01390
     C****************90*-*97*BEFORE*EXECUTION*OF*A*Z-SUBROUTINE.*********S01390
     C***********                                                         S01390
     C*****THIS*SR.*IS*REQUIRED*ONLY*IF*INDICATORS************************S01390
     C*****90*-*97*ARE*USED*ELSEWHERE*IN*A*PROGRAM************************S01390
     C***********                                                         S01390
     C***********ZSAVE     BEGSR                           *** ZSAVE ***  S01390
     C***********                                                         S01390
     C***********          BITOF'01234567'ZBITS   1                       S01390
     C***90******          BITON'0'       ZBITS                           S01390
     C***91******          BITON'1'       ZBITS                           S01390
     C***92******          BITON'2'       ZBITS                           S01390
     C***93******          BITON'3'       ZBITS                           S01390
     C***94******          BITON'4'       ZBITS                           S01390
     C***95******          BITON'5'       ZBITS                           S01390
     C***96******          BITON'6'       ZBITS                           S01390
     C***97******          BITON'7'       ZBITS                           S01390
     C***********                                                         S01390
     C***********          SETOF                     909192               S01390
     C***********          SETOF                     939495               S01390
     C***********          SETOF                     9697                 S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZRSTOR*SR.*TO*RESTORE*INDICATORS*90*-*97*TO*THE*SETTINGS*******S01390
     C****************THEY*HAD*BEFORE*THE*EXECUTION*OF*SR.*ZSAVE.*********S01390
     C***********                                                         S01390
     C***********ZRSTOR    BEGSR                           *** ZRSTOR *** S01390
     C***********                                                         S01390
     C***********          TESTB'0'       ZBITS          90               S01390
     C***********          TESTB'1'       ZBITS          91               S01390
     C***********          TESTB'2'       ZBITS          92               S01390
     C***********          TESTB'3'       ZBITS          93               S01390
     C***********          TESTB'4'       ZBITS          94               S01390
     C***********          TESTB'5'       ZBITS          95               S01390
     C***********          TESTB'6'       ZBITS          96               S01390
     C***********          TESTB'7'       ZBITS          97               S01390
     C***********                                                         S01390
     C***********          ENDSR                                          S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZDATE2*SR.*TO*CONVERT*A*DAY*NUMBER*TO*DATE*FORMATS.************S01390
     C***********                                                         S01390
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01390
     C***********                                                         S01390
     C***********ZDATE2    BEGSR                           *** ZDATE2 *** S01390
     C***********                                                         S01390
     C*****CLEAR*DATE*FIELDS.*********************************************S01390
     C***********          Z-ADD0         ZDATE   60                      S01390
     C***********          MOVEL'       ' ZADATE  7                       S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE*INPUT*DAY*NUMBER.************************S01390
     C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01390
     C***********                                                         S01390
     C*****DETERMINE*YEAR*NUMBER.*****************************************S01390
     C***********                                                         S01390
     C*****ADJUST*DAY*NUMBER*IN*CASE*LAST*DAY*OF*YEAR.********************S01390
     C***********ZDAYNO    SUB  1         ZDAYN1  50   99                 S01390
     C***99******          GOTO ZDEND2                                    S01390
     C***********                                                         S01390
     C*****CALCULATE*NUMBER*OF*4*YEAR*SPANS*SINCE*31/12/1971.*************S01390
     C***********ZDAYN1    DIV  1461      ZLYR    20                      S01390
     C***********          MVR            ZDAYN1           SAVE REMAINING S01390
     C***********                                          DAYS           S01390
     C*****CALCULATE*NUMBER*OF*REMAINING*YEARS.***************************S01390
     C***********          Z-ADD1         ZWRK2   20                      S01390
     C***********ZDTAG1    TAG                             ** ZDTAG1 TAG *S01390
     C***********ZDAYN1    COMP ZYDY,ZWRK2             90                 S01390
     C**N90******ZWRK2     ADD  1         ZWRK2                           S01390
     C**N90******          GOTO ZDTAG1                                    S01390
     C***********ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON S01390
     C***********                                                         S01390
     C*****DECREMENT*DAY*NO.*BY*DAYS*IN*REMAINING*YEARS.******************S01390
     C**N91******ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1                          S01390
     C***********                                                         S01390
     C*****CALCULATE*ACTUAL*YEAR*NUMBER.**********************************S01390
     C***********ZLYR      MULT 4         ZWRK3   30                      S01390
     C***********ZWRK3     ADD  72        ZWRK3            BASE IS 1972   S01390
     C***********          Z-ADDZWRK3     ZYEAR   20                      S01390
     C***********ZYEAR     ADD  ZWRK2     ZYEAR            YEAR           S01390
     C***********                                                         S01390
     C*****DETERMINE*MONTH*NUMBER.****************************************S01390
     C***********                                                         S01390
     C*****ADJUST*DAY*NO.*IN*CASE*LAST*DAY*OF*LEAP*YEAR*FEBRUARY.*********S01390
     C***********          SETOF                     9293                 S01390
     C***91******ZDAYN1    COMP 59                     9293               S01390
     C***91N92***ZDAYN1    SUB  1         ZDAYN1                          S01390
     C***********                                                         S01390
     C*****CALCULATE*MONTH*NUMBER.****************************************S01390
     C***********          Z-ADD2         ZWRK2                           S01390
     C***********ZDTAG2    TAG                             ** ZDTAG2 TAG *S01390
     C***********ZDAYN1    COMP ZMDY,ZWRK2             94                 S01390
     C**N94******ZWRK2     ADD  1         ZWRK2                           S01390
     C**N94******          GOTO ZDTAG2                                    S01390
     C***********ZWRK2     SUB  1         ZWRK2                           S01390
     C***********                                                         S01390
     C***********          Z-ADDZWRK2     ZMTH    20       MONTH          S01390
     C***********                                                         S01390
     C*****DETERMINE*DAY*OF*MONTH.****************************************S01390
     C***********                                                         S01390
     C*****ADD*BACK*LAST*DAY*OF*YEAR*ADJUSTMENT.**************************S01390
     C***********ZDAYN1    ADD  1         ZDAYN1                          S01390
     C***********                                                         S01390
     C******ALCULATE*DAY*OF*MONTH.****************************************S01390
     C***********ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY            S01390
     C***********                                                         S01390
     C*****ADD*BACK*LEAP*YEAR*29TH*FEBUARY*ADJUSTMENT,*IF*REQUIRED.*******S01390
     C***93******ZDAY      ADD  1         ZDAY                            S01390
     C***********                                                         S01390
     C*****FORMAT*DATE,*DDMMYY*OR*MMDDYY.*********************************S01390
     C**N98******          MOVELZDAY      ZWRK4   40                      S01390
     C***98******          MOVE ZDAY      ZWRK4                           S01390
     C**N98******          MOVE ZMTH      ZWRK4                           S01390
     C***98******          MOVELZMTH      ZWRK4                           S01390
     C***********          MOVELZWRK4     ZDATE                           S01390
     C***********          MOVE ZYEAR     ZDATE                           S01390
     C***********                                                         S01390
     C*****FORMAT*ALPHA*DATE,*DDMMMYY.************************************S01390
     C***********ZDAY      COMP 10                     95                 S01390
     C***********          MOVELZDAY      ZWRK5   5                       S01390
     C***95******          MOVEL' '       ZWRK5                           S01390
     C***********          MOVE ZMNM,ZMTH ZWRK5                           S01390
     C***********          MOVELZWRK5     ZADATE                          S01390
     C***********          MOVE ZYEAR     ZADATE                          S01390
     C***********                                                         S01390
     C***********ZDEND2    ENDSR                           * ZDEND2 ENDSR*S01390
     C***********                                                         S01390
     C***/EJECT*****                                                      S01390
0747 C***********                                                         S01390
0748 C*****ZALIGN*SR.*TO*VALIDATE*AND*RIGHT-ALIGN*NUMERIC*FIELDS.         S01390
0749 C***********                                                         S01390
     C***********ZALIGN    BEGSR                           *** ZALIGN *** S01390
     C***********                                                         S01390
     C***********          SETOF                     929399               S01390
     C***********                                                         S01390
     C*****SAVE*INPUT*FIELD*IN*ARRAY,*ZA1.********************************S01390
     C***********          MOVEAZFIELD    ZA1                             S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE NUMBER*STRUCTURE*CONTROL*FIELDS.*********S01390
     C***********          Z-ADDZADIG     ZADIG   20                      S01390
     C***********          Z-ADDZADEC     ZADEC   10                      S01390
     C***********                                                         S01390
     C*****CALCULATIONS*TO*DEFINE/CLEAR*FIELDS.***************************S01390
     C***********          MOVE ' '       ZA2                             S01390
     C***********          MOVEAZA2       ZFIELD 16                       S01390
     C***********          Z-ADD0         ZX      20                      S01390
     C***********          Z-ADD0         ZY      20                      S01390
     C***********                                                         S01390
     C*****ENSURE*REQUIRED*STRUCTURE*OF*FIELD*IS*VALID.*******************S01390
     C***********ZADIG     ADD  ZADEC     ZZ      20                      S01390
     C***********ZZ        COMP 15                   99                   S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********                                                         S01390
     C*****LOOP*TO*FIND*DECIMAL*POINT,*BLANKS*AND*CHARACTERS.*************S01390
     C***********ZATAG1    TAG                             ** ZATAG1 TAG *S01390
     C***********ZX        ADD  1         ZX                              S01390
     C***********                                                         S01390
     C*****CHECK*FOR*DECIMAL*POINT.*ERROR*IF*SECOND*DECIMAL*POINT.********S01390
     C***********ZA1,ZX    COMP '.'                      90               S01390
     C***90*93***          SETON                     99                   S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C*****CHECK*FOR*'M'*CONSTANT.*ERROR*IF*NOT*LAST*CHARACTER*ENTERED****S01390
     C***********ZA1,ZX    COMP 'M'                      96               S01390
     C***96******          DO                                             S01390
     C***********ZX        ADD  1         ZX                              S01390
     C***********ZA1,ZX    COMP ' '                  9999                 S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********ZX        SUB  1         ZX                              S01390
     C***********ZX        COMP 9                    99                   S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****CHECK*FOR*'T'*CONSTANT.*ERROR*IF*NOT*LAST*CHARACTER*ENTERED****S01390
     C***********ZA1,ZX    COMP 'T'                      97               S01390
     C***97******          DO                                             S01390
     C***********ZX        ADD  1         ZX                              S01390
     C***********ZA1,ZX    COMP ' '                  9999                 S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********ZX        SUB  1         ZX                              S01390
     C***********ZX        COMP 12                   99                   S01390
     C***99******          GOTO ZAEND                                     S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****CLEAR*ALPHAMERIC*CONSTANT*FROM*ZA1*****************************S01390
     C***96******                                                         S01390
     C***OR*97***             MOVE ' '       ZA1,ZX                       S01390
     C***********                                                         S01390
     C*****CHECK*FOR*BLANKS.*BYPASS*FOR*FIRST*BLANK*AFTER*A*DIGIT.********S01390
     C***********ZA1,ZX    COMP ' '                      91               S01390
     C***91*92***          GOTO ZATAG2                                    S01390
     C***********                                                         S01390
     C*****CHECK*FOR*NUMERIC,*IF*NOT*'.'*OR*' '.**************************S01390
     C**N90N91***ZA1,ZX    COMP '0'                    99                 S01390
     C**N90N91N99ZA1,ZX    COMP '9'                  99                   S01390
     C***99******          GOTO ZAEND                      NOT NUMERIC    S01390
     C***********                                                         S01390
     C*****STORE*DIGITS*IN*ARRAY*AND*HOW*MANY.****************************S01390
     C*****ZY,*TOTAL*OF*DIGITS*IN*THE*INPUT*FIELD.************************S01390
     C*****ZZ,*TOTAL*OF*DIGITS*TO*THE*LEFT*OF*DECIMAL*POINT.**************S01390
     C**N90N91***ZY        ADD  1         ZY         92                   S01390
     C**N90N91***          MOVE ZA1,ZX    ZA2,ZY                          S01390
     C***90******          Z-ADDZY        ZZ         93  93               S01390
     C***********                                                         S01390
     C***********ZX        COMP 16                     94  CHECK IF ALL   S01390
     C***94******          GOTO ZATAG1                                    S01390
     C***********                                                         S01390
     C***********ZATAG2    TAG                             ** ZATAG2 TAG *S01390
     C***********                                                         S01390
     C*****IF*'M'*SPECIFIED,*MULTIPLY*ZA1*BY*1*MILLION********************S01390
     C***96******ZZ        ADD  6         ZZ                              S01390
     C***********                                                         S01390
     C*****IF*'T'*SPECIFIED,*MULTIPLY*ZA1*BY*1*THOUSAND*******************S01390
     C***97******ZZ        ADD  3         ZZ                              S01390
     C***********                                                         S01390
     C*****FILL*IN*ZEROS*IN*ANY*BLANKS*LEFT*OF*DECIMAL*POINT**************S01390
     C***96*93***                                                         S01390
     C***OR*97*93***ZZ        DOWGTZY                                     S01390
     C***********ZY        ADD  1         ZY                              S01390
     C***********          MOVE '0'       ZA2,ZY                          S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****IF*CONSTANT*SPECIFIED*WITH*NO*DECIMAL*POINT*ZEROISE*BLANKS*****S01390
     C***96N93***          DO   6                                         S01390
     C***********ZY        ADD  1         ZY                              S01390
     C***********          MOVE '0'       ZA2,ZY                          S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C***97N93***          DO   3                                         S01390
     C***********ZY        ADD  1         ZY                              S01390
     C***********          MOVE '0'       ZA2,ZY                          S01390
     C***********          END                                            S01390
     C***********                                                         S01390
     C*****IF*NO*DECIMAL*POINT*FOUND,*SET*TOTAL*FIELD*ZZ.*****************S01390
     C**N93******          Z-ADDZY        ZZ                              S01390
     C***********                                                         S01390
     C*****CHECK*FOR*EMBEDDED*BLANKS.*************************************S01390
     C***91*92***          MOVEAZA1,ZX    ZFIELD                          S01390
     C***91*92***ZFIELD    COMP ' '                  9999                 S01390
     C***99******          GOTO ZAEND                      EMBEDDED BLANK S01390
     C***********                                                         S01390
     C*****ENSURE*THAT*NUMBER*OF*DIGITS*ENTERED*EITHER*SIDE***************S01390
     C*****OF*DECIMAL*POINT*ARE*NOT*MORE*THAN*ALLOWED.********************S01390
     C***********ZZ        COMP ZADIG                99                   S01390
     C***********ZY        SUB  ZZ        ZX                              S01390
     C**N99******ZADEC     SUB  ZX        ZX           9995               S01390
     C***99******          GOTO ZAEND                                     S01390
     C***95******          GOTO ZATAG4                     NO TRAILING    S01390
     C***********                                          BLANKS.        S01390
     C*****FILL*THE*TRAILING*BLANKS*WITH*ZEROS.***************************S01390
     C***********ZY        ADD  ZX        ZZ                              S01390
     C***********ZATAG3    TAG                             ** ZATAG3 TAG *S01390
     C***********ZY        ADD  1         ZY                              S01390
     C***********          MOVE '0'       ZA2,ZY                          S01390
     C***********ZY        COMP ZZ                     94                 S01390
     C***94******          GOTO ZATAG3                                    S01390
     C***********                                                         S01390
     C*****RIGHT-ALIGN*THE*VALUE*BY*MOVING*BACK*TO*ARRAY,*ZA1.************S01390
     C***********ZATAG4    TAG                             ** ZATAG4 TAG *S01390
     C***********          MOVE '0'       ZA1                             S01390
     C***********          Z-ADD16        ZX                              S01390
     C***********ZATAG5    TAG                             ** ZATAG5 TAG *S01390
     C***********ZY        COMP 0                        94               S01390
     C***94******          GOTO ZATAG6                                    S01390
     C***********          MOVE ZA2,ZY    ZA1,ZX                          S01390
     C***********ZY        SUB  1         ZY                              S01390
     C***********ZX        SUB  1         ZX                              S01390
     C***********          GOTO ZATAG5                                    S01390
     C***********ZATAG6    TAG                             ** ZATAG6 TAG *S01390
     C***********                                                         S01390
     C**   MOVE VALIDATED*AND*RIGHT-ALIGNED*NUMBER*BACK*INTO*ZFIELD.******S01390
     C***********          MOVEAZA1       ZFIELD                          S01390
     C***********                                                         S01390
     C***********          SETOF                     9697                 S01390
     C***********                                                         S01390
     C***********ZAEND     ENDSR                           * ZAEND ENDSR *S01390
     C***********                                                         S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***/SPACE 3                                                         S01390
     C********************************************************************S01390
     C***********                                                         S01390
     C*****ZDATE1*SR.*TO*VALIDATE*DATES*SUBMITTED*AND*********************S01390
     C****************CONVERT*TO*A*NUMBER*OF*DAYS.************************S01390
     C***********                                                         S01390
     C*****THE*YEAR*2000,*BEING*DIVISIBLE*BY*400,*IS*A*LEAP*YEAR.*********S01390
     C***********                                                         S01390
     C***********ZDATE1    BEGSR                           *** ZDATE1 *** S01390
     C***********                                                         S01390
     C*****CLEAR*DAY*NUMBER.**********************************************S01390
     C***********          Z-ADD0         ZDAYNO  50                      S01390
     C***********                                                         S01390
     C*****CALCULATION*TO*DEFINE*INPUT*DATE*FIELD.************************S01390
     C***********          Z-ADDZDATE     ZDATE   60                      S01390
     C***********                                                         S01390
     C*****GET*INDIVIDUAL*DAY,*MONTH*AND*YEAR*FIELDS.*********************S01390
     C***********          MOVE ZDATE     ZYEAR   20                      S01390
     C**N98******          MOVELZDATE     ZDAY    20                      S01390
     C***98******          MOVELZDATE     ZMTH    20                      S01390
     C***********          MOVE ZDATE     ZWRK4   40                      S01390
     C**N98******          MOVELZWRK4     ZMTH                            S01390
     C***98******          MOVELZWRK4     ZDAY                            S01390
     C***********                                                         S01390
     C*****ENSURE*MONTH*IS*VALID.*****************************************S01390
     C***********ZMTH      COMP 0                      9999               S01390
     C**N99******ZMTH      COMP 12                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****CHECK*FOR*30*DAY*MONTHS.***************************************S01390
     C***********ZMTH      COMP 4                        90IF 90 ON, 30   S01390
     C**N90******ZMTH      COMP 6                        90DAY MONTH.     S01390
     C**N90******ZMTH      COMP 9                        90               S01390
     C**N90******ZMTH      COMP 11                       90               S01390
     C***********                                                         S01390
     C*****ENSURE*DAY*IS*VALID.*******************************************S01390
     C***********ZDAY      COMP 0                      9999               S01390
     C***90N99***ZDAY      COMP 30                   99                   S01390
     C**N90N99***ZDAY      COMP 31                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****CHECK*FOR*LEAP*YEAR*AND*FEBRUARY.******************************S01390
     C***********ZYEAR     ADD  28        ZYEAR                           S01390
     C***********ZYEAR     DIV  4         ZLYR    20                      S01390
     C***********          MVR            ZLY     10     91LEAP YR, 91 ON S01390
     C***********ZMTH      COMP 2                    93  92FEB., 92 ON    S01390
     C***********                                          PAST FEB, 93 ONS01390
     C*****IF*FEBUARY*FURTHER*VALIDATE*DAY.*******************************S01390
     C**N91*92***ZDAY      COMP 28                   99                   S01390
     C***91*92***ZDAY      COMP 29                   99                   S01390
     C***99******          GOTO ZDEND1                     BYPASS IF ERRORS01390
     C***********                                                         S01390
     C*****DETERMINE*NUMBER*OF*DAYS*FROM*31/12/1971.*****NO.OF*4*YR.*SPANSS01390
     C***********ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.S01390
     C**N91******ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRS01390
     C***91*93***ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.S01390
     C***********ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR S01390
     C***********ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHS01390
     C***********                                                         S01390
     C***********ZDEND1    ENDSR                           * ZDEND1 ENDSR*S01390
     C***********                                                         S01390
     C********************************************************************S01390
     C***/EJECT*****                                                      S01390
     C********************************************************************
     C/COPY ZSRSRC,GLINTCZ1                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZALIGNZ2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZDATE1Z2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZDATE2Z2                                               S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZSAVEZ1                                                S01390
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZRSTORZ1                                               S01390
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
     C/SPACE 3                                                            S01390
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** RECORD MESSAGES FOR SCREEN 2
                         ****  P L E A S E   W A I T  ****
**** NO HISTORY RECORDS FOUND FOR SELECTION CRITERIA  ****
** NRTP/NRDS - EVENT TYPES AND DESCRIPTIONS
LDDEPOSIT
IBINTERIM BAL
OBOPENING BAL
PIPRIN INCRSE
PDPART REPAY
IAINT ADJUST
TXWHT CHARGE
FASER CHG ADJ
FDSERVICE CHG
SCRENEG
MAREPAYMENT
IPINT DUE
CBCLOSING BAL
ROROLLOVER
EUEU WH TAX                                                                                   CGL031
STSECOND TAX                                                                                BUG26296
CTTHIRD TAX                                                                                 BUG26296
** LONT - LOAN TYPES                                                      152851
IPTICLLNDL                                                                152851
** DEPT - DEPOSIT TYPES                                                   152851
ITTDCDCI                                                                  152851
     X/COPY WNCPYSRC,DL9100X001
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Finastra International Limited 2001
** CLRPFM  -  Clear Data Base File Member                                 073175
CLRPFM FILE(HISTEAA) MBR(          )                                      073175
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
