     H        1                                                           S01390
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas DL Dealing Interest History Enq Print')
     F********************************************************************
     F*                                                                  *
     F*  Midas - Dealing Module
     F*                                                                  *
     F*     DL9105 - DEALING INTEREST HISTORY ENQUIRY PRINT              *
     F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *  Prev Amend No. 188461             Date 23May01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 114447             Date 21Nov97               *
     F*                    073175            DATE 21NOV97             *
     F*                    048632            DATE 03FEB93             *
     F*                    AUS006            DATE 12AUG92             *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
     F*  188461 - Correct DB error processing and cosmetic errors     *
     F*  114447 - Amount and balance fields in Interest History       *
     F*           Enquiry Screen truncate leading digit - change      *
     F*           amount fields from 13A to 14A.                      *
     F*  073175 - Interest History Enquiry Print loops if more than   *
     F*           one user takes the option since both write records  *
     F*           with the same RRN - fix is to create a new member   *
     F*           for each user.                                      *
     F*     048632 - Printer file DL9111P1 being opened               *
     F*              when already open.                               *
     F*     AUS006 - AUSTRALIAN PRODUCT - INTEREST HISTORY            *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F********************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS                          *
     F********************************************************************
     F*
     F*       07         End of file for HISTEAA                      *   073175
     F*       18         Overflow                                     *   073175
     F*       43         Print end of Report                          *   073175
     F*                                                               *   073175
     F*****************************************************************   073175
     F*
     F***********DL9111P1O   E  18     PRINTER      KINFDS SPOOL1   S01390048632
     FDL9111P1O   E             18     PRINTER      KINFDS SPOOL1     UC  048632
     FHISTEAA IF  E                    DISK                               S01390
     F*
     F/EJECT
     E*
0069 E********************ZA1        16  1               ZALIGN SR. ARRAY 073175
0070 E********************ZA2        16  1               ZALIGN SR. ARRAY 073175
     E                    CPY@    1   1 80                                S01390
     E*
     E/EJECT
     I*
     ILDA         DS                            256                       S01390
     I*                                                                   S01390
     I** Local Data Area To Identify Database Errors                      S01390
     I*                                                                   S01390
     I                                      134 141 DBFILE                S01390
     I                                      142 170 DBKEY                 S01390
     I                                      171 180 DBPGM                 S01390
     I                                      181 1830DBASE                 S01390
     I*                                                                   S01390
     I*RUNDT*******DS                                              S01390 073175
     I***************                        13  13 MBIN           S01390 073175
     I*                                                                   S01390
     ISDBANK    E DSSDBANKPD                                              S01390
     I* Bank Details Accesses Via Access Program                          S01390
     I*                                                                   S01390
     I*SDBRCH****E*DSSDBRCHPD                                             073175
     I**Branch*Details*Accessed*Via*Access*Program**************** S01390 073175
     I*                                                                   S01390
     IDSFDY     E DSDSFDY                                                 S01390
     I* First DS For Access Programs, Short Data Structure                S01390
     I*
     I*                                                                   S01390
     ISPOOL1      DS                                                      S01390
     I**    SPOOL FILE INFORMATION DATA STRUCTURE FOR P1                  S01390
     I                                       83  92 SFILE1                S01390
     I                                    B 123 1240SFNUM1                S01390
     I*
     I            DS
     I****************************************1  72 RECORD                114447
     I                                        1  74 RECORD                114447
     I                                        1   7 ODATE
     I                                        8  18 ONARRA
     I                                       19  32 OAMT                  114447
     I                                       33  46 OBAL                  114447
     I                                       58  70 OINTR                 114447
     I***************************************19  31 OAMT                  114447
     I***************************************32  44 OBAL                  114447
     I***************************************56  68 OINTR                 114447
     I*                                                                   114447
     I************DS**************************1                           073175
     I*****DATA*STRUCTURE*CONTAINING*NEW*RECORD                           073175
     I****************************************1  96 NREC                  E36489
     I****************************************1 104 NREC           E36489 073175
     I****************************************1   2 RTYP                  073175
     I****************************************3   70EDAT                  073175
     I****************************************8  130DLNO                  073175
     I***************************************14  280PCPL                  073175
     I***************************************29  418NRAT                  073175
     I***************************************42  548ORAT                  073175
     I***************************************55  57 BRCA           S01390 073175
     I***************************************58  60 CCY                   073175
     I***************************************61  61 INTC                  073175
     I***************************************62  760EAMT                  073175
     I***************************************77  79 BRCC           S01390 073175
     I***************************************80  87 CASK                  073175
     I***************************************88  88 ICBS                  073175
     I***************************************89  930MDAT                  073175
     I***************************************94  96 TERM                  073175
     I***************************************97 1020CNUM           E36489 073175
     I**************************************103 104 DTYP                  073175
     I************DS**************************                            073175
     I*****DATA*STRUCTURE*CONTAINING*OLD*RECORD************************** 073175
     I****************************************1  96 OREC                  E36489
     I****************************************1 104 OREC           E36489 073175
     I****************************************1   2 ORTYP                 073175
     I****************************************3   70OEDAT                 073175
     I****************************************8  130ODLNO                 073175
     I***************************************14  280OPCPL                 073175
     I***************************************29  418ONRAT                 073175
     I***************************************42  548OORAT                 073175
     I***************************************55  57 OBRCA          S01390 073175
     I***************************************58  60 OCCY                  073175
     I***************************************61  61 OINTC                 073175
     I***************************************62  760OEAMT                 073175
     I***************************************77  79 OBRCC          S01390 073175
     I***************************************80  87 OCASK                 073175
     I***************************************88  88 OICBS                 073175
     I***************************************89  930OMDAT                 073175
     I***************************************94  96 OTERM                 073175
     I***************************************97 1020OCNUM          E36489 073175
     I**************************************103 104 ODTYP                 073175
     I/EJECT
     C********************************************************************
     C*
     C*     M A I N L I N E
     C*
     C*     INITIALISATION PROCESSING
     C*
     C                     EXSR INIT
     C*
     C*     MAIN PROCESSING
     C*
     C                     EXSR MAIN
     C*
     C*     END PROCESSING
     C*
     C                     EXSR END
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*     SUBROUTINE: INITIALISATION
     C*
     C           INIT      BEGSR                           *** INIT SUBR *
     C           *ENTRY    PLIST
     C                     PARM           SEQ     5
     C***********          PARM           LVL     1                S01390 073175
     C***********          PARM           ENT     3                S01390 073175
     C*
     C*     INITIALISE STANDARD VARIABLES
     C*
     C           *NAMVAR   DEFN           LDA                             S01390
     C           *LOCK     IN   LDA                                       S01390
     C                     MOVEL'DL9105'  DBPGM
     C                     OUT  LDA                                       S01390
     C************NAMVAR   DEFN RUNDAT    RUNDT                    S01390 073175
     C***********          IN   RUNDT                              S01390 073175
     C                     MOVEACPY@      BIS@   80                       S01390
     C***********          Z-ADD1         A       20                      073175
     C***********          MOVE '0'       HISREC  1                       073175
     C***********          MOVE *ALL'*'   ASTERX 14                       073175
     C                     Z-ADD*ZERO     RRN     50
     C*
     C*     ACCESS BANK DETAILS                                           S01390
     C*
     C                     CALL 'AOBANKR0'                                S01390
     C**********           PARM '*DBERR ' RTCD    7                S01390 188461
     C                     PARM '       ' RTCD    7                       188461
     C                     PARM '*FIRST ' OPTN    7                       S01390
     C           SDBANK    PARM SDBANK    DSFDY                           S01390
     C*                                                                   188461
     C           RTCD      IFNE *BLANKS                                   188461
     C           *LOCK     IN   LDA                                       188461
     C                     MOVEL'SDBANKPD'DBFILE                          188461
     C                     Z-ADD1         DBASE                           188461
     C                     OUT  LDA                                       188461
     C                     MOVE '1'       *INU8                           188461
     C                     EXSR END                                       188461
     C                     END                                            188461
     C*
     C                     ENDSR                           *** END INIT **
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    MAIN PROCESSING SUBROUTINE
     C*               OUTPUT SELECTED RECORDS TO STATEMENT FILE
     C*
     C           MAIN      BEGSR                           ** MAIN SUBR **
     C                     Z-ADD0         PAGE                            S01390
     C***********          MOVE '0'       *IN51                    S01390 073175
     C                     MOVE '0'       *IN07                           S01390
     C*                                                                   S01390
     C***ACCESS*BRANCH*DETAILS************************************ S01390 073175
     C***********MBIN      IFEQ 'Y'                                S01390 073175
     C***********          SETON                     88            S01390 073175
     C***********          CALL 'AOBRCHR0'                         S01390 073175
     C***********          PARM *BLANKS   RTCD                     S01390 073175
     C***********          PARM '*KEY   ' OPTN                     S01390 073175
     C***********          PARM BRCC      KYBR    3                S01390 073175
     C***********SDBRCH    PARM SDBRCH    DSFDY                    S01390 073175
     C***********RTCD      IFNE *BLANKS                            S01390 073175
     C************LOCK     IN   LDA                                S01390 073175
     C***********          MOVEL'SDBRCHPD'DBFILE                   S01390 073175
     C***********          MOVELBRCC      DBKEY                    S01390 073175
     C***********          Z-ADD2         DBASE                    S01390 073175
     C***********          OUT  LDA                                S01390 073175
     C***********          MOVE '1'       *INLR                           073175
     C***********          MOVE '1'       *INU8                           073175
     C***********          END                                            073175
     C***********          END                                     S01390 073175
     C*                                                                   S01390
     C           FILOP1    IFNE 'Y'                                       S01390
     C                     OPEN DL9111P1                                  S01390
     C                     Z-ADD0         PAGE                            S01390
     C                     MOVEL'Y'       FILOP1  1                       S01390
     C                     SETOF                     18                   S01390
     C*                                                                   S01390
     C** Report printer file to RCF via ZSFILE                            S01390
     C*                                                                   S01390
     C                     Z-ADDSFNUM1    ZSNUM   60                      S01390
     C                     CALL 'ZSFILE'                                  S01390
     C                     PARM           SEQ                             S01390
     C***********          PARM BRCC      @ENT    3                S01390 073175
     C                     PARM *BLANKS   @ENT    3                       073175
     C                     PARM           SFILE1                          S01390
     C                     PARM           ZSNUM                           S01390
     C                     PARM *BLANKS   ZSERR   1                       S01390
     C*                                                                   S01390
     C** Error during ZSFILE processing, return to calling program        S01390
     C*                                                                   S01390
     C           ZSERR     IFEQ 'Y'                                       S01390
     C                     SETON                     U7U8LR               S01390
     C                     EXSR END                                       188461
     C                     END                                            S01390
     C                     END                                            S01390
     C                     Z-ADD1         RRN                             S01390
     C*                                                                   S01390
     C           *IN07     DOUEQ'1'                                       S01390
     C*                                                                   S01390
     C           RRN       CHAINHISTEAAF             07                   S01390
     C*                                                                   S01390
     C           *IN07     IFEQ '0'                                       S01390
     C           RRN       IFEQ 1                                         S01390
     C                     MOVE OCCY      CCY                             S01390
     C                     WRITECUHEAD                                    S01390
     C                     END                                            S01390
     C*                                                                   S01390
     C**   CHECK IF NEW DEAL RECORD                                       S01390
     C*                                                                   S01390
     C                     MOVELONARRA    FLD4    4                       S01390
     C           FLD4      IFEQ 'DEAL'                                    S01390
     C           OCCY      IFNE CCY                                       S01390
     C                     MOVE OCCY      CCY                             S01390
     C                     WRITECUHEAD                                    S01390
     C                     END                                            S01390
     C                     MOVE ONARRA    DLNO                            S01390
     C*                                                                   S01390
     C**   PROCESS TERM RECORD                                            S01390
     C*                                                                   S01390
     C                     ADD  1         RRN                             S01390
     C           RRN       CHAINHISTEAAF             07                   S01390
     C           *IN07     IFEQ '0'                                       S01390
     C                     MOVELONARRA    TERMA                           S01390
     C                     WRITEDLHEAD                                    S01390
     C                     GOTO REP01                                     S01390
     C                     END                                            S01390
     C                     END                                            S01390
     C*                                                                   S01390
     C**   PROCESS ALL OTHER SUB-FILE RECORDS                             S01390
     C*                                                                   S01390
     C                     MOVE ODATE     EDATE                           S01390
     C                     MOVELONARRA    NARR                            S01390
     C                     MOVE ORATE     RATE                            S01390
     C                     MOVE ODAYS     DAYS                            S01390
     C                     MOVE AMT       PAMT                            S01390
     C                     MOVE BAL       PBAL                            S01390
     C                     MOVE INTR      PINT                            S01390
     C                     WRITEDETLIN                                    S01390
     C                     MOVEL'1'       *IN43                           073175
     C*                                                                   S01390
     C**   CHECK FOR PAGE OVERFLOW
     C*                                                                   S01390
     C           *IN18     IFEQ '1'                                       S01390
     C                     WRITECUHEAD                                    S01390
     C                     WRITEDLHEAD                                    S01390
     C                     MOVE '0'       *IN18                           S01390
     C                     END                                            S01390
     C*                                                                   S01390
     C           REP01     TAG                                            S01390
     C*                                                                   S01390
     C                     ADD  1         RRN                             S01390
     C*                                                                   S01390
     C                     END                                            S01390
     C                     END                                            S01390
     C*                                                                   073175
     C                     WRITETOTLIN                                    188461
     C*                                                                   188461
     C           *IN43     IFEQ '1'                                       073175
     C                     WRITETOTLIN                                    073175
     C                     END                                            073175
     C*
     C           ENDMAN    ENDSR                           ** END OF MAIN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C*    END PROCESSING SUBROUTINE
     C*
     C           END       BEGSR                           *** END SUBR  *
     C*                                                                   073175
     C                     SETON                     LR                   073175
     C                     RETRN                                          188461
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/SPACE 3                                                            S01390
     C*COPY*ZSRSRC,ZALIGNZ2*************************************** S01390 073175
** CPY@   **      OBJECT COPYRIGHT                                        S01390
(c) Finastra International Limited 2001
