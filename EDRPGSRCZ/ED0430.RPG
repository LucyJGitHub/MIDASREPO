     H        1
      *****************************************************************
/*OVRF*  OVRDBF FILE(EDPCSJPD) TOFILE(EDNEWJPD)                       *
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ED FRA/IRS deals file special processing')
      *****************************************************************
      *                                                               *
      *  Midas  -  Midas Export Data Module                           *
      *                                                               *
      *  ED0430 - FRA/IRS Deals file special processing program (i/c) *
      *                                                               *
      *  Function: This program is one of the 'Special Processing     *
      *            programs' that are called when the Drip Feed       *
      *            process encounters a journal entry from a certain  *
      *            file. In this case the file is PF/DEALSDG. This    *
      *            program also processes Date Schedule, Cash Flow    *
      *            Schedule and Principle Change Schedule files.      *
      *                                                               *
      *  Called By: ED0060 - Extract Journal entries within comit     *
      *                                                               *
      *  Calls: AOSARDR0 - Access program for switchable features     *
      *                                                               *
      *  Notes:  i) Created with override for EDPCSCPD to EDNEWJPD    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CDL028             Date 07Feb05               *
      *  Prev Amend No. 217684             Date 12May03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP056             Date 13Mar02               *
      *                 CIR008             Date 13Mar02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR005             Date 21Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 124473             Date 22OCT97               *
      *                 CED003 *CREATE     DATE 12JUN97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  217684 - Authorisation User Malfunction (Recompile)          *
      *  CAP056 - Automatic Authorisation of Interface deals          *
      *           (Recompile)                                         *
      *  CIR008 - FRA/IRS Deals Authorisation (Recompile)             *
      *  CIR005 - FRA/IRS Business Day Conventions to DEALSDG         *
      *           (recompile)                                         *
      *  124473 - Repo deal gives database error 008 in ED0060        *
      *  CED003 - Extract IRS details for IRS's in ED Module          *
      *                                                               *
      *****************************************************************
      *
     FEDNEWJL4UF  E           K        DISK         KINFSR *PSSR
     F            QJORDJE                           KRENAMEEDNEWJD4
      * New journal entries by journal sequence
      *
     FEDOLDJL4UF  E           K        DISK         KINFSR *PSSR
     F            QJORDJE                           KRENAMEEDOLDJD4
      * Old journal entries by journal sequence
      *
     FEDJRNEPDO   E                    DISK         KINFSR *PSSR
     F            QJORDJE                           KRENAMEEDJRNED1
      *
     FDLDTSCPDIF  E           K        DISK         KINFSR *PSSR
      * Date Schedule file
      *
     FDLCFSCPDIF  E           K        DISK         KINFSR *PSSR
      * Cash-Flow Schedule file
      *
     FDLPCSCPDIF  E           K        DISK         KINFSR *PSSR
      * Principal Change Schedule file
      *
     FEDBFRJPDIF  E           K        DISK         KINFSR *PSSR      UC
     F            QJORDJE                           KRENAMEEDBFRJD1
      * Journal Entries by sequence no.
      *
     FEDPCSJPDIF  E           K        DISK         KINFSR *PSSR      UC
     F            QJORDJE                           KRENAMEEDPCSJD1
      * Journal entries for DLPCSCPD
      *
      /TITLE FUNCTION OF INDICATORS
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *    01  -  EoF EDNEWJL4 or EDOLDJL4                            *
      *    40  -  Chain/Read of PF/DLDTSCPD                           *
      *    41  -  Chain/Read of PF/DLPCSCPD                           *
      *    42  -  Read of EDBFRJPD                                    *
      *    43  -  Read of EDPCSJPD                                    *
      *    44  -  Chain/Read of PF/DLCFSCPD                           *
      *                                                               *
      *  U7+U8 - Database Error                                       *
      *                                                               *
      *****************************************************************
      /TITLE SUBROUTINE INDEX
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  INIT   - Initial Processing                                  *
      *  PROCES - Perform Detail Processing                           *
      *  CRTJRN - Journal Entry Processing for all programs           *
      *  CRT2   - Journal Entry Processing for insert                 *
      *  CRT3   - Journal Entry Processing for amend                  *
      *  FMTDT  - Format journal information for EDJRNEPD from        *
      *           PF/DLDTSCPD                                         *
      *  FMTCFU - Format journal information for EDJRNEPD from        *
      *           PF/DLCFSCPD (our side)                              *
      *  FMTCFT - Format journal information for EDJRNEPD from        *
      *           PF/DLCFSCPD (their side)                            *
      *  FMTPCU - Format journal information for EDJRNEPD from        *
      *           PF/DLPCSCPD (our side)                              *
      *  FMTPCT - Format journal information for EDJRNEPD             *
      *           PF/DLPCSCPD (their side)                            *
      *  FTPCUD - Format journal information for EDJRNEPD             *
      *           PF/DLPCSCPD (our side, delete)                      *
      *  FTPCTD - Format journal information for EDJRNEPD             *
      *           PF/DLPCSCPD (their side, delete)                    *
      *  FMTEDU - Format journal information for EDJRNEPD from        *
      *           PF/EDPCSJPD (our side)                              *
      *  FMTEDT - Format journal information for EDJRNEPD             *
      *           PF/EDPCSJPD (their side)                            *
      *  WRITE  - Write a EDJRNEPD record                             *
      *  *PSSR  - Program error handling routine                      *
      *                                                               *
      *****************************************************************
     E/TITLE E-SPECIFICATIONS
     E                    CPY@    1   1 80
      **  Array for Object Copyright Statement.
      *
     E                    DATA1     125  1
     E                    DATA2    3971  1
      ** Arrays for input parameters
      *
     E                    DLCA     3971  1
     E                    DLPA     3971  1
      *
     I/TITLE I-SPECIFICATIONS
      *-----------------------------------------------------------
     IDLDTSCD0
      ** DS for Date Schedule
     I              DLNO                            DDLNO
     I              OTIN                            DOTIN
     I              PRDT                            DPRDT
     I              RCIP                            DRCIP
     I              COHO                            DCOHO
     I              DTPR                            DDTPR
      *
      *-----------------------------------------------------------
     IDLCFSCD0
      ** DS for Cash-Flow Schedule
     I              DLNO                            CDLNO
     I              OTIN                            COTIN
     I              PRDT                            CPRDT
     I              CFLA                            CCFLA
     I              COHO                            CCOHO
     I              DTPR                            CDTPR
      *
      *-----------------------------------------------------------
     IDLPCSCD0
      ** DS for Principal Change Schedule
     I              DLNO                            PDLNO
     I              OTIN                            POTIN
     I              PRDT                            PPRDT
     I              PAMT                            PPAMT
     I              COHO                            PCOHO
     I              DTPR                            PDTPR
      *
      *-----------------------------------------------------------
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
      *-----------------------------------------------------------
     ISCSARD    E DSSCSARDPD
      ** DS for Switchable Features file
      *
      *-----------------------------------------------------------
     IDEALS     E DSDEALSDG
      ** DS for Deals file
     I              LCD                             DLCD
      *
      *-----------------------------------------------------------
     IDLDT      E DSDLDTSCPD
      ** DS for Date Schedule
     I              DLNO                            DDLNO
     I              OTIN                            DOTIN
     I              PRDT                            DPRDT
     I              RCIP                            DRCIP
     I              COHO                            DCOHO
     I              DTPR                            DDTPR
      *
      *-----------------------------------------------------------
     IDLCF      E DSDLCFSCPD
      ** DS for Cash-Flow Schedule
     I              DLNO                            CDLNO
     I              OTIN                            COTIN
     I              PRDT                            CPRDT
     I              CFLA                            CCFLA
     I              COHO                            CCOHO
     I              DTPR                            CDTPR
      *
      *-----------------------------------------------------------
     IDLPC      E DSDLPCSCPD
      ** DS for Principal Change Schedule
     I              DLNO                            PDLNO
     I              OTIN                            POTIN
     I              PRDT                            PPRDT
     I              PAMT                            PPAMT
     I              COHO                            PCOHO
     I              DTPR                            PDTPR
      *
      *-----------------------------------------------------------
     I            DS
      ** Data Structure for Journal record data parameter
     I                                        1 125 IN1
     I                                        1   50INENTL
     I                                        6  150INSEQN
     I                                        6  15 ALSEQN
     I                                       16  16 INCODE
     I                                       17  18 INENTT
     I                                       19  24 INDATE
     I                                       25  300INTIME
     I                                       31  40 INJOB
     I                                       41  50 INUSER
     I                                       51  560INNBR
     I                                       57  66 INPGM
     I                                       67  76 INOBJ
     I                                       77  86 INLIB
     I                                       87  96 INMBR
     I                                       97 1060INCTRR
     I                                      107 107 INFLAG
     I                                      108 1170INCCID
     I                                      118 125 INRES
      *
      *-----------------------------------------------------------
     I            DS
      ** Data Structure for EDJRNEPD output
     I                                        1 125 OUT1
     I                                        1   50JOENTL
     I                                        6  150JOSEQN
     I                                       16  16 JOCODE
     I                                       17  18 JOENTT
     I                                       19  24 JODATE
     I                                       25  300JOTIME
     I                                       31  40 JOJOB
     I                                       41  50 JOUSER
     I                                       51  560JONBR
     I                                       57  66 JOPGM
     I                                       67  76 JOOBJ
     I                                       77  86 JOLIB
     I                                       87  96 JOMBR
     I                                       97 1060JOCTRR
     I                                      107 107 JOFLAG
     I                                      108 1170JOCCID
     I                                      108 1110#CCID
     I                                      118 125 JORES
      *-----------------------------------------------------------
     IWOVR        DS                            125
      **  DS for QCMDEXC
     I******                                 61  700WDSEQN                124473
     I                                       62  710WDSEQN                124473
     I                                       80  890@SEQN
      *
      *-----------------------------------------------------------
      **  Constant for QCMDEXC (DEALSDG journal entries)
      *
     I***********   'DSPJRN JRN(ICJRN) FI-C         QOVR                  124473
     I***********   'LE((DEALSDG)) RCVRNG-                                124473
     I***********   '(*CURCHAIN) FROMENT(-                                124473
     I***********   'XXXXXXXXXX) OUTPUT(*-                                124473
     I***********   'OUTFILE) OUTFILE(EDB-                                124473
     I***********   'FRJPD)'                                              124473
     I              'DSPJRN JRN(ICJRN) FI-C         QOVR                  124473
     I              'LE((DEALSDG)) RCVRNG-                                124473
     I              '(*CURCHAIN) CMTCYCID-                                124473
     I              '(XXXXXXXXXX) OUTPUT(-                                124473
     I              '*OUTFILE) OUTFILE(ED-                                124473
     I              'BFRJPD)'                                             124473
      *-----------------------------------------------------------
      **  Constant for QCMDEXC (DLPCSCPD journal entries)
      *
     I              'DSPJRN JRN(ICJRN) FI-C         @OVR
     I              'LE((DLPCSCPD)) RCVRN-
     I              'G(*CURCHAIN) ENTTYP(-
     I              'PT UP DL) CMTCYCID(X-
     I              'XXXXXXXXX) OUTPUT(*O-
     I              'UTFILE) OUTFILE(EDPC-
     I              'SJPD)'
      *-----------------------------------------------------------
     IDBERR       DS                            256
      * Data structure for data-base error processing.
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *-----------------------------------------------------------
     I            DS
      * Data Structure for saving original DEALSDG data
     I                                    P   1   30@UPCD
     I                                    P   4   60@TPCD
     I                                        7   9 @UCCY
     I                                       10  12 @TCCY
     I                                       13  14 @DTYP
      *-----------------------------------------------------------
     I            DS
      *
     I                                        1   40COMID
      *-----------------------------------------------------------
     I            DS
      *
     I                                        1   60KDLNO
     I                                        7   7 KOTIN
     I                                    P   8  100KPRDT
     I                                       11  11 KRCIP
      *-----------------------------------------------------------
     I            DS
      *
     I                                        1   60DLNOK
     I                                        7   7 OTINK
     I                                    P   8  100PRDTK
      **
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M     S T A R T                                  *
      *================================================================
      *
      ***  Parameter entry list
     C           *ENTRY    PLIST
      *IN PARAMETERS
     C                     PARM           DATA1
     C                     PARM           DATA2
     C                     PARM           SRCF    1
      *OUT PARAMETERS
     C                     PARM JOOBJ     CDFILE  8
     C                     PARM ALSEQN    CDBKEY 10
     C                     PARM           WRTCD1  1
     C                     PARM           RECCNT  50
      *
      ** Perform Initial Processing
      *
     C                     EXSR INIT
      *
      ** Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      *================================================================
      *  P R O G R A M     E N D                                      *
      *                                                               *
     C                     SETON                     LR               *
     C                     RETRN                                      *
      *                                                               *
      *================================================================
      *
      *****************************************************************
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT - Subroutine to do the Initial Processing.              *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ***  Copyright Statement and initialisation
      *
     C                     MOVEACPY@      MKI@   80
     C                     Z-ADD*ZERO     RECCNT
      *
      ** Key list to chain to PF/DLDTSCPD
      *
     C           KEY1      KLIST
     C                     KFLD           KDLNO
     C                     KFLD           KOTIN
     C                     KFLD           KRCIP
     C                     KFLD           KPRDT
      *
      ** Key list to chain to PF/DLPCSCPD and PF/DLCFSCPD
      *
     C           KEY2      KLIST
     C                     KFLD           DLNOK
     C                     KFLD           OTINK
     C                     KFLD           PRDTK
      *
      ** Call Access object AOSARDR0 to check if IRC switchable feature
      ** is installed.
      *
     C                     MOVE 'N'       CIR001  1
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   RTNCD   7
     C                     PARM '*VERIFY' OPTN    7
     C                     PARM 'CIR001'  PSARN   6
     C           SCSARD    PARM SCSARD    DSFDY
      *
      ** If error found execute error routine.
      *
     C           RTNCD     IFNE *BLANK
     C           RTNCD     ANDNE'*NRF'
     C                     MOVEL'SCSARDPD'DBFILE            *************
     C                     Z-ADD1         DBASE             *DBERROR 012*
     C                     MOVELPSARN     DBKEY             *************
     C                     MOVEL'ED0430  'DBPGM
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** IRC switchable feature installed.
      *
     C           RTNCD     IFEQ *BLANK
     C                     MOVE 'Y'       CIR001
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ** Initialise Commitment ID for records
      *
     C                     Z-ADD9001      COMID
      *
      ** Set-up the data from the input parameters so that it can be used.
      *
     C                     MOVEADATA1     IN1
     C                     MOVEADATA2     DEALS
      *
     C                     MOVEADATA1     OUT1      P
     C                     MOVEADATA2     JOESD     P
      *
      ** Write to the batch member
      *
     C                     EXSR WRITE
      *
      ** Continue by deleting the record read in by ED0060.
      ** Use the journal sequence number from the incoming data parameter
      ** to delete the record from 'Old' or 'New' as appropriate.
      *
     C           SRCF      IFEQ 'N'                        B001
      *
     C           INSEQN    DELETEDNEWJD4             01
      *
     C           *IN01     IFEQ '1'                        B002
     C                     Z-ADD02        DBASE            ***************
     C                     MOVEL'EDNEWJL4'DBFILE           * DB ERROR 02 *
     C                     MOVE INSEQN    DBKEY            ***************
     C                     EXSR *PSSR
     C                     ENDIF                           E002
      *
     C                     ELSE                            X001
      *
     C           INSEQN    DELETEDOLDJD4             01
      *
     C           *IN01     IFEQ '1'                        B002
     C                     Z-ADD03        DBASE            ***************
     C                     MOVEL'EDOLDJL4'DBFILE           * DB ERROR 03 *
     C                     MOVE INSEQN    DBKEY            ***************
     C                     EXSR *PSSR
     C                     ENDIF                           E002
      *
     C                     ENDIF                           E001
      *
      ** Generate an Interest Rate Swaps Journal Entry
      *
     C           CIR001    IFEQ 'Y'                        B001
      *
      ** Program on Journal Entry is Insert/Amend program for RS and
      ** RX deals, generate appropiate journal entries for Date
      ** Schedule and Cash flow schedule details.
      *
     C           INPGM     IFEQ 'DL1602I'                  B002
     C           INPGM     OREQ 'DL1602A'
     C           INPGM     OREQ 'DL1603I'
     C           INPGM     OREQ 'DL1603A'
     C                     EXSR CRTJRN
     C                     ENDIF                           E002
      *
      ** Program on Journal Entry is Insert program, generate
      ** appropiate journal entries for Principle change records.
      *
     C           INPGM     IFEQ 'DL1602I'                  B002
     C           INPGM     OREQ 'DL1603I'
     C                     EXSR CRT2
     C                     ENDIF                           E002
      *
      ** Program on Journal Entry is Amend program, generate
      ** appropiate journal entries for Principle change records.
      *
     C           INPGM     IFEQ 'DL1602A'                  B002
     C           INPGM     OREQ 'DL1603A'
     C                     EXSR CRT3
     C                     ENDIF                           E002
      *
      ** Note: No other records need to be written to PF/EDJRNEPD for
      ** Deal reversal.
      *
     C                     ENDIF                           E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CRTJRN
      *****************************************************************
      *                                                               *
      *  CRTJRN - Journal Entry Processing for all programs for       *
      *           Date and Cash flow schedule.                        *
      *                                                               *
      *  Called By: PROCES - Detail processing                        *
      *                                                               *
      *****************************************************************
      *
     C           CRTJRN    BEGSR
      *
      ** Our interest payment frequency = Z, find record on
      ** PF/DLDTSCPD.
      *
     C           UIPFR     IFEQ 'Z'                        B001
     C                     Z-ADDDLNO      KDLNO
     C                     MOVE 'U'       KOTIN
     C                     MOVE 'P'       KRCIP
     C                     Z-ADD0         KPRDT
      *
     C           KEY1      SETLLDLDTSCPD             40
     C                     READ DLDTSCPD                 40
      *
      ** Process all records with same deal no., our/their indicator,
      ** and Interest Rate/Payment Indicator.
      *
     C           *IN40     DOWEQ'0'                        B002
     C           DDLNO     ANDEQKDLNO
     C           DOTIN     ANDEQKOTIN
     C           DRCIP     ANDEQKRCIP
      *
      ** Format journal entry.
      *
     C                     EXSR FMTDT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLDTSCPD                 40
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Their interest payment frequency = Z, find record on
      ** PF/DLDTSCPD.
      *
     C           TIPFR     IFEQ 'Z'                        B001
     C                     Z-ADDDLNO      KDLNO
     C                     MOVE 'T'       KOTIN
     C                     MOVE 'P'       KRCIP
     C                     Z-ADD0         KPRDT
      *
     C           KEY1      SETLLDLDTSCPD             40
     C                     READ DLDTSCPD                 40
      *
      ** Process all records with same Deal no., our/their indicator,
      ** and Interest Rate/Payment Indicator.
      *
     C           *IN40     DOWEQ'0'                        B002
     C           DDLNO     ANDEQKDLNO
     C           DOTIN     ANDEQKOTIN
     C           DRCIP     ANDEQKRCIP
      *
      ** Format journal entry.
      *
     C                     EXSR FMTDT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLDTSCPD                 40
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Our rate change frequency = Z, find record on
      ** PF/DLDTSCPD.
      *
     C           UICFR     IFEQ 'Z'                        B001
     C                     Z-ADDDLNO      KDLNO
     C                     MOVE 'U'       KOTIN
     C                     MOVE 'R'       KRCIP
     C                     Z-ADD0         KPRDT
      *
     C           KEY1      SETLLDLDTSCPD             40
     C                     READ DLDTSCPD                 40
      *
      ** Process all records with same Deal no., our/their indicator,
      ** and Interest Rate/Payment Indicator.
      *
     C           *IN40     DOWEQ'0'                        B002
     C           DDLNO     ANDEQKDLNO
     C           DOTIN     ANDEQKOTIN
     C           DRCIP     ANDEQKRCIP
      *
      ** Format journal entry.
      *
     C                     EXSR FMTDT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLDTSCPD                 40
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Their rate change frequency = Z, find record on
      ** PF/DLDTSCPD.
      *
     C           TICFR     IFEQ 'Z'                        B001
     C                     Z-ADDDLNO      KDLNO
     C                     MOVE 'T'       KOTIN
     C                     MOVE 'R'       KRCIP
     C                     Z-ADD0         KPRDT
      *
     C           KEY1      SETLLDLDTSCPD             40
     C                     READ DLDTSCPD                 40
      *
      ** Process all records with same Deal no., our/their indicator,
      ** and Interest Rate/Payment Indicator.
      *
     C           *IN40     DOWEQ'0'                        B002
     C           DDLNO     ANDEQKDLNO
     C           DOTIN     ANDEQKOTIN
     C           DRCIP     ANDEQKRCIP
      *
      ** Format journal entry.
      *
     C                     EXSR FMTDT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLDTSCPD                 40
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Our interest payment frequency = C, find record on
      ** PF/DLCFSCPD.
      *
     C           UIPFR     IFEQ 'C'                        B001
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'U'       OTINK
     C                     Z-ADD0         PRDTK
      *
     C           KEY2      SETLLDLCFSCPD             44
     C                     READ DLCFSCPD                 44
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN44     DOWEQ'0'                        B002
     C           CDLNO     ANDEQDLNOK
     C           COTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FMTCFU
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLCFSCPD                 44
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Their interest payment frequency = C, find record on
      ** PF/DLCFSCPD.
      *
     C           TIPFR     IFEQ 'C'                        B001
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'T'       OTINK
     C                     Z-ADD0         PRDTK
      *
     C           KEY2      SETLLDLCFSCPD             44
     C                     READ DLCFSCPD                 44
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN44     DOWEQ'0'                        B002
     C           CDLNO     ANDEQDLNOK
     C           COTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FMTCFT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLCFSCPD                 44
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CRT2
      *****************************************************************
      *                                                               *
      *  CRT2   - Journal Entry Processing for Insert programs for    *
      *           Principle change schedule                           *
      *                                                               *
      *  Called By: PROCES - detail processing                        *
      *                                                               *
      *****************************************************************
      *
     C           CRT2      BEGSR
      *
      ** Our next principle change date not zero, OUR schedule has
      ** been inserted.
      *
     C           UNPCD     IFNE 0                          B001
      *
      ** Program in journal entry = DL1603I(RS Deal), find record on
      ** PF/DLPCSCPD
      *
     C           INPGM     IFEQ 'DL1603I'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'U'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program in journal entry = DL1602I(RX Deal), find record on
      ** PF/DLPCSCPD
      *
     C                     ELSE                            X003
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B002
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     MOVELUCUCY     @UCCY
     C                     EXSR FMTPCU
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Their next principle change date not zero, THEIR schedule
      ** has been inserted.
      *
     C           TNPCD     IFNE 0                          B001
      *
      ** Program on journal entry is DL1603I(RS Deal), find record on
      ** PF/DLPCSCPD.
      *
     C           INPGM     IFEQ 'DL1603I'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'T'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program on journal entry is DL1602I(RX Deal), find record on
      ** PF/DLPCSCPD.
      *
     C                     ELSE                            X002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B002
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     MOVELTCUCY     @TCCY
     C                     EXSR FMTPCT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CRT3
      *****************************************************************
      *                                                               *
      *  CRT3   - Journal Entry Processing for Amend programs         *
      *                                                               *
      *  Called By: PROCES - detail processing                        *
      *                                                               *
      *****************************************************************
      *
     C           CRT3      BEGSR
      *
      ** Produce before image journal entries from PF/DEALSDG in
      ** PF/EDBFRJPD.
      *
     C                     MOVELQOVR      WOVR
     C***********INSEQN    SUB  1         WDSEQN                          124473
     C                     Z-ADDINCCID    WDSEQN                          124473
     C******               CALL 'QCMDEXC'                                 124473
     C                     CALL 'QCMDEXC'                51               124473
     C                     PARM           WOVR
     C                     PARM 107       QLEN   155
     C           *IN51     IFEQ '1'                                       124473
     C                     Z-ADD04        DBASE            ***************124473
     C                     MOVEL'QCMDEXC 'DBFILE           * DB ERROR 04 *124473
     C                     MOVE WDSEQN    DBKEY            ***************124473
     C                     EXSR *PSSR                                     124473
     C                     ENDIF                                          124473
      *                                                                   124473
      *
      ** Save fields from DEALSDG for later use
      *
     C                     Z-ADDUNPCD     @UPCD
     C                     Z-ADDTNPCD     @TPCD
     C                     MOVELUCUCY     @UCCY
     C                     MOVELTCUCY     @TCCY
     C                     MOVELDTYP      @DTYP
      *
      ** Read first record on PF/EDBFRJPD
      *
     C                     OPEN EDBFRJPD
     C                     READ EDBFRJPD                 42
      *
      ** Use DEALSDG data structure to retrieve values in EDBFRJPD
      *
     C                     MOVELJOESD     DEALS
      *
      ** Our next principle change date on DEALSDG is not zero and
      ** before image of field on EDBFRJPD is zero, OUR PC schedule
      ** inserted.
      *
     C           @UPCD     IFNE 0                          B001
     C           UNPCD     ANDEQ0
      *
      ** Program on journal entry is DL1603A(RX Deal), find record on
      ** PF/DLPCSCPD.
      *
     C           INPGM     IFEQ 'DL1603A'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'U'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program on journal entry is DL1602A(RS Deal), find record on
      ** PF/DLPCSCPD.
      *
     C                     ELSE                            X002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B002
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FMTPCU
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Their next principle change date on DEALSDG is not zero and
      ** before image of field on EDBFRJPD is zero, THEIR PC
      ** schedule inserted.
      *
     C           @TPCD     IFNE 0                          B001
     C           TNPCD     ANDEQ0
      *
      ** Program on journal entry is DL1603A(RX Deal), find record on
      ** PF/DLPCSCPD.
      *
     C           INPGM     IFEQ 'DL1603A'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'T'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program on journal entry is DL1602A(RS Deal), find record on
      ** PF/DLPCSCPD.
      *
     C                     ELSE                            X002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B002
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FMTPCT
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Our next principle change date on DEALSDG is zero and
      ** before image of field on EDBFRJPD is not zero, OUR PC
      ** schedule has been removed.
      *
     C           @UPCD     IFEQ 0                          B001
     C           UNPCD     ANDNE0
      *
      ** Program on journal entry is DL1603A(RX Deal), find record on
      ** PF/DLPCSCPD.
      *
     C           INPGM     IFEQ 'DL1603A'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'U'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program on journal entry is DL1602A(RS Deal), find record on
      ** PF/DLPCSCPD.
      *
     C                     ELSE                            X002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B003
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FTPCUD
      *
      **  output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E003
     C                     ENDIF                           E002
      *
      ** Their next principle change date on DEALSDG is zero and
      ** before image of field on EDBFRJPD is not zero, THEIR PC
      ** schedule has been removed.
      *
     C           @TPCD     IFEQ 0                          B001
     C           TNPCD     ANDNE0
      *
      ** Program on journal entry is DL1603A(RX Deal), find record on
      ** PF/DLPCSCPD.
      *
     C           INPGM     IFEQ 'DL1603A'                  B002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'T'       OTINK
     C                     Z-ADD0         PRDTK
      *
      ** Program on journal entry is DL1602A(RS Deal), find record on
      ** PF/DLPCSCPD.
      *
     C                     ELSE                            X002
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
     C                     ENDIF                           E002
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
      ** Process all records with same Deal no., our/their indicator,
      *
     C           *IN41     DOWEQ'0'                        B002
     C           PDLNO     ANDEQDLNOK
     C           POTIN     ANDEQOTINK
      *
      ** Format journal entry.
      *
     C                     EXSR FTPCTD
      *
      ** output to EDJRNEPD
      *
     C                     EXSR WRITE
      ** Read next record
     C                     READ DLPCSCPD                 41
     C                     ENDDO                           E002
     C                     ENDIF                           E001
      *
      ** Our/Their next principle change date are not zero and the
      ** before images of the fields on EDBFRJPD are not zero, PC
      ** schedule has been amended.
      *
     C           @UPCD     IFNE 0                          B001
     C           UNPCD     ANDNE0
     C           @TPCD     ORNE 0
     C           TNPCD     ANDNE0
      *
      ** Produce records on PF/EDPCSJPD for all Principle
      ** change schedule journal entries to determine which PC
      ** records have been changed.
      *
     C                     MOVEL@OVR      WOVR
     C                     Z-ADDINCCID    @SEQN
     C                     CALL 'QCMDEXC'              02
     C                     PARM           WOVR
     C                     PARM 125       QLEN   155
      *
      ** If no entries converted from journal for PF/DLPCSCPD, then
      ** processing skipped, (error occurred during call of QCMDEXC)
      ** otherwise read journal entries.
      *
     C           *IN02     IFEQ '0'                        B002
      *
     C                     OPEN EDPCSJPD
     C                     READ EDPCSJPD                 43
     C                     MOVELJOESD     DLPC
      *
      ** Process all records in PF/EDPCSJPD, if Deal type is RS then
      ** two journal entries need to be written to PF/EDJRNEPD.
      *
     C           *IN43     DOWEQ'0'                        B003
     C           @DTYP     IFEQ 'RS'                       B004
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE *BLANK    OTINK
     C                     Z-ADD0         PRDTK
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
      *
     C                     EXSR FMTEDU
     C                     EXSR WRITE
      *
     C                     EXSR FMTEDT
     C                     EXSR WRITE
      *
      ** Deal type is RX, one journal entry written to PF/EDJRNEPD
      ** depending on our/their indicator.
      *
     C                     ELSE                            X004
     C           POTIN     IFEQ 'T'                        B005
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'T'       OTINK
     C                     Z-ADD0         PRDTK
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
     C                     EXSR FMTEDT
     C                     EXSR WRITE
     C                     ENDIF                           E005
      *
     C           POTIN     IFEQ 'U'                        B005
     C                     Z-ADDDLNO      DLNOK
     C                     MOVE 'U'       OTINK
     C                     Z-ADD0         PRDTK
      *
     C           KEY2      SETLLDLPCSCPD             41
     C                     READ DLPCSCPD                 41
     C                     EXSR FMTEDU
     C                     EXSR WRITE
     C                     ENDIF                           E005
      *
     C                     ENDIF                           E004
      * Read next record
     C                     READ EDPCSJPD                 43
     C                     ENDDO                           E003
     C                     ENDIF                           E002
     C                     ENDIF                           E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTDT
      *****************************************************************
      *                                                               *
      *  FMTDT - Format simulated journal information for EDJRNEPD    *
      *          from DLDTSCPD                                        *
      *                                                               *
      *  Called By: CRTJRN -                                          *
      *                                                               *
      *****************************************************************
      *
     C           FMTDT     BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVE 'PT'      JOENTT
     C                     MOVEL'DLDTSCPD'JOOBJ
     C                     MOVEL'DLDTSCPD'JOMBR
     C                     MOVELDLDT      JOESD     P
     C                     Z-ADD125       JOENTL
     C                     ADD  13        JOENTL
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTCFU
      *****************************************************************
      *                                                               *
      *  FMTCFU- Format simulated journal information for EDJRNEPD    *
      *          from DLCFSCPD ('our' side)                           *
      *                                                               *
      *  Called By: CRTJRN                                            *
      *                                                               *
      *****************************************************************
      *
     C           FMTCFU    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C           UINPM     IFEQ 'D'
     C           CPRDT     ANDEQVDAT
     C           UINPM     OREQ 'Y'
     C           CPRDT     ANDEQVDAT
     C           UINPM     ORNE 'D'
     C           UINPM     ANDNE'Y'
     C           CPRDT     ANDEQMDAT
     C                     MOVE 'UP'      JOENTT
     C                     ELSE
     C                     MOVE 'PT'      JOENTT
     C                     ENDIF
      *
     C                     MOVEL'DLCFSCPD'JOOBJ
     C                     MOVEL'DLCFSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  19        JOENTL
      *
      ** Add Our currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLCF      DLCA
     C                     Z-ADD20        X       50
     C                     MOVEAUCUCY     DLCA,X
     C                     MOVEADLCA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTCFT
      *****************************************************************
      *                                                               *
      *  FMTCFT- Format simulated journal information for EDJRNEPD    *
      *          from DLCFSCPD ('their' side)                         *
      *                                                               *
      *  Called By: CRTJRN                                            *
      *                                                               *
      *****************************************************************
      *
     C           FMTCFT    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C           TINPM     IFEQ 'D'
     C           CPRDT     ANDEQVDAT
     C           TINPM     OREQ 'Y'
     C           CPRDT     ANDEQVDAT
     C           TINPM     ORNE 'D'
     C           TINPM     ANDNE'Y'
     C           CPRDT     ANDEQMDAT
     C                     MOVE 'UP'      JOENTT
     C                     ELSE
     C                     MOVE 'PT'      JOENTT
     C                     ENDIF
      *
     C                     MOVEL'DLCFSCPD'JOOBJ
     C                     MOVEL'DLCFSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  19        JOENTL
      *
      ** Add Their currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLCF      DLCA
     C                     Z-ADD20        X
     C                     MOVEATCUCY     DLCA,X
     C                     MOVEADLCA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTPCU
      *****************************************************************
      *                                                               *
      *  FMTPCU- Format simulated journal information for EDJRNEPD    *
      *          from DLPCSCPD ('Our' side)                           *
      *                                                               *
      *  Called By: CRT2                                              *
      *             CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FMTPCU    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVE 'PT'      JOENTT
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to U
      *
     C                     MOVE 'U'       POTIN
      *
      ** Add Our currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@UCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTPCT
      *****************************************************************
      *                                                               *
      *  FMTPCT- Format simulated journal information for EDJRNEPD    *
      *          from DLPCSCPD ('Their side')                         *
      *                                                               *
      *  Called By: CRT2                                              *
      *             CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FMTPCT    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVE 'PT'      JOENTT
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to T
      *
     C                     MOVE 'T'       POTIN
      *
      ** Add Their currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@TCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FTPCUD
      *****************************************************************
      *                                                               *
      *  FTPCUD- Format simulated journal information for EDJRNEPD    *
      *          from DLPCSCPD ('Our' side, delete action)            *
      *                                                               *
      *  Called By: CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FTPCUD    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVE 'DL'      JOENTT
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to U
      *
     C                     MOVE 'U'       POTIN
      *
      ** Add Our currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@UCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FTPCTD
      *****************************************************************
      *                                                               *
      *  FTPCTD- Format simulated journal information for EDJRNEPD    *
      *          from DLPCSCPD ('Their' side, delete action)          *
      *                                                               *
      *  Called By: CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FTPCTD    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVE 'DL'      JOENTT
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to T
      *
     C                     MOVE 'T'       POTIN
      *
      ** Add Their currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@TCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTEDU
      *****************************************************************
      *                                                               *
      *  FMTRXU- Format simulated journal information for EDJRNEPD    *
      *          from EDPCSJPD ('Our' side)                           *
      *                                                               *
      *  Called By: CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FMTEDU    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to U
      *
     C                     MOVE 'U'       POTIN
      *
      ** Add Our currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@UCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FMTRXT
      *****************************************************************
      *                                                               *
      *  FMTEDT- Format simulated journal information for EDJRNEPD    *
      *          from EDPCSJPD ('Their' side)                         *
      *                                                               *
      *  Called By: CRT3                                              *
      *                                                               *
      *****************************************************************
      *
     C           FMTEDT    BEGSR
      *
      ** Move data into fields for output to EDJRNEPD.
      *
     C                     MOVEL'DLPCSCPD'JOOBJ
     C                     MOVEL'DLPCSCPD'JOMBR
     C                     Z-ADD125       JOENTL
     C                     ADD  20        JOENTL
      *
      ** Change our/their indicator to T
      *
     C                     MOVE 'T'       POTIN
      *
      ** Add Their currency from DEALSDG to end of journal record.
      *
     C                     MOVEADLPC      DLPA
     C                     Z-ADD21        X
     C                     MOVEA@TCCY     DLPA,X
     C                     MOVEADLPA      JOESD     P
      *
      ** Create unique ID for each record.
      *
     C                     Z-ADDINCCID    JOCCID
     C                     Z-ADDCOMID     #CCID
     C                     ADD  1         COMID
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WRITE
      *****************************************************************
      *                                                               *
      *  WRITE - Write a detail record to EDJRNEPD                    *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *****************************************************************
      *
     C           WRITE     BEGSR
      *
     C                     WRITEEDJRNED1
     C                     ADD  1         RECCNT
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Program Error Processing Subroutine.                *
      *                                                               *
      *  Called By: Various                                           *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           *** *PSSR  ***
      *
     C                     SETON                     U7U8LR
     C                     MOVE 'E'       WRTCD1
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK                     B1
     C                     MOVE 'Y'       WRUN    1
     C                     MOVEL'ED0430'  DBPGM
      *
     C           *NAMVAR   DEFN LDA       WLDA  256
     C           *LOCK     IN   WLDA
     C                     MOVELDBERR     WLDA
     C                     OUT  WLDA
     C                     DUMP
     C                     ENDIF                           E1
      *
      ** Exit program
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE COMPILE-TIME ARRAYS
      ***
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
