      *****************************************************************
/*STD *: PGMBASE                                                    : *
/*EXI *  TEXT('Midas EM Trade finance account balance update')        *
/*E*I *:*MODULE(EM0452M)*BNDDIR(MIDAS)******************************:**                       CPK016
/*EXI *: MODULE(EM0452M)                                            : *                       CPK016
/*EXI *: ACTGRP(*CALLER)                                            : *
      *****************************************************************
      *                                                               *
      *  Midas - Trade Inovation (TI) Module PHASE II                 *
      *                                                               *
      *  Function:  This program update exposure management trade     *
      *   (COB)     finance details from account balance during the   *
      *             close of business.                                *
      *                                                               *
      *         This program can be runed only if feature CTI002 is   *
      *         active.                                               *
      *                                                               *
      *         Reads all records in file EMTFSAL1 and for each       *
      *         record, zeroise the field SAEXP, account exposure     *
      *                                                               *
      *         Retrieve exposure management currency details(BUCYCD) *
      *         from exposure management standing data file SDEXPML0. *
      *                                                               *
      *         Reads all records in file EMTFCBL0 for customer and   *
      *         account - there will only be one record for each      *
      *         Customer / Account code.                              *
      *                                                               *
      *         Using the customer and account code as key, read all  *
      *         records in file ACCNTL4 - a new file over ACCNT keyed *
      *         by customer and account code.                         *
      *                                                               *
      *         For each record read on file ACCNTL4 , check that the *
      *         currency matches the exposure management standing     *
      *         data currency (BUCYCD). If match, add ledger balance  *
      *         to work field. If does not match, call EM0020 to      *
      *         convert currency and then add converted amount to     *
      *         to work field. At end of read for the customer /      *
      *         account code, update EMTFCBL0 - CBEXP. If there are   *
      *         no records in ACCNTL4 for customer / account code,    *
      *         zeroise CBEXP in EMTFCBL0.                            *
      *                                                               *
      *         Using account code found in EMTFCBL0, retrieve the    *
      *         sub-line type from file EMTFSAL0. Using the sub-line  *
      *         type found, update file EMTFSLL0 - SLEXP with the     *
      *         account balance found from ACCNTL4. If this is the    *
      *         first time the sub-line is read, zeroise the exposure *
      *         balance on file EMTFSLL0  prior to updating with the  *
      *         ledger balance.                                       *
      *                                                               *
      *         Update the customer exposure on file EMDEXX5 - TFEX   *
      *         with the total exposure found for this customer.      *
      *                                                               *
      *         When reading EMTFSAL0 for account code code, there    *
      *         may be an "offsetting account code". Where this is    *
      *         the case, retrieve ledger balance from ACCNTL4 for    *
      *         the offsetting account code as before, and update     *
      *         files EMTFCBL0 - CBOFFB (using account code and       *
      *         customer number CNUM + ACOD);  EMDEXX5 - TFOF (using  *
      *         customer number MCUN).                                *
      *                                                               *
      *  Called By: mmCnnnn - (program name)                          *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD030956           Date 09Oct14               *
      *                 CLE134             Date 01Aug12               *
      *                 CER059             Date 19Jul10               *
      *                 CER045             Date 20Jul09               *
      *                 BUG23967           Date 13May09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CPK016             Date 29Jul03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 167618             Date 13Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CTI002  *CREATE    Date 21SEP98               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  MD030956 - Additional changes to BFM-TI enhancement          *
      *             (Recompile)                                       *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  BUG23967 - Add Local Industry Code Field. (Recompile)        *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CPK016 - Release 5 packaging.  Standardise parameters.       *
      *  167618 - Recompile due to change in EM0452M.                 *
      *                                                               *
      *****************************************************************
