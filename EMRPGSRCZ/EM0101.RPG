     H*                                                                   CDL002
     H        1                                                           CDL002
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas EM Online exposure update')                      *
     F*****************************************************************
     F*                                                               *
     F*  Midas EXPOSURE MANAGEMENT MODULE
     F*                                                               *
     F*  EM0101 - On-Line Exposure Update                             *
     F*                                                               *
     F*  Function: This program runs in the background during input   *
     F*  (I/C)     cycle, updating the customer exposure file (EMCEX) *
     F*            to reflect any transactions inserted, amended or   *
     F*            deleted.                                           *
     F*                                                               *
     F*            This program is the exit program for the 'Receive  *
     F*            Journal Entry' command in EMC0202 and will run at  *
     F*            intervals specified in the Exposure Management ICD *
     F*            (File SDEXPMPD), if any entry of the following type*
     F*            appears on the journal ICJRN:                      *
     F*                                                               *
     F*  File = TABTB10, FXDEALPP, MMDELDPP, MMDENBPP, MMDEAMPP,      *
     F*         CLOANCL, LOAMSDK, FCLTYFM, TRADSD, DPTMVD, SETLED,    *
     F**********DEALSDG, POSTNCD, ACCNTAB, MEMOS.                     *
     F*         DEALSDG, POSTNCD, ACCNTAB, MEMOS, SDACODPD, EMTFEXPD, *   CTI002
     F*         EMTFSAPD, EMTFCBPD, EMTFSLPD.                         *   CTI002
     F*                                                               *
     F*  Journal Code = R, U.                                         *
     F*                                                               *
     F***Entry*Type*=*PT,*UP,*UB,*BR,*UR,*DR,*XJ,*XE*******************   CTI002
     F***Entry*Type*=*PT,*UP,*UB,*BR,*UR,*DR,*XJ,*XE,*DL***************                CTI002 CTI007
     F*  Entry Type = PT, UP, UB, BR, UR, DR, XJ, XE, DL, PX          *                       CTI007
     F*                                                               *
     F*            The program will be cancelled during Input Cycle   *
     F*            Termination.                                       *
     F*                                                               *
     F*  Called By: EMC0202                                           *
     F*                                                               *
     F*  Calls: None                                                  *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD038999           Date 13Jul16               *
      *  Prev Amend No. CLE141             Date 08Feb16               *
      *                 226449             Date 24Jun15               *
      *                 MD034328           Date 06May15               *
      *                 CGL165             Date 17Feb15               *
      *                 MD030956           Date 09Oct14               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 MD029266B          Date 26Aug14               *
      *                 MD029266           Date 20Aug14               *
      *                 MD029270           Date 11Aug14               *
      *                 CTI007             Date 31Mar14               *
      *                 MD020363           Date 06Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 BUG21694           Date 03Mar09               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 181500             Date 05Dec06               *
      *                 169798             Date 05Dec06               *
      *                 134237             Date 30Nov06               *
      *                 241589             Date 29Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 06Jul06               *
      *                 226919             Date 06Jun06               *
      *                 222471             Date 06Jun06               *
      *                 BUG11321           Date 12May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSE071             Date 19Jul05               *
      *                 CDL038             Date 10May05               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 180056             Date 18Oct00               *
      *                 CSE037             Date 29Apr02               *
     F*                 153041             DATE 20JAN99               *
     F*                 135004             DATE 12MAY98               *
      *                 CDL010             Date 02Aug02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 176817             Date 17Oct02               *
      *                 206988             Date 23Jul02               *
      *                 201514             Date 29May02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 167618             Date 13Nov00               *
      *                 CDL008             Date 02May00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 135632             Date 15Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 147997             Date 31May99               *
     F*                 133170             Date 29Apr99               *
     F*                 155631             Date 11Feb99               *
     F*                 CTI002             Date 03Sep98               *
     F*                 CEU020             Date 25Mar98               *
     F*                 CLE005             Date 22May97               *
     F*                 CLE004             Date 02Dec96               *
     F*                 CLE006             Date 02Dec96               *
     F*                 CDL002             Date 17SEP96               *
     F*                 CCB002             DATE 02SEP96               *
     F*                 CFF004             DATE 02OCT96               *
     F*                 S01408             DATE 06AUG96               *
     F*                 S01408             Date 29Apr96               *
     F*                 094081             Date 06Nov95               *
     F*                 S01408             DATE 06FEB96               *
     F*                 092363             DATE 18OCT95               *
     F*                 S01408             DATE 13DEC95               *
     F*                 S01408             DATE 31OCT95               *
     F*                 092163             DATE 04SEP95               *
     F*                 091932             DATE 23AUG95               *
     F*                 090742             DATE 27JUL95               *
     F*                 090794             DATE 27JUL95               *
     F*                 041754             DATE 10OCT95               *  *
     F*                 CIR002             DATE 13JUN95               *  *
     F*                 052254             DATE 10JAN94               *  *
     F*                 053699             DATE 19NOV93               *
     F*                 S01397             DATE 17SEP92               *
     F*                 E27498             DATE 14AUG91               *
     F*                 E26186             DATE 11JUL91               *
     F*                 S01220             DATE 25JUN91               *
     F*                 E14724             DATE 20JUN91               *
     F*                 E23929             DATE 19JUN91               *
     F*                 RT0137/S01339      DATE 01JUN91               *
     F*                 S01332/BHF848      DATE 18JUN91               *
     F*                 E21552             DATE 26MAR90               *
     F*                 E20299             DATE 10JAN90               *
     F*                 E20684             DATE 22DEC89               *
     F*                 E19357             DATE 22DEC89               *
     F*                 LN0071             DATE 16MAY89               *
     F*                 E19669             DATE 12OCT89               *
     F*                 E19310             DATE 01SEP89               *
     F*                 S01117             DATE 24/10/89              *
     F*                 E13735             DATE 28/02/89              *
     F*                 E16054             DATE 10/11/88              *
     F*                 E13665             DATE 05/10/88              *
     F*                 S01176             DATE 18/08/88              *
     F*                 S01129             DATE 06/11/87              *
     F*                 S01128             DATE 12/05/87              *
     F*****************************************************************
      *                                                               *
      *  MD038999 - DB error was issued as account is not existing.   *
      *             This might be due to account transfer so no need  *
      *             to issue DB error.                                *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
      *         - Applied for MD034387.                               *
      *  MD034328 - EM0101 job is not running. Adjust data structure  *
      *             of currency.                                      *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  MD030956 - Additional changes to BFM-TI enhancement          *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *  MD029266B - Reread DLDLDCQD to make sure that the record was *
      *              was already in there before writing in EMCEXX2.  *
      *  MD029266 - Access DLDLDCQD to know if deal was attached to a *
      *             facility.                                         *
      *  MD029270 - Lending Limits not reduced when Settlement Pay    *
      *             Retail Account is not linked to a Facility.       *
      *             Added element in array PGMS.                      *
      *  CTI007   - Trade Finance BF Midas 2.2 Exposure Management    *
      *  MD020363 - Include MM deal exposure from the VALUE DATE      *
      *             rather than DEAL DATE. Reinstate the codes        *
      *             removed by fix 134237.                            *
      *           - Applied for MD027409.                             *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG21694 - EM0101 on MSGW.  Applied GEMS fix 253087/ 244889  *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  181500 - Scaling percentage is ignored during I/C update of  *
      *           exposure.  Fix is to use Maturity Date of Security  *
      *           instead of Value Date of Trade to calculate correct *
      *           risk period.  Follow COB processing.                *
      *  169798 - If MM transaction and rollover deal, include in     *
      *           exposure on Value Date.                             *
      *  134237 - Include MM deal exposure from the Deal Date rather  *
      *           than Value Date.                                    *
      *  241589 - Deleted completed deals are still included in the   *
      *           FX/MM exposure.                                     *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  226919 - FX Deal customers do not have to be defined as      *
      *           SE customers so no error processing should be       *
      *           performed if customer is not present on CLINTSE.    *
      *  222471 - Program ends with DB error when a loan is reversed. *
      *           Amend conditions for DB error 36 and 37 introduced  *
      *           by CLE004.                                          *
      *           Also, program access CLAONCK for journal entry to   *
      *           CLOANCL. LE2030 writes to CLOANCK after CLOANCL     *
      *           and on occasion the CLOANCK record has not yet been *
      *           written when this program tries to access it when   *
      *           processing journal entry for CLOANCL.               *
      *           Solution is to try accessing CLOANCK again after a  *
      *           delay.                                              *
      *  BUG11321 - Exposure management batch job crashes when a TD   *
      *             has PD amendment.                                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  180056 - Recompiled over changes in ZDYYRZ3.                 *
      *  CSE037 - Bond Pricing - 3 Decimal Places in Trades Input     *
     F*  153041 - Increase size of Nominal  - ZPRCCAL                 *
     F*  135004 - Market value of security calculated incorrectly.    *
     F*            Used market price, now calls ZPRCCAL for price %.  *
     F*           During I/C, MKPR is zero, thus no exposure update.  *
     F*            Modified code to use alternative prices in order   *
     F*            to get a value and thus update exposure.           *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in FXDEALPP.*
      *           , MMDEAMPP , MMDELDPP, MMDENBPP AND MMDENSPP .      *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  176817 - Data structure DPTMDS incorrect.                    *
      *         - Add DBerror processing.                             *
      *  206988 - Rename members of array to reflect new service pgms *
      *           at R4.                                              *
      *  201514 - Deleted completed deals are still included in the   *
      *           MM exposure.                                        *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
     F*  167618 - Incorrect TI exposure shown for currencies with no  *
     F*           decimal places.                                     *
      *  CDL008 - Continuous Linked Settlement                        *
     F*  135632 - Exposure Management did not include FX input.  No   *
     F*           indication of exposure after authorization.  Apply  *
     F*           Gems fix 129258.                                    *
      *  147997 - Exposure Management Enquiries.  Both Credit         *
      *           Agreement and tranches are included in total        *
      *           of Credit Limits granted.                           *
     F*  133170 - Wrong exposure amount for IRS & FRA deals           *
     F*  155631 - On-line exposure not updated for API transactions   *
     F*  CTI002 - Trade Innovation Phase 2                            *
     F*  CEU020 - EMU LE Multi-Ccy Rollover                           *
     F*  CLE005 - Customer Lending Enhancements - Tranche 3           *
     F*  CLE004 - Customer Lending Enhancements - Syndication         *
     F*  CLE006 - Customer Lending Enhancements - Past Due Accounts   *
     F*  CDL002 - FX Netting.  Updates the exposure and offset        *
     F*           amounts based on the net positions - i.e. 'Net'     *
     F*           transactions on FXNETMPD.  The exposure and offset  *
     F*           amounts for individual FX deals on FXDEALPP that    *
     F*           have been netted will be reversed and replaced with *
     F*           the net position.                                   *
     F*  CCB002 - COB Performance Enhancements                        *
     F*           Access now via access object                        *
     F*           Change MEMOS processing to use access objects.      *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  S01408 - Addition of core hooks EM0101CP19                   *
     F*  S01408 - Addition of core hooks EM0101CP17                   *
     F*                                  EM0101CP18                   *
     F*  094081 - For FT, program AOMEMSU0 now updates the MEMOS      *
     F*           file. Update the table of programs (PGMS) to        *
     F*           contain this program so EM could update the expo-   *
     F*           sure for FT if settled through retail account.      *
     F*  S01408 - Addition of core hooks EM0101CP11                   *
     F*                                  EM0101CP12                   *
     F*                                  EM0101CP13                   *
     F*                                  EM0101CP14                   *
     F*                                  EM0101CP15                   *
     F*                                  EM0101CP16                   *
     F*  092363 - SE Issuer Exposure not updated for trade input.     *
     F*           Depot movement date (DPDO) is wrongly used for      *
     F*           checking. Should use value date (TDVD) in TRADDS.   *
     F*           Also fields TDDT/PRIC/PCOD/TCTR/CHTPTR in data      *
     F*           structure TRADDS are defined in wrong positions.    *
     F*           Size of DS/TRADDS need to be expanded.              *
     F*  S01408 - Addition of core hooks EM0101CCP7                   *
     F*                                  EM0101CCP8                   *
     F*                                  EM0101CCP9                   *
     F*                                  EM0101CP10                   *
     F*  S01408 - Core hook EM0101FFP1 added                          *
     F*           Core hook EM0101IIP3 added                          *
     F*           Core hook EM0101IIP2 added                          *
     F*           Core hook EM0101IIP1 added                          *
     F*           Core hook EM0101CCP6 added                          *
     F*           Core hook EM0101CCP5 added                          *
     F*           Core hook EM0101CCP4 added                          *
     F*           Core hook EM0101CCP3 added                          *
     F*           Core hook EM0101CCP2 added                          *
     F*           Core hook EM0101CCP1 added                          *
     F*  092163 - LOAN PAST DUE SHOULD NOT RELEASE THE EXPOSURE       *
     F*  091932 - CLIENT LIMIT MAINTENACE PROGRAMS SHOULD BE INCLUDED *
     F*           FOR RETRIEVING JOURNAL INFORMATION, OTHERWISE,      *
     F*           GRANTED LIMITS CANNOT BE SHOWN IF NO A/C OR FACILITY*
     F*           FOR THE CUSTOMER HAS BEEN OPENED                    *
     F*  090742 - SHOULD USE ADD INSTEAD OF Z-ADD FOR CALCULATING     *
     F*           RETAIL EXPOSURE AS FOR 1 CUSTOMER, THERE MAY BE     *
     F*           MORE THAN 1 RETAIL A/C AND SO IF USE Z-ADD, ONLY    *
     F*           THE BALANCE OF LAST RETAIL A/C IN ACTION WILL BE    *
     F*           THE EXPOSURE/OFFSETTING BALANCE!                    *
     F*           THIS IS ALSO NECESSARY WHEN REVERSING THE BEFORE    *
     F*           IMAGE, OTHERWISE, THE AMOUNT IN REVERSED SIGN WILL  *
     F*           BE Z-ADDED TO THE EXPOSURE/OFFSETTING BALANCE       *
     F*           INSTEAD OF JUST COUNTERACT PREVIOUS ACTION!         *
     F*  090794 - FOR R10.5, RETAIL III IS INCLUDED AND RE0279 NO     *
     F*           LONGER PRESENT. SHOULD USE GL3271 FOR RETAIL III.   *
     F*  041754 - Prevent authorization of deals deleting the         *  *
     F*           exposure for that deal                              *  *
     F*  CIR002 - Compounding of Interest                             *
     F*  052254 - RECOMPILED as CURRENT FACTOR amended from 9,8       *
     F*           to 10,9                                             *
     F*  053699 - Use Facility Customer for Loans & Loan amends       *
     F*  S01397 - Rel 10 Incorporation of BNZ SARs A46008 and A46013. *
     F*           Recompiled for New Zealand Bond Formula             *
     F*  E27498 - FALLING OVER WHEN ENTER A DEAL AMENDMENT DUE TO     *
     F*           CHAIN FAILURE ON CURRENCY FILE AS A RESULT OF THE   *
     F*           CURRENCY BEING DEFINED IN THE 'I' SPECS IN THE      *
     F*           WRONG PLACE. ORIGINAL DEAL TYPE ALSO IN THE WRONG   *
     F*           PLACE.                                              *
     F*  E26186 - SR DLSDD USES THE FIELD MATD FOR COMPARISON WITH    *
     F*           SALE DATE WHEN IT SHOULD BE USING MDAT              *
     F*  S01220 - RECOMPILE FOR STRATEGIC RISK MANAGEMENT CHANGES TO  *
     F*           SECTYD                                              *
     F*  E14724 - EXPOSURE UPDATES SHOULD NOT BE PERFORMED FOR        *
     F*           INCOMPLETE TRADES                                   *
     F*  E23929 - ADD GL4445 TO LIST OF VALID PGMS FOR RECEIVING      *
     F*           JOURNAL ENTRIES                                     *
     F*  RT0137 - REMOVE REFERENCES TO REDUNDANT FILES LOANS, FACIL   *
     F*  /S01339  AND REPAY                                           *
     F*  S01332 - EXPOSURE MANAGEMENT RELEASE 10 ENHANCEMENTS.        *
     F*  BHF848 - Amend program to read DRS deals file rather than    *
     F*  /S01332  Midas deals file so as to include complete deals    *
     F*           in EM exposure calculation.                         *
     F*           NOTE: PGMS array amended to include only valid      *
     F*           program entries.                                    *
     F*           ALSO A FIX IS APPLIED TO LN0071                     *
     F*  E21552 - Add the program SE3003 to the PGMS array to allow   *
     F*           EM to be updated for Bulk Input Securities Trading. *
     F*  E20299 - ENSURE EM BACKGROUND JOB HALTS AFTER DATABASE ERROR.*
     F*  E20684 - SE Issuer Exposure Update changed to execute it if  *
     F*           Issuer is on the Securities file when Processing    *
     F*           Type is not 9.                                      *
     F*  E19357 - Size of JRNENT data structure not big enough to     *
     F*           cope with TRADSD file, and TRADDS data structure    *
     F*           has incorrect field defintion for PCOD, TCTR and    *
     F*           CHTPTR.                                             *
     F*  LN0071 - CHANGE CUSTOMER NUMBER ON EMCEXX2 TO ALPHA          *
     F*  E19669 - LOAN AMENDMENTS DO NOT UPDATE EXPOSURE.             *
     F*  E19310 - DO NOT CHAIN TO TABTB36 IF SE IS NOT INSTALLED.     *
     F*  S01117 - RELEASE TEN MULTIBRANCHING                          *
     F*  E13735 - INCONSISTENT EXPOSURE UPDATE FOR 'TI' DEAL DURING   *
     F*           INPUT CYCLE AND COB.                                *
     F*  E16054 - Changes to list of Valid Programs for receiving     *
     F*           Journal entries. DL0030 replaced by FX0380 & FX0390 *
     F*           DL0040, DL0050, DL0060 replaced by MM0081.          *
     F*  E13665 - THE NEW CLEARED BALANCE IS USED FOR 'EM' UPDATE     *
     F*           INSTEAD OF THE TRANSACTION AMOUNT.                  *
     F*  S01176 - SECURITIES TRADING 3.1                              *
     F*  S01128 - Field JNSQ - Journal Sequence No.- in EMCEXX1       *
     F*           renamed to JOSEQN, as it exists in the FRF.         *
     F*           Changes to include Valid Programs for receiving     *
     F*           Journal entries.                                    *
     F*  S01129 - Amend program to handle journal entries from files  *
     F*           S01129, DPTMVD & SETLED.                            *
     F*           SECURITIES TRADING RELEASE 2                        *
     F*****************************************************************
     FMMDELDL2IF  E           K        DISK                               169798
     FMMDEALLLIF  E           K        DISK                               BHF848
     F            MMDELDP0                          KIGNORE               BHF848
     F            MMDENBP0                          KIGNORE               BHF848
     F*                                                                   BHF848
     FEMCEX   UF  E           K        DISK                      A
     F                                              KCOMIT
     F*CLOAN***IF  F     400  7AI     2 DISK                           U3 CLE004
     F*CLOAN***IF  F    1284  7AI     2 DISK                       CLE004 CEU020
     F*CLOAN***IF**F    1290  7AI     2 DISK                   U3  CEU020 CLE011
     F***CLOAN***IF  F    1310  7AI     2 DISK                           U3            CLE011 CLE028
     FCLOAN   IF  F    1375  7AI     2 DISK                           U3                      CLE028
     F*LOANS**IF**F*****400 13AI     2 DISK                           U3  RT0137
     F*ABLE   IF  E           K        DISK                               S01129
     F*           TABTE10F                          KIGNORE               S01129
     F*           TABLETHF                          KIGNORE               S01129
     F*           TABLETIF                          KIGNORE               S01129
     F*           TABLETNF                          KIGNORE               S01129
     F*           TABLETTF                          KIGNORE               S01129
     F*EMACC***IF**E****       K        DISK                           U1 CCB002
     F************ACCNTABF                          KRENAMEACCNTF         CCB002
     FACCNT   IF  E           K        DISK                           U1  CCB002
     F            ACCNTABF                          KRENAMEACCNTF         CCB002
     FTABEM   IF  E           K        DISK                               S01129
     F*           TABTB10F                          KIGNORE               S01129
     F*           TABTB11F                          KIGNORE               S01129
     F*           TABTB36F                          KIGNORE               S01129
     F*           TABTB95F                          KIGNORE               S01129
     F            TABTE10F                          KIGNORE               S01129
     F*           TABTG10F                          KIGNORE               S01129
     F            TABLETHF                          KIGNORE               S01129
     F            TABLETIF                          KIGNORE               S01129
     F            TABLETNF                          KIGNORE               S01129
     F            TABLETTF                          KIGNORE               S01129
     FCLINT   IF  E           K        DISK                               S01129
     F            CLINTCAF                          KIGNORE               S01129
     F            CLINTCBF                          KIGNORE               S01129
     F            CLINTCCF                          KIGNORE               S01129
     F            CLINTC1F                          KIGNORE               S01129
     F*           CLINTSEF                          KIGNORE               S01129
     FSECTY   IF  E           K        DISK                               S01129
     FINVTP   IF  E           K        DISK                               S01129
     FTRADS   IF  E           K        DISK                               S01129
     FINTYP   IF  E           K        DISK                               S01332
     FDLDLDCL3IF  E           K        DISK                                                 MD029266
     FSDACODL1IF  E           K        DISK                               CTI002
     FEMTFSAL1UF  E           K        DISK                      A        CTI002
     F                                              KCOMIT                CTI002
     FEMTFEXL0UF  E           K        DISK                      A        CTI002
     F                                              KCOMIT                CTI002
     FEMTFEXL2UF  E           K        DISK                               CTI002
     F                                              KCOMIT                CTI002
     F            EMTFEX                            KRENAMEEMTFEXF2       CTI002
     FEMTFCBL0UF  E           K        DISK                      A        CTI002
     F                                              KCOMIT                CTI002
     FEMTFCBL1UF  E           K        DISK                               CTI002
     F                                              KCOMIT                CTI002
     F            EMTFCB                            KRENAMEEMTFCBF1       CTI002
     FEMTFSLL0UF  E           K        DISK                      A        CTI002
     F                                              KCOMIT                CTI002
     F*                                                                   S01332
     F**  Exposure management scaling file LF/EMEXSCL1                    S01332
     F/COPY ZSRSRC,ZEXPSCLZ2                                              S01332
     F*                                                                   S01408
     F/COPY WNCPYSRC,EM0101FFP1                                           S01408
     F*
     F********************************************************************
     F*   INDICATORS USED                                                *
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F* 01               EMCEX - HEADER RECORD                           *
     F* 02                     - DETAIL RECORD                           *
     F* 15               CLOAN - DETAIL RECORD                           *
     F**16***********************SYND. LOANS FACILITIES                   RT0137
     F* 17                       RETAIL OVERDRAFTS
     F**18***********************REPAY DETAIL RECORD                     *RT0137
     F*   13             SE INSTALLED                                     E19310
     F*   19             CLOANS PARTS. PURCH WITHOUT RECOURSE            *
     F*   20             MULTIPLY/DIVIDE INDICATOR ZERO                  *
     F*   21             CLOAN - Detail Record 'B'                       *CLE004
     F****22*************LOANS DETAIL RECORD                             *RT0137
     F*   23             DEAL IS NOT AGAINST A FACILITY                  *E13735
     F*     25           CHAIN FAIL ON EMEXSCL1                           S01332
      *     26           CHAIN ON DLDLDCL3                                                  MD029266
     F*     30           NUMBER OF CCY DEC PLACES = 0                    *S01129
     F*     31           NUMBER OF CCY DEC PLACES = 1                    *S01129
     F*     32           NUMBER OF CCY DEC PLACES = 2                    *S01129
     F*     33           NUMBER OF CCY DEC PLACES = 3                    *S01129
     F*     40           CHAIN FAILED                                    *S01129
     F*     41           EMCEX DETAIL RECORD NOT FOUND                   *
     F*     45           WORK INDICATOR                                   S01129
     F*     46           RECORD DOES UPDATE EXPOSURE                     *
     F*     47           WORK INDICATOR
     F*     50           NOT FIRST CYCLE                                 *
     F*     55           ACTION I, OR INSERT HALF OF AN AMENDMENT        *
     F*     80           JOURNAL - 'UP' RECORD BEING PROCESSED           *
     F*     81           JOURNAL - 'UR' RECORD BEING PROCESSED           *
     F*     82           CHAIN TO LF/INTYP                               *S01332
     F*     97           SHUT DOWN                                       *
     F*     98           DATE FORMAT INDICATOR                           *
     F*     99           ERROR IN FIRST CYCLE CALCULATIONS               *
     F*            U1    RETAIL MODULE PRESENT IN THE SYSTEM             *
     F*            U2    DEALING MODULE PRESENT IN THE SYSTEM            *
     F*            U3    CUSTOMER LENDING PRESENT IN THE SYSTEM          *
     F*            U7,U8 DATABASE ERROR FOUND                            *
     F*            U6    PAUSE RECEIVING JOURNALS                        *S01128
     F*                                                                  *
     F**
     F********************************************************************
     E                    CPY@    1   1 80
     E*                   EXP        17 15 0             EXP/OFF/GRT      S01129
     E**************      EXP        20 15 0             EXP/OFF/GRTS01129S01332
     E**************      EXP        28 15 0             EXP/OFF/GRTS01332CTI002
     E                    EXP        31 15 0             EXP/OFF/GRT      CTI002
     E**************      POWER   1   7  7 0             POWERS OF TEN    S01129
     E                    POWERA  1   7  7 0             POWERS OF TEN    S01129
     E                    TABA    8   8  2               FX SELECTIONS
     E                    TABB    8   8  2               MM SELECTIONS
     E********************TABD    8   8  2               LENDING SELECTIONCLE005
     E**********          TABD   12  12  2               LENDING SELECTION             CLE005 CLE028
     E                    TABD   13  13  2               LENDING SELECTION                    CLE028
     E*                   PGMS    5  27 10               VALID JRN. PGMS. S01128
     E********************PGMS    5  30 10               VALID JRN. PGMS. S01129
     E********************PGMS    5  29 10                         E16054 E21552
     E********************PGMS    5  30 10                         E21552 BHF848
     E********************PGMS    5  22 10                         BHF848 S01332
     E********************PGMS    6  37 10                         S01332 RT0137
     E********************PGMS    5  31 10                         RT0137 E23929
     E********************PGMS    5  32 10                         E23929 E21552
     E********************PGMS    5  33 10                         E21552 S01332
     E***********         PGMS    5  36 10                         S01332 091932
     E********************PGMS    5  38 10                         S01332 CIR002
     E********************PGMS    5  39 10                         CIR002 094081
     E********************PGMS    5  40 10                         0094081CDL002
     E********************PGMS    5  40 10                         094081 CDL002
     E********************PGMS    5  45 10                         CDL002 CLE005
     E********************PGMS    5  46 10                         CLE005 CTI002
     E********************PGMS    5  47 10                         CTI002 155631
     E**********          PGMS    5  89 10                                           155631 MD029270
     E                    PGMS    5  90 10                                                  MD029270
     E*                                                                   S01332
     E**  Exposure management scaling arrays.                             S01332
     E/COPY ZSRSRC,ZEXPSCLZ3                                              S01332
     E/COPY ZSRSRC,ZPOWER8Z1                                              S01129
     E/COPY ZSRSRC,ZPOWERZ1                                               S01129
     E*                                                                   BHF848
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIODBHF848
     E                    @YD     4   4  5 0A                             BHF848
     E*                                                                   BHF848
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR PER MONTH        BHF848
     E                    @MD    13  13  5 0A                             BHF848
     E*                                                                   BHF848
     E                    CMD     1   1 15                                                 MD029266B
     E/EJECT
     I********
     I**  EMCEX - HEADER RECORD
     IEMCEXX1F    01
     I**
     I**    - DETAIL RECORD
     IEMCEXX2F    02
     I********
     I**  EMACC  - DETAIL RECORD
     IACCNTF
     I              RECI                            RECIRA
     I              CNUM                            CNUMRA
     I              CCY                             CCYRA
     I              FACT                            FACTRA
     I              FCNO                            FCNORA
0387 I********
0388 I**  CLOAN - DETAIL RECORD
0389 ICLOAN   NS  15   1 CD   8 CA
     I                                       10  110PTYPC
0390 I**********                             12  170CNUMC                                     CSD027
0390 I                                       12  17 CNUMC                                     CSD027
     I                                       18  20 BRCA                  CLE004
     I                                       47  49 CCYA                  CLE004
0391 I                                      139 1400SDST
     I                                    P 197 1990RLDT                  CLE004
     I**********                            290 2950OLNOC                                     CSD027
     I                                      290 295 OLNOC                                     CSD027
0392 I                                      296 296 RCSIA
     I                                     12061206 LNKS                  CLE004
      *                                                                   CLE004
     I        NS  21   1 CD   8 CB                                        CLE004
     I                                      470 472 NCCY                  CLE004
     I                                    P 473 4790NCPA                  CLE004
0393 I**
0394 I**     - CATCHALL
0395 I        NS
0396 I*******
     I****LOANS*FILE*-*DETAIL*RECORD                                      RT0137
     I*LOANS**NS  22   1 CD   8 CD                                        RT0137
     I********                               39  40 LNTPL                 RT0137
     I********                               15  200BWCNL                 RT0137
     I********                              146 1460RCUIL                 RT0137
     I********                                                            RT0137
     I****-*CATCHALL                                                      RT0137
     I********NS                                                          RT0137
     IINTYPDF                                                             S01332
     I              CHTP                            FOCHTP                S01332
      *                                                                   CSE037
     IINVTPDF                                                             CSE037
     I              SFLG                            ISFLG                 CSE037
      *                                                                   CSE037
     I/COPY WNCPYSRC,EM0101IIP3                                           S01408
      *                                                                   S01332
     I**********
     I**
     I**  DATA STRUCTURE FOR EXPOSURES AND BALANCES
     I            DS
     I*                                       1 255 EXP                   S01129
     I**************                          1 300 EXP             S01129S01332
     I**************                          1 420 EXP             S01332CTI002
     I                                        1 465 EXP                   CTI002
     I                                        1  150MFXE
     I                                       16  300MFXB
     I                                       31  450MMME
     I                                       46  600MMMB
     I                                       61  750MLEG
     I                                       76  900MLEE
     I                                       91 1050MLEB
     I                                      106 1200MLAE
     I                                      121 1350MLAB
     I                                      136 1500MREG
     I                                      151 1650MREE
     I                                      166 1800MREB
     I                                      181 1950MLCG
     I                                      196 2100MLCA
     I                                      211 2250MLCB
     I                                      226 2400MSTE
     I                                      241 2550MSTB
     I                                      256 2700MSIE                  S01129
     I                                      271 2850MSCE                  S01129
     I                                      286 3000MSPO                  S01129
     I                                      301 3150MFRE                  S01332
     I                                      316 3300MFRO                  S01332
     I                                      331 3450MIRE                  S01332
     I                                      346 3600MIRO                  S01332
     I                                      361 3750MFUE                  S01332
     I                                      376 3900MFUO                  S01332
     I                                      391 4050MOPE                  S01332
     I                                      406 4200MOPO                  S01332
     I                                      421 4350TFEX                  CTI002
     I                                      436 4500TFGR                  CTI002
     I                                      451 4650TFOF                  CTI002
     I*
     I*  INSERT AS DATA STRUCTURE FOR JOURNAL ENTRIES
     I*
     I*RNENT      DS                            525                       S01129
     I***JRNENT      DS                            551             S01129 E19357
     I***JRNENT      DS                         625                E19357 S01332
     I***JRNENT      DS                            760             S01332 CIR002
     I***JRNENT      DS                            812             CIR002 CDL002
     I/COPY WNCPYSRC,EM0101I003
     IJRNENT      DS                           2126                       CDL002
     I/COPY WNCPYSRC,EM0101I004
0146 I                                        6  150JRNSQ
0146 I                                       16  16 JRNCD
0154 I                                       17  18 JOENTT
     I                                       57  66 JOPGM
     I                                       87  96 JFILE
     I                                       97 1060JOCTRR
0155 I                                      126 135 JRNRCV
     I************                                                        RT0137
     I****DATA*STRUCTURE*FOR*LOAN*KEY*(COMMITMENT)                     RS RT0137
     I************DS                                                      RT0137
     I************                            1  13 LNKEY1                RT0137
     I************                            1   60LNRF                  RT0137
     I************                            7   7 LN2                   RT0137
     I************                            8  130DDRF1                 RT0137
     I*
0143 I******-*DEALSDB*:*FOREIGN*EXCHANGE*******************************   BHF848
0144 I*EALDB      DS                            525                       S01129
0144 I*DEALDB******DS****************************551               S01129 E19357
0144 I*DEALDB******DS***************************625                E19357 BHF848
0154 I**************************************126 126 RECIDB                BHF848
0155 I**************************************136 1410CNUM                  BHF848
0156 I**************************************145 146 DTYP1                 BHF848
0157 I************************************P*152 1540VDAT                  BHF848
0158 I************************************P*155 1570OTDT                  BHF848
0159 I**************************************171 173 PUCY                  BHF848
0160 I************************************P*174 1800PUAM                  BHF848
     I**************************************211 213 SUCY                  BHF848
     I************************************P*214 2200SLAM                  BHF848
0165 I**************************************522 522 CHTPA1                BHF848
      *                                                                   BHF848
      *                                                                   BHF848
      ***************                                              BHF848 CDL002
     I**FXDEAL******DS*                         551                BHF848 CDL002
      ***************                                              BHF848 CDL002
      ***Data*structure for FX deals file. Replaces DEALDB, but stiBHF848 CDL002
      ***keep*fields*from above where possible.                    BHF848 CDL002
      ***Type*of*last change                                       BHF848 CDL002
     I***************                       142 142 FHCHTP         BHF848 CDL002
     I***************                       142 142 CHTPA1         BHF848 CDL002
      ***Value*date*in YYYYMMDD format                             BHF848 CDL002
     I***************                       155 1580FHVDYY         BHF848 CDL002
     I***************                       159 1600FHVDMM         BHF848 CDL002
     I***************                       161 1620FHVDDD         BHF848 CDL002
      ***Deal*option*end date in YYYYMMDD                          BHF848 CDL002
     I***************                       171 1740FHDOEY         BHF848 CDL002
     I***************                       175 1760FHDOEM         BHF848 CDL002
     I***************                       177 1780FHDOED         BHF848 CDL002
      ***Deal*status*                                              BHF848 CDL002
     I***************                       186 186 FHDSTS         BHF848 CDL002
      ***Customer*number                                           BHF848 CDL002
     I***************                       198 2030FHDCNO         BHF848 CDL002
     I***************                       198 2030CNUM           BHF848 CDL002
      ***First*&*second deal amounts & currencies                  BHF848 CDL002
     I***************                     P 211 2180FHDAM1         BHF848 CDL002
     I***************                       219 221 FHCCY1         BHF848 CDL002
     I***************                       222 224 FHCCY2         BHF848 CDL002
     I***************                     P 225 2320FHDAM2         BHF848 CDL002
      ***Deal*type***                                              BHF848 CDL002
     I***************                       360 361 FHTYPE         BHF848 CDL002
     I***************                       360 361 DTYP1          BHF848 CDL002
      *                                                                   CDL002
     I***FXDEAL*    E DSFXDEALPP                   2126                                CDL002 CDL094
     IFXDEAL    E DSFXDEALPP                   2253                                           CDL094
     I* Data structure for FX Deals                                       CDL002
     I*                                                                   CDL002
     IFXNET     E DSFXNETMPD                   1126                       CDL002
     I* Data structure for Netted Deals                                   CDL002
0166 I**
0167 I******-*DEALSDC*:*LOANS*DEPOSITS*********************************   BHF848
0168 I*EALDC      DS                            525                       S01129
0168 I*DEALDC******DS****************************551               S01129 E19357
0168 I*DEALDC*****DS****************************625                E19357 BHF848
0178 I**************************************126 126 RECIDC                BHF848
0179 I**************************************136 1410CNUMDC                BHF848
0180 I**************************************145 146 DTYPDC                BHF848
0181 I************************************P*152 1540VDATDC                BHF848
0182 I************************************P*155 1570MDAT1                 BHF848
0183 I**************************************171 173 CCY                   BHF848
0184 I************************************P*174 1800PCPL                  BHF848
0185 I**************************************237 2390FACT                  BHF848
0188 I**************************************240 2410FCNO1                 BHF848
     I**************************************522 522 CHTPDC                BHF848
      *                                                                   BHF848
      *                                                                   BHF848
     I/COPY WNCPYSRC,EM0101I005
     IMMDELD      DS                            551                       BHF848
     I/COPY WNCPYSRC,EM0101I006
      *                                                                   BHF848
      ** Data structure for MM loans file. Replaces DEALDC, but still     BHF848
      ** keep fields from above where possible.                           BHF848
      *  Type of last change                                              BHF848
     I                                      142 142 HKCHTP                BHF848
     I                                      142 142 CHTPDC                BHF848
     I                                      155 1600HKDLNO                                  MD029266
     I                                      161 166 HKDADN                169798
      *  Currency                                                         BHF848
     I                                      171 173 HKCCY                 BHF848
     I                                      171 173 CCY                   BHF848
      *  Value date in YYYYMMDD format                                    BHF848
     I                                      175 1780HKVDYY                BHF848
     I                                      179 1800HKVDMM                BHF848
     I                                      181 1820HKVDDD                BHF848
      *  Deal status                                                      BHF848
     I                                      192 192 HKDSTS                BHF848
      *  Deal type                                                        BHF848
     I                                      193 194 HKMTYP                BHF848
     I/COPY WNCPYSRC,EM0101I001
     I                                      193 194 DTYPDC                BHF848
     I/COPY WNCPYSRC,EM0101I002
      *  Customer number                                                  BHF848
     I**********                            210 2150HKCNUM                             BHF848 CSD027
     I**********                            210 2150CNUMDC                             BHF848 CSD027
     I                                      210 215 HKCNUM                                    CSD027
     I                                      210 215 CNUMDC                                    CSD027
      *  Principal amount                                                 BHF848
     I                                    P 216 2230HKAMNP                BHF848
     I                                    P 216 2230PCPL                  BHF848
      ** Last action type                                                                     201514
      *                                                                                       201514
     I                                      283 283 HKLACT                                    201514
      *  Maturity date                                                    BHF848
     I                                      377 3800HKMDYY                BHF848
     I                                      381 3820HKMDMM                BHF848
     I                                      383 3840HKMDDD                BHF848
      *  Facility type and number                                         BHF848
     I                                      388 3920HKFCLY                BHF848
     I                                      388 3900FACT                  BHF848
     I                                      391 3920FCNO1                 BHF848
      *                                                                   BHF848
      *                                                                   BHF848
0193 I**
0194 I******-*DEALSDD*:*NEGOTIABLE*ASSETS*PURCHASED********************   BHF848
0195 I*EALDD      DS                            525                       S01129
0195 I*DEALDD******DS****************************551               S01129 E19357
0195 I*DEALDD*****DS****************************625                E19357 BHF848
0205 I**************************************126 126 RECIDD                BHF848
0206 I**************************************136 1410ISCN                  BHF848
0207 I**************************************145 146 DTYPDD                BHF848
0208 I************************************P*152 1540VDATDD                BHF848
0209 I************************************P*155 1570MDATDD                BHF848
0210 I**************************************171 173 CCYDD                 BHF848
0211 I**************************************237 2390FACTDD                BHF848
0212 I**************************************240 2410FCNODD                BHF848
0213 I************************************P*242 2480FVAL                  BHF848
0213 I************************************P*416 4180SADT                  BHF848
     I**************************************522 522 CHTPDD                BHF848
      *                                                                   BHF848
      *                                                                   BHF848
     IMMDENB      DS                            551                       BHF848
      *                                                                   BHF848
      ** Data structure for MM negotiable assets bought. Replaces         BHF848
      ** DEALDD, but still keep fields from above where possible.         BHF848
      *  Type of last change                                              BHF848
     I                                      142 142 HLCHTP                BHF848
     I                                      142 142 CHTPDD                BHF848
      *  Associated deal number to chain to MMDEALLL                      BHF848
     I                                      161 166 HLDADN                BHF848
     I                                      161 1660KYDENS                BHF848
      *  Currency                                                         BHF848
     I                                      171 173 HLCCY                 BHF848
     I                                      171 173 CCYDD                 BHF848
      *  Value date in YYYYMMDD format                                    BHF848
     I                                      175 1780HLVDYY                BHF848
     I                                      179 1800HLVDMM                BHF848
     I                                      181 1820HLVDDD                BHF848
      *  Deal status                                                      BHF848
     I                                      192 192 HLDSTS                BHF848
      *  Deal type                                                        BHF848
     I                                      193 194 HLMTYP                BHF848
     I                                      193 194 DTYPDD                BHF848
     I/COPY WNCPYSRC,EM0101I008
      *  Face value                                                       BHF848
     I                                    P 324 3310HLFVAL                BHF848
     I                                    P 324 3310FVAL                  BHF848
      *  Issuing customer                                                 BHF848
     I**********                            342 3470HLISCN                             BHF848 CSD027
     I**********                            342 3470ISCN                               BHF848 CSD027
     I                                      342 347 HLISCN                                    CSD027
     I                                      342 347 ISCN                                      CSD027
      *  Maturity date                                                    BHF848
     I                                      390 3930HLMDYY                BHF848
     I                                      394 3950HLMDMM                BHF848
     I                                      396 3970HLMDDD                BHF848
      *  Facility type and number                                         BHF848
     I                                      398 4020HLFCLY                BHF848
     I                                      398 4000FACTDD                BHF848
     I                                      401 4020FCNODD                BHF848
      *                                                                   BHF848
      *                                                                   BHF848
0219 I**
0220 I******-*DEAMSDI*:*DEAL*AMENDMENTS********************************   BHF848
0195 I*EAMDI      DS                            525                       S01129
0195 I*DEAMDI******DS****************************551               S01129 E19357
0195 I*DEAMDI******DS***************************625                E19357 BHF848
0230 I**************************************126 126 RECIDI                BHF848
0233 I**************************************133 1370VDATDI                BHF848
0234 I**************************************141 142 DTYPDI                BHF848
0235 I**************************************145 146 AMTP                  BHF848
0236 I**************************************156 158 CCYDI                 BHF848
0237 I************************************P*159 1650DAAM                  BHF848
0238 I**************************************167 1720CNUMDI                BHF848
0241 I**************************************322 322 CHTPDI                BHF848
      *                                                                   BHF848
      *                                                                   BHF848
     IMMDEAM      DS                            551                       BHF848
      *                                                                   BHF848
      ** Data structure for MM deal amendments. Replaces DEAMDI, but      BHF848
      ** still keep fields from above where possible.                     BHF848
      *  Type of last change                                              BHF848
     I                                      142 142 HNCHTP                BHF848
     I                                      142 142 CHTPDI                BHF848
      *  Currency                                                         BHF848
     I***********                           171 173 HNCCY          BHF848 E27498
     I***********                           171 173 CCYDI          BHF848 E27498
     I                                      155 1600HNDA38                169798
     I                                      170 172 HNCCY                 E27498
     I                                      170 172 CCYDI                 E27498
      *  Value date in YYYYMMDD format                                    BHF848
     I                                      174 1770HNVDYY                BHF848
     I                                      178 1790HNVDMM                BHF848
     I                                      180 1810HNVDDD                BHF848
      *  Deal status                                                      BHF848
     I                                      191 191 HNDSTS                BHF848
      *  Amendment type                                                   BHF848
     I                                      192 193 HNMTYP                BHF848
     I                                      192 193 AMTP                  BHF848
      *  Amendment amount                                                 BHF848
     I                                    P 204 2110HNAMNP                BHF848
     I                                    P 204 2110DAAM                  BHF848
      *  Deal type (original deal type, not amendment type)               BHF848
     I***********                           255 256 HNOMDT          BHF848E27498
     I***********                           255 256 DTYPDI          BHF848E27498
     I                                      380 381 HNOMDT                E27498
     I                                      380 381 DTYPDI                E27498
     I/COPY WNCPYSRC,EM0101I009
      *  Customer number                                                  BHF848
     I**********                            382 3870HNCNUM                             BHF848 CSD027
     I**********                            382 3870CNUMDI                             BHF848 CSD027
     I                                      382 387 HNCNUM                                    CSD027
     I                                      382 387 CNUMDI                                    CSD027
      *                                                                   BHF848
      *                                                                   BHF848
0243 I**
0244 I******-*LOANSCS*:*SYNDICATED LOANS                                  RT0137
0195 I*OANCS      DS                            525                       S01129
0195 I*LOANCS**** DS                            551                 S01129E19357
0195 I*OANCS******DS********                126 625 RECICS         E19357 RT0137
0258 I***********                           126 126 RECICS                RT0137
0260 I***********                           140 1450BWCN                  RT0137
0261 I***********                           158 160 CMCY                  RT0137
0262 I***********                           161 163 DDCY                  RT0137
0263 I***********                           165 166 LNTP                  RT0137
0265 I***********                         P 173 1750MATD                  RT0137
0266 I***********                         P 245 2510ODDC                  RT0137
0267 I***********                         P 252 2580PRLA                  RT0137
0270 I***********                           421 421 CONI                  RT0137
0271 I***********                           522 522 CHTPCS                RT0137
0272 I**
0273 I**    CLOANCL -  CUSTOMER LOANS
     I*OANCL      DS                            525                       S01129
     I***LOANCL      DS                            551             S01129 E19357
     ILOANCL      DS                            625                       E19357
0284 I                                      126 126 RECICL
     I**********                            127 1320LNRFCL                                    CLE148
     I                                      127 132 LNRFCL                                    CLE148
0286 I                                      135 136 PTYP
0287 I                                      137 1420CNUMCL
0288 I                                    P 153 1550VDATCL
0289 I                                    P 156 1580MDATCL
     I**********                            161 1660FCUSCL                             053699 CSD027
     I                                      161 166 FCUSCL                                    CSD027
0290 I                                      172 174 CCYCL
0291 I                                    P 175 1810CPAM
0296 I**********                            415 4200OLNO                                      CSD027
0296 I                                      415 420 OLNO                                      CSD027
0297 I                                      421 421 RCSI
0298 I                                      522 522 CHTPCL
0299 I**
0300 I**    LOAMSDK - CUSTOMER LENDING LOAN AMENDMENTS
0301 I*OAMDK      DS                            525                       S01129
0301 I***LOAMDK      DS                            551             S01129 E19357
0301 ILOAMDK      DS                            625                       E19357
0310 I                                      126 126 RECIDK
0311 I**********                            127 1320LNRFDK                                    CLE148
     I                                      127 132 LNRFDK                                    CLE148
     I                                      133 1370VDATDK                E19669
0312 I                                      146 147 PTYPDK
0313 I                                      148 149 AMTPDK
0314 I***********                           153 1570VDATDK                E19669
0315 I                                      160 162 CCYDK
0316 I                                    P 163 1690PRAM
0317 I                                      201 2060CNUMDK
     I                                      346 3530WORKXA
0321 I                                      346 3500XAVD
0322 I                                      351 3530XASQ
     I**********                            354 3590FCUSDK                             053699 CSD027
     I                                      354 359 FCUSDK                                    CSD027
0323 I                                      442 442 CHTPDK
0349 I***********                                                         RT0137
0350 I******-*LOANSCR   SYNDICATED LOANS COMMITMENTS                      RT0137
0349 I***********                                                         RT0137
0301 I*OANCR      DS                            525                       S01129
0301 I*LOANCR**** DS                            551                 S01129E19357
0301 I*OANCR      DS                            625                E19357 RT0137
0362 I***********                           126 126 RECICR                RT0137
0363 I***********                           127 1320LNRFCR                RT0137
0365 I***********                           140 1450BWCNCR                RT0137
0365 I***********                         P 148 1540ORCA                  RT0137
0365 I***********                         P 186 1880FAVD                  RT0137
0365 I***********                         P 189 1910LAVD                  RT0137
0365 I***********                         P 195 1970MATDCR                RT0137
0365 I***********                           226 228 CMCYCR                RT0137
0365 I***********                           522 522 CHTPCR                RT0137
0349 I**
0350 I**    - FCLTYFM    CUSTOMER LENDING FACILITY
0349 I**
0301 I*CLTDS      DS                            525                       S01129
0301 I***FCLTDS      DS                            551             S01129 E19357
0301 IFCLTDS      DS                            625                       E19357
0362 I                                      126 126 RECIFC
0360 I**********                            127 1320CNUMFC                                    CSD027
0360 I                                      127 132 CNUMFC                                    CSD027
0360 I                                      133 1350FACTFC
0360 I                                      136 1370FCNOFC
0360 I                                      143 145 FCCY
0360 I                                    P 146 1520FAMT
0360 I                                    P 156 1580DTAP
0360 I                                    P 159 1610DTEX
0360 I                                      378 378 CHTPFC
0360 I                                      464 465 TRCA                  147997
0349 I***********                                                         RT0137
0350 I******-*FACILFB    SYNDICATED LOANS FACILITIES                      RT0137
0349 I***********                                                         RT0137
0301 I*ACIDS      DS                            525                       S01129
0301 I*FACIDS**** DS                            551                 S01129E19357
0301 I*ACIDS      DS                            625                E19357 RT0137
0362 I***********                           126 126 RECIFA                RT0137
0360 I***********                           127 1320CNUMFA                RT0137
0360 I***********                           133 1350FACTFA                RT0137
0360 I***********                           136 1370FCNOFA                RT0137
0360 I***********                           139 1410CCYFA                 RT0137
0360 I***********                         P 142 1440APPD                  RT0137
0360 I***********                         P 145 1470EXPD                  RT0137
0360 I***********                         P 148 1540FAMTFA                RT0137
0360 I***********                           250 250 CHTPFA                RT0137
0349 I**
0350 I**    - ACCNTAB    RETAIL OVERDRAFTS
0349 I**
0301 I*CCTDS      DS                            525                       S01129
0301 I***ACCTDS      DS                            551             S01129 E19357
0301 I***ACCTDS*     DS                            625                                 E19357 CGL029
     IACCTDS      DS                            725                                           CGL029
0362 I                                      126 126 RECIAC
0364 I**********                            127 1320CNUMAC                                    CSD027
0364 I                                      127 132 CNUMAC                                    CSD027
0365 I                                      133 135 CCYAC
0364 I**********                            136 1390ACOD                                      CGL029
     I                                      136 1390ACODQQ                                    CGL029
0364 I                                      151 151 ATYP
0364 I                                    P 327 3320ODLN
0364 I                                      338 3400FACTAC
0364 I                                      341 3420FCNOAC
0364 I                                    P 364 3660RRNM
0364 I                                      522 522 CHTPAC
     I                                      679 6880ACOD                                      CGL029
0367 I**
0350 I******REPAYRD - REPAYMENT                                           RT0137
0301 I*EPAYM      DS                            525                       S01129
0301 I*REPAYM*****DS                            551                 S01129E19357
0301 I*EPAYM      DS                            625                E19357 RT0137
0362 I************                          126 126 RECIRE                RT0137
0223 I************                          127 1320LNRFRE                RT0137
0227 I************                          140 1440RPYD                  RT0137
0228 I************                          145 147 CMCYRE                RT0137
0229 I************                        P 148 1540RPYA                  RT0137
0230 I************                          155 155 RPAI                  RT0137
0231 I************                          156 243 ZZ088                 RT0137
0234 I************                          250 250 CHTPRE                RT0137
     I**
0220 I**    - MEMOS : SHADOW BALANCES
0195 I*EMODS      DS                            525                       S01129
0195 I***MEMODS      DS                            551             S01129 E19357
0195 IMEMODS      DS                            625                       E19357
0230 I                                      126 126 RECIME
     I**********                            127 1320MECNUM                             CCB002 CSD027
     I                                      127 132 MECNUM                                    CSD027
     I                                      133 135 MECCY                 CCB002
     I**********                            136 1390MEACOD                             CCB002 CGL029
     I                                      136 1390QQACO1                                    CGL029
     I                                      140 1410MEACSQ                CCB002
     I                                      142 144 MEBRCA                CCB002
0232 I************                          127 141 BLK1ME                CCB002
0233 I************                          142 1560CLBLME                CCB002
     I                                      155 169 BLK1ME                CCB002
     I                                      170 1840CLBLME                CCB002
     I                                      194 2030MEACOD                                    CGL029
     I*                                                                   S01129
     I**    - S01129 :  TRADS DETAILS                                     S01129
     I***TRADDS      DS                            551             S01129 E19357
     I***TRADDS      DS                            625             E19357 092363
     ITRADDS      DS                            641                       092363
     I                                      126 126 RECITR                S01129
     I                                      133 133 TINC                  E14724
     I                                      134 143 TDSS                  S01129
     I**********                            144 1490TCNR                               S01129 CSD027
     I                                      144 149 TCNR                                      CSD027
     I                                      150 151 TDTP                  S01129
     I                                    P 152 1570NOML                  S01129
     I                                      158 160 TNMC                  S01129
     I                                    P 170 1720TDVD                  S01129
     I***********                         P 178 1800TDDT           S01129 092363
     I***********                         P 261 2688PRIC           S01129 092363
     I                                    P 181 1830TDDT                  092363
     I                                    P 264 2718PRIC                  092363
     I***************                       393 393 PCOD           S01129 E19357
     I***************                     P 531 5380TCTR           S01129 E19357
     I***************                       548 548 CHTPTR         S01129 E19357
     I***********                           400 400 PCOD           E19357 092363
     I***********                         P 605 6120TCTR           E19357 092363
     I***********                           622 622 CHTPTR         E19357 092363
     I                                      403 403 PCOD                  092363
     I                                    P 608 6150TCTR                  092363
     I                                      630 630 CHTPTR                092363
     I**    - DPTMVD :  DEPOT MOVEMENTS                                   S01129
     IDPTMDS      DS                            551                       S01129
     I                                       94 1010MKTP                  135004
     I                                      126 126 RECIDP                S01129
     I                                      127 136 DPSS                  S01129
     I                                      143 144 DPMV                  S01129
     I                                    P 151 1530DPMD                  S01129
     I                                    P 160 1620DPDO                  S01129
     I**********                            169 1740DPBN                               S01129 176817
     I**********                          P 175 1800DPNA                               S01129 176817
     I**********                            239 239 CHTPDP                             S01129 176817
     I**********                            172 1770DPBN                               176817 CSD027
     I                                      172 177 DPBN                                      CSD027
     I                                    P 178 1830DPNA                                      176817
     I                                      248 248 CHTPDP                                    176817
     I/COPY WNCPYSRC,EM0101I007
     I**    - SETLED :  TRADES SETTLEMENT MAINTENANCE                     S01129
     ISETLDS      DS                            551                       S01129
     I                                      126 126 RECISE                S01129
     I                                      127 132 STDR                  S01129
     I                                    P 138 1400DOMOV                 S01332
     I                                      142 142 SRIN                  S01129
     I                                    P 143 1480SNMS                  S01129
     I                                    P 149 1550SVLS                  S01129
     I                                      209 218 SSSN                  S01129
     I                                      219 224 SCPN                  S01129
     I                                      226 227 STET                  S01129
     I                                      228 230 SSCY                  S01129
     I                                      236 236 CHTPSE                S01129
      *                                                                   S01332
     I***DEALDG      DS                            760             S01332 CIR002
     IDEALDG      DS                            812                       CIR002
      * Customer number.                                                  S01332
     I**********                            136 1410DGCNUM                             S01332 CSD027
     I                                      136 141 DGCNUM                                    CSD027
      * Deal type.                                                        S01332
     I                                      145 146 DGDTYP                S01332
      * Value date (Midas format).                                        S01332
     I                                    P 152 1540DGVDAT                S01332
      * Maturity date (to use as settlement date).                        S01332
     I                                    P 155 1570DGMDAT                S01332
      * Our currency.                                                     S01332
     I                                      179 181 DGCCY                 S01332
      * Our principal amount.                                             S01332
     I                                    P 182 1880DGPAMO                S01332
      * Their currency.                                                   S01332
     I                                      323 325 DGTCCY                S01332
      *Their principal amount                                             S01332
     I                                    P 326 3320DGPAMT                S01332
      * Last change type.                                                 S01332
     I                                      722 722 DGCHTP                S01332
      * Our Unsettled Interest                                            CIR002
     I                                    P 781 7880DGOUSI                CIR002
      * Our Unsettled Interest Adjustment                                 CIR002
     I                                    P 789 7960DGOUSA                CIR002
      * Their Unsettled Interest                                          CIR002
     I                                    P 797 8040DGTUSI                CIR002
      * Their Unsettled Interest Adjustment                               CIR002
     I                                    P 805 8120DGTUSA                CIR002
      *                                                                   S01408
     I/COPY WNCPYSRC,EM0101IIP1                                           S01408
      *                                                                   S01332
     IPOSTIT      DS                            310                       S01332
      * Customer Number.                                                  S01332
     I                                      130 135 FOCNUM                S01332
      * Instrument Type.                                                  S01332
     I                                      136 140 FOTYP                 S01332
      * Long open position(current).                                      S01332
     I                                    P 179 1820FOLOP                 S01332
      * Short open position(current).                                     S01332
     I                                    P 183 1860FOSOP                 S01332
      * Currency.                                                         S01332
     I**********                            223 225 FOISCY                           S01332 MD034328
     I                                      229 231 FOISCY                                  MD034328
     IDSINVK      DS                                                      S01129
     I                                        1   3 NMCY                  S01129
     I                                        4   6 SITP                  S01129
     IDSCLNT      DS                                                      S01129
     I**********                              1   60KYCNUM                             S01129 CSD027
     I                                        1   6 KYCNUM                                    CSD027
     I                                        7   7 KYRCDT                S01129
     I            DS                                                      BHF848
     I**  DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE        BHF848
     I                                        1   80@@DTIN                BHF848
     I                                        1   40@@YYYY                BHF848
     I                                        3   40@@YY                  BHF848
     I                                        1   20@@CC                  BHF848
     I                                        5   60@@MTH                 BHF848
     I                                        7   80@@DAY                 BHF848
     I*                                                                   BHF848
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   CIR002
     ISCSARD    E DSSCSARDPD                                              CIR002
     I** External data structure for Switchable Features                  CIR002
      *                                                                   CLE004
     ISDBRCH    E DSSDBRCHPD                                              CLE004
      ** External data structure for Branch Details                       CLE004
     I*                                                                   135004
     ISDBANK    E DSSDBANKPD                                              135004
     I**  EXTERNAL DS FOR BANK DETAILS                                    135004
     I*                                                                   S01332
     I/COPY WNCPYSRC,EM0101IIP2                                           S01408
      *                                                                   S01332
      ** Data structure for program EM0010 (Currency Conversion)          CTI002
     I/COPY EMCPYSRC,EM0010I001                                           CTI002
      *                                                                   CTI002
      ** Data structure for program EM0998 (Keep Track of Batch)          CTI002
     I/COPY EMCPYSRC,EM0998I001                                           CTI002
     IDSFDY     E DSDSFDY                                                 S01332
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01332
     IDSSDY     E DSDSSDY                                                 CTI002
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                CTI002
     I*                                                                   S01332
     I* DATA STRUCTURE FOR ACCESS PROGRAM (to see if open position        S01332
     I* should be taken GROSS or NET)                                     S01332
     ISDEXPM    E DSSDEXPMPD                                              S01332
     ISDCURR    E DSSDCURRPD                                              CTI002
     IACODDS    E DSSDACODPD                                              CTI002
     IPOSTDS    E DSTIPOSTPD                                              CTI002
     I              CNUM                            CNUMTI                CTI002
     I              ACOD                            ACODTI                CTI002
     I              CCY                             CCYTI                 CTI002
     I              ACODQQ                          QQACO2                                    CGL029
      *                                                                                       CTI007
     IATMIDS    E DSGLATMIPD                                                                  CTI007
      *                                                                                       CTI007
     IKEY2DS      DS                                                      CTI002
     I**********                              1   60CNUMK2                             CTI002 CSD027
     I                                        1   6 CNUMK2                                    CSD027
     I**********                              7  100ACODK2                             CTI002 CGL029
     I**********                             11  160TRSQK2                             CTI002 CGL029
     I                                        7  160ACODK2                                    CGL029
     I                                       17  180TRSQK2                                    CGL029
     IKEY3DS      DS                                                      CTI002
     I**********                              1   60CNUMK3                             CTI002 CSD027
     I                                        1   6 CNUMK3                                    CSD027
     I**********                              7  100ACODK3                             CTI002 CGL029
     I                                        7  160ACODK3                                    CGL029
0510 I**
0511 I** DATA STRUCTURE FOR DATABASE ERRORS
     ILDA       E DS                                                      CTI002
     I              DBKEY                           DBKY                  CTI002
0512 I**********LDA        UDS                            256             CTI002
0513 I**********                            134 138 DBFILE                S01117
0514 I**********                            139 167 DBKY                  S01117
0515 I**********                            168 175 DBPGM                 S01117
0516 I**********                            176 1770DBASE                 S01117
     I**********                            134 141 DBFILE          S01117CTI002
     I**********                            142 170 DBKY            S01117CTI002
     I**********                            171 180 DBPGM           S01117CTI002
     I**********                            181 1830DBASE           S01117CTI002
0517 I/EJECT
     C*****************************************************************
     C**                   MAIN CYCLE PROCESSING                      *
     C*****************************************************************
     C                     MOVEACPY@      BIS@   80
     C**
     C**    ENTRY PARAMETERS FROM EXITPGM OF RCVJRNE COMMAND
     C**
     C           *ENTRY    PLIST
     C                     PARM           JRNENT
     C                     PARM           CALLCD  1
     C**
     C           *LIKE     DEFN FACT      FACT1
     C           *LIKE     DEFN FCNO1     FCNO
     C************LIKE*****DEFN MDAT1     MDAT                            BHF848
     C           *LIKE     DEFN MDATCL    MDAT                            BHF848
     C************LIKE*****DEFN CHTPA1    CHTPA                           CDL002
     C           *LIKE     DEFN FHCHTP    CHTPA                           CDL002
     C************LIKE     DEFN DTYP1     DTYP                            CDL002
     C           *LIKE     DEFN FHTYPE    DTYP                            CDL002
     C           *LIKE     DEFN MDAT      WDAT
     C           *LIKE     DEFN MDAT      OTDT                            BHF848
     C           *LIKE     DEFN MDAT      SADT                            BHF848
     C           *LIKE     DEFN MDAT      VDAT                            BHF848
     C           *LIKE     DEFN MDAT      WVDAT                           169798
     C           *LIKE     DEFN FHDAM1    PUAM                            BHF848
     C           *LIKE     DEFN FHDAM1    SLAM                            BHF848
     C           *LIKE     DEFN FHCCY1    PUCY                            BHF848
     C           *LIKE     DEFN FHCCY1    SUCY                            BHF848
     C*                                                                   S01129
     C*   Key to Investment Type File                                     S01129
     C*                                                                   S01129
     C           KYINVT    KLIST                                          S01129
     C                     KFLD           NMCY                            S01129
     C                     KFLD           SITP                            S01129
     C*                                                                   S01129
     C*   Key to Clint File                                               S01129
     C*                                                                   S01129
     C           KYCLNT    KLIST                                          S01129
     C                     KFLD           KYCNUM                          S01129
     C                     KFLD           KYRCDT                          S01129
     C*                                                                   CTI002
     C**  Key to TF sub type detail (EMTFEXL0)                            CTI002
     C*                                                                   CTI002
     C           KTFEX0    KLIST                                          CTI002
     C                     KFLD           EXCNUM                          CTI002
     C                     KFLD           EXACNO                          CTI002
     C                     KFLD           EXTRNS                          CTI002
     C*                                                                   CTI002
     C**  Key to TF sub type detail (EMTFEXL2)                            CTI002
     C*                                                                   CTI002
     C           KTFEX2    KLIST                                          CTI002
     C                     KFLD           EXACNO                          CTI002
     C*                                                                   CTI002
     C**  Key to TF customer balance (EMTFCBL0)                           CTI002
     C*                                                                   CTI002
     C           KTFCB0    KLIST                                          CTI002
     C                     KFLD           CBCUST                          CTI002
     C                     KFLD           CBACNO                          CTI002
     C*                                                                   CTI002
     C**  Key to TF customer balance (EMTFCBL1)                           CTI002
     C*                                                                   CTI002
     C           KTFCB1    KLIST                                          CTI002
     C                     KFLD           CBACNO                          CTI002
     C*                                                                   CTI002
     C**  Key to TF sub type total (EMTFSAL1)                             CTI002
     C*                                                                   CTI002
     C           KTFSA1    KLIST                                          CTI002
     C                     KFLD           SAACOD                          CTI002
     C*                                                                   CTI002
     C**  Key to TF sub line (EMTFSLL0)                                   CTI002
     C*                                                                   CTI002
     C           KTFSL0    KLIST                                          CTI002
     C                     KFLD           SLTYPE                          CTI002
     C*                                                                   CTI002
     C**  Key to Midas SD account code (SDACODPD)                         CTI002
     C*                                                                   CTI002
     C           KACOD1    KLIST                                          CTI002
     C                     KFLD           A5ACCD                          CTI002
     C**
     C** FIRST CYCLE CALCULATIONS
     C  N50                EXSR FIRST
     C   99                SETON                     U7U8
     C   99                GOTO END
     C  N50                SETON                     50
     C**
     C** MAIN BODY
     C**
     C*
     C*  CALLCD EQ 1 => THERE IS DATA FOR JOURNALLING
     C*
     C           CALLCD    IFEQ '1'
     C                     Z-ADD0         N       20
     C                     Z-ADD0         EXP
      *                                                                   S01332
      **  Set scale indicator to N(no).                                   S01332
     C                     MOVE 'N'       @SCALE  1                       S01332
     C                     MOVE 'N'       @SCAL2  1                       CTI002
     C*
     C*      SETOF INDICATORS
     C*
     C                     MOVEA'00'      *IN,1
     C                     MOVEA'0000'    *IN,15
     C                     MOVEA'0'       *IN,22
     C                     MOVEA'00'      *IN,46
     C                     MOVEA'0'       *IN,55
     C                     MOVEA'00'      *IN,80
     C**
     C** EXECUTE APPROPRIATE SUBROUTINE BASED ON FILE NAME ON JOURNAL
     C**
      *                                                                   BHF848
      ** Amend so as to detect DRS file names rather than Midas deals     BHF848
      ** file names. Still execute same sub-routine as we are mapping     BHF848
      ** DRS fields to equivalent Midas fields via data structures.       BHF848
      *                                                                   BHF848
     C***********JFILE*****CASEQ'DEALSDB' DLSDB                           BHF848
     C***********JFILE*****CASEQ'DEALSDC' DLSDC                           BHF848
     C***********JFILE*****CASEQ'DEALSDD' DLSDD                           BHF848
     C***********JFILE*****CASEQ'DEAMSDI' DEAMS                           BHF848
     C           JFILE     CASEQ'FXDEALPP'DLSDB                           BHF848
     C           JFILE     CASEQ'MMDELDPP'DLSDC                           BHF848
     C           JFILE     CASEQ'MMDENBPP'DLSDD                           BHF848
     C           JFILE     CASEQ'MMDEAMPP'DEAMS                           BHF848
     C***********JFILE     CASEQ'LOANSCS' LNSCS                           RT0137
     C           JFILE     CASEQ'CLOANCL' CLOANR
     C           JFILE     CASEQ'LOAMSDK' LOAMS
     C***********JFILE     CASEQ'LOANSCR' LNSCR                           RT0137
     C           JFILE     CASEQ'FCLTYFM' FCLTY
     C***********JFILE     CASEQ'FACILFB' FACIL                           RT0137
     C***********JFILE     CASEQ'ACCNTAB' ACCNT                           CCB002
     C           JFILE     CASEQ'ACCNTAB' ACCNTA                          CCB002
     C***********JFILE     CASEQ'REPAYRD' REPAY                           RT0137
     C           JFILE     CASEQ'MEMOS'   MEMOS
     C           JFILE     CASEQ'TRADSD'  TRADSD                          S01129
     C           JFILE     CASEQ'DPTMVD'  DPTMVD                          S01129
     C           JFILE     CASEQ'SETLED'  SETLED                          S01129
     C           JFILE     CASEQ'DEALSDG' FRAIRS                          S01332
     C/COPY WNCPYSRC,EM0101CCP1                                           S01408
     C           JFILE     CASEQ'OTC'     FUTOPT                          S01332
     C           JFILE     CASEQ'FXNETMPD'FXNETM                          CDL002
     C           JFILE     CASEQ'SDACODPD'SDACOD                          CTI002
     C           JFILE     CASEQ'TIPOSTPD'TIPOST                          CTI002
     C           JFILE     CASEQ'GLATMIPD'TIATMI                                              CTI007
     C                     END
     C**
     C           END       TAG                             ** TAG END **
     C*          =============
      *                                                                                       176817
     C           *INU7     IFEQ *ON                                                           176817
     C           *INU8     OREQ *ON                                                           176817
     C                     EXSR *PSSR                                                         176817
     C                     END                                                                176817
     C**
     C*  UPDATE EMCEX HEADER WITH JOURNAL RECEIVER AND SEQUENCE NO.
     C*
     C           JOENTT    IFEQ 'XJ'
     C                     SETON                       U6LR
     C                     MOVE '9'       CALLCD
     C                     END
     C*
     C           JOENTT    IFEQ 'XE'
     C                     SETON                         LR
     C                     MOVE '9'       CALLCD
     C                     END
     C*
     C                     EXSR GETHED
     C*
     C****                 Z-ADDJRNSQ     JNSQ                            S01128
     C                     Z-ADDJRNSQ     JOSEQN                          S01128
     C                     UPDATEMCEXX1F
     C*
     C                     COMIT
     C                     SETOF                         01
     C*
     C                     END                             CALLCD = 1
     C**
     C**  IF SHUT DOWN , THEN SETON LR AND TERMINATE JOURNALLING
     C**
     C                     SHTDN                     97
     C           *IN97     IFEQ '1'
     C                     MOVE '9'       CALLCD
     C                     MOVE '1'       *INLR
     C                     END
     C**
     C**  IF ERROR DO NOT JOURNAL; SETOF *IN99 FOR NEXT JOURNALLING
     C**
     C   99                MOVE '9'       CALLCD                          E20299
     C   99                SETOF                     99
     C**                                                                  CTI002
     C           *INLR     IFEQ '1'                                       CTI002
     C           CALLCD    OREQ '9'                                       CTI002
     C                     MOVEL'1'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     END                                            CTI002
     C*
     C                     RETRN
     C**
     C********   END OF MAIN CYCLE  ***********************************
     C/EJECT
     C********   BEGINNING OF SUBROUTINES   ***************************
     C**
     C*****************************************************************
     C*   DEALSDB - FOREIGN EXCHANGE DEALS SUBROUTINE
     C*****************************************************************
     C           DLSDB     BEGSR
     C**
     C*********************MOVE JRNENT    DEALDB                          BHF848
     C***********          MOVE JRNENT    FXDEAL                    BHF848S01332
     C*********************MOVELJRNENT    FXDEAL                    S01332CDL002
     C           2000      SUBSTJRNENT:126FXDEAL                          CDL002
     C/COPY WNCPYSRC,EM0101C014
      *                                                                   BHF848
      ** Do not process incomplete deals, ie. status = I.                 BHF848
      ***If*type*of*last*change*was*X*for*authorisation*of*deal,thenBHF848041754
      ***do*not*process*it*either.**********************************BHF848041754
      ** Just go to end of sub-routine rather than use structured         BHF848
      ** techniques.                                                      BHF848
      *                                                                   BHF848
     C           FHDSTS    IFEQ 'I'                                       BHF848
     C***********FHCHTP    OREQ 'X'                                BHF848 041754
     C                     GOTO ENDDB                                     BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C*********************MOVE DTYP1     DTYP                            CDL002
     C                     MOVE FHTYPE    DTYP                            CDL002
     C/COPY WNCPYSRC,EM0101C020
      *                                                                   BHF848
      ** Set up purchase & sale amounts and currencies from first &       BHF848
      ** second amounts and currencies.                                   BHF848
      *                                                                   BHF848
     C           FHDAM1    IFGT 0                                         BHF848
     C                     Z-ADDFHDAM1    PUAM                            BHF848
     C                     MOVE FHCCY1    PUCY                            BHF848
     C                     Z-SUBFHDAM2    FHDAM2                          S01332
     C                     Z-ADDFHDAM2    SLAM                            BHF848
     C                     MOVE FHCCY2    SUCY                            BHF848
     C                     ELSE                                           BHF848
     C                     Z-ADDFHDAM2    PUAM                            BHF848
     C                     MOVE FHCCY2    PUCY                            BHF848
     C                     Z-SUBFHDAM1    FHDAM1                          S01332
     C                     Z-ADDFHDAM1    SLAM                            BHF848
     C                     MOVE FHCCY1    SUCY                            BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C                     MOVE PUAM      AMTIN  130
     C                     MOVE PUCY      CCYIN   3
     C                     MOVE SLAM      SAMTIN 130
     C                     MOVE SUCY      SCCYIN  3
     C************         MOVE CNUM      UPCUS   60                      LN0071
     C*********************MOVE CNUM      UPCUS   6                LLN0071CDL002
     C                     MOVE FHDCNO    UPCUS   6                       CDL002
     C*********************MOVE CHTPA1    CHTPA                           CDL002
     C                     MOVE FHCHTP    CHTPA                           CDL002
     C**
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDDB
     C*
     C           DTYP      LOKUPTABA                     47
     C           *IN47     CABEQ'0'       ENDDB
     C*
      ** Need to convert value date from YYYYMMDD to Midas day number     BHF848
      *                                                                   BHF848
     C                     Z-ADDFHVDYY    @@YYYY                          BHF848
     C                     Z-ADDFHVDMM    @@MTH                           BHF848
     C                     Z-ADDFHVDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    VDAT                            BHF848
      *                                                                   BHF848
      ** Need to convert option date from YYYYMMDD to Midas day number    BHF848
      *                                                                   BHF848
     C                     Z-ADDFHDOEY    @@YYYY                          BHF848
     C                     Z-ADDFHDOEM    @@MTH                           BHF848
     C                     Z-ADDFHDOED    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    OTDT                            BHF848
      *                                                                   BHF848
     C           DTYP      IFEQ 'OP'
     C***********OTDT      CABLERUND      ENDDB                           135632
     C           OTDT      CABLTRUND      ENDDB                           135632
     C                     ELSE
     C***********VDAT      CABLERUND      ENDDB                           135632
     C           VDAT      CABLTRUND      ENDDB                           135632
     C                     END
     C*
     C                     Z-ADD1         N
     C*
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           VDAT      SUB  RUND      @TDATE  50                      S01332
     C                     MOVE 'FX'      @DELTP  2                       S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*                                                                   S01129
     C*   Update the portfolio offset                                     S01129
     C*                                                                   S01129
     C           PIFX      IFEQ 'Y'                                       S01129
     C           VDAT      ANDGTRUND                                      S01129
     C*                                                                   S01129
     C                     MOVE *BLANKS   C1DI                                                226919
     C*********************Z-ADDCNUM      KYCNUM                   S01129 CDL002
     C**********           Z-ADDFHDCNO    KYCNUM                                       CDL002 CSD027
     C                     MOVE FHDCNO    KYCNUM                                              CSD027
     C                     MOVE '1'       KYRCDT                          S01129
     C           KYCLNT    CHAINCLINTSEF             40                   S01129
     C********** *IN40     IFEQ '1'                                                    S01129 226919
     C********** RECI      OREQ '*'                                                    S01129 226919
     C**********           SETON                     U7U899                            S01129 226919
     C**********           MOVELDSCLNT    DBKY                                         S01129 226919
     C**********           MOVEL'CLINT'   DBFILE                                       S01129 226919
     C**********           Z-ADD17        DBASE            ** DBASE17**                S01129 226919
     C**********           GOTO ENDDB                                                  S01129 226919
     C**********           END                                                         S01129 226919
     C*                                                                   S01129
     C           C1DI      IFEQ 'S'                                       S01129
     C           C1DI      OREQ 'D'                                       S01129
     C*                                                                   S01129
     C           PFTR      IFEQ 'Y'                                       S01129
     C                     MULT FEXR      EXBL                            S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     MULT -1        EXBL                            S01129
     C*                                                                   S01129
     C                     Z-ADD20        N                               S01129
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*
     C           ENDDB     ENDSR
     C*****************************************************************   CDL002
     C*   FXNETMPD - Confirmed Nets                                       CDL002
     C*****************************************************************   CDL002
     C           FXNETM    BEGSR                                          CDL002
     C*                                                                   CDL002
     C*                                                                   CDL002
      * Net FX Exposure?                                                  CDL002
     C           W#NFXE    IFEQ 'Y'                                       CDL002
      *                                                                   CDL002
      * Put Journal Entry in FXNET fields                                 CDL002
     C           1000      SUBSTJRNENT:126FXNET                           CDL002
      *                                                                   CDL002
      * Yes, update customer, amounts, etc.                               CDL002
     C           AMBSIN    IFEQ 'B'                                       CDL002
     C                     MOVE AMDBUY    AMTIN                           CDL002
     C                     MOVE AMCCYD    CCYIN                           CDL002
     C                     CLEARSAMTIN                                    CDL002
     C                     CLEARSCCYIN                                    CDL002
     C                     ENDIF                                          CDL002
     C           AMBSIN    IFEQ 'S'                                       CDL002
     C                     CLEARAMTIN                                     CDL002
     C                     CLEARCCYIN                                     CDL002
     C                     MOVE AMDBUY    SAMTIN                          CDL002
     C                     MOVE AMCCYD    SCCYIN                          CDL002
     C                     ENDIF                                          CDL002
     C                     MOVE AMCNUM    UPCUS                           CDL002
     C                     MOVE AMCHTY    CHTPA                           CDL002
     C*                                                                   CDL002
     C* Determine how the net deal is processed                           CDL002
     C                     EXSR CHECK                                     CDL002
     C           *IN46     CABEQ'0'       ENDNET                          CDL002
     C*                                                                   CDL002
     C           AMVALD    CABLERUND      ENDNET                          CDL002
     C*                                                                   CDL002
     C                     Z-ADD1         N                               CDL002
      *                                                                   CDL002
      **  Set up scaling parameters.                                      CDL002
     C           AMVALD    SUB  RUND      @TDATE  50                      CDL002
     C                     MOVE 'FX'      @DELTP  2                       CDL002
     C                     MOVE 'Y'       @SCALE                          CDL002
      *                                                                   CDL002
      * Scale FX Values                                                   CDL002
     C                     EXSR CALC                                      CDL002
     C           *IN99     IFEQ *ON                                       CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
      * Update the Exposure                                               CDL002
     C                     EXSR UPDATE                                    CDL002
     C*                                                                   CDL002
     C* Update the portfolio offset                                       CDL002
     C*                                                                   CDL002
     C           BUPIFX    IFEQ 'Y'                                       CDL002
     C           AMVALD    ANDGTRUND                                      CDL002
     C*   Access Securities Trading  customer details                     CDL002
     C**********           Z-ADDAMCNUM    KYCNUM                                       CDL002 CSD027
     C                     MOVE AMCNUM    KYCNUM                                              CSD027
     C                     MOVE '1'       KYRCDT                          CDL002
     C           KYCLNT    CHAINCLINTSEF             40                   CDL002
     C           *IN40     IFEQ '1'                                       CDL002
     C           RECI      OREQ '*'                                       CDL002
     C                     SETON                     U7U899               CDL002
     C                     MOVELDSCLNT    DBKY                            CDL002
     C                     MOVEL'CLINT'   DBFILE                          CDL002
     C                     Z-ADD33        DBASE            ** DBASE33**   CDL002
     C                     EXSR *PSSR                                     CDL002
     C                     ENDIF                                          CDL002
     C*   Customer Safe or Discretionary?                                 CDL002
     C           C1DI      IFEQ 'S'                                       CDL002
     C           C1DI      OREQ 'D'                                       CDL002
     C*                                                                   CDL002
     C                     Z-ADD20        N                               CDL002
     C*     Update Portfolio Offset                                       CDL002
     C                     EXSR UPDATE                                    CDL002
     C*                                                                   CDL002
     C                     ENDIF                                          CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   CDL002
     C           ENDNET    ENDSR                                          CDL002
     C*****************************************************************
     C*   DEALSDC - LOANS AND DEPOSITS SUBROUTINE
     C*****************************************************************
     C           DLSDC     BEGSR
     C**
     C                     SETOF                     23                   E13735
     C*********************MOVE JRNENT    DEALDC                          BHF848
     C***********          MOVE JRNENT    MMDELD                    BHF848S01332
     C                     MOVELJRNENT    MMDELD                          S01332
      *                                                                   BHF848
      ** Do not process incomplete deals, ie. status = I.                 BHF848
      ***If*type*of*last*change*was*X*for*authorisation*of*deal,thenBHF848041754
      ***do*not*process*it*either.**********************************BHF848041754
      ** Just go to end of sub-routine rather than use structured         BHF848
      ** techniques.                                                      BHF848
      *                                                                   BHF848
     C           HKDSTS    IFEQ 'I'                                       BHF848
     C***********HKCHTP    OREQ 'X'                                BHF848 041754
     C                     GOTO ENDDC                                     BHF848
     C                     END                                            BHF848
     C/COPY WNCPYSRC,EM0101C008
      *                                                                   BHF848
     C                     MOVE DTYPDC    DTYP
     C/COPY WNCPYSRC,EM0101C003
     C           PCPL      IFLT 0                                         S01332
     C                     Z-SUBPCPL      PCPL                            S01332
     C                     END                                            S01332
     C                     MOVE PCPL      AMTIN
     C                     MOVE CCY       CCYIN
     C                     MOVE CNUMDC    UPCUS
     C*********************MOVE VDATDC    VDAT                            BHF848
     C                     MOVE CHTPDC    CHTPA
      *                                                                                    MD029266B
     C                     Z-ADD0         CTRL    10                                       MD029266B
     C           REREAD    TAG                                                             MD029266B
      *                                                                                     MD029266
      ** Check if deal is attached to facility.                                             MD029266
      *                                                                                     MD029266
     C           DTYP      IFEQ 'TI'                                                        MD029266
     C                     MOVE HKDLNO    DLNO    6                                         MD029266
     C           DLNO      CHAINDLDLDCL3            N26                                     MD029266
     C           *IN26     IFEQ '0'                                                         MD029266
     C**********           MOVE F1FACT    FACT                                    MD029266 MD029266B
     C**********           MOVE F1FCNO    FCNO1                                   MD029266 MD029266B
     C                     Z-ADDF1FACT    FACT                                             MD029266B
     C                     Z-ADDF1FCNO    FCNO1                                            MD029266B
     C                     ELSE                                                            MD029266B
      *                                                                                    MD029266B
     C                     ADD  1         CTRL                                             MD029266B
     C                     Z-ADD13        MSGLEN 155                                       MD029266B
     C                     MOVEACMD,1     PCMD   15                                        MD029266B
     C                     CALL 'QCMDEXC'                                                  MD029266B
     C                     PARM           PCMD                                             MD029266B
     C                     PARM           MSGLEN                                           MD029266B
     C           CTRL      IFLE 6                                                          MD029266B
     C                     GOTO REREAD                                                     MD029266B
     C                     ENDIF                                                           MD029266B
     C                     ENDIF                                                            MD029266
     C                     ENDIF                                                            MD029266
      *                                                                                     MD029266
     C           FACT      IFEQ *ZEROS                                    E13735
     C           FCNO1     ANDEQ*ZEROS                                    E13735
     C                     SETON                     23                   E13735
     C                     MOVE *ZEROS    FACT1                           E13735
     C                     MOVE *ZEROS    FCNO                            E13735
     C                     END                                            E13735
     C***********          MOVE FACT      FACT1                           E13735
     C***********          MOVE FCNO1     FCNO                            E13735
     C  N23                MOVE FACT      FACT1                           E13735
     C  N23                MOVE FCNO1     FCNO                            E13735
      *                                                                   BHF848
      ** Need to convert maturity date from YYYYMMDD to Midas day no.     BHF848
      *                                                                   BHF848
     C                     Z-ADDHKMDYY    @@YYYY                          BHF848
     C                     Z-ADDHKMDMM    @@MTH                           BHF848
     C                     Z-ADDHKMDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    MDAT                            BHF848
      *                                                                   BHF848
     C*********************MOVE MDAT1     MDAT                            BHF848
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDDC
     C*
     C           DTYP      LOKUPTABB                     47
     C           *IN47     CABEQ'0'       ENDDC
     C*
      ** Need to convert value date from YYYYMMDD to Midas day no.        BHF848
      *                                                                   BHF848
     C                     Z-ADDHKVDYY    @@YYYY                          BHF848
     C                     Z-ADDHKVDMM    @@MTH                           BHF848
     C                     Z-ADDHKVDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    VDAT                            BHF848
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP11                                           S01408
      *                                                                   BHF848
     C********** VDAT      CABGTRUND      ENDDC                                               134237
     C           VDAT      CABGTRUND      ENDDC                                             MD020363
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP12                                           S01408
      *                                                                   169798
      ** If MM deal is a Rollover deal, include in exposure only on       169798
      ** value date.                                                      169798
      *                                                                   169798
     C           HKDADN    IFNE *BLANKS                                   169798
     C           VDAT      CABGTRUND      ENDDC                           169798
     C                     ENDIF                                          169798
     C*
     C           MDAT      IFNE 0
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP17                                           S01408
     C*                                                                   S01408
     C           MDAT      CABLERUND      ENDDC
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP18                                           S01408
     C*                                                                   S01408
     C                     END
     C*
     C           DTYP      IFEQ 'IP'
     C           DTYP      OREQ 'CL'
     C                     Z-ADD3         N
     C                     END
     C   23      DTYP      IFEQ 'TI'                                      E13735
     C                     Z-ADD3         N                               E13735
     C                     END                                            E13735
     C           DTYP      IFEQ 'IT'
     C           DTYP      OREQ 'TD'
     C           DTYP      OREQ 'CD'
     C                     Z-ADD4         N
     C                     END
     C***********DTYP      IFEQ 'TI'                                      E13735
     C***********DTYP      OREQ 'LN'                                      E13735
     C           DTYP      IFEQ 'LN'                                      E13735
     C           DTYP      OREQ 'DL'
     C                     Z-ADD6         N
     C                     END
     C  N23      DTYP      IFEQ 'TI'                                      E13735
     C                     Z-ADD6         N                               E13735
     C                     END                                            E13735
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           MDAT      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'MM'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDDC     ENDSR
     C*****************************************************************
     C*   DEALSDD - NEGOTIABLE ASSETS PURCHASED SUBROUTINE
     C*****************************************************************
     C           DLSDD     BEGSR
     C**
     C*********************MOVE JRNENT    DEALDD                          BHF848
     C***********          MOVE JRNENT    MMDENB                    BHF848S01332
     C                     MOVELJRNENT    MMDENB                          S01332
     C/COPY WNCPYSRC,EM0101C015
      *                                                                   BHF848
      ** Do not process incomplete deals, ie. status = I.                 BHF848
      ***If*type*of*last*change*was*X*for*authorisation*of*deal,thenBHF848041754
      ***do*not*process*it*either.*********************************BHF848 041754
      ** Just go to end of sub-routine rather than use structured         BHF848
      ** techniques.                                                      BHF848
      *                                                                   BHF848
     C           HLDSTS    IFEQ 'I'                                       BHF848
     C***********HLCHTP    OREQ 'X'                                BHF848 041754
     C                     GOTO ENDDD                                     BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C           FVAL      IFLT 0                                         S01332
     C                     Z-SUBFVAL      FVAL                            S01332
     C                     END                                            S01332
     C                     MOVE FVAL      AMTIN
     C                     MOVE CCYDD     CCYIN
     C                     MOVE ISCN      UPCUS
      *                                                                   BHF848
      ** Need to convert value date from YYYYMMDD to Midas day no.        BHF848
      *                                                                   BHF848
     C                     Z-ADDHLVDYY    @@YYYY                          BHF848
     C                     Z-ADDHLVDMM    @@MTH                           BHF848
     C                     Z-ADDHLVDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    VDAT                            BHF848
      *                                                                   BHF848
     C*********************MOVE VDATDD    VDAT                            BHF848
      *                                                                   BHF848
      ** Need to convert maturity date from YYYYMMDD to Midas day no.     BHF848
      *                                                                   BHF848
     C                     Z-ADDHLMDYY    @@YYYY                          BHF848
     C                     Z-ADDHLMDMM    @@MTH                           BHF848
     C                     Z-ADDHLMDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    MDAT                            BHF848
      *                                                                   BHF848
     C*********************MOVE MDATDD    MDAT                            BHF848
     C                     MOVE FACTDD    FACT1
     C                     MOVE FCNODD    FCNO
     C                     MOVE CHTPDD    CHTPA
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDDD
     C*
     C/COPY WNCPYSRC,EM0101CP13                                           S01408
     C*                                                                   S01408
     C********** VDAT      CABGTRUND      ENDDD                                               134237
     C           VDAT      CABGTRUND      ENDDD                                             MD020363
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP14                                           S01408
     C*
      ** Need to retrieve the sale date from the related sale record      BHF848
      ** if one exists, ie. HLDADN is not blank.                          BHF848
      ** Key is set up in data structure, so just chain to the file.      BHF848
      ** Standard database error processing if record is not found.       BHF848
      *                                                                   BHF848
     C                     Z-ADD0         SADT                            BHF848
      *                                                                   BHF848
     C           HLDADN    IFNE *BLANKS                                   BHF848
      *                                                                   BHF848
     C           KYDENS    CHAINMMDEALLL             89                   BHF848
      *                                                                   BHF848
     C           *IN89     IFEQ '1'                                       BHF848
     C           HMDLTF    OREQ '*'                                       BHF848
     C                     SETON                     U7U899               BHF848
     C                     MOVELKYDENS    DBKY                            BHF848
     C                     MOVEL'MMDEALLL'DBFILE                          BHF848
     C                     Z-ADD31        DBASE            ** DBASE31**   BHF848
     C                     GOTO ENDDD                                     BHF848
      *                                                                   BHF848
     C                     ELSE                                           BHF848
      *                                                                   BHF848
      ** otherwise, need to convert value date from YYYYMMDD to Midas     BHF848
      ** day number and set it up as the sale date.                       BHF848
      *                                                                   BHF848
     C                     Z-ADDHMVDYY    @@YYYY                          BHF848
     C                     Z-ADDHMVDMM    @@MTH                           BHF848
     C                     Z-ADDHMVDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    SADT                            BHF848
      *                                                                   BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C****MATD*IS*FROM*THE*SYNDICATED*LOANS*DETAILS*AND*SO*DOES*NOT RT0137E26186
     C*****NEED*TO*BE*TESTED*AGAINST                                RT0137E26186
     C***********                                                   RT0137E26186
     C***********SADT      IFNE 0                                         RT0137
     C***********SADT      ANDLTMATD                                      RT0137
     C***********          MOVE SADT      WDAT                            RT0137
     C***********          ELSE                                           RT0137
     C***********          MOVE MDAT      WDAT                            RT0137
     C***********          END                                            RT0137
     C***********                                                   RT0137E26186
     C***********SADT      IFNE 0                                   RT0137E26186
     C***********          MOVE SADT      WDAT                      RT0137E26186
     C***********          ELSE                                     RT0137E26186
     C***********          MOVE MDAT      WDAT                      RT0137E26186
     C***********          END                                      RT0137E26186
     C*                                                                   E26186
     C**  USE THE EARLIER OF SALE DATE (SADT) AND MATURITY DATE (MDAT)    E26186
     C           SADT      IFNE 0                                         E26186
     C           SADT      ANDLTMDAT                                      E26186
     C                     MOVE SADT      WDAT                            E26186
     C                     ELSE                                           E26186
     C                     MOVE MDAT      WDAT                            E26186
     C                     END                                            E26186
     C*
     C           WDAT      IFNE 0
     C           WDAT      CABLERUND      ENDDD
     C                     END
     C*
     C           FACT1     IFEQ 0
     C                     Z-ADD3         N
     C                     ELSE
     C                     Z-ADD6         N
     C                     END
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           MDAT      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'MM'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDDD     ENDSR
     C*****************************************************************
     C*   DEAMSDI  - DEAL AMENDMENTS SUBROUTINE
     C*****************************************************************
     C           DEAMS     BEGSR
     C**
     C*********************MOVE JRNENT    DEAMDI                          BHF848
     C***********          MOVE JRNENT    MMDEAM                    BHF848S01332
     C                     MOVELJRNENT    MMDEAM                          S01332
     C/COPY WNCPYSRC,EM0101C016
      *                                                                   BHF848
      ** Do not process incomplete deals, ie. status = I.                 BHF848
      ***If*type*of*last*change*was*X*for*authorisation*of*deal,thenBHF848041754
      ***do*not*process*it*either.*********************************BHF848 041754
      ** Just go to end of sub-routine rather than use structured         BHF848
      ** techniques.                                                      BHF848
      *                                                                   BHF848
     C           HNDSTS    IFEQ 'I'                                       BHF848
     C***********HNCHTP    OREQ 'X'                                BHF848 041754
     C                     GOTO ENDDM                                     BHF848
     C                     END                                            BHF848
      *                                                                   BHF848
     C           DAAM      IFLT 0                                         S01332
     C                     Z-SUBDAAM      DAAM                            S01332
     C                     END                                            S01332
     C                     MOVE DAAM      AMTIN
     C                     MOVE CCYDI     CCYIN
     C                     MOVE CNUMDI    UPCUS
     C                     MOVE DTYPDI    DTYP
     C*********************MOVE VDATDI    VDAT                            BHF848
     C                     MOVE CHTPDI    CHTPA
     C/COPY WNCPYSRC,EM0101C021
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDDM
     C*
     C           AMTP      IFNE 'PI'
     C           AMTP      ANDNE'PD'
     C                     GOTO ENDDM
     C                     END
     C*
     C           DTYP      LOKUPTABB                     47                                 BUG21694
     C           *IN47     CABEQ'0'       ENDDM                                             BUG21694
      *                                                                                     BUG21694
      ** Need to convert value date from YYYYMMDD to Midas day no.        BHF848
      *                                                                   BHF848
     C                     Z-ADDHNVDYY    @@YYYY                          BHF848
     C                     Z-ADDHNVDMM    @@MTH                           BHF848
     C                     Z-ADDHNVDDD    @@DAY                           BHF848
      *                                                                   BHF848
     C                     EXSR ZA0680                                    BHF848
      *                                                                   BHF848
     C                     Z-ADD@@MDNO    VDAT                            BHF848
      *                                                                   BHF848
     C********** VDAT      CABGTRUND      ENDDM                                               134237
     C           VDAT      CABGTRUND      ENDDM                                             MD020363
      *                                                                   169798
      ** Check if deal amendment is a Loans/Deposit transaction.          169798
      *                                                                   169798
     C           HNDA38    CHAINMMDELDD0             70                   169798
      *                                                                   169798
      ** If MM transaction and it is a rollover deal, include in          169798
      ** exposure only on value date of the deal.                         169798
      *                                                                   169798
     C           *IN70     IFEQ '0'                                       169798
     C           HKDADN    ANDNE*BLANKS                                   169798
     C                     Z-ADDHKVDYY    @@YYYY                          169798
     C                     Z-ADDHKVDMM    @@MTH                           169798
     C                     Z-ADDHKVDDD    @@DAY                           169798
     C                     EXSR ZA0680                                    169798
     C                     Z-ADD@@MDNO    WVDAT                           169798
     C           WVDAT     CABGTRUND      ENDDM                           169798
     C                     ENDIF                                          169798
     C*
     C           DTYP      IFEQ 'CL'
     C                     Z-ADD3         N
     C                     END
     C           DTYP      IFEQ 'CD'
     C                     Z-ADD4         N
     C                     END
     C           DTYP      IFEQ 'DL'
     C                     Z-ADD6         N
     C                     END
     C           DTYP      IFEQ 'TI'                                                        BUG21694
     C           DTYP      OREQ 'IP'                                                        BUG21694
     C                     Z-ADD3         N                                                 BUG21694
     C                     ENDIF                                                            BUG21694
     C           DTYP      IFEQ 'TD'                                                        BUG11321
     C           DTYP      OREQ 'IT'                                                        BUG21694
     C                     Z-ADD4         N                                                 BUG11321
     C                     END                                                              BUG11321
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           VDAT      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'MM'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C*
     C                     EXSR CALC
     C           AMTP      IFEQ 'PD'
     C                     MULT -1        EXBL
     C                     END
     C*
     C                     EXSR UPDATE
     C*
     C           ENDDM     ENDSR
     C*****************************************************************
     C****LOANSCS  -  SYNDICATED LOANS SUBROUTINE                         RT0137
     C*****************************************************************
     C***********LNSCS     BEGSR                                          RT0137
     C***********                                                         RT0137
     C***********          MOVE JRNENT    LOANCS                          S01332
     C***********          MOVELJRNENT    LOANCS                    S01332RT0137
     C***********LNTP      IFEQ 'TE'                                      RT0137
     C***********LNTP      OREQ 'RC'                                      RT0137
     C***********          MOVE ODDC      AMTIN                           RT0137
     C***********          MOVE DDCY      CCYIN                           RT0137
     C***********          ELSE                                           RT0137
     C***********          MOVE PRLA      AMTIN                           RT0137
     C***********          MOVE CMCY      CCYIN                           RT0137
     C***********          END                                            RT0137
     C***********          MOVE BWCN      UPCUS                           RT0137
     C***********          MOVE CHTPCS    CHTPA                           RT0137
     C***********                                                         RT0137
     C***********          EXSR CHECK                                     RT0137
     C************IN46     CABEQ'0'       ENDCS                           RT0137
     C***********                                                         RT0137
     C***********          Z-ADD6         N                               RT0137
     C***********                                                         RT0137
     C***********          EXSR CALC                                      RT0137
     C***********                                                         RT0137
     C***********          EXSR UPDATE                                    RT0137
     C***********                                                         RT0137
     C***********ENDCS     ENDSR                                          RT0137
     C*****************************************************************
     C*   CLOANCL - CUSTOMER LOANS SUBROUTINE
     C*****************************************************************
     C           CLOANR    BEGSR
     C**
     C***********          MOVE JRNENT    LOANCL                          S01332
     C                     MOVELJRNENT    LOANCL                          S01332
     C           PTYP      LOKUPTABD                     47
     C           *IN47     CABEQ'0'       ENDCL
     C*                                                                                      222471
     C                     EXSR CHECK                                                        222471
     C           *IN46     CABEQ'0'       ENDCL                                              222471
      *                                                                   CLE004
     C                     MOVELLNRFCL    CLONKY                          CLE004
     C                     MOVE 'A'       CLONKY                          CLE004
     C           CLONKY    CHAINCLOAN                40                   CLE004
      *                                                                   CLE004
     C********** *IN15     IFEQ *OFF                                                   CLE004 222471
      *                                                                                       222471
      * Skip if loan is not found.                                                            222471
     C           *IN40     IFEQ *ON                                                           222471
     C                     GOTO ENDCL                                                         222471
     C                     SETON                     U7U899               CLE004
     C                     MOVE CLONKY    DBKY                            CLE004
     C                     MOVE 'CLOAN'   DBFILE                          CLE004
     C                     Z-ADD36        DBASE            ** DBASE 36**  CLE004
     C                     GOTO ENDCL                                     CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     MOVELLNRFCL    CLONKY                          CLE004
     C                     MOVE 'B'       CLONKY                          CLE004
     C           CLONKY    CHAINCLOAN                40                   CLE004
      *                                                                   CLE004
     C********** *IN21     IFEQ *OFF                                                   CLE004 222471
      *                                                                                       222471
      * If not found delay job and try again                                                  222471
     C           *IN40     IFEQ *ON                                                           222471
     C                     CALL 'ACDEL20'                                                     222471
      *                                                                                       222471
     C           CLONKY    CHAINCLOAN                40                                       222471
      *                                                                                       222471
      * Error if not found.                                                                   222471
     C           *IN40     IFEQ *ON                                                           222471
     C                     SETON                     U7U899               CLE004
     C                     MOVE CLONKY    DBKY                            CLE004
     C                     MOVE 'CLOAN'   DBFILE                          CLE004
     C                     Z-ADD37        DBASE            ** DBASE 37**  CLE004
     C                     GOTO ENDCL                                     CLE004
     C                     ENDIF                                          CLE004
     C                     ENDIF                                                              222471
      *                                                                   CLE004
     C                     Z-ADDRLDT      WRLDT   50                      CLE004
     C                     MOVELCCYA      WCCY    3                       CLE004
      *                                                                   CLE004
      ** If SAR CLE004 is *ON                                             CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
      *                                                                   CLE004
      ** If Linked to Syndicate                                           CLE004
      *                                                                   CLE004
     C           LNKS      IFEQ 'Y'                                       CLE004
      *                                                                   CLE004
      ** Retrieve Branch Details                                          CLE004
      *                                                                   CLE004
     C**********           CALL 'AOBRCHR0'                                             CLE004 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   P@RTCD  7                       CLE004
     C                     PARM '*KEY   ' P@OPTN  7                       CLE004
     C                     PARM BRCA      P@BRCD  3                       CLE004
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CLE004 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CLE004
     C           P@RTCD    IFNE *BLANKS                                   CLE004
     C                     MOVE *ON       *INU7                           CLE004
     C                     MOVE *ON       *INU8                           CLE004
     C                     MOVE *ON       *IN99                           CLE004
     C                     MOVEL'SDBRCHPD'DBFILE           ************   CLE004
     C                     Z-ADD35        DBASE            * DBERR 35 *   CLE004
     C                     MOVELBRCA      DBKY      P      ************   CLE004
     C                     GOTO ENDCL                                     CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     MOVELCNUMC     WCNUM   6                       CLE004
     C           A8BICN    IFEQ WCNUM                                     CLE004
     C                     GOTO ENDCL                                     CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
     C**
     C***********          MOVE LNRFCL    LNRF                            RT0137
     C**********           MOVE LNRFCL    LNRF    60                                   RT0137 CLE148
     C                     MOVE LNRFCL    LNRF    6                                           CLE148
     C                     MOVE VDATCL    VDAT
     C                     MOVE MDATCL    MDAT
     C                     MOVE CCYCL     CCYIN
     C                     MOVE CHTPCL    CHTPA
     C                     MOVE CPAM      AMTIN
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDCL
     C*
     C/COPY WNCPYSRC,EM0101CP15                                           S01408
     C*                                                                   S01408
     C           VDAT      CABGTRUND      ENDCL
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP16                                           S01408
     C*
     C           MDAT      IFNE 0
     C           CPAM      IFEQ 0                                         092163
     C           MDAT      CABLERUND      ENDCL
     C                     END                                            092163
     C                     END
     C*
     C*
     C***********          MOVE CNUMCL    UPCUS                           053699
     C                     MOVE FCUSCL    UPCUS                           053699
     C                     Z-ADD6         N
     C**  PARTICIPATIONS PURCHASED WITHOUT RECOURSE
     C           PTYP      IFEQ '64'
     C           PTYP      OREQ '65'
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'
     C                     MOVE OLNO      UPCUS
     C                     END
     C                     END
     C**  PARTICIPATIONS SOLD WITHOUT RECOURSE
     C           PTYP      IFEQ '66'
     C           PTYP      OREQ '67'
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'
     C                     MOVELOLNO      CLONKY  7
     C                     MOVE 'A'       CLONKY
     C           CLONKY    CHAINCLOAN                40
     C  N15                SETON                     U7U899
     C  N15                MOVE CLONKY    DBKY
     C  N15                MOVE 'CLOAN'   DBFILE
     C  N15                Z-ADD8         DBASE            ** DBASE 8 **
     C  N15                GOTO ENDCL
     C                     MOVE CNUMC     UPCUS
     C           PTYPC     IFEQ 64
     C           PTYPC     OREQ 65
     C           PTYPC     OREQ 68                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYPC     OREQ 71                                        CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSIA     IFNE 'Y'
     C                     MOVE OLNOC     UPCUS
     C                     END
     C                     END
     C                     MULT -1        AMTIN
     C                     ELSE
     C*
     C                     Z-ADD7         N
     C                     END
     C                     END
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           MDAT      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'LE'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
      *                                                                   CLE006
      ** If SAR CLE006 is *ON                                             CLE006
      *                                                                   CLE006
     C           CLE006    IFEQ *ON                                       CLE006
     C           CEU020    OREQ 'Y'                                       CEU020
      *                                                                   CLE006
     C           WRLDT     IFEQ RUND                                      CLE006
     C           WCCY      ANDNENCCY                                      CLE006
     C           NCCY      ANDNE*BLANKS                                   CLE006
      *                                                                   CLE006
     C                     MOVE LNRFCL    LNRF                            CLE006
     C                     MOVE VDATCL    VDAT                            CLE006
     C                     MOVE MDATCL    MDAT                            CLE006
     C                     MOVE CCYCL     CCYIN                           CLE006
     C                     MOVE CHTPCL    CHTPA                           CLE006
     C                     MOVE CPAM      AMTIN                           CLE006
     C                     MULT -1        AMTIN                           CLE006
      *                                                                   CLE006
     C                     MOVE FCUSCL    UPCUS                           CLE006
     C                     Z-ADD6         N                               CLE006
      *                                                                   CLE006
      ** Participations Purchased Without Recourse                        CLE006
      *                                                                   CLE006
     C           PTYP      IFEQ '64'                                      CLE006
     C           PTYP      OREQ '65'                                      CLE006
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'                                       CLE006
     C                     MOVE OLNO      UPCUS                           CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
      *                                                                   CLE006
      ** Participations Sold Without Recourse                             CLE006
      *                                                                   CLE006
     C           PTYP      IFEQ '66'                                      CLE006
     C           PTYP      OREQ '67'                                      CLE006
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'                                       CLE006
     C                     MOVELOLNO      CLONKY  7                       CLE006
     C                     MOVE 'A'       CLONKY                          CLE006
     C           CLONKY    CHAINCLOAN                40                   CLE006
     C  N15                SETON                     U7U899               CLE006
     C  N15                MOVE CLONKY    DBKY                            CLE006
     C  N15                MOVE 'CLOAN'   DBFILE                          CLE006
     C  N15                Z-ADD38        DBASE            ** DBASE 38**  CLE006
     C  N15                GOTO ENDCL                                     CLE006
     C                     MOVELOLNO      CLONKY  7                       CLE006
     C                     MOVE 'B'       CLONKY                          CLE006
     C           CLONKY    CHAINCLOAN                40                   CLE006
     C  N21                SETON                     U7U899               CLE006
     C  N21                MOVE CLONKY    DBKY                            CLE006
     C  N21                MOVE 'CLOAN'   DBFILE                          CLE006
     C  N21                Z-ADD39        DBASE            ** DBASE 39**  CLE006
     C  N21                GOTO ENDCL                                     CLE006
     C                     MOVE CNUMC     UPCUS                           CLE006
     C           PTYPC     IFEQ 64                                        CLE006
     C           PTYPC     OREQ 65                                        CLE006
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSIA     IFNE 'Y'                                       CLE006
     C                     MOVE OLNOC     UPCUS                           CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
     C                     MULT -1        AMTIN                           CLE006
     C                     ELSE                                           CLE006
      *                                                                   CLE006
     C                     Z-ADD7         N                               CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
      *                                                                   CLE006
      **  Set up scaling parameters.                                      CLE006
      *                                                                   CLE006
     C           MDAT      SUB  RUND      @TDATE                          CLE006
     C                     MOVE 'LE'      @DELTP                          CLE006
     C                     MOVE 'Y'       @SCALE                          CLE006
      *                                                                   CLE006
     C                     EXSR CALC                                      CLE006
      *                                                                   CLE006
     C                     EXSR UPDATE                                    CLE006
      *                                                                   CLE006
     C                     MOVE LNRFCL    LNRF                            CLE006
     C                     MOVE VDATCL    VDAT                            CLE006
     C                     MOVE MDATCL    MDAT                            CLE006
     C                     MOVE NCCY      CCYIN                           CLE006
     C                     MOVE CHTPCL    CHTPA                           CLE006
     C                     MOVE NCPA      AMTIN                           CLE006
      *                                                                   CLE006
     C                     MOVE FCUSCL    UPCUS                           CLE006
     C                     Z-ADD6         N                               CLE006
      *                                                                   CLE006
      ** Participations Purchased Without Recourse                        CLE006
      *                                                                   CLE006
     C           PTYP      IFEQ '64'                                      CLE006
     C           PTYP      OREQ '65'                                      CLE006
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'                                       CLE006
     C                     MOVE OLNO      UPCUS                           CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
      *                                                                   CLE006
      ** Participations Sold Without Recourse                             CLE006
      *                                                                   CLE006
     C           PTYP      IFEQ '66'                                      CLE006
     C           PTYP      OREQ '67'                                      CLE006
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSI      IFNE 'Y'                                       CLE006
     C                     MOVELOLNO      CLONKY  7                       CLE006
     C                     MOVE 'A'       CLONKY                          CLE006
     C           CLONKY    CHAINCLOAN                40                   CLE006
     C  N15                SETON                     U7U899               CLE006
     C  N15                MOVE CLONKY    DBKY                            CLE006
     C  N15                MOVE 'CLOAN'   DBFILE                          CLE006
     C  N15                Z-ADD38        DBASE            ** DBASE 38**  CLE006
     C  N15                GOTO ENDCL                                     CLE006
     C                     MOVE CNUMC     UPCUS                           CLE006
     C           PTYPC     IFEQ 64                                        CLE006
     C           PTYPC     OREQ 65                                        CLE006
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSIA     IFNE 'Y'                                       CLE006
     C                     MOVE OLNOC     UPCUS                           CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
     C                     MULT -1        AMTIN                           CLE006
     C                     ELSE                                           CLE006
      *                                                                   CLE006
     C                     Z-ADD7         N                               CLE006
     C                     END                                            CLE006
     C                     END                                            CLE006
      *                                                                   CLE006
      **  Set up scaling parameters.                                      CLE006
      *                                                                   CLE006
     C           MDAT      SUB  RUND      @TDATE                          CLE006
     C                     MOVE 'LE'      @DELTP                          CLE006
     C                     MOVE 'Y'       @SCALE                          CLE006
      *                                                                   CLE006
     C                     EXSR CALC                                      CLE006
      *                                                                   CLE006
     C                     EXSR UPDATE                                    CLE006
      *                                                                   CLE006
     C                     ENDIF                                          CLE006
      *                                                                   CLE006
     C                     ENDIF                                          CLE006
     C*
     C           ENDCL     ENDSR
     C*****************************************************************
     C*   LOAMSDK -  CUSTOMER LENDING LOANS AMENDMENTS SUBROUTINE
     C*****************************************************************
     C           LOAMS     BEGSR
     C**
     C                     MOVE '0'       *IN19
     C***********          MOVE JRNENT    LOAMDK                          S01332
     C                     MOVELJRNENT    LOAMDK                          S01332
     C***********AMTP      IFNE 'PI'                                      E19669
     C***********AMTP      ANDNE'RE'                                      E19669
     C***********AMTP      ANDNE'MR'                                      E19669
      *                                                                   CLE004
      ** If CLE004 is *OFF                                                CLE004
      *                                                                   CLE004
     C           AMTPDK    IFNE 'PI'                                      E19669
     C           AMTPDK    ANDNE'RE'                                      E19669
     C           AMTPDK    ANDNE'MR'                                      E19669
     C           CLE004    ANDEQ*OFF                                      CLE004
     C                     GOTO ENDDK
     C                     END
      *                                                                   CLE004
      ** If CLE004 is *ON, include 'PT' and 'PF'                          CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
     C           AMTPDK    ANDNE'PI'                                      CLE004
     C           AMTPDK    ANDNE'RE'                                      CLE004
     C           AMTPDK    ANDNE'MR'                                      CLE004
     C           AMTPDK    ANDNE'PT'                                      CLE004
     C           AMTPDK    ANDNE'PF'                                      CLE004
     C                     GOTO ENDDK                                     CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C                     MOVE LNRFDK    LNRF
     C                     MOVE PTYPDK    PTYP
     C                     MOVE AMTPDK    AMTP
     C                     MOVE VDATDK    VDAT
0263 C                     MOVE CCYDK     CCYIN
0264 C***********          MOVE CNUMDK    UPCUS                           053699
     C                     MOVE FCUSDK    UPCUS                           053699
0267 C                     MOVE CHTPDK    CHTPA
0269 C                     MOVE PRAM      AMTIN
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDDK
     C*
     C           VDAT      CABGTRUND      ENDDK
     C*
     C           AMTP      IFEQ 'MR'
     C           WORKXA    CABNE0         ENDDK
     C                     END
     C*
     C                     Z-ADD6         N
     C*                                                                   S01128
     C           PTYP      IFEQ '61'                                      S01128
     C           PTYP      OREQ '62'                                      S01128
     C           PTYP      OREQ '63'                                      S01128
     C           PTYP      OREQ '70'                                      S01128
     C           PTYP      OREQ '80'                                                          CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C*                                                                   S01128
     C           AMTP      IFEQ 'RE'
     C           AMTP      OREQ 'MR'
      *                                                                   CLE004
      ** If CLE004 is *ON, include 'PF'                                   CLE004
      *                                                                   CLE004
     C           CLE004    OREQ *ON                                       CLE004
     C           AMTP      ANDEQ'PF'                                      CLE004
      *                                                                   CLE004
     C                     MULT -1        AMTIN
     C                     END
     C                     END                                            S01128
     C*
     C**  PARTICIPATIONS PURCHASED/SOLD
     C           PTYP      IFEQ '64'
     C           PTYP      OREQ '65'
     C           PTYP      OREQ '66'
     C           PTYP      OREQ '67'
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MULT -1        AMTIN
     C                     MOVELLNRF      CLONKY  7
     C                     MOVE 'A'       CLONKY
     C           CLONKY    CHAINCLOAN                40
     C  N15                SETON                     U7U899
     C  N15                MOVE CLONKY    DBKY
     C  N15                MOVE 'CLOAN'   DBFILE
     C  N15                Z-ADD8         DBASE            ** DBASE 8 **
     C  N15                GOTO ENDDK
     C           RCSIA     COMP 'Y'                  1919
     C                     END
     C*
     C**  PARTICIPATIONS PURCHASED WITHOUT RECOURSE
     C   19      PTYP      IFEQ '64'
     C           PTYP      OREQ '65'
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVE OLNOC     UPCUS
     C                     END
     C*
     C**  PARTICIPATIONS SOLD WITHOUT RECOURSE
     C           *IN19     IFEQ '1'
     C           PTYP      IFEQ '66'
     C           PTYP      OREQ '67'
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     MOVELOLNOC     CLONKY
     C                     MOVE 'A'       CLONKY
     C           CLONKY    CHAINCLOAN                40
     C  N15                SETON                     U7U899
     C  N15                MOVE CLONKY    DBKY
     C  N15                MOVE 'CLOAN'   DBFILE
     C  N15                Z-ADD8         DBASE            ** DBASE 8 **
     C  N15                GOTO ENDDK
     C                     MOVE CNUMC     UPCUS
     C           PTYPC     IFEQ 64
     C           PTYPC     OREQ 65
     C           PTYP      OREQ '68'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '71'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           RCSIA     IFNE 'Y'
     C                     MOVE OLNOC     UPCUS
     C                     END
     C                     END
     C                     MULT -1        AMTIN
     C                     END
     C                     END                                            S01128
     C*
     C  N19      PTYP      IFEQ '66'                                      S01128
     C           PTYP      OREQ '67'                                      S01128
     C           PTYP      OREQ '69'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      OREQ '72'                                      CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C                     Z-ADD7         N
     C                     END
     C*
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           VDAT      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'LE'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDDK     ENDSR
     C*****************************************************************
     C****LOANSCR -  SYNDICATED LOANS COMMITMENTS SUBROUTINE              RT0137
     C*****************************************************************
     C***********LNSCR     BEGSR                                          RT0137
     C***********                                                         RT0137
     C***********          MOVE JRNENT    LOANCR                          RT0137
     C***********          MOVE LNRFCR    LNRF                            RT0137
     C***********          MOVE BWCNCR    UPCUS                           RT0137
     C***********          MOVE CMCYCR    CCYIN                           RT0137
     C***********          MOVE MATDCR    MATD                            RT0137
     C***********          MOVE CHTPCR    CHTPA                           RT0137
     C***********          MOVE ORCA      AMTIN                           RT0137
     C***********                                                         RT0137
     C***********          EXSR CHECK                                     RT0137
     C************IN46     CABEQ'0'       ENDCR                           RT0137
     C***********                                                         RT0137
     C***********FAVD      IFGT RUND                                      RT0137
     C***********MATD      ORLE RUND                                      RT0137
     C***********ORCA      OREQ 0                                         RT0137
     C***********          GOTO ENDCR                                     RT0137
     C***********          END                                            RT0137
     C***********                                                         RT0137
     C***********          Z-ADD5         N                               RT0137
     C***********                                                         RT0137
     C***********          EXSR CALC                                      RT0137
     C***********                                                         RT0137
     C***********          EXSR UPDATE                                    RT0137
     C***********                                                         RT0137
     C***********ENDCR     ENDSR                                          RT0137
     C*****************************************************************
     C*   FCLTYFM  - CUSTOMER LENDING FACILITY SUBROUTINE
     C*****************************************************************
     C           FCLTY     BEGSR
     C**
     C***********          MOVE JRNENT    FCLTDS                          S01332
     C                     MOVELJRNENT    FCLTDS                          S01332
     C                     MOVE CNUMFC    UPCUS
     C                     MOVE FACTFC    FACT1
     C                     MOVE FCNOFC    FCNO
     C                     MOVE CHTPFC    CHTPA
     C*
     C                     MOVE FAMT      AMTIN
     C                     MOVE FCCY      CCYIN
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDFM
     C*
     C           DTAP      IFGT RUND
     C           DTEX      ORLE RUND
     C           CLE005    OREQ 'Y'                                       147997
     C           TRCA      ANDEQ'CA'                                      147997
     C                     GOTO ENDFM
     C                     END
     C*
     C                     Z-ADD5         N
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDFM     ENDSR
     C*****************************************************************
     C****FACILFB -  SYNDICATED LOAN FACILITIES SUBROUTINE                RT0137
     C*****************************************************************
     C***********FACIL     BEGSR                                          RT0137
     C***********                                                         RT0137
     C***********          MOVE JRNENT    FACIDS                          RT0137
     C***********          MOVE CNUMFA    UPCUS                           RT0137
     C***********          MOVE FACTFA    FACT1                           RT0137
     C***********          MOVE FCNOFA    FCNO                            RT0137
     C***********          MOVE FAMTFA    FAMT                            RT0137
     C***********          MOVE CCYFA     CCYIN                           RT0137
     C***********          MOVE CHTPFA    CHTPA                           RT0137
     C***********                                                         RT0137
     C***********          MOVE FAMT      AMTIN                           RT0137
     C***********          MULT 1000      AMTIN                           RT0137
     C***********                                                         RT0137
     C***********          EXSR CHECK                                     RT0137
     C************IN46     CABEQ'0'       ENDFB                           RT0137
     C***********                                                         RT0137
     C***********APPD      IFGT RUND                                      RT0137
     C***********EXPD      ORLE RUND                                      RT0137
     C***********          GOTO ENDFB                                     RT0137
     C***********          END                                            RT0137
     C***********                                                         RT0137
     C***********          MOVE '1'       *IN16                           RT0137
     C***********          Z-ADD5         N                               RT0137
     C***********                                                         RT0137
     C***********          EXSR CALC                                      RT0137
     C***********                                                         RT0137
     C***********          EXSR UPDATE                                    RT0137
     C***********                                                         RT0137
     C***********ENDFB     ENDSR                                          RT0137
     C*****************************************************************
     C*   ACCNTAB -  RETAILS OVERDRAFTS ACCOUNTS SUBROUTINE
     C*****************************************************************
     C***********ACCNT     BEGSR                                          CCB002
     C           ACCNTA    BEGSR                                          CCB002
     C**
     C***********          MOVE JRNENT    ACCTDS                          S01332
     C                     MOVELJRNENT    ACCTDS                          S01332
     C                     MOVE CNUMAC    UPCUS
     C                     MOVE CCYAC     CCYIN
     C                     MOVE FCNOAC    FCNO
     C                     MOVE FACTAC    FACT1
     C                     MOVE CHTPAC    CHTPA
     C                     MOVE ODLN      AMTIN
     C*
     C                     EXSR CHECK
     C           *IN46     CABEQ'0'       ENDAB
     C*
     C           FACT1     IFNE 0
     C           FCNO      ORNE 0
     C           ODLN      OREQ 0
     C                     GOTO ENDAB
     C                     END
     C*
     C                     MOVE '1'       *IN17
     C                     Z-ADD10        N
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDAB     ENDSR
     C*****************************************************************
     C****REPAYRD -  REPAYMENTS  SUBROUTINE                               RT0137
     C*****************************************************************   RT0137
     C***********REPAY     BEGSR                                          RT0137
     C***********                                                         RT0137
     C***********          MOVE JRNENT    REPAYM                          RT0137
     C***********          MOVE LNRFRE    LNRF                            RT0137
     C***********          MOVE CMCYRE    CCYIN                           RT0137
     C***********          MOVE RPYA      AMTIN                           RT0137
     C***********          MOVE CHTPRE    CHTPA                           RT0137
     C***********                                                         RT0137
     C***********          EXSR CHECK                                     RT0137
     C************IN46     CABEQ'0'       ENDRD                           RT0137
     C***********                                                         RT0137
     C***********RPYD      CABNERUND      ENDRD                           RT0137
     C***********                                                         RT0137
     C***GET*ORIGINAL LOANS RECORD TO OBTAIN LOAN TYPE                    RT0137
     C***********LNKEY1    CHAINLOANS                40                   RT0137
     C**N22******          MOVE 'LOANS'   DBFILE                          RT0137
     C**N22******          MOVE LNKEY1    DBKY                            RT0137
     C**N22******          Z-ADD14        DBASE                           RT0137
     C**N22******          SETON                     U7U899               RT0137
     C**N22******          GOTO ENDRD                                     RT0137
     C***********                                                         RT0137
     C***CHECK*IF RC UPDATE INDICATOR OFF                                 RT0137
     C***********          MOVE BWCNL     UPCUS                           RT0137
     C***********LNTPL     IFEQ 'RC'                                      RT0137
     C***********RCUIL     ANDEQ1                                         RT0137
     C***********          MOVE '1'       *IN18                           RT0137
     C***********          ELSE                                           RT0137
     C***********LNTPL     IFNE 'RC'                                      RT0137
     C***********          MOVE '1'       *IN18                           RT0137
     C***********          END                                            RT0137
     C***********          END                                            RT0137
     C***********                                                         RT0137
     C***********          Z-ADD6         N                               RT0137
     C***********          MULT -1        AMTIN                           RT0137
     C***********                                                         RT0137
     C***********          EXSR CALC                                      RT0137
     C***********                                                         RT0137
     C***********          EXSR UPDATE                                    RT0137
     C***********                                                         RT0137
     C***********ENDRD     ENDSR                                          RT0137
     C*****************************************************************
     C*   MEMOS   -  SHADOW POSTINGS SUBROUTINE
     C*****************************************************************
     C           MEMOS     BEGSR
     C**
     C***********          MOVE JRNENT    MEMODS                          S01332
     C                     MOVELJRNENT    MEMODS                          S01332
     C**
     C           RECIME    IFNE 'D'
     C           CLBLME    OREQ 0
     C***********JOENTT    OREQ 'UB'                                      E13665
     C                     GOTO ENDME
     C                     END
     C**
     C***********          Z-ADDJOCTRR    RAKEY   50                      CCB002
     C***********RAKEY     CHAINACCNTF               99                   CCB002
     C*                                                                   CCB002
     C**  Accounts master file                                            CCB002
     C*                                                                   CCB002
     C           KKACCN    KLIST                                          CCB002
     C                     KFLD           MECNUM                          CCB002
     C                     KFLD           MECCY                           CCB002
     C                     KFLD           MEACOD                          CCB002
     C                     KFLD           MEACSQ                          CCB002
     C                     KFLD           MEBRCA                          CCB002
      *                                                                   CCB002
     C           KKACCN    CHAINACCNTF               99                   CCB002
     C  N99      RECIRA    COMP 'D'                  9999
     C*****************************************************************                     MD038999
     C***IF*RECORD*NOT*FOUND,*DATABASE*ERROR***************************                     MD038999
     C***99*****           MOVE JOCTRR    DBKY                                              MD038999
     C***99*****           Z-ADD6         DBASE            ** DBASE 6 **                    MD038999
     C***99*****           SETON                     U7U8                                   MD038999
      ** If account is no longer existing, it might be because of                           MD038999
      ** account transfer.  So, no need to issue DB error.                                  MD038999
     C   99                GOTO ENDME
     C                     MOVE FACTRA    FACT1
     C                     MOVE FCNORA    FCNO
     C                     MOVE CNUMRA    UPCUS
     C                     MOVE CCYRA     CCYIN
     C                     Z-ADDCLBLME    AMTIN
     C                     MOVE 'A'       CHTPA
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP7                                           S01408
     C*                                                                   S01408
     C                     EXSR CHECK
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP8                                           S01408
     C*                                                                   S01408
     C           *IN46     CABEQ'0'       ENDME
     C*
     C           FACT1     IFEQ 0
     C/COPY WNCPYSRC,EM0101C017
     C           AMTIN     IFGT 0
     C                     Z-ADD11        N
     C                     ELSE
     C                     Z-ADD12        N
     C                     MULT -1        AMTIN
     C                     END
     C*
     C                     ELSE
     C           AMTIN     IFGT 0
     C                     Z-ADD8         N
     C                     ELSE
     C                     Z-ADD9         N
     C                     MULT -1        AMTIN
     C                     END
     C                     END
     C*
     C                     EXSR CALC
     C*
     C                     EXSR UPDATE
     C*
     C           ENDME     ENDSR
     C*                                                                   S01129
     C*****************************************************************   S01129
     C*   S01129 - PROCESS JOURNAL ENTRIES FOR TRADS                      S01129
     C*****************************************************************   S01129
     C           TRADSD    BEGSR                                          S01129
     C***********          MOVE JRNENT    TRADDS                    S01129S01332
     C                     MOVELJRNENT    TRADDS                          S01332
     C*                                                                   S01129
     C*   Check how journal entry is to be processed                      S01129
     C                     MOVE CHTPTR    CHTPA                           S01129
     C*                                                                   S01129
     C                     EXSR CHECK                                     S01129
     C*                                                                   S01129
     C           *IN46     CABEQ'0'       ENDTR                           S01129
     C*                                                                   S01129
     C*   Access Security details                                         S01129
     C*                                                                   S01129
     C           TDSS      CHAINSECTY                40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELTDSS      DBKY                            S01129
     C                     MOVEL'SECTY'   DBFILE                          S01129
     C                     Z-ADD18        DBASE            ** DBASE18**   S01129
     C                     GOTO ENDTR                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*   Access Investment details                                       S01129
     C*                                                                   S01129
     C           KYINVT    CHAININVTP                40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSINVK    DBKY                            S01129
     C                     MOVEL'INVTP'   DBFILE                          S01129
     C                     Z-ADD19        DBASE            ** DBASE19**   S01129
     C                     GOTO ENDTR                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*   Obtain nominal ccy decimal places                               S01129
     C                     MOVE *BLANK    ZTABKY                          S01129
     C                     MOVELNMCY      WORK1                           S01129
     C                     MOVE '1'       WORK1                           S01129
     C                     MOVEL'20'      ZTABKY                          S01129
     C                     MOVE WORK1     ZTABKY                          S01129
     C           ZTABKY    CHAINTABTG10F             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     MOVE ZTABKY    DBKY                            S01129
     C                     MOVEL'TABLE'   DBFILE                          S01129
     C                     Z-ADD20        DBASE            ** DBASE 20**  S01129
     C                     SETON                     U7U899               S01129
     C                     GOTO ENDTR                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     Z-ADDNOML      WNOML                           S01129
     C*                                                                   S01129
     C* Calculate Market Value                                            S01129
     C*                                                                   S01129
     C                     Z-ADDMKPR      WPRIC  158                      S01129
      *                                                            START  135004
     C                     SELEC                                          135004
      *                                                                   135004
      * Use SECTY Market Price to get price as a %                        135004
     C           MKPR      WHNE *ZEROS                                    135004
     C                     Z-ADDMKPR      ZPRCIN                          135004
      *                                                                   135004
      *    Calculate price as a percentage                                135004
     C                     CALL 'ZPRCCAL'                                 135004
     C                     PARM TDSS      ZSECTY 10        Security       135004
     C                     PARM           ZPRCIN 158       Market price   135004
     C                     PARM BJRDNB    ZFDATE  50       Run date       135004
     C                     PARM 'P'       ZMODE   1        Give me price% 135004
     C                     PARM *ZEROS    ZPRCOT 158                      135004
     C                     PARM *BLANKS   ZRTCDE 10                       135004
     C***********          PARM NOML      ANOML  110       Nominal  135004153041
     C                     PARM NOML      ANOML  150       Nominal amount 153041
     C                     PARM 'N'       DEBUG   1                       135004
      *                                                                   135004
     C           ZRTCDE    IFNE *BLANKS                                   135004
     C                     MOVEL'ZPRCCAL 'DBFILE            ************* 135004
     C                     Z-ADD036       DBASE             *DBERROR 036* 135004
     C                     MOVELTDSS      DBKY      P       ************* 135004
     C                     SETON                     U7U899               135004
     C                     GOTO ENDTR                                     135004
     C                     ENDIF                                          135004
      *                                                                   135004
     C                     Z-ADDZPRCOT    WPRIC                           135004
      *                                                                   135004
      * Use TRADS Price                                                   135004
     C           PRIC      WHNE *ZEROS                                    135004
     C                     Z-ADDPRIC      WPRIC                           135004
      *                                                                   135004
      * Price is zero....                                                 135004
     C                     OTHER                                          135004
     C                     Z-ADD*ZEROS    WPRIC                           135004
      *                                                                   135004
     C                     ENDSL                                          135004
      *                                                              END  135004
     C/COPY WNCPYSRC,EM0101C011
     C                     EXSR CLCVAL                                    S01129
     C*                                                                   S01129
     C*   Convert to EM Limited Currency                                  S01129
     C                     Z-ADDZCONS     AMTIN                           S01129
     C                     MOVE TNMC      CCYIN                           S01129
     C                     Z-ADD0         N                               S01129
     C                     EXSR CALC                                      S01129
     C*                                                                   S01129
     C                     Z-ADDEXBL      WMKVAL 150                      S01129
     C                     Z-ADDEXBL      WEXBL  130                      S01129
     C*                                                                   S01129
     C* Calculate Book Value                                              S01129
     C*                                                                   S01129
     C           MBEX      IFEQ 'B'                                       S01129
     C                     Z-ADDPRIC      WPRIC                           S01129
     C                     EXSR CLCVAL                                    S01129
     C*                                                                   S01129
     C*   Convert to EM Limited Currency                                  S01129
     C                     Z-ADDZCONS     AMTIN                           S01129
     C                     MOVE TNMC      CCYIN                           S01129
     C                     Z-ADD0         N                               S01129
     C                     EXSR CALC                                      S01129
     C*                                                                   S01129
     C                     Z-ADDEXBL      WBKVAL 150                      S01129
     C                     Z-ADDEXBL      WEXBL  130                      S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*  Calculate Factored exposure amount if Issuer Risk Factored = Y   S01129
     C*                                                                   S01129
     C           IFTR      IFEQ 'Y'                                       S01129
     C           WEXBL     MULT EXPC      WFEXBL 150                      S01129
     C           WFEXBL    DIV  100       EXBL      H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           LSNG      IFEQ 'N'                                       S01129
     C           TDTP      ANDEQ'TS'                                      S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
     C/COPY WNCPYSRC,EM0101C001
     C*                                                                   S01129
     C*   Update Issuers Exposure                                         S01129
     C*                                                                   S01129
     C***********ISSR      IFNE *ZEROS                                    S01176
     C***********RSKC      IFNE *ZEROS                             S01176 E20684
     C***********          MOVE ISSR      UPCUS                           S01176
     C           PROT      IFEQ '9'                                       E20684
     C********** RSKC      IFNE *ZEROS                                                 E20684 CSD027
     C           RSKC      IFNE *BLANKS                                                       CSD027
     C/COPY WNCPYSRC,EM0101C007
     C                     MOVE RSKC      UPCUS                           S01176
     C                     Z-ADD18        N                               S01129
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C***********DPDO      SUB  RUND      @TDATE                    S01332092363
     C********** TDVD      SUB  RUND      @TDATE                                       092363 181500
     C           MATY      SUB  RUND      @TDATE                                              181500
     C                     MOVE 'IS'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR UPDATE                                    S01129
     C                     END                                            S01129
     C*                                                                   E20684
     C                     ELSE                                           E20684
     C********** ISSR      IFNE *ZEROS                                                 E20684 CSD027
     C           ISSR      IFNE *BLANKS                                                       CSD027
     C/COPY WNCPYSRC,EM0101C002
     C                     MOVE ISSR      UPCUS                           E20684
     C                     Z-ADD18        N                               E20684
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C***********DPDO      SUB  RUND      @TDATE                    S01332092363
     C********** TDVD      SUB  RUND      @TDATE                                       092363 181500
     C           MATY      SUB  RUND      @TDATE                                              181500
     C                     MOVE 'IS'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR UPDATE                                    E20684
     C                     END                                            E20684
     C                     END                                            E20684
     C*                                                                   S01129
     C*                                                                   S01129
     C*   Determine whether the Counterparty  Exposure is to be updated   S01129
     C*                                                                   S01129
     C**********           Z-ADDTCNR      KYCNUM                                       S01129 CSD027
     C                     MOVE TCNR      KYCNUM                                              CSD027
     C                     MOVE '1'       KYRCDT                          S01129
     C           KYCLNT    CHAINCLINTSEF             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSCLNT    DBKY                            S01129
     C                     MOVEL'CLINT'   DBFILE                          S01129
     C                     Z-ADD21        DBASE            ** DBASE21**   S01129
     C                     GOTO ENDTR                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           AUTS      IFNE 'Y'                                       S01176
     C           TDVD      ORGT RUND                                      S01176
     C*                                                                   S01129
     C           C1DI      IFEQ 'M'                                       S01129
     C*                                                                   S01129
     C                     SETOF                         45               S01129
     C*                                                                   S01129
     C           AFPC      IFEQ 'N'                                       S01129
     C*                                                                   S01129
     C                     SETON                         45               S01129
     C*                                                                   S01129
     C                     ELSE                                           S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           AFPC      IFEQ 'Y'                                       S01129
     C*                                                                   S01129
     C           TDTP      IFEQ 'TS'                                      S01129
     C           PCOD      COMP '0'                      45               S01129
     C  N45      PCOD      COMP '2'                      45               S01129
     C  N45      PCOD      COMP '3'                      45               S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           TDTP      IFEQ 'TP'                                      S01129
     C           PCOD      COMP '0'                      45               S01129
     C  N45      PCOD      COMP '2'                      45               S01129
     C  N45      PCOD      COMP '4'                      45               S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           *IN45     IFEQ '1'                                       S01129
     C*                                                                   S01129
     C* CONVERT COUNTERVALUE FROM NOMINAL TO EM LIMIT CCY                 S01129
     C*     & UPDATE COUNTERPARTY EXPOSURE ON EMCEXX2                     S01129
     C                     MOVE TCNR      UPCUS                           S01129
     C                     Z-ADDTCTR      AMTIN                           S01129
     C                     MOVE TNMC      CCYIN                           S01129
     C                     Z-ADD19        N                               S01129
     C*                                                                   S01129
     C                     EXSR CALC                                      S01129
     C*                                                                   S01129
     C* REVERSE SIGN OF THE CONVERTED SETTLED VALUE IF REQUIRED           S01129
     C*                                                                   S01129
     C           TDTP      IFEQ 'TP'                                      S01129
     C           CPTG      ANDEQ'N'                                       S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           TDVD      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'CP'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C*                                                                   S01129
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01176
     C*                                                                   S01129
     C*   Determine whether the porfolio offset is to be updated          S01129
     C*                                                                   S01129
     C**********           Z-ADDTCNR      KYCNUM                                       S01129 CSD027
     C                     MOVE TCNR      KYCNUM                                              CSD027
     C                     MOVE '1'       KYRCDT                          S01129
     C           KYCLNT    CHAINCLINTSEF             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSCLNT    DBKY                            S01129
     C                     MOVEL'CLINT'   DBFILE                          S01129
     C                     Z-ADD22        DBASE            ** DBASE22**   S01129
     C                     GOTO ENDTR                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           C1DI      IFEQ 'S'                                       S01129
     C           C1DI      OREQ 'D'                                       S01129
     C*                                                                   S01129
     C           TDVD      IFLE RUND                                      S01129
     C*                                                                   S01129
     C           PFTR      IFEQ 'Y'                                       S01129
     C                     MULT EXPC      WMKVAL                          S01129
     C                     DIV  100       WMKVAL    H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           TNMC      IFNE LCCY                                      S01129
     C                     MULT CMGN      WMKVAL                          S01129
     C                     DIV  100       WMKVAL    H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     Z-ADDWMKVAL    EXBL                            S01129
     C*                                                                   S01129
     C           TDTP      IFNE 'TS'                                      S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     MOVE TCNR      UPCUS                           S01129
     C                     Z-ADD20        N                               S01129
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           ENDTR     ENDSR                                          S01129
     C*                                                                   S01129
     C*****************************************************************   S01129
     C*   DPTMVD - PROCESS JOURNAL ENTRIES FOR DPTMVD                     S01129
     C*****************************************************************   S01129
     C           DPTMVD    BEGSR                                          S01129
     C***********          MOVE JRNENT    DPTMDS                    S01129S01332
     C                     MOVELJRNENT    DPTMDS                          S01332
     C                     MOVE DPBN      UPCUS                           S01129
     C*                                                                   S01129
     C/COPY WNCPYSRC,EM0101C009
     C           DPMV      IFEQ 'WI'                                      S01129
     C           DPMV      OREQ 'WO'                                      S01129
     C           DPMV      OREQ 'RR'                                      S01129
     C           DPMV      OREQ 'PL'                                      S01176
     C*                                                                   S01129
     C*   Check how journal entry is to be processed                      S01129
     C*                                                                   S01129
     C                     MOVE CHTPDP    CHTPA                           S01129
     C*                                                                   S01129
     C                     EXSR CHECK                                     S01129
     C*                                                                   S01129
     C           *IN46     CABEQ'0'       ENDDP                           S01129
     C*                                                                   S01129
     C           DPSS      CHAINSECTY                40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELTDSS      DBKY                            S01129
     C                     MOVEL'SECTY'   DBFILE                          S01129
     C                     Z-ADD23        DBASE            ** DBASE23**   S01129
     C                     GOTO ENDDP                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           KYINVT    CHAININVTP                40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSINVK    DBKY                            S01129
     C                     MOVEL'INVTPD'  DBFILE                          S01129
     C                     Z-ADD24        DBASE            ** DBASE24**   S01129
     C                     GOTO ENDDP                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*   Obtain nominal ccy decimal places                               S01129
     C                     MOVE *BLANK    ZTABKY                          S01129
     C                     MOVELNMCY      WORK1                           S01129
     C                     MOVE '1'       WORK1                           S01129
     C                     MOVEL'20'      ZTABKY                          S01129
     C                     MOVE WORK1     ZTABKY                          S01129
     C           ZTABKY    CHAINTABTG10F             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     MOVE ZTABKY    DBKY                            S01129
     C                     MOVEL'TABLE'   DBFILE                          S01129
     C                     Z-ADD25        DBASE            ** DBASE 25**  S01129
     C                     SETON                     U7U899               S01129
     C                     GOTO ENDDP                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C* Calculate Market Value                                            S01129
     C*                                                                   S01129
     C                     Z-ADDDPNA      WNOML                           S01129
     C*                                                                   S01129
     C                     Z-ADDMKPR      WPRIC  158                      S01129
      *                                                            START  135004
      * Use SECTY Market Price else use DPTMVD Market Price               135004
     C           MKPR      IFNE *ZEROS                                    135004
     C                     Z-ADDMKPR      ZPRCIN                          135004
     C                     ELSE                                           135004
     C                     Z-ADDMKTP      ZPRCIN                          135004
     C                     ENDIF                                          135004
      *                                                                   135004
      * If price is zero, ZPRCCAL will fall over...                       135004
     C           ZPRCIN    IFNE *ZEROS                                    135004
      *                                                                   135004
      * Calculate price as a percentage                                   135004
     C                     CALL 'ZPRCCAL'                                 135004
     C                     PARM DPSS      ZSECTY 10        Security       135004
     C                     PARM MKPR      ZPRCIN 158       Market price   135004
     C                     PARM BJRDNB    ZFDATE  50       Run date       135004
     C                     PARM 'P'       ZMODE   1        Give me price% 135004
     C                     PARM *ZEROS    ZPRCOT 158                      135004
     C                     PARM *BLANKS   ZRTCDE 10                       135004
     C***********          PARM DPNA      ANOML  110       Nominal  135004153041
     C                     PARM DPNA      ANOML  150       Nominal amount 153041
     C                     PARM 'N'       DEBUG   1                       135004
      *                                                                   135004
     C           ZRTCDE    IFNE *BLANKS                                   135004
     C                     MOVEL'ZPRCCAL 'DBFILE            ************* 135004
     C                     Z-ADD037       DBASE             *DBERROR 037* 135004
     C                     MOVELDPSS      DBKY      P       ************* 135004
     C                     SETON                     U7U899               135004
     C                     GOTO ENDDP                                     135004
     C                     ENDIF                                          135004
      *                                                                   135004
     C                     Z-ADDZPRCOT    WPRIC                           135004
      *                                                                   135004
     C                     ENDIF                                          135004
      *                                                              END  135004
     C/COPY WNCPYSRC,EM0101C012
     C                     EXSR CLCVAL                                    S01129
     C*                                                                   S01129
     C*   Convert to EM Limit CCy                                         S01129
     C                     Z-ADDZCONS     AMTIN                           S01129
     C                     MOVE NMCY      CCYIN                           S01129
     C                     Z-ADD0         N                               S01129
     C                     EXSR CALC                                      S01129
     C*                                                                   S01129
     C                     Z-ADDEXBL      WMKVAL 150                      S01129
     C                     Z-ADDEXBL      WEXBL  130                      S01129
     C*                                                                   S01129
     C*  If Portfolio factored = Y Multiply by Exposure %                 S01129
     C*                                                                   S01129
     C           PFTR      IFEQ 'Y'                                       S01129
     C           WEXBL     MULT EXPC      WWORK  150                      S01129
     C           WWORK     DIV  100       EXBL      H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*  If Nom ccy *NE limit ccy mult by Collateral %                    S01129
     C*                                                                   S01129
     C           NMCY      IFNE LCCY                                      S01129
     C           EXBL      MULT CMGN      WWORK                           S01129
     C           WWORK     DIV  100       EXBL      H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           DPMV      IFEQ 'WI'                                      S01129
     C           DPMV      OREQ 'WO'                                      S01129
     C*                                                                   S01129
     C**********           Z-ADDDPBN      KYCNUM                                       S01129 CSD027
     C                     MOVE DPBN      KYCNUM                                              CSD027
     C                     MOVE '1'       KYRCDT                          S01129
     C           KYCLNT    CHAINCLINTSEF             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSCLNT    DBKY                            S01129
     C                     MOVEL'CLINT'   DBFILE                          S01129
     C                     Z-ADD26        DBASE            ** DBASE26**   S01129
     C                     GOTO ENDDP                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           C1DI      IFEQ 'S'                                       S01129
     C           C1DI      OREQ 'D'                                       S01129
     C*                                                                   S01129
     C           DPMV      IFEQ 'WI'                                      S01129
     C                     Z-ADDDPMD      WVDATE  50                      S01129
     C                     ELSE                                           S01129
     C                     Z-ADDDPDO      WVDATE                          S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           WVDATE    IFLE RUND                                      S01129
     C*                                                                   S01129
     C           DPMV      IFNE 'WI'                                      S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     Z-ADD20        N                               S01129
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           DPMV      IFEQ 'RR'                                      S01129
     C           DPMV      OREQ 'PL'                                      S01176
     C*                                                                   S01129
     C*                                                                   S01129
     C                     Z-ADD4         N                               S01129
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           ENDDP     ENDSR                                          S01129
     C*                                                                   S01129
     C*****************************************************************   S01129
     C*   SETLED - PROCESS JOURNAL ENTRIES FOR SETLED                     S01129
     C*****************************************************************   S01129
     C           SETLED    BEGSR                                          S01129
     C***********          MOVE JRNENT    SETLDS                    S01129S01332
     C                     MOVELJRNENT    SETLDS                          S01332
     C                     MOVE SCPN      UPCUS                           S01129
     C*                                                                   S01129
     C*   Check how journal entry is to be processed                      S01129
     C                     MOVE CHTPSE    CHTPA                           S01129
     C*                                                                   S01129
     C                     EXSR CHECK                                     S01129
     C*                                                                   S01129
     C           *IN46     CABEQ'0'       ENDSE                           S01129
     C*                                                                   S01129
     C                     MOVE SCPN      KYCNUM                          S01129
     C                     MOVE '1'       KYRCDT                          S01129
     C           KYCLNT    CHAINCLINTSEF             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELDSCLNT    DBKY                            S01129
     C                     MOVEL'CLINT'   DBFILE                          S01129
     C                     Z-ADD27        DBASE            ** DBASE27**   S01129
     C                     GOTO ENDSE                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           C1DI      IFEQ 'M'                                       S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C*   Access TRADE    details                                         S01129
     C*                                                                   S01129
     C           STDR      CHAINTRADS                40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                     U7U899               S01129
     C                     MOVELSTDR      DBKY                            S01129
     C                     MOVEL'TRADS'   DBFILE                          S01129
     C                     Z-ADD30        DBASE            ** DBASE30**   S01129
     C                     GOTO ENDSE                                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C*   Determine whether the Counterparty  Exposure is to be updated   S01129
     C*                                                                   S01129
     C                     SETOF                         45               S01129
     C*                                                                   S01129
     C           AFPC      IFEQ 'N'                                       S01129
     C*                                                                   S01129
     C                     SETON                         45               S01129
     C*                                                                   S01129
     C                     ELSE                                           S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           AFPC      IFEQ 'Y'                                       S01129
     C*                                                                   S01129
     C           TDTP      IFEQ 'TS'                                      S01129
     C           PCOD      COMP '0'                      45               S01129
     C  N45      PCOD      COMP '2'                      45               S01129
     C  N45      PCOD      COMP '3'                      45               S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           TDTP      IFEQ 'TP'                                      S01129
     C           PCOD      COMP '0'                      45               S01129
     C  N45      PCOD      COMP '2'                      45               S01129
     C  N45      PCOD      COMP '4'                      45               S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           *IN45     IFEQ '1'                                       S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C* CONVERT VALUE SETTLED FROM SETTLEMENT CCY TO LIMIT CCY            S01129
     C*    & UPDATE COUNTERPARTY EXPOSURE ON EMCEXX2                      S01129
     C*                                                                   S01129
     C                     Z-ADDSVLS      AMTIN                           S01129
     C                     MOVE SSCY      CCYIN                           S01129
     C                     Z-ADD19        N                               S01129
     C                     EXSR CALC                                      S01129
     C*                                                                   S01129
     C* REVERSE SIGN OF THE CONVERTED SETTLED VALUE IF REQUIRED           S01129
     C*                                                                   S01129
     C           CPTG      IFEQ 'Y'                                       S01129
     C           STET      OREQ 'TS'                                      S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C* REVERSE SIGN OF THE CONVERTED SETTLED VALUE IF REVERSAL           S01129
     C*                                                                   S01129
     C           SRIN      IFEQ 'Y'                                       S01129
     C                     MULT -1        EXBL                            S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     Z-ADD19        N                               S01129
      *                                                                   S01332
      **  Set up scaling parameters.                                      S01332
     C           DOMOV     SUB  RUND      @TDATE                          S01332
     C                     MOVE 'CP'      @DELTP                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
     C                     EXSR UPDATE                                    S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C*                                                                   S01129
     C           ENDSE     ENDSR                                          S01129
     C*                                                                   S01129
     C*****************************************************************   S01332
     C*   FRAIRS  - FRA/IRS DEALS SUBROUTINE                              S01332
     C*****************************************************************   S01332
     C           FRAIRS    BEGSR                                          S01332
      *                                                                   S01332
     C***********          MOVE JRNENT    DEALDG                   S01332 133170
     C                     MOVELJRNENT    DEALDG                          133170
      *                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP2                                           S01408
      *                                                                   S01332
      ** If type of last change was X for authorisation of deal, then     S01332
      ** do not process it.Just go to end of sub-routine rather than      S01332
      ** use structured techniques.                                       S01332
      *                                                                   S01332
     C           DGCHTP    IFEQ 'X'                                       S01332
     C                     GOTO ENDFI                                     S01332
     C                     END                                            S01332
      *                                                                   S01332
      ** Set up customer number and last change type.                     S01332
      *                                                                   S01332
     C                     MOVE DGCNUM    UPCUS                           S01332
     C                     MOVE DGCHTP    CHTPA                           S01332
      *                                                                   S01332
      ** Set up Principal/ccy. Whether one uses OUR or THEIR depends      S01332
      ** on the deal type.                                                S01332
     C           DGDTYP    IFEQ 'RX'                                      S01332
     C                     MOVE DGPAMT    AMTIN                           S01332
     C                     MOVE DGTCCY    CCYIN                           S01332
      *                                                                   CIR002
      **  Add their unsettled interest amount/adjustment to amount        CIR002
      **  if switchable feature CIR002 is switched ON.                    CIR002
      *                                                                   CIR002
     C           CIR002    IFEQ 'Y'                                       CIR002
     C                     ADD  DGTUSI    AMTIN                           CIR002
     C                     ADD  DGTUSA    AMTIN                           CIR002
     C                     END                                            CIR002
      *                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP3                                           S01408
      *                                                                   S01408
     C                     ELSE                                           S01332
     C                     MOVE DGPAMO    AMTIN                           S01332
     C                     MOVE DGCCY     CCYIN                           S01332
      *                                                                   CIR002
      **  Add our unsettled interest amount/adjustment to amount          CIR002
      **  if switchable feature CIR002 is switched ON.                    CIR002
      *                                                                   CIR002
     C           CIR002    IFEQ 'Y'                                       CIR002
     C           DGDTYP    IFEQ 'RS'                                      CIR002
     C           DGDTYP    OREQ 'RF'                                      CIR002
     C           DGDTYP    OREQ 'RP'                                      CIR002
     C           DGDTYP    OREQ 'RR'                                      CIR002
     C                     ADD  DGOUSI    AMTIN                           CIR002
     C                     ADD  DGOUSA    AMTIN                           CIR002
     C                     END                                            CIR002
     C                     END                                            CIR002
      *                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP4                                           S01408
      *                                                                   S01408
     C                     END                                            S01332
      *                                                                   S01332
     C                     EXSR CHECK                                     S01332
     C           *IN46     CABEQ'0'       ENDFI                           S01332
      *                                                                   S01332
      ** If settlement date < rundate then no further processing.         S01332
     C           DGMDAT    CABLTRUND      ENDFI                           S01332
      *                                                                   S01332
     C                     EXSR CALC                                      S01332
      **  Set up scaling parameters.If FRA use value date - IRS use       S01332
      **  maturity date.                                                  S01332
     C           DGDTYP    IFEQ 'FR'                                      S01332
     C           DGVDAT    SUB  RUND      @TDATE                          S01332
     C                     MOVE 'FR'      @DELTP                          S01332
     C                     Z-ADD21        N                               S01332
     C                     ELSE                                           S01332
     C           DGMDAT    SUB  RUND      @TDATE                          S01332
      **                                                                  S01332
      ** if processing a cap, collar or floor, check the ICD field to     S01332
      ** determine whether to include in IRS exposure or Options          S01332
      ** exposure                                                         S01332
     C           DGDTYP    IFEQ 'RP'                                      S01332
     C           DGDTYP    OREQ 'RR'                                      S01332
     C           DGDTYP    OREQ 'RF'                                      S01332
      *                                                                   S01332
     C           BUCCSO    IFEQ 'O'                                       S01332
     C                     MOVE 'OP'      @DELTP                          S01332
     C                     Z-ADD27        N                               S01332
     C                     ELSE                                           S01332
     C                     MOVE 'IR'      @DELTP                          S01332
     C                     Z-ADD23        N                               S01332
     C                     END                                            S01332
      *                                                                   S01332
     C                     ELSE                                           S01332
     C                     MOVE 'IR'      @DELTP                          S01332
     C                     Z-ADD23        N                               S01332
     C                     END                                            S01332
     C                     END                                            S01332
      *                                                                   S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR UPDATE                                    S01332
      *                                                                   S01332
     C           ENDFI     ENDSR                                          S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP19                                           S01408
     C*                                                                   S01408
     C*****************************************************************   S01332
     C*   FUTOPT  - FUTURES AND OPTIONS                                   S01332
     C*****************************************************************   S01332
     C           FUTOPT    BEGSR                                          S01332
      *                                                                   S01332
     C                     MOVELJRNENT    POSTIT                          S01332
      *                                                                   S01332
     C/COPY WNCPYSRC,EM0101C019
      ** Calculate net open position.                                     S01332
      *  If ICD field FO positions net or gross is 'G', add the long      S01332
      *  and short positions together; otherwise take the difference      S01332
      *  between them                                                     S01332
      *                                                                   S01332
     C           BUFONG    IFEQ 'G'                                       S01332
     C           FOLOP     ADD  FOSOP     @ONETP  80                      S01332
     C                     ELSE                                           S01332
     C           FOLOP     SUB  FOSOP     @ONETP                          S01332
     C                     END                                            S01332
      *                                                                   S01332
      ** Ensure net open position is positive.                            S01332
     C           @ONETP    IFLT *ZERO                                     S01332
     C                     Z-SUB@ONETP    @ONETP                          S01332
     C                     END                                            S01332
      *                                                                   S01332
      ** Chain to LF/INTYP to obtain the contingent amount.               S01332
     C           FOTYP     CHAININTYP                82                   S01332
      *                                                                   S01332
     C           *IN82     IFEQ '1'                                       S01332
     C                     SETON                     U7U899               S01332
     C                     MOVELFOTYP     DBKY                            S01332
     C                     MOVEL'INTYP'   DBFILE                          S01332
     C                     Z-ADD32        DBASE            ** DBASE32**   S01332
     C                     GOTO ENDFOP                                    S01332
     C                     END                                            S01332
      *                                                                   S01332
      ** Set up amount.                                                   S01332
     C           CTAM      MULT @ONETP    AMTIN                           S01332
      *                                                                   S01332
      ** Set up currency, customer number, and last change type.          S01332
      *                                                                   S01332
     C                     MOVE FOISCY    CCYIN                           S01332
     C                     MOVE FOCNUM    UPCUS                           S01332
     C                     MOVE FOCHTP    CHTPA                           S01332
      *                                                                   S01332
     C                     EXSR CHECK                                     S01332
     C           *IN46     CABEQ'0'       ENDFOP                          S01332
      *                                                                   S01332
      ** If settlement date < rundate then no further processing.         S01332
     C           SETD      CABLTRUND      ENDFOP                          S01332
      *                                                                   S01332
     C                     EXSR CALC                                      S01332
      **  Set up scaling parameters.If instrument type = 1,2,3 set key to S01332
      **  FU(FUTURES) else OP(OPTIONS).                                   S01332
     C           ISPT      IFEQ 1                                         S01332
     C           ISPT      OREQ 2                                         S01332
     C           ISPT      OREQ 3                                         S01332
     C                     MOVE 'FU'      @DELTP                          S01332
     C                     Z-ADD25        N                               S01332
     C                     ELSE                                           S01332
     C                     MOVE 'OP'      @DELTP                          S01332
     C                     Z-ADD27        N                               S01332
     C                     END                                            S01332
      *                                                                   S01332
     C           SETD      SUB  RUND      @TDATE                          S01332
     C                     MOVE 'Y'       @SCALE                          S01332
      *                                                                   S01332
     C                     EXSR UPDATE                                    S01332
      *                                                                   S01332
     C           ENDFOP    ENDSR                                          S01332
     C*****************************************************************                       CTI007
      *                                                               *                       CTI007
      *   TIATMI  - TI ACCOUNT TRANSFER PROCESSING SUBROUTINE         *                       CTI007
      *                                                               *                       CTI007
     C*****************************************************************                       CTI007
     C           TIATMI    BEGSR                                                              CTI007
      *                                                                                       CTI007
     C           CTI007    IFEQ 'Y'                                                           CTI007
      *                                                                                       CTI007
     C           2000      SUBSTJRNENT:126ATMIDS                                              CTI007
     C                     MOVELATMIDS    WDLIND  1                                           CTI007
      *                                                                                       CTI007
     C                     MOVEL*BLANKS   CNUMTI                                              CTI007
     C                     MOVEL*BLANKS   CCYTI                                               CTI007
     C                     MOVEL*BLANKS   TIDCIN                                              CTI007
     C                     Z-ADD*ZEROS    ACODTI                                              CTI007
     C                     Z-ADD*ZEROS    DRCV                                                CTI007
     C                     Z-ADD*ZEROS    MTIVD                                               CTI007
     C                     Z-ADD*ZEROS    TIAMNT                                              CTI007
     C                     Z-ADD*ZEROS    TRSEQ                                               CTI007
      *                                                                                       CTI007
      ** Process Debit Transaction                                                            CTI007
      *                                                                                       CTI007
     C           R1DRVL    IFLE BJRDNB                                                        CTI007
     C                     MOVELR1DBCU    CNUMTI                                              CTI007
     C                     MOVELR1DBCY    CCYTI                                               CTI007
     C                     MOVEL'D'       TIDCIN                                              CTI007
     C                     Z-ADDR1DBAC    ACODTI                                              CTI007
     C                     Z-ADDR1INDT    DRCV                                                CTI007
     C                     Z-ADDR1DRVL    MTIVD                                               CTI007
     C                     Z-ADDR1DAMT    TIAMNT                                              CTI007
     C                     Z-ADDR1DBSQ    TRSEQ                                               CTI007
      *                                                                                       CTI007
     C                     MOVE ACODTI    A5ACCD                                              CTI007
     C           KACOD1    CHAIN@A5REA6              40                                       CTI007
     C           *IN40     IFEQ *OFF                                                          CTI007
     C           A5TFCT    ANDEQ'Y'                                                           CTI007
     C           JOENTT    CASEQ'PT'      TIPOST                                              CTI007
     C           JOENTT    CASEQ'PX'      TIPOST                                              CTI007
     C           JOENTT    CASEQ'UP'      TIDLTE                                              CTI007
     C                     END                                                                CTI007
     C                     ENDIF                                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Process Credit Transaction                                                           CTI007
      *                                                                                       CTI007
     C           R1CRVL    IFLE BJRDNB                                                        CTI007
     C                     MOVELR1CRCU    CNUMTI                                              CTI007
     C                     MOVELR1CRCY    CCYTI                                               CTI007
     C                     MOVEL'C'       TIDCIN                                              CTI007
     C                     Z-ADDR1CRAC    ACODTI                                              CTI007
     C                     Z-ADDR1INDT    DRCV                                                CTI007
     C                     Z-ADDR1CRVL    MTIVD                                               CTI007
     C                     Z-ADDR1CAMT    TIAMNT                                              CTI007
     C                     Z-ADDR1CRSQ    TRSEQ                                               CTI007
      *                                                                                       CTI007
     C                     MOVE ACODTI    A5ACCD                                              CTI007
     C           KACOD1    CHAIN@A5REA6              40                                       CTI007
     C           *IN40     IFEQ *OFF                                                          CTI007
     C           A5TFCT    ANDEQ'Y'                                                           CTI007
     C           JOENTT    CASEQ'PT'      TIPOST                                              CTI007
     C           JOENTT    CASEQ'PX'      TIPOST                                              CTI007
     C           JOENTT    CASEQ'UP'      TIDLTE                                              CTI007
     C                     END                                                                CTI007
     C                     ENDIF                                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
     C                     ENDSR                                                              CTI007
     C*****************************************************************   CTI002
     C*   TIPOST  - TRADE INNOVATION POSTINGS SUBROUTINE                  CTI002
     C*****************************************************************   CTI002
     C           TIPOST    BEGSR                                          CTI002
     C**                                                                  CTI002
     C                     CLEARAMTIN                                     CTI002
     C                     CLEARCCYIN                                     CTI002
     C                     CLEARSAMTIN                                    CTI002
     C**                                                                  CTI002
     C                     Z-ADD29        N                               CTI002
      *                                                                                       CTI007
     C           CTI007    IFEQ 'N'                                                           CTI007
     C           2000      SUBSTJRNENT:126POSTDS                          CTI002
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
     C                     MOVE CNUMTI    UPCUS                           CTI002
     C*                                                                   CTI002
     C** Specific checks for TI postings                                  CTI002
     C                     EXSR CHKTI                                     CTI002
     C           *IN46     CABEQ'0'       ENDTI                           CTI002
     C*                                                                   CTI002
     C                     Z-ADDTIAMNT    AMTIN                           CTI002
     C                     MOVE CCYTI     CCYIN                           CTI002
     C                     Z-ADDMTIVD     P#FRDT                          CTI002
     C                     Z-ADDMTIVD     P#TODT                          CTI002
     C           CBSCL     IFNE *BLANK                                    CTI002
     C                     MOVE 'Y'       @SCAL2                          CTI002
     C           MTIVD     SUB  RUND      @TDATE                          CTI002
     C                     MOVE CBSCL     @DELTP                          CTI002
     C                     ELSE                                           CTI002
     C                     MOVE 'N'       @SCAL2                          CTI002
     C                     END                                            CTI002
     C*                                                                   CTI002
     C** Set up amounts                                                   CTI002
     C                     EXSR CALC2                                     CTI002
     C           *IN46     CABEQ'0'       ENDTI                           CTI002
     C*                                                                   CTI002
     C** Specific updates for TI postings                                 CTI002
     C*                                                                   CTI002
     C                     EXSR UPDTI                                     CTI002
     C           *IN46     CABEQ'0'       ENDTI                           CTI002
     C*                                                                   CTI002
     C** Update the Exposure                                              CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     Z-ADDSEXBL     EXBL                            CTI002
     C                     END                                            CTI002
     C                     EXSR UPDATE                                    CTI002
     C*                                                                   CTI002
     C           ENDTI     ENDSR                                          CTI002
     C*****************************************************************                       CTI007
      *                                                               *                       CTI007
      *   TIDLTE  - TI ACCOUNT TRANSFER DELETION SUBROUTINE           *                       CTI007
      *                                                               *                       CTI007
     C*****************************************************************                       CTI007
     C           TIDLTE    BEGSR                                                              CTI007
      *                                                                                       CTI007
      ** If Record ID from GLATMIPD is 'R', then delete record                                CTI007
     C           WDLIND    IFEQ 'R'                                                           CTI007
      *                                                                                       CTI007
      ** Initialize workfield indicators                                                      CTI007
     C                     MOVE 'N'       WCBFND                                              CTI007
     C                     MOVE 'N'       WSAFND                                              CTI007
     C                     MOVE 'N'       WSLFND                                              CTI007
      *                                                                                       CTI007
      ** Divide amount by the number of decimal positions                                     CTI007
     C                     CALL 'AOCURRR0'                                                    CTI007
     C                     PARM *BLANKS   @RTCD   7                                           CTI007
     C                     PARM '*KEY   ' @OPTN   7                                           CTI007
     C                     PARM CCYTI     @AJCD   3                                           CTI007
     C           SDCURR    PARM SDCURR    DSSDY                                               CTI007
      *                                                                                       CTI007
     C           @RTCD     IFEQ *BLANK                                                        CTI007
     C           A6NBDP    ADD  1         M       10                                          CTI007
     C           1         DIV  POWERA,M  DECP   138H                                         CTI007
     C           TIAMNT    MULT DECP      TIAMNT                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Convert if posted amount and exposure amount are not the                             CTI007
      ** same currency                                                                        CTI007
     C           CCYTI     IFNE BUCYCD                                                        CTI007
     C                     Z-ADDMTIVD     P#FRDT                                              CTI007
     C                     Z-ADDMTIVD     P#TODT                                              CTI007
     C                     MOVE CCYTI     P#FRCY                                              CTI007
     C                     Z-ADDTIAMNT    P#FRAM                                              CTI007
     C                     MOVE BUCYCD    P#TOCY                                              CTI007
     C                     Z-ADD0         P#TOAM                                              CTI007
     C                     Z-ADD0         P#RATE                                              CTI007
     C                     CALL 'EM0010'                                                      CTI007
     C                     PARM           P#0010                                              CTI007
     C           P#RTCD    IFEQ *BLANK                                                        CTI007
     C                     Z-ADDP#TOAM    TIAMNT                                              CTI007
     C                     ELSE                                                               CTI007
     C                     SETON                     99                                       CTI007
     C                     SETOF                     46                                       CTI007
     C           *LOCK     IN   LDA                                                           CTI007
     C                     MOVEL*BLANKS   DBFILE                                              CTI007
     C                     MOVE *BLANKS   DBKY                                                CTI007
     C                     Z-ADD60        DBASE                                               CTI007
     C                     MOVELP#RTCD    DBKY                                                CTI007
     C                     MOVEL'EM0010'  DBFILE                                              CTI007
     C                     OUT  LDA                                                           CTI007
     C                     EXSR *PSSR                                                         CTI007
     C                     GOTO ENDDLT                                                        CTI007
     C                     ENDIF                                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Delete record from Sub-Limit Detail Transaction                                      CTI007
     C                     MOVE CNUMTI    EXCNUM                                              CTI007
     C                     MOVE ACODTI    EXACNO                                              CTI007
     C                     MOVELR1TREF    EXTRNS                                              CTI007
      *                                                                                       CTI007
     C           KTFEX0    CHAINEMTFEX               43                                       CTI007
     C           *IN43     IFEQ *OFF                                                          CTI007
     C                     DELETEMTFEX                                                        CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Sign of Amount depends on Debit/Credit indicator                                     CTI007
     C           TIDCIN    IFEQ 'C'                                                           CTI007
     C                     MULT -1        TIAMNT                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Update record from TF Customer Balance                                               CTI007
     C                     MOVE CNUMTI    CBCUST                                              CTI007
     C                     MOVE ACODTI    CBACNO                                              CTI007
      *                                                                                       CTI007
     C           KTFCB0    CHAINEMTFCB               43                                       CTI007
     C           *IN43     IFEQ '0'                                                           CTI007
      *                                                                                       CTI007
      ** If the customer sub-limit weighting factor exists,                                   CTI007
      ** scale the amount                                                                     CTI007
     C           CBSCL     IFNE *BLANKS                                                       CTI007
     C                     MOVE CBSCL     @DELTP                                              CTI007
     C                     Z-ADDTIAMNT    @SCAMT                                              CTI007
     C                     Z-ADD0         @TDATE                                              CTI007
     C                     EXSR SCALE                                                         CTI007
     C                     Z-ADD@SCAMT    TIAMNT                                              CTI007
     C                     END                                                                CTI007
      *                                                                                       CTI007
     C                     SUB  TIAMNT    CBEXP                                               CTI007
     C                     EXCPTTFCBU                                                         CTI007
     C                     MOVE 'Y'       WCBFND                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Update record from Sub-Line / Account X-Ref                                          CTI007
     C                     MOVE ACODTI    SAACOD                                              CTI007
     C           KTFSA1    CHAINEMTFSA               43                                       CTI007
     C           *IN43     IFEQ '0'                                                           CTI007
     C                     SUB  TIAMNT    SAEXP                                               CTI007
     C                     EXCPTTFSAU                                                         CTI007
     C                     MOVE 'Y'       WSAFND                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Update record from Sub-Line / Account X-Ref                                          CTI007
     C                     MOVE SATYPE    SLTYPE                                              CTI007
     C           KTFSL0    CHAINEMTFSL               43                                       CTI007
     C           *IN43     IFEQ '0'                                                           CTI007
     C                     SUB  TIAMNT    SLEXP                                               CTI007
     C                     EXCPTTFSLU                                                         CTI007
     C                     MOVE 'Y'       WSLFND                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** Update EM file detail                                                                CTI007
     C           CNUMTI    CHAINEMCEXX2F             43                                       CTI007
     C           *IN43     IFEQ '0'                                                           CTI007
     C                     MOVE RUND      LCD                                                 CTI007
     C                     MOVE 'A'       CHTP                                                CTI007
     C                     SUB  TIAMNT    TFEX                                                CTI007
     C                     UPDATEMCEXX2F                                                      CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
     C           WCBFND    IFEQ 'Y'                                                           CTI007
     C                     UNLCKEMTFCBL0                                                      CTI007
     C                     END                                                                CTI007
     C           WSAFND    IFEQ 'Y'                                                           CTI007
     C                     UNLCKEMTFSAL1                                                      CTI007
     C                     END                                                                CTI007
     C           WSLFND    IFEQ 'Y'                                                           CTI007
     C                     UNLCKEMTFSLL0                                                      CTI007
     C                     END                                                                CTI007
      *                                                                                       CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
     C           ENDDLT    ENDSR                                                              CTI007
      *                                                                                       CTI007
     C*****************************************************************   CTI002
     C*   SDACOD  - STANDING DATA SUBROUTINE                              CTI002
     C*****************************************************************   CTI002
     C           SDACOD    BEGSR                                          CTI002
     C*                                                                   CTI002
     C           2000      SUBSTJRNENT:126ACODDS                          CTI002
     C*                                                                   CTI002
     C*                                                                   CTI002
     C                     EXSR CHECK                                     CTI002
     C           *IN46     CABEQ'0'       ENDAC                           CTI002
     C*                                                                   CTI002
     C** Specific checks for SD account codes                             CTI002
     C                     EXSR CHKAC                                     CTI002
     C           *IN46     CABEQ'0'       ENDAC                           CTI002
     C*                                                                   CTI002
     C** Specific updates for SD account codes                            CTI002
     C                     EXSR UPDAC                                     CTI002
     C*                                                                   CTI002
     C           ENDAC     ENDSR                                          CTI002
     C*****************************************************************   S01129
      *                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP5                                           S01408
      *                                                                   S01408
     C*****************************************************************   S01129
     C*   CLCVAL - CALCULATES A VALUE FROM THE NOMINAL AMOUNT AND A       S01129
     C*            GIVEN PRICE.                                           S01129
     C*****************************************************************   S01129
     C           CLCVAL    BEGSR                                          S01129
     C*                                                                   S01129
     C                     Z-ADD0         ZCONS  150                      S01129
     C                     Z-ADD0         ZCONS0 150                      S01129
     C                     Z-ADD0         ZCONS1 151                      S01129
     C                     Z-ADD0         ZCONS2 152                      S01129
     C                     Z-ADD0         ZCONS3 153                      S01129
     C*                                                                   S01129
     C* Set indicator for number of decimal places                        S01129
     C*                                                                   S01129
     C                     MOVEA'0000'    *IN,30                          S01129
     C           30        ADD  CDP       V       20                      S01129
     C                     MOVEA'1'       *IN,V                           S01129
     C*                                                                   S01129
     C* Calculate consideration = face value(=nominal) x trade price      S01129
     C*     If price basis is P, divide consideration by 100              S01129
     C*     If processing type is 8 , multiply cons'n by current factor   S01129
     C*                                                                   S01129
     C   30      WNOML     MULT WPRIC     ZCONS0    H                     S01129
     C   31      WNOML     MULT WPRIC     ZCONS1    H                     S01129
     C   32      WNOML     MULT WPRIC     ZCONS2    H                     S01129
     C   33      WNOML     MULT WPRIC     ZCONS3    H                     S01129
     C*                                                                   S01129
     C           PROT      IFEQ '8'                                       S01129
     C/COPY WNCPYSRC,EM0101C013
     C   30      ZCONS0    MULT CFCT      ZCONS0                          S01129
     C   31      ZCONS1    MULT CFCT      ZCONS1                          S01129
     C   32      ZCONS2    MULT CFCT      ZCONS2                          S01129
     C   33      ZCONS3    MULT CFCT      ZCONS3                          S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C           SPBS      IFEQ 'P'                                       S01129
     C   30      ZCONS0    DIV  100       ZCONS0    H                     S01129
     C   31      ZCONS1    DIV  100       ZCONS1    H                     S01129
     C   32      ZCONS2    DIV  100       ZCONS2    H                     S01129
     C   33      ZCONS3    DIV  100       ZCONS3    H                     S01129
     C                     END                                            S01129
     C*                                                                   S01129
     C/COPY WNCPYSRC,EM0101C006
     C   30                MOVE ZCONS0    ZCONS                           S01129
     C   31                MOVE ZCONS1    ZCONS                           S01129
     C   32                MOVE ZCONS2    ZCONS                           S01129
     C   33                MOVE ZCONS3    ZCONS                           S01129
     C*                                                                   S01129
     C*  ALLOW FOR NOMINAL DECIMAL PLACES                                 S01129
     C*                                                                   S01129
     C           5         SUB  NMDP      DC      10                      S01129
     C           ZCONS     MULT POWER8,DC ZCONS     H                     S01129
     C*                                                                   S01129
     C* IF PARTLY PAID SEC MULT EXP AMOUNT BY       *** TAKEN OUT ***
     C* (CURRENT PP PRICE / FULLY PAID PRICE)       *** 9/3/88 SP ***
     C***********PPDI      IFEQ 'Y'                                       S01129
     C*********************MULT CPDP      ZCONS                           S01129
     C***********SFPP      IFEQ 0                                         S01129
     C*********************Z-ADD0         ZCONS                           S01129
     C*********************ELSE                                           S01129
     C*********************DIV  SFPP      ZCONS     H                     S01129
     C*********************END                                            S01129
     C*********************END                                            S01129
     C*                                                                   S01129
     C                     ENDSR                                          S01129
     C*****************************************************************
0728 C**
0729 C**   GETHED S.R.  TO ACCES EMCEX HEADER RECORD
0730 C**                CALLED BY: FIRST
0731 C**
0732 C           GETHED    BEGSR                           *** GETHED ***
0733 C**
     C                     SETOF                     01
0734 C***********          Z-ADD0         EMCXKY  60                      LN0071
0734 C***********          MOVE *BLANKS   EMCXKY  6                 LN0071BHF848
0734 C***********          MOVE '000000'  EMCXKY  6                 BHF848S01332
0734 C                     MOVE *BLANKS   EMCXKY  6                       S01332
0735 C           EMCXKY    CHAINEMCEXX1F             40
0736 C**
0737 C** IF HEADER NOT FOUND, DATABASE ERROR
0738 C  N01                Z-ADD4         DBASE            ** DBASE 4 **
0739 C  N01                MOVE EMCXKY    DBKY
0740 C  N01                MOVE 'EMCEX'   DBFILE
0741 C  N01                SETON                     U7U899
0742 C**
0743 C                     ENDSR
0745 C********************************************************************
0746 C**
0747 C**   CHECK  S.R.  TO DETERMINE IF JRNEM RECORD IS TO BE PROCESSEDORD
0747 C**                AND IF SO WHETHER TO PROCESS IT AS AN INSERT ORORD
     C**                A DELETE
0748 C**                CALLED BY: MAINLINE
0749 C**
0750 C           CHECK     BEGSR                           *** CHECK ***
0751 C**
     C**
     C** CHECK JOURNAL ENTRY TYPE
     C****                 SETON                     46                   S01128
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CCP9                                           S01408
     C*                                                                   S01408
     C           JOPGM     LOKUPPGMS                     46               S01128
     C           *IN46     CABEQ'0'       ENDCK                           S01128
     C*                                                                   S01129
     C*                                                                   S01408
     C/COPY WNCPYSRC,EM0101CP10                                           S01408
     C*                                                                   CTI002
     C           JOPGM     IFEQ 'SD0031R'                                 CTI002
     C           JOENTT    IFNE 'DL'                                      CTI002
     C           JOENTT    ANDNE'UP'                                      CTI002
     C                     SETOF                     46                   CTI002
     C                     END                                            CTI002
     C                     GOTO ENDCK                                     CTI002
     C                     END                                            CTI002
     C*                                                                   S01408
     C           JOPGM     IFEQ 'SE0050'                                  S01129
     C           CHTPA     ANDEQ'C'                                       S01129
     C                     MOVE 'A'       CHTPA                           S01129
     C                     END                                            S01129
     C**                                                                  E14724
     C** DO NOT PROCESS SE TRADES IF THEY ARE INCOMPLETE                  E14724
     C**                                                                  E14724
     C           JOPGM     IFEQ 'SE0050'                                  E14724
     C           TINC      ANDNE'C'                                       E14724
     C                     SETOF                     46                   E14724
     C                     GOTO ENDCK                                     E14724
     C                     END                                            E14724
     C*                                                                   CDL002
     C* Only process the Confirmed or Reversed FX Netting Entries         CDL002
     C           JOPGM     IFEQ 'FX0920'                                  CDL002
     C           JFILE     ANDEQ'FXNETMPD'                                CDL002
     C           AMRECI    ANDNE'C'                                       CDL002
     C                     MOVE *OFF      *IN46                           CDL002
     C                     GOTO ENDCK                                     CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   S01129
     C           JOENTT    CABEQ'PT'      ENDCK          55
     C           JOENTT    CABEQ'UR'      ENDCK          55
     C           JOENTT    CABEQ'DR'      ENDCK
     C           JOENTT    CABEQ'UB'      ACTION
     C           JOENTT    CABEQ'UP'      ACTION         80
     C           JOENTT    CABEQ'BR'      ACTION         81
     C                     SETOF                     46
     C                     GOTO ENDCK
     C**
     C           ACTION    TAG                             *** ACTION ***
     C**
     C** PROCESS ALL 'UB' ENTRIES EXCEPT THOSE WITH ACTION CODE
     C** "R" "C" OR "D" AS DELETE
     C           JOENTT    IFEQ 'UB'
     C           CHTPA     IFNE 'A'
     C           CHTPA     ANDNE'I'
     C           CHTPA     ANDNE'X'                                       041754
     C** API entries may be blank                                         155631
     C           CHTPA     ANDNE' '                                       155631
     C                     SETOF                     46
     C                     END
     C                     SETOF                     55                   E13665
     C                     GOTO ENDCK
     C                     END
     C**
      * Ensure UP entries for authorization are processed as inserts      041754
      * since previous exposure will have been reversed for UB entry      041754
     C           CHTPA     IFEQ 'I'
     C           CHTPA     OREQ 'X'                                       041754
     C** API entries may be blank                                         155631
     C           CHTPA     OREQ ' '                                       155631
     C**
      ** Do not process any longer the UP journal entry of deleted                            201514
      ** complete deals                                                                       201514
      *                                                                                       241589
     C           CHTPA     IFEQ ' '                                                           241589
     C           FHLACT    ANDEQ'D'                                                           241589
     C           JOENTT    ANDEQ'UP'                                                          241589
     C                     MOVEL'0'       *IN46                                               241589
     C                     GOTO ENDCK                                                         241589
     C                     ENDIF                                                              241589
      *                                                                                       201514
     C           CHTPA     IFEQ ' '                                                           201514
     C           HKLACT    ANDEQ'D'                                                           201514
     C           JOENTT    ANDEQ'UP'                                                          201514
     C                     MOVEL'0'       *IN46                                               201514
     C                     GOTO ENDCK                                                         201514
     C                     ENDIF                                                              201514
      *                                                                                       201514
     C** PROCESS ALL 'UP' ENTRIES AS INSERTS
     C** IF ROLLBACK PROCESS AS A DELETE
     C   80                SETON                     55
     C   81                SETOF                     55
     C                     GOTO ENDCK
     C                     END
     C**
     C           CHTPA     IFEQ 'A'
     C**
     C** IF ROLLBACK PROCESS AS A DELETE
     C   80                GOTO DEAMST
     C   81                SETOF                     55
     C                     GOTO ENDCK
     C**
     C** PROCESS 'AFTER STATUS' RECORD AS AN INSERT
     C           DEAMST    TAG                             *** DEAMST ***
     C                     SETON                     55
     C                     GOTO ENDCK
     C                     END
     C**
     C                     SETOF                     46
     C**
     C           ENDCK     ENDSR                           *** ENDCK ***
     C********************************************************************CTI002
     C**                                                                  CTI002
     C**   CHKAC  S.R.  TO DETERMINE IF JRNEM RECORD IS TO BE PROCESSED   CTI002
     C**   FOR THE FILE SDACODPD                                          CTI002
     C**                                                                  CTI002
     C           CHKAC     BEGSR                           *** CHECK ***  CTI002
      *                                                                   CTI002
     C                     SETON                     46                   CTI002
      *                                                                   CTI002
     C           CTI002    IFNE 'Y'                                       CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCA                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           JOENTT    IFEQ 'UP'                                      CTI002
     C           A5TFCT    IFEQ 'Y'                                       CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCA                                     CTI002
     C                     END                                            CTI002
     C                     MOVE A5ACCD    CBACNO                          CTI002
     C           KTFCB1    SETLLEMTFCBF1                 40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCA                                     CTI002
     C                     END                                            CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           ENDCA     ENDSR                           *** ENDCK ***  CTI002
     C********************************************************************CTI002
     C**                                                                  CTI002
     C**   CHKTI  S.R.  TO DETERMINE IF JRNEM RECORD IS TO BE PROCESSED   CTI002
     C**   FOR THE FILE TIPOSTPD                                          CTI002
     C**                CALLS: EM0998 KEEP TRACK IN EMTRCKPD              CTI002
     C**                                                                  CTI002
     C           CHKTI     BEGSR                           *** CHECK ***  CTI002
      *                                                                   CTI002
     C                     SETON                     46                   CTI002
      *                                                                   CTI002
     C           JOENTT    IFEQ 'PT'                                      CTI002
     C           CTI007    OREQ 'Y'                                                           CTI007
     C           JOENTT    ANDEQ'PX'                                                          CTI007
     C                     SETON                     55                   CTI002
     C                     ELSE                                           CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           CTI002    IFNE 'Y'                                       CTI002
     C           CTI007    ANDNE'Y'                                                         MD030956
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     MOVE ACODTI    A5ACCD                          CTI002
     C           KACOD1    SETLL@A5REA6                  40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVELACODTI    WKEY1     P                     CTI002
     C                     MOVEL'SDACODPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     ELSE                                           CTI002
     C           KACOD1    READE@A5REA6                  40               CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      ** It must be a trade finance contigent account                     CTI002
     C           A5TFCT    IFNE 'Y'                                       CTI002
     C           *IN40     OREQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0030' MSGID                           CTI002
     C                     MOVELACODTI    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      ** We use 3 flags WCBFND, WSAFND and WSLFND in order to determine   CTI002
      ** - Wether or not we need to create a new Customer Balance         CTI002
      ** - Wether or not we need to create an 'unknown' Sub Line          CTI002
      ** - and an 'unknow SubLine Account' (TYPE = #)                     CTI002
      ** So                                                               CTI002
      ** If no customer balance defined =>                                CTI002
      **   we create the record and check that there's a account sub      CTI002
      **   line and a subline.                                            CTI002
      ** If we are not able to link the customer balance (even with       CTI002
      ** the 'unknown' subline (SLTYPE = #) with the T/F frame file's     CTI002
      ** we create the corresponding records.                             CTI002
     C                     MOVE ACODTI    SAACOD                          CTI002
     C           KTFSA1    SETLLEMTFSA                   40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     CLEAREMTFSA                                    CTI002
     C                     MOVEL'N'       WSAFND  1                       CTI002
      *                                                                   CTI002
     C                     MOVE '#'       SLTYPE                          CTI002
     C           KTFSL0    SETLLEMTFSL                   40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     CLEAREMTFSL                                    CTI002
     C                     MOVEL'N'       WSLFND  1                       CTI002
     C                     ELSE                                           CTI002
     C                     MOVEL'Y'       WSLFND  1                       CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     ELSE                                           CTI002
      ** If there 's a sub line account, we must have a sub line          CTI002
      ** defined as well.                                                 CTI002
     C                     MOVEL'Y'       WSAFND  1                       CTI002
     C                     MOVEL'Y'       WSLFND  1                       CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     MOVE CNUMTI    CBCUST                          CTI002
     C                     MOVE ACODTI    CBACNO                          CTI002
     C           KTFCB0    SETLLEMTFCB                   40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     CLEAREMTFCB                                    CTI002
     C                     MOVEL'N'       WCBFND  1                       CTI002
     C                     ELSE                                           CTI002
     C                     MOVEL'Y'       WCBFND  1                       CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WSAFND    IFNE 'Y'                                       CTI002
     C           WSLFND    ANDEQ'Y'                                       CTI002
      *                                                                   CTI002
     C           KTFSL0    READEEMTFSL                 4740               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
      *                                                                   CTI002
     C           KTFSA1    READEEMTFSA                 4740               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVELACODTI    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSAPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELACODTI    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSAPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     MOVE SATYPE    SLTYPE                          CTI002
     C           KTFSL0    SETLLEMTFSL                   40               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     ELSE                                           CTI002
     C           KTFSL0    READEEMTFSL                 4740               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
      *                                                                   CTI002
     C           KTFCB0    READEEMTFCB                 4740               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0031' MSGID                           CTI002
     C                     MOVE CNUMTI    CNUMK3                          CTI002
     C                     MOVE ACODTI    ACODK3                          CTI002
     C                     MOVELKEY3DS    WKEY1     P                     CTI002
     C                     MOVEL'EMTFCBPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVE CNUMTI    CNUMK3                          CTI002
     C                     MOVE ACODTI    ACODK3                          CTI002
     C                     MOVELKEY3DS    WKEY1     P                     CTI002
     C                     MOVEL'EMTFCBPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDCI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           ENDCI     ENDSR                           *** ENDCK ***  CTI002
     C**                                                                  CTI002
     C**
1012 C********************************************************************
1227 C**
1228 C**   CALC    S.R.  TO SET UP AMOUNT FIELDS FOR UPDATE
1230 C**                  CALLS: CCYCON
1231 C**
1232 C           CALC      BEGSR                           ** CALC  **
      *                                                                   CDL002
     C                     CLEAREXBL                                      CDL002
     C                     CLEARSEXBL                                     CDL002
1233 C**
1233 C* Don't convert if amount is zero                                   CDL002
     C           AMTIN     IFNE *ZERO                                     CDL002
1234 C                     MOVE AMTIN     AMOUNT 130
1235 C                     MOVE CCYIN     CURR    3
1236 C                     EXSR CCYCON
1237 C                     Z-ADDCONBAL    EXBL   130
     C                     ENDIF                                          CDL002
1233 C**
1233 C* Don't convert if amount is zero                                   CDL002
     C           SAMTIN    IFNE *ZERO                                     CDL002
     C           N         IFEQ 1
     C                     MOVE SAMTIN    AMOUNT 130
     C                     MOVE SCCYIN    CURR    3
     C                     EXSR CCYCON
     C                     Z-ADDCONBAL    SEXBL  130
     C                     END
     C                     ENDIF                                          CDL002
1233 C**
     C           *IN55     IFEQ '0'
     C                     MULT -1        EXBL
     C                     MULT -1        SEXBL
     C                     END
1233 C**
1259 C           ENDCC     ENDSR
1282 C**
     C/EJECT                                                              S01332
     C********************************************************************CTI002
     C**                                                                  CTI002
     C**   CALC2   S.R.  TO SET UP AMOUNT FIELDS FOR UPDATE               CTI002
     C**                                                                  CTI002
     C**                                                                  CTI002
     C           CALC2     BEGSR                           ** CALC  **    CTI002
     C                     CLEAREXBL                                      CTI002
     C                     CLEARSEXBL                                     CTI002
      **                                                                  CTI002
      ** Null amount is not allowed                                       CTI002
     C           AMTIN     IFEQ *ZERO                                     CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0056' MSGID                           CTI002
     C                     MOVE CNUMTI    CNUMK2                          CTI002
     C                     MOVE ACODTI    ACODK2                          CTI002
     C                     MOVE TRSEQ     TRSQK2                          CTI002
     C                     MOVELKEY2DS    P#MSDA    P                     CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
      ** We release the records previously locked for update in           CTI002
      ** SR/CHKTI before leaving.                                         CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFCBL0                                  CTI002
     C                     END                                            CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDC2                                     CTI002
     C                     END                                            CTI002
      **                                                                  CTI002
      ** Divide posting amount by the number of decimal positions         CTI002
      ** of in currency                                                   CTI002
     C                     CALL 'AOCURRR0'                                CTI002
     C                     PARM *BLANKS   @RTCD   7                       CTI002
     C                     PARM '*KEY   ' @OPTN   7                       CTI002
     C                     PARM CCYIN     @AJCD   3                       CTI002
     C           SDCURR    PARM SDCURR    DSSDY                           CTI002
     C           @RTCD     IFNE *BLANK                                    CTI002
      ** We release the records previously locked for update in           CTI002
      ** SR/CHKTI before leaving.                                         CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFCBL0                                  CTI002
     C                     END                                            CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     SETON                     99                   CTI002
     C                     SETOF                     46                   CTI002
     C           *LOCK     IN   LDA                                       CTI002
     C                     MOVEL*BLANKS   DBFILE                          CTI002
     C                     MOVE *BLANKS   DBKY                            CTI002
     C                     Z-ADD44        DBASE                           CTI002
     C                     MOVEL@RTCD     DBKY                            CTI002
     C                     MOVEL'SDCURRPD'DBFILE                          CTI002
     C                     OUT  LDA                                       CTI002
     C                     EXSR *PSSR                                     CTI002
     C                     GOTO ENDC2                                     CTI002
     C                     END                                            CTI002
     C           A6NBDP    ADD  1         M       10                      CTI002
     C           1         DIV  POWERA,M  DECP   138H                     CTI002
     C***********AMTIN     MULT DECP      AMTIN                    CTI002 167618
     C           AMTIN     MULT DECP      XAMTIN 130                      167618
      **                                                                  CTI002
      ** Don't convert if posted amount and exposure amount have the      CTI002
      ** same currency                                                    CTI002
     C           CCYIN     IFEQ BUCYCD                                    CTI002
     C                     Z-ADDAMTIN     EXBL   130                      CTI002
     C                     ELSE                                           CTI002
     C                     MOVE CCYIN     P#FRCY                          CTI002
     C                     Z-ADDAMTIN     P#FRAM                          CTI002
     C                     MOVE BUCYCD    P#TOCY                          CTI002
     C                     Z-ADD0         P#TOAM                          CTI002
     C                     Z-ADD0         P#RATE                          CTI002
     C                     CALL 'EM0010'                                  CTI002
     C                     PARM           P#0010                          CTI002
     C           P#RTCD    IFEQ *BLANK                                    CTI002
     C                     Z-ADDP#TOAM    EXBL   130                      CTI002
     C                     ELSE                                           CTI002
      ** We release the records previously locked for update in           CTI002
      ** SR/CHKTI before leaving.                                         CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFCBL0                                  CTI002
     C                     END                                            CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     SETON                     99                   CTI002
     C                     SETOF                     46                   CTI002
     C           *LOCK     IN   LDA                                       CTI002
     C                     MOVEL*BLANKS   DBFILE                          CTI002
     C                     MOVE *BLANKS   DBKY                            CTI002
     C                     Z-ADD41        DBASE                           CTI002
     C                     MOVELP#RTCD    DBKY                            CTI002
     C                     MOVEL'EM0010'  DBFILE                          CTI002
     C                     OUT  LDA                                       CTI002
     C                     EXSR *PSSR                                     CTI002
     C                     GOTO ENDC2                                     CTI002
     C                     END                                            CTI002
     C                     END                                            CTI002
      *                                                                   167618
     C           LCDP      ADD  1         @F      10                      167618
     C           EXBL      DIV  POWERA,@F EXBL      H                     167618
     C                     Z-ADDXAMTIN    AMTIN                           167618
      **                                                                  CTI002
      ** Scaling amount if necessary                                      CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     Z-ADDAMTIN     @SCAMT 130                      CTI002
     C                     EXSR SCALE                                     CTI002
     C                     Z-ADD@SCAMT    SAMTIN 130                      CTI002
     C                     END                                            CTI002
      **                                                                  CTI002
      ** Don't convert if amount is zero or both currencies are the       CTI002
      ** same                                                             CTI002
     C           SAMTIN    IFEQ *ZERO                                     CTI002
     C           CCYIN     OREQ BUCYCD                                    CTI002
     C                     Z-ADDSAMTIN    SEXBL  130                      CTI002
     C                     ELSE                                           CTI002
     C                     MOVE CCYIN     P#FRCY                          CTI002
     C                     Z-ADDSAMTIN    P#FRAM                          CTI002
     C                     MOVE BUCYCD    P#TOCY                          CTI002
     C                     Z-ADD0         P#TOAM                          CTI002
     C                     Z-ADD0         P#RATE                          CTI002
     C                     CALL 'EM0010'                                  CTI002
     C                     PARM           P#0010                          CTI002
     C           P#RTCD    IFEQ *BLANK                                    CTI002
     C                     Z-ADDP#TOAM    SEXBL  130                      CTI002
     C                     ELSE                                           CTI002
      ** We release the records previously locked for update in           CTI002
      ** SR/CHKTI before leaving.                                         CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFCBL0                                  CTI002
     C                     END                                            CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     SETON                     99                   CTI002
     C                     SETOF                     46                   CTI002
     C           *LOCK     IN   LDA                                       CTI002
     C                     MOVEL*BLANKS   DBFILE                          CTI002
     C                     MOVE *BLANKS   DBKY                            CTI002
     C                     Z-ADD42        DBASE                           CTI002
     C                     MOVELP#RTCD    DBKY                            CTI002
     C                     MOVEL'EM0010'  DBFILE                          CTI002
     C                     OUT  LDA                                       CTI002
     C                     EXSR *PSSR                                     CTI002
     C                     GOTO ENDC2                                     CTI002
     C                     END                                            CTI002
     C                     END                                            CTI002
      **                                                                  CTI002
     C           *IN55     IFEQ '0'                                       CTI002
     C                     MULT -1        EXBL                            CTI002
     C                     MULT -1        SEXBL                           CTI002
     C                     END                                            CTI002
     C           ENDC2     ENDSR                                          CTI002
      **                                                                  CTI002
     C/EJECT                                                              CTI002
1316 C********************************************************************
1342 C**
1343 C**   UPDATE  S.R.  TO UPDATE EXPOSURE/BALANCES ON EMCEX RECORD
1344 C**                CALLED FROM: FILE SUBROUTINES
1346 C**
     C           UPDATE    BEGSR                           ** UPDATE **
     C**
     C** GET DETAIL RECORD
     C           UPCUS     CHAINEMCEXX2F             41
     C           *IN41     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD0         EXP
     C                     END
     C**
     C** APPLY CALCULATED AMOUNTS
      *  Execute SCALE to scale the exposure.Takes two other parameters   S01332
      *  @TDATE and @DELTP which were set up in the relevant file         S01332
      *  routines.                                                        S01332
     C           @SCALE    IFEQ 'Y'                                       S01332
     C                     Z-ADDEXBL      @SCAMT 130                      S01332
     C                     EXSR SCALE                                     S01332
     C                     Z-ADD@SCAMT    EXBL                            S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C*  If processing Retail Exposure or Off-set                         S01332
     C           N         IFEQ 11                                        S01332
     C           N         OREQ 12                                        S01332
     C*                                                                   S01332
     C*  If Retail Exposure Scaling required, scale amount                S01332
     C           @RESCL    IFEQ 'Y'                                       S01332
     C           EXBL      ANDNE*ZERO                                     S01332
     C           EXBL      MULT @PERCT    EXBL                            S01332
     C/COPY WNCPYSRC,EM0101C004
     C           EXBL      DIV  100       EXBL                            S01332
     C/COPY WNCPYSRC,EM0101C005
     C                     END                                            S01332
     C                     END                                            S01332
     C*                                                                   S01332
     C***If*processing*Retail*Exposure*or*Off-set,*Z-ADD*exposure,**S01332090742
     C***off-set*to*total,*since*it*has*been*calculated*from*the****S01332090742
     C***overall*balance*on*MEMOS,*not*from*the*change*in*the*balancS01332090742
     C***otherwise,*ADD*the*exposure,*off-set*to*the*total**********S01332090742
     C***********N         IFEQ 11                                  S01332090742
     C***********N         OREQ 12                                  S01332090742
     C***********          Z-ADDEXBL      EXP,N                     S01332090742
     C***********          ELSE                                     S01332090742
     C*                                                                   CDL002
     C* Net FX Exposure?                                                  CDL002
     C           W#NFXE    IFEQ 'Y'                                       CDL002
     C* Updated by Net Confirmation?                                      CDL002
     C           JOPGM     ANDEQ'FX0920'                                  CDL002
      * FX Deals File?                                                    CDL002
     C           JFILE     ANDEQ'FXDEALPP'                                CDL002
      * Netted Buy?                                                       CDL002
     C           FHNBRF    IFNE *BLANK                                    CDL002
      *                                                                   CDL002
      *   Reverse exposure if deal is being netted                        CDL002
     C           AMRECI    IFNE 'E'                                       CDL002
      *   Reinstate exposure if net is being deleted                      CDL002
     C           AMRECI    OREQ 'E'                                       CDL002
     C           FHNBRF    ANDEQAMNETR                                    CDL002
     C                     SUB  EXBL      EXP,N                           CDL002
     C                     ENDIF                                          CDL002
      * No, Reversal of Net                                               CDL002
     C                     ELSE                                           CDL002
      * No Action required                                                CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     ELSE                                           CDL002
      *                                                                   CDL002
     C                     ADD  EXBL      EXP,N
     C                     ENDIF                                          CDL002
     C***********          END                                      S01332090742
     C** FX OFFSET
      **(S01332 - FX-OFFSET IS NOT SCSALED)                               S01332
     C           N         IFEQ 1
     C*                                                                   CDL002
     C* Net FX Exposure?                                                  CDL002
     C           W#NFXE    IFEQ 'Y'                                       CDL002
     C* Updated by Net Confirmation?                                      CDL002
     C           JOPGM     ANDEQ'FX0920'                                  CDL002
      * FX Deals File?                                                    CDL002
     C           JFILE     ANDEQ'FXDEALPP'                                CDL002
      * Netted Sell?                                                      CDL002
     C           FHNSRF    IFNE *BLANK                                    CDL002
      *                                                                   CDL002
      *   Reverse exposure if deal is being netted                        CDL002
     C           AMRECI    IFNE 'E'                                       CDL002
      *   Reinstate exposure if net is being deleted                      CDL002
     C           AMRECI    OREQ 'E'                                       CDL002
     C           FHNSRF    ANDEQAMNETR                                    CDL002
     C                     SUB  SEXBL     EXP,2                           CDL002
     C                     ENDIF                                          CDL002
      * No, Reversal of Net                                               CDL002
     C                     ELSE                                           CDL002
      * No Action required                                                CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     ELSE                                           CDL002
      *                                                                   CDL002
      *                                                                   CDL002
     C                     ADD  SEXBL     EXP,2
      *                                                                   CDL002
     C                     ENDIF                                          CDL002
      *                                                                   CDL002
     C                     END
     C***REPAYMENTS                                                       RT0137
     C************IN18     IFEQ '1'                                       RT0137
     C***********          ADD  EXBL      EXP,5                           RT0137
     C***********          END                                            RT0137
     C*
     C                     MOVE 'D'       RECI
     C                     MOVE RUND      LCD
     C*
     C           *IN41     IFEQ '0'
     C                     MOVE 'A'       CHTP
     C                     UPDATEMCEXX2F
     C                     ELSE
     C*********            MOVE UPCUS     MCUN                            LN0071
     C                     MOVE UPCUS     MCUNA                           LN0071
     C                     MOVE 'I'       CHTP
     C                     WRITEEMCEXX2F
     C                     END
     C/COPY WNCPYSRC,EM0101C022
     C**
     C           ENDUPD    ENDSR
1396 C**
1397 C/EJECT
     C********************************************************************CTI002
     C**                                                                  CTI002
     C**   UPDAC   S.R.  UPDATES SPECIFIC TO SDACODPD                     CTI002
     C**                CALLED FROM: FILE SUBROUTINES                     CTI002
     C**                CALLS: EM0998 KEEP TRACK IN EMTRCKPD              CTI002
     C**                                                                  CTI002
     C           UPDAC     BEGSR                           ** UPDATE **   CTI002
      *                                                                   CTI002
     C                     MOVE A5ACCD    SAACOD                          CTI002
     C           KTFSA1    SETLLEMTFSA                                    CTI002
     C           KTFSA1    READEEMTFSA                 4740               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELA5ACCD    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSAPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     GOTO ENDUA                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     DELETEMTFSA                                    CTI002
      *                                                                   CTI002
     C                     MOVE SATYPE    SLTYPE                          CTI002
     C           KTFSL0    SETLLEMTFSL                                    CTI002
     C           KTFSL0    READEEMTFSL                 4740               CTI002
     C           *IN40     IFEQ '0'                                       CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELSATYPE    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSLPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     GOTO ENDUA                                     CTI002
     C                     END                                            CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     SUB  SAEXP     SLEXP                           CTI002
     C                     EXCPTTFSLU                                     CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      *                                                                   CTI002
      *                                                                   CTI002
     C                     MOVE A5ACCD    EXACNO                          CTI002
     C           KTFEX2    SETLLEMTFEXF2                                  CTI002
     C           KTFEX2    READEEMTFEXF2               4740               CTI002
     C           *IN40     DOWEQ'0'                                       CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELA5ACCD    WKEY1     P                     CTI002
     C                     MOVEL'EMTFEXPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     GOTO ENDUA                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     DELETEMTFEXF2                                  CTI002
      *                                                                   CTI002
     C           KTFEX2    READEEMTFEXF2               4740               CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      *                                                                   CTI002
     C                     MOVE A5ACCD    CBACNO                          CTI002
     C           KTFCB1    SETLLEMTFCBF1                                  CTI002
     C           KTFCB1    READEEMTFCBF1               4740               CTI002
     C           *IN40     DOWEQ'0'                                       CTI002
     C           *IN47     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0029' MSGID                           CTI002
     C                     MOVELA5ACCD    WKEY1     P                     CTI002
     C                     MOVEL'EMTFCBPD'WFILE1    P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     GOTO ENDUA                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     DELETEMTFCBF1                                  CTI002
      *                                                                   CTI002
     C           KTFCB1    READEEMTFCBF1               4740               CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           ENDUA     ENDSR                                          CTI002
     C/EJECT                                                              CTI002
     C********************************************************************CTI002
     C**                                                                  CTI002
     C**   UPDTI   S.R.  UPDATES SPECIFIC TO TIPOSTPD                     CTI002
     C**                CALLED FROM: FILE SUBROUTINES                     CTI002
     C**                CALLS: EM0998 KEEP TRACK IN EMTRCKPD              CTI002
     C**                                                                  CTI002
     C           UPDTI     BEGSR                           ** UPDATE **   CTI002
      *                                                                   CTI002
     C                     MOVE CNUMTI    EXCNUM                          CTI002
     C                     MOVE ACODTI    EXACNO                          CTI002
      *                                                                                       CTI007
     C           CTI007    IFEQ 'N'                                                           CTI007
     C**********           MOVE TRSEQ     EXTRNS                                       CTI002 CTI007
     C                     MOVELTRSEQ     EXTRNS                                              CTI007
     C                     ELSE                                                               CTI007
     C                     MOVELR1TREF    EXTRNS                                              CTI007
     C                     ENDIF                                                              CTI007
      *                                                                                       CTI007
      ** No double Key Allowed                                            CTI002
     C           KTFEX0    SETLLEMTFEX                   40               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0032' MSGID                           CTI002
     C                     MOVE CNUMTI    CNUMK2                          CTI002
     C                     MOVE ACODTI    ACODK2                          CTI002
     C                     MOVE TRSEQ     TRSQK2                          CTI002
     C                     MOVELKEY2DS    WKEY1  40 P                     CTI002
     C                     MOVEL'EMTFEXPD'WFILE1 10 P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
      ** We release the records previously locked for update in           CTI002
      ** SR/CHKTI before leaving.                                         CTI002
     C           WCBFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFCBL0                                  CTI002
     C                     END                                            CTI002
     C           WSAFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSAL1                                  CTI002
     C                     END                                            CTI002
     C           WSLFND    IFEQ 'Y'                                       CTI002
     C                     UNLCKEMTFSLL0                                  CTI002
     C                     END                                            CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDUI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      ** Check again if EMTFCBPD is present to not write duplicate key    CTI002
      ** In case of between S/R CHKTI and S/R UPDTI a record has          CTI002
      ** been added by the customer within the customer sub limit         CTI002
      ** maintenance menu (EM0040)                                        CTI002
     C           WCBFND    IFNE 'Y'                                       CTI002
      *                                                                   CTI002
     C           KTFCB0    SETLLEMTFCB                   40               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0032' MSGID                           CTI002
     C                     MOVE CNUMTI    CNUMK3                          CTI002
     C                     MOVE ACODTI    ACODK3                          CTI002
     C                     MOVELKEY3DS    WKEY1  40 P                     CTI002
     C                     MOVEL'EMTFCBPD'WFILE1 10 P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDUI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      ** Check again if EMTFSAPD is present to not write duplicate key    CTI002
      ** In case of between S/R CHKTI and S/R UPDTI a record has          CTI002
      ** been added by the customer within the sub limit                  CTI002
      ** maintenance menu (EM0050)                                        CTI002
     C           WSAFND    IFNE 'Y'                                       CTI002
      *                                                                   CTI002
     C           KTFSA1    SETLLEMTFSA                   40               CTI002
     C           *IN40     IFEQ '1'                                       CTI002
     C                     MOVEL'EM0101'  PGMN                            CTI002
     C                     MOVEL'EMT0032' MSGID                           CTI002
     C                     MOVELACODTI    WKEY1     P                     CTI002
     C                     MOVEL'EMTFSAPD'WFILE1 10 P                     CTI002
     C           WKEY1     CAT  WFILE1    P#MSDA                          CTI002
     C                     MOVEL'EMUSRMSG'P#MSGF                          CTI002
     C                     MOVEL'0'       P#INLR                          CTI002
     C                     CALL 'EM0998'                                  CTI002
     C                     PARM           P#0998                          CTI002
     C                     SETOF                     46                   CTI002
     C                     GOTO ENDUI                                     CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      ** We dont check duplicate record in EMTFSLPD because               CTI002
      ** only EM0101 can create sub-line with TYPE = '#'                  CTI002
      *                                                                   CTI002
     C                     MOVE TIDCIN    EXDRCR                          CTI002
     C                     MOVE CCYTI     EXCURR                          CTI002
     C                     Z-ADDAMTIN     EXUAMT                          CTI002
     C                     Z-ADDMTIVD     EXVDTE                          CTI002
     C                     Z-ADDDRCV      EXRDTE                          CTI002
     C                     WRITEEMTFEX                                    CTI002
      *                                                                   CTI002
      ** Sign of amount exposure depends on the debit/credit direction    CTI002
     C           TIDCIN    IFEQ 'C'                                       CTI002
     C                     MULT -1        EXBL                            CTI002
     C                     MULT -1        SEXBL                           CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WCBFND    IFNE 'Y'                                       CTI002
      *                                                                   CTI002
     C                     MOVE CNUMTI    CBCUST                          CTI002
     C                     MOVE ACODTI    CBACNO                          CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     Z-ADDSEXBL     CBEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     Z-ADDEXBL      CBEXP                           CTI002
     C                     END                                            CTI002
     C                     WRITEEMTFCB                                    CTI002
      *                                                                   CTI002
     C                     ELSE                                           CTI002
      *                                                                   CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     ADD  SEXBL     CBEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     ADD  EXBL      CBEXP                           CTI002
     C                     END                                            CTI002
     C                     EXCPTTFCBU                                     CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WSAFND    IFNE 'Y'                                       CTI002
      *                                                                   CTI002
     C                     MOVEL'#'       SATYPE                          CTI002
     C                     MOVE ACODTI    SAACOD                          CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     Z-ADDSEXBL     SAEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     Z-ADDEXBL      SAEXP                           CTI002
     C                     END                                            CTI002
     C                     WRITEEMTFSA                                    CTI002
      *                                                                   CTI002
     C                     ELSE                                           CTI002
      *                                                                   CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     ADD  SEXBL     SAEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     ADD  EXBL      SAEXP                           CTI002
     C                     END                                            CTI002
     C                     EXCPTTFSAU                                     CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           WSLFND    IFNE 'Y'                                       CTI002
      *                                                                   CTI002
     C                     MOVEL'#'       SLTYPE                          CTI002
     C                     MOVEL'UNKNOWN' SLDESC                          CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     Z-ADDSEXBL     SLEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     Z-ADDEXBL      SLEXP                           CTI002
     C                     END                                            CTI002
     C                     WRITEEMTFSL                                    CTI002
      *                                                                   CTI002
     C                     ELSE                                           CTI002
      *                                                                   CTI002
     C           @SCAL2    IFEQ 'Y'                                       CTI002
     C                     ADD  SEXBL     SLEXP                           CTI002
     C                     ELSE                                           CTI002
     C                     ADD  EXBL      SLEXP                           CTI002
     C                     END                                            CTI002
     C                     EXCPTTFSLU                                     CTI002
      *                                                                   CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
     C           ENDUI     ENDSR                                          CTI002
     C/EJECT                                                              CTI002
      *                                                                   S01332
      ** Exposure management scaling subroutine                           S01332
     C/COPY ZSRSRC,ZEXPSCLZ1                                              S01332
1398 C********************************************************************
1399 C**
1400 C**   CCYCON  S.R.  TO CALCULATE EVENT AMOUNT IN TERMS OF LIMIT CCY
1401 C**              THE CONVERTED BALANCE IS IN CONBAL
1402 C**                 CALLED FROM: CALC1, RETAIL
1403 C**
1404 C**     FIELDS USED - AMOUNT = EVENT AMTIN
1405 C**                 - CURR = EVENT CURRENCY
1406 C**     FIELD OUTPUT - CONBAL = CONVERTED AMOUNT                    E
1407 C**
1408 C           CCYCON    BEGSR                           ** CCYCON **
1409 C**
1410 C** ACCESS EVENT CURRENCY RECORD FOR SPOT RATE
1411 C                     MOVE *BLANK    ZTABKY
1412 C                     MOVEL'20'      ZTABKY
1413 C                     MOVELCURR      WORK1
1414 C                     MOVE '1'       WORK1
1415 C                     MOVE WORK1     ZTABKY
1416 C           ZTABKY    CHAINTABTG10F             99
1417 C  N99      RECI      COMP 'D'                  9999
1418 C**
1419 C** IF RECORD NOT FOUND, DATABASE ERROR
1420 C   99                MOVE ZTABKY    DBKY
1421 C   99                Z-ADD7         DBASE            ** DBASE 7 **
1422 C   99                SETON                     U7U8
1423 C   99                GOTO ENDCCY
1424 C**
1425 C** CALCULATE X RATE
1426 C**
     C           MDIN      COMP 0                        20
1427 C   20      1         DIV  SPOT      SPOT
1428 C           SPOT      DIV  LSPOT     XSPOT  138H
1429 C**
1430 C** SET UP EXPONENT
1431 C**
1432 C           CDP       ADD  1         M       10
1433 C********   1         DIV  POWER,M   DECP   138H                     S01129
1433 C           1         DIV  POWERA,M  DECP   138H                     S01129
1434 C** CALCULATE AMOUNT TO BE OUTPUT/ACCUM.
1435 C**
     C****       AMOUNT    MULT DECP      AMOUNT
     C  N16N17   AMOUNT    MULT DECP      AMOUNT
1437 C           AMOUNT    MULT XSPOT     CONBAL 150H  75
1438 C**
1439 C           ENDCCY    ENDSR
1438 C**
1506 C/EJECT
0575 C********************************************************************
0576 C**
0577 C**   FIRST  S.R.  TO PERFORM FIRST CYCLE CALCULATIONS
0578 C**                CALLED FROM: MAINLINE
0579 C**                CALLS: ZSYSTM, GETHED
0580 C**
0581 C           FIRST     BEGSR                           ** FIRST  **
     C           *LIKE     DEFN NOML      WNOML                           S01129
     C           *NAMVAR   DEFN           LDA   256                       CTI002
0582 C**
0583 C** SET PROGRAM NAME ETC
0584 C                     MOVE *BLANK    DBKY
0585 C                     MOVE 'EM0101  'DBPGM
0586 C                     MOVE 'TABEM'   DBFILE
0587 C**
0588 C** GET ICDR1 RECORD FROM TABLE FILE
0589 C                     EXSR ZSYSTM
0590 C   99                Z-ADD1         DBASE            ** DBASE1 **
0591 C   99                MOVE ZTABKY    DBKY
0592 C   99                GOTO ENDF
      *                                                                   CDL002
      **  Access Switchable features file for                             CDL002
      **  FX Netting - CDL002                                             CDL002
     C                     CALL 'AOSARDR0'                                CDL002
     C                     PARM *BLANKS   @RTCD                           CDL002
     C                     PARM '*VERIFY' @OPTN                           CDL002
     C                     PARM 'CDL002'  WSARD   6                       CDL002
     C                     MOVE 'N'       CDL002  1                       CDL002
     C           @RTCD     IFEQ *BLANK                                    CDL002
     C                     MOVE 'Y'       CDL002                          CDL002
     C                     END                                            CDL002
0593 C**
0594 C** GET ICDR2 RECORD FROM TABLE FILE
0595 C                     MOVE '  11'    ZTABKY
0596 C           ZTABKY    CHAINTABTB11F             99    ON=NOT THERE
0597 C  N99      RECI      COMP 'D'                  9999  ON=NOT LIVE REC
0598 C   99                Z-ADD2         DBASE            ** DBASE2 **
0599 C   99                MOVE ZTABKY    DBKY
0600 C   99                GOTO ENDF
     C**                                                                  S01129
     C**                                                                  S01129
     C**   IF 'SE' IS NOT INSTALLED DO NOT CHAIN TO 'SE' ICD RECORD.      E19310
     C                     TESTB'4'       MODI3          13               E19310
     C  N13                GOTO NOTSE                                     E19310
     C**                                                                  E19310
     C                     MOVE *BLANKS   ZTABKY                          S01129
     C                     MOVEL'01'      ZTABKY                          S01129
     C                     MOVE '36'      ZTABKY                          S01129
     C           ZTABKY    CHAINTABTB36F             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                         99               S01129
     C                     Z-ADD15        DBASE            ** DBASE15**   S01129
     C                     MOVE ZTABKY    DBKY                            S01129
     C                     GOTO ENDF                                      S01129
     C                     END                                            S01129
     C**                                                                  S01129
     C           NOTSE     TAG                                            E19310
     C**                                                                  S01129
     C                     MOVE '95'      ZTABKY                          S01129
     C           ZTABKY    CHAINTABTB95F             40                   S01129
     C           *IN40     IFEQ '1'                                       S01129
     C           RECI      OREQ '*'                                       S01129
     C                     SETON                         99               S01129
     C                     Z-ADD16        DBASE            ** DBASE16**   S01129
     C                     MOVE ZTABKY    DBKY                            S01129
     C                     GOTO ENDF                                      S01129
     C                     END                                            S01129
     C*                                                                   S01129
0601 C**
0602 C** READ LIMITS BASE CURRENCY RECORD
0603 C                     MOVEL'20'      ZTABKY
0604 C                     MOVELLCCY      WORK1   4
0605 C                     MOVE '1'       WORK1
0606 C                     MOVE WORK1     ZTABKY
0607 C           ZTABKY    CHAINTABTG10F             99    ON=NOT THERE
0608 C  N99      RECI      COMP 'D'                  9999  ON=NOT LIVE REC
0609 C   99                Z-ADD3         DBASE            ** DBASE3 **
0610 C   99                MOVE ZTABKY    DBKY
0611 C   99                GOTO ENDF
0612 C**
0613 C** STORE LIMITS CURRENCY SPOT RATE AND DECIMAL PLACES
     C           MDIN      COMP 0                        20
0614 C                     Z-ADDCDP       LCDP    10
0615 C                     Z-ADDSPOT      LSPOT  138
0616 C   20      1         DIV  SPOT      LSPOT
0617 C**
0618 C** SET UP WORK FIELDS
0619 C                     Z-ADD0         ZERO5   50
0620 C                     Z-ADD0         ZERO13 130
     C***********          MOVE 'D'       LN2     1                       RT0137
     C***********          Z-ADD0         DDRF1                           RT0137
0621 C**
0622 C** ACCESS EMCEX HEADER
0623 C                     EXSR GETHED
0642 C**
     C*                                                                   S01332
     C** ACCESS EM ICD                                                    S01332
     C                     CALL 'AOEXPMR0'                                S01332
     C                     PARM '*BLANKS' @RTCD   7                       S01332
     C                     PARM '*KEY   ' @OPTN   7                       S01332
     C           SDEXPM    PARM SDEXPM    DSFDY                           S01332
      *                                                                   S01332
     C           @RTCD     IFNE *BLANKS                                   S01332
     C                     SETON                     U7U899               S01332
     C                     MOVEL'AOEXP'   DBFILE                          S01332
     C                     MOVE 'MR0'     DBFILE                          S01332
     C                     Z-ADD31        DBASE            ** DBASE31**   S01332
     C                     END                                            S01332
      *                                                                   CDL002
      * Net FX Exposure?                                                  CDL002
     C                     MOVE 'N'       W#NFXE  1                       CDL002
     C           CDL002    IFEQ 'Y'                                       CDL002
     C                     MOVE BUNTEM    W#NFXE                          CDL002
     C                     ENDIF                                          CDL002
     C*                                                                   S01332
      *                                                                   S01332
      ** If scaling record exists for Retail obtain scaling factor.       S01332
      *                                                                   S01332
     C           'RE'      CHAINEMEXSCL1             25                   S01332
      *                                                                   S01332
     C           *IN25     IFEQ '1'                        B1             S01332
     C                     MOVE 'N'       @RESCL  1                       S01332
     C                     ELSE                            X1             S01332
     C                     MOVE 'Y'       @RESCL                          S01332
     C                     Z-ADDEKPR1P    @PERCT  30                      S01332
     C                     END                             E1             S01332
      *                                                                   CEU020
      ** Check if CEU020 is present                                       CEU020
      *                                                                   CEU020
     C                     MOVEL'N'       CEU020                          CEU020
      *                                                                   CEU020
     C                     CALL 'AOSARDR0'                                CEU020
     C                     PARM *BLANKS   P@RTCD                          CEU020
     C                     PARM '*VERIFY' P@OPTN                          CEU020
     C                     PARM 'CEU020'  P@SARD                          CEU020
     C           SCSARD    PARM SCSARD    DSFDY                           CEU020
      *                                                                   CEU020
     C           P@RTCD    IFEQ *BLANKS                                   CEU020
     C                     MOVEL'Y'       CEU020  1                       CEU020
     C                     ELSE                                           CEU020
      *                                                                   CEU020
      ** Handle Database Error                                            CEU020
      *                                                                   CEU020
     C           P@RTCD    IFNE '*NRF    '                                CEU020
     C                     MOVE *ON       *INU7                           CLE004
     C                     MOVE *ON       *INU8                           CLE004
     C                     MOVE *ON       *IN99                           CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU020
     C                     Z-ADD5         DBASE            * DBERR 05 *   CEU020
     C                     MOVEL'CEU020'  DBKY             ************   CEU020
     C                     ENDIF                                          CEU020
      *                                                                   CEU020
     C                     ENDIF                                          CEU020
     C*                                                                   CIR002
     C** Check if switchable feature CIR002 is switched on                CIR002
     C*                                                                   CIR002
     C                     CALL 'AOSARDR0'                                CIR002
     C                     PARM '*BLANKS' @RTCD                           CIR002
     C                     PARM '*VERIFY' @OPTN                           CIR002
     C                     PARM 'CIR002'  @SARD   6                       CIR002
     C           SCSARD    PARM SCSARD    DSFDY                           CIR002
     C*                                                                   CIR002
     C           @RTCD     IFEQ *BLANKS                                   CIR002
     C                     MOVE 'Y'       CIR002  1                       CIR002
     C                     ELSE                                           CIR002
     C                     MOVE 'N'       CIR002                          CIR002
     C                     END                                            CIR002
      *                                                                   135004
      ** CALL ACCESS PROGRAM FOR BANK DETAILS                             135004
     C                     CALL 'AOBANKR0'                                135004
     C                     PARM '*DBERR  '@RTCD   7                       135004
     C                     PARM '*FIRST  '@OPTN   7                       135004
     C           SDBANK    PARM SDBANK    DSFDY                           135004
      *                                                                   135004
     C           @RTCD     IFNE *BLANK                                    135004
     C                     MOVEL'SDBANKPD'DBFILE            ************* 135004
     C                     Z-ADD037       DBASE             *DBERROR 037* 135004
     C                     MOVEL@OPTN     DBKY      P       ************* 135004
     C                     SETON                     U7U899               135004
     C                     ENDIF                                          135004
      *                                                                   135004
      * Set Date Format Indicator                                         135004
     C           BJDFIN    IFEQ 'M'                                       135004
     C                     MOVE '1'       *IN98                           135004
     C                     ENDIF                                          135004
      *                                                                   S01332
     C/COPY WNCPYSRC,EM0101CCP6                                           S01408
      *                                                                   S01408
      ** Check if SAR CLE004 is present                                   CLE004
      *                                                                   CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   P@RTCD  7                       CLE004
     C                     PARM '*KEY   ' P@OPTN  7                       CLE004
     C                     PARM 'CLE004'  P@SARD  6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           P@RTCD    IFEQ *BLANKS                                   CLE004
     C                     MOVE *ON       CLE004  1                       CLE004
     C                     ELSE                                           CLE004
      *                                                                   CLE004
      ** Handle Database Error                                            CLE004
      *                                                                   CLE004
     C           P@RTCD    IFNE '*NRF    '                                CLE004
     C                     MOVE *ON       *INU7                           CLE004
     C                     MOVE *ON       *INU8                           CLE004
     C                     MOVE *ON       *IN99                           CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE004
     C                     Z-ADD33        DBASE            * DBERR 33 *   CLE004
     C                     MOVEL'CLE004'  DBKY             ************   CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE006
      ** Check if SAR CLE006 is present                                   CLE006
      *                                                                   CLE006
     C                     CALL 'AOSARDR0'                                CLE006
     C                     PARM *BLANKS   P@RTCD  7                       CLE006
     C                     PARM '*KEY   ' P@OPTN  7                       CLE006
     C                     PARM 'CLE006'  P@SARD  6                       CLE006
     C           SCSARD    PARM SCSARD    DSFDY                           CLE006
      *                                                                   CLE006
     C           P@RTCD    IFEQ *BLANKS                                   CLE006
     C                     MOVE *ON       CLE006  1                       CLE006
     C                     ELSE                                           CLE006
      *                                                                   CLE006
      ** Handle Database Error                                            CLE006
      *                                                                   CLE006
     C           P@RTCD    IFNE '*NRF    '                                CLE006
     C                     MOVE *ON       *INU7                           CLE006
     C                     MOVE *ON       *INU8                           CLE006
     C                     MOVE *ON       *IN99                           CLE006
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE006
     C                     Z-ADD34        DBASE            * DBERR 34 *   CLE006
     C                     MOVEL'CLE006'  DBKY             ************   CLE006
     C                     ENDIF                                          CLE006
      *                                                                   CLE006
     C                     ENDIF                                          CLE006
      *                                                                   CLE006
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C                     MOVE *ON       *INU7                           CLE005
     C                     MOVE *ON       *INU8                           CLE005
     C                     MOVE *ON       *IN99                           CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD40        DBASE            * DBERR 40 *   CLE005
     C                     MOVEL'CLE005'  DBKY             ************   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE028
      ** Check if SAR CLE028 is present                                                       CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   P@RTCD                                              CLE028
     C                     PARM '*KEY   ' P@OPTN                                              CLE028
     C                     PARM 'CLE028'  P@SARD                                              CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
      ** Handle Database Error                                                                CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFNE '*NRF    '                                                    CLE028
     C                     MOVE *ON       *INU7                                               CLE028
     C                     MOVE *ON       *INU8                                               CLE028
     C                     MOVE *ON       *IN99                                               CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD43        DBASE                                               CLE028
     C                     MOVEL'CLE028'  DBKY                                                CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C/COPY WNCPYSRC,EM0101C018
      *                                                                   CTI002
      **  Access Switchable features file for                             CTI002
      **  Trade inovation CTI002                                          CTI002
     C                     CALL 'AOSARDR0'                                CTI002
     C                     PARM *BLANKS   @RTCD                           CTI002
     C                     PARM '*VERIFY' @OPTN                           CTI002
     C                     PARM 'CTI002'  WSARD   6                       CTI002
     C                     MOVE 'N'       CTI002  1                       CTI002
     C           @RTCD     IFEQ *BLANK                                    CTI002
     C                     MOVE 'Y'       CTI002                          CTI002
     C                     END                                            CTI002
      *                                                                   CTI002
      **  Access Switchable features file for                                                 CTI007
      **  Exposure Management Enahncement CTI007                                              CTI007
     C                     CALL 'AOSARDR0'                                                    CTI007
     C                     PARM *BLANKS   @RTCD                                               CTI007
     C                     PARM '*VERIFY' @OPTN                                               CTI007
     C                     PARM 'CTI007'  WSARD   6                                           CTI007
     C                     MOVE 'N'       CTI007  1                                           CTI007
     C           @RTCD     IFEQ *BLANK                                                        CTI007
     C                     MOVE 'Y'       CTI007                                              CTI007
     C                     END                                                                CTI007
      *                                                                   CLE005
0643 C           ENDF      ENDSR                           ** ENDF TAG **
1440 C**
     C******************************************************************* BHF848
     C*                                                                   BHF848
     C* ZA0680 : SUB-ROUTINE TO CONVERT FROM YYYYMMDD DATE FORMAT TO      BHF848
     C*          MIDAS DAY NUMMBER                                        BHF848
     C*                                                                   BHF848
     C* INPUT  : @@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   BHF848
     C*                                                                   BHF848
     C* OUTPUT : @@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     BHF848
     C*                                                                   BHF848
     C* USES :   @@CC   NUMBER OF CENTURIES IN DATE                       BHF848
     C*          @@DAY  DAY NUMBER                                        BHF848
     C*          @@REM  REMAINDER FROM DIVIDE                             BHF848
     C*          @@MTH  MONTH NUMBER                                      BHF848
     C*          @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     BHF848
     C*                 MONTH                                             BHF848
     C*          @@WK2  WORK FIELD (2,0)                                  BHF848
     C*          @@WK5  WORK FIELD (5,0)                                  BHF848
     C*          @@YYYY YEAR (4 CHARACTER)                                BHF848
     C*          @@YY   YEAR (2 CHARACTER)                                BHF848
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     BHF848
     C*                 A FOUR YEAR PERIOD                                BHF848
     C*                                                                   BHF848
     C           ZA0680    BEGSR                                          BHF848
     C*                                                                   BHF848
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD                               BHF848
     C                     Z-ADD0         @@MDNO  50                      BHF848
     C*                                                                   BHF848
     C           @@DTIN    CABEQ0         ZA0689                          BHF848
     C*                                                                   BHF848
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          BHF848
     C           @@YYYY    IFGE 2072                       B1             BHF848
     C*                                                                   BHF848
     C**    MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)            BHF848
     C           @@CC      SUB  19        @@WK2   20       *1             BHF848
     C           @@WK2     MULT 36524     @@MDNO           *1             BHF848
     C*                                                                   BHF848
     C**  YEAR 2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY                   BHF848
     C                     ADD  1         @@MDNO           *1             BHF848
     C                     END                             E1             BHF848
     C*                                                                   BHF848
     C           @@YYYY    ADD  28        @@WK2                           BHF848
     C*                                                                   BHF848
     C           @@WK2     DIV  4         @@WK2                           BHF848
     C                     MVR            @@REM   10                      BHF848
     C*                                                                   BHF848
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                BHF848
     C           @@WK2     MULT 1461      @@WK5   50                      BHF848
     C                     ADD  @@WK5     @@MDNO                          BHF848
     C*                                                                   BHF848
     C**  CHECK REMAINDER AND MONTH NUMBER                                BHF848
     C           @@REM     IFEQ 0                          B1             BHF848
     C           @@MTH     ANDGT2                          B1             BHF848
     C                     ADD  1         @@MDNO           *1             BHF848
     C                     END                             E1             BHF848
     C*                                                                   BHF848
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               BHF848
     C           @@REM     IFNE 0                          B1             BHF848
     C                     ADD  @YD,@@REM @@MDNO           *1             BHF848
     C                     END                             E1             BHF848
     C*                                                                   BHF848
     C**  ADD MONTHS THIS YEAR                                            BHF848
     C                     ADD  @MD,@@MTH @@MDNO                          BHF848
     C*                                                                   BHF848
     C**  ADD DAYS THIS MONTH                                             BHF848
     C                     ADD  @@DAY     @@MDNO                          BHF848
     C*                                                                   BHF848
     C           ZA0689    ENDSR                           **ZA0689 TAG** BHF848
1441 C********************************************************************
1486 C**
1487 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
1488 C**              CALLED BY: FIRST
1489 C**
1490 C           ZSYSTM    BEGSR                           *** ZSYSTM ***
1491 C**
1492 C**   SET UP KEY FOR INSTALLATION CONTROL RECORD.
1493 C                     MOVEL'01      'ZTABKY 12
1494 C                     MOVE '  10'    ZTABKY
1495 C**
1496 C           ZTABKY    CHAINTABTB10F             99    ON NOT THERE
1497 C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
1498 C**
1499 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
1500 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
1501 C**
1502 C                     ENDSR
1503 C**
1504 C**
     E/COPY ZSRSRC,ZCONVZ1                                                S01129
      *                                                                   CDL002
      *****************************************************************   CDL002
      *                                                               *   CDL002
      * *PSSR - SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS        *   CDL002
      *                                                               *   CDL002
      * CALLED FROM : AFTER ABNORMAL OPERATION OCCURS                 *   CDL002
      *                                                               *   CDL002
      *****************************************************************   CDL002
     C           *PSSR     BEGSR                           ** *PSSR **    CDL002
      *                                                                   CDL002
     C           @RUN      IFEQ *BLANKS                                   CDL002
     C                     MOVE 'Y'       @RUN    1                       CDL002
     C                     SETON                     U7U8LR               CDL002
     C                     DUMP                                           CDL002
     C                     END                                            CDL002
      *                                                                   CDL002
     C                     ENDSR                                          CDL002
1505 C********************************************************************
     C* PGMS - VALID PGMS. FOR RECEIVING JOURNAL ENTRIES - UPDATED S01332
     C*CL0020    CL0030    CL0040    CL0045    CL1610                     S01332
     C*LE0020    LE0033    LE0040    LE0053    LE0063                     S01332
     C*LE0110    LE0120    RE0150    RE0190    RE0253                     S01332
     C*RE0279    CL0050    SE0050    SE0060    SE0070                     S01332
     C*FX0320    MM0078                                                   S01332
     C* PGMS - SYND LOANS REMOVED FROM  VALID PROGRAMS - RT0137           RT0137
     C*CL0020    CL0030    CL0040    CL0045    CL1610    DL1602I          RT0137
     C*LE0020    LE0033    LE0040    LE0053    LE0063    DL1602A          RT0137
     C*LE0110    LE0120    RE0150    RE0190    RE0253    DL1602R          RT0137
     C*RE0279    CL0050    SE0050    SE0060    SE0070    DL1603I          RT0137
     C*FX0320    MM0078    DL1601I   DL1601A   DL1601R   DL1603A          RT0137
     C*DL1603R   DL1604I   DL1604A   DL1604R   FF0020    FF0040           RT0137
     C*FF0360                                                             RT0137
      *                                                                   E21552
      **  SE3003 ADDED TO ARRAY PGMS BY E21552.                           E21552
      *                                                                   E21552
      *                                                                   S01332
      **  DL0070 TAKEN OUT OF PGMS ARRAY AS OLD S/38 PGM.                 S01332
      **  BC0052 BC0062 BC0082 BC0092 BC0112 TAKEN OUT - S01196           S01332
      **  CL0020 CL0030 CL0040 CL0045 CL1610 CL0050 TAKEN OUT BY          RT0137
      **  RT0137                                                          RT0137
      **  GL4445 ADDED TO PGMS ARRAY BY E23929                            E23929
      *                                                                   090794
      **  GL3271 REPLACED RE0279 IN ARRAY PGMS BY 090794                  090794
      *                                                                   091932
      **  SD0451R AND SD0452R ADDED IN ARRAY PGMS BY 091932               091932
      **  AOMEMSU0 ADDED TO ARRAY PGMS BY 094081                          094081
      **  Program No.41 FX0920   ADDED TO ARRAY PGMS BY CDL002            CDL002
      **  Program No.42 SD0031R  ADDED TO ARRAY PGMS BY CTI002            CTI002
      **  API PROGRAMS ADDED TO ARRAY BY 155631                           155631
      **  Service Programs renamed at R4 by 206988                                            206988
     C**  DL1602I   DL1602A   DL1602R   DL1603I   DL1603A                 CTI002
     C**  LE0020    LE0033    LE0040    LE0053    LE0063                  CTI002
     C**  LE0110    LE0120    RE0150    RE0190    RE0253                  CTI002
     C**  GL3271    FF0040    SE0050    SE0060    SE0070                  CTI002
     C**  FX0320    MM0078    DL1601I   DL1601A   DL1601R                 CTI002
     C**  DL1603R   DL1604I   DL1604A   DL1604R   FF0020                  CTI002
     C**  FF0360    GL4445    SE3003    FX0380    FX0390                  CTI002
     C**  MM0081    SD0451R   SD0452R   DL0100    AOMEMSU0          CIR002CTI002
     C**  LE2020    LE2030    LE2040    LE2110    LE2120            CLE005CTI002
     C**  FX0920    SD0031R                                         CDL002CTI002
1506 C/EJECT
1503 C**
1504 C**
     C/COPY WNCPYSRC,EM0101C010
     OEMTFSA  E                TFSAU                                      CTI002
     O                         SAEXP                                      CTI002
     OEMTFCB  E                TFCBU                                      CTI002
     O                         CBEXP                                      CTI002
     OEMTFSL  E                TFSLU                                      CTI002
     O                         SLEXP                                      CTI002
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** POWERA - ASCENDING POWERS OF TEN
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** TABA - FX UPDATE TYPES
FPFSCXSWOPOTPISI
** TABB - MM UPDATE TYPES
IPITTILNCLDLTDCD
** TABD - LOANS CL
61626364656667706869717280
** PGMS -VALIDPGMS.FOR RCVING JRNL ENTRIES S01128BHF848RT0137 90794 91932
DL1602I   DL1602A   DL1602R   DL1603I   DL1603A
LE0020    LE0033    LE0040    LE0053    LE0063
LE0110    LE0120    RE0150    RE0190    RE0253
GL3271    FF0040    SE0050    SE0060    SE0070
FX0320    MM0078    DL1601I   DL1601A   DL1601R
DL1603R   DL1604I   DL1604A   DL1604R   FF0020
FF0360    GL4445    SE3003    FX0380    FX0390
MM0081    SD0451R   SD0452R   DL0100    AOMEMSU0                          CIR002
LE2020    LE2030    LE2040    LE2110    LE2120                            CLE005
FX0920    SD0031R   FXFXDLSIN FXFXDLRPR FXFXDLUPP                         155631
FXDEALRAT MMLDNISIN MMLDNIRPR MMLDNIUPP MMDEALRAT                         155631
MMDEAMSIN MMDEAMRPR MMDEAMUPP MMNASPSIN MMNASPRPR                         155631
MMNASPUPP MMNASSSIN MMNASSRPR MMNASSUPP FFEXTRSIN                         155631
FFEXTRRPR FFTRANUPP FFOTCCSIN FFOTCCRPR IRCIRSSIN                         155631
IRCIRSRPR IRCIRSUPP IRFRASIN  IRFRARPR  IRFRAUPP                          155631
IRSIRSSIN IRSIRSRPR IRSIRSUPP SEDPMVSIN SEDPMVRPR                         155631
SEDPMVUPP SETRADSIN SETRADRPR SETRADUPP SP8FF0001                         155631
SP8FX0001 SP8MM0002 SP8IR0001 SP8SE0001 SP8LE0005                                           MD029270
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION                      S01129
00000001                                                                  S01129
00000010                                                                  S01129
00000100                                                                  S01129
00001000                                                                  S01129
00010000                                                                  S01129
00100000                                                                  S01129
01000000                                                                  S01129
10000000                                                                  S01129
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** @YD  USED BY SR. ZA0680 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    BHF848
00366007310109601461                                                      BHF848
** @MD  USED BY SR. ZA0680 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       BHF848
00000000310005900090001200015100181002120024300273003040033400365         BHF848
** CMD ** System commands
DLYJOB DLY(5)
