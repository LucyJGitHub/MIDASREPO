     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ER Book Positions Closure Price-Historic')
      ********************************************************************
      *                                                                  *
      *     MIDAS ABS  EUROPEAN REPORTING                                *
      *                                                                  *
      *     ER0522 - BOOK POSITIONS CLOSURE PRICE - HISTORIC             *
      *                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2005            *
      *                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD027A            Date 03May06               *
      *  Prev Amend No. CER001             Date 25Aug05               *
      *                 UPG402             Date 04Oct04               *
      *                 ER_R10             Date 18OCT94               *
      *                 ER0107             Date 02DEC92               *
      *                                                                  *
      *                                                                  *
      ********************************************************************
      *  CSD027A - Conversion of customer number to alpha (post       *
      *            build 103). Recompiled.                            *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  UPG402 - Recompile due to R4.02 upgrade                      *
      *     ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10   *
      *            - MULTIBRANCHING CHANGES                           *
      *     ER0107 - New field in BKPHDDX4 (Previous Nomonal Position)*
      *****************************************************************
     FBKPRVLJ0IF  E           K        DISK         KINFSR *PSSR          ER0107
     F* BOOK Positions Revaluation                                        ER0107
     F*                                                                   ER0107
     F***BKPHDDX4UF  E           K        DISK         KINFSR *PSSR                           CER001
     FERBKPHPDUF  E           K        DISK         KINFSR *PSSR                              CER001
     F* Book Positions - Extended File - Upd idx
     F*
     FSDBANKL1IF  E           K        DISK         KINFSR *PSSR
     F* Bank Details - Rtv idx
     F*
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     F* Securities details - Rtv idx
     F*
      /EJECT
     ******************************************************************
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     ******************************************************************
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     ******************************************************************
     C* INIT PROCESSING
     C           BKKEY     KLIST                                          ER0107
     C***********          KFLD           K1BHBR  30                ER0107ER_R10
     C                     KFLD           K1BHBA  3                       ER_R10
     C                     KFLD           K2BHBK  2                       ER0107
     C                     KFLD           K3BHSC 10                       ER0107
     C                     KFLD           K4NCRY  3                       ER0107
     ******************************************************************
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C                     READ SDBANKL1                 80
     C           *IN80     IFEQ '1'                        - B1
     C                     MOVEL'ER0522  'DBPGM
     C                     MOVEL'01'      DBASE            *****************
     C                     MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     EXSR *PSSR
     C                     END                             - E1
     ******************************************************************
     C* MAIN PROCESSING
     ******************************************************************
     C                     MOVE *BLANKS   WWBHSC 10
     C*
     C********** *LOVAL    SETLLBKPHDDX4                                                      CER001
     C**********           READ BKPHDDX4                 31                                   CER001
     C           *LOVAL    SETLLERBKPHPD                                                      CER001
     C                     READ ERBKPHPD                 31                                   CER001
     C*
     C           *IN31     DOWEQ'0'                        - B1
      *
     C           WDBHSC    IFNE WWBHSC                     - B2
      *
     C           WDBHSC    CHAINSECTY                88
     C           *IN88     IFEQ '1'                        - B3
     C********** WDBHSC    SETGTBKPHDDX4                                                      CER001
     C           WDBHSC    SETGTERBKPHPD                                                      CER001
     C                     GOTO NEXT
     C                     END                             - E3
      *
     C                     END                             - E2
     C*
     C                     Z-ADDMKPR      WDPRCP
      *                                                                   ER0107
     C***********          MOVE WDBHBR    K1BHBR                    ER0107ER_R10
     C                     MOVE WDBHBR    K1BHBA                          ER_R10
     C                     MOVE WDBHBK    K2BHBK                          ER0107
     C                     MOVE WDBHSC    K3BHSC                          ER0107
     C                     MOVE WDNCRY    K4NCRY                          ER0107
      *                                                                   ER0107
     C           BKKEY     CHAINBKPBKF               88                   ER0107
     C           *IN88     IFEQ '0'                                       ER0107
     C                     Z-ADDNPSN      WDPNPS                          ER0107
     C                     END                                            ER0107
      *                                                                   ER0107
     C                     UPDATBKPHDDF4
      *
     C           NEXT      TAG
     C                     MOVELWDBHSC    WWBHSC
     C**********           READ BKPHDDX4                 31                                   CER001
     C                     READ ERBKPHPD                 31                                   CER001
      *
     C                     ENDDO                           - E1
      *
     C                     MOVE '1'       *INLR
     C                     RETRN
     C********************************************************************
      ** *PSSR  S/R  - DATABASE ERROR SUBROUTINE
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2005
