     H        1   Y
      *****************************************************************   ULX004
/*STD *  RPGBASE                                                      *   ULX004
/*EXI *  TEXT('Midas ER Extract program - LE Lending')                *
      *****************************************************************
      *                                                               *
      *  Midas - European Reporting module                            *
      *                                                               *
      *  ER0623 - ER EXTRACT PROGRAM - LE LENDING                     *
      *                                                               *
      *  (c) Finastra International Limited 2005                      *
      *                                                               *
      *  Last Amend No. MD059600           Date 17Feb22               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 MD046248           Date 27Oct17               *
      *                 MD041443           Date 19Sep16               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 225555             Date 01Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG11611           Date 26Jun06               *
      *                 CSD027A            Date 12May06               *
      *                 CLE042             Date 06Sep05               *
      *                 CER001             Date 25Apr05               *
      *                 217813             Date 13May03               *
      *                 214603             Date 06Feb03               *
      *                 ULX047             Date 06Dec02               *
      *                 193116             Date 28May01               *
      *                 ULX046             Date 04Oct04               *
      *                 212867             Date 03Dec02               *
      *                    ULX046             Date 23Oct02            *
      *                    CG0001             DATE 16Sep02            *
      *                    194921             DATE 28Jun01            *
      *                    187607 PT          DATE 18Dec00            *
      *                    163681 PT          DATE 29JUL99            *
      *                    WDPTF9             Date 06Jul99            *
      *                    CAD027 PT          Date 13Jan99            *
      *                    158312 PT PTFIX1   DATE 31MAR99            *
      *                    150630             Date 14Dec98            *
      *                    141660 PT          Date 30Nov98            *
      *                    CEU007 PTF08       Date 30Nov98            *
      *                    CAD007 PT          Date 24Jul98            *
      *                    CAD006 PT          Date 20Jul98            *
      *                    ULX004             Date 14Mar97            *
      *                    ART021    PT       Date 16SEP96            *
      *                    ERL463 PT          Date 05NOV96            *
      *                    107142 PT          DATE 21AUG96            *
      *                    ER_R10             DATE 18OCT94            *
      *                    ERL460 PT          DATE 08JUN95            *
      *                    ERL458 PT          DATE 11MAY95            *
      *                    85053  PT          DATE 11MAY95            *
      *                    80849  PT          DATE 11JAN95            *
      *                    57071  PT          DATE 22DEC94            *
      *                    ERL446 TLI         DATE 14NOV94            *
      *                    ERL428 PT          DATE 27AUG94            *
      *                    ERL417 PT          DATE 27AUG94            *
      *                    ERL416 PT          DATE 26JUL94            *
      *                    ER0402 PT          DATE 12JUL94            *
      *                    054791 TLI         DATE 24MAY93            *
      *                    EMFIX  TLI         DATE 11MAY93            *
      *                    ER0343 TLI         DATE 27APR93            *
      *                    ER0341 PT          DATE 21APR93            *
      *                    ER0337 PT          DATE 15APR93            *
      *                    ER0336 TLI         DATE 05APR93            *
      *                    ER0330 TLI         DATE 17MAR93            *
      *                    ER0329 TLI         DATE 16MAR93            *
      *                    ER0324 TLI         DATE 02MAR93            *
      *                    ER0321 TLI         DATE 15FEB93            *
      *                    ER0320 TLI         DATE 05FEB93            *
      *                    ER0317 TLI         DATE 02FEB93            *
      *                    ER0310 PT          DATE 26JAN93            *
      *                    ER0205 ADs         DATE 14JAN93            *
      *                    ER1012             DATE 15JAN93      ThL   *
      *                    ER0136 VT          DATE 23DEC92            *
      *                    ER0101 ADs         DATE 24NOV92            *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD059600 - Loan narratives fields are not extrated           *
      *             (recompile)                                       *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data.    *
      *  MD046248 - Finastra Rebranding                               *
      *  MD041443 - CBC022001 failed due to invalid character in file *
      *             text description (Recompile)                      *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *    225555 - Add discount/premium amount, amount to amortize   *
      *             and 'Prix d'Acquisition'. Recompile over changed  *
      *             EREXTRPD.                                         *
      *  BUG11611 - ERC0600 10001 failed                              *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *    217813 - Repayments incorrectly managed for S1.5 table
      *    214603 - Several problems due to ULX046
      *    ULX047 - CSSF Market Values Calculation                    *
      *    193116 - Rename SCCY from LOAMSDK to avoid DB error 006    *
      *  UPG402 - Recompile due to R4.02 upgrade                      *
      *    212867 - REVISION DATE (REPAYMENT DATE) MUST CORRECTLY     *
      *             CALCULATED AND NO MORE ENDDATE - CROSS-CHECK WITH *
      *             FIRE (APLLICATION DE S ONE)                       *
      *    ULX046 - Circulars 2002/170-174-175 Integration            *
      *    CG0001 - remove fix 187607 (msg PAscal Tinant 13/09/02)    *
      *    194921 - To populate several empty fields                  *
      *    187607 - End date must always be set to the maturity date  *
      *    163681 - TO MANAGE THE PRINCIPAL INCREASES                 *
      *             upgraded to PTF09                                 *
      *    WDPTF9 - Recompile due to change in files NOK in RDB2CPLX09*
      *    CAD027 - Several events 'X2' can be generated for a loan   *
      *    158312 - Do not process interbranch events                *
      *    150630 - Database Error file SDNOSTPD at 07                *
      *             Access to SDNOSTPD with CLOANC details            *
      *    141660 - Do not extract events which have reached the      *
      *             reporting date                                    *
      *    CEU007 - Holidays Changes For Reporting Interface.         *
      *    CAD007 - CAD adaptation to data dictionary version 1.6     *
      *           (recompiled only)                                   *
      *    CAD006 - TOTI must be subtracted from OPAM for the discount*
      *             participations purchased, not the term part.      *
      *    ULX004 - Capital Adequacy                                  *
      *           - IML Circular 97/138                               *
      *           - Customer Lending enhancements consideration       *
      *           (UNL002 Reference is replaced with ULX004 for DBA4) *
      *           (UCH001 Reference is replaced with ULX004 for DBA4) *
      *    ART021 - SNB Article 21 development                        *
      *    ERL463 - In release 10, events type I2 have been replaced  *
      *             by events type X2 when interest are capitalised   *
      *    107142 - For monthly IBLC, we need to use the initial      *
      *             duration when the repayments are processed        *
      *    ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10    *
      *           - (R10 MULTIBRANCHING)                              *
      *    ERL460 - To increment a value for the repayments           *
      *    ERL458 - To set up field DSFREP to 1 for first repayment   *
      *    85053  - Amount reported in debit instead of credit        *
      *    80849  - For call loans, initial duration = notice days    *
      *    57071  - WHEN A PARTICIPATION PURCHASED HAS BEEN SOLD,     *
      *             THE PARTICIPATION SOLD AMOUNT MUST BE REPORTED    *
      *             UNDER THE ORIGINAL BORROWER OF THE PARTICIPATION  *
      *             PURCHASED AND NOT UNDER THE COUNTERPARTY          *
      *    ERL446 - NEW IML 2.3 DEVELOPMENT                           *
      *    ERL428 - To extract customer classification                *
      *    ERL417 - To extract loan processing type                   *
      *    ERL416 - Repayments management incorporation (includes     *
      *             fix. 64629 for IMI)                               *
      *    ER0402 - Credit type enlarged to last quarter past due cr. *
      *    054791 - Setup Revision Date                               *
      *    EMFIX  - FOR PARTICIPATION SOLD LNRF OVERWRITTEN           *
      *           - LOANS MATURED TAKE IN CONSIDERATION               *
      *    ER0343 - Change setup of Maturity Date                     *
      *    ER0341 - For participations purchased, use original        *
      *             borrower as customer number                       *
      *    ER0337 - Processing type 70 must be processed              *
      *    ER0336 - Setup Credit Type field - IML 2.3 DEVELOPMENT     *
      *    ER0330 - Use the original borrower for the participations  *
      *             sold                                              *
      *    ER0329 - The Discount Amount must be removed from          *
      *             Principal Amount for loans processing type        *
      *             63, 66 and 67.                                    *
      *    ER0324 - Extract records if Deal Date reached              *
      *    ER0321 - Add 'Country of Citizenship'                      *
      *    ER0320 - Take Loans Past Due in consideration              *
      *    ER0317 - Change test with run date by end of month date    *
      *    ER0310 - Interest rate type indicator incorrectly set up   *
      *    ER0205 - Add B/n-B ind. and second Ccy on extract file     *
      *    ER1012 - Nominal amount is mandatory for Discount Loans &  *
      *             Participations.                                   *
      *    ER0136 - CALCULATE THE NUMBER OF EXTRACTED RECORDS         *
      *    ER0101 - Decision Key lenght from 6 to 8 (RECOMPILATION)   *
      *                                                               *
     F*****************************************************************
     F**CLOANCL2IF  E           K        DISK                             ER0337
     F**CLOANC**IF  E           K        DISK                             ER0337 ULX046
     F***CLOANC**IF  E           K        DISK                           UC            ULX046 CER001
     FLECLNXL0IF  E           K        DISK                           UC                      CER001
     F* LE Loans file
     F*
     F**CLOANK**IF  E           K        DISK                             ULX004 ULX046
     FCLOANK  IF  E           K        DISK                           UC  ULX046
     F* LE Loans file                                                     ULX004
      *
     FERLOANL0IF  E           K        DISK                           UC  ULX046
      * LE Loans file                                                     ULX046
      *                                                                   ULX046
     FERLOAKL0IF  E           K        DISK                           UC  ULX046
      * LE Loans file                                                     ULX004
     F*
     FERPARTL0IF  E           K        DISK                               ER0330
     F* Participations Sold file                                          ER0330
     F*                                                                   ER0330
     FSDCUSTL1IF  E           K        DISK
     F* Client Details file
     F*                                                                   ERL428
     FSDSECSL1IF  E           K        DISK                               ERL428
     F* SE Client Details file                                            ERL428
     F*
     FLOAMS   IF  E           K        DISK                               ER0336
     F            LOAMSDHF                          KIGNORE               ER0336
     F            LOAMSZ1F                          KIGNORE               ER0336
     F* Loan Amendments                                                   ER0336
     F*
     FSDCURRL1IF  E           K        DISK
     F* Currency Codes file
     F*
     FSDBRCHL1IF  E           K        DISK
     F* Branch Details - Master file
     F*
     FSDBANKL1IF  E           K        DISK
     F* Bank Details file
     F*                                                                   ERL416
     FERLVENL0IF  E           K        DISK                               ERL416
     F* ER Customer Lending Events                                        ERL416
     F*
     FLEACXAL3IF  E           K        DISK                               ULX004
     F* LE Accruals Extract by Loan number                                ULX004
     F*                                                                   ULX004
     FEREXTRPDO   E                    DISK
     F* ER Production Extract
     F*
     FER0623AUO   E                    PRINTER
     F* ER Audit report for Customer Lending
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   .. *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*                                                                   ER0317
     E** ARRAY FOR ZDATE1                                                 ER0317
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMNM   12  12  3               ZDATE2 SR.ARRAY  ER0317
     E                    TNDM   12  12  2 0             NUMBER/DAY/MONTH ER0317
     E*
     E                    CT1    12  12  2 0                              ER0336
     E                    CT2    12  12  2 0                              ER0336
     E                    TFRQ    8   8  1               FREQUENCE        ULX046
     E                    TFVL    8   8  1 0             FREQUENCE VALUE  ULX046
     IERPARTLD                                                            EMFIX
     I              LNRF                            ERLNRF                EMFIX
     ILOAMSDKF                                                            ER0336
     I              LNRF                            BQLNRF                ER0336
     I              VDAT                            BQVDAT                ER0336
     I              LTYP                            BQLTYP                ER0336
     I              SUTP                            BQSUTP                ER0336
     I              PTYP                            BQPTYP                ER0336
     I              CCY                             BQCCY                 ER0336
     I**************BRCD                            BQBRCD          ER0336ER_R10
     I              BRCA                            BQBRCD                ULX004
     I              CNUM                            BQCNUM                ER0336
     I              FCUS                            BQFCUS                ER0336
     I              FTYP                            BQFTYP                ER0336
     I              FSEQ                            BQFSEQ                ER0336
     I              INTC                            BQINTC                ERL416
     I              PSTM                            BQPSTM                150630
     I              PONS                            BQPONS                150630
     I              RSTM                            BQRSTM                150630
     I              RONS                            BQRONS                150630
     I              SCCY                            BQSCCY                193116
     I              CLAS                            BQCLAS                                    CLE042
     I*
      **OLNO*field*-*alpha*and numeric                                                CSD027A CLE148
     I**********  DS                                                                  CSD027A CLE148
     I**********                              1   6 OLNOA                             CSD027A CLE148
     I**********                              1   60OLNON                             CSD027A CLE148
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA       E DSLDA                         256                       ULX004
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I            DS                                                      ULX046
     I**  DATA STRUCTURE FOR SR. ZDAT10 - DATE INPUT TO SUBROUTINE        ULX046
     I                                        1   80ZZDTIN                ULX046
     I                                        1   40ZWYYYY                ULX046
     I                                        1   20ZWCC                  ULX046
     I                                        5   60ZWMTH                 ULX046
     I                                        7   80ZWDAY                 ULX046
     I*
     I**  DATA STRUCTURE FOR LOAN TYPE/SUBTYPE
     I            DS
     I                                        1   2 LTYP
     I                                        3   4 SUTP
     I                                        5   5 OFLD                                      CLE042
     I                                        6   9 CLAS                                      CLE042
     I                                        1   9 TSTYPE                                    CLE042
     I****************************************1   4 TSTYPE                                    CLE042
     I**  MIDAS RUN DATE                                                  ER0317
     I            DS                                                      ER0317
     I                                        1   7 BJMRDT                ER0317
     I                                        1   20WWBJD                 ER0317
     I                                        3   5 WWBJM                 ER0317
     I                                        6   70WWBJY                 ER0317
     I**  DEFINE A DATE                                                   ER0317
     I            DS                                                      ER0317
     I                                        1   60WWDATE                ER0317
     I                                        1   20WWD                   ER0317
     I                                        3   40WWM                   ER0317
     I                                        5   60WWY                   ER0317
     I*
     I**  DEFINED BEGIN OF QUARTER                                        ER0336
     I            DS                                                      ER0336
     I                                        1   40BQYEAR                ER0336
     I                                        5   60BQMONT                ER0336
     I                                        7   80BQDAY                 ER0336
     I                                        1   80BQDATE                ER0336
     I*                                                                   ERL458
     I**  DEFINED TRANSACTION REFERENCE FOR FIRST REPAYMENT               ERL458
     I************DS                                                      ERL458
     I************                            1  15 EXTREF          ERL458ULX004
     I************                            8  10 DSREPN          ERL460ULX004
     I************                           11  11 DSFREP          ERL458ULX004
      *                                                                   CEU007
     IUUFDY     E DSDSFDY                                                 CEU007
      ***  200 Byte Data Structure for Incoming Data from Access Program  CEU007
      *                                                                   CEU007
     ID@NOST    E DSSDNOSTPD                                              CEU007
      ***  Nostro Details DS for assigning data from Access               CEU007
      ***  Programs to work fields                                        CEU007
      *                                                                   CEU007
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*                    M A I N
     C*****************************************************************
     C*
     C** KEY TO ACCESS LOAN TYPE/SUBTYPE EXTENDED FILE
     C           KEYTST    KLIST
     C                     KFLD           LTYP
     C                     KFLD           SUTP
     C                     KFLD           CLAS                                                CLE042
     C*
     C                     EXSR #INIT
     C*
     C*********************READ CLOANCL2                 30               ER0337
     C           ULX046    IFNE 'Y'                                       ULX046
     C**********           READ CLOANC                   30                            ER0337 CER001
     C                     READ LECLNXL0                 30                                   CER001
     C                     ELSE                                           ULX046
     C                     READ ERLOANL0                 30               ULX046
     C                     ENDIF                                          ULX046
     C*
     C** MAIN PROCESSING
     C           *IN30     DOWEQ'0'                        - B1
     C*
     C                     EXSR P003
     C*
     C*********************READ CLOANCL2                 30               ER0337
     C           ULX046    IFNE 'Y'                                       ULX046
     C**********           READ CLOANC                   30                            ER0337 CER001
     C                     READ LECLNXL0                 30                                   CER001
     C                     ELSE                                           ULX046
     C                     READ ERLOANL0                 30               ULX046
     C                     ENDIF                                          ULX046
     C*
     C                     END                             - E1
     C*
     C** TERMINATION PROCESSING
     C                     WRITEDETAIL                                    ER0136
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C**************************************************************************
     C* P003 - DETAIL PROCESSING SUB-ROUTINE
     C**************************************************************************
     C*
     C           P003      BEGSR
     C*
     C** IF MATURITY DATE EQUAL 0
     C***********MDAT      IFEQ *ZEROS                     - B1           ER0343
     C*********************MOVE *ZEROS    ABMDAT  80                      ER0343
     C*********************ELSE                            - X1           ER0343
     C*                                                                   ER0343
     C           PTYP      IFEQ 61                         - B1           ER0343
     C           PTYP      OREQ 68                                        ULX004
     C           PTYP      OREQ 69                                        ULX004
     C           EREOMD    ADD  1         @@DAYN                          ER0343
     C                     ELSE                            - X1           ER0343
     C*                                                                   ER0343
     C           EREOMD    IFLT MDAT                       - B2           ER0343
     C           ULX046    OREQ 'Y'                                       ULX046
     C           RECI      ANDEQ'M'                                       ULX046
     C                     Z-ADDMDAT      @@DAYN                          ER0343
     C                     ELSE                            - X2           ER0343
     C           EREOMD    ADD  1         @@DAYN                          ER0343
     C                     END                             - E2           ER0343
     C*                                                                   ER0343
     C                     END                             - E1           ER0343
     C*
     C*********************Z-ADDMDAT      @@DAYN  50                      ER0343
     C                     EXSR ZDATE9
     C*********************Z-ADD@@VDT     ABMDAT                          ER0343
     C                     Z-ADD@@VDT     ABMDAT  80                      ER0343
     C*********************END                             - E1           ER0343
     C*
     C** GENERAL TEST FOR RECORD ACCEPTANCE
     C***********BJRDNB    IFGE VDAT                       - B1           ER0317
     C***********BJRDNB    ANDLTMDAT                                      ER0317
     C***********BJRDNB    ORGE VDAT                                      ER0317
     C***********EREOMD    IFGE VDAT                       - B1    ER0317 ER0324
     C           EREOMD    IFGE DDAT                       - B1           ER0324
     C           CPAM      ANDNE0                                         ER0320
     C           RECI      ANDNE'M'                                       EMFIX
     C***********EREOMD    ANDLTMDAT                               ER0317 ER0320
     C***********EREOMD    ORGE VDAT                               ER0317 ER0320
     C***********MDAT      ANDEQ*ZEROS                                    ER0320
     C           ULX046    OREQ 'Y'                                       ULX046
     C           RECI      ANDEQ'M'                                       ULX046
     C           VDAT      ANDGEWWFDOM                                    ULX046
     C           CPAM      ANDNE0                                         ULX046
      *                                                                   ULX046
     C           RECI      IFEQ 'M'                                       ULX046
     C                     MOVEL'MATURE'  WWLNST  7        LOAN STATUS    ULX046
     C                     ELSE                                           ULX046
     C                     MOVEL'LIVE'    WWLNST  7 P      LOAN STATUS    ULX046
     C                     ENDIF                                          ULX046
      *
     C** OLD BRANCH FIELD IS NOT EQUAL TO NEW BRANCH FIELD
     C           BRCA      IFNE WWBRCD                     - B2           ULX004
     C** STORE NEW BRANCH IN OLD BRANCH
     C                     MOVE BRCA      WWBRCD  3                       ULX004
     C*
     C***********          MOVE BRCD      AABRCD  3                       ER_R10
     C                     MOVE BRCA      AABRCD  3                       ULX004
     C*
     C           AABRCD    CHAINSDBRCHL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'001'     DBASE            *****************
     C                     MOVEL'SDBRCHL1'DBFILE           ** DB ERROR 01 **
     C                     MOVELAABRCD    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
      *                                                                   ULX004
      ***  ULX004 : Save Internal branch customer A8BICN                  ULX004
      *                                                                   ULX004
     C                     MOVE A8BICN    SVBICN  6                       ULX004
     C*
     C** ACCESS CUSTOMER DETAILS FILE
     C           A8BICN    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'002'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 02 **
     C                     MOVELA8BICN    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    WWORCC  2
     C                     END                             - E2
     C*
     C** TRANSFORM VALUE DATE FROM MIDAS FORMAT TO ABACUS FORMAT
     C           PTYP      IFEQ 61                         - B1           80849
     C           EREOMD    ANDGEVDAT                                      80849
     C           PTYP      OREQ 68                                        ULX004
     C           EREOMD    ANDGEVDAT                                      ULX004
     C           PTYP      OREQ 69                                        ULX004
     C           EREOMD    ANDGEVDAT                                      ULX004
     C                     Z-ADDEREOMD    @@DAYN                          80849
     C                     ELSE                                           80849
     C                     Z-ADDVDAT      @@DAYN
     C                     END                                            80849
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     ABVDAT  80
      *                                                                   ULX004
      ** TRANSFORM VALUE DATE FROM MIDAS FORMAT TO ABACUS FORMAT          ULX004
     C                     Z-ADDVDAT      @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     WWVDAT  80                      ULX004
     C*                                                                   ER0324
     C** TRANSFORM DEAL DATE FROM MIDAS FORMAT TO ABACUS FORMAT           ER0324
     C                     Z-ADDDDAT      @@DAYN                          ER0324
     C                     EXSR ZDATE9                                    ER0324
     C                     Z-ADD@@VDT     ABDDAT  80                      ER0324
     C*
     C** TRANSFORM ROLLOVER DATE FROM MIDAS FORMAT TO ABACUS FORMAT
     C                     Z-ADDRLDT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     ABRLDT  80
     C*                                                                   ER0330
     C** IF PARTICIPATION SOLD TAKE CUSTOMER NUMBER OF PARTICIPATION      ER0330
     C** OR ORIGINAL BORROWER IF ANY (PARTICIPATION PURCHASED SOLD)       57071
     C           PTYP      IFEQ 66                         - B2           ER0330
     C           PTYP      OREQ 67                                        ER0330
     C           PTYP      OREQ 69                                        ULX004
     C           PTYP      OREQ 72                                        ULX004
     C********** OLNO      CHAINERPARTL0             88                               ER0330 CSD027A
     C**********           MOVE OLNO      OLNOA                                       CSD027A CLE148
     C********** OLNON     CHAINERPARTL0             88                               CSD027A CLE148
     C           OLNO      CHAINERPARTL0             88                               CSD027A CLE148
     C           *IN88     IFEQ '0'                                       57071
     C********** OLNO      ANDNE*ZEROS                                                 57071 CSD027A
     C**********           Z-ADDOLNO      CNUM                                         57071 CSD027A
     C           OLNO      ANDNE*BLANKS                                                      CSD027A
     C           OLNO      ANDNE'000000'                                                    BUG11611
     C                     MOVE OLNO      CNUM                                               CSD027A
     C                     END                                            57071
     C                     END                             - E2           ER0330
     C*
     C** ACCESS CUSTOMER DETAILS WITH CUSTOMER NUMBER
     C                     MOVE CNUM      AACNUM  6
     C** FOR PARTICIPATIONS PURCHASED, USE ORIGINAL BORROWER              ER0341
     C           PTYP      IFEQ 64                                        ER0341
     C           PTYP      OREQ 65                                        ER0341
     C           PTYP      OREQ 68                                        ULX004
     C           PTYP      OREQ 71                                        ULX004
     C                     MOVE OLNO      AACNUM                          ER0341
     C                     END                                            ER0341
     C*                                                                   ERL428
     C** ACCESS SECURITIES CUSTOMER DETAILS FILE                          ERL428
     C           AACNUM    CHAINSDSECSL1             88                   ERL428
     C*                                                                   ERL428
     C** Store Customer classification                                    ERL428
     C           *IN88     IFEQ '0'                        - B2           ERL428
     C                     MOVE BFCLAS    EXCLAS                          ERL428
      *                                                                   ULX004
      ***  ULX004 : Store Pledge agreement                                ULX004
      *                                                                   ULX004
     C                     MOVE BFPLAG    EXPLAG                          ULX004
     C                     END                             - E2           ERL428
     C*                                                                   ERL428
     C** ACCESS CUSTOMER DETAILS                                          ERL428
     C           AACNUM    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'003'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 03 **
     C                     MOVELAACNUM    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*                                                                   ER0205
     C** STORE Bank/non-Bank Indicator                                    ER0205
     C                     MOVE BBBNBI    EXBNBI                          ER0205
     C*
     C** STORE CUSTOMER NUMBER
     C                     MOVE BBCUST    EXCUST
      *                                                                   ULX004
      ***  ULX004 : Store counterparty type                               ULX004
      *                                                                   ULX004
     C** NOW MAINTAINED ON A WINDOW                                       ART021
     C*********************MOVE BBBFIC    EXCTPY                   ULX004 ART021
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    EXCUCC
     C*
     C** STORE CUSTOMER SHORTNAME
     C                     MOVE BBCSSN    EXCSSN
     C*
     C** STORE CUSTOMER REPORT NAME
     C                     MOVE BBCRNM    EXCRNM
     C*                                                                   ER0321
     C** STORE COUNTRY OF CITIEZNSHIP                                     ER0321
     C                     MOVE BBCNCZ    EXCNCZ                          ER0321
      *                                                                   ULX004
      ***  Branch/subsidiary indicator                                    ULX004
      *                                                                   ULX004
     C                     MOVE BBBSIN    EXBSIN                          ULX004
      *                                                                   ULX004
      ***  Book Code                                                      ULX004
      *                                                                   ULX004
     C                     MOVE BOKC      EXBKCD                          ULX004
      *
     C*
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK
     C           BBPCNB    IFNE *BLANKS                    - B2
     C*
     C           BBPCNB    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'004'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 04 **
     C                     MOVELBBPCNB    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE
     C                     MOVE BBCUST    EXPCNB
     C                     MOVE BBCOLC    EXPRCC
     C                     ELSE                            - X2
     C*
     C** ELSE RESET FIELDS
     C                     MOVE *BLANKS   EXPCNB
     C                     MOVE *BLANKS   EXPRCC
     C                     END                             - E2
     C*
     C** IF BASE RATE CODE IS EQUAL TO BLANK
     C********** BRTT      IFEQ *ZEROS                     - B2                               CSD103
     C           BRTT      IFEQ *BLANKS                    - B2                               CSD103
     C           RLDT      ANDEQ*ZEROS                                    ER0310
     C                     Z-ADD1         EXIRTT
     C                     ELSE                            - X2
     C                     Z-ADD2         EXIRTT
     C                     END                             - E2
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'LEN'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LECL'    EXRIND
     C*
     C** GET PARTICIPATION PURCHASED INFORMATIONS
     C           PTYP      IFEQ 64
     C           PTYP      OREQ 65
     C           PTYP      OREQ 68                                        ULX004
     C           PTYP      OREQ 71                                        ULX004
     C                     EXSR P007
     C                     END
     C*
     C** GET PARTICIPATION SOLD INFORMATIONS
     C           PTYP      IFEQ 66
     C           PTYP      OREQ 67
     C           PTYP      OREQ 69                                        ULX004
     C           PTYP      OREQ 72                                        ULX004
     C                     EXSR P008
     C                     END
     C*
     C** STORE AMOUNT IN CURRENCY
     C           CPAM      IFLT 0                          - B2
     C                     Z-SUBCPAM      CPAM
     C                     END                             - E2
     C*
     C           PTYP      IFEQ 63                         - B2           ER0329
     C***********PTYP      OREQ 66                                 ER0329 CAD006
     C           PTYP      OREQ 65                                        CAD006
     C           PTYP      OREQ 67                                        ER0329
     C                     SUB  TOTI      CPAM                            ER0329
     C                     END                             - E2           ER0329
     C*
     C           CCY       CHAINSDCURRL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'005'     DBASE            *****************
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 05 **
     C                     MOVELCCY       DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C           A6NBDP    IFEQ 0                          - B2
     C           CPAM      MULT 1000      EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 1                          - B2
     C           CPAM      MULT 100       EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 2                          - B2
     C           CPAM      MULT 10        EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 3                          - B2
     C                     Z-ADDCPAM      EXAMNT
     C                     END                             - E2
      *
      ** STORE PARTICIPATION SOLD AMOUNT IN 'MARGIN AMOUNT'               ERL446
     C           A6NBDP    IFEQ 0                          - B2           ERL446
     C           PSAM      MULT 1000      EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 1                          - B2           ERL446
     C           PSAM      MULT 100       EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 2                          - B2           ERL446
     C           PSAM      MULT 10        EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 3                          - B2           ERL446
     C                     Z-ADDPSAM      EXMARA                          ERL446
     C                     END                             - E2           ERL446
      *
     C           PTYP      IFEQ 63                         Discount Loan  ER1012
     C           PTYP      OREQ 65                         Disc.Part.Purc.ER1012
     C           PTYP      OREQ 67                         Disc.Part.Sold ER1012
     C                     Z-ADDEXAMNT    EXNOMA                          ER1012
     C                     ELSE                                           ER1012
     C                     Z-ADD*ZEROS    EXNOMA                          ER1012
     C                     END                                            ER1012
      *                                                                   ULX004
      ***  Original Principal amount                                      ULX004
      *                                                                   ULX004
     C           ULX046    IFNE 'Y'                                       ULX046
     C           LNRF      CHAINCLOANK               88                   ULX004
     C                     ELSE                                           ULX046
     C           LNRF      CHAINERLOAKL0             88                   ULX046
     C                     ENDIF                                          ULX046
     C           *IN88     IFEQ *ON                        - B2           ULX004
     C                     MOVEL'030'     DBASE            ***************ULX004
     C           ULX046    IFNE 'Y'                                       ULX046
     C                     MOVEL'CLOANK  'DBFILE           ** DB ERROR 30 ULX004
     C                     ELSE                                           ULX046
     C                     MOVEL'ERLOAKL0'DBFILE           ** DB ERROR 30 ULX046
     C                     ENDIF                                          ULX046
     C                     MOVELLNRF      DBKEY            ***************ULX004
     C                     EXSR *PSSR                                     ULX004
     C                     ENDIF                           - E2           ULX004
      *
     C           A6NBDP    IFEQ 0                          - B2           ULX004
     C           OPAM      MULT 1000      EXOPAM                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 1                          - B2           ULX004
     C           OPAM      MULT 100       EXOPAM                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 2                          - B2           ULX004
     C           OPAM      MULT 10        EXOPAM                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 3                          - B2           ULX004
     C                     Z-ADDOPAM      EXOPAM                          ULX004
     C                     ENDIF                           - E2           ULX004
      *                                                                   ULX004
      ***  Total Interest                                                 ULX004
      *                                                                   ULX004
     C           A6NBDP    IFEQ 0                          - B2           ULX004
     C           TOTI      MULT 1000      EXTOTI                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 1                          - B2           ULX004
     C           TOTI      MULT 100       EXTOTI                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 2                          - B2           ULX004
     C           TOTI      MULT 10        EXTOTI                          ULX004
     C                     ENDIF                           - E2           ULX004
     C           A6NBDP    IFEQ 3                          - B2           ULX004
     C                     Z-ADDTOTI      EXTOTI                          ULX004
     C                     ENDIF                           - E2           ULX004
     C                     EXSR SRCRET                                    ER0336
      *
      ***  Store Branch Internal Customer Number
      *
     C                     MOVE SVBICN    EXBICN                          ULX004
      *
     C** WRITE RECORD IN OUTPUT FILE
     C                     EXSR W001
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C**************************************************************************
     C* P007 - SUBROUTINE TO GET PARTICIPATION PURCHASED INFORMATIONS          *
     C**************************************************************************
     C*
     C           P007      BEGSR
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'PPU'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LEPP'    EXRIND
     C*
     C** STORE DEBIT/CREDIT INDICATOR
     C                     Z-ADD0         EXDRCR
     C*
     C                     ENDSR
     C**************************************************************************
     C* P008 - SUBROUTINE TO GET PARTICIPATION SOLD INFORMATIONS               *
     C**************************************************************************
     C*
     C           P008      BEGSR
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'PSO'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LEPS'    EXRIND
     C*
     C** STORE DEBIT/CREDIT INDICATOR
     C                     Z-ADD1         EXDRCR
     C*
     C** RESET FACILITY CUSTOMER, NUMBER AND SEQUENCE IF PARTICIPATION SOLD
     C**********           Z-ADD0         FCUS                                               CSD027A
     C                     MOVE *BLANKS   FCUS                                               CSD027A
     C                     Z-ADD0         FTYP
     C                     Z-ADD0         FSEQ
     C*
     C                     ENDSR
     C**************************************************************************
     C* W001 - SUBROUTINE TO WRITE A RECORD IN EREXTRPD OUTPUT FILE
     C**************************************************************************
     C*
     C           W001      BEGSR
     C*
     C                     Z-ADD001       EXRECT
     C                     Z-ADDWWREPD    EXREPD
     C***********          MOVE BRCD      EXBRCD                          ER_R10
     C                     MOVE BRCA      EXBRCD                          ULX004
     C                     MOVELLNRF      EXTREF
     C                     MOVEL*BLANK    OFLD                                                CLE042
     C                     MOVELTSTYPE    EXDECK
     C                     MOVE CCY       EXCCYC
     C                     MOVE WWORCC    EXORCC
     C                     MOVE RCSI      EXRCSI
     C           EREOMD    IFLT VDAT                       - B1           ER0324
     C                     Z-ADDABDDAT    EXSTRD                          ER0324
     C                     Z-ADDABVDAT    EXENDD                          ER0324
      *                                                                   CEU007
      ***  If the feature CEU007 is installed, filling the new fields     CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  CCY from PF/CLOANC                                             CEU007
      ***  BJSLCD from PF/SDBANKPD                                        CEU007
      *                                                                   CEU007
     C                     MOVELCCY       EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXSDLO           St.Dat.Sett.LocCEU007
     C                     MOVELCCY       EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXRDLO           Re.Dat.Sett.LocCEU007
     C                     MOVELCCY       EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency                                                       CEU007
      *                                                                   CEU007
     C           SCCY      IFEQ *BLANKS                    B2             CEU007
     C                     MOVELCCY       UUCYCD                          CEU007
     C                     ELSE                            X2             CEU007
     C                     MOVELSCCY      UUCYCD                          CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PPU' or'LEN' (Payment)                CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PPU'                      B2             CEU007
     C           EXLOTD    OREQ 'LEN'                                     CEU007
      *                                                                   CEU007
     C           PSTM      IFEQ 1                          B3             CEU007
     C           PSTM      OREQ 2                                         CEU007
     C           PSTM      OREQ 7                                         CEU007
     C           PSTM      OREQ 8                                         CEU007
     C           PSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELPONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PSO' (Receipt)                        CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PSO'                      B2             CEU007
      *                                                                   CEU007
     C           RSTM      IFEQ 1                          B3             CEU007
     C           RSTM      OREQ 2                                         CEU007
     C           RSTM      OREQ 7                                         CEU007
     C           RSTM      OREQ 8                                         CEU007
     C           RSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELRONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     MOVELTSTYPE    OODECK  5                       ER0324
     C                     MOVE 'O'       OODECK                          ER0324
     C                     MOVELOODECK    EXDECK                          ER0324
     C                     ELSE                            - X1           ER0324
     C                     Z-ADDABVDAT    EXSTRD
     C                     Z-ADDABMDAT    EXENDD
      *                                                                   CEU007
      ***  If the feature CEU007 is installed, filling the new fields     CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  CCY from PF/CLOANC                                             CEU007
      ***  BJSLCD from PF/SDBANKPD                                        CEU007
      *                                                                   CEU007
     C                     MOVELCCY       EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXSDLO           St.Dat.Sett.LocCEU007
     C                     MOVELCCY       EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXRDLO           Re.Dat.Sett.LocCEU007
     C                     MOVELCCY       EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency                                                       CEU007
      *                                                                   CEU007
     C           SCCY      IFEQ *BLANKS                    B2             CEU007
     C                     MOVELCCY       UUCYCD                          CEU007
     C                     ELSE                            X2             CEU007
     C                     MOVELSCCY      UUCYCD                          CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PPU' or'LEN' (Payment)                CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PPU'                      B2             CEU007
     C           EXLOTD    OREQ 'LEN'                                     CEU007
      *                                                                   CEU007
     C           PSTM      IFEQ 1                          B3             CEU007
     C           PSTM      OREQ 2                                         CEU007
     C           PSTM      OREQ 7                                         CEU007
     C           PSTM      OREQ 8                                         CEU007
     C           PSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELPONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXSDLO           St.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PSO' (Receipt)                        CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PSO'                      B2             CEU007
      *                                                                   CEU007
     C           RSTM      IFEQ 1                          B3             CEU007
     C           RSTM      OREQ 2                                         CEU007
     C           RSTM      OREQ 7                                         CEU007
     C           RSTM      OREQ 8                                         CEU007
     C           RSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELRONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXSDLO           St.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PPU' or'LEN' (Receipt)                CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PPU'                      B2             CEU007
     C           EXLOTD    OREQ 'LEN'                                     CEU007
      *                                                                   CEU007
     C           RSTM      IFEQ 1                          B3             CEU007
     C           RSTM      OREQ 2                                         CEU007
     C           RSTM      OREQ 7                                         CEU007
     C           RSTM      OREQ 8                                         CEU007
     C           RSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELRONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PSO' (Payment)                        CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PSO'                      B2             CEU007
      *                                                                   CEU007
     C           PSTM      IFEQ 1                          B3             CEU007
     C           PSTM      OREQ 2                                         CEU007
     C           PSTM      OREQ 7                                         CEU007
     C           PSTM      OREQ 8                                         CEU007
     C           PSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELPONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     END                             - E1           ER0324
     C           ABRLDT    IFNE *ZEROS                                    054791
     C                     Z-ADDABRLDT    EXREVD
     C                     ELSE                                           054791
     C                     Z-ADDABMDAT    EXREVD                          054791
     C                     END                                            054791
      *                                                                   CEU007
      ***  If the feature CEU007 is installed, filling the new fields     CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency                                                       CEU007
      *                                                                   CEU007
     C           SCCY      IFEQ *BLANKS                    B2             CEU007
     C                     MOVELCCY       UUCYCD                          CEU007
     C                     ELSE                            X2             CEU007
     C                     MOVELSCCY      UUCYCD                          CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PPU' or'LEN' (Receipt)                CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PPU'                      B2             CEU007
     C           EXLOTD    OREQ 'LEN'                                     CEU007
      *                                                                   CEU007
     C           RSTM      IFEQ 1                          B3             CEU007
     C           RSTM      OREQ 2                                         CEU007
     C           RSTM      OREQ 7                                         CEU007
     C           RSTM      OREQ 8                                         CEU007
     C           RSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELRONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      *** If it's a lot descriptor 'PSO' (Payment)                        CEU007
      *                                                                   CEU007
     C           EXLOTD    IFEQ 'PSO'                      B2             CEU007
      *                                                                   CEU007
     C           PSTM      IFEQ 1                          B3             CEU007
     C           PSTM      OREQ 2                                         CEU007
     C           PSTM      OREQ 7                                         CEU007
     C           PSTM      OREQ 8                                         CEU007
     C           PSTM      OREQ 12                                        CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD                                                CEU007
      *                                                                   CEU007
     C                     MOVELPONS      UUNONB                          CEU007
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Check if the 3 last digits from Nostro Shortname is valid.     CEU007
      ***  via the access object.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:Return Cd    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:Option       CEU007
     C                     PARM           P@LCCD  3        I:Key field    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B4             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVE A7NOSN    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E4             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     MOVE FCUS      EXFCUS
     C                     Z-ADDFTYP      EXFACT
     C                     Z-ADDFSEQ      EXFCNO
     C*                                                                   ULX004
     C** Accrued Interest and Interest to accrue                          ULX004
     C           LNRF      CHAINLEACXAL3             88                   ULX004
     C           *IN88     IFEQ '1'                        - B1           ULX004
     C                     Z-ADD*ZEROS    EXACCR                          ULX004
     C                     Z-ADD*ZEROS    EXITAC                          ULX004
     C                     ELSE                            - X1           ULX004
     C*                                                                   ULX004
     C           A6NBDP    IFEQ 0                          - B2           ULX004
     C           AMAD      MULT 1000      EXACCR                          ULX004
     C           AMTA      MULT 1000      EXITAC                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 1                          - B2           ULX004
     C           AMAD      MULT 100       EXACCR                          ULX004
     C           AMTA      MULT 100       EXITAC                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 2                          - B2           ULX004
     C           AMAD      MULT 10        EXACCR                          ULX004
     C           AMTA      MULT 10        EXITAC                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 3                          - B2           ULX004
     C                     Z-ADDAMAD      EXACCR                          ULX004
     C                     Z-ADDAMTA      EXITAC                          ULX004
     C                     END                             - E2           ULX004
     C                     END                             - E1           ULX004
     C*                                                                   ULX004
     C** Start/Last Interest Date                                         ULX004
     C                     Z-ADDSLID      @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXSLID                          ULX004
     C*                                                                   ULX004
     C** Next Interest Due Date                                           ULX004
     C                     Z-ADDNIDT      @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXNIDT                          ULX004
     C*                                                                   ULX004
     C** Retail Indicators                                                ULX004
     C                     MOVE *BLANKS   EXRETB                          ULX004
     C*                                                                   194921
     C** Market Values                                                    194921
     C                     Z-ADDEXAMNT    EXNPVA                          194921
     C                     Z-ADDEXAMNT    EXMKT1                          194921
     C*                                                                   194921
     C** Coupon Rate                                                      194921
     C                     Z-ADDINTR      EXCPNR                          194921
     C*                                                                   194921
     C** Long/short position indicator 1                                  194921
     C           EXDRCR    IFEQ 0                                         194921
     C                     Z-ADD1         EXLSP1                          194921
     C                     ELSE                                           194921
     C                     Z-ADD2         EXLSP1                          194921
     C                     ENDIF                                          194921
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
      ** If the loan is matured, reset fields                             ULX046
      *                                                                   ULX046
     C           WWLNST    IFEQ 'MATURE'                                  ULX046
     C****                 Z-ADDEXREVD    EXENDD                          ULX046
     C                     Z-ADD*ZEROS    EXNIDT                          ULX046
     C                     Z-ADD*ZEROS    EXAMNT                          ULX046
     C                     Z-ADD*ZEROS    EXNOMA                          ULX046
     C                     Z-ADD*ZEROS    EXNPVA                          ULX046
     C                     Z-ADD*ZEROS    EXMKT1                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C           EXLOTD    IFEQ 'LEN'                      Customer loan  ULX046
     C           EXLOTD    OREQ 'PPU'                      Partic. Purch. ULX046
      *                                                                   ULX046
      ** New Deposit/Credit Indicator                                     ULX046
      *                                                                   ULX046
     C           ABVDAT    IFGE WWFDTM                     Value Date     ULX046
     C                     Z-ADD1         EXNWDC                          ULX046
     C                     ELSE                                           ULX046
     C                     Z-ADD2         EXNWDC                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Interest Rate Starting Date                                      ULX046
      *                                                                   ULX046
     C           EXIRTT    IFEQ 1                                         ULX046
     C                     Z-ADDEXSTRD    EXIRSD                          ULX046
     C                     ELSE                                           ULX046
     C                     Z-ADD*ZEROS    EXIRSD                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Interest Rate Ending Date                                        ULX046
      *                                                                   ULX046
     C           EXIRTT    IFEQ 1                                         ULX046
     C                     Z-ADDEXENDD    EXIRED                          ULX046
     C                     ELSE                                           ULX046
     C                     Z-ADD*ZEROS    EXIRED                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Annual Interest Rate                                             ULX046
      *                                                                   ULX046
     C           INTR      DIV  100       EXANIR    H                     ULX046
      *                                                                   ULX046
      ** Number Of Capitalisation/Reimbursements Periods                  ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXNCAP                          ULX046
     C                     Z-ADD1         WINDX   20                      ULX046
     C           RFRQ      LOKUPTFRQ,WINDX               99               ULX046
     C   99                Z-ADDTFVL,WINDXEXNCAP                          ULX046
      *                                                                   ULX046
      ** Net Credit Amount In Original Currency                           ULX046
      *                                                                   ULX046
     C                     Z-ADDEXOPAM    EXNCRA                          ULX046
      *                                                                   ULX046
      ** Unique Contract Reference                                        ULX046
      *                                                                   ULX046
     C           EXRIND    CAT  EXTREF:1  EXCTRF                          ULX046
      *                                                                   ULX046
      ** Total Transaction Amount                                         ULX046
      *                                                                   ULX046
     C                     SELEC                                          ULX046
     C           A6NBDP    WHEQ 0                                         ULX046
     C           CPAM      MULT 1000      EXTOTA                          ULX046
     C           A6NBDP    WHEQ 1                                         ULX046
     C           CPAM      MULT 100       EXTOTA                          ULX046
     C           A6NBDP    WHEQ 2                                         ULX046
     C           CPAM      MULT 10        EXTOTA                          ULX046
     C           A6NBDP    WHEQ 3                                         ULX046
     C                     Z-ADDCPAM      EXTOTA                          ULX046
     C                     OTHER                                          ULX046
     C                     Z-ADD*ZEROS    EXTOTA                          ULX046
     C                     ENDSL                                          ULX046
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Save values before repayments processing                         ULX046
      *                                                                   ULX046
     C*********************Z-ADDEXIRSD    WWIRSD                   ULX046 217813
     C*********************Z-ADDEXIRED    WWIRED                   ULX046 217813
     C*********************Z-ADDEXNCRA    WWNCRA                   ULX046 217813
     C                     MOVELEXCTRF    WWCTRF    P                     ULX046
     C                     Z-ADDEXTOTA    WWTOTA                          ULX046
     C*********************Z-ADDEXNWDC    WWNWDC                   214603 217813
     C*********************Z-ADDEXANIR    WWANIR                   214603 217813
     C*********************Z-ADDEXNCAP    WWNCAP                   214603 217813
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
     C*                                                                   ULX004
     C** Save values before repayments processing                         ULX004
     C                     Z-ADDEXACCR    WWACCR 160                      ULX004
     C                     Z-ADDEXITAC    WWITAC 160                      ULX004
     C                     Z-ADDEXSLID    WWSLID  80                      ULX004
     C                     Z-ADDEXNIDT    WWNIDT  80                      ULX004
     C                     MOVE EXRETB    WWRETB  1                       ULX004
     C                     Z-ADDPTYP      EXPTYP                          ERL417
     C*                                                                   ERL416
     C** REPAYMENTS MANAGEMENT                                            ERL416
     C                     MOVE 'N'       REPIND  1                       ERL416
     C*                                                                   ERL416
     C**    SAVE VALUES AFTER REPAYMENTS PROCESSING                       ERL416
     C                     Z-ADDEXAMNT    WWAMNT 160                      ERL416
     C                     Z-ADDEXNPVA    WWNPVA 160                      ULX047
     C                     Z-ADDEXENDD    WWENDD  80                      ERL416
     C                     Z-ADDEXREVD    WWREVD  80                      212867
     C                     Z-ADDEXENDD    EXQINC                          107142
     C                     Z-ADDEXDRCR    WWDRCR  10                      085053
     C*                                                                   ERL416
     C                     EXSR REPAY                                     ERL416
     C*                                                                   ERL416
     C**    RESTORE VALUES AFTER REPAYMENTS PROCESSING                    ERL416
     C                     Z-ADDWWAMNT    EXAMNT                          ERL416
     C                     Z-ADDWWNPVA    EXNPVA                          ULX047
     C                     Z-ADDWWENDD    EXENDD                          ERL416
     C                     Z-ADDWWREVD    EXREVD                          212867
     C                     Z-ADDWWDRCR    EXDRCR                          085053
     C                     Z-ADDWWACCR    EXACCR                          ULX004
     C                     Z-ADDWWITAC    EXITAC                          ULX004
     C                     Z-ADDWWSLID    EXSLID                          ULX004
     C                     Z-ADDWWNIDT    EXNIDT                          ULX004
     C                     MOVE WWRETB    EXRETB                          ULX004
     C*                                                                   ERL416
     C           REPIND    IFEQ 'Y'                                       ERL416
     C                     MOVE 'REX'     EXTREF                          ERL416
     C                     END                                            ERL416
     C*                                                                   ERL458
     C***********          MOVE '1'       DSFREP                    ERL458ULX004
     C                     Z-ADD1         EXFREP                          ULX004
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
      ** Restore values after repayments processing                       ULX046
      *                                                                   ULX046
     C*********************Z-ADDWWIRSD    EXIRSD                   ULX046 217813
     C*********************Z-ADDWWIRED    EXIRED                   ULX046 217813
     C*********************Z-ADDWWNCRA    EXNCRA                   ULX046 217813
     C                     MOVELWWCTRF    EXCTRF    P                     ULX046
     C                     Z-ADDWWTOTA    EXTOTA                          ULX046
     C*********************Z-ADDWWNWDC    EXNWDC                   214603 217813
     C*********************Z-ADDWWANIR    EXANIR                   214603 217813
     C*********************Z-ADDWWNCAP    EXNCAP                   214603 217813
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
     C*                                                                   ER0136
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0136
     C                     ADD  1         NREC    30                      ER0136
     C*
     C** WRITE A RECORD
     C                     WRITEEREXTRF0
     C*
     C** RESET FILE RECORD FORMAT
     C                     RESETEREXTRF0
     C*
     C                     ENDSR
     C********************************************************************ER0336
     C* SRCRET - SUBROUTINE TO SETUP CREDIT TYPE FIELD                    ER0336
     C********************************************************************ER0336
     C*                                                                   ER0336
     C           SRCRET    BEGSR                                          ER0336
     C*                                                                   ER0336
     C                     Z-ADD0         EXCRET                          ER0336
     C                     MOVE 'N'       PASDUE  1                       ER0402
     C*                                                                   ER0336
     C**********           MOVE *ZEROS    KEY6    60                                   ER0336 CLE148
     C**********           Z-ADDLNRF      KEY6                                         ER0336 CLE148
     C********** KEY6      SETLLLOAMS                                                  ER0336 CLE148
     C           LNRF      SETLLLOAMS                                                         CLE148
     C                     READ LOAMS                    66               ER0336
     C*                                                                   ER0336
     C           *IN66     DOWEQ'0'                        - B1           ER0336
     C           BQLNRF    ANDEQLNRF                                      ER0336
     C*                                                                   ER0336
     C           AMTP      IFEQ 'PD'                       - B2           ER0336
     C                     MOVE 'Y'       PASDUE                          ER0402
     C                     GOTO ENDRD                                     ER0402
     C*********************Z-ADD2         EXCRET                   ER0336 ER0402
     C*********************GOTO #9CRET                             ER0336 ER0402
     C                     END                             - E2           ER0336
     C*                                                                   ER0336
     C                     READ LOAMS                    66               ER0336
     C*                                                                   ER0336
     C                     END                             - E1           ER0336
     C*                                                                   ER0402
     C           ENDRD     TAG                                            ER0402
     C*                                                                   ER0336
     C                     Z-ADDWWREPD    BQDATE                          ER0336
     C                     Z-ADD1         J       20                      ER0336
     C           BQMONT    LOKUPCT1,J                    26               ER0336
     C                     Z-ADDCT2,J     BQMONT                          ER0336
     C                     Z-ADD1         BQDAY                           ER0336
     C*                                                                   ER0336
     C*********************]**PAST*DUE***]**NOT*PAST*DUE           ER0402 ULX004
     C**__________________*]____________*]_______________          ER0402 ULX004
     C*********************]*************]**************           ER0402 ULX004
     C***LAST*QUARTER******]******4******]******3*******           ER0402 ULX004
     C*********************]*************]**************           ER0402 ULX004
     C***NOT*LAST*QUARTER**]******2******]******1*******           ER0402 ULX004
     C*********************]*************]**************           ER0402 ULX004
     C*                                                                   ER0402
     C*********  ABVDAT    IFGE BQDATE                     - B1     ER0336ULX004
     C******     WWVDAT    IFGE BQDATE                     - B1    ULX004 ULX004
     C*                                                                   ER0402
     C***********PASDUE    IFEQ 'N'                                 ER0402ULX004
     C******               Z-ADD3         EXCRET                   ER0336 ULX004
     C***********          ELSE                                     ER0402ULX004
     C***********          Z-ADD4         EXCRET                    ER0402ULX004
     C***********          END                                      ER0402ULX004
      *                                                                   ER0402
     C******               ELSE                            - X1    ER0336 ULX004
      *                                                                   ER0402
     C                     Z-ADD1         EXCRET                          ULX004
      *                                                                   ULX004
     C***********PASDUE    IFEQ 'N'                                 ER0402ULX004
     C***********          Z-ADD1         EXCRET                    ER0336ULX004
     C***********          ELSE                                     ER0402ULX004
     C***********          Z-ADD2         EXCRET                    ER0402ULX004
     C***********          END                                      ER0402ULX004
      *                                                                   ER0402
     C***********          END                             - E1    ER0336 ULX004
      *
     C           PASDUE    IFEQ 'Y'                        - B1           ULX004
      *
     C           BQVDAT    IFLE WWPDDT                     - B2           ULX004
     C                     Z-ADD2         EXCRET                          ULX004
     C                     ENDIF                           - E2           ULX004
      *
     C                     ENDIF                           - E1           ULX004
      *
     C           #9CRET    TAG                                            ER0336
     C                     ENDSR                                          ER0336
     C********************************************************************ERL416
     C* REPAY - SUBROUTINE FOR REPAYMENTS MANAGEMENT                      ERL416
     C********************************************************************ERL416
     C*                                                                   ERL416
     C           REPAY     BEGSR                                          ERL416
     C*                                                                   ERL416
     C                     Z-ADD0         WWI2   130                      ERL416
     C                     Z-ADD0         WWV3   130                      163681
     C***********          Z-ADD0         WWREPN  30                ERL460ULX004
     C                     Z-ADD0         EXREPN                          ULX004
     C**********           Z-ADDLNRF      RELNRF  60                                   ERL416 CLE148
     C                     MOVELLNRF      RELNRF  6                                           CLE148
     C                     MOVE 'N'       WWTEST  1                       ULX004
     C***********          MOVE '2'       DSFREP                    ERL458ULX004
     C                     Z-ADD2         EXFREP                          ULX004
     C                     Z-ADD0         WWSEQN  50                      217813
     C*                                                                   ERL416
     C** CHECK PROCESSING TYPE FROM LOAN                                  ERL416
     C** REPAYMENTS ONLY MANAGED IF PARTICIPATION SOLD EQUAL 0            ERL446
     C           PTYP      IFEQ 61                         - B1           ERL416
     C           PSAM      ANDEQ0                                         ERL446
      *
     C           PTYP      OREQ 62                                        ERL416
     C           PSAM      ANDEQ0                                         ERL446
      *
     C           PTYP      OREQ 64                                        ERL416
     C           PSAM      ANDEQ0                                         ERL446
     C*                                                                   ERL416
     C           PTYP      OREQ 68                                        ULX004
     C           PSAM      ANDEQ0                                         ULX004
     C*                                                                   ULX004
     C           LNRF      SETLLERLVENL0                                  ERL416
     C                     READ ERLVENL0                 65               ERL416
     C*                                                                   ERL416
     C           *IN65     DOWEQ'0'                        - B2           ERL416
     C           LNRF      ANDEQRELNRF                                    ERL416
     C*                                                                   ERL416
     C           INTC      IFEQ 'Y'                        - B3           ERL416
     C***********ETYP2     ANDEQ'I2'                               ERL416 ERL463
     C           ETYP2     ANDEQ'X2'                                      ERL463
     C*********************Z-ADDEAMT      WWI2                     ERL416 CAD027
     C                     ADD  EAMT      WWI2                            CAD027
     C                     GOTO NEXT                                      ERL416
     C                     END                             - E3           ERL416
     C*                                                                   ERL416
     C           ETYP2     IFEQ 'V3'                                      163681
     C                     ADD  EAMT      WWV3                            163681
     C                     END                             - E3           163681
     C*                                                                   163681
     C           ETYP2     IFEQ 'I2'                                      ERL416
     C           ETYP2     OREQ 'X2'                                      ERL463
     C           ETYP2     OREQ 'V3'                                      163681
     C                     GOTO NEXT                                      ERL416
     C                     END                             - E3           ERL416
     C*                                                                   158312
     C           IBRE      IFEQ 'Y'                                       158312
     C                     GOTO NEXT                                      158312
     C                     END                             - E3           158312
     C*                                                                   141660
     C           ETYP1     IFNE '61'                                      141660
     C           ETYP2     ANDEQ'R1'                                      141660
     C           EDAT      ANDLEEREOMD                                    141660
     C                     GOTO NEXT                                      141660
     C                     END                                            141660
     C*****************                                            ERL416 187607
     C***SETUP*END*DATE                                            ERL416 187607
     C***********ETYP1     IFEQ '61'                       - B3    ERL416 187607
     C***********ETYP2     OREQ 'D1'                               ERL416 187607
     C***********EREOMD    ADD  1         @@DAYN                   ERL416 187607
     C***********          ELSE                            - X3    ERL416 187607
     C***********          Z-ADDEDAT      @@DAYN                   ERL416 187607
     C***********          END                             - E3    ERL416 187607
     C***********          EXSR ZDATE9                             ERL416 187607
     C***********          Z-ADD@@VDT     EXENDD                   ERL416 187607
     C*                                                                   CG0001
     C*  SETUP END DATE                                                   CG0001
     C           ETYP1     IFEQ '61'                       - B3           CG0001
     C           ETYP2     OREQ 'D1'                                      CG0001
     C           EREOMD    ADD  1         @@DAYN                          CG0001
     C                     ELSE                            - X3           CG0001
     C                     Z-ADDEDAT      @@DAYN                          CG0001
     C                     END                             - E3           CG0001
     C                     EXSR ZDATE9                                    CG0001
     C                     Z-ADD@@VDT     EXENDD                          CG0001
     C*                                                                   ERL416
     C***SETUP*EVENT*AMOUNT                                        ERL416 163681
     C***********EAMT      IFLT 0                          - B3    ERL416 163681
     C***********          Z-SUBEAMT      EAMT                     ERL416 163681
     C***********          Z-ADD1         EXDRCR                   085053 163681
     C***********          ELSE                                    085053 163681
     C***********          Z-ADD0         EXDRCR                   085053 163681
     C***********          END                             - E3    ERL416 163681
     C*                                                                   ERL416
     C           ETYP2     IFEQ 'M1'                       - B3           ERL416
     C           EAMT      SUB  WWI2      EAMT                            ERL416
     C                     SUB  WWV3      EAMT                            163681
     C                     END                             - E3           ERL416
     C*                                                                   163681
     C** SETUP EVENT AMOUNT                                               163681
     C           EAMT      IFLT 0                          - B3           163681
     C                     Z-SUBEAMT      EAMT                            163681
     C                     Z-ADD1         EXDRCR                          163681
     C                     ELSE                                           163681
     C                     Z-ADD0         EXDRCR                          163681
     C                     END                             - E3           163681
     C*                                                                   212867
     C                     Z-ADDEXENDD    EXREVD                          212867
     C*                                                                   ERL416
     C           A6NBDP    IFEQ 0                          - B3           ERL416
     C           EAMT      MULT 1000      EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 1                          - B3           ERL416
     C           EAMT      MULT 100       EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 2                          - B3           ERL416
     C           EAMT      MULT 10        EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 3                          - B3           ERL416
     C                     Z-ADDEAMT      EXAMNT                          ERL416
     C                     END                             - E3           ERL416
      *                                                                   ULX047
     C                     Z-ADDEXAMNT    EXNPVA                          ULX047
      *                                                                   217813
     C           ULX046    IFEQ 'Y'                                       217813
     C                     Z-ADDEXAMNT    EXTOTA                          217813
     C                     ADD  1         WWSEQN                          217813
     C                     MOVE WWSEQN    EXCTRF                          217813
     C                     ENDIF                                          217813
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
      ** If the loan is matured, reset fields                             ULX046
      *                                                                   ULX046
     C           WWLNST    ANDEQ'MATURE'                                  ULX046
     C*******              Z-ADDEXREVD    EXENDD                          ULX046
     C                     Z-ADD*ZEROS    EXNIDT                          ULX046
     C                     Z-ADD*ZEROS    EXAMNT                          ULX046
     C                     Z-ADD*ZEROS    EXNOMA                          ULX046
     C                     Z-ADD*ZEROS    EXNPVA                          ULX046
     C                     Z-ADD*ZEROS    EXMKT1                          ULX046
     C                     ENDIF                                          ULX046
     C*                                                                   ULX004
     C** Only for the first record written for the repayments, the        ULX004
     C** fields must be setup with the values already retrieved and       ULX004
     C** for the other records, fields to zeros or blanks
     C           WWTEST    IFEQ 'N'                        - B3           ULX004
     C                     MOVE 'Y'       WWTEST                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD*ZEROS    EXACCR                          ULX004
     C                     Z-ADD*ZEROS    EXITAC                          ULX004
     C                     Z-ADD*ZEROS    EXSLID                          ULX004
     C                     Z-ADD*ZEROS    EXNIDT                          ULX004
     C                     MOVE *BLANKS   EXRETB                          ULX004
     C***********ULX046    IFEQ 'Y'                                ULX046 217813
     C***********          Z-ADD*ZEROS    EXIRSD    Int. Rate StartULX046 217813
     C***********          Z-ADD*ZEROS    EXIRED    Int. Rate End  ULX046 217813
     C***********          Z-ADD*ZEROS    EXNCRA    Net Credit OPAMULX046 217813
     C***********          MOVE *BLANKS   EXCTRF    Unique ContractULX046 217813
     C***********          Z-ADD*ZEROS    EXTOTA    Tot Trans. AmntULX046 217813
     C***********          Z-ADD*ZERO     EXNWDC                   214603 217813
     C***********          Z-ADD*ZERO     EXANIR                   214603 217813
     C***********          Z-ADD*ZERO     EXNCAP                   214603 217813
     C***********          ENDIF                                   ULX046 217813
     C                     END                                            ULX004
     C*                                                                   194921
     C** Market Values                                                    194921
     C                     Z-ADDEXAMNT    EXNPVA                          194921
     C                     Z-ADDEXAMNT    EXMKT1                          194921
     C*                                                                   194921
     C** Long/short position indicator 1                                  194921
     C           EXDRCR    IFEQ 0                                         194921
     C                     Z-ADD1         EXLSP1                          194921
     C                     ELSE                                           194921
     C                     Z-ADD2         EXLSP1                          194921
     C                     ENDIF                                          194921
      *                                                                   ERL416
     C                     MOVE 'Y'       REPIND                          ERL416
     C                     MOVE 'REP'     EXTREF                          ERL416
     C                     ADD  1         NREC                            ERL416
     C*                                                                   ERL416
     C** WRITE A RECORD FOR REPAYMENT MANAGEMENT                          ERL416
     C           EXAMNT    IFNE *ZEROS                                    ERL458
     C*                                                                   ERL458
     C***********DSFREP    IFEQ '2'                                 ERL458ULX004
     C***********          MOVE '1'       DSFREP                    ERL458ULX004
     C***********          ELSE                                     ERL458ULX004
     C***********          MOVE '0'       DSFREP                    ERL458ULX004
     C***********          END                                      ERL458ULX004
     C           EXFREP    IFEQ 2                                         ULX004
     C                     Z-ADD1         EXFREP                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD0         EXFREP                          ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ERL460
     C***********          ADD  1         WWREPN                    ERL460ULX004
     C***********          MOVE WWREPN    DSREPN                    ERL460ULX004
     C                     ADD  1         EXREPN                          ULX004
      *                                                                   ERL458
     C                     WRITEEREXTRF0                                  ERL416
     C                     END                                            ERL458
      *                                                                   ERL416
      ** READ NEXT RECORD                                                 ERL416
     C           NEXT      TAG                                            ERL416
     C                     READ ERLVENL0                 65               ERL416
     C*                                                                   ERL416
     C                     END                             - E2           ERL416
     C*                                                                   ERL416
     C                     END                             - E1           ERL416
      *                                                                   ERL416
     C***********          MOVE '0'       DSFREP                    ERL458ULX004
     C                     Z-ADD0         EXFREP                          ULX004
     C***********          MOVE *BLANKS   DSREPN                    ERL460ULX004
     C                     Z-ADD0         EXREPN                          ULX004
      *                                                                   ERL458
     C                     ENDSR                                          ERL416
     C**=================================================================
      **
      **  #INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
      **              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
     C**
      **     CALLED BY PROGRAM
      **     CALLS     *PSSR
      **
     C**=================================================================
     C**                                                   *****************
     C           #INIT     BEGSR                           ** #INIT BEGSR **
     C**                                                   *****************
     C**  PREPARE LDA:
     C**
     C           *NAMVAR   DEFN           LDA                             ULX004
     C******               MOVEL*BLANK    DBLOT                           ULX004
     C                     MOVEL'ER0623'  DBPGM
     C*
     C** INITIALIZE WORK FIELD FOR BRANCH
     C                     MOVEL*BLANKS   WWBRCD                          ULX004
     C*                                                                   ER0136
     C** INITIALIZE WORK FIELD FOR NUMBER OF EXTRACTED RECORDS            ER0136
     C                     Z-ADD0         NREC                            ER0136
     C*
     C**  INITIALIZE INDICATORS:
     C                     MOVE '0'       *IN
     C**
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C                     READ SDBANKL1                 81
     C**
     C**  IF RECORD NOT FOUND:
     C           *IN81     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'009'     DBASE            *****************
     C                     MOVEL'SDBANKL1'DBFILE           ** DB ERROR 09 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
      *                                                                   CEU007
      ***  Check if the feature CEU007 is installed.                      CEU007
      *                                                                   CEU007
     C                     MOVEL'N'       CEU007  1                       CEU007
     C                     CALL 'AOSARDR0'                                CEU007
     C                     PARM '       ' @RTCD   7                       CEU007
     C                     PARM '*VERIFY' @OPTN   7                       CEU007
     C                     PARM 'CEU007'  @SARD   6                       CEU007
      *                                                                   CEU007
     C           @RTCD     IFEQ *BLANKS                                   CEU007
      *                                                                   CEU007
      ***  It's existing.                                                 CEU007
      *                                                                   CEU007
     C                     MOVEL'Y'       CEU007                          CEU007
      *                                                                   CEU007
     C                     ENDIF                                          CEU007
      *                                                                   ULX046
      ***  Check if the feature ULX046 is installed.                      ULX046
      *                                                                   ULX046
     C                     MOVEL'N'       ULX046  1                       ULX046
     C                     CALL 'AOSARDR0'                                ULX046
     C                     PARM '       ' @RTCD                           ULX046
     C                     PARM '*VERIFY' @OPTN                           ULX046
     C                     PARM 'ULX046'  @SARD                           ULX046
      *                                                                   ULX046
     C           @RTCD     IFEQ *BLANKS                                   ULX046
     C                     MOVEL'Y'       ULX046                          ULX046
     C                     OPEN ERLOANL0                                  ULX046
     C                     OPEN ERLOAKL0                                  ULX046
     C                     ELSE                                           ULX046
     C**********           OPEN CLOANC                                                 ULX046 CER001
     C                     OPEN LECLNXL0                                                      CER001
     C                     OPEN CLOANK                                    ULX046
     C                     ENDIF                                          ULX046
      *
      ** CHECK FOR END OF MONTH                                           ART021
      *
     C                     CALL 'SD2000'                                  ART021
     C                     PARM 'N'       EOM     1                       ART021
     C                     PARM 'N'       EOY     1                       ART021
     C*                                                                   ART021
     C           EOM       IFEQ 'Y'                                       ART021
     C                     EXSR #DATE                      RUN DATE       ER0317
     C                     EXSR #EOMD                      END OF MONTH   ER0317
     C                     ELSE                                           ART021
     C                     Z-ADDBJRDNB    EREOMD                          ART021
     C                     END                                            ART021
      *
      ** GET REPORTING DATE IN FORMAT YYYYMMDD
      *********************Z-ADDBJRDNB    @@DAYN  50                      ER0317
     C                     Z-ADDEREOMD    @@DAYN  50                      ER0317
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     WWREPD  80
      *                                                                   ULX046
      ** RETRIEVE FIRST DATE OF THE MONTH                                 ULX046
      *                                                                   ULX046
     C                     Z-ADDWWREPD    ZZDTIN                          ULX046
     C                     Z-ADD01        ZWDAY                           ULX046
     C                     Z-ADDZZDTIN    WWFDTM  80                      ULX046
     C                     EXSR ZDAT10                                    ULX046
     C                     Z-ADDZZMDNO    WWFDOM  50                      ULX046
      *                                                                   ULX046
      ** DEFINE WORKING FIELDS                                            ULX046
      *                                                                   ULX046
     C           *LIKE     DEFN EXIRSD    WWIRSD                          ULX046
     C           *LIKE     DEFN EXIRED    WWIRED                          ULX046
     C           *LIKE     DEFN EXNCRA    WWNCRA                          ULX046
     C           *LIKE     DEFN EXCTRF    WWCTRF                          ULX046
     C           *LIKE     DEFN EXTOTA    WWTOTA                          ULX046
     C           *LIKE     DEFN EXNWDC    WWNWDC                          214603
     C           *LIKE     DEFN EXANIR    WWANIR                          214603
     C           *LIKE     DEFN EXNCAP    WWNCAP                          214603
      *
      ** Retrieve the date for past due                                   ULX004
     C           EREOMD    SUB  90        WWPDDT  50                      ULX004
     C*                                                                   ER0136
     C                     WRITEHEADAU                                    ER0136
     C*
     C                     ENDSR
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #DATE      - SUBROUTINE TO RUN DATE                             ER0317
      **                                                                  ER0317
      **  CALLS      -                                                    ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #DATE     BEGSR                                          ER0317
     C**                                                                  ER0317
     C**   DAY                                                            ER0317
     C                     Z-ADDWWBJD     ERDADD  20       DAY            ER0317
     C**   MONTH                                                          ER0317
     C                     Z-ADD1         X       20       X : INDEX      ER0317
     C           WWBJM     LOKUPZMNM,X                   2626 : EQUAL     ER0317
     C           *IN26     IFEQ '1'                                       ER0317
     C                     Z-ADDX         ERDAMM  20       MONTH          ER0317
     C                     END                                            ER0317
     C**   YEAR                                                           ER0317
     C                     Z-ADDWWBJY     ERDAYY  20       YEAR           ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #EOMD      - SUBROUTINE TO COMPUTE END OF MONTH                 ER0317
      **                                                                  ER0317
      **  CALLS      - ZDATE1                                             ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #EOMD     BEGSR                                          ER0317
     C**                                                                  ER0317
     C                     Z-ADDERDAYY    WWY              YEAR           ER0317
     C                     Z-ADDERDAMM    WWM              MONTH          ER0317
     C                     Z-ADDTNDM,WWM  WWD              DAY            ER0317
     C**                                                                  ER0317
     C           *IN99     DOUEQ'0'                        - B1           ER0317
     C                     Z-ADDWWDATE    ZDATE                           ER0317
     C                     EXSR ZDATE1                                    ER0317
     C                     SUB  1         WWD                             ER0317
     C                     END                             - E1           ER0317
     C**                                                                  ER0317
     C                     Z-ADDZDAYNO    EREOMD  50       END OF MONTH   ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
     C********************************************************************
     C** *PSSR  S/R
     C*================================================================
     C           *PSSR     BEGSR
     C*
     C*********************WRITEHEADAU                                    ER0136
     C                     WRITEERROR                                     ER0136
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************ER0317
     C**                                                                  ER0317
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND                     ER0317
     C**              CONVERT TO A NUMBER OF DAYS.                        ER0317
     C**                                                                  ER0317
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         ER0317
     C**                                                                  ER0317
     C           ZDATE1    BEGSR                           *** ZDATE1 *** ER0317
     C**                                                                  ER0317
     C**   CLEAR DAY NUMBER.                                              ER0317
     C                     Z-ADD0         ZDAYNO  50                      ER0317
     C**                                                                  ER0317
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.                        ER0317
     C                     Z-ADDZDATE     ZDATE   60                      ER0317
     C**                                                                  ER0317
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.                     ER0317
     C                     MOVE ZDATE     ZYEAR   20                      ER0317
     C  N98                MOVELZDATE     ZDAY    20                      ER0317
     C   98                MOVELZDATE     ZMTH    20                      ER0317
     C                     MOVE ZDATE     ZWRK4   40                      ER0317
     C  N98                MOVELZWRK4     ZMTH                            ER0317
     C   98                MOVELZWRK4     ZDAY                            ER0317
     C**                                                                  ER0317
     C**   ENSURE MONTH IS VALID.                                         ER0317
     C           ZMTH      COMP 0                      9999               ER0317
     C  N99      ZMTH      COMP 12                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR 30 DAY MONTHS.                                       ER0317
     C           ZMTH      COMP 4                        90IF 90 ON, 30   ER0317
     C  N90      ZMTH      COMP 6                        90DAY MONTH.     ER0317
     C  N90      ZMTH      COMP 9                        90               ER0317
     C  N90      ZMTH      COMP 11                       90               ER0317
     C**                                                                  ER0317
     C**   ENSURE DAY IS VALID.                                           ER0317
     C           ZDAY      COMP 0                      9999               ER0317
     C   90N99   ZDAY      COMP 30                   99                   ER0317
     C  N90N99   ZDAY      COMP 31                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.                              ER0317
     C           ZYEAR     ADD  28        ZYEAR                           ER0317
     C           ZYEAR     DIV  4         ZLYR    20                      ER0317
     C                     MVR            ZLY     10     91LEAP YR, 91 ON ER0317
     C           ZMTH      COMP 2                    93  92FEB., 92 ON    ER0317
     C**                                                   PAST FEB, 93 ONER0317
     C**   IF FEBUARY FURTHER VALIDATE DAY.                               ER0317
     C  N91 92   ZDAY      COMP 28                   99                   ER0317
     C   91 92   ZDAY      COMP 29                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANSER0317
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.ER0317
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRER0317
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.ER0317
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR ER0317
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHER0317
     C**                                                                  ER0317
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*ER0317
     C**                                                                  ER0317
     C**                                                                  ER0317
     C*****************************************************************
     C*
     C           ZDATE9    BEGSR
     C*
     C                     SETOF                     8081
     C                     MOVE '0'       @@RTN   1
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1
     C                     MOVE '1'       @@RTN
     C                     GOTO ZDAT79
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZA0711
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZA0711
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZDAT79    ENDSR
      *                                                                   CEU007
      ********************************************************************CEU007
      * NOSTRO - Subroutine for access PF/SDNOSTPD via access object      CEU007
      ********************************************************************CEU007
      *                                                                   CEU007
     C           NOSTRO    BEGSR                                          CEU007
      *                                                                   CEU007
     C                     CALL 'AONOSTR0'                                CEU007
     C                     PARM *BLANKS   UUAPRC  7        B:Return Cd    CEU007
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU007
     C                     PARM *BLANKS   UUCUST  6        I:Customer No. CEU007
     C                     PARM           UUCYCD  3        I:Currency CodeCEU007
     C**********           PARM *BLANKS   UUACCD  4        I:Account Code              CEU007 CER001
     C                     PARM *BLANKS   UUACCD 10        I:Account Code                     CER001
     C                     PARM *BLANKS   UUACSN  2        I:Account SequeCEU007
     C                     PARM           UUNONB  2        I:Nostro NumberCEU007
     C                     PARM *BLANKS   UUBRCD  3        I:Branch Code  CEU007
     C                     PARM *BLANKS   UUCSSN 10        I:Cust ShortN  CEU007
     C                     PARM *BLANKS   UUPNOI  1        I:Prime Nost InCEU007
     C           D@NOST    PARM *BLANKS   UUFDY            O:Format       CEU007
      *                                                                   CEU007
     C           UUAPRC    IFNE *BLANKS                    B1             CEU007
      *                                                                   CEU007
      *** If not found perform the database error                         CEU007
      *                                                                   CEU007
     C           *LOCK     IN   LDA                                       CEU007
     C                     MOVEL'006'     DBASE            ***************CEU007
     C                     MOVEL'SDNOSTPD'DBFILE           ** DB ERROR 06 CEU007
     C           UUCYCD    CAT  UUNONB    DBKEY            ***************CEU007
     C                     OUT  LDA                                       CEU007
     C                     EXSR *PSSR                                     CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     ENDSR                                          CEU007
      *                                                                   CEU007
     C********************************************************************
     C*                                                                   ULX046
     C* ZDAT10 - THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         ULX046
     C*          MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         ULX046
     C*                                                                   ULX046
     C* INPUT  : ZZDTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   ULX046
     C*                                                                   ULX046
     C* OUTPUT : ZZMDNO MIDAS DAY NUMBER  (SIZE : 5N)                     ULX046
     C*                                                                   ULX046
     C* USES :   @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     ULX046
     C*                 MONTH                                             ULX046
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     ULX046
     C*                 A FOUR YEAR PERIOD                                ULX046
     C*          ZWYYYY YEAR (4 CHARACTER)                                ULX046
     C*          ZWYY   YEAR (2 CHARACTER)                                ULX046
     C*          ZWCC   NUMBER OF CENTURIES IN DATE                       ULX046
     C*          ZWMTH  MONTH NUMBER                                      ULX046
     C*          ZWDAY  DAY NUMBER                                        ULX046
     C*          ZWREM  REMAINDER FROM DIVIDE                             ULX046
     C*          ZWWK2  WORK FIELD (2,0)                                  ULX046
     C*          ZWWK5  WORK FIELD (5,0)                                  ULX046
     C*                                                                   ULX046
     C******************************************************************* ULX046
     C*                                                                   ULX046
     C           ZDAT10    BEGSR                                          ULX046
     C*                                                                   ULX046
     C** INITIALISE OUTPUT FIELD                                          ULX046
     C                     Z-ADD0         ZZMDNO  50                      ULX046
     C*                                                                   ULX046
     C** IF INPUT FIELD IS ZERO THEN TERMINATE SUBROUTINE                 ULX046
     C           ZZDTIN    CABEQ0         ZDAT19                          ULX046
     C*                                                                   ULX046
     C** IF DATE GREATER THAN 31/12/2071 THEN CALCUALTE NUMBER OF         ULX046
     C** CENTURIES PASSED SINCE 1971, BY SUBTRACTING 1972 FROM THE        ULX046
     C** THE YEAR FIELD.                                                  ULX046
     C           ZWYYYY    IFGE 2072                                      ULX046
     C           ZWYYYY    SUB  1972      ZWYYYY                          ULX046
     C*                                                                   ULX046
     C** MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)               ULX046
     C** THEN RESTORE THE YEAR WHICH WAS INPUT BACK TO THE                ULX046
     C** ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.       ULX046
     C           ZWCC      MULT 36525     ZZMDNO                          ULX046
     C           ZWYYYY    ADD  1972      ZWYYYY                          ULX046
     C                     END                                            ULX046
     C*                                                                   ULX046
     C** ADD 28 TO THE YEAR - THE RIGHT TWO DIGITS OF THE RESULT WILL     ULX046
     C** GIVE THE NUMBER OF YEARS FROM 1971 - DISREGARDING CENTURIES      ULX046
     C           ZWYYYY    ADD  28        ZWWK2   20                      ULX046
     C*                                                                   ULX046
     C** CALCULATE HOW MANY GROUPS OF FOUR YEARS THERE ARE                ULX046
     C           ZWWK2     DIV  4         ZWWK2                           ULX046
     C                     MVR            ZWREM   10                      ULX046
     C*                                                                   ULX046
     C** AND MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD               ULX046
     C           ZWWK2     MULT 1461      ZWWK5   50                      ULX046
     C                     ADD  ZWWK5     ZZMDNO                          ULX046
     C*                                                                   ULX046
     C** IF A LEAP YEAR AND PAST FEBRUARY THEN ADD AN EXTRA DAY           ULX046
     C           ZWREM     IFEQ 0                                         ULX046
     C           ZWMTH     ANDGT2                                         ULX046
     C                     ADD  1         ZZMDNO                          ULX046
     C                     END                                            ULX046
     C*                                                                   ULX046
     C** YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR                ULX046
     C           ZWREM     IFNE 0                                         ULX046
     C                     ADD  @YD,ZWREM ZZMDNO                          ULX046
     C                     END                                            ULX046
     C*                                                                   ULX046
     C** ADD MONTHS THIS YEAR                                             ULX046
     C                     ADD  @MD,ZWMTH ZZMDNO                          ULX046
     C*                                                                   ULX046
     C** ADD DAYS THIS MONTH                                              ULX046
     C                     ADD  ZWDAY     ZZMDNO                          ULX046
     C*                                                                   ULX046
     C           ZDAT19    ENDSR                           **ZDAT19 TAG** ULX046
     C********************************************************************ULX046
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@                                                                  ULX004
(c) Finastra International Limited 2005
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TNDM - NUMBER OF DAYS PER MONTH
312931303130313130313031
**   CT1
010203040506070809101112
**   CT2
010101040404070707101010
**   TFRQ - INTEREST FREQUENCY
WFMTQXY
**   TFVL - INTEREST FREQUENCY VALUE
44433211
