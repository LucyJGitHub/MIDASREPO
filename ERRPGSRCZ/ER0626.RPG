     H        1   Y
      *****************************************************************   ULX004
/*STD *  RPGBASE                                                      *   ULX004
/*EXI *  TEXT('Midas ER Extract program - FRA/IRS Deals')             *
      *****************************************************************
      *                                                               *
      *  Midas - European Reporting Module                            *
      *                                                               *
      *  ER0626 - ER Extract program - FRA/IRS Deals                  *
      *                                                               *
      *  (c) Finastra International Limited 2005                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 225555             Date 01Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027A            Date 12May06               *
      *                 CER001             Date 25Apr05               *
      *                 ULX047             Date 04Dec02               *
      *                 UPG402             Date 04Oct04               *
      *                 ULX046             Date 31Oct02               *
      *                 187689 PT          Date 09Jan01               *
      *                 171429             DATE 09DEC99               *
      *                 152952 PT          Date 14Jan98               *
      *                 143793 PT          Date 30Nov98               *
      *                 CEU007 PTF08       Date 30Nov98               *
      *                 CAD007 PT          Date 22Jul98               *
      *                 ULX004             Date 10MAR97               *
      *                 ERL428             DATE 27AUG94               *
      *                 109278             Date 25OCT96               *
      *                 ART021             Date 16SEP96               *
      *                 ER_R10             Date 25SEP95               *
      *                 076678 PBO         Date 29SEP94               *
      *                 068453 PT          Date 13APR94               *
      *                 068452 PT          Date 13APR94               *
      *                 ERL357 PT          Date 08JUL93               *
      *                 ER0352 TLI         Date 18JUN93               *
      *                 054793 TLI         Date 13MAY93               *
      *                 ER0338 PT          Date 09APR93               *
      *                 ER0321 TLI         Date 15FEB93               *
      *                 ER0319 TLI         Date 05FEB93               *
      *                 ER0317 TLI         Date 02FEB93               *
      *                 ER0302 TLI         Date 13JAN83               *
      *                 ER1014             Date 18JAN93 THL           *
      *                 ER0205 ADs         Date 14DEC92               *
      *                 ER0136 VT          Date 23DEC92               *
      *                 ER0113 TLi         Date 08DEC92               *
      *                 ER0101 ADs         Date 24NOV92               *
      *                                                               *
      *---------------------------------------------------------------*
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  225555 - Add discount/premium amount, amount to amortize     *
      *           and 'Prix d'Acquisition'. Recompile over changed    *
      *           EREXTRPD.                                           *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  ULX047 - CSSF Market Values calculation                      *
      *  UPG402 - Recompile due to R4.02 upgrade                      *
      *  ULX046 - Circulars 2002/170-174-175 Integration              *
      *           Recompiled due to changes in file layout            *
      *  187689 - Access to currency files badly positioned           *
      *  171429 - APPLY FIX 161739                                    *
      *  152952 - CEU007 badly integrated                             *
      *  143793 - Accruals wrongly set up - must be based on DL0520   *
      *  CEU007 - Holidays Changes For Reporting Interface.           *
      *  CAD007 - CAD adaptation to data dictionary version 1.6       *
      *  ULX004 - Capital Adequacy                                    *
      *           (UNL002 Reference is replaced with ULX004 for DBA4) *
      *           (UCH001 Reference is replaced with ULX004 for DBA4) *
      *  ERL428 - To extract customer classification                  *
      *  109278 - For RX deals, the unrealised P&L is in base currency*
      *  ART021 - SNB Article 21 development                          *
      *  ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10      *
      *         - (R10 MULTIBRANCHING)                                *
      *  076678 - Distinction must be done between Floors Bought      *
      *           (0) debit and Sold (1) Credit   and CAP COLLAR      *
      *           Bought (1) credit Sold (0)  debit                   *
      *  068453 - Distinction must be done between Caps, floors       *
      *           and collars bought and sold                         *
      *  068452 - Distinction must be done between FRA bought and     *
      *           sold                                                *
      *  ERL357 - For cross currency interest rate swaps (RX),        *
      *           "Their" side is debit, "Our" is credit.             *
      *  ER0352 - Change setup for Debit/Credit indicator             *
      *  054793 - SETUP REVISION DATE                                 *
      *  ER0338 - Debit side used for caps, collars and floors        *
      *  ER0321 - Add 'Country of Citizenship'                        *
      *  ER0319 - Setup Currency 2 for 'MM' and 'FRA/IRS'             *
      *  ER0317 - Change test with run date by end of month date      *
      *  ER0302 - SETUP ALWAYS CREDIT FOR 'FRA'                       *
      *  ER1014 - NOMINAL AMOUNT MUST BE PRESENT WITH FRA/IRS.        *
      *  ER0205 - Add B/n-B ind. and second Ccy on extract file       *
      *  ER0136 - CALCULATE THE NUMBER OF EXTRACTED RECORDS           *
      *  ER0101 - Decision Key lenght from 6 to 8 (RECOMPILATION)     *
      *  ER0113 - Wrong field to test decimal places                  *
      *                                                               *
      *****************************************************************
     FDEALSDG IF  E           K        DISK
     F* FRA/IRS Deals file
     F*
     FSDCUSTL1IF  E           K        DISK
     F* Client Details file
     F*
     FSDSECSL1IF  E           K        DISK                               ULX004
     F* SE Client Details file                                            ULX004
     F*                                                                   ULX004
     FSDCURRL1IF  E           K        DISK
     F* Currency Codes file
     F*
     FSDBRCHL1IF  E           K        DISK
     F* Branch Code master file
     F*
     FSDBANKL1IF  E           K        DISK
     F* Bank Details file
     F*
     FSDBOOKL1IF  E           K        DISK
     F* Book Details file
     F*
     FSDBSRTL1IF  E           K        DISK                               CAD007
     F* Base Rate Codes file                                              CAD007
     F*                                                                   CAD007
     F***ACCEXAL3IF  E           K        DISK                            ULX004              CER001
     FDLACOXL1IF  E           K        DISK                                                   CER001
     F* DL Accruals Extract by deal number                                ULX004
     F*                                                                   ULX004
     F***DEALSGY6IF  E           K        DISK                            ULX047              CER001
     FDLDGX1L0IF  E           K        DISK                                                   CER001
     F* IRS LU Extension File                                             ULX047
     F*                                                                   ULX047
     FEREXTRPDO   E                    DISK
     F* ER Production Extract
     F*
     FER0626AUO   E                    PRINTER
     F* ER Audit report for FRA/IRS deals extract
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   .. *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   .. *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*                                                                   ER0317
     E** ARRAY FOR ZDATE1                                                 ER0317
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMNM   12  12  3               ZDATE2 SR.ARRAY  ER0317
     E                    TNDM   12  12  2 0             NUMBER/DAY/MONTH ER0317
     I*                                                                   CAD007
     I** RENAME BASE RATE CODES TO KEEP ORIGINAL                          CAD007
     IACCEXAOF                                                            CAD007
     I              UBRTT                           XUBRTT                CAD007
     I              TBRTT                           XTBRTT                CAD007
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA       E DSLDA                         256                       ULX004
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I**  MIDAS RUN DATE                                                  ER0317
     I            DS                                                      ER0317
     I                                        1   7 BJMRDT                ER0317
     I                                        1   20WWBJD                 ER0317
     I                                        3   5 WWBJM                 ER0317
     I                                        6   70WWBJY                 ER0317
     I**  DEFINE A DATE                                                   ER0317
     I            DS                                                      ER0317
     I                                        1   60WWDATE                ER0317
     I                                        1   20WWD                   ER0317
     I                                        3   40WWM                   ER0317
     I                                        5   60WWY                   ER0317
     I*
      *                                                                   CEU007
     IUUFDY     E DSDSFDY                                                 CEU007
      ***  200 Byte Data Structure for Incoming Data from Access Program  CEU007
      *                                                                   CEU007
     ID@NOST    E DSSDNOSTPD                                              CEU007
      ***  Nostro Details DS for assigning data from Access               CEU007
      ***  Programs to work fields                                        CEU007
     ISCSARD    E DSSCSARDPD                                                                  CER001
      ** External DS for SAR Details                                                          CER001
      *                                                                                       CER001
     IEXDECK      DS                             14                                           CER001
     I                                        6   9 WWCLAS                                    CER001
      ** Data structure for decision table                                                    CER001
      *                                                                                       CER001
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*                    M A I N
     C*****************************************************************
     C*
     C                     EXSR #INIT
     C*
     C                     READ DEALSDG                  30
     C*
     C** MAIN PROCESSING
     C           *IN30     DOWEQ'0'                        - B1
     C*
     C                     EXSR P003
     C*
     C                     READ DEALSDG                  30
     C*
     C                     END                             - E1
     C*
     C** TERMINATION PROCESSING
     C                     WRITEDETAIL                                    ER0136
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C**************************************************************************
     C* P003 - DETAIL PROCESSING SUB-ROUTINE
     C**************************************************************************
     C*
     C           P003      BEGSR
      *                                                                   CEU007
      *** IF THE FEATURE CEU007 IS INSTALLED, FILLING THE NEW FIELDS      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
     C           DTYP      IFEQ 'FR'                       B2             CEU007
      *                                                                   CEU007
      ***  SET UP THE DEFAULTS FIELD WITH:                                CEU007
      ***  UCUCY FROM PF/DEALSDG                                          CEU007
      ***  TCUCY FROM PF/DEALSDG                                          CEU007
      ***  BJSLCD FROM PF/SDBANKPD                                        CEU007
      *                                                                   CEU007
     C           BYSL      IFEQ 'B'                        B3             CEU007
     C                     MOVELPSCY      EXSDCU           ST.DAT.SETT.CCYCEU007
     C                     MOVELPSCY      EXRDCU           RE.DAT.SETT.CCYCEU007
     C                     MOVELPSCY      EXEDCU           EN.DAT.SETT.CCYCEU007
      *                                                                   CEU007
      *****STORE*THE*VALUES*FOR THE SECOND RECORD                  CEU007 152952
      *********************                                        CEU007 152952
     C*********************MOVELPSCY      WWSDCU  3 ST.DAT.SETT.CCYCEU007 152952
     C*********************MOVELPSCY      WWEDCU  3 EN.DAT.SETT.CCYCEU007 152952
     C*********************MOVELPSCY      WWRDCU  3 RE.DAT.SETT.CCYCEU007 152952
      *                                                                   CEU007
     C                     MOVELPSCY      WWSCY1  3        FOR SR NOSTRO  CEU007
      *                                                                   CEU007
     C                     ELSE                            X3             CEU007
     C                     MOVELRSCY      EXSDCU           ST.DAT.SETT.CCYCEU007
     C                     MOVELRSCY      EXRDCU           RE.DAT.SETT.CCYCEU007
     C                     MOVELRSCY      EXEDCU           EN.DAT.SETT.CCYCEU007
      *                                                                   CEU007
     C                     MOVELRSCY      WWSCY1           FOR SR NOSTRO  CEU007
      *                                                                   CEU007
      *****STORE*THE*VALUES*FOR THE SECOND RECORD                  CEU007 152952
      *********************                                        CEU007 152952
     C*********************MOVELRSCY      WWSDCU    ST.DAT.SETT.CCYCEU007 152952
     C*********************MOVELRSCY      WWEDCU    EN.DAT.SETT.CCYCEU007 152952
     C*********************MOVELRSCY      WWRDCU    RE.DAT.SETT.CCYCEU007 152952
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ELSE                            X2             CEU007
      *                                                                   CEU007
     C                     MOVELUCUCY     EXSDCU           ST.DAT.SETT.CCYCEU007
     C                     MOVELUCUCY     EXRDCU           RE.DAT.SETT.CCYCEU007
     C                     MOVELUCUCY     EXEDCU           EN.DAT.SETT.CCYCEU007
      *                                                                   CEU007
     C                     MOVELUCUCY     WWSCY1           FOR SR NOSTRO  CEU007
      *                                                                   CEU007
      ***  STORE THE VALUES FOR THE SECOND RECORD                         CEU007
      *                                                                   CEU007
     C*********************MOVELTCUCY     WWSDCU    ST.DAT.SETT.CCYCEU007 152952
     C                     MOVELTCUCY     WWSDCU  3        ST.DAT.SETT.CCY152952
     C                     MOVELTCUCY     WWEDCU           EN.DAT.SETT.CCYCEU007
     C                     MOVELTCUCY     WWRDCU           RE.DAT.SETT.CCYCEU007
      *                                                                   CEU007
     C                     MOVELTCUCY     WWSCY2  3        FOR SR NOSTRO  CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     MOVELBJSLCD    EXSDLO           ST.DAT.SETT.LOCCEU007
     C                     MOVELBJSLCD    EXRDLO           RE.DAT.SETT.LOCCEU007
     C                     MOVELBJSLCD    EXEDLO           EN.DAT.SETT.LOCCEU007
      *                                                                   CEU007
      ***  STORE THE VALUES FOR THE SECOND RECORD                         CEU007
      *                                                                   CEU007
     C                     MOVELBJSLCD    WWSDLO  3        ST.DAT.SETT.LOCCEU007
     C                     MOVELBJSLCD    WWEDLO  3        EN.DAT.SETT.LOCCEU007
     C                     MOVELBJSLCD    WWRDLO  3        RE.DAT.SETT.LOCCEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
     C*
     C           DTYP      IFEQ 'FR'                       - B1
     C***********BJRDNB    ANDGEDDAT                                      ER0317
     C***********BJRDNB    ANDLTVDAT                                      ER0317
     C           EREOMD    ANDGEDDAT                                      ER0317
     C           EREOMD    ANDLTVDAT                                      ER0317
     C           RECI      ANDEQ'D'
     C           DTYP      ORNE 'FR'
     C***********BJRDNB    ANDGEDDAT                                      ER0317
     C***********BJRDNB    ANDLTMDAT                                      ER0317
     C***********EREOMD    ANDGEDDAT                               ER0317 143793
     C           EREOMD    ANDGEVDAT                                      143793
     C           EREOMD    ANDLTMDAT                                      ER0317
     C           RECI      ANDEQ'D'
     C*
     C***********BRCD      IFNE WWBRCD                     - B2           ER_R10
     C           BRCA      IFNE WWBRCD                     - B2           ULX004
     C*
     C** STORE NEW BRANCH IN OLD BRANCH
     C***********          Z-ADDBRCD      WWBRCD  30                      ER_R10
     C                     MOVE BRCA      WWBRCD  3                       ULX004
     C*
     C***********          MOVE BRCD      AABRCD  3                       ER_R10
     C                     MOVE BRCA      AABRCD  3                       ULX004
     C*
     C           AABRCD    CHAINSDBRCHL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'002'     DBASE            *****************
     C                     MOVEL'SDBRCHL1'DBFILE           ** DB ERROR 02 **
     C                     MOVELAABRCD    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
      *                                                                   ULX004
      ***  ULX004 : Save Internal branch customer A8BICN                  ULX004
      *                                                                   ULX004
     C                     MOVE A8BICN    SVBICN  6                       ULX004
     C*
     C** ACCESS CUSTOMER DETAILS FILE
     C           A8BICN    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'003'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 03 **
     C                     MOVELA8BICN    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    WWORCC  2
     C                     END                             - E2
     C*                                                                   ULX004
     C***   Long/Short Position Indicator 1 and 2                         ULX004
     C*                                                                   ULX004
     C                     Z-ADD0         EXLSP1                          ULX004
     C                     Z-ADD0         EXLSP2                          ULX004
     C                     Z-ADD0         EXNUND                          ULX004
     C                     Z-ADD1         EXOTCE                          ULX004
     C                     MOVE BOKC      EXBKCD                          ULX004
     C*                                                                   187689
     C** STORE AMOUNT IN CURRENCY                                         187689
     C           UCUCY     CHAINSDCURRL1             88                   187689
     C           *IN88     IFEQ '1'                        - B2           187689
     C           *LOCK     IN   LDA                                       187689
     C                     MOVEL'007'     DBASE            ***************187689
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 07 187689
     C                     MOVELUCUCY     DBKEY            ***************187689
     C                     OUT  LDA                                       187689
     C                     EXSR *PSSR                                     187689
     C                     END                             - E2           187689
      *                                                                   143793
      ** Accrued Interest and Interest to accrue                          143793
     C                     Z-ADDDLNO      KDLNO                           143793
     C                     MOVE UCUCY     KCCY                            143793
     C********** KACCR     CHAINACCEXAL3             89                   143793              CER001
     C           KACCR     CHAINDLACOXL1             89                                       CER001
      *
      ** Access IRS extension file                                        ULX047
      *                                                                   ULX047
     C                     MOVE 'N'       WWIN88  1                       ULX047
     C           DTYP      IFEQ 'RS'                                      ULX047
     C           DTYP      OREQ 'RX'                                      ULX047
     C********** DLNO      CHAINDEALSGY6             88                   ULX047              CER001
     C           DLNO      CHAINDLDGX1L0             88                                       CER001
     C           *IN88     IFEQ *OFF                                      ULX047
     C                     MOVE 'Y'       WWIN88  1                       ULX047
     C                     ENDIF                                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX047
      ** EXECUTE FORWARD RATE AGREEMENTS PROCESSING
      **                   OR
      ** EXECUTE INTEREST RATE SWAP PROCESSING
     C           DTYP      IFEQ 'FR'                       - B2
     C                     EXSR P007
     C                     ELSE                            - X2
     C                     EXSR P008
     C                     END                             - E2
      *                                                                   ULX004
      ***  ACCESS SECURITIES CUSTOMER DETAILS FILE                        ULX004
      *                                                                   ULX004
     C                     MOVE CNUM      AACNUM  6                       ULX004
     C           AACNUM    CHAINSDSECSL1             88                   ULX004
     C           *IN88     IFEQ '0'                                       ULX004
      *                                                                   ULX004
      ***  ULX004 : Store Pledge agreement                                ULX004
      *                                                                   ULX004
     C                     MOVE BFPLAG    EXPLAG                          ULX004
     C*                                                                   ERL428
     C** Store Customer classification                                    ERL428
     C                     MOVE BFCLAS    EXCLAS                          ERL428
     C                     END                                            ULX004
     C*
     C** ACCESS CUSTOMER DETAILS FILE
     C**********           MOVE CNUM      AACNUM  6                       ULX004
     C           AACNUM    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'004'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 04 **
     C                     MOVELAACNUM    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*                                                                   ER0205
     C** STORE Bank/non-Bank Indicator                                    ER0205
     C                     MOVE BBBNBI    EXBNBI                          ER0205
     C*
     C** STORE CUSTOMER NUMBER
     C                     MOVE BBCUST    EXCUST
      *                                                                   ULX004
      ***  ULX004 : Store counterparty type                               ULX004
      *                                                                   ULX004
     C** NOW MAINTAINED ON A WINDOW                                       ART021
     C*********************MOVE BBBFIC    EXCTPY                   ULX004 ART021
     C*
     C** STORE CUSTOMER COUNTRY CODE
     C                     MOVE BBCOLC    EXCUCC
     C*
     C** STORE CUSTOMER SHORT NAME
     C                     MOVE BBCSSN    EXCSSN
     C*
     C** STORE CUSTOMER REPORT NAME
     C                     MOVE BBCRNM    EXCRNM
     C*                                                                   ER0321
     C** STORE COUNTRY OF CITIEZNSHIP                                     ER0321
     C                     MOVE BBCNCZ    EXCNCZ                          ER0321
      *                                                                   ULX004
      ***  Branch/subsidiary indicator                                    ULX004
      *                                                                   ULX004
     C                     MOVE BBBSIN    EXBSIN                          ULX004
     C*
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK
     C           BBPCNB    IFNE *BLANKS                    - B2
     C*
     C           BBPCNB    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'006'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 06 **
     C                     MOVELBBPCNB    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE
     C                     MOVE BBCUST    EXPCNB
     C                     MOVE BBCOLC    EXPRCC
     C                     ELSE                            - X2
     C*
     C** RESET FIELDS
     C                     MOVE *BLANKS   EXPCNB
     C                     MOVE *BLANKS   EXPRCC
     C                     END                             - E2
     C*
     C** ACCESS BOOK DETAILS TO SETUP TRADE/INVESTMENT
     C           BOKC      CHAINSDBOOKL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'010'     DBASE            *****************
     C                     MOVEL'SDBOOKL1'DBFILE           ** DB ERROR 10 **
     C                     MOVELBOKC      DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C           BDHGIN    IFEQ 'Y'                        - B2
     C                     MOVE 'I'       EXTRIN
     C                     ELSE                            - X2
     C                     MOVE 'T'       EXTRIN
     C                     END                             - E2
     C***********                                                         187689
     C***STORE*AMOUNT IN CURRENCY                                         187689
     C***********UCUCY     CHAINSDCURRL1             88                   187689
     C************IN88     IFEQ '1'                        - B2           187689
     C************LOCK     IN   LDA                                ULX004 187689
     C***********          MOVEL'007'     DBASE            ***************187689
     C***********          MOVEL'SDCURRL1'DBFILE           ** DB ERROR 07 187689
     C***********          MOVELUCUCY     DBKEY            ***************187689
     C***********          OUT  LDA                                ULX004 187689
     C***********          EXSR *PSSR                                     187689
     C***********          END                             - E2           187689
     C*
     C** STORE OUR CURRENCY
     C                     MOVE UCUCY     EXCCYC
     C*
     C** STORE THEIR CURRENCY                                             ER0319
     C                     MOVE TCUCY     EXCCY2                          ER0319
     C*
     C           A6NBDP    IFEQ 0                          - B2
     C           UPAMT     MULT 1000      EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 1                          - B2
     C           UPAMT     MULT 100       EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 2                          - B2
     C           UPAMT     MULT 10        EXAMNT
     C                     END                             - E2
     C***********UPAMT     IFEQ 3                          - B2           ER0113
     C           A6NBDP    IFEQ 3                          - B2           ER0113
     C                     Z-ADDUPAMT     EXAMNT
     C                     END                             - E2
      *                                                                   ULX004
      ***  Original Contract Value                                        ULX004
      *                                                                   ULX004
     C                     Z-ADDEXAMNT    EXORCV                          ULX004
      ***********                                                         143793
      ***Accrued*Interest and Interest to accrue                   ULX004 143793
     C***********DLNO      CHAINACCEXAL3             88            ULX004 143793
     C************IN88     IFEQ '1'                        - B2    ULX004 143793
     C***********          Z-ADD*ZEROS    EXACCR                   ULX004 143793
     C***********          Z-ADD*ZEROS    EXITAC                   ULX004 143793
     C***********          ELSE                            - X2    ULX004 143793
     C***********                                                  ULX004 143793
     C***********A6NBDP    IFEQ 0                          - B3    ULX004 143793
     C***********AMAD      MULT 1000      EXACCR                   ULX004 143793
     C***********AMTA      MULT 1000      EXITAC                   ULX004 143793
     C***********          END                             - E3    ULX004 143793
     C***********A6NBDP    IFEQ 1                          - B3    ULX004 143793
     C***********AMAD      MULT 100       EXACCR                   ULX004 143793
     C***********AMTA      MULT 100       EXITAC                   ULX004 143793
     C***********          END                             - E3    ULX004 143793
     C***********A6NBDP    IFEQ 2                          - B3    ULX004 143793
     C***********AMAD      MULT 10        EXACCR                   ULX004 143793
     C***********AMTA      MULT 10        EXITAC                   ULX004 143793
     C***********          END                             - E3    ULX004 143793
     C***********A6NBDP    IFEQ 3                          - B3    ULX004 143793
     C***********          Z-ADDAMAD      EXACCR                   ULX004 143793
     C***********          Z-ADDAMTA      EXITAC                   ULX004 143793
     C***********          END                             - E3    ULX004 143793
     C***********          END                             - E2    ULX004 143793
     C*                                                                   ULX004
     C** Start/Last Interest Date                                         ULX004
     C                     Z-ADDUSLIP     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXSLID                          ULX004
     C*                                                                   ULX004
     C** Next Interest Due Date                                           ULX004
     C                     Z-ADDUNIPD     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXNIDT                          ULX004
     C*                                                                   ULX004
     C** Retail Indicators                                                ULX004
     C                     MOVE *BLANKS   EXRETB                          ULX004
      *                                                                   ULX004
      ***  Store Internal branch customer                                 ULX004
      *                                                                   ULX004
     C                     MOVE SVBICN    EXBICN                          ULX004
      *                                                                   ULX004
      ***  Net present value calculated                                   ULX004
     C*                                                                   ULX004
     C           WWIN88    IFEQ 'Y'                                       ULX047
     C           IRTPRV    SUB  IROPRV    UNRL                            ULX047
     C                     ENDIF                                          ULX047
     C*                                                                   ULX047
     C           DTYP      IFEQ 'RX'                                      109278
     C*                                                                   109278
     C           WWNBDP    IFEQ 0                          - B2           109278
     C           UNRL      MULT 1000      EXNPVA                          109278
     C                     END                             - E2           109278
     C           WWNBDP    IFEQ 1                          - B2           109278
     C           UNRL      MULT 100       EXNPVA                          109278
     C                     END                             - E2           109278
     C           WWNBDP    IFEQ 2                          - B2           109278
     C           UNRL      MULT 10        EXNPVA                          109278
     C                     END                             - E2           109278
     C           WWNBDP    IFEQ 3                          - B2           109278
     C                     Z-ADDUNRL      EXNPVA                          109278
     C                     END                             - E2           109278
     C*                                                                   109278
     C                     ELSE                                           109278
     C*                                                                   109278
     C           A6NBDP    IFEQ 0                          - B2           ULX004
     C           UNRL      MULT 1000      EXNPVA                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 1                          - B2           ULX004
     C           UNRL      MULT 100       EXNPVA                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 2                          - B2           ULX004
     C           UNRL      MULT 10        EXNPVA                          ULX004
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 3                          - B2           ULX004
     C                     Z-ADDUNRL      EXNPVA                          ULX004
     C                     END                             - E2           ULX004
      *                                                                   ULX004
     C                     END                                            109278
     C*
     C                     Z-ADDEXNPVA    EXDEMK                          ULX047
      *                                                                   ULX047
     C** WRITE RECORD IN OUTPUT FILE
     C                     EXSR W001
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  Set up the fields for the second record                        CEU007
      *                                                                   CEU007
     C                     MOVELWWSDCU    EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVELWWSDLO    EXSDLO           St.Dat.Sett.LocCEU007
     C                     MOVELWWEDCU    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWEDLO    EXEDLO           En.Dat.Sett.LocCEU007
     C                     MOVELWWRDCU    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWRDLO    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
     C*
     C           DTYP      IFEQ 'RS'                       - B2
     C                     EXSR P009
     C                     END                             - E2
     C*
     C           DTYP      IFEQ 'RX'                       - B2
     C                     EXSR P010
     C                     END                             - E2
     C*
     C** RESET FILE RECORD FORMAT
     C                     RESETEREXTRF0
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C**************************************************************************
     C* W001 - SUBROUTINE TO WRITE A RECORD IN EREXTRPD OUTPUT FILE
     C**************************************************************************
     C*
     C           W001      BEGSR
     C*
     C                     Z-ADD001       EXRECT
     C                     MOVE 'FRIR'    EXRIND
     C                     Z-ADDWWREPD    EXREPD
     C***********          MOVE BRCD      EXBRCD                          ER_R10
     C                     MOVE BRCA      EXBRCD                          ULX004
     C                     MOVELDLNO      EXTREF
     C*
     C** DEAL TYPE AND DEAL SUB-TYPE IN DECISION TABLE KEY
     C                     MOVELDTYP      WWDECK  4
     C                     MOVE DLST      WWDECK
     C                     MOVELWWDECK    EXDECK
      *                                                                                       CER001
     C           CDL038    IFEQ 'Y'                                                           CER001
     C                     MOVELCLAS      WWCLAS                                              CER001
     C                     ELSE                                                               CER001
     C                     MOVE *BLANKS   WWCLAS                                              CER001
     C                     ENDIF                                                              CER001
     C*
     C                     MOVE WWORCC    EXORCC
     C*                                                                   ER0136
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0136
     C                     ADD  1         NREC    30                      ER0136
     C*
     C                     Z-ADDEXAMNT    EXNOMA                          ER1014
     C*
     C* WRITE A RECORD
     C                     WRITEEREXTRF0
     C*
     C*
     C                     ENDSR
     C**************************************************************************
     C* P007 - FORWARD RATE AGREEMENTS PROCESSING                              *
     C**************************************************************************
     C*
     C           P007      BEGSR
     C*
     C** TRANSFORM DEAL DATE IN ABACUSS FORMAT
     C                     Z-ADDDDAT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     EXSTRD
      *                                                                   ULX004
      ***  Start Date                                                     ULX004
      *                                                                   ULX004
     C                     Z-ADDEXSTRD    EXSTDA                          ULX004
     C*
     C** TRANSFORM VALUE DATE IN ABACUSS FORMAT
     C*********************Z-ADDVDAT      @@DAYN                          ULX047
     C                     Z-ADDMDAT      @@DAYN                          ULX047
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     EXENDD
      *                                                                   ULX004
      ***  Data B                                                         ULX004
      *                                                                   ULX004
     C                     Z-ADDEXENDD    EXDATB                          ULX004
     C*
     C** SETUP REVISION DATE                                              054793
     C*********************Z-ADDMDAT      @@DAYN                   054793 ULX047
     C                     Z-ADDVDAT      @@DAYN                          ULX047
     C                     EXSR ZDATE9                                    054793
     C                     Z-ADD@@VDT     EXREVD                          054793
      *                                                                   ULX004
      ***  Data A                                                         ULX004
      *                                                                   ULX004
     C                     Z-ADDEXREVD    EXDATA                          ULX004
      *
     C                     MOVE 'FRA'     EXLOTD
     C                     Z-ADD0         EXIRTT
     C                     Z-ADD0         EXNIFD                          CAD007
      *                                                                   143793
      ** Set up accruals                                                  143793
     C           *IN89     IFEQ '1'                        - B1           143793
     C                     Z-ADD*ZEROS    EXACCR                          143793
     C                     Z-ADD*ZEROS    EXITAC                          143793
     C                     ELSE                            - X1           143793
     C           URTPI     IFEQ 'Y'                        - B2           143793
     C           TRTPI     ANDEQ'Y'                                       143793
     C           TAMAD     IFEQ 0                          - B3           143793
     C           TAMTA     ANDEQ0                                         143793
     C                     Z-ADDAMAD      WWACCR 160                      143793
     C                     Z-ADDAMTA      WWITAC 160                      143793
     C                     ELSE                            - X3           143793
     C                     Z-ADDTAMAD     WWACCR                          143793
     C                     Z-ADDTAMTA     WWITAC                          143793
     C                     EXSR ACCRSR                                    143793
     C                     END                             - E3           143793
     C                     END                             - E2           143793
     C                     END                             - E1           143793
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  If buy-Sell indicator is equal to 'B'                          CEU007
      ***  take the settlement currency                                   CEU007
      *                                                                   CEU007
     C           BYSL      IFEQ 'B'                        B2             CEU007
     C                     MOVELPSCY      SUSTCY  3                       CEU007
     C                     ELSE                            E2             CEU007
     C                     MOVELRSCY      SUSTCY                          CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      ***  If buy-Sell indicator is equal to 'B'                          CEU007
      *                                                                   CEU007
     C******     BYSL      IFEQ 'B'                        B2      CEU007 161739
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           SUSTCY    IFEQ *BLANKS                    B2             CEU007
     C                     MOVELUCUCY     UUCYCD                          CEU007
     C                     ELSE                            X2             CEU007
     C                     MOVELSUSTCY    UUCYCD                          CEU007
     C                     ENDIF                           E2             CEU007
     C           BYSL      IFEQ 'B'                        B2             161739
      *                                                                   CEU007
     C***********PSTM      IFEQ 1                          B3      CEU007 152952
     C***********PSTM      OREQ 2                                  CEU007 152952
     C***********PSTM      OREQ 7                                  CEU007 152952
     C***********PSTM      OREQ 8                                  CEU007 152952
     C***********PSTM      OREQ 12                                 CEU007 152952
     C           PSETM     IFEQ 1                          B3             152952
     C           PSETM     OREQ 2                                         152952
     C           PSETM     OREQ 7                                         152952
     C           PSETM     OREQ 8                                         152952
     C           PSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc.            CEU007
      *                                                                   CEU007
     C*********************MOVELPONS      UUNONB                   CEU007 152952
     C                     MOVELUPACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C*********************MOVELWWNOSC    EXEDLO    En.Dat.Sett.LocCEU007 152952
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.Loc152952
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of Review date Ccy and Loc.         CEU007
      *                                                                   CEU007
     C***********RSTM      IFEQ 1                          B3      CEU007 152952
     C***********RSTM      OREQ 2                                  CEU007 152952
     C***********RSTM      OREQ 7                                  CEU007 152952
     C***********RSTM      OREQ 8                                  CEU007 152952
     C***********RSTM      OREQ 12                                 CEU007 152952
     C           RSETM     IFEQ 1                          B3             152952
     C           RSETM     OREQ 2                                         152952
     C           RSETM     OREQ 7                                         152952
     C           RSETM     OREQ 8                                         152952
     C           RSETM     OREQ 12                                        152952
      *                                                                   CEU007
     C*********************MOVELRONS      UUNONB                   CEU007 152952
     C                     MOVELURACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ELSE                            X2     SELL    CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc.            CEU007
      *                                                                   CEU007
     C***********RSTM      IFEQ 1                          B3      CEU007 152952
     C***********RSTM      OREQ 2                                  CEU007 152952
     C***********RSTM      OREQ 7                                  CEU007 152952
     C***********RSTM      OREQ 8                                  CEU007 152952
     C***********RSTM      OREQ 12                                 CEU007 152952
     C           RSETM     IFEQ 1                          B3             152952
     C           RSETM     OREQ 2                                         152952
     C           RSETM     OREQ 7                                         152952
     C           RSETM     OREQ 8                                         152952
     C           RSETM     OREQ 12                                        152952
      *                                                                   CEU007
     C*********************MOVELRONS      UUNONB                   CEU007 152952
     C                     MOVELURACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of Review date Ccy and Loc.         CEU007
      *                                                                   CEU007
     C***********PSTM      IFEQ 1                          B3      CEU007 152952
     C***********PSTM      OREQ 2                                  CEU007 152952
     C***********PSTM      OREQ 7                                  CEU007 152952
     C***********PSTM      OREQ 8                                  CEU007 152952
     C***********PSTM      OREQ 12                                 CEU007 152952
     C           PSETM     IFEQ 1                          B3             152952
     C           PSETM     OREQ 2                                         152952
     C           PSETM     OREQ 7                                         152952
     C           PSETM     OREQ 8                                         152952
     C           PSETM     OREQ 12                                        152952
      *                                                                   CEU007
     C*********************MOVELPONS      UUNONB                   CEU007 152952
     C                     MOVELUPACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C*
     C** IF BUY-SELL INDICATOR IS EQUAL TO 'B'
     C***********BYSL      IFEQ 'B'                        - B1           ER0302
     C*********************Z-ADD1         EXDRCR                          ER0302
     C*********************ELSE                            - X1           ER0302
     C*********************Z-ADD0         EXDRCR                          ER0302
     C*********************END                             - E1           ER0302
     C*
     C** DRCR MUST BE SET UP ACCORDING TO BOUGHT/SOLD INDICATOR           068452
     C           BYSL      IFEQ 'B'                                       068452
     C***********          Z-ADD1         EXDRCR                   068452 ULX047
     C                     Z-ADD0         EXDRCR                          ULX047
      *                                                                   ULX004
      ***   Long/Short Position Indicator 1                               ULX004
      *                                                                   ULX004
     C***********          Z-ADD2         EXLSP1                   ULX004 ULX047
     C                     Z-ADD1         EXLSP1                          ULX047
      *                                                                   ULX004
      ***   Coupon rate, Our Effective Interest Rate                      ULX004
      *                                                                   ULX004
     C                     Z-ADDUEINR     EXCPNR    H                     ULX004
      *                                                                   ULX004
     C                     MOVE *BLANKS   EXREFR                          CAD007
      *                                                                   CAD007
     C********** TBRTT     IFNE *ZERO                                                  CAD007 CSD103
     C           TBRTT     IFNE *BLANKS                                                       CSD103
     C                     Z-ADD2         EXIRTT                          CAD007
     C                     MOVE UCUCY     KKCCY                           CAD007
     C                     MOVE TBRTT     KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C                     ELSE                                           CAD007
     C                     Z-ADD1         EXIRTT                          CAD007
     C                     END                                            CAD007
      *                                                                   CAD007
     C                     ELSE                                           068452
     C***********          Z-ADD0         EXDRCR                   ER0302 ULX047
     C                     Z-ADD1         EXDRCR                          ULX047
      *                                                                   ULX004
      ***   Long/Short Position Indicator 1                               ULX004
      *                                                                   ULX004
     C***********          Z-ADD1         EXLSP1                   ULX004 ULX047
     C                     Z-ADD2         EXLSP1                          ULX047
      *                                                                   ULX004
      ***   Coupon rate, Their Effective Interest Rate                    ULX004
      *                                                                   ULX004
     C                     Z-ADDTEINR     EXCPNR    H                     ULX004
      *                                                                   ULX004
     C********** UBRTT     IFNE *ZERO                                                  CAD007 CSD103
     C           UBRTT     IFNE *BLANKS                                                       CSD103
     C                     Z-ADD2         EXIRTT                          CAD007
     C                     MOVE UCUCY     KKCCY                           CAD007
     C                     MOVE UBRTT     KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C                     ELSE                                           CAD007
     C                     Z-ADD1         EXIRTT                          CAD007
     C                     END                                            CAD007
      *                                                                   CAD007
     C                     END                                            068452
      *
     C                     ENDSR
     C**************************************************************************
     C* P008 - INTEREST RATE SWAP PROCESSING                                   *
     C**************************************************************************
     C*
     C           P008      BEGSR
     C*
     C** TRANSFORM VALUE DATE IN ABACUSS FORMAT
     C                     Z-ADDVDAT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     EXSTRD
      *                                                                   ULX004
      ***  Start Date                                                     ULX004
      *                                                                   ULX004
     C                     Z-ADDEXSTRD    EXSTDA                          ULX004
      *                                                                   ULX004
      ***  Data B                                                         ULX004
      *                                                                   ULX004
     C***********DTYP      IFEQ 'RP'                               ULX004 CAD007
     C***********DTYP      OREQ 'RF'                               ULX004 CAD007
     C                     Z-ADDEXSTRD    EXDATB                          ULX004
     C***********          ELSE                                    ULX004 CAD007
     C***********          Z-ADD0         EXDATB                   ULX004 CAD007
     C***********          ENDIF                                   ULX004 CAD007
     C*
     C** TRANSFORM MATURITY DATE IN ABACUSS FORMAT
     C                     Z-ADDMDAT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     EXENDD
      *                                                                   ULX004
      ***  Final Maturity Date of a Swap                                  ULX004
      *                                                                   ULX004
     C           DTYP      IFEQ 'RS'                                      ULX004
     C           DTYP      OREQ 'RX'                                      ULX004
     C                     Z-ADDEXENDD    EXFMSW                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD0         EXFMSW                          ULX004
     C                     ENDIF                                          ULX004
      *                                                                   143793
      ** Set up accruals                                                  143793
     C           DTYP      IFEQ 'RS'                       - B1           143793
     C           DTYP      OREQ 'RX'                                      143793
     C           *IN89     IFEQ '1'                        - B2           143793
     C                     Z-ADD*ZEROS    EXACCR                          143793
     C                     Z-ADD*ZEROS    EXITAC                          143793
     C                     ELSE                            - X2           143793
     C                     Z-ADDAMAD      WWACCR                          143793
     C                     Z-ADDAMTA      WWITAC                          143793
     C                     EXSR ACCRSR                                    143793
     C                     END                             - E2           143793
     C                     END                             - E1           143793
     C*
     C** SETUP REVISION DATE                                              054793
     C           UNICD     IFNE *ZEROS                                    054793
     C                     Z-ADDUNICD     @@DAYN                          054793
     C                     EXSR ZDATE9                                    054793
     C                     Z-ADD@@VDT     EXREVD                          054793
     C                     ELSE                                           054793
     C                     Z-ADDEXENDD    EXREVD                          054793
     C                     END                                            054793
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
     C***********PSTM      IFEQ 1                          B3      CEU007 152952
     C***********PSTM      OREQ 2                                  CEU007 152952
     C***********PSTM      OREQ 7                                  CEU007 152952
     C***********PSTM      OREQ 8                                  CEU007 152952
     C***********PSTM      OREQ 12                                 CEU007 152952
     C           PSETM     IFEQ 1                          B3             152952
     C           PSETM     OREQ 2                                         152952
     C           PSETM     OREQ 7                                         152952
     C           PSETM     OREQ 8                                         152952
     C           PSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           PSCY      IFEQ *BLANKS                    B3             CEU007
     C                     MOVELUCUCY     UUCYCD                          CEU007
     C                     ELSE                            X3             CEU007
     C                     MOVELPSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc. (First Record)                        CEU007
      *                                                                   CEU007
     C*********************MOVELPONS      UUNONB                   CEU007 152952
     C                     MOVELUPACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXRDLO           Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     EXRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     EXRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C***********RSTM      IFEQ 1                          B3      CEU007 152952
     C***********RSTM      OREQ 2                                  CEU007 152952
     C***********RSTM      OREQ 7                                  CEU007 152952
     C***********RSTM      OREQ 8                                  CEU007 152952
     C***********RSTM      OREQ 12                                 CEU007 152952
     C           RSETM     IFEQ 1                          B3             152952
     C           RSETM     OREQ 2                                         152952
     C           RSETM     OREQ 7                                         152952
     C           RSETM     OREQ 8                                         152952
     C           RSETM     OREQ 12                                        152952
      *                                                                   CEU007
     C           RSCY      IFEQ *BLANKS                    B3             CEU007
     C*********************MOVELUCUCY     UUCYCD                   CEU007 152952
     C                     MOVELTCUCY     UUCYCD                          152952
     C                     ELSE                            X3             CEU007
     C                     MOVELRSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc. (Second Record)                       CEU007
      *                                                                   CEU007
     C*********************MOVELRONS      UUNONB                   CEU007 152952
     C                     MOVELURACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      ***  Store the values for the second record                         CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    WWEDCU  3        En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWEDLO  3        En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    WWRDCU  3        Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWRDLO  3        Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     WWRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     WWRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C*
     C                     MOVE 'IRS'     EXLOTD
     C*********************Z-ADD1         EXDRCR                          ERL338
     C           DTYP      IFEQ 'RX'                                      ERL357
     C                     Z-ADD1         EXDRCR                          ERL357
     C                     Z-ADD2         EXLSP2                          ULX004
     C                     Z-ADD1         EXNUND                          ULX004
     C                     ELSE                                           ERL357
     C           DTYP      IFEQ 'RS'                                      068453
     C***********          Z-ADD0         EXDRCR                    ERL338ULX004
     C                     Z-ADD1         EXDRCR                          ULX004
     C                     Z-ADD2         EXLSP2                          ULX004
     C                     Z-ADD1         EXNUND                          ULX004
     C                     END                                            068453
     C                     END                                            ERL357
      *                                                                   ULX004
      ***  Data A                                                         ULX004
      *                                                                   ULX004
     C                     Z-ADDEXENDD    EXDATA                          ULX004
      *                                                                   ULX004
     C***********          SELEC                                          CAD007
     C***********DTYP      WHEQ 'RS'                               ULX004 CAD007
     C***********DTYP      OREQ 'RX'                               ULX004 CAD007
      *                                                                   ULX004
     C********** UBRTT     IFNE 0                                                      ULX004 CSD103
     C           UBRTT     IFNE *BLANKS                                                       CSD103
     C***********UINFD     ANDNE0                                  ULX004 CAD007
     C                     Z-ADDUINFD     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C***********          Z-ADD@@VDT     EXDATA                   ULX004 CAD007
     C                     Z-ADD@@VDT     EXNIFD                          CAD007
     C           EXNIFD    IFEQ *ZERO                                     ULX047
     C                     Z-ADDEXENDD    EXNIFD                          ULX047
     C                     ENDIF                                          ULX047
     C                     ENDIF                                          ULX004
      *
     C***********DTYP      WHEQ 'RR'                               ULX004 CAD007
     C***********          Z-ADD0         EXDATA                   ULX004 CAD007
     C***********          ENDSL                                   ULX004 CAD007
      *
     C*                                                                   068453
     C* FOR*CAPS,*COLLARS*AND FLOORS, DEBIT/CREDIT INDICATOR*MUST*BE068453076678
     C** FOR CAPS, and Collars   DEBIT/CREDIT INDICATOR MUST BE     068453076678
     C** SET UP ACCORDINGLY TO THE BOUGHT/SOLD INDICATOR                  068453
     C           DTYP      IFEQ 'RP'                                      068453
     C           DTYP      OREQ 'RR'                                      068453
     C*          DTYP      OREQ 'RF'                                068453076678
     C           BYSL      IFEQ 'B'                                       068453
     C                     Z-ADD1         EXDRCR                          068453
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
     C***********PSTM      IFEQ 1                          B3      CEU007 152952
     C***********PSTM      OREQ 2                                  CEU007 152952
     C***********PSTM      OREQ 7                                  CEU007 152952
     C***********PSTM      OREQ 8                                  CEU007 152952
     C***********PSTM      OREQ 12                                 CEU007 152952
     C           PSETM     IFEQ 1                          B3             152952
     C           PSETM     OREQ 2                                         152952
     C           PSETM     OREQ 7                                         152952
     C           PSETM     OREQ 8                                         152952
     C           PSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           PSCY      IFEQ *BLANKS                    B3             CEU007
     C                     MOVELUCUCY     UUCYCD                          CEU007
     C                     ELSE                            X3             CEU007
     C                     MOVELPSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc.                                       CEU007
      *                                                                   CEU007
     C*********************MOVELPONS      UUNONB                   CEU007 152952
     C                     MOVELUPACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    WWRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWRDLO           Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     WWRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     WWRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     ELSE                                           068453
     C                     Z-ADD0         EXDRCR                          068453
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
     C***********RSTM      IFEQ 1                          B3      CEU007 152952
     C***********RSTM      OREQ 2                                  CEU007 152952
     C***********RSTM      OREQ 7                                  CEU007 152952
     C***********RSTM      OREQ 8                                  CEU007 152952
     C***********RSTM      OREQ 12                                 CEU007 152952
     C           RSETM     IFEQ 1                          B3             152952
     C           RSETM     OREQ 2                                         152952
     C           RSETM     OREQ 7                                         152952
     C           RSETM     OREQ 8                                         152952
     C           RSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           RSCY      IFEQ *BLANKS                    B3             CEU007
     C*********************MOVELUCUCY     UUCYCD                   CEU007 152952
     C                     MOVELTCUCY     UUCYCD                          152952
     C                     ELSE                            X3             CEU007
     C                     MOVELRSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc.                                       CEU007
      *                                                                   CEU007
     C*********************MOVELRONS      UUNONB                   CEU007 152952
     C                     MOVELURACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    WWRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWRDLO           Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     WWRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     WWRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     END                                            068453
     C                     END                                            068453
      *                                                                   143793
      ** Set up accruals                                                  143793
     C           DTYP      IFEQ 'RP'                       - B1           143793
     C           DTYP      OREQ 'RR'                                      143793
     C           DTYP      OREQ 'RF'                                      143793
     C           *IN89     IFEQ '1'                        - B2           143793
     C                     Z-ADD*ZEROS    EXACCR                          143793
     C                     Z-ADD*ZEROS    EXITAC                          143793
     C                     ELSE                            - X2           143793
     C           URTPI     IFEQ 'Y'                        - B3           143793
     C********** XUBRTT    ANDNE0                                                      143793 CSD103
     C           XUBRTT    ANDNE*BLANKS                                                       CSD103
     C           TRTPI     OREQ 'Y'                                       143793
     C********** XTBRTT    ANDNE0                                                      143793 CSD103
     C           XTBRTT    ANDNE*BLANKS                                                       CSD103
     C           TAMAD     IFEQ 0                          - B4           143793
     C           TAMTA     ANDEQ0                                         143793
     C                     Z-ADDAMAD      WWACCR                          143793
     C                     Z-ADDAMTA      WWITAC                          143793
     C                     ELSE                            - X4           143793
     C                     Z-ADDTAMAD     WWACCR                          143793
     C                     Z-ADDTAMTA     WWITAC                          143793
     C                     EXSR ACCRSR                                    143793
     C                     END                             - E4           143793
     C                     END                             - E3           143793
     C                     END                             - E2           143793
     C                     END                             - E1           143793
     C*                                                                   076678
     C** FOR FLOORS              DEBIT/CREDIT INDICATOR MUST BE           076678
     C** SET UP ACCORDINGLY TO THE BOUGHT/SOLD INDICATOR                  076678
     C           DTYP      IFEQ 'RF'                                      076678
     C           BYSL      IFEQ 'B'                                       076678
     C                     Z-ADD0         EXDRCR                          076678
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
     C***********PSTM      IFEQ 1                          B3      CEU007 152952
     C***********PSTM      OREQ 2                                  CEU007 152952
     C***********PSTM      OREQ 7                                  CEU007 152952
     C***********PSTM      OREQ 8                                  CEU007 152952
     C***********PSTM      OREQ 12                                 CEU007 152952
     C           PSETM     IFEQ 1                          B3             152952
     C           PSETM     OREQ 2                                         152952
     C           PSETM     OREQ 7                                         152952
     C           PSETM     OREQ 8                                         152952
     C           PSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           PSCY      IFEQ *BLANKS                    B3             CEU007
     C                     MOVELUCUCY     UUCYCD                          CEU007
     C                     ELSE                            X3             CEU007
     C                     MOVELPSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc.                                       CEU007
      *                                                                   CEU007
     C*********************MOVELPONS      UUNONB                   CEU007 152952
     C                     MOVELUPACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD    CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    WWRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWRDLO           Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     WWRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     WWRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     ELSE                                           076678
     C                     Z-ADD1         EXDRCR                          076678
      *                                                                   CEU007
      *** If the feature CEU007 is installed, filling the new fields      CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
     C***********RSTM      IFEQ 1                          B3      CEU007 152952
     C***********RSTM      OREQ 2                                  CEU007 152952
     C***********RSTM      OREQ 7                                  CEU007 152952
     C***********RSTM      OREQ 8                                  CEU007 152952
     C***********RSTM      OREQ 12                                 CEU007 152952
     C           RSETM     IFEQ 1                          B3             152952
     C           RSETM     OREQ 2                                         152952
     C           RSETM     OREQ 7                                         152952
     C           RSETM     OREQ 8                                         152952
     C           RSETM     OREQ 12                                        152952
      *                                                                   CEU007
      ***  If settlement currency is blank use the transaction            CEU007
      ***  currency for access nostro                                     CEU007
      *                                                                   CEU007
     C           RSCY      IFEQ *BLANKS                    B3             CEU007
     C*********************MOVELUCUCY     UUCYCD                   CEU007 152952
     C                     MOVELTCUCY     UUCYCD                          152952
     C                     ELSE                            X3             CEU007
     C                     MOVELRSCY      UUCYCD                          CEU007
     C                     ENDIF                           E3             CEU007
      *                                                                   CEU007
      ***  Access SDNOSTPD for set up of End date Ccy and Loc,            CEU007
      ***  Review date Ccy and Loc.                                       CEU007
      *                                                                   CEU007
     C*********************MOVELRONS      UUNONB                   CEU007 152952
     C                     MOVELURACC     UUNONB                          152952
      *                                                                   CEU007
     C                     EXSR NOSTRO                                    CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  A7CYCD from PF/NOSTROPD for the ccy                            CEU007
      ***  3Last digist of the nostro shortname A7NOSN from PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELWWNOSC    EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    EXEDLO           En.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C***********UNICD     IFEQ *ZEROS                     B3      CEU007 152952
     C                     MOVELWWNOSC    WWRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELWWNOSL    WWRDLO           Re.Dat.Sett.LocCEU007
     C*********************ELSE                            X3      CEU007 152952
     C*********************MOVELUCUCY     WWRDCU    Re.Dat.Sett.CcyCEU007 152952
     C*********************MOVELTCUCY     WWRDLO    Re.Dat.Sett.LocCEU007 152952
     C*********************ENDIF                           E3      CEU007 152952
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     END                                            076678
     C                     END                                            076678
     C*                                                                   CAD007
     C                     MOVE *BLANKS   EXREFR                          CAD007
     C*
     C** IF OUR BASE RATE TYPE IS EQUAL TO BLANK
     C********** UBRTT     IFEQ *ZEROS                     - B1                               CSD103
     C           UBRTT     IFEQ *BLANKS                    - B1                               CSD103
     C                     Z-ADD1         EXIRTT
     C                     ELSE                            - X1
     C                     Z-ADD2         EXIRTT
     C                     MOVE UCUCY     KKCCY                           CAD007
     C                     MOVE UBRTT     KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C                     END                             - E1
      *                                                                   ULX004
      ***   Long/Short Position Indicator 1                               ULX004
      *                                                                   ULX004
     C           DTYP      IFEQ 'RP'                                      ULX004
     C           BYSL      IFEQ 'B'                                       ULX004
     C                     Z-ADD2         EXLSP1                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD1         EXLSP1                          ULX004
     C                     ENDIF                                          ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
      ***   Long/Short Position Indicator 1                               ULX004
      *                                                                   ULX004
     C           DTYP      IFEQ 'RF'                                      ULX004
     C           BYSL      IFEQ 'B'                                       ULX004
     C                     Z-ADD1         EXLSP1                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD2         EXLSP1                          ULX004
     C                     ENDIF                                          ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
      * Coupon rate,                                                      ULX004
      * Following the deat type, buy/sell indicator, store 'Our effective ULX004
      * interest rate' or 'Their effective interest rate' in the coupon   ULX004
      * rate.                                                             ULX004
      *                                                                   ULX004
     C                     SELEC                                          ULX004
     C           DTYP      WHEQ 'RF'                                      ULX004
     C           BYSL      IFEQ 'B'                                       ULX004
     C                     Z-ADDUEINR     EXCPNR    H                     ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADDTEINR     EXCPNR    H                     ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
     C           DTYP      WHEQ 'RP'                                      ULX004
     C           DTYP      OREQ 'RR'                                      ULX004
     C           BYSL      IFEQ 'B'                                       ULX004
     C                     Z-ADDTEINR     EXCPNR    H                     ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADDUEINR     EXCPNR    H                     ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
     C           DTYP      WHEQ 'RS'                                      ULX004
     C           DTYP      OREQ 'RX'                                      ULX004
     C                     Z-ADDUEINR     EXCPNR    H                     ULX004
     C                     ENDSL                                          ULX004
      *                                                                   ULX047
      ***  Net present value for 'Our' leg                                ULX047
      *                                                                   ULX047
     C                     Z-ADD0         EXMKT1                          ULX047
      *                                                                   ULX047
     C           WWIN88    IFEQ 'Y'                                       ULX047
      *                                                                   ULX047
     C           DTYP      IFEQ 'RX'                       - B2           ULX047
      *                                                                   ULX047
     C           WWNBDP    IFEQ 0                          - B3           ULX047
     C           IROPRV    MULT 1000      EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           WWNBDP    IFEQ 1                          - B3           ULX047
     C           IROPRV    MULT 100       EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           WWNBDP    IFEQ 2                          - B3           ULX047
     C           IROPRV    MULT 10        EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           WWNBDP    IFEQ 3                          - B3           ULX047
     C                     Z-ADDIROPRV    EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
      *                                                                   ULX047
     C                     ELSE                                           ULX047
      *                                                                   ULX047
     C           A6NBDP    IFEQ 0                          - B3           ULX047
     C           IROPRV    MULT 1000      EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           A6NBDP    IFEQ 1                          - B3           ULX047
     C           IROPRV    MULT 100       EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           A6NBDP    IFEQ 2                          - B3           ULX047
     C           IROPRV    MULT 10        EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
     C           A6NBDP    IFEQ 3                          - B3           ULX047
     C                     Z-ADDIROPRV    EXMKT1                          ULX047
     C                     ENDIF                           - E3           ULX047
      *                                                                   ULX047
     C                     ENDIF                           - E2           ULX047
      *                                                                   ULX047
     C                     ENDIF                           - E1           ULX047
      *
     C                     ENDSR
     C**************************************************************************
     C* P009 - SINGLE CURRENCY INTEREST RATE SWAP PROCESSING                   *
     C**************************************************************************
     C*
     C           P009      BEGSR
     C*
     C** STORE THEIR AMOUNT IN SINGLE CURRENCY
     C           A6NBDP    IFEQ 0                          - B2
     C           TPAMT     MULT 1000      EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 1                          - B2
     C           TPAMT     MULT 100       EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 2                          - B2
     C           TPAMT     MULT 10        EXAMNT
     C                     END                             - E2
     C           TPAMT     IFEQ 3                          - B2
     C                     Z-ADDTPAMT     EXAMNT
     C                     END                             - E2
      *                                                                   ULX047
      ***  Net present value for 'Our' leg                                ULX047
      *                                                                   ULX047
     C                     Z-ADD0         EXMKT1                          ULX047
      *                                                                   ULX047
     C           WWIN88    IFEQ 'Y'                        - B1           ULX047
      *                                                                   ULX047
     C           A6NBDP    IFEQ 0                          - B2           ULX047
     C           IRTPRV    MULT 1000      EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           A6NBDP    IFEQ 1                          - B2           ULX047
     C           IRTPRV    MULT 100       EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           A6NBDP    IFEQ 2                          - B2           ULX047
     C           IRTPRV    MULT 10        EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           A6NBDP    IFEQ 3                          - B2           ULX047
     C                     Z-ADDIRTPRV    EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
      *                                                                   ULX047
     C                     ENDIF                           - E1           ULX047
      *                                                                   143793
      ** Set up accruals                                                  143793
     C           *IN89     IFEQ '1'                        - B1           143793
     C                     Z-ADD*ZEROS    EXACCR                          143793
     C                     Z-ADD*ZEROS    EXITAC                          143793
     C                     ELSE                            - X1           143793
     C                     Z-ADDTAMAD     WWACCR                          143793
     C                     Z-ADDTAMTA     WWITAC                          143793
     C                     EXSR ACCRSR                                    143793
     C                     END                             - E1           143793
      *                                                                   ULX004
      ***  Original Contract Value                                        ULX004
      *                                                                   ULX004
     C                     Z-ADDEXAMNT    EXORCV                          ULX004
      *
      *
      ** SETUP REVISION DATE                                              054793
     C           TNICD     IFNE *ZEROS                                    054793
     C                     Z-ADDTNICD     @@DAYN                          054793
     C                     EXSR ZDATE9                                    054793
     C                     Z-ADD@@VDT     EXREVD                          054793
     C                     ELSE                                           054793
     C                     Z-ADDEXENDD    EXREVD                          054793
     C                     END                                            054793
      *                                                                   ULX004
      ***  Data A                                                         ULX004
      *                                                                   ULX004
     C                     Z-ADDEXENDD    EXDATA                          ULX004
      *                                                                   CAD007
     C                     Z-ADD0         EXNIFD                          CAD007
     C********** TBRTT     IFNE 0                                                      ULX004 CSD103
     C           TBRTT     IFNE *BLANKS                                                       CSD103
     C***********TINFD     ANDNE0                                  ULX004 CAD007
     C                     Z-ADDTINFD     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C***********          Z-ADD@@VDT     EXDATA                   ULX004 CAD007
     C                     Z-ADD@@VDT     EXNIFD                          CAD007
     C           EXNIFD    IFEQ *ZERO                                     ULX047
     C                     Z-ADDEXENDD    EXNIFD                          ULX047
     C                     ENDIF                                          ULX047
     C                     ENDIF                                          ULX004
     C*
     C                     MOVE 'IRS'     EXLOTD
     C*********************Z-ADD0         EXDRCR                          ER0352
     C***********          Z-ADD1         EXDRCR                    ER0352ULX004
     C                     Z-ADD0         EXDRCR                          ULX004
     C                     Z-ADD1         EXLSP2                          ULX004
     C*                                                                   CAD007
     C                     MOVE *BLANKS   EXREFR                          CAD007
     C*
     C** IF THEIR BASE RATE TYPE IS EQUAL TO BLANK
     C********** TBRTT     IFEQ *ZEROS                     - B1                               CSD103
     C           TBRTT     IFEQ *BLANKS                    - B1                               CSD103
     C                     Z-ADD1         EXIRTT
     C                     ELSE                            - X1
     C                     Z-ADD2         EXIRTT
     C                     MOVE UCUCY     KKCCY                           CAD007
     C                     MOVE TBRTT     KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C                     END                             - E1
      *                                                                   ULX004
      * Coupon rate,                                                      ULX004
      * 'Their effective interest rate' in the coupon rate                ULX004
      *                                                                   ULX004
     C                     Z-ADDTEINR     EXCPNR    H                     ULX004
     C*
     C** WRITE A SECOND RECORD
     C                     EXSR W001
     C*
     C                     ENDSR
     C**************************************************************************
     C* P010 - CROSS CURRENCY INTEREST RATE SWAP PROCESSING                    *
     C**************************************************************************
     C*
     C           P010      BEGSR
     C*
     C** STORE THEIR AMOUNT IN THEIR CURRENCY
     C           TCUCY     CHAINSDCURRL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'009'     DBASE            *****************
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 09 **
     C                     MOVELTCUCY     DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C** STORE THEIR CURRENCY
     C                     MOVE TCUCY     EXCCYC
     C*
     C** STORE OUR CURRENCY                                               ER0319
     C                     MOVE UCUCY     EXCCY2                          ER0319
     C*
     C           A6NBDP    IFEQ 0                          - B2
     C           TPAMT     MULT 1000      EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 1                          - B2
     C           TPAMT     MULT 100       EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 2                          - B2
     C           TPAMT     MULT 10        EXAMNT
     C                     END                             - E2
     C           TPAMT     IFEQ 3                          - B2
     C                     Z-ADDTPAMT     EXAMNT
     C                     END                             - E2
      *                                                                   ULX047
      ***  Net present value for 'Our' leg (in base currency for RX)      ULX047
      *                                                                   ULX047
     C                     Z-ADD0         EXMKT1                          ULX047
      *                                                                   ULX047
     C           WWIN88    IFEQ 'Y'                        - B1           ULX047
      *                                                                   ULX047
     C           WWNBDP    IFEQ 0                          - B2           ULX047
     C           IRTPRV    MULT 1000      EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           WWNBDP    IFEQ 1                          - B2           ULX047
     C           IRTPRV    MULT 100       EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           WWNBDP    IFEQ 2                          - B2           ULX047
     C           IRTPRV    MULT 10        EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
     C           WWNBDP    IFEQ 3                          - B2           ULX047
     C                     Z-ADDIRTPRV    EXMKT1                          ULX047
     C                     ENDIF                           - E2           ULX047
      *                                                                   ULX047
     C                     ENDIF                           - E1           ULX047
      *                                                                   143793
      ** Accrued Interest and Interest to accrue                          143793
     C                     Z-ADDDLNO      KDLNO                           143793
     C                     MOVE TCUCY     KCCY                            143793
     C********** KACCR     CHAINACCEXAL3             89                   143793              CER001
     C           KACCR     CHAINDLACOXL1             89                                       CER001
     C           *IN89     IFEQ '1'                        - B1           143793
     C                     Z-ADD*ZEROS    EXACCR                          143793
     C                     Z-ADD*ZEROS    EXITAC                          143793
     C                     ELSE                            - X1           143793
     C                     Z-ADDTAMAD     WWACCR                          143793
     C                     Z-ADDTAMTA     WWITAC                          143793
     C                     EXSR ACCRSR                                    143793
     C                     END                             - E1           143793
      *                                                                   ULX004
      ***  Original Contract Value                                        ULX004
      *                                                                   ULX004
     C                     Z-ADDEXAMNT    EXORCV                          ULX004
      *
      ** SETUP REVISION DATE                                              054793
     C           TNICD     IFNE *ZEROS                                    054793
     C                     Z-ADDTNICD     @@DAYN                          054793
     C                     EXSR ZDATE9                                    054793
     C                     Z-ADD@@VDT     EXREVD                          054793
     C                     ELSE                                           054793
     C                     Z-ADDEXENDD    EXREVD                          054793
     C                     END                                            054793
      *                                                                   ULX004
      ***  Data A                                                         ULX004
      *                                                                   ULX004
     C                     Z-ADDEXENDD    EXDATA                          ULX004
      *                                                                   CAD007
     C                     Z-ADD0         EXNIFD                          CAD007
     C********** TBRTT     IFNE 0                                                      ULX004 CSD103
     C           TBRTT     IFNE *BLANKS                                                       CSD103
     C***********TINFD     ANDNE0                                         CAD007
     C                     Z-ADDTINFD     @@DAYN                   ULX004 CAD007
     C                     EXSR ZDATE9                                    ULX004
     C***********          Z-ADD@@VDT     EXDATA                   ULX004 CAD007
     C                     Z-ADD@@VDT     EXNIFD                          CAD007
     C           EXNIFD    IFEQ *ZERO                                     ULX047
     C                     Z-ADDEXENDD    EXNIFD                          ULX047
     C                     ENDIF                                          ULX047
     C                     ENDIF                                          ULX004
     C*
     C                     MOVE 'IRS'     EXLOTD
     C*********************Z-ADD0         EXDRCR                          ER0352
     C*********************Z-ADD1         EXDRCR                   ER0352 ERL357
     C                     Z-ADD0         EXDRCR                          ERL357
     C                     Z-ADD1         EXLSP2                          ULX004
     C*                                                                   CAD007
     C                     MOVE *BLANKS   EXREFR                          CAD007
     C*
     C** IF THEIR BASE RATE TYPE IS EQUAL TO BLANK
     C********** TBRTT     IFEQ *ZEROS                     - B1                               CSD103
     C           TBRTT     IFEQ *BLANKS                    - B1                               CSD103
     C                     Z-ADD1         EXIRTT
     C                     ELSE                            - X1
     C                     Z-ADD2         EXIRTT
     C                     MOVE TCUCY     KKCCY                           CAD007
     C                     MOVE TBRTT     KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C                     END                             - E1
     C***********                                                  ULX004 143793
     C***Accrued*Interest and Interest to accrue                   ULX004 143793
     C***********DLNO      CHAINACCEXAL3             88            ULX004 143793
     C************IN88     IFEQ '1'                        - B1    ULX004 143793
     C***********          Z-ADD*ZEROS    EXACCR                   ULX004 143793
     C***********          Z-ADD*ZEROS    EXITAC                   ULX004 143793
     C***********          ELSE                            - X1    ULX004 143793
     C***********                                                  ULX004 143793
     C***********A6NBDP    IFEQ 0                          - B2    ULX004 143793
     C***********TAMAD     MULT 1000      EXACCR                   ULX004 143793
     C***********TAMTA     MULT 1000      EXITAC                   ULX004 143793
     C***********          END                             - E2    ULX004 143793
     C***********A6NBDP    IFEQ 1                          - B2    ULX004 143793
     C***********TAMAD     MULT 100       EXACCR                   ULX004 143793
     C***********TAMTA     MULT 100       EXITAC                   ULX004 143793
     C***********          END                             - E2    ULX004 143793
     C***********A6NBDP    IFEQ 2                          - B2    ULX004 143793
     C***********TAMAD     MULT 10        EXACCR                   ULX004 143793
     C***********TAMTA     MULT 10        EXITAC                   ULX004 143793
     C***********          END                             - E2    ULX004 143793
     C***********A6NBDP    IFEQ 3                          - B2    ULX004 143793
     C***********          Z-ADDTAMAD     EXACCR                   ULX004 143793
     C***********          Z-ADDTAMTA     EXITAC                   ULX004 143793
     C***********          END                             - E2    ULX004 143793
     C***********          END                             - E1    ULX004 143793
     C*                                                                   ULX004
     C** Start/Last Interest Date                                         ULX004
     C                     Z-ADDTSLIP     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXSLID                          ULX004
     C*                                                                   ULX004
     C** Next Interest Due Date                                           ULX004
     C                     Z-ADDTNIPD     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADD@@VDT     EXNIDT                          ULX004
     C*                                                                   ULX004
     C** Retail Indicators                                                ULX004
     C                     MOVE *BLANKS   EXRETB                          ULX004
      *                                                                   ULX004
      * Coupon rate,                                                      ULX004
      * 'Their effective interest rate' in the coupon rate                ULX004
      *                                                                   ULX004
     C                     Z-ADDTEINR     EXCPNR    H                     ULX004
     C*
     C** WRITE A SECOND RECORD
     C                     EXSR W001
     C*
     C                     ENDSR
     C********************************************************************CAD007
     C* BSRTSR - ACCESS TO THE BASE RATE CODES                            CAD007
     C********************************************************************CAD007
     C           BSRTSR    BEGSR                                          CAD007
     C*                                                                   CAD007
     C           KBSRT     CHAINSDBSRTL1             88                   CAD017
     C           *IN88     IFEQ '0'                                       CAD007
     C                     MOVELBABSRN    EXREFR                          CAD007
     C                     END                                            CAD007
     C*                                                                   CAD007
     C                     ENDSR                                          CAD007
     C********************************************************************143793
     C* ACCRSR - TO SET UP ACCRUAL AMOUNTS                                143793
     C********************************************************************143793
     C           ACCRSR    BEGSR                                          143793
     C*                                                                   143793
     C           A6NBDP    IFEQ 0                          - B1           143793
     C           WWACCR    MULT 1000      EXACCR                          143793
     C           WWITAC    MULT 1000      EXITAC                          143793
     C                     END                             - E1           143793
     C           A6NBDP    IFEQ 1                          - B1           143793
     C           WWACCR    MULT 100       EXACCR                          143793
     C           WWITAC    MULT 100       EXITAC                          143793
     C                     END                             - E1           143793
     C           A6NBDP    IFEQ 2                          - B1           143793
     C           WWACCR    MULT 10        EXACCR                          143793
     C           WWITAC    MULT 10        EXITAC                          143793
     C                     END                             - E1           143793
     C           A6NBDP    IFEQ 3                          - B1           143793
     C                     Z-ADDWWACCR    EXACCR                          143793
     C                     Z-ADDWWITAC    EXITAC                          143793
     C                     END                             - E1           143793
     C*                                                                   143793
     C                     ENDSR                                          143793
     C**=================================================================
      **
      **  #INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
      **              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
     C**
      **     CALLED BY PROGRAM
      **     CALLS     *PSSR
      **
     C**=================================================================
     C**                                                   *****************
     C           #INIT     BEGSR                           ** #INIT BEGSR **
     C**                                                   *****************
     C**  PREPARE LDA:
     C**
     C           *NAMVAR   DEFN           LDA                             ULX004
     C*******              MOVEL*BLANK    DBLOT                           ULX004
     C                     MOVEL'ER0626'  DBPGM
      *                                                                   CAD007
     C           KBSRT     KLIST                                          CAD007
     C                     KFLD           KKCCY   3        * Currency     CAD007
     C                     KFLD           KKBSRT  2        * Base Rate    CAD007
      *                                                                   143793
     C           KACCR     KLIST                                          143793
     C                     KFLD           KDLNO   60       * Deal nr.     143793
     C                     KFLD           KCCY    3        * Currency     143793
     C*
     C** INITIALIZE WORK FIELD FOR BRANCH
     C***********          Z-ADD0         WWBRCD                          ER_R10
     C                     MOVEL*BLANKS   WWBRCD                          ULX004
     C*                                                                   ER0136
     C** INITIALIZE WORK FIELD FOR NUMBER OF EXTRACTED RECORDS            ER0136
     C                     Z-ADD0         NREC                            ER0136
     C*
     C**  INITIALIZE INDICATORS:
     C                     MOVE '0'       *IN
     C**
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C                     READ SDBANKL1                 81
     C**
     C**  IF RECORD NOT FOUND:
     C           *IN81     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'001'     DBASE            *****************
     C                     MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
      *                                                                   CEU007
      ***  Check if the feature CEU007 is installed.                      CEU007
      *                                                                   CEU007
     C                     MOVEL'N'       CEU007  1                       CEU007
     C                     CALL 'AOSARDR0'                                CEU007
     C                     PARM '       ' @RTCD   7                       CEU007
     C                     PARM '*VERIFY' @OPTN   7                       CEU007
     C                     PARM 'CEU007'  @SARD   6                       CEU007
      *                                                                   CEU007
     C           @RTCD     IFEQ *BLANKS                                   CEU007
      *                                                                   CEU007
      ***  It's existing.                                                 CEU007
      *                                                                   CEU007
     C                     MOVEL'Y'       CEU007                          CEU007
      *                                                                   CEU007
     C                     ENDIF                                          CEU007
      *                                                                                       CER001
      ** Check for switchable feature                                                         CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD   7                                           CER001
     C                     PARM '*VERIFY' POPTN   7                                           CER001
     C                     PARM 'CDL038'  PSARD   6                                           CER001
     C           SCSARD    PARM SCSARD    UUFDY                                               CER001
      *                                                                                       CER001
     C           PRTCD     IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       CDL038  1                                           CER001
     C                     ELSE                                                               CER001
     C                     MOVE 'N'       CDL038                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C*                                                                   109278
     C** RETRIEVE BASE CURRENCY DECIMAL PLACES                            109278
     C           BJCYCD    CHAINSDCURRL1             88                   109278
     C           *IN88     IFEQ '1'                        - B2           109278
     C                     MOVEL'005'     DBASE            ***************109278
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 05 109278
     C                     MOVELUCUCY     DBKEY            ***************109278
     C                     EXSR *PSSR                                     109278
     C                     END                             - E2           109278
     C*                                                                   109278
     C                     Z-ADDA6NBDP    WWNBDP  10                      109278
     C*
     C** CHECK FOR END OF MONTH                                           ART021
     C                     CALL 'SD2000'                                  ART021
     C                     PARM 'N'       EOM     1                       ART021
     C                     PARM 'N'       EOY     1                       ART021
     C*                                                                   ART021
     C           EOM       IFEQ 'Y'                                       ART021
     C                     EXSR #DATE                      RUN DATE       ER0317
     C                     EXSR #EOMD                      END OF MONTH   ER0317
     C                     ELSE                                           ART021
     C                     Z-ADDBJRDNB    EREOMD                          ART021
     C                     END                                            ART021
     C*
     C** GET REPORTING DATE IN FORMAT YYYYMMDD
     C*********************Z-ADDBJRDNB    @@DAYN  50                      ER0317
     C                     Z-ADDEREOMD    @@DAYN  50                      ER0317
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     WWREPD  80
     C*                                                                   ER0136
     C                     WRITEHEADAU                                    ER0136
     C*
     C                     ENDSR
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #DATE      - SUBROUTINE TO RUN DATE                             ER0317
      **                                                                  ER0317
      **  CALLS      -                                                    ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #DATE     BEGSR                                          ER0317
     C**                                                                  ER0317
     C**   DAY                                                            ER0317
     C                     Z-ADDWWBJD     ERDADD  20       DAY            ER0317
     C**   MONTH                                                          ER0317
     C                     Z-ADD1         X       20       X : INDEX      ER0317
     C           WWBJM     LOKUPZMNM,X                   2626 : EQUAL     ER0317
     C           *IN26     IFEQ '1'                                       ER0317
     C                     Z-ADDX         ERDAMM  20       MONTH          ER0317
     C                     END                                            ER0317
     C**   YEAR                                                           ER0317
     C                     Z-ADDWWBJY     ERDAYY  20       YEAR           ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #EOMD      - SUBROUTINE TO COMPUTE END OF MONTH                 ER0317
      **                                                                  ER0317
      **  CALLS      - ZDATE1                                             ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #EOMD     BEGSR                                          ER0317
     C**                                                                  ER0317
     C                     Z-ADDERDAYY    WWY              YEAR           ER0317
     C                     Z-ADDERDAMM    WWM              MONTH          ER0317
     C                     Z-ADDTNDM,WWM  WWD              DAY            ER0317
     C**                                                                  ER0317
     C           *IN99     DOUEQ'0'                        - B1           ER0317
     C                     Z-ADDWWDATE    ZDATE                           ER0317
     C                     EXSR ZDATE1                                    ER0317
     C                     SUB  1         WWD                             ER0317
     C                     END                             - E1           ER0317
     C**                                                                  ER0317
     C                     Z-ADDZDAYNO    EREOMD  50       END OF MONTH   ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
     C********************************************************************
     C** *PSSR  S/R
     C*================================================================
     C           *PSSR     BEGSR
     C*
     C*********************WRITEHEADAU                                    ER0136
     C                     WRITEERROR                                     ER0136
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************ER0317
     C**                                                                  ER0317
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND                     ER0317
     C**              CONVERT TO A NUMBER OF DAYS.                        ER0317
     C**                                                                  ER0317
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         ER0317
     C**                                                                  ER0317
     C           ZDATE1    BEGSR                           *** ZDATE1 *** ER0317
     C**                                                                  ER0317
     C**   CLEAR DAY NUMBER.                                              ER0317
     C                     Z-ADD0         ZDAYNO  50                      ER0317
     C**                                                                  ER0317
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.                        ER0317
     C                     Z-ADDZDATE     ZDATE   60                      ER0317
     C**                                                                  ER0317
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.                     ER0317
     C                     MOVE ZDATE     ZYEAR   20                      ER0317
     C  N98                MOVELZDATE     ZDAY    20                      ER0317
     C   98                MOVELZDATE     ZMTH    20                      ER0317
     C                     MOVE ZDATE     ZWRK4   40                      ER0317
     C  N98                MOVELZWRK4     ZMTH                            ER0317
     C   98                MOVELZWRK4     ZDAY                            ER0317
     C**                                                                  ER0317
     C**   ENSURE MONTH IS VALID.                                         ER0317
     C           ZMTH      COMP 0                      9999               ER0317
     C  N99      ZMTH      COMP 12                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR 30 DAY MONTHS.                                       ER0317
     C           ZMTH      COMP 4                        90IF 90 ON, 30   ER0317
     C  N90      ZMTH      COMP 6                        90DAY MONTH.     ER0317
     C  N90      ZMTH      COMP 9                        90               ER0317
     C  N90      ZMTH      COMP 11                       90               ER0317
     C**                                                                  ER0317
     C**   ENSURE DAY IS VALID.                                           ER0317
     C           ZDAY      COMP 0                      9999               ER0317
     C   90N99   ZDAY      COMP 30                   99                   ER0317
     C  N90N99   ZDAY      COMP 31                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.                              ER0317
     C           ZYEAR     ADD  28        ZYEAR                           ER0317
     C           ZYEAR     DIV  4         ZLYR    20                      ER0317
     C                     MVR            ZLY     10     91LEAP YR, 91 ON ER0317
     C           ZMTH      COMP 2                    93  92FEB., 92 ON    ER0317
     C**                                                   PAST FEB, 93 ONER0317
     C**   IF FEBUARY FURTHER VALIDATE DAY.                               ER0317
     C  N91 92   ZDAY      COMP 28                   99                   ER0317
     C   91 92   ZDAY      COMP 29                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANSER0317
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.ER0317
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRER0317
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.ER0317
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR ER0317
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHER0317
     C**                                                                  ER0317
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*ER0317
     C**                                                                  ER0317
     C**                                                                  ER0317
     C*****************************************************************
     C*
     C           ZDATE9    BEGSR
     C*
     C                     SETOF                     8081
     C                     MOVE '0'       @@RTN   1
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1
     C                     MOVE '1'       @@RTN
     C                     GOTO ZDAT79
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZA0711
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZA0711
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZDAT79    ENDSR
      *                                                                   CEU007
      ********************************************************************CEU007
      * NOSTRO - Subroutine for access PF/SDNOSTPD via access object      CEU007
      ********************************************************************CEU007
      *                                                                   CEU007
     C           NOSTRO    BEGSR                                          CEU007
      *                                                                   CEU007
     C                     CALL 'AONOSTR0'                                CEU007
     C                     PARM *BLANKS   UUAPRC  7        B:Return Cd    CEU007
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU007
     C                     PARM *BLANKS   UUCUST  6        I:Customer No. CEU007
     C                     PARM           UUCYCD  3        I:Currency CodeCEU007
     C**********           PARM *BLANKS   UUACCD  4        I:Account Code              CEU007 CER001
     C                     PARM *BLANKS   UUACCD 10        I:Account Code                     CER001
     C                     PARM *BLANKS   UUACSN  2        I:Account SequeCEU007
     C                     PARM           UUNONB  2        I:Nostro NumberCEU007
     C                     PARM *BLANKS   UUBRCD  3        I:Branch Code  CEU007
     C                     PARM *BLANKS   UUCSSN 10        I:Cust ShortN  CEU007
     C                     PARM *BLANKS   UUPNOI  1        I:Prime Nost InCEU007
     C           D@NOST    PARM *BLANKS   UUFDY            O:Format       CEU007
      *                                                                   CEU007
     C           UUAPRC    IFNE *BLANKS                    B1             CEU007
      *                                                                   CEU007
      *** If not found perform the database error                         CEU007
      *                                                                   CEU007
     C           *LOCK     IN   LDA                                       CEU007
     C                     MOVEL'011'     DBASE            ***************CEU007
     C                     MOVEL'SDNOSTPD'DBFILE           ** DB ERROR 11 CEU007
     C           UUCYCD    CAT  UUNONB    DBKEY            ***************CEU007
     C                     OUT  LDA                                       CEU007
     C                     EXSR *PSSR                                     CEU007
      *                                                                   CEU007
     C                     ELSE                            X1             CEU007
      *                                                                   CEU007
      ***  CHECK IF THE 3 LAST DIGITS FROM NOSTRO SHORTNAME IS VALID.     CEU007
      ***  VIA THE ACCESS OBJECT.                                         CEU007
      *                                                                   CEU007
     C                     MOVE A7NOSN    P@LCCD    P                     CEU007
     C                     CALL 'AOLOCNR0'                                CEU007
     C                     PARM *BLANKS   P@RTCD  7        B:RETURN CD    CEU007
     C                     PARM '*VERIFY' P@OPTN  7        I:OPTION       CEU007
     C                     PARM           P@LCCD  3        I:KEY FIELD    CEU007
      *                                                                   CEU007
     C           P@RTCD    IFEQ *BLANKS                    B2             CEU007
      *                                                                   CEU007
      ***  SET UP THE FIELDS WITH :                                       CEU007
      ***  A7CYCD FROM PF/NOSTROPD FOR THE CCY                            CEU007
      ***  3LAST DIGIST OF THE NOSTRO SHORTNAME A7NOSN FROM PF/SDNOSTPD   CEU007
      *                                                                   CEU007
     C                     MOVELA7CYCD    WWNOSC  3                       CEU007
     C                     MOVELA7CYCD    WNOSC2  3                       CEU007
     C                     MOVE A7NOSN    WWNOSL  3                       CEU007
      *                                                                   CEU007
     C                     ELSE                            X2             CEU007
      *                                                                   CEU007
     C                     MOVELWWSCY1    WWNOSC                          CEU007
     C                     MOVELWWSCY2    WNOSC2                          CEU007
     C                     MOVELBJSLCD    WWNOSL                          CEU007
      *                                                                   CEU007
     C                     ENDIF                           E2             CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C                     ENDSR                                          CEU007
      *                                                                   CEU007
     C********************************************************************
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@                                                                  ULX004
(c) Finastra International Limited 2005
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TNDM - NUMBER OF DAYS PER MONTH
312931303130313130313031
