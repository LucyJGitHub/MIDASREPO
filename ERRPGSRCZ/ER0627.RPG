     H        1   Y
      *****************************************************************   ULX004
/*STD *  RPGBASE                                                      *   ULX004
/*EXI *  TEXT('Midas ER Extract program - SE Accounts')               *
      *****************************************************************
      *                                                               *
      *  Midas - European Reporting Module                            *
      *                                                               *
      *  ER0627 - ER Extract program - SE Accounts                    *
      *                                                               *
      *  (c) Finastra International Limited 2005                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD034387           Date 25Jan16               *
      *                 MD034776           Date 08Jul15               *
      *                 AR1067108          Date 11Dec12               *
      *                 AR1001183A         Date 20Nov12               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 225555             Date 01Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027A            Date 12May06               *
      *                 CER001             Date 25Apr05               *
      *                 ULX047             Date 06Dec02               *
      *                 UPG402             Date 04Oct04               *
      *                 ULX046             Date 24Oct02               *
      *                 194921             Date 28Jun01               *
      *                 190900             Date 30Mar01               *
      *                 184315             Date 30Oct00               *
      *                 182312             Date 30Oct00               *
      *                 CEU007 PTF08       Date 01Dec98               *
      *                 157326             Date 07May99               *
      *                 CAD007 PT          DATE 23Jul98               *
      *                 CAD002 PT          DATE 30MAY98               *
      *                 ERL465 PT          DATE 12FEB98               *
      *                 ERL464 PT          DATE 08JAN98               *
      *                 ULX004             Date 11MAR97               *
      *                 BLIFIX ADI         Date 27APR95               *
      *                 ART021    PT       Date 16SEP96               *
      *                 ER_R10             Date 31OCT94               *
      *                 ERB457 PT          Date 26APR95               *
      *                 079437 PHB         Date 28NOV94               *
      *                 CGEBRU PT          Date 29JUN94               *
      *                 ERL400 PT          Date 21JUN94               *
      *                 068458 PT          Date 22APR94               *
      *                 ER0362 TLI         Date 02FEB94               *
      *                 ER0359 TLI         Date 20OCT93               *
      *                 ER0354 PT          Date 10AUG93               *
      *                 ER0349 TLI         Date 08JUN93               *
      *                 ER0347 PT          Date 28MAY93               *
      *                 ERL328 TLI         Date 22MAR93               *
      *                 ER0334 TLI         Date 19MAR93               *
      *                 ER0321 TLI         Date 15FEB93               *
      *                 ER0317 TLI         Date 02FEB93               *
      *                 ER0312 TLI         Date 28JAN93               *
      *                 ER0305 TLI         Date 21JAN93               *
      *                 ER0205 ADs         Date 14DEC92               *
      *                 ER0204 TLI         Date 13JAN93               *
      *                 ER0136 VT          Date 23DEC92               *
      *                 ER0133 TLI         Date 21DEC92               *
      *                 ER0119 TLI         Date 10DEC92               *
      *                 ER0101 ADs         Date 24NOV92               *
      *                                                               *
      *---------------------------------------------------------------*
      *  MD046248 - Finastra Rebranding                               *
      *  MD034387 - Recompiled over changes made in /COPY ZDYYRZ3     *
      *  MD034776 - Reverse AR1001183A to allow negative interest     *
      *             rate. (Recompile)                                 *
      *  AR1067108 - PMC1140 Component failed during Clean COB        *
      *              Applied fix AR1001183A                           *
      *  AR1001183A- Coupon rate was still used in computation of     *
      *              interest instead of using the details in FRN tab *
      *              (Reopen) (Recompile)                             *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  225555 - Add discount/premium amount, amount to amortize     *
      *           and 'Prix d'acquisition'.                           *
      *           Add a second 'details' line in file EREXTRPD if     *
      *           there is a discount or premium amount to write.     *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  ULX047 - CSSF Market Values Calculation                      *
      *  UPG402 - Recompile due to R4.02 upgrade                      *
      *  ULX046 - Circulars 2002/170-174-175 Integration              *
      *  194921 - To populate several empty fields                    *
      *  190900 - Interest rate type incorrectly managed              *
      *  184315 - Discount/preium cannot be considered for            *
      *           zero-coupon securities                              *
      *  182312 - Accrued interest incorrectly managed                *
      *  157326 - Book values incorrectly reported                    *
      *  CEU007 - Holidays Changes For Reporting Interface.           *
      *  CAD007 - CAD adaptation to data dictionary version 1.6       *
      *  CAD002 - Program call with a parameter to force BVSKTV       *
      *  ERL465 - Price (Yield) must be converted to price format     *
      *           before any calculation                              *
      *  ERL464 - POOL FACTOR NOT TAKEN INTO CONSIDERATION            *
      *  ULX004 - Capital Adequacy                                    *
      *           (UNL002 Reference is replaced with ULX004 for DBA4) *
      *           (UCH001 Reference is replaced with ULX004 for DBA4) *
      *  BLIFIX - REMOVE ER0312 FOR BLI ONLY                          *
      *  ART021 - Article 21 development                              *
      *  ULX004 - European Reporting - Switzerland                    *
      *           + Remove ER_R10                                     *
      *  ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10      *
      *         - (R10 MULTIBRANCHING)                                *
      *  ERB457 - To extract the amount according to the book code    *
      *           and the investment type                             *
      *  079437 - Value in decimal position for currency with         *
      *           decimal place = 0                                   *
      *  CGEBRU - FIFO ACCOUNTING INDICATOR RETRIEVED FROM BOOK       *
      *           CODE (EXT. FILE) INSTEAD OF I.C.D.                  *
      *  ERL400 - TO OUTPUT PROCESSING TYPE (POS. 14 OF EXTREF)       *
      *  068458 - SECUR. MARKET PRICE MUST BE USED INSTEAD OF LAST    *
      *           AVERAGE PRICE IN FIFO ACCOUNTING                    *
      *  ER0362 - REMOVE DEFINITIVELY (?) PROCESSING FOR TRADES !!    *
      *  ER0359 - Store Initial date into Start Date                  *
      *  ER0354 - Trades incorrectly extracted                        *
      *  ER0349 - Re-install processing for Trades                    *
      *  ER0347 - For zero coupon positions, discount/premium must    *
      *           taken into consideration                            *
      *  ERL328 - IML 2.4 DEVELOPMENT + SETUP SECURITY DENOMINATION   *
      *  ER0334 - Setup Country of Cîtizenship with country of risk   *
      *  ER0321 - Add 'Country of Citizenship'                        *
      *  ER0317 - Change test with run date by end of month date      *
      *  ER0312 - SETUP COUNTRY CODE WITH COUNTRY OF RISK             *
      *  ER0305 - Wrong setup for Nominal Amount.                     *
      *  ER0205 - Add B/n-B ind. and second Ccy on extract file       *
      *  ER0204 - 1. WRONG SETUP FOR DECIMAL PLACES                   *
      *           2. REVERSE DEBIT/CREDIT INDICATOR SETUP             *
      *           3. NOTHING EXTRACT FOR FUTURE TRADES                *
      *  ER0136 - CALCULATE THE NUMBER OF EXTRACTED RECORDS           *
      *  ER0133 - REMOVE DATABASE ERROR 10 AND SETUP NPSN TO 0        *
      *  ER0119 - ADD MARKET IN REFERENCE TO SETUP PREVIOUS           *
      *           MONTH FIELDS IN PGM ERXX67                          *
      *  ER0101 - Decision Key lenght from 6 to 8 (RECOMPILATION)     *
      *                                                               *
      *****************************************************************
     FBPOHTR  IF  E           K        DISK                           UC
     F* SE Book position header Trade date basis
     F*
     FBPOHVL  IF  E           K        DISK                           UC
     F            BKPHDDF                           KRENAMEBKPHDXX
     F* SE Book position header Value date basis
     F*
     FBKPOS   IF  E           K        DISK
     F* SE Book position
     F*
     FSECTY   IF  E           K        DISK
     F* SE Securities details
     F*
     F******TRADV   IF  E           K        DISK                         ER0204
     F******TRADV   IF  E           K        DISK                   ER0349ER0354
     F***TRADIML IF  E           K        DISK                     ER0354 ER0362
     F* SE Trades details
     F*
     FINVTP   IF  E           K        DISK
     F* SE Investment Types details
     F*
     FSDCUSTL1IF  E           K        DISK
     F* Clients Details file
     F*
     FSDSECSL1IF  E           K        DISK                               ULX004
     F* SE Client Details file                                            ULX004
     F*                                                                   ULX004
     F**SDCURRL1IF  E           K        DISK                             ER0305
     F* Currency Details file                                             ER0305
     F*
     F****SDCURRL1IF  E           K        DISK                    ER0349 ER0362
     F***** Currency Details file                                  ER0349 ER0362
     F*
     FSDCURRL1IF  E           K        DISK                               079437
     F* Currency Details file                                             079437
     F*
     FSDBRCHL1IF  E           K        DISK
     F* Branch Code master file
     F*
     FSDBANKL1IF  E           K        DISK
     F* Bank Details file
     F*                                                                   ERL465
     FSDGELRL1IF  E           K        DISK                               ERL465
     F* General Ledger Details File                                       ERL465
     F*                                                                   ERL465
     FSEDEV   IF  E           K        DISK                               ERL465
     FSECEO   IF  E           K        DISK                               ERL465
     F            SEDEVDF                           KRENAMESEDEVDO        ERL465
     F            SNDEVDF                           KRENAMESNDEVDO        ERL465
     F*
     FSDSTRDL1IF  E           K        DISK
     F* Securities Trading ICD
     F*
     FSDBSRTL1IF  E           K        DISK                               CAD007
     F* Base Rate Codes file                                              CAD007
     F*                                                                   CAD007
     F**SDBOOKY1IF**E***********K********DISK                      CGEBRU ERB457
     F**Book*Codes*Extension*File*********                         CGEBRU ERB457
     F*                                                            CGEBRU ERB457
     F*ERBEBKL0IF  E           K        DISK                       ERB457 ULX004
     FERCHBKL0IF  E           K        DISK                               ULX004
     F* BI - ER Book code / Investment type details                       ERB457
      *                                                                   ERB457
     F**IACEXL1 IF  E           K        DISK                      ULX004 182312
     FIACEXL2 IF  E           K        DISK                               182312
     F* SE Accruals Extract by book code                                  ULX004
     F*                                                                   ULX004
     FBKPOSDT IF  E           K        DISK                               ULX046
      * Midas SE Book Positions by Position Date                          ULX046
     F            BKPOSDF                           KRENAMEBKPOSPV        ULX046
      *                                                                   ULX046
     FGEST2   IF  E           K        DISK                               225555
     F*  Securities Trading generated postings                            225555
     F*                                                                   225555
     FEREXTRPDO   E                    DISK
     F* ER Production Extract
     F*
     FER0627AUO   E                    PRINTER
     F* ER Audit report for SE extract
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   .. *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   .. *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   ..   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E/COPY ZSRSRC,ZSDESCZ1                                               ERL328
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR POWER
     E                    POW     1   8  8 3
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*                                                                   ER0317
     E** ARRAY FOR ZDATE1                                                 ER0317
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMNM   12  12  3               ZDATE2 SR.ARRAY  ER0317
     E                    TNDM   12  12  2 0             NUMBER/DAY/MONTH ER0317
      /COPY ZSRSRC,ZFRQAZ1                                                ULX004
      /COPY ZSRSRC,ZHOLE                                                  ULX004
     E*
     E** ARRAY FOR REVISION DATE
     E                    REV        12  4 0A
     E/COPY ZSRSRC,ZNCDZ1                                                 ULX004
      /COPY ZSRSRC,ZDAYSZ1                                                ERL465
      /COPY ZSRSRC,ZACCRZ0                                                ERL465
      /COPY ZSRSRC,ZPOWER8Z1                                              ERL465
      *                                                                   ULX046
      ** Rename fields to avoid to override fields                        ULX046
      *                                                                   ULX046
     IBKPOSPV                                                             ULX046
     I              RECI                            PVRECI                ULX046
     I              BPSC                            PVBPSC                ULX046
     I              BPBA                            PVBPBA                ULX046
     I              BPBK                            PVBPBK                ULX046
     I              BPMK                            PVBPMK                ULX046
     I              BPTV                            PVBPTV                ULX046
     I              BPPD                            PVBPPD                ULX046
     I              NPSN                            PVNPSN                ULX046
     I              ECNP                            PVECNP                ULX046
     I              APPB                            PVAPPB                ULX046
     I              RPTP                            PVRPTP                ULX046
     I              PILP                            PVPILP                ULX046
     I              APNC                            PVAPNC                ULX046
     I              SNPI                            PVSNPI                ULX046
     I              SNSI                            PVSNSI                ULX046
     I              SANP                            PVSANP                ULX046
     I              SANS                            PVSANS                ULX046
     I              ANMP                            PVANMP                ULX046
     I              ZZ005                           PVZZ05                ULX046
     I              ADJI                            PVADJI                ULX046
     I              TNLU                            PVTNLU                ULX046
     I              AAPR                            PVAAPR                ULX046
     I              FXAP                            PVFXAP                ULX046
      *                                                                   ULX046
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA       E DSLDA                         256                       ULX004
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     I** Data area NARRAT                                                 225555
     I*                                                                   225555
     INARRAT      DS                                                      225555
     I                                        1  30 PNARR                 225555
     I                                        1   6 REFER                 225555
     I                                        8  19 AMORT                 225555
     I*                                                                   225555
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      /COPY ZSRSRC,ZNCDZ2                                                 ULX004
     I***
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
      /COPY ZSRSRC,ZDAT10Z1                                               ULX046
     I*
     I** DATA STRUCTURE FOR BKKEY
     I            DS
     I                                        1  10 BHSC
     I************                           11  130BHBR                  ER_R10
     I                                       11  13 BHBA                  ULX004
     I                                       14  15 BHBK
     I                                       16  16 BHMK
     I                                       17  17 BHTV
     I                                       18  220WWLPSD
     I                                        1  22 WBKKEY
     I*
     I** DATA STRUCTURE FOR BHKEY
     I            DS
     I                                        1   30WBHBR
     I                                        4   5 WBHBK
     I                                        6   8 WINVT
     I                                        9  18 WBHSC
     I                                       19  19 WBHMK
     I                                        1  19 WBHKEY
     I*
     I** DATA STRUCTURE FOR INKEY
     I            DS
     I                                        1   3 NCRY
     I                                        4   6 XINVT
     I                                        1   6 WINKEY
     I*                                                                   ERL400
     I** DATA STRUCTURE FOR TRANSACTION REFERENCE                         ERL400
     I            DS                                                      ERL400
     I**********                              1  15 EXTREF                             ERL400 CER001
     I                                        1  21 EXTREF                                    CER001
     I                                        1   2 EXBHBK                ERL400
     I                                        3  12 EXBHSC                ERL400
     I                                       14  14 EXPROT                ERL400
     I                                       15  15 EXBHMK                ERL400
     I*
     I** DATA STRUCTURE FOR REVISION DATE
     I            DS
     I                                        1   40WWYYYY
     I                                        5   60WWMM
     I                                        7   80WWDD
     I                                        1   80WWREPD
     I**  MIDAS RUN DATE                                                  ER0317
     I            DS                                                      ER0317
     I                                        1   7 BJMRDT                ER0317
     I                                        1   20WWBJD                 ER0317
     I                                        3   5 WWBJM                 ER0317
     I                                        6   70WWBJY                 ER0317
     I**  DEFINE A DATE                                                   ER0317
     I            DS                                                      ER0317
     I                                        1   60WWDATE                ER0317
     I                                        1   20WWD                   ER0317
     I                                        3   40WWM                   ER0317
     I                                        5   60WWY                   ER0317
      *
      ***  DS for access programs, short data structure                   ULX004
     IDSFDY     E DSDSFDY                                                 ULX004
      ***  DS for access programs, long data structure                    ULX004
     IDSSDY     E DSDSSDY                                                 ULX004
      *                                                                   ULX004
     I/COPY ZSRSRC,ZSDESCZ2                                               ERL328
      /COPY ZSRSRC,ZAOZ2                                                  ULX004
      /COPY ZSRSRC,ZHOLI                                                  ULX004
      /COPY ZSRSRC,ZYLDZ1                                                 ERL465
      /EJECT
     C*****************************************************************
     C*  P R O G R A M     S T A R T                                  *
     C*****************************************************************
      *                    M A I N                                    *
     C*****************************************************************
     C*
     C                     EXSR #INIT
     C*
     C** MAIN PROCESSING
     C                     READ SDSTRDL1                 81
     C**  IF RECORD NOT FOUND:
     C           *IN81     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'002'     DBASE            *****************
     C                     MOVEL'SDSTRDL1'DBFILE           ** DB ERROR 02 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C           WWSKTV    IFEQ 'T'                                       CAD002
     C           WWSKTV    OREQ 'R'                                       CAD002
     C                     MOVE 'V'       BVSKTV                          CAD002
     C                     END                                            CAD002
     C*                                                                   CAD002
     C           WWSKTV    IFEQ 'V'                                       CAD002
     C                     MOVE 'T'       BVSKTV                          CAD002
     C                     END                                            CAD002
     C*                                                                   CAD002
     C           BVSKTV    IFEQ 'V'                        - B1
     C*
     C                     OPEN BPOHTR
     C                     READ BPOHTR                   30
     C*
     C           *IN30     DOWEQ'0'                        - B2
     C*
     C           RECI      IFEQ 'D'                        - B3
     C***********BJRDNB    ANDGEFPSD                                      ER0317
     C           EREOMD    ANDGEFPSD                                      ER0317
     C                     EXSR P003
     C*
     C** RESET FILE RECORD FORMAT
     C                     RESETEREXTRF0
     C*
     C                     END                             - E3
     C*
     C                     READ BPOHTR                   30
     C                     END                             - E2
     C*
     C                     CLOSEBPOHTR
     C*
     C                     ELSE                            - X1
     C*
     C                     OPEN BPOHVL
     C                     OPEN BPOHTR
     C                     READ BPOHVL                   30
     C*
     C           *IN30     DOWEQ'0'                        - B2
     C*
     C           RECI      IFEQ 'D'                        - B3
     C                     EXSR P003
     C***********          EXSR P004                                      ULX004
     C*
     C** RESET FILE RECORD FORMAT
     C                     RESETEREXTRF0
     C*
     C                     END                             - E3
     C*
     C                     READ BPOHVL                   30
     C                     END                             - E2
     C*
     C                     CLOSEBPOHVL
     C                     CLOSEBPOHTR
     C*
     C                     END                             - E1
     C*
     C** TERMINATION PROCESSING
     C                     WRITEDETAIL                                    ER0136
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C**************************************************************************
     C* P003 - DETAIL PROCESSING SUB-ROUTINE                                   *
     C**************************************************************************
     C*
     C           P003      BEGSR
     C*
     C***********BHBR      IFNE WWBHBR                     - B1           ER_R10
     C           BHBA      IFNE WWBHBR                     - B1           ULX004
     C*
     C** STORE NEW BRANCH IN OLD BRANCH
     C***********          Z-ADDBHBR      WWBHBR  30                      ER_R10
     C                     MOVELBHBA      WWBHBR  3                       ULX004
     C*
     C***********          MOVE BHBR      AABHBR  3                       ER_R10
     C                     MOVE BHBA      AABHBR  3                       ULX004
     C*
     C           AABHBR    CHAINSDBRCHL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'003'     DBASE            *****************
     C                     MOVEL'SDBRCHL1'DBFILE           ** DB ERROR 03 **
     C                     MOVELAABHBR    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
      *                                                                   ULX004
      ***  ULX004 : Save Internal branch customer A8BICN                  ULX004
      *                                                                   ULX004
     C                     MOVE A8BICN    SVBICN  6                       ULX004
     C*
     C** ACCESS CUSTOMER DETAILS FILE
     C           A8BICN    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'004'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 04 **
     C                     MOVELA8BICN    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    WWORCC  2
     C                     END                             - E1
     C*
     C** ACCESS BKPOS WITH BKKEY
     C           LPSD      IFEQ 0                          - B1
     C                     Z-ADDFPSD      LPSD
     C                     END                             - E1
     C*
     C           BKKEY     CHAINBKPOS                88
     C           *IN88     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'005'     DBASE            *****************
     C                     MOVEL'BKPOS   'DBFILE           ** DB ERROR 05 **
     C                     Z-ADDLPSD      WWLPSD           *****************
     C                     MOVELWBKKEY    DBKEY
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C* Prix d'acquisition added in extract file                          225555
     C*                                                                   225555
     C                     Z-ADDAPPB      EXFAMT                          225555
     C*                                                                   225555
     C** ACCESS SECTY WITH SECURITY SHORTNAME
     C           BPSC      CHAINSECTY                88
     C           *IN88     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'006'     DBASE            *****************
     C                     MOVEL'SECTY   'DBFILE           ** DB ERROR 06 **
     C                     MOVELBPSC      DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
      *                                                                   ULX004
      ***  ULX004 : store Security amount                                 ULX004
      *                                                                   ULX004
     C                     Z-ADDISSA      EXISAM                          ULX004
     C*
     C** ACCESS INVTP WITH INKEY
     C           INKEY     CHAININVTP                88
     C           *IN88     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'007'     DBASE            *****************
     C                     MOVEL'INVTP   'DBFILE           ** DB ERROR 07 **
     C                     MOVE INVT      XINVT            *****************
     C                     MOVELWINKEY    DBKEY
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** STORE NUMBER OF DECIMAL PLACES
     C***********NMDP      IFEQ 0                          - B1           ER0305
     C***********NMCY      CHAINSDCURRL1             88                   ER0305
     C************IN88     IFEQ '1'                        - B2           ER0305
     C*********************MOVEL'027'     DBASE            ***************ER0305
     C*********************MOVEL'SDCURRL1'DBFILE           ** DB ERROR 27 ER0305
     C*********************MOVELNMCY      DBKEY            ***************ER0305
     C*********************EXSR *PSSR                                     ER0305
     C*********************END                             - E2           ER0305
     C*                                                                   ER0305
     C** STORE NUMBER OF DECIMAL PLACES                                   079437
     C           NMCY      CHAINSDCURRL1             88                   079437
     C           *IN88     IFEQ '1'                        - B1           079437
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'027'     DBASE            ***************079437
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 27 079437
     C                     MOVELNMCY      DBKEY            ***************079437
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR                                     079437
     C                     END                             - E1           079437
     C*                                                                   079437
     C***********4         ADD  A6NBDP    B       10                      ER0305
     C*********************ELSE                            - X1           ER0305
     C***********4         ADD  NMDP      B                               ER0305
     C*********************END                             - E1           ER0305
     C*
     C** WRONG SETUP FOR DECIMAL PLACES                                   ER0204
     C*********************SUB  3         B                        ER0204 ER0305
     C           7         SUB  NMDP      B       10                      ER0305
     C*
     C** NOMINAL POSITION > 0 ?
     C***********NPSN      IFGT 0                          - B1           ER0204
     C*********************Z-ADD1         EXDRCR                          ER0204
     C*********************ELSE                            - X1           ER0204
     C*********************Z-ADD0         EXDRCR                          ER0204
     C*********************Z-SUBNPSN      NPSN                            ER0204
     C*********************END                             - E1           ER0204
     C*
     C***For*zero*coupon*securities,*discount/premium must be takenER0347 184315
     C***consideration:*********                                   ER0347 184315
     C****On*a*long*position,*Discount is Income, Premium is ExpensER0347 184315
     C****On*a *hort*position,*Premium is Income, Discount is ExpenER0347 184315
     C***********CPNR      IFEQ 0                          - B1    ER0347 184315
     C***********NPSN      IFGT 0                          - B2    ER0347 184315
     C***********          SUB  DPAP      NPSN                     ER0347 184315
     C***********          ELSE                            - X2    ER0347 184315
     C***********          ADD  DPAP      NPSN                     ER0347 184315
     C***********          END                             - E2    ER0347 184315
     C***********          END                             - E1    ER0347 184315
     C*                                                                   ER0347
      *                                                                   ULX004
      ***  Long/Short Position Indiactor 1                                ULX004
      *                                                                   ULX004
     C           NPSN      IFGT 0                                         ULX004
     C                     Z-ADD1         EXLSP1                          ULX004
     C                     ELSE                                           ULX004
     C                     Z-ADD2         EXLSP1                          ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
     C           NPSN      IFGT 0                          - B1           ER0204
     C                     Z-ADD0         EXDRCR                          ER0204
     C                     ELSE                            - X1           ER0204
     C                     Z-ADD1         EXDRCR                          ER0204
     C                     Z-SUBNPSN      NPSN                            ER0204
     C                     END                             - E1           ER0204
     C*
     C** TRANSFORM MATURITY DATE IN ABACUS FORMAT
     C                     Z-ADDMATY      @@DAYN  50
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     EXENDD
      *                                                                   ULX004
      ***  Final Maturity Date                                            ULX004
      *                                                                   ULX004
     C                     Z-ADD@@VDT     EXFMDT                          ULX004
      *                                                                   ULX004
      ***  First next rate date change                                    ULX004
      *                                                                   ULX004
     C                     Z-ADD@@VDT     EXDATA                          ULX004
      *
     C***********CPNR      IFNE 0                                  CAD007 190900
     C           PROT      IFEQ '3'                                       CAD007
     C*********************Z-ADD2         EXIRTT                   CAD007 190900
     C                     MOVE NCRY      KKCCY                           CAD007
     C                     MOVE BASC      KKBSRT                          CAD007
     C                     EXSR BSRTSR                                    CAD007
     C*********************ELSE                                    CAD007 190900
     C*********************Z-ADD1         EXIRTT                   CAD007 190900
     C*********************END                                     CAD007 190900
     C*********************ELSE                                    CAD007 190900
     C*********************Z-ADD0         EXIRTT                   CAD007 190900
     C                     END                                            CAD007
      *                                                                   190900
     C           PROT      IFEQ '4'                                       190900
     C           PROT      OREQ '7'                                       190900
     C                     Z-ADD2         EXIRTT                          190900
     C                     ELSE                                           190900
     C                     Z-ADD1         EXIRTT                          190900
     C                     ENDIF                                          190900
      *                                                                   CAD007
     C           PROT      IFEQ '3'                                       ULX004
     C***********PROT      OREQ '5'                                ULX004 CAD007
     C***********PROT      OREQ '8'                                ULX004 CAD007
     C                     EXSR P006                                      ULX004
     C                     ENDIF                                          ULX004
      *                                                                   ULX004
      ***  Position Book Code                                             ULX004
      *                                                                   ULX004
     C                     MOVE BHBK      EXBKCD                          ULX004
      *
      ** PROCESSING TYPE
     C           PROT      IFEQ '3'                        - B1
     C           PROT      OREQ '5'
     C           PROT      OREQ '6'
     C           PROT      OREQ '8'
     C                     EXSR REVDAT
     C                     END                             - E1
     C*
     C** MARKET CENTER
     C           SMCC      IFNE *BLANKS                    - B1
     C                     Z-ADD1         EXSECQ
     C                     ELSE                            - X1
     C                     Z-ADD2         EXSECQ
     C                     END                             - E1
     C*
     C** STORE SECURITY REPORT NAME
     C                     MOVELSRPN      EXSECD                          ERL328
     C*                                                                   ERL328
     C                     MOVE SRPN      ZSRPN                           ERL328
     C                     MOVE BVROSD    RSFD    1                       ERL328
     C                     EXSR ZSDESC                                    ERL328
     C                     MOVELZRNME     EXSECY                          ERL328
     C*
     C** STORE SECURITY SHORT NAME
     C                     MOVELSESN      EXSESN
      *                                                                   ULX004
      ***  ACCESS SECURITIES CUSTOMER DETAILS FILE                        ULX004
      *                                                                   ULX004
     C                     MOVE ISSR      AAISSR  6                       ULX004
     C           AAISSR    CHAINSDSECSL1             88                   ULX004
     C*                                                                   ULX004
     C** Store Customer classification                                    ULX004
     C           *IN88     IFEQ '0'                                       ULX004
     C                     MOVE BFCLAS    EXCLAS                          ULX004
      *                                                                   ULX004
      ***  ULX004 : Store Pledge agreement                                ULX004
      *                                                                   ULX004
     C                     MOVE BFPLAG    EXPLAG                          ULX004
     C                     END                                            ULX004
     C*
     C** ACCESS CUSTOMER DETAILS FILE WITH ISSUER
     C**********           MOVE ISSR      AAISSR  6                       ULX004
     C           AAISSR    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'008'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 08 **
     C                     MOVELAAISSR    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
     C*                                                                   ER0205
     C** STORE Bank/non-Bank Indicator                                    ER0205
     C                     MOVE BBBNBI    EXBNBI                          ER0205
     C*
     C** STORE COUNTRY OF LOCATION
     C*********************MOVE BBCOLC    EXCUCC                          ER0312
     C***********          MOVE SCOR      EXCUCC                   ER0312 BLIFIX
     C                     MOVE BBCOLC    EXCUCC                          BLIFIX
      *
      ***  ULX004 : Store Issuer Country of Location                      ULX004
      ***  ULX004 : Store Issuer Counterparty Type                        ULX004
      ***  ULX004 : Store Branch Internal Customer Number                 ULX004
      *                                                                   ULX004
     C                     MOVE BBCOLC    EXISLC                          ULX004
     C** NOW MAINTAINED ON A WINDOW
     C*********************MOVE BBBFIC    EXCTPY                   ULX004 ART021
     C                     MOVE SVBICN    EXBICN                          ULX004
     C*
     C** STORE CUSTOMER SHORT NAME
     C                     MOVE BBCSSN    EXCSSN
     C*
     C** STORE CUSTOMER REPORT NAME
     C                     MOVE BBCRNM    EXCRNM
      *                                                                   ULX004
      ***  Issuer Name                                                    ULX004
      *                                                                   ULX004
     C                     MOVE BBCRNM    EXISSN                          ULX004
     C*
     C** STORE COUNTRY OF CITIEZNSHIP                                     ER0321
     C*********************MOVE BBCNCZ    EXCNCZ                   ER0321 ER0334
     C*********************MOVE SCOR      EXCNCZ                   ER0334 BLIFIX
     C                     MOVE BBCNCZ    EXCNCZ                          BLIFIX
      *                                                                   ULX004
      ***  Branch/subsidiary indicator                                    ULX004
      *                                                                   ULX004
     C                     MOVE BBBSIN    EXBSIN                          ULX004
     C*
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK
     C           BBPCNB    IFNE *BLANKS                    - B1
     C*
     C           BBPCNB    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'009'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 09 **
     C                     MOVELBBPCNB    DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE
     C                     MOVE BBCUST    EXPCNB
     C                     MOVE BBCOLC    EXPRCC
     C                     ELSE                            - X1
     C*
     C** RESET FIELDS
     C                     MOVE *BLANKS   EXPCNB
     C                     MOVE *BLANKS   EXPRCC
     C                     END                             - E1
     C*********************                                        CGEBRU ERB457
     C***RETRIEVE*FIFO*ACCOUNTING FROM BOOK CODE EXT. FILE         CGEBRU ERB457
     C***********BHBK******CHAINSDBOOKY1             88            CGEBRU ERB457
     C************IN88*****IFEQ '1'                        - B2    CGEBRU ERB457
     C*********************MOVEL'010'     DBASE     ***************CGEBRU ERB457
     C*********************MOVEL'SDBOOKY1'DBFILE    ** DB ERROR 10 CGEBRU ERB457
     C*********************MOVELBHBK      DBKEY     ***************CGEBRU ERB457
     C*********************EXSR *PSSR                              CGEBRU ERB457
     C*********************END                             - E2    CGEBRU ERB457
     C*********************                                               ERB457
     C***PRICE*BASIS*EQUAL*'P'                                            ERB457
     C***********SPBS******IFEQ 'P'                        - B1           ERB457
     C*********************                                               ERB457
     C***********B*********SUB  2         C       10                      ERB457
     C***********NPSN******MULT APPB      EXAMNT                   ERL328 ERB457
     C***********BVFIFO****IFEQ 'Y'                         XXXXXX CGEBRU ERB457
     C***********SEFIFO****IFEQ 'Y'                                CGEBRU ERB457
     C***********NPSN******MULT MKPR      EXAMNT                   XXXXXX ERB457
     C*********************ELSE                                    XXXXXX ERB457
     C***********NPSN******MULT LAVP      EXAMNT                   ERL328 ERB457
     C*********************END                                     XXXXXX ERB457
     C***********EXAMNT****DIV  100       EXAMNT                   ER0305 ERB457
     C***********EXAMNT****MULT 10        EXAMNT                   ER0305 ERB457
     C***********EXAMNT****MULT POW,C     EXAMNT                   ER0305 ERB457
     C*********************                                               ERB457
     C***********NPSN******MULT MKPR      EXREAA                          ERB457
     C***********EXREAA****DIV  100       EXREAA                   ER0305 ERB457
     C***********EXREAA****MULT 10        EXREAA                   ER0305 ERB457
     C***********EXREAA****MULT POW,C     EXREAA                   ER0305 ERB457
     C*********************                                               ERB457
     C*********************ELSE                            - X1           ERB457
     C*********************                                               ERB457
     C***********NPSN      MULT APPB      EXAMNT                   ERL328 ERB457
     C***********BVFIFO    IFEQ 'Y'                         XXXXXX CGEBRU ERB457
     C***********SEFIFO****IFEQ 'Y'                                CGEBRU ERB457
     C***********NPSN******MULT MKPR      EXAMNT                   XXXXXX ERB457
     C*********************ELSE                                    XXXXXX ERB457
     C***********NPSN******MULT LAVP      EXAMNT                   ERL328 ERB457
     C*********************END                                     XXXXXX ERB457
     C***********EXAMNT****MULT 1000      EXAMNT                   ER0305 ERB457
     C***********EXAMNT****MULT POW,B     EXAMNT                   ER0305 ERB457
     C*********************                                               ERB457
     C***********NPSN******MULT MKPR      EXREAA                          ERB457
     C***********EXREAA****MULT 1000      EXREAA                   ER0305 ERB457
     C***********EXREAA****MULT POW,B     EXREAA                   ER0305 ERB457
     C*********************END                             - E1           ERB457
     C*********************                                               ERB457
     C***STORE*AMOUNT*IN*CURRENCY                                         ERB457
     C***********EXAMNT****MULT POW,B     EXAMNT                   ER0204 ERB457
     C***********EXAMNT****DIV  POW,B     EXAMNT            ER0204 ER0305 ERB457
     C***********EXAMNT****MULT 1000      EXAMNT                   ER0305 ERB457
     C*********************                                               ERB457
     C***STORE*REALISATION*AMOUNT                                         ERB457
     C***********EXREAA****MULT POW,B     EXREAA                   ER0204 ERB457
     C***********EXREAA****DIV  POW,B     EXREAA                   ER0204 ERB457
     C*********************                                               ERB457
     C***PRICE*BASIS*EQUAL*'P'                                            ERB457
     C***********SPBS******IFEQ 'P'                        - B1    ER0305 ERB457
     C*********************                                               ERB457
     C***STORE*NOMINAL*AMOUNT                                             ERB457
     C***********NPSN******MULT POW,B     EXNOMA            ER0204 ER0305 ERB457
     C***********NPSN      DIV  POW,B     EXNOMA            ER0204 ER0305 ERB457
     C*********************                                               ERB457
     C*********************ELSE                            - X1    ER0305 ERB457
     C*********************                                               ERB457
     C*********************Z-ADDNPSN      EXNOMA                          ERB457
     C***********EXNOMA****MULT POW,B     EXNOMA                   ER0305 ERB457
     C*********************END                             - E1           ER0305
     C*###################################################                ERB457
     C*                                                                   ERB457
     C** CALCULATE REALISATION AMOUNT AND BOOK VALUE                      ERB457
     C***********NPSN      MULT MKPR      EXREAA                   ERB457 ERL465
     C                     Z-ADDMKPR      ZPRCIN                          ERL465
     C                     Z-ADDEREOMD    ZFDATE                          ERL465
     C                     EXSR ZPRCI                                     ERL465
     C           NPSN      MULT ZPRCOT    EXREAA                          ERL465
     C*                                                                   ERL465
     C***********NPSN      MULT LAVP      EXAMNT                   ERB457 157326
     C*                                                                   157326
     C           NPSN      MULT ZPRCOT    WWREAA 215                      157326
     C           NPSN      MULT LAVP      WWAMNT 215                      157326
     C*                                                                   ERB457
     C** PRICE BASIS EQUAL 'P'                                            ERB457
     C           SPBS      IFEQ 'P'                        - B1           ERB457
     C           B         SUB  2         C       10                      ERB457
     C           EXREAA    MULT POW,C     EXREAA                          ERB457
     C***********EXAMNT    MULT POW,C     EXAMNT                   ERB457 157326
     C           WWREAA    MULT POW,C     WWREAA                          157326
     C           WWAMNT    MULT POW,C     WWAMNT                          157326
     C                     ELSE                            - X1           ERB457
     C           EXREAA    MULT POW,B     EXREAA                          ERB457
     C***********EXAMNT    MULT POW,B     EXAMNT                   ERB457 157326
     C           WWREAA    MULT POW,B     WWREAA                          157326
     C           WWAMNT    MULT POW,B     WWAMNT                          157326
     C                     END                             - E1           ERB457
      *                                                                   ULX004
      ***  Market Value 1 in Foreign Ccy                                  ULX004
      *                                                                   ULX004
     C                     Z-ADDEXREAA    EXMKT1                          ULX004
     C*
     C** CALCULATE NOMINAL POSITION                                       ERB457
     C*********            Z-ADDNPSN      EXNOMA                   ERB457 ULX004
     C*********  EXNOMA    MULT POW,B     EXNOMA                   ERB457 ULX004
     C                     Z-ADD*ZEROS    EXNOMA                          ULX004
      *                                                                   ERB457
     C** RETRIEVE TYPE OF AMOUNT TO BE REPORTED                           ERB457
     C******     BKIVKY    CHAINERBEBKL0             88            ERB457 ULX004
     C           BKIVKY    CHAINERCHBKL0             88                   ULX004
     C           *IN88     IFEQ '1'                        - B1           ERB457
     C           *IN88     OREQ '0'                                       ERB457
     C           BIAMTT    ANDEQ*BLANK                                    ERB457
     C                     MOVE 'B'       BIAMTT                          ERB457
     C                     END                             - E1           ERB457
     C*                                                                   ERB457
     C** NOMINAL POSITION MUST BE REPORTED                                ERB457
     C           BIAMTT    IFEQ 'N'                                       ERB457
     C*********************Z-ADDEXNOMA    EXAMNT                   ERB457 157326
     C                     Z-ADDEXNOMA    WWAMNT                          157326
     C                     END                                            ERB457
     C*                                                                   ERB457
     C** MARKET VALUE MUST BE REPORTED                                    ERB457
     C           BIAMTT    IFEQ 'M'                                       ERB457
     C*********************Z-ADDEXREAA    EXAMNT                   ERB457 157326
     C                     Z-ADDWWREAA    WWAMNT                          157326
     C                     END                                            ERB457
     C*                                                                   ERB457
     C** LOWER OF COST OR MARKET MUST BE REPORTED                         ERB457
     C           BIAMTT    IFEQ 'C'                                       ERB457
     C***********EXREAA    ANDLEEXAMNT                             ERB457 157326
     C           WWREAA    ANDLEWWAMNT                                    157326
     C*                                                                   ERB457
     C** LOWER OF ACTUARIAL VALUE OR MARKET MUST BE REPORTED              ERB457
     C           BIAMTT    OREQ 'A'                                       ERB457
     C***********EXREAA    ANDLEEXAMNT                             ERB457 157326
     C           WWREAA    ANDLEWWAMNT                                    157326
     C*********************Z-ADDEXREAA    EXAMNT                   ERB457 157326
     C                     Z-ADDWWREAA    WWAMNT                          157326
     C                     END                                            ERB457
     C*                                                                   ERB457
     C** IF THE BOOK VALUE OR THE PURCHASE VALUE MUST BE REPORTED         ERB457
     C** (BIAMTT = 'B' OR 'P'), EXAMNT HAS BEEN CORRECTLY SETUP           ERB457
     C** PREVIOUSLY                                                       ERB457
     C*                                                                   ERB457
     C*###################################################                ERB457
      ***********                                                  079437 157326
     C***********EXAMNT    DIV  1000      ZON213 213               079437 157326
     C***********A6NBDP    IFEQ 0                          - B1    079437 157326
     C***********          Z-ADDZON213    ZON210 210H              079437 157326
     C***********ZON210    MULT 1000      EXAMNT                   079437 157326
     C***********          END                             - E1    079437 157326
     C***********A6NBDP    IFEQ 1                          - B1    079437 157326
     C***********          Z-ADDZON213    ZON211 211H              079437 157326
     C***********ZON211    MULT 1000      EXAMNT                   079437 157326
     C***********          END                             - E1    079437 157326
     C***********A6NBDP    IFEQ 2                          - B1    079437 157326
     C***********          Z-ADDZON213    ZON212 212H              079437 157326
     C***********ZON212    MULT 1000      EXAMNT                   079437 157326
     C***********          END                             - E1    079437 157326
     C*                                                                   157326
     C                     Z-ADDWWAMNT    EXAMNT                          157326
      *                                                                   079437
     C***********EXNOMA    IFNE *ZEROS                             ULX004 ULX047
      ***********                                                  ULX004 ULX047
     C***********EXNOMA    DIV  1000      ZON213 213               079437 ULX047
     C***********A6NBDP    IFEQ 0                          - B1    079437 ULX047
     C***********          Z-ADDZON213    ZON210 210H              079437 ULX047
     C***********ZON210    MULT 1000      EXNOMA                   079437 ULX047
     C***********          END                             - E1    079437 ULX047
     C***********A6NBDP    IFEQ 1                          - B1    079437 ULX047
     C***********          Z-ADDZON213    ZON211 211H              079437 ULX047
     C***********ZON211    MULT 1000      EXNOMA                   079437 ULX047
     C***********          END                             - E1    079437 ULX047
     C***********A6NBDP    IFEQ 2                          - B1    079437 ULX047
     C***********          Z-ADDZON213    ZON212 212H              079437 ULX047
     C***********ZON212    MULT 1000      EXNOMA                   079437 ULX047
     C***********          END                             - E1    079437 ULX047
      ***********                                                  ULX004 ULX047
     C***********          ENDIF                                   ULX004 ULX047
     C*  Discount/premium amount if PROT non equal to 2,4 and 7           225555
     C*                                                                   225555
     C           PROT      IFNE '2'                                       225555
     C           PROT      ANDNE'4'                                       225555
     C           PROT      ANDNE'7'                                       225555
     C*                                                                   225555
     C* IF PROT = '8' MULT BUDU BY Current factor                         225555
     C* Discount/Premium Amount comes from GEST (Postings)                225555
     C*                                                                   225555
     C           PROT      IFEQ '8'                                       225555
     C                     EXSR PROT8                                     225555
     C                     END                                            225555
     C*                                                                   225555
     C           NMDP      IFEQ 2                                         225555
     C           DPAP      MULT 100       DPAP                            225555
     C           BUDU      MULT 100       BUDU                            225555
     C                     END                                            225555
     C*                                                                   225555
     C           NMDP      IFEQ 4                                         225555
     C           DPAP      MULT 10000     DPAP                            225555
     C           BUDU      MULT 10000     BUDU                            225555
     C                     END                                            225555
     C*                                                                   225555
     C           PROT      IFEQ '8'                                       225555
     C           BUDU      SUB  DPAP      EXDISA                          225555
     C                     ELSE                                           225555
     C           DPAP      ADD  BUDU      EXDISA                          225555
     C                     END                                            225555
     C*                                                                   225555
     C           EXDISA    MULT POW,C     EXDISA                          225555
     C*                                                                   225555
     C*###################################################                225555
     C*                                                                   225555
     C           EXDISA    DIV  1000      ZON213 213                      225555
     C           A6NBDP    IFEQ 0                          - B1           225555
     C                     Z-ADDZON213    ZON210 210H                     225555
     C           ZON210    MULT 1000      EXDISA                          225555
     C                     END                             - E1           225555
     C           A6NBDP    IFEQ 1                          - B1           225555
     C                     Z-ADDZON213    ZON211 211H                     225555
     C           ZON211    MULT 1000      EXDISA                          225555
     C                     END                             - E1           225555
     C           A6NBDP    IFEQ 2                          - B1           225555
     C                     Z-ADDZON213    ZON212 212H                     225555
     C           ZON212    MULT 1000      EXDISA                          225555
     C                     END                             - E1           225555
     C*                                                                   225555
     C*  Amortised Discount/Premium amount                                225555
     C*                                                                   225555
     C                     Z-ADD0         EXDPTD                          225555
     C*                                                                   225555
     C                     Z-ADDDPAP      EXDPTD                          225555
     C*                                                                   225555
     C           EXDPTD    MULT POW,C     EXDPTD                          225555
     C*                                                                   225555
     C           EXDPTD    DIV  1000      ZON213 213                      225555
     C           A6NBDP    IFEQ 0                          - B1           225555
     C                     Z-ADDZON213    ZON210 210H                     225555
     C           ZON210    MULT 1000      EXDPTD                          225555
     C                     END                             - E1           225555
     C           A6NBDP    IFEQ 1                          - B1           225555
     C                     Z-ADDZON213    ZON211 211H                     225555
     C           ZON211    MULT 1000      EXDPTD                          225555
     C                     END                             - E1           225555
     C           A6NBDP    IFEQ 2                          - B1           225555
     C                     Z-ADDZON213    ZON212 212H                     225555
     C           ZON212    MULT 1000      EXDPTD                          225555
     C                     END                             - E1           225555
     C*                                                                   225555
     C                     END                                            225555
     C*                                                                   225555
     C*     Substract disc/premium amount from EXAMNT                     225555
     C*                                                                   225555
     C           EXAMNT    SUB  EXDPTD    EXAMNT                          225555
     C*                                                                   225555
      *                                                                   ULX004
      ***  Coupon Rate                                                    ULX004
      *                                                                   ULX004
     C                     Z-ADDCPNR      EXCPNR    H                     ULX004
      *                                                                   ULX004
      ***  Unique issuance reference                                      ULX004
      *                                                                   ULX004
     C                     MOVELSESN      EXUISS                          ULX004
     C* FOR MORTGAGE BACKED SECURITIES (INV PROCESSING TYPE 8)            ERL464
     C* MULTIPLY BOOK VALUE AND MARKET VALUE BY THE CURRENT               ERL464
     C* POOL FACTOR                                                       ERL464
     C           PROT      IFEQ '8'                                       ERL464
     C                     MULT CFCT      EXAMNT                          ERL464
     C                     MULT CFCT      EXREAA                          ERL464
     C                     MULT CFCT      EXMKT1                          ERL464
     C                     END                                            ERL464
      *                                                                   194921
     C           EXMKT1    IFEQ 0                                         194921
     C                     Z-ADDEXAMNT    EXMKT1                          194921
     C                     ENDIF                                          194921
      *                                                                   ULX047
     C           EXREAA    IFEQ 0                                         ULX047
     C                     Z-ADDEXAMNT    EXREAA                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX047
     C                     Z-ADDEXREAA    EXNPVA                          ULX047
      *
      ** WRITE RECORD IN OUTPUT FILE
     C                     EXSR W001
      *                                                                   225555
      ** WRITE a second record line in output file only                   225555
      *  if Discount/Premium amount is not zero.                          225555
      *                                                                   225555
     C           EXDPTD    IFNE 0                                         225555
     C                     Z-ADDEXDPTD    EXAMNT                          225555
     C                     Z-ADD0         EXREAA                          225555
     C                     EXSR W002                                      225555
     C                     END                                            225555
      *                                                                   225555
     C                     ENDSR                                          225555
     C********************************************************************225555
     C* PROT8 - SUBROUTINE TO CATCH DISCOUNT/PREMIUM AMOUNT IN GESTPD     225555
     C**================================================================= 225555
     C*                                                                   225555
     C           PROT8     BEGSR                                          225555
     C*                                                                   225555
     C                     Z-ADD0         DPAP                            225555
     C                     MOVE BHSC      OTST                            225555
     C           GEKEY     SETLLAPOSTPDF                                  225555
     C           GEKEY     READEAPOSTPDF                 50               225555
     C           *IN50     DOWEQ'0'                                       225555
     C                     MOVELPNAR      PNARR                           225555
     C                     MOVELREFER     AMOR6   6                       225555
     C                     MOVELAMORT     AMOR8   8                       225555
     C                     MOVE AMORT     AMOR4   4                       225555
     C           AMOR8     IFEQ 'DISC/PRE'                                225555
     C           AMOR6     ANDEQ'000000'                                  225555
     C           AMOR4     ANDEQ'M   '                                    225555
     C           ACSC      IFEQ 'AS'                                      225555
     C           ACSC      OREQ 'LI'                                      225555
     C           DRCR      IFEQ 0                                         225555
     C                     ADD  PSTA      DPAP                            225555
     C                     ELSE                                           225555
     C                     SUB  PSTA      DPAP                            225555
     C                     END                                            225555
     C                     END                                            225555
     C                     END                                            225555
     C           AMOR8     IFEQ 'DISC/PRE'                                225555
     C           AMOR4     ANDEQ'M   '                                    225555
     C           AMOR6     ANDNE'000000'                                  225555
     C           ACSC      IFEQ 'AS'                                      225555
     C           ACSC      OREQ 'LI'                                      225555
     C           DRCR      IFEQ 0                                         225555
     C                     Z-SUBPSTA      BUDU                            225555
     C                     ELSE                                           225555
     C                     Z-ADDPSTA      BUDU                            225555
     C                     END                                            225555
     C                     END                                            225555
     C                     END                                            225555
     C           GEKEY     READEAPOSTPDF                 50               225555
     C                     END                                            225555
      *
     C                     ENDSR
     C**================================================================= 225555
     C********************************************************************CAD007
     C* BSRTSR - ACCESS TO THE BASE RATE CODES                            CAD007
     C********************************************************************CAD007
     C           BSRTSR    BEGSR                                          CAD007
     C*                                                                   CAD007
     C           KBSRT     CHAINSDBSRTL1             88                   CAD017
     C           *IN88     IFEQ '0'                                       CAD007
     C                     MOVELBABSRN    EXREFR                          CAD007
     C                     END                                            CAD007
     C*                                                                   CAD007
     C                     ENDSR                                          CAD007
     C**************************************************************************
     C* P004 - VALUE DATE BASIS DETAIL PROCCESSING                             *
     C**************************************************************************
     C*
     C***********P004      BEGSR                                          ULX004
     C*
     C** SAVE NOMINAL POSITION
     C***********          Z-ADDNPSN      WWNPSN 150                      ULX004
     C*
     C** ACCESS BPOHTR WITH BHKEY
     C***********BHKEY     CHAINBPOHTR               88                   ULX004
     C************IN88     IFEQ '1'                        - B1     ER0133ULX004
     C***********          Z-ADD0         NPSN                      ER0133ULX004
     C***********          MOVE 'N'       FOUND   1                 ER0133ULX004
     C*********************MOVEL'010'     DBASE            *********      ER0133
     C*********************MOVEL'BPOHTR  'DBFILE           ** DB ER ER      0133
     C*********************Z-ADDBHBR      WBHBR            *********      ER0133
     C*********************MOVE BHBK      WBHBK                           ER0133
     C*********************MOVE INVT      WINVT                           ER0133
     C*********************MOVE BHSC      WBHSC                           ER0133
     C*********************MOVE BHMK      WBHMK                           ER0133
     C*********************MOVELWBHKEY    DBKEY                           ER0133
     C*********************EXSR *PSSR                                     ER0133
     C***********          ELSE                            - X1     ER0133ULX004
     C***********          MOVE 'Y'       FOUND                     ER0133ULX004
     C***********          END                             - E1           ULX004
     C*
     C** ACCESS BKPOS WITH BKKEY
     C***********FOUND     IFEQ 'Y'                        - B0     ER0133ULX004
      *
     C***********LPSD      IFEQ 0                          - B2           ULX004
     C***********          Z-ADDFPSD      LPSD                            ULX004
     C***********          END                             - E2           ULX004
     C*
     C***********BKKEY     CHAINBKPOS                88                   ULX004
     C************IN88     IFEQ '1'                        - B1           ULX004
     C************LOCK     IN   LDA                                       ULX004
     C***********          MOVEL'011'     DBASE            *****************X004
     C***********          MOVEL'BKPOS   'DBFILE           ** DB ERROR 11 **X004
     C***********          Z-ADDLPSD      WWLPSD           *****************X004
     C***********          MOVELWBKKEY    DBKEY                           ULX004
     C***********          OUT  LDA                                       ULX004
     C***********          EXSR *PSSR                                     ULX004
     C***********          END                             - E1           ULX004
      *
     C***********          END                             - E0     ER0133ULX004
     C*
     C** NOMINAL POSITION NOT EQUAL TO NOMINAL POSITION SAVED
     C***********NPSN      IFNE WWNPSN                     - B1           ER0204
     C*********************Z-ADD0         WWCNUM  60                      ER0204
     C*********************MOVE *BLANKS   WWTDRF  6                       ER0204
     C*
     C***********TRKEY     SETGTTRADV                                     ER0204
     C*********************READ TRADV                    31               ER0204
     C*********************MOVE TDSS      WWTDSS 10                       ER0204
     C*********************Z-ADDTDBR      WWTDBR  30                      ER0204
     C*
     C** SAME SECURITY AND SAME BRANCH CODE
     C************IN31     DOWEQ'0'                        - B2           ER0204
     C***********TDSS      ANDEQWWTDSS                                    ER0204
     C***********TDBR      ANDEQWWTDBR                                    ER0204
     C*
     C***********RECI      IFEQ 'D'                        - B3           ER0204
     C*********************EXSR P005                                      ER0204
     C*********************EXSR W002                                      ER0204
     C*********************END                             - E3           ER0204
     C*
     C*********************READ TRADV                    31               ER0204
     C*********************END                             - E2           ER0204
     C*
     C*********************END                             - E1           ER0204
     C*
     C** RE-INSTALL PROCESSING FOR TRADES
     C***********NPSN      IFNE WWNPSN                     - B1           ER0349
     C*********************Z-ADD0         WWCNUM  60               ER0349 ER0362
     C*********************MOVE *BLANKS   WWTDRF  6                ER0349 ER0362
     C*                                                                   ER0349
     C***********TRKEY     SETGTTRADV                               ER0349ER0354
     C*********************SETGTTRADIML                            ER0354 ER0362
     C*********************MOVE TDSS      WWTDSS 10                       ER0349
     C*********************Z-ADDTDBR      WWTDBR  30                      ER0349
     C*********************MOVELBHSC      WWTDSS 10                ER0349 ER0362
     C*********************Z-ADDBHBR      WWTDBR  30               ER0349 ER0362
     C*********************MOVELBPBK      WWBPBK  2                ER0349 ER0362
     C*                                                                   ER0349
     C*********************READ TRADV                    31         ER0349ER0354
     C*********************READ TRADIML                  31        ER0354 ER0362
     C*                                                                   ER0349
     C*********************MOVE TDSS      WWTDSS 10                       ER0349
     C*********************Z-ADDTDBR      WWTDBR  30                      ER0349
     C*                                                                   ER0349
     C** SAME SECURITY AND SAME BRANCH CODE                               ER0349
     C************IN31     DOWEQ'0'                        - B2    ER0349 ER0362
     C***********TDSS      ANDEQWWTDSS                             ER0349 ER0362
     C***********TDBR      ANDEQWWTDBR                             ER0349 ER0362
     C***********TDBK      ANDEQWWBPBK                             ER0349 ER0362
     C*                                                                   ER0349
     C*********************MOVE ISSR      AAISSR  6                ER0349 ER0362
     C*                                                                   ER0349
     C***********RECI      IFEQ 'D'                        - B3    ER0349 ER0362
     C*********************MOVE TCNR      AATCNR  6                ER0349 ER0362
     C***********AAISSR    IFEQ A8BICN                             ER0349 ER0362
     C***********LKRF      ORNE *BLANKS                    - B4    ER0349 ER0362
     C***********AATCNR    ANDEQA8BICN                             ER0349 ER0362
     C*********************GOTO NEXT                               ER0349 ER0362
     C**                                                                  ER0349
     C*********************ELSE                            - X4    ER0349 ER0362
     C*********************EXSR P005                               ER0349 ER0362
     C*********************EXSR W002                               ER0349 ER0362
     C*********************END                             - E4    ER0349 ER0362
     C*********************END                             - E3    ER0349 ER0362
     C*                                                                   ER0349
     C***********NEXT      TAG                                     ER0349 ER0362
     C*********************READ TRADV                    31         ER0349ER0354
     C*********************READ TRADIML                  31        ER0354 ER0362
     C*********************END                             - E2    ER0349 ER0362
     C*                                                                   ER0349
     C*********************END                             - E1           ER0349
     C*
     C***********          ENDSR                                          ULX004
     C**************************************************************************
     C* P005 - FORWARD VALUE DATE PROCESSING                                   *
     C**************************************************************************
     C*
     C***********P005      BEGSR                                          ER0204
     C*
     C** TRANSFORM VALUE DATE IN ABACUSS FORMAT - END DATE
     C*********************Z-ADDTDVD      @@DAYN                          ER0204
     C*********************EXSR ZDATE9                                    ER0204
     C*********************Z-ADD@@VDT     EXENDD                          ER0204
     C*
     C** ACCESS CUSTOMER DETAILS WITH COUNTERPARTY CUSTOMER NUMBER
     C*********************MOVE TCNR      AATCNR  6                       ER0204
     C***********AATCNR    CHAINSDCUSTL1             88                   ER0204
     C************IN88     IFEQ '1'                        - B1           ER0204
     C*********************MOVEL'012'     DBASE            ***************ER0204
     C*********************MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 12 ER0204
     C*********************MOVELAATCNR    DBKEY            ***************ER0204
     C*********************EXSR *PSSR                                     ER0204
     C*********************END                             - E1           ER0204
     C*
     C** STORE CUSTOMER NUMBER
     C*********************MOVE TCNR      EXCUST                          ER0204
     C*
     C** STORE COUNTRY OF LOCATION
     C*********************MOVE BBCOLC    EXCUCC                          ER0204
     C*
     C** STORE CUSTOMER SHORTNAME
     C*********************MOVE BBCSSN    EXCSSN                          ER0204
     C*
     C** STORE CUSTOMER REPORT NAME
     C*********************MOVE BBCRNM    EXCRNM                          ER0204
     C*
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK
     C***********BBPCNB    IFNE *BLANKS                    - B1           ER0204
     C*
     C***********BBPCNB    CHAINSDCUSTL1             88                   ER0204
     C************IN88     IFEQ '1'                        - B2           ER0204
     C*********************MOVEL'013'     DBASE            ***************ER0204
     C*********************MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 13 ER0204
     C*********************MOVELBBPCNB    DBKEY            ***************ER0204
     C*********************EXSR *PSSR                                     ER0204
     C*********************END                             - E2           ER0204
     C*
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE
     C*********************MOVE BBCUST    EXPCNB                          ER0204
     C*********************MOVE BBCOLC    EXPRCC                          ER0204
     C*********************ELSE                            - X1           ER0204
     C*
     C** RESET FIELDS
     C*********************MOVE *BLANKS   EXPCNB                          ER0204
     C*********************MOVE *BLANKS   EXPRCC                          ER0204
     C*********************END                             - E1           ER0204
     C*
     C** IF TRADE TYPE IS 'TS'
     C***********TDTP      IFEQ 'TS'                       - B1           ER0204
     C*********************Z-ADD1         EXDRCR                          ER0204
     C*********************ELSE                            - X1           ER0204
     C*********************Z-ADD0         EXDRCR                          ER0204
     C*********************END                             - E1           ER0204
     C*
     C** STORE EXERCICE AMOUNT
     C***********TCSR      MULT POW,B     EXEXEA                          ER0204
     C***********TCSR      DIV  POW,B     EXEXEA                          ER0204
     C*
     C** PRICE BASIS EQUAL 'P'
     C***********SPBS      IFEQ 'P'                        - B1           ER0204
     C*
     C***********NPSN      MULT MKPR      EXREAA                          ER0204
     C***********EXREAA    DIV  100       EXREAA                          ER0204
     C*
     C** STORE NOMINAL AMOUNT
     C***********NPSN      MULT POW,B     EXNOMA                          ER0204
     C***********NPSN      DIV  POW,B     EXNOMA                          ER0204
     C*
     C*********************ELSE                            - X1           ER0204
     C*
     C***********NPSN      MULT MKPR      EXREAA                          ER0204
     C*********************Z-ADDNPSN      EXNOMA                          ER0204
     C*
     C*********************END                             - E1           ER0204
     C*
     C** STORE REALISATION AMOUNT
     C***********EXREAA    MULT POW,B     EXREAA                          ER0204
     C***********EXREAA    DIV  POW,B     EXREAA                          ER0204
     C*
     C*********************ENDSR                                          ER0204
     C********************************************************************ER0349
     C* P005 - FORWARD VALUE DATE PROCESSING                              ER0349
     C********************************************************************ER0349
     C*                                                                   ER0349
     C***********P005      BEGSR                                   ER0349 ER0362
     C*                                                                   ER0349
     C** TRANSFORM VALUE DATE IN ABACUSS FORMAT - END DATE                ER0349
     C*********************Z-ADDTDVD      @@DAYN                   ER0349 ER0362
     C*********************EXSR ZDATE9                             ER0349 ER0362
     C*********************Z-ADD@@VDT     EXENDD                   ER0349 ER0362
     C*                                                                   ER0349
     C** ACCESS CUSTOMER DETAILS WITH COUNTERPARTY CUSTOMER NUMBER        ER0349
     C*********************MOVE TCNR      AATCNR  6                       ER0349
     C***********AATCNR    CHAINSDCUSTL1             88                   ER0349
     C************IN88     IFEQ '1'                        - B1           ER0349
     C*********************MOVEL'012'     DBASE            ***************ER0349
     C*********************MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 12 ER0349
     C*********************MOVELAATCNR    DBKEY            ***************ER0349
     C*********************EXSR *PSSR                                     ER0349
     C*********************END                             - E1           ER0349
     C*                                                                   ER0349
     C** STORE CUSTOMER NUMBER                                            ER0349
     C*********************MOVE TCNR      EXCUST                          ER0349
     C*                                                                   ER0349
     C** STORE COUNTRY OF LOCATION                                        ER0349
     C*********************MOVE BBCOLC    EXCUCC                          ER0349
     C*                                                                   ER0349
     C** STORE CUSTOMER SHORTNAME                                         ER0349
     C*********************MOVE BBCSSN    EXCSSN                          ER0349
     C*                                                                   ER0349
     C** STORE CUSTOMER REPORT NAME                                       ER0349
     C*********************MOVE BBCRNM    EXCRNM                          ER0349
     C*                                                                   ER0349
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK                        ER0349
     C***********BBPCNB    IFNE *BLANKS                    - B1           ER0349
     C*                                                                   ER0349
     C***********BBPCNB    CHAINSDCUSTL1             88                   ER0349
     C************IN88     IFEQ '1'                        - B2           ER0349
     C*********************MOVEL'013'     DBASE            ***************ER0349
     C*********************MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 13 ER0349
     C*********************MOVELBBPCNB    DBKEY            ***************ER0349
     C*********************EXSR *PSSR                                     ER0349
     C*********************END                             - E2           ER0349
     C*                                                                   ER0349
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE             ER0349
     C*********************MOVE BBCUST    EXPCNB                          ER0349
     C*********************MOVE BBCOLC    EXPRCC                          ER0349
     C*********************ELSE                            - X1           ER0349
     C*                                                                   ER0349
     C** RESET FIELDS                                                     ER0349
     C*********************MOVE *BLANKS   EXPCNB                          ER0349
     C*********************MOVE *BLANKS   EXPRCC                          ER0349
     C*********************END                             - E1           ER0349
     C*                                                                   ER0349
     C** IF TRADE TYPE IS 'TS'                                            ER0349
     C***********TDTP      IFEQ 'TS'                       - B1    ER0349 ER0362
     C*********************Z-ADD1         EXDRCR                   ER0349 ER0362
     C*********************ELSE                            - X1    ER0349 ER0362
     C*********************Z-ADD0         EXDRCR                   ER0349 ER0362
     C*********************END                             - E1    ER0349 ER0362
     C*                                                                   ER0349
     C** SETUP DECIMAL PLACES                                             ER0349
     C***********TNMC      CHAINSDCURRL1             88            ER0349 ER0362
     C************IN88     IFEQ '1'                        - B2    ER0349 ER0362
     C*********************MOVEL'027'     DBASE            ********ER0349 ER0362
     C*********************MOVEL'SDCURRL1'DBFILE           ** DB E ER0349 ER0362
     C*********************MOVELTNMC      DBKEY            ********ER0349 ER0362
     C*********************EXSR *PSSR                              ER0349 ER0362
     C*********************END                             - E2    ER0349 ER0362
     C***********7         SUB  A6NBDP    D       10               ER0349 ER0362
     C*                                                                   ER0349
     C** STORE EXERCICE AMOUNT                                            ER0349
     C***********TCSR      MULT POW,D     EXEXEA                   ER0349 ER0362
     C*                                                                   ER0349
     C** STORE PRINCIPAL AMOUNT                                           ER0349
     C***********TCSR      MULT POW,D     EXAMNT                   ER0349 ER0362
     C*                                                                   ER0349
     C** PRICE BASIS EQUAL 'P'                                            ER0349
     C***********SPBS      IFEQ 'P'                        - B1    ER0349 ER0362
     C*                                                                   ER0349
     C***********D         SUB  2         E       10               ER0349 ER0362
     C***********NPSN      MULT MKPR      EXREAA                   ER0349 ER0362
     C***********EXREAA    MULT POW,E     EXREAA                   ER0349 ER0362
     C*                                                                   ER0349
     C** STORE NOMINAL AMOUNT                                             ER0349
     C***********NPSN      MULT POW,E     EXNOMA                   ER0349 ER0362
     C*                                                                   ER0349
     C*********************ELSE                            - X1    ER0349 ER0362
     C*                                                                   ER0349
     C***********NPSN      MULT MKPR      EXREAA                   ER0349 ER0362
     C*********************Z-ADDNPSN      EXNOMA                   ER0349 ER0362
     C*                                                                   ER0349
     C*********************END                             - E1    ER0349 ER0362
     C*                                                                   ER0349
     C** STORE REALISATION AMOUNT                                         ER0349
     C***********EXREAA    MULT POW,D     EXREAA                   ER0349 ER0362
     C*                                                                   ER0349
     C*********************ENDSR                                   ER0349 ER0362
     C**************************************************************************
      * P006 - Subroutine to process FRNs, Yen bonds and mortgage              *
      *        backed securities                                               *
      **************************************************************************
      *
     C           P006      BEGSR                                          ULX004
      *
     C                     EXSR ZNRC                                      ULX004
     C                     Z-ADDNCD       DATE1   50                      ULX004
      *
     C           RCFQ      IFEQ *BLANKS                    B1             ULX004
      *                                                                   ULX004
     C                     Z-ADDMATY      DATE2   50                      ULX004
      *                                                                   ULX004
      ***  If next change date > reporting date store maturity date       ULX004
      *                                                                   ULX004
     C                     ELSE                            X1             ULX004
      *                                                                   ULX004
     C                     SELEC
     C           NCHD      WHGT EREOMD                     B2             ULX004
     C                     Z-ADDNCHD      DATE2                           ULX004
      *                                                                   ULX004
      ***  If rate change freq is daily store next working day            ULX004
      *                                                                   ULX004
     C           RCFQ      WHEQ 'D'                        B2             ULX004
     C                     Z-ADDBJDNWD    DATE2                           ULX004
      *                                                                   ULX004
      ***  If rate change freq is weekly                                  ULX004
      *                                                                   ULX004
     C           RCFQ      WHEQ 'W'                        B2             ULX004
     C           EREOMD    SUB  NCHD      DATE2                           ULX004
     C           DATE2     DIV  7         DATE2                           ULX004
     C                     ADD  1         DATE2                           ULX004
     C                     MULT 7         DATE2                           ULX004
     C                     ADD  NCHD      DATE2                           ULX004
      *                                                                   ULX004
      ***  If rate change freq is fortnightly                             ULX004
      *                                                                   ULX004
     C           RCFQ      WHEQ 'F'                        B2             ULX004
     C           EREOMD    SUB  NCHD      DATE2                           ULX004
     C           DATE2     DIV  14        DATE2                           ULX004
     C                     ADD  1         DATE2                           ULX004
     C                     MULT 14        DATE2                           ULX004
     C                     ADD  NCHD      DATE2                           ULX004
      *                                                                   ULX004
      ***  If rate change freq is monthly                                 ULX004
      *                                                                   ULX004
     C           RCFQ      WHEQ 'M'                        B2             ULX004
     C                     Z-ADDNCHD      @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C                     Z-ADDNCHD      ZDAYNO                          ULX004
     C                     Z-ADD@@Z71D    ZMDAY                           ULX004
     C                     MOVE 'M'       ZFREQ                           ULX004
     C                     MOVE NCRY      ZCCY                            ULX004
     C           ZDAYNO    DOUGTEREOMD                     B3             ULX004
     C                     EXSR ZFRQA                                     ULX004
     C                     ENDDO                           E3             ULX004
      *
     C           ZDAYNO    IFGT MATY                       B3             ULX004
     C                     Z-ADDMATY      DATE2                           ULX004
     C                     ELSE                            X3             ULX004
     C                     Z-ADDZDAYNO    DATE2                           ULX004
     C                     ENDIF                           E3             ULX004
     C                     ENDSL                           E2             ULX004
      *
     C                     ENDIF                           E1             ULX004
      *
     C           DATE1     IFLE DATE2                      B1             ULX004
     C                     Z-ADDDATE1     DATE2                           ULX004
     C                     ENDIF                           E1             ULX004
      *
     C                     Z-ADDDATE2     @@DAYN                          ULX004
     C                     EXSR ZDATE9                                    ULX004
     C*********************Z-ADD@@VDT     EXDATA                   ULX004 CAD007
     C                     Z-ADD@@VDT     EXNIFD                          CAD007
      *
     C                     ENDSR                                          ULX004
      *
     C**************************************************************************
     C* W001 - SUBROUTINE TO WRITE A RECORD IN EREXTRPD OUTPUT FILE            *
     C**************************************************************************
     C*
     C           W001      BEGSR
     C*
     C                     MOVE WWSKTV    EXRCSI                          CAD002
     C*                                                                   CAD002
     C                     Z-ADD003       EXRECT
     C                     MOVE 'SEC'     EXLOTD
     C                     MOVE 'SECU'    EXRIND
     C                     Z-ADDWWREPD    EXREPD
     C***********          MOVE BHBR      EXBRCD                          ER_R10
     C                     MOVE BHBA      EXBRCD                          ULX004
     C*
     C** SETUP TRANSACTION REFERENCE
     C*********************MOVELBHBK      WWTREF 12                       ERL400
     C*********************MOVE BHSC      WWTREF                          ERL400
     C*********************MOVELWWTREF    EXTREF                          ERL400
     C*********************MOVE BHMK      EXTREF                   ER0119 ERL400
     C                     MOVE BHBK      EXBHBK                          ERL400
     C                     MOVE BHSC      EXBHSC                          ERL400
     C                     MOVE PROT      EXPROT                          ERL400
     C                     MOVE BHMK      EXBHMK                          ERL400
     C*
     C** SETUP DECISION TABLE KEY
     C                     MOVELINVT      WWDECK  5
     C                     MOVE BHBK      WWDECK
     C                     MOVELWWDECK    EXDECK
     C*                                                                   ER0359
     C** STORE INITIAL DATE OF SECURITY IN START DATE                     ER0359
     C           ITLD      IFNE *ZEROS                                    ULX047
     C                     Z-ADDITLD      @@DAYN  50                      ER0359
     C                     ELSE                                           ULX047
     C                     Z-ADDISSD      @@DAYN                          ULX047
     C                     ENDIF                                          ULX047
     C                     EXSR ZDATE9                                    ER0359
     C                     Z-ADD@@VDT     EXSTRD                          ER0359
      *                                                                   ULX004
      ***  Start Date                                                     ULX004
      *                                                                   ULX004
     C                     Z-ADD@@VDT     EXSTDA                          ULX004
     C*                                                                   ART021
     C** STORE ISSUE DATE OF SECURITY IN SREPORTING PERIOD TO AVOID TO    ART021
     C** RECOMPILE EREXTRPD                                               ART021
     C                     Z-ADDISSD      @@DAYN  50                      ART021
     C                     EXSR ZDATE9                                    ART021
     C                     Z-ADD@@VDT     EXREPP                          ART021
     C*
     C                     MOVE NCRY      EXCCYC
     C                     MOVE WWORCC    EXORCC
     C                     MOVE ISSR      EXCUST
     C                     MOVE ISSR      EXISSR                          ULX004
     C*                                                                   ERL328
     C** SETUP NET AMOUNT WITH PRINCIPAL AMOUNT                           ERL328
     C                     Z-ADDEXAMNT    EXNETA                          ERL328
      *                                                                   CEU007
      ***  If the feature CEU007 is installed, filling the new fields     CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                        B1             CEU007
      *                                                                   CEU007
      ***  Set up the fields with :                                       CEU007
      ***  NCCY from PF/BPOHTR                                            CEU007
      ***  BJSLCD from PF/SDBANKPD                                        CEU007
      *                                                                   CEU007
     C                     MOVELNCRY      EXSDCU           St.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXSDLO           St.Dat.Sett.LocCEU007
     C                     MOVELNCRY      EXEDCU           En.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXEDLO           En.Dat.Sett.LocCEU007
     C                     MOVELNCRY      EXRDCU           Re.Dat.Sett.CcyCEU007
     C                     MOVELBJSLCD    EXRDLO           Re.Dat.Sett.LocCEU007
      *                                                                   CEU007
     C                     ENDIF                           E1             CEU007
      *                                                                   CEU007
     C*                                                                   ULX004
     C** Accrued Interest and Interest to accrue                          ULX004
     C***********BHBK      CHAINIACEXL1              88            ULX004 182312
     C                     MOVELBHBA      K#BRCH                          182312
     C                     MOVELBHBK      K#BOOK                          182312
     C                     MOVELNCRY      K#CURR                          182312
     C                     MOVELINVT      K#INVT                          182312
     C                     MOVELBHSC      K#SCSN                          182312
     C           KACEX     CHAINIACEXL2              88                   182312
     C           *IN88     IFEQ '1'                        - B1           ULX004
     C                     Z-ADD*ZEROS    EXACCR                          ULX004
     C                     ELSE                            - X1           ULX004
     C*                                                                   ULX004
     C                     Z-ADDIARC      W#ACCR 160                      182312
      *                                                                   182312
      ***  When Last coupon eq 0                                          182312
      *                                                                   182312
     C           LCPN      IFEQ 0                                         182312
     C                     ADD  IAPI      W#ACCR                          182312
     C                     ENDIF                                          182312
     C           A6NBDP    IFEQ 0                          - B2           ULX004
     C***********IARC      MULT 1000      EXACCR                   ULX004 182312
     C           W#ACCR    MULT 1000      EXACCR                          182312
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 1                          - B2           ULX004
     C***********IARC      MULT 100       EXACCR                   ULX004 182312
     C           W#ACCR    MULT 100       EXACCR                          182312
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 2                          - B2           ULX004
     C***********IARC      MULT 10        EXACCR                   ULX004 182312
     C           W#ACCR    MULT 10        EXACCR                          182312
     C                     END                             - E2           ULX004
     C           A6NBDP    IFEQ 3                          - B2           ULX004
     C*********************Z-ADDIARC      EXACCR                   ULX004 182312
     C                     Z-ADDW#ACCR    EXACCR                          182312
     C                     END                             - E2           ULX004
     C                     END                             - E1           ULX004
     C*                                                                   ULX004
     C** Interest to accrue                                               ULX004
     C                     Z-ADD*ZEROS    EXITAC                          ULX004
     C*                                                                   ULX004
     C** Start/Last Interest Date                                         ULX004
     C                     Z-ADD*ZEROS    EXSLID                          ULX004
     C*                                                                   ULX004
     C** Next Interest Due Date                                           ULX004
     C                     Z-ADD*ZEROS    EXNIDT                          ULX004
     C*                                                                   ULX004
     C** Retail Indicators                                                ULX004
     C                     MOVE *BLANKS   EXRETB                          ULX004
     C*
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
      ** Quantity of Stocks                                               ULX046
      *                                                                   ULX046
     C                     Z-ADDNPSN      EXQSTK                          ULX046
      *                                                                   ULX046
      ** Multiplying Factor of an OST on the Quantity of Stocks           ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXMFQS                          ULX046
      *                                                                   ULX046
     C                     MOVELBHSC      KKBPSC    P      Security       ULX046
     C                     MOVELBHBA      KKBPBA    P      Branch         ULX046
     C                     MOVELBHBK      KKBPBK    P      Book           ULX046
     C                     Z-ADDWWFDOM    KKBPPD           Position Date  ULX046
     C                     MOVELBHMK      KKBPMK    P      Market         ULX046
      *                                                                   ULX046
      ** Key field to retrieve previous position.                         ULX046
      *                                                                   ULX046
     C           KPRVPS    SETLLBKPOSDT                                   ULX046
     C                     READPBKPOSDT                  99               ULX046
     C           *IN99     IFEQ *OFF                                      ULX046
     C           BHSC      ANDEQPVBPSC                     Security       ULX046
     C           BHBA      ANDEQPVBPBA                     Branch         ULX046
     C           BHBK      ANDEQPVBPBK                     Book           ULX046
     C           BHMK      ANDEQPVBPMK                     Market         ULX046
     C           PVNPSN    ANDNE*ZEROS                                    ULX046
     C           PVNPSN    IFLT *ZEROS                                    ULX046
     C                     Z-SUBPVNPSN    PVNPSN                          ULX046
     C                     ENDIF                                          ULX046
     C           EXQSTK    DIV  PVNPSN    EXMFQS    H                     ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Discounted Security Indicator                                    ULX046
      *                                                                   ULX046
     C           STBS      IFEQ 'D'                        Discount       ULX046
     C                     Z-ADD1         EXDISC                          ULX046
     C                     ELSE                            Otherwise      ULX046
     C                     Z-ADD*ZEROS    EXDISC                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Unique Contract Reference                                        ULX046
      *                                                                   ULX046
     C           EXRIND    CAT  EXTREF:1  EXCTRF                          ULX046
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C** WRITE A RECORD ONLY IF NOMIMAL POSITION NOT EQUAL 0
     C***********NPSN      IFNE 0                          - B1           ULX004
     C           EXAMNT    IFNE 0                          - B1           ULX004
     C*                                                                   ER0136
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0136
     C                     ADD  1         NREC    30                      ER0136
     C*
     C** WRITE A RECORD
     C                     WRITEEREXTRF0
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C******************************************************************* 225555
     C* W002 - SUBROUTINE TO WRITE A SECOND RECORD IN OUTPUT FILE       * 225555
     C******************************************************************* 225555
     C*                                                                   225555
     C           W002      BEGSR                                          225555
     C*                                                                   225555
     C                     MOVE WWSKTV    EXRCSI                          225555
     C*                                                                   225555
     C                     Z-ADD003       EXRECT                          225555
     C                     MOVE 'SEF'     EXLOTD                          225555
     C                     MOVE 'SEFU'    EXRIND                          225555
     C                     Z-ADDWWREPD    EXREPD                          225555
     C                     MOVE BHBA      EXBRCD                          225555
     C*                                                                   225555
     C** SETUP TRANSACTION REFERENCE                                      225555
     C                     MOVE BHBK      EXBHBK                          225555
     C                     MOVE BHSC      EXBHSC                          225555
     C                     MOVE PROT      EXPROT                          225555
     C                     MOVE BHMK      EXBHMK                          225555
     C*                                                                   225555
     C** SETUP DECISION TABLE KEY                                         225555
     C                     MOVELINVT      WWDECK  5                       225555
     C                     MOVE BHBK      WWDECK                          225555
     C                     MOVELWWDECK    EXDECK                          225555
     C*                                                                   225555
     C** STORE INITIAL DATE OF SECURITY IN START DATE                     225555
     C           ITLD      IFNE *ZEROS                                    225555
     C                     Z-ADDITLD      @@DAYN  50                      225555
     C                     ELSE                                           225555
     C                     Z-ADDISSD      @@DAYN                          225555
     C                     ENDIF                                          225555
     C                     EXSR ZDATE9                                    225555
     C                     Z-ADD@@VDT     EXSTRD                          225555
      *                                                                   225555
      ***  Start Date                                                     225555
      *                                                                   225555
     C                     Z-ADD@@VDT     EXSTDA                          225555
     C*                                                                   225555
     C** STORE ISSUE DATE OF SECURITY IN SREPORTING PERIOD TO AVOID TO    225555
     C** RECOMPILE EREXTRPD                                               225555
     C                     Z-ADDISSD      @@DAYN  50                      225555
     C                     EXSR ZDATE9                                    225555
     C                     Z-ADD@@VDT     EXREPP                          225555
     C*                                                                   225555
     C                     MOVE NCRY      EXCCYC                          225555
     C                     MOVE WWORCC    EXORCC                          225555
     C                     MOVE ISSR      EXCUST                          225555
     C                     MOVE ISSR      EXISSR                          225555
     C*                                                                   225555
     C** SETUP DISCOUNT/PREMIUM AMOUNT                                    225555
     C                     Z-ADDEXAMNT    EXNETA                          225555
      *                                                                   225555
      ***  If the feature CEU007 is installed, filling the new fields     225555
      *                                                                   225555
     C           CEU007    IFEQ 'Y'                        B1             225555
      *                                                                   225555
      ***  Set up the fields with :                                       225555
      ***  NCCY from PF/BPOHTR                                            225555
      ***  BJSLCD from PF/SDBANKPD                                        225555
      *                                                                   225555
     C                     MOVELNCRY      EXSDCU           St.Dat.Sett.Ccy225555
     C                     MOVELBJSLCD    EXSDLO           St.Dat.Sett.Loc225555
     C                     MOVELNCRY      EXEDCU           En.Dat.Sett.Ccy225555
     C                     MOVELBJSLCD    EXEDLO           En.Dat.Sett.Loc225555
     C                     MOVELNCRY      EXRDCU           Re.Dat.Sett.Ccy225555
     C                     MOVELBJSLCD    EXRDLO           Re.Dat.Sett.Loc225555
      *                                                                   225555
     C                     ENDIF                           E1             225555
      *                                                                   225555
     C*                                                                   225555
     C** Accrued Interest and Interest to accrue                          225555
     C                     MOVELBHBA      K#BRCH                          225555
     C                     MOVELBHBK      K#BOOK                          225555
     C                     MOVELNCRY      K#CURR                          225555
     C                     MOVELINVT      K#INVT                          225555
     C                     MOVELBHSC      K#SCSN                          225555
     C           KACEX     CHAINIACEXL2              88                   225555
     C           *IN88     IFEQ '1'                        - B1           225555
     C                     Z-ADD*ZEROS    EXACCR                          225555
     C                     ELSE                            - X1           225555
     C*                                                                   225555
     C                     Z-ADDIARC      W#ACCR 160                      225555
      *                                                                   225555
      ***  When Last coupon eq 0                                          225555
      *                                                                   225555
     C           LCPN      IFEQ 0                                         225555
     C                     ADD  IAPI      W#ACCR                          225555
     C                     ENDIF                                          225555
     C           A6NBDP    IFEQ 0                          - B2           225555
     C           W#ACCR    MULT 1000      EXACCR                          225555
     C                     END                             - E2           225555
     C           A6NBDP    IFEQ 1                          - B2           225555
     C           W#ACCR    MULT 100       EXACCR                          225555
     C                     END                             - E2           225555
     C           A6NBDP    IFEQ 2                          - B2           225555
     C           W#ACCR    MULT 10        EXACCR                          225555
     C                     END                             - E2           225555
     C           A6NBDP    IFEQ 3                          - B2           225555
     C                     Z-ADDW#ACCR    EXACCR                          225555
     C                     END                             - E2           225555
     C                     END                             - E1           225555
     C*                                                                   225555
     C** Interest to accrue                                               225555
     C                     Z-ADD*ZEROS    EXITAC                          225555
     C*                                                                   225555
     C** Start/Last Interest Date                                         225555
     C                     Z-ADD*ZEROS    EXSLID                          225555
     C*                                                                   225555
     C** Next Interest Due Date                                           225555
     C                     Z-ADD*ZEROS    EXNIDT                          225555
     C*                                                                   225555
     C** Retail Indicators                                                225555
     C                     MOVE *BLANKS   EXRETB                          225555
     C*                                                                   225555
      ** ULX046 Circulars 2002/170-174-175 Integration                    225555
      *                                                                   225555
     C           ULX046    IFEQ 'Y'                                       225555
      *                                                                   225555
      ** Quantity of Stocks                                               225555
      *                                                                   225555
     C                     Z-ADDNPSN      EXQSTK                          225555
      *                                                                   225555
      ** Multiplying Factor of an OST on the Quantity of Stocks           225555
      *                                                                   225555
     C                     Z-ADD*ZEROS    EXMFQS                          225555
      *                                                                   225555
     C                     MOVELBHSC      KKBPSC    P      Security       225555
     C                     MOVELBHBA      KKBPBA    P      Branch         225555
     C                     MOVELBHBK      KKBPBK    P      Book           225555
     C                     Z-ADDWWFDOM    KKBPPD           Position Date  225555
     C                     MOVELBHMK      KKBPMK    P      Market         225555
      *                                                                   225555
      ** Key field to retrieve previous position.                         225555
      *                                                                   225555
     C           KPRVPS    SETLLBKPOSDT                                   225555
     C                     READPBKPOSDT                  99               225555
     C           *IN99     IFEQ *OFF                                      225555
     C           BHSC      ANDEQPVBPSC                     Security       225555
     C           BHBA      ANDEQPVBPBA                     Branch         225555
     C           BHBK      ANDEQPVBPBK                     Book           225555
     C           BHMK      ANDEQPVBPMK                     Market         225555
     C           PVNPSN    ANDNE*ZEROS                                    225555
     C           PVNPSN    IFLT *ZEROS                                    225555
     C                     Z-SUBPVNPSN    PVNPSN                          225555
     C                     ENDIF                                          225555
     C           EXQSTK    DIV  PVNPSN    EXMFQS    H                     225555
     C                     ENDIF                                          225555
      *                                                                   225555
      ** Discounted Security Indicator                                    225555
      *                                                                   225555
     C           STBS      IFEQ 'D'                        Discount       225555
     C                     Z-ADD1         EXDISC                          225555
     C                     ELSE                            Otherwise      225555
     C                     Z-ADD*ZEROS    EXDISC                          225555
     C                     ENDIF                                          225555
      *                                                                   225555
      ** Unique Contract Reference                                        225555
      *                                                                   225555
     C           EXRIND    CAT  EXTREF:1  EXCTRF                          225555
      *                                                                   225555
     C                     ENDIF                                          225555
      *                                                                   225555
     C** WRITE A RECORD ONLY IF NOMIMAL POSITION NOT EQUAL 0              225555
     C           EXAMNT    IFNE 0                          - B1           225555
     C*                                                                   225555
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             225555
     C                     ADD  1         NREC    30                      225555
     C*                                                                   225555
     C** WRITE A RECORD                                                   225555
     C                     WRITEEREXTRF0                                  225555
     C*                                                                   225555
     C                     END                             - E1           225555
     C*                                                                   225555
     C                     ENDSR                                          225555
     C*                                                                   225555
     C********************************************************************225555
     C**************************************************************************
     C* W002 - SUBROUTINE TO WRITE A SECOND RECORD IN OUTPUT FILE              *
     C**************************************************************************
     C*
     C***********W002      BEGSR                                          ER0204
     C*
     C*********************MOVE 'SEF'     EXLOTD                          ER0204
     C*********************MOVE 'SEFU'    EXRIND                          ER0204
     C*
     C** TRADE REFERENCE
     C*********************MOVE *BLANKS   EXTREF                          ER0204
     C*********************MOVELTDRF      EXTREF                          ER0204
     C*
     C*********************Z-ADD0         EXREVD                          ER0204
     C*                                                                   ER0136
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0136
     C*********************ADD  1         NREC    30               ER0136 ER0204
     C*
     C* WRITE A RECORD
     C*********************WRITEEREXTRF0                                  ER0204
     C*
     C*********************ENDSR                                          ER0204
     C*                                                                   ER0349
     C***********W002      BEGSR                                   ER0349 ER0362
     C*                                                                   ER0349
     C*********************MOVE 'SEF'     EXLOTD                   ER0349 ER0362
     C*********************MOVE 'SEFU'    EXRIND                   ER0349 ER0362
     C*                                                                   ER0349
     C** TRADE REFERENCE                                                  ER0349
     C*********************MOVE *BLANKS   EXTREF                   ER0349 ER0362
     C*********************MOVELTDRF      EXTREF                   ER0349 ER0362
     C*                                                                   ER0349
     C** DECISION KEY                                                     ER0349
     C*********************MOVELEXDECK    XXDECK  6                ER0349 ER0362
     C*********************MOVE 'O'       XXDECK                   ER0349 ER0362
     C*********************MOVELXXDECK    EXDECK                   ER0349 ER0362
     C*                                                                   ER0349
     C*********************Z-ADD0         EXREVD                   ER0349 ER0362
     C*                                                                   ER0359
     C** STORE TRADE DATE OF TRADE IN START DATE                          ER0359
     C*********************Z-ADDTDDT      @@DAYN  50               ER0359 ER0362
     C*********************EXSR ZDATE9                             ER0359 ER0362
     C*********************Z-ADD@@VDT     EXSTRD                   ER0359 ER0362
     C*                                                                   ER0349
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0349
     C*********************ADD  1         NREC    30               ER0349 ER0362
     C*                                                                   ER0349
     C* WRITE A RECORD                                                    ER0349
     C*********************WRITEEREXTRF0                           ER0349 ER0362
     C*                                                                   ER0349
     C*********************ENDSR                                   ER0349 ER0362
     C**************************************************************************
     C* REVDAT - SUBROUTINE TO CALCULATE REVISION DATE                         *
     C**************************************************************************
     C*
     C           REVDAT    BEGSR
     C*
     C                     MOVEA*ZEROS    REV
     C*
     C**  STORE ARRAY ==> IN FORMAT JJMM
     C                     Z-ADDCD01      REV,1
     C                     Z-ADDCD02      REV,2
     C                     Z-ADDCD03      REV,3
     C                     Z-ADDCD04      REV,4
     C                     Z-ADDCD05      REV,5
     C                     Z-ADDCD06      REV,6
     C                     Z-ADDCD07      REV,7
     C                     Z-ADDCD08      REV,8
     C                     Z-ADDCD09      REV,9
     C                     Z-ADDCD10      REV,10
     C                     Z-ADDCD11      REV,11
     C                     Z-ADDCD12      REV,12
     C*
     C** SETUP ARRAY ==> IN FORMAT MMJJ
     C                     Z-ADD1         I
     C           I         DOWLE12                         - B1
     C                     MOVEAREV,I     TRAVNU  40
     C                     MOVE TRAVNU    TRAV    4
     C                     MOVE TRAV      WTRAV   2
     C                     MOVELTRAV      XTRAX   2
     C                     MOVE *BLANKS   TRAV
     C                     MOVE XTRAX     TRAV
     C                     MOVELWTRAV     TRAV
     C                     MOVE TRAV      TRAVNU
     C                     MOVEATRAVNU    REV,I
     C                     ADD  1         I
     C                     END                             - E1
     C*
     C** SORT ARRAY REV
     C                     SORTAREV
     C*
     C** CHECK IF ARRAY EMPTY
     C                     XFOOTREV       TOTREV  40
     C                     MOVE *BLANKS   WWREVD  8
     C*
     C           TOTREV    IFEQ 0                          - B1
     C                     Z-ADD0         EXREVD
     C                     ELSE                            - X1
     C                     Z-ADD1         I       20
     C*
     C** CHECK IF DATE IN ARRAY IS GREATER THAN RUN DATE
     C           I         DOWLE12                         - B2
     C*
     C           RUNREV    IFLE REV,I                      - B3
     C                     MOVE REV,I     WWREVD
     C                     MOVELWWYYYY    WWREVD
     C                     MOVE WWREVD    EXREVD
     C                     LEAVE
     C                     END                             - E3
     C*
     C                     ADD  1         I
     C                     END                             - E2
     C*
     C** IF RUN DATE GREATER THAN ARRAY VALUES
     C           WWREVD    IFEQ *BLANKS                    - B2
     C                     Z-ADD1         I
     C           I         DOWLE12                         - B3
     C*
     C           REV,I     IFNE *ZEROS                     - B4
     C                     MOVE REV,I     WWREVD
     C           WWYYYY    ADD  1         WWYYY2  40
     C                     MOVELWWYYY2    WWREVD
     C                     MOVE WWREVD    EXREVD
     C                     LEAVE
     C                     END                             - E4
     C*
     C                     ADD  1         I
     C                     END                             - E3
     C*
     C                     END                             - E2
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C**=================================================================
      **
      **  #INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
      **              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
     C**
      **     CALLED BY PROGRAM
      **     CALLS     *PSSR
      **
     C**=================================================================
     C**                                                   *****************
     C           #INIT     BEGSR                           ** #INIT BEGSR **
     C**                                                                  CAD002
     C           *ENTRY    PLIST                                          CAD002
     C                     PARM           WWSKTV  1                       CAD002
     C**                                                   *****************
     C**  PREPARE LDA:
     C**
     C           *NAMVAR   DEFN           LDA                             ULX004
     C******               MOVEL*BLANK    DBLOT                           ULX004
     C                     MOVEL'ER0627'  DBPGM
      *                                                                   CAD007
     C           KBSRT     KLIST                                          CAD007
     C                     KFLD           KKCCY   3        * Currency     CAD007
     C                     KFLD           KKBSRT  2        * Base Rate    CAD007
     C*
     C** INITIALIZE WORK FIELD FOR BRANCH
     C***********          Z-ADD0         WWBHBR                          ER_R10
     C                     MOVEL*BLANKS   WWBHBR                          ULX004
     C*                                                                   ER0136
     C** INITIALIZE WORK FIELD FOR NUMBER OF EXTRACTED RECORDS            ER0136
     C                     Z-ADD0         NREC                            ER0136
     C*
     C**  INITIALIZE INDICATORS:
     C                     MOVE '0'       *IN
     C**
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C                     READ SDBANKL1                 81
     C**
     C**  IF RECORD NOT FOUND:
     C           *IN81     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       ULX004
     C                     MOVEL'001'     DBASE            *****************
     C                     MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       ULX004
     C                     EXSR *PSSR
     C                     END                             - E1
      *                                                                   CEU007
      ***  Check if the feature CEU007 is installed.                      CEU007
      *                                                                   CEU007
     C                     MOVEL'N'       CEU007  1                       CEU007
     C                     CALL 'AOSARDR0'                                CEU007
     C                     PARM '       ' @RTCD   7                       CEU007
     C                     PARM '*VERIFY' @OPTN   7                       CEU007
     C                     PARM 'CEU007'  @SARD   6                       CEU007
      *                                                                   CEU007
     C           @RTCD     IFEQ *BLANKS                                   CEU007
      *                                                                   CEU007
      ***  It's existing.                                                 CEU007
      *                                                                   CEU007
     C                     MOVEL'Y'       CEU007                          CEU007
      *                                                                   CEU007
     C                     ENDIF                                          CEU007
      *                                                                   ULX046
      ***  Check if the feature ULX046 is installed.                      ULX046
      *                                                                   ULX046
     C                     MOVEL'N'       ULX046  1                       ULX046
     C                     CALL 'AOSARDR0'                                ULX046
     C                     PARM '       ' @RTCD                           ULX046
     C                     PARM '*VERIFY' @OPTN                           ULX046
     C                     PARM 'ULX046'  @SARD                           ULX046
      *                                                                   ULX046
     C           @RTCD     IFEQ *BLANKS                                   ULX046
     C                     MOVEL'Y'       ULX046                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C           *LIKE     DEFN BPSC      KKBPSC           Security       ULX046
     C           *LIKE     DEFN BPBA      KKBPBA           Branch         ULX046
     C           *LIKE     DEFN BPBK      KKBPBK           Book           ULX046
     C           *LIKE     DEFN BPPD      KKBPPD           Position Date  ULX046
     C           *LIKE     DEFN BPMK      KKBPMK           Market         ULX046
      *                                                                   ULX046
      ** Key field to retrieve previous position.                         ULX046
      *                                                                   ULX046
     C           KPRVPS    KLIST                                          ULX046
     C                     KFLD           KKBPSC           Security       ULX046
     C                     KFLD           KKBPBA           Branch         ULX046
     C                     KFLD           KKBPBK           Book           ULX046
     C                     KFLD           KKBPPD           Position Date  ULX046
     C                     KFLD           KKBPMK           Market         ULX046
     C*                                                                   ERL465
     C**  GET GENERAL LEDGER DATA RECORD:                                 ERL465
     C                     READ SDGELRL1                 81               ERL465
     C*                                                                   ERL465
     C**  IF RECORD NOT FOUND:                                            ERL465
     C           *IN81     IFEQ '1'                        - B1           ERL465
     C                     MOVEL'001'     DBASE            ***************ERL465
     C                     MOVEL'SDGELRL1'DBFILE           ** DB ERROR XX ERL465
     C                     MOVEL' NONE '  DBKEY            ***************ERL465
     C                     EXSR *PSSR                                     ERL465
     C                     END                             - E1           ERL465
     C*                                                               *   ERL465
     C** RETRIEVE EVENT CONTROL DATE                                 *    ERL465
     C                     Z-ADDBKAPDT    ZZAPDT                          ERL465
     C                     Z-ADDBJDNWD    ZZDNWD                          ERL465
     C                     EXSR ZEVCD                                     ERL465
     C*
     C** CHECK FOR END OF MONTH                                           ART021
     C                     CALL 'SD2000'                                  ART021
     C                     PARM 'N'       EOM     1                       ART021
     C                     PARM 'N'       EOY     1                       ART021
     C*                                                                   ART021
     C           EOM       IFEQ 'Y'                                       ART021
     C                     EXSR #DATE                      RUN DATE       ER0317
     C                     EXSR #EOMD                      END OF MONTH   ER0317
     C                     ELSE                                           ART021
     C                     Z-ADDBJRDNB    EREOMD                          ART021
     C                     END                                            ART021
      *
     C                     Z-ADDBJRDNB    ECD     50                      ULX004
     C           BJDFIN    IFEQ 'M'                                       ULX004
     C                     MOVE *ON       *IN98                           ULX004
     C                     ENDIF                                          ULX004
      *
      ** GET REPORTING DATE IN FORMAT YYYYMMDD
      *********************Z-ADDBJRDNB    @@DAYN  50                      ER0317
     C                     Z-ADDEREOMD    @@DAYN  50                      ER0317
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     WWREPD
      *
     C** SETUP RUN DATE FOR REVISION PROCESSING  (MMJJ)
     C                     MOVELWWMM      WWREV   4
     C                     MOVE WWDD      WWREV
     C                     MOVE WWREV     RUNREV  40
      *                                                                   ULX046
      ** RETRIEVE FIRST DATE OF THE MONTH                                 ULX046
     C                     Z-ADDWWREPD    ZZDTIN                          ULX046
     C                     Z-ADD01        ZWDAY                           ULX046
     C                     Z-ADDZZDTIN    WWFDTM  80                      ULX046
     C                     EXSR ZDAT10                                    ULX046
     C                     Z-ADDZZMDNO    WWFDOM  50                      ULX046
     C*                                                                   ER0136
     C                     WRITEHEADAU                                    ER0136
     C*
     C** SETUP KEY FOR 'BK'
     C           BKKEY     KLIST
     C                     KFLD           BHSC
     C***********          KFLD           BHBR                            ER_R10
     C                     KFLD           BHBA                            ULX004
     C                     KFLD           BHBK
     C                     KFLD           BHMK
     C                     KFLD           BHTV
     C                     KFLD           LPSD
     C*
     C** SETUP KEY FOR 'GEST2'                                            225555
     C           GEKEY     KLIST                                          225555
     C                     KFLD           OTST                            225555
     C*                                                                   225555
     C** SETUP KEY FOR 'BH'
     C           BHKEY     KLIST
     C***********          KFLD           BHBR                            ER_R10
     C                     KFLD           BHBA                            ULX004
     C                     KFLD           BHBK
     C                     KFLD           INVT
     C                     KFLD           BHSC
     C                     KFLD           BHMK
     C*
     C** SETUP KEY FOR 'IN'
     C           INKEY     KLIST
     C                     KFLD           NCRY
     C                     KFLD           INVT
     C*                                                                   ERB457
     C** SETUP KEY FOR 'BI'                                               ERB457
     C           BKIVKY    KLIST                                          ERB457
     C                     KFLD           BHBK                            ERB457
     C                     KFLD           INVT                            ERB457
     C*
     C** SETUP KEY FOR 'TR'
     C***********TRKEY     KLIST                                          ER0204
     C*********************KFLD           BHSC                            ER0204
     C*********************KFLD           BHBR                            ER0204
     C*********************KFLD           BJRDNB                          ER0204
     C*********************KFLD           WWCNUM                          ER0204
     C*********************KFLD           WWTDRF                          ER0204
     C***********TRKEY     KLIST                                   ER0349 ER0362
     C*********************KFLD           BHSC                     ER0349 ER0362
     C*********************KFLD           BHBR                     ER0349 ER0362
     C*********************KFLD           BPBK                     ER0354 ER0362
     C*********************KFLD           BJRDNB                   ER0349 ER0362
     C*********************KFLD           WWCNUM                   ER0349 ER0362
     C*********************KFLD           WWTDRF                   ER0349 ER0362
     C*
      ***  SETUP KEY FOR IACEXL2                                          182312
      *                                                                   182312
     C           KACEX     KLIST                                          182312
     C                     KFLD           K#BRCH  3                       182312
     C                     KFLD           K#BOOK  2                       182312
     C                     KFLD           K#CURR  3                       182312
     C                     KFLD           K#INVT  3                       182312
     C                     KFLD           K#SCSN 10                       182312
      *                                                                   182312
     C                     ENDSR
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #DATE      - SUBROUTINE TO RUN DATE                             ER0317
      **                                                                  ER0317
      **  CALLS      -                                                    ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #DATE     BEGSR                                          ER0317
     C**                                                                  ER0317
     C**   DAY                                                            ER0317
     C                     Z-ADDWWBJD     ERDADD  20       DAY            ER0317
     C**   MONTH                                                          ER0317
     C                     Z-ADD1         X       20       X : INDEX      ER0317
     C           WWBJM     LOKUPZMNM,X                   2626 : EQUAL     ER0317
     C           *IN26     IFEQ '1'                                       ER0317
     C                     Z-ADDX         ERDAMM  20       MONTH          ER0317
     C                     END                                            ER0317
     C**   YEAR                                                           ER0317
     C                     Z-ADDWWBJY     ERDAYY  20       YEAR           ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #EOMD      - SUBROUTINE TO COMPUTE END OF MONTH                 ER0317
      **                                                                  ER0317
      **  CALLS      - ZDATE1                                             ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #EOMD     BEGSR                                          ER0317
     C**                                                                  ER0317
     C                     Z-ADDERDAYY    WWY              YEAR           ER0317
     C                     Z-ADDERDAMM    WWM              MONTH          ER0317
     C                     Z-ADDTNDM,WWM  WWD              DAY            ER0317
     C**                                                                  ER0317
     C           *IN99     DOUEQ'0'                        - B1           ER0317
     C                     Z-ADDWWDATE    ZDATE                           ER0317
     C                     EXSR ZDATE1                                    ER0317
     C                     SUB  1         WWD                             ER0317
     C                     END                             - E1           ER0317
     C**                                                                  ER0317
     C                     Z-ADDZDAYNO    EREOMD  50       END OF MONTH   ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
     C********************************************************************
     C** *PSSR  S/R
     C*================================================================
     C           *PSSR     BEGSR
     C*
     C*********************WRITEHEADAU                                    ER0136
     C                     WRITEERROR                                     ER0136
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************ER0317
     C**                                                                  ER0317
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND                     ER0317
     C**              CONVERT TO A NUMBER OF DAYS.                        ER0317
     C**                                                                  ER0317
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         ER0317
     C**                                                                  ER0317
     C           ZDATE1    BEGSR                           *** ZDATE1 *** ER0317
     C**                                                                  ER0317
     C**   CLEAR DAY NUMBER.                                              ER0317
     C                     Z-ADD0         ZDAYNO  50                      ER0317
     C**                                                                  ER0317
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.                        ER0317
     C                     Z-ADDZDATE     ZDATE   60                      ER0317
     C**                                                                  ER0317
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.                     ER0317
     C                     MOVE ZDATE     ZYEAR   20                      ER0317
     C  N98                MOVELZDATE     ZDAY    20                      ER0317
     C   98                MOVELZDATE     ZMTH    20                      ER0317
     C                     MOVE ZDATE     ZWRK4   40                      ER0317
     C  N98                MOVELZWRK4     ZMTH                            ER0317
     C   98                MOVELZWRK4     ZDAY                            ER0317
     C**                                                                  ER0317
     C**   ENSURE MONTH IS VALID.                                         ER0317
     C           ZMTH      COMP 0                      9999               ER0317
     C  N99      ZMTH      COMP 12                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR 30 DAY MONTHS.                                       ER0317
     C           ZMTH      COMP 4                        90IF 90 ON, 30   ER0317
     C  N90      ZMTH      COMP 6                        90DAY MONTH.     ER0317
     C  N90      ZMTH      COMP 9                        90               ER0317
     C  N90      ZMTH      COMP 11                       90               ER0317
     C**                                                                  ER0317
     C**   ENSURE DAY IS VALID.                                           ER0317
     C           ZDAY      COMP 0                      9999               ER0317
     C   90N99   ZDAY      COMP 30                   99                   ER0317
     C  N90N99   ZDAY      COMP 31                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.                              ER0317
     C           ZYEAR     ADD  28        ZYEAR                           ER0317
     C           ZYEAR     DIV  4         ZLYR    20                      ER0317
     C                     MVR            ZLY     10     91LEAP YR, 91 ON ER0317
     C           ZMTH      COMP 2                    93  92FEB., 92 ON    ER0317
     C**                                                   PAST FEB, 93 ONER0317
     C**   IF FEBUARY FURTHER VALIDATE DAY.                               ER0317
     C  N91 92   ZDAY      COMP 28                   99                   ER0317
     C   91 92   ZDAY      COMP 29                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANSER0317
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.ER0317
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRER0317
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.ER0317
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR ER0317
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHER0317
     C**                                                                  ER0317
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*ER0317
     C**                                                                  ER0317
     C**                                                                  ER0317
     C*****************************************************************
     C*
     C           ZDATE9    BEGSR
     C*
     C                     SETOF                     8081
     C                     MOVE '0'       @@RTN   1
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1
     C                     MOVE '1'       @@RTN
     C                     GOTO ZDAT79
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZA0711
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZA0711
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZDAT79    ENDSR
     C********************************************************************
      *    SUBROUTINE- ZNRC                                               ULX004
      *    DETERMINE NEXT RATE CHANGE                                     ULX004
      *                                                                   ULX004
      *                                                                   ULX004
      *   INPUT - CD ARRAY - COUPON DATES - SECTYD SECURITY FILE          ULX004
      *           CR ARRAY - RATE/PAYT INDICS - SECTYD SECURITY FILE      ULX004
      *           FCPN - FIRST COUPON DATE - SECTYD SECURITY FILE         ULX004
      *           MATY - MATURITY DATE - SECTYD SECURITY FILE             ULX004
      *           ECD - EVENT CONTROL DTAE - ZEVCD PROCESS                ULX004
      *           *IN98 - DATE FORMAT - FROM RUNDAT VIA PROGRAM           ULX004
      *                                                                   ULX004
      *   OUTPUT - NCD (5,0) - NEXT COUPON DATE                           ULX004
      *                                                                   ULX004
      *   CALLS  - ZDATE1                                                 ULX004
      *            ZDATE2                                                 ULX004
      ********************************************************************ULX004
      *
     C           ZNRC      BEGSR                           *** ZNRC   *** ULX004
      *                                                                   ULX004
      * CALL ZDATE2 TO OBTAIN MMDD FOR EVENT CONTROL DATE                 ULX004
      *    Use the greater of ECD and ITLD as basis for the calculation   ULX004
      *                                                                   ULX004
     C           ECD       IFGE ITLD                       B1             ULX004
     C                     Z-ADDECD       ZDAYNO                          ULX004
     C                     ELSE                            X1             ULX004
     C                     Z-ADDITLD      ZDAYNO                          ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
     C                     EXSR ZDATE2                                    ULX004
     C                     MOVELZDATE     ZZECD4  40                      ULX004
     C           *IN98     IFEQ '0'                        B1             ULX004
     C                     MOVELZZECD4    ZZWRKD                          ULX004
     C                     MOVE ZZECD4    ZZWRKM                          ULX004
     C                     Z-ADDZZWRKD    ZZECD4                          ULX004
     C                     MOVELZZWRKM    ZZECD4                          ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
      * IF DATE FORMAT IS DDMMYY TURN ROUND ARRAY OF COUPON DATES TO MMDD ULX004
      *                                                                   ULX004
     C           *IN98     IFEQ '0'                        B1             ULX004
     C                     DO   12        X       20       B2             ULX004
     C                     MOVE CD,X      ZZWRKM  20                      ULX004
     C                     MOVELCD,X      ZZWRKD  20                      ULX004
     C                     Z-ADDZZWRKD    CD,X                            ULX004
     C                     MOVELZZWRKM    CD,X                            ULX004
     C                     ENDDO                           E2             ULX004
     C                     ENDIF                           E1             ULX004
      * GET YEAR FOR ECD                                                  ULX004
     C                     MOVE ZDATE     ZECDYR  20                      ULX004
      *                                                                   ULX004
      * FIND NEXT COUPON DATE FROM ARRAYS -                               ULX004
      *  IF RATE/PAYT INDS ALL BLANK NCD = MATURITY DATE                  ULX004
      *                                                                   ULX004
     C                     Z-ADDMATY      NCD     50                      ULX004
     C           CRDS      IFNE *BLANKS                    B1             ULX004
      *                                                                   ULX004
      *  IF RATE/PAYT INDS NOT ALL BLANK -                                ULX004
      *    SEARCH FOR NEXT HIGHEST COUPON                                 ULX004
      *                                                                   ULX004
     C                     MOVE '0'       ZFOUND  1                       ULX004
     C                     Z-ADD0         TX      20                      ULX004
     C                     DO   12        X                B2             ULX004
     C           CR,X      IFEQ 'R'                        B3             ULX004
     C           CR,X      OREQ 'C'                                       ULX004
      *                                                                   ULX004
      ** If 29Feb is used in the coupon array, then there is a need to    ULX004
      ** check if the current year is a leap year. If it is not,          ULX004
      ** the coupon date is changed to 28. But there is a need to store   ULX004
      ** the date so that it can be restored back after the check.        ULX004
      *                                                                   ULX004
     C                     MOVE CD,X      ZZWRKD                          ULX004
     C                     MOVELCD,X      ZZWRKM                          ULX004
     C           ZZWRKM    IFEQ 2                          B4             ULX004
     C           ZZWRKD    ANDEQ29                                        ULX004
     C                     Z-ADDZECDYR    ZZYR    20                      ULX004
     C           ZZYR      ADD  28        ZZYR                            ULX004
     C           ZZYR      DIV  4         ZZYR                            ULX004
     C                     MVR            ZMVR    10                      ULX004
     C           ZMVR      IFGT 0                          B5             ULX004
     C                     Z-ADDX         TX                              ULX004
     C                     MOVE '28'      CD,X                            ULX004
     C                     ENDIF                           E5             ULX004
     C                     ENDIF                           E4             ULX004
      *                                                                   ULX004
     C           ZZECD4    IFLT CD,X                       B4             ULX004
     C                     MOVE '1'       ZFOUND                          ULX004
     C                     GOTO ZNRC00                                    ULX004
     C                     ELSE                            X4             ULX004
     C           ZZECD4    IFEQ CD,X                       B5             ULX004
     C                     Z-ADDZECDYR    ZDATE                           ULX004
     C                     MOVELCD,X      ZDATE                           ULX004
     C           *IN98     IFEQ '0'                        B6             ULX004
     C                     MOVELZDATE     ZZWRK   40                      ULX004
     C                     MOVE ZZWRK     ZZWRKM                          ULX004
     C                     MOVELZZWRK     ZZWRKD                          ULX004
     C                     Z-ADDZZWRKD    ZZWRK                           ULX004
     C                     MOVELZZWRKM    ZZWRK                           ULX004
     C                     MOVELZZWRK     ZDATE                           ULX004
     C                     ENDIF                           E6             ULX004
     C                     EXSR ZDATE1                                    ULX004
     C                     Z-ADDZDAYNO    NCD                             ULX004
     C           NCD       IFGT FCPN                       B6             ULX004
     C           NCD       SUB  FCPN      @DDIF   50                      ULX004
     C           @DDIF     IFGT 10                         B7             ULX004
     C                     MOVE '1'       ZFOUND                          ULX004
     C                     GOTO ZNRC00                                    ULX004
     C                     ENDIF                           E7             ULX004
     C                     ENDIF                           E6             ULX004
     C                     ENDIF                           E5             ULX004
     C                     ENDIF                           E4             ULX004
     C                     ENDIF                           E3             ULX004
     C                     ENDDO                           E2             ULX004
      *                                                                   ULX004
      *      FOUND - ADD ECD'S YY TO FORM DATE                            ULX004
     C           ZNRC00    TAG                             ZNRC00 TAG     ULX004
     C           ZFOUND    IFEQ '1'                        B2             ULX004
     C                     Z-ADDZECDYR    ZDATE                           ULX004
     C                     MOVELCD,X      ZDATE                           ULX004
      *      NOT FOUND - USE FIRST COUPON                                 ULX004
      *                  ADD NEXT YEAR'S YY TO FORM DATE                  ULX004
     C                     ELSE                            X2             ULX004
     C                     DO   12        X                B3             ULX004
     C           CR,X      IFEQ 'R'                        B4             ULX004
     C           CR,X      OREQ 'C'                                       ULX004
      *                                                                   ULX004
      *  If 29Feb is used in the coupon array, then there is a need to    ULX004
      *  check if the current year is a leap year. If it is not,          ULX004
      *  the coupon date is changed to 28. But there is a need to store   ULX004
      *  the date so that it can be restored back after the check.        ULX004
      *                                                                   ULX004
     C           TX        IFNE 0                          B5             ULX004
     C                     MOVE '29'      CD,TX                           ULX004
     C                     Z-ADD0         TX                              ULX004
     C                     ENDIF                           E5             ULX004
      *                                                                   ULX004
     C                     MOVE CD,X      ZZWRKD                          ULX004
     C                     MOVELCD,X      ZZWRKM                          ULX004
     C           ZZWRKM    IFEQ 2                          B5             ULX004
     C           ZZWRKD    ANDEQ29                                        ULX004
     C           ZECDYR    ADD  1         ZZYR                            ULX004
     C           ZZYR      ADD  28        ZZYR                            ULX004
     C           ZZYR      DIV  4         ZZYR                            ULX004
     C                     MVR            ZMVR    10                      ULX004
     C           ZMVR      IFGT 0                          B6             ULX004
     C                     Z-ADDX         TX                              ULX004
     C                     MOVE '28'      CD,X                            ULX004
     C                     ENDIF                           E6             ULX004
     C                     ENDIF                           E5             ULX004
      *                                                                   ULX004
     C                     Z-ADDZECDYR    ZDATE                           ULX004
     C                     ADD  1         ZDATE                           ULX004
     C                     MOVELCD,X      ZDATE                           ULX004
     C                     MOVE '1'       ZFOUND                          ULX004
     C                     GOTO ZNRC01                                    ULX004
     C                     ENDIF                           E4             ULX004
     C                     ENDDO                           E3             ULX004
     C                     ENDIF                           E2             ULX004
      *                                                                   ULX004
     C           ZNRC01    TAG                             ZNRC01 TAG     ULX004
      *                                                                   ULX004
      * CONVERT DATE TO DAY NO USING ZDATE1                               ULX004
      * (NOT DONE IF NO RATE/PAYT IND IS P OR C)                          ULX004
      * IF DDMMYY FORMAT TURN ROUND TO MMDDYY                             ULX004
     C           ZFOUND    IFEQ '1'                        B2             ULX004
     C           *IN98     IFEQ '0'                        B3             ULX004
     C                     MOVELZDATE     ZZWRK   40                      ULX004
     C                     MOVE ZZWRK     ZZWRKM                          ULX004
     C                     MOVELZZWRK     ZZWRKD                          ULX004
     C                     Z-ADDZZWRKD    ZZWRK                           ULX004
     C                     MOVELZZWRKM    ZZWRK                           ULX004
     C                     MOVELZZWRK     ZDATE                           ULX004
     C                     ENDIF                           E3             ULX004
     C                     EXSR ZDATE1                                    ULX004
     C                     Z-ADDZDAYNO    NCD                             ULX004
     C                     ENDIF                           E2             ULX004
      *                                                                   ULX004
      * IF NCD > MATURITY DATE , RESET NCD = MATURITY DATE                ULX004
     C           NCD       IFGT MATY                       B2             ULX004
     C                     Z-ADDMATY      NCD                             ULX004
     C                     ENDIF                           E2             ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
      * If the First Coupon Date is not zero, then                        ULX004
      * IF NCD < 1ST COUPON DATE , RESET NCD = 1ST COUPON DATE            ULX004
      *                                                                   ULX004
     C           FCPN      IFNE *ZEROS                     B1             ULX004
     C           NCD       IFLE FCPN                       B2             ULX004
     C           ECD       ORLE FCPN                                      ULX004
     C                     Z-ADDFCPN      NCD                             ULX004
     C                     ENDIF                           E2             ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
      ** Restore 29Feb to the array if it is changed.                     ULX004
      *                                                                   ULX004
     C           TX        IFNE 0                          B1             ULX004
     C                     MOVE '29'      CD,TX                           ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
      ** If the First Coupon date is not zero, and is equal to the        ULX004
      ** Event Control Date, set the Next Coupon date to this date.       ULX004
      *                                                                   ULX004
     C           FCPN      IFNE *ZEROS                     B1             ULX004
     C           FCPN      ANDEQECD                                       ULX004
     C                     Z-ADDFCPN      NCD                             ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
      * IF DATE FORMAT IS DDMMYY TURN BACK ARRAY OF COUPON DATES TO DD/MM ULX004
     C           *IN98     IFEQ '0'                        B1             ULX004
     C                     DO   12        X       20       B2             ULX004
     C                     MOVELCD,X      ZZWRKM  20                      ULX004
     C                     MOVE CD,X      ZZWRKD  20                      ULX004
     C                     Z-ADDZZWRKM    CD,X                            ULX004
     C                     MOVELZZWRKD    CD,X                            ULX004
     C                     ENDDO                           E2             ULX004
     C                     ENDIF                           E1             ULX004
      *                                                                   ULX004
     C                     ENDSR                                          ULX004
     C*****************************************************************
     C**
     C**   ZSDESC- SUBROUTINE TO FORMAT SECURITY DESCRIPTIONS
     C**
     C**   INPUT  - ZSRPN (20) SECURITY REPORT NAME
     C**            ZSFN1 (30) SECURITY FULL NAME 1
     C**            ZSFN2 (30) SECURITY FULL NAME 2
     C**            CPNR  (11,7) COUPON RATE FROM SECURITY
     C**            MATY  (5,0) MATURITY DATE FROM SECURITY
     C**            SCPP  (15,8) REDEMPTION PRICE FROM SECURITY
     C**            SCPD  (5,0) FIRST REDEMPTION DATE FROM SECURITY
     C**            RSFD  (1) REDEMPTION IN SEC.DESC. IND (TABTB36)
     C**            SCPI  (1) PUT/CALL INDICATOR
     C**
     C**  OUTPUT -  ZRNME  (41) SECURITY REPORT NAME DESCRIPTION
     C**            ZFNM1  (30) SECURITY FULL NAME DESCRIPTION 1
     C**            ZFNM2  (50) SECURITY FULL NAME DESCRIPTION 2
     C**            ZFNM3  (50) SECURITY FULL NAME DESCRIPTION 3
     C**
     C**  CALLS  -  ZDATE2
     C**
     C**********************************************************************
     C*
     C/COPY ZSRSRC,ZSDESCZ3
     C*****************************************************************
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
      /COPY ZSRSRC,ZFRQAZ2                                                ULX004
      /COPY ZSRSRC,ZCHKH                                                  ULX004
      /COPY ZSRSRC,ZACCH                                                  ULX004
     C/COPY ZSRSRC,ZDATE2Z4
      /COPY ZSRSRC,ZPRCIZ1                                                ERL465
      /COPY ZSRSRC,ZDAYSZ2                                                ERL465
      /COPY ZSRSRC,ZDYYRZ3                                                ERL465
      /COPY ZSRSRC,ZNCDZ3                                                 ERL465
      /COPY ZSRSRC,ZLCDZ1                                                 ERL465
      /COPY ZSRSRC,ZYLDIZ1                                                ERL465
      /COPY ZSRSRC,ZYLDZ2                                                 ERL465
      /COPY ZSRSRC,ZACCZZ1                                                ERL465
      /COPY ZSRSRC,ZACCRZ1                                                ERL465
      /COPY ZSRSRC,ZRATEZ1                                                ERL465
      /COPY ZSRSRC,ZCNSDZ1                                                ERL465
      /COPY ZSRSRC,ZCALCD                                                 ERL465
      /COPY ZSRSRC,ZEVCDZ1                                                ERL465
      /COPY ZSRSRC,ZDAT10Z2                                               ULX046
     C**
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** POW
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  CPY@                                                                  ULX004
(c) Finastra International Limited 2005
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TNDM - NUMBER OF DAYS PER MONTH
312931303130313130313031
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)                      ERL465
0006001521029820444305904073650882610287117481320914670161311759219053    ERL465
2051421975234362489726358278192928030741322023366335124365853804639507    ERL465
40968424294389045351                                                      ERL465
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION                      ERL465
00000001                                                                  ERL465
00000010                                                                  ERL465
00000100                                                                  ERL465
00001000                                                                  ERL465
00010000                                                                  ERL465
00100000                                                                  ERL465
01000000                                                                  ERL465
10000000                                                                  ERL465
