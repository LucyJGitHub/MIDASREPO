     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas AGDL Audit detail and summary report')           *
      *****************************************************************
      *                                                               *
      *  Midas - General Ledger Module                                *
      *                                                               *
      *  ERAG09 - AGDL Audit Details and Summary Reports              *
      *                                                               *
      *  Function:  This program enables the user to list audit       *
      *             and summary reports.                              *
      *  (phase(s)) Input cycle and end of year                       *
      *                                                               *
      *  Called By: ERCAG09 - AGDL Audit and Summary Report           *
      *                                                               *
      *  (c) Finastra International Limited 2005                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027A            Date 11May06               *
      *                 CER001             Date 25Apr05               *
      *                 174247             Date 08Feb00               *
      *                 173116             Date 05Jan00               *
      *                 168723             Date 06Oct99               *
      *                 166705             Date 22Sep99               *
      *                 CC0001             Date 20Jul99               *
      *                 155076             Date 25Feb99               *
      *                 ULX010  *CREATE    Date 26Jun98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  174247 - Link does not work properly                         *
      *  173116 - Correct Number of Participant                       *
      *  168723 - Replace array A1 to avoid more than 99999 elements  *
      *  166705 - Error fix - Bad setup of Account Code and Account   *
      *           Sequence fields for printing of complete account    *
      *           reference                                           *
      *  CC0001 - Change Control for DL                               *
      *  155076 - New fonctionalities of ULX010                       *
      *  ULX010 - AGDL Reporting statistiques sur les dépôts garantis *
      *                                                               *
      *****************************************************************
      /SPACE 3
      ****************************************************************
      * USING OF INDICATORS                                          *
      *--------------------------------------------------------------*
      * 66 = OVERFLOW FOR ERAG09P1                                   *
      * 65 = OVERFLOW FOR ERAG09P1                                   *
      * 64 = OVERFLOW FOR ERAG09P1                                   *
      * 70 = READ FOR AGDLSEPP                                       *
      * 71 = READ FOR AGDLEXV0                                       *
      ****************************************************************
      /SPACE 3
      ****************************************************************
      * CALL SUBROUTINES                                             *
      *--------------------------------------------------------------*
      *  INIT = PROGRAMME INITIALIZATION                             *
      *  PROCES - Detail Processing                                  *
      *  REPP1 - Process Reports P1 Lines                            *
      *  WP1REC - Format and Write a Detail Record to the Report P1  *
      *  WP1END - Write End of Report P1                             *
      *  PSSR  = DATA BASE ERROR                                     *
      *  RCFP1  - RCF Processing for P1 Report                       *
      *  RCFP2  - RCF Processing for P2 Report                       *
      *  RCFP3  - RCF Processing for P3 Report                       *
      *  RCFAU  - RCF Processing for Audit Report                    *
      *  ZSEDIT - Edit an Amount                                     *
      ****************************************************************
      /EJECT
     FAGDLEXV0IF  E           K        DISK         KINFSR *PSSR
      ** AGDL Extract
     FAGDLSEPPIF  E           K        DISK         KINFSR *PSSR
      ** AGDL Report                                                      168723
     FAGREPTPPIF  E                    DISK         KINFSR *PSSR A    UC  168723
      *
      ** AGDL Reporting
      *
     FERAG09P1O   E             66     PRINTER
     F                                              KINFDS SPOOL1
     FERAG09P2O   E             65     PRINTER
     F                                              KINFDS SPOOL2
     FERAG09P3O   E             64     PRINTER
     F                                              KINFDS SPOOL3
      *
      ** Details report
      *
     FERAG09AUO   E                    PRINTER
     F                                              KINFDS SPOOLU
      *
      ** Audit report
      *
      /SPACE 3                                                            155076
      *                                                                   155076
      ** Array containing the writing informations                        155076
     E******              A1        999130                         155076 168723
      /SPACE 3
      *
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZDATE2Z1
      *                                                                   155076
      ** Array containing the writing informations                        155076
     E                    STROKE  1   1 21                                155076
      *
      ** Array containing Copyright statement
      *
     E                    CPY@    1   1 80
     E                    CMD     1   1 25                                168723
      /SPACE 3
     E/COPY ZSRSRC,ZFRPEDZ2
      /SPACE 3
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
     ICLIENT      DS                            100
      ***  Data structure client
     I                                        1   9 #1NUM
      *
     ISDCURR    E DSSDCURRPD
      ***  Currency Details
      *
     ISDBANK    E DSSDBANKPD
      *
      ** Data Structure for bank details
      *
     ISDCUST    E DSSDCUSTPD
      *
      ** Data Structure for customer details
      *
     IDSFDY     E DSDSFDY
      *
      ** Short Data Structure for acces programs
      *
     IDSSDY     E DSDSSDY
      *
      ** Long Data Structure for acces programs
      *
     IPSDS       SDS
     I                                     *PROGRAM ##PGM
     I                                      244 253 JOB
     I                                      244 246 WSID
     I                                      254 263 USER
     ISPOOL1      DS
      *
      ***  File Information Data Structure for ERAG09P1
      *
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
     ISPOOL2      DS
      *
      ***  File Information Data Structure for ERAG09P2
      *
     I                                       83  92 SFILE2
     I                                    B 123 1240SFNUM2
     I                                    B 188 1890OFLLN2
     I                                    B 367 3680PRTLN2
     ISPOOL3      DS
      *
      ***  File Information Data Structure for ERAG09P2
      *
     I                                       83  92 SFILE3
     I                                    B 123 1240SFNUM3
     I                                    B 188 1890OFLLN3
     I                                    B 367 3680PRTLN3
     ISPOOLU      DS
      *
      ***  File Information Data Structure for ERAG09AU
      *
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *                                                                   155076
     IDSCULI      DS                                                      155076
      *                                                                   155076
      ***  Data structure for writing the details of customer linked      155076
      *                                                                   155076
     I                                        1   9 DSNUM                 155076
     I                                       10  12 DSCURR                155076
     I**********                             13  160DSACOD                             155076 CER001
     I**********                             17  180DSACSQ                             155076 CER001
     I**********                             20  40 DSAMNT                             155076 CER001
     I**********                             42  62 DSINTR                             155076 CER001
     I**********                             64  84 DSTOTC                             155076 CER001
     I**********                             85 105 DSTOTL                             155076 CER001
     I**********                            107 1080DSPART                             155076 CER001
     I**********                            110 130 DSOWNT                             155076 CER001
     I                                       13  220DSACOD                                    CER001
     I                                       23  240DSACSQ                                    CER001
     I                                       26  46 DSAMNT                                    CER001
     I                                       48  68 DSINTR                                    CER001
     I                                       70  90 DSTOTC                                    CER001
     I                                       91 111 DSTOTL                                    CER001
     I                                      113 1140DSPART                                    CER001
     I                                      116 136 DSOWNT                                    CER001
      *                                                                   155076
      ****************************************************************
      ** Program Start                                               *
      ****************************************************************
      *
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      ***  Output Audit Report and End Program.
      *
     C                     EXSR AUDIT
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * INIT - Subroutine to do program initialisation                *
      *                                                               *
      * Called by: (**calling routines**)                             *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
     C                     OPEN AGREPTPP                                  168723
      *
      ** Reset indicators
      *
     C                     MOVE *OFF      *IN
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ***  Receive Parameter List.
      *
     C           *ENTRY    PLIST
     C                     PARM           PSEQ    5
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           LDA
      *
     C           *LIKE     DEFN AXLINK    SPLINK                          155076
     C           *LIKE     DEFN AXNAME    SPNAME                          155076
     C           *LIKE     DEFN AXTOWN    SPTOWN                          155076
     C           *LIKE     DEFN AXLINK    SVLINK
     C           *LIKE     DEFN AXSEQU    SVSEQU                          173116
     C           *LIKE     DEFN AXCUST    SVCUST                          173116
     C           *LIKE     DEFN A6NBDP    DPTCCY
     C           *LIKE     DEFN A6NBDP    DPTCUR
     C           *LIKE     DEFN AXOVER    SVOVER                          174247
      *
     C           *LIKE     DEFN AXTOTL    WSTOTL
     C           *LIKE     DEFN AXOWNT    WSOWNT
     C           *LIKE     DEFN AXTOTL    WTTOTL
     C           *LIKE     DEFN AXOWNT    WTOWNT
     C           *LIKE     DEFN ZOUT25    WGLIMI
     C           *LIKE     DEFN ZOUT25    #TTWNT
     C           *LIKE     DEFN ZOUT25    #3IWNT
     C           *LIKE     DEFN ZOUT25    #3SWNT
      *
     C           *LIKE     DEFN AXOWNT    INOWNT
     C           *LIKE     DEFN AXOWNT    SPOWN1
     C           *LIKE     DEFN AXOWNT    SPOWN2
     C           *LIKE     DEFN AXOWNT    TTOWN1
     C           *LIKE     DEFN AXOWNT    TTOWN2
      *
     C                     MOVE 0         #3NBI
     C                     MOVE 0         #3NBS
     C                     MOVE 0         #3NB
      *
     C                     Z-ADD0         INOWNT
     C                     Z-ADD0         SPOWN1
     C                     Z-ADD0         SPOWN2
     C                     Z-ADD0         TTOWN1
     C                     Z-ADD0         TTOWN2
     C                     Z-ADD0         WWCOUN  50                      CC0002
      *
      ***  Initialise LDA field.
      *
     C                     MOVE ##PGM     DBPGM
      *
      ***  Access to bank Details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           WRTCD     IFNE *BLANKS                    B1
     C           *LOCK     IN   LDA
     C                     Z-ADD001       DBASE            ****************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 001 *
     C                     MOVEL'*FIRST'  DBKEY     P      ****************
     C                     MOVEL##PGM     DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E1
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           BJDFIN    IFEQ 'M'                        B2
     C                     SETON                     98
     C                     ENDIF                           E2
      *
      ***  Load the limit currency and amount
      *
     C                     READ AGDLSEPP                 70
      *
     C           *IN70     IFEQ *ON                        B3
     C           *LOCK     IN   LDA
     C                     Z-ADD002       DBASE            ****************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 002 *
     C                     MOVEL'*FIRST'  DBKEY     P      ****************
     C                     MOVEL##PGM     DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E3
      *
     C                     MOVE AGCURR    WGCURR  3
     C                     MOVE WGCURR    #1GCUR
     C                     MOVE WGCURR    #2GCUR
      *
      ***  Decimal of the limit currency
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   #RTCD   7
     C                     PARM '*KEY   ' #OPTN   7
     C                     PARM WGCURR    #CKEY   3
     C           SDCURR    PARM SDCURR    DSFDY
      *
     C           #RTCD     IFNE *BLANKS                    B4
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ****************
     C                     Z-ADD3         DBASE            * DB ERROR 003 *
     C                     MOVELWGCURR    DBKEY     P      ****************
     C                     MOVEL##PGM     DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E4
      *
     C                     Z-ADDA6NBDP    DPTCCY
      *
     C                     WRITEHEADP1
      *
     C                     WRITEHEADP2
      *
      ***  RCF Processing for Audit File.
      *
     C                     EXSR RCFAU
      *
      ***  RCF Processing for File.
      *
     C                     EXSR RCFP1
     C                     EXSR RCFP2
     C                     EXSR RCFP3
      *
      ***  Report Work fields.
      *
     C                     Z-ADD0         RQDLN1  30
     C                     Z-ADD0         DIFLN1  30
     C                     Z-ADD0         RCOUNT  30
      *
     C                     Z-ADD0         RQDLN2  30
     C                     Z-ADD0         DIFLN2  30
      *
     C                     Z-ADD0         RQDLN3  30
     C                     Z-ADD0         DIFLN3  30
      *                                                                   155076
      ***  Number of record to write                                      155076
      *                                                                   155076
     C                     Z-ADD0         Z       30                      155076
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  AUDIT  - Produce Audit Report and End Program                *
      *  REPORT - Process Report Lines                                *
      *  WP1END - Write End of Report                                 *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ***  Read first record from File.
      *
     C                     READ AGDLEXV0                 71
      *
      ***  If End of Records, (*IN71), Perform: Audit Reporting (No
      ***  Records).
      *
     C           *IN71     IFEQ *ON                        B1
     C                     WRITENOLIP1
     C                     WRITEENDP1
      *
     C                     EXSR REPP2
      *
     C                     EXSR REPP3
      *
     C                     EXSR AUDIT
      *
     C                     ENDIF                           E1
      *
      ***  Write the firsth customer linked                               155076
      ***  Save the firsth  customer linked                               155076
      *
     C*****                MOVE AXLINK    #1LINK                          155076
     C*****                MOVE AXNAME    #1NAME                          155076
     C*****                MOVE AXTOWN    #1TOWN                          155076
     C*****                WRITEDHEDP1                                    155076
      *****                                                               155076
     C*****                MOVE AXLINK    #2LINK                          155076
     C*****                MOVE AXNAME    #2NAME                          155076
     C*****                MOVE AXTOWN    #2TOWN                          155076
      *                                                                   155076
     C                     MOVE AXLINK    SPLINK                          155076
     C                     MOVELAXNAME    SPNAME                          155076
     C                     MOVELAXTOWN    SPTOWN                          155076
     C                     MOVE AXLINK    SVLINK
     C                     MOVE AXSEQU    SVSEQU                          173116
     C                     MOVE AXCUST    SVCUST                          173116
     C                     MOVE AXOVER    SVOVER                          174247
      *
      ***  Do Until End of File.
      *
     C           *IN72     DOUEQ*ON
      *
      ***  Count records read.
      *
     C                     ADD  1         RCOUNT
      *
      ***  Process Report P1 lines.
      *
     C                     EXSR REPP1
      *
      ***  Read next record.
      *
     C                     READ AGDLEXV0                 72
      *
      ***  End of Do Until End of Valid Records.
     C                     ENDDO
      *
      ***  Write final records and Totals to Report.                      155076
      ***  Prepare the final records and Totals to Report.                155076
      ***  Write only if the calculated total amount is positif.          155076
      *
     C*****                MOVE *ON       *IN51                           155076
     C*****                WRITEDETAP1                                    155076
     C           WTOWNT    IFGE 0                                         155076
     C                     MOVEL*BLANKS   DSNUM                           155076
     C                     MOVEL*BLANKS   DSCULI                          155076
     C                     Z-ADD0         DSACOD                          155076
     C                     Z-ADD0         DSACSQ                          155076
     C                     Z-ADD0         DSPART                          155076
     C                     MOVEASTROKE    DSTOTL                          155076
     C                     MOVEASTROKE    DSOWNT                          155076
      *                                                                   155076
     C******               ADD  1         Z                         155076168723
     C******               MOVELDSCULI    A1,Z                      155076168723
     C                     WRITEAGREPTD0                                  168723
      *                                                                   155076
     C                     Z-ADDWTTOTL    ZFLD15                          155076
     C                     EXSR ZFRPED                                    155076
     C                     MOVE ZOUT25    DSTOTL    P                     155076
      *                                                                   155076
     C                     Z-ADDWTOWNT    ZFLD15                          155076
     C                     EXSR ZFRPED                                    155076
     C                     MOVE ZOUT25    DSOWNT    P                     155076
      *                                                                   155076
     C******               ADD  1         Z                         155076168723
     C******               MOVELDSCULI    A1,Z                      155076168723
     C                     WRITEAGREPTD0                                  168723
      *                                                                   155076
      ***  Write details                                                  155076
     C******               Z-ADD1         Z                        155076 168723
     C                     MOVE SPLINK    #1LINK                          155076
     C                     MOVELSPNAME    #1NAME                          155076
     C                     MOVELSPTOWN    #1TOWN                          155076
      *                                                                   155076
     C                     MOVE SPLINK    #2LINK                          155076
     C                     MOVELSPNAME    #2NAME                          155076
     C                     MOVELSPTOWN    #2TOWN                          155076
     C                     MOVELDSOWNT    #2TTOW                          155076
     C                     WRITEDHEDP1                                    155076
      *                                                                   155076
     C******               MOVELA1,Z      DSCULI                   155076 168723
     C                     MOVE *OFF      *IN89                           168723
     C           1         CHAINAGREPTPP             89                   168723
     C           DSOWNT    DOWNE*BLANKS                                   155076
     C           *IN89     ANDEQ*OFF                                      168723
      *                                                                   155076
     C                     MOVELDSNUM     #1NUM                           155076
     C                     MOVELDSCURR    #1CURR                          155076
     C                     MOVE DSACOD    #1ACOD                          155076
     C                     MOVE DSACSQ    #1ACSQ                          155076
     C                     MOVELDSAMNT    #1AMNT                          155076
     C                     MOVELDSINTR    #1INTR                          155076
     C                     MOVELDSTOTC    #1TOTC                          155076
     C                     MOVELDSTOTL    #1TOTL                          155076
     C                     MOVELDSPART    #1PART                          155076
     C                     MOVELDSOWNT    #1OWNT                          155076
      *                                                                                       CER001
      ** Do not print zero account code and sequence                                          CER001
      *                                                                                       CER001
     C                     MOVE *OFF      *IN52                                               CER001
     C           #1ACOD    IFEQ *ZERO                                                         CER001
     C           #1ACSQ    ANDEQ*ZERO                                                         CER001
     C                     MOVE *ON       *IN52                                               CER001
     C                     ENDIF                                                              CER001
      *                                                                   155076
     C                     WRITEDETAP1                                    155076
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     ENDIF
      *                                                                   155076
     C******               ADD  1         Z                        155076 168723
     C******               MOVELA1,Z      DSCULI                   155076 168723
     C                     READ AGREPTPP                 89               168723
     C                     ENDDO                                          155076
      *
      ***  Write end of report P1.
      *
     C                     WRITEENDP1
     C                     EXSR REPP2
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN2
     C           OFLLN2    SUB  PRTLN2    DIFLN2
     C           DIFLN2    IFLE RQDLN2
     C                     WRITEHEADP2
     C                     ENDIF
      *                                                                   155076
     C                     ENDIF                                          155076
      *
      ***  Write end of report P2.
      *
     C                     MOVE WWCOUN    #2COUN                          CC0002
     C                     WRITEENDP2
      *
     C                     EXSR REPP3
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/REPP1
      *****************************************************************
      *                                                               *
      *  REPP1 - Process Report P1 lines.                             *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:                                                       *
      *  WP1REC - Format and Write a Detail Record to the Report      *
      *                                                               *
      *****************************************************************
      *
     C           REPP1     BEGSR
      *                                                                   155076
     C*****                MOVE AXCURR    #1CURR                          155076
     C*****                MOVE AXACOD    #1ACOD                          155076
     C*****                MOVE AXACSQ    #1ACSQ                          155076
     C*****                MOVE AXPART    DSPART                          155076
      *                                                                   155076
      ***  Check that sufficient lines remain for the Format. If not,     155076
      ***  write out the Main Headings on a new page.                     155076
      *                                                                   155076
     C*****                Z-ADD6         RQDLN1                          155076
     C*****      OFLLN1    SUB  PRTLN1    DIFLN1                          155076
     C*****      DIFLN1    IFLE RQDLN1                                    155076
     C*****                WRITEHEADP1                                    155076
     C*****                ENDIF                                          155076
      *                                                                   155076
     C                     MOVELAXCURR    DSCURR                          155076
     C                     MOVE AXACOD    DSACOD                          155076
     C                     MOVE AXACSQ    DSACSQ                          155076
     C                     MOVE AXPART    DSPART                          155076
      *                                                                   155076
      ***  Decimal of the limit currency
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   #RTCD
     C                     PARM '*KEY   ' #OPTN
     C                     PARM AXCURR    #CKEY
     C           SDCURR    PARM SDCURR    DSFDY
      *
     C           #RTCD     IFNE *BLANKS                    B1
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ****************
     C                     Z-ADD4         DBASE            * DB ERROR 004 *
     C                     MOVELAXCURR    DBKEY     P      ****************
     C                     MOVEL##PGM     DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E1
      *
     C                     Z-ADDA6NBDP    DPTCUR
      *
      ***  The new number customer linked isn't the same of the
      ***  previous, then print the totals.
      *
     C           AXLINK    IFNE SVLINK                     B2
     C********** AXLINK    ANDNE999999                                                174247 CSD027A
     C           AXLINK    ANDNE'999999'                                                     CSD027A
     C******     AXLINK    OREQ 999999                              166705174247
     C******     AXCUST    ANDNESVCUST                              173116174247
     C******     AXLINK    OREQ 999999                              173116174247
     C******     AXSEQU    ANDNESVSEQU                              173116174247
     C                     EXSR NREC                                      174247
     C                     ENDIF                                          174247
      *                                                                   174247
     C********** AXLINK    IFEQ 999999                                                174247 CSD027A
     C           AXLINK    IFEQ '999999'                                                     CSD027A
     C           AXOVER    ANDNESVOVER                                    174247
     C           AXSEQU    ORNE SVSEQU                                    174247
     C                     EXSR NREC                                      174247
     C                     ENDIF                                          174247
      *                                                                   174247
     C******               MOVE AXLINK    SVLINK                          174247
     C******               MOVE AXSEQU    SVSEQU                    173116174247
     C******               MOVE *ON       *IN51                     155076174247
     C******               WRITEDETAP1                              155076174247
      *                                                             155076174247
      ***  Check if the calculated total amount is positif.         155076174247
      *                                                             155076174247
     C******     WTOWNT    IFGE 0                                   155076174247
     C******               MOVEL*BLANKS   DSNUM                     155076174247
     C******               MOVEL*BLANKS   DSCULI                    155076174247
     C******               Z-ADD0         DSACOD                    155076174247
     C******               Z-ADD0         DSACSQ                    155076174247
     C******               Z-ADD0         DSPART                    155076174247
     C******               MOVEASTROKE    DSTOTL                    155076174247
     C******               MOVEASTROKE    DSOWNT                    155076174247
     C******               ADD  1         Z                  155076 168723174247
     C******               MOVELDSCULI    A1,Z               155076 168723174247
     C******               WRITEAGREPTD0                     155076 168723174247
     C******                                                        155076174247
     C******               Z-ADDWTTOTL    ZFLD15                    155076174247
     C******               EXSR ZFRPED                              155076174247
     C******               MOVE ZOUT25    DSTOTL    P               155076174247
     C******                                                        155076174247
     C******               Z-ADDWTOWNT    ZFLD15                    155076174247
     C******               EXSR ZFRPED                              155076174247
     C******               MOVE ZOUT25    DSOWNT    P               155076174247
     C******                                                        155076174247
     C******               ADD  1         Z                  155076 168723174247
     C******               MOVELDSCULI    A1,Z               155076 168723174247
     C******               WRITEAGREPTD0                     155076 168723174247
      *                                                             155076174247
      ***  Write details                                            155076174247
     C******               Z-ADD1         Z                  155076 168723174247
     C******               MOVE SPLINK    #1LINK                    155076174247
     C******               MOVELSPNAME    #1NAME                    155076174247
     C******               MOVELSPTOWN    #1TOWN                    155076174247
     C******                                                        155076174247
     C******               MOVE SPLINK    #2LINK                    155076174247
     C******               MOVELSPNAME    #2NAME                    155076174247
     C******               MOVELSPTOWN    #2TOWN                    155076174247
     C******               MOVELDSOWNT    #2TTOW                    155076174247
     C******                                                        155076174247
     C******               WRITEDHEDP1                              155076174247
     C******                                                        155076174247
     C******               MOVELA1,Z      DSCULI             155076 168723174247
     C******               MOVE *OFF      *IN89                     168723174247
     C******     1         CHAINAGREPTPP             89             168723174247
     C******     DSOWNT    DOWNE*BLANKS                             155076174247
     C******     *IN89     ANDEQ*OFF                                168723174247
     C******                                                        155076174247
     C******               MOVELDSNUM     #1NUM                     155076174247
     C******               MOVELDSCURR    #1CURR                    155076174247
     C******               MOVE DSACOD    #1ACOD                    155076174247
     C******               MOVE DSACSQ    #1ACSQ                    155076174247
     C******               MOVELDSAMNT    #1AMNT                    155076174247
     C******               MOVELDSINTR    #1INTR                    155076174247
     C******               MOVELDSTOTC    #1TOTC                    155076174247
     C******               MOVELDSTOTL    #1TOTL                    155076174247
     C******               MOVELDSPART    #1PART                    155076174247
     C******               MOVELDSOWNT    #1OWNT                    155076174247
     C******                                                        155076174247
     C******               WRITEDETAP1                              155076174247
      *                                                             155076174247
      ***  Check that sufficient lines remain for the Format. If not155076174247
      ***  write out the Main Headings on a new page.               155076174247
      *                                                             155076174247
     C******               Z-ADD4         RQDLN1                    155076174247
     C******     OFLLN1    SUB  PRTLN1    DIFLN1                    155076174247
     C******     DIFLN1    IFLE RQDLN1                              155076174247
     C******               WRITEHEADP1                              155076174247
     C******               ENDIF                                    155076174247
     C******                                                        155076174247
     C******               ADD  1         Z                  155076 168723174247
     C******               MOVELA1,Z      DSCULI             155076 168723174247
     C******               READ AGREPTPP                 89         168723174247
     C******               ENDDO                                    155076174247
      *                                                                   174247
      ***  Process Report P2 lines.                                       174247
      *                                                                   174247
     C******               EXSR REPP2                                     174247
      *                                                             155076174247
     C******               ENDIF                                    155076174247
      *                                                                   174247
      ***  Reset the total field                                          174247
      *                                                                   174247
     C******               MOVEL*BLANKS   A1                 155076 168723174247
     C******               CLOSEAGREPTPP                            168723174247
     C******               Z-ADD25        CMDLEN 155                168723174247
     C******               CALL 'QCMDEXC'                           168723174247
     C******               PARM           CMD                       168723174247
     C******               PARM           CMDLEN                    168723174247
     C******               OPEN AGREPTPP                     155076 168723174247
     C******               Z-ADD0         Z                  155076 168723174247
     C******               Z-ADD0         WSTOTL                          174247
     C******               Z-ADD0         WSOWNT                          174247
     C******               Z-ADD0         WTTOTL                          174247
     C******               Z-ADD0         WTOWNT                          174247
      *                                                                   174247
     C******               Z-ADD0         CPT                             174247
      *                                                                   174247
      ***  Write the s/header****                                   155076174247
      ***  Prepare the s/header                                     155076174247
      *                                                             155076174247
     C*****                MOVE AXLINK    #1LINK                    155076174247
     C*****                MOVE AXNAME    #1NAME                    155076174247
     C*****                MOVE AXTOWN    #1TOWN                    155076174247
     C*****                WRITEDHEDP1                              155076174247
      *                                                             155076174247
     C*****                MOVE AXLINK    #2LINK                    155076174247
     C*****                MOVE AXNAME    #2NAME                    155076174247
     C*****                MOVE AXTOWN    #2TOWN                    155076174247
      *                                                             155076174247
     C******               MOVE AXLINK    SPLINK                    155076174247
     C******               MOVE AXNAME    SPNAME                    155076174247
     C******               MOVE AXTOWN    SPTOWN                    155076174247
     C******               ENDIF                           E2             174247
      *
      ***  The linked customer is the same that the previous
      *
     C           AXACOD    IFNE 0                          B3
      *
      ***  Prepare total and s/total.
      *
     C*****                MOVELAXBRCA    #1NUM                           155076
     C*****                MOVE AXCUST    #1NUM                           155076
      *                                                                   155076
     C                     MOVELAXBRCA    DSNUM                           155076
     C                     MOVE AXCUST    DSNUM                           155076
      *                                                                   166705
     C                     MOVE AXCURR    DSCURR                          166705
     C                     Z-ADDAXACOD    DSACOD                          166705
     C                     Z-ADDAXACSQ    DSACSQ                          166705
     C                     MOVE AXPART    DSPART                          166705
      *
     C                     MOVE *OFF      *IN50
     C                     MOVE *OFF      *IN51
      *
     C                     ADD  AXTOTL    WSTOTL
     C                     ADD  AXOWNT    WSOWNT
      *
     C                     ELSE
      *
      ***  Check if the record is a Deal or not
      *
     C           AXDLNO    IFNE 0                          B4
      *
      ***  Prepare total and s/total.
      *
     C*****                MOVELAXDLNO    #1NUM                           155076
     C                     MOVELAXDLNO    DSNUM                           155076
     C                     MOVELAXCURR    DSCURR                          CC0001
     C                     MOVE AXPART    DSPART                          CC0001
      *
     C                     MOVE *OFF      *IN50
     C                     MOVE *OFF      *IN51
      *
     C                     ADD  AXTOTL    WSTOTL
     C                     ADD  AXOWNT    WSOWNT
      *
     C                     ELSE
      *
      ***  Write s/total
      *
     C*****                MOVE *ON       *IN50                           155076
     C                     ADD  1         CPT     10
     C           CPT       IFEQ 1                          B5
     C*****                WRITEDETAP1                                    155076
      *                                                                   155076
     C                     MOVEL*BLANKS   DSNUM                           155076
     C                     MOVEL*BLANKS   DSCULI                          155076
     C                     Z-ADD0         DSACOD                          155076
     C                     Z-ADD0         DSACSQ                          155076
     C                     Z-ADD0         DSPART                          155076
     C                     MOVEASTROKE    DSTOTL                          155076
     C                     MOVEASTROKE    DSOWNT                          155076
     C******               ADD  1         Z                        155076 168723
     C******               MOVELDSCULI    A1,Z                     155076 168723
     C                     WRITEAGREPTD0                                  168723
      *                                                                   155076
     C                     Z-ADDWSTOTL    ZFLD15                          155076
     C                     EXSR ZFRPED                                    155076
     C                     MOVE ZOUT25    DSTOTL                          155076
      *                                                                   155076
     C                     Z-ADDWSOWNT    ZFLD15                          155076
     C                     EXSR ZFRPED                                    155076
     C                     MOVE ZOUT25    DSOWNT                          155076
      *                                                                   155076
     C******               ADD  1         Z                        155076 168723
     C******               MOVELDSCULI    A1,Z                     155076 168723
     C                     WRITEAGREPTD0                                  168723
     C                     ENDIF                           E5
     C                     ENDIF                           E4
      *
      ***  Check if the record is a Loan or not
      *
     C********** AXLNNO    IFNE 0                          B6                                 CLE148
     C           AXLNNO    IFNE *BLANK                                                        CLE148
      *
      ***  Prepare total and s/total.
      *
     C*****                MOVELAXLNNO    #1NUM                           155076
     C                     MOVELAXLNNO    DSNUM                           155076
     C                     MOVELAXCURR    DSCURR                          CC0001
     C                     MOVE AXPART    DSPART                          CC0001
     C                     Z-ADD0         DSACOD                          166705
     C                     Z-ADD0         DSACSQ                          166705
      *
     C                     MOVE *OFF      *IN50
     C                     MOVE *OFF      *IN51
      *
     C                     Z-SUBAXTOTL    AXTOTL
     C                     Z-SUBAXOWNT    AXOWNT
      *
     C                     ENDIF                           E6
     C                     ENDIF                           E3
      *
     C                     ADD  AXTOTL    WTTOTL
     C                     ADD  AXOWNT    WTOWNT
      *
     C                     Z-ADDDPTCUR    ZDECS
      *
     C                     Z-ADDAXAMNT    ZFLD15
     C                     EXSR ZFRPED
     C*****                MOVE ZOUT25    #1AMNT                          155076
     C                     MOVE ZOUT25    DSAMNT                          155076
      *
     C                     Z-ADDAXINTR    ZFLD15
     C                     EXSR ZFRPED
     C*****                MOVE ZOUT25    #1INTR                          155076
     C                     MOVE ZOUT25    DSINTR                          155076
      *
     C                     Z-ADDAXTOTC    ZFLD15
     C                     EXSR ZFRPED
     C*****                MOVE ZOUT25    #1TOTC                          155076
     C                     MOVE ZOUT25    DSTOTC                          155076
      *
     C                     Z-ADDDPTCCY    ZDECS
      *
     C                     Z-ADDAXTOTL    ZFLD15
     C                     EXSR ZFRPED
     C*****                MOVE ZOUT25    #1TOTL                          155076
     C                     MOVE ZOUT25    DSTOTL                          155076
      *
     C                     Z-ADDAXOWNT    ZFLD15
     C                     EXSR ZFRPED
     C*****                MOVE ZOUT25    #1OWNT                          155076
     C                     MOVE ZOUT25    DSOWNT                          155076
      *                                                                   155076
     C*****                Z-ADDWSTOTL    ZFLD15                          155076
     C*****                EXSR ZFRPED                                    155076
     C*****                MOVE ZOUT25    #1STOT                          155076
      *                                                                   155076
     C*****                Z-ADDWSOWNT    ZFLD15                          155076
     C*****                EXSR ZFRPED                                    155076
     C*****                MOVE ZOUT25    #1SOWN                          155076
      *                                                                   155076
     C*****                Z-ADDWTTOTL    ZFLD15                          155076
     C*****                EXSR ZFRPED                                    155076
     C*****                MOVE ZOUT25    #1TTOT                          155076
      *                                                                   155076
     C*****                Z-ADDWTOWNT    ZFLD15                          155076
     C*****                EXSR ZFRPED                                    155076
     C*****                MOVE ZOUT25    #1TTOW                          155076
     C*****                MOVE ZOUT25    #2TTOW                          155076
      *                                                                   155076
     C*****                WRITEDETAP1                                    155076
      *                                                                   155076
     C******               ADD  1         Z                        155076 168723
     C******               MOVELDSCULI    A1,Z                     155076 168723
     C                     WRITEAGREPTD0                           155076 168723
      *
      ** Reset Data structure client
      *
     C*****                MOVE *BLANKS   #1NUM                           155076
     C                     MOVE *BLANKS   DSNUM                           155076
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/REPP2
      *****************************************************************
      *                                                               *
      *  REPP2 - Process Report P2 lines.                             *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           REPP2     BEGSR
      *
     C                     Z-ADDDPTCCY    ZDECS
      *
     C                     Z-ADDAGLIMI    ZFLD15
     C                     EXSR ZFRPED
     C           ' '       CHECKZOUT25    X       20     10
     C   10                SUBSTZOUT25:X  WGLIMI
     C           '<'       CAT  WGLIMI:1  #3LIM1
     C           '>'       CAT  WGLIMI:1  #3LIM2
      *
      ***  If the file AGDLEXPP is empty
      *
     C           *IN71     IFEQ *OFF                       B1
      *
      ***  Check if the amount is less or greater then the limit amount
      *
     C           WTOWNT    IFLT AGLIMI                     B2
     C                     ADD  1         W3NBI  150
     C                     ADD  WTOWNT    INOWNT
     C                     ELSE
     C                     ADD  1         W3NBS  150
     C                     ADD  WTOWNT    SPOWN1
     C                     ADD  AGLIMI    SPOWN2
     C                     ENDIF                           E2
      *
     C           INOWNT    ADD  SPOWN1    TTOWN1
     C           INOWNT    ADD  SPOWN2    TTOWN2
     C                     ADD  1         W3NB   150                      166705
      *
     C           DPTCCY    IFEQ 0                                         155076
     C                     Z-ADD100000    WWDIV  150                      155076
     C                     ELSE                                           155076
     C           DPTCCY    IFEQ 1                                         155076
     C                     Z-ADD1000000   WWDIV  150                      155076
     C                     ELSE                                           155076
     C                     Z-ADD10000000  WWDIV  150                      155076
     C                     ENDIF                                          155076
     C                     ENDIF                                          155076
     C                     Z-ADD1         ZDECS                           155076
     C***********          Z-ADDINOWNT    ZFLD15                          155076
     C                     Z-ADD*ZEROS    ZFLD15                          155076
     C           INOWNT    DIV  WWDIV     ZFLD15                          155076
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    #3IWN1
     C                     MOVE ZOUT25    #3IWN2
      *
     C***********          Z-ADDSPOWN1    ZFLD15                          155076
     C                     Z-ADD*ZEROS    ZFLD15                          155076
     C           SPOWN1    DIV  WWDIV     ZFLD15                          155076
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    #3SWN1
      *
     C***********          Z-ADDSPOWN2    ZFLD15                          155076
     C                     Z-ADD*ZEROS    ZFLD15                          155076
     C           SPOWN2    DIV  WWDIV     ZFLD15                          155076
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    #3SWN2
      *
     C***********          Z-ADDTTOWN1    ZFLD15                          155076
     C                     Z-ADD*ZEROS    ZFLD15                          155076
     C           TTOWN1    DIV  WWDIV     ZFLD15                          155076
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    #3TWN1
      *
     C***********          Z-ADDTTOWN2    ZFLD15                          155076
     C                     Z-ADD*ZEROS    ZFLD15                          155076
     C           TTOWN2    DIV  WWDIV     ZFLD15                          155076
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    #3TWN2
      *
     C                     Z-ADD0         ZDECS
      *
     C                     Z-ADD*ZEROS    ZFLD15                          CC0002
     C                     Z-ADDW3NBI     ZFLD15
     C                     EXSR ZFRPED
     C******               MOVE ZOUT25    #3NBI                           CC0002
     C                     MOVE ZOUT22    #3NBI                           CC0002
      *
     C                     Z-ADD*ZEROS    ZFLD15                          CC0002
     C                     Z-ADDW3NBS     ZFLD15
     C                     EXSR ZFRPED
     C******               MOVE ZOUT25    #3NBS                           CC0002
     C                     MOVE ZOUT22    #3NBS                           CC0002
      *
     C                     Z-ADD*ZEROS    ZFLD15                          CC0002
     C                     Z-ADDW3NB      ZFLD15
     C                     EXSR ZFRPED
     C******               MOVE ZOUT25    #3NB                            CC0002
     C                     MOVE ZOUT22    #3NB                            CC0002
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD6         RQDLN2
     C           OFLLN2    SUB  PRTLN2    DIFLN2
     C           DIFLN2    IFLE RQDLN2
     C                     WRITEHEADP2
     C                     ENDIF
      *
     C                     ADD  1         WWCOUN                          CC0002
     C                     WRITEDETAP2
      *
     C                     ELSE                             1
      *
     C                     Z-ADD6         RQDLN2
     C           OFLLN2    SUB  PRTLN2    DIFLN2
     C           DIFLN2    IFLE RQDLN2
     C                     WRITEHEADP2
     C                     ENDIF
      *
     C                     WRITENOLIP2
     C                     WRITEENDP2
     C                     ENDIF                           E1
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/<EPP3
      *****************************************************************
      *                                                               *
      *  REPP3 - Process Report P3 lines.                             *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           REPP3     BEGSR
      *
     C                     MOVE WGCURR    #3CUR1
     C                     MOVE WGCURR    #3CUR2
     C                     MOVE WGCURR    #3CUR3
     C                     MOVE WGCURR    #3CUR4
      *
      ***  If the file AGDLEXPP is empty
      *
     C           *IN71     IFEQ *ON                        B1
      *
     C                     MOVE 0         #3NBI
     C                     MOVE 0         #3NBS
     C                     MOVE 0         #3NB
     C                     MOVE 0         #3IWN1
     C                     MOVE 0         #3IWN2
     C                     MOVE 0         #3SWN1
     C                     MOVE 0         #3SWN2
     C                     MOVE 0         #3TWN1
     C                     MOVE 0         #3TWN2
      *
     C                     ENDIF                           E1
     C                     WRITEHEADP3
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Output Audit report and End Program.  *
      *                                                               *
      *  Called By: Main Processing, PROCES, *PSSR                    *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
      *
      ***  If there is a DB Error, Output the DB Error Information.
      *
     C           *INU7     IFEQ *ON
     C                     WRITEHEADAU
     C                     WRITEDBERROR
     C                     ENDIF
      *
      ***  End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Called by: (**calling routines**)                             *
      *                                                               *
      * Calls: None                                                   *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           DBASE     IFEQ 0
     C                     Z-ADD999       DBASE
     C                     ENDIF
      *
      ***  Print error message in Audit report
      *
     C                     WRITEHEADAU
     C                     WRITEDBERROR
     C                     WRITEENDAU
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFP1
      *****************************************************************
      *                                                               *
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP1     BEGSR                            *** RCFP1  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ     5
     C                     PARM           SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFP2
      *****************************************************************
      *                                                               *
      *  RCFP2  - Subroutine to register the P2 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP2     BEGSR                            *** RCFP2  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM2    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ     5
     C                     PARM           SENTY   3
     C                     PARM           SFILE2
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFP3
      *****************************************************************
      *                                                               *
      *  RCFP3  - Subroutine to register the P3 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP3     BEGSR                            *** RCFP3  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM3    ZSNUM   60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ     5
     C                     PARM           SENTY   3
     C                     PARM           SFILE3
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFAU
      *****************************************************************
      *                                                               *
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFAU     BEGSR                            *** RCFAU  ***
      *
      ***  Ensure Audit Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM PSEQ      SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANK    ZSERR
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/NREC                                                      174247
      *****************************************************************   174247
      *                                                               *   174247
      *  NREC   - Subroutine to write totals and prepare new reocord  *   174247
      *                                                               *   174247
      *****************************************************************   174247
      *                                                                   174247
     C           NREC      BEGSR                            *** NREC   ***174247
     C                     MOVE AXLINK    SVLINK                          174247
     C                     MOVE AXSEQU    SVSEQU                          174247
     C                     MOVE AXOVER    SVOVER                          174247
      *                                                                   174247
      ***  Check if the calculated total amount is positif.               174247
      *                                                                   174247
     C           WTOWNT    IFGE 0                                         174247
     C                     MOVEL*BLANKS   DSNUM                           174247
     C                     MOVEL*BLANKS   DSCULI                          174247
     C                     Z-ADD0         DSACOD                          174247
     C                     Z-ADD0         DSACSQ                          174247
     C                     Z-ADD0         DSPART                          174247
     C                     MOVEASTROKE    DSTOTL                          174247
     C                     MOVEASTROKE    DSOWNT                          174247
     C                     WRITEAGREPTD0                                  174247
      *                                                                   174247
     C                     Z-ADDWTTOTL    ZFLD15                          174247
     C                     EXSR ZFRPED                                    174247
     C                     MOVE ZOUT25    DSTOTL    P                     174247
      *                                                                   174247
     C                     Z-ADDWTOWNT    ZFLD15                          174247
     C                     EXSR ZFRPED                                    174247
     C                     MOVE ZOUT25    DSOWNT    P                     174247
      *                                                                   174247
     C                     WRITEAGREPTD0                                  174247
      *                                                                   174247
      ***  Write details                                                  174247
     C                     MOVE SPLINK    #1LINK                          174247
     C                     MOVELSPNAME    #1NAME                          174247
     C                     MOVELSPTOWN    #1TOWN                          174247
      *                                                                   174247
     C                     MOVE SPLINK    #2LINK                          174247
     C                     MOVELSPNAME    #2NAME                          174247
     C                     MOVELSPTOWN    #2TOWN                          174247
     C                     MOVELDSOWNT    #2TTOW                          174247
      *                                                                   174247
     C                     WRITEDHEDP1                                    174247
      *                                                                   174247
     C                     MOVE *OFF      *IN89                           174247
     C           1         CHAINAGREPTPP             89                   174247
     C           DSOWNT    DOWNE*BLANKS                                   174247
     C           *IN89     ANDEQ*OFF                                      174247
      *                                                                   174247
     C                     MOVELDSNUM     #1NUM                           174247
     C                     MOVELDSCURR    #1CURR                          174247
     C                     MOVE DSACOD    #1ACOD                          174247
     C                     MOVE DSACSQ    #1ACSQ                          174247
     C                     MOVELDSAMNT    #1AMNT                          174247
     C                     MOVELDSINTR    #1INTR                          174247
     C                     MOVELDSTOTC    #1TOTC                          174247
     C                     MOVELDSTOTL    #1TOTL                          174247
     C                     MOVELDSPART    #1PART                          174247
     C                     MOVELDSOWNT    #1OWNT                          174247
      *                                                                                       CER001
      ** Do not print zero account code and sequence                                          CER001
      *                                                                                       CER001
     C                     MOVE *OFF      *IN52                                               CER001
     C           #1ACOD    IFEQ *ZERO                                                         CER001
     C           #1ACSQ    ANDEQ*ZERO                                                         CER001
     C                     MOVE *ON       *IN52                                               CER001
     C                     ENDIF                                                              CER001
      *                                                                   174247
     C                     WRITEDETAP1                                    174247
      *                                                                   174247
      ***  Check that sufficient lines remain for the Format. If not,     174247
      ***  write out the Main Headings on a new page.                     174247
      *                                                                   174247
     C                     Z-ADD4         RQDLN1                          174247
     C           OFLLN1    SUB  PRTLN1    DIFLN1                          174247
     C           DIFLN1    IFLE RQDLN1                                    174247
     C                     WRITEHEADP1                                    174247
     C                     ENDIF                                          174247
      *                                                                   174247
     C                     READ AGREPTPP                 89               174247
     C                     ENDDO                                          174247
      *                                                                   174247
      ***  Process Report P2 lines.                                       174247
      *                                                                   174247
     C                     EXSR REPP2                                     174247
      *                                                                   174247
     C                     ENDIF                                          174247
      *                                                                   174247
      ***  Reset the total field                                          174247
      *                                                                   174247
     C                     CLOSEAGREPTPP                                  174247
     C                     Z-ADD25        CMDLEN 155                      174247
     C                     CALL 'QCMDEXC'                                 174247
     C                     PARM           CMD                             174247
     C                     PARM           CMDLEN                          174247
     C                     OPEN AGREPTPP                                  174247
     C                     Z-ADD0         WSTOTL                          174247
     C                     Z-ADD0         WSOWNT                          174247
     C                     Z-ADD0         WTTOTL                          174247
     C                     Z-ADD0         WTOWNT                          174247
      *                                                                   174247
     C                     Z-ADD0         CPT                             174247
      *                                                                   174247
      ***  Write the s/header****                                         174247
      ***  Prepare the s/header                                           174247
      *                                                                   174247
      *                                                                   174247
     C                     MOVE AXLINK    SPLINK                          174247
     C                     MOVE AXNAME    SPNAME                          174247
     C                     MOVE AXTOWN    SPTOWN                          174247
      *                                                                   174247
     C                     ENDSR                                          174247
      *****************************************************************
      *****************************************************************
      /EJECT
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
      /EJECT
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  STROKE                                                                155076
---------------------                                                     155076
**  CPY@
(c) Finastra International Limited 2005
**   CMD - COMMAND TO CLEAR FILE AGREPTPP                                 168723
CLRPFM FILE(AGREPTPP)                                                     168723
