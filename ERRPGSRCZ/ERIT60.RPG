     H        1   Y                       F
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ER Interface to FRS Main Component')             *
      *****************************************************************
      *                                                               *
      *  Midas - European Reporting Module                            *
      *                                                               *
      *  ERIT60 - ER Italy - Interface to FRS Main Component          *
      *                                                               *
      *  (C) Copyright Midas-Kapiti International Ltd. 1997.          *
      *                                                               *
      *  Last Amend No. LUC143             Date 13Jan22               *
      *  Prev Amend No. MD058100           Date 20May21               *
      *                 LUC139 *Amend      Date 28Apr21               *
      *                 LUC139 *Amend      Date 04Mar21               *
      *                 LUC139             Date 04Jan21               *
      *                 MMI140             Date 08Mar11               *
      *                 MBV006             Date 06Jun08               *
      *                 MMI117             Date 17Jan05               *
      *                 MBV002             Date 22Nov02               *
      *                 MMI115             Date 25Mar04               *
      *                 MMI110             Date 07Oct03               *
      *                 217674             Date 23May03               *
      *                 214826             Date 04Mar03               *
      *                 MMI100             Date 06Nov02               *
      *                 MMI101             Date 24Oct02               *
      *                 MMI096             Date 08Aug02               *
      *                 206990             Date 02Jul02               *
      *                 MMI098             Date 03Apr02               *
      *                 200160             Date 14Nov01               *
      *                 MMI084             Date 04Oct01               *
      *                 197061             Date 21Aug01               *
      *                 192459             Date 23Apr01               *
      *                 189360             Date 30Jan01               *
      *                 MMI080             Date 03Jan01               *
      *                 MMI075             Date 09AUG00               *
      *                 MMI032             Date 25AUG98               *
      *                 UIT021             Date 22JUN98               *
      *                 UIT021             Date 29JAN97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  LUC143 - Italian Returns changes for Unicredit               *
      *  MD058100 - Rollup of additional BoI onsite fixes at FbMidas  *
      *  LUC139 - Recompiled - ICDECK is now 14 long                  *
      *  LUC139 - Use core EXEXTRPD                                   *
      *           At DBA3 the following are zero. Remove processing   *
      *           EXCRRT EXDERT EXIADF EXIMAM EXIMUP EXMPRA EXMUPR    *
      *           Obtain ICCLTP from EXTRIN instead of EXFCTI         *
      *  LUC139 - Upgrade UCI Italian Returns                         *
      *  MMI140 - PUMA changes February 2011 and Usura changes.       *
      *  MBV006 - Install Lending parts of MMI120                     *
      *  MMI117 - CR2005                                              *
      *  MBV002 - Field 472 for accounts: retrieve from first         *
      *           Guarantee of the covering Facility                  *
      *  MMI115 - Tassi Attivi.                                       *
      *  MMI110 - Rewrite Numeri extraction.                          *
      *  217674 - Set field 113 on IRS according to value of Our Base *
      *           Rate                                                *
      *  214826 - Set field 143 for Futures and Options to 28.        *
      *  MMI100 - R4.1 Upgrade                                        *
      *  MMI101 - Future Exposure for SE Trades (fields 667 and 767)  *
      *           should be calculated differently for shares and for *
      *           other securities.                                   *
      *  MMI096 - Do not output LE Repayments from EREXTRPD as they   *
      *           will be generated by ERIT79.                        *
      *  206990 - ICOTHR should be 2 (Gold et al)                     *
      *  MMI098 - Removed ERITICPD ERDEALPD                           *
      *  200160 - Field 005 (duration) for MM deals: derive from      *
      *           number of months (224)                              *
      *  MMI084 - Equivalente Creditizio (fields 667 696 697 767)     *
      *  197061 - Use half-adjust when converting currencies.         *
      *           Setup Unpaid Amount Indicator.                      *
      *  192459 - Calculate number of installments matured.           *
      *  189360 - Wrong UIC Currency on FX Swaps                      *
      *  MMI080 - PUMA Changes December 2000                          *
      *  MMI032 - FICS BOI Interface amendment to incorporate         *
      *           data dic 3.0 changes                                *
      *  UIT021 - Bank of Italy Monthly Reporting changes for data    *
      *           dictionary 2.6.3 July 1997                          *
      *  UIT021 - Bank of Italy Monthly Reporting                     *
      *                                                               *
      *****************************************************************
     FEREXTRL0IP  E           K        DISK                                                   LUC139
      * EX - ER Extract File                                                                  LUC139
      *      Rcd fmt : EREXTRF0                                                               LUC139
     FERNUMEPDIF  E           K        DISK                               MMI110
      *
     FERICDRPDIF  E           K        DISK
      * VD - ER I.C.D.
      *
     F***ERITICL0IF  E           K        DISK                            MMI098
      * VP - Italy I.C.D.
      *
     F***ERDEALPDIF  E                    DISK                            MMI098
      *
     F***ERCURRL1IF  E           K        DISK                            MMI100
     FSDCURRL1IF  E           K        DISK                               MMI100
      *
     FSDCTT1PDIF  E           K        DISK
      * European Reporting - Puma2 Extended detail         Prefix 'PE'
     FSDBANKL1IF  E           K        DISK                               MMI084
     FDLINTRL2IF  E           K        DISK                               MMI084
     FDLMMDFL1IF  E           K        DISK                               MMI084
      *
     FLEGTT1L0IF  E           K        DISK                               MBV002
     FERITTRPDO   E                    DISK         KINFDS OUTFIL
      * EX - ER Italy 'enriched' Extract File
      *      Rcd fmt : ERITTRF0
     FERIT60AUO   E                    PRINTER
      * Audit List
      *
      /COPY ZSRSRC,ZDATE9Z1
     ******COPY ZSRSRC,ZDATE1Z1                                           MMI084
      /COPY ZSRSRC,ZDATE2Z1                                               MMI084
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E**  ARRAY HOLDING SHORTNAMES OF EACH MONTH
     E*
     E                    SSA     1  12  3   SSB     2 0
     E/COPY ZSRSRC,ZDAYSZ1                                                MMI084
     E/COPY ZSRSRC,ZHOLE                                                  MMI084
      *===============================================================*
     IFDINTRP0
     I              HWTMESTMP                       HWTMST
      *
     IEREXTRF0    01                                                                          LUC139
      ***  Primary file : Level break definition
      *
     I                                              EXBRCDL4
     I                                              EXLOTDL3
     I                                              EXDECKL3
     I                                              EXDRCRL3
     I                                              EXCCYCL2
     I                                              EXCUSTL1
      *
     ILDA        UDS                            256
      ***  Local data area for data base error
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I                                      132 183 DBLOT
     IIRSTAT    E DSIRSTAT
      ***  Puma2 Data area
     IIRFXTB    E DSIRFXTBPD                                              MBV002
      *
     ICPYR@#      DS
      ***  Data structure for compilation  - Copyright Insertion
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     I           SDS
      ***  Program status data structure
      *
     I                                     *PROGRAM PGM
      *
     IOUTFIL      DS
      ***  Output File data structure
      *
     I                                     *FILE    FILNAM
     IDSORAP      DS                             35
      ***  Origin of Application (See ERIT75/76/80)
     I                                        1   4 EXRIND
     I                                        6  26 EXTREF
     I                                       27  29 EXBRCD
     I****************************************6  20 EXTREF
     I***************************************21  23 EXBRCD
      *
     I            DS
     I                                        1   30DSFACT
     I                                        4   50DSFCNO
     I                                        1   60DSILNB
      *
     I            DS
     I                                        1   80EXSTRD
     I*                                       1   40WYEAR
     I*                                       5   60WMONTH
     I                                        7   80WDAY
      *                                                                   MBV002
     IDSCOL       DS                             40                       MBV002
     I                                       36  360COL472                MBV002
      *
      ***  Extract Production File record format
      *
     I@@ITTR    E DSERITTRPD
      *
      ***  Data structures to receive File details by Access Program
      *
      *
      ***  Data structures to handle Date formats
      *
     IDATE07      DS                              7
     I                                        1   2 D7DAY
     I                                        3   5 D7MNTH
     I                                        6   7 D7YEAR
      *
     I            DS
     I                                        1   20D6DAY
     I                                        3   40D6MNTH
     I                                        5   60D6YEAR
     I                                        1   60DATE06
      *
     I            DS
     I                                        1   40WYEAR1
     I                                        5   60WMONT1
     I***********                             1   60WSTRDT                200160
     I                                        7   80WDAYS1                200160
     I                                        1   80WSTRDT                200160
     I            DS
     I                                        1   40WYEAR2
     I                                        5   60WMONT2
     I***********                             1   60WENDDT                200160
     I                                        7   80WDAYS2                200160
     I***********                             1   80WENDDT          200160MMI100
     I                                        1   80WENDAT                MMI100
     I            DS
     I                                        1   80WWPRDD
     I                                        3   40WYEARC
     I                                        5   60WMONTC
     I                                        7   80WDAYS
     I            DS
     I                                        1   60XWSTRD
     I                                        1   20XDAY
     I                                        3   40XMONTH
     I                                        5   60XYEAR
      *                                                                   MMI100
      ** Data structure for subroutine ZCBDYS                             MMI100
     I            DS                                                      MMI100
     I                                        1   80ZZDAT1                MMI100
     I                                        1   40ZZYYA                 MMI100
     I                                        5   60ZZMMA                 MMI100
     I                                        7   80ZZDDA                 MMI100
      *                                                                   MMI100
     I            DS                                                      MMI100
     I                                        1   80ZZDAT2                MMI100
     I                                        1   40ZZYYB                 MMI100
     I                                        5   60ZZMMB                 MMI100
     I                                        7   80ZZDDB                 MMI100
      *                                                                                       LUC143
     I            DS                                                                          LUC143
     I                                        1  12 DS032                                     LUC143
     I                                        1   60WRK06N                                    LUC143
     I                                        7   9 EXCCYC                                    LUC143
     I                                       10  100FLD003                                    LUC143
     I                                       11  110FLD004                                    LUC143
      ***  Standard routine
      *
     I/COPY ZSRSRC,ZDAT10Z1
      *
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZHOLDS                                                 MMI084
     I/COPY ZSRSRC,ZHOLI                                                  MMI084
      /EJECT
      *****************************************************************
      ***                    M A I N L I N E S                      ***
      *****************************************************************
      *
      ***  For each detail record
      *
     C                     EXSR #CLEAR
      *
      ***  Level break, specific processing
      *
     C           *INL4     IFEQ '1'                        Branch
     C           *INL3     OREQ '1'                        EXLOTD/EXDECK/EXDESC
     C           *INL2     OREQ '1'                        Currency
     C           *INL1     OREQ '1'                        Customer
     C           EXLOTD    OREQ 'SEC'                      or LOTD is SEC
     C                     EXSR #SQBK
     C                     ENDIF
      *                                                                   MMI096
     C                     MOVE EXTREF    CHKREP  3                       MMI096
      *
      ***  Detail processing only when line item (Voce/sottovoce code)
      ***  linked to transaction or position.
     C           RTLINI    IFNE *ZEROS
     C           RTINCL    ANDEQ'Y'
     C           CHKREP    ANDNE'REP'                                     MMI096
      *
      ***  Record processing : Access external details
     C                     EXSR #DETL
      *
      *** If no problem fill Italian extracted record to report
     C  NU7                EXSR #WDTL
      *
     C                     ENDIF
      *
      ***  in case Of problem : leave pgm with audit DB error.
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     EXSR #DBERR
     C                     ENDIF
      *
      ***  next run tag
     C           NXTRCD    TAG
      *
      ***  TOTAL : End of file encountered
     CLR         *LOCK     IN   IRSTAT
     CLR                   Z-ADDWWSQCT    IRSQCT
     CLR                   OUT  IRSTAT
     CLR                   EXSR #AUDIT
      *
      *****************************************************************
      ***             E N D    O F    M A I N L I N E S             ***
      *****************************************************************
      *
      /EJECT
      *****************************************************************
      *  #CLEAR - Clear record fields and setup with default values   *
      *  ------                                                       *
      *  Called by : Mainlines                                        *
      *  Calls     :                                                  *
      *  Calls     :                                                  *
      *****************************************************************
      *
     C           #CLEAR    BEGSR
      *
     C                     ADD  1         RCD     60       Rcds Read
      *
     C                     CLEARERITTRD0
      *
      ***  Defaults
      *
     C                     Z-ADD99        ICMBCD           Mobil. Code
     C                     Z-ADD99        ICCLAC           Class of Account
     C                     Z-ADD0         ICRTTP           Rate Type
     C                     Z-ADD9         ICMOOP           Motiv of Operat.
     C                     Z-ADD770       ICSECL           Secur. listed
     C                     Z-ADD999       ICSECT           Secur. Type
     C           '7990001' CAT  'W0':0    ICFIID           Financial instit.
     C                     Z-ADD9         ICFXSP           Forex Sale/Purch. ind
     C           '7990001' CAT  'W0':0    ICBKPL           Bank cd of Pool Leadr
     C                     Z-ADD9         ICTPPL           Type of Pool Leader
     C                     Z-ADD9         ICTPUV           Type Underlying Value
     C                     Z-ADD000       ICNBUM           Nbr of Unpaid Months
     C                     Z-ADD999999    ICTPPR           Type of Product
     C                     Z-ADD777777793 ICFSCD           Fiscal Cd of Cntrpy
      *
      * Clear output fields for called programs
      *
     C***********          Z-ADD0         RTIDUR                          MMI110
     C                     Z-ADD0         RTRETM                          MMI110
     C                     Z-ADD0         RTAACF
     C                     Z-ADD0         RTAAFX
     C                     Z-ADD0         RTACFX
     C**********           Z-ADD0         RTBAFX                          MMI110
     C**********           Z-ADD0         RTBALR                          MMI110
     C                     Z-ADD0         RTCPCF
     C                     Z-ADD0         RTCPDF
     C                     Z-ADD0         RTLACF
     C                     Z-ADD0         RTLAFX
     C                     Z-ADD0         RTLCFX
     C**********           Z-ADD0         RTMTCR                          MMI110
     C**********           Z-ADD0         RTMVDR                          MMI110
     C                     Z-ADD0         RTNCCF
     C                     Z-ADD0         RTNCDF
     C**********           Z-ADD0         RTNMCR                          MMI110
     C                     Z-ADD0         RTOREX
     C**********           Z-ADD0         RTOUTB                          MMI110
     C**********           Z-ADD0         RTPCPC                          MMI110
     C**********           Z-ADD0         RTPCPD                          MMI110
     C**********           Z-ADD0         RTPMVC                          MMI110
     C**********           Z-ADD0         RTPMVD                          MMI110
     C**********           Z-ADD0         RTPNCC                          MMI110
     C**********           Z-ADD0         RTPNCD                          MMI110
     C**********           Z-ADD0         RTPVFX                          MMI110
     C                     Z-ADD0         RTQCPC
     C                     Z-ADD0         RTQCPD
     C                     Z-ADD0         RTQMVC
     C                     Z-ADD0         RTQMVD
     C                     Z-ADD0         RTQNCC
     C                     Z-ADD0         RTQNCD
     C**********           Z-ADD0         RTYCPC                          MMI110
     C**********           Z-ADD0         RTYCPD                          MMI110
     C**********           Z-ADD0         RTYMVC                          MMI110
     C**********           Z-ADD0         RTYMVD                          MMI110
     C**********           Z-ADD0         RTYNCC                          MMI110
     C**********           Z-ADD0         RTYNCD                          MMI110
     C                     Z-ADD0         RTCTVL
     C                     Z-ADD0         RTOPDT
     C                     Z-ADD*ZERO     RTCATC                          MMI115
     C                     Z-ADD*ZERO     RTTPAC                          MMI115
     C                     Z-ADD*ZERO     RTCLRL                          MMI115
     C                     Z-ADD*ZERO     RTACST                          MMI115
     C                     Z-ADD*ZERO     RTTEGL                          MMI115
     C                     Z-ADD*ZERO     RTCMPC                          MMI115
     C                     Z-ADD*ZERO     RTPSAM                          MMI117
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  #SQBK  - Subroutine to manage Ruptures                       *
      *  ------                                                       *
      *  Called by : Mainlines                                        *
      *  Calls     : internal routine : #DBERR : handle error         *
      *  Calls     : external pgm : ERIT61 (Branch)                   *
      *                             ERIT62 (Lot descr./Dec. key/DRCR) *
      *                             ERIT73 (Currency)                 *
      *                             ERIT63 (Customer/Lot descr.=SEC)  *
      *****************************************************************
      *
     C           #SQBK     BEGSR
      *
      ***  *INL4 is *ON : Branch Code sequence break :
      *
     C           *INL4     IFEQ *ON
      *
     C                     CALL 'ERIT61'
     C                     PARM           EXBRCD           Input
     C                     PARM *ZERO     RTORSP  50       Output
     C                     PARM ' '       RTINCL  1        Output
     C                     PARM *ZERO     RTONSP  90       Output
     C                     PARM *ZERO     RTORPR  50       Output
     C                     PARM *ZERO     RTORPA  30       Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C           *INU7     CABEQ'1'       #SQBKE           Leave
      *
     C                     FREE 'ERIT61'               80
     C   80                MOVE '0'       *IN80
      *
     C                     ENDIF
      *
      ***  *INL3 is *ON : Lot id/Decision Key/debit-Credit ind sequence break :
      *
     C           *INL3     IFEQ *ON
      *
     C                     CALL 'ERIT62'
     C                     PARM           EXLOTD           Input
     C                     PARM           EXDECK           Input
     C                     PARM           EXDRCR           Input
     C                     PARM *ZERO     RTLINI  70       Output
     C                     PARM *ZERO     RTRESV  20       Output
     C                     PARM *ZERO     RTCPAC  70       Output
     C                     PARM *BLANK    RTCOMP 15        Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C           *INU7     CABEQ'1'       #SQBKE           Leave
      *
     C                     ENDIF
      *
      ***  *INL2 is *ON : Currency sequence break :
      *
     C           *INL2     IFEQ *ON
      *
     C                     CALL 'ERIT73'
     C                     PARM           EXCCYC           Input
     C                     PARM *ZERO     RTUCCY  30       Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
      ***  Read European reporint Currency details
      *
     C********** EXCCYC    CHAINERCURRL1             80                   MMI100
     C           EXCCYC    CHAINSDCURRL1             80                   MMI100
     C           *IN80     IFEQ '1'                        Not found
     C           *LOCK     IN   LDA
     C                     MOVEL'600'     DBASE            ****************
     C**********           MOVEL'ERCURRL1'DBFILE           * DB ERROR 600 MMI100
     C                     MOVEL'SDCURRL1'DBFILE           * DB ERROR 600 MMI100
     C                     MOVELEXCCYC    DBKEY            ****************
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C**********           MOVELVRCYCD    RTCYCD  2        CCY CODE       MMI100
     C**********           Z-ADDVRNBDP    CONBDP  10       Dec places     MMI100
     C**********           Z-ADDVRSPRT    @@RAT1 138                      MMI100
     C**********           MOVE VRMDIN    @@MDI1  1                       MMI100
     C                     MOVELA6CYCD    RTCYCD  2        CCY CODE       MMI100
     C                     Z-ADDA6NBDP    CONBDP  10       Dec places     MMI100
     C                     Z-ADDA6SPRT    @@RAT1 138                      MMI100
     C                     MOVE A6MDIN    @@MDI1  1                       MMI100
     C                     EXSR ZA0900                     Cross X-rate
      *
     C           *INU7     CABEQ'1'       #SQBKE           Leave
      *
     C                     ENDIF                           *INL2
      *
      *** *INL1 is *ON or Lot descriptor is 'SEC' : Customer sequence break :
      *
     C           *INL1     IFEQ '1'
     C           EXLOTD    OREQ 'SEC'
      *
     C                     CALL 'ERIT63'
     C                     PARM           EXCUST           Input
     C                     PARM *ZERO     RTCONS  10       Output
     C                     PARM *ZERO     RTCPTY  40       Output
     C                     PARM *ZERO     RTECSG  30       Output
     C                     PARM *BLANKS   RTFIID  9        Output
     C                     PARM *ZERO     RTDBCD  10       Output
     C                     PARM *ZERO     RTECBC  30       Output
     C                     PARM 99999     RTPRCT  50       Output(Default)
     C                     PARM *ZERO     RTCNTP  50       Output
     C                     PARM 777777793 RTFSCD 110       Output(Default)
     C                     PARM *BLANKS   RTBNTP  1        Output
     C                     PARM *ZERO     RTCUCR  90       Output
     C                     PARM *ZERO     RTCRTP  10       Output
     C                     PARM *BLANKS   RTCRNM 60        Output
     C                     PARM *BLANKS   RTFCCR 16        Output
     C                     PARM *BLANKS   RTHOLC 30        Output
     C                     PARM *ZERO     RTHLCD  60       Output
     C                     PARM *BLANKS   RTCUAD 40        Output
     C                     PARM *BLANKS   RTCUCT 40        Output
     C                     PARM *BLANKS   RTCCCN  7        Output
     C                     PARM *BLANKS   RTCCCL 15        Output
     C                     PARM *BLANKS   RTCCCD  3        Output
     C                     PARM *ZERO     RTCURF  10       Output
     C                     PARM *ZERO     RTCPPT  20       Output
     C                     PARM *BLANKS   RTCOTP  2        Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      ****
      **** Access Customer details to know last change date
      ****
     C****                 MOVELEXCUST    @KEY   10
     C****                 CALL 'AOCUSTR0'
     C****                 PARM *BLANKS   @RTCD   7
     C****                 PARM '*KEY   ' @OPTN   7
     C****                 PARM           @KEY
     C****                 PARM *BLANKS   @KYSTS  7
     C****       SDCUST    PARM SDCUST    DSSDY
      ****
     C****       @RTCD     IFNE *BLANKS
     C****       *LOCK     IN   LDA
     C****                 MOVEL'601'     DBASE            ****************
     C****                 MOVEL'SDCUSTPD'DBFILE           * DB ERROR 601 *
     C****                 MOVELEXCUST    DBKEY            ****************
     C****                 EXSR #DBERR
     C****                 ENDIF
      ****
     C****                 Z-ADDBBLCD     RTLCD   50       Last change Date
     C****                 Z-ADDBBORED    RTORED  50       Original Entry date
     C****                 MOVE BBTYLC    RTTYLC  1                    Type
      *
     C                     ENDIF
      *
      ***  Leave routine Tag
      *
     C           #SQBKE    TAG
      *          ---------------
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  #DETL  - Subroutine to retrieve external details             *
      *  ------                                                       *
      *  Called By : Mainlines                                        *
      *  Calls     : internal Routine :                               *
      *  Calls     : External pgm : ERIT64 (Dealing)                  *
      *                             ERIT65 (Lending)                  *
      *                             ERIT67 (Sec. Trading)             *
      *                             ERIT70 (General Ledger)           *
      *                             ERIT74 (Lot Desc = SEC)           *
      *                             ERIT77 (all)                      *
      *                             ERIT78 (Lot Desc = GLA)           *
      *****************************************************************
      *
     C           #DETL     BEGSR
      *
      ***  Specific processing depending on record type :
      *
     C                     SELEC
      *
      ***  Dealing : MMD, NAP, FXP, FXS, FRA, IRS
      *
     C           EXLOTD    WHEQ 'MMD'
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
      *
      ***  Dealing processing
      *
     C                     CALL 'ERIT64'
     C                     PARM           EXLOTD           Input
     C                     PARM           EXTREF           Input
     C                     PARM           EXDECK           Input
     C                     PARM           XXSTRQ           Input
     C                     PARM           XXENDQ           Input
     C                     PARM 9         RTMOOP  10       Output(Default)
     C                     PARM 999       RTAGCT  30       Output(Default)
     C                     PARM 999       RTAGCL  30       Output(Default)
     C                     PARM 99        RTECBD  20       Output(Default)
     C                     PARM *ZERO     RTSBCR  10       Output
     C                     PARM *BLANKS   RTSBLW  3        Output
     C                     PARM *ZERO     RTINSB  10       Output
     C                     PARM 999999    RTTPPR  60       Output(Default)
     C                     PARM 999999    RTPEPR  60       Output
     C                     PARM *ZERO     RTGLPA  10       Output
     C                     PARM *ZERO     RTPTRP  30       Output
     C                     PARM *ZERO     RTTPFD  10       Output
     C                     PARM 9         RTTPUV  10       Output
     C                     PARM *ZERO     RTCVID  10       Output
     C                     PARM *ZERO     RTCVTP  10       Output
     C                     PARM *ZERO     RTPATP  20       Output
     C                     PARM *ZERO     RTDPIV  50       Output
     C                     PARM *BLANKS   RTEDIV  3        Output
     C                     PARM *ZERO     RTCATC 110       Output
     C                     PARM *ZERO     RTTPAC  30       Output
     C                     PARM *ZERO     RTCLRL  30       Output
     C                     PARM *ZERO     RTACST  30       Output
     C                     PARM *BLANKS   RTLNIT  7        Output
     C                     PARM *ZERO     RTTEGL  83       Output
     C                     PARM *ZERO     RTCMPC  83       Output
     C                     PARM *ZERO     RTNUMO  30       Num. of Month
     C                     PARM *ZERO     RTSPRE 117       Spread Rate
     C                     PARM *ZERO     RTQMVD 160
     C                     PARM *ZERO     RTQNCD 160
     C                     PARM *ZERO     RTQMVC 160
     C                     PARM *ZERO     RTQNCC 160
     C                     PARM *ZERO     RTQCPC 160
     C                     PARM *ZERO     RTQCPD 160
     C                     PARM *ZERO     RTCTVL 160
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Lending : LEN, PPU, PSO
      *
     C           EXLOTD    WHEQ 'LEN'
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
      *
      ***  Lending processing
      *
     C                     CALL 'ERIT65'
     C                     PARM           EXLOTD           Input
     C                     PARM           EXBRCD           Input
     C                     PARM           EXTREF           Input
     C***********          PARM           XXSTRQ           Input          MMI110
     C***********          PARM           XXENDQ           Input          MMI110
     C                     PARM           XXENDQ           Input          MMI115
     C                     PARM 9         RTMOOP  10       Output(Default)
     C                     PARM 999       RTAGCT  30       Output(Default)
     C                     PARM 999       RTAGCL  30       Output(Default)
     C                     PARM 99        RTECBD  20       Output(Default)
     C                     PARM *ZERO     RTSBCR  10       Output
     C                     PARM *BLANKS   RTSBLW  3        Output
     C                     PARM *ZERO     RTINSB  10       Output
     C                     PARM 999999    RTTPPR  60       Output(Default)
     C                     PARM 999999    RTPEPR  60       Output
     C                     PARM *ZERO     RTGLPA  10       Output
     C                     PARM *ZERO     RTPTRP  30       Output
     C                     PARM *ZERO     RTTPFD  10       Output
     C                     PARM *ZERO     RTDPIV  50       Output
     C                     PARM *BLANKS   RTEDIV  3        Output
     C                     PARM *ZERO     RTCATC 110       Output
     C                     PARM *ZERO     RTTPAC  30       Output
     C                     PARM *ZERO     RTCLRL  30       Output
     C                     PARM *ZERO     RTACST  30       Output
     C                     PARM *BLANKS   RTLNIT  7        Output
     C                     PARM *ZERO     RTTEGL  83       Output
     C                     PARM *ZERO     RTCMPC  83       Output
     C***********          PARM *ZERO     RTNUMO  30       Num. of Month  MMI110
     C                     PARM           RTOPDT  80       Next Payment Date
     C***********          PARM           RTOREX 160       Original Expo  MMI110
     C***********          PARM *ZERO     RTIDUR  20       Original Matur MMI110
     C***********          PARM *ZERO     RTQMVD 160                      MMI110
     C***********          PARM *ZERO     RTQNCD 160                      MMI110
     C***********          PARM *ZERO     RTQMVC 160                      MMI110
     C***********          PARM *ZERO     RTQNCC 160                      MMI110
     C***********          PARM *ZERO     RTQCPC 160                      MMI110
     C***********          PARM *ZERO     RTQCPD 160                      MMI110
     C***********          PARM *ZERO     RTTPPL  10                      MMI110
     C***********          PARM *ZERO     RTPVFX 160                      MMI110
     C***********          PARM *ZERO     RTAAFX 160                      MMI110
     C***********          PARM *ZERO     RTRETM  30                192459MMI110
     C                     PARM           RTPSAM 130                      MMI117
     C                     PARM *ZERO     RTUNDT  50                      MBV006
     C                     PARM *BLANKS   ERROR   1        Output
      *
      *
      ***  Securities trading :
      *
     C           EXLOTD    WHEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
      *
      ***  Securities Trading processing
      *
     C                     CALL 'ERIT67'
     C                     PARM           EXSESN           Input
     C***********          PARM *BLANKS   RTSECC 11        Output         MMI032
     C                     PARM *BLANKS   RTSECC 12        Output         MMI032
     C                     PARM *ZEROS    RTSECL  30       Output
     C                     PARM *ZEROS    RTSECT  50       Output
     C                     PARM *BLANKS   RTSEGA 11        Output
     C                     PARM *BLANKS   RTISCT  3        Output
     C                     PARM *ZERO     RTBUFC  10       Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
      ***  Additional details for SEC : Book details
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
      *
     C           EXLOTD    IFEQ 'SEC'
     C                     MOVELEXTREF    WFIE02  2
     C                     ELSE
     C                     MOVELEXDECK    WFIE05  5
     C                     MOVE WFIE05    WFIE02
     C                     END
     C                     MOVELWFIE02    WFIE15 15
     C                     CALL 'ERIT74'
     C*******              PARM           EXTREF           Input
     C                     PARM           WFIE15           Input
     C                     PARM *ZERO     RTSEIM  10       Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
     C                     ENDIF
      *
      ***  General Ledger : GLA
      *
     C           EXLOTD    WHEQ 'GLA'
      *
      ***  General ledger processing  (account code details)
     C                     CALL 'ERIT78'
     C                     PARM           EXDECK           Input
     C                     PARM 99        RTCLAC  20       Output(Default)
     C                     PARM 99        RTMBCD  20       Output(Default)
     C                     PARM *BLANKS   ERROR   1
      *
      ***  Additional details for GLA : (account details)
     C                     CALL 'ERIT70'
     C                     PARM           EXTREF           Input
     C                     PARM           EXBRCD           Input
     C**********           PARM           RTLINI           Input (L3 break)MI110
     C**********           PARM           XYENDP           END OF PERIOD  MMI110
     C**********           PARM           EXAMNT                          MMI110
     C**********           PARM           EXDRCR                          MMI110
     C                     PARM           RTMBCD  20       Output(Default)
     C**********           PARM *ZERO     RTBAFX 160       Output         MMI110
     C**********           PARM *ZERO     RTBALR 160       Output         MMI110
     C**********           PARM *ZERO     RTPNCD 160       Output         MMI110
     C**********           PARM *ZERO     RTPNCC 160       Output         MMI110
     C**********           PARM *ZERO     RTPCPD 160       Output         MMI110
     C**********           PARM *ZERO     RTPCPC 160       Output         MMI110
     C**********           PARM *ZERO     RTPMVD 160       Output         MMI110
     C**********           PARM *ZERO     RTPMVC 160       Output         MMI110
     C**********           PARM *ZERO     RTQNCD 160       Output         MMI110
     C**********           PARM *ZERO     RTQNCC 160       Output         MMI110
     C**********           PARM *ZERO     RTQCPD 160       Output         MMI110
     C**********           PARM *ZERO     RTQCPC 160       Output         MMI110
     C**********           PARM *ZERO     RTQMVD 160       Output         MMI110
     C**********           PARM *ZERO     RTQMVC 160       Output         MMI110
     C**********           PARM *ZERO     RTYNCD 160       Output         MMI110
     C**********           PARM *ZERO     RTYNCC 160       Output         MMI110
     C**********           PARM *ZERO     RTYCPD 160       Output         MMI110
     C**********           PARM *ZERO     RTYCPC 160       Output         MMI110
     C**********           PARM *ZERO     RTYMVD 160       Output         MMI110
     C**********           PARM *ZERO     RTYMVC 160       Output         MMI110
     C**********           PARM *ZERO     RTAAFX 160       Output         MMI110
     C**********           PARM *ZERO     RTLAFX 160       Output         MMI110
     C**********           PARM *ZERO     RTAACF 160       Output         MMI110
     C**********           PARM *ZERO     RTLACF 160       Output         MMI110
     C**********           PARM *ZERO     RTNCDF 160       Output         MMI110
     C**********           PARM *ZERO     RTCPDF 160       Output         MMI110
     C**********           PARM *ZERO     RTNCCF 160       Output         MMI110
     C**********           PARM *ZERO     RTCPCF 160       Output         MMI110
     C**********           PARM *ZERO     RTNBOP  50       Output         MMI110
     C**********           PARM *ZERO     RTMTCR 160       Output         MMI110
     C**********           PARM *ZERO     RTNMCR 160       Output         MMI110
     C**********           PARM *ZERO     RTMVDR 160       Output         MMI110
     C**********           PARM *ZERO     RTOUTB 160       Output         MMI110
     C**********           PARM *ZERO     RTACFX 160       Output         MMI110
     C**********           PARM *ZERO     RTLCFX 160       Output         MMI110
     C**********           PARM *ZERO     RTLSTM  80       Output         MMI110
     C                     PARM *ZERO     RTCATC 110       Output
     C                     PARM *ZERO     RTTPAC  30       Output
     C                     PARM *ZERO     RTCLRL  30       Output
     C                     PARM *ZERO     RTACST  30       Output
     C                     PARM *BLANKS   RTLNIT  7        Output
     C                     PARM *ZERO     RTTEGL  83       Output
     C                     PARM *ZERO     RTCMPC  83       Output
     C                     PARM           ERROR   1        Return ind.
      *
      ***  Handle error
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C                     ENDSL
      *
      ***  Handle error : 'Module' processing
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
      *** Country processing for all type of record
      *
     C                     CALL 'ERIT77'
     C                     PARM           EXCUCC  2        Input
     C                     PARM *ZERO     RTUCTR  30       Output
     C                     PARM *BLANKS   ERROR   1        Return
      *
      ***  Handle error : Country processing
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *                                                                   MMI117
      * Work out factor to convert Midas amounts to Puma amounts.         MMI117
      *                                                                   MMI117
     C                     Z-ADD100       FACTOR  41                      MMI117
     C                     DO   CONBDP                                    MMI117
     C                     DIV  10        FACTOR                          MMI117
     C                     ENDDO                                          MMI117
      *                                                                   MMI110
      * Access work file containing numeri and other data                 MMI110
      *                                                                   MMI110
     C           KEREX     KLIST                                          MMI110
     C                     KFLD           EXTREF                          MMI110
     C                     KFLD           EXBRCD                          MMI110
      *                                                                   MMI110
     C           EXLOTD    IFEQ 'LEN'                                     MMI110
     C           EXLOTD    OREQ 'PPU'                                     MMI110
     C           EXLOTD    OREQ 'PSO'                                     MMI110
     C           EXLOTD    OREQ 'GLA'                                     MMI110
      *                                                                   MMI110
     C           KEREX     CHAINERNUMEPD             01                   MMI110
      *                                                                   MMI110
     C           *IN01     IFEQ *OFF                                      MMI110
      **********                                                    MMI110MMI117
     C**********           Z-ADD100       FACTOR  41                MMI110MMI117
     C**********           DO   CONBDP                              MMI110MMI117
     C**********           DIV  10        FACTOR                    MMI110MMI117
     C**********           ENDDO                                    MMI110MMI117
      *                                                                   MMI110
     C                     Z-ADDOUT248    RTRETM  30                      MMI110
     C           FACTOR    MULT OUT612    RTNCDF 160H                     MMI110
     C           FACTOR    MULT OUT613    RTNCCF 160H                     MMI110
     C           FACTOR    MULT OUT614    RTCPDF 160H                     MMI110
     C           FACTOR    MULT OUT615    RTCPCF 160H                     MMI110
     C                     Z-ADDOUT635    RTQNCD                          MMI110
     C                     Z-ADDOUT636    RTQNCC                          MMI110
     C                     Z-ADDOUT637    RTQCPD                          MMI110
     C                     Z-ADDOUT638    RTQCPC                          MMI110
     C                     Z-ADDOUT639    RTQMVD                          MMI110
     C                     Z-ADDOUT640    RTQMVC                          MMI110
     C           FACTOR    MULT OUT661    RTAAFX 160H                     MMI110
     C           FACTOR    MULT OUT662    RTLAFX 160H                     MMI110
     C           FACTOR    MULT OUT663    RTAACF 160H                     MMI110
     C           FACTOR    MULT OUT664    RTLACF 160H                     MMI110
     C           FACTOR    MULT OUT665    RTACFX 160H                     MMI110
     C           FACTOR    MULT OUT666    RTLCFX 160H                     MMI110
     C                     Z-ADDOUT859    RTOREX 160                      MMI110
      *                                                                   MMI115
     C           OUT253    IFNE *ZERO                                     MMI115
     C                     Z-ADDOUT253    @@DAYN                          MMI115
     C                     EXSR ZDATE9                                    MMI115
     C                     Z-ADD@@VDT     ICDDAT                          MMI115
     C                     ENDIF                                          MMI115
      *                                                                   MMI115
     C           FACTOR    MULT OU6001    INAMNT                          MMI115
     C                     EXSR CALCON                                    MMI115
     C                     Z-ADDOUTAMT    IC6001                          MMI115
      *                                                                   MMI115
     C           OU6416    IFNE *ZERO                                     MMI115
     C                     Z-ADDOU6416    @@DAYN                          MMI115
     C                     EXSR ZDATE9                                    MMI115
     C                     Z-ADD@@VDT     IC6416                          MMI115
     C                     ENDIF                                          MMI115
      *                                                                   MMI140
     C           FACTOR    MULT OUT953    INAMNT                          MMI140
     C                     EXSR CALCON                                    MMI140
     C                     Z-ADDOUTAMT    ICOUTB                          MMI140
      *                                                                   MMI140
     C           FACTOR    MULT OU9478    INAMNT                          MMI140
     C                     EXSR CALCON                                    MMI140
     C                     Z-ADDOUTAMT    ICPNCD                          MMI140
      *                                                                   MMI140
      * If the Effective Interest Rate has not been entered in the        MMI140
      * Puma window then use the nominal rate retrieved by ERIT58         MMI140
      * and ERIT59.                                                       MMI140
      *                                                                   MMI140
     C           RTTEGL    IFEQ *ZERO                                     MMI140
      *                                                                   MMI140
     C                     Z-ADDICDERT    RTTEGL                          MMI140
      *                                                                   MMI140
      * If Interest Frequency is not blank then adjust the nominal        MMI140
      * rate accordingly                                                  MMI140
      *                                                                   MMI140
     C           INTFRQ    IFNE *BLANKS                                   MMI140
      *                                                                   MMI140
      * Determine number of capitalisation periods in year                MMI140
      *                                                                   MMI140
     C                     Z-ADD1         PERIOD  30                      MMI140
     C           INTFRQ    IFEQ 'D'                                       MMI140
     C                     Z-ADD365       PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'W'                                       MMI140
     C                     Z-ADD52        PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'F'                                       MMI140
     C           INTFRQ    OREQ 'S'                                       MMI140
     C                     Z-ADD26        PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'M'                                       MMI140
     C           INTFRQ    OREQ 'A'                                       MMI140
     C           INTFRQ    OREQ 'B'                                       MMI140
     C           INTFRQ    OREQ 'L'                                       MMI140
     C           INTFRQ    OREQ 'N'                                       MMI140
     C           INTFRQ    OREQ 'P'                                       MMI140
     C           INTFRQ    OREQ 'R'                                       MMI140
     C                     Z-ADD12        PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'T'                                       MMI140
     C                     Z-ADD6         PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'Q'                                       MMI140
     C           INTFRQ    OREQ 'K'                                       MMI140
     C                     Z-ADD4         PERIOD                          MMI140
     C                     ENDIF                                          MMI140
     C           INTFRQ    IFEQ 'X'                                       MMI140
     C           INTFRQ    OREQ 'H'                                       MMI140
     C                     Z-ADD2         PERIOD                          MMI140
     C                     ENDIF                                          MMI140
      *                                                                   MMI140
     C                     Z-ADDICDERT    NOMRAT 139H                     MMI140
     C                     DIV  PERIOD    NOMRAT 139H                     MMI140
     C                     DIV  100       NOMRAT                          MMI140
     C                     ADD  1         NOMRAT                          MMI140
     C                     Z-ADD1         WRKRAT 139                      MMI140
     C                     DO   PERIOD                                    MMI140
     C                     MULT NOMRAT    WRKRAT    H                     MMI140
     C                     ENDDO                                          MMI140
     C                     SUB  1         WRKRAT                          MMI140
     C           WRKRAT    MULT 100       EFFRAT 117H                     MMI140
     C                     Z-ADDEFFRAT    RTTEGL    H                     MMI140
      *                                                                   MMI140
     C                     ENDIF                                          MMI140
     C                     ENDIF                                          MMI140
      *                                                                   MMI115
     C                     ENDIF                                          MMI110
     C                     ENDIF                                          MMI110
      *                                                                   MMI110
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  #WDTL  - Subroutine to write detail record in ERITTRPD       *
      *  ------                                                       *
      *  Called by : Mainlines                                        *
      *  Calls     : internal routine :                               *
      *  Calls     : External pgm :                                   *
      *****************************************************************
      *
     C           #WDTL     BEGSR
      *
      ***  used retrieved details to setup fields (RT....)
      *
     C                     Z-ADD1         ICRTYP           Record type
     C                     Z-ADDRTUCCY    ICUCCY           UIC CCY code
      *
      ***  Country UIC code : Foreign customer : RTUCTR  (3,0)
      ***  - - - - - - - - -  Italian customer : RTPRTC  (5,0)
      *
     C****       RTPRCT    IFNE 99999                      Code provincia
     C****       RTPRCT    ANDNE0                          not used/not defined
     C****                 Z-ADDRTPRCT    ICUCTR           5.0 --> 3.0
     C****                 ELSE
      *
      ***  In all cases take customer retrieved UCTR code (*INL1)
      *
     C                     Z-ADDRTUCTR    ICUCTR
     C****                 ENDIF
      *
     C                     Z-ADDRTCONS    ICCONS           Consol. code
     C                     Z-ADDRTCPTY    ICCPTY           Ctrpy. code
     C                     Z-ADDRTLINI    ICLINI           Line Item
     C                     MOVE RTRESV    ICILIN           Internal Line Item
     C                     Z-ADDRTECSG    ICECSG           Econom. Subgrp
     C                     MOVE RTCOTP    ICCOTP           TYPE OF CRED.OP
      *
      ***  Mobilisation code : For General Ledger else Default
      ***  Class of account  : For General Ledger else Default
      *
     C           EXLOTD    IFEQ 'GLA'
     C                     Z-ADDRTMBCD    ICMBCD           Mobilisation code
     C                     Z-ADDRTCLAC    ICCLAC           Class of account
     C                     ENDIF
      *
      ***  Last Mvts Date
      *
     C           EXLOTD    IFEQ 'GLA'
     C           OUT221    ANDNE*ZERO                                     MMI110
     C**********           Z-ADDRTLSTM    ICLSTM                          MMI110
     C                     Z-ADDOUT221    @@DAYN                          MMI110
     C                     EXSR ZDATE9                                    MMI110
     C                     Z-ADD@@VDT     ICLSTM                          MMI110
     C                     ELSE
     C                     Z-ADDEXSTRD    ICLSTM
     C                     ENDIF
      *
      ***  Rate type
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C********** EXLOTD    OREQ 'FRA'
     C********** EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
      *
     C                     SELEC
     C           EXIRTT    WHEQ 0
     C                     Z-ADD0         ICRTTP
     C           EXIRTT    WHEQ 1
     C                     Z-ADD0         ICRTTP
     C           EXIRTT    WHEQ 2
     C                     Z-ADD1         ICRTTP
     C                     ENDSL
     C                     ENDIF
      *
     C           EXLOTD    IFEQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
      *
     C           EXPTYP    IFEQ 1
     C                     Z-ADD1         ICRTTP
     C                     ELSE
     C                     Z-ADD0         ICRTTP
     C                     END
      *                                                                   217674
     C           EXLOTD    IFEQ 'IRS'                                     217674
      *                                                                   217674
     C           EXIRTT    IFEQ 1                                         217674
     C                     Z-ADD1         ICRTTP                          217674
     C                     ELSE                                           217674
     C                     Z-ADD0         ICRTTP                          217674
     C                     ENDIF                                          217674
     C                     ENDIF                                          217674
      *
     C                     Z-ADDEXPTYP    ICBSRT
     C*****                Z-ADDEXCRRT    ICCRRT                                              LUC139
     C*****                Z-ADDEXDERT    ICDERT                                              LUC139
      *
     C                     ENDIF
      *
      ***  Motivation of operation : For Dealing or Lending else default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTMOOP    ICMOOP
     C                     ENDIF
      *
     C                     Z-ADDEXSTRD    ICSTRD           Value date
     C                     Z-ADDEXENDD    ICENDD           Maturity date
      *
      ***  Security Code : for Securities Trading else *blanks
      ***  Security Listed : for Securities Trading else default
      ***  Security Type : for Securities Trading else default
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
     C                     MOVELRTSECC    ICSECC
     C                     MOVELRTSECL    ICSECL
     C                     MOVELRTSECT    ICSECT
     C*****                Z-ADDEXCRRT    ICCRRT                          MMI080              LUC139
     C                     ENDIF
      *                                                                   MMI084
     C                     Z-ADD0         ICDTOP                          MMI032
     C                     MOVE *BLANKS   ICSCAT                          MMI032
      *                                                                   MMI084
      * Future Exposure and Intrinsic Value calculation                   MMI084
      *                                                                   MMI084
     C                     Z-ADD*ZERO     ICFTEX                          MMI084
     C                     Z-ADD*ZERO     ICESVL                          MMI084
     C                     Z-ADD*ZERO     ICINVL                          MMI084
      *                                                                   MMI084
      * Future Exposure - FX Deals over 14 days                           MMI084
      *                                                                   MMI084
     C           EXLOTD    IFEQ 'FXP'                                     MMI084
     C           EXLOTD    OREQ 'FXS'                                     MMI084
     C                     Z-ADDEXENDD    ZZDTIN                          MMI084
     C                     EXSR ZDAT10                                    MMI084
     C                     Z-ADDZZMDNO    NBRDYS  50                      MMI084
     C                     Z-ADDEXSTRD    ZZDTIN                          MMI084
     C                     EXSR ZDAT10                                    MMI084
     C                     SUB  ZZMDNO    NBRDYS                          MMI084
     C           NBRDYS    IFGT 14                                        MMI084
     C           0.01      MULT EXAMNT    ICFTEX    H                     MMI084
     C           EXENDD    IFGT YEAR1                                     MMI084
     C           0.05      MULT EXAMNT    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
     C           EXENDD    IFGT YEAR5                                     MMI084
     C           0.075     MULT EXAMNT    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI084
      * Intrinsic Value - FX Deals over 14 days                           MMI084
      *                                                                   MMI084
     C                     Z-ADDEXENDD    ZZDTIN                          MMI084
     C                     EXSR ZDAT10                                    MMI084
     C                     Z-ADDXXENDQ    ZNPSDT                          MMI084
     C                     Z-ADDZZMDNO    ZNPFDT                          MMI084
     C                     Z-ADDEXAMNT    ZNPAMT                          MMI084
     C                     MOVE EXCCYC    ZNPCCY                          MMI084
     C                     MOVE 'B'       ZNPBOF                          MMI084
     C                     Z-ADD1         ZCBCBS                          MMI084
     C                     EXSR ZNPV                                      MMI084
     C           ZNPOUT    DIV  10        INAMNT                          MMI084
     C                     EXSR CALCON                                    MMI084
     C           EXRIND    IFEQ 'FXPU'                                    MMI084
     C                     Z-ADDOUTAMT    ICINVL                          MMI084
     C                     ELSE                                           MMI084
     C                     Z-SUBOUTAMT    ICINVL                          MMI084
     C                     ENDIF                                          MMI084
     C                     Z-ADDEXEXEA    ZNPAMT                          MMI084
     C                     MOVE BJCYCD    ZNPCCY                          MMI084
     C                     EXSR ZNPV                                      MMI084
     C                     DIV  10        ZNPOUT                          MMI084
     C           EXRIND    IFEQ 'FXPU'                                    MMI084
     C                     SUB  ZNPOUT    ICINVL                          MMI084
     C                     ELSE                                           MMI084
     C                     ADD  ZNPOUT    ICINVL                          MMI084
     C                     ENDIF                                          MMI084
     C                     ENDIF                                          MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI084
      * Future Exposure - FRA/IRS Deals                                   MMI084
      *                                                                   MMI084
     C           EXLOTD    IFEQ 'FRA'                                     MMI084
     C           EXLOTD    OREQ 'IRS'                                     MMI084
     C           EXENDD    IFGT YEAR1                                     MMI084
     C           0.005     MULT EXAMNT    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
     C           EXENDD    IFGT YEAR5                                     MMI084
     C           0.015     MULT EXAMNT    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI084
      * Intrinsic Value - FRA/IRS Deals                                   MMI084
      *                                                                   MMI084
     C           EXNPVA    IFNE 0                                         MMI084
     C           EXNPVA    DIV  10        INAMNT                          MMI084
     C                     EXSR CALCON                                    MMI084
     C                     Z-ADDOUTAMT    ICINVL                          MMI084
     C                     ENDIF                                          MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI084
      * Future Exposure - SE Forward Trades                               MMI084
      *                                                                   MMI084
     C           EXLOTD    IFEQ 'SEF'                                     MMI084
     C                     Z-ADDEXSTRD    ZZDTIN                          MMI084
     C                     EXSR ZDAT10                                    MMI084
     C                     Z-ADDZZMDNO    ZDAYNO                          MMI084
     C                     Z-ADD2         ZNRDYS                          MMI084
     C                     MOVE EXCCYC    ZCCY                            MMI084
     C                     MOVE *BLANKS   ZLOC                            MMI084
     C                     EXSR ZFWDT                                     MMI084
     C                     Z-ADDZDYNBR    @@DAYN                          MMI084
     C                     EXSR ZDATE9                                    MMI084
     C           EXENDD    IFGT @@VDT                                     MMI084
     C           0.06      MULT EXNOMA    ICFTEX    H                     MMI084
     C           EXENDD    IFGT YEAR1                                     MMI084
     C           0.08      MULT EXNOMA    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
     C           EXENDD    IFGT YEAR5                                     MMI084
     C           0.1       MULT EXNOMA    ICFTEX    H                     MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI101
      * For Non-shares use different percentages                          MMI101
      *                                                                   MMI101
     C                     MOVE EXDTCD    PROT    1                       MMI101
     C           PROT      IFNE '4'                                       MMI101
     C                     Z-ADD*ZERO     ICFTEX                          MMI101
     C           EXENDD    IFGT YEAR1                                     MMI101
     C           0.005     MULT EXNOMA    ICFTEX    H                     MMI101
     C                     ENDIF                                          MMI101
     C           EXENDD    IFGT YEAR5                                     MMI101
     C           0.015     MULT EXNOMA    ICFTEX    H                     MMI101
     C                     ENDIF                                          MMI101
     C                     ENDIF                                          MMI101
      *                                                                   MMI084
      * Intrinsic Value - SE Forward Trades                               MMI084
      *                                                                   MMI084
     C                     Z-ADDEXENDD    ZZDTIN                          MMI084
     C                     EXSR ZDAT10                                    MMI084
     C                     Z-ADDXXENDQ    ZNPSDT                          MMI084
     C                     Z-ADDZZMDNO    ZNPFDT                          MMI084
     C                     Z-ADDEXEXEA    ZNPAMT                          MMI084
     C                     MOVE EXCCYC    ZNPCCY                          MMI084
     C                     MOVE 'B'       ZNPBOF                          MMI084
     C                     Z-ADD1         ZCBCBS                          MMI084
     C                     EXSR ZNPV                                      MMI084
     C           EXDRCR    IFEQ 0                                         MMI084
     C           EXREAA    SUB  ZNPOUT    ICINVL                          MMI084
     C                     ELSE                                           MMI084
     C           ZNPOUT    SUB  EXREAA    ICINVL                          MMI084
     C                     ENDIF                                          MMI084
     C           ICINVL    DIV  10        INAMNT                          MMI084
     C                     EXSR CALCON                                    MMI084
     C                     Z-ADDOUTAMT    ICINVL                          MMI084
     C                     ENDIF                                          MMI084
     C                     ENDIF                                          MMI084
      *                                                                   MMI084
      * Format and store in ICFTEX (orig. ccy) and ICESVL (rep. ccy)      MMI084
      *                                                                   MMI084
     C           ICFTEX    IFNE 0                                         MMI084
     C                     DIV  10        ICFTEX                          MMI084
     C                     Z-ADDICFTEX    INAMNT                          MMI084
     C                     EXSR CALCON                                    MMI084
     C                     Z-ADDOUTAMT    ICESVL                          MMI084
     C                     ENDIF                                          MMI084
      **********************************************************************
      ***  All Amounts will be filled out with 2 decimal places (Italy)  ***
      **********************************************************************
      *
      ***  Book value in Original Currency
      *
     C           EXAMNT    DIV  10        ICBVFX           (3dec --> 2 dec)
      *
      ***  Movements                                                      MMI110
      *                                                                   MMI110
     C           EXLOTD    IFEQ 'LEN'                                     MMI110
     C           EXLOTD    OREQ 'PPU'                                     MMI110
     C           EXLOTD    OREQ 'PSO'                                     MMI110
     C           EXLOTD    OREQ 'NAP'                                     MMI110
     C           EXLOTD    OREQ 'MMD'
     C           EXLOTD    OREQ 'GLA'                                     MMI110
     C********** EXLOTD    IFEQ 'MMD'
     C**********           Z-ADDEXAMNT    EXNOMA                          MMI110
     C**********           Z-ADDICBVFX    RTAAFX
     C**********           DIV  100       RTAAFX
     C**********           Z-ADDRTAAFX    ICAAFX                          MMI110
     C                     Z-ADDRTQMVD    ICQMVD
     C                     Z-ADDRTQMVC    ICQMVC
     C                     SELEC                           Ccy dec places
     C           CONBDP    WHEQ 0
     C           RTQNCD    MULT 100       ICQNCD           Not Cap Debit
     C           RTQNCC    MULT 100       ICQNCC           Not Cap Credit
     C           RTQCPD    MULT 100       ICQCPD           Cap Debit
     C           RTQCPC    MULT 100       ICQCPC           Cap Credit
     C           CONBDP    WHEQ 1
     C           RTQNCD    MULT 10        ICQNCD           Not Cap Debit
     C           RTQNCC    MULT 10        ICQNCC           Not Cap Credit
     C           RTQCPD    MULT 10        ICQCPD           Cap Debit
     C           RTQCPC    MULT 10        ICQCPC           Cap Credit
     C           CONBDP    WHEQ 2
     C                     Z-ADDRTQNCD    ICQNCD           Not Cap Debit
     C                     Z-ADDRTQNCC    ICQNCC           Not Cap Credit
     C                     Z-ADDRTQCPD    ICQCPD           Cap Debit
     C                     Z-ADDRTQCPC    ICQCPC           Cap Credit
     C           CONBDP    WHEQ 3
     C           RTQNCD    DIV  10        ICQNCD           Not Cap Debit
     C           RTQNCC    DIV  10        ICQNCC           Not Cap Credit
     C           RTQCPD    DIV  10        ICQCPD           Cap Debit
     C           RTQCPC    DIV  10        ICQCPC           Cap Credit
     C                     ENDSL
      *
     C                     Z-ADDICQNCD    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICQNCD
      *
     C                     Z-ADDICQNCC    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICQNCC
      *
     C                     Z-ADDICQCPD    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICQCPD
      *
     C                     Z-ADDICQCPC    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICQCPC
      *
     C                     ENDIF
      *
      ***  Convert For Book value in Lira
      *
     C                     Z-ADDICBVFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICBVLR
      *
      ***  Nominal value in Original Currency
      *
     C           EXNOMA    DIV  10        ICNVFX           (3dec --> 2 dec)
     C           EXNOMA    IFEQ *ZERO                                          MMI110
     C           EXLOTD    ANDNE'GLA'                                          MMI110
     C           EXAMNT    DIV  10        ICNVFX           (3dec --> 2 dec)    MMI110
     C                     ENDIF                                               MMI110
      *
      ***  Convert For Nominal value in Lira
      *
     C                     Z-ADDICNVFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICNVLR
      *
      ***  ACCRUED value in Original Currency
      *
     C           EXACCR    DIV  10        ICNEGC           (3dec --> 2 dec)
      *
      ***  Convert For ACCRUED value in Lira
      *
     C                     Z-ADDICNEGC    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICNEGL
      *
      ***  Market value  : Securities trading              (3dec --> 2 dec)
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
     C           EXLOTD    OREQ 'SEF'
     C           EXREAA    DIV  10        ICMVFX           Market value
      *
      ***  Convert For Nominal value in Lira
      *
     C                     Z-ADDICMVFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICMVLR
     C                     ENDIF
     C                     MOVELRTFIID    ICFIID           Fin. Instit.
      *
      ***  Doubfull code : For lending else Default
      *
     C           EXLOTD    IFEQ 'LEN'                      Loan
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     MOVE EXDBCD    ICDBCD           Doubfull  code
     C                     MOVE RTLNIT    ICGUTP                       de
     C                     ENDIF
      *don't setup         Z-ADD0         ICOCFX           Outstand. C.R. in CCy
      *don't setup         Z-ADD0         ICOCLR           Outst. C.R. in Lira
      *don't setup         MOVEL*BLANKS   ICAUTR           Audit trail.
     C                     MOVEL*BLANKS   ICAUTR           Audit trail.
      *
      ***  next sequence
      *
     C           WWSQCT    IFNE 999999
     C                     ADD  1         WWSQCT
     C                     ELSE
     C                     Z-ADD1         WWSQCT
     C                     ENDIF
     C                     Z-ADDWWSQCT    ICSQCT
      *
      *don't setup         Z-ADD0         ICISGA           Instit. sect. of GUA
      *FICS Derivated      Z-ADD0         ICZNCD           Zone Code A/B
      *
      ***  Forex Sale / Purchase according Lot descriptor else default (9)
      *
     C                     SELEC
     C           EXLOTD    WHEQ 'FXP'
     C                     Z-ADD1         ICFXSP
     C           EXLOTD    WHEQ 'FXS'
     C                     Z-ADD2         ICFXSP
     C                     ENDSL
      *
      ***  Debit/Credit indicator
      *
     C           EXDRCR    IFEQ 1
     C                     MOVEL'A'       ICCRDR
     C                     ELSE
     C                     MOVEL'D'       ICCRDR
     C                     ENDIF
      *
     C                     Z-ADDRTECBC    ICECBC           Econ. Branch class.
     C                     Z-ADDRTPRCT    ICPRCT           Provincia
      *
     C           EXLOTD    IFEQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C**********           Z-ADDRTTPPL    ICTPPL           Type of Pool LeMMI110
     C                     MOVELRTPEPR    WORK04  4                       MMI110
     C           WORK04    IFEQ '0144'                                    MMI110
     C                     MOVE RTPEPR    ICTPPL                          MMI110
     C                     END                                            MMI110
     C********** RTPVFX    IFNE 0                                         MMI110
     C**********           SELEC                           Decimal places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTPVFX    MULT 100       ICPVFX                          MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTPVFX    MULT 10        ICPVFX                          MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTPVFX    ICPVFX           Pool - Part. i MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTPVFX    DIV  10        ICPVFX                          MMI110
     C**********           ENDSL                                          MMI110
     C*                                                                   MMI110
     C* Participation sold amount                                         MMI110
     C*                                                                   MMI110
     C           EXMARA    DIV  10        ICPVFX                          MMI110
     C*
     C                     Z-ADDICPVFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICPFLR
     C*
     C                     SUB  ICPVFX    ICBVFX
     C                     Z-ADDICBVFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICBVLR
     C*                                                                   MMI117
     C* If an additional Part Sold amount entered on window, use it       MMI117
     C*                                                                   MMI117
     C           RTPSAM    MULT FACTOR    ICPSAM 160                      MMI117
     C                     ADD  ICPSAM    ICPVFX                          MMI117
     C                     Z-ADDICPVFX    INAMNT                          MMI117
     C                     EXSR CALCON                                    MMI117
     C                     Z-ADDOUTAMT    ICPFLR                          MMI117
     C*                                                                   197061
     C* Setup Unpaid Amount Indicator                                     197061
     C*                                                                   197061
     C                     Z-ADD0         ICUNAM                          197061
     C           EXCRET    IFEQ 2                                         197061
     C           EXCRET    OREQ 4                                         197061
     C                     Z-ADD1         ICUNAM                          197061
     C                     ENDIF                                          197061
     C***********          END                                            MMI110
     C                     END
      *
      ***  Subsidized Credit ind : for Loan input else default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTSBCR    ICSBCR
     C                     ENDIF
      *
      ***  Type of Underlying Value for Derived Contract : 'FRA','IRS'
      ***  Should be retrieved when Futures and options will be extracted.
      *
     C           EXLOTD    IFEQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C                     Z-ADDRTTPUV    ICTPUV
     C                     Z-ADDRTCVID    ICCVID
     C                     Z-ADDRTCVTP    ICCVTP
     C                     Z-ADDRTPATP    ICPRTP           Type of Participation
     C                     Z-ADD2         ICDTOP                          MMI032
     C                     Z-ADDRTSPRE    ICSPRE                          MMI032
     C                     ENDIF
      *
      ***  Issuer UIC country of location :
      ***  Issuer economic sector         :
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'CPO'
      *
      ***  Issuer Country of location is EXISLC
      *
     C           EXISLC    CHAINSDCTT1PD             99
     C           *IN99     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'602'     DBASE            ****************
     C                     MOVEL'SDCTT1PD'DBFILE           * DB ERROR 602 *
     C                     MOVELEXISLC    DBKEY            ****************
     C                     EXSR #DBERR
     C                     ENDIF
     C                     Z-ADDPEUCTR    ICISCC
      *
      ***  Issuer is EXCUST, then Economic sector is RTECSG
      *
     C                     Z-ADDRTECSG    ICISEC           Issuer Ec. Sector
     C                     ENDIF
     C*
     C* Average monthly balance (661 662 761 762)
     C*
     C           EXLOTD    IFEQ 'GLA'
     C           EXLOTD    OREQ 'LEN'                                     MMI110
     C           EXLOTD    OREQ 'PPU'                                     MMI110
     C           EXLOTD    OREQ 'PSO'                                     MMI110
     C*
      ***  Assets Average Book balance (2 dec) : 'GLA'
     C                     Z-ADDRTAAFX    ICAAFX           761
     C*
     C***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICAAFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICAALR           661
      *
      ***  Liabilities Average Book balance (2 dec) : 'GLA'
      *
     C                     Z-ADDRTLAFX    ICLAFX           762
     C***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICLAFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICLALR           662
      *                                                                   MBV006
      * Setup Puma field 5008 according to window field 'Scaduto Dal'     MBV006
      *                                                                   MBV006
     C                     MOVE '000'     ICLSTP                          MBV006
     C           RTUNDT    IFGT *ZERO                                     MBV006
     C           RTUNDT    ANDLTXXENDQ                                    MBV006
     C           EXLOTD    ANDNE'GLA'                                     MBV006
     C           XXENDQ    SUB  RTUNDT    NBRDYS  50                      MBV006
     C           NBRDYS    IFGT 90                                        MBV006
     C                     MOVE '001'     ICLSTP                          MBV006
     C                     ENDIF                                          MBV006
     C           NBRDYS    IFGT 180                                       MBV006
     C                     MOVE '002'     ICLSTP                          MBV006
     C                     ENDIF                                          MBV006
     C                     ENDIF                                          MBV006
      *
     C                     END                                      MMI032AG0001
      **********                                                          MMI110
      *****Movements Amounts (2dec)                                       MMI110
      **********                                                          MMI110
     C********** EXLOTD    IFEQ 'GLA'                                     MMI110
     C**********           Z-ADDRTPMVD    ICPMVD           NB mvts Debit  MMI110
     C**********           Z-ADDRTPMVC    ICPMVC           NB mvts Credit MMI110
     C**********           SELEC                           Ccy dec places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTPNCD    MULT 100       ICPNCD           Not Cap Debit  MMI110
     C********** RTPNCC    MULT 100       ICPNCC           Not Cap Credit MMI110
     C********** RTPCPD    MULT 100       ICPCPD           Cap Debit      MMI110
     C********** RTPCPC    MULT 100       ICPCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTPNCD    MULT 10        ICPNCD           Not Cap Debit  MMI110
     C********** RTPNCC    MULT 10        ICPNCC           Not Cap Credit MMI110
     C********** RTPCPD    MULT 10        ICPCPD           Cap Debit      MMI110
     C********** RTPCPC    MULT 10        ICPCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTPNCD    ICPNCD           Not Cap Debit  MMI110
     C**********           Z-ADDRTPNCC    ICPNCC           Not Cap Credit MMI110
     C**********           Z-ADDRTPCPD    ICPCPD           Cap Debit      MMI110
     C**********           Z-ADDRTPCPC    ICPCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTPNCD    DIV  10        ICPNCD           Not Cap Debit  MMI110
     C********** RTPNCC    DIV  10        ICPNCC           Not Cap Credit MMI110
     C********** RTPCPD    DIV  10        ICPCPD           Cap Debit      MMI110
     C********** RTPCPC    DIV  10        ICPCPC           Cap Credit     MMI110
     C**********           ENDSL                                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTQMVD    ICQMVD           NB mvts Debit  MMI110
     C**********           Z-ADDRTQMVC    ICQMVC           NB mvts Credit MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTQNCD    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICQNCD                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTQNCC    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICQNCC                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTQCPD    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICQCPD                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTQCPC    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICQCPC                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTYMVD    ICYMVD           NB mvts Debit  MMI110
     C**********           Z-ADDRTYMVC    ICYMVC           NB mvts Credit MMI110
     C**********           SELEC                           Ccy dec places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTYNCD    MULT 100       ICYNCD           Not Cap Debit  MMI110
     C********** RTYNCC    MULT 100       ICYNCC           Not Cap Credit MMI110
     C********** RTYCPD    MULT 100       ICYCPD           Cap Debit      MMI110
     C********** RTYCPC    MULT 100       ICYCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTYNCD    MULT 10        ICYNCD           Not Cap Debit  MMI110
     C********** RTYNCC    MULT 10        ICYNCC           Not Cap Credit MMI110
     C********** RTYCPD    MULT 10        ICYCPD           Cap Debit      MMI110
     C********** RTYCPC    MULT 10        ICYCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTYNCD    ICYNCD           Not Cap Debit  MMI110
     C**********           Z-ADDRTYNCC    ICYNCC           Not Cap Credit MMI110
     C**********           Z-ADDRTYCPD    ICYCPD           Cap Debit      MMI110
     C**********           Z-ADDRTYCPC    ICYCPC           Cap Credit     MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTYNCD    DIV  10        ICYNCD           Not Cap Debit  MMI110
     C********** RTYNCC    DIV  10        ICYNCC           Not Cap Credit MMI110
     C********** RTYCPD    DIV  10        ICYCPD           Cap Debit      MMI110
     C********** RTYCPC    DIV  10        ICYCPC           Cap Credit     MMI110
     C**********           ENDSL                                          MMI110
     C**********           ENDIF                                          MMI110
      *
      ***  Interest subsidized : Dealing or Lending else Default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C********** EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C********** EXLOTD    OREQ 'FRA'
     C********** EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTINSB    ICINSB
     C                     ENDIF
      *
      ***  Private banking on behalf of customer
      *
     C                     SELEC
     C           EXCLAS    WHEQ 'D'
     C                     Z-ADD1         ICPBCU
     C           EXCLAS    WHEQ 'S'
     C                     Z-ADD2         ICPBCU
     C                     OTHER
     C                     Z-ADD0         ICPBCU           Default
     C                     ENDSL
      *
      ***  Credit line type : Facility else Default
      ***  Stand-by Credit line ind. : Facility else Default
      *
     C           EXLOTD    IFEQ 'FCL'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     CALL 'ERIT66'
     C                     PARM           EXFCUS           Input
     C                     PARM           EXFACT           Input
     C                     PARM           EXFCNO           Input
     C*********            PARM *ZERO     ICSBCL  10       Output
     C*********            PARM ' '       ICLNTP  1        Output
     C                     PARM *ZERO     ICSBCL           Output
     C                     PARM ' '       ICLNTP           Output
     C                     PARM *BLANKS   ICLKCD 24        Output
     C                     PARM *BLANKS   ICDECD  3        Output
     C                     PARM *ZERO     ICLNSC  10       Output
     C                     PARM           ICEXPO 130       Output         MMI117
     C                     PARM *BLANKS   RTPOPT  1        Output         MBV006
     C                     PARM *BLANKS   ERROR   1        Return
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C                     ENDIF
      *
      ***  Facility type indicator : 'FCL'
     C           EXLOTD    IFEQ 'FCL'
      *                                                                                       LUC143
      ** Unicredit change: set FT to 9541.10 for Pool Facilities                              LUC143
      *                                                                                       LUC143
     C           EXLEVL    IFEQ 'L'                                                           LUC143
     C                     Z-ADD954110    ICLINI                                              LUC143
     C                     ENDIF                                                              LUC143
      *                                                                                       LUC143
     C           EXLEVL    IFEQ *BLANKS                                                       LUC143
     C           ICEXPO    ANDNE*ZERO                                                         LUC143
     C           RTPOPT    IFEQ '1'                                                           LUC143
     C           RTPOPT    OREQ '3'                                                           LUC143
     C                     Z-ADD954110    ICLINI                                              LUC143
     C                     ENDIF                                                              LUC143
     C                     ENDIF                                                              LUC143
      *                                                                   LUC139
      * FM Upgrade: the value of FCTI is stored in EXTRIN                 LUC139
      *                                                                   LUC139
     C                     MOVE EXTRIN    EXFCTI  1                       LUC139
      *                                                                   MBV006
     C                     MOVE RTPOPT    ICPOPT                          MBV006
      *
     C           EXFCTI    IFEQ 'C'                        Confirmed or
     C           EXFCTI    OREQ 'F'                        Committed
     C                     Z-ADD1         ICCLTP           Irrevocable
     C                     ENDIF
      *
     C           EXFCTI    IFEQ 'G'                        Guidance
     C                     Z-ADD0         ICCLTP           revocable
     C                     ENDIF
      *                                                                   MMI117
      *                                                                   MMI117
      * Granted amount from other pool participants                       MMI117
      *                                                                   MMI117
     C           ICEXPO    MULT FACTOR    INAMNT                          MMI117
     C                     EXSR CALCON                                    MMI117
     C                     Z-ADDOUTAMT    ICAUXC                          MMI117
      *
     C                     ENDIF
      *
      *** Third party Fund operation : Dealing or Lending
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTTPFD    ICTPFD
     C                     ENDIF
      *
      ***  Backup Facility indicator : Securities Trading
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
     C                     Z-ADDRTBUFC    ICBUFC
     C                     ENDIF
      *
      ***  Residence Digit : Counterparty Country code = Internal Ctry Code
      ***  REM : Securities Trading : EXCUCC is SCOR (Country of Risf of SECTYD)
      *
     C           EXCUCC    IFEQ VDICCD                     Internal Ctry code
     C                     Z-ADD1         ICRSDG           Resident
     C                     ELSE
     C                     Z-ADD2         ICRSDG           Foreigner
     C                     ENDIF
      *
      ***  Currency digit : Currency code = Internal currency code
      *
     C           EXCCYC    IFEQ VDCCYC                     Internal Ccy code
     C                     Z-ADD1         ICCYDG           Lira
     C                     ADD  10000     ICSECT
     C                     ELSE
     C                     Z-ADD2         ICCYDG           Other Currency
     C                     ADD  20000     ICSECT
     C                     ENDIF
     C                     Z-ADDRTORSP    ICORSP           Loc Orgn. Info Sporte
     C                     Z-ADDRTORPR    ICORPR                    Info Provin.
     C                     Z-ADDRTORPA    ICORPA                    Info Paese
     C                     Z-ADDRTCNTP    ICCNTP           Cprty type
     C                     Z-ADD0         ICMARK                          MMI032
      *
      ***  Type of Product : Dealing or Lending Else Default
      ***  HELP : TPPR should be calculated : Where? How?
      ***  Pers. of Product : Dealing or Lending Else Default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTTPPR    ICTPPR
     C***********          Z-ADDRTPEPR    ICPEPR                          MMI032
     C                     MOVELRTPEPR    ICLNIT                          MMI032
     C                     ENDIF
      *
      ***  Global/partial Code : Dealing or Lending Else Default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTGLPA    ICGLPA
     C                     ENDIF
      **********                                                          MMI110
      *****Assets Average Book balance (2 dec)                            MMI110
      **********                                                          MMI110
     C********** EXLOTD    IFNE 'GLA'                                     MMI110
     C**********                                                          MMI110
     C**********           SELEC                           Decimal places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTAAFX    MULT 100       ICAAFX                          MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTAAFX    MULT 10        ICAAFX                          MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTAAFX    ICAAFX                          MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTAAFX    DIV  10        ICAAFX                          MMI110
     C**********           ENDSL                                          MMI110
     C**********                                                          MMI110
     C*****Convert From Original Ccy in Lira                              MMI110
      **********                                                          MMI110
     C**********           Z-ADDICAAFX    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICAALR           661            MMI110
      **********                                                          MMI110
      *****Liabilities Average Book balance (2 dec) :                     MMI110
      **********                                                          MMI110
     C**********           SELEC                           Decimal places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTLAFX    MULT 100       ICLAFX                          MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTLAFX    MULT 10        ICLAFX                          MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTLAFX    ICLAFX                          MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTLAFX    DIV  10        ICLAFX                          MMI110
     C**********           ENDSL                                          MMI110
      **********                                                          MMI110
     C**********           Z-ADDRTLAFX    ICLAFX           762            MMI110
      **********                                                          MMI110
      *****Convert From Original Ccy in Lira                              MMI110
      **********                                                          MMI110
     C**********           Z-ADDICLAFX    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICLALR           662            MMI110
     C**********           END                                            MMI110
      *
     C           EXLOTD    IFEQ 'MMD'                      -----]
     C           EXLOTD    OREQ 'NAP'                           ]         MMI100
     C********** EXLOTD    OREQ 'LEN'                           ]         MMI100
     C           EXLOTD    OREQ 'SEF'                           ]
     C********** EXLOTD    OREQ 'SEC'                           ]         MMI100
     C                     Z-ADD0         ICAAFX
     C                     Z-ADD0         ICAALR
     C                     Z-ADD0         ICLAFX
     C                     Z-ADD0         ICLALR
     C                     Z-ADD0         $AMNT  160            ]
     C                     Z-ADD0         $AMNT1 162            ]
     C                     Z-ADD$DDP      $DDPE   20            ]
     C           EXENDD    IFGE XYSTRP                     ---] ]
     C                     Z-ADD0         $DD     20            ]
     C*                                                         ]
     C           EXENDD    IFLE XYENDP                     ---] ]
     C                     Z-ADDEXENDD    $IDAT             ] ] ]
     C                     ELSE                            -] ] ]
     C                     Z-ADDXYENDP    $IDAT             ] ] ]
     C                     END                             -] ] ]
     C                     EXSR CALDAT
     C                     Z-ADD$ODAT     $ENDD   50
     C*                                                         ]
     C           EXSTRD    IFLE XYSTRP                     ---] ]
     C                     Z-ADDXYSTRP    $IDAT             ] ] ]
     C                     ELSE                            -] ] ]
     C                     Z-ADDEXSTRD    $IDAT             ] ] ]
     C                     END                             -] ] ]
     C                     EXSR CALDAT
     C                     Z-ADD$ODAT     $STRD   50
     C                     Z-ADD$ENDD     $$FIL  150
     C                     SUB  $STRD     $$FIL
     C           EXENDD    IFGT XYENDP                     ---] ]
     C                     ADD  1         $$FIL
     C                     END
     C           ICBVLR    MULT $$FIL     $AMNT                 ]
     C                     DIV  $DDP      $AMNT                 ]
     C*                                                         ]
     C           ICBVFX    MULT $$FIL     $AMNT1                ]
     C                     DIV  $DDP      $AMNT1                ]
     C           EXDRCR    IFEQ 1                          -]   ]
     C                     Z-ADD$AMNT     ICLALR            ]662]
     C                     ELSE                             ]   ]
     C                     Z-ADD$AMNT     ICAALR            ]661]
     C                     ENDIF                           -]   ]
     C           EXDRCR    IFEQ 1                          -]   ]
     C                     Z-ADD$AMNT1    ICLAFX            ]762]
     C                     ELSE                             ]   ]
     C                     Z-ADD$AMNT1    ICAAFX            ]761]
     C                     ENDIF                           -]   ]
     C                     ENDIF                           -]   ]
      *
     C           EXLOTD    IFEQ 'SEC'                      -----]
     C                     Z-ADD0         ICAAFX
     C                     Z-ADD0         ICAALR
     C                     Z-ADD0         ICLAFX
     C                     Z-ADD0         ICLALR
     C                     Z-ADD0         $AMNT  160            ]
     C                     Z-ADD0         $AMNT1 162            ]
     C                     Z-ADD$DDP      $DDPE   20            ]
     C           EXRISA    DIV  10        EXRISA           ---] ]
     C           EXDRCR    IFEQ 0                          ---] ]
     C                     MOVE EXRISA    ICAAFX           761
      *
      ***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICAAFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICAALR           661
      *
     C                     ELSE
     C                     MOVE EXRISA    ICLAFX           762
      *
      ***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICLAFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICLALR           662
      *
     C                     END                                      MMI032AG0001
      *                                                             MMI032AG0001
     C                     END                                      MMI032AG0001
      *                                                             MMI032AG0001
     C                     Z-ADD0         $AMNT  160            ]
     C                     Z-ADD0         $$FIL1 150            ]
     C                     Z-ADDEXENDD    $IDAT   80
     C                     EXSR CALDAT
     C                     Z-ADD$ODAT     $ENDD   50
     C                     Z-ADDEXSTRD    $IDAT   80
     C                     EXSR CALDAT
     C                     Z-ADD$ODAT     $STRD   50
     C           $ENDD     IFLE XXENDQ                     ---] ]
     C                     Z-ADD$ENDD     $$FIL
     C                     ELSE
     C                     Z-ADDXXENDQ    $$FIL
     C                     END
     C           $STRD     IFLE XXSTRY                     ---] ]
     C                     Z-ADDXXSTRY    $$FIL1
     C                     ELSE
     C                     Z-ADD$STRD     $$FIL1
     C                     END
     C                     SUB  $$FIL1    $$FIL
     C           EXENDD    IFGT XYENDP                     ---] ]
     C                     ADD  1         $$FIL
     C                     END
     C           ICBVLR    MULT $$FIL     $AMNT                 ]
     C                     DIV  100       $AMNT                 ]
     C*                                                         ]
     C           EXDRCR    IFEQ 0                          -]   ]
     C           $ENDD     IFLE XXENDQ
     C                     Z-ADD$AMNT     ICCPDL            ]614]
     C                     ELSE                             ]   ]
     C                     Z-ADD$AMNT     ICNCDL            ]612]
     C                     END                              ]   ]
     C                     ELSE
     C           $ENDD     IFLE XXENDQ
     C                     Z-ADD$AMNT     ICCPCL            ]615]
     C                     ELSE                             ]   ]
     C                     Z-ADD$AMNT     ICNCCL            ]613]
     C                     END                              ]   ]
     C                     ENDIF                           -]   ]
     C                     END                             -----]
     C*
     C***********EXLOTD    IFEQ 'FRA'                                     MMI110
     C***********EXLOTD    OREQ 'IRS'                                     MMI110
     C***********EXLOTD    OREQ 'FCL'                                     MMI110
     C***********EXLOTD    OREQ 'MMD'                                     MMI110
     C***********EXLOTD    OREQ 'NAP'                                     MMI100
     C***********EXLOTD    OREQ 'SEF'                                     MMI110
     C***********EXLOTD    OREQ 'SEC'                                     MMI110
     C***********EXLOTD    OREQ 'FXP'                                     MMI110
     C***********EXLOTD    OREQ 'FXS'                                     MMI110
     C*                                                                   MMI110
     C           ICENDD    IFGT ICSTRD                                    MMI110
     C           ICSTRD    ANDNE0                                         MMI110
     C*                                                                   AG0001
     C                     MOVELICSTRD    WSTRDT                          AG0001
     C**********           MOVELICENDD    WENDDT                    AG0001MMI100
     C                     MOVELICENDD    WENDAT                          MMI100
      *
     C           WMONT2    IFLT WMONT1
     C                     ADD  12        WMONT2
     C                     SUB  1         WYEAR2
     C                     ENDIF
      *
     C           WMONT2    SUB  WMONT1    WMONTH  30
     C           WYEAR2    SUB  WYEAR1    WYEAR   30
     C                     MULT 12        WYEAR
     C                     ADD  WYEAR     WMONTH
      *                                                                   200160
     C           WDAYS1    IFLT WDAYS2                                    200160
     C                     ADD  1         WMONTH                          200160
     C                     ENDIF                                          200160
      *                                                                   200160
     C                     Z-ADDWMONTH    ICNUMO
     C***********          Z-ADDWMONTH    RTNUMO                    MMI100MMI110
     C                     ENDIF                                          MMI110
      *
     C           ICNUMO    IFLE 18
     C***********          Z-ADD1         RTIDUR                          MMI110
     C                     Z-ADD1         ICIDUR                          MMI110
     C                     ELSE                                           MMI110
     C                     Z-ADD2         ICIDUR                          MMI110
     C                     ENDIF
     C***********                                                         MMI110
     C***********ICNUMO    IFGT 18                                        MMI110
     C***********          Z-ADD1         RTIDUR                          MMI110
     C***********          ENDIF                                          MMI110
      *
     C                     Z-ADDEXREVD    ICYDAT                          MMI032
     C***********                                                         AG0001
     C***********          ENDIF                                          MMI110
      *
      ***  Assets Cleared balance (2 dec) : 'GLA'
      ***  or Liabilities cleared balance : Depending of RTCLAC
      *
     C                     Z-ADDRTACFX    ICACFX           765
      *
     C                     Z-ADDICACFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICACLR           665
      *
     C                     Z-ADDRTLCFX    ICLCFX           766
      *
     C                     Z-ADDICLCFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICLCLR           666
      **********                                                          MMI110
     C********** EXLOTD    IFEQ 'GLA'                                     MMI110
     C**********                                                          MMI110
     C**********           Z-ADD0         ICACLR           665            MMI110
     C**********           Z-ADD0         ICLCLR           666            MMI110
     C**********           Z-ADD0         ICACFX           765            MMI110
     C**********           Z-ADD0         ICLCFX           766            MMI110
     C**********                                                          MMI110
     C********** EXNOMA    IFLT 0                                         MMI110
     C********** EXNOMA    DIV  10        ICLCFX                          MMI110
     C**********           MULT -1        ICLCFX                          MMI110
     C**********                                                          MMI110
     C*****Convert From Original Ccy in Lira  (Assets Cleared balance)    MMI110
     C**********                                                          MMI110
     C**********           Z-ADDICLCFX    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICLCLR                          MMI110
      **********                                                          MMI110
     C**********           ELSE                                           MMI110
      **********                                                          MMI110
     C********** EXNOMA    DIV  10        ICACFX                          MMI110
     C**********           Z-ADDICACFX    INAMNT                          MMI110
     C**********           EXSR CALCON                                    MMI110
     C**********           Z-ADDOUTAMT    ICACLR                          MMI110
      **********                                                          MMI110
     C**********           END                                            MMI110
     C**********           END                                            MMI110
      *
      ***  Assets Average Cleared balance (2 dec) : 'GLA'
      *
     C                     Z-ADDRTAACF    ICAACF           763
      ***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICAACF    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICAACL           663
      *
      ***  Liabilities Average Cleared balance (2 dec) : 'GLA'
      *
     C                     Z-ADDRTLACF    ICLACF           764
     C***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICLACF    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICLACL           664
      *
     C                     Z-ADDRTFSCD    ICFSCD           Fiscal Code
      *
      * Numbers
      *
     C           EXLOTD    IFEQ 'GLA'
     C           EXLOTD    OREQ 'LEN'                                     MMI110
     C           EXLOTD    OREQ 'PPU'                                     MMI110
     C           EXLOTD    OREQ 'PSO'                                     MMI110
     C**********           Z-ADDRTNCDF    ICNCDL                          MMI110
     C**********           Z-ADDRTCPDF    ICCPDL                          MMI110
     C**********           Z-ADDRTNCCF    ICNCCL                          MMI110
     C**********           Z-ADDRTCPCF    ICCPCL                          MMI110
      *                                                                   MMI110
     C                     Z-ADDRTNCDF    INAMNT                          MMI110
     C                     EXSR CALCON                                    MMI110
     C           OUTAMT    DIV  100       ICNCDL    H      612            MMI110
      *                                                                   MMI110
     C                     Z-ADDRTNCCF    INAMNT                          MMI110
     C                     EXSR CALCON                                    MMI110
     C           OUTAMT    DIV  100       ICNCCL    H      613            MMI110
      *                                                                   MMI110
     C                     Z-ADDRTCPDF    INAMNT                          MMI110
     C                     EXSR CALCON                                    MMI110
     C           OUTAMT    DIV  100       ICCPDL    H      614            MMI110
      *                                                                   MMI110
     C                     Z-ADDRTCPCF    INAMNT                          MMI110
     C                     EXSR CALCON                                    MMI110
     C           OUTAMT    DIV  100       ICCPCL    H      615            MMI110
      *                                                                   MMI110
     C**********           Z-ADDRTNBOP    ICNBOP                          MMI110
     C                     ENDIF
      *
      ***  Untied operation : 'SEF'
      *
     C                     Z-ADD0         ICUNOP           Default
     C           EXLOTD    IFEQ 'SEF'                      Forward trade
     C                     Z-ADD1         ICUNOP
     C                     ENDIF
      *
      ***  Capital Amount (doubfull) : Lending
      ***  Interest Amount (doubfull) : Lending
      *
     C           EXLOTD    IFEQ 'LEN'
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
      *
     C*****      EXCADF    DIV  10        ICCDFX           3 dec --> 2 dec                    LUC139
     C*****      EXIADF    DIV  10        ICIDFX           3 dec --> 2 dec                    LUC139
      *
      ***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICCDFX    INAMNT           Past due Amount
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICCDLR
      *
     C                     Z-ADDICIDFX    INAMNT           Interest due amount
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICIDLR
     C                     ENDIF
      *
     C                     Z-ADD0         ICGTTE                          MMI032
     C                     Z-ADD0         ICGTOR                          MMI032
     C                     Z-ADD0         ICCREQ                          MMI032
      *
      ***  Net profit Amount : FRA/IRS or FXS/FXP
      *
     C           EXLOTD    IFEQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
      *
     C                     Z-ADD0         ICNPFX
      *
     C           EXLOTD    IFEQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
      *
      ***  Take Unrealised profit and Loss amount
      *
     C           EXNPVA    DIV  10        ICNPFX           (3 dec --> 2 dec)
     C                     ELSE
      *
      ***   Need more details to Calculate
      *
     C                     ENDIF
      *
      ***  Convert From Original Ccy in Lira
      *
     C                     Z-ADDICNPFX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICNPLR
     C***********          MOVE *BLANKS   ICLSTP                    MMI032MBV006
     C                     MOVE *BLANKS   ICCECT                          MMI032
     C                     Z-ADD0         ICOPFI                          MMI032
     C                     MOVE *BLANKS   ICCPNO                          MMI032
      *
     C                     ENDIF
      *
      *** Matured Capital without Penalties : Lending --> EXMPRA
      *** Matured Capital with Penalties : Lending : not supported by MIDAS
      *** Matured unpaid Capital : Lending --> EXMUPR
      *** Interest on Matured Unpaid Capital :  --> EXIMUP
      *** Interest on Matured Capital Without penalties :  --> EXIMAM
      *** Interest on Matured Unpaid Capital With penalties :  Not in MIDAS
      *
     C********** EXLOTD    IFEQ 'LEN'
     C********** EXLOTD    OREQ 'PPU'
     C           EXLOTD    IFEQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C*****      EXMPRA    DIV  10        ICCPNP           3 dec --> 2 dec                    LUC139
      *                    Z-ADD0         ICCPPE
     C*****      EXMUPR    DIV  10        ICCPUP           3 dec --> 2 dec                    LUC139
     C*****      EXIMUP    DIV  10        ICICUP           3 dec --> 2 dec                    LUC139
     C*****      EXIMAM    DIV  10        ICICNP           3 dec --> 2 dec                    LUC139
      *                    Z-ADD0         ICICPE
     C                     ENDIF
      *
      ***  Credit movements on SE accounts Mature or extracted : 'GLA'
      ***  Credit movements on SE accounts not matur. or extract. : 'GLA'
      ***  Debit Movements on SE accounts : 'GLA'
      ***  Amounts with 2 decimal places
      *
     C********** EXLOTD    IFEQ 'GLA'                                     MMI110
     C**********           SELEC                           Decimal Places MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** RTMTCR    MULT 100       ICMTCR                          MMI110
     C********** RTNMCR    MULT 100       ICNMCR                          MMI110
     C***********RTMVDR    MULT 100       ICMVDR                          MMI032
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** RTMTCR    MULT 10        ICMTCR                          MMI110
     C********** RTNMCR    MULT 10        ICNMCR                          MMI110
     C***********RTMVDR    MULT 10        ICMVDR                          MMI032
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDRTMTCR    ICMTCR                          MMI110
     C**********           Z-ADDRTNMCR    ICNMCR                          MMI110
     C***********          Z-ADDRTMVDR    ICMVDR                          MMI032
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** RTMTCR    DIV  10        ICMTCR                          MMI110
     C********** RTNMCR    DIV  10        ICNMCR                          MMI110
     C***********RTMVDR    DIV  10        ICMVDR                          MMI032
     C**********           ENDSL                                          MMI110
     C***********          Z-ADDRTLSTM    ICLSTM                          MMI110
     C**********           ENDIF                                          MMI110
     C**********           Z-ADD0         ICGOLD                          MMI032
     C**********           Z-ADD0         ICOTHR                    MMI032206990
     C                     Z-ADD2         ICOTHR                    MMI032206990
     C**********           Z-ADD0         ICCCCI                          MMI032
     C**********           Z-ADD0         ICACTV                          MMI032
     C**********           Z-ADD0         ICCCRE                          MMI032
     C**********           Z-ADD0         ICCCLM                          MMI032
     C**********           Z-ADD0         ICACLK                          MMI032
      *
     C           EXLOTD    IFEQ 'FCL'
     C           EXLOTD    OREQ 'LEN'
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
      *
      ***  ICLNNB = EXFCUS + EXFACT + EXFCNO
      *
     C                     MOVE EXFACT    WWFACT  3
     C                     MOVE EXFCNO    WWFCNO  2
     C           EXFCUS    CAT  WWFACT:0  ICLNNB    P      CR line number
     C           ICLNNB    CAT  WWFCNO:0  ICLNNB           CR line number
     C                     Z-ADD0         ICCCAC                          MMI032
     C                     Z-ADD0         ICFMAR                          MMI032
     C                     Z-ADD0         ICENCR                          MMI032
     C           EXRCSI    IFEQ 'Y'                                       MMI117
     C                     Z-ADD1         ICENCR                          MMI117
     C                     ENDIF                                          MMI117
     C                     MOVE *BLANKS   ICPOLK                          MMI032
     C                     MOVE *BLANKS   ICTPLK                          MMI032
     C                     Z-ADD0         ICLRSK                          MMI032
     C                     Z-ADD0         ICCRSK                          MMI032
     C                     MOVE *BLANKS   ICISSS                          MMI032
     C                     MOVE *BLANKS   ICRESE                          MMI032
     C                     Z-ADD0         ICMAT1                          MMI032
      *
      ***  ICILNB : Internal credit line number : EXFACT + EXFCNO +*zero
     C                     Z-ADD0         DSILNB
     C                     Z-ADDEXFACT    DSFACT
     C                     Z-ADDEXFCNO    DSFCNO
     C                     ENDIF                           Facility
      *
     C                     Z-ADD0         ICMAT2                          MMI032
     C                     Z-ADD0         ICMAT3                          MMI032
     C                     Z-ADDEXREVD    ICYDAT                          MMI032
     C                     Z-ADD0         ICRMAT                          MMI032
     C                     MOVE *BLANKS   ICPRVC                          MMI032
     C                     MOVE *BLANKS   ICAREA                          MMI032
     C                     MOVE *BLANKS   ICCATS                          MMI032
     C                     Z-ADD0         ICRTTY                          MMI032
     C                     Z-ADD0         ICAMTP                          MMI032
     C                     Z-ADD0         ICSHTP                          MMI032
     C                     Z-ADD0         ICCUAM                          MMI032
     C                     Z-ADD0         ICCCTY                          MMI032
     C                     MOVE *BLANKS   ICCAIM                          MMI032
     C                     MOVE *BLANKS   ICSUBS                          MMI032
     C                     MOVE *BLANKS   ICSETS                          MMI032
     C                     MOVE *BLANKS   ICINTP                          MMI032
     C                     MOVE *BLANKS   ICMRTP                          MMI032
     C                     MOVE *BLANKS   ICCARD                          MMI032
     C                     MOVE '0'       ICREAR                          MMI032
     C                     Z-ADD0         ICUNSL                          MMI032
     C                     Z-ADD0         ICUNSC                          MMI032
     C                     Z-ADD0         ICCDAT                          MMI032
     C                     MOVELEXCUST    ICCUST           Client Intern. Custom
      *
      ***  Reference date is Reporting date
      *
     C                     MOVE D7DAY     D6DAY            DD
     C                     Z-ADDDATE06    ZDATE            DDMMYY
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    @@DAYN  50
     C                     EXSR ZDATE9
     C           @@RTN     IFNE '1'
     C                     Z-ADD@@VDT     ICRFDT           Reference date
     C                     ENDIF
     C                     MOVE *BLANKS   ICRSKT                          MMI032
     C                     MOVE *BLANKS   ICPSTP                          MMI032
     C                     Z-ADD0         ICS117                          MMI032
     C                     Z-ADD0         ICSETP                          MMI032
     C                     Z-ADD0         ICNOPA                          MMI032
     C                     Z-ADD0         ICAMPA                          MMI032
     C                     Z-ADD0         ICOPCC                          MMI032
     C                     Z-ADD0         ICFRCC                          MMI032
     C**********           Z-ADD0         ICAUXC                    MMI032MMI117
     C                     Z-ADD0         ICLKTI                          MMI032
     C                     Z-ADD0         ICTILI                          MMI032
     C                     Z-ADD0         ICTICY                          MMI032
     C                     Z-ADD0         ICINLK                          MMI032
     C                     Z-ADD0         ICTEOD                          MMI032
     C                     Z-ADD0         ICUINC                          MMI032
     C                     Z-ADD0         ICCOIP                          MMI032
     C                     Z-ADD0         ICSPFW                          MMI032
     C**********           Z-ADD0         ICNEGC                          MMI032
     C                     MOVE *BLANKS   ICREOP                          MMI032
     C                     Z-ADD0         ICTPPO                          MMI032
     C                     MOVE *BLANKS   ICTPCO                          MMI032
     C                     Z-ADD0         ICOPDT                          MMI032
     C                     Z-ADD0         ICAUXL                          MMI032
     C                     Z-ADD0         ICPRIC                          MMI032
     C                     Z-ADDRTCPPT    ICCPPA           Cprty participation
      *
      *** Type of Contract
      *
     C           EXLOTD    IFEQ 'FRA'
     C                     MOVEL'22'      ICTPCO
     C                     ENDIF
      *
     C           EXLOTD    IFEQ 'IRS'
     C*********
     C*********  EXIRTT    IFEQ 0
     C*********            MOVEL'21'      ICTPCO
     C*********            ELSE
     C*********            MOVEL'26'      ICTPCO
     C*********            ENDIF
     C           EXIRTT    IFEQ 1
     C                     MOVEL'21'      ICTPCO
     C                     ENDIF
     C           EXIRTT    IFEQ 3
     C                     MOVEL'23'      ICTPCO
     C                     ENDIF
     C           EXIRTT    IFEQ 4
     C                     MOVEL'24'      ICTPCO
     C                     ENDIF
     C           EXIRTT    IFEQ 6
     C                     MOVEL'26'      ICTPCO
     C                     ENDIF
     C                     ENDIF
      *                                                                   214826
     C           EXLOTD    IFEQ 'FTR'                                     214826
     C           EXLOTD    OREQ 'OPT'                                     214826
     C                     MOVEL'28'      ICTPCO                          214826
     C                     ENDIF                                          214826
      *
      *** Security immobilisation : 'SEC'
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C                     Z-ADDRTSEIM    ICSEIM
     C                     ENDIF
      *
      ***  Security code gathering : Securities Trading
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
     C                     MOVELRTSEGA    ICSEGA
     C                     ENDIF
      ***  Forward Trades : complementary amounts
      *
     C           EXLOTD    IFEQ 'SEF'
     C           EXPREA    DIV  10        ICPRIC           (3dec --> 2 dec)
      *
      ***  Convert fUTURE EXPOSITION
      *
     C                     Z-ADDICPRIC    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICAGPR
      *
     C                     ENDIF
     C                     Z-ADDRTCPAC    ICCPAC           Complem. Accounting
      *
      ***  Law for subsidized Credit code : Loans else blanks
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     MOVELRTSBLW    ICSBLW
     C                     ENDIF
      *
      ***  Convention code of CD's emission : NAP and CD product else default
      ***  HELP : Processing ?
     C           EXLOTD    IFEQ 'NAP'
     C                     MOVELEXDECK    WWDLTP  2        Deal type
     C           WWDLTP    IFEQ 'C1'                       CD's Products
     C           WWDLTP    OREQ 'C2'
     C           WWDLTP    OREQ 'CS'
      *
      ***  ICJRRG : take day of EXSTRD
      *
     C                     MOVE WDAY      ICJRRG           Day in mnth of trans.
     C                     ENDIF                           Product 'CD'
     C                     ENDIF                           NAP
      *
     C           EXLOTD    IFEQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
      *
     C                     Z-ADDRTUCCY    SAVCCY  30                      189360
     C                     CALL 'ERIT73'                           MMI075
     C                     PARM           EXCCY2           Input   MMI075
     C                     PARM *ZERO     RTUCCY  30       Output  MMI075
     C                     PARM *BLANKS   ERROR   1        Return  MMI075
     C                     Z-ADDRTUCCY    ICRDUR           UIC CCY2MMI075
     C                     Z-ADDSAVCCY    RTUCCY                          189360
     C*
     C                     SELEC                           Decimal places
     C           CCNBDP    WHEQ 0
     C           RTCTVL    MULT 100       ICCTVL
     C           CCNBDP    WHEQ 1
     C           RTCTVL    MULT 10        ICCTVL
     C           CCNBDP    WHEQ 2
     C                     Z-ADDRTCTVL    ICCTVL                       MMI032
     C           CCNBDP    WHEQ 3
     C           RTCTVL    DIV  10        ICCTVL
     C                     ENDSL
     C*
     C                     ENDIF
      *
      *** Destination province of investment : Loans else default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     Z-ADDRTDPIV    ICDPIV
     C                     ENDIF
      *FICS Derivated      Z-ADD0         ICLKCU           Linked Cli. Intern. N
      *                                                                   MMI117
      * Store seller of parts sold                                        MMI117
      *                                                                   MMI117
     C           EXLOTD    IFEQ 'PPU'                                     MMI117
     C           EXLOTD    OREQ 'NAP'                                     MMI117
     C                     MOVELEXFINR    ICLKCU    P                     MMI117
     C                     ENDIF                                          MMI117
      *
      *** Economic Destination of Investment : Loans else default
      *
     C           EXLOTD    IFEQ 'MMD'                      Dealing
     C           EXLOTD    OREQ 'NAP'
     C           EXLOTD    OREQ 'FXP'
     C           EXLOTD    OREQ 'FXS'
     C           EXLOTD    OREQ 'FRA'
     C           EXLOTD    OREQ 'IRS'
     C           EXLOTD    OREQ 'LEN'                      Lending
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C                     MOVELRTEDIV    ICEDIV
     C                     ENDIF
      *
      ***  Issuer category : Securities Trading
      *
     C           EXLOTD    IFEQ 'SEC'
     C           EXLOTD    OREQ 'SEF'
     C           EXLOTD    OREQ 'CPO'
     C           EXLOTD    OREQ 'DEP'
     C                     MOVELRTISCT    ICISCT
     C                     ENDIF
     C*********                                                           MMI110
     C*********  EXLOTD    IFEQ 'MMD'                      Dealing        MMI110
     C*********  EXLOTD    OREQ 'NAP'                                     MMI110
     C*********  EXLOTD    OREQ 'FXP'                                     MMI110
     C*********  EXLOTD    OREQ 'FXS'                                     MMI110
     C*********  EXLOTD    OREQ 'FRA'                                     MMI110
     C*********  EXLOTD    OREQ 'IRS'                                     MMI110
     C*********  EXLOTD    OREQ 'LEN'                      Lending        MMI110
     C*********  EXLOTD    OREQ 'PPU'                                     MMI110
     C*********  EXLOTD    OREQ 'PSO'                                     MMI110
     C*********  EXLOTD    OREQ 'GLA'                      General ledger MMI110
     C                     Z-ADDRTCATC    ICCATC
     C                     Z-ADDRTTPAC    ICTPAC
     C                     Z-ADDRTCLRL    ICCLRL
     C                     Z-ADDRTACST    ICACST
     C*******              MOVELRTLNIT    ICLNIT
     C                     Z-ADDRTTEGL    ICTEGL
     C                     Z-ADDRTCMPC    ICCMPC
     C***********          Z-ADDRTNUMO    ICNUMO                          MMI110
     C                     Z-ADDRTOPDT    ICOPDT
     C                     Z-ADDRTOREX    ICOREX
     C                     Z-ADDRTRETM    ICRETM                          192459
     C*
     C                     SELEC
     C           CONBDP    WHEQ 0
     C                     MULT 100       ICOREX
     C           CONBDP    WHEQ 1
     C                     MULT 10        ICOREX
     C           CONBDP    WHEQ 3
     C                     DIV  10        ICOREX    H
     C                     ENDSL
     C*
     C                     Z-ADDICOREX    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    ICOREX
     C*********                                                           MMI110
     C*********            ENDIF                                          MMI110
     C*********                                                           MMI110
     C*********            Z-ADDRTIDUR    ICIDUR                          MMI110
      **********                                                          MMI110
      *****Maximum outstanding balance (2dec) : 'GLA'                     MMI110
      **********                                                          MMI110
     C********** EXLOTD    IFEQ 'GLA'                                     MMI110
     C**********           SELEC                                          MMI110
     C********** CONBDP    WHEQ 0                                         MMI110
     C********** ICOUTB    MULT 100       ICOUTB                          MMI110
     C********** CONBDP    WHEQ 1                                         MMI110
     C********** ICOUTB    MULT 10        ICOUTB                          MMI110
     C********** CONBDP    WHEQ 2                                         MMI110
     C**********           Z-ADDICOUTB    ICOUTB                          MMI110
     C********** CONBDP    WHEQ 3                                         MMI110
     C********** ICOUTB    DIV  10        ICOUTB                          MMI110
     C**********           ENDSL                                          MMI110
     C**********           ENDIF                                          MMI110
     C**dont setup         Z-ADDRTCPPT    ICCPPT
     C                     MOVELEXDECK    ICDECK           Cprty type
     C                     MOVELEXCUST    WFIE12 12        CUSTOMER CODE
     C                     MOVE RTCOMP    WFIE06  6        Company Code
     C                     MOVELRTCYCD    WFIE06           Company Code
     C                     MOVE WFIE06    WFIE12           Company Code
     C                     MOVELWFIE12    ICCOMP           Company Code
     C                     MOVELEXFCUS    ICFCUS           Facil. custom.
     C                     Z-ADDEXFACT    ICFACT           Facility type
     C                     Z-ADDEXFCNO    ICFCNO           Fac. Nr.
      *                                                                   MBV002
      * Access extension file for first Guarantee of the Facility         MBV002
      * covering the Account                                              MBV002
      *                                                                   MBV002
     C           EXLOTD    IFEQ 'GLA'                                     MBV002
     C                     Z-ADD*ZERO     ICGURP                          MBV002
      *                                                                   MBV002
     C           KEYGUA    KLIST                                          MBV002
     C                     KFLD           XPCNUM                          MBV002
     C                     KFLD           XPFCLN                          MBV002
      *                                                                   MBV002
     C                     MOVE EXFCUS    XPCNUM                          MBV002
     C                     MOVE EXFACT    WWFACT  3                       MBV002
     C                     MOVE EXFCNO    WWFCNO  2                       MBV002
     C           'F'       CAT  WWFACT:0  XPFCLN                          MBV002
     C           XPFCLN    CAT  WWFCNO:0  XPFCLN                          MBV002
      *                                                                   MBV002
     C           KEYGUA    CHAINLEGTT1L0             02                   MBV002
     C           *IN02     IFEQ *OFF                                      MBV002
     C                     MOVELXPCOLC    WKEY      P                     MBV002
     C                     CALL 'AOFXTBR0'                                MBV002
     C                     PARM '*BLANKS' WRTCD   7                       MBV002
     C                     PARM '*KEY   ' WOPTN   7                       MBV002
     C                     PARM 'COL'     FIELD   3                       MBV002
     C                     PARM           WKEY   18                       MBV002
     C           IRFXTB    PARM *BLANKS   DSSDY                           MBV002
      *                                                                   MBV002
     C           WRTCD     IFEQ *BLANKS                                   MBV002
     C                     MOVE F0PNAR    DSCOL                           MBV002
     C                     Z-ADDCOL472    ICGURP                          MBV002
     C                     ENDIF                                          MBV002
     C                     ENDIF                                          MBV002
     C                     ENDIF                                          MBV002
      *
      ***  DSORAP : EXRIND, EXTREF, EXBRCD : see guar. processing (ERIT76)
      *
     C                     MOVELDSORAP    ICORAP           Origin. Appl. Id.
     C                     Z-ADDICSQCT    ICSEQN           Record Sequence
      *don't setup         Z-ADD0         ICRFD1           Ref to Detail Rec 1
      *don't setup         Z-ADD0         ICPROV           Provisions
      *don't setup         MOVEL*BLANKS   ICNOTE           Note
      *
      ***  End position
     C                     MOVE '*'       ICEND
      *                                                                                       LUC143
      ** Unicredit change: output currency and residency indicators                           LUC143
      ** to Security Code if not used for ISIN Code                                           LUC143
      *                                                                                       LUC143
     C           ICSECC    IFEQ *BLANKS                                                       LUC143
     C                     Z-ADD*ZERO     WRK06N                                              LUC143
     C                     Z-ADDICCYDG    FLD003                                              LUC143
     C                     Z-ADDICRSDG    FLD004                                              LUC143
     C                     MOVE DS032     ICSECC                                              LUC143
     C                     ENDIF                                                              LUC143
      *
      ***  Save Voce/Sottovoce original
     C                     Z-ADDICLINI    @@LINI
      *
      ***  Setup WITTR to 'N' before Voce/Sottovoce Decision Table processing
     C                     MOVE 'N'       WITTR   1
      *
      ***  Voce/Sottovoce Decision Table processing
     C                     CALL 'ERIT82'
      *
      ***  Parameters
     C                     PARM           EXTREF           Transaction Reference
     C                     PARM           EXLOTD           Lot Descriptor
     C                     PARM           EXCCYC           Currency Code
     C                     PARM           EXBNBI           Bank/Non Bank Ind.
     C                     PARM           EXCUST           Customer Number
     C                     PARM           @@ITTR           ERITTRPD Rcd format
     C                     PARM 'N'       @@RTCD  1        Return Code
     C                     PARM *BLANKS   @@ADCD  1        Addition Code
      *
      ***  If Return Code = 'E', Handle Error
     C           @@RTCD    IFEQ 'E'                        *B1
     C                     EXSR #DBERR
     C                     ENDIF                           *E1
      *
     C           *INU7     CABEQ'1'       #WDTLE           Leave
      *
      ***  If Return Code = 'N' => No Voce/Sottovoce Original Decision Table
      ***  found, setup WITTR to 'Y' for write record on ERITTRPD
     C           @@RTCD    IFEQ 'N'                        *B1
     C                     MOVE 'Y'       WITTR
     C                     ENDIF                           *E1
      *
      ***  If Return Code is blank => Voce/Sottovoce Original Decision Table
      ***  found and depending conditions are valid, setup WITTR to 'Y' for
      ***  write record on ERITTRPD with Line Item = Voce/Sottovoce Derived
     C           @@RTCD    IFEQ ' '                        *B1
     C                     MOVE 'Y'       WITTR
     C                     ENDIF                           *E1
      *
      ***  If Return Code = 'Y' => Voce/Sottovoce Original Decision Table found
      ***  but depending conditions not valid, don't setup WITTR (defaulted to
      ***  'N') so don't write record on ERITTRPD
      *
      ***  If WITTR = 'Y', write record on ERITTRPD
     C           WITTR     IFEQ 'Y'                        *B1
     C                     WRITEERITTRD0
      *
      ***  If Return Code is blank => Voce/Sottovoce Original Decision Table
      ***  found and depending conditions are valid, write new record with Line
      ***  Item = Voce/Sottovoce Original if Addition Code = 'A'
     C           @@RTCD    IFEQ ' '                        *B2
     C           @@ADCD    ANDEQ'A'
     C                     Z-ADD@@LINI    ICLINI
     C                     WRITEERITTRD0
     C                     ENDIF                           *E2
     C                     ENDIF                           *E1
      *
     C           #WDTLE    ENDSR
      **
      *==================================================================
      **
      **** CALDAT     Convert DATE YYYYMMDD IN MIDAS DATE
      **
      **   INPUT  : $IDAT
      **   OUTPUT : $ODAT
      **
      *-----------------------------------------------------------
     C           CALDAT    BEGSR
      *-----------------------------------------------------------
      *
     C                     MOVEL'D'       #SDTFM                          AG0001
     C                     Z-ADD$IDAT     WWPRDD
     C                     Z-ADDWYEARC    XYEAR
     C                     Z-ADDWMONTC    XMONTH
     C                     Z-ADDWDAYS     XDAY
     C                     Z-ADDXWSTRD    #SDATE
      *
     C                     CALL 'ZA0270'
     C                     PARM           #SDATE  60
     C                     PARM           #SDTFM  1
     C                     PARM           #SRTRN  1
     C                     PARM           #SDGIM  50
     C                     Z-ADD#SDGIM    $ODAT   50
      *
     C                     ENDSR
      **
      /EJECT
      /COPY ZSRSRC,ZDAT10Z2
      /COPY ZSRSRC,ZDATE9Z3
      /COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZACCH                                                  MMI084
     C/COPY ZSRSRC,ZFWDT                                                  MMI084
      /COPY ZSRSRC,ZNPVZ1                                                 MMI084
      /COPY ZSRSRC,ZCBDYSZ1                                               MMI084
      /COPY ZSRSRC,ZDATE2Z2                                               MMI084
      /COPY ZSRSRC,ZINTPLZ1                                               MMI084
      /EJECT
      *==================================================================
      **
      **** CALCON     Convert Amount to Report CCY
      **
      **   INPUT  : INAMNT 160
      **   OUTPUT : OUTAMT 160
      **
      *-----------------------------------------------------------
     C           CALCON    BEGSR
      *-----------------------------------------------------------
      *
      ** Initialize fields
     C                     Z-ADDINAMNT    INAMNT 160
     C                     Z-ADD0         OUTAMT 160
      **
     C           @@MDI1    IFEQ 'M'
     C           @@MDI2    ANDEQ'D'
     C           @@RAT1    MULT @@RAT2    WWRAT  138
     C*****      INAMNT    MULT WWRAT     OUTAMT    H
     C********** INAMNT    MULT WWRAT     OUTAMT                          197061
     C           INAMNT    MULT WWRAT     OUTAMT    H                     197061
     C                     END
      **
     C           @@MDI1    IFEQ 'M'
     C           @@MDI2    ANDEQ'M'
     C           INAMNT    MULT @@RAT1    OUTAMT
     C*****      OUTAMT    DIV  @@RAT2    OUTAMT    H
     C********** OUTAMT    DIV  @@RAT2    OUTAMT                          197061
     C           OUTAMT    DIV  @@RAT2    OUTAMT    H                     197061
     C                     END
      **
     C           @@MDI1    IFEQ 'D'
     C           @@MDI2    ANDEQ'D'
     C           INAMNT    MULT @@RAT2    OUTAMT
     C*****      OUTAMT    DIV  @@RAT1    OUTAMT    H
     C********** OUTAMT    DIV  @@RAT1    OUTAMT                          197061
     C           OUTAMT    DIV  @@RAT1    OUTAMT    H                     197061
     C                     END
      **
     C           @@MDI1    IFEQ 'D'
     C           @@MDI2    ANDEQ'M'
     C           @@RAT1    MULT @@RAT2    WWRAT
     C*****      INAMNT    DIV  WWRAT     OUTAMT    H
     C********** INAMNT    DIV  WWRAT     OUTAMT                          197061
     C           INAMNT    DIV  WWRAT     OUTAMT    H                     197061
     C                     END
     C                     Z-ADD0         WKOUTA 160
     C* IF THE CURRENCY HAS DECIMAL PLACES IS AN ERROR
     C*******    OUTAMT    DIV  10        WKOUTA    H
     C*******    WKOUTA    MULT 10        OUTAMT
      **
     C                     ENDSR
      *
      /EJECT
      **=================================================================
     C*  ZA0900 - THIS SUBROUTINE CALCULATES THE CROSS EXCHANGE RATE  *
     C*                                                               *
     C* CALLED BY :  MAIN                                             *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@MDI1  FIRST MULTIPLY/DIVIDE INDICATOR              *
     C*          @@MDI2  SECOND MULTIPLY/DIVIDE INDICATOR             *
     C*          @@RAT1  FIRST RATE (SIZE : 13,8)                     *
     C*          @@RAT2  SECOND RATE (SIZE : 13,8)                    *
     C*                                                               *
     C* OUTPUT : @@CSRT  CROSS RATE  (SIZE : 13,8)                    *
     C*          @@FCMD  FIRST CCY MULTIPLY/DIVIDE INDICATOR          *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZA0900    BEGSR
     C*
     C           @@RAT1    IFEQ *ZERO                      B1
     C                     Z-ADD1         @@RAT1
     C                     END                             E1
     C*
     C           @@RAT2    IFEQ *ZERO                      B1
     C                     Z-ADD1         @@RAT2           *1
     C                     END                             E1
     C*
     C**  IF THE FIRST RATE M/D INDICATOR IS 'M' MULTIPLY,
     C**             ELSE DIVIDE
     C*
     C           @@MDI1    IFEQ 'M'                        B1
     C                     Z-ADD@@RAT1    @@CSRT 159       *1
     C                     ELSE                            X1
     C           1         DIV  @@RAT1    @@CSRT    H      *1
     C                     END                             E1
     C*
     C**  IF THE SECOND RATE M/D INDICATOR IS 'D' MULTIPLY,
     C**             ELSE DIVIDE
     C*
     C           @@MDI2    IFEQ 'D'                        B1
     C           @@CSRT    MULT @@RAT2    @@CSRT    H      *1
     C                     ELSE                            X1
     C           @@CSRT    DIV  @@RAT2    @@CSRT    H      *1
     C                     END                             E1
     C*
     C*
     C**  SET FIRST CCY MULTIPLY/DIVIDE *IN TO MULTIPLY
     C                     MOVE 'M'       @@FCMD  1
     C*
     C           ZA0909    ENDSR                           **ZA0909 TAG**
      /EJECT
      *****************************************************************
      *  *INZSR - Program initialisation subroutine                   *
      *  ------                                                       *
      *  Called by : automatically at program start                   *
      *  Calls     : internal routine :                               *
      *  Calls     : external pgm :                                   *
      *****************************************************************
      *
     C           *INZSR    BEGSR
      *
     C                     MOVE *OFF      *IN98
      *
      ***  Define LDA
      *                                                                *****
     C           *NAMVAR   DEFN           LDA
     C                     IN   LDA
      *                                                                *****
     C           *ENTRY    PLIST
     C                     PARM           BJMRDT  7        Run date
     C                     PARM           BJURPT 53        Rpt Title
     C                     PARM           LASTSQ  60       Output Parm
      *                                                                   MMI084
      * Access Bank Details                                               MMI084
      *                                                                   MMI084
     C                     MOVEL'BANK'    BJBANK                          MMI084
     C           BJBANK    CHAINSDBANKL1             80                   MMI084
      *
     C                     MOVELBJMRDT    WDAT5   5
     C                     MOVE WDAT5     WDAT3   3
     C                     Z-ADD1         X       20
     C           WDAT3     LOKUPSSA,X                    50
     C   50                Z-ADDX         WDAT2   20
     C   50                MOVELSSB,X     BJMRDT
     C   50                MOVELBJMRDT    WDAT4   4
     C   50                MOVE WDAT2     WDAT4
     C   50                MOVELSSB,X     WDAT4
     C   50                MOVELWDAT4     WDAT6   6
     C   50                MOVE BJMRDT    WDAT2
     C   50                MOVE WDAT2     WDAT6
     C           WDAT2     IFLT 71
     C                     MOVEL'20'      WDAT4
     C                     ELSE
     C                     MOVEL'19'      WDAT4
     C                     END
     C                     MOVE WDAT6     WDAT2
     C                     MOVE WDAT2     WDAT4
     C                     MOVELWDAT4     WDAT8   8
     C                     MOVE WDAT6     WDAT4
     C                     MOVELWDAT6     WDAT2
     C                     MOVE WDAT2     WDAT4
     C                     MOVE WDAT4     WDAT8   8
     C           X         IFEQ 2
     C                     MOVELWDAT8     WDAT04  40
     C           WDAT04    DIV  4         WDAT03  30
     C                     MVR            RESTO   10
     C           RESTO     IFEQ 0
     C                     MOVE '29'      WDAT8
     C                     MOVEL'29'      BJMRDT
     C                     MOVEL'29'      WDAT6
     C                     END
     C                     END
     C                     MOVE WDAT8     XYENDP  80
     C*                                                                   MMI084
     C* Setup reporting date + 1 year, and rep. date plus 5 years         MMI084
     C*                                                                   MMI084
     C           XYENDP    ADD  10000     YEAR1   80                      MMI084
     C           XYENDP    ADD  50000     YEAR5   80                      MMI084
     C                     MOVE WDAT8     $DDP    20
     C                     MOVE '01'      WDAT8   8
     C                     MOVE WDAT8     XYSTRP  80
      *
     C                     MOVE WDAT6     ZDATE            DDMMYY
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    XXENDQ  50
      *
     C           X         IFEQ 1
     C           X         OREQ 2
     C           X         OREQ 3
     C                     MOVEL'0101'    WDAT4
     C                     MOVELWDAT4     WDAT6
     C                     END
      *
     C           X         IFEQ 4
     C           X         OREQ 5
     C           X         OREQ 6
     C                     MOVEL'0104'    WDAT4
     C                     MOVELWDAT4     WDAT6
     C                     END
      *
     C           X         IFEQ 7
     C           X         OREQ 8
     C           X         OREQ 9
     C                     MOVEL'0107'    WDAT4
     C                     MOVELWDAT4     WDAT6
     C                     END
      *
     C           X         IFEQ 10
     C           X         OREQ 11
     C           X         OREQ 12
     C                     MOVEL'0110'    WDAT4
     C                     MOVELWDAT4     WDAT6
     C                     END
      *
     C                     MOVE WDAT6     ZDATE            DDMMYY
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    XXSTRQ  50
      *
      *
     C                     MOVEL'0101'    ZDATE            DDMMYY
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    XXSTRY  50
      *
     C                     MOVEL*BLANK    DBLOT
     C                     MOVELPGM       DBPGM
     C                     OUT  LDA
     C                     MOVE '0'       *INU7
      *
      ***  Read ER ICD : RETRIEVE LOCAL CCY
      *
     C           'IT'      CHAINERICDRPD             80
     C           *IN80     IFEQ '1'                        Not found
     C           *LOCK     IN   LDA
     C                     MOVEL'603'     DBASE            ****************
     C                     MOVEL'ERICDRPD'DBFILE           * DB ERROR 603 *
     C                     MOVEL'IT'      DBKEY            ****************
     C                     EXSR #DBERR
     C                     ENDIF
      *
      ***  Access Italian ER currency defintion : retrieve Rate /vs base CCY
      *
     C********** VDCCYC    CHAINERCURRL1             80                   MMI100
     C           VDCCYC    CHAINSDCURRL1             80                   MMI100
     C           *IN80     IFEQ '1'                        not found
     C           *LOCK     IN   LDA
     C                     MOVEL'604'     DBASE            ****************
     C**********           MOVEL'ERCURRL1'DBFILE           * DB ERROR 605 MMI100
     C                     MOVEL'SDCURRL1'DBFILE           * DB ERROR 605 MMI100
     C                     MOVELVDCCYC    DBKEY            ****************
     C                     EXSR #DBERR
     C                     ENDIF
      *
     C***********          Z-ADDVRSPRT    @@RAT2 138       Spot rate      MMI100
     C***********          MOVE VRMDIN    @@MDI2  1        Mult/Div Ind   MMI100
     C***********          Z-ADDVRNBDP    CCNBDP  10       Dec places     MMI100
     C                     Z-ADDA6SPRT    @@RAT2 138       Spot rate      MMI100
     C                     MOVE A6MDIN    @@MDI2  1        Mult/Div Ind   MMI100
     C                     Z-ADDA6NBDP    CCNBDP  10       Dec places     MMI100
      ***********                                                         MMI098
      *****Read*Specific Italian European reporting I.C.D.                MMI098
      ***********                                                         MMI098
     C***********'IT'      CHAINERITICL0             80                   MMI098
     C************IN80     IFEQ '1'                        not found      MMI098
     C************LOCK     IN   LDA                                       MMI098
     C***********          MOVEL'606'     DBASE            ****************MI098
     C***********          MOVEL'ERITICL0'DBFILE           * DB ERROR 606 *MI098
     C***********          MOVEL'IT'      DBKEY     P      ****************MI098
     C***********          EXSR #DBERR                                    MMI098
     C***********          ENDIF                           - E1           MMI098
     C***********                                                         MMI098
     C*****Read*Specifique Dealing I.C.D. for European Reporting          MMI098
     C***********                                                         MMI098
     C***********          READ ERDEALPD                 80               MMI098
     C************IN80     IFEQ '1'                        Not found      MMI098
     C************LOCK     IN   LDA                                       MMI098
     C***********          MOVEL'607'     DBASE            ***************MMI098
     C***********          MOVEL'ERDEALPD'DBFILE           * DB ERROR 607*MMI098
     C***********          MOVEL'DEAL'    DBKEY            ***************MMI098
     C***********          EXSR #DBERR                                    MMI098
     C***********          ENDIF                                          MMI098
      *
      *** Read counter of IRSTAT
      *
     C           *NAMVAR   DEFN           IRSTAT
     C                     IN   IRSTAT
      *
     C                     Z-ADDIRSQCT    WWSQCT  60
      *
      ***  Convert reporting date to day number
      *
     C***                  Z-ADDEXREPD    ZZDTIN           From Primary File
     C***                  EXSR ZDAT10
     C***                  Z-ADDZZMDNO    WWREPD  50
      *
      ***  Defined @@LINI to save Voce/Sottovoce Original
     C           *LIKE     DEFN ICLINI    @@LINI
      *
     C                     ENDSR
      *
      /EJECT
      ********************************************************************
      *  #DBERR - Handle error                                           *
      *  ------                                                          *
      *  Called by : *INZSR, #SQBK, #DETL,                               *
      *  Calls     :                                                     *
      ********************************************************************
      *
     C           #DBERR    BEGSR
      *
      ***  If problem during external call
      *
     C           ERROR     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     ENDIF
      *
      ***  Every case : write out lda field
      *
     C                     OUT  LDA
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INLR
      *
      *** Output Audit report
      *
     C                     EXSR #AUDIT
      *
     C           ERROR     IFEQ *BLANK
     C                     DUMP
     C                     END
      *
      *** Leave program
      *
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *  #AUDIT - Write Audit list                                    *
      *  ------                                                       *
      *  Called by : Mainlines                                        *
      *              #DBERR - Data base error/call problem            *
      *****************************************************************
      *
     C           #AUDIT    BEGSR
      *
     C                     WRITEHEADAU
      *
      ***  In case of error
      *
     C           *INU7     IFEQ '1'
     C                     WRITEDBERAU
     C                     ENDIF
      *
      ***  Write trailer
      *
     C                     MOVELFILNAM    ERXXTR  8
     C                     Z-ADDWWSQCT    WTR
     C                     Z-ADDWWSQCT    LASTSQ
     C                     WRITETRLRAU
      *
     C                     ENDSR
      *
** FILE TRANSFORMATION
*EQUATE ERITTRPD
*EQUATE 406B407D404B4061
** @YD* USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(C) Copyright Midas-Kapiti International Ltd. 1997.
**  MONTH SHORTNAMES
JAN31
FEB28
MAR31
APR30
MAY31
JUN30
JUL31
AUG31
SEP30
OCT31
NOV30
DEC31
**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
0006001521029820444305904073650882610287117481320914670161311759219053
2051421975234362489726358278192928030741322023366335124365853804639507
40968424294389045351
