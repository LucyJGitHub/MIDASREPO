     H        1   Y                       F
     H****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ER IML Reporting - Main Component')              *
     H****************************************************************
     H*                                                              *
     H*          MIDAS ABS - EUROPEAN REPORTING                      *
     H*                                                              *
     H*  ERLU60 - LU  REPORTING - INTERFACE TO FRS MAIN COMPONENT    *
     H*                                                              *
     H*  (c) Finastra International Limited 2005                     *
     H*                                                              *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CER059             Date 19Jul10               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base --------------------------------- --------*
      *                 225540             Date 05Jan07               *
      *                 233403             Date   04Jan07             *
      *                 225555             Date   31Oct06             *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027A            Date 06MAy06               *
      *                 CER001             Date 25Apr05               *
      *                 ULX048             Date 07Aug03               *
      *                 223840             Date 18Dec03               *
     H*                    217943             Date   16MAY03         *
     H*                    217912             Date   16MAY03         *
     H*                    214603             Date   04Feb03         *
     H*                    MBFIX              Date   24Jan03         *
     H*                    209275             Date   20Jan03         *
     H*                    213111             Date   11Dec02         *
     H*                    212511             Date   30Nov02         *
     H*                    212077             Date   30Nov02         *
     H*                    203320             Date   13Mar02         *
     H*                    ULX048             Date   07Aug03         *
     H*                    214603             Date   04Feb03         *
     H*                    ULX047             Date   28Jan03         *
      *                 UPG042             Date 04OCt04               *
      *                 ULX046C3           Date 03Jan03               *
      *                 ULX046C2           Date 16Dec02               *
     H*                    ULX046C1           Date   13Dec02         *
     H*                    ULX046             Date   28Oct02         *
     H*                    CG0001             Date   16Sep02         *
     H*                    194921             Date   28Jun01         *
     H*                    ULX024             Date   03Sep99         *
     H*                    181643             Date   30Mar01         *
     H*                    189998             Date   08Mar01         *
     H*                    176762             Date   13Feb01         *
     H*                    187689             Date   19Dec00         *
     H*                    187607             Date   18Dec00         *
     H*                    186714             Date   15Nov00         *
     H*                    186712             Date   15Nov00         *
     H*                    182312             Date   30Oct00         *
     H*                    163004             Date   06Sep00         *
     H*                    169125             Date   01Sep00         *
     H*                    ULX008             Date   19Jul00         *
     H*                    ULX008             Date   23Mar00         *
     H*                    ULX008             Date   23Mar00         *
     H*                    175795             Date   02MAR00         *
     H*                    GUARPT             Date   24Sep99         *
     H*                    ULX012             Date   15Dec98         *
     H*                    142828             Date   15Oct98         *
     H*                    CAD021             Date   30Nov98         *
     H*                    CEU007 PFT08       Date   30Nov98         *
     H*                    141872             Date   29Sep98         *
     H*                    CAD019             Date   29Sep98         *
     H*                    CAD018             Date   29Sep98         *
     H*                    CAD017             Date   23Sep98         *
     H*                    CAD013             Date   02Sep98         *
     H*                    CAD011             Date   25Aug98         *
     H*                    117987             Date   24Jul98         *
     H*                    CAD007             Date   24Jul98         *
     H*                    119467             Date   24Jul98         *
     H*                    CAD002             Date   30May98         *
     H*                    ULX011             Date   22Apr98         *
     H*                    ULX004             Date   26Mar97         *
     H*                    111329 DDJ         Date   03Sep96         *
     H*                    103422 DDJ         DATE   03SEP96         *
     H*                    105698             DATE   21AUG96         *
     H*                    107142 PT          DATE   21AUG96         *
     H*                    ERL370 TLI         DATE   29SEP93         *
     H*                    ER_R10             DATE   25OCT94         *
     H*                    ERL461 PT          DATE   04APR96         *
     H*                                                              *
     H* ------------------------------------------------------------ *
     H*                                                              *
      *  MD046248 - Finastra Rebranding                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (recompiled)                                       *
     H* 225540 - Split Total of Purchase Amounts eligible for        *
     H*          refinancing with Central Bank (1.02) and Total of   *
     H*          all other Purchase Amounts (1.06)                   *
     H* 233403 - WRONG CODE C075                                     *
     H* 225555 - Add discount/premium amount, amount to amortize     *
     H*          and 'Prix d'Acquisition'.                           *
     H*          1.15.0000 for Discount and 2.05.0000 for Premium    *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CER001 - LUX Upgrade to MidasPlus                            *
     H* ULX048 - Circular CSSF 2003/100 management                   *
     H* 223840 - Deals in currency/EUR should be generated in the    *
     H*          BCL items 3-03.11201 to 3-03.11204                  *
     H* 217943 - WRONG CODE FOR DOCUMENTARY CREDITS
     H* 217912 - COUNTRY CODE MUST BE XA FOR CAISSE
     H* MBFIX  - B035                                                *
     H* 209275 - Country code of cash accounts incorrectly managed   *
     H* 213111 - Country of citizenship incorrectly managed          *
     H* 212511 - C090 incorrect                                      *
     H* 212077 - C149 and C155 incorrect                             *
     H* 203320 - For Rubric IML 101100 (cash) due to EURO's change   *
     H*          set up the currency country code with ISO Ctry cde  *
     H*          issuer (EXLISS)                                     *
     H*          Set up defaut value '0' instead ' ' for Position    *
     H* ULX048 - Circular CSSF 2003/100 management                   *
     H* 214603 - Several problems due to ULX046
     H* ULX047 - CSSF Market Values Calculation                      *
      *  UPG402 - Recompile due to R4.02 upgrade                      *
     H* ULX046C3 - Amount type incorrectly managed                   *
     H* ULX046C2 - Correction of ULX046C1 fix.                       *
     H* ULX046C1 - Correction of ULX046.                             *
     H*          For history transactions, use default extended detail
     H* ULX046 - Circulars 2002/170-174-175 Integration              *
     H* CG0001 - remove fix 187607 (msg PAscal Tinant 13/09/02)      *
     H* 194921 - To populate several empty fields                    *
     H* ULX024 - Trade Innovation/CSSF Reporting Interface           *
     H* 181643 - Repo not extracted from money market deposits       *
     H* 189998 - EXCRMT set up changes                               *
     H* 176762 - Current spot forex deals must be considered as      *
     H*          forward                                             *
     H* 187689 - "GRD" currency in EMU                               *
     H* 187607 - Initial duration is always the end date             *
     H* 186714 - Initial duration code must be passed to ERLUSA      *
     H*          to calculate 302420 BCL code                        *
     H* 186712 - Amount type not changed from term to sight          *
     H* 182312 - Accrued interest flag (EXTDCD) not managed          *
     H* 163004 - 'A recevoir (debit)' side must be reported for IRS  *
     H* 169125 - SWAP are not affected correctly                      *
     H* ULX008 - "Commissariat aux Bourses" - Change control C        *
     H*          Recompiled due to changes in PF/ERLUICPD             *
     H* ULX008 - "Commissariat aux Bourses" - Change control A        *
     H*          Recompiled due to changes in PF/ERLUICPD             *
     H* ULX008 - CSSF Statutory Reporting - Commissariat aux Bourses  *
     H*          Recompiled due to changes in PF/ERLUICPD             *
     H* 175795 - AMEND OPÉRATIONS DE CHANGE À TERME DEV/(BEF OU LUF) *
     H*          TO USE ALL IN-CURRENCIES                            *
     H* GUARPT - To allow one guarantee for several exposures        *
     H* ULX012 - Guarantees and Collateral Management enhancements   *
     H*          Recompile over changed file ERLUICPD                *
     H* 142828 - Country code not be erased by 'XX' (done by Abacus) *
     H* CAD021 - Swap trade accounts management badly positioned     *
     H* CEU007 - Holidays Changes For Reporting Interface.           *
     H* CAD021 - Swap trade accounts management badly positioned     *
     H* 141872 - Options reported on debit and credit                *
     H* CAD019 - Both sides of IRS (RS) were reported                *
     H* CAD018 - Parameters for duration calculation incorrect       *
     H* CAD017 - Currency code wrong for swap trade account          *
     H* CAD013 - Sequence number wrongly managed                     *
     H* CAD011 - EXSEQN cannot be saved for Swap trade A/c management*
     H* 117987 - Swap trade accounts management                      *
     H* CAD007 - CAD adaptation to data dictionary version 1.6       *
     H* 119467 - Spot FX cannot be considered as outrights           *
     H* CAD002 - To ignore SE positions from the rerurn              *
     H* ULX011 - IML Circular 97/138                                 *
     H* ULX004 - CAPITAL ADEQUACY                                    *
     H* 111329 - DO NOT ROUND AMOUNT ...                             *
     H* 103422 - TO SPLIT EXNMDT INTO 2 SUBFIELDS FOR CL             *
     H* 105698 - AMOUNT ENTERED UNDER AMAD DO NOT APPEAR IN 302400   *
     H* 107142 - For monthly IBLC, we need to use the initial        *
     H*          duration when the repayments are processed          *
     H* ERL370 - Book code / Investment type development  (R10)      *
     H* ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10      *
     H*        - ADD BRANCH CODE (R10 MULTIBRANCHING) FOR ERLU70     *
     H*  ERL461 - Suppression of records type 001                    *
     H*           New version of old RPG/ERLU60                      *
     H*            (92193 is latest correction from old version)     *
     F*****************************************************************
     F***EREXTRL0IP**E           K        DISK                                                CER001
     FEREXTXL0IP  E           K        DISK                                                   CER001
      * EX - ER Extract File
      *      Rcd fmt : EREXTRF0
      *
     F***ERICDRL1IF**E           K        DISK                                                CER001
     FERICDXL1IF  E           K        DISK                                                   CER001
      * VD - ER I.C.D.
      *
     F***ERDEALPDIF**E           K        DISK                                                CER001
     FERDEAXPDIF  E           K        DISK                                                   CER001
      * BN - ER DL I.C.D.
      *
     F***ERCURRL1IF  E           K        DISK                            187689
     F*** VR - Currency Codes table                                       187689
     FSDCURRL1IF  E           K        DISK                               187689
     F* A6 - Currency Codes table                                         187689
      *
     F***ERLUICL0IF**E           K        DISK                                                CER001
     FERLICXL0IF  E           K        DISK                                                   CER001
     F* VP - LU I.C.D.
      *
     FSDCTX2L0IF  E           K        DISK                                                   233403
      *                                                                                       233403
     F**FWDRT   IF  E           K        DISK                      ULX011 ULX047
     F**Forward*rates*table                                        ULX011 ULX047
      *********************                                        ULX011 ULX047
     F***SDBOOKX4IF**E           K        DISK                                         194921 CER001
     FSDBKX3PDIF  E           K        DISK                                                   CER001
     F* WC - Book Codes Extended file                                     194921
      *                                                                   194921
      **             ** ------------------- **
     F***ERLUTRPDO***E                    DISK         KINFDS OUTFIL                          CER001
     FERLTRXPDO   E                    DISK         KINFDS OUTFIL                             CER001
      * EX - ER LU 'enriched' Extract File
      *      Rcd fmt : ERLUTRF0
      *
      **             ** ------------------- **
     FERLU60AUO   E                    PRINTER
      * Audit List -
      *
      *===============================================================*
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       01         EXTRACT FILE RECORD ID INDICATOR
     F*       80         FILE ACCESS OPERATION FAIL
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * ..   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E*
     E** ARRAY FOR SECUTITY SHORTNAME
     E                    OTC     1   2 10
     E****                                                         ULX011 ULX047
     E****FORWARD DATES/RATES                                      ULX011 ULX047
     E****                DAT        26  5 0A                      ULX011 ULX047
     E****                RAT        26 13 8                       ULX011 ULX047
      ****                                                         ULX011 ULX047
      ****FORWARD DAYS ARRAY                                       ULX011 ULX047
     E****                DF         25  5 0                       ULX011 ULX047
      ****                                                         ULX011 ULX047
      ****FORWARD RATES ARRAY                                      ULX011 ULX047
     E****                RF         25 13 8                       ULX011 ULX047
      ****                                                         ULX011 ULX047
      ****FORWARD DATES ARRAY INCLUDING RUN DATE IN FIRST ELEMENT  ULX011 ULX047
     E****                DYF        26  5 0                       ULX011 ULX047
      ****                                                         ULX011 ULX047
      ****FORWARD RATES ARRAY INCLUDING CURRENCY SPOT RATE IN FIRSTULX011 ULX047
     E****                RAF        26 13 8                       ULX011 ULX047
     E****                                                         ULX011 ULX047
     E****                POWER   1   7  7 3             POWER ARRAULX011 ULX047
     E*                                                                   ULX011
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIODULX011
     E                    @YD     4   4  5 0A                             ULX011
     E*                                                                   ULX011
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR PER MONTH        ULX011
     E                    @MD    13  13  5 0A                             ULX011
     E*                                                                   ULX011
      * Arrays to split holiday fields into 1-bit elements                186712
      *                                                                   186712
     E                    ZHL       366  1                                186712
     E                    ZHL1      366  1                                186712
      *                                                                   186712
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
      *===============================================================*
      *
     IEREXTRF0    01
     I                                              EXBRCDL4
     I                                              EXLOTDL3
     I                                              EXDECKL3
     I                                              EXDRCRL3
     I                                              EXCCYCL2
     I                                              EXCUSTL1
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      132 183 DBLOT
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      142 156 DBK1
     I                                      158 163 DBK2
     I                                      165 170 DBK3
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I* Data structure for KYFACT key
     I            DS
     I                                        1   6 KY1
     I                                        7   90KY2
     I                                       10  110KY3
     I                                        1  110WWFACT
     I* Data structure for EXTREF key
     I            DS
     I**********                              1  15 EXTREF                                    CER001
     I                                        1  21 EXTREF                                    CER001
     I****************************************8  10 WWREPN                GUARPT
     I***************************************11  11 WWFREP                GUARPT
     I                                       14  14 EXPROT
     I                                       15  15 EXSPFW
     I                                       13  15 WWTREF
     I**********                             10  13 WWACOD                             117987 CER001
     I                                       10  19 WWACOD                                    CER001
     I* Data structure for EXDECK key                                     ULX047
     I            DS                                                      ULX047
     I**********                              1   8 EXDECK                             ULX047 CER001
     I                                        1  14 EXDECK                                    CER001
     I                                        1   2 EXDEC2                ULX047
     I            DS                                                      103422
     I                                        1   9 EXRICC                103422
     I                                        6   8 W1REPN                103422
     I                                        9   9 W1FREP                103422
      * Data structure for EXUCOR                                         ULX047
     I            DS                                                      ULX047
     I**********                              1  15 EXUCOR                             ULX047 CER001
     I                                        1  21 EXUCOR                                    CER001
      *                                                                   ULX047
     I                                        1   4 WKRIND                ULX047
     I                                        5   5 WKFILL                ULX047
     I                                        6  15 WKTREF                ULX047
     I                                       15  15 WKTR15                ULX047
      * Program status data structure
     I           SDS
     I                                     *PROGRAM PGM
      **
     I            DS
     I                                        1   80SCHA
     I                                        1   10SCHA11
     I                                        1   30SCHA13
     I                                        1   60SCHA16
     I                                        7   80SCHA78
      * Output File data structure
     IOUTFIL      DS
     I                                     *FILE    FILNAM
      ***DATA*STRUCTURE*TO*GET*THE FORWARD DAYS FROM FILE LF/FWDRT ULX011 ULX047
      *******                                                      ULX011 ULX047
     I**DFWDS       DS                                             ULX011 ULX047
     I*******                             P   1  750DF             ULX011 ULX047
      *******                                                      ULX011 ULX047
     I***DATA*STRUCTURE*TO*GET*THE FORWARD RATES FROM FILE LF/FWDRTULX011 ULX047
     I**RFWDS       DS                                             ULX011 ULX047
     I*******                             P   1 1758RF             ULX011 ULX047
     I**  DATA STRUCTURE FOR SR. ZDAT10 - DATE INPUT TO SUBROUTINE        ULX011
     I            DS                                                      ULX011
     I                                        1   80ZZDTIN                ULX011
     I                                        1   40ZWYYYY                ULX011
     I                                        1   20ZWCC                  ULX011
     I                                        5   60ZWMTH                 ULX011
     I                                        7   80ZWDAY                 ULX011
     I*                                                                   186712
     IDSSDY     E DSDSSDY                                                 186712
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                186712
     I*                                                                   186712
     IZHOLDS      DS                                                      186712
      *                                                                   186712
      * Data structure defined over holiday file fields                   186712
      *                                                                   186712
     I                                        1   3 DGCYCD                186712
     I                                        4   6 DGLCCD                186712
     I                                        7  100DGYRNB                186712
     I                                    P  11  130DGJDNB                186712
     I                                    P  14  160DGDDNB                186712
     I                                       17 202 ZDS1                  186712
     I                                      203 382 ZDS2                  186712
     I                                       17 382 ZHL                   186712
      *                                                                   186712
      *                                                                   186712
     IZVARS       DS                                                      186712
      *                                                                   186712
      * Data structure to define variables used in holiday sub-routines   186712
      *                                                                   186712
     I                                        1   1 ZIND                  186712
     I                                        2   40ZINDX                 186712
     I                                    P   5   70ZDAYNO                186712
     I                                    P   8  100ZDYNBR                186712
     I                                       11  120ZNRDYS                186712
     I                                       13  140@ZWRDY                186712
      *                                                                   186712
     I                                       15  17 ZCCY                  186712
     I                                       18  20 ZLOC                  186712
     I                                       15  20 @ZWRKI                186712
      *                                                                   186712
     I                                       21  23 ZSCCY                 186712
     I                                       24  26 ZSLOC                 186712
     I                                       27  300ZSWEXX                186712
     I                                    P  31  330ZSJAN                 186712
     I                                    P  34  360ZSDCM                 186712
     I                                       37  43 RTNCD                 186712
     I                                       21  43 @ZWRKO                186712
      *                                                                   186712
     I                                       44  50 ZOPTN                 186712
     I                                       51  53 ZZCCY                 186712
     I                                       54  56 ZZLOC                 186712
     I                                    P  57  590ZZDYNO                186712
     I                                       60  66 ZSRTN                 186712
      /EJECT
     C*================================================================
      *          *IN01     CABEQ'0'       NXTRCD
     C                     ADD  1         RCD     60       Rcds Read
      *
     C                     MOVE EXCNCZ    WWCNCZ  2
      *
     C           *INL4     IFEQ '1'
     C           *INL3     OREQ '1'
     C           *INL2     OREQ '1'
     C           *INL1     OREQ '1'
     C           EXLOTD    OREQ 'SEC'
     C                     EXSR #SQBK
     C                     END
      *
      * Reporting date                                                    ULX011
     C           EXREPD    IFNE WWREPD                                    ULX011
     C                     Z-ADDEXREPD    ZZDTIN                          ULX011
     C                     EXSR ZDAT10                                    ULX011
     C                     Z-ADDZZMDNO    W#REPD  50                      ULX011
     C                     Z-ADDEXREPD    WWREPD                          ULX011
     C                     ENDIF                                          ULX011
      *                                                                   ULX011
     C           EXECOS    IFNE 1410
     C           EXECOS    ANDNE1421
     C           EXECOS    ANDNE1422
     C           EXECOS    ANDNE1451
     C***********          MOVELEXCUCL    EXCNCZ                          213111
     C                     MOVELEXCUCL    XXCNCZ                          213111
     C                     END
      *
     C           EXLOTD    IFEQ 'SEC'                                     CAD002
     C           EXRCSI    ANDEQ'R'                                       CAD002
     C                     GOTO NXTRCD                                    CAD002
     C                     END                                            CAD002
      *                                                                   CAD002
     C***********EXLOTD    IFEQ 'IRS'                              CAD019 187689
     C***********EXSCHA    ANDEQ30321000                           CAD019 187689
     C***********EXDRCR    ANDEQ0                           CAD019 163004 187689
     C***********EXDRCR    ANDEQ1                                  163004 187689
     C***********          GOTO NXTRCD                             CAD019 187689
     C***********          END                                     CAD019 187689
      *                                                            CAD019 187689
     C           EXINCL    IFEQ 'Y'
     C           EXSCHA    ANDNE*ZEROS
     C           *INU7     ANDEQ'0'
     C*
     C           EXLOTD    IFEQ 'LEN'
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
     C*
     C** If LE repayments required, bypass loans for which repayments
     C** exist
     C           VPLERP    IFEQ 'Y'
     C           WWTREF    IFEQ 'REX'
     C                     GOTO NXTRCD
     C                     END
     C*
     C** If LE repayments not required, bypass loans repayments
     C                     ELSE
     C           WWTREF    IFEQ 'REP'
     C                     GOTO NXTRCD
     C                     END
     C                     END
     C                     END
     C*
     C           EXLOTD    IFEQ 'DRW'
     C*
     C** If CL repayments required, bypass loans for which repayments
     C** exist
     C           VPCLRP    IFEQ 'Y'
     C           WWTREF    IFEQ 'REX'
     C                     GOTO NXTRCD
     C                     END
     C*
     C** If CL repayments not required, bypass loans repayments
     C                     ELSE
     C           WWTREF    IFEQ 'REP'
     C                     GOTO NXTRCD
     C                     END
     C                     END
     C                     END
     C*
     C** Save country of location and  economic sector code
     C                     MOVELEXCUCL    WWCUCL  3
     C                     Z-ADDEXECOS    WWECOS  40
     C*
     C                     EXSR #DETL
     C  NU7                EXSR #WDTL
     C*
     C** Restore country of location and economic sector code
     C                     MOVELWWCUCL    EXCUCL
     C                     Z-ADDWWECOS    EXECOS
      ***Write error:
     C                     END
      *
     C           *INU7     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     EXSR #DBERR
     C                     END
      *
      *-----------------------------------------------------------
     C           NXTRCD    TAG
     C******LR                   EXSR SWAP                         117987 169125
     CLR                   EXSR #AUDIT
      *
     C*LR******            MOVE 'Y'       #END                            ULX004
     C*LR******            EXSR SRLUGU                                    ULX004
      *
      /EJECT
     C*================================================================
      **
      **  #DETL       Detail processing
      **
      *-----------------------------------------------------------
     C           #DETL     BEGSR
      *-----------------------------------------------------------
      *
      **  Common processing to all record types:
      *
     C                     MOVEL*BLANKS   WPEDLO  3                       CEU007
     C                     MOVEL*BLANKS   WPEDCU  3                       CEU007
      *                                                                   CEU007
      ***  If the feature CEU007 is installed, filling the new            CEU007
      ***  parameters                                                     CEU007
      *                                                                   CEU007
     C           CEU007    IFEQ 'Y'                                       CEU007
      *                                                                   CEU007
     C                     MOVELEXEDLO    WPEDLO                          CEU007
     C                     MOVELEXEDCU    WPEDCU                          CEU007
      *                                                                   CEU007
     C                     ENDIF                                          CEU007
      *                                                                   CEU007
      ***Reset*amount*type to '1' (brut amount)                           ULX011
     C*********************MOVE '1'       EXAMTY                          ULX011
      *
      *   - Calculate transaction initial duration code
     C                     CALL 'ERLUIDUR'
     C                     PARM           EXSTRD
     C                     PARM           EXENDD
     C                     PARM           EXCCYC
     C                     PARM *ZEROS    EXIDUR
     C                     PARM           WPEDLO                          CEU007
     C                     PARM           WPEDCU                          CEU007
      *                                                                   CEU007
     C                     Z-ADDEXIDUR    EXREFI                          107142
      ***********                                                  107142 187607
      ****-*Calculate transaction initial duration code for repaym 107142 187607
     C***********EXLOTD    IFEQ 'LEN'                              107142 187607
     C***********EXLOTD    OREQ 'PPU'                              107142 187607
     C***********          Z-ADDEXQINC    WWQINC  80               107142 187607
     C***********          CALL 'ERLUIDUR'                         107142 187607
     C***********          PARM           EXSTRD                   107142 187607
     C***********          PARM           WWQINC                   107142 187607
     C***********          PARM           EXCCYC                   107142 187607
     C***********          PARM *ZEROS    WWREFI  20               107142 187607
     C***********          PARM           WPEDLO                   CEU007 187607
     C***********          PARM           WPEDCU                   CEU007 187607
      ***********                                                  CEU007 187607
     C***********          Z-ADDWWREFI    EXREFI                   107142 187607
     C***********          END                                     107142 187607
      *                                                                   CG0001
      *   -*Calculate transaction initial duration code for repaym        CG0001
     C           EXLOTD    IFEQ 'LEN'                                     CG0001
     C           EXLOTD    OREQ 'PPU'                                     CG0001
     C                     Z-ADDEXQINC    WWQINC  80                      CG0001
     C                     CALL 'ERLUIDUR'                                CG0001
     C                     PARM           EXSTRD                          CG0001
     C                     PARM           WWQINC                          CG0001
     C                     PARM           EXCCYC                          CG0001
     C                     PARM *ZEROS    WWREFI  20                      CG0001
     C                     PARM           WPEDLO                          CG0001
     C                     PARM           WPEDCU                          CG0001
     C                     Z-ADDWWREFI    EXREFI                          CG0001
     C                     END                                            CG0001
      *                                                                   ULX011
      *   - Calculate transaction initial duration code 2 (Review date)   ULX011
     C                     CALL 'ERLUIDUR'                                ULX011
     C                     PARM           EXSTRD                          ULX011
     C                     PARM           EXREVD                          ULX011
     C                     PARM           EXCCYC                          ULX011
     C                     PARM *ZEROS    EXIDU2                          ULX011
     C                     PARM           WPEDLO                          CEU007
     C                     PARM           WPEDCU                          CEU007
      *
      *   - Calculate transaction residual period code 1
     C                     CALL 'ERLURDUR'
     C                     PARM           EXREPD
     C                     PARM           EXENDD
     C                     PARM *ZEROS    EXRDU1
     C                     PARM           VDCCYC
     C                     PARM           WPEDLO                          CEU007
     C                     PARM           WPEDCU                          CEU007
      *
      *   - Calculate transaction residual period code 2
     C                     CALL 'ERLURDUR'
     C                     PARM           EXREPD
     C                     PARM           EXREVD
     C                     PARM *ZEROS    EXRDU2
     C                     PARM           VDCCYC
     C                     PARM           WPEDLO                          CEU007
     C                     PARM           WPEDCU                          CEU007
      *
     C           EXLOTD    IFEQ 'GLA'
     C                     Z-ADD05        EXRDU1
     C                     Z-ADD05        EXRDU2           For 1.2 report
     C                     END
      *
      *   - Set up Security description for N.A.P.
     C           EXLOTD    IFEQ 'NAP'
     C                     MOVELEXSECD    EXSECY
     C                     END
      *
      *   - If Revision Date is 0 and End Date different than 0
      *     Setup RDU2 with RDU1.
     C           EXREVD    IFEQ 0                          - B1
     C           EXENDD    ANDNE0
     C                     Z-ADDEXRDU1    EXRDU2
     C                     END                             - E1
      *
      ** NEW DURATION PERIODS FOR IML 1.4
     C                     MOVE EXSTRD    W1STRD  8                       CAD018
     C                     MOVE EXENDD    W1ENDD  8                       CAD018
     C                     CALL 'ERIDUR14'
     C**                   PARM           EXSTRD                          CAD018
     C**                   PARM           EXENDD                          CAD018
     C                     PARM           W1STRD                          CAD018
     C                     PARM           W1ENDD                          CAD018
     C**                   PARM *ZEROS    EXID14                          CAD018
     C           EXID14    PARM *ZEROS    EXID14                          CAD018
     C                     PARM           WPEDLO                          CEU007
     C                     PARM           WPEDCU                          CEU007
      *
     C                     MOVE EXENDD    W1ENDD  8                       CAD018
     C                     MOVE EXREPD    W1REPD  8                       CAD018
     C                     CALL 'ERRDUR14'
     C**                   PARM           EXREPD                          CAD018
     C**                   PARM           EXENDD                          CAD018
     C                     PARM           W1REPD                          CAD018
     C                     PARM           W1ENDD                          CAD018
     C**                   PARM *ZEROS    EXRD14                          CAD018
     C           EXRD14    PARM *ZEROS    EXRD14                          CAD018
      *
      *   - Initialise other detail fields
     C                     EXSR #INZF                      Field init.
      *
      **  Specific processing depending on record type:
      *
      ** For history deal, set the extended detail to initial value.      ULX046C1
      *                                                                   ULX046C1
     C           EXLOTD    IFEQ 'MMD'                                     ULX046C1
     C           ULX046    ANDEQ'Y'                                       ULX046C1
     C           EXAMNT    ANDEQ*ZEROS                                    ULX046C1
      *                                                                   ULX046C1
     C                     Z-ADD*ZEROS    EXREVD                          ULX046C1
     C                     Z-ADD*ZEROS    EXPPSC                          ULX046C1
     C                     Z-ADD*ZEROS    EXCCSZ                          ULX046C1
     C                     Z-ADD*ZEROS    EXCORA                          ULX046C1
     C                     Z-ADD*ZEROS    EXCORT                          ULX046C1
     C                     Z-ADD*ZEROS    EXVOTR                          ULX046C1
     C**********           MOVE *BLANKS   EXTRIN                 ULX046C1 ULX046C2
     C                     MOVE *ZEROS    EXTRIN                          ULX046C2
     C                     Z-ADD*ZEROS    EXEVMT                          ULX046C1
     C                     Z-ADD*ZEROS    EXSWLK                          ULX046C1
     C                     Z-ADD*ZEROS    EXTOVM                          ULX046C1
     C                     Z-ADD*ZEROS    EXIM93                          ULX046C1
     C                     Z-ADD*ZEROS    EXCLAT                          ULX046C1
     C                     MOVE 'N'       EXSUBR                          ULX046C1
     C                     Z-ADD*ZEROS    EXLSAM                          ULX046C1
     C                     MOVE *BLANK    ERROR                           ULX046C1
      *                                                                   ULX046C1
     C                     ENDIF                                          ULX046C1
      *
     C           EXLOTD    IFEQ 'MMD'
     C           ULX046    ANDNE'Y'                                       ULX046C1
     C           EXLOTD    OREQ 'MMD'                                     ULX046C1
     C           ULX046    ANDEQ'Y'                                       ULX046C1
     C           EXAMNT    ANDNE*ZEROS                                    ULX046C1
     C           EXLOTD    OREQ 'NAP'
     C                     CALL 'ERLU64'
     C                     PARM           EXLOTD
     C                     PARM           EXTREF
     C                     PARM           VHFRNI  1
     C                     PARM           EXENDD
     C                     PARM           EXLAMT
     C                     PARM           EXGUAC
     C                     PARM           EXBKCD                          181643
     C                     PARM *ZEROS    EXREVD
     C                     PARM *ZEROS    EXPPSC
     C                     PARM *ZEROS    EXCCSZ
     C                     PARM *ZEROS    EXCORA
     C                     PARM *ZEROS    EXCORT
     C                     PARM *ZEROS    EXVOTR
     C                     PARM *BLANKS   EXTRIN
     C                     PARM *ZEROS    EXEVMT
     C                     PARM *ZEROS    EXSWLK
     C                     PARM *ZEROS    EXTOVM
     C                     PARM *ZEROS    EXIM93
     C                     PARM *ZEROS    EXCLAT
     C                     PARM *BLANKS   EXSUBR
     C                     PARM *ZEROS    EXLSAM
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C                     END
      **
     C           EXLOTD    IFEQ 'LEN'
     C           EXLOTD    OREQ 'PPU'
     C           EXLOTD    OREQ 'PSO'
      *
     C           ULX046    IFNE 'Y'                                       ULX046C1
     C           ULX046    OREQ 'Y'                                       ULX046C1
     C           EXAMNT    ANDNE*ZEROS                                    ULX046C1
      *
     C                     CALL 'ERLU65'
     C                     PARM           EXLOTD
     C                     PARM           EXTREF
     C                     PARM           EXLAMT
     C                     PARM           EXFCUS
     C                     PARM           EXFACT
     C                     PARM           EXFCNO
     C                     PARM           EXGUAC
     C                     PARM *ZEROS    EXPPSC
     C                     PARM *ZEROS    EXCCSZ
     C                     PARM *ZEROS    EXCORA
     C                     PARM *ZEROS    EXIM93
     C                     PARM *ZEROS    EXCLAT
     C                     PARM *ZEROS    EXDGRI
     C                     PARM *BLANKS   EXSUBR
     C                     PARM *ZEROS    EXLSAM
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C                     ELSE                                           ULX046C1
      *                                                                   ULX046C1
      ** For history deal, set the extended detail to initial value.      ULX046C1
      *                                                                   ULX046C1
     C                     Z-ADD*ZEROS    EXPPSC                          ULX046C1
     C                     Z-ADD*ZEROS    EXCCSZ                          ULX046C1
     C                     Z-ADD*ZEROS    EXCORA                          ULX046C1
     C                     Z-ADD*ZEROS    EXIM93                          ULX046C1
     C                     Z-ADD*ZEROS    EXCLAT                          ULX046C1
     C                     Z-ADD*ZEROS    EXDGRI                          ULX046C1
     C                     MOVE 'N'       EXSUBR                          ULX046C1
     C                     Z-ADD*ZEROS    EXLSAM                          ULX046C1
     C                     MOVE *BLANK    ERROR                           ULX046C1
     C                     ENDIF                                          ULX046C1
     C                     END
      *
      ** RE-ACTIVE PROCESSING FOR FACILITIES ===> IML 1.4
     C           EXLOTD    IFEQ 'FCL'
     C           EXFCUS    ANDNE*BLANK
     C           EXFACT    ANDNE*ZERO
     C           EXFCNO    ANDNE*ZERO
     C                     CALL 'ERLU66'
     C                     PARM           EXFCUS  6
     C                     PARM           EXFACT  30
     C                     PARM           EXFCNO  20
     C                     PARM *BLANKS   EXSUBR
     C                     PARM *ZEROS    EXDGRI
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C                     END
      *
     C           EXLOTD    IFEQ 'SEC'
     C                     CALL 'ERLU67'
     C                     PARM           EXBRCD
     C                     PARM           EXTREF
     C                     PARM           EXDECK                          ERL370
     C                     PARM           EXLAMT
     C                     PARM *ZEROS    EXCORA
     C                     PARM *ZEROS    EXCORT
     C                     PARM *ZEROS    EXVOTR
     C                     PARM *BLANKS   EXTRIN
     C                     PARM *ZEROS    EXEVMT
     C                     PARM *ZEROS    EXSWLK
     C                     PARM *ZEROS    EXTOVM
     C                     PARM *ZEROS    EXIM93
     C                     PARM *ZEROS    EXCLAT
     C                     PARM *BLANKS   EXSUBR
     C                     PARM *ZEROS    EXLSAM
     C                     PARM *BLANKS   EXRNKG 15                       ULX004
     C                     PARM *ZEROS    EXQUOT  10       Quoted Ind.    ULX046
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
      *                                                                   225555
     C                     Z-ADDEXDISA    EXOISA                          225555
     C                     Z-ADDEXDPTD    EXOPTD                          225555
     C                     Z-ADDEXFAMT    EXOAMT                          225555
      *                                                                   225555
     C                     END
      *
     C           EXLOTD    IFEQ 'SEF'
      *
     C           EXDRCR    IFEQ 0
     C                     Z-ADD070       EXTOVM
     C                     ELSE
     C                     Z-ADD080       EXTOVM
     C                     END
      *
     C           EXAMNT    IFGE 0                                         225555
     C                     Z-ADD11500000  EXSCHA                          225555
     C                     ELSE                                           225555
     C                     Z-ADD20500000  EXSCHA                          225555
     C                     END                                            225555
      *                                                                   225555
     C                     Z-ADD0         EXOISA                          225555
     C                     Z-ADD0         EXOPTD                          225555
     C                     Z-ADD0         EXOAMT                          225555
     C                     END
      **
     C********** EXLOTD    IFEQ 'CMT'                                                         CER001
     C********** EXLOTD    OREQ 'DRW'                                                         CER001
     C********** EXLOTD    OREQ 'CFL'                                                         CER001
     C**********           CALL 'ERLU68'                                                      CER001
     C**********           PARM           EXLOTD                                              CER001
     C**********           PARM           EXTREF                                              CER001
     C**********           PARM           EXLAMT                                              CER001
     C**********           PARM           EXGUAC                                              CER001
     C**********           PARM *ZEROS    EXPPSC                                              CER001
     C**********           PARM *ZEROS    EXCCSZ                                              CER001
     C**********           PARM *ZEROS    EXCORA                                              CER001
     C**********           PARM *ZEROS    EXIM93                                              CER001
     C**********           PARM *ZEROS    EXCLAT                                              CER001
     C**********           PARM *ZEROS    EXDGRI                                              CER001
     C**********           PARM *BLANKS   EXSUBR                                              CER001
     C**********           PARM *ZEROS    EXLSAM                                              CER001
     C**********           PARM *BLANK    ERROR   1                                           CER001
      **********                                                                              CER001
     C********** ERROR     IFEQ 'Y'                                                           CER001
     C**********           EXSR #DBERR                                                        CER001
     C**********           END                                                                CER001
     C**********           END                                                                CER001
      *
     C           EXLOTD    IFEQ 'DEP'
     C                     CALL 'ERLU69'
      *  Input Parameters
     C                     PARM           EXLOTD
     C                     PARM           EXTREF
     C                     PARM           EXDECK
     C                     PARM           EXSESN
      *  Output Parameters
     C                     PARM *ZEROS    EXTOVM
     C                     PARM *ZEROS    EXEXCF  10                      ULX004
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C                     END
      *
     C           EXLOTD    IFEQ 'GLA'
     C                     CALL 'ERLU70'
      *  Input Parameters
     C                     PARM           EXLOTD
     C                     PARM           EXTREF
     C                     PARM           EXBRCD                          ER_R10
     C                     PARM           EXDRCR
     C                     PARM           EXLAMT
     C                     PARM           EXGUAC
      *  Output Parameters
     C                     PARM *ZEROS    EXDEPT
     C                     PARM *ZEROS    EXIM93
     C                     PARM *ZEROS    EXSHAT
     C                     PARM *ZEROS    EXLSAM
     C                     PARM *ZEROS    EXCORA
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C                     END
      *
      ** SETUP FIELD FOR IML 1.4
     C                     Z-ADD0         EXOPTY
     C           EXLOTD    IFEQ 'OPT'                      - B1
     C           EXSESN    IFEQ OTC,1                      - B2
     C                     Z-ADD1         EXOPTY
     C                     ELSE                            - X2
     C           EXSESN    IFEQ OTC,2                      - B3
     C                     Z-ADD2         EXOPTY
     C                     END                             - E3
     C                     END                             - E2
     C                     END                             - E1
      *
      *
      ** Setup decimal places for 'Correction Amount'
     C           EXCORA    IFNE *ZEROS                     - B1
      *
     C           CONBDP    IFEQ 0                          - B2
     C           EXCORA    MULT 1000      EXCORA
     C                     END                             - E2
     C           CONBDP    IFEQ 1                          - B2
     C           EXCORA    MULT 100       EXCORA
     C                     END                             - E2
     C           CONBDP    IFEQ 2                          - B2
     C           EXCORA    MULT 10        EXCORA
     C                     END                             - E2
      *
      ** Convertion for 'Correction Amount'
     C                     Z-ADDEXCORA    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXCORL
     C                     ELSE                            - X1
     C                     MOVE *ZEROS    EXCORL
     C                     END                             - E1
      *
     C********** EXRECT    IFEQ 003                                       ULX004
     C********** VPOWFA    ANDNE0                                         ULX004
     C********** EXLAMT    DIV  VPOWFA    WWAMNT 153                      ULX004
     C********** WWAMNT    DIV  10        EXFPPC                          ULX004
     C**********           END                                            ULX004
     C                     Z-ADD*ZEROS    EXFPPC                          ULX004
      *
     C           EXECOS    IFNE 1410
     C           EXECOS    ANDNE1421
     C           EXECOS    ANDNE1422
     C           EXECOS    ANDNE1451
     C                     MOVELEXCUCC    WWCNCZ
     C                     END
      *
     C           EXSCHA    IFEQ 10300000                                                  225540
     C           EXSCHA    OREQ 10400000                                                  225540
     C           EXSCHA    OREQ 10600000                                                  225540
      *                                                                                   225540
     C           WWMOBC    IFEQ '1'                                                       225540
     C           WWMOBC    OREQ '2'                                                       225540
      *                                                                                   225540
     C           WWPMOB    IFEQ '1'                                                       225540
     C                     Z-ADD10220000  EXSCHA                                          225540
     C                     ENDIF                                                          225540
      *                                                                                   225540
     C                     ENDIF                                                          225540
      *                                                                                   225540
     C                     ENDIF                                                          225540
      *                                                                                   225540
      *   - Calculate IML Code sub-rubrique
     C                     CALL 'ERLUSA'                   IML Code
     C                     PARM           EXLOTD           sub-rubrique
     C                     PARM           EXSCHA
     C                     PARM           EXECOS
     C                     PARM           EXRDU1
     C                     PARM           EXCUCL
     C                     PARM           EXCONS
     C                     PARM           WWCNCZ
     C                     PARM *ZEROS    TOTSUB  80
     C                     PARM *ZEROS    TOTSU2  80
     C                     PARM *BLANKS   EXZONA
     C                     PARM           EXIDUR                          186714
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
      **
     C           EXLOTD    IFEQ 'NAP'                                     MBFIX
     C           EXLOTD    OREQ 'GLA'                                     MBFIX
     C           EXSCHA    IFGT 10600000                                  MBFIX
     C           EXSCHA    ANDLT10800000                                  MBFIX
     C                     Z-ADD1         EXQUOT                          MBFIX
     C                     ENDIF                                          MBFIX
     C                     ENDIF                                          MBFIX
      **                                                                  MBFIX
     C                     MOVELEXSCHA    SCHA
      *
      ** SETUP FIELDS FROM EUROPEAN REPORTING I.C.D.
     C                     MOVE VPIM14    EXIM14
     C                     Z-ADDVPCRMT    EXCRMT
     C           EXSUBR    IFEQ *BLANKS
     C                     MOVE 'N'       EXSUBR
     C                     END
     C           SCHA11    IFEQ 4
     C           VPCYPR    ANDEQ'Y'
     C                     Z-ADD1         EXIM93
     C                     END
     C*
     C           SCHA16    IFEQ 303112
     C           EXSPFW    ANDEQ'1'
     C                     Z-ADD303152    SCHA16
     C                     END
      *                                                                   ULX048
     C           ULX048    IFEQ 'Y'                                       ULX048
      *                                                                   ULX048
     C           SCHA16    IFEQ 304100                                    ULX048
     C           EXMCID    ANDNE'0'                                       ULX048
      *                                                                   ULX048
     C                     SELEC                                          ULX048
      *                                                                   ULX048
     C           EXMCID    WHEQ '1'                                       ULX048
     C                     Z-ADD304110    SCHA16                          ULX048
      *                                                                   ULX048
     C           EXMCID    WHEQ '2'                                       ULX048
     C                     Z-ADD304120    SCHA16                          ULX048
      *                                                                   ULX048
     C           EXMCID    WHEQ '3'                                       ULX048
     C                     Z-ADD304130    SCHA16                          ULX048
      *                                                                   ULX048
     C           EXMCID    WHEQ '4'                                       ULX048
     C                     Z-ADD304140    SCHA16                          ULX048
      *                                                                   ULX048
     C                     ENDSL                                          ULX048
      *                                                                   ULX048
     C                     ENDIF                                          ULX048
      *                                                                   ULX048
     C                     MOVE SCHA      EXSCHA                          ULX048
      *                                                                   ULX048
     C                     ENDIF                                          ULX048
      *
      ** 'Valeurs fiduciaires'
     C           SCHA16    IFEQ 304200                     - B1
      *
     C           EXDRCR    IFEQ 0                          - B2
      *
     C           EXBNBI    IFEQ 'Y'                        - B3
     C                     Z-ADD1         SCHA78
     C                     ELSE                            - X3
     C                     Z-ADD2         SCHA78
     C                     END                             - E3
      *
     C                     ELSE                            - X2
      *
     C           EXBNBI    IFEQ 'Y'                        - B3
     C                     Z-ADD3         SCHA78
     C                     ELSE                            - X3
     C                     Z-ADD4         SCHA78
     C                     END                             - E3
      *
     C                     END                             - E2
      *
     C                     MOVELSCHA      EXSCHA
     C                     END                             - E1
      **
      *'Opérations de change à terme DEV/(BEF ou LUF) ou (BEF ou LUF)/DEV'
      *
     C           SCHA16    IFEQ 303112                     - B1
     C           SCHA16    OREQ 303130
      *
     C           EXCCY2    IFNE *BLANKS                    - B1.1
      *
     C***********EXCCY2    CHAINERCURRL1             80                   187689
     C           EXCCY2    CHAINSDCURRL1             80                   187689
     C           *IN80     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     MOVEL'609'     DBASE            ***************
     C***********          MOVEL'ERCURRL1'DBFILE                          187689
     C                     MOVEL'SDCURRL1'DBFILE                          187689
     C                     MOVELEXCCY2    DBKEY
     C                     EXSR #DBERR
     C                     ELSE                            - X2
     C***********          MOVELVRSWCY    WWCCY2  3                       187689
     C                     MOVELA6SWCY    WWCCY2  3                       187689
     C                     END                             - E2
      *
     C***********EXCCYL    IFEQ 'BEF'                      - B2           187689
     C***********EXCCYL    OREQ 'LUF'                                     187689
     C***********EXCCYL    OREQ 'ATS'                      175795         187689
     C***********EXCCYL    OREQ 'DEM'                      175795         187689
     C***********EXCCYL    OREQ 'ESP'                      175795         187689
     C***********EXCCYL    OREQ 'FIM'                      175795         187689
     C***********EXCCYL    OREQ 'FRF'                      175795         187689
     C***********EXCCYL    OREQ 'IEP'                      175795         187689
     C***********EXCCYL    OREQ 'ITL'                      175795         187689
     C***********EXCCYL    OREQ 'NLG'                      175795         187689
     C***********EXCCYL    OREQ 'PTE'                      175795         187689
     C***********EXCCYL    OREQ 'EUR'                      175795         187689
     C***********WWCCY2    OREQ 'BEF'                                     187689
     C***********WWCCY2    OREQ 'LUF'                                     187689
     C***********WWCCY2    OREQ 'ATS'                      175795         187689
     C***********WWCCY2    OREQ 'DEM'                      175795         187689
     C***********WWCCY2    OREQ 'ESP'                      175795         187689
     C***********WWCCY2    OREQ 'FIM'                      175795         187689
     C***********WWCCY2    OREQ 'FRF'                      175795         187689
     C***********WWCCY2    OREQ 'IEP'                      175795         187689
     C***********WWCCY2    OREQ 'ITL'                      175795         187689
     C***********WWCCY2    OREQ 'NLG'                      175795         187689
     C***********WWCCY2    OREQ 'PTE'                      175795         187689
     C***********WWCCY2    OREQ 'EUR'                      175795         187689
     C*          WWINCY    IFEQ 'Y'                                187689 223840
     C*          A6INCY    OREQ 'Y'                                187689
     C           EXCCYL    IFEQ 'EUR'                                     223840
     C           WWCCY2    OREQ 'EUR'                                     223840
      *
     C           EXBNBI    IFEQ 'N'                        - B3
      *
     C           EXDRCR    IFEQ 0                          - B4
     C                     Z-ADD1         SCHA78
     C                     ELSE                            - X4
     C                     Z-ADD3         SCHA78
     C                     END                             - E4
      *
     C                     ELSE                            - X3
      *
     C           EXDRCR    IFEQ 0                          - B4
     C                     Z-ADD2         SCHA78
     C                     ELSE                            - X4
     C                     Z-ADD4         SCHA78
     C                     END                             - E4
      *
     C                     END                             - E3
      *
     C                     ELSE                            - X2
      *
      * 'Opérations de change à terme DEV/DEV'
     C           EXBNBI    IFEQ 'N'                        - B3
      *
     C           EXDRCR    IFEQ 0                          - B4
     C                     Z-ADD5         SCHA78
     C                     ELSE                            - X4
     C                     Z-ADD7         SCHA78
     C                     END                             - E4
      *
     C                     ELSE                            - X3
      *
     C           EXDRCR    IFEQ 0                          - B4
     C                     Z-ADD6         SCHA78
     C                     ELSE                            - X4
     C                     Z-ADD8         SCHA78
     C                     END                             - E4
      *
     C                     END                             - E3
      *
     C                     END                             - E2
      *
     C                     MOVELSCHA      EXSCHA
      *
     C                     END                             - E1.1
      *
     C                     END                             - E1
      *
      * Réglement d'opérations au comptant
     C           SCHA16    IFEQ 303152                     - B1
     C           EXDRCR    IFEQ 0                          - B2
     C                     Z-ADD1         SCHA78
     C                     ELSE                            - X2
     C                     Z-ADD2         SCHA78
     C                     END                             - E2
     C                     MOVELSCHA      EXSCHA
     C                     END                             - E1
      *
      * Achats et ventes à terme de valeurs mobilières
     C           SCHA16    IFEQ 302110
     C           SCHA16    OREQ 302210
     C           EXPROT    IFNE '2'                        - B2
     C           EXPROT    ANDNE'4'
     C           EXPROT    ANDNE'7'
     C                     Z-ADD1         SCHA78           * Revenu fixe
     C                     ELSE                            - X2
     C                     Z-ADD2         SCHA78           * Revenu var.
     C                     END                             - E2
     C                     MOVELSCHA      EXSCHA
     C                     END                             - E1
      *
      * For accounts set up with IML code 302400 (marge disponible des
      * lignes de crédit), set the margin amounts equal to the ledger
      * balance amount
     C           SCHA16    IFEQ 302400                     - B1
     C           EXLOTD    ANDEQ'GLA'
     C                     MOVE 002       EXRECT
     C                     MOVE EXAMNT    EXMARA
     C                     MOVE EXLAMT    EXLMAR
     C                     END
      *
      * For rubric IML 101100 (cash), set the country code equal to the
      * currency country code and the economic sector code equal to 4000
      * (required by IML for 2.5 report production)
     C           SCHA16    IFEQ 101100                     - B1
     C****                 MOVELEXCCYL    EXCUCL                          203320
     C****                 MOVEL*BLANKS   EXCUCL                   203320 209275
     C****                 MOVELEXCNCZ    EXCUCL                   203320 209275
     C           EXCCYL    IFEQ 'EUR'                                     209275
     C*                    MOVEL'LU'      EXCUCL                   209275 217912
     C*                    MOVEL'LU'      EXCNCZ                   209275 217912
     C                     MOVEL'XA'      EXCUCL                          217912
     C                     MOVEL'XA'      EXCNCZ                          217912
     C                     ELSE                                           209275
     C                     MOVELEXCCYL    EXCUCL                          209275
     C                     MOVELEXCCYL    EXCNCZ                          209275
     C                     ENDIF                                          209275
     C                     Z-ADD4000      EXECOS
     C                     Z-ADD9000      EXNCOS                          ULX011
     C                     END                             - E1
      *
      **For*the*following IML codes, set the country code to 'XX' and the 142828
      **economic*sector code to 4000 (required by IML for 2.5 report)     142828
     C***********SCHA13    IFEQ 209                        - B1           142828
     C***********SCHA13    OREQ 210                                       142828
     C***********SCHA13    OREQ 211                                       142828
     C***********SCHA13    OREQ 212                                       142828
     C***********SCHA13    OREQ 213                                       142828
     C***********SCHA13    OREQ 214                                       142828
     C***********SCHA13    OREQ 215                                       142828
      ***********                                                         142828
      ***Profit/Loss IML code                                             142828
     C***********SCHA11    OREQ 4                                         142828
      ***********                                                         142828
     C***********          MOVEL'XX'      EXCUCL                          142828
     C***********          Z-ADD4000      EXECOS                          142828
     C***********          Z-ADD9000      EXNCOS                          ULX011
     C***********          END                             - E1           142828
      *
      * For the following IML codes, set the residual duration 1 and 2 to
      * 90 (undefined) (required by IML for 2.5 report)
     C           SCHA13    IFEQ 107                        - B1
     C           SCHA13    OREQ 108
     C           SCHA13    OREQ 109
     C           SCHA13    OREQ 190
     C           SCHA13    OREQ 115
     C           SCHA13    OREQ 205
     C           SCHA13    OREQ 209
     C           SCHA13    OREQ 210
     C           SCHA13    OREQ 211
     C           SCHA13    OREQ 212
     C           SCHA13    OREQ 280
     C           SCHA13    OREQ 281
     C           SCHA13    OREQ 213
     C           SCHA13    OREQ 214
     C           SCHA13    OREQ 215
     C                     Z-ADD90        EXRDU1
     C                     Z-ADD90        EXRDU2
     C                     END                             - E1
      *
      * Setup Net present value (C042 and C043)                           ULX011
      *                                                                   ULX011
      **Market*Value*1*in*FX*Ccy                                   ULX011 ULX047
     C***********EXLOTD    IFEQ 'OPT'                      B2      ULX011 ULX047
     C***********VPOPCM    ANDEQ1                                  ULX011 ULX047
     C***********EXLOTD    OREQ 'OPT'                              ULX011 ULX047
     C***********VPOPCM    ANDEQ3                                  ULX011 ULX047
      ***********                                                  ULX011 ULX047
     C***********EXRSKF    IFNE *ZEROS                     B3      ULX011 ULX047
     C***********          MULT EXRSKF    EXMKT1                   ULX011 ULX047
     C***********          ENDIF                           E3      ULX011 ULX047
     C***********          ENDIF                           E2      ULX011 ULX047
     C***********          Z-ADDEXMKT1    EXNPVA                   ULX011 ULX047
      ***********                                                  ULX011 ULX047
      **Market*Value*1*in*rep.*Ccy                                 ULX011 ULX047
     C*********************Z-ADDEXMKT1    INAMNT                   ULX011 ULX047
      *                                                                   ULX047
      * Net present value in reporting currency                           ULX047
     C           EXDEC2    IFEQ 'RX'                                      ULX047
     C           EXLOTD    OREQ 'FXP'                                     ULX047
     C           EXLOTD    OREQ 'FXS'                                     ULX047
     C                     Z-ADDEXNPVA    EXLNPV                          ULX047
     C                     ELSE                                           ULX047
     C                     Z-ADDEXNPVA    INAMNT                          ULX047
     C                     EXSR CALCON                                    ULX011
     C                     Z-ADDOUTAMT    EXLNPV                          ULX011
     C                     ENDIF                                          ULX047
      *                                                                   ULX011
     C***********EXLOTD    IFEQ 'FXP'                      B2      ULX011 ULX047
     C***********EXLOTD    OREQ 'FXS'                              ULX011 ULX047
     C*                                                                   119467
     C***********EXSPFW    IFEQ '1'                        B3      119467 176762
     C***********EXDTCD    ANDEQ2                                  119467 176762
     C***********          Z-ADD0         EXDTCD                   119467 176762
     C***********          END                             E3      119467 176762
     C***********                                                  ULX011 ULX047
     C***SET*UP*INPUT*FIELDS*FOR*SR/ZFWDRT*:                       ULX011 ULX047
     C***'FROM'*FIELDS*FROM*DEAL*CCY*AND*'TO'*FIELDS*FROM*REPORT.*CULX011 ULX047
     C***********          Z-ADDEXAMNT    ZAMTF                    ULX011 ULX047
     C***********          MOVE EXCCYC    ZCCYF                    ULX011 ULX047
     C***********          MOVE VDCCYC    ZCCYT                    ULX011 ULX047
     C***********          MOVE @@MDI1    ZMDINF                   ULX011 ULX047
     C***********          MOVE @@MDI2    ZMDINT                   ULX011 ULX047
     C***********          Z-ADD@@NBD1    ZCDPF                    ULX011 ULX047
     C***********          Z-ADD@@NBD2    ZCDPT                    ULX011 ULX047
     C***********          Z-ADD@@RAT1    ZSPOTF                   ULX011 ULX047
     C***********          Z-ADD@@RAT2    ZSPOTT                   ULX011 ULX047
     C***********                                                  ULX011 ULX047
     C***********          Z-ADDEXENDD    ZZDTIN                   ULX011 ULX047
     C***********          EXSR ZDAT10                             ULX011 ULX047
     C***********          Z-ADDZZMDNO    ZDATN                    ULX011 ULX047
     C***********                                                  ULX011 ULX047
     C***********          Z-ADDW#REPD    ZRDATE                   ULX011 ULX047
     C***********                                                  ULX011 ULX047
     C***********          EXSR ZFWDRT                             ULX011 ULX047
     C***********                                                  ULX011 ULX047
     C***********          Z-ADDEXAMNT    EXNPVA                   ULX011 ULX047
     C***********EXNPVA    MULT ZCRSRT    EXLNPV                   ULX011 ULX047
     C***********                                                  ULX011 ULX047
     C***********          END                             E2      ULX011 ULX047
      *                                                                   ULX011
      * Setup Unpaid Amount in reporting ccy (C054)                       ULX011
     C           EXOPAM    ADD  EXTOTI    INAMNT                          ULX011
     C                     EXSR CALCON                                    ULX011
     C                     Z-ADDOUTAMT    EXUNPA                          ULX011
      *                                                                   ULX011
     C                     Z-ADD9000      EXISEC                          ULX047
     C                     MOVE 'XX'      EXLISS                          ULX047
     C           EXLOTD    IFEQ 'SEC'                                     ULX047
     C           EXLOTD    OREQ 'SEF'                                     ULX047
     C           EXLOTD    OREQ 'CPO'                                     ULX047
     C           EXLOTD    OREQ 'NPA'                                     ULX047
      *                                                                   ULX047
      * Setup Issuer economic group (C075)                                ULX011
     C                     Z-ADDEXNCOS    EXISEC                          ULX011
      *                                                                   ULX011
      * Setup Issuer country code (C076)                                  ULX011
     C                     MOVELEXCUCL    EXLISS                          ULX011
      *                                                                   ULX047
     C                     ENDIF                                          ULX047
      *                                                                   212077
      * Setup Type of term deposit (C149)                                 212077
     C                     MOVE '00'      EXFWDP                          212077
      *                                                                   ULX011
      * Setup Contract type (C151)                                        ULX011
     C                     Z-ADD0         EXCONT                          ULX011
      *                                                                   187689
     C                     CALL 'ERLU72'                                  187689
     C                     PARM           EXCCYL           SWIFT ccy code 187689
     C                     PARM           EXTP10           Product code   187689
     C                     PARM           EXCONT           Contract type  187689
      *                                                                   189998
     C           EXCONT    IFEQ 1                                         189998
     C           EXCRMT    ANDEQ3                                         189998
     C                     Z-ADD1         EXCRMT                          189998
     C                     END                                            189998
      *                                                                   189998
     C           EXCONT    IFEQ 2                                         189998
     C           EXCRMT    ANDEQ3                                         189998
     C                     Z-ADD2         EXCRMT                          189998
     C                     END                                            189998
      *                                                                   189998
     C           EXCONT    IFEQ 1                                         189998
     C           EXCRMT    ANDEQ4                                         189998
     C                     Z-ADD2         EXCRMT                          189998
     C                     END                                            189998
      *                                                                   189998
     C           EXCONT    IFEQ 2                                         189998
     C           EXCRMT    ANDEQ4                                         189998
     C                     Z-ADD1         EXCRMT                          189998
     C                     END                                            189998
      *                                                                   ULX011
      * Setup Unique Contract ref (C152)                                  ULX011
     C**********           MOVELEXTREF    EXUCOR                   ULX011 ULX047
     C                     MOVE EXRIND    WKRIND                          ULX047
     C                     MOVE *BLANK    WKFILL                          ULX047
     C                     MOVELEXTREF    WKTREF    P                     ULX047
      *                                                                   ULX047
     C           EXRIND    IFEQ 'FXSA'                                    ULX047
     C           EXRIND    OREQ 'FXPU'                                    ULX047
     C                     MOVE 'FXDL'    WKRIND                          ULX047
     C                     MOVE *BLANK    WKTR15                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX047
     C           EXRIND    IFEQ 'SECU'                                    ULX047
     C           EXRIND    OREQ 'SEFU'                                    ULX047
     C           EXRIND    OREQ 'FUTU'                                    ULX047
     C           EXRIND    OREQ 'OPTI'                                    ULX047
     C           EXRIND    OREQ 'GLAC'                                    ULX047
     C                     MOVELEXTREF    EXUCOR                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX011
      * Setup Position (C155)                                             ULX011
     C                     SELEC                                          ULX011
     C           EXCPIN    WHEQ 1                                         ULX011
     C                     MOVEL'C'       EXPOSI                          ULX011
     C           EXCPIN    WHEQ 2                                         ULX011
     C                     MOVEL'P'       EXPOSI                          ULX011
     C                     OTHER                                          ULX011
     C** !!! IF FIX 203320 NOT THERE REPLACE IT BY FIX 212077 !!!         212077
     C** !!! AND DELETE THESE 2 COMMENT LINES                 !!!         212077
     C*****                MOVEL*BLANKS   EXPOSI                   ULX011 203320
     C                     MOVEL'0'       EXPOSI                          203320
     C                     ENDSL                                          ULX011
      *                                                                   ULX011
      * Setup (C149)                                                      212077
     C                     MOVE ' 0'      EXFWDP                          212077
      *                                                                   212077
      * Setup Risk Value (C165)                                           ULX011
     C                     Z-ADD0         EXLSTA                          ULX011
      *                                                                   ULX011
      * Setup Derivatives Coverage type (C175)                            ULX011
     C                     Z-ADD0         EXDCOV                          ULX011
      *                                                                   ULX011
      * Setup Unique Contract of novation/compensation (C176)             ULX011
     C                     MOVEL*BLANKS   EXNOVA                          ULX011
      *                                                                   ULX011
      * Setup Capital requirements for ... (C180)                         ULX011
     C                     Z-ADD0         EXOFOP                          ULX011
      *                                                                   ULX011
      * Setup Capital requirements for ... gamma risk (C181)              ULX011
     C                     Z-ADD0         EXOFGA                          ULX011
      *                                                                   ULX011
      * Setup Capital requirements for ... vega risk (C182)               ULX011
     C                     Z-ADD0         EXOFVE                          ULX011
      * Transfer EXREVL value to EXDGRI                                   ULX024
     C           EXLOTD    IFEQ 'TID'                                     ULX024
     C                     Z-ADDEXREVL    EXDGRI                          ULX024
     C                     ENDIF                                          ULX024
      *
      ** Set up EXDTCD for accrued interest                               182312
     C           EXDTCD    IFEQ 9                                         182312
     C                     Z-ADD0         EXDTCD                          182312
     C                     END                                            182312
      *                                                                   182312
     C           EXPORT    IFEQ 1                                         182312
     C           EXDTCD    ANDEQ0                                         182312
     C                     Z-ADD9         EXDTCD                          182312
     C                     END                                            182312
      *                                                                   187689
      * Transaction intermediary                                          187689
     C                     Z-ADD0         EXTINT                          187689
     C           EXOTCE    IFEQ 2                                         187689
     C                     Z-ADD1         EXTINT                          187689
     C                     END                                            187689
     C           EXOTCE    IFEQ 1                                         187689
     C                     Z-ADD5         EXTINT                          187689
     C                     END                                            187689
      *                                                                   182312
     C           #DETLE    ENDSR
      **
      /EJECT
     C**************************************************************117987169125
     C******                                                        117987169125
     C***SWAPSR - SUBROUTINE TO SAVE SWAP TRADE ACCOUNTS DETAILS    117987169125
     C******                                                        117987169125
     C**************************************************************117987169125
     C******                                                        117987169125
     C******     SWAPSR    BEGSR                                    117987169125
     C******                                                        117987169125
     C******               MOVE EXORIG    WAORIG 20                 117987169125
     C*********************Z-ADDEXSEQN    WASEQN  60         117987 CAD011169125
     C******               MOVE EXLOTD    WALOTD  3                 117987169125
     C******               Z-ADDEXREPP    WAREPP  80                117987169125
     C******               Z-ADDEXREPD    WAREPD  80                117987169125
     C******               MOVE EXRIND    WARIND  4                 117987169125
     C******               MOVE EXBRCD    WABRCD  3                 117987169125
     C******               MOVE EXDECK    WADECK  8                 117987169125
     C******               MOVE EXCCYL    WACCYL  3                 117987169125
     C******               Z-ADDEXOROC    WAOROC  10                117987169125
     C******               MOVE EXORCL    WAORCL  3                 117987169125
     C******               MOVE EXCUCL    WACUCL  3                 117987169125
     C******               MOVE EXCUST    WACUST  6                 117987169125
     C******               Z-ADDEXCONS    WACONS  10                117987169125
     C******               Z-ADDEXREFI    WAREFI  80                117987169125
     C******               Z-ADDEXECOS    WAECOS  40                117987169125
     C******               Z-ADDEXNMDT    WANMDT  60                117987169125
     C******               Z-ADDEXGUAC    WAGUAC  10                117987169125
     C******               MOVE EXGUCL    WAGUCL  3                 117987169125
     C******               Z-ADDEXIDUR    WAIDUR  20                117987169125
     C******               Z-ADDEXRDU1    WARDU1  20                117987169125
     C******               Z-ADDEXRDU2    WARDU2  20                117987169125
     C******               Z-ADDEXSTRD    WASTRD  80                117987169125
     C******               Z-ADDEXENDD    WAENDD  80                117987169125
     C******               Z-ADDEXREVD    WAREVD  80                117987169125
     C******               Z-ADDEXNOMA    WANOMA 160                117987169125
     C******               Z-ADDEXLNOM    WALNOM 160                117987169125
     C******               Z-ADDEXMARA    WAMARA 160                117987169125
     C******               Z-ADDEXLMAR    WALMAR 160                117987169125
     C******               MOVE EXCRNM    WACRNM 20                 117987169125
     C******               MOVE EXGUEC    WAGUEC 40                 117987169125
     C******               Z-ADDEXCCSZ    WACCSZ  10                117987169125
     C******               Z-ADDEXTP10    WATP10  40                117987169125
     C******               Z-ADDEXPPSC    WAPPSC  60                117987169125
     C******               MOVE EXGUCN    WAGUCN  6                 117987169125
     C******               MOVE EXGURN    WAGURN 20                 117987169125
     C******               MOVE EXGUAT    WAGUAT  1                 117987169125
     C******               Z-ADDEXCRET    WACRET  10                117987169125
     C******               MOVE EXCNCZ    WACNCZ  2                 117987169125
     C******               Z-ADDEXDTCD    WADTCD  10                117987169125
     C******               MOVE EXTRIN    WATRIN  1                 117987169125
     C******               Z-ADDEXSECQ    WASECQ  10                117987169125
     C******               Z-ADDEXTOVM    WATOVM  30                117987169125
     C******               MOVE EXSECY    WASECY 45                 117987169125
     C******               Z-ADDEXREAA    WAREAA 160                117987169125
     C******               Z-ADDEXREAL    WAREAL 160                117987169125
     C******               Z-ADDEXNETA    WANETA 160                117987169125
     C******               Z-ADDEXNETL    WANETL 160                117987169125
     C******               MOVE EXSESN    WASESN 10                 117987169125
     C******               Z-ADDEXVOTR    WAVOTR  50                117987169125
     C******               Z-ADDEXCORA    WACORA 160                117987169125
     C******               Z-ADDEXCORL    WACORL 160                117987169125
     C******               Z-ADDEXFPPC    WAFPPC  50                117987169125
     C******               Z-ADDEXEVMT    WAEVMT  10                117987169125
     C******               Z-ADDEXSWLK    WASWLK  10                117987169125
     C******               Z-ADDEXCORT    WACORT  10                117987169125
     C******               Z-ADDEXBCAT    WABCAT  20                117987169125
     C******               Z-ADDEXCGRP    WACGRP  60                117987169125
     C******               MOVE EXFCUS    WAFCUS  6                 117987169125
     C******               Z-ADDEXFACT    WAFACT  30                117987169125
     C******               Z-ADDEXFCNO    WAFCNO  20                117987169125
     C******               MOVE EXDBCT    WADBCT 25                 117987169125
     C******               MOVE EXGUCT    WAGUCT 25                 117987169125
     C******               Z-ADDEXLSEC    WALSEC 160                117987169125
     C******               Z-ADDEXSECA    WASECA 160                117987169125
     C******               Z-ADDEXIM93    WAIM93  10                117987169125
     C******               Z-ADDEXCLAT    WACLAT  10                117987169125
     C******               Z-ADDEXGA14    WAGA14  20                117987169125
     C******               Z-ADDEXDGRI    WADGRI  10                117987169125
     C******               Z-ADDEXNGAL    WANGAL 160                117987169125
     C******               Z-ADDEXNGAM    WANGAM 160                117987169125
     C******               MOVE EXPRFO    WAPRFO  1                 117987169125
     C******               Z-ADDEXSHAT    WASHAT  10                117987169125
     C******               Z-ADDEXID14    WAID14  20                117987169125
     C******               Z-ADDEXRD14    WARD14  20                117987169125
     C******               Z-ADDEXIRTT    WAIRTT  10                117987169125
     C******               Z-ADDEXOPTY    WAOPTY  10                117987169125
     C******               MOVE EXIM14    WAIM14  1                 117987169125
     C******               Z-ADDEXCRMT    WACRMT  10                117987169125
     C******               Z-ADDEXPAPS    WAPAPS  50                117987169125
     C******               Z-ADDEXLSAM    WALSAM 160                117987169125
     C******               MOVE EXSUBR    WASUBR  1                 117987169125
     C******               MOVE EXCLAS    WACLAS  1                 117987169125
     C******               MOVE EXZONA    WAZONA  1                 117987169125
     C******               Z-ADDEXRKCV    WARKCV  50                117987169125
     C******               MOVE EXCGRN    WACGRN 20                 117987169125
     C******               MOVE EXCGLC    WACGLC  2                 117987169125
     C******               MOVE EXPERF    WAPERF  1                 117987169125
     C******               Z-ADDEXFREP    WAFREP  10                117987169125
     C******               Z-ADDEXREPN    WAREPN  50                117987169125
     C******               Z-ADDEXOPAM    WAOPAM 160                117987169125
     C******               Z-ADDEXLPAM    WALPAM 160                117987169125
     C******               Z-ADDEXTOTI    WATOTI 160                117987169125
     C******               Z-ADDEXLTOT    WALTOT 160                117987169125
     C******               Z-ADDEXTINT    WATINT  10                117987169125
     C******               Z-ADDEXIDU2    WAIDU2  20                117987169125
     C******               Z-ADDEXNPVA    WANPVA 160                117987169125
     C******               Z-ADDEXLNPV    WALNPV 160                117987169125
     C******               Z-ADDEXUNPA    WAUNPA 160                117987169125
     C******               Z-ADDEXISEC    WAISEC  40                117987169125
     C******               MOVE EXLISS    WALISS  2                 117987169125
     C******               MOVE EXFWDP    WAFWDP  2                 117987169125
     C******               MOVE EXCONT    WACONT  10                117987169125
     C******               MOVE EXUCOR    WAUCOR 15                 117987169125
     C******               MOVE EXPOSI    WAPOSI  1                 117987169125
     C******               Z-ADDEXLSTA    WALSTA 160                117987169125
     C******               Z-ADDEXDCOV    WADCOV  10                117987169125
     C******               MOVE EXNOVA    WANOVA 15                 117987169125
     C******               Z-ADDEXOFOP    WAOFOP 160                117987169125
     C******               Z-ADDEXOFGA    WAOFGA 160                117987169125
     C******               Z-ADDEXOFVE    WAOFVE 160                117987169125
     C******               ENDSR                                    117987169125
      *****/EJECT                                                   117987169125
     C**************************************************************117987169125
     C******                                                        117987169125
     C***SWAP - TO OUTPUT SWAP DETAILS                              117987169125
     C******                                                        117987169125
     C**************************************************************117987169125
     C******                                                        117987169125
     C******     SWAP      BEGSR                                    117987169125
     C******                                                        117987169125
     C******     LULAMT    IFNE *ZEROS                     - B1     117987169125
     C******                                                        117987169125
     C******               Z-ADD1         EXRECT                    117987169125
     C******               MOVE WAORIG    EXORIG                    117987169125
     C*********************Z-ADDWASEQN    EXSEQN                   117987 CAD011
     C******               MOVE WALOTD    EXLOTD                    117987169125
     C******               Z-ADDWAREPP    EXREPP                    117987169125
     C******               Z-ADDWAREPD    EXREPD                    117987169125
     C******               MOVE WARIND    EXRIND                    117987169125
     C******               MOVE WABRCD    EXBRCD                    117987169125
     C******               MOVE WADECK    EXDECK                    117987169125
     C*********************MOVE WACCYL    EXCCYL             117987 CAD017169125
     C******               MOVE VDCCYL    EXCCYL                    CAD017169125
     C******               Z-ADDWAOROC    EXOROC                    117987169125
     C******               MOVE WAORCL    EXORCL                    117987169125
     C******               MOVE WACUCL    EXCUCL                    117987169125
     C******               MOVE WACUST    EXCUST                    117987169125
     C******               Z-ADDWACONS    EXCONS                    117987169125
     C******               Z-ADDWAREFI    EXREFI                    117987169125
     C******               Z-ADDWAECOS    EXECOS                    117987169125
     C******               Z-ADDWANMDT    EXNMDT                    117987169125
     C******               Z-ADDWAGUAC    EXGUAC                    117987169125
     C******               MOVE WAGUCL    EXGUCL                    117987169125
     C******               Z-ADDWAIDUR    EXIDUR                    117987169125
     C******               Z-ADDWARDU1    EXRDU1                    117987169125
     C******               Z-ADDWARDU2    EXRDU2                    117987169125
     C******               Z-ADDWASTRD    EXSTRD                    117987169125
     C******               Z-ADDWAENDD    EXENDD                    117987169125
     C******               Z-ADDWAREVD    EXREVD                    117987169125
     C******               Z-ADDWANOMA    EXNOMA                    117987169125
     C******               Z-ADDWALNOM    EXLNOM                    117987169125
     C******               Z-ADDWAMARA    EXMARA                    117987169125
     C******               Z-ADDWALMAR    EXLMAR                    117987169125
     C******               MOVE WACRNM    EXCRNM                    117987169125
     C******               MOVE WAGUEC    EXGUEC                    117987169125
     C******               Z-ADDWACCSZ    EXCCSZ                    117987169125
     C******               Z-ADDWATP10    EXTP10                    117987169125
     C******               Z-ADDWAPPSC    EXPPSC                    117987169125
     C******               MOVE WAGUCN    EXGUCN                    117987169125
     C******               MOVE WAGURN    EXGURN                    117987169125
     C******               MOVE WAGUAT    EXGUAT                    117987169125
     C******               Z-ADDWACRET    EXCRET                    117987169125
     C******               MOVE WACNCZ    EXCNCZ                    117987169125
     C******               Z-ADDWADTCD    EXDTCD                    117987169125
     C******               MOVE WATRIN    EXTRIN                    117987169125
     C******               Z-ADDWASECQ    EXSECQ                    117987169125
     C******               Z-ADDWATOVM    EXTOVM                    117987169125
     C******               MOVE WASECY    EXSECY                    117987169125
     C******               Z-ADDWAREAA    EXREAA                    117987169125
     C******               Z-ADDWAREAL    EXREAL                    117987169125
     C******               Z-ADDWANETA    EXNETA                    117987169125
     C******               Z-ADDWANETL    EXNETL                    117987169125
     C******               MOVE WASESN    EXSESN                    117987169125
     C******               Z-ADDWAVOTR    EXVOTR                    117987169125
     C******               Z-ADDWACORA    EXCORA                    117987169125
     C******               Z-ADDWACORL    EXCORL                    117987169125
     C******               Z-ADDWAFPPC    EXFPPC                    117987169125
     C******               Z-ADDWAEVMT    EXEVMT                    117987169125
     C******               Z-ADDWASWLK    EXSWLK                    117987169125
     C******               Z-ADDWACORT    EXCORT                    117987169125
     C******               Z-ADDWABCAT    EXBCAT                    117987169125
     C******               Z-ADDWACGRP    EXCGRP                    117987169125
     C******               MOVE WAFCUS    EXFCUS                    117987169125
     C******               Z-ADDWAFACT    EXFACT                    117987169125
     C******               Z-ADDWAFCNO    EXFCNO                    117987169125
     C******               MOVE WADBCT    EXDBCT                    117987169125
     C******               MOVE WAGUCT    EXGUCT                    117987169125
     C******               Z-ADDWALSEC    EXLSEC                    117987169125
     C******               Z-ADDWASECA    EXSECA                    117987169125
     C******               Z-ADDWAIM93    EXIM93                    117987169125
     C******               Z-ADDWACLAT    EXCLAT                    117987169125
     C******               Z-ADDWAGA14    EXGA14                    117987169125
     C******               Z-ADDWADGRI    EXDGRI                    117987169125
     C******               Z-ADDWANGAL    EXNGAL                    117987169125
     C******               Z-ADDWANGAM    EXNGAM                    117987169125
     C******               MOVE WAPRFO    EXPRFO                    117987169125
     C******               Z-ADDWASHAT    EXSHAT                    117987169125
     C******               Z-ADDWAID14    EXID14                    117987169125
     C******               Z-ADDWARD14    EXRD14                    117987169125
     C******               Z-ADDWAIRTT    EXIRTT                    117987169125
     C******               Z-ADDWAOPTY    EXOPTY                    117987169125
     C******               MOVE WAIM14    EXIM14                    117987169125
     C******               Z-ADDWACRMT    EXCRMT                    117987169125
     C******               Z-ADDWAPAPS    EXPAPS                    117987169125
     C******               Z-ADDWALSAM    EXLSAM                    117987169125
     C******               MOVE WASUBR    EXSUBR                    117987169125
     C******               MOVE WACLAS    EXCLAS                    117987169125
     C******               MOVE WAZONA    EXZONA                    117987169125
     C******               Z-ADDWARKCV    EXRKCV                    117987169125
     C******               MOVE WACGRN    EXCGRN                    117987169125
     C******               MOVE WACGLC    EXCGLC                    117987169125
     C******               MOVE WAPERF    EXPERF                    117987169125
     C******               Z-ADDWAFREP    EXFREP                    117987169125
     C******               Z-ADDWAREPN    EXREPN                    117987169125
     C******               Z-ADDWAOPAM    EXOPAM                    117987169125
     C******               Z-ADDWALPAM    EXLPAM                    117987169125
     C******               Z-ADDWATOTI    EXTOTI                    117987169125
     C******               Z-ADDWALTOT    EXLTOT                    117987169125
     C******               Z-ADDWATINT    EXTINT                    117987169125
     C******               Z-ADDWAIDU2    EXIDU2                    117987169125
     C******               Z-ADDWANPVA    EXNPVA                    117987169125
     C******               Z-ADDWALNPV    EXLNPV                    117987169125
     C******               Z-ADDWAUNPA    EXUNPA                    117987169125
     C******               Z-ADDWAISEC    EXISEC                    117987169125
     C******               MOVE WALISS    EXLISS                    117987169125
     C******               MOVE WAFWDP    EXFWDP                    117987169125
     C******               MOVE WACONT    EXCONT                    117987169125
     C******               MOVE WAUCOR    EXUCOR                    117987169125
     C******               MOVE WAPOSI    EXPOSI                    117987169125
     C******               Z-ADDWALSTA    EXLSTA                    117987169125
     C******               Z-ADDWADCOV    EXDCOV                    117987169125
     C******               MOVE WANOVA    EXNOVA                    117987169125
     C******               Z-ADDWAOFOP    EXOFOP                    117987169125
     C******               Z-ADDWAOFGA    EXOFGA                    117987169125
     C******               Z-ADDWAOFVE    EXOFVE                    117987169125
     C******                                                        117987169125
     C******     LULAMT    IFLT *ZEROS                     - B2     117987169125
     C******               Z-ADD1         EXDRCR                    117987169125
     C******               Z-SUBLULAMT    EXAMNT                    117987169125
     C******               Z-SUBLULAMT    EXLAMT                    117987169125
     C******               ELSE                            - X2     117987169125
     C******               Z-ADD0         EXDRCR                    117987169125
     C******               Z-ADDLULAMT    EXAMNT                    117987169125
     C******               Z-ADDLULAMT    EXLAMT                    117987169125
     C******               END                             - E2     117987169125
     C******                                                        117987169125
     C***RETRIEVE IML 1.1 CODE                                      117987169125
     C******               CALL 'ERLU62'                            117987169125
     C******               PARM           EXLOTD                    117987169125
     C******               PARM           EXDECK                    117987169125
     C******               PARM           EXDRCR                    117987169125
     C******               PARM           EXCCYC                    117987169125
     C******               PARM *ZEROS    EXSCHA                    117987169125
     C******               PARM *BLANK    EXEXTT                    117987169125
     C******               PARM *ZEROS    VHFRNI                    117987169125
     C******               PARM *BLANKS   EXAMTY                    117987169125
     C******               PARM *ZEROS    EXDEPT                    117987169125
     C******               PARM           EXPORT  10                117987169125
     C******               PARM *BLANK    ERROR   1                 117987169125
     C******               PARM           EXTP10                    ULX004169125
     C******                                                        117987117987
     C******     EXSCHA    IFNE *ZEROS                      - B2    117987169125
     C******                                                        117987169125
     C***Setup Sequential Counter                                   117987169125
     C******               ADD  1         EXSEQN                    117987169125
     C******                                                        117987169125
     C******               WRITEERLUTRF0               80           117987169125
     C******                                                        117987169125
     C******               END                              - E2    117987169125
     C******                                                        117987169125
     C******               END                              - E1    117987169125
     C******                                                        117987169125
     C******               ENDSR                                    117987169125
     C******                                                        117987169125
     C**************************************************************117987169125
     C******/EJECT                                                  117987169125
      **=================================================================
      **
      **  #INZF       Initialisation of detail fields
      **
      *-----------------------------------------------------------
     C           #INZF     BEGSR
      *-----------------------------------------------------------
      *                                                                ***
     C                     MOVE *ZEROS    EXCORA
     C                     MOVE *ZERO     EXGUAC
     C                     MOVE '0'       EXGUAT
     C                     MOVE *BLANK    EXGUCL
     C                     Z-ADD0         EXGA14
     C*
     C                     MOVE *BLANKS   EXGUCN
     C                     MOVE *BLANKS   EXGURN
     C                     Z-ADD4000      EXGUEC
     C*********************Z-ADD0         EXTP10                          187689
     C** Deposit type
     C                     MOVE *ZERO     EXDEPT
      **
     C** Convert amounts into local currency amt
     C                     Z-ADDEXAMNT    INAMNT 160
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXLAMT
      **
     C           EXNOMA    IFNE *ZERO
     C                     Z-ADDEXNOMA    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXLNOM
     C                     ELSE
     C                     MOVE *ZEROS    EXLNOM
     C                     END
      **
     C           EXMARA    IFNE *ZERO
     C                     Z-ADDEXMARA    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXLMAR
     C                     ELSE
     C                     MOVE *ZEROS    EXLMAR
     C                     END
      **
     C           EXNETA    IFNE *ZERO                      - B1
     C                     Z-ADDEXNETA    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXNETL
     C                     ELSE                            - X1
     C                     MOVE *ZEROS    EXNETL
     C                     END                             - E1
      **
     C           EXREAA    IFNE *ZERO                      - B1
     C                     Z-ADDEXREAA    INAMNT
     C                     EXSR CALCON
     C                     Z-ADDOUTAMT    EXREAL
     C                     ELSE                            - X1
     C                     MOVE *ZEROS    EXREAL
     C                     END                             - E1
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
      ** BCL Item Number                                                  ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXBCIT           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** BCL Economic Sector code                                         ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXBCEC           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** Quoted Security Indicator - Initialisation                       ULX046
      *                                                                   ULX046
      ** This field will be filled by the call of ERLU67.                 ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXQUOT           Initialisation ULX046
      *                                                                   ULX046
      ** BCL Economic Sector Code of the Issuer of Securities             ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXBCEI           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** New Deposit/Credit Indicator                                     ULX046
      *                                                                   ULX046
     C                     Z-ADDEXNWDC    EXNWDC                          ULX046
      *                                                                   ULX046
      ** Interest Rate Fixing Period                                      ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXIRFP           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** Interest Rate Starting Date                                      ULX046
      *                                                                   ULX046
     C                     Z-ADDEXIRSD    EXIRSD                          ULX046
      *                                                                   ULX046
      ** Interest Rate Ending Date                                        ULX046
      *                                                                   ULX046
     C                     Z-ADDEXIRED    EXIRED                          ULX046
      *                                                                   ULX046
      ** TCA Interest Rate                                                ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXTCAR           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** TAEG Interest Rate                                               ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXTAEG           FIRE Calcul.   ULX046
      *                                                                   ULX046
      ** Amount in Capital Currency to be Reported on S1.5                ULX046
      *                                                                   ULX046
     C           EXTOTA    IFNE *ZEROS                                    ULX046
     C                     Z-ADDEXTOTA    INAMNT                          ULX046
     C                     EXSR CALCON                                    ULX046
     C                     Z-ADDOUTAMT    WWTOTA                          ULX046
     C                     ELSE                                           ULX046
     C                     Z-ADD*ZEROS    WWTOTA                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Net Credit Amount in Capital  Currency.                          ULX046
      *                                                                   ULX046
     C           EXNCRA    IFNE *ZEROS                                    ULX046
     C                     Z-ADDEXNCRA    INAMNT                          ULX046
     C                     EXSR CALCON                                    ULX046
     C                     Z-ADDOUTAMT    EXLNCR                          ULX046
     C                     ELSE                                           ULX046
     C                     Z-ADD*ZEROS    EXLNCR                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** Unique Contract Reference                                        ULX046
      *                                                                   ULX046
     C                     MOVELEXCTRF    EXCTRF                          ULX046
      *                                                                   ULX046
      ** Annual  Interest Rate                                            ULX046
      *                                                                   ULX046
     C                     Z-ADDEXANIR    EXANIR                          ULX046
      *                                                                   ULX046
      ** Number of Capitalisation/Reimbursements Periods                  ULX046
      *                                                                   ULX046
     C                     Z-ADDEXNCAP    EXNCAP                          ULX046
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
      ** If the feature is not installed, clear corresponding fields      ULX046
      *                                                                   ULX046
     C           ULX046    IFNE 'Y'                                       ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXBCIT                          ULX046
     C                     Z-ADD*ZEROS    EXBCEC                          ULX046
     C                     Z-ADD*ZEROS    EXQUOT                          ULX046
     C                     Z-ADD*ZEROS    EXBCEI                          ULX046
     C                     Z-ADD*ZEROS    EXNWDC                          ULX046
     C                     Z-ADD*ZEROS    EXIRFP                          ULX046
     C                     Z-ADD*ZEROS    EXIRSD                          ULX046
     C                     Z-ADD*ZEROS    EXIRED                          ULX046
     C                     Z-ADD*ZEROS    EXTCAR                          ULX046
     C                     Z-ADD*ZEROS    EXTAEG                          ULX046
     C                     Z-ADD*ZEROS    EXQSTK                          ULX046
     C                     Z-ADD*ZEROS    EXMFQS                          ULX046
     C                     Z-ADD*ZEROS    EXDISC                          ULX046
     C                     Z-ADD*ZEROS    EXLS15                          ULX046
     C                     MOVE *BLANKS   EXCTRF                          ULX046
     C                     Z-ADD*ZEROS    EXANIR                          ULX046
     C                     Z-ADD*ZEROS    EXNCAP                          ULX046
     C                     Z-ADD*ZEROS    EXLNCR                          ULX046
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      **
     C                     ENDSR
      **
      /EJECT
     C*================================================================
      **
      **  #WDTL       Write detail record to output file
      **
      *-----------------------------------------------------------
     C           #WDTL     BEGSR
      *-----------------------------------------------------------
      * Save EXECOS (Old Economic sector) and output the new one          ULX011
     C                     Z-ADDEXECOS    SVECOS  40                      ULX011
     C                     Z-ADDEXNCOS    EXECOS                          ULX011
      *                                                                   187689
     C                     SELEC                                          187689
      *                                                                   187689
     C           EXSMRS    WHEQ *BLANKS                                   187689
     C                     MOVE EXECOS    EXECO6                          187689
     C                     MOVEL'00'      EXECO6                          187689
      *                                                                   187689
     C           EXSMRS    WHEQ 'Y'                                       187689
     C                     MOVE '01'      EXECO6                          187689
     C                     MOVELEXECOS    EXECO6                          187689
      *                                                                   187689
     C           EXSMRS    WHEQ 'N'                                       187689
     C                     MOVE '02'      EXECO6                          187689
     C                     MOVELEXECOS    EXECO6                          187689
      *                                                                   187689
     C                     ENDSL                                          187689
      *                                                                   187689
     C           EXECOS    IFEQ 9000                                      187689
     C                     MOVE EXECOS    EXECO6                          187689
     C                     MOVEL'00'      EXECO6                          187689
     C                     ENDIF                                          187689
      *                                                                   187689
      ***  Default Field C090 (Purchase/Sale) to 'N'                      187689
      *                                                                   187689
     C*********************MOVE 'N'       EXPUSA           Net            187689
      ***********                                                         187689
     C***********EXLOTD    IFEQ 'FXP'                                     187689
     C***********EXLOTD    OREQ 'FXS'                                     187689
     C***********EXLOTD    OREQ 'IRS'                                     187689
      *                                                                   212511
     C                     MOVE 'N'       EXPUSA           Net            212511
      *                                                                   212511
     C***********EXLOTD    IFEQ 'FXP'                              212511 ULX047
     C***********EXLOTD    OREQ 'FXS'                              212511 ULX047
     C***********EXLOTD    OREQ 'IRS'                              212511 ULX047
     C***********EXLOTD    OREQ 'OPT'                              212511 ULX047
     C           SCHA16    IFEQ 302700                                    ULX047
     C           SCHA16    OREQ 303112                                    ULX047
     C           SCHA16    OREQ 303122                                    ULX047
     C           SCHA16    OREQ 303130                                    ULX047
     C           SCHA16    OREQ 303152                                    ULX047
     C           SCHA16    OREQ 303210                                    ULX047
     C           SCHA16    OREQ 303231                                    ULX047
     C           SCHA16    OREQ 303232                                    ULX047
     C           SCHA16    OREQ 301310                                    217943
     C           SCHA16    OREQ 301320                                    217943
     C           SCHA16    OREQ 301330                                    217943
     C           SCHA16    OREQ 301340                                    217943
      *                                                                   187689
     C           EXDRCR    IFEQ 0                                         187689
     C                     MOVE 'A'       EXPUSA           Purchase       187689
     C                     ELSE                                           187689
     C                     MOVE 'V'       EXPUSA           Sale           187689
     C                     ENDIF                                          187689
     C******************   ENDIF                                    ULX047212511
     C                     ENDIF                                          ULX047
      *                                                                   194921
      ** Category of security must be filled in for all records           194921
     C           EXBKCD    IFNE *BLANK                                    194921
      *                                                                   194921
     C********** EXBKCD    CHAINSDBOOKX4             80                                194921 CER001
     C           EXBKCD    CHAINSDBKX3PD             80                                       CER001
     C           *IN80     IFEQ '1'                        - B1           194921
     C           *LOCK     IN   LDA                                       194921
     C                     MOVEL'672'     DBASE                           194921
     C**********           MOVEL'SDBOOKX4'DBFILE                                       194921 CER001
     C                     MOVEL'SDBKX3PD'DBFILE                                       194921 CER001
     C                     MOVELEXBKCD    DBKEY                           194921
     C                     EXSR #DBERR                                    194921
     C                     END                             - E1           194921
      *                                                                   194921
     C           WCTRIN    IFEQ 'F'                        - B1           194921
     C                     MOVE '1'       EXTRIN                          194921
     C                     ENDIF                           - E1           194921
     C           WCTRIN    IFEQ 'T'                        - B1           194921
     C                     MOVE '2'       EXTRIN                          194921
     C                     ENDIF                           - E1           194921
     C           WCTRIN    IFEQ 'I'                        - B1           194921
     C                     MOVE '3'       EXTRIN                          194921
     C                     ENDIF                           - E1           194921
      *                                                                   194921
     C                     ENDIF                                          194921
      *                                                                   187689
     C*********************ENDIF                                          187689
      *
      ** Save details of Swap Trade Accounts records                      117987
      *                                                                   117987
     C***********EXLOTD    IFEQ 'GLA'                       - B11  117987 CAD021
     C***********WWACOD    ANDEQBNSWTA                             117987 CAD021
      ***********                                                  117987 CAD021
     C***********WWSWAP    IFNE 'Y'                         - B21  117987 CAD021
     C***********          EXSR SWAPSR                             117987 CAD021
     C***********          MOVE 'Y'       WWSWAP  1                117987 CAD021
     C***********          END                              - E21  117987 CAD021
      ***********                                                  117987 CAD021
      ***Cumulate amounts in total fields output at LR             117987 CAD021
      ***********                                                  117987 CAD021
     C***********EXDRCR    IFEQ 1                           - B21  117987 CAD021
     C***********          SUB  EXLAMT    LULAMT 160               117987 CAD021
     C***********          ELSE                             - X21  117987 CAD021
     C***********          ADD  EXLAMT    LULAMT                   117987 CAD021
     C***********          END                              - E21  117987 CAD021
      ***********                                                  117987 CAD021
     C***********          ELSE                             - X11  117987 CAD021
      ***********                                                  117987 CAD021
     C           EXSUBR    IFEQ 'Y'                                       ULX011
     C                     Z-ADD1         EXCLAT                          ULX011
     C                     END                                            ULX011
     C*                                                                   ULX011
     C           EXGUAC    IFEQ 5
     C                     MOVEL'C'       EXGUAT
     C                     END
      *                                                                   141872
     C           EXLOTD    IFEQ 'OPT'                                     141872
     C           EXLOTD    OREQ 'FTR'                                     141872
     C                     Z-ADD1         EXDRCR                          141872
     C                     END                                            141872
      *
      ** RE-setup Guarantee Code (0,1,2,3,4,5 => 0,1,2,2,3,0)
     C                     Z-ADD0         EXGUAC
      *
     C***********EXLOTD    IFEQ 'LEN'                                     GUARPT
     C***********EXLOTD    OREQ 'PPU'                                     GUARPT
     C*********************MOVE WWFREP    EXNMDT                          GUARPT
     C*********************MOVE *BLANK    WWFREP                          GUARPT
     C*********************MOVELWWREPN    EXNMDT                          GUARPT
     C*********************MOVE *BLANK    WWREPN                          GUARPT
     C*********************END                                            GUARPT
     C           EXLOTD    IFEQ 'DRW'                                     103422
     C                     MOVE W1FREP    EXNMDT                          103422
     C                     MOVE *BLANK    W1FREP                          103422
     C                     MOVELW1REPN    EXNMDT                          103422
     C                     MOVE *BLANK    W1REPN                          103422
     C                     END                                            103422
      *
     C                     MOVE XXCNCZ    EXCNCZ                          213111
      *
      ** Setup Origine of record
     C                     MOVEL*BLANKS   EXORIG
     C                     MOVE EXTREF    EXORIG
     C                     MOVELEXRIND    EXORIG
     C*
     C***SET*RECORD*TYPE*TO*6*WHEN*1**                                    ULX004
     C                     MOVE EXEXTT    WWEXTT  1
     C********** EXRECT    IFEQ 001                         - B1          ULX004
     C********** EXEXTT    ANDEQ'Y'                                       ULX004
     C**********           Z-ADD6         EXRECT                          ULX004
     C**********           END                              - E1          ULX004
     C           EXRECT    IFEQ 002                         - B1          ULX004
     C           EXRECT    OREQ 003                                       ULX004
     C           EXEXTT    ANDEQ'Y'                                       ULX004
     C           EXRECT    OREQ 006                                       ULX004
     C                     Z-ADD1         EXRECT                          ULX004
     C                     ENDIF                            - E1          ULX004
     C*
     C********** EXRECT    IFEQ 006                         - B1          ULX004
     C**********           MOVE 'N'       EXEXTT                          ULX004
     C**********           END                              - E1          ULX004
     C           EXRECT    IFEQ 001                         - B1          ULX004
     C                     MOVE 'N'       EXEXTT                          ULX004
     C                     END                              - E1          ULX004
     C*
     C** GENERATE GLOBAL RECORDS BEFORE 'DONT' RECORD
     C           TOTSUB    IFNE *ZEROS
     C           TOTSUB    ANDLTEXSCHA
     C                     Z-ADDEXSCHA    WKSCHA  80
     C                     Z-ADDTOTSUB    EXSCHA
     C                     Z-ADDWKSCHA    TOTSUB
     C                     END
     C*
     C                     Z-ADDEXSCHA    W2SCHA  80
     C*
     C***********          ADD  1         EXSEQN                          ULX004
      *
      ** SET UP CONSUMER CREDIT DETAILS BEFORE FIRST WRITE
     C********             MOVE EXAMTY    WWAMTY  1                ULX011 ULX046
     C                     Z-ADDEXAMTY    WWAMTY  20                      ULX046
     C           EXGUAT    IFEQ 'C'                         - B3
     C                     MOVE '0'       EXGUAC
     C                     MOVE '0'       EXGUAT
     C*********************MOVE '3'       EXAMTY                          ULX011
     C********             MOVE '2'       EXAMTY                   ULX011 ULX046
     C                     Z-ADD2         EXAMTY                          ULX046
     C                     END                              - E3
     C*                                                                   186712
      ** Change Term to sight when required                               186712
     C*                                                                   186712
     C********   EXAMTY    IFEQ '8'                         - B1   186712 ULX046
     C           EXAMTY    IFEQ 8                           - B1          ULX046
     C           EXSTRD    ANDNE0                                         186712
     C           EXENDD    ANDNE0                                         186712
      *                                                                   186712
     C                     Z-ADDEXSTRD    ZZDTIN                          186712
     C                     EXSR ZDAT10                                    186712
     C                     Z-ADDZZMDNO    ZDAYNO                          186712
      *                                                                   186712
     C                     Z-ADD1         ZNRDYS                          186712
     C                     MOVE EXCCYC    ZCCY                            186712
     C                     MOVE *BLANKS   ZLOC                            186712
     C                     EXSR ZFWDT                                     186712
     C                     Z-ADDZDYNBR    SPOT    50                      186712
      *                                                                   186712
     C                     Z-ADDEXENDD    ZZDTIN                          186712
     C                     EXSR ZDAT10                                    186712
     C                     Z-ADDZZMDNO    ENDD    50                      186712
      *                                                                   186712
     C           ENDD      IFLE SPOT                        - B2          186712
     C*******              MOVE '6'       EXAMTY                   186712 ULX046
     C                     Z-ADD6         EXAMTY                          ULX046
     C                     END                              - E2          186712
      *                                                                   186712
     C                     END                              - E1          186712
      *                                                                   CAD021
      ** Save details of Swap Trade Accounts records                      CAD021
      *                                                                   CAD021
     C******     EXLOTD    IFEQ 'GLA'                       - B11   CAD021169125
     C******     WWACOD    ANDEQBNSWTA                              CAD021169125
      ******                                                        CAD021169125
     C******     WWSWAP    IFNE 'Y'                         - B21   CAD021169125
     C******               EXSR SWAPSR                              CAD021169125
     C******               MOVE 'Y'       WWSWAP  1                 CAD021169125
     C******               END                              - E21   CAD021169125
      ******                                                        CAD021169125
      ***Cumulate amounts in total fields output at LR              CAD021169125
      ******                                                        CAD021169125
     C******     EXDRCR    IFEQ 1                           - B21   CAD021169125
     C******               SUB  EXLAMT    LULAMT 160                CAD021169125
     C******               ELSE                             - X21   CAD021169125
     C******               ADD  EXLAMT    LULAMT                    CAD021169125
     C******               END                              - E21   CAD021169125
      ******                                                        CAD021169125
     C******               ELSE                             - X11   CAD021169125
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
     C           EXLOTD    ANDEQ'CPO'                      Customer Posit.ULX046
      *                                                                   ULX046C3
      ** Set the issuer detail                                            ULX046C3
      *                                                                   ULX046C3
     C                     CALL 'ERLU73'                                  ULX046C3
     C                     PARM           EXISSR                          ULX046C3
     C                     PARM           EXISLC                          ULX046C3
     C                     PARM *ZEROS    EXISEC                          ULX046C3
     C                     PARM *BLANKS   EXLISS                          ULX046C3
     C                     PARM           ERROR                           ULX046C3
      *                                                                   ULX046C3
     C           ERROR     IFEQ 'Y'                                       ULX046C3
     C                     EXSR #DBERR                                    ULX046C3
     C                     ENDIF                                          ULX046C3
      *                                                                   ULX046
      ** Set the amount type according the investment processing type     ULX046
      *                                                                   ULX046
     C                     SELEC                                          ULX046
     C           EXLEVL    WHEQ '1'                                       ULX046
     C           EXLEVL    OREQ '3'                                       ULX046
     C           EXLEVL    OREQ '5'                                       ULX046
     C           EXLEVL    OREQ '6'                                       ULX046
     C                     Z-ADD3         EXAMTY                          ULX046
     C           EXLEVL    WHEQ '4'                                       ULX046
     C                     Z-ADD5         EXAMTY                          ULX046
     C           EXLEVL    WHEQ '7'                                       ULX046
     C           EXISEC    IFEQ 5100                                      ULX046C3
     C           EXISEC    OREQ 5201                                      ULX046C3
     C           EXISEC    OREQ 5202                                      ULX046C3
     C           EXISEC    OREQ 5203                                      ULX046C3
     C                     Z-ADD10        EXAMTY                          ULX046
     C                     ELSE                                           ULX046C3
     C                     Z-ADD11        EXAMTY                          ULX046C3
     C                     ENDIF                                          ULX046C3
     C                     ENDSL                                          ULX046
      *                                                                   ULX046
      ***Set*the*issuer*detail                                     ULX046 ULX046C3
      ***********                                                  ULX046 ULX046C3
     C***********          CALL 'ERLU73'                           ULX046 ULX046C3
     C***********          PARM           EXISSR                   ULX046 ULX046C3
     C***********          PARM           EXISLC                   ULX046 ULX046C3
     C***********          PARM *ZEROS    EXISEC                   ULX046 ULX046C3
     C***********          PARM *BLANKS   EXLISS                   ULX046 ULX046C3
     C***********          PARM           ERROR                    ULX046 ULX046C3
      ***********                                                  ULX046 ULX046C3
     C***********ERROR     IFEQ 'Y'                                ULX046 ULX046C3
     C***********          EXSR #DBERR                             ULX046 ULX046C3
     C***********          ENDIF                                   ULX046 ULX046C3
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046C3
     C           ULX046    IFEQ 'Y'                                       ULX046C3
     C           EXLOTD    ANDEQ'SEC'                      Book Positions ULX046C3
      *                                                                   ULX046C3
     C           EXISEC    IFNE 5100                                      ULX046C3
     C           EXISEC    ANDNE5201                                      ULX046C3
     C           EXISEC    ANDNE5202                                      ULX046C3
     C           EXISEC    ANDNE5203                                      ULX046C3
     C           EXAMTY    ANDEQ10                                        ULX046C3
     C                     Z-ADD11        EXAMTY                          ULX046C3
     C                     ENDIF                                          ULX046C3
      *                                                                   ULX046C3
     C                     ENDIF                                          ULX046C3
      *                                                                   ULX046C3
     C           ULX046    IFEQ 'Y'                                       ULX046C3
     C           EXLOTD    ANDEQ'GLA'                      Book Positions ULX046C3
      *                                                                   ULX046C3
     C           EXAMTY    IFEQ 6                                         ULX046C3
     C           EXDRCR    ANDEQ0                                         ULX046C3
     C                     Z-ADD12        EXAMTY                          ULX046C3
     C                     ENDIF                                          ULX046C3
      *                                                                   ULX046C3
     C                     ENDIF                                          ULX046C3
      *                                                                   ULX046
      ** UPDFLD - Update some fields for ULX046                           ULX046
      **  - Circulars 2002/170-174-175 Integration                        ULX046
      *                                                                   ULX046
     C                     EXSR UPDFLD                                    ULX046
      *                                                                   CAD021
     C           EXTRIN    IFEQ *BLANK                                    ULX047
     C                     MOVE '0'       EXTRIN                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX047
     C           WWOUTP    IFNE 'N'                                       ULX047
      *                                                                   ULX047
     C                     ADD  1         EXSEQN                          ULX004
     C                     WRITEERLUTRF0               80
      *                                                                   105698
     C                     ENDIF                                          ULX047
     C******               END                                      117987169125
      **                                                                  105698
     C           EXLOTD    IFEQ 'GLA'                       - B1          105698
     C           EXSCHA    ANDNE30240000                                  105698
      *                                                                   105698
     C           EXLMAR    IFNE *ZEROS                      - B2          105698
     C                     Z-ADDEXAMNT    W1AMNT 160                      105698
     C                     Z-ADDEXLAMT    W1LAMT 160                      105698
     C                     Z-ADDEXSCHA    W1SCHA  80                      105698
     C                     Z-ADDEXDRCR    W1DRCR  10                      105698
      *                                                                   105698
     C           EXDRCR    IFEQ 1                           - B3          105698
     C                     Z-ADDEXMARA    EXAMNT                          105698
     C                     Z-ADDEXLMAR    EXLAMT                          105698
     C                     ELSE                             - X3          105698
     C           EXMARA    SUB  EXAMNT    EXAMNT                          105698
     C           EXLMAR    SUB  EXLAMT    EXLAMT                          105698
     C           EXLAMT    IFLT *ZEROS                      - B4          105698
     C                     Z-ADD*ZEROS    EXLAMT                          105698
     C                     Z-ADD*ZEROS    EXAMNT                          105698
     C                     END                              - E4          105698
     C*                                                                   105698
     C                     END                              - E3          105698
     C*                                                                   105698
     C           EXLAMT    IFNE *ZEROS                      - B3          105698
     C                     Z-ADD30240000  EXSCHA                          105698
     C                     Z-ADD0         EXDRCR                          105698
      *                                                                   ULX046
      ** UPDFLD - Update some fields for ULX046                           ULX046
      **  - Circulars 2002/170-174-175 Integration                        ULX046
      *                                                                   ULX046
     C                     EXSR UPDFLD                                    ULX046
      *                                                                   ULX046
     C           WWOUTP    IFNE 'N'                                       ULX047
     C                     ADD  1         EXSEQN                          ULX004
     C                     WRITEERLUTRF0               80                 105698
     C                     ENDIF                                          ULX047
     C                     END                              - E3          105698
     C*                                                                   105698
     C                     Z-ADDW1AMNT    EXAMNT                          105698
     C                     Z-ADDW1LAMT    EXLAMT                          105698
     C                     Z-ADDW1SCHA    EXSCHA                          105698
     C                     Z-ADDW1DRCR    EXDRCR                          105698
     C                     END                              - E2          105698
     C*                                                                   105698
     C                     END                              - E1          105698
     C*                                                                   105698
      ***                                                                 117987
      ***WRITE ONE MORE RECORD IF ACCOUNT AND SWAP TRADE ACCOUNT          117987
     C***                  MOVELEXDECK    TESTSW  4                       117987
     C***        EXLOTD    IFEQ 'GLA'                      - B1           117987
     C***        TESTSW    ANDEQBNSWTA                                    117987
     C***                  Z-ADD98100000  EXSCHA                          117987
     C***                  ADD  1         EXSEQN                          117987
     C***                  WRITEERLUTRF0               80                 117987
     C***                  Z-ADDW2SCHA    EXSCHA                          117987
     C***                  END                             - E1           117987
      *
      ***Write*extra output record depending on extract type              ULX004
     C************IN80     IFEQ '0'                         - B1          ULX004
     C***********EXEXTT    ANDEQ'Y'                                       ULX004
     C***********EXRECT    IFEQ 002                         - B2          ULX004
     C***********EXRECT    OREQ 003                                       ULX004
     C***********          MOVE 006       EXRECT                          ULX004
     C***********          END                              - E2          ULX004
     C***********                                                         ULX004
     C***OUTPUT*CORRECTION AMOUNTS FOR RECORD 6 ONLY IF LOWER OF COST     ULX004
     C***OR*MARKET, OR MARK TO MARKET REVALUATION METHOD                  ULX004
     C***********EXLOTD    IFEQ 'NAP'                                     ULX004
     C***********EXLOTD    OREQ 'SEC'                                     ULX004
     C***********EXLOTD    OREQ 'SEF'                                     ULX004
     C***********EXEVMT    IFNE 2                                         ULX004
     C***********EXEVMT    ANDNE3                                         ULX004
     C***********          Z-ADD*ZEROS    EXCORA                          ULX004
     C***********          Z-ADD*ZEROS    EXCORL                          ULX004
     C***********          END                                            ULX004
     C***********          END                                            ULX004
     C***********          ADD  1         EXSEQN                          ULX004
     C***********          WRITEERLUTRF0               80                 ULX004
      ***********                                                         ULX004
      ***WRITE*ONE MORE RECORD IF ACCOUNT AND SWAP TRADE ACCOUNT          ULX004
     C***********          MOVELEXDECK    TESTSW  4                       ULX004
     C***********EXLOTD    IFEQ 'GLA'                      - B2           ULX004
     C***********TESTSW    ANDEQBNSWTA                                    ULX004
      ***********                                                         ULX004
     C***********          Z-ADD98100000  EXSCHA                          ULX004
     C***********          ADD  1         EXSEQN                          ULX004
     C***********          WRITEERLUTRF0               80                 ULX004
     C***********          Z-ADDW2SCHA    EXSCHA                          ULX004
     C***********          END                             - E2           ULX004
      ***********                                                         ULX004
     C***********          END                              - E1          ULX004
      *
      ** WRITE A SECOND RECORD IF SUB-TOTAL RUBRIQUE
     C           TOTSUB    IFNE *ZEROS                      - B1
     C*
     C***********EXRECT    IFEQ 006                         - B2          ULX004
     C           EXRECT    IFEQ 001                         - B2          ULX004
     C                     Z-ADDTOTSUB    EXSCHA
     C***********          ADD  1         EXSEQN                          ULX004
      *
      ** UPDFLD - Update some fields for ULX046                           ULX046
      **  - Circulars 2002/170-174-175 Integration                        ULX046
      *                                                                   ULX046
     C                     EXSR UPDFLD                                    ULX046
      *                                                                   ULX046
     C           WWOUTP    IFNE 'N'                                       ULX047
     C                     ADD  1         EXSEQN                          ULX004
     C                     WRITEERLUTRF0               80
     C                     ENDIF                                          ULX047
     C                     END                              - E2
     C*
     C                     END                              - E1
      *
      ** WRITE A THIRD RECORD IF SUB-TOTAL RUBRIQUE
      ** SECOND SUB-TOTAL RUBRIQUE
     C           TOTSU2    IFNE *ZEROS                      - B1
     C*
     C***********EXRECT    IFEQ 006                         - B2          ULX004
     C           EXRECT    IFEQ 001                         - B2          ULX004
     C                     Z-ADDTOTSU2    EXSCHA
      *                                                                   ULX046
      ** UPDFLD - Update some fields for ULX046                           ULX046
      **  - Circulars 2002/170-174-175 Integration                        ULX046
      *                                                                   ULX046
     C                     EXSR UPDFLD                                    ULX046
      *                                                                   ULX046
     C           WWOUTP    IFNE 'N'                                       ULX047
     C                     ADD  1         EXSEQN
     C                     WRITEERLUTRF0               80
     C                     ENDIF                                          ULX047
     C                     END                              - E2
     C*
     C                     END                              - E1
      *
     C           *IN80     IFEQ '1'                         - B1
     C           *LOCK     IN   LDA
     C                     MOVEL'608'     DBASE            ***************
     C**********           MOVEL'ERLUTRPD'DBFILE                                              CER001
     C                     MOVEL'ERLTRXPD'DBFILE                                              CER001
     C                     MOVELEXTREF    DBK1
     C                     MOVELEXDECK    DBK2
     C                     MOVELEXSEQN    DBK3
     C                     EXSR #DBERR
     C                     END                              - E1
      *
      ** RESETUP IML CODE LIKE AFTER 'ERLUSA'
     C                     Z-ADDW2SCHA    EXSCHA
      *
     C******               MOVE WWAMTY    EXAMTY                   ULX011 ULX046
     C                     Z-ADDWWAMTY    EXAMTY                          ULX046
      ** SETUP GUARANTOR DETAILS
     C*********            MOVE 'N'       #END                            ULX004
     C*********            EXSR SRLUGU                                    ULX004
      *
      *
      * RESETUP IML CODE WITH OLD VALUE NON-RUPTURE
     C                     Z-ADDWWSCHA    EXSCHA
     C                     MOVE WWEXTT    EXEXTT
      *                                                                ***
      *                                                                   ULX011
      * Restore EXECOS (Old Economic sector) for calculation              ULX011
     C                     Z-ADDSVECOS    EXECOS                          ULX011
     C           #WDTLE    ENDSR
      **
      /EJECT
      *================================================================== ULX046
      * UPDFLD - Update some additional fields for ULX046                 ULX046
      *------------------------------------------------------------------ ULX046
     C           UPDFLD    BEGSR                                          ULX046
      *                                                                   ULX046
      ** ULX046 Circulars 2002/170-174-175 Integration                    ULX046
      *                                                                   ULX046
     C           ULX046    IFEQ 'Y'                                       ULX046
      *                                                                   ULX046
     C***********EXMFQS    IFNE *ZEROS                             ULX046 214603
      *                                                                   ULX046
     C           EXAMTY    IFEQ 3                          Own debt intr. ULX046
     C           EXAMTY    OREQ 5                          Shares         ULX046
     C           EXAMTY    OREQ 9                          Issued Debt IntULX046
     C           SCHA13    OREQ 108                        Participations ULX046
      *                                                                   ULX046
      ** Quantity of stocks                                               ULX046
      *                                                                   ULX046
     C                     Z-ADDEXQSTK    EXQSTK                          ULX046
      *                                                                   ULX046
      ** Multiplying Factore of an OST on the Quantity of Stocks          ULX046
      *                                                                   ULX046
     C                     Z-ADDEXMFQS    EXMFQS                          ULX046
      *                                                                   ULX046
      ** Discounted Security Indicator                                    ULX046
      *                                                                   ULX046
     C                     Z-ADDEXDISC    EXDISC                          ULX046
      *                                                                   ULX046
     C                     ELSE                                           ULX046
      *                                                                   ULX046
     C                     Z-ADD*ZEROS    EXQSTK                          ULX046
     C                     Z-ADD*ZEROS    EXMFQS                          ULX046
     C                     Z-ADD*ZEROS    EXDISC                          ULX046
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C***********          ELSE                                    ULX046 214603
      ***********                                                  ULX046 214603
     C***********          Z-ADD*ZEROS    EXQSTK                   ULX046 214603
     C***********          Z-ADD*ZEROS    EXMFQS                   ULX046 214603
     C***********          Z-ADD*ZEROS    EXDISC                   ULX046 214603
      ***********                                                  ULX046 214603
     C***********          ENDIF                                   ULX046 214603
      *                                                                   ULX046
      ** Amount in Capital Currency to be Reported on S1.5                ULX046
      *                                                                   ULX046
     C***********EXRIND    IFEQ 'LECL'                             ULX046 214603
     C***********EXRIND    OREQ 'LEPU'                             ULX046 214603
     C                     Z-ADDWWTOTA    EXLS15                          ULX046
     C***********          ELSE                                    ULX046 214603
     C***********          Z-ADDEXLAMT    EXLS15                   ULX046 214603
     C***********          ENDIF                                   ULX046 214603
      *                                                                   ULX047
     C           EXLOTD    IFNE 'GLA'                                     ULX047
     C           EXLOTD    ANDNE'MMD'                                     ULX047
     C           EXLOTD    ANDNE'LEN'                                     ULX047
     C           EXLOTD    ANDNE'PPU'                                     ULX047
     C           EXLOTD    ANDNE'PSO'                                     ULX047
     C           EXLOTD    ANDNE'SEC'                                     ULX047
     C                     MOVE *BLANKS   EXCTRF                          ULX047
     C                     MOVELEXORIG    EXCTRF                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX047
     C                     MOVE ' '       WWOUTP  1                       ULX047
     C           EXNCOS    IFNE 1000                                      ULX047
     C           EXNCOS    ANDNE1100                                      ULX047
     C           EXNCOS    ANDNE1200                                      ULX047
     C           EXNCOS    ANDNE1300                                      ULX047
     C           EXNCOS    ANDNE1400                                      ULX047
     C           EXNCOS    ANDNE3000                                      ULX047
     C           EXNCOS    ANDNE3110                                      ULX047
     C           EXNCOS    ANDNE3120                                      ULX047
     C           EXNCOS    ANDNE3200                                      ULX047
     C                     Z-ADD0         EXNWDC                          ULX047
     C                     Z-ADD0         EXIRSD                          ULX047
     C                     Z-ADD0         EXIRED                          ULX047
     C                     Z-ADD0         EXLS15                          ULX047
     C           EXAMNT    IFEQ 0                                         ULX047
     C                     MOVE 'N'       WWOUTP                          ULX047
     C                     ENDIF                                          ULX047
     C                     ENDIF                                          ULX047
      *                                                                   ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C                     MOVELEXSCHA    EXSCH4  40                      233403
     C           EXSCH4    IFEQ 3041                                      233403
     C           EXAMTY    IFEQ 10                                        233403
     C           EXAMTY    OREQ 11                                        233403
     C           EXISEC    IFNE 6101                                      233403
     C           EXISEC    ANDNE6110                                      233403
     C           EXISEC    ANDNE6121                                      233403
     C           EXLISS    CHAINSDCTX2L0             90                   233403
     C           WFEMUM    IFEQ 'Y'                                       233403
     C                     Z-ADD6110      EXISEC                          233403
     C                     ELSE                                           233403
     C                     Z-ADD6101      EXISEC                          233403
     C                     ENDIF                                          233403
     C                     ENDIF                                          233403
     C                     ENDIF                                          233403
     C                     ENDIF                                          233403
      *                                                                   233403
     C                     ENDSR                                          ULX046
      *=================================================================  ULX046
      /EJECT
     C*================================================================
      **
      **  #SQBK       Sequence Breaks
      **
      *-----------------------------------------------------------
     C           #SQBK     BEGSR
      *-----------------------------------------------------------
      *                                                                ***
      ** Branch Code sequence break:
     C           *INL4     IFEQ '1'                        - B1
     C                     CALL 'ERLU61'
     C                     PARM           EXBRCD
     C                     PARM           EXORCC
     C                     PARM *BLANK    EXINCL  1
     C                     PARM *ZERO     EXOROC
     C                     PARM *BLANK    EXORCL
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
     C           *INU7     CABEQ'1'       #SQBKE
     C                     FREE 'ERLU61'               80
     C   80                MOVE '0'       *IN80
     C                     END                             - E1
      *
      ** Lot id/Decision Key sequence break:
     C           *INL3     IFEQ '1'                        - B1
     C                     MOVELEXDECK    DTYP    2
     C                     CALL 'ERLU62'
     C                     PARM           EXLOTD
     C                     PARM           EXDECK
     C                     PARM           EXDRCR
     C                     PARM           EXCCYC
     C                     PARM *ZEROS    EXSCHA
     C                     PARM *BLANK    EXEXTT
     C                     PARM *ZEROS    VHFRNI
     C***********          PARM *BLANKS   EXAMTY                          ULX004
     C*******              PARM *BLANKS   EXAMTY                   ULX011 ULX046
     C                     PARM *ZEROS    EXAMTY                          ULX046
     C                     PARM *ZEROS    EXDEPT
     C                     PARM           EXPORT  10                      ULX011
     C                     PARM *BLANK    WWMOBC  1                                       225540
     C                     PARM *BLANK    WWPMOB  1                                       225540
     C                     PARM *BLANK    ERROR   1
     C                     PARM           EXTP10                          ULX004
      *
     C           ERROR     IFEQ 'Y'
     C                     EXSR #DBERR
     C                     END
      *
      ** SAVE VALUE OF IML CODE BEFORE SPLIT
     C                     Z-ADDEXSCHA    WWSCHA  80
      *
     C           *INU7     CABEQ'1'       #SQBKE
     C                     END                             - E1
      *
      ** Currency sequence break:
     C           *INL2     IFEQ '1'                        - B1
     C***********EXCCYC    CHAINERCURRL1             80                   187689
     C           EXCCYC    CHAINSDCURRL1             80                   187689
     C           *IN80     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     MOVEL'606'     DBASE
     C***********          MOVEL'ERCURRL1'DBFILE                          187689
     C                     MOVEL'SDCURRL1'DBFILE                          187689
     C                     MOVELEXCCYC    DBKEY
     C                     EXSR #DBERR
     C                     ELSE                            - X2
     C***********          Z-ADDVRNBDP    CONBDP  10                      187689
     C***********          MOVELVRSWCY    EXCCYL                          187689
     C***********          Z-ADDVRSPRT    @@RAT1 138                      187689
     C***********          MOVE VRMDIN    @@MDI1  1                       187689
     C***********          MOVE VRNBDP    @@NBD1  10                ULX011187689
     C                     Z-ADDA6NBDP    CONBDP  10                      187689
     C                     MOVELA6SWCY    EXCCYL                          187689
     C                     Z-ADDA6SPRT    @@RAT1 138                      187689
     C                     MOVE A6MDIN    @@MDI1  1                       187689
     C                     MOVE A6NBDP    @@NBD1  10                      187689
     C                     MOVE A6INCY    WWINCY  1                       187689
     C                     EXSR ZA0900                     Cross X-rate
     C                     END                             - E2
     C                     END                             - E1
      *
      ** Customer sequence break:
     C           *INL1     IFEQ '1'                        - B1
     C           EXLOTD    OREQ 'SEC'
     C                     CALL 'ERLU63'
     C                     PARM           EXLOTD
     C                     PARM           EXCUST
     C                     PARM           EXCUCC
     C                     PARM           EXBNBI
     C                     PARM *BLANK    EXCUCL
     C                     PARM *ZERO     EXCONS
     C                     PARM *ZEROS    EXECOS
     C                     PARM *ZEROS    EXNCOS  40                      ULX011
     C***********          PARM           EXCNCZ                          213111
     C           XXCNCZ    PARM           EXCNCZ                          213111
     C**********           PARM *ZEROS    EXCGRP                                             CSD027A
     C                     PARM *BLANKS   EXCGRP                                             CSD027A
     C                     PARM *ZEROS    EXPAPS
     C                     PARM *ZEROS    EXNTAG  10                      ULX004
     C                     PARM *BLANKS   EXCGRN                          ULX004
     C                     PARM *BLANKS   EXCGLC                          ULX004
     C                     PARM *BLANKS   EXPERF                          ULX004
     C                     PARM *BLANKS   EXSMRS  1                       187689
     C                     PARM *BLANKS   EXMCID  1                       ULX048
     C                     PARM *BLANK    ERROR   1
      *
     C           ERROR     IFEQ 'Y'                        - B1.1
     C                     EXSR #DBERR
     C                     END                             - E1.1
      *
     C                     END                             - E1
      *
     C           #SQBKE    ENDSR
      **=================================================================
      ***SRLUGU - SUBROUTINE TO                                           ULX004
      **================================================================= ULX004
      *********                                                           ULX004
     C*********  SRLUGU    BEGSR                                          ULX004
      *********                                                           ULX004
     C*********            CALL 'ERLUGU'                                  ULX004
     C*********            PARM           EXRECT                          ULX004
     C*********            PARM           EXORIG                          ULX004
     C*********            PARM           EXSEQN                          ULX004
     C*********            PARM           EXLOTD                          ULX004
     C*********            PARM           EXREPP                          ULX004
     C*********            PARM           EXREPD                          ULX004
     C*********            PARM           EXRIND                          ULX004
     C*********            PARM           EXEXTT                          ULX004
     C*********            PARM           EXBRCD                          ULX004
     C*********            PARM           EXDECK                          ULX004
     C*********            PARM           EXCCYL                          ULX004
     C*********            PARM           EXOROC                          ULX004
     C*********            PARM           EXORCL                          ULX004
     C*********            PARM           EXCUCL                          ULX004
     C*********            PARM           EXCUST                          ULX004
     C*********            PARM           EXCONS                          ULX004
     C*********            PARM           EXSCHA                          ULX004
     C*********            PARM           EXREFI                          ULX004
     C*********            PARM           EXECOS                          ULX004
     C*********            PARM           EXDEPT                          ULX004
     C*********            PARM           EXNMDT                          ULX004
     C*********            PARM           EXGUAC                          ULX004
     C*********            PARM           EXGUCL                          ULX004
     C*********            PARM           EXIDUR                          ULX004
     C*********            PARM           EXRDU1                          ULX004
     C*********            PARM           EXRDU2                          ULX004
     C*********            PARM           EXSTRD                          ULX004
     C*********            PARM           EXENDD                          ULX004
     C*********            PARM           EXREVD                          ULX004
     C*********            PARM           EXAMNT                          ULX004
     C*********            PARM           EXLAMT                          ULX004
     C*********            PARM           EXDRCR                          ULX004
     C*********            PARM           EXNOMA                          ULX004
     C*********            PARM           EXLNOM                          ULX004
     C*********            PARM           EXMARA                          ULX004
     C*********            PARM           EXLMAR                          ULX004
     C*********            PARM           EXAMTY                          ULX004
     C*********            PARM           EXCRNM                          ULX004
     C*********            PARM           EXGUEC                          ULX004
     C*********            PARM           EXCCSZ                          ULX004
     C*********            PARM           EXTP10                          ULX004
     C*********            PARM           EXPPSC                          ULX004
     C*********            PARM           EXGUCN                          ULX004
     C*********            PARM           EXGURN                          ULX004
     C*********            PARM           EXGUAT                          ULX004
     C*********            PARM           EXCRET                          ULX004
     C*********            PARM           EXCNCZ                          ULX004
     C*********            PARM           EXDTCD                          ULX004
     C*********            PARM           EXTRIN                          ULX004
     C*********            PARM           EXSECQ                          ULX004
     C*********            PARM           EXTOVM                          ULX004
     C*********            PARM           EXSECY                          ULX004
     C*********            PARM           EXREAA                          ULX004
     C*********            PARM           EXREAL                          ULX004
     C*********            PARM           EXNETA                          ULX004
     C*********            PARM           EXNETL                          ULX004
     C*********            PARM           EXSESN                          ULX004
     C*********            PARM           EXVOTR                          ULX004
     C*********            PARM           EXCORA                          ULX004
     C*********            PARM           EXCORL                          ULX004
     C*********            PARM           EXFPPC                          ULX004
     C*********            PARM           EXEVMT                          ULX004
     C*********            PARM           EXSWLK                          ULX004
     C*********            PARM           EXCORT                          ULX004
     C*********            PARM           EXBCAT                          ULX004
     C*********            PARM           EXCGRP                          ULX004
     C*********            PARM           EXFCUS                          ULX004
     C*********            PARM           EXFACT                          ULX004
     C*********            PARM           EXFCNO                          ULX004
     C*********            PARM           EXDBCT                          ULX004
     C*********            PARM           EXGUCT                          ULX004
     C*********            PARM           EXLSEC                          ULX004
     C*********            PARM           EXSECA                          ULX004
     C*********            PARM           EXIM93                          ULX004
     C*********            PARM           EXCLAT                          ULX004
     C*********            PARM           EXGA14                          ULX004
     C*********            PARM           EXDGRI                          ULX004
     C*********            PARM           EXNGAL                          ULX004
     C*********            PARM           EXNGAM                          ULX004
     C*********            PARM           EXPRFO                          ULX004
     C*********            PARM           EXSHAT                          ULX004
     C*********            PARM           EXID14                          ULX004
     C*********            PARM           EXRD14                          ULX004
     C*********            PARM           EXIRTT                          ULX004
     C*********            PARM           EXOPTY                          ULX004
     C*********            PARM           EXIM14                          ULX004
     C*********            PARM           EXCRMT                          ULX004
     C*********            PARM           EXPAPS                          ULX004
     C*********            PARM           EXLSAM                          ULX004
     C*********            PARM           EXSUBR                          ULX004
     C*********            PARM           EXCLAS                          ULX004
     C*********            PARM           EXZONA                          ULX004
     C*********            PARM *BLANK    ERROR   1                       ULX004
     C*********            PARM           #END    1                       ULX004
      *********                                                           ULX004
     C*********  ERROR     IFEQ 'Y'                                       ULX004
     C*********            EXSR #DBERR                                    ULX004
     C*********            END                                            ULX004
      *********                                                           ULX004
     C*********            ENDSR                                          ULX004
      **=================================================================
      /EJECT
      **=================================================================
     C*  ZA0900 - THIS SUBROUTINE CALCULATES THE CROSS EXCHANGE RATE  *
     C*                                                               *
     C* CALLED BY :  MAIN                                             *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@MDI1  FIRST MULTIPLY/DIVIDE INDICATOR              *
     C*          @@MDI2  SECOND MULTIPLY/DIVIDE INDICATOR             *
     C*          @@RAT1  FIRST RATE (SIZE : 13,8)                     *
     C*          @@RAT2  SECOND RATE (SIZE : 13,8)                    *
     C*                                                               *
     C* OUTPUT : @@CSRT  CROSS RATE  (SIZE : 13,8)                    *
     C*          @@FCMD  FIRST CCY MULTIPLY/DIVIDE INDICATOR          *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZA0900    BEGSR
     C*
     C           @@RAT1    IFEQ *ZERO                      B1
     C                     Z-ADD1         @@RAT1
     C                     END                             E1
     C*
     C           @@RAT2    IFEQ *ZERO                      B1
     C                     Z-ADD1         @@RAT2           *1
     C                     END                             E1
     C*
     C**  IF THE FIRST RATE M/D INDICATOR IS 'M' MULTIPLY,
     C**             ELSE DIVIDE
     C*
     C           @@MDI1    IFEQ 'M'                        B1
     C                     Z-ADD@@RAT1    @@CSRT 159H      *1
     C                     ELSE                            X1
     C           1         DIV  @@RAT1    @@CSRT    H      *1
     C                     END                             E1
     C*
     C**  IF THE SECOND RATE M/D INDICATOR IS 'D' MULTIPLY,
     C**             ELSE DIVIDE
     C*
     C           @@MDI2    IFEQ 'D'                        B1
     C           @@CSRT    MULT @@RAT2    @@CSRT    H      *1
     C                     ELSE                            X1
     C           @@CSRT    DIV  @@RAT2    @@CSRT    H      *1
     C                     END                             E1
     C*
     C*
     C**  SET FIRST CCY MULTIPLY/DIVIDE *IN TO MULTIPLY
     C                     MOVE 'M'       @@FCMD  1
     C*
     C           ZA0909    ENDSR                           **ZA0909 TAG**
      /EJECT
      **=================================================================
      **
      **=================================================================
      **
      **  *INZSR      Program initialisation sub-routine
      **
      *-----------------------------------------------------------
     C           *INZSR    BEGSR
      *-----------------------------------------------------------
      *                                                                *****
     C           *NAMVAR   DEFN           LDA
     C           *LIKE     DEFN EXREPD    WWREPD                          ULX011
     C           *LIKE     DEFN EXCNCZ    XXCNCZ                          213111
     C                     IN   LDA
      *                                                                *****
     C           *ENTRY    PLIST
     C                     PARM           BJMRDT  7        Run date
     C                     PARM           BJURPT 53        Rpt Title
     C*********************PARM           LASTSQ  60       Output Parm    CAD013
     C           EXSEQN    PARM           LASTSQ  60       Output Parm    CAD013
      *                                                    (last seq num)
      **                                                               *****
     C                     MOVEL*BLANK    DBLOT
     C                     MOVELPGM       DBPGM
     C                     OUT  LDA
     C                     MOVE '0'       *INU7
      *
      **  ACCESS ER DEALING DATA TO RETRIEVE :
      **   Limit Currency (BNCYCD) :
     C**********           READ ERDEALPD                 80                                   CER001
     C                     READ ERDEAXPD                 80                                   CER001
      **   If record not found:
     C           *IN80     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     MOVEL'602'     DBASE            *****************
     C**********           MOVEL'ERDEALPD'DBFILE                                              CER001
     C                     MOVEL'ERDEAXPD'DBFILE                                              CER001
     C                     MOVEL'*NONE '  DBKEY            *****************
     C                     EXSR #DBERR
     C                     ELSE                            - X1
     C***********BNCYCD    CHAINERCURRL1             80                   187689
     C           BNCYCD    CHAINSDCURRL1             80                   187689
     C           *IN80     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     MOVEL'603'     DBASE            *****************
     C***********          MOVEL'ERCURRL1'DBFILE                          187689
     C                     MOVEL'SDCURRL1'DBFILE                          187689
     C                     MOVELBNCYCD    DBKEY
     C                     EXSR #DBERR
     C                     ELSE                            - X2
     C***********          MOVELVRSWCY    EXCRCY  3        not used]]     187689
     C***********          Z-ADDVRSPRT    @@RAT1 138                      187689
     C***********          MOVE VRMDIN    @@MDI1  1                       187689
     C                     MOVELA6SWCY    EXCRCY  3        not used]]     187689
     C                     Z-ADDA6SPRT    @@RAT1 138                      187689
     C                     MOVE A6MDIN    @@MDI1  1                       187689
     C                     END                             - E2
     C                     END                             - E1
      *
      **  ACCESS ER ICD TO RETRIEVE LOCAL CCY & XRATE v/s Base ccy :     *****
     C********** 'LU'      CHAINERICDRL1             80                                       CER001
     C           'LU'      CHAINERICDXL1             80                                       CER001
     C           *IN80     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     MOVEL'604'     DBASE            *****************
     C**********           MOVEL'ERICDRL1'DBFILE                                              CER001
     C                     MOVEL'ERICDXL1'DBFILE                                              CER001
     C                     MOVEL'LU'      DBKEY
     C                     EXSR #DBERR
     C                     ELSE                            - X1
     C***********VDCCYC    CHAINERCURRL1             80                   187689
     C           VDCCYC    CHAINSDCURRL1             80                   187689
     C           *IN80     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA
     C                     MOVEL'605'     DBASE            ***************
     C***********          MOVEL'ERCURRL1'DBFILE                          187689
     C                     MOVEL'SDCURRL1'DBFILE                          187689
     C                     MOVELVDCCYC    DBKEY
     C                     EXSR #DBERR
     C                     ELSE                            - X2
     C***********          Z-ADDVRNBDP    XXNBDP  10                      187689
     C***********          Z-ADDVRSPRT    @@RAT2 138                      187689
     C***********          MOVE VRMDIN    @@MDI2  1                       187689
     C***********          MOVE VRNBDP    @@NBD2  10                ULX011187689
     C***********          MOVE VRSWCY    VDCCYL  3                 CAD017187689
     C                     Z-ADDA6NBDP    XXNBDP  10                      187689
     C                     Z-ADDA6SPRT    @@RAT2 138                      187689
     C                     MOVE A6MDIN    @@MDI2  1                       187689
     C                     MOVE A6NBDP    @@NBD2  10                      187689
     C                     MOVE A6SWCY    VDCCYL  3                       187689
     C** CALCULATE XRATE FOR LIMIT CURRENCY
     C                     EXSR ZA0900                     Cross X-rate
     C                     Z-ADD@@CSRT    WWCSRT 138
     C                     END                             - E2
     C                     END                             - E1
      *
      ** IML 2.4 DEVELOPMENT
     C********** 'LU'      CHAINERLUICL0             80                                       CER001
     C           'LU'      CHAINERLICXL0             80                                       CER001
     C           *IN80     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     MOVEL'671'     DBASE
     C**********           MOVEL'ERLUICL0'DBFILE                                              CER001
     C                     MOVEL'ERLICXL0'DBFILE                                              CER001
     C                     MOVEL'LU'      DBKEY
     C                     EXSR #DBERR
     C                     END                             - E1
      *                                                                   CEU007
      ***  Check if the feature CEU007 is installed.                      CEU007
      *                                                                   CEU007
     C                     MOVEL'N'       CEU007  1                       CEU007
     C                     CALL 'AOSARDR0'                                CEU007
     C                     PARM '       ' @RTCD   7                       CEU007
     C                     PARM '*VERIFY' @OPTN   7                       CEU007
     C                     PARM 'CEU007'  @SARD   6                       CEU007
      *                                                                   CEU007
     C           @RTCD     IFEQ *BLANKS                                   CEU007
      *                                                                   CEU007
      ***  It's existing.                                                 CEU007
      *                                                                   CEU007
     C                     MOVEL'Y'       CEU007                          CEU007
      *                                                                   CEU007
     C                     ENDIF                                          CEU007
      *                                                                   ULX046
      ***  Check if the feature ULX046 is installed.                      ULX046
      *                                                                   ULX046
     C                     MOVEL'N'       ULX046  1                       ULX046
     C                     CALL 'AOSARDR0'                                ULX046
     C                     PARM '       ' @RTCD                           ULX046
     C                     PARM '*VERIFY' @OPTN                           ULX046
     C                     PARM 'ULX046'  @SARD                           ULX046
      *                                                                   ULX046
     C           @RTCD     IFEQ *BLANKS                                   ULX046
     C                     MOVEL'Y'       ULX046                          ULX046
     C                     ENDIF                                          ULX046
      *                                                                   ULX046
     C           *LIKE     DEFN EXTOTA    WWTOTA                          ULX046
      *                                                                   ULX046
      ***  Check if the feature ULX048 is installed.                      ULX048
      *                                                                   ULX048
     C                     MOVEL'N'       ULX048  1                       ULX048
     C                     CALL 'AOSARDR0'                                ULX048
     C                     PARM *BLANKS   @RTCD   7                       ULX048
     C                     PARM '*VERIFY' @OPTN   7                       ULX048
     C                     PARM 'ULX048'  @SARD   6                       ULX048
      *                                                                   ULX048
     C           @RTCD     IFEQ *BLANKS                                   ULX048
     C                     MOVEL'Y'       ULX048                          ULX048
     C                     ENDIF                                          ULX048
      *
     C           KYFACT    KLIST
     C                     KFLD           KY1
     C                     KFLD           KY2
     C                     KFLD           KY3
      *
     C                     ENDSR
      /EJECT
      *================================================================
      **
      **   CALCON     Convert Amount to Report CCY
      **
      **   INPUT  : INAMNT 160
      **   OUTPUT : OUTAMT 160
      **
      *-----------------------------------------------------------
     C           CALCON    BEGSR
      *-----------------------------------------------------------
     C                     Z-ADD0         OUTAMT 160
      **
     C           @@MDI1    IFEQ 'M'
     C           @@MDI2    ANDEQ'D'
     C           @@RAT1    MULT @@RAT2    WWRAT  138
     C           INAMNT    MULT WWRAT     OUTAMT    H
     C                     END
      **
     C           @@MDI1    IFEQ 'M'
     C           @@MDI2    ANDEQ'M'
     C           INAMNT    MULT @@RAT1    OUTAMT
     C           OUTAMT    DIV  @@RAT2    OUTAMT    H
     C                     END
      **
     C           @@MDI1    IFEQ 'D'
     C           @@MDI2    ANDEQ'D'
     C           INAMNT    MULT @@RAT2    OUTAMT
     C           OUTAMT    DIV  @@RAT1    OUTAMT    H
     C                     END
      **
     C           @@MDI1    IFEQ 'D'
     C           @@MDI2    ANDEQ'M'
     C           @@RAT1    MULT @@RAT2    WWRAT
     C           INAMNT    DIV  WWRAT     OUTAMT    H
     C                     END
     C*                    Z-ADD0         WKOUTA 160                   92382
     C*          OUTAMT    DIV  10        WKOUTA    H                  92382
     C*          WKOUTA    MULT 10        OUTAMT                       92382
     C*********  OUTAMT    DIV  1000      OUTAMT    H             92382111329
     C*********  OUTAMT    MULT 1000      OUTAMT    H             92382111329
      **                                                               92382
     C           OUTAMT    DIV  10        OUTAMT    H                  111329
     C           OUTAMT    MULT 10        OUTAMT    H                  111329
      **
     C                     ENDSR
      *================================================================
      *                                                                   ULX011
      ********                                                     ULX011 ULX047
      ***ZFWDRT - SR. TO CALCULATE THE FORWARD FX RATE BETWEEN TWO ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***INPUT  FIELDS                                             ULX011 ULX047
      ********ZAMTF  150     'FROM' AMOUNT                         ULX011 ULX047
      ********ZCCYF   3A     'FROM' CURRENCY                       ULX011 ULX047
      ********ZCCYT   3A     'TO' CURRENCY                         ULX011 ULX047
      ********ZMDINF  1A     'FROM' CURRENCY MULTIPLY/DIVIDE INDICAULX011 ULX047
      ********ZMDINT  1A     'TO' CURRENCY MULTIPLY/DIVIDE INDICATOULX011 ULX047
      ********ZCDPF   10     'FROM' CURRENCY NUMBER OF DECIMAL PLACULX011 ULX047
      ********ZCDPT   10     'TO' CURRENCY NUMBER OF DECIMAL PLACESULX011 ULX047
      ********ZSPOTF 138     'FROM' CURRENCY SPOT RATE             ULX011 ULX047
      ********ZSPOTT 138     'TO' CURRENCY SPOT RATE               ULX011 ULX047
      ********ZDATN   50     FORWARD DATE (MIDAS DAY NUMBER FORMAT)ULX011 ULX047
      ********ZRDATE  50     RUN DATE, SDBANKPD (MIDAS DAY NUMBER FULX011 ULX047
      ********                                                     ULX011 ULX047
      ***OUTPUT  FIELDS                                            ULX011 ULX047
      ********ZAMTT  150     ZAMTF CONVERTED INTO 'TO' CURRENCY    ULX011 ULX047
      ********               USING FORWARD RATES                   ULX011 ULX047
      ********ZCRSRT 138     FORWARD FX RATE BETWEEN 'FROM' & 'TO' ULX011 ULX047
      ********               (ALWAYS A MULTIPLY RATE)              ULX011 ULX047
      ********                                                     ULX011 ULX047
      ****WORK FIELDS                                              ULX011 ULX047
      ********DFWDS          DATA STRUCTURE (75 = 25 X 3P)         ULX011 ULX047
      ********RFWDS          DATA STRUCTURE (175 = 25 X 7P)        ULX011 ULX047
      ********DF             FORWARD DAYS ARRAY (25 X 3 0)         ULX011 ULX047
      ********RF             FORWARD RATES ARRAY (25 X 13 8)       ULX011 ULX047
      ********DYF            FORWARD DATES ARRAY (26 X 3 0)        ULX011 ULX047
      ********RAF            FORWARD RATES ARRAY (26 X 13 8)       ULX011 ULX047
      ********ZWCCY   3A     CURRENCY                              ULX011 ULX047
      ********ZWSPOT 138     SPOT RATE                             ULX011 ULX047
      ********I       10     INDEX TO PROCESS 'FROM' AND 'TO' CURREULX011 ULX047
      ********J       20     INDEX TO ACCESS ELEMENTS OF ARRAYS    ULX011 ULX047
      ********K       20     INDEX TO ACCESS ELEMENTS OF ARRAYS    ULX011 ULX047
      ********ZWRATE 138     FORWARD RATE                          ULX011 ULX047
      ********ZRATEF 138     'FROM' CURRENCY FORWARD RATE (INPUT FOULX011 ULX047
      ********ZRATET 138     'TO' CURRENCY FORWARD RATE (INPUT FOR ULX011 ULX047
      ********ZWDAT1  50     DATE (MIDAS DAY NUMBER FORMAT)        ULX011 ULX047
      ********ZWDAT2  50     DATE (MIDAS DAY NUMBER FORMAT)        ULX011 ULX047
      ********ZWDDT1  50     DATE (MIDAS DAY NUMBER FORMAT)        ULX011 ULX047
      ********ZWDDT2  50     DATE (MIDAS DAY NUMBER FORMAT)        ULX011 ULX047
      ********ZWRAT1 138     RATE                                  ULX011 ULX047
      ********ZWRAT2 138     RATE                                  ULX011 ULX047
      ********ZWRDIF 158     RATE                                  ULX011 ULX047
      ********                                                     ULX011 ULX047
      ****INDICATORS USED                                          ULX011 ULX047
      *********IN91,92,93,*  USED ON SEARCH FOR ZDATN ON FORWARD DAULX011 ULX047
      *********IN99          USED ON CHAIN TO LF/FWDRT             ULX011 ULX047
      ********                                                     ULX011 ULX047
      ****ALSO REQUIRED                                            ULX011 ULX047
      ********DATA STRUCTURE FOR FORWARD DAYS FROM FILE FWDRT (CHARULX011 ULX047
      ********DATA STRUCTURE FOR FORWARD RATES FROM FILE FWDRT (CHAULX011 ULX047
      ********ARRAY FOR FORWARD DAYS FROM FILE FWDRT (NUM)         ULX011 ULX047
      ********ARRAY FOR FORWARD RATES FROM FILE FWDRT (NUM)        ULX011 ULX047
      ********ARRAY FOR ALL FORWARD DATES (RUN DATE AND R.D.+DAYS FULX011 ULX047
      ********ARRAY FOR ALL FORWARD RATES (SPOT RATE AND RATES FROMULX011 ULX047
      ********                                                     ULX011 ULX047
      ***CALLS:                                                    ULX011 ULX047
      ********ZCCYCN                                               ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***CALLED BY:                                                ULX011 ULX047
      ********                                                     ULX011 ULX047
      *************************************************************ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********   ZFWDRT    BEGSR                           ** ZFWDRULX011 ULX047
      ********                                                     ULX011 ULX047
      ***DEFINE INPUT AND OUTPUT FIELDS                            ULX011 ULX047
     C********             Z-ADDZAMTF     ZAMTF  150               ULX011 ULX047
     C********             MOVE ZCCYF     ZCCYF   3                ULX011 ULX047
     C********             MOVE ZCCYT     ZCCYT   3                ULX011 ULX047
     C********             MOVE ZMDINF    ZMDINF  1                ULX011 ULX047
     C********             MOVE ZMDINT    ZMDINT  1                ULX011 ULX047
     C********             Z-ADDZCDPF     ZCDPF   10               ULX011 ULX047
     C********             Z-ADDZCDPT     ZCDPT   10               ULX011 ULX047
     C********             Z-ADDZSPOTF    ZSPOTF 138               ULX011 ULX047
     C********             Z-ADDZSPOTT    ZSPOTT 138               ULX011 ULX047
     C********             Z-ADDZDATN     ZDATN   50               ULX011 ULX047
     C********             Z-ADDZRDATE    ZRDATE  50               ULX011 ULX047
     C********             Z-ADD0         ZAMTT  150               ULX011 ULX047
     C********             Z-ADD0         ZCRSRT 138               ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***CALCULATE THE FORWARD RATE FIRST FOR THE 'FROM' CURRENCY  ULX011 ULX047
      ***AND*THEN FOR THE 'TO' CURRENCY BY USING THE SAME PROCESSINULX011 ULX047
     C********             Z-ADD1         I       30               ULX011 ULX047
     C********   I         DOUEQ3                          B1      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***I*=*1 : 'FROM' CURRENCY, I = 2 : 'TO' CURRENCY            ULX011 ULX047
     C********   I         IFEQ 1                          B2      ULX011 ULX047
     C********             MOVE ZCCYF     ZWCCY   3                ULX011 ULX047
     C********             Z-ADDZSPOTF    ZWSPOT 138               ULX011 ULX047
     C********             ELSE                            X2      ULX011 ULX047
     C********             MOVE ZCCYT     ZWCCY                    ULX011 ULX047
     C********             Z-ADDZSPOTT    ZWSPOT                   ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***INITIALISE FORWARD DATES AND FORWARD RATES ARRAYS         ULX011 ULX047
     C********             MOVEA*ZERO     DYF                      ULX011 ULX047
     C********             MOVEA*ZERO     RAF                      ULX011 ULX047
     C********             Z-ADDZRDATE    DYF,1                    ULX011 ULX047
     C********             Z-ADDZWSPOT    RAF,1                    ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***ACCESS LF/FWDRT AND SET UP FURTHER ELEMENTS OF THE TWO ARRULX011 ULX047
     C********   ZWCCY     CHAINFWDRT                99            ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********   *IN99     IFEQ '0'                        B2      ULX011 ULX047
     C********   RECI      ANDEQ'D'                                ULX011 ULX047
     C********             MOVE DFW       DFWDS                    ULX011 ULX047
     C********             MOVE RFW       RFWDS                    ULX011 ULX047
     C********             Z-ADD1         J       30               ULX011 ULX047
     C********             Z-ADD2         K       30               ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***SET*UP EACH ELEMENT OF FORWAD DATES ARRAY                 ULX011 ULX047
     C********   J         DOWLT26                         B3      ULX011 ULX047
     C********   DF,J      IFNE 0                          B4      ULX011 ULX047
     C********   ZRDATE    ADD  DF,J      DYF,K                    ULX011 ULX047
     C********             ADD  1         J                        ULX011 ULX047
     C********             ADD  1         K                        ULX011 ULX047
     C********             ELSE                            X4      ULX011 ULX047
     C********             Z-ADD90        J                        ULX011 ULX047
     C********             END                             E4      ULX011 ULX047
     C********             END                             E3      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***SET*UP ELEMENTS OF FORWAD RATES ARRAY                     ULX011 ULX047
     C********             MOVEARF        RAF,2                    ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***DETERMINE IF ZDATN IS EQUAL TO AN ELEMENT OF FORWARD DATESULX011 ULX047
     C********             Z-ADD1         J                        ULX011 ULX047
     C********   ZDATN     LOKUPDYF,J                    91        ULX011 ULX047
     C********   *IN91     IFEQ '1'                        B2      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***ZDATN IS EQUAL TO A FORWARD DATE IN THE ARRAY             ULX011 ULX047
     C********             Z-ADDRAF,J     ZWRATE 138               ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***DETERMINE IF ZDATN IS GREATER THAN LAST DATE OF ARRAY     ULX011 ULX047
      ***OR*IF ZDATN FALLS BETWEEN TWO DATES IN ARRAY              ULX011 ULX047
     C********             ELSE                            X2      ULX011 ULX047
     C********             MOVE '0'       *IN92                    ULX011 ULX047
     C********             MOVE '0'       *IN93                    ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********   J         DOUGT26                         B3      ULX011 ULX047
     C********   *IN92     OREQ '1'                                ULX011 ULX047
     C********   *IN93     OREQ '1'                                ULX011 ULX047
     C********   ZDATN     IFLT DYF,J                      B4      ULX011 ULX047
     C********             MOVE '1'       *IN92                    ULX011 ULX047
     C********             ELSE                            X4      ULX011 ULX047
     C********   DYF,J     IFEQ 0                          B5      ULX011 ULX047
     C********             MOVE '1'       *IN93                    ULX011 ULX047
     C********             ELSE                            X5      ULX011 ULX047
     C********             ADD  1         J                        ULX011 ULX047
     C********             END                             E5      ULX011 ULX047
     C********             END                             E4      ULX011 ULX047
     C********             END                             E3      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***ZDATN IS GREATER THAN THE LAST FORWARD DATE IN THE ARRAY  ULX011 ULX047
     C********   *IN92     IFEQ '0'                        B3      ULX011 ULX047
     C********             SUB  1         J                        ULX011 ULX047
     C********             Z-ADDRAF,J     ZWRATE                   ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***ZDATN IS BETWEEN TWO FORWARD DATES IN THE ARRAY           ULX011 ULX047
     C********             ELSE                            X3      ULX011 ULX047
     C********             Z-ADDDYF,J     ZWDAT2  50               ULX011 ULX047
     C********             Z-ADDRAF,J     ZWRAT2 138               ULX011 ULX047
     C********             SUB  1         J                        ULX011 ULX047
     C********             Z-ADDDYF,J     ZWDAT1  50               ULX011 ULX047
     C********             Z-ADDRAF,J     ZWRAT1 138               ULX011 ULX047
     C********   ZDATN     SUB  ZWDAT1    ZWDDT1  50               ULX011 ULX047
     C********   ZWDAT2    SUB  ZWDAT1    ZWDDT2  50               ULX011 ULX047
     C********   ZWRAT2    SUB  ZWRAT1    ZWRDIF 158               ULX011 ULX047
     C********             MULT ZWDDT1    ZWRDIF                   ULX011 ULX047
     C********             DIV  ZWDDT2    ZWRDIF    H              ULX011 ULX047
     C********   ZWRAT1    ADD  ZWRDIF    ZWRATE                   ULX011 ULX047
     C********             END                             E3      ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********   I         IFEQ 1                          B2      ULX011 ULX047
     C********             Z-ADDZWRATE    ZRATEF 138               ULX011 ULX047
     C********             ELSE                            X2      ULX011 ULX047
     C********             Z-ADDZWRATE    ZRATET 138               ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********             ADD  1         I                        ULX011 ULX047
     C********             END                             E1      ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***CALL*SR/ZCCYCN TO CALCULATE THE FORWARD FX RATE           ULX011 ULX047
      ***USING THE CALCULATED FORWARD RATES                        ULX011 ULX047
     C********             EXSR ZCCYCN                             ULX011 ULX047
      ********                                                     ULX011 ULX047
      ***IF*THE CROSS RATE MULT/DIV IND IS 'D', INVERSE FORWARD FX ULX011 ULX047
     C********   ZCRSMD    IFEQ 'D'                        B1      ULX011 ULX047
     C********   1         DIV  ZCRSRT    ZCRSRT    H              ULX011 ULX047
     C********             END                             E1      ULX011 ULX047
      ********                                                     ULX011 ULX047
     C********             ENDSR                           ** ZFWDRULX011 ULX047
      ********                                                     ULX011 ULX047
     C*************************************************************ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***ZCCYCN SR. TO CONVERT AN AMOUNT IN ONE CURRENCY TO ANOTHERULX011 ULX047
     C***CURRENCY USING THE SPOT RATES FOR THE TWO CURRENCIES      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***INPUT  FIELDS                                             ULX011 ULX047
     C********ZAMTF  150     AMOUNT IN 'FROM' CURRENCY             ULX011 ULX047
     C********ZCCYF   3A     FROM CURRENCY                         ULX011 ULX047
     C********ZCCYT   3A     TO CURRENCY                           ULX011 ULX047
     C********ZRATEF 138     SPOT RATE FOR 'FROM' CURRENCY         ULX011 ULX047
     C********ZRATET 138     SPOT RATE FOR 'TO' CURRENCY           ULX011 ULX047
     C********ZMDINF  1A     MULTIPLY/DIVIDE INDICATOR FOR 'FROM' CULX011 ULX047
     C********ZMDINT  1A     MULTIPLY/DIVIDE INDICATOR FOR 'TO' CURULX011 ULX047
     C********ZCDPF   10     CURRENCY DECIMAL PLACES FOR 'FROM' CURULX011 ULX047
     C********ZCDPT   10     CURRENCY DECIMAL PLACES FOR 'TO' CURREULX011 ULX047
     C********                                                     ULX011 ULX047
     C***OUTPUT  FIELDS                                            ULX011 ULX047
     C********ZAMTT  150     AMOUNT IN 'TO' CURRENCY (IE. CONVERTEDULX011 ULX047
     C********ZCRSRT 138     CROSS EXCHANGE RATE                   ULX011 ULX047
     C********ZCRSMD  1A     CROSS RATE MULTIPLY/DIVIDE INDICATOR  ULX011 ULX047
     C********                                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***CALLS:                                                    ULX011 ULX047
     C********                                                     ULX011 ULX047
     C*************************************************************ULX011 ULX047
     C********                                                     ULX011 ULX047
     C********   ZCCYCN    BEGSR                           *** ZCCYULX011 ULX047
     C********                                                     ULX011 ULX047
     C***DEFINE ALL FIELDS                                         ULX011 ULX047
     C********             Z-ADDZAMTF     ZAMTF  150               ULX011 ULX047
     C********             MOVE ZCCYF     ZCCYF   3                ULX011 ULX047
     C********             MOVE ZCCYT     ZCCYT   3                ULX011 ULX047
     C********             Z-ADDZRATEF    ZRATEF 138               ULX011 ULX047
     C********             Z-ADDZRATET    ZRATET 138               ULX011 ULX047
     C********             MOVE ZMDINF    ZMDINF  1                ULX011 ULX047
     C********             MOVE ZMDINT    ZMDINT  1                ULX011 ULX047
     C********             Z-ADDZCDPF     ZCDPF   10               ULX011 ULX047
     C********             Z-ADDZCDPT     ZCDPT   10               ULX011 ULX047
     C********             Z-ADDZAMTT     ZAMTT  150               ULX011 ULX047
     C********             Z-ADDZCRSRT    ZCRSRT 138               ULX011 ULX047
     C********             MOVE ZCRSMD    ZCRSMD  1                ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*'FROM' CURRENCY EQUAL TO 'TO' CURRENCY SET AMOUNT IN 'TULX011 ULX047
     C***EQUAL TO AMOUNT IN 'FROM' CURRENCY                        ULX011 ULX047
     C********   ZCCYF     IFEQ ZCCYT                              ULX011 ULX047
     C********             Z-ADDZAMTF     ZAMTT                    ULX011 ULX047
     C********             Z-ADD1         ZCRSRT                   ULX011 ULX047
     C********             MOVE 'M'       ZCRSMD                   ULX011 ULX047
     C********   1000000000MULT 1000000   ZCRSRN                   ULX011 ULX047
     C********             GOTO CCYEND                             ULX011 ULX047
     C********             END                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***INITIALIZE CROSS EXCHANGE RATE (ZCRSSRT) TO ZERO          ULX011 ULX047
     C********             Z-ADD*ZEROS    ZCRSRT                   ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***CONVERT 'FROM' RATE TO MULTIPLY RATE                      ULX011 ULX047
     C********   ZMDINF    IFEQ 'M'                                ULX011 ULX047
     C********             Z-ADDZRATEF    ZRATF1 138               ULX011 ULX047
     C********   1000000000MULT ZRATEF    ZRATF2 308               ULX011 ULX047
     C********   10        MULT ZRATF2    ZRATF2                   ULX011 ULX047
     C********             ELSE                                    ULX011 ULX047
     C********   1         DIV  ZRATEF    ZRATF1                   ULX011 ULX047
     C********   1000000000MULT 10        ZRWORK 200               ULX011 ULX047
     C********   ZRWORK    DIV  ZRATEF    ZRATF2    H              ULX011 ULX047
     C********             END                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***CONVERT 'TO' RATE TO MULTIPLY RATE                        ULX011 ULX047
     C********   ZMDINT    IFEQ 'M'                                ULX011 ULX047
     C********             Z-ADDZRATET    ZRATT1 138               ULX011 ULX047
     C********   1000000000MULT ZRATET    ZRATT2 308               ULX011 ULX047
     C********   10        MULT ZRATT2    ZRATT2                   ULX011 ULX047
     C********             ELSE                                    ULX011 ULX047
     C********   1         DIV  ZRATET    ZRATT1                   ULX011 ULX047
     C********   1000000000MULT 10        ZRWORK                   ULX011 ULX047
     C********   ZRWORK    DIV  ZRATET    ZRATT2    H              ULX011 ULX047
     C********             END                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***NOW*CALCULATE CROSS RATE                                  ULX011 ULX047
     C********   ZRATT1    IFNE *ZEROS                             ULX011 ULX047
     C********   ZRATF1    DIV  ZRATT1    ZCRSRT                   ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***CALCULATE DOUBLE PRECISION FX RATE                        ULX011 ULX047
     C***FIRST SPLIT FIGURE INTO TWO PARTS                         ULX011 ULX047
     C********   1000000000MULT 1000000   ZRWORK                   ULX011 ULX047
     C********   ZRATF2    MULT ZRWORK    ZRATBF 300               ULX011 ULX047
     C********             Z-ADDZRATF2    ZRATSF 158               ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***DIVIDE BOTH BIG AND SMALL PARTS BY TO FX RATE AND ADD TO CULX011 ULX047
     C***TO*BE USED IN CALCULATIONS                                ULX011 ULX047
     C********   ZRATBF    DIV  ZRATT2    ZCRSRN 309H              ULX011 ULX047
     C********   ZRATSF    DIV  ZRATT2    ZCRSR1 309H              ULX011 ULX047
     C********             ADD  ZCRSR1    ZCRSRN                   ULX011 ULX047
     C********             END                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***MOVE*MULT/DIV INDIC FOR 'FROM' CURRENCY TO CROSS RATE MULTULX011 ULX047
     C***INDICATOR (ZCRSMD)                                        ULX011 ULX047
     C********             MOVE 'M'       ZCRSMD                   ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*CROSS EXCHANGE RATE IS EQUAL TO ZERO                   ULX011 ULX047
     C***SET*ZAMTT  TO *ZERO  & EXIT                               ULX011 ULX047
     C********   ZCRSRN    IFEQ 0                                  ULX011 ULX047
     C********             Z-ADD*ZEROS    ZAMTT                    ULX011 ULX047
     C********             GOTO CCYEND                             ULX011 ULX047
     C********             END                                     ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF) EQUALS DECIULX011 ULX047
     C***DECIMAL PLACES  FOR 'TO' CURRENCY CONVERT AMOUNT BY SIMPLEULX011 ULX047
     C***MULTIPLICATION                                            ULX011 ULX047
     C********   ZCDPF     IFEQ ZCDPT                      B1      ULX011 ULX047
     C********   ZAMTF     MULT ZCRSRN    ZAMTO  300H              ULX011 ULX047
     C********             END                             E1      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*DECIMAL PLACES  FOR 'FROM' CURRENCY (ZCDPF)  NOT EQUALSULX011 ULX047
     C***DECIMAL PLACES  FOR 'TO' CURRENCY ADJUST AMOUNT FOR DIFFERULX011 ULX047
     C********   ZCDPF     IFNE ZCDPT                      B1      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***SUBTRACT DECIMAL PLACES 'FROM' FROM DECIMAL PLACES 'TO' INULX011 ULX047
     C********   ZCDPT     SUB  ZCDPF     ZWKPX   10               ULX011 ULX047
     C********   ZWKPX     ADD  4         B       30               ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*POWER ELEMENT (8,4) LESS THAN 1                        ULX011 ULX047
     C********   POWER,B   IFLT 1                          B2      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***MULTIPLY AMOUNT IN FROM CURRENCY BY ELEMENT IN POWER ARRAYULX011 ULX047
     C********   POWER,B   MULT ZAMTF     ZWK153 153               ULX011 ULX047
     C********                                                     ULX011 ULX047
     C********   ZWK153    MULT ZCRSRN    ZAMTO     H              ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C***IF*POWER ELEMENT (8,4) GREATER OR EQUAL TO 1              ULX011 ULX047
     C********   POWER,B   IFGE 1                          B2      ULX011 ULX047
     C********   ZAMTF     MULT POWER,B   ZAMTO                    ULX011 ULX047
     C********   ZAMTO     MULT ZCRSRN    ZAMTO     H              ULX011 ULX047
     C********             END                             E2      ULX011 ULX047
     C********             END                             E1      ULX011 ULX047
     C********                                                     ULX011 ULX047
     C********   ZAMTO     DIV  ZRWORK    ZAMTT     H              ULX011 ULX047
     C********                                                     ULX011 ULX047
     C********   CCYEND    ENDSR                                   ULX011 ULX047
     C************************************************************ ULX011 ULX047
     C*                                                                   ULX011
     C* ZDAT10 - THIS SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         ULX011
     C*          MIDAS DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         ULX011
     C*                                                                   ULX011
     C* INPUT  : ZZDTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   ULX011
     C*                                                                   ULX011
     C* OUTPUT : ZZMDNO MIDAS DAY NUMBER  (SIZE : 5N)                     ULX011
     C*                                                                   ULX011
     C* USES :   @MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     ULX011
     C*                 MONTH                                             ULX011
     C*          @YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     ULX011
     C*                 A FOUR YEAR PERIOD                                ULX011
     C*          ZWYYYY YEAR (4 CHARACTER)                                ULX011
     C*          ZWYY   YEAR (2 CHARACTER)                                ULX011
     C*          ZWCC   NUMBER OF CENTURIES IN DATE                       ULX011
     C*          ZWMTH  MONTH NUMBER                                      ULX011
     C*          ZWDAY  DAY NUMBER                                        ULX011
     C*          ZWREM  REMAINDER FROM DIVIDE                             ULX011
     C*          ZWWK2  WORK FIELD (2,0)                                  ULX011
     C*          ZWWK5  WORK FIELD (5,0)                                  ULX011
     C*                                                                   ULX011
     C******************************************************************* ULX011
     C*                                                                   ULX011
     C           ZDAT10    BEGSR                                          ULX011
     C*                                                                   ULX011
     C** INITIALISE OUTPUT FIELD                                          ULX011
     C                     Z-ADD0         ZZMDNO  50                      ULX011
     C*                                                                   ULX011
     C** IF INPUT FIELD IS ZERO THEN TERMINATE SUBROUTINE                 ULX011
     C           ZZDTIN    CABEQ0         ZDAT19                          ULX011
     C*                                                                   ULX011
     C** IF DATE GREATER THAN 31/12/2071 THEN CALCUALTE NUMBER OF         ULX011
     C** CENTURIES PASSED SINCE 1971, BY SUBTRACTING 1972 FROM THE        ULX011
     C** THE YEAR FIELD.                                                  ULX011
     C           ZWYYYY    IFGE 2072                                      ULX011
     C           ZWYYYY    SUB  1972      ZWYYYY                          ULX011
     C*                                                                   ULX011
     C** MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)               ULX011
     C** THEN RESTORE THE YEAR WHICH WAS INPUT BACK TO THE                ULX011
     C** ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.       ULX011
     C           ZWCC      MULT 36525     ZZMDNO                          ULX011
     C           ZWYYYY    ADD  1972      ZWYYYY                          ULX011
     C                     END                                            ULX011
     C*                                                                   ULX011
     C** ADD 28 TO THE YEAR - THE RIGHT TWO DIGITS OF THE RESULT WILL     ULX011
     C** GIVE THE NUMBER OF YEARS FROM 1971 - DISREGARDING CENTURIES      ULX011
     C           ZWYYYY    ADD  28        ZWWK2   20                      ULX011
     C*                                                                   ULX011
     C** CALCULATE HOW MANY GROUPS OF FOUR YEARS THERE ARE                ULX011
     C           ZWWK2     DIV  4         ZWWK2                           ULX011
     C                     MVR            ZWREM   10                      ULX011
     C*                                                                   ULX011
     C** AND MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD               ULX011
     C           ZWWK2     MULT 1461      ZWWK5   50                      ULX011
     C                     ADD  ZWWK5     ZZMDNO                          ULX011
     C*                                                                   ULX011
     C** IF A LEAP YEAR AND PAST FEBRUARY THEN ADD AN EXTRA DAY           ULX011
     C           ZWREM     IFEQ 0                                         ULX011
     C           ZWMTH     ANDGT2                                         ULX011
     C                     ADD  1         ZZMDNO                          ULX011
     C                     END                                            ULX011
     C*                                                                   ULX011
     C** YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR                ULX011
     C           ZWREM     IFNE 0                                         ULX011
     C                     ADD  @YD,ZWREM ZZMDNO                          ULX011
     C                     END                                            ULX011
     C*                                                                   ULX011
     C** ADD MONTHS THIS YEAR                                             ULX011
     C                     ADD  @MD,ZWMTH ZZMDNO                          ULX011
     C*                                                                   ULX011
     C** ADD DAYS THIS MONTH                                              ULX011
     C                     ADD  ZWDAY     ZZMDNO                          ULX011
     C*                                                                   ULX011
     C           ZDAT19    ENDSR                           **ZDAT19 TAG** ULX011
      /EJECT                                                              186712
      *****************************************************************   186712
      * Midas DBA 2.10 -----------------------------------------------*   186712
      *  Last Amend No. 154799             Date 24Feb99               *   186712
      * Midas DBA 2.08 -----------------------------------------------*   186712
      *   Prev Amend No 115603                Date 23APR97                186712
      *---------------------------------------------------------------*   186712
      *  154799 - Array index error                                   *   186712
      *           Restore DGJDNB and DGDDNB from ZSJAN and ZSDCM as   *   186712
      *           they may have been changed by other SR(ZF2C).       *   186712
      *           Applied fix 115603.                                 *   186712
      *   115603  - ARRAY INDEX ERROR                                     186712
      *             RESTORE DGJDNB AND DGDDNB FROM ZSJAN AND ZSDCM AS THEY186712
      *             HAVE BEEN CHANGED BY OTHER SR(ZF2C)                   186712
      *****************************************************************   186712
     C           ZACCH     BEGSR                                          186712
      *                                                                   186712
      * This standard sub-routine is to be used in conjunction with       186712
      * the holiday standard sub-routines. Its function is to             186712
      * determine if the access program AOHOLS0 needs to be called and    186712
      * sets up the holiday record appropriately. It is common to all     186712
      * the new holiday sub-routines, but should only be included in      186712
      * a program once, using /COPY.                                      186712
      *                                                                   186712
      *                                                                   186712
      * If stored parameters from last call are not within the same       186712
      * bounds - ie. same ccy/location and date is within 1st. Jan &      186712
      * 31st. Dec of current holiday record - continue processing.        186712
      *                                                                   186712
      **                                                                  186712
      *Define input parameters                                            186712
      **                                                                  186712
     C                     Z-ADDZDAYNO    ZDAYNO  50                      186712
     C                     MOVE ZCCY      ZCCY    3                       186712
     C                     MOVE ZLOC      ZLOC    3                       186712
     C                     MOVE ZOPTN     ZOPTN   7                       186712
     C*                                                                   186712
     C           ZOPTN     IFEQ '*FREE  '                    IF 2         186712
     C*                                                                   186712
     C                     CALL 'AOHOLS0'                                 186712
     C                     PARM *BLANK    RTNCD                           186712
     C                     PARM           ZOPTN                           186712
     C                     PARM ZCCY      ZZCCY                           186712
     C                     PARM ZLOC      ZZLOC                           186712
     C                     PARM ZDAYNO    ZZDYNO                          186712
     C           ZHOLDS    PARM ZHOLDS    DSSDY                        B  186712
     C*                                                                   186712
     C                     ELSE                                           186712
     C*                                                                   186712
     C           ZCCY      IFNE ZSCCY                      IF 1           186712
     C           ZLOC      ORNE ZSLOC                       OR            186712
     C           ZDAYNO    ORLT ZSJAN                       OR            186712
     C           ZDAYNO    ORGT ZSDCM                       OR            186712
      *                                                                   186712
      * Get appropriate holiday record                                    186712
      *                                                                   186712
     C                     CALL 'AOHOLS0'                                 186712
     C                     PARM *BLANK    RTNCD                           186712
     C                     PARM           ZOPTN                           186712
     C                     PARM ZCCY      ZZCCY                           186712
     C                     PARM ZLOC      ZZLOC                           186712
     C                     PARM ZDAYNO    ZZDYNO  50                      186712
     C           ZHOLDS    PARM ZHOLDS    DSSDY                        B  186712
      *                                                                   186712
      * If no record was found, assume all days in year are working       186712
      * days.                                                             186712
      *                                                                   186712
     C           RTNCD     IFEQ '*NRF   '                    IF 2         186712
      *                                                                   186712
     C                     MOVE *ALL' '   ZHL                             186712
      *                                                                   186712
      * Save 1st. Jan/31st. Dec dates as input date as we cannot say      186712
      * anything about this year in future calls.                         186712
      *                                                                   186712
     C                     Z-ADDZDAYNO    ZSJAN                           186712
     C                     Z-ADDZDAYNO    ZSDCM                           186712
      *                                                                   186712
     C                     ELSE                              ELSE 2       186712
      *                                                                   186712
      * Save 1st. Jan/31st. Dec for future calls                          186712
      *                                                                   186712
     C                     Z-ADDDGJDNB    ZSJAN                           186712
     C                     Z-ADDDGDDNB    ZSDCM                           186712
      *                                                                   186712
      * Left adjust the holiday array over FEB 29th if the                186712
      * holiday record is not for a leap year.                            186712
      *                                                                   186712
     C                     MOVE DGYRNB    Z@YR    40                      186712
     C           Z@YR      DIV  4         Z@WK1   40                      186712
     C                     MVR            Z@WK2   40                      186712
     C*                                                                   186712
     C           Z@WK2     IFNE 0                                         186712
     C*                                                                   186712
     C                     MOVEAZHL       ZHL1                            186712
     C                     MOVEAZHL1,61   ZHL,60                          186712
     C*                                                                   186712
     C                     END                                            186712
     C*                                                                   186712
     C                     END                               FI 2         186712
      *                                                                   186712
      * Save currency and location for future calls. Need to save         186712
      * return code as well.                                              186712
      *                                                                   186712
     C                     MOVE ZCCY      ZSCCY                           186712
     C                     MOVE ZLOC      ZSLOC                           186712
     C                     MOVE RTNCD     ZSRTN                           186712
      *                                                                   186712
     C                     ELSE                            ELSE 1         186712
      *                                                                   186712
      * Move saved return code back again as there may have been no       186712
      * record found last time.                                           186712
      *                                                                   186712
     C**********           Z-ADDZSJAN     DGJDNB                          186712
     C**********           Z-ADDZSDCM     DGDDNB                          186712
     C                     Z-ADDZSJAN     DGJDNB                          186712
     C                     Z-ADDZSDCM     DGDDNB                          186712
     C                     MOVE ZSRTN     RTNCD                           186712
      *                                                                   186712
     C                     END                             FI 1           186712
      *                                                                   186712
     C                     END                                            186712
      *                                                                   186712
     C                     ENDSR                                          186712
      /EJECT                                                              186712
      *****************************************************************   186712
      *                                                               *   186712
      *  Midas - Copy Source                                          *   186712
      *                                                               *   186712
      *  ZFWDT - Calculate Working Days Forward.                      *   186712
      *                                                               *   186712
      *  (C) COPYRIGHT MKI LIMITED 1992, 1994                         *   186712
      *                                                               *   186712
      * Midas DBA 2.0 --------------- Base ---------------------------*   186712
      *  LAST AMEND NO. S01434             DATE 20SEP93               *   186712
      *  PREV AMEND NO. E38323             DATE 27JUL92               *   186712
      *                                                               *   186712
      *---------------------------------------------------------------*   186712
      *                                                               *   186712
      *  S01434 - There is an logic error when the array index 'ZINDX'*   186712
      *           holds the value '367' (days in year).               *   186712
      *                                                               *   186712
      *  E38323 - There is an incorrect gap to appear in the series   *   186712
      *           next working days. This error occurs under certain  *   186712
      *           circumstances: when a series of next working days   *   186712
      *           are required and the series goes from an old year   *   186712
      *           to a new year. The fix is to store the initial      *   186712
      *           value of ZDAYNO and z-add the value back to ZDAYNO  *   186712
      *           after the execution of the holiday checking routine *   186712
      *****************************************************************   186712
     C           ZFWDT     BEGSR                                          186712
      *                                                                   186712
      * Standard sub-routine to calculate up to 99 working days forward   186712
      * from a given start date.                                          186712
      * NB. Must be used in conjunction with ZACCH.                       186712
      *                                                                   186712
      * NB: If required no. of working days forward is zero, then:-       186712
      *       if input date is a working day, then result is input date   186712
      *       else result is first working day after input date.          186712
      *                                                                   186712
      *     If required no. of working days forward is one, then:-        186712
      *       if input date is a working day, then result is next         186712
      *       working day                                                 186712
      *       else result is first working day after input date.          186712
      *                                                                   186712
      * Thus, if input date is a holiday, then zero and one working day   186712
      * forward will return the same result.                              186712
      *                                                                   186712
      *                                                                   186712
      **                                                                  186712
      *Define input parameters                                            186712
      **                                                                  186712
     C                     Z-ADDZDAYNO    ZDAYNO  50                      186712
     C                     MOVE ZCCY      ZCCY    3                       186712
     C                     MOVE ZLOC      ZLOC    3                       186712
     C                     Z-ADDZNRDYS    ZNRDYS  20                      186712
      **                                                                  186712
      *Define Output parameters                                           186712
      **                                                                  186712
     C                     Z-ADD0         ZDYNBR  50                      186712
      *                                                                   186712
      * Move input date to output date                                    186712
      *                                                                   186712
      *                                                                   186712
     C                     Z-ADDZDAYNO    ZDYNBR                          186712
      *                                                                   186712
      ** Save original value of ZDAYNO                                    186712
      *                                                                   186712
     C                     Z-ADDZDAYNO    ZDAYNT  50                      186712
      *                                                                   186712
      * Access holiday record                                             186712
      *                                                                   186712
     C                     MOVE '*SETGT ' ZOPTN                           186712
     C                     EXSR ZACCH                                     186712
      *                                                                   186712
      * If no record was found, then just add no. of days forward         186712
      * required to input date to give output.                            186712
      *                                                                   186712
     C           RTNCD     IFEQ '*NRF   '                  IF 1           186712
      *                                                                   186712
     C           ZDAYNO    ADD  ZNRDYS    ZDYNBR                          186712
      *                                                                   186712
     C                     ELSE                            ELSE 1         186712
      *                                                                   186712
      * Otherwise, a holiday record was found and so need to count days   186712
      * forward to get required result.                                   186712
      *                                                                   186712
      * Subtract 1st. Jan date from given date and add 1 to give the      186712
      * nth day in the year (ZINDX).                                      186712
      *                                                                   186712
     C           ZDAYNO    SUB  DGJDNB    ZINDX                           186712
     C                     ADD  1         ZINDX                           186712
      *                                                                   186712
      * If no. of working days forward wanted is zero, then check first   186712
      * that given date is not a holiday. If it is, then change no. of    186712
      * days forward wanted to one to get next working day.               186712
      *                                                                   186712
     C           ZNRDYS    IFEQ 0                           IF 2          186712
     C           ZHL,ZINDX ANDEQ'X'                                       186712
     C                     ADD  1         ZNRDYS                          186712
     C                     END                              FI 2          186712
      *                                                                   186712
      * While no. of working days left to find is greater than zero       186712
      *                                                                   186712
     C           ZNRDYS    DOWGT0                           DOW 1         186712
      *                                                                   186712
      * Add one to day in year index and to output date                   186712
      *                                                                   186712
     C                     ADD  1         ZINDX                           186712
     C                     ADD  1         ZDYNBR                          186712
      *                                                                   186712
      * If output date is beyond stored 31st. Dec date, then need to      186712
      * get next holiday record with new parameters: output date is new   186712
      * input date; no. of days forward is current no. of days left to    186712
      * find.                                                             186712
      *                                                                   186712
     C           ZDYNBR    IFGT DGDDNB                       IF 1         186712
      *                                                                   186712
     C                     Z-ADDZDYNBR    ZDAYNO                          186712
      *                                                                   186712
      *                                                                   186712
     C                     MOVE '*SETGT ' ZOPTN                           186712
     C                     EXSR ZACCH                                     186712
      *                                                                   186712
      * If no record was found, then add no. of days left to find to      186712
      * output date and subtract 1 to give required result and change     186712
      * no. left to find to zero to terminate loop.                       186712
      *                                                                   186712
     C           RTNCD     IFEQ '*NRF   '                     IF 2        186712
      *                                                                   186712
     C                     ADD  ZNRDYS    ZDYNBR                          186712
     C                     SUB  1         ZDYNBR                          186712
     C                     Z-ADD0         ZNRDYS                          186712
      *                                                                   186712
     C                     ELSE                               ELSE 2      186712
      *                                                                   186712
      * Otherwise, reset day in year value to one.                        186712
      *                                                                   186712
     C                     Z-ADD1         ZINDX                           186712
      *                                                                   186712
     C                     END                                FI 2        186712
      *                                                                   186712
     C                     END                               FI 1         186712
      *                                                                   186712
      * If working day then no. left to find is one less                  186712
      *                                                                   186712
     C***********ZHL,ZINDX IFEQ ' '                          IF 1  S01434 186712
     C           ZNRDYS    IFNE 0                            IF 1  S01434 186712
     C           ZHL,ZINDX ANDEQ' '                          AND1  S01434 186712
     C                     SUB  1         ZNRDYS                          186712
     C                     END                               FI 1         186712
      *                                                                   186712
     C                     END                              ENW 1         186712
      *                                                                   186712
      ** Move back original value of ZDAYNO                        E38323 186712
     C                     Z-ADDZDAYNT    ZDAYNO                   E38323 186712
      *                                                                   186712
     C                     END                             FI 1           186712
      *                                                                   186712
     C                     ENDSR                                          186712
      *****************************************************************   186712
      /EJECT                                                              186712
      **================================================================= ULX011
      **
      **  #DBERR      Monitored error
      **
      *-----------------------------------------------------------
     C           #DBERR    BEGSR
      *-----------------------------------------------------------
      **
     C           ERROR     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     END
     C                     OUT  LDA
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INLR
     C                     EXSR #AUDIT
     C           ERROR     IFEQ *BLANK
     C                     DUMP
     C                     END
     C                     RETRN
     C**
     C                     ENDSR
      *================================================================
      **
      **  #AUDIT      Audit List
      **
      *-----------------------------------------------------------
     C           #AUDIT    BEGSR
      *-----------------------------------------------------------
      **
     C                     WRITEHEADAU
      *
     C           *INU7     IFEQ '1'
     C                     WRITEDBERAU
     C                     END
      *
     C                     MOVELFILNAM    ERXXTR  8
     C                     Z-ADDEXSEQN    WTR
     C                     Z-ADDEXSEQN    LASTSQ
     C                     WRITETRLRAU
     C**
     C                     ENDSR
      *================================================================
      **  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION         ULX011  ULX047
      *0000001                                                    ULX011  ULX047
      *0000010                                                    ULX011  ULX047
      *0000100                                                    ULX011  ULX047
      *0001000                                                    ULX011  ULX047
      *0010000                                                    ULX011  ULX047
      *0100000                                                    ULX011  ULX047
      *1000000                                                    ULX011  ULX047
      *
      ** Array File Trans change to ERLTRXPD instead of ERLUTRPD                              CER001
      *
** FILE TRANS. ERLUTRPD FILE TO REMOVE ALL NON STANDARD CHARACTERS
*EQUATE ERLTRXPD
*EQUATE C144504EC551C552C554C956C164C368406A406FC571C572C5744079407A407D407E407F
*EQUATE C181C282C383C484C585C686C787C888C989D191D292D393D494D595D696D797D898D999
*EQUATE E2A2E3A3E4A4E5A5E6A6E7A7E8A8E9A940E0E4FE
**  OTC
OTCINTERST
OTC  FOREX
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    ULX011
00366007310109601461                                                      ULX011
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       ULX011
00000000310005900090001200015100181002120024300273003040033400365         ULX011
**  CPY@
(c) Finastra International Limited 2005
