     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('MIDAS ABS ER IML Reporting - Accounts')
     H****************************************************************
     H*                                                              *
     H*          MIDAS ABS - EUROPEAN REPORTING                      *
     H*                                                              *
     H*  ERLU70 - IML REPORTING - ACCOUNTS PROCESSING                *
     H*                                                              *
     H*  (c) Finastra International Limited 2005                     *
     H*                                                              *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CGL165             Date 17Feb15               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027A            Date 06May06               *
      *                 CER001             Date 25Apr05               *
      *                 CAD010             Date 31Jul98               *
      *                 ER_R10             Date 25Oct94               *
     H*                    ERL432 PT          DATE   30AUG94         *
     H*                    67483  PT          DATE   10MAR94         *
     H*                    ERL381 TLI         DATE   03DEC93         *
     H*                    ERL371 TLI         DATE   02DEC93         *
     H*                    ERL363 PT          DATE   09AUG93         *
     H*                                                              *
     H****************************************************************
      *  MD046248 - Finastra Rebranding                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CER001 - LUX Upgrade to MidasPlus                            *
     H* CAD010 - PROGRAM MUST BE RECOMPILED DUE TO FILE LAYOUT CHANGE*
     H*  ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10     *
     H*         - ADD BRANCH CODE (R10 MULTIBRANCHING)               *
     H* ERL432 - TO MANAGE THE DATABASE ERRORS CORRECTLY             *
     H* 67483  - To set up consumer credit code (EXGUAC = 5)         *
     H* ERL381 - Remove processing 'Lump-Sum' for A/c                *
     H* ERL371 - IML 1.4 DEVELOPMENT                                 *
     H* ERL363 - WRITTEN FOR ACCOUNTS PROCESSING                     *
     F*****************************************************************
     F***ACCNTBY6IF**E           K        DISK                                                CER001
     FREACX2L0IF  E           K        DISK                                                   CER001
     F* WE - ER Accounts - Extended file
      *
     F***SDACODY6IF**E           K        DISK                                         ERL371 CER001
     FSDACX4L0IF  E           K        DISK                                                   CER001
     F* SD - ER Accounts code - Extended file                             ERL371
      *                                                                   ERL371
      *===============================================================*
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       80         FAIL CONDITION FOR FILE ACCESS OPERATION
     F*
     F*       U7         DATABASE ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * 01   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   70 *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
      *===============================================================*
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*
     I** ACCOUNT DATA STRUCTURE
     I*
     I            DS
     I**********                              1   60KCNUM                                    CSD027A
     I                                        1   6 KCNUM                                    CSD027A
     I                                        7   9 KCCY
     I**********                             10  130KACOD                                     CER001
     I                                       10  190KACOD                                     CER001
     I**********                             14  150KACSQ                                     CER001
     I                                       20  210KACSQ                                     CER001
     I**********                              1  15 KKEY                                      CER001
     I                                        1  21 KKEY                                      CER001
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
      * Program status data structure
     I           SDS
     I                                     *PROGRAM PGM
      *
      **=================================================================
     C                     EXSR #INIT
      *----------------------------------------------------------------==
     C           EXLOTD    CASEQ'GLA'     #GLA
      *
     C                     END
      *----------------------------------------------------------------==
     C                     RETRN
      /EJECT
      **=================================================================
      **
      **=================================================================
      **
      **  #INIT       Program initialisation sub-routine
      **
      *----------------------------------------------------------------==
     C           #INIT     BEGSR
      *----------------------------------------------------------------==
      *                                                                *****
     C           *NAMVAR   DEFN           LDA
     C                     UNLCKLDA
      **                                                               *****
     C           *ENTRY    PLIST
      *  Input Parameters
     C                     PARM           EXLOTD  3
     C**********           PARM           EXTREF 15                                           CER001
     C                     PARM           EXTREF 21                                           CER001
     C                     PARM           EXBRCD  3                       ER_R10
     C                     PARM           EXDRCR  10
     C                     PARM           EXLAMT 160                      ERL371
     C                     PARM           EXGUAC  10                      67483
      *  Output Parameters
     C                     PARM           EXDEPT  10
     C                     PARM           EXIM93  10                      ERL371
     C*********************PARM           EXPRFO  1                ERL371 ERL381
     C                     PARM           EXSHAT  10                      ERL371
     C                     PARM           EXLSAM 160                      ERL371
     C                     PARM           EXCORA 160                      ERL371
     C                     PARM           ERROR   1                       ERL432
      *
      **  Set up Key
     C           KACCN     KLIST
     C                     KFLD           KCNUM
     C                     KFLD           KCCY
     C                     KFLD           KACOD
     C                     KFLD           KACSQ
     C                     KFLD           KBRCA                           ER_R10
      *
     C                     MOVE EXTREF    KKEY
     C                     MOVE EXBRCD    KBRCA   3                       ER_R10
      *
     C                     MOVE '0'       *INU7
      *
     C                     ENDSR
     C*================================================================
      **
      **  #GLA      ACCOUNTS
      **
      *----------------------------------------------------------------==
     C           #GLA      BEGSR
      *----------------------------------------------------------------==
      *
     C** Access to Accounts extension file
     C********** KACCN     CHAINACCNTBY6             80                                       CER001
     C           KACCN     CHAINREACX2L0             80                                       CER001
     C           *IN80     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA
     C                     MOVEL'691'     DBASE
     C**********           MOVEL'ACCNTBY6'DBFILE                                              CER001
     C                     MOVEL'REACX2L0'DBFILE                                              CER001
     C***********          MOVELKKEY      DBKEY                           ER_R10
     C           KKEY      CAT  KBRCA     DBKEY                           ER_R10
     C                     EXSR #DBERR
     C                     END                             - E1
     C*
     C** Set up deposit type only for Retail/Nostri accounts credit
     C** balances
     C           WEATYP    IFEQ 'R'                        - B1
     C           EXDRCR    ANDEQ1
     C           WEATYP    OREQ 'N'                        - B1
     C           EXDRCR    ANDEQ1
     C                     Z-ADD1         EXDEPT
     C                     END                             -E1
      *                                                                   ERL371
      ** Setup 'Correction Amount'                                        ERL371
     C                     Z-ADDWECOAM    EXCORA                          ERL371
      *                                                                   67483
      ** Setup Consumer credit code                                       67483
     C           WE1UAC    IFEQ 5                                         67483
     C                     MOVELWE1UAC    EXGUAC                          67483
     C                     END                                            67483
     C*                                                                   ERL371
     C** Access Account codes extended file to retrieve IML 1.4 fields    ERL371
     C********** KACOD     CHAINSDACODY6             81                                ERL371 CER001
     C           KACOD     CHAINSDACX4L0             81                                       CER001
     C           *IN81     IFEQ '1'                        - B1           ERL371
     C           *LOCK     IN   LDA                                       ERL371
     C                     MOVEL'692'     DBASE                           ERL371
     C**********           MOVEL'SDACODY6'DBFILE                                       ERL371 CER001
     C                     MOVEL'SDACX4L0'DBFILE                                              CER001
     C                     MOVELKACOD     DBKEY                           ERL371
     C                     EXSR #DBERR                                    ERL371
     C                     ELSE                            - X1           ERL371
     C                     Z-ADDSDIM93    EXIM93                          ERL371
     C*********************MOVE SDPRFO    EXPRFO                   ERL371 ERL381
     C                     Z-ADDSDSHAT    EXSHAT                          ERL371
     C                     END                             - E1           ERL371
     C           EXLAMT    MULT WELURA    EXLSAM                          ERL371
     C           EXLSAM    DIV  10000     EXLSAM                          ERL371
     C*
     C                     ENDSR
      **=================================================================
      **
      **  #DBERR      DATA BASE ERROR
      **
      *----------------------------------------------------------------==
     C           #DBERR    BEGSR
      *----------------------------------------------------------------==
     C*
      **
     C                     MOVELPGM       DBPGM
     C                     OUT  LDA                    81
     C                     MOVE 'Y'       ERROR                           ERL432
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INLR
     C  N81                DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************
**  CPY@
(c) Finastra International Limited 2005
