      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('MIDAS ABS ER LU Residual Duration for 1.4')
     H**********************************************************************
     H*                                                                    *
     H*    MIDAS/ABS  EUROPEAN REPORTING - LUXEMBOURG                      *
     H*                                                                    *
     H*    RPG/ERRDUR14 - Residual Duration for IML 1.4                    *
     H*                                                                    *
      *  (c) Misys International Banking Systems Ltd. 2005            *
     H*                                                                    *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CER001             Date 25Aug05               *
      *  Prev Amend No. CAD018 PT          Date 29Sep98               *
      *                 XXXXXX PT          Date 07May96               *
     H*                   85606  PT             DATE 18APR95               *
     H*                   ERL454 PT             DATE 16FEB95               *
     H*                   ERL409 PT             DATE 14JUN94               *
     H*                   ERL371 TLI            DATE 16NOV93               *
     H*                                                                    *
     H**********************************************************************
      *  CER001 - LUX Upgrade to MidasPlus                            *
     H*    CAD018   -   PARAMETERS NOT CORRECTLY MANAGED                   *
     H*    XXXXXX   -   DURATION CODE NOT SET UP WHEN SAME DATES           *
     H*    85606    -   ARRAY INDEX ERROR WHEN END DATE LESS THAN ZERO     *
     H*    ERL454   -   FROM DATE TO DATE, LESS OR EQUAL ONE YEAR          *
     H*    ERL409   -   DURATION CODES WRONGLY SET UP                      *
     H*    ERL371   -   IML 1.4 DEVELOPMENT                                *
     H**********************************************************************
     H*                                                                    *
     H* FUNCTION:    Calculate number of days between transaction          *
     H*              reporting date and end/review date AND setup          *
     H***************residual period code:  - 00  < or = 1 year and not = ERL409
     H**************************************      14 calendar days        ERL409
     H**************************************_ 01  > 1 year < or = 2 years ERL409
     H**************************************- 02  > 2 year < or = 3 years ERL409
     H**************************************- 03  > 3 year < or = 4 years ERL409
     H**************************************- xx  > xx year < or = yy yearERL409
     H**************************************- 99  = 14 calendar days      ERL409
     H*              residual period code:  - 01  < or = 1 year and not = ERL409
     H*                                           14 calendar days        ERL409
     H*                                     - 02  > 1 year < or = 2 years ERL409
     H*                                     - 03  > 2 year < or = 3 years ERL409
     H*                                     - 04  > 3 year < or = 4 years ERL409
     H*                                     - xx  > xx year < or = yy yearERL409
     H*                                                                    *
     F**********************************************************************
     E*
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZA0680 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
      /EJECT
      *
      **  Data Structure for compilation  - Copyright Insertion:
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I**  DATA STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE
     I            DS
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        3   40@@YY
     I                                        1   20@@CC
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I**
     I            DS
     I                                        1   80RESULT
     I                                        1   40NBYEAR
     I*
      /EJECT
      *===================================================================
     C**         *ENTRY    PLIST                           Entry parameterCAD018
     C**                   PARM           PARM1   80       I: Reporting daCAD018
     C**                   PARM           PARM2   80       I: End Date    CAD018
     C**                   PARM           PARM3   20       O: Residual DurCAD018
     C           *ENTRY    PLIST                           Entry parameterCAD018
     C                     PARM           PARM1   8        I: Reporting daCAD018
     C                     PARM           PARM2   8        I: End Date    CAD018
     C           PARM3     PARM           PARM3   20       O: Residual DurCAD018
      *===================================================================
      *
     C                     MOVELPARM1     WKRPDT  80
     C                     MOVELPARM2     WKENDT  80
      *
     C                     SUB  1         WKENDT                          ERL454
      *                                                                   ERL454
      **   If the reporting date has changed initialize period.
     C***********WKSTRD    IFNE BKSTRD                                    XXXXXX
     C*********************EXSR SRINIT                                    XXXXXX
     C*********************END                                            XXXXXX
      *********************                                               XXXXXX
      *****If the two input date are the sane do not process one more(saveXXXXXX
     C***********WKSTRD    IFEQ BKSTRD                                    XXXXXX
     C***********WKENDT    ANDEQBKENDT                                    XXXXXX
     C*********************GOTO SETUP                                     XXXXXX
     C*********************END                                            XXXXXX
      *
     C           WKRPDT    IFEQ 0
     C                     Z-ADD0         INITPR  20
     C                     GOTO SETUP
     C                     END
      *
     C***********WKENDT    IFEQ 0                                          85606
     C           WKENDT    IFLT 0                                          85606
     C                     Z-ADD0         INITPR
     C                     GOTO SETUP
     C                     END
      *
     C***********WKENDT    IFNE BKENDT                                    XXXXXX
      *                                                                   XXXXXX
      **   Convert reporting date in Midas format.                        XXXXXX
     C                     MOVELWKRPDT    @@DTIN                          XXXXXX
     C                     EXSR ZA0680                                    XXXXXX
     C                     MOVE @@MDNO    RPDT    50                      XXXXXX
      *                                                                   XXXXXX
     C                     MOVELWKENDT    @@DTIN
     C                     EXSR ZA0680
     C                     MOVE @@MDNO    ENDT    50
     C*********************END                                            XXXXXX
      **************************************************************************
     C**   Calcul period between to given date and setup corresponding code
      **************************************************************************
      *
      ** Calculate difference in year
     C           WKENDT    SUB  WKRPDT    RESULT
      *
      ** Calculate difference in days
     C           ENDT      SUB  RPDT      DIFF    50
      *
      ***<=*1*year*and*different*than*14*******                           ERL409
     C***********NBYEAR    IFLT 0001                                      ERL409
     C***********DIFF      ANDNE14                                        ERL409
     C*********************Z-ADD00        INITPR                          ERL409
      *                                                                   ERL409
      ** <= 1 year                                                        ERL409
     C           NBYEAR    IFLT 0001                                      ERL409
     C                     Z-ADD01        INITPR                          ERL409
     C                     GOTO SETUP
     C                     END
      *
      ***=*14*calendar*days***********                                    ERL409
     C***********DIFF******IFEQ 14                                        ERL409
     C*********************Z-ADD99        INITPR                          ERL409
     C*********************GOTO SETUP                                     ERL409
     C*********************END                                            ERL409
      *
      ***Setup*with*number*of*year**************                          ERL409
     C*********************Z-ADDNBYEAR    INITPR                          ERL409
      *                                                                   ERL409
      ** Setup with number of years plus 1                                ERL409
     C           1         ADD  NBYEAR    INITPR                          ERL409
      *
     C           SETUP     TAG                             *** SETUP PARM ***
      *
      ** Setup backup parameters to avoid proccessing
     C                     Z-ADDWKRPDT    BKRPDT  80
     C                     Z-ADDWKENDT    BKENDT  80
      *
      ** Setup output parameters
     C                     MOVELINITPR    PARM3
      *
     C                     RETRN
      *
      ** Define in98 for compilation
     C  N98                MOVE '0'       *IN98
     C/EJECT
     C*****************************************************************
     C* SRINIT - Routine called only if reporting date has changed    *
     C*****************************************************************
     C***********SRINIT    BEGSR                                          XXXXXX
      ***********                                                         XXXXXX
     C***********WKSTRD    IFNE 0                                         XXXXXX
      ***********                                                         XXXXXX
      *****Convert reporting date in Midas format.                        XXXXXX
     C***********          MOVELWKSTRD    @@DTIN                          XXXXXX
     C***********          EXSR ZA0680                                    XXXXXX
     C***********          MOVE @@MDNO    STRD    50                      XXXXXX
      ***********                                                         XXXXXX
     C***********          END                                            XXXXXX
      ***********                                                         XXXXXX
     C***********          ENDSR                                          XXXXXX
     C********************************************************************
     C/EJECT
     C*******************************************************************
     C*
     C           ZA0680    BEGSR
     C*
     C**  CLEAR OUT ANY 'OLD' DATA IN FIELD
     C                     Z-ADD0         @@MDNO  50
     C*
     C**   IF DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING
     C           @@YYYY    IFGE 2072                       B1
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)
     C           @@CC      SUB  19        @@WK2   20       *1
     C           @@WK2     MULT 36524     @@MDNO           *1
     C*
     C**  YEAR 2000 IS A LEAP YEAR MUST ALLOW EXTRA DAY
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C           @@YYYY    ADD  28        @@WK2
     C*
     C           @@WK2     DIV  4         @@WK2
     C                     MVR            @@REM   10
     C*
     C**    MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD
     C           @@WK2     MULT 1461      @@WK5   50
     C                     ADD  @@WK5     @@MDNO
     C*
     C**  CHECK REMAINDER AND MONTH NUMBER
     C           @@REM     IFEQ 0                          B1
     C           @@MTH     ANDGT2                          B1
     C                     ADD  1         @@MDNO           *1
     C                     END                             E1
     C*
     C**  YEAR NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR
     C           @@REM     IFNE 0                          B1
     C                     ADD  @YD,@@REM @@MDNO           *1
     C                     END                             E1
     C*
     C**  ADD MONTHS THIS YEAR
     C                     ADD  @MD,@@MTH @@MDNO
     C*
     C**  ADD DAYS THIS MONTH
     C                     ADD  @@DAY     @@MDNO
     C*
     C           ZA0689    ENDSR                           **ZA0689 TAG**
     C********************************************************************
** @YD  USED BY SR. ZA0680 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0680 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@
(c) Misys International Banking Systems Ltd. 2005
