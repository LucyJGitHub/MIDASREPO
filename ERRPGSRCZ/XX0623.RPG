     H        1   Y
      *****************************************************************   USW004
/*STD *  RPGBASE                                                      *   USW004
/*EXI *  TEXT('Midas ER Extract program - LE Lending')                *
      *****************************************************************
      *                                                               *
      *  Midas - European Reporting Module                            *
      *                                                               *
      *  XX0623 - ER Extract program - LE Lending                     *
      *                                                               *
      *  (c) Copyright Midas-Kapiti International 1992, 1996.         *
      *                                                               *
      *  Last Amend No. MD058100           Date 20May21               *
      *  Prev Amend No. LUC139             Date 11Mar21               *
      *                 MBV006             Date 08Jun08               *
      *                 MMI117             Date 17Jan05               *
      *                 MMI115             Date 06Apr04               *
      *                 225425             Date 03Mar04               *
      *                 222582             Date 28Oct03               *
      *                 MMI100             Date 27Feb03               *
      *                 MMI094             Date 09Oct02               *
      *                 206336             Date 06Jun02               *
      *                 197061             Date 23Aug01               *
      *                 191523             Date 21Mar01               *
      *                 191114             Date 15Mar01               *
      *                 MMI075             Date 09AUG00               *
      *                 MMI001             Date 05NOV97               *
      *                 UIT021             Date 13JAN97               *
      *                 USW004             Date 10SEP96               *
      *                 ART021    PT       Date 16SEP96               *
      *                 UCH001    PR       Date 13NOV95               *
      *                 UNL002             Date 10OCT95               *
      *                 ERL463 PT          DATE 05NOV96               *
      *                 107142 PT          DATE 21AUG96               *
      *                 ER_R10             DATE 18OCT94               *
      *                 ERL460 PT          DATE 08JUN95               *
      *                 ERL458 PT          DATE 11MAY95               *
      *                 85053  PT          DATE 11MAY95               *
      *                 80849  PT          DATE 11JAN95               *
      *                 57071  PT          DATE 22DEC94               *
      *                 ERL446 TLI         DATE 14NOV94               *
      *                 ERL428 PT          DATE 27AUG94               *
      *                 ERL417 PT          DATE 27AUG94               *
      *                 ERL416 PT          DATE 26JUL94               *
      *                 ER0402 PT          DATE 12JUL94               *
      *                 054791 TLI         DATE 24MAY93               *
      *                 EMFIX  TLI         DATE 11MAY93               *
      *                 ER0343 TLI         DATE 27APR93               *
      *                 ER0341 PT          DATE 21APR93               *
      *                 ER0337 PT          DATE 15APR93               *
      *                 ER0336 TLI         DATE 05APR93               *
      *                 ER0330 TLI         DATE 17MAR93               *
      *                 ER0329 TLI         DATE 16MAR93               *
      *                 ER0324 TLI         DATE 02MAR93               *
      *                 ER0321 TLI         DATE 15FEB93               *
      *                 ER0320 TLI         DATE 05FEB93               *
      *                 ER0317 TLI         DATE 02FEB93               *
      *                 ER0310 PT          DATE 26JAN93               *
      *                 ER0205 ADs         DATE 14JAN93               *
      *                 ER1012             DATE 15JAN93      ThL      *
      *                 ER0136 VT          DATE 23DEC92               *
      *                 ER0101 ADs         DATE 24NOV92               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD058100 - Rollup of additional BoI onsite fixes at FbMidas  *
      *  LUC139 - Upgrade BoI Returns to FbMidas                      *
      *  MBV006 - For Loans rebooked in Loan IQ, use the original     *
      *           Start Date from the related Midas Loan.             *
      *           Do not extract Matured Loans when being called      *
      *           from ERC0600LIQ (i.e. when U1 is on).               *
      *  MMI117 - CR2005                                              *
      *  MMI115 - Matured call loans should be extracted with real    *
      *           Start Date (while Start Date of live call loans is  *
      *           the end of month).                                  *
      *  225425 - Record reference (used for 204 and 277) to contain  *
      *           only Loan Number.                                   *
      *  222582 - Set field 113 to 1 (Variable Rate) if Last Rollover *
      *           Date is not zero and Rollover Date is zero          *
      *  MMI100 - Release 4.1 Upgrade - If a loan is still unpaid     *
      *           after Maturity date, shift Maturity date to fist    *
      *           day of next month.                                  *
      *  MMI094 - Recompiled over ERLVENL0                            *
      *  206336 - After 197061, loans with zero outstanding principal *
      *           but not matured are extracted with original amount. *
      *  197061 - Include loans matured today and loans with zero     *
      *           amount.                                             *
      *  191523 - Matured demand loans still reported as live         *
      *  191114 - Output Facility details on parts sold               *
      *  MMI075 - Midas Italy Puma/2 Extract Change 4                 *
      *  MMI001 - LEHISTL0 renamed from LEHISTV0 for DBA2 as file     *
      *           already existed.                                    *
      *  UIT021 - Bank of Italy Monthly Reporting                     *
      *  ART021 - SNB Article 21 development                          *
      *  UCH001 - European Reporting - Switzerland                    *
      *  UNL002 - European Reporting - Netherlands                    *
      *  ERL463 - In release 10, events type I2 have been replaced    *
      *           by events type X2 when interest are capitalised     *
      *  107142 - For monthly IBLC, we need to use the initial        *
      *           duration when the repayments are processed          *
      *  ER_R10 - EUROPEAN REPORTING - LUXEMBOURG UPGRADE IN R10      *
      *         - (R10 MULTIBRANCHING)                                *
      *  ERL460 - To increment a value for the repayments             *
      *  ERL458 - To set up field DSFREP to 1 for first repayment     *
      *  85053  - Amount reported in debit instead of credit          *
      *  80849  - For call loans, initial duration = notice days      *
      *  57071  - WHEN A PARTICIPATION PURCHASED HAS BEEN SOLD,       *
      *           THE PARTICIPATION SOLD AMOUNT MUST BE REPORTED      *
      *           UNDER THE ORIGINAL BORROWER OF THE PARTICIPATION    *
      *           PURCHASED AND NOT UNDER THE COUNTERPARTY            *
      *  ERL446 - NEW IML 2.3 DEVELOPMENT                             *
      *  ERL428 - To extract customer classification                  *
      *  ERL417 - To extract loan processing type                     *
      *  ERL416 - Repayments management incorporation (includes       *
      *           fix. 64629 for IMI)                                 *
      *  ER0402 - Credit type enlarged to last quarter past due cr.   *
      *  054791 - Setup Revision Date                                 *
      *  EMFIX  - FOR PARTICIPATION SOLD LNRF OVERWRITTEN             *
      *         - LOANS MATURED TAKE IN CONSIDERATION                 *
      *  ER0343 - Change setup of Maturity Date                       *
      *  ER0341 - For participations purchased, use original          *
      *           borrower as customer number                         *
      *  ER0337 - Processing type 70 must be processed                *
      *  ER0336 - Setup Credit Type field - IML 2.3 DEVELOPMENT       *
      *  ER0330 - Use the original borrower for the participations    *
      *           sold                                                *
      *  ER0329 - The Discount Amount must be removed from            *
      *           Principal Amount for loans processing type          *
      *           63, 66 and 67.                                      *
      *  ER0324 - Extract records if Deal Date reached                *
      *  ER0321 - Add 'Country of Citizenship'                        *
      *  ER0320 - Take Loans Past Due in consideration                *
      *  ER0317 - Change test with run date by end of month date      *
      *  ER0310 - Interest rate type indicator incorrectly set up     *
      *  ER0205 - Add B/n-B ind. and second Ccy on extract file       *
      *  ER1012 - Nominal amount is mandatory for Discount Loans &    *
      *           Participations.                                     *
      *  ER0136 - CALCULATE THE NUMBER OF EXTRACTED RECORDS           *
      *  ER0101 - Decision Key lenght from 6 to 8 (RECOMPILATION)     *
      *                                                               *
      *****************************************************************
     F**CLOANCL2IF  E           K        DISK                             ER0337
     F*LOANC  IF  E           K        DISK                     ER0337MMI075
     FCLOANCL IF  E           K        DISK                               ER0337
     F* LE Loans file                                                     MMI075
     F*                                                                   MMI075
     FMLOAN   IF  E           K        DISK                               ER0337
     F            CLOANCLF                          KRENAMECLOANCLM       MMI075
     F            CLOANHHF                          KIGNORE               ER0336
     F            CLOANCKF                          KRENAMECLOANCKM       MMI075
     F            CLOANZ1F                          KIGNORE               ER0336
     FCLOAN   IF  E           K        DISK                               ER0337
     F            CLOANCLF                          KIGNORE               MMI075
     F            CLOANHHF                          KIGNORE               ER0336
     F*****       CLOANCKF                          KIGNORE               ER0336
     F            CLOANZ1F                          KIGNORE               ER0336
     F* LE Loans file
     F*
     FERPARTL0IF  E           K        DISK                               ER0330
     F* Participations Sold file                                          ER0330
     F*                                                                   ER0330
     FSDCUSTL1IF  E           K        DISK
     F* Client Details file
     F*                                                                   ERL428
     FSDSECSL1IF  E           K        DISK                               ERL428
     F* SE Client Details file                                            ERL428
     F*
     FSDCUT2L0IF  E           K        DISK                               UIT021
      *** Customer Extended details for Italy                             UIT021
      *                                                                   UIT021
     FLOAMS   IF  E           K        DISK                               ER0336
     F            LOAMSDHF                          KIGNORE               ER0336
     F            LOAMSZ1F                          KIGNORE               ER0336
     F* Loan Amendments                                                   ER0336
     F*
     FSDCURRL1IF  E           K        DISK
     F* Currency Codes file
     F*
     FSDBRCHL1IF  E           K        DISK
     F* Branch Details - Master file
     F*
     FSDBANKL1IF  E           K        DISK
     F* Bank Details file
     F*                                                                   ERL416
     FERLVENL0IF  E           K        DISK                               ERL416
     F* ER Customer Lending Events                                        ERL416
     F*
     FLEACXAL3IF  E           K        DISK                               UNL002
     F* LE Accruals Extract by Loan number                                UNL002
     F*                                                                   UNL002
     FLEHISTV0IF  E           K        DISK                               UIT021
      *** LE history file                                                 UIT021
     F            HISTSHMF                          KIGNORE               UIT021
      *                                                                   UIT021
     FBVLQLKL1IF  E           K        DISK                               MBV006
     F* Loans rebooked from Midas to Loan IQ                              MBV006
     FEREXTRPDO   E                    DISK
     F* ER Production Extract
     F*
     FER0623AUO   E                    PRINTER
     F* ER Audit report for Customer Lending
     F*
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F**             *************************
     F**             ** INDICATORS NOT USED **
     F**             ** ------------------- **
     F**             *************************
     F**
     F**      ***************************************************
     F**      * ..   02   03   04   05   06   07   08   09   10 *
     F**      * 11   12   13   14   15   16   17   18   19   20 *
     F**      * 21   22   23   24   25   26   27   28   29   30 *
     F**      * 31   32   33   34   35   36   37   38   39   40 *
     F**      * 41   42   43   44   45   46   47   48   49   50 *
     F**      * 51   52   53   54   55   56   57   58   59   60 *
     F**      * 61   62   63   64   65   66   67   68   69   .. *
     F**      * 71   72   73   74   75   76   77   78   79   .. *
     F**      * 81   82   83   84   85   86   87   88   89   90 *
     F**      * 91   92   93   94   95   96   97   98   99      *
     F**      ***************************************************
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZDATE9 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*                                                                   ER0317
     E** ARRAY FOR ZDATE1                                                 ER0317
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAYER0317
     E                    ZMNM   12  12  3               ZDATE2 SR.ARRAY  ER0317
     E                    TNDM   12  12  2 0             NUMBER/DAY/MONTH ER0317
     E*
     E                    CT1    12  12  2 0                              ER0336
     E                    CT2    12  12  2 0                              ER0336
     IERPARTLD                                                            EMFIX
     I              LNRF                            ERLNRF                EMFIX
     ILOAMSDKF                                                            ER0336
     I              LNRF                            BQLNRF                ER0336
     I              VDAT                            BQVDAT                ER0336
     I              LTYP                            BQLTYP                ER0336
     I              SUTP                            BQSUTP                ER0336
     I              PTYP                            BQPTYP                ER0336
     I              CCY                             BQCCY                 ER0336
     I**************BRCD                            BQBRCD          ER0336ER_R10
     I              BRCA                            BQBRCD                ER_R10
     I              CNUM                            BQCNUM                ER0336
     I              FCUS                            BQFCUS                ER0336
     I              FTYP                            BQFTYP                ER0336
     I              FSEQ                            BQFSEQ                ER0336
     I              INTC                            BQINTC                ERL416
     I              PRAM                            BQPRAM                UIT021
     I              INTA                            BQINTA                UIT021
      *                                                                   UIT021
     IHISTSHPF                                                            UIT021
     I              RECI                            HZRECI                UIT021
     I              RCDT                            HZRCDT                UIT021
     I              BRCA                            HZBRCA                UIT021
     I              CNUM                            HZCNUM                UIT021
     I              LNRF                            HZLNRF                UIT021
     I              VDAT                            HZVDAT                UIT021
     I              PRSQ                            HZPRSQ                UIT021
     I              LASN                            HZLASN                UIT021
     I              FCUS                            HZFCUS                UIT021
     I              FTYP                            HZFTYP                UIT021
     I              PTYP                            HZPTYP                UIT021
     I              CCY                             HZCCY                 UIT021
     I              AMTP                            HZAMTP                UIT021
     I              PRAM                            HZPRAM                UIT021
     I              INTA                            HZINTA                UIT021
     I              WTXA                            HZWTXA                UIT021
     I              FEAM                            HZFEAM                UIT021
     I              FECD                            HZFECD                UIT021
     I              WOIN                            HZWOIN                UIT021
     I              EXVD                            HZEXVD                UIT021
     I              LTYP                            HZLTYP                UIT021
     I              SUTP                            HZSUTP                UIT021
     I              ZZ013                           HZZ013                UIT021
     I              LCD                             HZLCD                 UIT021
     I              ZZ001                           HZZ001                UIT021
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I*LDA        UDS                            256                      USW004
     I******                                132 183 DBLOT                 USW004
     I******                                132 141 DBFILE                USW004
     I******                                134 141 DBFILE                USW004
     I******                                142 170 DBKEY                 USW004
     I******                                171 180 DBPGM                 USW004
     I******                                181 1830DBASE                 USW004
     ILDA       E DSLDA                         256                       USW004
      *                                                                   USW004
      ** Local data area for database error details                       USW004
      ** *LOCK IN LDA immediately before and OUT LDA immediately          USW004
      ** after each database error handling.                              USW004
      **                                                                  USW004
      **                                    134 141 DBFILE                USW004
      **       Defines:                     142 170 DBKEY                 USW004
      **                                    171 180 DBPGM                 USW004
      **                                    181 1830DBASE                 USW004
     I**
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I**  DATA STRUCTURE FOR SR. ZDATE9 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I*
     I**  DATA STRUCTURE FOR LOAN TYPE/SUBTYPE
     I            DS
     I                                        1   2 LTYP
     I                                        3   4 SUTP
     I                                        1   4 TSTYPE
     I**  MIDAS RUN DATE                                                  ER0317
     I            DS                                                      ER0317
     I                                        1   7 BJMRDT                ER0317
     I                                        1   20WWBJD                 ER0317
     I                                        3   5 WWBJM                 ER0317
     I                                        6   70WWBJY                 ER0317
     I**  DEFINE A DATE                                                   ER0317
     I            DS                                                      ER0317
     I                                        1   60WWDATE                ER0317
     I                                        1   20WWD                   ER0317
     I                                        3   40WWM                   ER0317
     I                                        5   60WWY                   ER0317
     I*
     I**  DEFINED BEGIN OF QUARTER                                        ER0336
     I            DS                                                      ER0336
     I                                        1   40BQYEAR                ER0336
     I                                        5   60BQMONT                ER0336
     I                                        7   80BQDAY                 ER0336
     I                                        1   80BQDATE                ER0336
     I*                                                                   ERL458
     I**  DEFINED TRANSACTION REFERENCE FOR FIRST REPAYMENT               ERL458
     I            DS                                                      ERL458
     I                                        1  21 EXTREF                ERL458
     I                                        8  10 DSREPN                ERL460
     I*********                              11  11 DSFREP          ERL458225425
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*                    M A I N
     C*****************************************************************
     C*
     C** KEY TO ACCESS LOAN TYPE/SUBTYPE EXTENDED FILE
     C           KEYTST    KLIST
     C                     KFLD           LTYP
     C                     KFLD           SUTP
     C*
     C                     EXSR #INIT
     C*
     C*********************READ CLOANCL2                 30               ER0337
     C******               READ CLOANC                   30         ER0337MMI075
     C                     READ CLOANCL                  30         ER0337MMI075
     C*
     C** MAIN PROCESSING
     C           *IN30     DOWEQ'0'                        - B1
     C*
     C                     EXSR P003
     C*
     C*********************READ CLOANCL2                 30               ER0337
     C******               READ CLOANC                   30         ER0337MMI075
     C                     READ CLOANCL                  30               MMI075
     C*
     C                     END                             - E1
     C*
     C***                  READ MLOAN                    30               ER0337
     C                     READ CLOANCLM                 30               ER0337
     C**N30      LNRF      CHAINCLOANCKF             11
     C**N11                Z-ADDOPAM      CPAM
     C*
     C** MAIN PROCESSING
     C           *IN30     DOWEQ'0'                        - B1
     C           *INU1     ANDEQ*OFF                                      MBV006
     C*
     C                     EXSR P003
     C*
     C                     READ CLOANCLM                 30               ER0337
     C**N30      LNRF      CHAINCLOANCKF             11
     C**N11                Z-ADDOPAM      CPAM
     C*
     C                     END                             - E1
     C*
     C** TERMINATION PROCESSING
     C                     WRITEDETAIL                                    ER0136
     C******               WRITEENDRPT                             ER0136 USW004
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C/EJECT
     C**************************************************************************
     C* P003 - DETAIL PROCESSING SUB-ROUTINE
     C**************************************************************************
     C*
     C           P003      BEGSR
     C*                                                                   206336
     C                     MOVE RECI      CLRECI  1                       206336
     C*
     C** IF MATURITY DATE EQUAL 0
     C***********MDAT      IFEQ *ZEROS                     - B1           ER0343
     C*********************MOVE *ZEROS    ABMDAT  80                      ER0343
     C*********************ELSE                            - X1           ER0343
     C*                                                                   ER0343
     C           PTYP      IFEQ 61                         - B1           ER0343
     C           MDAT      ANDEQ*ZERO                                     191523
     C           MDAT      ORLE EREOMD                                    MMI100
     C           CPAM      ANDNE*ZERO                                     MMI100
     C           RECI      ANDEQ'D'                                       MMI100
     C           EREOMD    ADD  1         @@DAYN                          ER0343
     C                     ELSE                            - X1           ER0343
     C**********                                                          ER0343
     C********** EREOMD    IFLT MDAT                       - B2           ER0343
     C                     Z-ADDMDAT      @@DAYN                          ER0343
     C**********           ELSE                            - X2           ER0343
     C********** EREOMD    ADD  1         @@DAYN                          ER0343
     C**********           END                             - E2           ER0343
     C**********                                                          ER0343
     C                     END                             - E1           ER0343
     C*
     C*********************Z-ADDMDAT      @@DAYN  50                      ER0343
     C                     EXSR ZDATE9
     C*********************Z-ADD@@VDT     ABMDAT                          ER0343
     C                     Z-ADD@@VDT     ABMDAT  80                      ER0343
     C*********************END                             - E1           ER0343
     C*                                                                   MBV006
     C* For Loans rebooked in Loan IQ, use the original Start             MBV006
     C* Date from the related Midas Loan.                                 MBV006
     C*                                                                   MBV006
     C           LNRF      CHAINBVLQLKD0             01                   MBV006
     C           *IN01     IFEQ *OFF                                      MBV006
     C           BVOOST    ANDGT*ZERO                                     MBV006
     C           BVOOST    ANDLTVDAT                                      MBV006
     C                     Z-ADDBVOOST    VDAT                            MBV006
     C                     ENDIF                                          MBV006
     C*
     C** SET UP VALUE DATE IN ABACUS FORMAT                               MMI033
     C                     Z-ADDVDAT      @@DAYN                          MMI033
     C                     EXSR ZDATE9                                    MMI033
     C                     Z-ADD@@VDT     HKVDAT  80                      MMI033
     C*                                                                   MMI033
     C** SET UP DEAL DATE IN ABACUS FORMAT                                MMI033
     C                     Z-ADDDDAT      @@DAYN                          MMI033
     C                     EXSR ZDATE9                                    MMI033
     C                     Z-ADD@@VDT     HKDDAT  80                      MMI033
     C*                                                                   MMI033
     C                     Z-ADDMDAT      @@DAYN                          MMI033
     C                     EXSR ZDATE9                                    MMI033
     C                     Z-ADD@@VDT     HKMDAT  80                      MMI033
     C*                                                                   MMI033
     C** GENERAL TEST FOR RECORD ACCEPTANCE
     C***********BJRDNB    IFGE VDAT                       - B1           ER0317
     C***********BJRDNB    ANDLTMDAT                                      ER0317
     C***********BJRDNB    ORGE VDAT                                      ER0317
     C***********EREOMD    IFGE VDAT                       - B1    ER0317 ER0324
     C           EREOMD    IFGE DDAT                       - B1           ER0324
     C********** CPAM      ANDNE0                                   ER0320197061
     C           RECI      ANDNE'M'                                       EMFIX
     C***********EREOMD    ANDLTMDAT                               ER0317 ER0320
     C***********EREOMD    ORGE VDAT                               ER0317 ER0320
     C***********MDAT      ANDEQ*ZEROS                                    ER0320
     C           HKMDAT    ORGE WWREPI                     - B1           MMI033
     C********** HKMDAT    ANDLTWWREPD                              MMI033197061
     C           HKMDAT    ANDLEWWREPD                                    197061
     C***********DLNO      ANDLT98000                                     MMI033
     C******     RECI      ANDEQ'M'                                       MMI033
     C*
     C*
     C** OLD BRANCH FIELD IS NOT EQUAL TO NEW BRANCH FIELD
     C***********BRCD      IFNE WWBRCD                     - B2           ER_R10
     C           BRCA      IFNE WWBRCD                     - B2           ER_R10
     C** STORE NEW BRANCH IN OLD BRANCH
     C***********          Z-ADDBRCD      WWBRCD  30                      ER_R10
     C                     MOVE BRCA      WWBRCD  3                       ER_R10
     C*
     C***********          MOVE BRCD      AABRCD  3                       ER_R10
     C                     MOVE BRCA      AABRCD  3                       ER_R10
     C*
     C           AABRCD    CHAINSDBRCHL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'001'     DBASE            *****************
     C                     MOVEL'SDBRCHL1'DBFILE           ** DB ERROR 01 **
     C                     MOVELAABRCD    DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** ACCESS CUSTOMER DETAILS FILE
     C           A8BICN    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'002'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 02 **
     C                     MOVELA8BICN    DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    WWORCC  2
     C                     END                             - E2
     C*
     C** TRANSFORM VALUE DATE FROM MIDAS FORMAT TO ABACUS FORMAT
     C           PTYP      IFEQ 61                         - B1           80849
     C           EREOMD    ANDGEVDAT                                      80849
     C           RECI      ANDEQ'D'                                       MMI115
     C                     Z-ADDEREOMD    @@DAYN                          80849
     C                     ELSE                                           80849
     C                     Z-ADDVDAT      @@DAYN
     C                     END                                            80849
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     ABVDAT  80
     C*                                                                   ER0324
     C** TRANSFORM DEAL DATE FROM MIDAS FORMAT TO ABACUS FORMAT           ER0324
     C                     Z-ADDDDAT      @@DAYN                          ER0324
     C                     EXSR ZDATE9                                    ER0324
     C                     Z-ADD@@VDT     ABDDAT  80                      ER0324
     C*
     C** TRANSFORM ROLLOVER DATE FROM MIDAS FORMAT TO ABACUS FORMAT
     C                     Z-ADDRLDT      @@DAYN
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     ABRLDT  80
     C*                                                                   ER0330
     C** IF PARTICIPATION SOLD TAKE CUSTOMER NUMBER OF PARTICIPATION      ER0330
     C** OR ORIGINAL BORROWER IF ANY (PARTICIPATION PURCHASED SOLD)       57071
     C           PTYP      IFEQ 66                         - B2           ER0330
     C           PTYP      OREQ 67                                        ER0330
     C           OLNO      CHAINERPARTL0             88                   ER0330
     C           *IN88     IFEQ '0'                                       57071
     C           OLNO      ANDNE*ZEROS                                    57071
     C                     MOVELOLNO      CNUM                            57071
     C                     END                                            57071
     C                     END                             - E2           ER0330
     C*
     C** ACCESS CUSTOMER DETAILS WITH CUSTOMER NUMBER
     C                     MOVE CNUM      AACNUM  6
     C** FOR PARTICIPATIONS PURCHASED, USE ORIGINAL BORROWER              ER0341
     C           PTYP      IFEQ 64                                        ER0341
     C           PTYP      OREQ 65                                        ER0341
     C                     MOVE OLNO      AACNUM                          ER0341
     C                     MOVE CNUM      EXFINR                          MMI117
     C                     END                                            ER0341
     C*                                                                   ERL428
     C** ACCESS SECURITIES CUSTOMER DETAILS FILE                          ERL428
     C           AACNUM    CHAINSDSECSL1             88                   ERL428
     C*                                                                   ERL428
     C** Store Customer classification                                    ERL428
     C           *IN88     IFEQ '0'                        - B2           ERL428
     C                     MOVE BFCLAS    EXCLAS                          ERL428
      *                                                                   UCH001
      ***  UCH001 : Store Pledge agreement                                UCH001
      *                                                                   UCH001
     C                     MOVE BFPLAG    EXPLAG                          UCH001
     C                     END                             - E2           ERL428
     C*                                                                   ERL428
     C** ACCESS CUSTOMER DETAILS                                          ERL428
     C           AACNUM    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'003'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 03 **
     C                     MOVELAACNUM    DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*                                                                   ER0205
     C** STORE Bank/non-Bank Indicator                                    ER0205
     C                     MOVE BBBNBI    EXBNBI                          ER0205
     C*
     C** STORE CUSTOMER NUMBER
     C                     MOVE BBCUST    EXCUST
     C                     MOVE BBBFIC    EXCTPY                          UIT021
     C*
     C** STORE COUNTRY OF LOCATION
     C                     MOVE BBCOLC    EXCUCC
     C*
     C** STORE CUSTOMER SHORTNAME
     C                     MOVE BBCSSN    EXCSSN
     C*
     C** STORE CUSTOMER REPORT NAME
     C                     MOVE BBCRNM    EXCRNM
     C*                                                                   ER0321
     C** STORE COUNTRY OF CITIEZNSHIP                                     ER0321
     C                     MOVE BBCNCZ    EXCNCZ                          ER0321
     C*
     C** PARENT CUSTOMER NUMBER IF NOT EQUAL BLANK
     C           BBPCNB    IFNE *BLANKS                    - B2
     C*
     C           BBPCNB    CHAINSDCUSTL1             88
     C           *IN88     IFEQ '1'                        - B3
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'004'     DBASE            *****************
     C                     MOVEL'SDCUSTL1'DBFILE           ** DB ERROR 04 **
     C                     MOVELBBPCNB    DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E3
     C*
     C** STORE PARENT CUSTOMER NUMBER AND PARENT COUNTRY CODE
     C                     MOVE BBCUST    EXPCNB
     C                     MOVE BBCOLC    EXPRCC
     C                     ELSE                            - X2
     C*
     C** ELSE RESET FIELDS
     C                     MOVE *BLANKS   EXPCNB
     C                     MOVE *BLANKS   EXPRCC
     C                     END                             - E2
     C*
     C** IF BASE RATE CODE IS EQUAL TO BLANK
     C           BRTT      IFEQ *ZEROS                     - B2
     C           RLDT      ANDEQ*ZEROS                                    ER0310
     C           LRLD      ANDEQ*ZEROS                                    222582
     C                     Z-ADD1         EXIRTT
     C                     ELSE                            - X2
     C                     Z-ADD2         EXIRTT
     C                     END                             - E2
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'LEN'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LECL'    EXRIND
     C*
     C** GET PARTICIPATION PURCHASED INFORMATIONS
     C           PTYP      IFEQ 64
     C           PTYP      OREQ 65
     C                     EXSR P007
     C                     END
     C*
     C** GET PARTICIPATION SOLD INFORMATIONS
     C           PTYP      IFEQ 66
     C           PTYP      OREQ 67
     C                     EXSR P008
     C                     END
     C*
     C** STORE AMOUNT IN CURRENCY
     C           CPAM      IFLT 0                          - B2
     C                     Z-SUBCPAM      CPAM
     C                     END                             - E2
     C*
     C********   PTYP      IFEQ 63                         - B2     ER0329MMI075
     C********   PTYP      OREQ 66                                  ER0329MMI075
     C           PTYP      IFEQ 66                         - B2     ER0329MMI075
     C           PTYP      OREQ 67                                        ER0329
     C                     SUB  TOTI      CPAM                            ER0329
     C                     END                             - E2           ER0329
     C*
     C           CCY       CHAINSDCURRL1             88
     C           *IN88     IFEQ '1'                        - B2
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'005'     DBASE            *****************
     C                     MOVEL'SDCURRL1'DBFILE           ** DB ERROR 05 **
     C                     MOVELCCY       DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E2
     C*
     C           A6NBDP    IFEQ 0                          - B2
     C           CPAM      MULT 1000      EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 1                          - B2
     C           CPAM      MULT 100       EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 2                          - B2
     C           CPAM      MULT 10        EXAMNT
     C                     END                             - E2
     C           A6NBDP    IFEQ 3                          - B2
     C                     Z-ADDCPAM      EXAMNT
     C                     END                             - E2
      *
      ** STORE PARTICIPATION SOLD AMOUNT IN 'MARGIN AMOUNT'               ERL446
     C           A6NBDP    IFEQ 0                          - B2           ERL446
     C           PSAM      MULT 1000      EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 1                          - B2           ERL446
     C           PSAM      MULT 100       EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 2                          - B2           ERL446
     C           PSAM      MULT 10        EXMARA                          ERL446
     C                     END                             - E2           ERL446
     C           A6NBDP    IFEQ 3                          - B2           ERL446
     C                     Z-ADDPSAM      EXMARA                          ERL446
     C                     END                             - E2           ERL446
      *
     C           PTYP      IFEQ 63                         Discount Loan  ER1012
     C           PTYP      OREQ 65                         Disc.Part.Purc.ER1012
     C           PTYP      OREQ 67                         Disc.Part.Sold ER1012
     C                     Z-ADDEXAMNT    EXNOMA                          ER1012
     C                     ELSE                                           ER1012
     C                     Z-ADD*ZEROS    EXNOMA                          ER1012
     C                     END                                            ER1012
      *
     C                     EXSR SRCRET                                    ER0336
     C*                                                                   UIT021
     C** Extract Loan Processing Type                                     UIT021
     C                     MOVE PTYP      EXPTYP                          UIT021
      *                                                                   UIT021
      *** If Mortgage (Repayment type is 3), cumulate Matured amounts     UIT021
      *                                                                   UIT021
     C           REPT      IFEQ 3                                         UIT021
     C                     EXSR SRMORT                                    UIT021
     C                     ENDIF                                          UIT021
      *
     C** WRITE RECORD IN OUTPUT FILE
     C                     EXSR W001
     C*
     C                     END                             - E1
     C*
     C                     ENDSR
     C**************************************************************************
     C* P007 - SUBROUTINE TO GET PARTICIPATION PURCHASED INFORMATIONS          *
     C**************************************************************************
     C*
     C           P007      BEGSR
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'PPU'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LEPP'    EXRIND
     C*
     C** STORE DEBIT/CREDIT INDICATOR
     C                     Z-ADD0         EXDRCR
     C*
     C                     ENDSR
     C**************************************************************************
     C* P008 - SUBROUTINE TO GET PARTICIPATION SOLD INFORMATIONS               *
     C**************************************************************************
     C*
     C           P008      BEGSR
     C*
     C** STORE LOT DESCRIPTOR
     C                     MOVE 'PSO'     EXLOTD
     C*
     C** STORE RECORD IDENTIFIER
     C                     MOVE 'LEPS'    EXRIND
     C*
     C** STORE DEBIT/CREDIT INDICATOR
     C                     Z-ADD1         EXDRCR
     C***********                                                         191114
     C***RESET*FACILITY CUSTOMER, NUMBER AND SEQUENCE IF PARTICIPATION SO 191114
     C***********          Z-ADD0         FCUS                            191114
     C***********          Z-ADD0         FTYP                            191114
     C***********          Z-ADD0         FSEQ                            191114
     C*
     C                     ENDSR
     C**************************************************************************
     C* W001 - SUBROUTINE TO WRITE A RECORD IN EREXTRPD OUTPUT FILE
     C**************************************************************************
     C*
     C           W001      BEGSR
     C*
     C                     Z-ADD001       EXRECT
     C                     Z-ADDWWREPD    EXREPD
     C***********          MOVE BRCD      EXBRCD                          ER_R10
     C                     MOVE BRCA      EXBRCD                          ER_R10
     C                     MOVELLNRF      EXTREF
     C                     MOVELTSTYPE    EXDECK
     C                     MOVE CCY       EXCCYC
     C                     MOVE WWORCC    EXORCC
     C                     MOVE RCSI      EXRCSI
     C           EREOMD    IFLT VDAT                       - B1           ER0324
     C                     Z-ADDABDDAT    EXSTRD                          ER0324
     C                     Z-ADDABVDAT    EXENDD                          ER0324
     C                     MOVELTSTYPE    OODECK  5                       ER0324
     C                     MOVE 'O'       OODECK                          ER0324
     C                     MOVELOODECK    EXDECK                          ER0324
     C                     ELSE                            - X1           ER0324
     C                     Z-ADDABVDAT    EXSTRD
     C                     Z-ADDABMDAT    EXENDD
     C                     END                             - E1           ER0324
     C           ABRLDT    IFNE *ZEROS                                    054791
     C                     Z-ADDABRLDT    EXREVD
     C                     ELSE                                           054791
     C                     Z-ADDABMDAT    EXREVD                          054791
     C                     END                                            054791
     C                     MOVE FCUS      EXFCUS
     C                     Z-ADDFTYP      EXFACT
     C                     Z-ADDFSEQ      EXFCNO
     C*                                                                   UNL002
     C** Accrued Interest and Interest to accrue                          UNL002
     C           LNRF      CHAINLEACXAL3             88                   UNL002
     C           *IN88     IFEQ '1'                        - B1           UNL002
     C                     Z-ADD*ZEROS    EXACCR                          UNL002
     C                     Z-ADD*ZEROS    EXITAC                          UNL002
     C                     ELSE                            - X1           UNL002
     C*                                                                   UNL002
     C           A6NBDP    IFEQ 0                          - B2           UNL002
     C           AMAD      MULT 1000      EXACCR                          UNL002
     C           AMTA      MULT 1000      EXITAC                          UNL002
     C                     END                             - E2           UNL002
     C           A6NBDP    IFEQ 1                          - B2           UNL002
     C           AMAD      MULT 100       EXACCR                          UNL002
     C           AMTA      MULT 100       EXITAC                          UNL002
     C                     END                             - E2           UNL002
     C           A6NBDP    IFEQ 2                          - B2           UNL002
     C           AMAD      MULT 10        EXACCR                          UNL002
     C           AMTA      MULT 10        EXITAC                          UNL002
     C                     END                             - E2           UNL002
     C           A6NBDP    IFEQ 3                          - B2           UNL002
     C                     Z-ADDAMAD      EXACCR                          UNL002
     C                     Z-ADDAMTA      EXITAC                          UNL002
     C                     END                             - E2           UNL002
     C                     END                             - E1           UNL002
     C*                                                                   UNL002
     C** Start/Last Interest Date                                         UNL002
     C                     Z-ADDSLID      @@DAYN                          UNL002
     C                     EXSR ZDATE9                                    UNL002
     C                     Z-ADD@@VDT     EXSLID                          UNL002
     C*                                                                   UNL002
     C** Next Interest Due Date                                           UNL002
     C                     Z-ADDNIDT      @@DAYN                          UNL002
     C                     EXSR ZDATE9                                    UNL002
     C                     Z-ADD@@VDT     EXNIDT                          UNL002
     C*                                                                   UNL002
     C** Retail Indicators                                                UNL002
     C                     MOVE *BLANKS   EXRETB                          UNL002
     C*                                                                   UNL002
     C** Save values before repayments processing                         UNL002
     C                     Z-ADDEXACCR    WWACCR 160                      UNL002
     C                     Z-ADDEXITAC    WWITAC 160                      UNL002
     C                     Z-ADDEXSLID    WWSLID  80                      UNL002
     C                     Z-ADDEXNIDT    WWNIDT  80                      UNL002
     C                     MOVE EXRETB    WWRETB  1                       UNL002
     C                     Z-ADDPTYP      EXPTYP                          ERL417
     C*                                                                   ERL416
     C** REPAYMENTS MANAGEMENT                                            ERL416
     C                     MOVE 'N'       REPIND  1                       ERL416
     C*                                                                   ERL416
     C**    SAVE VALUES AFTER REPAYMENTS PROCESSING                       ERL416
     C                     Z-ADDEXAMNT    WWAMNT 160                      ERL416
     C                     Z-ADDEXENDD    WWENDD  80                      ERL416
     C                     Z-ADDEXENDD    EXQINC                          107142
     C                     Z-ADDEXDRCR    WWDRCR  10                      085053
     C*                                                                   ERL416
     C                     EXSR REPAY                                     ERL416
     C*                                                                   ERL416
     C**    RESTORE VALUES AFTER REPAYMENTS PROCESSING                    ERL416
     C                     Z-ADDWWAMNT    EXAMNT                          ERL416
     C                     Z-ADDWWENDD    EXENDD                          ERL416
     C                     Z-ADDWWDRCR    EXDRCR                          085053
     C                     Z-ADDWWACCR    EXACCR                          UNL002
     C                     Z-ADDWWITAC    EXITAC                          UNL002
     C                     Z-ADDWWSLID    EXSLID                          UNL002
     C                     Z-ADDWWNIDT    EXNIDT                          UNL002
     C                     MOVE WWRETB    EXRETB                          UNL002
     C*                                                                   ERL416
     C           REPIND    IFEQ 'Y'                                       ERL416
     C***********          MOVE 'REX'     EXTREF                          ERL416
     C                     MOVE '   '     EXTREF                          225425
     C                     END                                            ERL416
     C*                                                                   ERL458
     C*********            MOVE '1'       DSFREP                    ERL458225425
     C*                                                                   ER0136
     C** ADD 1 TO NUMBER OF EXTRACTED RECORDS                             ER0136
     C                     ADD  1         NREC    30                      ER0136
     C*
     C           EXAMNT    IFEQ 0                                         MMI075
     C           CLRECI    ANDEQ'M'                                       206336
     C           LNRF      CHAINCLOANCKF             11                   MMI075
     C   11      LNRF      CHAINCLOANCKM             11                   MMI075
     C  N11                DO                                             MMI075
     C                     Z-ADDOPAM      CPAM                            MMI075
     C           A6NBDP    IFEQ 0                          - B2           MMI075
     C           CPAM      MULT 1000      EXAMNT                          MMI075
     C                     END                             - E2           MMI075
     C           A6NBDP    IFEQ 1                          - B2           MMI075
     C           CPAM      MULT 100       EXAMNT                          MMI075
     C                     END                             - E2           MMI075
     C           A6NBDP    IFEQ 2                          - B2           MMI075
     C           CPAM      MULT 10        EXAMNT                          MMI075
     C                     END                             - E2           MMI075
     C           A6NBDP    IFEQ 3                          - B2           MMI075
     C                     Z-ADDCPAM      EXAMNT                          MMI075
     C                     END                             - E2           MMI075
     C                     END                             - E2           MMI075
      *                                                                   MMI075
     C                     END                             - E2           MMI075
      *
     C** WRITE A RECORD
     C                     WRITEEREXTRF0
     C*
     C** RESET FILE RECORD FORMAT
     C                     RESETEREXTRF0
     C*
     C                     ENDSR
     C********************************************************************ER0336
     C* SRCRET - SUBROUTINE TO SETUP CREDIT TYPE FIELD                    ER0336
     C*          Also used to doubtful  code EXDBCD                       UIT021
     C*                       Cumulate Past due Amount and interest       UIT021
     C*                       Mortgage Cumul. unpaid Amount and interest  UIT021
     C********************************************************************ER0336
     C*                                                                   ER0336
     C           SRCRET    BEGSR                                          ER0336
      *                                                                   UIT021
      ***  Check if client is doubtful                                    UIT021
      *                                                                   UIT021
     C                     MOVE '0'       EXDBCD                          UIT021
     C           EXCUST    CHAINSDCUT2L0             99                   UIT021
     C           *IN99     IFEQ *ON                        not found      UIT021
     C           *LOCK     IN   LDA                                       UIT021
     C                     MOVEL'010'     DBASE            *****************T021
     C                     MOVEL'SDCUT2L0'DBFILE           ** DB ERROR 10 **T021
     C                     MOVELEXCUST    DBKEY            *****************T021
     C                     OUT  LDA                                       UIT021
     C                     EXSR *PSSR                                     UIT021
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
     C                     Z-ADD0         WWCADF 160       Capital doubtf.UIT021
     C                     Z-ADD0         WWIADF 160       Interest Doubt UIT021
      *                                                    Mortgage       UIT021
     C                     Z-ADD0         WWMUPR 160       Unpaid Capital UIT021
     C                     Z-ADD0         WWIMUP 160       Unpaid Interst UIT021
     C*                                                                   ER0336
     C                     Z-ADD0         EXCRET                          ER0336
     C                     MOVE 'N'       PASDUE  1                       ER0402
     C*                                                                   ER0336
     C                     MOVE *ZEROS    KEY6    6                       ER0336
     C                     MOVELLNRF      KEY6                            ER0336
     C           KEY6      SETLLLOAMS                                     ER0336
     C                     READ LOAMS                    66               ER0336
     C*                                                                   ER0336
     C           *IN66     DOWEQ'0'                        - B1           ER0336
     C           BQLNRF    ANDEQLNRF                                      ER0336
     C*                                                                   ER0336
     C           AMTP      IFEQ 'PD'                       - B2           ER0336
      *                                                                   UIT021
      ***  If Client is doubtful  and at least one Past Due record        UIT021
      ***  then fill out EXDBCD doubtful  code with '1'                   UIT021
      *                                                                   UIT021
     C           PCDBCD    IFEQ 1                                         UIT021
     C                     MOVE '1'       EXDBCD                          UIT021
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
      ***  Keep ER0336 fix                                                UIT021
      *                                                                   UIT021
     C           EXCRET    IFEQ 0                                         UIT021
     C                     MOVE 'Y'       PASDUE                          ER0402
     C                     Z-ADD2         EXCRET                          ER0336
     C*********************GOTO ENDRD                              ER0402 UIT021
     C*********************GOTO #9CRET                             ER0336 ER0402
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
      ***  Cumulate every Past due Amount and Past due interest           UIT021
      *                                                                   UIT021
     C                     ADD  BQPRAM    WWCADF                          UIT021
     C                     ADD  BQINTA    WWIADF                          UIT021
      *                                                                   UIT021
      ***  If Loan repayment type is 3 (Mortgage),                        UIT021
      ***  then cumulate Unpaid amount in interest (Past due)             UIT021
      *                                                                   UIT021
     C           REPT      IFEQ 3                                         UIT021
     C                     ADD  BQPRAM    WWMUPR                          UIT021
     C                     ADD  BQINTA    WWIMUP                          UIT021
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
     C                     END                             - E2           ER0336
     C*                                                                   ER0336
     C                     READ LOAMS                    66               ER0336
     C*                                                                   ER0336
     C                     END                             - E1           ER0336
      *                                                                   UIT021
      ***  Convert Output amounts in 3 dec (IML)                          UIT021
      *                                                                   UIT021
     C                     SELEC                                          UIT021
     C           A6NBDP    WHEQ 0                                         UIT021
     C*****      WWCADF    MULT 1000      EXCADF                          UIT021
     C*****      WWIADF    MULT 1000      EXIADF                          UIT021
     C*****      WWMUPR    MULT 1000      EXMUPR                          UIT021
     C*****      WWIMUP    MULT 1000      EXIMUP                          UIT021
      *                                                                   UIT021
     C           A6NBDP    WHEQ 1                                         UIT021
     C*****      WWCADF    MULT 100       EXCADF                          UIT021
     C*****      WWIADF    MULT 100       EXIADF                          UIT021
     C*****      WWMUPR    MULT 100       EXMUPR                          UIT021
     C*****      WWIMUP    MULT 100       EXIMUP                          UIT021
      *                                                                   UIT021
     C           A6NBDP    WHEQ 2                                         UIT021
     C*****      WWCADF    MULT 10        EXCADF                          UIT021
     C*****      WWIADF    MULT 10        EXIADF                          UIT021
     C*****      WWMUPR    MULT 10        EXMUPR                          UIT021
     C*****      WWIMUP    MULT 10        EXIMUP                          UIT021
      *                                                                   UIT021
     C           A6NBDP    WHEQ 3                                         UIT021
     C*****                Z-ADDWWCADF    EXCADF                          UIT021
     C*****                Z-ADDWWIADF    EXIADF                          UIT021
     C*****                Z-ADDWWMUPR    EXMUPR                          UIT021
     C*****                Z-ADDWWIMUP    EXIMUP                          UIT021
      *                                                                   UIT021
     C                     ENDSL                                          UIT021
      *                                                                   UIT021
      ***  EXCRET is defined, go to end of routine (fix ER0336)           UIT021
      *                                                                   UIT021
     C           EXCRET    IFEQ 2                                         UIT021
     C                     GOTO #9CRET                                    ER0336
     C                     ENDIF                                          UIT021
     C*                                                                   ER0402
     C           ENDRD     TAG                                            ER0402
     C*                                                                   ER0336
     C                     Z-ADDWWREPD    BQDATE                          ER0336
     C                     Z-ADD1         J       20                      ER0336
     C           BQMONT    LOKUPCT1,J                    26               ER0336
     C                     Z-ADDCT2,J     BQMONT                          ER0336
     C                     Z-ADD1         BQDAY                           ER0336
     C*                                                                   ER0336
     C*                    ]  PAST DUE   ]  NOT PAST DUE                  ER0402
     C* __________________ ]____________ ]_______________                 ER0402
     C*                    ]             ]                                ER0402
     C*  LAST QUARTER      ]      4      ]      3                         ER0402
     C*                    ]             ]                                ER0402
     C*  NOT LAST QUARTER  ]      2      ]      1                         ER0402
     C*                    ]             ]                                ER0402
     C*                                                                   ER0402
     C           ABVDAT    IFGE BQDATE                     - B1           ER0336
     C*                                                                   ER0402
     C           PASDUE    IFEQ 'N'                                       ER0402
     C                     Z-ADD3         EXCRET                          ER0336
     C                     ELSE                                           ER0402
     C                     Z-ADD4         EXCRET                          ER0402
     C                     END                                            ER0402
     C*                                                                   ER0402
     C                     ELSE                            - X1           ER0336
     C*                                                                   ER0402
     C           PASDUE    IFEQ 'N'                                       ER0402
     C                     Z-ADD1         EXCRET                          ER0336
     C                     ELSE                                           ER0402
     C                     Z-ADD2         EXCRET                          ER0402
     C                     END                                            ER0402
     C*                                                                   ER0402
     C                     END                             - E1           ER0336
     C*                                                                   ER0336
     C           #9CRET    TAG                                            ER0336
     C                     ENDSR                                          ER0336
      *****************************************************************   UIT021
      * SRMORT - Mortgage processing for Matured Capital paid         *   UIT021
      * ------                           Interest Paid                *   UIT021
      *                                                               *   UIT021
      *****************************************************************   UIT021
      *                                                                   UIT021
     C           SRMORT    BEGSR                                          UIT021
      *                                                                   UIT021
     C                     Z-ADD0         WWMPRA 160                      UIT021
     C                     Z-ADD0         WWIMAM 160                      UIT021
      *                                                                   UIT021
      ***  Read history loan file for AMTP = 'MA','RE','MR' and 'IN'      UIT021
      *                                                                   UIT021
     C           LNRF      SETLLHISTSHPF                 99               UIT021
      *                                                                   UIT021
     C           *IN99     IFEQ *ON                        Found          UIT021
     C           LNRF      READEHISTSHPF                 99               UIT021
     C           *IN99     DOWEQ*OFF                       Found          UIT021
      *                                                                   UIT021
     C           HZAMTP    IFEQ 'MA'                                      UIT021
     C           HZAMTP    OREQ 'RE'                                      UIT021
     C           HZAMTP    OREQ 'MR'                                      UIT021
     C           HZAMTP    OREQ 'IN'                                      UIT021
     C                     ADD  HZPRAM    WWMPRA           Matured paid   UIT021
     C                     ADD  HZINTA    WWIMAM           Mat. inter.    UIT021
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
     C           LNRF      READEHISTSHPF                 99               UIT021
     C                     ENDDO                                          UIT021
     C                     ENDIF                                          UIT021
      *                                                                   UIT021
      ***  Fill out EXMPRA and EXIMAM with 3 dec (IML)                    UIT021
      *                                                                   UIT021
     C                     SELEC                                          UIT021
     C           A6NBDP    WHEQ 0                                         UIT021
     C*****      WWMPRA    MULT 1000      EXMPRA                          UIT021
     C*****      WWIMAM    MULT 1000      EXIMAM                          UIT021
     C           A6NBDP    WHEQ 1                                         UIT021
     C*****      WWMPRA    MULT 100       EXMPRA                          UIT021
     C*****      WWIMAM    MULT 100       EXIMAM                          UIT021
     C           A6NBDP    WHEQ 2                                         UIT021
     C*****      WWMPRA    MULT 10        EXMPRA                          UIT021
     C*****      WWIMAM    MULT 10        EXIMAM                          UIT021
     C           A6NBDP    WHEQ 3                                         UIT021
     C*****                Z-ADDWWMPRA    EXMPRA                          UIT021
     C*****                Z-ADDWWIMAM    EXIMAM                          UIT021
     C                     ENDSL                                          UIT021
     C                     ENDSR                                          UIT021
      /EJECT                                                              UIT021
     C********************************************************************ERL416
     C* REPAY - SUBROUTINE FOR REPAYMENTS MANAGEMENT                      ERL416
     C********************************************************************ERL416
     C*                                                                   ERL416
     C           REPAY     BEGSR                                          ERL416
     C*                                                                   ERL416
     C                     Z-ADD0         WWI2   130                      ERL416
     C                     Z-ADD0         WWREPN  30                      ERL460
     C                     MOVE LNRF      RELNRF  6                       ERL416
     C                     MOVE 'N'       WWTEST  1                       UNL002
     C***********          MOVE '2'       DSFREP                    ERL458225425
     C*                                                                   ERL416
     C** CHECK PROCESSING TYPE FROM LOAN                                  ERL416
     C** REPAYMENTS ONLY MANAGED IF PARTICIPATION SOLD EQUAL 0            ERL446
     C           PTYP      IFEQ 61                         - B1           ERL416
     C           PSAM      ANDEQ0                                         ERL446
      *
     C           PTYP      OREQ 62                                        ERL416
     C           PSAM      ANDEQ0                                         ERL446
      *
     C           PTYP      OREQ 64                                        ERL416
     C           PSAM      ANDEQ0                                         ERL446
     C*                                                                   ERL416
     C           LNRF      SETLLERLVENL0                                  ERL416
     C                     READ ERLVENL0                 65               ERL416
     C*                                                                   ERL416
     C           *IN65     DOWEQ'0'                        - B2           ERL416
     C           LNRF      ANDEQRELNRF                                    ERL416
     C*                                                                   ERL416
     C           INTC      IFEQ 'Y'                        - B3           ERL416
     C***********ETYP2     ANDEQ'I2'                               ERL416 ERL463
     C           ETYP2     ANDEQ'X2'                                      ERL463
     C                     Z-ADDEAMT      WWI2                            ERL416
     C                     GOTO NEXT                                      ERL416
     C                     END                             - E3           ERL416
     C*                                                                   ERL416
     C           ETYP2     IFEQ 'I2'                                      ERL416
     C           ETYP2     OREQ 'X2'                                      ERL463
     C                     GOTO NEXT                                      ERL416
     C                     END                             - E3           ERL416
     C*                                                                   ERL416
     C** SETUP END DATE                                                   ERL416
     C           ETYP1     IFEQ '61'                       - B3           ERL416
     C           ETYP2     OREQ 'D1'                                      ERL416
     C           EREOMD    ADD  1         @@DAYN                          ERL416
     C                     ELSE                            - X3           ERL416
     C                     Z-ADDEDAT      @@DAYN                          ERL416
     C                     END                             - E3           ERL416
     C                     EXSR ZDATE9                                    ERL416
     C                     Z-ADD@@VDT     EXENDD                          ERL416
     C*                                                                   ERL416
     C** SETUP EVENT AMOUNT                                               ERL416
     C           EAMT      IFLT 0                          - B3           ERL416
     C                     Z-SUBEAMT      EAMT                            ERL416
     C                     Z-ADD1         EXDRCR                          085053
     C                     ELSE                                           085053
     C                     Z-ADD0         EXDRCR                          085053
     C                     END                             - E3           ERL416
     C*                                                                   ERL416
     C           ETYP2     IFEQ 'M1'                       - B3           ERL416
     C           EAMT      SUB  WWI2      EAMT                            ERL416
     C                     END                             - E3           ERL416
     C*                                                                   ERL416
     C           A6NBDP    IFEQ 0                          - B3           ERL416
     C           EAMT      MULT 1000      EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 1                          - B3           ERL416
     C           EAMT      MULT 100       EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 2                          - B3           ERL416
     C           EAMT      MULT 10        EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C           A6NBDP    IFEQ 3                          - B3           ERL416
     C                     Z-ADDEAMT      EXAMNT                          ERL416
     C                     END                             - E3           ERL416
     C*                                                                   UNL002
     C** Only for the first record written for the repayments, the        UNL002
     C** fields must be setup with the values already retrieved and       UNL002
     C** for the other records, fields to zeros or blanks                 UNL002
     C           WWTEST    IFEQ 'N'                        - B3           UNL002
     C                     MOVE 'Y'       WWTEST                          UNL002
     C                     ELSE                                           UNL002
     C                     Z-ADD*ZEROS    EXACCR                          UNL002
     C                     Z-ADD*ZEROS    EXITAC                          UNL002
     C                     Z-ADD*ZEROS    EXSLID                          UNL002
     C                     Z-ADD*ZEROS    EXNIDT                          UNL002
     C                     MOVE *BLANKS   EXRETB                          UNL002
     C                     END                                            UNL002
      *                                                                   ERL416
     C                     MOVE 'Y'       REPIND                          ERL416
     C                     MOVE 'REP'     EXTREF                          ERL416
     C                     ADD  1         NREC                            ERL416
     C*                                                                   ERL416
     C** WRITE A RECORD FOR REPAYMENT MANAGEMENT                          ERL416
     C           EXAMNT    IFNE *ZEROS                                    ERL458
     C***********                                                   ERL458225425
     C***********DSFREP    IFEQ '2'                                 ERL458225425
     C***********          MOVE '1'       DSFREP                    ERL458225425
     C***********          ELSE                                     ERL458225425
     C***********          MOVE '0'       DSFREP                    ERL458225425
     C***********          END                                      ERL458225425
     C*                                                                   ERL460
     C                     ADD  1         WWREPN                          ERL460
     C                     MOVE WWREPN    DSREPN                          ERL460
     C*                                                                   ERL458
     C                     WRITEEREXTRF0                                  ERL416
     C                     END                                            ERL458
     C*                                                                   ERL416
     C** READ NEXT RECORD                                                 ERL416
     C           NEXT      TAG                                            ERL416
     C                     READ ERLVENL0                 65               ERL416
     C*                                                                   ERL416
     C                     END                             - E2           ERL416
     C*                                                                   ERL416
     C                     END                             - E1           ERL416
     C*                                                                   ERL416
     C**********           MOVE '0'       DSFREP                    ERL458225425
     C                     MOVE *BLANKS   DSREPN                          ERL460
     C*                                                                   ERL458
     C                     ENDSR                                          ERL416
     C**=================================================================
      **
      **  #INIT       SUBROUTINE TO INITIALIZE STATIC FIELDS AND ACCESS STANDING
      **              DATA CALLED ONCE AT START OF PROGRAM FROM MAIN LINE.
     C**
      **     CALLED BY PROGRAM
      **     CALLS     *PSSR
      **
     C**=================================================================
     C**                                                   *****************
     C           #INIT     BEGSR                           ** #INIT BEGSR **
     C**                                                   *****************
     C**  PREPARE LDA:
     C**
     C           *NAMVAR   DEFN           LDA                             USW004
     C******               MOVEL*BLANK    DBLOT                           USW004
     C                     MOVEL'ER0623'  DBPGM
     C*
     C** INITIALIZE WORK FIELD FOR BRANCH
     C***********          Z-ADD0         WWBRCD                          ER_R10
     C                     MOVEL*BLANKS   WWBRCD                          ER_R10
     C*                                                                   ER0136
     C** INITIALIZE WORK FIELD FOR NUMBER OF EXTRACTED RECORDS            ER0136
     C                     Z-ADD0         NREC                            ER0136
     C*
     C**  INITIALIZE INDICATORS:
     C                     MOVE '0'       *IN
     C**
     C**  GET INSTALLATION CONTROL DATA RECORD 1:
     C                     READ SDBANKL1                 81
     C**
     C**  IF RECORD NOT FOUND:
     C           *IN81     IFEQ '1'                        - B1
     C           *LOCK     IN   LDA                                       USW004
     C                     MOVEL'009'     DBASE            *****************
     C                     MOVEL'SDBANKL1'DBFILE           ** DB ERROR 09 **
     C                     MOVEL' NONE '  DBKEY            *****************
     C                     OUT  LDA                                       USW004
     C                     EXSR *PSSR
     C                     END                             - E1
     C*
     C** CHECK FOR END OF MONTH                                           ART021
     C                     CALL 'SD2000'                                  ART021
     C                     PARM 'N'       EOM     1                       ART021
     C                     PARM 'N'       EOY     1                       ART021
     C*                                                                   ART021
     C           EOM       IFEQ 'Y'                                       ART021
     C                     EXSR #DATE                      RUN DATE       ER0317
     C                     EXSR #EOMD                      END OF MONTH   ER0317
     C                     ELSE                                           ART021
     C                     Z-ADDBJRDNB    EREOMD                          ART021
     C                     END                                            ART021
     C*
     C** GET REPORTING DATE IN FORMAT YYYYMMDD
     C*********************Z-ADDBJRDNB    @@DAYN  50                      ER0317
     C                     Z-ADDEREOMD    @@DAYN  50                      ER0317
     C                     EXSR ZDATE9
     C                     Z-ADD@@VDT     WWREPD  80
     C                     Z-ADDWWREPD    WWREPI  80
     C                     MOVE WWREPD    WWREPX  8                       MMI033
     C                     MOVE '01'      WWREPX                          MMI033
     C                     MOVE WWREPX    WWREPI  80                      MMI033
     C*                                                                   ER0136
     C                     MOVE WWREPD    WDAT4   4                       MMI075
     C                     MOVELWDAT4     WDAT2   2                       MMI075
     C                     MOVE WDAT2     X                               MMI075
      *                                                                   MMI075
      *                                                                   MMI075
     C           X         IFEQ 1                                         MMI075
     C           X         OREQ 2                                         MMI075
     C           X         OREQ 3                                         MMI075
     C                     MOVE '0101'    WWREPI                          MMI075
     C                     END                                            MMI075
      *                                                                   MMI075
     C           X         IFEQ 4                                         MMI075
     C           X         OREQ 5                                         MMI075
     C           X         OREQ 6                                         MMI075
     C                     MOVE '0401'    WWREPI                          MMI075
     C                     END                                            MMI075
      *                                                                   MMI075
     C           X         IFEQ 7                                         MMI075
     C           X         OREQ 8                                         MMI075
     C           X         OREQ 9                                         MMI075
     C                     MOVE '0701'    WWREPI                          MMI075
     C                     END                                            MMI075
      *                                                                   MMI075
     C           X         IFEQ 10                                        MMI075
     C           X         OREQ 11                                        MMI075
     C           X         OREQ 12                                        MMI075
     C                     MOVE '1001'    WWREPI                          MMI075
     C                     END                                            MMI075
      *                                                                   MMI075
     C*                                                                   ER0136
     C                     WRITEHEADAU                                    ER0136
     C*
     C                     ENDSR
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #DATE      - SUBROUTINE TO RUN DATE                             ER0317
      **                                                                  ER0317
      **  CALLS      -                                                    ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #DATE     BEGSR                                          ER0317
     C**                                                                  ER0317
     C**   DAY                                                            ER0317
     C                     Z-ADDWWBJD     ERDADD  20       DAY            ER0317
     C**   MONTH                                                          ER0317
     C                     Z-ADD1         X       20       X : INDEX      ER0317
     C           WWBJM     LOKUPZMNM,X                   2626 : EQUAL     ER0317
     C           *IN26     IFEQ '1'                                       ER0317
     C                     Z-ADDX         ERDAMM  20       MONTH          ER0317
     C                     END                                            ER0317
     C**   YEAR                                                           ER0317
     C                     Z-ADDWWBJY     ERDAYY  20       YEAR           ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
      ********************************************************************ER0317
      **                                                                  ER0317
      **  #EOMD      - SUBROUTINE TO COMPUTE END OF MONTH                 ER0317
      **                                                                  ER0317
      **  CALLS      - ZDATE1                                             ER0317
      **                                                                  ER0317
      **  CALLED BY  - MAINLINE                                           ER0317
      **                                                                  ER0317
      ********************************************************************ER0317
     C**                                                                  ER0317
     C           #EOMD     BEGSR                                          ER0317
     C**                                                                  ER0317
     C                     Z-ADDERDAYY    WWY              YEAR           ER0317
     C                     Z-ADDERDAMM    WWM              MONTH          ER0317
     C                     Z-ADDTNDM,WWM  WWD              DAY            ER0317
     C**                                                                  ER0317
     C           *IN99     DOUEQ'0'                        - B1           ER0317
     C                     Z-ADDWWDATE    ZDATE                           ER0317
     C                     EXSR ZDATE1                                    ER0317
     C                     SUB  1         WWD                             ER0317
     C                     END                             - E1           ER0317
     C**                                                                  ER0317
     C                     Z-ADDZDAYNO    EREOMD  50       END OF MONTH   ER0317
     C**                                                                  ER0317
     C                     ENDSR                                          ER0317
     C********************************************************************
     C** *PSSR  S/R
     C*================================================================
     C           *PSSR     BEGSR
     C*
     C*********************WRITEHEADAU                                    ER0136
     C                     WRITEERROR                                     ER0136
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     DUMP
     C                     RETRN
     C**
     C                     ENDSR
     C********************************************************************ER0317
     C**                                                                  ER0317
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND                     ER0317
     C**              CONVERT TO A NUMBER OF DAYS.                        ER0317
     C**                                                                  ER0317
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.         ER0317
     C**                                                                  ER0317
     C           ZDATE1    BEGSR                           *** ZDATE1 *** ER0317
     C**                                                                  ER0317
     C**   CLEAR DAY NUMBER.                                              ER0317
     C                     Z-ADD0         ZDAYNO  50                      ER0317
     C**                                                                  ER0317
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.                        ER0317
     C                     Z-ADDZDATE     ZDATE   60                      ER0317
     C**                                                                  ER0317
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.                     ER0317
     C                     MOVE ZDATE     ZYEAR   20                      ER0317
     C  N98                MOVELZDATE     ZDAY    20                      ER0317
     C   98                MOVELZDATE     ZMTH    20                      ER0317
     C                     MOVE ZDATE     ZWRK4   40                      ER0317
     C  N98                MOVELZWRK4     ZMTH                            ER0317
     C   98                MOVELZWRK4     ZDAY                            ER0317
     C**                                                                  ER0317
     C**   ENSURE MONTH IS VALID.                                         ER0317
     C           ZMTH      COMP 0                      9999               ER0317
     C  N99      ZMTH      COMP 12                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR 30 DAY MONTHS.                                       ER0317
     C           ZMTH      COMP 4                        90IF 90 ON, 30   ER0317
     C  N90      ZMTH      COMP 6                        90DAY MONTH.     ER0317
     C  N90      ZMTH      COMP 9                        90               ER0317
     C  N90      ZMTH      COMP 11                       90               ER0317
     C**                                                                  ER0317
     C**   ENSURE DAY IS VALID.                                           ER0317
     C           ZDAY      COMP 0                      9999               ER0317
     C   90N99   ZDAY      COMP 30                   99                   ER0317
     C  N90N99   ZDAY      COMP 31                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.                              ER0317
     C           ZYEAR     ADD  28        ZYEAR                           ER0317
     C           ZYEAR     DIV  4         ZLYR    20                      ER0317
     C                     MVR            ZLY     10     91LEAP YR, 91 ON ER0317
     C           ZMTH      COMP 2                    93  92FEB., 92 ON    ER0317
     C**                                                   PAST FEB, 93 ONER0317
     C**   IF FEBUARY FURTHER VALIDATE DAY.                               ER0317
     C  N91 92   ZDAY      COMP 28                   99                   ER0317
     C   91 92   ZDAY      COMP 29                   99                   ER0317
     C   99                GOTO ZDEND1                     BYPASS IF ERRORER0317
     C**                                                                  ER0317
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANSER0317
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.ER0317
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YRER0317
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.ER0317
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR ER0317
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTHER0317
     C**                                                                  ER0317
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*ER0317
     C**                                                                  ER0317
     C**                                                                  ER0317
     C*****************************************************************
     C*
     C           ZDATE9    BEGSR
     C*
     C                     SETOF                     8081
     C                     MOVE '0'       @@RTN   1
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1
     C                     MOVE '1'       @@RTN
     C                     GOTO ZDAT79
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZA0711
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZA0711
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZDAT79    ENDSR
     C********************************************************************
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@                                                                  USW004
(C) Copyright Midas-Kapiti International Ltd. 1992, 1996
**   ZYDY - YEARS IN DAYS CUMULATIVE IN FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TNDM - NUMBER OF DAYS PER MONTH
312931303130313130313031
**   CT1
010203040506070809101112
**   CT2
010101040404070707101010
