     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas EU Open Euro accounts')                          *
      *****************************************************************
      *                                                               *
      *  Midas - EMU Retail Utilities                                 *
      *                                                               *
      *  EU0140 - Open Euro Accounts                                  *
      *                                                               *
      *  Function:  This program will create Euro accounts            *
      *                                                               *
      *  Called By: EUC0140                                           *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 CSD101             Date 07Dec18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD034366           Date 09Sep15               *
      *                 CRE095             Date 25Apr14               *
      *                 CGL165             Date 17Feb15               *
      *                 CRE090             Date 14Feb14               *
      *                 AR1095876          Date 30Sep13               *
      *                 CRE073             Date 06Dec10               *
      *                 CER055             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 230355             Date 18Dec09               *
      *                 208336             Date 18Dec09               *
      *                 CAP205             Date 04Jan10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 240740 (Reopen)    Date 07Jul06               *
      *                 240740             Date 29Jun06               *
      *                 238619 (Reopen)    Date 28Apr06               *
      *                 238619             Date 31Mar06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CER001             Date 25Apr05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 11Sep03               *
      *                 217910             Date 30May03               *
      *                 CRE008             Date 19Feb02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 184617             Date 31May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      *                 184653             Date 19Feb02               *
      *                 196967             Date 24Jan02               *
      *                 199201             Date 08Jan02               *
      *                 190154             Date 29Nov01               *
      *                 160552             Date 28Nov01               *
      *                 191826             Date 31Oct01               *
      *                 194878             Date 27Oct01               *
      *                 194044             Date 27Oct01               *
      *                 177663             Date 24Oct01               *
      *                 158072             Date 24Oct01               *
      *                 177541             Date 24Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 15May01               *
      *                 CPB002             Date 25Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 164492             Date 19May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 10Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157543             Date 31Mar99               *
      *                 155257             Date 16Feb99               *
      *                 153298             Date 16Feb99               *
      *                 154034             Date 09Feb99               *
      *                 153810             Date 09Feb99               *
      *                 150164             Date 10DEC98               *
      *                 143460             Date 26OCT98               *
      *                 CEU029             Date 21SEP98               *
      *                 CEU025             Date 31Aug98               *
      *                 140915             Date 18Aug98               *
      *                 138334             Date 20Jul98               *
      *                 136675             Date 16JUN98               *
      *                 136643             Date 11JUN98               *
      *                 133674             Date 17APR98               *
      *                 CEU022  *CREATE    Date 07JAN98               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  CSD101 - Password Encryption                                 *
      *  MD046248 - Finastra Rebranding                               *
      *  MD034366 - CRE005 failuers in COB. Added timestamp field to  *
      *             ensure that latest rate change record is used.    *
      *  LLN022A - BOE Upgrade to MidasPlus - incorporate code from   *
      *            /COPY members and add switchability.               *
      *  LLN022 - BOE Upgrade to MidasPlus.                           *
      *  CRE095 - Rate fixing for RE Accounts                         *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CRE090 - Delay Capitalisation of Interest                    *
      *  AR1095876- ABC - Forward Days 1 should = DNWD-1, not just    *
      *             RUND (Child: AR1095877) (Recompile)               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CER055 - Penalty Interest on Exceeding Overdraft Limit       *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *  230355 - Recompiled over changed REPRPNPP.                   *
      *         - S1AODR added to I-spec redefinition in order to     *
      *           allow re-compilation of this *PGM.                  *
      *  208336 - Rate changes for the account should now be          *
      *           generated to PF/RERCHxPD files instead of the       *
      *           previous PF/STRAN.  Apply part of fix 155637.       *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *           (Recompile)                                         *
      *  240740 - Blank also IBAN seq. no.                            *
      *  240740 - Blank IBAN of the old IN currency account.          *
      *  238619 - Add newly created EUR account to GLACNTQD.          *
      *           Initialize OD change value dates to zero before     *
      *           writing to ACCNTBXC.(Reopen)                        *
      *  238619 - Add newly created EUR account to GLACNTQD           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGP001 - Global Processing.                                  *
      *  217910 - Show retail accounts on postings  (CRE008 FIX)      *
      *  CRE008 - Cash Management                                     *
      *  184617 - Transfer 'In' currency details correctly to STRAN   *
      *           records, GECOMD and REHISPD files upon mapping.     *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  184653 - Sweep DEM account to EUR.  Upon amendment of EUR,   *
      *           error msg appears.  Move EUR date account opened to *
      *           Overdraft Rate Change Value Date.                   *
      *  196967 - Initialise overdraft line change value date.        *
      *  199201 - IBAN number is being carried across from legacy     *
      *           to EURO accounts by default.                        *
      *  190154 - Data base error if account exist in ACCNTBXC        *
      *  160552 - File out of balance in ME0240.                      *
      *           Initialise ACST before write to ACCNTAB.            *
      *  191826 - Ensure that EUOPFA (Euro Account Opening Failed     *
      *           Indicator) is initialized to 'N'(Not Failed) for    *
      *           every mapping operation.                            *
      *  194878 - Transaction charges override was not transferred to *
      *           newly opened euro account.                          *
      *  194044 - If fixed commission of In-ccy account is 'E',       *
      *           transfer/convert the same value to the new Euro a/c.*
      *  177663 - Retrieve the details of the 'IN' ccy account such   *
      *           that no data will be lost during sweeping to EUR    *
      *           account.                                            *
      *  158072 - Convert 'HIGHEST OVERDRAFT COMMISSION' only if it   *
      *           is a fixed amount, just move for a percentage       *
      *  177541 - If stmt freq of Euro account being mapped is 'E',   *
      *           then initialise field ENOC to 1.                    *
      *  CSD006 - Use long DS with SDBSRTPD.                          *
      *  CPB002 - Meridian DBA Middleware Replication Customization.  *
      *  164492 - EUSB must be blank for the euro acc created         *
      *  CPB001 - 'Private Banking' Module                            *
      *  157543 - Incorrect conversion of overdraft line when ccys    *
      *           have different dec. places; ODLN is held in whole   *
      *           units of ccy so converted amount must be adjusted.  *
      *           Same applies to minimum balance (MINB). Also        *
      *           conversion of ODRL on history is pointless as 'in'  *
      *           ccy a/c value is not retrieved; it should be set to *
      *           ODLN. Also the RECOMD record for the 'in' ccy a/c   *
      *           is not retrieved so fields are not set for the      *
      *           mapped a/c, and CEXA, CEXB & CEXC should not be     *
      *           converted as they are rates.                        *
      *  155257 - Shadow balances incorrect when retail a/c no. is    *
      *           preserved. If ACNO on ACCNT is zeroised for the     *
      *           'in' ccy a/c, it should also be zeroised on MEMOS.  *
      *  153298 - If 'Create one Euro a/c for each cust., a/c code    *
      *           & a/c seq.' flag is 'Y' (many-to-one map) 1 a/c for *
      *           each 'in' ccy is created, and if flag is 'N' (one-  *
      *           to-one map) only 1 a/c is created. It should be the *
      *           other way round.                                    *
      *  154034 - No interest accrued, or interest accrued at base    *
      *           rate without including spread, for mapped a/c when  *
      *           flat rate used (both DR & CR). Caused by int. rate  *
      *           & rate/spread not being set on STRAN record type 1. *
      *  153810 - No credit interest calculated for mapped a/c when   *
      *           interest type/subtype used; caused by DRCR being    *
      *           '0' (debit) on STRAN record type 2X & 3.            *
      *  150164   Spread rates not written in STRAN.                  *
      *  143460   To avoid dbase error in REC376 initialise PDID      *
      *  CEU029 - EMU Midas/Trade Innovation Interface Enhancements:  *
      *           creation of TI Euro accounts.                       *
      *  CEU025 - EMU: Midas-Cashier Interface                        *
      *  140915   New accounts created should not be TI accounts.     *
      *  138334 . Only validate the base rate code if one exists.     *
      *  136675 . Fix for retail account number of IN ccy             *
      *         . If profit centre not entered, default IN a/c value  *
      *         . Default following fields from IN ccy a/c.           *
      *           'Print transaction advice' & 'Print rate change adv'*
      *           preserved                                           *
      *  136643 - Program was writing wrong values of rate/spread sign*
      *           and DR/CR next capitalisation number to LF/ACCBR    *
      *  133674 - Adjustment to SR/PRTRAN which was coded wrongly     *
      *           with respect to base rate types/interest types etc. *
      *  CEU022 - EMU Retail Utilities                                *
      *                                                               *
      *===============================================================*
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    66      On for no record found on CHAIN into ACCNTTI.      *   CEU029
      *    70      Used for CHAIN and READ                            *
      *    90-99   Used by standard subroutine
      *                                                               *
      *****************************************************************
      *
      ** EMU Mapping Details Account Mapping List
     FEUACMLL3UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
      *
      ** EMU Mapping Details Header
     FEUMDHDL0UF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
      *
      **
     FREINT   IF  E           K        DISK         KINFSR *PSSR
      *
      ** Accounts Master file
     FACCBR   UF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *
      ** Accounts Master Trailer
     FACCNTAC UF  E                    DISK
     F            ACCNTACF                          KRENAMEACCNTCXF
     F                                              KCOMIT
     F                                              KINFSR *PSSR
      *
      ** Account Detail Extension
     F/COPY WNCPYSRC,EU0140F003
     F*ACCNTBXCIF*E********   K        DISK         KINFSR *PSSR A        190154
     FACCNTBXCUF  E           K        DISK         KINFSR *PSSR A        190154
     F                                              KCOMIT
     F/COPY WNCPYSRC,EU0140F001
      *                                                                                      LLN022A
     FBYACCTY0IF  E           K        DISK                      A                           LLN022A
      ** Account Details Extention File - retrieval                                          LLN022A
      *                                                                                      LLN022A
     FREACX1PDUF  E           K        DISK         KINFSR *PSSR A    UC                      CER001
     F                                              KCOMIT                                    CER001
      *
      ** Retail Commissions enquiry file
     FRECOM   IF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *
      ** Shadow Balances
     F***MEMOSL1*IF  E           K        DISK         KINFSR *PSSR A     155257
     FMEMOSL1 UF  E           K        DISK         KINFSR *PSSR A        155257
     F                                              KCOMIT
      *
      ** Retail Interest and Charges Detail
     FIACBR   IF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *
      ** Retail Accrued Interest to Date Detail
     FREACR   IF  E           K        DISK         KINFSR *PSSR A
     F            REACRZF                           KIGNORE
     F                                              KCOMIT
     FREACRZ  UF  E                    DISK
     F                                              KCOMIT
      *
      ***Retail*Account*Password***************************************                       CSD101
     F*REAPWDPDIF*E***        K        DISK         KINFSR *PSSR A                            CGP001
     F***REAPWDL0IF  E           K        DISK         KINFSR *PSSR A                  CGP001 CSD101
     F**********                                    KCOMIT                                    CSD101
      *
      ** Retail History file
     FREHISBL IF  E           K        DISK         KINFSR *PSSR A
     F                                              KCOMIT
      *                                                                                       238619
      ** Account Master Extension file                                                        238619
     FGLACNTL3IF  E           K        DISK         KINFSR *PSSR A                            238619
     F                                              KCOMIT                                    238619
      *
      ** Single Transactions file
     F***STRAN** UF  E                    DISK         KINFSR *PSSR                           208336
     F**********                                    KCOMIT                                    208336
     F/COPY WNCPYSRC,EU0140F002
      *                                                                   CEU025
     FACCNTTI IF  E           K        DISK                               CEU029
     F            ACCNTABF                          KRENAMEACCNTTBF       CEU029
      *                                                                   CEU029
      ** CI Converted Account Details Extract                             CEU025
     FRECIEUPDO   E                    DISK         KINFSR *PSSR      UC  CEU025
     F                                              KCOMIT                CEU025
      ** PM Portfolio Management Details                                  CPB001
     FPMPORTLLIF  E           K        DISK         KINFSR *PSSR      UC  CPB001
      *
     FRERCHHPAUF  E                    DISK         KINFSR *PSSR                              208336
     F                                              KCOMIT                                    208336
      *                                                                                       208336
     FRERCH1PDUF  E                    DISK         KINFSR *PSSR A                            208336
     F                                              KCOMIT                                    208336
      *                                                                                       208336
     FRERCH2PDUF  E                    DISK         KINFSR *PSSR A                            208336
     F                                              KCOMIT                                    208336
      *                                                                                       208336
     FRERCH3PDUF  E                    DISK         KINFSR *PSSR A                            208336
     F                                              KCOMIT                                    208336
      *                                                                                       208336
      * Retail ICD                                                        158072
     FTABTBRE IF  E                    DISK         KINFSR *PSSR          158072
      /EJECT
      *
      ** ARRAY FOR RATE AND BALANCE
     E                    RATN        6 11 0 BALN   15 0
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
      ** Array containing Copyright statement
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,EU0140E001
      *
      ** Array containing inputted currency codes
      *
     I/COPY WNCPYSRC,EU0140I002
     IACCNTTBF                                                            CEU029
     I** Rename fields of ACCNTTI                                         CEU029
     I              RECI                            TIRECI                CEU029
     I              CNUM                            TICNUM                CEU029
     I              CCY                             TICCY                 CEU029
     I              ACOD                            TIACOD                CEU029
     I              ACSQ                            TIACSQ                CEU029
     I              ZZ006                           TIZ006                CEU029
     I              BRCA                            TIBRCA                CEU029
     I              ATYP                            TIATYP                CEU029
     I              STYP                            TISTYP                CEU029
     I              MFFQ                            TIMFFQ                CEU029
     I              ACST                            TIACST                CEU029
     I              DACO                            TIDACO                CEU029
     I              DACC                            TIDACC                CEU029
     I              ANAM                            TIANAM                CEU029
     I              LDBL                            TIADBL                CEU029
     I              CLBL                            TICLBL                CEU029
     I              STFQ                            TISTFQ                CEU029
     I              STDY                            TISTDY                CEU029
     I              LSTD                            TILSTD                CEU029
     I              NSTD                            TINSTD                CEU029
     I              LSTP                            TILSTP                CEU029
     I              CFSB                            TICFSB                CEU029
     I              LMVD                            TILMVD                CEU029
     I              EPLB                            TIEPLB                CEU029
     I              EPCB                            TIEPCB                CEU029
     I              YTDB                            TIYTDB                CEU029
     I              GLBT                            TIGLBT                CEU029
     I              ADREF1                          TIREF1                CEU029
     I              PRFC                            TIPRFC                CEU029
     I              ZZ004                           TIZ004                CEU029
     I              ORED                            TIORED                CEU029
     I              DLIM                            TIDLIM                CEU029
     I              LRCR                            TILRCR                CEU029
     I              RTCB                            TIRTCB                CEU029
     I              RTLB                            TIRTLB                CEU029
     I              DITM                            TIDITM                CEU029
     I              CITM                            TICITM                CEU029
     I              ADREF2                          TIREF2                CEU029
     I              ZZ002                           TIZ002                CEU029
     I              CDIR                            TICDIR                CEU029
     I              CCIR                            TICCIR                CEU029
     I              ACNO                            TIACNO                CEU029
     I              RETB                            TIRETB                CEU029
     I              ODSC                            TIODSC                CEU029
     I              ODLN                            TIODLN                CEU029
     I              ODED                            TIODED                CEU029
     I              DIOD                            TIDIOD                CEU029
     I              FACT                            TIFACT                CEU029
     I              FCNO                            TIFCNO                CEU029
     I              EFAC                            TIEFAC                CEU029
     I              HELD                            TIHELD                CEU029
     I              MINB                            TIMINB                CEU029
     I              LACD                            TILACD                CEU029
     I              LISP                            TILISP                CEU029
     I              RRNM                            TIRRNM                CEU029
     I              DRIB                            TIDRIB                CEU029
     I              DRIS                            TIDRIS                CEU029
     I              DRCD                            TIDRCD                CEU029
     I              DRIC                            TIDRIC                CEU029
     I              DRIF                            TIDRIF                CEU029
     I              DRDY                            TIDRDY                CEU029
     I              NDID                            TINDID                CEU029
     I              LDID                            TILDID                CEU029
     I              LDIA                            TILDIA                CEU029
     I              SDAP                            TISDAP                CEU029
     I              LPAR                            TILPAR                CEU029
     I              DIIE                            TIDIIE                CEU029
     I              DAIC                            TIDAIC                CEU029
     I              MADI                            TIMADI                CEU029
     I              GADI                            TIGADI                CEU029
     I              DDIS                            TIDDIS                CEU029
     I              DDIA                            TIDDIA                CEU029
     I              OLDR                            TIOLDR                CEU029
     I              OLDB                            TIOLDB                CEU029
     I              OLDS                            TIOLDS                CEU029
     I              CRIB                            TICRIB                CEU029
     I              CRIS                            TICRIS                CEU029
     I              CRCD                            TICRCD                CEU029
     I              CRIC                            TICRIC                CEU029
     I              CRIF                            TICRIF                CEU029
     I              CRDY                            TICRDY                CEU029
     I              NCID                            TINCID                CEU029
     I              LCID                            TILCID                CEU029
     I              LCIA                            TILCIA                CEU029
     I              SCAP                            TISCAP                CEU029
     I              LPAP                            TILPAP                CEU029
     I              CIIE                            TICIIE                CEU029
     I              CAIC                            TICAIC                CEU029
     I              MACI                            TIMACI                CEU029
     I              GACI                            TIGACI                CEU029
     I              CDIS                            TICDIS                CEU029
     I              DCIA                            TIDCIA                CEU029
     I              OLCR                            TIOLCR                CEU029
     I              OLCB                            TIOLCB                CEU029
     I              OLCS                            TIOLCS                CEU029
     I              LCD                             TILCD                 CEU029
     I              CHTP                            TICHTP                CEU029
     I              TNLU                            TITNLU                CEU029
     I              BRTCA                           TIRTCA                CEU029
     I              NACSG                           TIACSG                CEU029
     I              R4ACNT                          TIACNT                CEU029
     I              ENOC                            TIENOC                CEU029
     I              EPNO                            TIEPNO                CEU029
     I              ECFB                            TIECFB                CEU029
     I              LTAB                            TILTAB                CEU029
     I              LTAC                            TILTAC                CEU029
     I              LTAS                            TILTAS                CEU029
     I              HCFB                            TIHCFB                CEU029
     I              PTFR                            TIPTFR                CEU029
     I              HLEX                            TIHLEX                CEU029
     I              A5TIAC                          TITIAC                CEU029
     I              A5TIAN                          TITIAN                CEU029
     I              A5TIAS                          TITIAS                CEU029
     I              EUSB                            TIEUSB                CEU029
     I              IBAN                            TIIBAN                                    199201
     I              IBSEQN                          TISEQN                                    199201
     IACCNTABF                                                                                199201
     I              IBAN                            ##IBAN                                    199201
     I              IBSEQN                          ##SEQN                                    199201
      *                                                                   CEU029
     IRERCHHA0                                                                                208336
      *                                                                                       208336
      ** Rename RERCHHPA file fields                                                          208336
      *                                                                                       208336
     I              RECI                            HHRECI                                    208336
     IRERCH1D0                                                                                208336
      *                                                                                       208336
      ** Rename RERCH1PD file fields                                                          208336
      *                                                                                       208336
     I              RECI                            S1RECI                                    208336
     I              CNUM                            S1CNUM                                    208336
     I              CCY                             S1CCY                                     208336
     I              ACOD                            S1ACOD                                    208336
     I              ACSQ                            S1ACSQ                                    208336
     I              RSEQ                            S1ONE                                     208336
     I              CONI                            S1X                                       208336
     I              ACNO                            S1ACNO                                    208336
     I              PSTD                            S1RUND                                    208336
     I              VALD                            S1WOLD                                    208336
     I              TRAT                            S1TRAT                                    208336
     I              PNAR                            S1NARR                                    208336
     I              INTP                            S1INTT                                    208336
     I              INST                            S1INTS                                    208336
     I              DRCR                            S1DRCR                                    208336
     I              TIME                            S1TIME                                    208336
     I              SPOS                            S1RECO                                    208336
     I              BRCA                            S1SPTA                                    208336
     I              ZZ001                           S1ATYP                                    208336
     I              RVLD                            S1RVLD                                    208336
     I              PRIN                            S1BITF                                    208336
     I              LRCD                            S1OLDR                                    208336
     I              INRT                            S1INRT                                    208336
     I              BRT                             S1BRIS                                    208336
     I              RTSP                            S1WRIS                                    208336
     I              AODR                            S1AODR                                    230355
     I              TSTMP                           S1TSTM                                  MD034366
     IRERCH2D0                                                                                208336
      *                                                                                       208336
      ** Rename RERCH2PD file fields                                                          208336
      *                                                                                       208336
     I              RECI                            S2RECI                                    208336
     I              CNUM                            S2CNUM                                    208336
     I              CCY                             S2CCY                                     208336
     I              ACOD                            S2ACOD                                    208336
     I              ACSQ                            S2ACSQ                                    208336
     I              RSEQ                            S2TWO                                     208336
     I              CONI                            S2X                                       208336
     I              INTH                            S2INTH                                    208336
     I              VALD                            S2WOLD                                    208336
     I              DRCR                            S2DRCR                                    208336
     I              TIME                            S2TIME                                    208336
     I              BRCA                            S2SPTA                                    208336
     I              TSTMP                           S2TSTM                                  MD034366
     IRERCH3D0                                                                                208336
      *                                                                                       208336
      ** Rename RERCH3PD file fields                                                          208336
      *                                                                                       208336
     I              RECI                            S3RECI                                    208336
     I              CNUM                            S3CNUM                                    208336
     I              CCY                             S3CCY                                     208336
     I              ACOD                            S3ACOD                                    208336
     I              ACSQ                            S3ACSQ                                    208336
     I              RSEQ                            S3THRE                                    208336
     I              VALD                            S3WOLD                                    208336
     I              RAT1                            RAT3                                      208336
     I              DRCR                            S3DRCR                                    208336
     I              TIME                            S3TIME                                    208336
     I              BRCA                            S3SPTA                                    208336
     I              BAL1                            BAL3                                      208336
     I              TSTMP                           S3TSTM                                  MD034366
      *                                                                                       208336
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
      ** External DS for bank details
     ISDBANK    E DSSDBANKPD
      *
      ** General Ledger Details
     ISDGELR    E DSSDGELRPD
      *
      ** External DS for bank details
     ISDCURR    E DSSDCURRPD
      *
      ** Account Code Details
     ISDACOD    E DSSDACODPD
     I              QQACCD                          QQACCX                                    CGL029
      *
      ** Base Rate Code Details
     ISDBSRT    E DSSDBSRTPD
      *                                                                   CEU025
      ** External DS for branch details                                   CEU029
     ISDBRCH    E DSSDBRCHPD                                              CEU029
      *                                                                   CEU029
      **  Switchable Features                                             CEU025
     ISCSARD    E DSSCSARDPD                                              CEU025
      *                                                                   CPB001
      **  Midas Module                                                    CPB001
     ISDMMOD    E DSSDMMODPD                                              CPB001
      *                                                                   CPB001
      **  Customer Details                                                CPB001
     ISDCUST    E DSSDCUSTPD                                              CPB001
     I              QQDFAC                          QQDFAX                                    CGL029
      *                                                                   CPB001
      **  Portfolio Management Details                                    CPB001
     ISDPLCS    E DSSDPLCSPD                                              CPB001
      *
      *  First DS for access program, short Data Structure
     IDSFDY     E DSDSFDY
      *
      ** Second DS for access programs, long data structure
     IDSSDY     E DSDSSDY
      *                                                                         CPB001
      ** Third DS for access programs, very long data structure                 CPB001
     IDSLDY     E DSDSLDY                                                       CPB001
     I/COPY WNCPYSRC,EU0140I001
      *
      ***DATA*STRUCTURE*FOR*STRAN*HEADER*                                                     208336
     I***STHEAD*     DS                                                                       CGL029
     I***STHEAD*     DS                            209                                 CGL029 208336
     I**********                              2   60TRNO                                      208336
     I**********                          P  12  140NORC                                      208336
     I**********                          P 198 2000SATN                                      208336
      **********                                                                              208336
      ***DATA*STRUCTURE*FOR*STRAN*RATE*1*                                                     208336
      **********                                                                              208336
     I***ST1RAT*     DS                                                                       208336
     I**********                              1   60S1CNUM                                    CSD027
     I**********                              1   6 S1CNUM                             CSD027 208336
     I**********                              7   9 S1CCY                                     208336
     I**********                             10  130S1ACOD                                    CGL029
     I**********                             10  130QQACD1                             CGL029 208336
     I**********                             14  150S1ACSQ                                    208336
     I**********                             16  16 S1ONE                                     208336
     I**********                             17  17 S1X                                       208336
     I**********                             22  310S1ACNO                                    208336
     I**********                          P  32  340S1RUND                                    208336
     I**********                          P  35  370S1WOLD                                    208336
     I**********                             38  53 S1NARR                                    208336
     I**********                             73  740S1INTT                                    208336
     I**********                             75  790S1INTS                                    208336
     I**********                             80  80 S1DRCR                                    208336
     I**********                             81  860S1TIME                                    208336
     I**********                             95  99 S1RECO                                    208336
     I**********                            102 104 S1SPTA                                    208336
     I**********                            123 123 S1ATYP                                    208336
     I**********                          P 124 1260S1RVLD                                    208336
     I**********                            127 127 S1BITF                                    208336
     I**********                          P 137 1390S1OLDR                                    208336
     I**********                          P 146 1517S1INRT                                    208336
     I**********                            152 1530S1BRIS                                    208336
     I**********                          P 154 1597S1WRIS                                    208336
     I**********                          P 160 1657S1AODR                                    208336
     I**********                          P 191 1930S1WRUN                                    208336
     I**********                          P 194 1960S1TRNO                                    208336
     I**********                          P 197 1990S1NATN                                    208336
     I**********                            200 2090S1ACOD                             CGL029 208336
     I**********                                                                              208336
     I***DATA*STRUCTURE*FOR*STRAN*RATE*2*                                                     208336
     I**********                                                                              208336
     I***ST2RAT*     DS                                                                       208336
     I**********                              1   60S2CNUM                                    CSD027
     I**********                              1   6 S2CNUM                             CSD027 208336
     I**********                              7   9 S2CCY                                     208336
     I**********                             10  130S2ACOD                                    CGL029
     I**********                             10  130QQACD2                             CGL029 208336
     I**********                             14  150S2ACSQ                                    208336
     I**********                             16  16 S2TWO                                     208336
     I**********                             17  17 S2X                                       208336
     I**********                          P  18  250S2INTH                                    208336
     I**********                          P  35  370S2WOLD                                    208336
     I**********                             38  73 RAT1                                      208336
     I**********                          P  38  437RAT1A                                     208336
     I**********                          P  44  497RAT1B                                     208336
     I**********                          P  50  557RAT1C                                     208336
     I**********                          P  56  617RAT1D                                     208336
     I**********                          P  62  677RAT1E                                     208336
     I**********                          P  68  737RAT1F                                     208336
     I**********                             80  80 S2DRCR                                    208336
     I**********                             81  860S2TIME                                    208336
     I**********                            102 104 S2SPTA                                    208336
     I**********                            105 152 BAL1                                      208336
     I**********                          P 105 1120BAL1A                                     208336
     I**********                          P 113 1200BAL1B                                     208336
     I**********                          P 121 1280BAL1C                                     208336
     I**********                          P 129 1360BAL1D                                     208336
     I**********                          P 137 1440BAL1E                                     208336
     I**********                          P 145 1520BAL1F                                     208336
     I**********                          P 194 1960S2TRNO                                    208336
     I**********                          P 197 1990S2NATN                                    208336
     I**********                            200 2090S2ACOD                             CGL029 208336
     I**********                                                                              208336
     I***DATA*STRUCTURE*FOR*STRAN*RATE*3*                                                     208336
     I**********                                                                              208336
     I***ST3RAT*     DS                                                                       208336
     I**********                              1   60S3CNUM                                    CSD027
     I**********                              1   6 S3CNUM                             CSD027 208336
     I**********                              7   9 S3CCY                                     208336
     I**********                             10  130S3ACOD                                    CGL029
     I**********                             10  130QQACD3                             CGL029 208336
     I**********                             14  150S3ACSQ                                    208336
     I**********                             16  16 S3THRE                                    208336
     I**********                          P  35  370S3WOLD                                    208336
     I**********                             38  67 RAT3                                      208336
     I**********                          P  38  437RAT3A                                     208336
     I**********                          P  44  497RAT3B                                     208336
     I**********                          P  50  557RAT3C                                     208336
     I**********                          P  56  617RAT3D                                     208336
     I**********                          P  62  677RAT3E                                     208336
     I**********                             80  80 S3DRCR                                    208336
     I**********                             81  860S3TIME                                    208336
     I**********                            102 104 S3SPTA                                    208336
     I**********                            105 144 BAL3                                      208336
     I**********                          P 105 1120BAL3A                                     208336
     I**********                          P 113 1200BAL3B                                     208336
     I**********                          P 121 1280BAL3C                                     208336
     I**********                          P 129 1360BAL3D                                     208336
     I**********                          P 137 1440BAL3E                                     208336
     I**********                          P 194 1960S3TRNO                                    208336
     I**********                          P 197 1990S3NATN                                    208336
     I**********                            200 2090S3ACOD                             CGL029 208336
      **********                                                                              208336
     I            DS
     I                                        1  12 KEY
     I                                        1   1 BLANC
     I                                        2   3 TYPE
     I                                        4   8 SBTYPE
     I                                        9  11 CURR
     I                                       12  12 D
      **
      ** DATA STRUCTURE FOR BALANCE IF INTEREST TYPE IS BLANK
      **
     I            DS
     I                                        1  48 BAL0
     I                                    P   1  480BALN
      **
      ** DATA STRUCTURE FOR RATE IF INTEREST TYPE IS BLANK
      **
     I            DS
     I                                        1  36 RAT0
     I                                    P   1  360RATN
      *                                                                                       208336
      ** Data structure for Rate Spread in File RERCH2PD                                      208336
      *                                                                                       208336
     I            DS                                                                          208336
     I                                        1  36 @RAT1                                     208336
     I                                    P   1   67RAT1A                                     208336
     I                                    P   7  127RAT1B                                     208336
     I                                    P  13  187RAT1C                                     208336
     I                                    P  19  247RAT1D                                     208336
     I                                    P  25  307RAT1E                                     208336
     I                                    P  31  367RAT1F                                     208336
      *                                                                                       208336
      ** Data Structure Balance in File RERCH2PD                                              208336
      *                                                                                       208336
     I            DS                                                                          208336
     I                                        1  48 @BAL1                                     208336
     I                                    P   1   80BAL1A                                     208336
     I                                    P   9  160BAL1B                                     208336
     I                                    P  17  240BAL1C                                     208336
     I                                    P  25  320BAL1D                                     208336
     I                                    P  33  400BAL1E                                     208336
     I                                    P  40  480BAL1F                                     208336
      *                                                                                       208336
      ** Data structure for Rate Spread in File RERCH3PD                                      208336
      *                                                                                       208336
     I            DS                                                                          208336
     I                                        1  36 @RAT3                                     208336
     I                                    P   1   67RAT3A                                     208336
     I                                    P   7  127RAT3B                                     208336
     I                                    P  13  187RAT3C                                     208336
     I                                    P  19  247RAT3D                                     208336
     I                                    P  25  307RAT3E                                     208336
     I                                    P  31  367RAT3F                                     208336
      *                                                                                       208336
      ** Data Structure Balance in File RERCH3PD                                              208336
      *                                                                                       208336
     I            DS                                                                          208336
     I                                        1  48 @BAL3                                     208336
     I                                    P   1   80BAL3A                                     208336
     I                                    P   9  160BAL3B                                     208336
     I                                    P  17  240BAL3C                                     208336
     I                                    P  25  320BAL3D                                     208336
     I                                    P  33  400BAL3E                                     208336
     I                                    P  40  480BAL3F                                     208336
      *                                                                                     MD034366
     IQUSEC       DS                                                                        MD034366
     I                                    B   1   40QUSBPR                                  MD034366
     I                                    B   5   80QUSBAV                                  MD034366
     I                                        9  15 QUSEI                                   MD034366
     I                                       16  16 QUSERE                                  MD034366
     I                                       17  32 QUSED0                                  MD034366
      *                                                                                     MD034366
     IOUTDAT      DS                                                                        MD034366
     I                                        1   4 APIYR                                   MD034366
     I                                        5   6 APIMH                                   MD034366
     I                                        7   8 APIDY                                   MD034366
     I                                        9  10 APIHR                                   MD034366
     I                                       11  12 APIMN                                   MD034366
     I                                       13  14 APISC                                   MD034366
     I                                       15  17 APIML                                   MD034366
     ITMSTDS      DS                                                                        MD034366
     I                                        1   4 RETYR                                   MD034366
     I                                        5   5 TMST1                                   MD034366
     I                                        6   7 RETMH                                   MD034366
     I                                        8   8 TMST2                                   MD034366
     I                                        9  10 RETDY                                   MD034366
     I                                       11  11 TMST3                                   MD034366
     I                                       12  13 RETHR                                   MD034366
     I                                       14  14 TMST4                                   MD034366
     I                                       15  16 RETMN                                   MD034366
     I                                       17  17 TMST5                                   MD034366
     I                                       18  19 RETSC                                   MD034366
     I                                       20  20 TMST6                                   MD034366
     I                                       21  23 RETML                                   MD034366
     I                                       24  26 RETMC                                   MD034366
     I/COPY WNCPYSRC,EU0140I003
      **                                                                  CEU029
      ** Data structure for TI Account Suffix                             CEU029
      **                                                                  CEU029
     I            DS                                                      CEU029
     I                                        1   3 A5TIAS                CEU029
     I                                        1   30COUNT                 CEU029
      **                                                                  CEU029
      *
     I/COPY ZSRSRC,ZTNLU1Z1
      *
      * ===============================================================
      **                  D E F I N I T I O N S
      * ===============================================================
      *
      **  Parmeters passed to program by EUC0140
     C           *ENTRY    PLIST
     C                     PARM           P#MAPN  6
      *
      ** Define Fields
      ** ~~~~~~~~~~~~~
     C           *LIKE     DEFN CNUM      K#CNUM
     C           *LIKE     DEFN CCY       K#CCY
     C           *LIKE     DEFN ACOD      K#ACOD
     C           *LIKE     DEFN BRCA      K#BRCA
     C           *LIKE     DEFN ACSQ      K#ACSQ
      *                                                                   184617
     C           *LIKE     DEFN ODLN      WODLN                           184617
     C           *LIKE     DEFN AODR      WAODR                           184617
      *
      ** Key Lists
      ** ~~~~~~~~~
      *
     C           K#KY01    KLIST
     C                     KFLD           K#BRCA
     C                     KFLD           K#CNUM
     C                     KFLD           K#CCY
     C                     KFLD           K#ACOD
     C                     KFLD           K#ACSQ
     C/COPY WNCPYSRC,EU0140C010
      *
     C           K#KY02    KLIST
     C                     KFLD           K#CNUM
     C                     KFLD           K#CCY
     C                     KFLD           K#ACOD
     C                     KFLD           K#ACSQ
     C                     KFLD           K#BRCA
      *
     C           K#KY03    KLIST
     C                     KFLD           W#MAPN
     C                     KFLD           K#BRCA
     C                     KFLD           K#CNUM
     C                     KFLD           K#CCY
     C                     KFLD           K#ACOD
     C                     KFLD           K#ACSQ
      *
     C** Key list to access accounts on ACCNTTI                           CEU029
     C**                                                                  CEU029
     C           K#KY04    KLIST                                          CEU029
     C                     KFLD           BRCA                            CEU029
     C                     KFLD           A5TIAN                          CEU029
     C                     KFLD           A5TIAS                          CEU029
      *
      * ===============================================================
      **                  P R O C E S S I N G
      * ===============================================================
      *
      **  Initialization Processing
     C                     EXSR INITPR
      *
      **  Main  Processing
      *
     C           W#MAPN    CHAINEUACMLL3             70
      *
     C           *IN70     DOWEQ*OFF
      *
     C                     MOVE 'N'       W#ERR1
     C                     MOVE 'N'       W#OPFA                          191826
      *
     C/COPY WNCPYSRC,EU0140C034
     C                     EXSR PRACNT
     C/COPY WNCPYSRC,EU0140C008
      *
      **  If it was created on ACCNTAB
     C           W#ERR1    IFNE 'Y'
      *
      **  Process Account Details Extension (ACCNTBXC)
     C                     EXSR PRTBXC
     C/COPY WNCPYSRC,EU0140C001
      *
      **  Process Commissions Enquiry file (RECOMD)
     C                     EXSR PRRCOM
      *
      **  Process Shadow Balances file (MEMOS)
     C                     EXSR PRMEMO
      *
      **  Process Retail Interest and Charges Detail file (REIACD)
     C                     EXSR PRIACD
      *
      **  Process Retail Accrued Interest to Date Detail file (REACRD)
     C                     EXSR PRACRD
      *
      ****Process*Retail*Account*Password*file*(REAPWDL0)**************                       CSD101
     C********** CRT101    IFEQ 'Y'                                                           CSD101
     C********** CRT001    ANDEQ'Y'                                                           CSD101
     C********** A5ACST    ANDEQ'S'                                                           CSD101
     C**********           EXSR PRAPWD                                                        CSD101
     C**********           ENDIF                                                              CSD101
      *
      **  Process Retail History file (REHISPD)
     C                     EXSR PRHIST
      *                                                                                       238619
      **  Process Account Master Extension file (GLACNTL3)                                    238619
     C                     EXSR PRGLAC                                                        238619
      *
      **  Process Single Transactions file (STRAN)
     C                     EXSR PRTRAN
     C/COPY WNCPYSRC,EU0140C013
      *                                                                   CEU025
      **  Process update to PF/RECIEUPD                                   CEU025
     C                     EXSR PRCIEU                                    CEU025
      *
     C                     ENDIF
     C/COPY WNCPYSRC,EU0140C006
      *
     C           W#OPFA    IFEQ 'Y'
     C                     MOVE 'Y'       EUOPFA
     C                     UPDATEUACMLPF
     C                     ENDIF
      *
      *
      * If many-to-one map only 1 Euro a/c is created                     153298
     C********** EUMULT    IFEQ 'N'                                       153298
     C           EUMULT    IFEQ 'Y'                                       153298
      * Set up Key
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY03    SETGTEUACMLL3
     C           W#MAPN    READEEUACMLL3                 70
      *
     C                     ELSE
      *
     C           W#MAPN    READEEUACMLL3                 70
     C                     ENDIF
      *
     C/COPY WNCPYSRC,EU0140C014
     C                     ENDDO
      *
     C                     MOVE 'Y'       EUOPIN
     C                     UPDATEUMDHDPF
     C/COPY WNCPYSRC,EU0140C011
      *
     C                     COMIT
      *
      ** Terminate Program
     C                     EXSR EXITPR
      *
      *
     C/COPY WNCPYSRC,EU0140C035
      ******************************************************************
      * PRACNT : Process ACCNTAB
      ******************************************************************
     C           PRACNT    BEGSR
      *
     C/COPY WNCPYSRC,EU0140C036
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
     C/COPY WNCPYSRC,EU0140C007
      *
     C           K#KY01    CHAINACCBR                70
     C/COPY WNCPYSRC,EU0140C015
      *
     C           *IN70     IFEQ *OFF
     C/COPY WNCPYSRC,EU0140C027
      *
     C                     MOVE 'Y'       W#OPFA  1
     C                     MOVE 'Y'       W#ERR1  1
      *
     C                     ELSE
      *
     C                     MOVE EUIBRC    K#BRCA
     C                     MOVE EUICNM    K#CNUM
     C                     MOVE EUICCY    K#CCY
     C                     MOVE EUIACD    K#ACOD
     C                     MOVE EUISQN    K#ACSQ
      *
     C/COPY WNCPYSRC,EU0140C012
     C           K#KY01    CHAINACCBR                70
     C           CEU025    IFEQ 'N'                                       CEU025
     C           *IN70     ANDEQ'0'                                       CEU025
     C/COPY WNCPYSRC,EU0140C049
      *                                                                   136675
      **  Check if Retail Account No is to be preserved for 'in' accnt    136675
     C***********          Z-ADD0         ACNO                            136675
     C           EURNPR    IFEQ 'Y'                                       136675
     C                     Z-ADD0         ACNO                            136675
     C                     ENDIF                                          136675
      *                                                                   136675
      ** Blank IBAN.                                                                          240740
      *                                                                                       240740
     C                     MOVEL##IBAN    WIBAN  34                                           240740
     C                     MOVEL##SEQN    WSEQN   3                                           240740
     C                     MOVE *BLANKS   ##IBAN                                              240740
     C                     MOVE *BLANKS   ##SEQN                                              240740
     C                     UPDATACCNTABF
     C                     MOVELWIBAN     ##IBAN                                              240740
     C                     MOVELWSEQN     ##SEQN                                              240740
      *                                                                   155257
      * If RE a/c no. preserved also zeroise ACNO on MEMOS                155257
     C           EURNPR    IFEQ 'Y'                                       155257
     C           K#KY02    CHAINMEMOSL1              70                   155257
     C           *IN70     IFEQ '0'                                       155257
     C                     Z-ADD0         ACNO                            155257
     C                     UPDATMEMOSMDF                                  155257
     C                     ENDIF                                          155257
     C                     ENDIF                                          155257
      *                                                                   155257
     C                     ENDIF                                          CEU025
      *                                                                   157543
      * Get 'in' ccy decimal places                                       157543
     C                     CALL 'AOCURRR0'                                157543
     C                     PARM *BLANKS   @RTCD                           157543
     C                     PARM '*KEY   ' @OPTN                           157543
     C                     PARM EUICCY    @CURR                           157543
     C           SDCURR    PARM SDCURR    DSSDY                           157543
      *                                                                   157543
     C           @RTCD     IFNE *BLANKS                                   157543
     C           *LOCK     IN   LDA                                       157543
     C                     Z-ADD21        DBASE                           157543
     C                     MOVEL'SDCURRPD'DBFILE                          157543
     C                     MOVELEUICCY    DBKEY                           157543
     C                     OUT  LDA                                       157543
     C                     EXSR *PSSR                                     157543
     C                     ELSE                                           157543
     C                     Z-ADDA6NBDP    @INCDP  10                      157543
     C                     ENDIF                                          157543
      *
      **  Write to ACCBR
     C                     MOVE 'D'       RECI
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C*********************MOVE BKEURO    CCY                             CRE008
     C                     MOVE EUECCY    CCY                             CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ACSQ
     C                     MOVE *BLANK    ZZ006
     C                     MOVELEUEBRC    BRCA
     C                     Z-ADDEUDACO    DACO
     C/COPY WNCPYSRC,EU0140C016
     C                     Z-ADD0         DACC
     C                     Z-ADD0         LDBL
     C                     Z-ADD0         CLBL
     C/COPY WNCPYSRC,EU0140C037
     C                     MOVE EUSTFQ    STFQ
     C                     Z-ADDEUSTDY    STDY
     C/COPY WNCPYSRC,EU0140C038
     C*********************Z-ADD*ZERO     LSTD                            136675
     C                     Z-ADDEUDACO    LSTD                            136675
     C/COPY WNCPYSRC,EU0140C039
     C                     Z-ADDEUNSTD    NSTD
     C/COPY WNCPYSRC,EU0140C040
     C                     Z-ADD*ZERO     LSTP
     C                     Z-ADD*ZERO     CFSB
     C                     Z-ADD*ZERO     LMVD
     C                     Z-ADD*ZERO     EPLB
     C                     Z-ADD*ZERO     EPCB
     C                     Z-ADD*ZERO     YTDB
     C                     MOVE *BLANKS   ZZ004
     C                     Z-ADDBJRDNB    ORED
     C                     Z-ADD*ZERO     DLIM
     C                     Z-ADD*ZERO     LRCR
     C                     Z-ADD*ZERO     RTCB
     C                     Z-ADD*ZERO     RTLB
     C                     Z-ADD*ZERO     DITM
     C                     Z-ADD*ZERO     CITM
     C                     MOVE *BLANKS   ZZ002
     C/COPY WNCPYSRC,EU0140C041
     C                     Z-ADDEUDRTS    CDIR
     C                     Z-ADDEUCRTS    CCIR
     C/COPY WNCPYSRC,EU0140C042
     C                     Z-ADDEUEACN    ACNO
      *  Overdraft Line
      *  --------------                                                   CRE008
      *  If the 2 currencies are different                                CRE008
     C           EUECCY    IFNE EUICCY                                    CRE008
      *                                                                   157543
      *  Convert overdraft line if one-to-one map or only 1 ccy mapped.   157543
     C           EUMULT    IFEQ 'N'                                       157543
     C           EUCCY2    OREQ *BLANKS                                   157543
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM ODLN      P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
      *                                                                   157543
      * Convert to whole units of ccy if necessary                        157543
     C           P@OUTA    IFNE *ZEROS                                    157543
     C           @INCDP    ANDNE@EURDP                                    157543
     C           @EURDP    ANDNE*ZEROS                                    157543
     C                     SELEC                                          157543
     C           @EURDP    WHEQ 1                                         157543
     C                     DIV  10        P@OUTA    H                     157543
     C           @EURDP    WHEQ 2                                         157543
     C                     DIV  100       P@OUTA    H                     157543
     C                     OTHER                                          157543
     C                     DIV  1000      P@OUTA    H                     157543
     C                     ENDSL                                          157543
     C                     ENDIF                                          157543
     C                     Z-ADDP@OUTA    ODLN                         unt
     C                     Z-ADDP@OUTA    WODLN                           184617
      *                                                                   157543
     C                     ELSE                                           157543
     C                     Z-ADD*ZEROS    ODLN                            157543
     C                     Z-ADD*ZEROS    ODED                            157543
     C                     MOVE *BLANKS   ODSC                            157543
     C                     ENDIF                                          157543
     C                     ENDIF                                          CRE008
      *
     C                     Z-ADD*ZEROS    DIOD
     C                     Z-ADD*ZEROS    HELD
      *  Minimum Balance
      *  ---------------                                                  CRE008
      *  If the 2 currencies are different                                CRE008
     C           EUECCY    IFNE EUICCY                                    CRE008
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM MINB      P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
      *                                                                   157543
      * Convert to whole units of ccy if necessary                        157543
     C           P@OUTA    IFNE *ZEROS                                    157543
     C           @INCDP    ANDNE@EURDP                                    157543
     C           @EURDP    ANDNE*ZEROS                                    157543
     C                     SELEC                                          157543
     C           @EURDP    WHEQ 1                                         157543
     C                     DIV  10        P@OUTA    H                     157543
     C           @EURDP    WHEQ 2                                         157543
     C                     DIV  100       P@OUTA    H                     157543
     C                     OTHER                                          157543
     C                     DIV  1000      P@OUTA    H                     157543
     C                     ENDSL                                          157543
     C                     ENDIF                                          157543
     C                     Z-ADDP@OUTA    MINB
     C                     ENDIF                                          CRE008
      *
     C*********************Z-ADD*ZEROS    LACD                            136675
     C                     Z-ADDEUDACO    LACD                            136675
     C                     Z-ADD*ZEROS    LISP
     C                     Z-ADD*ZEROS    RRNM
     C/COPY WNCPYSRC,EU0140C043
     C                     MOVE EUDBRT    DRIB
      *                                                                   136643
      ** Allow for fact that ACCBR does not have rate/spread sign field   136643
     C           EUDRSS    IFEQ '-'                                       136643
     C                     Z-SUBEUDRTS    DRIS                            136643
     C                     ELSE                                           136643
     C                     Z-ADDEUDRTS    DRIS
     C                     ENDIF                                          136643
      *                                                                   136643
     C                     Z-ADD*ZEROS    DRCD
     C                     Z-ADDEUDCLB    DRIC
     C                     MOVE EUDCFQ    DRIF
     C                     Z-ADDEUDCDY    DRDY
     C***********          Z-ADDEUDCLB    DRDY                            136643
     C                     Z-ADDEUDNIC    NDID
     C/COPY WNCPYSRC,EU0140C044
     C                     Z-ADDEUDACO    LDID
     C                     Z-ADD*ZEROS    LDIA
     C                     MOVE *BLANKS   SDAP
     C                     Z-ADD*ZEROS    LPAR
     C                     Z-ADD*ZEROS    DIIE
     C                     Z-ADD*ZEROS    DAIC
     C                     Z-ADD*ZEROS    MADI
     C                     Z-ADD*ZEROS    GADI
     C                     MOVE *BLANKS   DDIS
     C*********************Z-ADD*ZEROS    DDIA                            136675
     C*********************Z-ADD*ZEROS    OLDR                            136675
     C                     Z-ADDEUDACO    DDIA                            136675
     C                     Z-ADDEUDACO    OLDR                            136675
     C**********           Z-ADD*ZEROS    OLDB                                                CSD103
     C                     MOVE *BLANKS   OLDB                                                CSD103
     C                     Z-ADD*ZEROS    OLDS
     C***********          MOVE EUCINT    CRIB                            133674
     C/COPY WNCPYSRC,EU0140C045
     C                     MOVE EUCBRT    CRIB                            133674
      *                                                                   136643
      ** Allow for fact that ACCBR does not have rate/spread sign field   136643
     C           EUCRSS    IFEQ '-'                                       136643
     C                     Z-SUBEUCRTS    CRIS                            136643
     C                     ELSE                                           136643
     C                     Z-ADDEUCRTS    CRIS
     C                     ENDIF                                          136643
      *                                                                   136643
     C                     Z-ADD*ZEROS    CRCD
     C                     Z-ADDEUCCLB    CRIC
     C                     MOVE EUCCFQ    CRIF
     C***********          Z-ADDEUDCDY    CRDY                            136643
     C                     Z-ADDEUCCDY    CRDY                            136643
     C                     Z-ADDEUCNIC    NCID
     C/COPY WNCPYSRC,EU0140C046
     C                     Z-ADDEUDACO    LCID
     C                     Z-ADD*ZEROS    LCIA
     C                     MOVE *BLANKS   SCAP
     C*********************Z-ADD*ZEROS    LPAP                            136675
     C                     Z-ADDEUDACO    LPAP                            136675
     C                     Z-ADD*ZEROS    CIIE
     C                     Z-ADD*ZEROS    CAIC
     C                     Z-ADD*ZEROS    MACI
     C                     Z-ADD*ZEROS    GACI
     C                     MOVE *BLANKS   CDIS
     C*********************Z-ADD*ZEROS    DCIA                            136675
     C*********************Z-ADD*ZEROS    OLCR                            136675
     C                     Z-ADDEUDACO    DCIA                            136675
     C                     Z-ADDEUDACO    OLCR                            136675
     C**********           Z-ADD*ZEROS    OLCB                                                CSD103
     C                     MOVE *BLANKS   OLCB                                                CSD103
     C                     Z-ADD*ZEROS    OLCS
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE 'I'       CHTP
     C                     MOVE *BLANK    ACST                            160552
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
     C           EUECCY    IFNE EUICCY                                    CRE008
     C                     MOVE *BLANKS   BRTCA
     C                     ENDIF                                          CRE008
     C                     MOVE *BLANKS   NACSG
     C                     MOVE *BLANKS   R4ACNT
      *                                                                   177663
      ** Initialise ENOC to 1 if it is less than or equal to              177663
      ** 1 and statement frequency is 'E'.                                177663
      *                                                                   177541
     C           EUSTFQ    IFEQ 'E'                                       177541
     C           ENOC      ANDLE1                                         177663
     C                     Z-ADD1         ENOC                            177541
     C                     ELSE                                           177541
     C**********           Z-ADD*ZEROS    ENOC                            177663
     C                     ENDIF                                          177541
     C                     Z-ADD*ZEROS    EPNO
     C                     Z-ADD*ZEROS    ECFB
     C                     MOVE *BLANKS   LTAB
     C                     Z-ADD*ZEROS    LTAC
     C                     Z-ADD*ZEROS    LTAS
     C                     Z-ADD*ZEROS    HCFB
     C*********************MOVE *BLANKS   PTFR                            136675
      *                                                                   CPB001
      ** Determine whether the customer is Private Banking customer       CPB001
      *                                                                   CPB001
     C                     MOVE 'N'       WWPBC   1                       CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVELCNUM      @KEY10                          CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY    '@OPTN                           CPB001
     C                     PARM           @KEY10 10                       CPB001
     C                     PARM           @KEY7   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C                     MOVE 'Y'       WWPBC                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      ** Determine whether the customer is Portfolio Customer             CPB001
      *                                                                   CPB001
     C                     MOVE 'N'       WWPMC   1                       CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVELCNUM      @KEY10                          CPB001
     C                     CALL 'AOPLCSR0'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY    '@OPTN                           CPB001
     C                     PARM           @KEY10 10                       CPB001
     C           SDPLCS    PARM SDPLCS    DSFDY                           CPB001
      *                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C                     MOVE 'Y'       WWPMC                           CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
      ***  Default Portfolio Reference                                    CPB001
      *                                                                   CPB001
     C                     MOVE *BLANKS   PTFR                            CPB001
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           WWPMC     ANDEQ'Y'                                       CPB001
     C                     MOVE '9997'    PTFR                            136675
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           WWPBC     ANDEQ'Y'                                       CPB001
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WWPMC     ANDEQ'Y'                                       CPB001
     C           BGPFMG    ANDEQ'Y'                                       CPB001
      *                                                                   CPB001
     C**********           Z-ADDCNUM      WWCNUM  60                                   CPB001 CSD027
     C                     MOVE CNUM      WWCNUM  6                                           CSD027
     C           WWCNUM    SETLLPMPORTLL                                  CPB001
     C           WWCNUM    READEPMPORTLL                 89               CPB001
      *                                                                   CPB001
     C           *IN89     IFEQ *OFF                                      CPB001
     C                     MOVE PNPTFR    PTFR                            CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     MOVE *BLANKS   HLEX
     C***********          MOVE 'N'       A5TIAC                          136675
      *                                                                   CEU029
      ** If the account is a Trade Innovation account then                CEU029
      ** convert the TI account into a Euro TI account.                   CEU029
      *                                                                   CEU029
     C           A5TIAC    IFEQ 'Y'                                       CEU029
     C           EUECCY    ANDNEEUICCY                                    CRE008
      *                                                                   CEU029
      ** determine whether the customer is the branch internal customer   CEU029
      *                                                                   CEU029
     C**********           CALL 'AOBRCHR0'                                             CEU029 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           CEU029
     C                     PARM '*KEY    '@OPTN                           CEU029
     C                     PARM BRCA      @BRCD   3                       CEU029
     C********** SDBRCH    PARM SDBRCH    DSFDY                           CEU029              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   CEU029
      ** Database error                                                   CEU029
     C           @RTCD     IFNE *BLANKS                                   CEU029
     C           *LOCK     IN   LDA                                       CEU029
     C                     Z-ADD38        DBASE                           CEU029
     C                     MOVEL'SDBRCHPD'DBFILE                          CEU029
     C                     MOVELBRCA      DBKEY                           CEU029
     C                     OUT  LDA                                       CEU029
     C                     EXSR *PSSR                                     CEU029
     C                     ENDIF                                          CEU029
      *                                                                   CEU029
     C                     MOVE CNUM      CNUMA   6                       CEU029
      *                                                                   CEU029
      ** When customer is the branch internal customer:                   CEU029
      **  leave TI Account Number as the value on the old account;        CEU029
      **  set TI Account Suffix to 978 (ISO standard ccy no. for EUR).    CEU029
      *                                                                   CEU029
     C           CNUMA     IFEQ A8BICN                                    CEU029
     C                     MOVE '978'     A5TIAS                          CEU029
      *                                                                   CEU029
      ** When customer is not the branch internal customer:               CEU029
      **  set TI Account Number to the customer number;                   CEU029
      **  set TI Account Suffix to next available number.                 CEU029
      *                                                                   CEU029
     C                     ELSE                                           CEU029
     C                     MOVE CNUMA     A5TIAN                          CEU029
      *                                                                   CEU029
      ** determine the next available TI Account Suffix                   CEU029
      *                                                                   CEU029
     C                     Z-ADD0         COUNT                           CEU029
     C           *IN66     DOUEQ*ON                                       CEU029
     C           COUNT     OREQ 999                                       CEU029
     C                     ADD  1         COUNT                           CEU029
     C           K#KY04    CHAINACCNTTI              66                   CEU029
     C                     ENDDO                                          CEU029
      *                                                                   CEU029
      ** error if no moure suffixes are available                         CEU029
     C           COUNT     IFEQ 999                                       CEU029
     C           *LOCK     IN   LDA                                       CEU029
     C                     Z-ADD39        DBASE                           CEU029
     C                     MOVEL'ACCNTTI 'DBFILE                          CEU029
     C                     MOVEL'999     'DBKEY                           CEU029
     C                     OUT  LDA                                       CEU029
     C                     EXSR *PSSR                                     CEU029
     C                     ENDIF                                          CEU029
      *                                                                   CEU029
     C                     ENDIF                                          CEU029
      *                                                                   CEU029
     C                     ELSE                                           CEU029
     C                     MOVE 'N'       A5TIAC                          140915
     C                     MOVE *BLANKS   A5TIAN                          140915
     C                     MOVE *BLANKS   A5TIAS                          140915
     C                     ENDIF                                          CEU029
      *                                                                   CEU029
      ** If profit centre entered and its not blank, use it.              136675
     C           EUPRFC    IFNE *BLANKS                                   136675
     C                     MOVE EUPRFC    PRFC                            136675
     C                     END                                            136675
     C*                                                                   164492
     C** No Euro statement bal for euro (Euro is the actual ccy here)     164492
     C                     MOVE *BLANK    EUSB                            164492
     C/COPY WNCPYSRC,EU0140C017
      **
     C                     MOVEASTAMP,1   TMST             Default Timestamp                  CPK015
     C                     WRITEACCNTABF
     C/COPY WNCPYSRC,EU0140C003
      *                                                                                      LLN022A
     C           LLN022    IFEQ 'Y'                                                          LLN022A
      *                                                                                      LLN022A
      **  Get extension file details for legacy account                                      LLN022A
      *                                                                                      LLN022A
     C           K#KY01    CHAINBYACCTY0             90                                      LLN022A
      *                                                                                      LLN022A
      **  Record found                                                                       LLN022A
      *                                                                                      LLN022A
     C           *IN90     IFEQ *OFF                                                         LLN022A
      *                                                                                      LLN022A
      **  Convert the limit amount to Euros                                                  LLN022A
      *                                                                                      LLN022A
     C           LLLIM     IFNE *ZEROS                                                       LLN022A
     C                     Z-ADDLLLIM     P@FRAM                                             LLN022A
     C                     CALL 'EU0200'                                                     LLN022A
     C                     PARM *BLANK    P@RTCD  7        Return Code                       LLN022A
     C                     PARM           P@FRAM 183       FROM Ccy Amount                   LLN022A
     C                     PARM EUICCY    P@FRCY  3        FROM Currency                     LLN022A
     C                     PARM BKEURO    P@TOCY  3        TO Currency                       LLN022A
     C                     PARM           P@OUTA 150       Outright Amount                   LLN022A
     C                     PARM           P@INTA 183       Interim Amount                    LLN022A
     C                     PARM           P@EXRT 159       Exchange Rate                     LLN022A
     C                     PARM           P@MDIN  1        Mult/Div Ind.                     LLN022A
     C                     Z-ADDP@OUTA    LLLIM                                              LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
      **  Set new account reference                                                          LLN022A
      *                                                                                      LLN022A
     C                     MOVE EUECNM    LCNUM                                              LLN022A
     C                     MOVE BKEURO    LCCY                                               LLN022A
     C                     MOVE EUEACD    LACOD                                              LLN022A
     C                     MOVE EUESQN    LACSQ                                              LLN022A
     C                     MOVE EUEBRC    LBRCD                                              LLN022A
      *                                                                                      LLN022A
     C                     WRITEBYACCTD0                                                     LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                       CER001
      ** Save the indicator before process of ULX004                                          CER001
      *                                                                                       CER001
     C                     MOVE *IN99     WWIN99  1                                           CER001
      *                                                                                       CER001
      ** Test if the feature ULX004 is ON                                                     CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
      *                                                                                       CER001
      ** If found, check if EURO account exists                                               CER001
      *                                                                                       CER001
     C                     MOVE EUECNM    K#CNUM                                              CER001
     C                     MOVE EUECCY    K#CCY                                               CER001
     C                     MOVE EUEACD    K#ACOD                                              CER001
     C                     MOVE EUESQN    K#ACSQ                                              CER001
     C                     MOVE EUEBRC    K#BRCA                                              CER001
      *                                                                                       CER001
     C           K#KY02    CHAINREACX1PD             99                                       CER001
      *                                                                                       CER001
      ** If not found, write a new record                                                     CER001
      *                                                                                       CER001
     C           *IN99     IFNE *OFF                                                          CER001
      *                                                                                       CER001
      ** Set up field                                                                         CER001
      *                                                                                       CER001
     C                     MOVELEUECNM    WECNUM                                              CER001
     C                     MOVELEUECCY    WECCYC                                              CER001
     C                     MOVELEUEACD    WEACOD                                              CER001
     C                     MOVELEUESQN    WEACSQ                                              CER001
     C                     MOVELEUEBRC    WEBRCA                                              CER001
     C                     MOVELATYP      WEATYP                                              CER001
      *                                                                                       CER001
      ** Move blank/zero to the extension file fields                                         CER001
      *                                                                                       CER001
     C                     Z-ADD0         WE1UAC                                              CER001
     C                     Z-ADD0         WELUSU                                              CER001
     C                     Z-ADD0         WELURA                                              CER001
     C                     Z-ADD0         WECOAM                                              CER001
     C                     MOVE *BLANKS   WECOAC                                              CER001
     C                     MOVE *BLANKS   WECOBR                                              CER001
      *                                                                                       CER001
     C                     WRITEACCNTBF6                                                      CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** Restore the indicator after process of ULX004                                        CER001
      *                                                                                       CER001
     C                     MOVE WWIN99    *IN99                                               CER001
      **
      ** UPDATE ACCNTAC
      **
     C           1         SETLLACCNTAC
     C                     READ ACCNTAC                  80
      **
     C                     ADD  1         NINU
     C                     ADD  1         NOAU
     C                     ADD  1         NRET
     C                     Z-ADDBJRDNB    LCD
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      TNLU
     C                     UPDATACCNTCXF
      *
     C                     ENDIF
      *
     C/COPY WNCPYSRC,EU0140C018
     C                     ENDSR
     C/COPY WNCPYSRC,EU0140C009
      *
      ******************************************************************
      * PRTBXC :
      ******************************************************************
     C           PRTBXC    BEGSR
      *
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY02    CHAINACCNTBXC             70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C********** *LOCK     IN   LDA                                       190154
     C**********           Z-ADD1         DBASE                           190154
     C**********           MOVEL'ACCNTBXC'DBFILE                          190154
     C**********           MOVEL'        'DBKEY                           190154
     C**********           MOVEL'EU0140  'DBPGM                           190154
     C**********           OUT  LDA                                       190154
     C**********           EXSR *PSSR                                     190154
      *
     C**********           ELSE                                           190154
     C                     DELETACCNTBD0                                  190154
     C                     ENDIF                                          190154
      *
     C                     MOVE EUIBRC    K#BRCA
     C                     MOVE EUICNM    K#CNUM
     C                     MOVE EUICCY    K#CCY
     C                     MOVE EUIACD    K#ACOD
     C                     MOVE EUISQN    K#ACSQ
      *
     C           K#KY02    CHAINACCNTBXC             70
     C/COPY WNCPYSRC,EU0140C026
      *
      *
     C**********           Z-ADDEUECNM    ATCNUM                                              CSD027
     C                     MOVE EUECNM    ATCNUM                                              CSD027
     C*********************MOVE BKEURO    ATCCY                           CRE008
     C                     MOVE EUECCY    ATCCY                           CRE008
     C                     Z-ADDEUEACD    ATACOD
     C                     Z-ADDEUESQN    ATACSQ
     C                     MOVELEUEBRC    ATBRCA
      *  Account Charge Amount
      *  ---------------------                                            CRE008
      *  If the 2 currencies are different                                CRE008
     C           EUECCY    IFNE EUICCY                                    CRE008
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM ATCHAM    P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     Z-ADDP@OUTA    ATCHAM
     C                     ENDIF                                          CRE008
     C                     Z-ADDATAODR    WAODR                           184617
      *
     C                     Z-ADD*ZEROS    ATAODR
     C                     Z-ADD*ZEROS    ATITRD
     C**********           Z-ADD*ZEROS    ATORTC                          184653
     C                     Z-ADD*ZEROS    ATORTC                          CRE008
      *  If the 2 currencies are different                                CRE008
     C********** EUECCY    IFNE EUICCY                                                 CRE008 238619
     C**********           Z-ADDEUDACO    ATORTC                                       184653 238619
     C**********           ENDIF                                                       CRE008 238619
     C**********           Z-ADD*ZEROS    ATOLVD                          196967
     C**********           Z-ADDEUDACO    ATOLVD                                       196967 238619
     C                     Z-ADD*ZEROS    ATOLVD                                              238619
     C**********           Z-ADD*ZEROS    ATPOLC                          196967
     C**********           Z-ADDEUDACO    ATPOLC                                       196967 238619
     C                     Z-ADD*ZEROS    ATPOLC                                              238619
     C                     Z-ADD*ZEROS    ATPOLE
     C                     Z-ADDEUEACN    ATACNO                          CRE008
     C/COPY WNCPYSRC,EU0140C019
      *
     C                     MOVEASTAMP,1   ATTMST           Default Timestamp                  CPK015
     C                     WRITEACCNTBD0
      *
     C**********           ENDIF                                          190154
      *
     C                     ENDSR
     C/COPY WNCPYSRC,EU0140C002
      *
      ******************************************************************
      * PRRCOM :
      ******************************************************************
     C           PRRCOM    BEGSR
      *
     C** ACCESS RETAIL ICD TABTBRE FOR COMMISSION ON                      158072
     C*                                                                   158072
     C           1         SETLLTABTBRE                                   158072
     C                     READ TABTBRE                  60               158072
      *                                                                   158072
     C           *IN60     IFEQ *ON                                       158072
      *                                                                   158072
     C           *LOCK     IN   LDA                                       158072
     C                     Z-ADD6         DBASE                           158072
     C                     MOVEL'TABTBRE' DBFILE                          158072
     C                     MOVE '       ' DBKEY                           158072
     C                     MOVEL'EU0140 ' DBPGM                           158072
     C                     OUT  LDA                                       158072
     C                     EXSR *PSSR                                     158072
     C                     END                                            158072
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY01    CHAINRECOM                70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE
     C                     MOVEL'RECOM   'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'EU0140  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *                                                                   157543
      * Retrieve record for 'in' ccy a/c                                  157543
     C                     MOVE EUIBRC    K#BRCA                          157543
     C                     MOVE EUICNM    K#CNUM                          157543
     C                     MOVE EUICCY    K#CCY                           157543
     C                     MOVE EUIACD    K#ACOD                          157543
     C                     MOVE EUISQN    K#ACSQ                          157543
     C                     CLEARRECOMDF                                   157543
     C                     MOVE '0'       *IN70                           177663
     C           K#KY01    CHAINRECOM                70                   157543
      *
     C           *IN70     IFEQ '1'                                       177663
      *                                                                   177663
     C           *LOCK     IN   LDA                                       177663
     C                     Z-ADD7         DBASE                           177663
     C                     MOVEL'RECOM   'DBFILE                          177663
     C                     MOVEL'        'DBKEY                           177663
     C                     MOVEL'EU0140  'DBPGM                           177663
     C                     OUT  LDA                                       177663
     C                     EXSR *PSSR                                     177663
      *                                                                   177663
     C                     ELSE                                           177663
     C                     MOVE 'D'       RECI
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C*********************MOVE BKEURO    CCY                             CRE008
     C                     MOVE EUECCY    CCY                             CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ACSQ
     C                     MOVELEUEBRC    BRCA
      *                                                                   CRE008
      *  If the 2 currencies are different                                CRE008
     C           EUECCY    IFNE EUICCY                                    CRE008
      *                                                                   CRE008
      *  Fixed Commission
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM FXDC      P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     Z-ADDP@OUTA    FXDC
      *  Highest Overdraft Commission
      * (No conversion necessary as if CEXA is numeric it is a rate)      157543
     C**********           MOVE CEXA      W#NU10 100P                     157543
     C********** CEXA      IFNE *BLANKS                                   157543
     C********** CEXA      ANDNE'E'                                       157543
      *                                                                   158072
     C           MDPF      IFEQ 'F'                                       158072
      *                                                                   158072
     C                     CALL 'EU0200'                                  158072
     C                     PARM *BLANK    P@RTCD  7        Return Code    158072
     C                     PARM W#NU10    P@FRAM 183       FROM Ccy Amount158072
     C                     PARM EUICCY    P@FRCY  3        FROM Currency  158072
     C                     PARM BKEURO    P@TOCY  3        TO Currency    158072
     C                     PARM           P@OUTA 150       Outright Amount158072
     C                     PARM           P@INTA 183       Interim Amount 158072
     C                     PARM           P@EXRT 159       Exchange Rate  158072
     C                     PARM           P@MDIN  1        Mult/Div Ind.  158072
     C                     MOVE P@OUTA    CEXA      P                     158072
      *                                                                   158072
     C                     END                                            158072
      *
     C**********           CALL 'EU0200'                                  157543
     C**********           PARM *BLANK    P@RTCD  7        Return Code    157543
     C**********           PARM W#NU10    P@FRAM 183       FROM Ccy Amount157543
     C**********           PARM EUICCY    P@FRCY  3        FROM Currency  157543
     C**********           PARM BKEURO    P@TOCY  3        TO Currency    157543
     C**********           PARM           P@OUTA 150       Outright Amount157543
     C**********           PARM           P@INTA 183       Interim Amount 157543
     C**********           PARM           P@EXRT 159       Exchange Rate  157543
     C**********           PARM           P@MDIN  1        Mult/Div Ind.  157543
     C**********           MOVE P@OUTA    CEXA      P                     157543
      *
     C**********           ENDIF                                          157543
      *  Turnover Commission
      * (No conversion necessary as if CEXB is numeric it is a rate)      157543
     C**********           MOVE CEXB      W#NU10 100P                     157543
     C********** CEXB      IFNE *BLANKS                                   157543
     C********** CEXB      ANDNE'E'                                       157543
      *
     C**********           CALL 'EU0200'                                  157543
     C**********           PARM *BLANK    P@RTCD  7        Return Code    157543
     C**********           PARM W#NU10    P@FRAM 183       FROM Ccy Amount157543
     C**********           PARM EUICCY    P@FRCY  3        FROM Currency  157543
     C**********           PARM BKEURO    P@TOCY  3        TO Currency    157543
     C**********           PARM           P@OUTA 150       Outright Amount157543
     C**********           PARM           P@INTA 183       Interim Amount 157543
     C**********           PARM           P@EXRT 159       Exchange Rate  157543
     C**********           PARM           P@MDIN  1        Mult/Div Ind.  157543
     C**********           MOVE P@OUTA    CEXB      P                     157543
      *
     C**********           ENDIF                                          157543
      *  DR Interest Commission
      * (No conversion necessary as if CEXC is numeric it is a rate)      157543
     C**********           MOVE CEXC      W#NU10 100P                     157543
      *
     C********** CEXC      IFNE *BLANKS                                   157543
     C********** CEXC      ANDNE'E'                                       157543
      *
     C**********           CALL 'EU0200'                                  157543
     C**********           PARM *BLANK    P@RTCD  7        Return Code    157543
     C**********           PARM W#NU10    P@FRAM 183       FROM Ccy Amount157543
     C**********           PARM EUICCY    P@FRCY  3        FROM Currency  157543
     C**********           PARM BKEURO    P@TOCY  3        TO Currency    157543
     C**********           PARM           P@OUTA 150       Outright Amount157543
     C**********           PARM           P@INTA 183       Interim Amount 157543
     C**********           PARM           P@EXRT 159       Exchange Rate  157543
     C**********           PARM           P@MDIN  1        Mult/Div Ind.  157543
     C**********           MOVE P@OUTA    CEXC      P                     157543
      *
     C**********           ENDIF                                          157543
      *  Inactive Commission
     C                     MOVE CEXD      W#NU10 100P
     C           CEXD      IFNE *BLANKS
     C           CEXD      ANDNE'E'
      *
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM W#NU10    P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     MOVE P@OUTA    CEXD      P
      *
     C                     ENDIF
      *  Minimum Credit Balance Commission
     C                     MOVE CEXE      W#NU10 100P
     C           CEXE      IFNE *BLANKS
     C           CEXE      ANDNE'E'
      *
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM W#NU10    P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     MOVE P@OUTA    CEXE      P
      *
     C                     ENDIF
      *  Extra daily statement Commission
     C                     MOVE CEXF      W#NU10 100P
     C           CEXF      IFNE *BLANKS
     C           CEXF      ANDNE'E'
      *
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM W#NU10    P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     MOVE P@OUTA    CEXF      P
      *
     C                     ENDIF
      *  Fixed Commission
     C                     MOVE CEXG      W#NU10 100P
     C           CEXG      IFNE *BLANKS
     C********** CEXF      ANDNE'E'                                       194044
     C           CEXG      ANDNE'E'                                       194044
      *
     C                     CALL 'EU0200'
     C                     PARM *BLANK    P@RTCD  7        Return Code
     C                     PARM W#NU10    P@FRAM 183       FROM Ccy Amount
     C                     PARM EUICCY    P@FRCY  3        FROM Currency
     C                     PARM BKEURO    P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind.
     C                     MOVE P@OUTA    CEXG      P
      *
     C                     ENDIF
     C                     ENDIF                                          CRE008
      *                                                                   157543
     C                     Z-ADD*ZEROS    ACCEA                           157543
     C                     Z-ADD*ZEROS    ACCC                            157543
     C                     Z-ADD*ZEROS    GVDPE                           157543
     C                     Z-ADD*ZEROS    GVDPC                           157543
     C                     Z-ADD*ZEROS    ACCRA                           157543
     C                     MOVE *BLANKS   MMACC                           157543
     C                     Z-ADD*ZEROS    CACCC                           157543
     C                     Z-ADD*ZEROS    CDIE                            157543
     C                     Z-ADD*ZEROS    CDICA                           157543
     C                     Z-ADD*ZEROS    CDRR                            157543
     C                     MOVE *BLANKS   MMCDI                           157543
     C                     Z-ADD*ZEROS    CCDIC                           157543
     C                     Z-ADD*ZEROS    IACE                            157543
     C                     Z-ADD*ZEROS    IACCC                           157543
     C                     Z-ADD*ZEROS    CIACC                           157543
     C                     Z-ADD*ZEROS    CMBE                            157543
     C                     Z-ADD*ZEROS    CMBC                            157543
     C                     Z-ADD*ZEROS    ACCB                            157543
     C                     Z-ADD*ZEROS    CCMBC                           157543
     C                     Z-ADD*ZEROS    CHDBE                           157543
     C                     Z-ADD*ZEROS    CHDBC                           157543
     C                     Z-ADD*ZEROS    HDRB                            157543
     C                     Z-ADD*ZEROS    CHDBR                           157543
     C                     MOVE *BLANKS   MMCHDB                          157543
     C                     Z-ADD*ZEROS    CCHDBC                          157543
     C                     MOVE *BLANK    CACDC                           157543
     C                     Z-ADD*ZEROS    CCINST                          157543
     C                     Z-ADD*ZEROS    TEGRT                           157543
     C                     Z-ADD*ZEROS    VATAM                           157543
     C                     Z-ADD*ZEROS    NOIS                            157543
     C                     Z-ADD*ZEROS    PESP                            157543
     C                     Z-ADD*ZEROS    NOIP                            157543
      *
     C                     WRITERECOMDF
      *
     C                     ENDIF                                          177663
     C                     ENDIF
      *
     C                     ENDSR
      *
      ******************************************************************
      * PRMEMO :
      ******************************************************************
     C           PRMEMO    BEGSR
      *
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY02    CHAINMEMOSL1              70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C           *LOCK     IN   LDA
     C                     Z-ADD2         DBASE
     C                     MOVEL'MEMOSL1 'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'EU0140  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
     C                     MOVE 'D'       RECI
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C*********************MOVE BKEURO    CCY                             CRE008
     C                     MOVE EUECCY    CCY                             CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ACSQ
     C                     MOVELEUEBRC    BRCA
     C                     Z-ADDEUEACN    ACNO
      *
     C                     Z-ADD*ZERO     LDBLN
     C                     Z-ADD*ZERO     CLBLN
     C                     MOVE *BLANKS   ZZ005
     C                     Z-ADD*ZERO     INLU
     C                     Z-ADD*ZERO     BNLU
      *
     C                     WRITEMEMOSMDF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      ******************************************************************
      * PRIACD :
      ******************************************************************
     C           PRIACD    BEGSR
      *
      ** Access the IN currency A/c to allow fields to be defaulted if    136675
      ** required.                                                        136675
     C                     MOVE EUIBRC    K#BRCA                          136675
     C                     MOVE EUICNM    K#CNUM                          136675
     C                     MOVE EUICCY    K#CCY                           136675
     C                     MOVE EUIACD    K#ACOD                          136675
     C                     MOVE EUISQN    K#ACSQ                          136675
      *                                                                   136675
      ** clear default values.                                            136675
     C                     CLEARWUPTRA                                    136675
     C                     CLEARWUPRCH                                    136675
      *                                                                   136675
     C           K#KY01    CHAINIACBR                70                   136675
      *                                                                   136675
     C           *IN70     IFEQ *OFF                       rec found      136675
      *                                                                   136675
      ** Store fields to be defaulted.                                    136675
     C                     MOVE PTRA      WUPTRA  1                       136675
     C                     MOVE PRCH      WUPRCH  1                       136675
     C                     MOVE TCHO      WUTCHO  70                      194878
     C                     ENDIF                                          136675
      *                                                                   136675
      ** Clear IN a/c record.                                             136675
     C/COPY WNCPYSRC,EU0140C024
     C                     CLEARREIACDF                                   136675
     C/COPY WNCPYSRC,EU0140C025
      *                                                                   136675
      ** Proceed with euro a/c.                                           136675
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY01    CHAINIACBR                70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C           *LOCK     IN   LDA
     C                     Z-ADD3         DBASE
     C                     MOVEL'IACBR   'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'EU0140  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
     C                     MOVE 'D'       RECI
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C*********************MOVE BKEURO    CCY                             CRE008
     C                     MOVE EUECCY    CCY                             CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ACSQ
     C                     MOVELEUEBRC    BRCA
     C/COPY WNCPYSRC,EU0140C020
      *
     C                     MOVE EUDINT    DICT
     C                     MOVE EUDIST    DCST
     C                     MOVE *BLANKS   DACP
     C                     MOVE EUCINT    CICT
     C                     MOVE EUCIST    CCST
     C                     MOVE *BLANKS   CACP
     C/COPY WNCPYSRC,EU0140C047
     C                     MOVE EUCCCT    CHGT
     C                     MOVE EUCCST    CHST
     C                     MOVE *BLANKS   CHAC
     C/COPY WNCPYSRC,EU0140C021
      ** default values.                                                  136675
     C                     MOVE WUPTRA    PTRA             prt trans adv  136675
     C                     MOVE WUPRCH    PRCH             prt rate adv   136675
      *                                                                   194878
      ** Transaction Charge                                               194878
      *  ------------------                                               CRE008
      *  If the 2 currencies are different                                CRE008
     C           EUECCY    IFNE EUICCY                                    CRE008
      *                                                                   194878
     C                     CALL 'EU0200'                                  194878
     C                     PARM *BLANK    P@RTCD  7        Return Code    194878
     C                     PARM WUTCHO    P@FRAM 183       FROM Ccy Amount194878
     C                     PARM EUICCY    P@FRCY  3        FROM Currency  194878
     C                     PARM BKEURO    P@TOCY  3        TO Currency    194878
     C                     PARM           P@OUTA 150       Outright Amount194878
     C                     PARM           P@INTA 183       Interim Amount 194878
     C                     PARM           P@EXRT 159       Exchange Rate  194878
     C                     PARM           P@MDIN  1        Mult/Div Ind.  194878
     C                     Z-ADDP@OUTA    TCHO                            194878
     C                     ENDIF                                          CRE008
      *
     C                     WRITEREIACDF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      ******************************************************************
      * PRACRD :
      ******************************************************************
     C           PRACRD    BEGSR
      *
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY02    CHAINREACR                70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE
     C                     MOVEL'REACR   'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'EU0140  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
     C                     MOVE 'D'       RECI
     C**********           Z-ADDEUECNM    CUST                                                CSD027
     C                     MOVE EUECNM    CUST                                                CSD027
     C*********************MOVE BKEURO    ACCY                            CRE008
     C                     MOVE EUECCY    ACCY                            CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ASEQ
     C                     MOVELEUEBRC    BRCA
      *
     C                     MOVE *BLANKS   ZZ011
     C                     Z-ADDNATN      TNLU
     C                     Z-ADDBJRDNB    ORED
     C                     Z-ADDBJRDNB    LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADD*ZERO     DAIC1
     C                     Z-ADD*ZERO     MADI
     C                     Z-ADD*ZERO     GADI
     C                     Z-ADD*ZERO     CAIC1
     C                     Z-ADD*ZERO     MACI
     C                     Z-ADD*ZERO     GACI
     C                     Z-ADD*ZERO     HISB
     C                     Z-ADD*ZERO     BFDR
     C                     Z-ADD*ZERO     BFCR
     C                     MOVE *BLANK    ZZ022
     C                     Z-ADD*ZERO     MNBL
     C                     Z-ADD*ZERO     TDINT
     C                     Z-ADD*ZERO     TCINT
     C                     Z-ADD*ZERO     TEGLIS
     C                     MOVE *BLANK    POSTI
     C                     Z-ADD*ZERO     CINW
     C                     Z-ADD*ZERO     DINW
     C                     Z-ADD*ZERO     ODIA
     C                     MOVE *BLANKS   REPI                            CPB002
      *
     C                     WRITEREACRDF
      *
     C           1         SETLLREACRZ
     C                     READ REACRZ                   89
      *
     C           *IN89     IFEQ '0'
     C                     ADD  1         NORE
     C                     Z-ADDNATN      TNLU
     C                     UPDATREACRZF
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      ******************************************************************
      **PRAPWD*:*******************************************************                       CSD101
      ******************************************************************
     C********** PRAPWD    BEGSR                                                              CSD101
      *
     C**********           MOVE EUEBRC    K#BRCA                                              CSD101
     C**********           MOVE EUECNM    K#CNUM                                              CSD101
     C**********           MOVE EUECCY    K#CCY                                               CSD101
     C**********           MOVE EUEACD    K#ACOD                                              CSD101
     C**********           MOVE EUESQN    K#ACSQ                                              CSD101
      *
     C********** K#KY02    CHAINREAPWDPD             70                                       CGP001
     C********** K#KY02    CHAINREAPWDL0             70                                CGP001 CSD101
      *
     C********** *IN70     IFEQ *OFF                                                          CSD101
     C********** W#ERR1    ANDEQ'N'                                                           CSD101
      *
     C********** *LOCK     IN   LDA                                                           CSD101
     C**********           Z-ADD5         DBASE                                               CSD101
     C**********           MOVEL'REAPWDPD'DBFILE                                              CGP001
     C**********           MOVEL'REAPWDL0'DBFILE                                       CGP001 CSD101
     C**********           MOVEL'        'DBKEY                                               CSD101
     C**********           MOVEL'EU0140  'DBPGM                                               CSD101
     C**********           OUT  LDA                                                           CSD101
     C**********           EXSR *PSSR                                                         CSD101
      *
     C**********           ELSE                                                               CSD101
      *
     C**********           MOVE 'D'       RECI                                                CSD101
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C**********           MOVE EUECNM    CNUM                                         CSD027 CSD101
     C*********************MOVE BKEURO    CCY                             CRE008
     C**********           MOVE EUECCY    CCY                             CRE008              CSD101
     C**********           Z-ADDEUEACD    ACOD                                                CSD101
     C**********           Z-ADDEUESQN    ACSQ                                                CSD101
     C**********           MOVELEUEBRC    BRCA                                                CSD101
      *
     C**********           MOVE *BLANK    PSWD                                                CSD101
      *
     C**********           WRITEREAPWDD0                                                      CSD101
      *
     C**********           ENDIF                                                              CSD101
      *
     C**********           ENDSR                                                              CSD101
      *
      ******************************************************************
      * PRHIST :
      ******************************************************************
     C           PRHIST    BEGSR
      *
     C                     MOVE EUEBRC    K#BRCA
     C                     MOVE EUECNM    K#CNUM
     C                     MOVE EUECCY    K#CCY
     C                     MOVE EUEACD    K#ACOD
     C                     MOVE EUESQN    K#ACSQ
      *
     C           K#KY01    CHAINREHISBL              70
      *
     C           *IN70     IFEQ *OFF
     C           W#ERR1    ANDEQ'N'
      *
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE
     C                     MOVEL'REHISBL 'DBFILE
     C                     MOVEL'        'DBKEY
     C                     MOVEL'EU0140  'DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
     C                     MOVE EUIBRC    K#BRCA                          184617
     C                     MOVE EUICNM    K#CNUM                          184617
     C                     MOVE EUICCY    K#CCY                           184617
     C                     MOVE EUIACD    K#ACOD                          184617
     C                     MOVE EUISQN    K#ACSQ                          184617
     C                     MOVE '0'       *IN70                           184617
      *                                                                   184617
     C           K#KY01    CHAINREHISBL              70                   184617
      *                                                                   184617
     C           *IN70     IFEQ '1'                                       184617
      *                                                                   184617
     C           *LOCK     IN   LDA                                       184617
     C                     Z-ADD7         DBASE                           184617
     C                     MOVEL'REHISBL 'DBFILE                          184617
     C                     MOVEL'        'DBKEY                           184617
     C                     MOVEL'EU0140  'DBPGM                           184617
     C                     OUT  LDA                                       184617
     C                     EXSR *PSSR                                     184617
      *                                                                   184617
     C                     ELSE                                           184617
     C                     MOVE 'B'       RECI
     C**********           Z-ADDEUECNM    CNUM                                                CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C*********************MOVE BKEURO    CCY                                   CRE008
     C                     MOVE EUECCY    CCY                                   CRE008
     C                     Z-ADDEUEACD    ACOD
     C                     Z-ADDEUESQN    ACSQ
     C                     MOVELEUEBRC    BRCA
      *
     C                     Z-ADDEUDACO    HISD
     C                     Z-ADD*ZERO     HISB
     C                     Z-ADD*ZERO     MNBL
     C                     Z-ADD*ZERO     CHGAR
     C                     Z-ADD*ZERO     TCHGAR
     C                     Z-ADD*ZERO     CHGAN
     C                     Z-ADD*ZERO     TCHGAN
     C                     Z-ADD*ZERO     DMVT
     C/COPY WNCPYSRC,EU0140C028
     C                     MOVE EUDINT    DICT
     C                     MOVE EUDCLB    DRCB
     C                     MOVE EUDRTS    DRIR
     C/COPY WNCPYSRC,EU0140C029
     C                     Z-ADDEUDACO    DRCD
     C                     Z-ADD*ZERO     DAID
     C                     Z-ADD*ZERO     MADI
     C                     Z-ADD*ZERO     TMADI
     C*******************  Z-ADD*ZERO     PDID                                            143460
     C                     Z-ADDEUDACO    PDID                                            143460
     C                     Z-ADD*ZERO     DMINT
     C                     Z-ADD*ZERO     CMVT
     C/COPY WNCPYSRC,EU0140C030
     C                     MOVE EUCINT    CICT
     C                     MOVE EUCCLB    CRCB
     C                     Z-ADDEUCRTS    CRIR
     C/COPY WNCPYSRC,EU0140C031
     C                     Z-ADDEUDACO    CRCD
     C                     Z-ADD*ZERO     CAID
     C                     Z-ADD*ZERO     MACI
     C                     Z-ADD*ZERO     TMACI
     C                     Z-ADDEUDACO    PCID
     C                     Z-ADD*ZERO     CMINT
     C                     MOVE *BLANK    DICI
     C                     MOVE *BLANK    CICI
     C                     MOVE *BLANK    DRCI
     C                     MOVE *BLANK    CRCI
     C                     Z-ADDBJRDNB    VDTC
     C                     MOVE *BLANK    ADTY
     C                     MOVE *BLANK    ALTI
     C                     Z-ADD*ZERO     MNBCP
     C                     MOVE *BLANK    LGID
     C                     Z-ADD*ZERO     VALL
     C                     MOVE *BLANK    LINK
     C                     MOVE *BLANK    ZZ008
      *  Overdraft Line
     C**********           CALL 'EU0200'                                  157543
     C**********           PARM *BLANK    P@RTCD  7        Return Code    157543
     C**********           PARM ODRL      P@FRAM 183       FROM Ccy Amount157543
     C**********           PARM EUICCY    P@FRCY  3        FROM Currency  157543
     C**********           PARM BKEURO    P@TOCY  3        TO Currency    157543
     C**********           PARM           P@OUTA 150       Outright Amount157543
     C**********           PARM           P@INTA 183       Interim Amount 157543
     C**********           PARM           P@EXRT 159       Exchange Rate  157543
     C**********           PARM           P@MDIN  1        Mult/Div Ind.  157543
     C**********           Z-ADDP@OUTA    ODRL                            157543
     C           CRE001    IFEQ 'Y'                                       157543
     C                     Z-ADDODLN      ODRL                            157543
     C                     ELSE                                           157543
     C                     Z-ADD*ZEROS    ODRL                            157543
     C                     ENDIF                                          157543
     C                     Z-ADD*ZERO     ODIA                            184617
     C                     Z-ADDWODLN     ODRL                            184617
     C                     Z-ADDWAODR     AODR                            184617
     C                     MOVE *BLANK    ODLI                            184617
      *
     C                     WRITEREHISPPF
      *
     C                     ENDIF                                          184617
     C                     ENDIF
      *
     C                     ENDSR
      *                                                                                       238619
      ******************************************************************                      238619
      * PRGLAC :                                                                              238619
      ******************************************************************                      238619
     C           PRGLAC    BEGSR                                                              238619
      *                                                                                       238619
     C                     MOVE EUEBRC    K#BRCA                                              238619
     C                     MOVE EUECNM    K#CNUM                                              238619
     C                     MOVE EUECCY    K#CCY                                               238619
     C                     MOVE EUEACD    K#ACOD                                              238619
     C                     MOVE EUESQN    K#ACSQ                                              238619
      *                                                                                       238619
     C           K#KY02    CHAINGLACNTL3             70                                       238619
      *                                                                                       238619
     C           *IN70     IFEQ *OFF                                                          238619
     C           W#ERR1    ANDEQ'N'                                                           238619
      *                                                                                       238619
     C           *LOCK     IN   LDA                                                           238619
     C                     Z-ADD8         DBASE                                               238619
     C                     MOVEL'GLACNTL3'DBFILE                                              238619
     C                     MOVEL'        'DBKEY                                               238619
     C                     MOVEL'EU0140  'DBPGM                                               238619
     C                     OUT  LDA                                                           238619
     C                     EXSR *PSSR                                                         238619
      *                                                                                       238619
     C                     ELSE                                                               238619
      *                                                                                       238619
     C                     MOVE EUIBRC    K#BRCA                                              238619
     C                     MOVE EUICNM    K#CNUM                                              238619
     C                     MOVE EUICCY    K#CCY                                               238619
     C                     MOVE EUIACD    K#ACOD                                              238619
     C                     MOVE EUISQN    K#ACSQ                                              238619
     C                     MOVE '0'       *IN70                                               238619
      *                                                                                       238619
     C           K#KY02    CHAINGLACNTL3             70                                       238619
      *                                                                                       238619
     C           *IN70     IFEQ '1'                                                           238619
      *                                                                                       238619
     C           *LOCK     IN   LDA                                                           238619
     C                     Z-ADD9         DBASE                                               238619
     C                     MOVEL'GLACNTL3'DBFILE                                              238619
     C                     MOVEL'        'DBKEY                                               238619
     C                     MOVEL'EU0140  'DBPGM                                               238619
     C                     OUT  LDA                                                           238619
     C                     EXSR *PSSR                                                         238619
      *                                                                                       238619
     C                     ELSE                                                               238619
     C**********           Z-ADDEUECNM    F1CNUM                                       238619 CSD027
     C                     MOVE EUECNM    CNUM                                                CSD027
     C                     MOVE EUECCY    F1CCY                                               238619
     C                     Z-ADDEUEACD    F1ACOD                                              238619
     C                     Z-ADDEUESQN    F1ACSQ                                              238619
     C                     MOVELEUEBRC    F1BRCA                                              238619
     C                     Z-ADD*ZERO     F1FCHD                                              238619
     C                     Z-ADD*ZERO     F1LFCD                                              238619
     C                     Z-ADD*ZERO     F1ACBL                                              238619
     C                     Z-ADD*ZERO     F1TEXO                                              238619
     C                     Z-ADD*ZERO     F1TEOF                                              238619
     C                     Z-ADD*ZERO     F1TEOC                                              238619
     C                     Z-ADD*ZERO     F1DECD                                              CRE090
     C                     Z-ADD*ZERO     F1DRFD                                              CRE095
     C                     Z-ADD*ZERO     F1DNFD                                              CRE095
     C                     Z-ADD*ZERO     F1DNFM                                              CRE095
     C                     Z-ADD*ZERO     F1CRFD                                              CRE095
     C                     Z-ADD*ZERO     F1CNFD                                              CRE095
     C                     Z-ADD*ZERO     F1CNFM                                              CRE095
      *                                                                                       238619
     C                     WRITEGLACNTD0                                                      238619
      *                                                                                       238619
     C                     ENDIF                                                              238619
     C                     ENDIF                                                              238619
      *                                                                                       238619
     C                     ENDSR                                                              238619
      *
      ******************************************************************
      * PRTRAN :
      ******************************************************************
     C           PRTRAN    BEGSR
      *                                                                                       208336
      **  Initialise no. of records added field                                               208336
      *                                                                                       208336
     C                     Z-ADD0         WNORS   20                                          208336
      *
      **  OUTPUT ONLY IF NO FLAT RATE
     C/COPY WNCPYSRC,EU0140C032
      *
      *  D E B I T
      *
     C           EUDBRT    IFEQ *BLANK
     C           EUDRTS    ANDEQ*ZERO
     C           EUDRSS    ANDEQ*BLANK
      *
     C           EUDINT    IFNE *BLANK
     C           EUDIST    ANDNE*BLANK
      *
     C***********          MOVE EUDINT    WWRIB   2                       133674
     C***********          MOVE EUECCY    WWCCY   3                       133674
      ***********                                                         133674
      ***Get*Base*Rate*Codes*******************************************   133674
     C***********          CALL 'AOBSRTR0'                                133674
     C***********          PARM '*MSG   ' @RTCD                           133674
     C***********          PARM '*KEY   ' @OPTN                           133674
     C***********          PARM WWCCY     @CYCD   3                       133674
     C***********          PARM WWRIB     @BSRC   2                       133674
     C***********SDBSRT    PARM SDBSRT    DSFDY                           133674
     C***********@RTCD     IFNE *BLANKS                                   133674
     C************LOCK     IN   LDA                                       133674
     C***********          Z-ADD16        DBASE                           133674
     C***********          MOVEL'SDBSRTPD'DBFILE                          133674
     C***********          MOVELWWRIB     DBKEY                           133674
     C***********          OUT  LDA                                       133674
     C***********          EXSR *PSSR                                     133674
     C***********          ENDIF                                          133674
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      WWNATN  50
     C********** 1         CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ '1'                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD10        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVEL'1     '  DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      **********                                                                              208336
      ***UPDATE*HEADER*OF*STRAN*                                                              208336
      **********                                                                              208336
     C**********           MOVE ZZ199     STHEAD                                              208336
     C**********           Z-ADDTRNO      WWTRNO  50                                          208336
     C**********           ADD  3         TRNO                                                208336
     C**********           Z-ADDWWNATN    SATN                                                208336
     C**********           ADD  1         NORC                                                208336
     C**********           MOVE STHEAD    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
      *
      ** ACCESS INTEREST TYPE/SUB TYPE ONLY IF NOT ZERO
      *
     C                     Z-ADD*ZEROS    S1BRIS
      *
     C           EUDINT    IFNE *BLANK
     C           EUDIST    ORNE *BLANK
      *
     C                     MOVE EUDINT    TYPE
     C                     MOVE EUDIST    SBTYPE
     C                     MOVE EUECCY    CURR
     C                     MOVE 'D'       D
     C           KEY       CHAINREINT                70
     C           *IN70     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD11        DBASE
     C                     MOVEL'REINT   'DBFILE
     C                     MOVELKEY       DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE BRT       WWRIB   2                       133674
     C                     MOVE EUECCY    WWCCY   3                       133674
      *                                                                   138334
      ***  Only validate the base rate code if one exists.  Note that     138334
      ***  the field BRT is actually Base Rate Code and not Type.         138334
      *                                                                   138334
     C********** BRT       IFNE *ZEROS                                                 138334 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *                                                                   138334
      ** Get Base Rate Codes                                              133674
     C                     CALL 'AOBSRTR0'                                133674
     C                     PARM '*MSG   ' @RTCD                           133674
     C                     PARM '*KEY   ' @OPTN                           133674
     C                     PARM WWCCY     @CYCD   3                       133674
     C                     PARM WWRIB     @BSRC   2                       133674
     C********** SDBSRT    PARM SDBSRT    DSFDY                     133674CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C           @RTCD     IFNE *BLANKS                                   133674
     C           *LOCK     IN   LDA                                       133674
     C                     Z-ADD16        DBASE                           133674
     C                     MOVEL'SDBSRTPD'DBFILE                          133674
     C                     MOVELWWRIB     DBKEY                           133674
     C                     OUT  LDA                                       133674
     C                     EXSR *PSSR                                     133674
     C                     ENDIF                                          133674
      *                                                                   133674
      *                                                                   138334
     C                     ENDIF                                          138334
      *                                                                   138334
     C                     Z-ADDBRT       S1BRIS
      *
     C                     ENDIF
      *
     C********** WWTRNO    CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD12        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S1CNUM
     C                     MOVE EUECCY    S1CCY
     C                     MOVE EUEACD    S1ACOD
     C                     MOVE EUESQN    S1ACSQ
     C                     MOVE '1'       S1ONE
     C                     MOVE 'X'       S1X
     C                     MOVE EUEACN    S1ACNO
     C                     Z-ADDBJRDNB    S1RUND
     C                     Z-ADDEUDACO    S1WOLD
     C                     MOVEL'9010 RAT'S1NARR
     C                     MOVE 'E CHANGE'S1NARR
     C                     MOVE EUDINT    S1INTT
     C                     MOVE EUDIST    S1INTS
     C                     MOVE '0'       S1DRCR
      *
     C**********           Z-ADD*ZERO     S1AODR                          184617
     C                     Z-ADDWAODR     S1AODR                          184617
      *
     C                     TIME           S1TIME
     C**********           MOVE 'GE/RC'   S1RECO                                              208336
     C                     MOVEL'GE/RC'   S1RECO                                              208336
     C                     EXSR W#TIME                                                      MD034366
     C                     MOVELEUEBRC    S1SPTA
     C                     MOVE 'R'       S1ATYP
     C                     Z-ADD*ZEROS    S1RVLD
     C                     MOVE BITOFF    S1BITF
     C                     Z-ADDEUDACO    S1OLDR
     C***********          Z-ADD*ZEROS    S1INRT                     150164
     C***********          Z-ADDEUDRTS    S1INRT                   150164 154034
     C                     Z-ADD*ZEROS    S1INRT                          154034
     C                     Z-ADD*ZEROS    S1WRIS
     C**********           Z-ADDBJRDNB    S1WRUN                                              208336
     C**********           Z-ADDWWTRNO    S1TRNO                                              208336
     C**********           Z-ADDWWNATN    S1NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S1RECI                                              208336
     C**********           MOVE ST1RAT    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
     C**********           ADD  1         WWTRNO                                              208336
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD13        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S2CNUM
     C                     MOVE EUECCY    S2CCY
     C                     MOVE EUEACD    S2ACOD
     C                     MOVE EUESQN    S2ACSQ
     C                     MOVE '2'       S2TWO
     C                     MOVE 'X'       S2X
     C                     Z-ADDINTH      S2INTH
     C                     Z-ADDEUDACO    S2WOLD
     C                     MOVE '0'       S2DRCR
     C**********           TIME           S2TIME                                              208336
     C                     MOVE S1TIME    S2TIME                                              208336
     C                     MOVELS1TSTM    S2TSTM                                            MD034366
     C                     MOVE EUEBRC    S2SPTA
     C                     MOVELBAL2      BAL1
     C                     MOVELBAL1      @BAL1                                               208336
     C                     MOVELRAT2      RAT1
     C                     MOVELRAT1      @RAT1                                               208336
     C**********           Z-ADDWWTRNO    S2TRNO                                              208336
     C**********           Z-ADDWWNATN    S2NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S2RECI                                              208336
      *
      * INITIAL THRESHOLD, BALANCE AND RATE SPREAD SET TO ZERO IN
      * STRAN RATE 2 IF DEBIT INTEREST TYPE IS BLANK
      *
     C           EUDINT    IFEQ *BLANK
     C                     Z-ADD0         S2INTH
     C                     MOVELBAL0      BAL1
     C                     MOVELRAT0      RAT1
     C                     ENDIF
      *
      * ADD NEW BASE RATE WITH RATE SPREAD IN STRAN RATE 2 IF DEBIT
      * INTEREST TYPE IS EQUAL TO 2
      *
     C***********EUDINT    IFGT '00'                                      133674
     C********** BRT       IFGT 0                                                      133674 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *
      *
      ** USE NEW DEBIT BASE RATE
     C           BANBRT    ADD  RAT1A     RAT1A
      *
      * Must now use balance not rate to determine when the end of the
      * tiers/threshs has been reached and so omit the base rate.
      *
     C           BAL1B     IFNE 0
     C           BANBRT    ADD  RAT1B     RAT1B
     C                     ENDIF
      *
     C           BAL1C     IFNE 0
     C           BANBRT    ADD  RAT1C     RAT1C
     C                     ENDIF
      *
     C           BAL1D     IFNE 0
     C           BANBRT    ADD  RAT1D     RAT1D
     C                     ENDIF
      *
     C           BAL1E     IFNE 0
     C           BANBRT    ADD  RAT1E     RAT1E
     C                     ENDIF
      *
     C           BAL1F     IFNE 0
     C           BANBRT    ADD  RAT1F     RAT1F
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
     C**********           MOVE ST2RAT    ZZ199                                               208336
     C                     MOVE @RAT1     RAT1                                                208336
     C                     MOVE @BAL1     BAL1                                                208336
      *
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH2D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
     C**********           ADD  1         WWTRNO                                              208336
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ '1'                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD14        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S3CNUM
     C                     MOVE EUECCY    S3CCY
     C                     MOVE EUEACD    S3ACOD
     C                     MOVE EUESQN    S3ACSQ
     C                     MOVE '3'       S3THRE
     C                     Z-ADDEUDACO    S3WOLD
     C                     MOVE '0'       S3DRCR
     C**********           TIME           S3TIME                                              208336
     C                     MOVE S1TIME    S3TIME                                              208336
     C                     MOVELS1TSTM    S3TSTM                                            MD034366
     C                     MOVE EUEBRC    S3SPTA
     C                     MOVE BAL2      BAL3
     C                     MOVE BAL3      @BAL3                                               208336
     C                     MOVE RAT2      RAT3
     C                     MOVE RAT3      @RAT3                                               208336
     C**********           Z-ADDWWTRNO    S3TRNO                                              208336
     C**********           Z-ADDWWNATN    S3NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S3RECI                                              208336
      *
      * INITIAL THRESHOLD, BALANCE AND RATE SPREAD SET TO ZERO IN
      * STRAN RATE 3 IF DEBIT INTEREST TYPE IS BLANK
      *
     C           EUDINT    IFEQ *BLANK
     C                     MOVELBAL0      BAL3
     C                     MOVELRAT0      RAT3
     C                     ENDIF
      *
      * ADD NEW BASE RATE WITH RATE SPREAD IN STRAN RATE 2 IF DEBIT
      * INTEREST TYPE IS NOT 0
      *
     C***********EUDINT    IFGT '00'                                      133674
     C********** BRT       IFGT 0                                                      133674 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *
     C           BAL3A     IFNE 0
     C           BANBRT    ADD  RAT3A     RAT3A
     C                     ENDIF
      *
      * Must now use balance not rate to determine when the end of the
      * tiers/threshs has been reached and so omit the base rate.
      *
     C           BAL3B     IFNE 0
     C           BANBRT    ADD  RAT3B     RAT3B
     C                     ENDIF
      *
     C           BAL3C     IFNE 0
     C           BANBRT    ADD  RAT3C     RAT3C
     C                     ENDIF
      *
     C           BAL3D     IFNE 0
     C           BANBRT    ADD  RAT3D     RAT3D
     C                     ENDIF
      *
     C           BAL3E     IFNE 0
     C           BANBRT    ADD  RAT3E     RAT3E
     C                     ENDIF
      *
     C                     ENDIF
      *
     C**********           MOVE ST3RAT    ZZ199                                               208336
     C                     MOVE @BAL3     BAL3                                                208336
     C                     MOVE @RAT3     RAT3                                                208336
      *
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH3D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
      *
     C                     ENDIF
      *
     C                     ELSE
      *
      * Flat rate used (ie. rate/spread and/or base rate entered).        154034
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      WWNATN
     C********** 1         CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD15        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVEL'1     '  DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      **********                                                                              208336
      ***UPDATE*HEADER*OF*STRAN*                                                              208336
      **********                                                                              208336
     C**********           MOVE ZZ199     STHEAD                                              208336
     C**********           Z-ADDTRNO      WWTRNO                                              208336
     C**********           ADD  1         TRNO                                                208336
     C**********           Z-ADDWWNATN    SATN                                                208336
     C**********           ADD  1         NORC                                                208336
     C**********           MOVE STHEAD    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
      *
      ** ACCESS BASE RATE TYPE
      *
     C           EUDBRT    IFNE *BLANKS
      *
     C                     MOVE EUDBRT    WWRIB
     C                     MOVE EUECCY    WWCCY
      *
      ** Get Base Rate Codes
      *
     C                     CALL 'AOBSRTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM WWCCY     @CYCD
     C                     PARM WWRIB     @BSRC
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD16        DBASE
     C                     MOVEL'SDBSRTPD'DBFILE
     C                     MOVELWWRIB     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD17        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S1CNUM
     C                     MOVE EUECCY    S1CCY
     C                     MOVE EUEACD    S1ACOD
     C                     MOVE EUESQN    S1ACSQ
     C                     MOVE '1'       S1ONE
     C                     MOVE *BLANKS   S1X
     C                     MOVE EUEACN    S1ACNO
     C                     Z-ADDBJRDNB    S1RUND
     C                     Z-ADDEUDACO    S1WOLD
     C**********           MOVEL'9010 RAT'S1NARR                                              208336
     C                     Z-ADD9010      S1TRAT                                              208336
     C**********           MOVE 'E CHANGE'S1NARR                                              208336
     C                     MOVE 'RATE'    W1NARR  4                                           208336
     C                     MOVE 'CHANGE'  W2NARR  6                                           208336
     C           W1NARR    CAT  W2NARR:1  S1NARR                                              208336
     C                     Z-ADD*ZERO     S1INTT
     C                     Z-ADD*ZERO     S1INTS
     C                     MOVE '0'       S1DRCR
     C**********           Z-ADD*ZERO     S1AODR                          184617
     C                     Z-ADDWAODR     S1AODR                          184617
      *
     C                     TIME           S1TIME
     C**********           MOVE 'GE/RC'   S1RECO                                              208336
     C                     MOVEL'GE/RC'   S1RECO                                              208336
     C                     EXSR W#TIME                                                      MD034366
     C                     MOVELEUEBRC    S1SPTA
     C                     MOVE 'R'       S1ATYP
     C                     Z-ADD*ZEROS    S1RVLD
     C                     MOVE BITOFF    S1BITF
     C                     Z-ADDEUDACO    S1OLDR
     C**********           Z-ADDBJRDNB    S1WRUN                                              208336
     C**********           Z-ADDWWTRNO    S1TRNO                                              208336
     C**********           Z-ADDWWNATN    S1NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S1RECI                                              208336
      *                                                                   154034
     C**********           Z-ADD*ZERO     S1WRIS                          154034
     C**********           Z-ADD*ZERO     S1INRT                          154034
     C           EUDRSS    IFNE '-'                                       154034
     C                     Z-ADDEUDRTS    S1WRIS                          154034
     C                     Z-ADDEUDRTS    S1INRT                          154034
     C                     ELSE                                           154034
     C                     Z-SUBEUDRTS    S1WRIS                          154034
     C                     Z-SUBEUDRTS    S1INRT                          154034
     C                     ENDIF                                          154034
      *                                                                   154034
     C           EUDBRT    IFEQ *BLANKS
     C                     Z-ADD*ZEROS    S1BRIS
     C                     ELSE
     C                     MOVE EUDBRT    S1BRIS
     C                     ADD  BANBRT    S1INRT
     C                     ENDIF
      *
      *
     C**********           MOVE ST1RAT    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH1D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
     C                     ENDIF
      *
      *
      *
      ** CREDIT RATE CHANGE
      *
      *
      * OUTPUT ONLY IF NO FLAT RATE
     C           EUCBRT    IFEQ *BLANK
     C           EUCRTS    ANDEQ*ZERO
     C           EUCRSS    ANDEQ*BLANK
      *
     C           EUCINT    IFNE *BLANK                                    133674
     C           EUCIST    ANDNE*BLANK                                    133674
      *                                                                   133674
     C***********          MOVE EUCINT    WWRIB   2                       133674
     C***********          MOVE EUECCY    WWCCY   3                       133674
      ***********                                                         133674
      ***Get*Base*Rate*Codes**************                                133674
     C***********          CALL 'AOBSRTR0'                                133674
     C***********          PARM '*MSG   ' @RTCD                           133674
     C***********          PARM '*KEY   ' @OPTN                           133674
     C***********          PARM WWCCY     @CYCD   3                       133674
     C***********          PARM WWRIB     @BSRC   2                       133674
     C***********SDBSRT    PARM SDBSRT    DSFDY                           133674
     C***********@RTCD     IFNE *BLANKS                                   133674
     C************LOCK     IN   LDA                                       133674
     C***********          Z-ADD30        DBASE                           133674
     C***********          MOVEL'SDBSRTPD'DBFILE                          133674
     C***********          MOVELWWRIB     DBKEY                           133674
     C***********          OUT  LDA                                       133674
     C***********          EXSR *PSSR                                     133674
     C***********          ENDIF                                          133674
      *
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      WWNATN  50
     C********** 1         CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ '1'                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD31        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVEL'1     '  DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      **********                                                                              208336
      ***UPDATE*HEADER*OF*STRAN*                                                              208336
      **********                                                                              208336
     C**********           MOVE ZZ199     STHEAD                                              208336
     C**********           Z-ADDTRNO      WWTRNO  50                                          208336
     C**********           ADD  3         TRNO                                                208336
     C**********           Z-ADDWWNATN    SATN                                                208336
     C**********           ADD  1         NORC                                                208336
     C**********           MOVE STHEAD    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
      *
      ** ACCESS INTEREST TYPE/SUB TYPE ONLY IF NOT ZERO
      *
     C                     Z-ADD*ZEROS    S1BRIS
      *
     C           EUCINT    IFNE *BLANK
     C           EUCIST    ORNE *BLANK
      *
     C                     MOVE EUCINT    TYPE
     C                     MOVE EUCIST    SBTYPE
     C                     MOVE EUECCY    CURR
     C                     MOVE 'D'       D
     C           KEY       CHAINREINT                70
     C           *IN70     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD32        DBASE
     C                     MOVEL'REINT   'DBFILE
     C                     MOVELKEY       DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE BRT       WWRIB   2                       133674
     C                     MOVE EUECCY    WWCCY   3                       133674
      *                                                                   138334
      ***  Only validate the base rate code if one exists.  Note that     138334
      ***  the field BRT is actually Base Rate Code and not Type.         138334
      *                                                                   138334
     C********** BRT       IFNE *ZEROS                                                 138334 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *                                                                   133674
      ** Get Base Rate Codes                                              133674
     C                     CALL 'AOBSRTR0'                                133674
     C                     PARM '*MSG   ' @RTCD                           133674
     C                     PARM '*KEY   ' @OPTN                           133674
     C                     PARM WWCCY     @CYCD   3                       133674
     C                     PARM WWRIB     @BSRC   2                       133674
     C********** SDBSRT    PARM SDBSRT    DSFDY                     133674CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                           CSD006
     C           @RTCD     IFNE *BLANKS                                   133674
     C           *LOCK     IN   LDA                                       133674
     C                     Z-ADD30        DBASE                           133674
     C                     MOVEL'SDBSRTPD'DBFILE                          133674
     C                     MOVELWWRIB     DBKEY                           133674
     C                     OUT  LDA                                       133674
     C                     EXSR *PSSR                                     133674
     C                     ENDIF                                          133674
      *                                                                   133674
      *                                                                   138334
     C                     ENDIF                                          138334
      *                                                                   138334
     C                     Z-ADDBRT       S1BRIS
      *
     C                     ENDIF
      *
     C********** WWTRNO    CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD33        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S1CNUM
     C                     MOVE EUECCY    S1CCY
     C                     MOVE EUEACD    S1ACOD
     C                     MOVE EUESQN    S1ACSQ
     C                     MOVE '1'       S1ONE
     C                     MOVE 'X'       S1X
     C                     MOVE EUEACN    S1ACNO
     C                     Z-ADDBJRDNB    S1RUND
     C                     Z-ADDEUDACO    S1WOLD
     C**********           MOVEL'9010 RAT'S1NARR                                              208336
     C                     Z-ADD9010      S1TRAT                                              208336
     C**********           MOVE 'E CHANGE'S1NARR                                              208336
     C                     MOVE 'RATE'    W1NARR  4                                           208336
     C                     MOVE 'CHANGE'  W2NARR  6                                           208336
     C           W1NARR    CAT  W2NARR:1  S1NARR                                              208336
     C                     MOVE EUCINT    S1INTT
     C                     MOVE EUCIST    S1INTS
     C                     MOVE '1'       S1DRCR
      *
     C                     Z-ADD*ZERO     S1AODR
      *
     C                     TIME           S1TIME
     C**********           MOVE 'GE/RC'   S1RECO                                              208336
     C                     MOVEL'GE/RC'   S1RECO                                              208336
     C                     EXSR W#TIME                                                      MD034366
     C                     MOVELEUEBRC    S1SPTA
     C                     MOVE 'R'       S1ATYP
     C                     Z-ADD*ZEROS    S1RVLD
     C                     MOVE BITOFF    S1BITF
     C                     Z-ADDEUDACO    S1OLDR
     C***********          Z-ADD*ZEROS    S1INRT                     150164
     C***********          Z-ADDEUCRTS    S1INRT                   150164 154034
     C                     Z-ADD*ZEROS    S1INRT                          154034
     C                     Z-ADD*ZEROS    S1WRIS
     C**********           Z-ADDBJRDNB    S1WRUN                                              208336
     C**********           Z-ADDWWTRNO    S1TRNO                                              208336
     C**********           Z-ADDWWNATN    S1NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S1RECI                                              208336
     C**********           MOVE ST1RAT    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH1D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
     C**********           ADD  1         WWTRNO                                              208336
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD34        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S2CNUM
     C                     MOVE EUECCY    S2CCY
     C                     MOVE EUEACD    S2ACOD
     C                     MOVE EUESQN    S2ACSQ
     C                     MOVE '2'       S2TWO
     C                     MOVE 'X'       S2X
     C                     Z-ADDINTH      S2INTH
     C                     Z-ADDEUDACO    S2WOLD
     C**********           MOVE '0'       S2DRCR                          153810
     C                     MOVE '1'       S2DRCR                          153810
     C**********           TIME           S2TIME                                              208336
     C                     MOVE S1TIME    S2TIME                                              208336
     C                     MOVELS1TSTM    S2TSTM                                            MD034366
     C                     MOVE EUEBRC    S2SPTA
     C                     MOVELBAL2      BAL1
     C                     MOVELBAL1      @BAL1                                               208336
     C                     MOVELRAT2      RAT1
     C                     MOVELRAT1      @RAT1                                               208336
     C**********           Z-ADDWWTRNO    S2TRNO                                              208336
     C**********           Z-ADDWWNATN    S2NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S2RECI                                              208336
      *
      * INITIAL THRESHOLD, BALANCE AND RATE SPREAD SET TO ZERO IN
      * STRAN RATE 2 IF CREDIT INTEREST TYPE IS BLANK
      *
     C           EUCINT    IFEQ *BLANK
     C                     Z-ADD0         S2INTH
     C                     MOVELBAL0      BAL1
     C                     MOVELRAT0      RAT1
     C                     ENDIF
      *
      * ADD NEW BASE RATE WITH RATE SPREAD IN STRAN RATE 2 IF CREDIT
      * INTEREST TYPE IS EQUAL TO 2
      *
     C***********EUCINT    IFGT '00'                                      133674
     C********** BRT       IFGT 0                                                      133674 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *
      *
      ** USE NEW DEBIT BASE RATE
     C           BANBRT    ADD  RAT1A     RAT1A
      *
      * Must now use balance not rate to determine when the end of the
      * tiers/threshs has been reached and so omit the base rate.
      *
     C           BAL1B     IFNE 0
     C           BANBRT    ADD  RAT1B     RAT1B
     C                     ENDIF
      *
     C           BAL1C     IFNE 0
     C           BANBRT    ADD  RAT1C     RAT1C
     C                     ENDIF
      *
     C           BAL1D     IFNE 0
     C           BANBRT    ADD  RAT1D     RAT1D
     C                     ENDIF
      *
     C           BAL1E     IFNE 0
     C           BANBRT    ADD  RAT1E     RAT1E
     C                     ENDIF
      *
     C           BAL1F     IFNE 0
     C           BANBRT    ADD  RAT1F     RAT1F
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
     C**********           MOVE ST2RAT    ZZ199                                               208336
     C                     MOVEL@BAL1     BAL1                                                208336
     C                     MOVEL@RAT1     RAT1                                                208336
      *
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH2D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
     C**********           ADD  1         WWTRNO                                              208336
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ '1'                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD35        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S3CNUM
     C                     MOVE EUECCY    S3CCY
     C                     MOVE EUEACD    S3ACOD
     C                     MOVE EUESQN    S3ACSQ
     C                     MOVE '3'       S3THRE
     C                     Z-ADDEUDACO    S3WOLD
     C**********           MOVE '0'       S3DRCR                          153810
     C                     MOVE '1'       S3DRCR                          153810
     C**********           TIME           S3TIME                                              208336
     C                     MOVE S1TIME    S3TIME                                              208336
     C                     MOVELS1TSTM    S3TSTM                                            MD034366
     C                     MOVE EUEBRC    S3SPTA
     C                     MOVE BAL2      BAL3
     C                     MOVE BAL3      @BAL3                                               208336
     C                     MOVE RAT2      RAT3
     C                     MOVE RAT2      @RAT3                                               208336
     C**********           Z-ADDWWTRNO    S3TRNO                                              208336
     C**********           Z-ADDWWNATN    S3NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S3RECI                                              208336
      *
      * INITIAL THRESHOLD, BALANCE AND RATE SPREAD SET TO ZERO IN
      * STRAN RATE 3 IF DEBIT INTEREST TYPE IS BLANK
      *
     C           EUCINT    IFEQ *BLANK
     C                     MOVELBAL0      BAL3
     C                     MOVELRAT0      RAT3
     C                     ENDIF
      *
      * ADD NEW BASE RATE WITH RATE SPREAD IN STRAN RATE 2 IF CREDIT
      * INTEREST TYPE IS NOT 0
      *
     C***********EUCINT    IFGT '00'                                      133674
     C********** BRT       IFGT 0                                                      133674 CSD103
     C           BRT       IFNE *BLANKS                                                       CSD103
      *
     C           BAL3A     IFNE 0
     C           BANBRT    ADD  RAT3A     RAT3A
     C                     ENDIF
      *
      * Must now use balance not rate to determine when the end of the
      * tiers/threshs has been reached and so omit the base rate.
      *
     C           BAL3B     IFNE 0
     C           BANBRT    ADD  RAT3B     RAT3B
     C                     ENDIF
      *
     C           BAL3C     IFNE 0
     C           BANBRT    ADD  RAT3C     RAT3C
     C                     ENDIF
      *
     C           BAL3D     IFNE 0
     C           BANBRT    ADD  RAT3D     RAT3D
     C                     ENDIF
      *
     C           BAL3E     IFNE 0
     C           BANBRT    ADD  RAT3E     RAT3E
     C                     ENDIF
      *
     C                     ENDIF
      *
     C**********           MOVE ST3RAT    ZZ199                                               208336
     C                     MOVE @BAL3     BAL3                                                208336
     C                     MOVE @RAT3     RAT3                                                208336
      *
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH3D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
      *
     C                     ENDIF
      *
     C                     ELSE
      *
      * Flat rate used (ie. rate/spread and/or base rate entered).        154034
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      WWNATN
     C********** 1         CHAINSTRAN                70                                       208336
      *
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD35        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVEL'1     '  DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      **********                                                                              208336
      ***UPDATE*HEADER*OF*STRAN*                                                              208336
      **********                                                                              208336
     C**********           MOVE ZZ199     STHEAD                                              208336
     C**********           Z-ADDTRNO      WWTRNO                                              208336
     C**********           ADD  1         TRNO                                                208336
     C**********           Z-ADDWWNATN    SATN                                                208336
     C**********           ADD  1         NORC                                                208336
     C**********           MOVE STHEAD    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
      *
      ** ACCESS BASE RATE TYPE
      *
     C           EUCBRT    IFNE *BLANKS
      *
     C                     MOVE EUCBRT    WWRIB
     C                     MOVE EUECCY    WWCCY
      *
      ** Get Base Rate Codes
      *
     C                     CALL 'AOBSRTR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM WWCCY     @CYCD
     C                     PARM WWRIB     @BSRC
     C********** SDBSRT    PARM SDBSRT    DSFDY                                 CSD006
     C           SDBSRT    PARM SDBSRT    DSSDY                                 CSD006
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD36        DBASE
     C                     MOVEL'SDBSRTPD'DBFILE
     C                     MOVELWWRIB     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
     C********** WWTRNO    CHAINSTRAN                70                                       208336
     C********** *IN70     IFEQ *ON                                                           208336
     C********** *LOCK     IN   LDA                                                           208336
     C**********           Z-ADD37        DBASE                                               208336
     C**********           MOVEL'STRAN   'DBFILE                                              208336
     C**********           MOVELWWTRNO    DBKEY                                               208336
     C**********           OUT  LDA                                                           208336
     C**********           EXSR *PSSR                                                         208336
     C**********           ENDIF                                                              208336
      *
     C                     MOVE EUECNM    S1CNUM
     C                     MOVE EUECCY    S1CCY
     C                     MOVE EUEACD    S1ACOD
     C                     MOVE EUESQN    S1ACSQ
     C                     MOVE '1'       S1ONE
     C                     MOVE *BLANKS   S1X
     C                     MOVE EUEACN    S1ACNO
     C                     Z-ADDBJRDNB    S1RUND
     C                     Z-ADDEUDACO    S1WOLD
     C**********           MOVEL'9010 RAT'S1NARR                                              208336
     C                     Z-ADD9010      S1TRAT                                              208336
     C**********           MOVE 'E CHANGE'S1NARR                                              208336
     C                     MOVE 'RATE'    W1NARR  4                                           208336
     C                     MOVE 'CHANGE'  W2NARR  6                                           208336
     C           W1NARR    CAT  W2NARR:1  S1NARR                                              208336
     C                     Z-ADD*ZERO     S1INTT
     C                     Z-ADD*ZERO     S1INTS
     C                     MOVE '1'       S1DRCR
     C                     Z-ADD*ZERO     S1AODR
      *
     C                     TIME           S1TIME
     C**********           MOVE 'GE/RC'   S1RECO                                              208336
     C                     MOVEL'GE/RC'   S1RECO                                              208336
     C                     EXSR W#TIME                                                      MD034366
     C                     MOVELEUEBRC    S1SPTA
     C                     MOVE 'R'       S1ATYP
     C                     Z-ADD*ZEROS    S1RVLD
     C                     MOVE BITOFF    S1BITF
     C                     Z-ADDEUDACO    S1OLDR
     C**********           Z-ADDBJRDNB    S1WRUN                                              208336
     C**********           Z-ADDWWTRNO    S1TRNO                                              208336
     C**********           Z-ADDWWNATN    S1NATN                                              208336
     C**********           MOVE 'R'       RECI                                                208336
     C                     MOVE 'R'       S1RECI                                              208336
      *                                                                   154034
     C**********           Z-ADD*ZERO     S1WRIS                          154034
     C**********           Z-ADD*ZERO     S1INRT                          154034
     C           EUCRSS    IFNE '-'                                       154034
     C                     Z-ADDEUCRTS    S1WRIS                          154034
     C                     Z-ADDEUCRTS    S1INRT                          154034
     C                     ELSE                                           154034
     C                     Z-SUBEUCRTS    S1WRIS                          154034
     C                     Z-SUBEUCRTS    S1INRT                          154034
     C                     ENDIF                                          154034
      *                                                                   154034
     C           EUCBRT    IFEQ *BLANKS
     C                     Z-ADD*ZEROS    S1BRIS
     C                     ELSE
     C                     MOVE EUCBRT    S1BRIS
     C                     ADD  BANBRT    S1INRT
     C                     ENDIF
      *
      *
     C**********           MOVE ST1RAT    ZZ199                                               208336
     C**********           UPDATSTRANF                                                        208336
     C                     WRITERERCH1D0                                                      208336
      *
      ** Add 1 to header record field                                                         208336
      *                                                                                       208336
     C                     ADD  1         WNORS                                               208336
      *                                                                                       208336
     C                     ENDIF
     C/COPY WNCPYSRC,EU0140C033
      *
      ** Read header record before update                                                     208336
      *                                                                                       208336
     C           1         SETLLRERCHHA0                                                      208336
     C                     READ RERCHHA0                 70                                   208336
     C           *IN70     IFEQ '1'                                                           208336
     C           *LOCK     IN   LDA                                                           208336
     C                     Z-ADD26        DBASE                                               208336
     C                     MOVEL'RERCHHPA'DBFILE                                              208336
     C                     MOVEL'      '  DBKEY                                               208336
     C                     OUT  LDA                                                           208336
     C                     EXSR *PSSR                                                         208336
     C                     ENDIF                                                              208336
      *                                                                                       208336
      ** Update header record in Header file                                                  208336
      *                                                                                       208336
     C           WNORS     ADD  NOREC     NOREC                                               208336
     C                     UPDATRERCHHA0                                                      208336
      *                                                                                       208336
     C                     ENDSR
      *
      *****************************************************************   CEU025
      *                                                               *   CEU025
      *            PRCIEU - Process update for PF/RECIEUPD            *   CEU025
      *                                                               *   CEU025
      * CALLS             -                                           *   CEU025
      *                                                               *   CEU025
      * CALLED BY         - Main Processing                           *   CEU025
      *                                                               *   CEU025
      * FLDS USED         -                                           *   CEU025
      *                                                               *   CEU025
      *****************************************************************   CEU025
      *                                                                   CEU025
     C           PRCIEU    BEGSR                                          CEU025
      *                                                                   CEU025
     C           CEU025    IFEQ 'Y'                                       CEU025
     C           CRE008    OREQ 'Y'                                       CRE008
     C                     Z-ADDEUMAPN    RWMAPN                          CEU025
     C                     MOVELEUIBRC    RWIBRC                          CEU025
     C**********           Z-ADDEUICNM    RWICNM                                       CEU025 CSD027
     C                     MOVE EUICNM    RWICNM                                              CSD027
     C                     MOVELEUICCY    RWICCY                          CEU025
     C                     Z-ADDEUIACD    RWIACD                          CEU025
     C                     Z-ADDEUISQN    RWISQN                          CEU025
     C                     Z-ADDEUIACN    RWIACN                          CEU025
     C                     MOVELEUEBRC    RWEBRC                          CEU025
     C**********           Z-ADDEUECNM    RWECNM                                       CEU025 CSD027
     C                     MOVE EUECNM    RWECNM                                              CSD027
     C                     MOVELEUECCY    RWECCY                          CEU025
     C                     Z-ADDEUEACD    RWEACD                          CEU025
     C                     Z-ADDEUESQN    RWESQN                          CEU025
     C                     Z-ADDEUEACN    RWEACN                          CEU025
      *                                                                   CEU025
     C                     WRITERECIEUD0                                  CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
     C                     ENDSR                                          CEU025
      *
      ******************************************************************
      * INITIAL SUBROUTINE
      ******************************************************************
     C           INITPR    BEGSR
      *
      **  Define the LDA for error handling
     C           *NAMVAR   DEFN           LDA
      *
     C                     MOVEACPY@      MKI@   80
      *
     C                     MOVE P#MAPN    W#MAPN  60
      *
      **  Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      **  Check system date format, DDMMYY(98 off) or MMDDYY(98 on)
     C           BJDFIN    IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     ENDIF
      *                                                                   CPB001
      **  Access Module details                                           CPB001
     C                     CALL 'AOMMODR0'                                CPB001
     C                     PARM '*DBERR ' @RTCD   7                       CPB001
     C                     PARM '*FIRST ' @OPTN   7                       CPB001
     C           SDMMOD    PARM SDMMOD    DSFDY                           CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BGPFMG    OREQ 'Y'                                       CPB001
     C                     OPEN PMPORTLL                                  CPB001
     C                     ENDIF                                          CPB001
      *
      ** Access general ledger details
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      **  Access Switchable SAR details for the existence of CRT101
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CRT101'  @SARD   6
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CRT101  1
     C                     ELSE
     C                     MOVE 'N'       CRT101
     C                     ENDIF
      *
      **  Access Switchable SAR details for the existence of CRT001
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANK    @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CRT001'  @SARD   6
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CRT001  1
     C                     ELSE
     C                     MOVE 'N'       CRT001
     C                     ENDIF
      *                                                                   157543
      * Check if CRE001 is on (Overdraft Interest Calculations)           157543
     C                     CALL 'AOSARDR0'                                157543
     C                     PARM *BLANK    @RTCD                           157543
     C                     PARM '*VERIFY' @OPTN                           157543
     C                     PARM 'CRE001'  @SARD                           157543
     C           @RTCD     IFEQ *BLANKS                                   157543
     C                     MOVE 'Y'       CRE001  1                       157543
     C                     ELSE                                           157543
     C                     MOVE 'N'       CRE001                          157543
     C                     ENDIF                                          157543
      *
     C           W#MAPN    CHAINEUMDHDL0             70
      *
      **
     C**********           MOVE EUACOD    @ACOD   4                                           CGL029
     C                     MOVE EUACOD    @ACOD  10                                           CGL029
     C                     CALL 'AOACODR0'
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           @ACOD
     C********** SDACOD    PARM SDACOD    DSFDY                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *
     C                     BITOF'01234567'BITOFF  1
      *                                                                   CEU025
      **  Check if CEU025 is On.                                          CEU025
     C/COPY WNCPYSRC,EU0140C004
     C                     CALL 'AOSARDR0'                                CEU025
     C                     PARM *BLANK    @RTCD                           CEU025
     C                     PARM '*VERIFY' @OPTN                           CEU025
     C                     PARM 'CEU025'  @SARD                           CEU025
     C           SCSARD    PARM SCSARD    DSFDY                           CEU025
      *                                                                   CEU025
     C           @RTCD     IFEQ *BLANKS                                   CEU025
     C                     MOVE 'Y'       CEU025  1                       CEU025
     C                     OPEN RECIEUPD                                  CEU025
     C                     ELSE                                           CEU025
     C                     MOVE 'N'       CEU025                          CEU025
     C                     ENDIF                                          CEU025
      *                                                                   217910
      **  Check if CRE008 is On.                                          217910
     C                     CALL 'AOSARDR0'                                217910
     C                     PARM *BLANK    @RTCD                           217910
     C                     PARM '*VERIFY' @OPTN                           217910
     C                     PARM 'CRE008'  @SARD                           217910
     C           SCSARD    PARM SCSARD    DSFDY                           217910
      *                                                                   217910
     C           @RTCD     IFEQ *BLANKS                                   217910
     C                     MOVE 'Y'       CRE008  1                       217910
     C           CEU025    IFNE 'Y'                                       217910
     C                     OPEN RECIEUPD                                  217910
     C                     ENDIF                                          217910
     C                     ELSE                                           217910
     C                     MOVE 'N'       CRE008                          217910
     C                     ENDIF                                          217910
      *                                                                   157543
      * Get Euro decimal places                                           157543
     C                     CALL 'AOCURRR0'                                157543
     C                     PARM *BLANKS   @RTCD                           157543
     C                     PARM '*KEY   ' @OPTN                           157543
     C                     PARM BKEURO    @CURR   3                       157543
     C           SDCURR    PARM SDCURR    DSSDY                           157543
      *                                                                   157543
     C           @RTCD     IFNE *BLANKS                                   157543
     C           *LOCK     IN   LDA                                       157543
     C                     Z-ADD20        DBASE                           157543
     C                     MOVEL'SDCURRPD'DBFILE                          157543
     C                     MOVELBKEURO    DBKEY                           157543
     C                     OUT  LDA                                       157543
     C                     EXSR *PSSR                                     157543
     C                     ELSE                                           157543
     C                     Z-ADDA6NBDP    @EURDP  10                      157543
     C                     ENDIF                                          157543
      *                                                                                       208336
      ** Dummy reads to allow files to be specified as UPDATE in F-spec                       208336
      *                                                                                       208336
     C                     MOVE '0'       *IN02                                               208336
     C           *IN02     IFEQ '1'                                                           208336
     C                     READ RERCH1PD                 70                                   208336
     C                     READ RERCH2PD                 70                                   208336
     C                     READ RERCH3PD                 70                                   208336
     C                     ENDIF                                                              208336
      *
     C/COPY WNCPYSRC,EU0140C048
      *                                                                                       CER001
      ** Check switchable feature ULX004 if initialised                                       CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM '       ' @RTCD                                               CER001
     C                     PARM '*VERIFY' @OPTN                                               CER001
     C                     PARM 'ULX004'  @SARD                                               CER001
     C           @RTCD     IFEQ *BLANK                     B1                                 CER001
     C                     MOVE 'Y'       ULX004  1                                           CER001
     C                     OPEN REACX1PD                                                      CER001
     C                     ELSE                            X1                                 CER001
     C                     MOVE 'N'       ULX004                                              CER001
     C                     ENDIF                           E1                                 CER001
      *                                                                                       CER001
      **  Access Switchable SAR details for the existence of LLN022 (Bank of England)        LLN022A
      *                                                                                      LLN022A
     C                     CALL 'AOSARDR0'                                                   LLN022A
     C                     PARM *BLANK    @RTCD                                              LLN022A
     C                     PARM '*VERIFY' @OPTN                                              LLN022A
     C                     PARM 'LLN022'  @SARD                                              LLN022A
      *                                                                                      LLN022A
     C           @RTCD     IFEQ *BLANKS                                                      LLN022A
     C                     MOVE 'Y'       LLN022  1                                          LLN022A
     C                     ELSE                                                              LLN022A
     C                     MOVE 'N'       LLN022                                             LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDSR
      *
      *=========================================================================
      *                  ** SUBROUTINE  SC1PRC **
      *=================================================================
      *
      *
     C           EXITPR    BEGSR
     C/COPY WNCPYSRC,EU0140C005
      *                                                                   CEU025
      ** If switchable feature ULX004 is ON - CLOSE FILES                                     CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                        B1                                 CER001
     C                     CLOSEREACX1PD                                                      CER001
     C                     ENDIF                           E1                                 CER001
      *                                                                                       CER001
     C           CEU025    IFEQ 'Y'                                       CEU025
     C                     CLOSERECIEUPD                                  CEU025
     C                     ENDIF                                          CEU025
      *                                                                   CEU025
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           BGPFMG    OREQ 'Y'                                       CPB001
     C                     CLOSEPMPORTLL                                  CPB001
     C                     ENDIF                                          CPB001
     C                     MOVE *ON       *INLR
     C                     RETRN
     C                     ENDSR
     C/COPY WNCPYSRC,EU0140C022
      *
      ******************************************************************
      *                                                                                     MD034366
     C           W#TIME    BEGSR                                                            MD034366
      *                                                                                     MD034366
     C                     Z-ADD16        QUSBPR                                            MD034366
     C                     Z-ADD0         QUSBAV                                            MD034366
     C                     MOVE *BLANKS   INFORM 10                                         MD034366
     C                     MOVEL'*CURRENT'INFORM                                            MD034366
     C                     MOVE *BLANKS   INVARI  1                                         MD034366
     C                     MOVE *BLANKS   OUTFOR 10                                         MD034366
     C                     MOVEL'*YYMD'   OUTFOR 10                                         MD034366
      *                                                                                     MD034366
      ** Use the API to get a 17-byte date/time value (down to the                          MD034366
      ** microsecond).                                                                      MD034366
      *                                                                                     MD034366
     C                     CALL 'QWCCVTDT'                                                  MD034366
     C                     PARM           INFORM                                            MD034366
     C                     PARM           INVARI                                            MD034366
     C                     PARM           OUTFOR                                            MD034366
     C                     PARM           OUTDAT                                            MD034366
     C                     PARM           QUSEC                                             MD034366
      *                                                                                     MD034366
      ** The OutDate field returned from the API and TimeStamp fields                       MD034366
      ** returned from this procedure have been broken down by data                         MD034366
      ** structures.  Copy the data from one to the other and exit.                         MD034366
      *                                                                                     MD034366
     C                     MOVE '-'       TMST1                                             MD034366
     C                     MOVE '-'       TMST2                                             MD034366
     C                     MOVE '-'       TMST3                                             MD034366
     C                     MOVE '.'       TMST4                                             MD034366
     C                     MOVE '.'       TMST5                                             MD034366
     C                     MOVE '.'       TMST6                                             MD034366
     C                     MOVE '000'     RETMC                                             MD034366
     C                     MOVELAPIYR     RETYR                                             MD034366
     C                     MOVELAPIMH     RETMH                                             MD034366
     C                     MOVELAPIDY     RETDY                                             MD034366
     C                     MOVELAPIHR     RETHR                                             MD034366
     C                     MOVELAPIMN     RETMN                                             MD034366
     C                     MOVELAPISC     RETSC                                             MD034366
     C                     MOVELAPIML     RETML                                             MD034366
      *                                                                                     MD034366
     C                     MOVELTMSTDS    S1TSTM                                            MD034366
      *                                                                                     MD034366
     C                     ENDSR                                                            MD034366
      *                                                                                     MD034366
      *****************************************************************                     MD034366
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
      *
     C                     MOVE 'Y'       @RUN    1
      *
     C                     DUMP
      *
     C                     ROLBK
      *
     C           W#MAPN    CHAINEUMDHDL0             70
     C                     MOVE 'N'       EUOPIN
     C                     UPDATEUMDHDPF
     C                     COMIT
     C/COPY WNCPYSRC,EU0140C023
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      ********************************************************************
     C/COPY ZSRSRC,ZTNLU1Z2
      *
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
**  CPY@
(c) Finastra International Limited 2001
     X/COPY WNCPYSRC,EU0140X001
