     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas EU Limit currency conversion')
      *****************************************************************
      *                                                               *
      *  Midas - EMU Module                                           *
      *                                                               *
      *  EU0410 - EMU Limit Currency Conversion                       *
      *                                                               *
      *  Function:  This program converts the Limit amounts to their  *
      *  (I/C     ) new Limit Currency equivalent taking in account   *
      *             the Rounding factor.                              *
      *                                                               *
      *                                                               *
      *  Called By: EUC0410 - EMU Limit Currency Conversion Control   *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 197593             Date 14Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 139846             Date 28Aug98               *
      *                 134759             Date 06May98               *
      *                 CEU010  *CREATE    Date 19Feb98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  197593 - Limit currency conversion to EUROs is incorrect.    *
      *           Amounts are already in thousands, so no need to use *
      *           decimal places in conversion.  Do the conversion    *
      *           directly instead of calling program EU0200.         *
      *  139846 - Rollback was issued even if EU0410 files were not   *
      *           under commitment control. Fix is to put the said    *
      *           files under commitment control for recovery during  *
      *           Database error.                                     *
      *  134759 - RECI of 'D' on file SLIMI being overwritten with    *
      *           a value of '*'.                                     *
      *  CEU010 - Limit Currency Conversion                           *
      *                                                               *
      *****************************************************************
     F*SDEXPML1UF**E***********K        DISK                              139846
     FSDEXPML1UF  E           K        DISK         KCOMIT                139846
      * IN  - @BUREE1 EXPOSURE MANAGEMENT DATA (EXMK)
     F*SDDEALL1UF**E***********K        DISK                              139846
     FSDDEALL1UF  E           K        DISK         KCOMIT                139846
      * IN  - @BNREEI Dealing Data Cde(DLDA)
     F*EMLIML2*UF**E************        DISK                              139846
     FEMLIML2 UF  E                    DISK         KCOMIT                139846
     F* IN  - EMLIML2F EM Limits file
     F*SDCLLML1UF**E***********K        DISK                              139846
     FSDCLLML1UF  E           K        DISK         KCOMIT                139846
     F* IN  - @DZREHT Client Limits    (K@CLLM)
     F*SDCNLML1UF**E***********K        DISK                              139846
     FSDCNLML1UF  E           K        DISK         KCOMIT                139846
     F* IN  - @DXREHN Country Limits   (K@CNLM)
     F*SDRGLML1UF**E***********K        DISK                              139846
     FSDRGLML1UF  E           K        DISK         KCOMIT                139846
     F* IN  - @DYREHQ Region Limits    (K@RGLM)
     F*SLIME***UF**E***********K        DISK                              139846
     FSLIME   UF  E           K        DISK         KCOMIT                139846
     F* IN  - SLIMEF SE Country Limits   (K@SECN)
     F*SLIMF***UF**E***********K        DISK                              139846
     FSLIMF   UF  E           K        DISK         KCOMIT                139846
     F* IN  - SLIMFF SE Currency Limits   (K@SECC)
     F*SLIMH***UF**E***********K        DISK                              139846
     FSLIMH   UF  E           K        DISK         KCOMIT                139846
     F* IN  - SLIMHF SE Customer Limits   (K@SECS)
     F*SLIMI***UF**E***********K        DISK                              139846
     FSLIMI   UF  E           K        DISK         KCOMIT                139846
     F* IN  - SLIMIF SE Security Limits   (K@SESC)
     F*SLIMG***UF**E***********K        DISK                              139846
     FSLIMG   UF  E           K        DISK         KCOMIT                139846
     F* IN  - SLIMGF SE Investment Limits   (K@SEIV)
     FSECTY   IF  E           K        DISK
     F* IN  - SECTYDF Security File         (SESN)
     FINVTPC  IF  E           K        DISK
      * IN  - INVTPD SE INVESTMENT TYPES  (K@INVT)
     F*TABTB95*UF**E***********K        DISK                              139846
     FTABTB95 UF  E           K        DISK         KCOMIT                139846
     F* Midas SD Exposure Management ICD Record
     F*TABTB11*UF**E***********K        DISK                              139846
     FTABTB11 UF  E           K        DISK         KCOMIT                139846
     F* Midas Table ICD Record 2
     FEU0410AUO   E                    PRINTER                        UC
     F                                              KINFDS SPOOLU
     FEU0410P1O   E                    PRINTER
     F                                              KINFDS SPOOL1
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   40  - Print control for '0' decimal current amount field    *
      *   41  - Print control for '1' decimal current amount field    *
      *   42  - Print control for '2' decimal current amount field    *
      *   43  - Print control for '3' decimal current amount field    *
      *   44  - Print control for '0' decimal new amount field        *
      *   45  - Print control for '1' decimal new amount field        *
      *   46  - Print control for '2' decimal new amount field        *
      *   47  - Print control for '3' decimal new amount field        *
      *                                                               *
      *   50  - Print control for Exposure Management headings        *
      *   51  - Print control for Dealing and Lending headings        *
      *   52  - Print control for Securities Trading headings         *
      *                                                               *
      *   90  - Data base file error indicator                        *
      *   95  - Data base file Read/Chain indicator                   *
      *   98  - Date Format: DDMMYY (off); MMDDYY (on)                *
      *                                                               *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  INIT   - Program Initialisation                              *
      *  PROCES - Detail Processing                                   *
      *  EXPMNG - Process Exposure Management Report Limits           *
      *  DELLEN - Process Dealing, Lending and Precious Metals Limits *
      *  DTDLCL - Process Dealing Client Limits Detail calculations   *
      *  DTDLCN - Process Dealing Country Limits Detail Calculations  *
      *  DTDLRG - Process Dealing Region  Limits Detail Calculations  *
      *  SECTRD - Process Security Trading Limits                     *
      *  DTSCCN - Process Security Country Limits Detail Calculations *
      *  DTSCCC - Process Security Currency Limits Detail Calculations*
      *  DTSCCS - Process Security Customer Limits Detail Calculations*
      *  DTSCSC - Process Security Security Limits Detail Calculations*
      *  DTSCIV - Process Security Investment Limits Detail           *
      *            Calculations                                       *
      *  VALCUR - Validate Limit Currency                             *
      *  CVTAMT - Convert Limit Amounts from Old to New Limit currency*
      *                                                               *
      *  DETEXP - Process Exposure Management Detail calculations     *
      *  DETDCL - Process Dealing Client Limit Detail calculations    *
      *  DETDCN - Process Dealing Country Limit Detail calculations   *
      *  DETDRG - Process Dealing Region  Limit Detail calculations   *
      *  DETSCN - Process Security Country Limit Detail calculations  *
      *  DETSCC - Process Security Currency Limit Detail calculations *
      *  DETSCS - Process Security Customer Limit Detail calculations *
      *  DETSSC - Process Security Security Limit Detail calculations *
      *  DETSIV - Process Security Investmeent Limit Detail           *
      *            Calculations                                       *
      *                                                               *
      *  REPEXP - Process Exposure Management Report Lines            *
      *  REPDCL - Process Dealing Client Limits Detail Report Lines   *
      *  REPDCN - Process Dealing Country Limits Detail Report Lines  *
      *  REPDRG - Process Dealing Region Limits Detail Report Lines   *
      *  REPSCN - Process Security Country Limits Detail Report Lines *
      *  REPSCC - Process Security Currency Limits Detail Report Lines*
      *  REPSCS - Process Security Customer Limits Detail Report Lines*
      *  REPSSC - Process Security Security Limits Detail Report Lines*
      *  REPSIV - Process Security Investment Limits Detail Report    *
      *            Lines                                              *
      *                                                               *
      *  DTEXMN - Subroutine to Write a Detail Exposure Management    *
      *            Record to the Report                               *
      *  DEDLCL - Write a Detail Dealing Client Limits Report Lines   *
      *  DEDLCN - Write a Detail Dealing Country Limits Report Lines  *
      *  DEDLRG - Write a Detail Dealing Region Limits Report Lines   *
      *  DESCCN - Write a Detail Security Country Limits Report Lines *
      *  DESCCC - Write a Detail Security Currency Limits Report Lines*
      *  DESCCS - Write a Detail Security Customer Limits Report Lines*
      *  DESCSC - Write a Detail Security Security Limits Report Lines*
      *  DESCIV - Write a Detail Security Investment Limits Report    *
      *                                                               *
      *  GETDCL - Retrieve Customer name for Report                   *
      *  GETDCN - Retrieve Country  name for Report                   *
      *  GETDRG - Retrieve Region   name for Report                   *
      *  GETSCC - Retrieve SE Currency name for Report                *
      *  GETSSC - Retrieve SE Security name for Report                *
      *  GETSIV - Retrieve SE Investment name for Report              *
      *                                                               *
      *  SAVDCL - Save Dealing Client Key fields                      *
      *  SAVDCN - Save Dealing Country Key fields                     *
      *  SAVDRG - Save Dealing Region Key fields                      *
      *  SAVSCN - Save Security Country Key fields                    *
      *  SAVSCC - Save Security Currency Key fields                   *
      *  SAVSCS - Save Security Customer Key fields                   *
      *  SAVSSC - Save Security Security Key fields                   *
      *  SAVSIV - Save Security Investment Key fields                 *
      *                                                               *
      *  WP1END - Write End of Report                                 *
      *  WP2END - Subroutine to Write End of Report for Dealing or    *
      *            All Modules                                        *
      *                                                               *
      *  ER@BUR - Error processing for Exposure Management Data       *
      *  ERTB95 - Error processing SD Exposure Management ICD Record  *
      *            2 Table File                                       *
      *  EREMLI - Error processing for EM Limits File Detail          *
      *  ER@BNR - Error processing for SD Dealing Data Retrieval      *
      *  ERTB11 - Error processing Midas Table ICD Record 2           *
      *  ER@DZT - Error processing for SD Client Limits File          *
      *  ER@DXN - Error processing for SD Country Limits File         *
      *  ER@DYQ - Error processing for SD Region  Limits File         *
      *  ERSLIE - Error processing for SE Country Limits Detail File  *
      *  ERSLIF - Error processing for SE Currency Limits Detail File *
      *  ERSLIH - Error processing for SE Customer Limits Detail File *
      *  ERSLII - Error processing for SE Security Limits Detail File *
      *  ERSLIG - Error processing for SE Investment  Limits Detail   *
      *  AUDIT  - Produce Audit Report and End Program                *
      *  *PSSR  - Program Error Processing Subroutine                 *
      *  RCFP1  - RCF Processing for P1 Report                        *
      *  RCFAU  - RCF Processing for Audit Report                     *
      *                                                               *
      *  ZDATE1 - Validate Date and Convert into Midas Day Number     *
      *  ZDATE2 - Convert Midas Day Number into Date (DDMMYY/MMDDYY)  *
      *  ZDAYS  - Calculation Number of Days between Two Dates        *
      *  ZSEDIT - Edit an Amount                                      *
      *                                                               *
      *****************************************************************
     E/EJECT
     E                    CPY@    1   1 80
      *
      ** Array containing Copyright statement
      *
     E/COPY ZSRSRC,ZDATE2Z1
     E*COPY ZSRSRC,ZDAYSZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZPOWERZ1
      /SPACE 3
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     ISPOOL1      DS
      ***  File Information Data Structure for EU0410P1.
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
      *
     ISPOOLU      DS
      ***  File Information Data Structure for EU0410AU.
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
      ***  Dummy Data Structures used by Access Programs.
      *
     ISDBANK    E DSSDBANKPD
      ***  External data structures for Bank Details
     I*
     ISDGELR    E DSSDGELRPD
      ***  External data structures for General Ledger Details
     I*
     ISDCURR    E DSSDCURRPD
     I** External DS for CURRENCY details
      *
     ISDCUST    E DSSDCUSTPD
      * @CUST - Customer record format data structure
     I*
     ISDCTRY    E DSSDCTRYPD
      * @A4REBR - Region code record format data structure
     I*
     ISDREGN    E DSSDREGNPD
      * @A3REBX - Region code record format data structure
     I*
     I* Dummy data structures used by ACCESS PROGRAMS
     I* (DSSDY only used if file records over 150 chars. long)
     I*
     IDSFDY     E DSDSFDY
     I*
     IDSSDY     E DSDSSDY
     I*
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  Perform Initialisation.
      *
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      ***  Output End of Report and End Program.
      *
     C           PMODI     IFEQ 'EM'
     C                     EXSR WP1END
     C                     ELSE
     C                     EXSR WP2END
     C                     ENDIF
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
     C/EJECT
      *****************************************************************
      *                                                               *
      *  INIT   - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  RCFP1  - RCF Processing for P1 Report                        *
      *  ZDAT   -
      *  ZDAT   -
      *  AOBANKR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR                           ***  INIT  ***
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ***  Receive Parameter List.
      *
     C           *ENTRY    PLIST
     C                     PARM           PLCCY   3        New Limit Ccy
     C                     PARM           PMODI   2        EM/DL/AL Module
     C                     PARM           PRFAC   1        Rounding factor
      *
      ***  Initialise LDA field.
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVEL'EU0410'  DBPGM
     C                     OUT  LDA
      *
      * SET UP THE KEY FIELDS
      *
     C* SD Client Limits file
     C           K@CLLM    KLIST
     C                     KFLD           DZCUST
     C                     KFLD           DZLEVL
     C                     KFLD           DZBCCD
      *
     C* SD Country Limits file
     C           K@CNLM    KLIST
     C                     KFLD           DXCNCD
     C                     KFLD           DXLEVL
     C                     KFLD           DXBCCD
      *
     C* SD Region Limits file
     C           K@RGLM    KLIST
     C                     KFLD           DYRGCD
     C                     KFLD           DYLEVL
     C                     KFLD           DYBCCD
      *
     C* SE Country Limits file
     C           K@SECN    KLIST
     C                     KFLD           CTYL
     C                     KFLD           BOKE
     C                     KFLD           LVLE
     C                     KFLD           ETYE
      *
     C* SE Customer Limits file
     C           K@SECC    KLIST
     C                     KFLD           CNCL
     C                     KFLD           BOKF
     C                     KFLD           LVLF
     C                     KFLD           ETYF
      *
     C* SE Customer Limits file
     C           K@SECS    KLIST
     C                     KFLD           CSTL
     C                     KFLD           BOKH
     C                     KFLD           LVLH
     C                     KFLD           ETYH
      *
     C* SE Security Limits file
     C           K@SESC    KLIST
     C                     KFLD           SCTL
     C                     KFLD           BOKI
     C                     KFLD           LVLI
     C                     KFLD           ETYI
      *
     C* SE Investment Limits file
     C           K@SEIV    KLIST
     C                     KFLD           INTL
     C                     KFLD           BOKG
     C                     KFLD           LVLG
     C                     KFLD           ETYG
      *
     C           K@INVT    KLIST
     C                     KFLD           INTL
     C                     KFLD           H1DLCY
      *
      *
     C* Move New Limit currency to Print fields
     C                     MOVE PLCCY     H1NWEX
     C                     MOVE PLCCY     H1NWDL
     C*
     C                     MOVE *ZEROS    ROUND   10
     C           PRFAC     IFGT '0'
     C           PRFAC     ANDLE'9'
     C                     MOVE PRFAC     ROUND
     C                     ENDIF
      *
      ***  Call Access Program for Bank Details - Title, Run Date and
      ***  Run Day Number.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' PRTCD   7
     C                     PARM '*FIRST ' POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ***  Handle Database Error.
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE 'SDBANKPD'DBFILE           ***************
     C                     Z-ADD001       DBASE            * DBERR 01    *
     C                     MOVELPOPTN     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Check System Date Format, DDMMYY (*IN98 off)
      ***                            MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     ENDIF
      *
     C**   Call Access Program for General Ledger Details
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST  'POPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      ***  Handle Database Error.
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE 'SDGELRPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            * DBERR 02    *
     C                     MOVELPOPTN     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C*
      **   Access RUNDAT for multibranching indicator
      *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
      *
      ***  Report Work fields.
      *
     C                     Z-ADD0         RQDLN1  30
     C                     Z-ADD0         DIFLN1  30
      *
     C                     EXSR RCFP1
      *
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFP1
      *****************************************************************
      *                                                               *
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP1     BEGSR                            *** RCFP1  ***
      *
      ***  Ensure Report Spool File recorded by RCF.
     C*
      ** TRANSFER BINARY DATA INTO NUMERIC FIELD
     C                     Z-ADDSFNUM1    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   @PARM   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM *BLANK    ZSERR   1
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFAU
      *****************************************************************
      *                                                               *
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFAU     BEGSR                            *** RCFAU  ***
      *
      ***  Ensure Audit Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   SENTY   3
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANK    ZSERR
      *
      ***  If Error occurs during ZSFILE processing, then return to the
      ***  Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - Subroutine to do the Detail Processing.             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  EXPMNG - Process Exposure Management Report Limits           *
      *  DELLEN - Process Dealing Report Limits                       *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR                           *** PROCES ***
      *
      *
      * Check for Modules to be converted.
      * 'EM' - Exposure Management
      * 'DL' - Dealing, Securities Trading, Lending and Precious Metals
      * 'AL' - All Modules, i.e. 'EM' and 'DL'
      *
     C                     SELEC
     C           PMODI     WHEQ 'EM'
     C                     EXSR EXPMNG
     C*
     C           PMODI     WHEQ 'DL'
     C                     EXSR DELLEN
      *
     C                     OTHER
     C                     EXSR EXPMNG
     C                     EXSR DELLEN
     C                     ENDSL
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/EXPMNG
      *****************************************************************
      *                                                               *
      *  EXPMNG - Process Exposure Management Report Limits           *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:                                                       *
      *  VALCUR -                                                     *
      *  DETEXP -                                                     *
      *  REPEXP -                                                     *
      *                                                               *
      *****************************************************************
      *
     C           EXPMNG    BEGSR                           *** EXPMNG ***
     C*
     C                     MOVEA'000'     *IN,50
     C                     MOVE *ON       *IN50
     C*
     C                     WRITEHEADP1
     C*
     C           *LOVAL    SETLL@BUREE1                      Set file
     C                     READ @BUREE1                9091  Read record
     C*
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C                     EXSR ER@BUR
     C                     ENDIF
     C*
     C           *IN91     IFEQ *OFF
     C* Current Exposure Mangement Dealing Base Limit Currency
     C                     MOVELBUCYCD    H1EXCY
     C                     EXSR VALCUR
     C*
     C* Update Exposure Management ICD with the New Limit currency,
     C*  type of last change and date.
     C*
     C                     MOVE PLCCY     BUCYCD
     C                     MOVE 'A'       BUTYLC
     C                     MOVE BJRDNB    BULCD
     C*
     C                     UPDAT@BUREE1                90    Updt record
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@BUR
     C                     ENDIF
     C*
     C* Update Midas SD Exposure Management ICD record
     C                     READ TABTB95F               9091  Read record
     C*
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C                     EXSR ERTB95
     C                     ENDIF
     C*
     C           *IN91     IFEQ *OFF
     C                     MOVE PLCCY     LCCY
     C                     UPDATTABTB95F
     C                     ENDIF
     C*
     C*
     C                     WRITESUBHD1
     C                     WRITEDETHDG
     C*
     C                     READ EMLIML2                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR EREMLI
     C                     ENDIF
     C*
     C           *IN95     DOWEQ*OFF
     C                     EXSR DETEXP
     C                     UPDATEMLIML2F
     C                     READ EMLIML2                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR EREMLI
     C                     ENDIF
     C*
     C                     ENDDO
     C                     EXSR REPEXP
     C                     ENDIF
     C*
     C*
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DELLEN
      *****************************************************************
      *                                                               *
      *  DELLEN - Process Dealing, Lending and Precious Metals Limits *
      *                                                               *
      *  Called By: PROCES                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DELLEN    BEGSR                           *** DELLEN ***
     C                     MOVEA'000'     *IN,50
     C                     MOVE *ON       *IN51
     C*
     C*
     C           *LOVAL    SETLL@BNREEI                      Set file
     C                     READ @BNREEI                9092  Read record
     C*
     C           *IN90     IFEQ *ON
     C           *IN92     OREQ *ON
     C                     EXSR ER@BNR
     C                     ENDIF
     C*
     C           *IN92     IFEQ *OFF
     C* Current Dealing Base Limit Currency
     C                     MOVELBNCYCD    H1DLCY
     C                     EXSR VALCUR
     C*
     C* Update Dealing ICD with the New Limit currency,
     C*  type of last change and date.
     C*
     C                     MOVE PLCCY     BNCYCD
     C                     MOVE 'A'       BNTYLC
     C                     MOVE BJRDNB    BNLCD
     C                     UPDAT@BNREEI                90    Updt record
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@BNR
     C                     ENDIF
     C*
     C* Update Midas Table ICD Record 2
     C                     READ TABTB11F               9091  Read record
     C*
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C                     EXSR ERTB11
     C                     ENDIF
     C*
     C           *IN91     IFEQ *OFF
     C                     MOVE PLCCY     BCYL
     C                     UPDATTABTB11F
     C                     ENDIF
     C*
     C*
     C                     EXSR DTDLCL
     C                     EXSR DTDLCN
     C                     EXSR DTDLRG
     C*
     C                     EXSR SECTRD
     C*
     C                     ENDIF
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DTDLCL
      *****************************************************************
      *                                                               *
      *  DTDLCL - Process Dealing Client Limits Detail calculations   *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTDLCL    BEGSR                           *** DTDLCL ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLCLH2
     C                     Z-ADD0         RUNTOT  70
     C*
     C           K@CLLM    SETLL@DZREHT
     C                     READ @DZREHT                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DZT
     C                     ENDIF
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SZCUST    WHNE DZCUST
     C                     EXSR REPDCL
     C                     MOVE *BLANKS   P@KEY1
     C                     MOVELDZCUST    P@KEY1
     C                     EXSR GETDCL
     C                     EXSR SAVDCL
     C           SZLEVL    WHNE DZLEVL
     C                     EXSR REPDCL
     C                     EXSR SAVDCL
     C           SZBCCD    WHNE DZBCCD
     C                     EXSR REPDCL
     C                     EXSR SAVDCL
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETDCL
     C*
     C                     UPDAT@DZREHT                90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DZT
     C                     ENDIF
     C*
     C                     READ @DZREHT                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DZT
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPDCL
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/DTDLCN
      *****************************************************************
      *                                                               *
      *  DTDLCN - Process Dealing Country Limits Detail Calculations  *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTDLCN    BEGSR                           *** DTDLCN ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLCNH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@CNLM    SETLL@DXREHN
     C                     READ @DXREHN                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DXN
     C                     ENDIF
     C*
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SXCNCD    WHNE DXCNCD
     C                     EXSR REPDCN
     C                     MOVE DXCNCD    P@CNCD
     C                     EXSR GETDCN
     C                     EXSR SAVDCN
     C           SXLEVL    WHNE DXLEVL
     C                     EXSR REPDCN
     C                     EXSR SAVDCN
     C           SXBCCD    WHNE DXBCCD
     C                     EXSR REPDCN
     C                     EXSR SAVDCN
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETDCN
     C*
     C                     UPDAT@DXREHN                90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DXN
     C                     ENDIF
     C*
     C                     READ @DXREHN                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DXN
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPDCN
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DTDLRG
      *****************************************************************
      *                                                               *
      *  DTDLRG - Process Dealing Region  Limits Detail Calculations  *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTDLRG    BEGSR                           *** DTDLRG ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLRGH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@RGLM    SETLL@DYREHQ
     C                     READ @DYREHQ                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DYQ
     C                     ENDIF
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SYRGCD    WHNE DYRGCD
     C                     EXSR REPDRG
     C                     EXSR GETDRG
     C                     EXSR SAVDRG
     C           SYLEVL    WHNE DYLEVL
     C                     EXSR REPDRG
     C                     EXSR SAVDRG
     C           SYBCCD    WHNE DYBCCD
     C                     EXSR REPDRG
     C                     EXSR SAVDRG
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETDRG
     C*
     C                     UPDAT@DYREHQ                90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DYQ
     C                     ENDIF
     C*
     C                     READ @DYREHQ                9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ER@DYQ
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPDRG
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SECTRD
      *****************************************************************
      *                                                               *
      *  SECTRD - Process Security Trading Limits                     *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SECTRD    BEGSR                           *** SECTRD ***
     C                     MOVEA'000'     *IN,50
     C                     MOVE *ON       *IN52
     C*
     C                     EXSR DTSCCN
     C                     EXSR DTSCCC
     C                     EXSR DTSCCS
     C                     EXSR DTSCSC
     C                     EXSR DTSCIV
     C*
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DTSCCN
      *****************************************************************
      *                                                               *
      *  DTSCCN - Process Security Country Limits Detail Calculations *
      *                                                               *
      *  Called By: SECTRD                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTSCCN    BEGSR                           *** DTSCCN ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECNH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@SECN    SETLLSLIMEF
     C                     READ SLIMEF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIE
     C                     ENDIF
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SVCTYL    WHNE CTYL
     C                     EXSR REPSCN
     C                     MOVE CTYL      P@CNCD
     C                     EXSR GETDCN
     C                     EXSR SAVSCN
     C           SVBOKE    WHNE BOKE
     C                     EXSR REPSCN
     C                     EXSR SAVSCN
     C           SVLVLE    WHNE LVLE
     C                     EXSR REPSCN
     C                     EXSR SAVSCN
     C           SVETYE    WHNE ETYE
     C                     EXSR REPSCN
     C                     EXSR SAVSCN
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETSCN
     C*
     C                     UPDATSLIMEF                 90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIE
     C                     ENDIF
     C*
     C*
     C                     READ SLIMEF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIE
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPSCN
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/DTSCCC
      *****************************************************************
      *                                                               *
      *  DTSCCC - Process Security Currency Limits Detail Calculations*
      *                                                               *
      *  Called By: SECTRD                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTSCCC    BEGSR                           *** DTSCCC ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECCH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@SECC    SETLLSLIMFF
     C                     READ SLIMFF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIF
     C                     ENDIF
     C*
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SVCNCL    WHNE CNCL
     C                     EXSR REPSCC
     C                     EXSR GETSCC
     C                     EXSR SAVSCC
     C           SVBOKF    WHNE BOKF
     C                     EXSR REPSCC
     C                     EXSR SAVSCC
     C           SVLVLF    WHNE LVLF
     C                     EXSR REPSCC
     C                     EXSR SAVSCC
     C           SVETYF    WHNE ETYF
     C                     EXSR REPSCC
     C                     EXSR SAVSCC
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETSCC
     C*
     C                     UPDATSLIMFF                 90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIF
     C                     ENDIF
     C*
     C                     READ SLIMFF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIF
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPSCC
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DTSCCS
      *****************************************************************
      *                                                               *
      *  DTSCCS - Process Security Customer Limits Detail Calculations*
      *                                                               *
      *  Called By: SECTRD                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTSCCS    BEGSR                           *** DTSCCS ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECSH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@SECS    SETLLSLIMHF
     C                     READ SLIMHF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIH
     C                     ENDIF
     C*
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SVCSTL    WHNE CSTL
     C                     EXSR REPSCS
     C                     MOVE *BLANKS   P@KEY1
     C                     MOVELDZCUST    P@KEY1
     C                     EXSR GETDCL
     C                     EXSR SAVSCS
     C           SVBOKH    WHNE BOKH
     C                     EXSR REPSCS
     C                     EXSR SAVSCS
     C           SVLVLH    WHNE LVLH
     C                     EXSR REPSCS
     C                     EXSR SAVSCS
     C           SVETYH    WHNE ETYH
     C                     EXSR REPSCS
     C                     EXSR SAVSCS
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETSCS
     C*
     C                     UPDATSLIMHF                 90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIH
     C                     ENDIF
     C*
     C*
     C                     READ SLIMHF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIH
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPSCS
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DTSCSC
      *****************************************************************
      *                                                               *
      *  DTSCSC - Process Security Security Limits Detail Calculations*
      *                                                               *
      *  Called By: SECTRD                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTSCSC    BEGSR                           *** DTSCSC ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESESCH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@SESC    SETLLSLIMIF
     C                     READ SLIMIF                 9095
     C                     MOVE RECI      SLRECI  1                       134759
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLII
     C                     ENDIF
     C*
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SVSCTL    WHNE SCTL
     C                     EXSR REPSSC
     C                     EXSR GETSSC
     C                     EXSR SAVSSC
     C           SVBOKI    WHNE BOKI
     C                     EXSR REPSSC
     C                     EXSR SAVSSC
     C           SVLVLI    WHNE LVLI
     C                     EXSR REPSSC
     C                     EXSR SAVSSC
     C           SVETYI    WHNE ETYI
     C                     EXSR REPSSC
     C                     EXSR SAVSSC
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETSSC
     C*
     C                     MOVE SLRECI    RECI                           134759
     C                     UPDATSLIMIF                 90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLII
     C                     ENDIF
     C*
     C                     READ SLIMIF                 9095
     C                     MOVE RECI      SLRECI                         134759
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLII
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPSSC
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DTSCIV
      *****************************************************************
      *                                                               *
      *  DTSCIV - Process Security Investment Limits Detail           *
      *            Calculations                                       *
      *  Called By: SECTRD                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DTSCIV    BEGSR                           *** DTSCIV ***
     C*
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESEIVH2
     C                     Z-ADD0         RUNTOT
     C*
     C           K@SEIV    SETLLSLIMGF
     C                     READ SLIMGF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIG
     C                     ENDIF
     C*
     C           *IN95     DOWEQ*OFF
     C* Test for Level breaks
     C                     SELEC
     C           SVINTL    WHNE INTL
     C                     EXSR REPSIV
     C                     EXSR GETSIV
     C                     EXSR SAVSIV
     C           SVBOKG    WHNE BOKG
     C                     EXSR REPSIV
     C                     EXSR SAVSIV
     C           SVLVLG    WHNE LVLG
     C                     EXSR REPSIV
     C                     EXSR SAVSIV
     C           SVETYG    WHNE ETYG
     C                     EXSR REPSIV
     C                     EXSR SAVSIV
     C                     ENDSL
     C                     ADD  1         RUNTOT
     C*
     C                     EXSR DETSIV
     C*
     C                     UPDATSLIMGF                 90
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIG
     C                     ENDIF
     C*
     C*
     C                     READ SLIMGF                 9095
     C*
     C           *IN90     IFEQ *ON
     C                     EXSR ERSLIG
     C                     ENDIF
     C*
     C                     ENDDO
     C*
     C                     EXSR REPSIV
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/VALCUR
      *****************************************************************
      *                                                               *
      *  VALCUR - Validate Limit Currency                             *
      *                                                               *
      *  Called By: EXPMNG                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           VALCUR    BEGSR                           *** VALCUR ***
      *
      ** Obtain Current Limit CURRENCY details via ACCESS PROGRAM
     C*
     C           *IN50     IFEQ *ON
     C                     MOVE H1EXCY    @CCY
     C                     ELSE
     C                     MOVE H1DLCY    @CCY
     C                     ENDIF
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** If database error, return to calling program
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD003       DBASE            * DBERR 03 *
     C                     MOVEL@CCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C* Save the fields for Euro Exchange process.
     C*
     C                     MOVE A6INCY    WFRIN   1
     C                     MOVE A6CYCD    P@FRCY
     C*
     C* Save the fields for standard conversion routine.
     C*
     C                     MOVE A6CYCD    ZCCYF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     Z-ADDA6EUER    ZEUROF 159                                          197593
     C                     MOVE A6EUMD    ZEUMDF  1                                           197593
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADD*ZEROS    ZCDPF
     C*
     C* Set the appropriate indicator for using Edit word for Current
     C*  Limit amounts in the Report.
     C*
     C                     MOVEA'0000'    *IN,40
     C                     SELEC
     C           A6NBDP    WHEQ 0
     C                     MOVE *ON       *IN40
     C           A6NBDP    WHEQ 1
     C                     MOVE *ON       *IN41
     C           A6NBDP    WHEQ 2
     C                     MOVE *ON       *IN42
     C                     OTHER
     C                     MOVE *ON       *IN43
     C                     ENDSL
      *
      ** Obtain new Limit CURRENCY details for via ACCESS PROGRAM
     C                     MOVE PLCCY     @CCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** If database error, return to calling program
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD003       DBASE            * DBERR 03 *
     C                     MOVEL@CCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVE A6INCY    WTOIN   1
     C                     MOVE A6CYCD    P@TOCY
     C*
     C* Save the fields for standard conversion routine.
     C*
     C                     MOVE A6CYCD    ZCCYT
     C                     Z-ADDA6SPRT    ZRATET
     C                     MOVE A6MDIN    ZMDINT
     C                     Z-ADD*ZEROS    ZCDPT
     C*
     C* The exchange rates are to be printed in the Report headings
     C*  and hence a dummy amount of 0 is used for conversion
     C*  routines.
     C*
     C                     Z-ADD0         W1AMNT 110
     C*
     C                     EXSR CVTAMT
     C*
     C*
     C           PLCCY     IFEQ BKEURO
     C           WFRIN     ANDEQ'Y'
     C           *IN50     IFEQ *ON
     C                     Z-ADDP@EXRT    H1EXER
     C                     ELSE
     C                     Z-ADDP@EXRT    H1DLER
     C                     ENDIF
     C                     ELSE
     C           *IN50     IFEQ *ON
     C                     Z-ADDZCRSRT    H1EXER
     C                     ELSE
     C                     Z-ADDZCRSRT    H1DLER
     C                     ENDIF
     C                     ENDIF
     C*
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/CVTAMT
      *****************************************************************
      *                                                               *
      *  CVTAMT - Convert Limit Amounts from Old to New Limit currency*
      *                                                               *
      *  Called By: VALCUR, DETEXP                                    *
      *  Calls:     EU0200, ZCCYCN                                    *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           CVTAMT    BEGSR                           *** CVTAMT ***
     C*
     C* If the new currency is 'EUR' and the old currency is an 'in'
     C*  currency, then the official EMU exchange rate from the
     C*  currency file should be used.
     C*
     C                     Z-ADD0         W3AMNT 110
     C           PLCCY     IFEQ BKEURO
     C           WFRIN     ANDEQ'Y'
      *                                                                                       197593
      **  All the limit amounts are already in thousands.  So remove                          197593
      **  call to EU0200 when converting limit amounts as it uses                             197593
      **  decimal places in the conversion.                                                   197593
      *                                                                                       197593
     C           W1AMNT    IFNE 0                                                             197593
      *                                                                                       197593
     C           ZEUMDF    IFEQ 'D'                                                           197593
     C           W1AMNT    DIV  ZEUROF    W3AMNT                                              197593
     C                     ELSE                                                               197593
     C           W1AMNT    MULT ZEUROF    W3AMNT                                              197593
     C                     ENDIF                                                              197593
      *                                                                                       197593
     C                     ELSE                                                               197593
      *                                                                                       197593
      **  Only call EU0200 when obtaining the exchange rate (W1AMNT=0).                       197593
      **  That is, from subroutine VALCUR.                                                    197593
     C*
     C                     Z-ADDW1AMNT    P@FRAM
     C                     CALL 'EU0200'
     C                     PARM *BLANKS   P@RTCD  7        Return Code
     C                     PARM           P@FRAM 183       FROM Ccy Amount
     C                     PARM           P@FRCY  3        FROM Currency
     C                     PARM           P@TOCY  3        TO Currency
     C                     PARM           P@OUTA 150       Outright Amount
     C                     PARM           P@INTA 183       Interim Amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind
     C           P@RTCD    IFEQ '*ERROR*'
     C           *LOCK     IN   LDA
     C                     MOVEL'EU0200  'DBFILE           ************
     C                     MOVE 004       DBASE            * DBERR 04 *
     C                     MOVE *BLANKS   DBKEY            ************
     C                     MOVE *BLANKS   W@OPTN  7
     C                     MOVELP@FRCY    W@OPTN
     C                     MOVE P@TOCY    W@OPTN
     C                     MOVELW@OPTN    DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C*
     C                     ELSE
     C*
     C                     Z-ADDP@OUTA    W3AMNT
     C                     ENDIF
      *                                                                                       197593
     C                     ENDIF                                                              197593
     C*
     C                     ELSE
     C*
     C* Else, the conversion should use the normal spot rate from the
     C*  Currency file and the standard conversion routines.
     C*
     C                     Z-ADDW1AMNT    ZAMTF
     C                     Z-ADD0         ZAMTT
     C                     EXSR ZCCYCN
     C*
     C                     Z-ADDZAMTT     W3AMNT
     C                     ENDIF
     C*
     C* Perform the rounding off on the amount prior to updating
     C*  the amount fields in the files
     C*
     C                     Z-ADDW3AMNT    WRK309 309
     C                     DO   ROUND
     C                     DIV  10        WRK309
     C                     ENDDO
     C                     Z-ADDWRK309    WRK110 110H
     C                     DO   ROUND
     C                     MULT 10        WRK110
     C                     ENDDO
     C                     Z-ADDWRK110    W2AMNT 110
     C*
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/DETEXP
      *****************************************************************
      *                                                               *
      *  DETEXP - Process Exposure Management Detail calculations     *
      *                                                               *
      *  Called By: EXPMNG                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETEXP    BEGSR                           *** DETEXP ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  MOAL      CUMOAL
     C                     ADD  MFXL      CUMFXL
     C                     ADD  MMML      CUMMML
     C                     ADD  MLEL      CUMLEL
     C                     ADD  MREL      CUMREL
     C                     ADD  MSTL      CUMSTL
     C                     ADD  MSLI      CUMSLI
     C                     ADD  MSCL      CUMSCL
     C                     ADD  MFRL      CUMFRL
     C                     ADD  MIRL      CUMIRL
     C                     ADD  MFUL      CUMFUL
     C                     ADD  MOPL      CUMOPL
     C                     ADD  EMDR      CUEMDR
      *
     C                     Z-ADDMOAL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MOAL
      *
     C                     Z-ADDMFXL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MFXL
      *
     C                     Z-ADDMMML      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MMML
      *
     C                     Z-ADDMLEL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MLEL
      *
     C                     Z-ADDMREL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MREL
      *
     C                     Z-ADDMSTL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MSTL
      *
     C                     Z-ADDMSLI      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MSLI
      *
     C                     Z-ADDMSCL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MSCL
      *
     C                     Z-ADDMFRL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MFRL
      *
     C                     Z-ADDMIRL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MIRL
      *
     C                     Z-ADDMFUL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MFUL
      *
     C                     Z-ADDMOPL      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    MOPL
      *
     C                     Z-ADDEMDR      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    EMDR
     C*
     C                     ADD  MOAL      NWMOAL
     C                     ADD  MFXL      NWMFXL
     C                     ADD  MMML      NWMMML
     C                     ADD  MLEL      NWMLEL
     C                     ADD  MREL      NWMREL
     C                     ADD  MSTL      NWMSTL
     C                     ADD  MSLI      NWMSLI
     C                     ADD  MSCL      NWMSCL
     C                     ADD  MFRL      NWMFRL
     C                     ADD  MIRL      NWMIRL
     C                     ADD  MFUL      NWMFUL
     C                     ADD  MOPL      NWMOPL
     C                     ADD  EMDR      NWEMDR
      *
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/DETDCL
      *****************************************************************
      *                                                               *
      *  DETDCL - Process Dealing Client Limit Detail calculations    *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETDCL    BEGSR                           *** DETDCL ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  DZFLAM    CZFLAM
     C                     ADD  DZFXLA    CZFXLA
     C                     ADD  DZFXFA    CZFXFA
     C                     ADD  DZLLAM    CZLLAM
     C                     ADD  DZMDDR    CZMDDR
     C                     ADD  DZFRLA    CZFRLA
     C                     ADD  DZIRLM    CZIRLM
     C                     ADD  DZMMAM    CZMMAM
     C                     ADD  DZMLAM    CZMLAM
     C                     ADD  DZPFAM    CZPFAM
     C                     ADD  DZPSAM    CZPSAM
     C                     ADD  DZPLAM    CZPLAM
      *
     C                     Z-ADDDZFLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZFLAM
      *
     C                     Z-ADDDZFXLA    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZFXLA
      *
     C                     Z-ADDDZFXFA    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZFXFA
      *
     C                     Z-ADDDZLLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZLLAM
      *
     C                     Z-ADDDZMDDR    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZMDDR
      *
     C                     Z-ADDDZFRLA    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZFRLA
      *
     C                     Z-ADDDZIRLM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZIRLM
      *
     C                     Z-ADDDZMMAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZMMAM
      *
     C                     Z-ADDDZMLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZMLAM
      *
     C                     Z-ADDDZPFAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZPFAM
      *
     C                     Z-ADDDZPSAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZPSAM
      *
     C                     Z-ADDDZPLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DZPLAM
      *
     C                     ADD  DZFLAM    NZFLAM
     C                     ADD  DZFXLA    NZFXLA
     C                     ADD  DZFXFA    NZFXFA
     C                     ADD  DZLLAM    NZLLAM
     C                     ADD  DZMDDR    NZMDDR
     C                     ADD  DZFRLA    NZFRLA
     C                     ADD  DZIRLM    NZIRLM
     C                     ADD  DZMMAM    NZMMAM
     C                     ADD  DZMLAM    NZMLAM
     C                     ADD  DZPFAM    NZPFAM
     C                     ADD  DZPSAM    NZPSAM
     C                     ADD  DZPLAM    NZPLAM
      *
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/DETDCN
      *****************************************************************
      *                                                               *
      *  DETDCN - Process Dealing Country Limit Detail calculations   *
      *                                                               *
      *  Called By: DTDLCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETDCN    BEGSR                           *** DETDCN ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  DXFLAM    CXFLAM
     C                     ADD  DXLLAM    CXLLAM
     C                     ADD  DXFRLA    CXFRLA
     C                     ADD  DXIRLM    CXIRLM
      *
     C                     Z-ADDDXFLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DXFLAM
      *
     C                     Z-ADDDXLLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DXLLAM
      *
     C                     Z-ADDDXFRLA    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DXFRLA
      *
     C                     Z-ADDDXIRLM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DXIRLM
      *
     C                     ADD  DXFLAM    NXFLAM
     C                     ADD  DXLLAM    NXLLAM
     C                     ADD  DXFRLA    NXFRLA
     C                     ADD  DXIRLM    NXIRLM
      *
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/DETDRG
      *****************************************************************
      *                                                               *
      *  DETDRG - Process Dealing Region  Limit Detail calculations   *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETDRG    BEGSR                           *** DETDRG ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  DYFLAM    CYFLAM
     C                     ADD  DYLLAM    CYLLAM
     C                     ADD  DYFRLA    CYFRLA
     C                     ADD  DYIRLM    CYIRLM
      *
     C                     Z-ADDDYFLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DYFLAM
      *
     C                     Z-ADDDYLLAM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DYLLAM
      *
     C                     Z-ADDDYFRLA    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DYFRLA
      *
     C                     Z-ADDDYIRLM    W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    DYIRLM
      *
     C                     ADD  DYFLAM    NYFLAM
     C                     ADD  DYLLAM    NYLLAM
     C                     ADD  DYFRLA    NYFRLA
     C                     ADD  DYIRLM    NYIRLM
      *
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/DETSCN
      *****************************************************************
      *                                                               *
      *  DETSCN - Process Security Country Limit Detail calculations  *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETSCN    BEGSR                           *** DETSCN ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  LLME      CULLME
     C                     ADD  SLME      CUSLME
      *
     C                     Z-ADDLLME      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    LLME
      *
     C                     Z-ADDSLME      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    SLME
      *
     C                     ADD  LLME      NWLLME
     C                     ADD  SLME      NWSLME
      *
     C                     ENDSR
     C*
     C*
      *****************************************************************
      /TITLE SR/DETSCC
      *****************************************************************
      *                                                               *
      *  DETSCC - Process Security Currency Limit Detail calculations *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETSCC    BEGSR                           *** DETSCC ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  LLMF      CULLMF
     C                     ADD  SLMF      CUSLMF
      *
     C                     Z-ADDLLMF      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    LLMF
      *
     C                     Z-ADDSLMF      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    SLMF
      *
     C                     ADD  LLMF      NWLLMF
     C                     ADD  SLMF      NWSLMF
      *
     C                     ENDSR
     C*
     C*
      *****************************************************************
      /TITLE SR/DETSCS
      *****************************************************************
      *                                                               *
      *  DETSCS - Process Security Customer Limit Detail calculations *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETSCS    BEGSR                           *** DETSCS ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  LLMH      CULLMH
     C                     ADD  SLMH      CUSLMH
     C                     ADD  CLMP      CUCLMP
     C                     ADD  CLMS      CUCLMS
      *
     C                     Z-ADDLLMH      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    LLMH
      *
     C                     Z-ADDSLMH      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    SLMH
      *
     C                     Z-ADDCLMP      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    CLMP
      *
     C                     Z-ADDCLMS      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    CLMS
      *
     C                     ADD  LLMH      NWLLMH
     C                     ADD  SLMH      NWSLMH
     C                     ADD  CLMP      NWCLMP
     C                     ADD  CLMS      NWCLMS
      *
     C                     ENDSR
     C*
     C*
      *****************************************************************
      /TITLE SR/DETSSC
      *****************************************************************
      *                                                               *
      *  DETSSC - Process Security Security Limit Detail calculations *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETSSC    BEGSR                           *** DETSSC ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  LLMI      CULLMI
     C                     ADD  SLMI      CUSLMI
      *
     C                     Z-ADDLLMI      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    LLMI
      *
     C                     Z-ADDSLMI      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    SLMI
      *
     C                     ADD  LLMI      NWLLMI
     C                     ADD  SLMI      NWSLMI
      *
     C                     ENDSR
     C*
     C*
      *****************************************************************
      /TITLE SR/DETSIV
      *****************************************************************
      *                                                               *
      *  DETSIV - Process Security Investmeent Limit Detail           *
      *            Calculations                                       *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DETSIV    BEGSR                           *** DETSIV ***
      *
      *    Perform any necessary processing before writing detail line
     C                     ADD  LLMG      CULLMG
     C                     ADD  SLMG      CUSLMG
      *
     C                     Z-ADDLLMG      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    LLMG
      *
     C                     Z-ADDSLMG      W1AMNT
     C                     EXSR CVTAMT
     C                     Z-ADDW2AMNT    SLMG
      *
     C                     ADD  LLMG      NWLLMG
     C                     ADD  SLMG      NWSLMG
      *
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/REPEXP
      *****************************************************************
      *                                                               *
      *  REPEXP - Process Exposure Management Report Lines            *
      *                                                               *
      *  Called By: EXPMNG                                            *
      *  Calls:                                                       *
      *  DTEXMN - Format and Write a Detail Exposure Management Record*
      *                                                               *
      *****************************************************************
      *
     C           REPEXP    BEGSR                           *** REPEXP ***
      *
      *----------------------------------------------------------------
      *
      *
      ***  Write out the record.
      *
     C                     EXSR DTEXMN
      *
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/REPDCL
      *****************************************************************
      *                                                               *
      *  REPDCL - Process Dealing Client Limits Detail Report Lines   *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:     DEDLCL                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPDCL    BEGSR                           *** REPDCL ***
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DEDLCL
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPDCN
      *****************************************************************
      *                                                               *
      *  REPDCN - Process Dealing Country Limits Detail Report Lines  *
      *                                                               *
      *  Called By: DTDLCN                                            *
      *  Calls:     DEDLCN                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPDCN    BEGSR                           *** REPDCN ***
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DEDLCN
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPDRG
      *****************************************************************
      *                                                               *
      *  REPDRG - Process Dealing Region Limits Detail Report Lines   *
      *                                                               *
      *  Called By: DTDLRG                                            *
      *  Calls:     DEDLRG                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPDRG    BEGSR                           *** REPDRG ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DEDLRG
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPSCN
      *****************************************************************
      *                                                               *
      *  REPSCN - Process Security Country Limits Detail Report Lines *
      *                                                               *
      *  Called By: DTSCCN                                            *
      *  Calls:     DESCCN                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPSCN    BEGSR                           *** REPSCN ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DESCCN
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPSCC
      *****************************************************************
      *                                                               *
      *  REPSCC - Process Security Currency Limits Detail Report Lines*
      *                                                               *
      *  Called By: DTSCCC                                            *
      *  Calls:     DESCCC                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPSCC    BEGSR                           *** REPSCC ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DESCCC
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPSCS
      *****************************************************************
      *                                                               *
      *  REPSCS - Process Security Customer Limits Detail Report Lines*
      *                                                               *
      *  Called By: DTSCCS                                            *
      *  Calls:     DESCCS                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPSCS    BEGSR                           *** REPSCS ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DESCCS
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPSSC
      *****************************************************************
      *                                                               *
      *  REPSSC - Process Security Security Limits Detail Report Lines*
      *                                                               *
      *  Called By: DTSCSC                                            *
      *  Calls:     DESCSC                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPSSC    BEGSR                           *** REPSSC ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DESCSC
     C                     ENDIF
     C                     ENDSR
      *
     C*
      *****************************************************************
      /TITLE SR/REPSIV
      *****************************************************************
      *                                                               *
      *  REPSIV - Process Security Investment Limits Detail Report    *
      *            Lines                                              *
      *  Called By: DTSCIV                                            *
      *  Calls:     DESCIV                                            *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           REPSIV    BEGSR                           *** REPSIV ***
      *    Perform any necessary processing before writing detail line
      *
      *
     C           RUNTOT    IFGT 0
     C           *IN95     OREQ *ON
     C                     EXSR DESCIV
     C                     ENDIF
     C                     ENDSR
      *****************************************************************
      /TITLE SR/DTEXMN
      *****************************************************************
      *                                                               *
      *  DTEXMN - Subroutine to Write a Detail Exposure Management    *
      *            Record to the Report                               *
      *  Called By: REPEXP                                            *
      *  Calls:                                                       *
      *                                                               *
      *****************************************************************
      *
     C           DTEXMN    BEGSR                           *** DTEXMN ***
      *
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD14        RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITEDETHDG
     C                     ENDIF
      *
     C                     WRITEEXMNDT
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/DEDLCL
      *****************************************************************
      *                                                               *
      *  DEDLCL - Write a Detail Dealing Client Limits Report Lines   *
      *                                                               *
      *  Called By: REPDCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DEDLCL    BEGSR                           *** DEDLCL ***
     C                     Z-ADD22        RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLCLH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITEDLCLH3
     C                     WRITEDETHDG
     C                     WRITEDLCLDT
     C                     ENDSR
     C*
      *
      *
      *****************************************************************
      /TITLE SR/DEDLCN
      *****************************************************************
      *                                                               *
      *  DEDLCN - Write a Detail Dealing Country Limits Report Lines  *
      *                                                               *
      *  Called By: REPDCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DEDLCN    BEGSR                           *** DEDLCN ***
     C                     Z-ADD9         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLCNH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITEDLCNH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITEDLCNDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DEDLRG
      *****************************************************************
      *                                                               *
      *  DEDLRG - Write a Detail Dealing Region Limits Report Lines   *
      *                                                               *
      *  Called By: REPDRG                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DEDLRG    BEGSR                           *** DEDLCN ***
     C                     Z-ADD9         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDLRGH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITEDLRGH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITEDLRGDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DESCCN
      *****************************************************************
      *                                                               *
      *  DESCCN - Write a Detail Security Country Limits Report Lines *
      *                                                               *
      *  Called By: REPSCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DESCCN    BEGSR                           *** DESCCN ***
     C                     Z-ADD7         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECNH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITESECNH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITESECNDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DESCCC
      *****************************************************************
      *                                                               *
      *  DESCCC - Write a Detail Security Currency Limits Report Lines*
      *                                                               *
      *  Called By: REPSCC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DESCCC    BEGSR                           *** DESCCC ***
     C                     Z-ADD7         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECCH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITESECCH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITESECCDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DESCCS
      *****************************************************************
      *                                                               *
      *  DESCCS - Write a Detail Security Customer Limits Report Lines*
      *                                                               *
      *  Called By: REPSCS                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DESCCS    BEGSR                           *** DESCCS ***
     C                     Z-ADD7         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESECSH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITESECSH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITESECSDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DESCSC
      *****************************************************************
      *                                                               *
      *  DESCSC - Write a Detail Security Security Limits Report Lines*
      *                                                               *
      *  Called By: REPSSC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DESCSC    BEGSR                           *** DESCSC ***
     C                     Z-ADD7         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESESCH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITESESCH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITESESCDT
     C                     ENDSR
     C*
      *
      *****************************************************************
      /TITLE SR/DESCIV
      *****************************************************************
      *                                                               *
      *  DESCIV - Write a Detail Security Investment Limits Report    *
      *                                                               *
      *  Called By: REPSIV                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           DESCIV    BEGSR                           *** DESCIV ***
     C                     Z-ADD7         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESEIVH2
     C                     ENDIF
     C*
      *
      ***  Write out Detail Heading Record
      *
     C                     WRITESEIVH3
     C           PRTLN1    IFLE 17
     C                     WRITEDETHDG
     C                     ENDIF
     C                     WRITESEIVDT
     C                     ENDSR
     C*
      *****************************************************************
      /TITLE SR/GETDCL
      *****************************************************************
      *                                                               *
      *  GETDCL - Retrieve Customer name for Report                   *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETDCL    BEGSR                           *** GETDCL ***
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*KEY   ' P@OPTN  7        I:Option
     C                     PARM           P@KEY1 10        I:Key field
     C                     PARM           P@KYST  7        O:Key status
     C           SDCUST    PARM           DSSDY
      *
      ** If database error, return to calling program
     C           P@RTCD    IFEQ '*ERROR '
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ************
     C                     Z-ADD004       DBASE            * DBERR 04 *
     C                     MOVELP@KEY1    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE *BLANKS   PCSNAM
     C                     MOVELBBCNA1    PCSNAM
     C*
     C                     ENDSR
      *
      *
     C*
      *****************************************************************
      /TITLE SR/GETDCN
      *****************************************************************
      *                                                               *
      *  GETDCN - Retrieve Country  name for Report                   *
      *                                                               *
      *  Called By: DTDLCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETDCN    BEGSR                           *** GETDCN ***
     C                     CALL 'AOCTRYR0'
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*KEY   ' P@OPTN  7        I:Option
     C                     PARM           P@CNCD  2        I:Key field
     C           SDCTRY    PARM           DSFDY
      *
      ** If database error, return to calling program
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCTRYPD'DBFILE           ************
     C                     Z-ADD005       DBASE            * DBERR 05 *
     C                     MOVELP@CNCD    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE *BLANKS   PCNNAM
     C                     MOVELA4CNNM    PCNNAM
     C*
     C                     ENDSR
      *
      *
     C*
      *****************************************************************
      /TITLE SR/GETDRG
      *****************************************************************
      *                                                               *
      *  GETDRG - Retrieve Region   name for Report                   *
      *                                                               *
      *  Called By: DTDLRG                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETDRG    BEGSR                           *** GETDRG ***
     C                     CALL 'AOREGNR0'
     C                     PARM *BLANKS   P@RTCD  7        B:Return code
     C                     PARM '*KEY   ' P@OPTN  7        I:Option
     C                     PARM DYRGCD    P@RGCD  2        I:Key field
     C           SDREGN    PARM           DSFDY
      *
      ** If database error, return to calling program
     C           P@RTCD    IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDREGNPD'DBFILE           ************
     C                     Z-ADD006       DBASE            * DBERR 06 *
     C                     MOVELP@RGCD    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C                     MOVE *BLANKS   PRGNAM
     C                     MOVELA3RGNM    PRGNAM
     C*
     C                     ENDSR
      *
      *
     C*
     C*
      *****************************************************************
      /TITLE SR/GETSCC
      *****************************************************************
      *                                                               *
      *  GETSCC - Retrieve SE Currency name for Report                *
      *                                                               *
      *  Called By: DTSCCC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETSCC    BEGSR                           *** GETSCC ***
     C                     MOVE CNCL      @CCY
     C                     CALL 'AOCURRR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM           @CCY    3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** If database error, return to calling program
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C                     Z-ADD003       DBASE            * DBERR 03 *
     C                     MOVEL@CCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
     C*
     C                     MOVE *BLANKS   PCCNAM
     C                     MOVELA6CYNM    PCCNAM
     C                     ENDSR
      *
      *
     C*
      *****************************************************************
      /TITLE SR/GETSSC
      *****************************************************************
      *                                                               *
      *  GETSSC - Retrieve SE Security name for Report                *
      *                                                               *
      *  Called By: DTSCSC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETSSC    BEGSR                           *** GETSSC ***
     C           SCTL      CHAINSECTYDF              9590
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'SECTYD  'DBFILE           ************
     C                     Z-ADD007       DBASE            * DBERR 07 *
     C                     MOVELSCTL      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C                     MOVE *BLANKS   PSCNAM
     C           *IN95     IFEQ *OFF
     C                     MOVELSRPN      PSCNAM
     C                     ENDIF
     C                     ENDSR
      *
      *
     C*
      *****************************************************************
      /TITLE SR/GETSIV
      *****************************************************************
      *                                                               *
      *  GETSIV - Retrieve SE Investment name for Report              *
      *                                                               *
      *  Called By: DTSCIV                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           GETSIV    BEGSR                           *** GETSIV ***
     C           K@INVT    CHAININVTPDF              9590
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   W@OPTN  7
     C                     MOVELINTL      W@OPTN
     C                     MOVE H1DLCY    W@OPTN
     C                     MOVEL'INVTPD  'DBFILE           ************
     C                     Z-ADD008       DBASE            * DBERR 08 *
     C                     MOVELW@OPTN    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     MOVE *BLANKS   PIVNAM
     C           *IN95     IFEQ *OFF
     C                     MOVELINAM      PIVNAM
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVDCL
      *****************************************************************
      *                                                               *
      *  SAVDCL - Save Dealing Client Key fields                      *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVDCL    BEGSR                           *** SAVDCL ***
     C                     MOVE DZCUST    SZCUST
     C                     MOVE DZLEVL    SZLEVL
     C                     MOVE DZBCCD    SZBCCD
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARDLCLDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVDCN
      *****************************************************************
      *                                                               *
      *  SAVDCN - Save Dealing Country Key fields                     *
      *                                                               *
      *  Called By: DTDLCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVDCN    BEGSR                           *** SAVDCN ***
     C                     MOVE DXCNCD    SXCNCD
     C                     MOVE DXLEVL    SXLEVL
     C                     MOVE DXBCCD    SXBCCD
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARDLCNDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVDRG
      *****************************************************************
      *                                                               *
      *  SAVDRG - Save Dealing Region Key fields                      *
      *                                                               *
      *  Called By: DTDLRG                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVDRG    BEGSR                           *** SAVDRG ***
     C                     MOVE DYRGCD    SYRGCD
     C                     MOVE DYLEVL    SYLEVL
     C                     MOVE DYBCCD    SYBCCD
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARDLRGDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVSCN
      *****************************************************************
      *                                                               *
      *  SAVSCN - Save Security Country Key fields                    *
      *                                                               *
      *  Called By: DTSCCN                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVSCN    BEGSR                           *** SAVSCN ***
     C                     MOVE CTYL      SVCTYL
     C                     MOVE BOKE      SVBOKE
     C                     MOVE LVLE      SVLVLE
     C                     MOVE ETYE      SVETYE
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARSECNDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVSCC
      *****************************************************************
      *                                                               *
      *  SAVSCC - Save Security Currency Key fields                   *
      *                                                               *
      *  Called By: DTSCCC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVSCC    BEGSR                           *** SAVSCC ***
     C                     MOVE CNCL      SVCNCL
     C                     MOVE BOKF      SVBOKF
     C                     MOVE LVLF      SVLVLF
     C                     MOVE ETYF      SVETYF
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARSECCDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVSCS
      *****************************************************************
      *                                                               *
      *  SAVSCS - Save Security Customer Key fields                   *
      *                                                               *
      *  Called By: DTSCCS                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVSCS    BEGSR                           *** SAVSCS ***
     C                     MOVE CSTL      SVCSTL
     C                     MOVE BOKH      SVBOKH
     C                     MOVE LVLH      SVLVLH
     C                     MOVE ETYH      SVETYH
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARSECSDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVSSC
      *****************************************************************
      *                                                               *
      *  SAVSSC - Save Security Security Key fields                   *
      *                                                               *
      *  Called By: DTSCSC                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVSSC    BEGSR                           *** SAVSSC ***
     C                     MOVE SCTL      SVSCTL
     C                     MOVE BOKI      SVBOKI
     C                     MOVE LVLI      SVLVLI
     C                     MOVE ETYI      SVETYI
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARSESCDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/SAVSIV
      *****************************************************************
      *                                                               *
      *  SAVSIV - Save Security Investment Key fields                 *
      *                                                               *
      *  Called By: DTSCIV                                            *
      *  Calls:                                                       *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           SAVSIV    BEGSR                           *** SAVSIV ***
     C                     MOVE INTL      SVINTL
     C                     MOVE BOKG      SVBOKG
     C                     MOVE LVLG      SVLVLG
     C                     MOVE ETYG      SVETYG
     C*
     C* Save the indicators and initialise the Detail Report fields
     C*
     C                     MOVEA*IN,40    SAVIND  8
     C                     CLEARSEIVDT
     C                     MOVEASAVIND    *IN,40
     C*
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WP1END
      *****************************************************************
      *                                                               *
      *  WP1END - Subroutine to Write End of Report for Exposure      *
      *            Management                                         *
      *  Called By: Main Process Line                                 *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           WP1END    BEGSR                           *** WP1END ***
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITEDETHDG
     C                     ENDIF
      *
      ***  Write out End of Report record
      *
     C                     WRITETRAILPY
      *
      ***  End Program and Return.
      *
     C                     COMIT                                          139846
     C                     SETON                     LR
     C                     RETRN
      *
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WP2END
      *****************************************************************
      *                                                               *
      *  WP2END - Subroutine to Write End of Report for Dealing or    *
      *            All Modules                                        *
      *  Called By: Main Process Line                                 *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           WP2END    BEGSR                           *** WP2END ***
      *
      ***  Check that sufficient lines remain for the Format. If not,
      ***  write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     WRITESUBHD1
     C                     WRITESEIVH2
     C                     WRITESEIVH3
     C                     WRITEDETHDG
     C                     ENDIF
      *
      ***  Write out End of Report record
      *
     C                     WRITETRAILPY
      *
      ***  End Program and Return.
      *
     C                     COMIT                                          139846
     C                     SETON                     LR
     C                     RETRN
      *
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ER@BUR
      *****************************************************************
      *                                                               *
      *  ER@BUR - Error processing for Exposure Management Data       *
      *            Retrieval index                                    *
      *  Called By: EXPMNG                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ER@BUR    BEGSR                           *** ER@BUR ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'SDEXPML1'DBFILE           ************
     C                     Z-ADD019       DBASE            * DBERR 19 *
     C                     MOVELBUEXMK    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ERTB95
      *****************************************************************
      *                                                               *
      *  ERTB95 - Error processing SD Exposure Management ICD Record  *
      *            2 Table File                                       *
      *  Called By: EXPMNG                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERTB95    BEGSR                           *** ERTB95 ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'TABTB95 'DBFILE           ************
     C                     Z-ADD020       DBASE            * DBERR 20 *
     C                     MOVELLCCY      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/EREMLI
      *****************************************************************
      *                                                               *
      *  EREMLI - Error processing for EM Limits File Detail          *
      *                                                               *
      *  Called By: EXPMNG                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           EREMLI    BEGSR                           *** EREMLI ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'EMLIML2 'DBFILE           ************
     C                     Z-ADD009       DBASE            * DBERR 09 *
     C                     MOVELMLC       DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ER@BNR
      *****************************************************************
      *                                                               *
      *  ER@BNR - Error processing for SD Dealing Data Retrieval      *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ER@BNR    BEGSR                           *** ER@BNR ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'SDDEALL1'DBFILE           ************
     C                     Z-ADD010       DBASE            * DBERR 10 *
     C                     MOVELBNDLDA    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ERTB11
      *****************************************************************
      *                                                               *
      *  ERTB11 - Error processing Midas Table ICD Record 2           *
      *                                                               *
      *  Called By: DELLEN                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERTB11    BEGSR                           *** ERTB11 ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *IN91     OREQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'TABTB11 'DBFILE           ************
     C                     Z-ADD021       DBASE            * DBERR 21 *
     C                     MOVELBCYL      DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ER@DZT
      *****************************************************************
      *                                                               *
      *  ER@DZT - Error processing for SD Client Limits File          *
      *                                                               *
      *  Called By: DTDLCL                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ER@DZT    BEGSR                           *** ER@DZT ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELDZLEVL    WORK4   4
     C                     MOVE DZBCCD    WORK4
     C                     MOVEL'SDCLLML1'DBFILE           ************
     C                     Z-ADD011       DBASE            * DBERR 11 *
     C                     MOVELDZCUST    DBKEY            ************
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ER@DXN
      *****************************************************************
      *                                                               *
      *  ER@DXN - Error processing for SD Country Limits File         *
      *                                                               *
      *  Called By: DTDLCN                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ER@DXN    BEGSR                           *** ER@DXN ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELDXLEVL    WORK4
     C                     MOVE DXBCCD    WORK4
     C                     MOVEL'SDCNLML1'DBFILE           ************
     C                     Z-ADD012       DBASE            * DBERR 12 *
     C                     MOVELDXCNCD    DBKEY            ************
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ER@DYQ
      *****************************************************************
      *                                                               *
      *  ER@DYQ - Error processing for SD Region  Limits File         *
      *                                                               *
      *  Called By: DTDLRG                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ER@DYQ    BEGSR                           *** ER@DYQ ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELDYLEVL    WORK4
     C                     MOVE DYBCCD    WORK4
     C                     MOVEL'SDCNLML1'DBFILE           ************
     C                     Z-ADD013       DBASE            * DBERR 13 *
     C                     MOVELDYRGCD    DBKEY            ************
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ERSLIE
      *****************************************************************
      *                                                               *
      *  ERSLIE - Error processing for SE Country Limits Detail File  *
      *                                                               *
      *  Called By: DTSCCN                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERSLIE    BEGSR                           *** ERSLIE ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELCTYL      WORK4
     C                     MOVE BOKE      WORK4
     C                     MOVEL'SLIME   'DBFILE           ************
     C                     Z-ADD014       DBASE            * DBERR 14 *
     C                     MOVELWORK4     DBKEY            ************
     C                     MOVELLVLE      WORK4
     C                     MOVE ETYE      WORK4
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ERSLIF
      *****************************************************************
      *                                                               *
      *  ERSLIF - Error processing for SE Currency Limits Detail File *
      *                                                               *
      *  Called By: DTSCCC                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERSLIF    BEGSR                           *** ERSLIF ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELCNCL      WORK5   5
     C                     MOVE BOKF      WORK5
     C                     MOVEL'SLIMF   'DBFILE           ************
     C                     Z-ADD015       DBASE            * DBERR 15 *
     C                     MOVELWORK5     DBKEY            ************
     C                     MOVELLVLF      WORK4
     C                     MOVE ETYF      WORK4
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ERSLIH
      *****************************************************************
      *                                                               *
      *  ERSLIH - Error processing for SE Customer Limits Detail File *
      *                                                               *
      *  Called By: DTSCCS                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERSLIH    BEGSR                           *** ERSLIH ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELCSTL      WORK8   8
     C                     MOVE BOKH      WORK8
     C                     MOVEL'SLIMH   'DBFILE           ************
     C                     Z-ADD016       DBASE            * DBERR 16 *
     C                     MOVELWORK8     DBKEY            ************
     C                     MOVELLVLH      WORK4
     C                     MOVE ETYH      WORK4
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ERSLII
      *****************************************************************
      *                                                               *
      *  ERSLII - Error processing for SE Security Limits Detail File *
      *                                                               *
      *  Called By: DTSCSC                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERSLII    BEGSR                           *** ERSLII ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELSCTL      WORK12 12
     C                     MOVE BOKI      WORK12
     C                     MOVEL'SLIMI   'DBFILE           ************
     C                     Z-ADD017       DBASE            * DBERR 17 *
     C                     MOVELWORK12    DBKEY            ************
     C                     MOVELLVLI      WORK4
     C                     MOVE ETYI      WORK4
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *
      *****************************************************************
      /TITLE SR/ERSLIG
      *****************************************************************
      *                                                               *
      *  ERSLIG - Error processing for SE Investment  Limits Detail   *
      *                                                               *
      *  Called By: DTSCIV                                            *
      *  Calls: *PSSR                                                 *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           ERSLIG    BEGSR                           *** ERSLIG ***
      ** If database error, return to calling program
     C           *IN90     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVELINTL      WORK5
     C                     MOVE BOKG      WORK5
     C                     MOVEL'SLIMG   'DBFILE           ************
     C                     Z-ADD018       DBASE            * DBERR 18 *
     C                     MOVELWORK5     DBKEY            ************
     C                     MOVELLVLG      WORK4
     C                     MOVE ETYG      WORK4
     C                     MOVE WORK4     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Output Audit report and End Program.  *
      *                                                               *
      *  Called By: Main Processing, PROCES, *PSSR                    *
      *  Calls: None.                                                 *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR                           *** AUDIT  ***
      *
      ***  Output Report Header and File Controls.
      *
     C                     WRITEHEADAU
     C                     WRITECONTROL
      *
      ***  If there is a DB Error, Output the DB Error Information.
      *
     C           *INU7     IFEQ *ON
     C                     WRITEDBERROR
     C                     ELSE
      *
      ***  Or, if no records read, Output "No Details" message.
      *
     C           RCOUNT    IFEQ 0
     C                     WRITENODTLS
     C                     ENDIF
     C                     ENDIF
      *
      ***  End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Error control subroutine                            *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR **
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
     C                     OPEN EU0410AU
     C*
      *
     C                     EXSR RCFAU
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     EXSR AUDIT
     C                     CLOSEEU0410AU
     C                     ENDIF
      *
      ***  If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/ZCCYCN
     C/COPY ZSRSRC,ZCCYCN
      /TITLE SR/ZDATE1
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZDAYS
     C*COPY ZSRSRC,ZDAYSZ2
      /TITLE SR/ZSEDIT
     C*COPY ZSRSRC,ZSEDITZ3
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
