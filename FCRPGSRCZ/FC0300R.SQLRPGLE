     H DATEDIT(*YMD)
      *****************************************************************
/**** *  RPGBASE                                                      *                     MD055265
/*STD *  RPGSQLBND                                                    *                     MD055265
/*EXI *  TEXT('Midas FC Edit report descriptions')
     H/TITLE Edit Report Descriptions  Edit record(1 screen)
     F* CRTRPGPGM
      *
     H* SYNOPSIS :
     H* - Maintain DBF file records, one at a time.
     H* - Existing records may be updated or deleted.
     H* - New records may be added.
     H* - Key changes are not allowed.
     H* Generated by  : Synon/2  Version:  8646
     H* Function type : Edit record(1 screen)  Version:   0.1
      *
     H* Company    : Report Control Facility Model
     H* System     : Report Control Facility Model
     H* User name  : F6875SY
     H* Date       : 06/04/90 time: 15:18:26
      *  (c) Finastra International Limited 2001                      *
     H*
      *================================================================
     F* Maintenance   :
      *================================================================
      * Standard RPG Creation PAR - standard functions  *
     F*****************************************************************
     F*                                                               *
      *  Last Amend No. MD056040           Date 29Jun20               (
      *  Prev Amend No. MD055265           Date 10Feb20               *
      *                 MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 178120             Date 31Aug00               *
      * Midas DBA 3.01 -----------------------------------------------*
     F*                 CPB001             Date 02Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             DATE  08Mar99              *
     F*                 157552             DATE  14APR99              *
     F*                 CTI001             DATE  22JUL97              *
     F*                 S01408             DATE  10APR95              *
     F*                 081700             DATE  15MAR95              *
     F*                 S01486             DATE  02JUN94              *
     F*                 S01522             DATE  25NOV94              *
     F*                 S01493             DATE  02JUN94              *
     F*                 027055             DATE  02AUG93              *
     F*                 S01407             DATE  26JAN93              *
     F*                 S01393             DATE  06OCT92              *
     F*                     S10736        DATE  16OCT92               *
     F*                     S01269        DATE  19FEB92               *
     F*                     S01319        DATE  15JAN92               *
     F*                     S01310        DATE  29JUL91               *
     F*                     LN1190        DATE  29APR91               *
     F*                     LN1146        DATE  18APR91               *
     F*                     LN1069        DATE  07DEC90               *
     F*                     LN1037        DATE  27NOV90               *
     F*                     LN0828        DATE  04OCT90               *
     F*                     LN0680        DATE  07SEP90               *
     F*                     LN0587        DATE  01AUG90               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD056040 - Make description protected                        *
      *  MD055265 - Deliverable Data Split for Report Control Facility*
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*  178120 - Report Description levels should not be amendable   *
     F*           by users (who may assume that changeing the flag    *
     F*           will change the level the report is produced at) -  *
     F*           should be amendable only in 'BIS' mode.             *
     F*         - In Amend mode, pgm changes Dept Level and A/C       *
     F*           Officer Level to 'Y' if both are 'N' - this is      *
     F*           incorrect; remove part of 157552.                   *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  CPL002 - Midas-Plato Interface                               *
     F*  157552 - Database error when TI Postings Report or TI        *
     F*           Unprocessed Posting Report selected from Input      *
     F*           Cycle Reports menu.                                 *
     F*  CTI001 - Midas / Trade Innovation Interface Phase 1          *  *
     F*  S01408 - Core hook FC0300RVS1 added                             *
     F*  081700 - Module id 'HF' (HAF) added                          *
     F*  S01486 - ACCOUNT OFFICER AND DEPARTMENT LEVELS ADDED         *
     F*  S01522 - USER DEFINED CORRESPONDENCE                         *
     F*  S01493 - MIDAS EUREKA INTERFACE ADDED                        *
     F*  027055 - Module id 'IR' (FRA/IRS) should be allowed when     *
     F*           adding report descriptions.                         *
     F*      S01407 - SWITCHABILITY ENHANCEMENTS                      *
     F*      S01393 - RISK MANAGEMENT ADDED                           *
     F*      S10736 - MANAGEMENT ACCOUNTS                             *
      *      S01269 - Add more sub modules for SE                     *
      *      S01319 - Remove redundant processing                     *
      *               add modules TM,IC                               *
      *      S01310 - SWIFT RATIONALISATION                           *
     F*      LN1190 - REMOVE 'USR' MESSAGES AND REPLACE WITH 'RCF'    *
     F*               MESSAGES.                                       *
     F*      LN1146 - VALIDATE FIELDS IN ORDER OF APPEARANCE ON SCREEN*
     F*               AND DISPLAY ALL ERROR MESSAGES AT ONCE          *
     F*      LN1069 - ALLOW BOTH COB AND INPUT CYCLE AVAILABILITY     *
     F*               FLAGS TO BE 'N' TO ALLOW DEFINITION OF          *
     F*               MANDATORY REPORTS.                              *
     F*      LN1037 - READ FCSOUTL1 ONLY ONCE TO VALIDATE OUTPUT ID   *
     F*      LN0828 - SHOULD PRESS ENTER INSTEAD OF F12 TO GET PAST   *
     F*               2ND AND 3RD SCREENS; PERIODIC INDICATOR SHOULD  *
     F*               ONLY BE 'Y' IF COB INDICATOR IS ALSO 'Y'        *
     F*      LN0680 - STANDARDISE SCREEN APPEARANCE AND VALIDATION    *
     F*      LN0587 - COLLATION FLAG MOVED FROM REPT TO RSFX          *
     F*                                                               *
     F*****************************************************************
     F*Edit Report Descriptions Initialise Program F-spec
     F/COPY WNCPYSRC,FC0300RFPG
     FFC0300R#  CF   E             WORKSTN
     F                                     INFDS(INFDS#)
      * DSP: Edit Report Descriptions  Edit record(1 screen)
      *
     F***********FCREPTL1IF  E           K        DISK                    S01407
     F*FCREPTJ0* IF   E           K DISK                                         S01407     MD055265
     F**********                            INFDS(INFDS1)                                   MD055265
      * RTV: Report Descriptions       Retrieval index
      *
     FFCSOUTL1  IF   E           K DISK
      * RTV: Standard Output Insts     Retrieval index
      *
     F*FCRCOML1* IF   E           K DISK                                                    MD055265
      * RTV: Report Components         Retrieval index
      *
     F*FCRSFXL1* IF   E           K DISK                                                    MD055265
      * RTV: Report Suffix             Retrieval index
      *
     F*FCREPTL0* UF A E           K DISK                                                    MD055265
      * UPD: Report Descriptions       Update index
      *
     FFCRPDSL0  UF   E           K DISK
      * UPD: Report Descriptions Audit Update index
      *
     F*FCRCOML0* UF   E           K DISK                                                    MD055265
      * UPD: Report Components         Update index
      *
     F*FCRSFXL0* UF   E           K DISK                                                    MD055265
      * UPD: Report Suffix             Update index
      *
     FSCSARRL2  UF   E           K DISK                                         S01407
      * UPD: Switchable Features Report Name                              S01407
      *                                                                   S01407
     FSCSARML2  UF   E           K DISK                                         S01407
      * UPD: Switchable Features Report Component                         S01407
      *                                                                   S01407
     FSCSAROL2  UF   E           K DISK                                         S01407
      * UPD: Switchable Features Report Suffix                            S01407
      *                                                                   S01407
     D AENA            S             78    DIM(3) CTDATA PERRCD(1)
      *
     D ARGV            S             78    DIM(3) CTDATA PERRCD(1)
      *
     D*Edit Report Descriptions Initialise Program E-spec
     D/COPY WNCPYSRC,FC0300REPG
     D @CN             S             25    DIM(13) CTDATA PERRCD(1)             Long constants.
     D*Edit Report Descriptions Initialise Program I-spec
     D/COPY WNCPYSRC,FC0300RIPG
      /EJECT
      * Data structures:-
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Program data structure.
     D JBDTTM          DS
      * Job date/time.
     D  ##JDT                  1      6  0
     D  ##JYY                  1      2  0
     D  ##JMM                  3      4  0
     D  ##JDD                  5      6  0
     D  ##JTM                  7     12  0
     D  ##JHH                  7      8  0
     D  ##JNN                  9     10  0
     D  ##JSS                 11     12  0
     D INFDS#        E DS                  EXTNAME(Y2I#DSP)
      * Display file data structure.
      *
     D INFDS1        E DS                  EXTNAME(Y2I1DSP)
      * File information data structure.
      *
     D*@1DBRC***     E DS                  EXTNAME(FCREPTL0)                                MD055265
     D @1DBRC        E DS                  EXTNAME(FCREPJW0)                                MD055265
     D                                     PREFIX(@)                                        MD055265
      * Current/previous master file format fields for change control.
     D FCREPT        E DS                  EXTNAME(FCREPJW1)                                MD055265
     D FCREPTL       E DS                  EXTNAME(FCREPJW0)                                MD055265
     D                                     PREFIX(L)                                        MD055265
     D NullInds        s              5i 0 dim(19)                                          MD055265
     D FCRSFX        E DS                  EXTNAME(FCRSFJW0)                                MD055265
      *
     D*1DBRC******DS**************************** 84                       LN0587
     D***#1DBRC******DS                             83              LN0587S01486
     D*#1DBRC***       DS            85                                         S01486      MD055265
     D #1DBRC          DS            86                                         S01486      MD055265
      * Stored master file format fields.
     D  #1DB1                  1      1
      *
     D RUNDAT          DS
     D  RUNA                   1      7
     D  RUND                   8     10P 0
     D  SSF                   11     11
     D  DATF                  12     12
     D  MBIN                  13     13
      *                                                                   178120
     D @SDST         E DS                  EXTNAME(SDSTAT)                      178120
     D  MODEF                 50     50                                         178120
      /EJECT
      * Parameter declarations.
     D P1PARM          DS
      * B:    Action Code
     D  P1JTST                 1      1
     D P2PARM          DS            10
      * KEY: Report Descriptions       Retrieval index
      * B:MAP Report name
     D  P2RNAM                 1     10
     D                 DS
     D  ZAMSDA                 1    132
      * Message data for 'Warning: SOI not defined'
      * Default Output Id
     D  ZA0001                 1     10
      * Message data for 'Report level must be ent'
      * Bank-Level
     D  ZA0002                 1      1
      * Company-Level
     D  ZA0003                 2      2
      * Branch-level
     D  ZA0004                 3      3
     D*                                                                   S01486
     D** Department-level                                                 S01486
     D*                                                                   S01486
     D  ZA0007                 4      4                                         S01486
     D*                                                                   S01486
     D** Account-Officer-level                                            S01486
     D*                                                                   S01486
     D  ZA0008                 5      5                                         S01486
      * Message data for 'Phase of day must be ent'
      * Input Cycle
     D  ZA0005                 1      1
      * COB
     D  ZA0006                 2      2
     D FCRCOM        E DS                  EXTNAME(FCRCOJW0)                                MD055265
      /EJECT
      *****************************************************************
     C     *ENTRY        PLIST                                                  Entry parameter
     C                   PARM                    P0RTN             7            Return code
     C     P1JTST        PARM      P1JTST        WP0001            1            Action Code
     C                   PARM                    P2PARM                         KEY: Report Des
      *****************************************************************
      * Initialise
     C                   EXSR      ZZINIT
      *
      * Check passed parameters.
     C                   EXSR      FACKPM
      * Perform once if all passed, else repeat.
     C     W0RPT         DOUEQ     'N'
      * Display and process key screen.
     C                   EXSR      BADSKY
     C                   END
      * Terminate program.
     C                   EXSR      ZXEXPG
      *****************************************************************
      /EJECT
     CSR   BADSKY        BEGSR
      *================================================================
      * Display and process key screen.
      *================================================================
      * Initialise key screen
     C                   EXSR      MDIZ#K
      * Bypass first display of key screen is possible.
     C                   MOVEL     'Y'           W0BYP             1
      * Signal start of transaction.
     C                   MOVEL     'Y'           W0TRN             1
     C     W0TRN         DOWEQ     'Y'
     C     W0TRN         OREQ      'R'
      * Ensure transaction continues (if reset).
     C                   MOVEL     'Y'           W0TRN             1
      * Initialise detail screen.
     C                   EXSR      MAIZ#1
      * Conduct screen conversation:
     C     W0TRN         DOWEQ     'Y'
      * Is bypass key screen still viable?
     C     W0BYP         IFEQ      'Y'
     C     #1RNAM        IFEQ      *BLANK                                       Report name
      * One or more key field is blank.
     C                   MOVEL     'N'           W0BYP
     C                   END
     C                   END
      * Bypass key screen.
     C     W0BYP         IFNE      'Y'
      * Display key screen.
     C                   EXSR      BBEXFM
     C                   END
      * Cancel key screen bypass.
     C                   MOVEL     'N'           W0BYP
      * Process response to key screen:
      * Cancel & exit program.
     C   03              CAS                     ZXEXPG
      * Switch between *ADD/*CHANGE modes.
     C   09              CAS                     BCCHMD
      * HOME: Reset screen fields.
     C   05              CAS                     BDHMKY
      * Process key screen input.
     C                   CAS                     BEPRKY
     C                   END
      *
     C                   END
     C                   END
      *================================================================
     CSR   BAEXIT        ENDSR
      /EJECT
     CSR   BBEXFM        BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators.
     C                   EXSR      GADSAK
      * Update screen time.
     C                   TIME                    ##TME                          Screen time.
     C     W0HLP         DOUEQ     'N'
      * PUTOVR unless conditioned fields change.
     C                   SETON                                            86    *
     C     *IN89         IFNE      BBIN89
     C                   SETOFF                                           86    *
     C                   END
     C                   MOVE      *IN89         BBIN89            1
     C                   WRITE     #MSGCTL
     C                   WRITE     #CMDTXT1
     C                   EXFMT     #RCDKEY
     C                   MOVEL     'N'           W0HLP             1            Reset help requ
      * If help requested, display help text.
     C   25              EXSR      ZHHPKY                                       Display help te
     C                   END
      * Update job time.
     C                   TIME                    ##JTM                          Job time.
      * Clear messages from program message queue.
     C                   CALL      'Y2CLMSC'
     C                   PARM      ##PGM         ZAPGM            10
     C                   PARM      '*SAME'       ZAPGRL            5
      * Reset first message only flag.
     C                   MOVEL     'Y'           ZAFSMS            1
      * Reset global error indicator.
     C                   SETOFF                                           99    *
      *================================================================
     CSR   BBEXIT        ENDSR
      /EJECT
     CSR   BCCHMD        BEGSR
      *================================================================
      * Switch between ADD and CHANGE modes.
      *================================================================
     C     W0PMD         IFEQ      'ADD'
     C                   MOVEL     'CHG'         W0PMD             3
     C                   ELSE
     C                   MOVEL     'ADD'         W0PMD
     C                   END
      *================================================================
     CSR   BCEXIT        ENDSR
      /EJECT
     CSR   BDHMKY        BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                   MOVEL     'N'           W0TRN
      *================================================================
     CSR   BDEXIT        ENDSR
      /EJECT
     CSR   BEPRKY        BEGSR
      *================================================================
      * Process key screen.
      *================================================================
      * Validate key fields.
     C                   EXSR      BFVLKY
     C     *IN99         CABEQ     '1'           BEEXIT
      * Check for existing record.
     C     KRTV          KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Setup key.
     C                   MOVEL     #1RNAM        DXRNAM                         Report name
     C***********KRTV      CHAIN@DXREIK              9091  *              S01407
     C*****KRTV*         CHAIN     FCREPTD0                           9091      *     S0140 MD055265
     C******IN91         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPT :NullInds                                                              MD055265
     C+ from FCREPJW1                                                                       MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   IF        SQLCODE <> 0                                             MD055265
     C                             AND SQLCODE <> 100                                       MD055265
      * Record locked.
     C                   SETON                                        9931      *
     C                   GOTO      BEEXIT
     C                   END                                                    FI 91
      *
      * If record does not exist, flip to add mode.
     C******IN90         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE = 100                                            MD055265
     C                   MOVEL     'ADD'         W0PMD
      * USER: Initialise detail screen (new record)
      * Set-up DTL Screen Footer - standard functions  *
     C     P1JTST        IFEQ      'D'
     C                   MOVEA     AENA(1)       ##AENA
     C                   END
      *
     C     P1JTST        IFEQ      'A'
     C                   MOVEA     AENA(2)       ##AENA
     C                   END
      *
     C     P1JTST        IFEQ      'I'
     C                   MOVEA     AENA(3)       ##AENA
     C                   END
      *
     C                   MOVEL     @CN(01)       #1IPCY                         Input Cycle
     C                   MOVEL     @CN(01)       #1CLBP                         COB
     C                   MOVEL     @CN(01)       #1PDFL                         Periodic
     C*********************MOVEL@CN,01    #1COLT           Collation      LN0587
     C                   MOVEL     @CN(01)       #1GLVL                         Bank-Level
     C                   MOVEL     @CN(01)       #1CLVL                         Company-Level
     C                   MOVEL     @CN(01)       #1BLVL                         Branch-level
     C                   MOVEL     @CN(01)       #1DLVL                                        S0148
     C                   MOVEL     @CN(01)       #1ALVL                                        S0148
     C                   MOVEL     @CN(01)       #1MIDQ                         Midas/Q
     C*                                                                   157552
     C* For Single branch companies these five levels should not apply    157552
     C* leave them blank.                                                 157552
     C*                                                                   157552
     C     MBIN          IFEQ      'N'                                                         15755
     C                   MOVEL     *BLANK        #1GLVL                         Bank-Level     15755
     C                   MOVEL     *BLANK        #1CLVL                         Company-Level  15755
     C                   MOVEL     *BLANK        #1BLVL                         Branch-level   15755
     C                   MOVEL     *BLANK        #1DLVL                                        15755
     C                   MOVEL     *BLANK        #1ALVL                                        15755
     C                   END                                                                   15755
     C*                                                                   157552
      * 00/copy member XX0300RISN - Report Descriptions  *
     C*Edit Report Descriptions Initialise Dtl New Rcd
     C/COPY WNCPYSRC,FC0300RISN
     C                   ELSE
      * If record does exist, flip to change mode.
     C                   MOVEL     'CHG'         W0PMD
      * Load screen fields from DBF.
     C                   EXSR      MBFL#1
      * CALC: Detail screen function fields
      * 00/copy member XX0300RSFF - Report Descriptions  *
     C*Edit Report Descriptions Calc Detail Function Flds
     C/COPY WNCPYSRC,FC0300RSFF
      * USER: Initialise detail screen (existing record)
      * Set-up DTL Screen Footer - standard functions  *
     C     P1JTST        IFEQ      'D'
     C                   MOVEA     AENA(1)       ##AENA
     C                   END
     C     P1JTST        IFEQ      'A'
     C                   MOVEA     AENA(2)       ##AENA
     C                   END
     C     P1JTST        IFEQ      'I'
     C                   MOVEA     AENA(3)       ##AENA
     C                   END
      * 00/copy member XX0300RISE - Report Descriptions  *
     C*Edit Report Descriptions Initialise Dtl Exist Rcd
     C/COPY WNCPYSRC,FC0300RISE
     C                   END
      *.................................................
     C   99              GOTO      BEEXIT
      * No errors: Display and process details
     C                   EXSR      CADSDA
      *
      *================================================================
     CSR   BEEXIT        ENDSR
      /EJECT
     CSR   BFVLKY        BEGSR
      *================================================================
      * Validate key fields.
      *================================================================
     C     W0PMD         IFNE      'ADD'
      * Select existing record.
     C                   EXSR      VACKRL
     C                   END
      * USER: Validate key screen
      *CASE:     KEY.*CMD key is *Key screen
     C     *IN12         IFEQ      '1'                                          *IF
     C                   MOVEL     @CN(02)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
      *CASE:     PAR.Action Code is Insert
     C     P1JTST        IFEQ      @CN(03)                                      *IF
      * Retrieve Report Descriptn - Report Descriptions  *
     C                   EXSR      SARVGN
      *CASE:     PGM.*Return code is *Record already exists
     C     W0RTN         IFEQ      @CN(05)                                      *IF
      * Send message '*Record already exists'
     C                   MOVEL     'Y2U0003'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   SETON                                        99        *
      *
     C                   ELSE
      *CASE:     *OTHERWISE
     C                   MOVEL     #1RNAM        WURNAM                         Report name
     C                   END                                                    *FI
     C                   MOVEL     *BLANK        W0RTN                          *Return code
     C                   END                                                    *FI
      * 00/copy member XX0300RVKS - Report Descriptions  *
     C*Edit Report Descriptions Validate Key Screen
     C/COPY WNCPYSRC,FC0300RVKS
      * Report name required.
     C     #1RNAM        IFEQ      *BLANK                                       IF
     C                   SETON                                        9931      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END                                                    FI
      *================================================================
     CSR   BFEXIT        ENDSR
      /EJECT
     CSR   CADSDA        BEGSR
      *================================================================
      * Display and process details.
      *================================================================
      * Conduct detail screen conversation:
      * - repeat until screen control flag is reset:
     C     W0TRN         DOWEQ     'Y'
      * Display detail screen.
     C                   EXSR      CBEXFM
      * Process response to detail screen:
      * Cancel & exit program.
     C   03              CAS                     ZXEXPG
      * Redisplay previous screen
     C   12              CAS                     CCDSPV
      * Process detail screen input.
     C                   CAS                     CFPRSC
     C                   END
      *
     C                   END
      *================================================================
     CSR   CAEXIT        ENDSR
      /EJECT
     CSR   CBEXFM        BEGSR
      *================================================================
      * Display screen and process HELP requests.
      *================================================================
      * Set screen conditioning indicators.
     C                   EXSR      GBDSAD
      * Update screen time.
     C                   TIME                    ##TME                          Screen time.
     C     W0HLP         DOUEQ     'N'
      * PUTOVR unless conditioned fields change.
     C                   SETON                                            86    *
     C     *IN89         IFNE      CBIN89
     C                   SETOFF                                           86    *
     C                   END
     C                   MOVE      *IN89         CBIN89            1
     C                   WRITE     #MSGCTL
     C                   WRITE     #CMDTXT2
     C                   EXFMT     #RCDDTL1
     C                   MOVEL     'N'           W0HLP             1            Reset help requ
      * If help requested, display help text.
     C   25              EXSR      ZHHPKY                                       Display help te
     C                   END
      * Update job time.
     C                   TIME                    ##JTM                          Job time.
      * Clear messages from program message queue.
     C                   CALL      'Y2CLMSC'
     C                   PARM      ##PGM         ZAPGM            10
     C                   PARM      '*SAME'       ZAPGRL            5
      * Reset first message only flag.
     C                   MOVEL     'Y'           ZAFSMS            1
      * Reset global error indicator.
     C                   SETOFF                                           99    *
      *================================================================
     CSR   CBEXIT        ENDSR
      /EJECT
     CSR   CCDSPV        BEGSR
      *================================================================
      * Redisplay previous screen.
      *================================================================
      * USER: Process key screen request
      *CASE:     PAR.Action Code is not insert
     C     P1JTST        IFEQ      @CN(06)                                      *IF
     C     P1JTST        OREQ      @CN(07)
     C     P1JTST        OREQ      @CN(08)
     C                   MOVEL     @CN(02)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
      * 00/copy member XX0300RPKR - Report Descriptions  *
     C*Edit Report Descriptions Process Key Screen Rqst
     C/COPY WNCPYSRC,FC0300RPKR
     C                   MOVEL     'R'           W0TRN
      *================================================================
     CSR   CCEXIT        ENDSR
      /EJECT
     CSR   CFPRSC        BEGSR
      *================================================================
      * Validate record.
      *================================================================
      * Confirm/update is not defered.
     C                   MOVEL     'N'           W0DCF             1
      * If delete is not pending....
      * Validate details.
     C  N10              CAS                     DCVLDL
     C                   END
      * Quit if error:
     C   99              GOTO      CFEXIT
      * Defer confirm/update requested:
     C     W0DCF         CABEQ     'Y'           CFEXIT
      * No error: Update record:
     C                   EXSR      EBPR##
      *================================================================
     CSR   CFEXIT        ENDSR
      /EJECT
     CSR   DCVLDL        BEGSR
      *================================================================
      * Validate details.
      *================================================================
      * Validate Module
      * Name search required ?
     C                   MOVEL     #1CMOD        W0NSRQ            1            Module
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100155       Y2LSNO            7 0          List number.
     C     #1CMOD        PARM      #1CMOD        W0EXVL           20            Module
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Midas/Q
      * Name search required ?
     C                   MOVEL     #1MIDQ        W0NSRQ            1            Midas/Q
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100534       Y2LSNO            7 0          List number.
     C     #1MIDQ        PARM      #1MIDQ        W0EXVL           20            Midas/Q
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Bank-Level
      * Name search required ?
     C                   MOVEL     #1GLVL        W0NSRQ            1            Bank-Level
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100223       Y2LSNO            7 0          List number.
     C     #1GLVL        PARM      #1GLVL        W0EXVL           20            Bank-Level
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Company-Level
      * Name search required ?
     C                   MOVEL     #1CLVL        W0NSRQ            1            Company-Level
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100227       Y2LSNO            7 0          List number.
     C     #1CLVL        PARM      #1CLVL        W0EXVL           20            Company-Level
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Branch-level
      * Name search required ?
     C                   MOVEL     #1BLVL        W0NSRQ            1            Branch-level
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100231       Y2LSNO            7 0          List number.
     C     #1BLVL        PARM      #1BLVL        W0EXVL           20            Branch-level
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
     C*                                                                   S01486
     C** Validate Department-Level                                        S01486
     C** Name search required ?                                           S01486
     C*                                                                   S01486
     C                   MOVEL     #1DLVL        W0NSRQ            1                           S0148
     C     W0NSRQ        IFEQ      '?'                                                         S0148
     C                   CALL      'FCVLLSR'                            90                     S0148
     C                   PARM                    W0RTN             7                           S0148
     C                   PARM      1100273       Y2LSNO            7 0                         S0148
     C     #1DLVL        PARM      #1DLVL        W0EXVL           20                           S0148
     C                   MOVEL     'Y'           W0DCF             1                           S0148
     C                   END                                                                   S0148
     C*                                                                   S01486
     C** Validate Account-Officer-level                                   S01486
     C** Name search required ?                                           S01486
     C*                                                                   S01486
     C                   MOVEL     #1ALVL        W0NSRQ            1                           S0148
     C     W0NSRQ        IFEQ      '?'                                                         S0148
     C                   CALL      'FCVLLSR'                            90                     S0148
     C                   PARM                    W0RTN             7                           S0148
     C                   PARM      1100275       Y2LSNO            7 0                         S0148
     C     #1ALVL        PARM      #1ALVL        W0EXVL           20                           S0148
     C                   MOVEL     'Y'           W0DCF             1                           S0148
     C                   END                                                                   S0148
      * Validate Input Cycle
      * Name search required ?
     C                   MOVEL     #1IPCY        W0NSRQ            1            Input Cycle
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100235       Y2LSNO            7 0          List number.
     C     #1IPCY        PARM      #1IPCY        W0EXVL           20            Input Cycle
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate COB
      * Name search required ?
     C                   MOVEL     #1CLBP        W0NSRQ            1            COB
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100239       Y2LSNO            7 0          List number.
     C     #1CLBP        PARM      #1CLBP        W0EXVL           20            COB
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Periodic
      * Name search required ?
     C                   MOVEL     #1PDFL        W0NSRQ            1            Periodic
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100243       Y2LSNO            7 0          List number.
     C     #1PDFL        PARM      #1PDFL        W0EXVL           20            Periodic
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * Validate Collation
      **Name*search*required*?******                                      LN0587
     C***************      MOVEL#1COLT    W0NSRQ  1        Collation      LN0587
     C***********W0NSRQ    IFEQ '?'                        Search requiredLN0587
     C***************      CALL 'FCVLLSR'              90  *              LN0587
     C***************      PARM           W0RTN   7        Return code    LN0587
     C***************      PARM 1100247   Y2LSNO  70       List number.   LN0587
     C********** #1COLT    PARM #1COLT    W0EXVL 20        Collation      LN0587
     C***************      MOVEL'Y'       W0DCF   1        Defer confirm  LN0587
     C***************      END                                            LN0587
      * USER: Validate detail screen fields
     C*                                                                   LN0828
     C** PERIODIC INDICATOR CAN ONLY BE 'Y' IF COB INDICATOR IS 'Y'       LN0828
     C*                                                                   LN0828
     C     #1PDFL        IFEQ      'Y'                                                         LN082
     C     #1CLBP        ANDNE     'Y'                                                         LN082
     C                   MOVEL     'RCF0070'     ZAMSID                                        LN082
     C                   EXSR      ZASNMS                                                      LN082
     C                   SETON                                        3999                     LN082
     C                   END                                                                   LN082
     C*                                                                   LN0828
      *CASE:     PAR.Action Code is Delete
     C     P1JTST        IFEQ      @CN(07)                                      *IF
      * Send message 'F3/F10/F12 only valid opt'
     C                   MOVEL     'RCF0033'     ZAMSID                         Message id.
     C                   EXSR      ZASNMS                                       Send message
     C                   SETON                                        99        *
      *
     C                   MOVEL     @CN(09)       W0DCF                          *Defer confirm
     C                   END                                                    *FI
     C*                                                                   LN0680
     C*  MODULE FIELD - CHECK FOR VALID VALUES                            LN0680
     C*                                                                   LN0680
     C     #1CMOD        IFNE      'RC'                                                        LN068
     C     #1CMOD        ANDNE     'CN'                                                        LN068
     C     #1CMOD        ANDNE     'CL'                                                        LN068
     C     #1CMOD        ANDNE     'LE'                                                        LN068
     C     #1CMOD        ANDNE     'DL'                                                        LN068
     C     #1CMOD        ANDNE     'AB'                                                        LN068
     C     #1CMOD        ANDNE     'CM'                                                        LN068
     C     #1CMOD        ANDNE     'FM'                                                        LN068
     C     #1CMOD        ANDNE     'FX'                                                        LN068
     C     #1CMOD        ANDNE     'MM'                                                        LN068
     C     #1CMOD        ANDNE     'FD'                                                        LN068
     C     #1CMOD        ANDNE     'EM'                                                        LN068
     C     #1CMOD        ANDNE     'FF'                                                        LN068
     C     #1CMOD        ANDNE     'FT'                                                        LN068
     C     #1CMOD        ANDNE     'GL'                                                        LN068
     C     #1CMOD        ANDNE     'RI'                                                        LN068
     C     #1CMOD        ANDNE     'MS'                                                        LN068
     C     #1CMOD        ANDNE     'NM'                                                        LN068
     C     #1CMOD        ANDNE     'RE'                                                        LN068
     C     #1CMOD        ANDNE     'SE'                                                        LN068
     C     #1CMOD        ANDNE     'MA'                                                        LN068
     C     #1CMOD        ANDNE     'S3'                                                        LN068
     C     #1CMOD        ANDNE     'S5'                                                        LN068
     C     #1CMOD        ANDNE     'S4'                                                        LN068
     C     #1CMOD        ANDNE     'S8'                                                        LN068
     C     #1CMOD        ANDNE     'S2'                                                        LN068
     C     #1CMOD        ANDNE     'S6'                                                        LN068
     C     #1CMOD        ANDNE     'MT'                                                        LN068
     C     #1CMOD        ANDNE     'S7'                                                        LN068
     C     #1CMOD        ANDNE     'SD'                                                        LN068
     C     #1CMOD        ANDNE     'CF'                                                        S0131
     C     #1CMOD        ANDNE     'MG'                                                        S0131
     C     #1CMOD        ANDNE     'ME'                                                        S0131
     C     #1CMOD        ANDNE     'TM'                                                        S0131
     C     #1CMOD        ANDNE     'IC'                                                        S0131
     C     #1CMOD        ANDNE     'S1'                                                        S0126
     C     #1CMOD        ANDNE     'S9'                                                        S0126
     C     #1CMOD        ANDNE     'MC'                                                        S1073
     C     #1CMOD        ANDNE     'RM'                                                        S0139
     C     #1CMOD        ANDNE     'IR'                                                        02705
     C     #1CMOD        ANDNE     'ED'                                                        S0149
     C     #1CMOD        ANDNE     'CG'                                                        S0152
     C     #1CMOD        ANDNE     'PM'                                                        S0148
     C     #1CMOD        ANDNE     'LB'                                                        S0148
     C     #1CMOD        ANDNE     'HF'                                                        08170
     C     #1CMOD        ANDNE     'TI'                                                        CTI00
     C     #1CMOD        ANDNE     'PL'                                                        CPL00
     C     #1CMOD        ANDNE     'PB'                                                        CPB00
     C*                                                                   S01408
     C/COPY WNCPYSRC,FC0300RVS1                                           S01408
     C*                                                                   S01408
     C                   MOVEL     'RCF0062'     ZAMSID                                        LN068
     C                   SETON                                        3299                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
      *CASE:     DTL.Midas/Q is blank                                     LN1146
     C     #1MIDQ        IFEQ      *BLANK                                       *IF            LN114
     C                   MOVEL     @CN(01)       #1MIDQ                         Midas/Q        LN114
     C*                                                                   LN1146
     C                   ELSE                                                                  LN114
     C*                                                                   LN1146
     C*  MIDAS/Q FIELD - CHECK FOR VALID VALUES                           LN1146
     C*                                                                   LN1146
     C     #1MIDQ        IFNE      'Y'                                                         LN114
     C     #1MIDQ        ANDNE     'N'                                                         LN114
     C                   MOVEL     'RCF0055'     ZAMSID                                        LN114
     C                   SETON                                        3399                     LN114
     C                   EXSR      ZASNMS                                                      LN114
     C                   END                                                                   LN114
     C*                                                                   LN1146
     C                   END                                                    *FI            LN114
     C*                                                                   157552
     C* Do the following test if multi branch company only.               157552
     C*                                                                   157552
     C     MBIN          IFEQ      'Y'                                                         15755
     C*                                                                   157552
      *CASE:     DTL.Bank-Level is blank
     C     #1GLVL        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1GLVL                         Bank-Level
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  BANK-LEVEL FIELD - CHECK FOR VALID VALUES                        LN0680
     C*                                                                   LN0680
     C     #1GLVL        IFNE      'Y'                                                         LN068
     C     #1GLVL        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0056'     ZAMSID                                        LN068
     C                   SETON                                        3499                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
      *CASE:     DTL.Company-Level is blank
     C     #1CLVL        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1CLVL                         Company-Level
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  COMPANY-LEVEL FIELD - CHECK FOR VALID VALUES                     LN0680
     C*                                                                   LN0680
     C     #1CLVL        IFNE      'Y'                                                         LN068
     C     #1CLVL        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0057'     ZAMSID                                        LN068
     C                   SETON                                        3599                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
      *CASE:     DTL.Branch-level is blank
     C     #1BLVL        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1BLVL                         Branch-level
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  BRANCH-LEVEL FIELD - CHECK FOR VALID VALUES                      LN0680
     C*                                                                   LN0680
     C     #1BLVL        IFNE      'Y'                                                         LN068
     C     #1BLVL        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0058'     ZAMSID                                        LN068
     C                   SETON                                        3699                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
     C*                                                                   S01486
     C** CASE:     DTL.Department-Level is blank                          S01486
     C*                                                                   S01486
     C     #1DLVL        IFEQ      *BLANK                                                      S0148
     C                   MOVEL     @CN(01)       #1DLVL                                        S0148
     C*                                                                   S01486
     C                   ELSE                                                                  S0148
     C*                                                                   S01486
     C** Department-LEVEL FIELD - CHECK FOR VALID VALUES                  S01486
     C*                                                                   S01486
     C     #1DLVL        IFNE      'Y'                                                         S0148
     C     #1DLVL        ANDNE     'N'                                                         S0148
     C                   MOVEL     'RCF0071'     ZAMSID                                        S0148
     C                   SETON                                        4299                     S0148
     C                   EXSR      ZASNMS                                                      S0148
     C                   END                                                                   S0148
     C*                                                                   S01486
     C                   END                                                                   S0148
     C*                                                                   S01486
     C** CASE:     DTL.Account-Officer-level is blank                     S01486
     C*                                                                   S01486
     C     #1ALVL        IFEQ      *BLANK                                                      S0148
     C                   MOVEL     @CN(01)       #1ALVL                                        S0148
     C*                                                                   S01486
     C                   ELSE                                                                  S0148
     C*                                                                   S01486
     C** Account-Officer-LEVEL FIELD - CHECK FOR VALID VALUES             S01486
     C*                                                                   S01486
     C     #1ALVL        IFNE      'Y'                                                         S0148
     C     #1ALVL        ANDNE     'N'                                                         S0148
     C                   MOVEL     'RCF0072'     ZAMSID                                        S0148
     C                   SETON                                        4399                     S0148
     C                   EXSR      ZASNMS                                                      S0148
     C                   END                                                                   S0148
     C*                                                                   S01486
     C                   END                                                                   S0148
     C*                                                                   157552
     C                   END                                                                   15755
     C*                                                                   157552
      *CASE:     DTL.Input Cycle is blank
     C     #1IPCY        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1IPCY                         Input Cycle
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  INPUT CYCLE FIELD - CHECK FOR VALID VALUES                       LN0680
     C*                                                                   LN0680
     C     #1IPCY        IFNE      'Y'                                                         LN068
     C     #1IPCY        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0059'     ZAMSID                                        LN068
     C                   SETON                                        3799                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
      *CASE:     DTL.COB is blank
     C     #1CLBP        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1CLBP                         COB
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  COB FIELD - CHECK FOR VALID VALUES                               LN0680
     C*                                                                   LN0680
     C     #1CLBP        IFNE      'Y'                                                         LN068
     C     #1CLBP        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0060'     ZAMSID                                        LN068
     C                   SETON                                        3899                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
      *CASE:     DTL.Periodic is blank
     C     #1PDFL        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(01)       #1PDFL                         Periodic
     C*                                                                   LN0680
     C                   ELSE                                                                  LN068
     C*                                                                   LN0680
     C*  PERIODIC FIELD - CHECK FOR VALID VALUES                          LN0680
     C*                                                                   LN0680
     C     #1PDFL        IFNE      'Y'                                                         LN068
     C     #1PDFL        ANDNE     'N'                                                         LN068
     C                   MOVEL     'RCF0061'     ZAMSID                                        LN068
     C                   SETON                                        3999                     LN068
     C                   EXSR      ZASNMS                                                      LN068
     C                   END                                                                   LN068
     C*                                                                   LN0680
     C                   END                                                    *FI
      *CASE:*****DTL.Collation*is*blank***************                    LN0587
     C********** #1COLT    IFEQ *BLANK                     *IF            LN0587
     C******************** MOVEL@CN,01    #1COLT           Collation      LN0587
     C******************** END                             *FI            LN0587
      *CASE:*****DTL.Midas/Q is blank                                     LN1146
     C***********#1MIDQ    IFEQ *BLANK                     *IF            LN1146
     C***********          MOVEL@CN,01    #1MIDQ           Midas/Q        LN1146
     C***********                                                  LN0680 LN1146
     C***********          ELSE                                    LN0680 LN1146
     C***********                                                  LN0680 LN1146
     C***MIDAS/Q*FIELD - CHECK FOR VALID VALUES                    LN0680 LN1146
     C***********                                                  LN0680 LN1146
     C***********#1MIDQ    IFNE 'Y'                                LN0680 LN1146
     C***********#1MIDQ    ANDNE'N'                                LN0680 LN1146
     C***********          MOVEL'RCF0055' ZAMSID                   LN0680 LN1146
     C***********          SETON                     3399          LN0680 LN1146
     C***********          EXSR ZASNMS                             LN0680 LN1146
     C***********          END                                     LN0680 LN1146
     C***********                                                  LN0680 LN1146
     C***********          END                             *FI            LN1146
      *CASE:     DTL.Default Output Id is not blank
     C     #1DFTO        IFNE      *BLANK                                       *IF
      *CASE:     DTL.Default Output Id NE WRK.Default Output Id
     C     #1DFTO        IFNE      WUDFTO                                       *IF
     C                   MOVEL     #1DFTO        WUSOID                         Instruction Ide
      * Check SOI Exist & message
      * Check SOI Exist - Standard Output Insts  *
     C                   EXSR      SBRVGN
      *CASE:     PGM.*Return code is *Record does not exist
     C     W0RTN         IFEQ      @CN(04)                                      *IF
      * Setup message data for message.
     C                   MOVEL     #1DFTO        ZA0001                         Default Output
      * Send message 'Warning: SOI not defined'
     C                   MOVEL     'RCF0050'     ZAMSID                         Message id.
     C                   EXSR      ZASNMS                                       Send message
     C                   SETON                                        9941      *
      *
     C                   END                                                    *FI
     C                   MOVEL     #1DFTO        WUDFTO                         Default Output
     C                   END                                                    *FI
     C                   END                                                    *FI
      * 00/copy member XX0300RVSF - Report Descriptions  *
     C*Edit Report Descriptions Validate Detail Screen
     C/COPY WNCPYSRC,FC0300RVSF
      * CALC: Detail screen function fields
      * 00/copy member XX0300RSFF - Report Descriptions  *
     C*Edit Report Descriptions Calc Detail Function Flds
     C/COPY WNCPYSRC,FC0300RSFF
      * USER: Validate detail screen relations
      *CASE:*****WRK.Multi-branching*Indicator*is*Multibranch*system******S01486
     C***********WUMBIN    IFEQ @CN,09                     *IF            S01486
     C*                                                                   157552
     C* Only applies to Multi branch companies re instate check.          157552
     C*                                                                   157552
     C     WUMBIN        IFEQ      @CN(09)                                      *IF            15755
      *CASE:     DTL.Bank-Level is No
     C     #1GLVL        IFEQ      @CN(01)                                      *IF
      *CASE:     DTL.Company-Level is No
     C     #1CLVL        IFEQ      @CN(01)                                      *IF
      *CASE:     DTL.Branch-level is No
     C     #1BLVL        IFEQ      @CN(01)                                      *IF
     C     #1DLVL        ANDEQ     @CN(01)                                                     S0148
     C     #1ALVL        ANDEQ     @CN(01)                                                     S0148
      * Setup message data for message.
     C                   MOVEL     #1GLVL        ZA0002                         Bank-Level
     C                   MOVEL     #1CLVL        ZA0003                         Company-Level
     C                   MOVEL     #1BLVL        ZA0004                         Branch-level
     C                   MOVEL     #1DLVL        ZA0007                                        S0148
     C                   MOVEL     #1ALVL        ZA0008                                        S0148
      * Send message 'Report level must be ent'
     C                   MOVEL     'RCF0005'     ZAMSID                         Message id.
     C                   EXSR      ZASNMS                                       Send message
     C                   SETON                                        993435    *
     C                   SETON                                        36        *
     C                   SETON                                        4243                     S0148
      *
     C                   END                                                    *FI
     C                   END                                                    *FI
     C                   END                                                    *FI
     C***********          END                             *FI            S01486
     C                   END                                                    *FI            15755
      *CASE:*****DTL.COB*is*No*****************************************   LN1069
     C***********#1CLBP    IFEQ @CN,01                     *IF            LN1069
      *CASE:*****DTL.Input*Cycle*is*No*********************************   LN1069
     C***********#1IPCY    IFEQ @CN,01                     *IF            LN1069
      *CASE:*****DTL.Periodic*is*No************************************   LN1069
     C***********#1PDFL    IFEQ @CN,01                     *IF            LN1069
      **Setup*message*data*for*message.********************************   LN1069
     C***********          MOVEL#1IPCY    ZA0005           Input Cycle    LN1069
     C***********          MOVEL#1CLBP    ZA0006           COB            LN1069
      **Send*message*'Phase*of*day*must*be*ent'************************   LN1069
     C***********          MOVEL'RCF0006' ZAMSID           Message id.    LN1069
     C***********          EXSR ZASNMS                     Send message   LN1069
     C***********          SETON                     993738*              LN1069
      ***********                                                         LN1069
     C***********          END                             *FI            LN1069
     C***********          END                             *FI            LN1069
     C***********          END                             *FI            LN1069
      * 00/copy member XX0300RVSR - Report Descriptions  *
     C*Edit Report Descriptions Validate Screen Relns
     C/COPY WNCPYSRC,FC0300RVSR
      * Report Description required.
     C     #1RDSC        IFEQ      *BLANK                                       IF
     C                   SETON                                        9931      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END                                                    FI
      * Module required.
     C     #1CMOD        IFEQ      *BLANK                                       IF
     C                   SETON                                        9932      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END                                                    FI
      * Midas/Q required.
     C     #1MIDQ        IFEQ      *BLANK                                       IF
     C                   SETON                                        9933      *
      * Send message '*Value required'
     C                   MOVEL     'Y2U0001'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END                                                    FI
      *================================================================
     CSR   DCEXIT        ENDSR
      /EJECT
     CSR   EBPR##        BEGSR
      *================================================================
      * Process record.
      *================================================================
      * Process delete request.
     C   10              CAS                     EDDLRQ
      * Process add request.
     C     W0PMD         CASEQ     'ADD'         ECADRQ
      * Process update request.
     C     W0PMD         CASNE     'ADD'         EECHRQ
     C                   END
     C     W0RTN         IFEQ      *BLANK
      * USER: Process command keys
      *CASE:*****PAR.Action*Code*is*not*insert***                         LN0828
     C***********P1JTST****IFEQ @CN,06                     *IF            LN0828
     C***********P1JTST****OREQ @CN,07                                    LN0828
     C***********P1JTST****OREQ @CN,08                                    LN0828
     C*********************MOVEL@CN,02    P0RTN            *Return code   LN0828
     C*********************EXSR ZYEXPG                                    LN0828
     C*********************END                             *FI            LN0828
      * 00/copy member XX0300RPCK - Report Descriptions  *
     C*Edit Report Descriptions Process Command Keys
     C/COPY WNCPYSRC,FC0300RPCK
     C     W0PMD         IFEQ      'ADD'
      * Exit after successful add.
     C                   MOVEL     'N'           W0RPT
     C                   END
      * Restart program for next record.
     C                   MOVEL     'N'           W0TRN
     C                   END
      *================================================================
     CSR   EBEXIT        ENDSR
      /EJECT
     CSR   ECADRQ        BEGSR
      *================================================================
      * Process add request.
      *================================================================
      * USER: Create DBF record
      * Create Report Description - Report Descriptions  *
     C                   EXSR      SCCRRC
     C     W0RTN         IFEQ      *BLANK
      * Send message '*Record added'
     C                   MOVEL     'Y2U0011'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END
      *================================================================
     CSR   ECEXIT        ENDSR
      /EJECT
     CSR   EDDLRQ        BEGSR
      *================================================================
      * Process delete request.
      *================================================================
      * USER: Delete DBF record
      * Delete Report Description - Report Descriptions  *
     C                   EXSR      SEDLRC
     C     W0RTN         IFEQ      *BLANK
      * Send message '*Record deleted'
     C                   MOVEL     'Y2U0013'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END
      *================================================================
     CSR   EDEXIT        ENDSR
      /EJECT
     CSR   EECHRQ        BEGSR
      *================================================================
      * Process update request.
      *================================================================
      * USER: Change DBF record
      * Change Report Description - Report Descriptions  *
     C                   EXSR      SKCHRC
     C     W0RTN         IFNE      *BLANK
      * DBF Update error detected.
      * Reset screen fields if changed record.
     C     W0RTN         CASEQ     'Y2U0007'     MBFL#1
     C                   END
     C                   ELSE
      * Send message '*Record changed'
     C                   MOVEL     'Y2U0012'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END
      *================================================================
     CSR   EEEXIT        ENDSR
      /EJECT
     CSR   FACKPM        BEGSR
      *================================================================
      * Check passed parameters.
      *================================================================
      * Is full key present?
     C     P2RNAM        IFEQ      *BLANK                                       Report name
      * Not every key field passed - loop program.
     C                   MOVEL     'Y'           W0RPT             1
     C                   ELSE
      * Full key passed, so single shot program.
     C                   MOVEL     'N'           W0RPT
     C                   END
      *================================================================
     CSR   FAEXIT        ENDSR
      /EJECT
     CSR   GADSAK        BEGSR
      *================================================================
      * Set key screen conditioning indicators.
      *================================================================
     C     W0PMD         COMP      'ADD'                                  89    *
      *================================================================
     CSR   GAEXIT        ENDSR
      /EJECT
     CSR   GBDSAD        BEGSR
      *================================================================
      * Set detail screen conditioning indicators.
      *================================================================
     C     W0PMD         COMP      'ADD'                                  89    *
      * Protect key fields on detail screen.
     C                   SETON                                        88        *
     C                   MOVEL     '0'           *IN79
     C*                                                                   157552
     C* On input of new record in single branch program account officer   157552
     C* and Department code can be 'Y' all other fields should be 'N@     157552
     C***********#1ALVL    IFEQ 'N'                                 157552178120
     C***********#1DLVL    ANDEQ'N'                                 157552178120
     C***********          MOVEL'Y'       #1ALVL                    157552178120
     C***********          MOVEL'Y'       #1DLVL                    157552178120
     C     WUMBIN        IFEQ      @CN(01)                                      *IF            17812
     C                   MOVEL     'N'           #1GLVL                         Bank-Level     17812
     C                   MOVEL     'N'           #1CLVL                         Company-Level  17812
     C                   MOVEL     'N'           #1BLVL                         Branch-level   17812
     C                   END                                                                   15755
     C*                                                                   157552
     C     WUMBIN        IFEQ      @CN(01)                                      *IF
     C     #1ALVL        ANDNE     'Y'                                                         S0148
     C     #1DLVL        ANDNE     'Y'                                                         S0148
     C                   MOVEL     '1'           *IN79
     C                   END                                                    *FI
      * Enable key screen.
     C                   SETON                                        87        *
      *================================================================
     CSR   GBEXIT        ENDSR
      /EJECT
     CSR   MAIZ#1        BEGSR
      *================================================================
      * Initialise record - except for key fields.
      *================================================================
     C                   Z-ADD     *ZERO         #1LCD                          Last Change Dat
     C                   MOVEL     *BLANK        #1CHTP                         Type of Last Ch
     C                   MOVEL     *BLANK        #1RDSC                         Report Descript
     C                   MOVEL     *BLANK        #1CMOD                         Module
     C                   MOVEL     *BLANK        #1MIDQ                         Midas/Q
     C                   MOVEL     *BLANK        #1GLVL                         Bank-Level
     C                   MOVEL     *BLANK        #1CLVL                         Company-Level
     C                   MOVEL     *BLANK        #1BLVL                         Branch-level
     C                   MOVEL     *BLANK        #1DLVL                                        S0148
     C                   MOVEL     *BLANK        #1ALVL                                        S0148
     C                   MOVEL     *BLANK        #1IPCY                         Input Cycle
     C                   MOVEL     *BLANK        #1CLBP                         COB
     C                   MOVEL     *BLANK        #1PDFL                         Periodic
     C******************** MOVEL*BLANK    #1COLT           Collation      LN0587
     C                   MOVEL     *BLANK        #1DFTO                         Default Output
      *================================================================
     CSR   MAEXIT        ENDSR
      /EJECT
     CSR   MBFL#1        BEGSR
      *================================================================
      **Move*@DXREIK*fields*to*screen.                                    S01407
      * Move FCREPTD0 fields to screen.                                   S01407
      *================================================================
     C                   Z-ADD     DXLCD         #1LCD                          Last Change Dat
     C                   MOVEL     DXCHTP        #1CHTP                         Type of Last Ch
     C                   MOVEL     DXRNAM        #1RNAM                         Report name
     C                   MOVEL     DXRDSC        #1RDSC                         Report Descript
     C                   MOVEL     DXCMOD        #1CMOD                         Module
     C                   MOVEL     DXMIDQ        #1MIDQ                         Midas/Q
     C                   MOVEL     DXGLVL        #1GLVL                         Bank-Level
     C                   MOVEL     DXCLVL        #1CLVL                         Company-Level
     C                   MOVEL     DXBLVL        #1BLVL                         Branch-level
     C                   MOVEL     DXDLVL        #1DLVL                                        S0148
     C                   MOVEL     DXALVL        #1ALVL                                        S0148
     C                   MOVEL     DXIPCY        #1IPCY                         Input Cycle
     C                   MOVEL     DXCLBP        #1CLBP                         COB
     C                   MOVEL     DXPDFL        #1PDFL                         Periodic
     C*********************MOVELDXCOLT    #1COLT           Collation      LN0587
     C                   MOVEL     DXDFTO        #1DFTO                         Default Output
      * Hold existing record image.
     C                   eval      @DXRNAM = DXRNAM                                         MD055265
     C                   eval      @DXLCD  = DXLCD                                          MD055265
     C                   eval      @DXCHTP = DXCHTP                                         MD055265
     C                   eval      @DXCMOD = DXCMOD                                         MD055265
     C                   eval      @DXRDSC = DXRDSC                                         MD055265
     C                   eval      @DXGLVL = DXGLVL                                         MD055265
     C                   eval      @DXCLVL = DXCLVL                                         MD055265
     C                   eval      @DXBLVL = DXBLVL                                         MD055265
     C                   eval      @DXIPCY = DXIPCY                                         MD055265
     C                   eval      @DXCLBP = DXCLBP                                         MD055265
     C                   eval      @DXPDFL = DXPDFL                                         MD055265
     C                   eval      @DXDFTO = DXDFTO                                         MD055265
     C                   eval      @DXMIDQ = DXMIDQ                                         MD055265
     C                   eval      @DXALVL = DXALVL                                         MD055265
     C                   eval      @DXDLVL = DXDLVL                                         MD055265
     C                   eval      @DXMODE = DXMODE                                         MD055265
     C                   MOVEL     @1DBRC        #1DBRC
      *================================================================
     CSR   MBEXIT        ENDSR
      /EJECT
     CSR   MDIZ#K        BEGSR
      *================================================================
      * Initialise key screen.
      *================================================================
     C                   MOVEL     P2RNAM        #1RNAM                         Report name
      * USER: Initialise key screen
      * Set-up KEY Screen Footer - standard functions  *
     C                   MOVEA     ARGV(1)       ##AENA
      * 00/copy member XX0300RIKS - Report Descriptions  *
     C*Edit Report Descriptions Initialise Key Screen
     C/COPY WNCPYSRC,FC0300RIKS
      *================================================================
     CSR   MDEXIT        ENDSR
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Retrieve Report Descriptn - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define Keylist.
     C     KRSSA         KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Move fields to key list.
     C                   MOVEL     #1RNAM        DXRNAM                         Report name
     C***********KRSSA     CHAIN@DXREIK              90    *              S01407
     C*****KRSSA         CHAIN     FCREPTD0                           90        *     S0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPT :NullInds                                                              MD055265
     C+ from FCREPJW1                                                                       MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   SETOFF                                       90                    MD055265
     C                   If        SQLCODE = 100                                            MD055265
     C                   SETON                                        90                    MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
     C     *IN90         IFEQ      '1'
      * DBF Record not found.
     C**********           MOVEL'USR0712' W0RTN   7                       LN1190
     C                   MOVEL     'RCF0712'     W0RTN             7                           LN119
      * USER: Processing if DBF record not found
     C                   MOVEL     @CN(04)       W0RTN                          *Return code
     C                   GOTO      SAEXIT
     C                   END
      *
     C     *IN90         IFEQ      '0'
      * USER: Process DBF record
     C                   MOVEL     @CN(05)       W0RTN                          *Return code
      * PAR = DB1 By name
     C                   END
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Check SOI Exist - Standard Output Insts  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define Keylist.
     C     KPSSB         KLIST
     C                   KFLD                    D1SOID                         Instruction Ide
     C                   KFLD                    D1LVL                          Level
     C                   KFLD                    D1ETTY                         Entity
      * Move fields to key list.
     C                   MOVEL     WUSOID        D1SOID                         Instruction Ide
     C                   MOVEL     *BLANK        D1LVL                          Level
     C                   MOVEL     *BLANK        D1ETTY                         Entity
     C     KPSSB         SETLL     @D1REIT                                      *
     C                   READ      @D1REIT                                90    *
     C     *IN90         IFEQ      '1'
      * DBF Record not found.
     C**********           MOVEL'USR0720' W0RTN   7                       LN1190
     C                   MOVEL     'RCF0720'     W0RTN             7                           LN119
      * USER: Processing if DBF record not found
     C                   MOVEL     @CN(04)       W0RTN                          *Return code
     C                   GOTO      SBEXIT
     C************         END                                            LN1037
      *
     C************IN90     DOWEQ'0'                                       LN1037
     C                   ELSE                                                                  LN103
      * USER: Process DBF record
      *CASE:     DB1.Instruction Identifier NE PAR.Instruction Identifier
     C     D1SOID        IFNE      WUSOID                                       *IF
     C                   MOVEL     @CN(04)       W0RTN                          *Return code
     C                   GOTO      SBEXIT                                       *QUIT
     C                   END                                                    *FI
     C***********          READ @D1REIT                  90*              LN1037
     C                   END
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   SCCRRC        BEGSR
      *================================================================
      * Create Report Description - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Move all fields to @DXREIJ
     C                   MOVEL     #1RNAM        DXRNAM                         Report name
     C                   Z-ADD     WURUND        DXLCD                          Last Change Dat
     C                   MOVEL     @CN(03)       DXCHTP                         Type of Last Ch
     C                   MOVEL     #1CMOD        DXCMOD                         Module
     C                   MOVEL     #1RDSC        DXRDSC                         Report Descript
     C                   MOVEL     #1GLVL        DXGLVL                         Bank-Level
     C                   MOVEL     #1CLVL        DXCLVL                         Company-Level
     C                   MOVEL     #1BLVL        DXBLVL                         Branch-level
     C                   MOVEL     #1DLVL        DXDLVL                                        S0148
     C                   MOVEL     #1ALVL        DXALVL                                        S0148
     C                   MOVEL     #1IPCY        DXIPCY                         Input Cycle
     C                   MOVEL     #1CLBP        DXCLBP                         COB
     C                   MOVEL     #1PDFL        DXPDFL                         Periodic
     C******************** MOVEL#1COLT    DXCOLT           Collation      LN0587
     C                   MOVEL     #1DFTO        DXDFTO                         Default Output
     C                   MOVEL     #1MIDQ        DXMIDQ                         Midas/Q
      *
      * USER: Processing before DBF update
      * 00/copy member XX0300RCBU - Report Descriptions  *
     C*Edit Report Descriptions Processing Before Create
     C/COPY WNCPYSRC,FC0300RCBU
     C     KLCRSC        KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Check for duplicate primary key.
     C*****KLCRSC        SETLL     @DXREIJ                                90    *           MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPTL                                                                       MD055265
     C+ from FCREPJW0                                                                       MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   If        SQLCODE = 0                                              MD055265
     C**********           MOVEL'USR0713' W0RTN   7                       LN1190
     C                   MOVEL     'RCF0713'     W0RTN             7                           LN119
      * Send message 'Report Descriptions    EX'
     C**********           MOVEL'USR0713' ZAMSID           Message id.    LN1190
     C                   MOVEL     'RCF0713'     ZAMSID                         Message id.    LN119
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SCEXIT
     C                   END
      *
     C**********         WRITE     @DXREIJ                              91      *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ insert into FCREPBTD                                                                MD055265
     C+ (                                                                                   MD055265
     C+   DXRNAM                                                                            MD055265
     C+ , DXLCD                                                                             MD055265
     C+ , DXCHTP                                                                            MD055265
     C+ , DXCMOD                                                                            MD055265
     C+ , DXRDSC                                                                            MD055265
     C+ , DXGLVL                                                                            MD055265
     C+ , DXCLVL                                                                            MD055265
     C+ , DXBLVL                                                                            MD055265
     C+ , DXIPCY                                                                            MD055265
     C+ , DXCLBP                                                                            MD055265
     C+ , DXPDFL                                                                            MD055265
     C+ , DXDFTO                                                                            MD055265
     C+ , DXMIDQ                                                                            MD055265
     C+ , DXALVL                                                                            MD055265
     C+ , DXDLVL                                                                            MD055265
     C+ , DXMODE                                                                            MD055265
     C+ )                                                                                   MD055265
     C+ Values                                                                              MD055265
     C+ (                                                                                   MD055265
     C+   :#1RNAM                                                                           MD055265
     C+ , :#1LCD                                                                            MD055265
     C+ , :#1CHTP                                                                           MD055265
     C+ , :#1CMOD                                                                           MD055265
     C+ , :#1RDSC                                                                           MD055265
     C+ , :#1GLVL                                                                           MD055265
     C+ , :#1CLVL                                                                           MD055265
     C+ , :#1BLVL                                                                           MD055265
     C+ , :#1IPCY                                                                           MD055265
     C+ , :#1CLBP                                                                           MD055265
     C+ , :#1PDFL                                                                           MD055265
     C+ , :#1DFTO                                                                           MD055265
     C+ , :#1MIDQ                                                                           MD055265
     C+ , :#1ALVL                                                                           MD055265
     C+ , :#1DLVL                                                                           MD055265
     C+ , 'B'                                                                               MD055265
     C+ )                                                                                   MD055265
     C/END-EXEC                                                                             MD055265
     C/EXEC SQL                                                                             MD055265
     C+ insert into FCREPXTD                                                                MD055265
     C+ (                                                                                   MD055265
     C+   DXRNAM                                                                            MD055265
     C+ , DXLCD                                                                             MD055265
     C+ , DXCHTP                                                                            MD055265
     C+ , DXDFTO                                                                            MD055265
     C+ )                                                                                   MD055265
     C+ Values                                                                              MD055265
     C+ (                                                                                   MD055265
     C+   :#1RNAM                                                                           MD055265
     C+ , :#1LCD                                                                            MD055265
     C+ , :#1CHTP                                                                           MD055265
     C+ , :#1DFTO                                                                           MD055265
     C+ )                                                                                   MD055265
     C/END-EXEC                                                                             MD055265
      *                                                                                     MD055265
     C                   If        (SQLCODE <> 0)                                           MD055265
      *
     C******IN91         IFEQ      '1'                                                      MD055265
      * Write error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Write successful.
      * USER: Processing after DBF update
     C                   Z-ADD     1             WUNORC                         No. of Records
     C                   Z-ADD     1             WUNOIN                         No. of Inserts
     C                   Z-ADD     *ZERO         WUNOAM                         No. of Amends
     C                   Z-ADD     *ZERO         WUNODL                         No. of Deletes
      * Change Report Description - Report Descriptions Audit  *
     C                   EXSR      SDCHRC
      * 00/copy member XX0300RCAU - Report Descriptions  *
     C*Edit Report Descriptions Processing After Create
     C/COPY WNCPYSRC,FC0300RCAU
     C                   END
      *================================================================
     CSR   SCEXIT        ENDSR
      /EJECT
     CSR   SDCHRC        BEGSR
      *================================================================
      * Change Report Description - Report Descriptions Audit  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Move key fields to @ADREBB
     C                   MOVEL     @CN(10)       ADFLNM                         Filename
      *
     C     KLCHSD        KLIST
     C                   KFLD                    ADFLNM                         Filename
     C     KLCHSD        CHAIN     @ADREBB                            9091      *
      *
     C     *IN90         IFEQ      '1'
      * Record not found.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SDEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SDEXIT
     C                   END
      *
      * USER: Processing after DBF read
     C                   ADD       ADNORC        WUNORC                         No. of Records
     C                   ADD       ADNOIN        WUNOIN                         No. of Inserts
     C                   ADD       ADNOAM        WUNOAM                         No. of Amends
     C                   ADD       ADNODL        WUNODL                         No. of Deletes
      * Move Non-key fields to @ADREBB
     C                   Z-ADD     WUNORC        ADNORC                         No. of Records
     C                   Z-ADD     WUNOIN        ADNOIN                         No. of Inserts
     C                   Z-ADD     WUNOAM        ADNOAM                         No. of Amends
     C                   Z-ADD     WUNODL        ADNODL                         No. of Deletes
      *
     C                   UPDATE    @ADREBB                              91      *
     C     *IN91         IFEQ      '1'
      * Change error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Change successful.
      * Move @ADREBB fields back.
     C                   Z-ADD     ADNORC        WUNORC                         No. of Records
     C                   Z-ADD     ADNOIN        WUNOIN                         No. of Inserts
     C                   Z-ADD     ADNOAM        WUNOAM                         No. of Amends
     C                   Z-ADD     ADNODL        WUNODL                         No. of Deletes
     C                   END
      *================================================================
     CSR   SDEXIT        ENDSR
      /EJECT
     CSR   SEDLRC        BEGSR
      *================================================================
      * Delete Report Description - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * USER: Processing before DBF update
      * 00/copy member XX0300RDBU - Report Descriptions  *
     C*Edit Report Descriptions Processing Before Delete
     C/COPY WNCPYSRC,FC0300RDBU
      *                                                                   S01407
      * Move key fields to @SARRL2                                        S01407
     C                   MOVEL     #1RNAM        KRNAM            10                           S0140
      *                                                                   S01407
     C     KSARR         KLIST                                                                 S0140
     C                   KFLD                    KRNAM                                         S0140
      *                                                                   S01407
      * Move key fields to @DXREIJ
     C                   MOVEL     #1RNAM        DXRNAM                         Report name
      *
     C     KLDLSE        KLIST
     C                   KFLD                    DXRNAM                         Report name
     C*****KLDLSE        CHAIN     @DXREIJ                            9091      *           MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPTL                                                                       MD055265
     C+ from FCREPJW0                                                                       MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   If        (SQLCODE <> 0)                                           MD055265
      * Record already deleted.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SEEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SEEXIT
     C                   END
      *
      * Check for changed record.
     C                   eval      @1DBRC = FCREPTL                                         MD055265
     C     #1DBRC        IFNE      @1DBRC                                       IF
     C                   MOVEL     'Y2U0007'     W0RTN             7
      * Send message '*Update not accepted'
     C                   MOVEL     'Y2U0007'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
      * Use SETLL to release record lock.
     C*****KLDLSE        SETLL     @DXREIJ                            9091      *           MD055265
     C                   GOTO      SEEXIT
     C                   END                                                    FI #1DBRC
      * Do not allow deletion of core record                                                MD055265
     C     DXMODE        IFEQ      'C'                                                      MD055265
     C                   MOVEL     'RCF0502'     ZAMSID                                     MD055265
     C                   MOVEL     'RCF0502'     W0RTN                                      MD055265
     C                   MOVEL     'FCUSRMSG'    ZAMSGF                                     MD055265
     C                   EXSR      ZASNMS                                                   MD055265
     C                   GOTO      SEEXIT                                                   MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
      *................................................................
     C**********         DELETE    @DXREIJ                              91      *           MD055265
     C******IN91         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ delete from FCREPBTD                                                                MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C/EXEC SQL                                                                             MD055265
     C+ delete from FCREPXTD                                                                MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
      *                                                                                     MD055265
     C                   If        (SQLCODE <> 0)                                           MD055265
      * Delete error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Delete successful.
      *                                                                   S01407
      * If Report Name is related to a switchable feature, delete         S01407
      * records from Switchable Features Report Name file                 S01407
      *                                                                   S01407
     C     AHSARN        IFNE      *BLANKS                                                     S0140
     C     KSARR         SETLL     SCSARRL2                           8585                     S0140
     C     KSARR         READE     SCSARRL2                               85                   S0140
      *                                                                   S01407
     C     *IN85         DOWEQ     '0'                                                         S0140
     C                   DELETE    @SARRL2                                                     S0140
     C     KSARR         READE     SCSARRL2                               85                   S0140
     C                   END                                                                   S0140
      *                                                                   S01407
     C                   END                                                                   S0140
      * USER: Processing after DBF update
      * retrieve component name - Report Components  *
     C                   EXSR      SFRVGN
      * Retrieve all suffixes - Report Suffix  *
     C                   EXSR      SHRVGN
     C                   Z-ADD     -1            WUNORC                         No. of Records
     C                   Z-ADD     1             WUNODL                         No. of Deletes
     C                   Z-ADD     *ZERO         WUNOIN                         No. of Inserts
     C                   Z-ADD     *ZERO         WUNOAM                         No. of Amends
      * Change Report Description - Report Descriptions Audit  *
     C                   EXSR      SJCHRC
      * 00/copy member XX0300RDAU - Report Descriptions  *
     C*Edit Report Descriptions Processing After Delete
     C/COPY WNCPYSRC,FC0300RDAU
     C                   END
      *================================================================
     CSR   SEEXIT        ENDSR
      /EJECT
     CSR   SFRVGN        BEGSR
      *================================================================
      * retrieve component name - Report Components  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Declare restrictor key work fields.
     C     *LIKE         DEFINE    D3RNAM        WQSF01                         Report name
      * Define Keylist.
     C     KPSSF         KLIST
     C                   KFLD                    WQSF01                         Report name
     C                   KFLD                    D3COTT                         Component Name
     C                   KFLD                    D3CSEQ                         Component Seque
      * Define Keylist.
     C     KRSSF         KLIST
     C                   KFLD                    WQSF01                         Report name
      * Move fields to key list.
     C                   MOVEL     DXRNAM        WQSF01                         Report name
     C                   MOVEL     *BLANK        D3COTT                         Component Name
     C                   MOVEL     *BLANK        D3CSEQ                         Component Seque
     C*****KPSSF         SETLL     @D3REI5                                      *           MD055265
     C*****KRSSF         READE     @D3REI5                                90    *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ declare ACursor insensitive scroll cursor for                                       MD055265
     C+ select * from FCRCOJW0                                                              MD055265
     C+ where D3RNAM = :DXRNAM                                                              MD055265
     C+ order by D3RNAM, D3COTT, D3CSEQ                                                     MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ open ACursor                                                                        MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from ACursor into :FCRCOM                                                MD055265
     C/END-EXEC                                                                             MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE = 100                                            MD055265
      * DBF Record not found.
     C**********           MOVEL'USR0724' W0RTN   7                       LN1190
     C                   MOVEL     'RCF0724'     W0RTN             7                           LN119
      * USER: Processing if DBF record not found
     C                   MOVEL     @CN(04)       W0RTN                          *Return code
     C                   GOTO      SFEXIT
     C                   END
      *
     C******IN90         DOWEQ     '0'                                                      MD055265
     C                   DOW       SQLCODE = 0                                              MD055265
      * USER: Process DBF record
      * Delete Report Components - Report Components  *
     C                   EXSR      SGDLRC
     C*****KRSSF         READE     @D3REI5                                90    *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from ACursor into :FCRCOM                                                MD055265
     C/END-EXEC                                                                             MD055265
     C                   END
     C/EXEC SQL                                                                             MD055265
     C+ close ACursor                                                                       MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
      *================================================================
     CSR   SFEXIT        ENDSR
      /EJECT
     CSR   SGDLRC        BEGSR
      *================================================================
      * Delete Report Components - Report Components  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * USER: Processing before DBF update
     C/COPY WNCPYSRC,FC0302RDBU
      *                                                                   S01407
      * Move key fields to @SARML2                                        S01407
     C                   MOVEL     D3RNAM        KRNAM                                         S0140
     C                   MOVEL     D3COTT        KCOTT            10                           S0140
     C                   MOVEL     D3CSEQ        KCSEQ             5                           S0140
      *                                                                   S01407
     C     KSARM         KLIST                                                                 S0140
     C                   KFLD                    KRNAM                                         S0140
     C                   KFLD                    KCOTT                                         S0140
     C                   KFLD                    KCSEQ                                         S0140
      *                                                                   S01407
      * Move key fields to @D3REI4
      *
     C     KLDLSG        KLIST
     C                   KFLD                    D3RNAM                         Report name
     C                   KFLD                    D3COTT                         Component Name
     C                   KFLD                    D3CSEQ                         Component Seque
     C*****KLDLSG        CHAIN     @D3REI4                            9091      *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCRCOM                                                                        MD055265
     C+ from FCRCOJW0                                                                       MD055265
     C+ where D3RNAM = :D3RNAM and D3COTT = :D3COTT and D3CSEQ = :D3CSEQ                    MD055265
     C/END-EXEC                                                                             MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE = 100                                            MD055265
      * Record already deleted.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SGEXIT
     C                   END
      *
     C******IN91         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE <> 0 and SQLCODE <> 100                          MD055265
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SGEXIT
     C                   END
      *
      * Do not allow deletion of core record                                                MD055265
     C     D3MODE        IFEQ      'C'                                                      MD055265
     C                   MOVEL     'RCF0500'     ZAMSID                                     MD055265
     C                   MOVEL     'RCF0500'     W0RTN                                      MD055265
     C                   MOVEL     'FCUSRMSG'    ZAMSGF                                     MD055265
     C                   EXSR      ZASNMS                                                   MD055265
     C                   GOTO      SGEXIT                                                   MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
      *................................................................
     C**********         DELETE    @D3REI4                              91      *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ DELETE from FCRCOBTD                                                                MD055265
     C+ where D3RNAM = :D3RNAM and D3COTT = :D3COTT and D3CSEQ = :D3CSEQ                    MD055265
     C/END-EXEC                                                                             MD055265
     C/EXEC SQL                                                                             MD055265
     C+ DELETE from FCRCOXTD                                                                MD055265
     C+ where D3RNAM = :D3RNAM and D3COTT = :D3COTT and D3CSEQ = :D3CSEQ                    MD055265
     C/END-EXEC                                                                             MD055265
     C******IN91         IFEQ      '1'                                                      MD055265
      * Delete error detected.
     C**********         MOVEL     'Y2U0004'     W0RTN             7                        MD055265
     C**********         ELSE                                                               MD055265
      * DBF Delete successful.
      *                                                                   S01407
      * Delete records from Switchable Features Report Component file     S01407
      *                                                                   S01407
     C     KSARM         SETLL     SCSARML2                           8585                     S0140
     C     KSARM         READE     SCSARML2                               85                   S0140
      *                                                                   S01407
     C     *IN85         DOWEQ     '0'                                                         S0140
     C                   DELETE    @SARML2                                                     S0140
     C     KSARM         READE     SCSARML2                               85                   S0140
     C                   END                                                                   S0140
      *                                                                   S01407
      * USER: Processing after DBF update
     C/COPY WNCPYSRC,FC0302RDAU
     C**********         END                                                                MD055265
      *================================================================
     CSR   SGEXIT        ENDSR
      /EJECT
     CSR   SHRVGN        BEGSR
      *================================================================
      * Retrieve all suffixes - Report Suffix  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Declare restrictor key work fields.
     C     *LIKE         DEFINE    DYRNAM        WQSH01                         Report name
      * Define Keylist.
     C     KPSSH         KLIST
     C                   KFLD                    WQSH01                         Report name
     C                   KFLD                    DYRSFX                         Print File Name
      * Define Keylist.
     C     KRSSH         KLIST
     C                   KFLD                    WQSH01                         Report name
      * Move fields to key list.
     C                   MOVEL     DXRNAM        WQSH01                         Report name
     C                   MOVEL     *BLANK        DYRSFX                         Print File Name
     C*****KPSSH         SETLL     @DYREIO                                      *           MD055265
     C*****KRSSH         READE     @DYREIO                                90    *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ declare BCursor insensitive scroll cursor for                                       MD055265
     C+ select * from FCRSFJW0                                                              MD055265
     C+ where DYRNAM = :DXRNAM                                                              MD055265
     C+ order by DYRNAM, DYRSFX                                                             MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ close BCursor                                                                       MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ open BCursor                                                                        MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from BCursor into :FCRSFX                                                MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE = 100                                            MD055265
      * DBF Record not found.
     C**********           MOVEL'USR0714' W0RTN   7                       LN1190
     C                   MOVEL     'RCF0714'     W0RTN             7                           LN119
      * USER: Processing if DBF record not found
     C                   MOVEL     @CN(04)       W0RTN                          *Return code
     C                   GOTO      SHEXIT
     C                   END
      *
     C******IN90         DOWEQ     '0'                                                      MD055265
     C                   DOW       SQLCODE = 0                                              MD055265
      * USER: Process DBF record
      * Delete Report Suffix - Report Suffix  *
     C                   EXSR      SIDLRC
     C*****KRSSH         READE     @DYREIO                                90    *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from BCursor into :FCRSFX                                                MD055265
     C/END-EXEC                                                                             MD055265
     C                   END
      *================================================================
     C/EXEC SQL                                                                             MD055265
     C+ close BCursor                                                                       MD055265
     C/END-EXEC                                                                             MD055265
     CSR   SHEXIT        ENDSR
      /EJECT
     CSR   SIDLRC        BEGSR
      *================================================================
      * Delete Report Suffix - Report Suffix  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * USER: Processing before DBF update
      * 00/copy member XX0301MDBU - Report Suffix  *
      * REPORT SUFFIXES EDIT PROCESSING BEFORE DELETE
     C/COPY WNCPYSRC,FC0301RDBU
      *                                                                   S01407
      * Move key fields to @SAROL2                                        S01407
     C                   MOVEL     DYRSFX        KOBNM            10                           S0140
     C                   MOVEL     '*FILE'       KOBTP             8                           S0140
      *                                                                   S01407
     C     KSARO         KLIST                                                                 S0140
     C                   KFLD                    KOBNM                                         S0140
     C                   KFLD                    KOBTP                                         S0140
      *                                                                   S01407
      * Move key fields to @DYREIN
      *
     C     KLDLSI        KLIST
     C                   KFLD                    DYRNAM                         Report name
     C                   KFLD                    DYRSFX                         Print File Name
     C*****KLDLSI        CHAIN     @DYREIN                            9091      *
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCRSFX                                                                        MD055265
     C+ from FCRSFJW0                                                                       MD055265
     C+ where DYRNAM = :DYRNAM and DYRSFX = :DYRSFX                                         MD055265
     C/END-EXEC                                                                             MD055265
     C                   SETOFF                                       9091                  MD055265
     C                   IF        SQLCODE = 100                                            MD055265
     C                   SETON                                          90                  MD055265
     C                   ENDIF                                                              MD055265
     C                   IF        SQLCODE <> 100 and SQLCODE <> 0                          MD055265
     C                   SETON                                          91                  MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
     C     *IN90         IFEQ      '1'
      * Record already deleted.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SIEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SIEXIT
     C                   END
      *
      * Do not allow deletion of core record                                                MD055265
     C     DYMODE        IFEQ      'C'                                                      MD055265
     C                   MOVEL     'RCF0501'     ZAMSID                                     MD055265
     C                   MOVEL     'RCF0501'     W0RTN                                      MD055265
     C                   MOVEL     'FCUSRMSG'    ZAMSGF                                     MD055265
     C                   EXSR      ZASNMS                                                   MD055265
     C                   GOTO      SIEXIT                                                   MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
      *................................................................
     C**********         DELETE    @DYREIN                              91      *           MD055265
     C/EXEC SQL                                                                             MD055265
     C+ DELETE from FCRSFBTD                                                                MD055265
     C+ where DYRNAM = :DYRNAM and DYRSFX = :DYRSFX                                         MD055265
     C/END-EXEC                                                                             MD055265
     C/EXEC SQL                                                                             MD055265
     C+ DELETE from FCRSFXTD                                                                MD055265
     C+ where DYRNAM = :DYRNAM and DYRSFX = :DYRSFX                                         MD055265
     C/END-EXEC                                                                             MD055265
     C******IN91         IFEQ      '1'                                                      MD055265
     C                   IF        SQLCODE <> 0                                             MD055265
      * Delete error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Delete successful.
      *                                                                   S01407
      * Delete records from Switchable Features Report Suffix file        S01407
      *                                                                   S01407
     C     KSARO         SETLL     SCSAROL2                           8585                     S0140
     C     KSARO         READE     SCSAROL2                               85                   S0140
      *                                                                   S01407
     C     *IN85         DOWEQ     '0'                                                         S0140
     C                   DELETE    @SAROL2                                                     S0140
     C     KSARO         READE     SCSAROL2                               85                   S0140
     C                   END                                                                   S0140
      *                                                                   S01407
      * USER: Processing after DBF update
      * 00/copy member XX0301MDAU - Report Suffix  *
      * REPORT SUFFIXES EDIT PROCESSING AFTER DELETE
     C/COPY WNCPYSRC,FC0301RDAU
     C                   END
      *================================================================
     CSR   SIEXIT        ENDSR
      /EJECT
     CSR   SJCHRC        BEGSR
      *================================================================
      * Change Report Description - Report Descriptions Audit  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Move key fields to @ADREBB
     C                   MOVEL     @CN(10)       ADFLNM                         Filename
      *
     C     KLCHSJ        KLIST
     C                   KFLD                    ADFLNM                         Filename
     C     KLCHSJ        CHAIN     @ADREBB                            9091      *
      *
     C     *IN90         IFEQ      '1'
      * Record not found.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SJEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SJEXIT
     C                   END
      *
      * USER: Processing after DBF read
     C                   ADD       ADNORC        WUNORC                         No. of Records
     C                   ADD       ADNOIN        WUNOIN                         No. of Inserts
     C                   ADD       ADNOAM        WUNOAM                         No. of Amends
     C                   ADD       ADNODL        WUNODL                         No. of Deletes
      * Move Non-key fields to @ADREBB
     C                   Z-ADD     WUNORC        ADNORC                         No. of Records
     C                   Z-ADD     WUNOIN        ADNOIN                         No. of Inserts
     C                   Z-ADD     WUNOAM        ADNOAM                         No. of Amends
     C                   Z-ADD     WUNODL        ADNODL                         No. of Deletes
      *
     C                   UPDATE    @ADREBB                              91      *
     C     *IN91         IFEQ      '1'
      * Change error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Change successful.
      * Move @ADREBB fields back.
     C                   Z-ADD     ADNORC        WUNORC                         No. of Records
     C                   Z-ADD     ADNOIN        WUNOIN                         No. of Inserts
     C                   Z-ADD     ADNOAM        WUNOAM                         No. of Amends
     C                   Z-ADD     ADNODL        WUNODL                         No. of Deletes
     C                   END
      *================================================================
     CSR   SJEXIT        ENDSR
      /EJECT
     CSR   SKCHRC        BEGSR
      *================================================================
      * Change Report Description - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * USER: Processing before DBF read
      * 00/copy member XX0300RBDU - Report Descriptions  *
     C*Edit Report Descriptions Processing Before Update
     C/COPY WNCPYSRC,FC0300RBDU
      *CASE:     PGM.*Return code is *User QUIT requested
     C     W0RTN         IFEQ      @CN(11)                                      *IF
     C                   MOVEL     @CN(11)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
      *CASE:     PGM.*Return code is *Previous Screen
     C     W0RTN         IFEQ      @CN(02)                                      *IF
     C                   GOTO      SKEXIT                                       *QUIT
     C                   END                                                    *FI
      * Move key fields to @DXREIJ
     C                   MOVEL     #1RNAM        DXRNAM                         Report name
      *
     C     KLCHSK        KLIST
     C                   KFLD                    DXRNAM                         Report name
     C*****KLCHSK        CHAIN     @DXREIJ                            9091      *           MD055265
      *                                                                                     MD055265
     C******IN90         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPTL :NullInds                                                             MD055265
     C+ from FCREPJW0                                                                       MD055265
     C+ where DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   If        (SQLCODE <> 0)                                           MD055265
      * Record not found.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SKEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SKEXIT
     C                   END
      *
      * Check for changed record.
     C                   eval      @1DBRC = FCREPTL                                         MD055265
     C     #1DBRC        IFNE      @1DBRC                                       IF
     C                   MOVEL     'Y2U0007'     W0RTN             7
      * Send message '*Update not accepted'
     C                   MOVEL     'Y2U0007'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
      * Use SETLL to release record lock.
     C*****KLCHSK        SETLL     @DXREIJ                            9091      *           MD055265
     C                   GOTO      SKEXIT
     C                   END                                                    FI #1DBRC
      * Move Non-key fields to @DXREIJ
     C                   Z-ADD     WURUND        DXLCD                          Last Change Dat
     C                   MOVEL     @CN(03)       DXCHTP                         Type of Last Ch
     C                   MOVEL     @CN(03)       XXCHTP            1            Type of LastMD055265
     C                   MOVEL     #1CMOD        DXCMOD                         Module
     C                   MOVEL     #1RDSC        DXRDSC                         Report Descript
     C                   MOVEL     #1GLVL        DXGLVL                         Bank-Level
     C                   MOVEL     #1CLVL        DXCLVL                         Company-Level
     C                   MOVEL     #1BLVL        DXBLVL                         Branch-level
     C                   MOVEL     #1DLVL        DXDLVL                                        S0148
     C                   MOVEL     #1ALVL        DXALVL                                        S0148
     C                   MOVEL     #1IPCY        DXIPCY                         Input Cycle
     C                   MOVEL     #1CLBP        DXCLBP                         COB
     C                   MOVEL     #1PDFL        DXPDFL                         Periodic
     C******************** MOVEL#1COLT    DXCOLT           Collation      LN0587
     C                   MOVEL     #1DFTO        DXDFTO                         Default Output
     C                   MOVEL     #1MIDQ        DXMIDQ                         Midas/Q
      *
     C**********         UPDATE    @DXREIJ                              91      *           MD055265
     C******IN91         IFEQ      '1'                                                      MD055265
     C/EXEC SQL                                                                             MD055265
     C+ update FCREPXTD                                                                     MD055265
     C+  SET DXDFTO = :#1DFTO                                                               MD055265
     C+  , DXCHTP = :XXCHTP                                                                 MD055265
     C+  , DXLCD = :WURUND                                                                  MD055265
     C+ WHERE DXRNAM = :#1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C                   If        (SQLCODE <> 0)                                           MD055265
      * Change error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Change successful.
      * Update saved record image.
     C                   eval      @DXRNAM = DXRNAM                                         MD055265
     C                   eval      @DXLCD  = DXLCD                                          MD055265
     C                   eval      @DXCHTP = DXCHTP                                         MD055265
     C                   eval      @DXCMOD = DXCMOD                                         MD055265
     C                   eval      @DXRDSC = DXRDSC                                         MD055265
     C                   eval      @DXGLVL = DXGLVL                                         MD055265
     C                   eval      @DXCLVL = DXCLVL                                         MD055265
     C                   eval      @DXBLVL = DXBLVL                                         MD055265
     C                   eval      @DXIPCY = DXIPCY                                         MD055265
     C                   eval      @DXCLBP = DXCLBP                                         MD055265
     C                   eval      @DXPDFL = DXPDFL                                         MD055265
     C                   eval      @DXDFTO = DXDFTO                                         MD055265
     C                   eval      @DXMIDQ = DXMIDQ                                         MD055265
     C                   eval      @DXALVL = DXALVL                                         MD055265
     C                   eval      @DXDLVL = DXDLVL                                         MD055265
     C                   eval      @DXMODE = DXMODE                                         MD055265
     C                   MOVEL     @1DBRC        #1DBRC
      * USER: Processing after DBF update
     C                   Z-ADD     *ZERO         WUNORC                         No. of Records
     C                   Z-ADD     *ZERO         WUNOIN                         No. of Inserts
     C                   Z-ADD     *ZERO         WUNODL                         No. of Deletes
     C                   Z-ADD     1             WUNOAM                         No. of Amends
      * Change Report Description - Report Descriptions Audit  *
     C                   EXSR      SLCHRC
      * 00/copy member XX0300RADU - Report Descriptions  *
     C*Edit Report Descriptions Processing After Update
     C/COPY WNCPYSRC,FC0300RADU
     C                   END
      *================================================================
     CSR   SKEXIT        ENDSR
      /EJECT
     CSR   SLCHRC        BEGSR
      *================================================================
      * Change Report Description - Report Descriptions Audit  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Move key fields to @ADREBB
     C                   MOVEL     @CN(10)       ADFLNM                         Filename
      *
     C     KLCHSL        KLIST
     C                   KFLD                    ADFLNM                         Filename
     C     KLCHSL        CHAIN     @ADREBB                            9091      *
      *
     C     *IN90         IFEQ      '1'
      * Record not found.
     C                   MOVEL     'Y2U0009'     W0RTN             7
      * Send message '*Record no longer on file'
     C                   MOVEL     'Y2U0009'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   GOTO      SLEXIT
     C                   END
      *
     C     *IN91         IFEQ      '1'
      * Record locked.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   GOTO      SLEXIT
     C                   END
      *
      * USER: Processing after DBF read
     C                   ADD       ADNORC        WUNORC                         No. of Records
     C                   ADD       ADNOIN        WUNOIN                         No. of Inserts
     C                   ADD       ADNOAM        WUNOAM                         No. of Amends
     C                   ADD       ADNODL        WUNODL                         No. of Deletes
      * Move Non-key fields to @ADREBB
     C                   Z-ADD     WUNORC        ADNORC                         No. of Records
     C                   Z-ADD     WUNOIN        ADNOIN                         No. of Inserts
     C                   Z-ADD     WUNOAM        ADNOAM                         No. of Amends
     C                   Z-ADD     WUNODL        ADNODL                         No. of Deletes
      *
     C                   UPDATE    @ADREBB                              91      *
     C     *IN91         IFEQ      '1'
      * Change error detected.
     C                   MOVEL     'Y2U0004'     W0RTN             7
     C                   ELSE
      * DBF Change successful.
      * Move @ADREBB fields back.
     C                   Z-ADD     ADNORC        WUNORC                         No. of Records
     C                   Z-ADD     ADNOIN        WUNOIN                         No. of Inserts
     C                   Z-ADD     ADNOAM        WUNOAM                         No. of Amends
     C                   Z-ADD     ADNODL        WUNODL                         No. of Deletes
     C                   END
      *================================================================
     CSR   SLEXIT        ENDSR
      /EJECT
     CSR   VACKRL        BEGSR
      *================================================================
      * Select existing record.
      *================================================================
      * Name search required ?
     C                   MOVEL     #1RNAM        WK1X01            1            Report name
     C     WK1X01        IFEQ      '?'                                          Report name
     C                   CALL      'FC0300S'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C     #1RNAM        PARM      #1RNAM        WQ0001           10            Report name
     C     *IN90         IFEQ      '1'
      * Call to program ended in error.
     C                   MOVEL     'Y2U0021'     W0RTN             7
     C                   END
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      *================================================================
     CSR   VAEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue.
      *================================================================
      **Send*if*first*error*message*or*not*an*error*message.***           LN1146
     C***********ZAMSTP    IFNE *BLANK                                    LN1146
     C***********ZAFSMS    ORNE 'N'                                       LN1146
     C***********ZAMSTP    IFEQ *BLANK                                    LN1146
      **Signal*first*error*message*sent.***                               LN1146
     C***********          MOVEL'N'       ZAFSMS                          LN1146
     C***********          END                                            LN1146
     C     ZAPGM         IFEQ      *BLANK
     C                   MOVEL     ##PGM         ZAPGM
     C                   END
      * If no message file specified use default.
     C     ZAMSGF        IFEQ      *BLANK
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGM            10            Program queue
     C                   PARM                    ZAPGRL            5            Rel queue
     C                   PARM                    ZAMSID            7            Message Id.
     C                   PARM                    ZAMSGF           10            Message file.
     C                   PARM                    ZAMSDA          132            Message data.
     C                   PARM                    ZAMSTP            7            Message type.
     C***********          END                                            LN1146
      * Clear all fields for default mechanism next time.
     C                   MOVEL     *BLANK        ZAPGM                          Program queue
     C                   MOVEL     *BLANK        ZAPGRL                         Rel queue
     C                   MOVEL     *BLANK        ZAMSID                         Message Id.
     C                   MOVEL     *BLANK        ZAMSGF                         Message file.
     C                   MOVEL     *BLANK        ZAMSDA                         Message data.
     C                   MOVEL     *BLANK        ZAMSTP                         Message type.
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZHHPKY        BEGSR
      *================================================================
      * Display HELP text.
      *================================================================
     C                   MOVEL     'Y'           W0HLP             1            Signal help req
     C                   CALL      'YDDSHPR'
     C                   PARM      ##PGM         W0HPMB           10            Member name.
     C                   PARM      *BLANK        YYHPFL           10            *DFT text file.
     C                   PARM      *BLANK        YYHPLB           10            Help text lib.
     C                   PARM                    W0RTN             7            Return Code.
      *================================================================
     CSR   ZHEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Cancel and exit from key screen.
      *================================================================
      * USER: Exit program processing
     C*********************MOVELWURNAM    P2RNAM           Report name    LN0828
     C     P1JTST        IFEQ      'I'                                                         LN082
     C     P2RNAM        ANDEQ     *BLANK                                                      LN082
     C                   MOVEL     #1RNAM        P2RNAM                                        LN082
     C                   END                                                                   LN082
      * 00/copy member XX0300REPP - Report Descriptions  *
     C*Edit Report Descriptions Exit Program Processing
     C/COPY WNCPYSRC,FC0300REPP
      *CASE:     KEY.*CMD key is *Exit
     C     *IN03         IFEQ      '1'                                          *IF
     C                   MOVEL     @CN(11)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
     C                   MOVEL     *BLANK        P0RTN
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct.
      *================================================================
      * Terminate program.
     C                   SETON                                        LR
      *
      * Exit program.
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation.
      *================================================================
     C                   MOVE      *BLANK        P0RTN
     C                   MOVE      *BLANK        W0RTN             7
      * Setup job date/time.
     C                   Z-ADD     UDATE         ##JDT                          Job date.
     C                   TIME                    ##JTM                          Job time.
     C                   TIME                    ##TME             6 0          Screen time.
      * Define work field Report name
     C                   MOVEL     *BLANK        WURNAM           10
      * Obtain default message file.
     C     *DTAARA       DEFINE    FCMGFLA       ZADFMF           10
     C                   IN        ZADFMF
      * Define work field Default Output Id
     C                   MOVEL     *BLANK        WUDFTO           10
      * Define work field Instruction Identifier
     C                   MOVEL     *BLANK        WUSOID           10
      * Define work field Multi-branching Indicator
     C                   MOVEL     *BLANK        WUMBIN            1
      * Define work field run day number
     C                   Z-ADD     *ZERO         WURUND            5 0
      * Define work field No. of Records
     C                   Z-ADD     *ZERO         WUNORC            5 0
      * Define work field No. of Inserts
     C                   Z-ADD     *ZERO         WUNOIN            5 0
      * Define work field No. of Amends
     C                   Z-ADD     *ZERO         WUNOAM            5 0
      * Define work field No. of Deletes
     C                   Z-ADD     *ZERO         WUNODL            5 0
      * Define work field Component Name
     C                   MOVEL     *BLANK        WUCOTT           10
      * Define work field Component Sequence Number
     C                   MOVEL     *BLANK        WUCSEQ            5
      * Define work field midas rundate
     C                   MOVEL     *BLANK        WURUNA            7
      * Define work field Set Up Complete
     C                   MOVEL     *BLANK        WUSSF             1
      * Define work field date format flag
     C                   MOVEL     *BLANK        WUDATF            1
      * Signal first error message outstanding.
     C                   MOVEL     'Y'           ZAFSMS            1
      * Select initial mode.
     C     @1NROP        IFEQ      *ZERO
     C                   MOVEL     'ADD'         W0PMD             3            Add mode
     C                   ELSE
     C                   MOVEL     'CHG'         W0PMD                          Change mode
     C                   END
      * USER: Initialise program
      * Last Amd Hdr Box fc0300r - Report Descriptions  *
      * get rundate - rundate  *
     C     *DTAARA       DEFINE                  RUNDAT
     C                   IN        RUNDAT
     C                   MOVE      RUNA          ##RUNA
     C                   MOVE      RUNA          WURUNA
     C                   MOVE      RUND          WURUND
     C                   MOVE      SSF           WUSSF
     C                   MOVE      DATF          WUDATF
     C                   MOVE      MBIN          WUMBIN
      * Get Mode flag from SDSTAT                                         178120
     C     *DTAARA       DEFINE    SDSTAT        @SDST                                         17812
     C                   IN        @SDST                                                       17812
     C     MODEF         IFEQ      'C'                                                         17812
     C                   SETON                                        50                       17812
     C                   ELSE                                                                  17812
     C                   SETOFF                                       50                       17812
     C                   END                                                                   17812
      * Set-up DTL Screen Footer - standard functions  *
     C     P1JTST        IFEQ      'D'
     C                   MOVEA     AENA(1)       ##AENA
     C                   END
     C     P1JTST        IFEQ      'A'
     C                   MOVEA     AENA(2)       ##AENA
     C                   END
     C     P1JTST        IFEQ      'I'
     C                   MOVEA     AENA(3)       ##AENA
     C                   END
      *CASE:     PAR.Report name is blank
     C     P2RNAM        IFEQ      *BLANK                                       *IF
     C                   MOVEL     @CN(12)       W0PMD                          *Program mode
     C                   END                                                    *FI
      *CASE:     PAR.Action Code is Insert
     C     P1JTST        IFEQ      @CN(03)                                      *IF
     C                   MOVEL     @CN(12)       W0PMD                          *Program mode
     C                   ELSE
      *CASE:     *OTHERWISE
     C                   MOVEL     @CN(13)       W0PMD                          *Program mode
     C                   END                                                    *FI
      * 00/copy member XX0300RIPG - Report Descriptions  *
      * 00/copy member XX0300RFPG - Report Descriptions  *
      * 00/copy member XX0300REPG - Report Descriptions  *
      * 00/copy member XX0300RCPG - Report Descriptions  *
     C*Edit Report Descriptions Initialise Program C-spec
     C/COPY WNCPYSRC,FC0300RCPG
      * 00/copy member XX0300ROPG - Report Descriptions  *
      *================================================================
     CSR   ZZEXIT        ENDSR
     O*Edit Report Descriptions Initialise Program O-spec
     O/COPY WNCPYSRC,FC0300ROPG
**
F3=Main Menu   F10=Delete   F12=Previous
F3=Main Menu   F12=Previous
F3=Main Menu   F12=Previous
**
F3=Main Menu   F12=Previous
** @CN Long constants used in program.
N
RCF0790
I
Y2U0005
Y2U0003
A
D
E
Y
FCREPTPD
Y2U9999
ADD
CHG
