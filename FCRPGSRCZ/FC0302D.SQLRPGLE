     H DATEDIT(*YMD)
      *****************************************************************
/**** *  RPGBASE                                                      *                     MD055265
/*STD *  RPGSQLBND                                                    *                     MD055265
/*EXI *  TEXT('Midas FC Display report components')
     H/TITLE Display Report Components Display file
     F* CRTRPGPGM
      *
     H* SYNOPSIS :
     H*  - Displays the records from DBF as a subfile.
     H*  - Loads the SFL from the SBF a page at a time.
     H*  - The DBF record at which the SFL display starts may be
     H*    controlled by positioning fields on the SFL header.
     H*  - Any key fields on the SFL header will be used as
     H*    positioning values.
     H*  - Any non-key fields on the SFL header will be used as
     H*    selection values: a maximum of W0SLM records will be
     H*    read from the DBF before giving up.
     H* Generated by  : Synon/2  Version:  8646
     H* Function type : Display file  Version:   0.1
      *
     H* Company    : Report Control Facility Model
     H* System     : Report Control Facility Model
     H* User name  : F6875SY
     H* Date       : 05/04/90 time: 12:15:15
      *  (c) Finastra International Limited 2001                      *
     H*
      *================================================================
     F* Maintenance   :
      *================================================================
     F********************************************************************
     F*                                                                  *
      *  Last Amend No. MD055265           Date 10Feb20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027             Date 09Dec05               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01407             Date 26Jan93               *
     F*                 LN1190             Date 29APR91               *
     F*                     S01314       DATE 24APR91                    *
     F*                     LN0792       DATE 26SEP90                    *
     F*                                                                  *
     F********************************************************************
     F*                                                                  *
      *  MD055265 - Deliverable Data Split for Report Control Facility*
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
     F*      S01407 - SWITCHABILITY ENHANCEMENTS                         *
     F*      LN1190 - REMOVE 'USR' MESSAGES AND REPLACE WITH 'RCF'       *
     F*               MESSAGES.                                          *
     F*      S01314 - Changes made during PTF incorporation.             *
     F*               Multilanguage subfile message tags changed         *
     F*      LN0792 - SCAN LIMIT SIZE INCREASED FROM 500 TO 99999        *
     F*                                                                  *
     F********************************************************************
     F*Display Report ComponentsInitialise Program F-Spec
     F/COPY WNCPYSRC,FC0302DFPG
     FFC0302D#  CF   E             WORKSTN
     F                                     SFILE(#SFLRCD:##RR)
     F                                     INFDS(INFDS#)
      * DSP: Display Report Components Display file
      *
     F***********FCRCOML1IF  E           K        DISK                    S01407
     F*FCRCOMJ1* IF   E           K DISK                                         S01407     MD055265
     F**********                           INFDS(INFDS1)                                    MD055265
      * RTV: Report Components         Retrieval index
      *
     F***********FCREPTL1IF  E           K        DISK                    S01407
     F*FCREPTJ0* IF   E           K DISK                                         S01407     MD055265
      * RTV: Report Descriptions       Retrieval index
      *
     D ARGV            S             78    DIM(3) CTDATA PERRCD(1)
      *
     D CPY@            S             80    DIM(1) CTDATA PERRCD(1)
     D*Display Report ComponentsInitialise Program E-Spec
     D/COPY WNCPYSRC,FC0302DEPG
     D @CN             S             25    DIM(3) CTDATA PERRCD(1)              Long constants.
     D*Display Report ComponentsInitialise Program I-Spec
     D/COPY WNCPYSRC,FC0302DIPG
      /EJECT
      * Data structures:-
     D PGMDS         ESDS                  EXTNAME(Y2PGDSP)
      * Program data structure.
     D JBDTTM          DS
      * Job date/time.
     D  ##JDT                  1      6  0
     D  ##JYY                  1      2  0
     D  ##JMM                  3      4  0
     D  ##JDD                  5      6  0
     D  ##JTM                  7     12  0
     D  ##JHH                  7      8  0
     D  ##JNN                  9     10  0
     D  ##JSS                 11     12  0
     D INFDS#        E DS                  EXTNAME(Y2I#DSP)
      * Display file information data structure.
      *
     D INFDS1        E DS                  EXTNAME(Y2I1DSP)
      * File information data structure.
      *
     D RUNDAT          DS
     D  RUNA                   1      7
     D  RUND                   8     10P 0
     D  SSF                   11     11
     D  DATF                  12     12
     D  MBIN                  13     13
      /EJECT
     D FCREPT        E DS                  EXTNAME(FCREPJW1)                                MD055265
     D NullIndsF       s              5i 0 dim(19)                                          MD055265
                                                                                            MD055265
      * Parameter declarations.
     D P1PARM          DS            25
      * KEY: Report Components         Retrieval index
      * I:RST Report name
     D  P1RNAM                 1     10
     D P2PARM          DS
      * B:    Action Code
     D  P2JTST                 1      1
     D*                                                                   S01407
     D PRCMSQ          DS            15                                         S01407
     D*                                                                   S01407
     D** PREVIOUS REPORT COMPONENT/SEQUENCE COMBINATION                   S01407
     D*                                                                   S01407
     D  ##COTT                 1     10                                         S01407
     D  ##CSEQ                11     15                                         S01407
     D*                                                                   S01407
     D CUCMSQ          DS            15                                         S01407
     D*                                                                   S01407
     D** CURRENT REPORT COMPONENT/SEQUENCE COMBINATION                    S01407
     D*                                                                   S01407
     D**D3COTT**               1     10                                         S01407      MD055265
     D  X3COTT                 1     10                                         S01407      MD055265
     D**D3CSEQ**              11     15                                         S01407      MD055265
     D  X3CSEQ                11     15                                         S01407      MD055265
     D FCRCOM        E DS                  EXTNAME(FCRCOJW1)                                MD055265
     D  XSARD        E                     EXTFLD(SARD)                                     MD055265
     D NullInds        s              5i 0 dim(12)                                          MD055265
      /EJECT
     C********************************************************************S01314
      *                                                                   S01314
      ** Call SDRTVTXT pgm to access appropriate text                     S01314
      ** for a field used in a SFL                                        S01314
      *                                                                   S01314
     C                   MOVEL     'ZZGBMSGF'    MSGNM                                         S0131
     C                   MOVEL     'ZZM1345'     MSGDNB                                        S0131
     C                   CALL      'SDRTVTXT'                                                  S0131
     C                   PARM                    MSGDNB            7                           S0131
     C                   PARM                    MSGNM            10                           S0131
     C                   PARM                    MSGTXT           80                           S0131
     C                   MOVEL     MSGTXT        ZZM002                                        S0131
      *                                                                   S01314
     C                   MOVEL     'ZZM0361'     MSGDNB                                        S0131
     C                   CALL      'SDRTVTXT'                                                  S0131
     C                   PARM                    MSGDNB            7                           S0131
     C                   PARM                    MSGNM            10                           S0131
     C                   PARM                    MSGTXT           80                           S0131
     C                   MOVEL     MSGTXT        ZZM003                                        S0131
      *                                                                   S01314
      *****************************************************************
     C     *ENTRY        PLIST                                                  Entry parameter
     C                   PARM                    P0RTN             7            Return code
     C                   PARM                    P1PARM                         KEY: Report Com
     C     P2JTST        PARM      P2JTST        WP0001            1            Action Code
      *****************************************************************
      * Initialise
     C                   EXSR      ZZINIT
      *
     C                   DO        *HIVAL
     C                   MOVE      *BLANK        PRCMSQ                                        S0140
      * Initialise & load subfile page.
     C                   EXSR      BAIZSF
     C                   MOVEL     'N'           W0RSF             1
      * Display screen until reload requested:
     C     W0RSF         DOWEQ     'N'
      * Display screen.
     C                   EXSR      CAEXFM
      *   Process response:
      * Cancel & exit program.
     C   03              CAS                     ZXEXPG
      * HOME: Request subfile reload.
     C   05              CAS                     FBRQRL
      *   Display next SFL page.
     C   27              CAS                     BBLDSF
      *   Process screen input.
     C                   CAS                     DAPR##
     C                   END
      *
     C                   END                                                    OD W0RSF
     C                   END                                                    OD *HIVAL
      *****************************************************************
      /EJECT
     CSR   BAIZSF        BEGSR
      *================================================================
      * Initialise & Load subfile page.
      *================================================================
      * Clear subfile.
     C                   SETON                                        80
     C                   WRITE     #SFLCTL
     C                   SETOFF                                       80
      * Reset no of records in subfile.
     C                   Z-ADD     *ZERO         ##RRMX            5 081         SETOF 81
      * USER: Initialise subfile control
     C                   MOVEL     *BLANK        #CAETX                         Screen report d
      * Screen report description
      * Get report description - Report Descriptions  *
     C                   EXSR      SARVGN
      * 00 /copy XX0302DISC - Report Components  *
     C*Display Report ComponentsInitialise Subf Control
     C/COPY WNCPYSRC,FC0302DISC
      * Position DBF file:
     C     KPOS          KLIST
     C                   KFLD                    D3RNAM                         Report name
     C                   KFLD                    D3COTT                         Component Name
     C                   KFLD                    D3CSEQ                         Component Seque
      * Setup key.
     C                   MOVEL     #2RNAM        D3RNAM                         Report name
     C                   MOVEL     #2COTT        D3COTT                         Component Name
     C                   MOVEL     #2CSEQ        D3CSEQ                         Component Seque
     C***********KPOS      SETLL@D3REI5                                   S01407
     C*****KPOS*         SETLL     FCRCOMD0                                           S0140 MD055265
     C     KRST          KLIST
     C                   KFLD                    D3RNAM                         Report name
      * Setup key.
     C                   MOVEL     #2RNAM        D3RNAM                         Report name
     C***********KRST      READE@D3REI5                8782*82=EOF        S01407
     C*****KRST*         READE     FCRCOMD0                             8782    *82=EOS0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ declare ACursor insensitive scroll cursor for                                       MD055265
     C+ select * from FCRCOJW1                                                              MD055265
     C+ where D3RNAM = :D3RNAM                                                              MD055265
     C+ order by D3RNAM, D3COTT, D3CSEQ                                                     MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ close ACursor                                                                       MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ open ACursor                                                                        MD055265
     C/END-EXEC                                                                             MD055265
                                                                                            MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from ACursor into :FCRCOM :NullInds                                      MD055265
     C/END-EXEC                                                                             MD055265
     C                   If        SQLCODE = 100                                            MD055265
     C                   SETON                                        82                    MD055265
     C                   ELSE                                                               MD055265
     C                   SETOFF                                       82                    MD055265
     C                   ENDIF                                                              MD055265
                                                                                            MD055265
      * Save previous selector values.
     C     *LIKE         DEFINE    #CAETX        WZAETX
     C                   MOVEL     #CAETX        WZAETX                         Screen report d
     C     *LIKE         DEFINE    #2COTT        WZCOTT
     C                   MOVEL     #2COTT        WZCOTT                         Component Name
     C     *LIKE         DEFINE    #2CSEQ        WZCSEQ
     C                   MOVEL     #2CSEQ        WZCSEQ                         Component Seque
     C     *LIKE         DEFINE    #2MORQ        WZMORQ
     C                   MOVEL     #2MORQ        WZMORQ                         Mandatory/On Re
     C     *LIKE         DEFINE    #2PRPG        WZPRPG
     C                   MOVEL     #2PRPG        WZPRPG                         Prompt Program
     C     *LIKE         DEFINE    #2ADTX        WZADTX
     C                   MOVEL     #2ADTX        WZADTX                         Additional Repo
     C     *LIKE         DEFINE    #2BRTP        WZBRTP
     C                   MOVEL     #2BRTP        WZBRTP                         Branch Type
      * Translate search mask for text field.
     C                   MOVEL     'QSYST'       WQB10X           10
     C                   MOVE      'RNTBL'       WQB10X
     C     *LIKE         DEFINE    #2PRPG        WQPRPG                         Prompt Program
     C                   CALL      'QDCXLATE'
     C                   PARM      10            WQA5N             5 0          Len
     C                   PARM      #2PRPG        WQPRPG                         Prompt Program
     C                   PARM                    WQB10X                         QSYSTRNTBL
     C                   PARM      'QSYS'        WQC10X           10
     C     *LIKE         DEFINE    #2ADTX        WQADTX                         Additional Repo
     C                   CALL      'QDCXLATE'
     C                   PARM      10            WQA5N             5 0          Len
     C                   PARM      #2ADTX        WQADTX                         Additional Repo
     C                   PARM                    WQB10X                         QSYSTRNTBL
     C                   PARM      'QSYS'        WQC10X           10
      * Load subfile page.
     C                   Z-ADD     0             ##RROK            5 0
     C                   EXSR      BBLDSF
      *================================================================
     CSR   BAEXIT        ENDSR
      /EJECT
     CSR   BBLDSF        BEGSR
      *================================================================
      * Load subfile page.
      *================================================================
      * Re-establish fields in read-ahead record.
     C   27              DO
     C**N82******          READP@D3REI5                  90*              S01407
     C**N82******          READ @D3REI5                  90*              S01407
     C**N82*****         READP     FCRCOMD0                               90    *     S0140 MD055265
     C**N82*****         READ      FCRCOMD0                               90    *     S0140 MD055265
     C                   If        *IN82 = '0'                                              MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch prior from ACursor into :FCRCOM :NullInds                                     MD055265
     C/END-EXEC                                                                             MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from ACursor into :FCRCOM :NullInds                                      MD055265
     C/END-EXEC                                                                             MD055265
     C                   Endif                                                              MD055265
     C                   END
      *
      * Start at previous highest record in SFL.
     C                   Z-ADD     ##RRMX        ##RR              5 0
      * Reset count of DBF records read.
     C                   Z-ADD     0             ##RRRD            5 0
      *................................................................
      * Load next SFL page until SFL page full, or :
      * scan limit reached.
     C******IN82         DOWEQ     '0'                                          DO          MD055265
     C*****##RROK        ANDLT     ##SFPG                                                   MD055265
     C*****##RRRD        ANDLT     W0SLM                                                    MD055265
     C                   DOW       SQLCODE = 0                                              MD055265
     C                             and ##RROK < ##SFPG                                      MD055265
     C                             and ##RRRD < W0SLM                                       MD055265
      * Check selection fields - if fail, read next record.
     C     #2COTT        IFEQ      *BLANK                                       Component Name
     C     #2CSEQ        IFNE      *BLANK                                       Component Seque
     C     D3CSEQ        CABLT     #2CSEQ        BB020                          Component Seque
     C                   END
     C                   END
     C     #2MORQ        IFNE      *BLANK                                       Mandatory/On Re
     C     D3MORQ        CABNE     #2MORQ        BB020                          Mandatory/On Re
     C                   END
     C     #2PRPG        IFNE      *BLANK                                       Prompt Program
      * Scan for search string.
     C                   CALL      'QCLSCAN'
     C                   PARM                    D3PRPG                         Prompt Program
     C                   PARM      10            WQA3N             3 0          Length
     C                   PARM      1             WQB3N             3 0          Start
     C                   PARM                    WQPRPG                         Mask
     C                   PARM      10            WQC3N             3 0          Length
     C                   PARM      '1'           WQD1              1            Translate
     C                   PARM      '1'           WQE1              1            Trim
     C                   PARM      '?'           WQF1              1            Wild
     C                   PARM                    WQG3N             3 0          Result
     C     WQG3N         CABLT     1             BB020
     C                   END
     C     #2ADTX        IFNE      *BLANK                                       Additional Repo
      * Scan for search string.
     C                   CALL      'QCLSCAN'
     C                   PARM                    D3ADTX                         Additional Repo
     C                   PARM      10            WQA3N             3 0          Length
     C                   PARM      1             WQB3N             3 0          Start
     C                   PARM                    WQADTX                         Mask
     C                   PARM      10            WQC3N             3 0          Length
     C                   PARM      '1'           WQD1              1            Translate
     C                   PARM      '1'           WQE1              1            Trim
     C                   PARM      '?'           WQF1              1            Wild
     C                   PARM                    WQG3N             3 0          Result
     C     WQG3N         CABLT     1             BB020
     C                   END
     C     #2BRTP        IFNE      *BLANK                                       Branch Type
     C     D3BRTP        CABNE     #2BRTP        BB020                          Branch Type
     C                   END
     C*                                                                   S01407
     C** IGNORE THIS RECORD IF IT IS FOR THE SAME COMPONENT NAME/         S01407
     C** SEQUENCE COMBINATION AS THE PREVIOUS RECORD                      S01407
     C*                                                                   S01407
     C                   eval      X3COTT = D3COTT                                          MD055265
     C                   eval      X3CSEQ = D3CSEQ                                          MD055265
     C     CUCMSQ        CABEQ     PRCMSQ        BB020                                         S0140
     C*                                                                   S01407
      * Load SFL fields.
     C                   EXSR      MBFL#1
     C                   EXSR      MC#1FN
     C                   MOVEL     'Y'           W0RSL             1
      * USER: Initialise subfile record from DBF record
      * split parms for screen - Report Components  *
     C*
     C** SPLIT PARAMETERS FOR SCREEN
     C*
     C                   MOVEL     #1CLPM        #RALNA
     C                   MOVE      #1CLPM        #RAMNA
      * 00 /copy XX0302Disr - Report Components  *
     C*Display Report ComponentsInitialise Subfile Rcd
     C/COPY WNCPYSRC,FC0302DISR
      * DBF Record not selected.
     C     W0RSL         CABNE     'Y'           BB020
      * Output to subfile.
     C                   ADD       1             ##RR                 81        *
     C                   ADD       1             ##RROK
      * Set screen conditioning indicators.
     C                   EXSR      GADSA1
     C                   WRITE     #SFLRCD
     C     BB020         TAG
      * Increment scan check count.
     C                   ADD       1             ##RRRD
     C                   MOVE      CUCMSQ        PRCMSQ                                        S0140
     C***********KRST      READE@D3REI5                  82*82=EOF        S01407
     C*****KRST*         READE     FCRCOMD0                               82    *82=EOS0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ fetch next from ACursor into :FCRCOM :NullInds                                      MD055265
     C/END-EXEC                                                                             MD055265
     C                   END                                                    OD 1 - ##SFPG
      *................................................................
      * If no DBF records found, display error message.
     C     ##RR          IFEQ      *ZERO
     C     *IN82         ANDEQ     '1'
      * Send message '*No data to display'
     C                   MOVEL     'Y2U0008'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   END                                                    FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point.
     C     ##RR          IFGT      ##RRMX
     C     ##RRMX        ADD       1             ##SFRC
     C                   Z-ADD     ##RR          ##RRMX
     C                   END
      * If scan limit reached, display error message.
     C     ##RRRD        IFGE      W0SLM
      * Send message '*Scan limit reached'
     C                   MOVEL     'Y2U0017'     ZAMSID                         Message id.
     C                   MOVEL     'Y2USRMSG'    ZAMSGF                         Message file.
     C                   EXSR      ZASNMS                                       Send message
     C                   ELSE
     C                   Z-ADD     0             ##RROK
     C                   END
      *================================================================
     CSR   BBEXIT        ENDSR
      /EJECT
     CSR   CAEXFM        BEGSR
      *================================================================
      * Display screen.
      *================================================================
      * Set screen conditioning indicators.
     C                   EXSR      GBDSA2
     C     W0HLP         DOUEQ     'N'
      * Update screen time.
     C                   TIME                    ##TME                          Screen time.
      * PUTOVR unless conditioned fields change.
     C                   SETON                                        86
     C     *IN81         IFNE      CAIN81
     C                   SETOFF                                       86
     C                   END
     C                   MOVE      *IN81         CAIN81            1
     C                   WRITE     #MSGCTL
     C                   WRITE     #CMDTXT1
     C                   EXFMT     #SFLCTL
     C                   MOVEL     'N'           W0HLP             1            Reset help requ
      * If help requested, display help text.
     C   25              EXSR      ZHHPKY                                       Display help te
     C                   END
      * Update job time.
     C                   TIME                    ##JTM                          Job time.
      * Clear messages from program message queue.
     C                   CALL      'Y2CLMSC'
     C                   PARM      ##PGM         ZAPGM            10
     C                   PARM      '*SAME'       ZAPGRL            5
      * Reset first message only flag.
     C                   MOVEL     'Y'           ZAFSMS            1      99    *
     C                   SETOFF                                         8388    *
      *================================================================
     CSR   CAEXIT        ENDSR
      /EJECT
     CSR   DAPR##        BEGSR
      *================================================================
      * Process screen input.
      *================================================================
      * Maintain subfile position where possible.
     C     @#SFRC        IFGT      *ZERO
     C                   Z-ADD     @#SFRC        ##SFRC
     C                   END
      *
      * Confirm/update is not defered.
     C                   MOVEL     'N'           W0DCF             1
      * Validate Mandatory/On Request
      * Name search required ?
     C                   MOVEL     #2MORQ        W0NSRQ            1            Mandatory/On Re
     C     W0NSRQ        IFEQ      '?'                                          Search required
     C                   CALL      'FCVLLSR'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C                   PARM      1100220       Y2LSNO            7 0          List number.
     C     #2MORQ        PARM      #2MORQ        W0EXVL           20            Mandatory/On Re
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
     C                   END
      * CALC: Subfile control function fields
      * 00/Copy Member XX0302DSFF - Report Components  *
     C*Display Report ComponentsCalculate Control Fields
     C/COPY WNCPYSRC,FC0302DSFF
     C                   MOVEL     *BLANK        #CAETX                         Screen report d
      * Screen report description
      * Get report description - Report Descriptions  *
     C                   EXSR      SBRVGN
      * Change of position specified.
     C     WZCOTT        CASNE     #2COTT        FBRQRL
     C     WZCSEQ        CASNE     #2CSEQ        FBRQRL
     C     WZMORQ        CASNE     #2MORQ        FBRQRL
     C     WZPRPG        CASNE     #2PRPG        FBRQRL
     C     WZADTX        CASNE     #2ADTX        FBRQRL
     C     WZBRTP        CASNE     #2BRTP        FBRQRL
     C                   END
      * USER: Process subfile control (Pre-confirm)
      * 00 /copy XX0302DPSC - Report Components  *
     C*Display Report ComponentsProcess Subfile Control
     C/COPY WNCPYSRC,FC0302DPSC
      * Reload subfile requested:
     C     W0RSF         CABEQ     'Y'           DAEXIT
     C     *IN81         IFEQ      '1'
      * Process subfile records.
     C                   EXSR      DBPRSF
     C                   END
      * USER: Final processing (Pre-confirm)
      * 00 /copy XX0302DFPR - Report Components  *
     C*Display Report ComponentsFinal Processing
     C/COPY WNCPYSRC,FC0302DFPR
      * If error, Quit processing:
     C     *IN99         CABEQ     '1'           DAEXIT
      * Defer confirm/update requested:
     C     W0DCF         CABEQ     'Y'           DAEXIT
      * USER: Process command keys
      * 00/Copy Member XX0302DPCK - Report Components  *
     C*Display Report ComponentsProcess Command Keys
     C/COPY WNCPYSRC,FC0302DPCK
      *CASE:     CTL.*CMD key is *Key screen
     C     *IN12         IFEQ      '1'                                          *IF
     C                   MOVEL     @CN(01)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
      *================================================================
     CSR   DAEXIT        ENDSR
      /EJECT
     CSR   DBPRSF        BEGSR
      *================================================================
      * Process modified subfile records.
      *================================================================
     C                   READC     #SFLRCD                                88    *
     C     *IN88         DOWEQ     '0'
      * Process SFL record.
     C                   EXSR      DCPRSR
      * Set screen conditioning indicators.
     C                   EXSR      GADSA1
     C                   UPDATE    #SFLRCD
     C                   READC     #SFLRCD                                88    *
     C                   END
      *================================================================
     CSR   DBEXIT        ENDSR
      /EJECT
     CSR   DCPRSR        BEGSR
      *================================================================
      * Process subfile record.
      *================================================================
      * Setof error indicators and SFLNXTCHG.
     C                   SETOFF                                       98        *
     C                   EXSR      MC#1FN
      * USER: Process subfile record (Pre-confirm)
      * 00 /copy XX0302DPSR - Report Components  *
     C*Display Report ComponentsProcess Subfile Record
     C/COPY WNCPYSRC,FC0302DPSR
     C     *IN98         IFEQ      '1'
      * SFLRCD invalid.
     C  N99              Z-ADD     ##RR          ##SFRC               99        Invalid SFLRCD
     C                   SETON                                        84        SFLNXTCHG
     C                   ELSE
      * SFLRCD valid.
     C                   SETOFF                                       84        SFLNXTCHG
     C                   END                                                    FI *IN98
      *================================================================
     CSR   DCEXIT        ENDSR
      /EJECT
     CSR   FBRQRL        BEGSR
      *================================================================
      * Request subfile reload.
      *================================================================
     C                   MOVEL     'Y'           W0RSF
      *================================================================
     CSR   FBEXIT        ENDSR
      /EJECT
     CSR   GADSA1        BEGSR
      *================================================================
      * Set display attributes for Subfile record.
      *================================================================
     C                   MOVEL     '0'           *IN78
     C     WUMBIN        IFEQ      @CN(02)                                      *IF
     C                   MOVEL     '1'           *IN78
     C                   END                                                    *FI
      *================================================================
     CSR   GAEXIT        ENDSR
      /EJECT
     CSR   GBDSA2        BEGSR
      *================================================================
      * Set display attributes for Subfile control.
      *================================================================
     C                   MOVEL     '0'           *IN79
     C     WUMBIN        IFEQ      @CN(02)                                      *IF
     C                   MOVEL     '1'           *IN79
     C                   END                                                    *FI
      *================================================================
     CSR   GBEXIT        ENDSR
      /EJECT
     CSR   MBFL#1        BEGSR
      *================================================================
      **Move*@D3REI5****fields*to*subfile.                                S01407
      * Move FCRCOMD0   fields to subfile.                                S01407
      *================================================================
     C                   MOVEL     D3RNAM        #1RNAM                         Report name
     C                   MOVEL     D3CLPM        #1CLPM                         Calling Paramet
     C                   MOVEL     D3COTT        #1COTT                         Component Name
     C                   MOVEL     D3CSEQ        #1CSEQ                         Component Seque
     C                   MOVEL     D3MORQ        #1MORQ                         Mandatory/On Re
     C                   MOVEL     D3ADTX        #1ADTX                         Additional Repo
     C                   MOVEL     D3PRPG        #1PRPG                         Prompt Program
     C                   MOVEL     D3BRTP        #1BRTP                         Branch Type
     C                   MOVEL     *BLANK        #RALNA                         Parameters part
     C                   MOVEL     *BLANK        #RAMNA                         Parameters part
      *================================================================
     CSR   MBEXIT        ENDSR
      /EJECT
     CSR   MC#1FN        BEGSR
      *================================================================
      * CALC: Subfile record function fields
      *================================================================
      * CALC: Subfile record function fields
      * 00 /copy XX0302DRFF - Report Components  *
     C*Display Report ComponentsCalculate Record Funcs
     C/COPY WNCPYSRC,FC0302DRFF
      *================================================================
     CSR   MCEXIT        ENDSR
      /EJECT
     CSR   MEIZ#2        BEGSR
      *================================================================
      * Initialise subfile control.
      *================================================================
     C                   MOVEL     P1RNAM        #2RNAM                         Report name
     C                   MOVEL     *BLANK        #CAETX                         Screen report d
     C                   MOVEL     *BLANK        #2COTT                         Component Name
     C                   MOVEL     *BLANK        #2CSEQ                         Component Seque
     C                   MOVEL     *BLANK        #2MORQ                         Mandatory/On Re
     C                   MOVEL     *BLANK        #2PRPG                         Prompt Program
     C                   MOVEL     *BLANK        #2ADTX                         Additional Repo
     C                   MOVEL     *BLANK        #2BRTP                         Branch Type
      * Check restriction within Report Descriptions.
     C                   EXSR      VACKRL
      *================================================================
     CSR   MEEXIT        ENDSR
      /EJECT
     CSR   SARVGN        BEGSR
      *================================================================
      * Get report description - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define Keylist.
     C     KRSSA         KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Move fields to key list.
     C                   MOVEL     P1RNAM        DXRNAM                         Report name
     C***********KRSSA     CHAIN@DXREIK              90    *              S01407
     C*****KRSSA         CHAIN     FCREPTD0                           90        *     S0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPT :NullIndsF                                                             MD055265
     C+ from FCREPJW1                                                                       MD055265
     C+ where DXRNAM = :P1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   SETOFF                                       90                    MD055265
     C                   IF        SQLCODE = 100                                            MD055265
     C                   SETON                                        90                    MD055265
     C                   ENDIF                                                              MD055265
      * DBF Record not found.
     C***90*****           MOVEL'USR0712' W0RTN   7                       LN1190
     C   90              MOVEL     'RCF0712'     W0RTN             7                           LN119
     C     *IN90         IFEQ      '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                   MOVEL     DXRDSC        #CAETX                         Report Descript
     C                   END
      *================================================================
     CSR   SAEXIT        ENDSR
      /EJECT
     CSR   SBRVGN        BEGSR
      *================================================================
      * Get report description - Report Descriptions  *
      *================================================================
     C                   MOVEL     *BLANK        W0RTN             7
      * Define Keylist.
     C     KRSSB         KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Move fields to key list.
     C                   MOVEL     P1RNAM        DXRNAM                         Report name
     C***********KRSSB     CHAIN@DXREIK              90    *              S01407
     C*****KRSSB         CHAIN     FCREPTD0                           90        *     S0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPT :NullIndsF                                                             MD055265
     C+ from FCREPJW1                                                                       MD055265
     C+ where DXRNAM = :P1RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   SETOFF                                       90                    MD055265
     C                   IF        SQLCODE = 100                                            MD055265
     C                   SETON                                        90                    MD055265
     C                   ENDIF                                                              MD055265
      * DBF Record not found.
     C***90*****           MOVEL'USR0712' W0RTN   7                       LN1190
     C   90              MOVEL     'RCF0712'     W0RTN             7                           LN119
     C     *IN90         IFEQ      '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                   MOVEL     DXRDSC        #CAETX                         Report Descript
     C                   END
      *================================================================
     CSR   SBEXIT        ENDSR
      /EJECT
     CSR   VACKRL        BEGSR
      *================================================================
      * Check restriction within Report Descriptions.
      *================================================================
      * Name search required ?
     C                   MOVEL     #2RNAM        WK1X01            1            Report name
     C     WK1X01        IFEQ      '?'                                          Report name
     C                   CALL      'FC0300S'                            90      *
     C                   PARM                    W0RTN             7            Return code
     C     #2RNAM        PARM      #2RNAM        WQ0001           10            Report name
     C     *IN90         IFEQ      '1'
      * Call to program ended in error.
     C                   MOVEL     'Y2U0021'     W0RTN             7
     C                   END
     C                   MOVEL     'Y'           W0DCF             1            Defer confirm
      * No value selected exit.
     C     W0RTN         CABNE     *BLANK        VA999
     C                   END
      *................................................................
      *
     C     KLVADX        KLIST
     C                   KFLD                    DXRNAM                         Report name
      * Setup key.
     C                   MOVEL     #2RNAM        DXRNAM                         Report name
     C***********KLVADX    CHAIN@DXREIK              9091  *              S01407
     C*****KLVADX        CHAIN     FCREPTD0                           9091      *     S0140 MD055265
     C/EXEC SQL                                                                             MD055265
     C+ SELECT *                                                                            MD055265
     C+ into :FCREPT :NullIndsF                                                             MD055265
     C+ from FCREPJW1                                                                       MD055265
     C+ where DXRNAM = :#2RNAM                                                              MD055265
     C/END-EXEC                                                                             MD055265
     C                   SETOFF                                       90                    MD055265
     C                   IF        SQLCODE = 100                                            MD055265
     C                   SETON                                        90                    MD055265
     C                   ENDIF                                                              MD055265
     C     *IN90         IFEQ      '0'
      * Record found - move back any virtuals.
     C                   GOTO      VAEXIT
     C                   END
     C     VA999         TAG
      * Restrictor relation not satisfied
      * Send message 'Report Descriptions    NF'
     C**********           MOVEL'USR0712' ZAMSID           Message id.    LN1190
     C                   MOVEL     'RCF0712'     ZAMSID                         Message id.    LN119
     C                   MOVEL     '*PRV '       ZAPGRL                         Pgmq rel.
     C                   EXSR      ZASNMS                                       Send message
     C**********           MOVEL'USR0712' P0RTN                           LN1190
     C                   MOVEL     'RCF0712'     P0RTN                                         LN119
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   VAEXIT        ENDSR
      /EJECT
     CSR   ZASNMS        BEGSR
      *================================================================
      * Send message to program's message queue.
      *================================================================
      * Send if first error message or not an error message.
     C     ZAMSTP        IFNE      *BLANK
     C     ZAFSMS        ORNE      'N'
     C     ZAMSTP        IFEQ      *BLANK
      * Signal first error message sent.
     C                   MOVEL     'N'           ZAFSMS
     C                   END
     C     ZAPGM         IFEQ      *BLANK
     C                   MOVEL     ##PGM         ZAPGM
     C                   END
      * If no message file specified use default.
     C     ZAMSGF        IFEQ      *BLANK
     C                   MOVEL     ZADFMF        ZAMSGF
     C                   END
     C                   CALL      'Y2SNMGC'
     C                   PARM                    ZAPGM            10            Program queue
     C                   PARM                    ZAPGRL            5            Rel queue
     C                   PARM                    ZAMSID            7            Message Id.
     C                   PARM                    ZAMSGF           10            Message file.
     C                   PARM                    ZAMSDA          132            Message data.
     C                   PARM                    ZAMSTP            7            Message type.
     C                   END
      * Clear all fields for default mechanism next time.
     C                   MOVEL     *BLANK        ZAPGM                          Program queue
     C                   MOVEL     *BLANK        ZAPGRL                         Rel queue
     C                   MOVEL     *BLANK        ZAMSID                         Message Id.
     C                   MOVEL     *BLANK        ZAMSGF                         Message file.
     C                   MOVEL     *BLANK        ZAMSDA                         Message data.
     C                   MOVEL     *BLANK        ZAMSTP                         Message type.
      *================================================================
     CSR   ZAEXIT        ENDSR
      /EJECT
     CSR   ZHHPKY        BEGSR
      *================================================================
      * Display HELP text.
      *================================================================
     C                   MOVEL     'Y'           W0HLP             1            Signal help req
     C                   CALL      'YDDSHPR'
     C                   PARM      ##PGM         W0HPMB           10            Member name.
     C                   PARM      *BLANK        YYHPFL           10            *DFT text file.
     C                   PARM      *BLANK        YYHPLB           10            Help text lib.
     C                   PARM                    W0RTN             7            Return Code.
      *================================================================
     CSR   ZHEXIT        ENDSR
      /EJECT
     CSR   ZXEXPG        BEGSR
      *================================================================
      * Cancel & exit program.
      *================================================================
      * USER: Exit program processing
      * 00/Copy Member XX0302DEPP - Report Components  *
     C*Display Report ComponentsExit Program Processing
     C/COPY WNCPYSRC,FC0302DEPP
      *CASE:     CTL.*CMD key is *Exit
     C     *IN03         IFEQ      '1'                                          *IF
     C                   MOVEL     @CN(03)       P0RTN                          *Return code
     C                   EXSR      ZYEXPG
     C                   END                                                    *FI
     C                   EXSR      ZYEXPG
      *================================================================
     CSR   ZXEXIT        ENDSR
      /EJECT
     CSR   ZYEXPG        BEGSR
      *================================================================
      * Exit program: Direct.
      *================================================================
      * Terminate program.
     C                   SETON                                        LR
      *
     C/EXEC SQL                                                                             MD055265
     C+ close ACursor                                                                       MD055265
     C/END-EXEC                                                                             MD055265
      * Exit program.
     C                   RETURN
      *
      *================================================================
     CSR   ZYEXIT        ENDSR
      /EJECT
     CSR   ZZINIT        BEGSR
      *================================================================
      * Initialisation.
      *================================================================
     C                   MOVE      *BLANK        P0RTN
     C                   MOVE      *BLANK        W0RTN             7
      * Setup job date/time.
     C                   Z-ADD     UDATE         ##JDT                          Job date.
     C                   TIME                    ##JTM                          Job time.
     C                   TIME                    ##TME             6 0          Screen time.
      * Define work field Multi-branching Indicator
     C                   MOVEL     *BLANK        WUMBIN            1
      * Obtain default message file.
     C     *DTAARA       DEFINE    FCMGFLA       ZADFMF           10
     C                   IN        ZADFMF
      * Define work field run day number
     C                   Z-ADD     *ZERO         WURUND            5 0
      * Define work field midas rundate
     C                   MOVEL     *BLANK        WURUNA            7
      * Define work field Set Up Complete
     C                   MOVEL     *BLANK        WUSSF             1
      * Define work field date format flag
     C                   MOVEL     *BLANK        WUDATF            1
      * Signal first error message outstanding.
     C                   MOVEL     'Y'           ZAFSMS            1
     C                   Z-ADD     03            ##SFPG            3 0          SFLPAG
     C                   Z-ADD     1             ##SFRC
     C                   Z-ADD     *ZERO         ##RRMX                         MAX RECNO
     C*********************Z-ADD500       W0SLM   50       SCAN LIMIT     LN0792
     C                   Z-ADD     99999         W0SLM             5 0          SCAN LIMIT     LN079
      *................................................................
      * USER: Initialise program
      * Last Amd Hdr Box fc0302d - Report Components  *
      * Set SFLNXTCHG on - Report Suffix  *
     C                   SETON                                        84
      * Initialise DSPRCD program
      * get rundate - rundate  *
     C     *DTAARA       DEFINE                  RUNDAT
     C                   IN        RUNDAT
     C                   MOVE      RUNA          ##RUNA
     C                   MOVE      RUNA          WURUNA
     C                   MOVE      RUND          WURUND
     C                   MOVE      SSF           WUSSF
     C                   MOVE      DATF          WUDATF
     C                   MOVE      MBIN          WUMBIN
      * Standard RPG Creation PAR - standard functions  *
      *  C R E A T I O N     P A R A M E T E R S
      *
      *
      ********************************************************************
      * Set-up KEY Screen Footer - standard functions  *
     C                   MOVEA     ARGV(1)       ##AENA
      * Copyright Statement - standard functions  *
     C                   MOVEA     CPY@          BIS@             80
      * 00/Copy Member XX0302DFPG - Report Components  *
      * 00/Copy Member XX0302DEPG - Report Components  *
      * 00/Copy Member XX0302DIPG - Report Components  *
      * 00/Copy Member XX0302DCPG - Report Components  *
     C*Display Report ComponentsInitialise Program C-Spec
     C/COPY WNCPYSRC,FC0302DCPG
      * 00/Copy Member XX0302DOPG - Report Components  *
      * Initialise subfile control.
     C                   EXSR      MEIZ#2
      *================================================================
     CSR   ZZEXIT        ENDSR
     O*Display Report ComponentsInitialise Program O-Spec
     O/COPY WNCPYSRC,FC0302DOPG
**
F3=Main Menu   F12=Previous
** CPY@
(c) Finastra International Limited 2001
** @CN Long constants used in program.
PREVSCN
N
Y2U9999
