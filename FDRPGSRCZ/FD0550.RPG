     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FD Money market rates maintainance')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - STANDING DATA                                    *
     F*                                                               *
     F*  FD0550 - MONEY MARKET RATES MAINTENANCE                      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. 250662             Date 07Feb22               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 AR851109           Date 09Mar15               *
      *                 CCB020             Date 06Aug12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      * Midas DBA 3.05 -----------------------------------------------*
     F*                 CSD006             DATE 02FEB01               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 067980             DATE 16JUN94               *
     F*                 061426             DATE 30SEP93               *
     F*                 S01319             DATE 20AUG91               *
     F*                 S01328             DATE 04FEB91               *
     F*                 S01117             DATE 04FEB91               *
     F*                 S01314             DATE 31JAN91               *
     F*                 E21137             DATE 18FEB90               *
     F*                 S01194             DATE 23JAN90               *
     F*                 S01195             DATE 23JAN90               *
     F*                 E12802             DATE 08/04/88              *
     F*                 E12796             DATE 06/04/88              *
     F*                 FM1100             DATE 26/05/87              *
     F*                 S01136             DATE 05/01/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  250662 - Input is not allowed for enquiry mode.              *
      *  MD046248 - Finastra Rebranding                               *
      *  AR851109 - Cannot enter -ve rates. Applied for MD033488.     *
      *  CCB020 - COB Restructure - Secondary COB Infrastructure      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  CPK014 - Release 4 packaging.  Rename of field which is too  *
      *           long for OPM program.                               *
     F*  CSD006 - Market data feed recompile.                         *
     F*  067980 - Do not default action code to 'E' and cursor        *
     F*  067980 - Do not default action code to 'E' and cursor        *
     F*           should not be on the currency line at once.         *
     F*  061426 - Recompile after ZDATE9 correction                   *
     F*  S01319 - Remove redundant processing                         *
     F*           Avoid SPF processing if at Next Day Setup           *
     F*  S01328 - FRA/IRS REVALUATION -                               *
     F*              1. EXTEND RATES OUT TO 10 YEARS                  *
     F*              2. INCORPORATE SCREEN INTO ONE SUBFILE - REMOVE  *
     F*                 UNNECESSARY VALIDATION.                       *
     F*              3. REMOVE UNNECESSARY UPDATE OF CURRENCY HEADER  *
     F*                 RECORD ON TABLETX                             *
     F*  S01117 - MULTI-BRANCHING MODIFICATIONS                       *
     F*  S01314 - INCORPORATION CHANGES                               *
     F*  E21137 - Check MMOD for DRS before updating PC files.        *
     F*  S01194 - NEW STANDING DATA CHANGES                           *
     F*  S01195 - NEW HOLIDAY PROCESSING                              *
     F*  E12802 - APPROPRIATE ERROR MESSAGE FOR INVALID ENTRY         *
     F*           IN RATES FIELDS ADDED.                              *
     F*  E12796 - PROGRAM COMPILED DUE TO FILE CHANGE FDINTRPP        *
     F*  S01136 - EXTRA VALIDATION: WHEN SPOT DAYS = 1,SPOT/NEXT      *
     F*           MUST BE THE SAME AS TOMORROW/NEXT.                  *
     F*                                                               *
     F*****************************************************************
     F**  Indicator Function Summary                                 *
     F*                                                              *
     F* ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~   *
     F*                                                              *
     F*       KC         END
     F*       KL         END OR GO TO INITIAL LEVEL
     F*       KH         NEXT RECORD
     F*       KG         PREVIOUS RECORD
     F********KP         SELECT SCREEN                                    S01117
     F*       KJ         CONFIRM DELETE
     F*
     F*       10         SFLEND FD0140S1
     F*
     F*       20         ERROR ON FIELD DDACTN
     F*       21         ERROR ON FIELD DDCCY
     F*       22         POSITION CURSOR ON FIELD DDCCY                   S01328
     F********22         ERROR ON FIELD DD01BR                            S01328
     F********23         ERROR ON FIELD DD01LR                            S01328
     F********24         ERROR ON FIELD DDPDX1                            S01328
     F********25         ERROR ON FIELD DD02BR                            S01328
     F********26         ERROR ON FIELD DD02LR                            S01328
     F********27         ERROR ON FIELD DDPDX2                            S01328
     F*       30         ERROR ON FIELD DD03BR
     F*       31         ERROR ON FIELD DD03LR
     F*       32         ERROR ON FIELD DDPDX3
     F*       33         ERROR ON COMPARISON OF CALCULATED RATES
     F*       34         ERROR IN DD03BR AND NO ERROR PRIOR TO
     F*                  SUBFILE VALIDATION
     F*       35         ERROR IN DD03LR AND NO ERROR PRIOR TO
     F*                  SUBFILE VALIDATION
     F*       36         SUCCESSFUL VALIDATION OF ACTION CODE
     F*
     F********40         DISPLAY ENQUIRY SUBFILE AND CONTROL RECORD       S01117
     F********41         CLEAR ENQUIRY SUBFILE                            S01117
     F*       43         CLEAR POINTS SUBFILE
     F*       45         CLEAR MESSAGE SUBFILE
     F********46         PROTECT CURRENCY CODE FOR CMD/15                 S01194
     F*
     F*       50         ROLLUP
     F*       55         SETON WHEN SUBFILE EXITED
     F*       59         END OF SUBFILE WHEN READC
     F*
     F*       60         AMEND MODE
     F*       61         INSERT MODE
     F*       62         ENQUIRE MODE
     F*       63         DELETE MODE
     F*
     F*       64         ERROR INDICATOR
     F*       65         PRIOR READ WAS SUCCESSFUL
     F*       66         AT SUBFILE LEVEL
     F*       67         INSERT OVER DELETED RECORD
     F*       68         CHAIN FAIL TO FILE FDCCYLL
     F*       69         MATCHING MONTH SHORTNAME FOUND IN ARRAY
     F*
     F*       70         EOF ON READING DISPLAY FILE
     F*       71         LEVEL FLAG
     F*       72         BEGINNING OF FDINTRLL
     F*       73         END OF FDINTRLL
     F*       74         RECORD LOCKED
     F*       75         CHANGE OF ACTION CODE AT LEVEL 2
     F*       76         CHAIN FAIL TO FILE ANY SECONDARY FILES
     F*       77         INDICATES END OF READ OR READP
     F*       78         RECORD LOCKING ON FDINTULL
     F*
     F*       80         INVALID CHARS IN POINTS FIELD
     F*       81         LOKUP OF ARRAY @CY   : ZA0830
     F*       82         SIGN ENTERED IN POINTS FIELD
     F*       83         NUMBER ENTERED IN POINTS FIELD
     F*       85         POINTS FIELD IN ERROR
     F********90*********STOP*ZERO*SUPRESSION*IN*#ZL*FOR*PC*UPDATE******* S01319
     F*
     F*       U7         DATA BASE ERROR
     F*       U8         DATA BASE ERROR
     F*
     F*****************************************************************
     F/EJECT
     F**FDICDRLLIF  E           K        DISK         KINFSR *PSSR        S01194
     F*****       TABTB11F                          KIGNORE               S01194
     F*****       TABTB20F                          KIGNORE               S01194
     FFDTTOTLLUF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     FFDINTULLUF  E           K        DISK         KINFSR INFSR A
     F                                              KINFDS INFDS
     F                                              KCOMIT
     F            FDINTRP0                          KRENAMEFDINTUP0
     FFDINTRLLIF  E           K        DISK         KINFSR *PSSR
     F**FDTABJLLIF  E         K        DISK         KINFSR *PSSR      UC  S01195
     F*FDINSTLLIF**E*******************DISK*********KINFSR**PSSR**********S01319
     F*FDCCYTLLIF**E***********K********DISK*********KINFSR *PSSR         S01194
     F*************TABTG10F**************************KRENAMEFDCCYTL0      S01194
     FFD0550DDCF  E                    WORKSTN      KINFSR *PSSR
     F                                        @RRN  KSFILE FD0550S1
     F****************************************@RRN**KSFILE FD0550S3       S01117
     F                                        @RRN1 KSFILE FD0550S5
     F*CMSDULL*O***E*******************DISK*************************FM1100S01319
     E                    @MTH   12  12  3               MONTH S/NAMES
     E********************@PDD    4  20 15               PERIOD NAMES     S01328
     E********************@LR        20 11 7             LEND RATES       S01328
     E********************@BR        20 11 7             BORROW RATES     S01328
     E********************@PTP   20  20  1               PERIOD TYPES     S01328
     E********************@PRD   20  20  2 0             PERIODS          S01328
     E                    @PDD    4  24 15               PERIOD NAMES     S01328
     E                    @LR        24 11 7             LEND RATES       S01328
     E                    @BR        24 11 7             BORROW RATES     S01328
     E                    @PTP   24  24  1               PERIOD TYPES     S01328
     E                    @PRD   24  24  2 0             PERIODS          S01328
     E                    @EM        10  1               ERROR FLAGS
     E                    @MSG    1   1 48               COMIT MSG
     E*
     E****ARRAY*FOR*SR.*ZA0680 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIODS01328
     E********************@YD     4   4  5 0A                             S01328
     E*
     E****ARRAY*FOR*SR.*ZA0680 - CUMULATIVE DAYS IN YEAR PER MONTH        S01328
     E********************@MD    13  13  5 0A                             S01328
     E/COPY ZSRSRC,ZDATE9Z1                                               S01328
     E*
     E****USED BY SR. ZA0830 - CURRENCY RECORDS                           S01195
     E*****               @CY        50  3                                S01195
     E*
     E**  USED BY SR. MM1017
     E                    @W         13  1
     E*
      * input array for za0840
     E                    @F         16  1
     E*
      * output array for za0840
     E                    @G         16  1
     E*
      * array of powers of ten
     E                    @H      1  15 15 0
     E*                                                                   FM1100
     E****ARRAY*SPLIT*INTO*TWELVE*ELEMENTS**FOR DIFFERENT PERIODS   FM1100S01328
     E**  ARRAY SPLIT INTO 21 ELEMENTS FOR DIFFERENT PERIODS              S01328
     E**  IN FILE FDINTRLL                                                FM1100
     E********************@A         12 37                          FM1100S01328
     E                    @A         21 37                                S01328
     E*                                                                   FM1100
     E***ARRAY*TO*HELP*UPDATE*CMSDUPP*******************************FM1100S01319
     E********************@S********200**5**************************FM1100S01319
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80
     E** COMPILE TIME ARRAY FOR COPYRIGHT STATEMENT
     E*
     E/COPY ZSRSRC,ZDATE2Z1                                               S01328
     E*                                                                   S01328
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     I/EJECT
      *                                                                                       CPK014
     IFDINTRP0                                                                                CPK014
     I              HWTMESTMP                       HWTMST                                    CPK014
     IFDINTUP0                                                                                CPK014
     I              HWTMESTMP                       HXTMST                                    CPK014
     ITABLETXF
     I              RECI                            HRECI
     I              KEY                             HKEY
     I*                                                                   S01328
     I****DATA*STRUCTURE FOR SR. ZA0710 - FIELD IS @@Z71Y                 S01328
     I************DS                                                      S01328
     I************                            1   40@@Z71Y                S01328
     I************                            2   20@@SSY2                S01328
     I****DATA*STRUCTURE FOR SR. ZA0710 - FIELD IS @@VDT                  S01328
     I************DS                                                      S01328
     I************                            1   80@@VDT                 S01328
     I************                            1   40@@YR                  S01328
     I************                            5   60@@Z71M                S01328
     I************                            7   80@@Z71D                S01328
      *                                                                   S01328
     I/COPY ZSRSRC,ZDATE9Z2                                               S01328
     I*
     I****DATA*STRUCTURE FOR SR. ZA0680 - DATE INPUT TO SUBROUTINE        S01328
     I**  DATA STRUCTURE FOR DATE INPUT TO VARIOUS SUBROUTINES            S01328
     I            DS
     I                                        1   80@@DTIN
     I************                            1   40@@YYYY                S01328
     I************                            1   20@@CC                  S01328
     I************                            5   60@@MTH                 S01328
     I************                            7   80@@DAY                 S01328
     I*
     I                                        3   40@@YY
     I                                        5   60@@MM
     I                                        7   80@@DD
     I/COPY ZSRSRC,ZDAT10Z1                                               S01328
     I*
     I            DS                              6
     I                                        1   60@@DTOU
     I                                        1   20@@DAT1
     I                                        3   40@@DAT2
     I                                        5   60@@YYY
     I**  DATASTRUCTURE TO CHANGE FORMAT TO MMDDYY / DDMMYY
     I*
     I*
     I****        DS                                                      S01195
     I****                                                                S01195
     I****USED BY SR. ZA0830 - ARRAY DATA STRUCTURE                       S01195
     I****                                    1 150 @CY                   S01195
     I****                                    1  75 @@CY1                 S01195
     I****                                   76 150 @@CY2                 S01195
     I*
     IINFDS       DS
     I* DATA STRUCTURE FOR FILE STATUS
     I                                     *STATUS  STATUS
     IPSDS       SDS
     I*
     I**  PROGRAM STATUS DATA STRUCTURE
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I***@PCFT1****E*DSFDPCYPPP                                           S01319
     I*
     I***INTEREST*RATES*POINTS*****************************************   S01319
     I***@PCFT2****E*DSFDPCCYPP                                           S01319
     I*
     I*                                                                   FM1100
     I@INTL2      DS                          2  37                       FM1100
     I*                                                                   FM1100
     I**  DATA AREA TO INITIALISE FIELDS IN FDINTRLL                      FM1100
     I                                        1   8 @WPD                  FM1100
     I                                        9  10 @WPR                  FM1100
     I                                       11  11 @WTP                  FM1100
     I                                       12  15 @WPX                  FM1100
     I                                       16  26 @WBR                  FM1100
     I                                       27  37 @WLD                  FM1100
     I*
     I** CURRENCY DETAILS
     I@KEY        DS                             12
     I*
     I****Key*to*access*FDTTOTLL*,*FDCCYTTLL.**                           S01194
     I**  Key to access FDTTOTLL                                          S01194
     I                                        1   2 @KEY1
     I*                                       9  11 @KEY2
     I*                                      12  12 @KEY3
     I*                                       7  110@KEY6
     I           UDS
     I*
     I**  LOCAL DATA AREA FOR DATA BASE ERROR
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPROG
     I                                      181 183 DBASE
     IDNATN       DS                              5
     I* DATA STRUCTURE TO UPDATE TRANSACTION NUMBER DATA AREA
     I**
     I                                        1   50FNATN
     ICMTTXT      DS                            101
     I* DATA STRUCTURE FOR TEXT ON COMIT ON JOURNAL
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTCDX
     I                                       26  35 USRIDX
     I                                       51  98 @MSGX
     I                                       99 101 @CCYX
     I*@SCRKY******DS                                                     S01194
     I*
     I**KEY*TO*READ*RECORDS OFF FDCCYTLL                                  S01194
     I****************************************9  11 DDCCY                 S01194
     I***************************************12  12 @KEY4                 S01194
     I            DS                              7
     I*
     I***DATA*AREA*TO*HOLD*THE*DATE*OF*UPDATE*FROM RUNA IN DDMMMYY FORMAT S01194
     I****************************************1   7 RUNA                  S01194
     I                                        1   7 XXMRDT                S01194
     I                                        1   20@DD
     I                                        3   5 @MMM
     I                                        6   70@YY
     I@DATE       DS                              6
     I*
     I** DATA AREA TO HOLD THE DATE OF UPDATE FROM RUNA IN DDMMYY FORMAT
     I                                        1   20@DLUP
     I                                        3   40X
     I                                        5   60@YLUP
     I            DS                             70
     I*
     I** DATA STRUCTURE TO HOLD SCREEN FIELDS FROM FORMAT FD0550S0
     I                                        5  70 DDFLDS
     I                                        1   1 DDACTN
     I*********                               2   4 DDCCY2
     I*********                               5  16 DD01BR                S01328
     I*********                              17  28 DD01LR                S01328
     I*********                              29  32 DDPDX1                S01328
     I*********                              33  44 DD02BR                S01328
     I*********                              45  56 DD02LR                S01328
     I*********                              57  60 DDPDX2                S01328
     I*
     I*@DDS*******DS                         20                           S01328
     I@DDS        DS                         24                           S01328
     I*
     I** DATA STRUCTURE TO HOLD THE MULTIPLE
     I                                        1  12 @03LR
     I                                       13  24 @03BR
     I                                       25  28 @PDX3
     I*
     I**  DATA STRUCTURE HOLDING STARTING POINT DATE
     I            DS
     I                                        1   80@@STRT
     I                                        1   40@@STYR
     I                                        5   60@@STMT
     I                                        7   80@@STDY
     I*
     I**  DATA STRUCTURE HOLDING SPOT DATE
     I            DS
     I                                        1   80@@SPDD
     I                                        5   60@@SPMT
     I*
     I**  DATA STRUCTURE DAYS FOR DATE FORMAT DDMMYY
     I            DS
     I                                        1   60@@DATE
     I                                        1   20@@DAY2
     I*                                                                   FM1100
     I****DATA*STRUCTURE*FOR*RECORD*I.D.*AND*CURRENCY*CODE*IN*SUSDUDFM1100S01319
     I*@SUS*******DS******************************5*****************FM1100S01319
     I****************************************1***2*@WRCID**********FM1100S01319
     I****************************************3***5*@WCCY***********FM1100S01319
     I*                                                                   E21137
     ISDMMOD    E DSSDMMODPD                                              E21137
     I** MIDAS MODULES DETAILS ACCESSED VIA ACCESS PROGRAM                E21137
     I*
     ISDBANK    E DSSDBANKPD                                              S01194
     I** DUMMY RECORD FORMATS FOR ACCESS TO BANK DETAILS                  S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I* CURRENCY DETAILS ACCESSED VIA ACCESS PROGRAM                      S01194
      *                                                                   S01319
     ISDDEAL    E DSSDDEALPD                                              S01319
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01319
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I* USED BY HOLIDAY /COPY ROUTINES
      *                                                                   S01319
     IRUNDAT      DS                                                      S01319
     I** DATA STRUCTURE FOR MULTIBRANCH INDICATOR USING RUNDAT.           S01319
     I                                       13  13 @MBIN                 S01319
     I*                                                                   S01319
     IZMUSER      DS                             17                       S01319
     I                                       11  13 DBRN                  S01319
     I**MPHAS*******DS                              1                                  S01319 CCB020
      **Read*in*phase*to*see*if*SPF*processing*needs*to*be*done********                       CCB020
     I**********                              1   1 PHASE                              S01319 CCB020
     I*                                                                   S01117
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I/EJECT
     C*****************************************************************
     C*                                                               *
     C* MAIN PROCESSING - THIS ROUTINE CONTROLS THE WHOLE PROGRAM     *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :      #A                                               *
     C*              #B                                               *
     C*              #C                                               *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C                     EXSR #A
     C*
     C                     EXSR #B
     C*
     C                     EXSR #C
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C* ----------------                                              *
     C*                                                               *
     C* 1  #ZG    -  WRITE MAIN SCREEN                                *
     C* 2  #ZF    -  READ MAIN SCREEN                                 *
     C* 3  #B     -  GETS OPTION AND CALLS ROUTINE                    *
     C* 4  #ZA    -  READ NEXT LIVE RECORD ON MAIN FILE               *
     C* 5  #ZB    -  READ PREVIOUS LIVE RECORD ON MAIN FILE           *
     C* 7  #BA    -  CF8                                              *
     C* 8  #BB    -  CF7                                              *
     C**9**#BC****-**CF15                                             *   S01194
     C**10*#BCA***-**FILL SUBFILE                                     *   S01194
     C**11*#BCB***-**GET RECORD CHOSEN FROM SUBFILE                   *   S01194
     C**12*#BCC***-**PROCESS CHOSEN RECORD                            *   S01194
     C* 13 #ZH    -  CF12                                             *
     C* 14 #ZI    -  CF10                                             *
     C* 15 #ZJ    -  AMEND                                            *
     C**16*#ZK****-**DELETE                                           *   S01117
     C* 16 #ZP    -  DELETE                                           *   S01117
     C* 17 #BD    -  INPUT                                            *
     C* 18 #BE    -  ENQUIRE                                          *
     C* 19 #ZZ    -  READ RECORD AND LOAD DISPLAY FIELDS              *
     C* 20 #ZC    -  VALIDATE INPUT FOR SCREEN INPUT                  *
     C* 21 ZA0840 -  Validate/reformat input amount                   *
     C* 22 #ZD    -  UPDATE A RECORD ON MAIN FILE                     *
     C* 23 #ZE    -  WRITE A RECORD TO MAIN FILE                      *
     C* 24 MM1003 -  Calculate a period date                          *
     C* 25 #ZX    -  Load screen fields                               *
     C* 26 MM1017 -  Convert interest rate to display  (NO SIGN)      *
     C**27*ZA0680*-  Convert YYYYMMDD format date to a midas day no.  *   S01328
     C**28*ZA0710*-  Convert a midas day no. to a YYYYMMDD format date*   S01328
     C* 27 ZDAT10 -  Converts YYYYMMDD Date to Midas Day Number       *   S01328
     C* 28 ZDATE9 -  Converts Midas Day Number to YYYYMMDD Format     *   S01328
     C**29*ZA0730*-  Determine next working day                       *   S01195
     C* 29 ZA073C -  Determine next working day                       *   S01195
     C* 30 ZA0770 -  Date conversion YYYYMMDD to MMDDYY
     C**31*ZA0830*-  Determine if date is a holiday for currency      *   S01195
     C* 31 ZCHKH  -  Determine if date is a holiday for currency      *   S01195
     C* 32 ZTNLU1 -  Update last transaction number                   *
     C* 33 #A     -  INITIALISE DISPLAY FIELDS                        *
     C**34*ZA0150*-**Access*installation*file*FDICDRLL*****************   S01194
     C* 35 #C     -  TERMINAL PROCESSING                              *
     C* 36 INFSR  -  HANDLES ERRORS ON FILE FDINTRLL                  *
     C* 37 *PSSR  -  HANDLES ALL OTHER PROGRAM AND FILE ERRORS        *
     C* 38 ZDATE2 -  Convert day no. to DDMMMYY format.               *   S01328
     C*                                                               *
     C* EXTERNAL SUBROUTINES                                          *
     C* 1 ZA0240  -  SEND PROGRAM MESSAGE                             *
     C* 2 ZA0250  -  CLEAR PROGRAM MESSAGE QUEUE                      *
     C* 3 ZA0270  -  CONVERT START DATE TO MIDAS DAY NUMBER           *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZG  - THIS SUBROUTINE DISPLAYS THE MAIN SCREEN.              *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C**************#BC                                               *   S01194
     C**************#BCC                                              *   S01194
     C*             #ZJ                                               *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :      @ACTN  - SAVED ACTION CODE                        *
     C*             @CCNM  - SAVED CURRENCY NAME                      *
     C*             @CCY   - SAVED CURRENCY                           *
     C*             @FLDS  - SAVED LEND/BOR/SPOT RATES + PERIOD 1 & 2 *
     C*             @CNT   - COUNT OF SUBFILE RECORDS                 *
     C*             @DDS   - DATA STRUCTURE HOLDING THE SAVED S/FILE  *
     C*             @PDX3  - SAVED PERIOD SNAME 3                     *
     C*             @03BR  - SAVED LEND RATE 3                        *
     C*             @03LR  - SAVED BORROW RATE 3                      *
     C*             @X     - MULTIPURPOSE INDEX                       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZG       BEGSR
     C*
     C                     TIME           DDTIME
     C*
     C** SAVE ALL DISPLAY FIELDS BEFORE DISPLAYING SCREEN
     C** FIRST SAVE ALL THE SUBFILE FIELDS IN THE DATA STRUCTURE
     C           1         DO   @CNT      @X               B1
     C           @X        CHAINFD0550S5             78    *1
     C           @X        OCUR @DDS                       *1
     C                     MOVE DD03LR    @03LR            *1
     C                     MOVE DD03BR    @03BR            *1
     C                     MOVE DDPDX3    @PDX3            *1
     C                     END                             E1
     C*
     C** NOW MOVE THE OTHER FIELDS
     C*
     C***IF*ACTION*CODE*BLANK*DEFAULT*TO*'E'***************************   067980
     C***********DDACTN    IFEQ ' '                        B1             067980
     C***********          MOVE 'E'       DDACTN           *1             067980
     C***********          END                             E1             067980
     C*                                                                   067980
     C** Position cursor on action code                                   067980
     C*                                                                   067980
     C           *IN20     IFEQ '1'                                       067980
     C           DDACTN    OREQ *BLANK                                    067980
     C                     MOVE '1'       *IN23                           067980
     C                     END                                            067980
     C*                                                                   067980
     C                     MOVE DDACTN    @ACTN
     C                     MOVE DDCCY     @CCY
     C                     MOVE DDCCNM    @CCNM
     C                     MOVE DDFLDS    @FLDS
     C                     MOVE *IN21     @IN21   1
     C***********                                                  S01328 067980
     C**IF*CURRENCY*IN*ERROR*OR*BLANK,*POSITION*CURSOR*ON*CURRENCY S01328 067980
     C***********                                                  S01328 067980
     C************IN21     IFEQ '1'                                S01328 067980
     C***********DDCCY     OREQ *BLANK                             S01328 067980
     C***********          MOVE '1'       *IN22                    S01328 067980
     C***********          END                                     S01328 067980
     C*
     C** DISPLAY THE MAIN SCREEN
     C                     WRITEFD0550S0
     C*
     C** DISPLAY THE SUBFILE POINTS FIELDS
     C** BUT NOT IF JUST CLEARING THE MESSAGE SUBFILE
     C           *IN45     IFEQ '0'                        B1
     C                     WRITEFD0550S4                   *1
     C*
     C** DISPLAY THE SCREEN FOOTER
     C                     WRITEFD0550D0                   *1
     C                     END                             E1
     C*
     C** REDISPLAY THE MAIN SCREEN IF THERE WAS AN ERROR; OTHERWISE
     C** THE CURSOR REPOSITIONS ON THE FIRST INPUT CAPABLE FIELD.
     C           *IN20     IFEQ '1'                        B1
     C           *IN21     OREQ '1'                        *1
     C************IN46     OREQ '1'                        *1             S01194
     C           *IN22     OREQ '1'                        *1
     C           *IN23     OREQ '1'                        *1             067980
     C************IN23     OREQ '1'                        *1             S01328
     C************IN24     OREQ '1'                        *1             S01328
     C************IN25     OREQ '1'                        *1             S01328
     C************IN26     OREQ '1'                        *1             S01328
     C************IN27     OREQ '1'                        *1             S01328
     C           *IN28     OREQ '1'                        *1
     C           *IN29     OREQ '1'                        *1
     C                     WRITEFD0550S0                   *1
     C                     END                             E1
     C*
     C                     MOVE '0'       *IN22                           S01328
     C           #ZG9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZF  - THIS SUBROUTINE READS THE MAIN SCREEN AND CLEARS ALL   *
     C*        THE ERROR INDICATORS                                   *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C**************#BCC                                              *   S01194
     C*             #ZJ                                               *
     C*                                                               *
     C* CALLS :     ZA0250                                            *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZF       BEGSR
     C*
     C** READ THE SCREEN
     C                     READ FD0550S0                 70
     C*
     C** CLEAR PROGRAM MESSAGE QUEUE
     C                     CALL 'ZA0250'
     C*
     C** RESET ALL ERROR INDICATORS
     C                     MOVE '0'       *IN20
     C                     MOVE '0'       *IN21
     C                     MOVE '0'       *IN22                           067980
     C                     MOVE '0'       *IN23                           067980
     C***********          MOVE '0'       *IN22                           S01328
     C***********          MOVE '0'       *IN23                           S01328
     C***********          MOVE '0'       *IN24                           S01328
     C***********          MOVE '0'       *IN25                           S01328
     C***********          MOVE '0'       *IN26                           S01328
     C***********          MOVE '0'       *IN27                           S01328
     C                     MOVE '0'       *IN28
     C                     MOVE '0'       *IN29
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C                     MOVE '0'       *IN32
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN34
     C                     MOVE '0'       *IN35
     C                     MOVE '0'       *IN36
     C***********          MOVE '0'       *IN46                           S01194
     C                     MOVE '0'       *IN60
     C                     MOVE '0'       *IN61
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN63
     C                     MOVE '0'       *IN64
     C*
     C           #ZF9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #B   - THIS SUBROUTINE LOOPS UNTIL CF3 IS PRESSED OR CF12 IS  *
     C*        PRESSED AT THE INITIAL LEVEL                           *
     C*                                                               *
     C* CALLED BY : MAINLINE                                          *
     C*                                                               *
     C* CALLS :     #BA                                               *
     C*             #BB                                               *
     C**************#BC                                               *   S01194
     C*             #BD                                               *
     C*             #BE                                               *
     C*             #ZF                                               *
     C*             #ZG                                               *
     C*             #ZH                                               *
     C*             #ZJ                                               *
     C*             #ZP                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @CCNM  - SAVED CURRENCY NAME                      *
     C*             @CCY   - SAVED CURRENCY                           *
     C*             @FLDS  - SAVED HIGH/LOW/SPOT RATES + PERIOD 1 & 2 *
     C*             @CNT   - COUNT OF SUBFILE RECORDS                 *
     C*             @DDS   - DATA STRUCTURE HOLDING THE SAVED S/FILE  *
     C*             @PDX3  - SAVED PERIOD SNAME 3                     *
     C*             @03BR  - SAVED HIGH RATE 3                        *
     C*             @03LR  - SAVED LOW RATE 3                         *
     C*             @X     - MULTIPURPOSE INDEX                       *
     C*             @MSGID - MESSAGE ID TO SEND TO ZA0240             *
     C*                                                               *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C** IF U7 OR U8 ARE ON GO TO END OF SUBROUTINE
     C           *INU7     CABEQ'1'       #B9
     C           *INU8     CABEQ'1'       #B9
     C*
     C                     EXSR #ZG
     C*
     C                     EXSR #ZF
     C*
     C** LOOP HERE UNTIL CF3 OR CF12 AT THE INITIAL LEVEL
     C           *INKC     DOWEQ'0'                        B1
     C*
     C** IF ACTION CODE IS BLANK DEFAULT TO E
     C           DDACTN    IFEQ ' '                        B*2
     C                     MOVE 'E'       DDACTN           **2
     C                     END                             E*2
     C*
     C** VALIDATE ACTION CODE
     C           DDACTN    IFNE 'A'                        B*2
     C           DDACTN    ANDNE'D'                        **2
     C           DDACTN    ANDNE'E'                        **2
     C           DDACTN    ANDNE'I'                        **2
     C                     MOVEL'FDM0101' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     MOVE '1'       *IN20            **2
     C                     MOVE '1'       *IN23            **2            067980
     C*
     C** RESET SUBFILE RECORDS
     C           *IN75     IFEQ '0'                        B**3
     C           1         DO   @CNT      @X               B***4
     C           @X        CHAINFD0550S5             78    ****4
     C           @X        OCUR @DDS                       ****4
     C                     MOVE @03LR     DD03LR           ****4
     C                     MOVE @03BR     DD03BR           ****4
     C                     MOVE @PDX3     DDPDX3           ****4
     C                     UPDATFD0550S5                   ****4
     C                     END                             E***4
     C                     END                             E**3
     C*
     C** NOW MOVE THE OTHER FIELDS
     C           *IN75     IFEQ '0'                        B**3
     C                     MOVE @CCNM     DDCCNM           ***3
     C                     MOVE @FLDS     DDFLDS           ***3
     C                     END                             E**3
      **                                                                  S01319
     C                     ELSE                            X*2            S01319
      **                                                                  S01319
      **Get*MPHAS*to*find*Midas*phase**********************************                S01319 CCB020
     C********** *NAMVAR   DEFN           MPHAS                                        S01319 CCB020
     C**********           IN   MPHAS                                                  S01319 CCB020
     C**********           UNLCKMPHAS                                                  S01319 CCB020
      *                                                                   S01319
      **If*the*system*is*not*in*Next*Day*Setup*(TM*takeon*is*not*******                S01319 CCB020
      **being*run),****************************************************                S01319 CCB020
     C********** PHASE     IFNE 'D'                                                    S01319 CCB020
     C*                                                                   S01319
      ** If multibranching, -                                             S01319
     C           @MBIN     IFEQ 'Y'                                       S01319
      **                                                                  S01319
      ** - check the action and default branch security                   S01319
      **                                                                  S01319
     C                     CALL 'ZVACTBU'                                 S01319
     C                     PARM           DDACTN                          S01319
     C                     PARM           DBRN                            S01319
     C                     PARM           @ERR                            S01319
      **                                                                  S01319
     C           @ERR      IFNE 0                                         S01319
      ** Set code and message if ZVACTBU ended in error.                  S01319
     C                     MOVE '1'       *IN20                           S01319
     C                     MOVE '1'       *IN23                           067980
     C                     MOVEL'FXM0290' @MSGID                          S01319
     C                     CALL 'ZA0240'                                  S01319
     C                     PARM           @MSGID                          S01319
     C                     END                                            S01319
      **                                                                  S01319
     C                     ELSE                                           S01319
      **                                                                  S01319
     C                     CALL 'ZVACTU'                                  S01319
     C                     PARM           DDACTN                          S01319
     C                     PARM           @ERR    10                      S01319
      **                                                                  S01319
     C           @ERR      IFNE 0                                         S01319
     C                     MOVE '1'       *IN20                           S01319
     C                     MOVE '1'       *IN23                           067980
     C                     MOVEL'FXM0292' @MSGID                          S01319
     C                     CALL 'ZA0240'                                  S01319
     C                     PARM           @MSGID                          S01319
     C                     END                                            S01319
     C                     END                                            S01319
     C**********           END                                                         S01319 CCB020
      **                                                                  S01319
     C                     END                             E*2
     C                     MOVE '0'       *IN75            *1
     C*                                                                   S01319
     C           *IN20     IFEQ '0'                                       S01319
     C*
     C** VALIDATE CF8
     C           *INKH     CASEQ'1'       #BA              B*2
     C*
     C** VALIDATE CF7
     C           *INKG     CASEQ'1'       #BB              **2
     C*
     C***VALIDATE*CF15                                                    S01194
     C************INKP     CASEQ'1'       #BC              **2            S01194
     C*
     C** VALIDATE CF12
     C           *INKL     CASEQ'1'       #ZH              **2
     C*
     C** VALIDATE AMEND MODE
     C           DDACTN    CASEQ'A'       #ZJ              **2
     C*
     C** VALIDATE DELETE MODE
     C           DDACTN    CASEQ'D'       #ZP              **2
     C*
     C** VALIDATE INSERT MODE
     C           DDACTN    CASEQ'I'       #BD              **2
     C*
     C** PROCESS ENQUIRY
     C           DDACTN    CASEQ'E'       #BE              **2
     C*
     C                     END                             E*2
     C*                                                                   S01319
     C                     END                                            S01319
     C*
     C** CHECK FOR DATA BASE ERROR
     C           *INU7     CABEQ'1'       #B9              *1
     C*
     C** CHECK FOR CF3
     C           *INKC     CABEQ'1'       #B9              *1
     C*
     C** RESET SELECT FLAG
     C                     MOVE '0'       *IN66            *1
     C                     MOVE '0'       *IN69            *1
     C*
     C** IF CHANGE OF ACTION CODE TOOK PLACE DURING LEVEL 2 SCREEN
     C** PROCESS, DO NOT PROCESS CURRENT SCREEN
     C           *IN75     IFEQ '0'                        B*2
     C*
     C** WRITE SCREEN
     C                     EXSR #ZG                        **2
     C*
     C** READ SCREEN
     C                     EXSR #ZF                        **2
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #B9       ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZA  - THIS SUBROUTINE READS A RECORD FROM THE FILE FDINTRLL  *
     C*        IT WILL IGNORE DELETED RECORDS. IT WILL RETURN *IN73   *
     C*        ON FOR EOF                                             *
     C*                                                               *
     C* CALLED BY : #BA                                               *
     C*             #ZC                                               *
     C**************#ZK                                               *   S01117
     C*             #ZX                                               *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZA       BEGSR
     C*
     C** READ RECORD UNTIL THEEND OF THE FILE IS FOUND OR A LIVE RECORD
     C           HWDLTF    DOUEQ' '                        B1
     C           *IN73     OREQ '1'                        *1
     C                     READ FDINTRLL                 73*1
     C                     END                             E1
     C*
     C           #ZA9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZB  - THIS SUBROUTINE READ THE PREVIOUS RECORD FROM FDINTRLL *
     C*        IT WILL IGNORE DELETED RECORDS. IT WILL RETURN *IN72   *
     C*        ON FOR BOF                                             *
     C*                                                               *
     C* CALLED BY : #BB                                               *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZB       BEGSR
     C*
     C* READ THE PREVIOUS RECORD FROM THE FILE UNTIL A LIVE RECORD IS
     C* FOUND OR THE BEGINNING OF THE FILE IS FOUND
     C           HWDLTF    DOUEQ' '                        B1
     C           *IN72     OREQ '1'                        *1
     C                     READPFDINTRLL                 72*1
     C                     END                             E1
     C*
     C           #ZB9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BA   - CMD 8 PROCESS                                         *
     C*                                                               *
     C*         THIS SUBROUTINE PERFORMS THE VALIDATION FOR CF8       *
     C*         IF THE VALIDATION IS SUCCESSFUL THEN IT READS THE     *
     C*         NEXT RECORD                                           *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :     #ZA                                               *
     C*             #ZL                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @CCY   - SAVED CURRENCY CODE                      *
     C*             @CNT   - NUMBER OF SUBFILE RECORDS                *
     C**************@CHGD  - SAVED DAY OF LAST UPDATE                 *   S01194
     C*             @EXKY  - KEYLIST FOR FDINTRLL                     *
     C*             @FLD1  - NUMERIC FIELD TO CONVERT TO ALPHA        *
     C*             @FLD2  - ALPHA FIELD CONVERTED FROM NUMERIC       *
     C**************@TSPC  - SAVED TIME  OF LAST UPDATE               *   S01194
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @RRN1  - RELATIVE RECORD NUMBER FOR POINTS SFILE  *
     C*             @SCCY  - CURRENCY CODE SAVED FROM PREVIOUS READ   *
     C**************@SCRKY - KEY FOR FDCCYTLL FROM DISPLAY            *   S01194
     C*             @XDLUP - SAVED DAY OF LAST UPDATE FDINTRLL        *
     C*             @XMLUP - SAVED MONTH OF LAST UPDATE FDINTRLL      *
     C*             @XTLUP - SAVED TIME OF LAST UPDATE FDINTRLL       *
     C*             @XYLUP - SAVED YEAR OF LAST UPDATE FDINTRLL       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C** FIRST CHECK THE ACTION CODE IF INVALID EXIT
     C           DDACTN    IFEQ 'I'                        B1
     C*
     C** SEND PROGRAM MESSAGE
     C                     MOVEL'FDM0052' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C** REVERSE IMAGE ACTION CODE
     C                     MOVE '1'       *IN20            *1
     C                     MOVE '1'       *IN23            *1             067980
     C*
     C                     GOTO #BA9                       *1
     C                     END                             E1
     C*
     C** SETLL IF THE KEY HAS BEEN CHANGED
     C           DDCCY     IFNE @CCY                       B1
     C           @EXKY     SETLLFDINTRLL                   *1
     C                     END                             E1
     C*
     C** SET LOWER LIMITS IF AT INITIAL LEVEL OR LAST READ
     C** FAILED
     C           *IN71     IFEQ '0'                        B1
     C           *IN73     OREQ '1'                        *1
     C           *IN72     OREQ '1'                        *1
     C           @EXKY     SETLLFDINTRLL                   *1
     C                     END                             E1
     C*
     C** NOW READ THE FILE
     C                     EXSR #ZA
     C*
     C** NOW READ THE FILE AGAIN IF THE CF7 BEFORE PRODUCED
     C** AN ERROR
     C** BUT NOT FOR A CHANGED KEY
     C           *IN72     IFEQ '1'                        B1
     C           *IN73     ANDEQ'0'                        *1
     C           @CCY      ANDEQDDCCY                      *1
     C                     MOVE '0'       *IN72            *1
     C*
     C** GET THE NEXT RECORD IF THE CCY IS NOT BLANK
     C           DDCCY     IFNE *BLANKS                    B*2
     C***********          DO   12                         B**3           S01328
     C                     DO   21                         B**3           S01328
     C                     EXSR #ZA                        ***3
     C                     END                             E**3
     C                     END                             E*2
     C                     ELSE                            X1
     C*
     C           *IN65     IFEQ '0'                        B*2
     C           DDCCY     ANDNE*BLANKS                    **2
     C           DDCCY     ANDEQ@CCY                       **2
     C***********          DO   12                         B**3           S01328
     C                     DO   21                         B**3           S01328
     C           *IN73     IFEQ '0'                        B***4
     C                     EXSR #ZA                        ****4
     C                     END                             E***4
     C                     END                             E**3
     C                     END                             E*2
     C                     END                             E1
     C*
     C** SET OFF SUCCESSFUL READ INDICATOR
     C                     MOVE '0'       *IN65
     C*
     C** IF *IN73 IS SET ON THEN SIGNAL END OF FILE MESSAGE
     C           *IN73     IFEQ '1'                        B1
     C                     MOVEL'FDM0053' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     GOTO #BA9                       *1
     C                     END                             E1
     C*
     C** FILL FIELDS AS THE TRANSACTION WAS SUCCESSFUL
     C*
     C                     MOVE '1'       *IN65
     C                     MOVE '1'       *IN71
     C*
     C** LOAD SCREEN FIELDS
     C                     EXSR #ZX
     C*
     C           #BA9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BB   - CMD 7 PROCESS                                         *
     C*                                                               *
     C*         THIS SUBROUTINE PERFORMS THE VALIDATION FOR CF7       *
     C*         IF THE VALIDATION IS SUCCESSFUL THEN IT READS THE     *
     C*         PREVIOUS RECORD                                       *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :     #ZB                                               *
     C*             #ZL                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @CCY   - SAVED CURRENCY CODE                      *
     C*             @CNT   - NUMBER OF SUBFILE RECORDS                *
     C**************@CHGD  - SAVED DAY OF LAST UPDATE                 *   S01194
     C*             @EXKY  - KEYLIST FOR FDINTRLL                     *
     C*             @FLD1  - NUMERIC FIELD TO CONVERT TO ALPHA        *
     C*             @FLD2  - ALPHA FIELD CONVERTED FROM NUMERIC       *
     C**************@TSPC  - SAVED TIME  OF LAST UPDATE               *   S01194
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @RRN1  - RELATIVE RECORD NUMBER FOR POINTS SFILE  *
     C*             @SCCY  - CURRENCY CODE SAVED FROM PREVIOUS READ   *
     C**************@SCRKY - KEY FOR FDCCYTLL FROM DISPLAY            *   S01194
     C*             @XDLUP - SAVED DAY OF LAST UPDATE FDINTRLL        *
     C*             @XMLUP - SAVED MONTH OF LAST UPDATE FDINTRLL      *
     C*             @XTLUP - SAVED TIME OF LAST UPDATE FDINTRLL       *
     C*             @XYLUP - SAVED YEAR OF LAST UPDATE FDINTRLL       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BB       BEGSR
     C*
     C** FIRST CHECK THE ACTION CODE IF INVALID EXIT
     C           DDACTN    IFEQ 'I'                        B1
     C*
     C** SEND PROGRAM MESSAGE
     C                     MOVEL'FDM0052' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C** REVERSE IMAGE ACTION CODE
     C                     MOVE '1'       *IN20            *1
     C                     MOVE '1'       *IN23            *1             067980
     C*
     C** EXIT SUBROUTINE
     C                     GOTO #BB9                       *1
     C                     END                             E1
     C*
     C** SET OFF SUCCESSFUL READ INDICATOR
     C                     MOVE '0'       *IN65
     C*
     C** SET THE POSITION IN THE FILE
     C           @EXKY     SETLLFDINTRLL
     C*
     C** NOW READ THE FILE
     C***********          DO   12                         B1             S01328
     C                     DO   21                         B1             S01328
     C                     EXSR #ZB                        *1
     C                     END                             E1
     C*
     C** NOW READ THE FILE AGAIN IF THE CF8 BEFORE PRODUCED
     C** AN ERROR
     C           *IN73     IFEQ '1'                        B1
     C           *IN72     ANDEQ'0'                        *1
     C                     MOVE '0'       *IN73            *1
     C                     END                             E1
     C*
     C*
     C** IF *IN72 IS SET ON THEN SIGNAL BEGINNING OF FILE MESSAGE
     C           *IN72     IFEQ '1'                        B1
     C                     MOVEL'FDM0054' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     GOTO #BB9                       *1
     C                     END                             E1
     C*
     C** FILL FIELDS AS THE TRANSACTION WAS SUCCESSFUL
     C*
     C                     MOVE '1'       *IN65
     C                     MOVE '1'       *IN71
     C*
     C** LOAD SCREEN FIELDS
     C                     EXSR #ZX
     C*
     C           #BB9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01194
     C*********************                                           *   S01194
     C**#BC***-*CMD*15*PROCESS                                        *   S01194
     C*********************                                           *   S01194
     C**********THIS*SUBROUTINE PERFORMS THE VALIDATION FOR CF15      *   S01194
     C**********AND*CONTROLS THE SUBFILE                              *   S01194
     C*********************                                           *   S01194
     C**CALLED*BY*:*#B*****                                           *   S01194
     C*********************                                           *   S01194
     C**CALLS*:*****#ZG****                                           *   S01194
     C**************#BCA***                                           *   S01194
     C**************#BCB***                                           *   S01194
     C**************#BCC***                                           *   S01194
     C**************#ZH****                                           *   S01194
     C**************ZA0240*                                           *   S01194
     C**************ZA0250*                                           *   S01194
     C*********************                                           *   S01194
     C**USES*:******@EXKY**- KEY LIST FOR FDINTRLL                    *   S01194
     C**************@MSGID*- MESSAGE ID FOR ZA0240 TO SEND            *   S01194
     C**************@RRN***- RELATIVE RECORD NUMBER FOR ENQUIRY SFILE *   S01194
     C**************@SCRKY*- KEY FOR FDCCYTLL                         *   S01194
     C*********************                                           *   S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#BC*******BEGSR                                          S01194
     C*********************                                               S01194
     C***CLEAR*MESSAGE*SUBFILE                                            S01194
     C*********************MOVE '1'       *IN45                           S01194
     C*********************EXSR #ZG                                       S01194
     C*********************MOVE '0'       *IN45                           S01194
     C*********************                                               S01194
     C*********************MOVE '1'       *IN71                           S01194
     C*********************                                               S01194
     C***LOOP*UNTIL*FINISHED WITH                                         S01194
     C*********************MOVE '1'       *IN66                           S01194
     C*********************MOVE '1'       *IN65                           S01194
     C*********************MOVE '0'       *IN55                           S01194
     C*********************                                               S01194
     C***CLEAR*MESSAGE*QUEUE AND BLANK IT OUT                             S01194
     C*********************CALL 'ZA0250'                                  S01194
     C*********************                                               S01194
     C***INITIALISE*SUBFILE FIELDS                                        S01194
     C*********************Z-ADD1         @RRN                            S01194
     C*********************MOVE '1'       *IN41                           S01194
     C*********************MOVE '0'       *IN40                           S01194
     C*********************WRITEFD0550S2                                  S01194
     C*********************MOVE '1'       *IN40                           S01194
     C*********************MOVE '0'       *IN41                           S01194
     C*********************                                               S01194
     C***GET*THE*FIRST*LIVE RECORD ON THE CURRENCY FILE THAT              S01194
     C***ALSO*HAS*RECORDS*ON THE POINTS RATE FILE                         S01194
     C***********@SCRKY****SETLLFDCCYTLL                                  S01194
     C************IN77*****DOUEQ'1'                        B1             S01194
     C*********************READ FDCCYTLL                 73*1             S01194
     C*********************MOVE CCY       DDCCY            *1             S01194
     C***********@EXKY*****SETLLFDINTRLL                 77*1             S01194
     C*********************READ FDINTRLL                 68*1             S01194
     C*********************                                               S01194
     C***CHECK*RECORD*IS*LIVE                                             S01194
     C************IN77*****IFEQ '1'                        B*2            S01194
     C***********HWDLTF****ANDEQ'*'                        **2            S01194
     C*********************MOVE '0'       *IN77            **2            S01194
     C*********************END                             E*2            S01194
     C************IN73*****IFEQ '1'                        B*2            S01194
     C*********************MOVEL'FDM0225' @MSGID           **2            S01194
     C*********************CALL 'ZA0240'                   **2            S01194
     C*********************PARM           @MSGID           **2            S01194
     C*********************GOTO #BC9                       **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***FILL*SUBFILE*UNTIL ROLLUP NOT PRESSED OR FILE END                S01194
     C************IN50*****DOUEQ'0'                        B1             S01194
     C*********************                                               S01194
     C************IN73*****IFEQ '0'                        B*2            S01194
     C*********************EXSR #BCA                       **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***EXIT*IF*CF3*OR*CF12 PRESSED                                      S01194
     C************INKC*****CABEQ'1'       #BC9             *1             S01194
     C************INKL*****CABEQ'1'       #BC8             *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***LOOP*UNTIL*END*OF*SELECTIONS                                     S01194
     C************IN59*****DOUEQ'1'                        B1             S01194
     C*********************                                               S01194
     C****GET*OPTION*******                                               S01194
     C*********************EXSR #BCB                       *1             S01194
     C*********************                                               S01194
     C***EXIT*ON*DB*ERROR**                                               S01194
     C************INU7*****CABEQ'1'       #BC9             *1             S01194
     C*********************                                               S01194
     C***LOOP*UNTIL*NO*ERRORS                                             S01194
     C************IN64*****DOUEQ'0'                        B*2            S01194
     C*********************MOVE '0'       *IN64            **2            S01194
     C*********************                                               S01194
     C***PROCESS*DETAILS***                                               S01194
     C************IN59*****IFEQ '0'                        B**3           S01194
     C*********************EXSR #BCC                       ***3           S01194
     C*********************END                             E**3           S01194
     C*********************                                               S01194
     C***EXIT*IF*CF3*OR*CF12 PRESSED                                      S01194
     C************INKC*****CABEQ'1'       #BC9             **2            S01194
     C************INKL*****CABEQ'1'       #BC8             **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***CLEAR*THE*INPUT*FIELDS                                           S01194
     C***********#BC8******TAG                             TAG #BAC8      S01194
     C*********************MOVE '1'       *IN71                           S01194
     C*********************EXSR #ZH                                       S01194
     C*********************                                               S01194
     C***********#BC9******ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************   S01194
     C*EJECT***************                                               S01194
     C*****************************************************************   S01194
     C*********************                                           *   S01194
     C**#BCA**-**FILL*UP*THE ENQUIRY SUBFILE AND DISPLAY IT           *   S01194
     C*********************                                           *   S01194
     C**CALLED*BY*:*#BC****                                           *   S01194
     C*********************                                           *   S01194
     C**CALLS*:************                                           *   S01194
     C*********************                                           *   S01194
     C**USES*:******@COUNT*- COUNTS NUMBER OF RECORDS WRITTEN TO SFILE*   S01194
     C**************@EXKY**- KEY LIST FOR FDINTRLL                    *   S01194
     C**************@RRN***- RELATIVE RECORD NUMBER ENQUIRY SUBFILE   *   S01194
     C*********************                                           *   S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#BCA******BEGSR                                          S01194
     C*********************                                               S01194
     C***LOOP*HERE*UNTIL*SUBFILE FILLED                                   S01194
     C*********************                                               S01194
     C*********************DO   14                         B1             S01194
     C*********************MOVE CCY       DDCCY            *1             S01194
     C*********************MOVE CCNM      DDCCNM           *1             S01194
     C*********************MOVE *BLANK    DDOPT            *1             S01194
     C*********************Z-ADD@RRN      DDSFRN           *1             S01194
     C*********************WRITEFD0550S3                   *1             S01194
     C*********************                                               S01194
     C***GET*THE*NEXT*LIVE*CCY RECORD THAT HAS RELATED RECORDS ON         S01194
     C***THE*POINT*FILE****                                               S01194
     C************IN77*****DOUEQ'1'                        B*2            S01194
     C************IN73*****OREQ '1'                        **3            S01194
     C*********************READ FDCCYTLL                 73**2            S01194
     C*********************MOVE CCY       DDCCY            **2            S01194
     C***********@EXKY*****SETLLFDINTRLL                 77**2            S01194
     C*********************READ FDINTRLL                 68**2            S01194
     C************IN77*****IFEQ '1'                        B**3           S01194
     C***********HWDLTF****ANDEQ'*'                        ***3           S01194
     C*********************MOVE '0'       *IN77            ***3           S01194
     C*********************END                             E**3           S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C*********************ADD  1         @RRN             *1             S01194
     C*********************                                               S01194
     C***CHECK*FOR*END*OF*FILE                                            S01194
     C************IN73*****CABEQ'1'       #BACA1           *1             S01194
     C*********************                                               S01194
     C*********************END                             E1             S01117
     C*********************                                               S01194
     C***********#BACA1****TAG                             #BACA1         S01194
     C*********************                                               S01194
     C***DISPLAY*SUBFILE***                                               S01194
     C*********************TIME           DDTIME                          S01194
     C*********************WRITEFD0550S2                                  S01194
     C*********************WRITEFD0550D1                                  S01194
     C*********************                                               S01194
     C***READ*DISPLAY******                                               S01194
     C*********************READ FD0550S2                 70               S01194
     C*********************                                               S01194
     C***********#BCA9*****ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************   S01194
     C**JECT***************                                               S01194
     C*****************************************************************   S01194
     C*********************                                           *   S01194
     C**#BCB*-*THIS*SUBROUTINE READS THE DISPLAY FOR CHANGED RECORDS  *   S01194
     C*********************                                           *   S01194
     C**CALLED*BY*:*#BC****                                           *   S01194
     C*********************                                           *   S01194
     C**CALLS*:*****#ZX****                                           *   S01194
     C*********************                                           *   S01194
     C**USES*:*************                                           *   S01194
     C*********************                                           *   S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#BCB******BEGSR                                          S01194
     C*********************                                               S01194
     C***GET*NEXT*CHANGED*RECORD                                          S01194
     C***********DDOPT*****DOUNE*BLANK                     B1             S01194
     C*********************READCFD0550S3                 59*1             S01194
     C************IN59*****CABEQ'1'       #BCB9            *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***SET*ON*END*OF*READ INDICATOR                                     S01194
     C*********************MOVE '0'       *IN55                           S01194
     C*********************                                               S01194
     C***GET*REQUIRED*RECORD                                              S01194
     C***********@EXKY*****CHAINFDINTRLL             68                   S01194
     C*********************                                               S01194
     C***LOAD*SCREEN*FIELDS                                               S01194
     C*********************EXSR #ZX                                       S01194
     C*********************                                               S01194
     C***********#BCB9*****ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************   S01194
     C**JECT***************                                               S01194
     C*****************************************************************   S01194
     C*********************                                           *   S01194
     C**#BCC*-*THIS*SUBROUTINE HANDLES THE USE OF THE SELECTED        *   S01194
     C*********CURRENCIES**                                           *   S01194
     C*********************                                           *   S01194
     C**CALLED*BY*:*#BC****                                           *   S01194
     C*********************                                           *   S01194
     C**CALLS*:*****#ZC****                                           *   S01194
     C**************#ZD****                                           *   S01194
     C**************#ZF****                                           *   S01194
     C**************#ZG****                                           *   S01194
     C**************#ZH****                                           *   S01194
     C**************#ZI****                                           *   S01194
     C**************#ZK****                                           *   S01194
     C**************#ZJ****                                           *   S01194
     C**************ZA0240*                                           *   S01194
     C*********************                                           *   S01194
     C**USES*:******@MSGID*- MESSAGE ID FOR ZA0240 TO SEND            *   S01194
     C**************@DATA**-                                          *   S01194
     C**************@UPDWS*-                                          *   S01194
     C*********************                                           *   S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#BCC******BEGSR                                          S01194
     C*********************                                               S01194
     C***LOOP*UNTIL*NO*ERRORS                                             S01194
     C************IN64*****DOUEQ'0'                        B1             S01194
     C*********************                                               S01194
     C***PROTECT*CURRENCY*CODE FIELD AND DISPLAY THE SCREEN               S01194
     C*********************MOVE '1'       *IN46            *1             S01194
     C*********************EXSR #ZG                        *1             S01194
     C*********************                                               S01194
     C***NOW*READ*THE*SCREEN                                              S01194
     C*********************EXSR #ZF                        *1             S01194
     C*********************                                               S01194
     C***EXIT*IF*CF3*OR*CF12 PRESSED                                      S01194
     C************INKC*****CABEQ'1'       #BCC9            *1             S01194
     C************INKL*****CABEQ'1'       #BCC9            *1             S01194
     C*********************                                               S01194
     C***PROCESS*ACTION****                                               S01194
     C***VALIDATE*ACTION*CODE                                             S01194
     C***INSERT*INVALID****                                               S01194
     C***********DDACTN****IFNE 'A'                        B*2            S01194
     C***********DDACTN****ANDNE'D'                        **2            S01194
     C***********DDACTN****ANDNE'E'                        **2            S01194
     C*********************MOVE '1'       *IN64            **2            S01194
     C*********************MOVE '1'       *IN20            **2            S01194
     C*********************MOVEL'FDM0101' @MSGID           **2            S01194
     C*********************CALL 'ZA0240'                   **2            S01194
     C*********************PARM           @MSGID           **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***CALL*SUBROUTINE*TO DEAL WITH THE ACTION CODE                     S01194
     C***********DDACTN****IFEQ 'A'                        B*2            S01194
     C*********************MOVE '1'       *IN69            **2            S01194
     C*********************                                               S01194
     C***NOW*VALIDATE*FIELDS                                              S01194
     C*********************MOVE '0'       *IN64            **2            S01194
     C*********************EXSR #ZC                        **2            S01194
     C*********************                                               S01194
     C***IF*VALID*UPDATE*FILE                                             S01194
     C************IN64*****IFEQ '0'                        B**3           S01194
     C*********************EXSR #ZD                        ***3           S01194
     C*********************                                               S01194
     C***********@UPDWS****IFEQ 'N'                        B***4          S01194
     C*********************EXSR #ZH                        ****4          S01194
     C*********************END                             E***4          S01194
     C*********************                                               S01194
     C***OUTPUT*MESSAGE*FOR SUCCESSFUL AMENDMENT OF RECORD                S01194
     C***********@UPDWS****IFEQ 'N'                        B***4          S01194
     C*********************MOVEL@CCY      @DATA  45        ****4          S01194
     C*********************MOVEL'FDM8028' @MSGID           ****4          S01194
     C*********************CALL 'ZA0440'                   ****4          S01194
     C*********************PARM           @MSGID           ****4          S01194
     C*********************PARM           @DATA            ****4          S01194
     C*********************ELSE                            X***4          S01194
     C*********************MOVE 'Y'       @UPDWS           ****4          S01194
     C*********************END                             E***4          S01194
     C*********************                                               S01194
     C*********************END                             E**3           S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***********DDACTN****IFEQ 'D'                        B*2            S01194
     C*********************EXSR #ZK                        **2            S01194
     C************IN64*****IFEQ '0'                        B**3           S01194
     C*********************                                               S01194
     C***REDISPLAY*SCREEN*TO ENABLE CF10, AND PROCESS IT IF SELECTED      S01194
     C*********************EXSR #ZG                        ***3           S01194
     C*********************EXSR #ZF                        ***3           S01194
     C************INKJ*****IFEQ '1'                        B***4          S01194
     C*********************EXSR #ZI                        ****4          S01194
     C*********************END                             E***4          S01194
     C*********************                                               S01194
     C*********************END                             E**3           S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***********#BCC9*****ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZH   - CMD 2 PROCESS                                         *
     C*                                                               *
     C*         THIS SUBROUTINE CLEARS THE INPUT FIELDS               *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*             #BC                                               *
     C*             #BC                                               *
     C*             #BD                                               *
     C*             #ZI                                               *
     C*             #ZJ                                               *
     C*             #ZP                                               *
     C*             #ZZ                                               *
     C*                                                               *
     C* CALLS :     ZA0250                                            *
     C*                                                               *
     C* USES :      @CNT   - NUMBER OF SFILE RECORDS                  *
     C*             @DDS   - DATA STRUCTURE HOLDING SAVED VALUES      *
     C*             @X     - INDEX TO @DDS                            *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZH       BEGSR
     C*
     C** IF AT THE SECOND LEVEL CLEAR ALL THE FIELDS AND RESET
     C** THE LEVEL INDICATOR
     C           *IN71     IFEQ '1'                        B1
     C           *IN66     OREQ '1'                        *1
     C*
     C** CLEAR THE SUBFILE FIELDS
     C           1         DO   @CNT      @X               B*2
     C           @X        CHAINFD0550S5             78    **2
     C           @X        OCUR @DDS                       **2
     C                     MOVE *BLANKS   DD03LR           **2
     C                     MOVE *BLANKS   DD03BR           **2
     C                     MOVE *BLANKS   DDPDX3           **2
     C                     UPDATFD0550S5                   **2
     C                     END                             E*2
     C*
     C** NOW MOVE THE OTHER FIELDS
     C                     MOVE *BLANKS   DDACTN           *1
     C                     MOVE *BLANKS   DDCCY            *1
     C                     MOVE *BLANKS   DDCCNM           *1
     C                     MOVE *BLANKS   DDFLDS           *1
     C                     MOVE '0'       *IN71            *1
     C*
     C** CLEAR MESSAGE QUEUE AND ERROR INDICATORS
     C           *INKL     IFEQ '1'                        B*2
     C                     CALL 'ZA0250'                   **2
     C                     END                             E*2
     C                     MOVE '0'       *IN20            *1
     C                     MOVE '0'       *IN21            *1
     C                     MOVE '0'       *IN22            *1             067980
     C                     MOVE '0'       *IN23            *1             067980
     C***********          MOVE '0'       *IN22            *1             S01328
     C***********          MOVE '0'       *IN23            *1             S01328
     C***********          MOVE '0'       *IN24            *1             S01328
     C***********          MOVE '0'       *IN25            *1             S01328
     C***********          MOVE '0'       *IN26            *1             S01328
     C***********          MOVE '0'       *IN27            *1             S01328
     C                     MOVE '0'       *IN28            *1
     C                     MOVE '0'       *IN29            *1
     C                     MOVE '0'       *IN30            *1
     C                     MOVE '0'       *IN31            *1
     C                     MOVE '0'       *IN32            *1
     C                     MOVE '0'       *IN33            *1
     C                     MOVE '0'       *IN34            *1
     C                     MOVE '0'       *IN35            *1
     C*
     C                     ELSE                            X1
     C*
     C** SET ON *INKC TO SIGNAL END OF THE PROGRAM
     C                     MOVE '1'       *INKC            *1
     C                     END                             E1
     C*
     C           #ZH9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZI   - CMD 10 PROCESS                                        *
     C*                                                               *
     C*         THIS CHECKS THAT NONE OF THE FIELDS HAVE BEEN CHANGED *
     C*         THEN IT WILL THEN CALL THE SUBROUTINE TO UPDATE THE   *
     C*         RECORWITH THE LOGICAL DELETE FLAG SET TO '*'          *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*             #BCC                                              *
     C*                                                               *
     C* CALLS :     #ZD                                               *
     C*             #ZH                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @ACTN  - SAVED ACTION CODE                        *
     C*             @CCNM  - CCY NAME                                 *
     C*             @CCY   - SAVED CURRENCY CODE                      *
     C*             @FLDS  - SAVED LOW/HIGH/SPOT RATES AND PERIODS 1/2*
     C*             @CNT   - NUMBER OF SUBFILE RECORDS                *
     C*             @DDS   - DS HOLDING THE SAVED SFILE VALUES        *
     C*             @PDX3  - SAVED PERIOD SNAME 3                     *
     C*             @03BR  - SAVED HIGH RATE 3                        *
     C*             @03LR  - SAVED LOW RATE 3                         *
     C*             @RRN1  - ENQUIRY SFILE RELATIVE REC NO            *
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @X     - MULTIPURPOSE INDEX                       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZI       BEGSR
     C*
     C** CHECK FIELDS HAVE NOT BEEN CHANGED
     C                     MOVE '0'       *IN77
     C*
     C** FIRST ALL THE RECORDS IN THE SUBFILE
     C           1         DO   @CNT      @RRN1            B1
     C           @RRN1     OCUR @DDS                       *1
     C           @RRN1     CHAINFD0550S5             77    *1
     C           DD03LR    IFNE @03LR                      B*2
     C           DD03BR    ORNE @03BR                      **2
     C           DDPDX3    ORNE @PDX3                      **2
     C                     MOVE '1'       *IN77            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** NOW THE OTHER FIELDS
     C           *IN77     IFEQ '1'                        B1
     C           DDCCY     ORNE @CCY                       *1
     C           DDACTN    ORNE @ACTN                      *1
     C           DDFLDS    ORNE @FLDS                      *1
     C*
     C                     MOVEL'FDM0104' @MSGID           *1
     C                     MOVE '1'       *IN64            *1
     C                     MOVE '1'       *IN20            *1
     C                     MOVE '1'       *IN23            *1             067980
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C*
     C** RESET ALL FIELDS, FIRST THE SUBFILE FIELDS
     C           1         DO   @CNT      @X               B*2
     C           @X        CHAINFD0550S5             78    **2
     C           @X        OCUR @DDS                       **2
     C                     MOVE @03LR     DD03LR           **2
     C                     MOVE @03BR     DD03BR           **2
     C                     MOVE @PDX3     DDPDX3           **2
     C                     UPDATFD0550S5                   **2
     C                     END                             E*2
     C*
     C** NOW MOVE THE OTHER FIELDS
     C                     MOVE @ACTN     DDACTN           *1
     C                     MOVE @CCY      DDCCY            *1
     C                     MOVE @CCNM     DDCCNM           *1
     C                     MOVE @FLDS     DDFLDS           *1
     C                     GOTO #ZI9                       *1
     C                     END                             E1
     C*
     C** NOW UPDATE RECORD
     C                     EXSR #ZD
     C*
     C** CLEARDOWN DISPLAY
     C                     EXSR #ZH
     C*
     C** OUTPUT MESSAGE FOR SUCCESSFUL DELETION OF RECORD
     C                     MOVEL@CCY      @DATA  45        *1
     C                     MOVEL'FDM8027' @MSGID           *1
     C                     CALL 'ZA0440'                   *1
     C                     PARM           @MSGID           *1
     C                     PARM           @DATA            *1
     C*
     C           #ZI9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZJ   - AMEND PROCESS                                         *
     C*                                                               *
     C*         THIS SUBROUTINE CONTROLS THE AMEND MODE. IT WILL FIRST*
     C*         CHECK THAT THE LOCATION CODE HAS NOT BEEN CHANGED     *
     C*         IT WILL THEN CALL THE SUBROUTINE TO VALIDATE THE      *
     C*         DATA THEN IF THERE ARE NO ERRORS IT WILL CALL THE     *
     C*         SUBROUTINE TO UPDATE THE FILE                         *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :     #ZC                                               *
     C*             #ZD                                               *
     C*             #ZF                                               *
     C*             #ZG                                               *
     C*             #ZH                                               *
     C*             #ZZ                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @ACTN  -                                          *
     C*             @CCY   - SAVED CURRENCY CODE                      *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZJ       BEGSR
     C*
     C***RE-INITIALISE*SCREEN VALUES FROM SAVED VALUES IF ANY ERRORS      S01328
     C***AND*IT*IS*THE*SAME CURRENCY                                      S01328
     C***********@IN21     IFEQ '0'                        B1             S01328
     C***********DDCCY     ANDEQ@CCY                       *1             S01328
     C***********          GOTO #ZJ3                       *1             S01328
     C***********          END                             E1             S01328
     C*
     C           #ZJ1      TAG
     C*
     C** VALIDATE CURRENCY CODE AND OUTPUT RECORD
     C                     EXSR #ZZ
     C*          *IN21     CABEQ'1'       #ZJ9
     C           *IN21     IFEQ '1'                        B1
     C*
     C** SET OFF ANY INDICATORS SET IN PREVIOUS POINTS SUBFILE;
     C** OTHERWISE ANY FIELDS THAT WERE IN REVERSE IMAGE WILL
     C** STILL BE DISPLAYED IN REVERSE IMAGE.
     C           1         DO   @CNT      @RRN1            B*2
     C           @RRN1     CHAINFD0550S5             77    **2
     C                     MOVE '0'       *IN30            **2
     C                     MOVE '0'       *IN31            **2
     C                     MOVE '0'       *IN34            **2
     C                     MOVE '0'       *IN35            **2
     C                     UPDATFD0550S5                   **2
     C                     END                             E*2
     C                     GOTO #ZJ9                       *1
     C                     END                             E1
     C*
     C           #ZJ2      TAG
     C*
     C** DISPLAY SCREEN
     C                     EXSR #ZG
     C** READ SCREEN
     C                     EXSR #ZF
     C*
     C** VALIDATE CF12
     C           *INKL     CASEQ'1'       #ZH
     C*
     C** VALIDATE CF8
     C           *INKH     CASEQ'1'       #BA
     C*
     C** VALIDATE CF7
     C           *INKG     CASEQ'1'       #BB
     C                     END
     C*
     C** IF CMD 3 OR 12 EXIT SUBROUTINE
     C           *INKC     CABEQ'1'       #ZJ9
     C           *INKL     CABEQ'1'       #ZJ9
     C           *IN69     CABEQ'1'       #ZJ9
     C*
     C** IF CMD 8 OR CMD7
     C           *INKH     IFEQ '1'                        B1
     C           *INKG     OREQ '1'                        B1
     C                     GOTO #ZJ9                       *1
     C                     END                             E1
     C*
     C***VALIDATE*CF15                                                    S01194
     C************INKP     IFEQ '1'                        B1             S01194
     C***********          MOVE '1'       *IN75            *1             S01194
     C***********          GOTO #ZJ9                       *1             S01194
     C***********          END                             E1             S01194
     C*
     C**  PROCESSING FOR WHEN THERE IS CHANGE IN ACTION CODE OR
     C**  CURRENCY AT SCREEN LEVEL 2
     C           DDACTN    IFNE @ACTN                      B1
     C           DDCCY     ORNE @CCY                       *1
     C*
     C**  STORE ACTION CODE AND CURRENCY - THESE ARE BLANKED OUT
     C**  IN #ZH
     C                     MOVE DDACTN    @ACTN            *1
     C                     MOVE DDCCY     @CCY             *1
     C           DDACTN    IFNE 'I'                        B*2
     C*
     C** MUST BLANK OUT ALL FIELDS FOR ACTION CODE NOT 'I' IN CASE
     C** ACTION CODE AND/OR CURRENCY CODE ARE INVALID
     C                     MOVE '1'       *IN71            **2
     C                     EXSR #ZH                        **2
     C                     ELSE                            X*2
     C*
     C**  ONLY CURRENCY NAME IS TO BE BLANKED OUT IN CASE OF
     C**  INVALID ACTION CODE AND/OR CURRENCY CODE
     C                     MOVE *BLANKS   DDCCNM           **2
     C                     END                             E*2
     C*
     C**  RESET ACTION CODE AND CURRENCY CODE
     C                     MOVE @ACTN     DDACTN           *1
     C                     MOVE @CCY      DDCCY            *1
     C           DDACTN    IFNE 'A'                        B*2
     C                     MOVE '1'       *IN75            **2
     C                     GOTO #ZJ9                       **2
     C                     ELSE                            X*2
     C*
     C**  IF ACTION CODE IS 'A', PROCESSING CAN BE CONTINUED
     C**  DIRECTLY IN THIS ROUTINE
     C                     GOTO #ZJ1                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C** NOW VALIDATE FIELDS
     C*
     C           #ZJ3      TAG
     C*
     C                     MOVE '0'       *IN64
     C                     EXSR #ZC
     C           *IN64     CABEQ'1'       #ZJ2
     C*
     C** IF VALID UPDATE FILE
     C           *IN64     IFEQ '0'                        B1
     C                     EXSR #ZD                        *1
     C*
     C           @UPDWS    IFEQ 'N'                        B*2
     C                     EXSR #ZH                        **2
     C                     END                             E*2
     C*
     C** OUTPUT MESSAGE FOR SUCCESSFUL AMENDMENT OF RECORD
     C           @UPDWS    IFEQ 'N'                        B*2
     C                     MOVEL@CCY      @DATA  45        **2
     C                     MOVEL'FDM8028' @MSGID           **2
     C                     CALL 'ZA0440'                   **2
     C                     PARM           @MSGID           **2
     C                     PARM           @DATA            **2
     C                     ELSE                            X*2
     C                     MOVE 'N'       @UPDWS           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           #ZJ9      ENDSR
     C*
     C*****************************************************************   S01194
     C*EJECT***************                                               S01194
     C*****************************************************************   S01194
     C*********************                                           *   S01194
     C**#ZK***-*DELETE*PROCESS                                        *   S01194
     C*********************                                           *   S01194
     C**********THIS*SUBROUTINE SAVES THE SCREEN FIELDS AND SETS ON   *   S01194
     C**********THE*DELETE*MODE INDICATOR                             *   S01194
     C*********************                                           *   S01194
     C**CALLED*BY*:*#BCC***                                           *   S01194
     C*********************                                           *   S01194
     C**CALLS*:*****ZA0240*                                           *   S01194
     C*********************                                           *   S01194
     C**USES*:******@ACTN**- SAVED ACTION CODE                        *   S01194
     C**************@CCNM**- SAVED CURRENCY NAME                      *   S01194
     C**************@CCY***- SAVED CURRENCY                           *   S01194
     C**************@FLDS**- SAVED LOW/HIGH/SPOT RATES AND PERIODS 1/2*   S01194
     C**************@CNT***- COUNT OF SUBFILE RECORDS                 *   S01194
     C**************@DDS***- DATA STRUCTURE HOLDING THE SAVED S/FILE  *   S01194
     C**************@EXKY**- KEY LIST FDINTRLL                        *   S01194
     C**************@PDX3**- SAVED PERIOD SNAME 3                     *   S01194
     C**************@03BR**- SAVED HIGH RATE 3                        *   S01194
     C**************@03LR**- SAVED LOW RATE 3                         *   S01194
     C**************@RRN1**- REL REC NO OF POINTS SFILE                   S01194
     C**************@MSGID*- MESSAGE ID FOR ZA0240 TO SEND            *   S01194
     C**************@X*****- MULTIPURPOSE INDEX                       *   S01194
     C*********************                                           *   S01194
     C*****************************************************************   S01194
     C*********************                                               S01194
     C***********#ZK*******BEGSR                                          S01194
     C*********************                                               S01194
     C***CHECK*RECORD*HAS*NOT BEEN SELECTED FOR DELETION AT THE           S01194
     C***INITIAL*SCREEN****                                               S01194
     C***********@CCY******IFEQ *BLANKS                    B1             S01194
     C*********************MOVEL'FDM0125' @MSGID           *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************MOVE '1'       *IN20            *1             S01194
     C***RESET*ALL*FIELDS**                                               S01194
     C***********1*********DO   @CNT      @X               B*2            S01194
     C***********@X********CHAINFD0550S5             78    **2            S01194
     C***********@X********OCUR @DDS                       **2            S01194
     C*********************MOVE *BLANKS   DD03LR           **2            S01194
     C*********************MOVE *BLANKS   DD03BR           **2            S01194
     C*********************MOVE *BLANKS   DDPDX3           **2            S01194
     C*********************UPDATFD0550S5                   **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***NOW*MOVE*THE*OTHER FIELDS                                        S01194
     C*********************MOVE *BLANKS   DDCCY            *1             S01194
     C*********************MOVE *BLANKS   DDCCNM           *1             S01194
     C*********************MOVE *BLANKS   DDFLDS           *1             S01194
     C*********************GOTO #ZK9                       *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***CHECK*FIELDS*HAVE*NOT BEEN CHANGED                               S01194
     C*********************MOVE '0'       *IN77                           S01194
     C***********1*********DO   @CNT      @RRN1            B1             S01194
     C***********@RRN1*****OCUR @DDS                       *1             S01194
     C***********@RRN1*****CHAINFD0550S5             78    *1             S01194
     C***********DD03LR****IFNE @03LR                      B*2            S01194
     C***********DD03BR****ORNE @03BR                      **2            S01194
     C***********DDPDX3****ORNE @PDX3                      **2            S01194
     C*********************MOVE '1'       *IN77            **2            S01194
     C*********************END                             E*2            S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C************IN77*****IFEQ '1'                        B1             S01194
     C***********DDCCY*****ORNE @CCY                       *1             S01194
     C***********DDFLDS****ORNE @FLDS                      *1             S01194
     C*********************MOVEL'FDM0104' @MSGID           *1             S01194
     C*********************MOVE '1'       *IN64            *1             S01194
     C*********************MOVE '1'       *IN20            *1             S01194
     C*********************                                               S01194
     C***RESET*ALL*FIELDS**                                               S01194
     C***********1*********DO   @CNT      @X               B*2            S01194
     C***********@X********CHAINFD0550S5             78    **2            S01194
     C***********@X********OCUR @DDS                       **2            S01194
     C*********************MOVE @03LR     DD03LR           **2            S01194
     C*********************MOVE @03BR     DD03BR           **2            S01194
     C*********************MOVE @PDX3     DDPDX3           **2            S01194
     C*********************UPDATFD0550S5                   **2            S01194
     C*********************END                             E*2            S01194
     C*********************                                               S01194
     C***NOW*MOVE*THE*OTHER FIELDS                                        S01194
     C*********************MOVE @ACTN     DDACTN           *1             S01194
     C*********************MOVE @CCY      DDCCY            *1             S01194
     C*********************MOVE @CCNM     DDCCNM           *1             S01194
     C*********************MOVE @FLDS     DDFLDS           *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************GOTO #ZK9                       *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***CHECK*A*RECORD*HAS BEEN SELECTED                                 S01194
     C************IN65*****IFEQ '0'                        B1             S01194
     C***********@EXKY*****SETLLFDINTRLL                   *1             S01194
     C*********************EXSR #ZA                        *1             S01194
     C***********DDCCY*****IFEQ @CCY                       B*2            S01194
     C***********DDCCY*****ANDEQHWCCY                      **2            S01194
     C*********************MOVE '1'       *IN65            **2            S01194
     C*********************END                             E*2            S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C***IF*NO*RECORD*READ*THEN DISPLAY ERROR MESSAGE                     S01194
     C************IN65*****IFEQ '0'                        B1             S01194
     C*********************MOVEL'FDM0224' @MSGID           *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************MOVE '1'       *IN20            *1             S01194
     C*********************GOTO #ZK9                       *1             S01194
     C*********************END                             E1             S01194
     C*********************                                               S01194
     C*********************MOVE '1'       *IN71                           S01194
     C*********************                                               S01194
     C***SET*ON*DELETE*INDICATOR                                          S01194
     C*********************MOVE '1'       *IN63                           S01194
     C*********************                                               S01194
     C***********#ZK9******ENDSR                                          S01194
     C*********************                                               S01194
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZP   - DELETE MODE                                           *
     C*                                                               *
     C*         IT VALIDATES THE CURRENCY CODE AND OUTPUTS THE        *
     C*         FIRST DELETE SCREEN. IT THEN CHECKS AND VALIDATES     *
     C*         FOR THE SUBSEQUENT INPUT ON THE DELETE SCREEN.        *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :     #BA                                               *
     C*             #BB                                               *
     C*             #ZF                                               *
     C*             #ZG                                               *
     C*             #ZH                                               *
     C*             #ZI                                               *
     C*                                                               *
     C* USES :      @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @CCY   - SAVED CURRENCY CODE                      *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZP       BEGSR
     C*
     C           #ZP1      TAG
     C*
     C**  VALIDATE CURRENCY CODE AND SET UP OUTPUT SCREEN
     C                     EXSR #ZZ
     C           *IN21     CABEQ'1'       #ZP9
     C*
     C**  DISPLAY SCREEN
     C                     MOVE '1'       *IN63
     C                     EXSR #ZG
     C*
     C**  READ SCREEN
     C                     EXSR #ZF
     C*
     C** VALIDATE CF12
     C           *INKL     CASEQ'1'       #ZH
     C*
     C** VALIDATE CF8
     C           *INKH     CASEQ'1'       #BA
     C*
     C** VALIDATE CF7
     C           *INKG     CASEQ'1'       #BB
     C                     END
     C*
     C** IF CMD 3 OR 12 EXIT SUBROUTINE
     C           *INKC     CABEQ'1'       #ZP9
     C           *INKL     CABEQ'1'       #ZP9
     C           *IN69     CABEQ'1'       #ZP9
     C*
     C** IF CMD 8 OR CMD7
     C           *INKH     IFEQ '1'                        B1
     C           *INKG     OREQ '1'                        B1
     C                     GOTO #ZP9                       *1
     C                     END                             E1
     C*
     C***VALIDATE*CF15*****                                               S01194
     C************INKP*****IFEQ '1'                        B1             S01194
     C*********************MOVE '1'       *IN75            *1             S01194
     C*********************GOTO #ZP9                       *1             S01194
     C*********************END                             E1             S01194
     C*
     C**  PROCESSING FOR WHEN THERE IS CHANGE IN ACTION CODE OR
     C**  CURRENCY AT SCREEN LEVEL 2
     C           DDACTN    IFNE @ACTN                      B1
     C           DDCCY     ORNE @CCY                       *1
     C*
     C**  STORE ACTION CODE AND CURRENCY - THESE ARE BLANKED OUT
     C**  IN #ZH
     C                     MOVE DDACTN    @ACTND  1        *1
     C                     MOVE DDCCY     @CCYD   3        *1
     C           DDACTN    IFNE 'I'                        B*2
     C           DDACTN    ANDNE'A'                        **2
     C*
     C** MUST BLANK OUT ALL FIELDS FOR ACTION CODE NOT 'I' IN CASE
     C** ACTION CODE AND/OR CURRENCY CODE ARE INVALID
     C                     MOVE '1'       *IN71            **2
     C                     EXSR #ZH                        **2
     C                     ELSE                            X*2
     C*
     C**  ONLY CURRENCY NAME IS TO BE BLANKED OUT IN CASE OF
     C**  INVALID ACTION CODE AND/OR CURRENCY CODE
     C           DDACTN    IFEQ 'I'                        B**3
     C                     MOVE *BLANKS   DDCCNM           ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  RESET ACTION CODE AND CURRENCY CODE
     C                     MOVE @ACTND    DDACTN           *1
     C                     MOVE @CCYD     DDCCY            *1
     C           DDACTN    IFNE 'D'                        B*2
     C                     MOVE '1'       *IN75            **2
     C                     GOTO #ZP9                       **2
     C                     ELSE                            X*2
     C*
     C**  IF ACTION CODE IS 'D', PROCESSING CAN BE CONTINUED
     C**  DIRECTLY IN THIS ROUTINE
     C                     GOTO #ZP1                       **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  TEST FOR CMD/10
     C           *INKJ     IFEQ '1'                        B1
     C                     EXSR #ZI                        *1
     C                     ELSE                            X1
     C                     GOTO #ZP1                       *1
     C                     END                             E1
     C*
     C           #ZP9      ENDSR
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BD   - THIS SUBROUTINE WILL VALIDATE THE INPUT FOR AN INSERT *
     C*         THEN IT WILL EITHER UPDATE A RECORD FOR INSERT OVER A *
     C*         DELETED RECORD OR WRITE A NEW RECORD                  *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :     #ZC                                               *
     C*             #ZD                                               *
     C*             #ZE                                               *
     C*             #ZH                                               *
     C*             ZA0240                                            *
     C*                                                               *
     C* USES :      @EXKY  - KEY LIST FOR FDINTRLL                    *
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C**************@SCRKY*- KEY FOR FDCCYTLL                         *   S01194
     C*                                                               *
     C*****************************************************************
     C*
     C           #BD       BEGSR
     C                     MOVE '0'       *IN64
     C*
     C***FIRST*CHECK*THAT*THE CURRENCY IS A VALID DEALING CCY             S01194
     C***********@SCRKY****CHAINFDCCYTLL             68                   S01194
     C************IN68*****IFEQ '1'                        B1             S01194
     C***********RECI******ORNE 'D'                        *1             S01194
     C***********DCCY******ORNE 'Y'                        *1             S01194
     C*********************MOVEL'FDM0168' @MSGID           *1             S01194
     C*********************MOVE '1'       *IN21            *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************MOVE '1'       *IN64            *1             S01194
     C*********************END                             E1             S01194
032  C* CALL ACCESS PROG. FOR CURRENCY DETAILS.                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '       ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM DDCCY     @CRKEY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
032  C*                                                                   S01194
032  C* ERROR IF CURRENCY NOT FOUND OR NOT A DEALING CURRENCY             S01194
032  C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           @RTCD     OREQ *BLANK                                    S01194
     C           A6DLCI    ANDNE'Y'                                       S01194
     C                     MOVE '1'       *IN21                           S01194
     C                     MOVE '1'       *IN22                           067980
     C                     MOVE '1'       *IN64                           S01194
     C                     MOVEL'FDM0168' @MSGID                          S01194
     C                     CALL 'ZA0240'                                  S01194
     C                     PARM           @MSGID                          S01194
     C                     ELSE                                           S01194
     C                     MOVE A6CYCD    DDCCY                           S01194
     C                     END                                            S01194
     C*
     C** FIRST CHECK TO SEE IF RECORD EXISTS
     C                     MOVE '1'       *IN71
     C           @EXKY     CHAINFDINTRLL             68
     C*
     C** IF IT DOES EXIST THEN CHECK TO SEE IF IT HAS BEEN LOGICALLY
     C** DELETED
     C           *IN68     IFEQ '0'                        B1
     C           HWDLTF    ANDEQ' '                        *1
     C                     MOVEL'FDM0490' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN21            *1
     C                     MOVE '1'       *IN22                           067980
     C*
     C** SET OFF ANY INDICATORS SET IN PREVIOUS POINTS SUBFILE;
     C** OTHERWISE ANY FIELDS THAT WERE IN REVERSE IMAGE WILL
     C** STILL BE DISPLAYED IN REVERSE IMAGE.
     C           1         DO   @CNT      @RRN1            B*2
     C           @RRN1     CHAINFD0550S5             77    **2
     C                     MOVE '0'       *IN30            **2
     C                     MOVE '0'       *IN31            **2
     C                     MOVE '0'       *IN34            **2
     C                     MOVE '0'       *IN35            **2
     C                     UPDATFD0550S5                   **2
     C                     END                             E*2
     C                     GOTO #BD9                       *1
     C                     END                             E1
     C*
     C** NOW VALIDATE INPUT
     C*
     C** EXTRA VALIDATION FOR INSERT
     C           DDCCY     IFEQ *BLANKS                    B1
     C                     MOVEL'FDM0224' @MSGID           *1
     C                     MOVE '1'       *IN21            *1
     C                     MOVE '1'       *IN22                           067980
     C                     MOVE '1'       *IN64            *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C*
     C** SET ON SUCCESSFUL READ INDICATOR
     C                     MOVE '1'       *IN65
     C*
     C** CALL THE MAIN FIELD VALIDATION
     C                     EXSR #ZC
     C*
     C** UPDATE FILE IF NO ERRORS
     C           *IN64     IFEQ '0'                        B1
     C*
     C           *IN68     IFEQ '0'                        B*2
     C*
     C** INSERT OVER A DELETED RECORD
     C                     EXSR #ZD                        **2
     C*
     C                     ELSE                            X*2
     C*
     C                     EXSR #ZE                        **2
     C                     END                             E*2
     C*
     C** OUTPUT MESSAGE FOR SUCCESSFUL INSERTION OF RECORD
     C                     MOVELDDCCY     @DATA  45        *1
     C                     MOVEL'FDM8029' @MSGID           *1
     C                     CALL 'ZA0440'                   *1
     C                     PARM           @MSGID           *1
     C                     PARM           @DATA            *1
     C*
     C** CLEAR INPUT FIELDS
     C                     EXSR #ZH                        *1
     C                     END                             E1
     C*
     C                     MOVE '1'       *IN65
     C*
     C           #BD9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #BE  - HANDLES ENTER BEING PRESSED IN ENQUIRY MODE            *
     C*                                                               *
     C* CALLED BY : #B                                                *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :      @ACTN  - SAVED ACTION CODE                        *
     C*             @CCNM  - SAVED CURRENCY NAME                      *
     C*             @CCY   - SAVED CURRENCY                           *
     C*             @FLDS  - SAVED LOW/HIGH/SPOT RATES AND PERIODS 1/2*
     C*             @CNT   - COUNT OF SUBFILE RECORDS                 *
     C*             @DDS   - DATA STRUCTURE HOLDING THE SAVED S/FILE  *
     C*             @PDX3  - SAVED PERIOD SNAME 3                     *
     C*             @03BR  - SAVED HIGH RATE 3                        *
     C*             @03LR  - SAVED LOW RATE 3                         *
     C*             @X     - MULTIPURPOSE INDEX                       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BE       BEGSR
     C                     MOVE '1'       *IN62                                               250662
     C*
     C** IF ANY FIELD WAS CHANGED CHANGE IT BACK
     C           1         DO   @CNT      @X               B1
     C           @X        CHAINFD0550S5             78    *1
     C           @X        OCUR @DDS                       *1
     C                     MOVE @03LR     DD03LR           *1
     C                     MOVE @03BR     DD03BR           *1
     C                     MOVE @PDX3     DDPDX3           *1
     C                     UPDATFD0550S5                   *1
     C                     END                             E1
     C*
     C** NOW MOVE THE OTHER FIELDS
     C**                   MOVE @ACTN     DDACTN
     C**                   MOVE @CCY      DDCCY
     C                     MOVE @CCNM     DDCCNM
     C                     MOVE @FLDS     DDFLDS
     C*
     C** VALIDATE CURRENCY CODE
     C                     EXSR #ZZ
     C*
     C** INITIALISE INPUT FIELDS IF INPUT CURRENCY CODE
     C** BLANKS OR ERROR ON ENQUIRY
     C           DDCCY     IFEQ *BLANKS                    B1
     C           *IN36     OREQ '0'                        *1
     C                     MOVE DDACTN    @ACTN            *1
     C                     MOVE DDCCY     @CCY             *1
     C                     MOVE '1'       *IN71            *1
     C                     EXSR #ZH                        *1
     C                     MOVE @ACTN     DDACTN           *1
     C                     MOVE @CCY      DDCCY            *1
     C                     MOVE '1'       *IN21            *1
     C                     MOVE '1'       *IN22            *1             067980
     C                     END                             E1
     C           #BE9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZZ  -  CHECK FOR CURRENCY RECORD AND DISPLAY RECORD          *
     C*                                                               *
     C* CALLED BY : #ZJ                                               *
     C*                                                               *
     C* CALLS :     ZA0240                                            *
     C*             #ZX                                               *
     C*                                                               *
     C* USES :      @CCY   - SAVED CURRENCY CODE                      *
     C*             @CNT   - NUMBER OF SUBFILE RECORDS                *
     C**************@CHGD  - SAVED DAY OF LAST UPDATE                 *   S01194
     C*             @EXKY  - KEYLIST FOR FDCCYPLL                     *
     C*             @FLD1  - NUMERIC FIELD TO CONVERT TO ALPHA        *
     C*             @FLD2  - ALPHA FIELD CONVERTED FROM NUMERIC       *
     C**************@TSPC  - SAVED TIME  OF LAST UPDATE               *   S01194
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @RRN1  - RELATIVE RECORD NUMBER FOR POINTS SFILE  *
     C*             @SCCY  - CURRENCY CODE SAVED FROM PREVIOUS READ   *
     C**************@SCRKY*- KEY FOR FDCCYTLL FROM DISPLAY            *   S01194
     C*             @XDLUP - SAVED DAY OF LAST UPDATE FDCCYPLL        *
     C*             @XMLUP - SAVED MONTH OF LAST UPDATE FDCCYPLL      *
     C*             @XTLUP - SAVED TIME OF LAST UPDATE FDCCYPLL       *
     C*             @XYLUP - SAVED YEAR OF LAST UPDATE FDCCYPLL       *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZZ       BEGSR
     C*
     C                     MOVE '0'       *IN64
     C*
     C***FIRST*CHECK*THAT*THE CURRENCY IS A VALID DEALING CCY             S01194
     C***********@SCRKY****CHAINFDCCYTLL             68                   S01194
     C************IN68*****IFEQ '1'                        B1             S01194
     C***********RECI******ORNE 'D'                        *1             S01194
     C***********DCCY******ORNE 'Y'                        *1             S01194
     C*********************MOVEL'FDM0168' @MSGID           *1             S01194
     C*********************MOVE '1'       *IN21            *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************MOVE '1'       *IN64            *1             S01194
     C*********************GOTO #ZZ9                       *1             S01194
     C*********************END                             E1             S01194
032  C* CALL ACCESS PROG. FOR CURRENCY DETAILS.                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '       ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM DDCCY     @CRKEY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
032  C*                                                                   S01194
032  C* ERROR IF CURRENCY NOT FOUND OR NOT A DEALING CURRENCY             S01194
032  C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C           @RTCD     OREQ *BLANK                                    S01194
     C           A6DLCI    ANDNE'Y'                                       S01194
     C                     MOVE '1'       *IN21                           S01194
     C                     MOVE '1'       *IN22            *1             067980
     C                     MOVE '1'       *IN64                           S01194
     C                     MOVEL'FDM0168' @MSGID                          S01194
     C                     CALL 'ZA0240'                                  S01194
     C                     PARM           @MSGID                          S01194
     C                     GOTO #ZZ9                                      S01194
     C                     ELSE                                           S01194
     C                     MOVE A6CYCD    DDCCY                           S01194
     C                     END                                            S01194
     C*
     C** FIRST CHECK TO SEE IF RECORD EXISTS
     C                     MOVE '1'       *IN71
     C           @EXKY     CHAINFDINTRLL             68
     C*
     C** IF IT DOES EXIST THEN CHECK TO SEE IF IT HAS BEEN LOGICALLY
     C** DELETED
     C           *IN68     IFEQ '1'                        B1
     C           HWDLTF    OREQ '*'                        *1
     C                     MOVEL'FDM0491' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN21            *1
     C                     MOVE '1'       *IN22            *1             067980
     C                     GOTO #ZZ9                       *1
     C                     END                             E1
     C*
     C** SET ON END OF READ INDICATOR
     C                     MOVE '0'       *IN55
     C*
     C** GET REQUIRED RECORD
     C           @EXKY     CHAINFDINTRLL             68
     C*
     C** LOAD SCREEN FIELDS
     C                     EXSR #ZX
     C*
     C** SUCCESSFULL OVERALL VALIDATION OF ACTION CODE
     C                     MOVE '1'       *IN36
     C*
     C           #ZZ9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZC  - VALIDATES INPUT FOR AMENDMENTS AND DELETIONS           *
     C*                                                               *
     C* CALLED BY : #ZJ                                               *
     C*             #BD                                               *
     C*                                                               *
     C* CALLS :     #ZA                                               *
     C*             ZA0240                                            *
     C*             ZA0840                                            *
     C*                                                               *
     C* USES :      @CCY   - SAVED CCY                                *
     C*             @CNT   - RECORDS IN POINTS SFILE                  *
     C*             @EM    - FLAG FOR POSITIONING ERROR MESSAGES      *
     C*             @ER    - ARRAY CONTAINING FIELD TO BE VALIDATED   *
     C*             @EXKY  - KEY LIST FOR FDINTRLL                    *
     C*             @FLD4  - NUMERIC FIELD AFTER VALIDATION           *
     C*             @LR    - ARRAY CONTAINING THE SFILE HIPOINTS      *
     C*             @BR    - ARRAY CONTAINING THE SFILE LOPOINTS      *
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @RRN1  - REL REC NO POINTS SFILE                  *
     C*             @X     - ARRAY INDEX                              *
     C**************@01LR  - OVERNIGHT LEND POINTS                    *   S01328
     C**************@01BR  - OVERNIGHT BORROW POINTS                  *   S01328
     C**************@02LR  - TOMORROW NEXT LEND POINTS                *   S01328
     C**************@02BR  - TOMORROW NEXT BORROW POINTS              *   S01328
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZC       BEGSR
     C*
     C** IF *IN65 IS OFF CHECK IT IS BECAUSE YOU ARE AT THE END OR
     C** BEGINNING OF THE FILE
     C***********          MOVE ' '       @PERR                           S01328
     C                     MOVE *BLANKS   @@ALPH
     C                     MOVEA*BLANKS   @EM
     C                     Z-ADD7         @@IDP
     C                     Z-ADD4         @@IINT
     C           *IN65     IFEQ '0'                        B1
     C           DDACTN    ANDNE'I'                        *1
     C           @EXKY     SETLLFDINTRLL                   *1
     C                     EXSR #ZA                        *1
     C           DDCCY     IFEQ @CCY                       B*2
     C                     MOVE '1'       *IN65            **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C** CHECK A RECORD HAS BEEN READ FROM THE FILE
     C           *IN65     IFEQ '0'                        B1
     C                     MOVE '1'       *IN64            *1
     C                     MOVEL'FDM0125' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     MOVE '1'       *IN20            *1
     C                     MOVE '1'       *IN23            *1             067980
     C                     END                             E1
     C*
     C****VALIDATE*OVERNIGHT*BORROW RATE                                  S01328
     C***********DD01BR    IFEQ *BLANKS                    B1             S01328
     C***********          MOVE '1'       *IN22            *1             S01328
     C***********          MOVE '1'       @EM,5            *1             S01328
     C***********          MOVE '1'       *IN64            *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVE *BLANKS   @@ALPH                          S01328
     C***********          MOVELDD01BR    @@ALPH                          S01328
     C***********          EXSR ZA0840                                    S01328
     C***********@@ERCD    IFEQ *ZERO                      B1             S01328
     C***********@@AMT     DIV  @H,8      @01BR            *1             S01328
     C***********          ELSE                            X1             S01328
     C***********@@ERCD    IFEQ 1                          B*2            S01328
     C***********          MOVE '1'       *IN22            **2            S01328
     C***********          MOVE '1'       @EM,9            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          ELSE                            X*2            S01328
     C***********          MOVE '1'       *IN22            **2            S01328
     C***********          MOVE '1'       @EM,2            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***********
     C****VALIDATE*OVERNIGHT*LEND RATE                                    S01328
     C***********DD01LR    IFEQ *BLANKS                    B1             S01328
     C***********          MOVE '1'       *IN23            *1             S01328
     C***********          MOVE '1'       @EM,5            *1             S01328
     C***********          MOVE '1'       *IN64            *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVE *BLANKS   @@ALPH                          S01328
     C***********          MOVELDD01LR    @@ALPH                          S01328
     C***********          EXSR ZA0840                                    S01328
     C***********@@ERCD    IFEQ *ZERO                      B1             S01328
     C***********@@AMT     DIV  @H,8      @01LR            *1             S01328
     C***********@01LR     IFLT @01BR                      B*2            S01328
     C***********          MOVE '1'       *IN22            **2            S01328
     C***********          MOVE '1'       *IN23            **2            S01328
     C***********          MOVE '1'       @EM,6            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          ELSE                            X1             S01328
     C***********@@ERCD    IFEQ 1                          B*2            S01328
     C***********          MOVE '1'       *IN23            **2            S01328
     C***********          MOVE '1'       @EM,9            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          ELSE                            X*2            S01328
     C***********          MOVE '1'       *IN23            **2            S01328
     C***********          MOVE '1'       @EM,2            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***TOMORROW*NEXT**LOW                                               S01328
     C***********DD02BR    IFEQ *BLANKS                    B1             S01328
     C***********          MOVE '1'       *IN25            *1             S01328
     C***********          MOVE '1'       @EM,6            *1             S01328
     C***********          MOVE '1'       *IN64            *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVE *BLANKS   @@ALPH                          S01328
     C***********          MOVELDD02BR    @@ALPH                          S01328
     C***********          EXSR ZA0840                                    S01328
     C***********@@ERCD    IFEQ *ZERO                      B1             S01328
     C***********@@AMT     DIV  @H,8      @02BR            *1             S01328
     C***********          ELSE                            X1             S01328
     C***********@@ERCD    IFEQ 1                          B*2            S01328
     C***********          MOVE '1'       *IN25            **2            S01328
     C***********          MOVE '1'       @EM,9            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          ELSE                            X*2            S01328
     C***********          MOVE '1'       *IN25            **2            S01328
     C***********          MOVE '1'       @EM,2            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***********
     C****TOMORROW*NEXT*HIGH                                              S01328
     C***********DD02LR    IFEQ *BLANKS                    B1             S01328
     C***********          MOVE '1'       *IN26            *1             S01328
     C***********          MOVE '1'       @EM,5            *1             S01328
     C***********          MOVE '1'       *IN64            *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVE *BLANKS   @@ALPH                          S01328
     C***********          MOVELDD02LR    @@ALPH                          S01328
     C***********          EXSR ZA0840                                    S01328
     C***********@@ERCD    IFEQ *ZERO                      B1             S01328
     C***********@@AMT     DIV  @H,8      @02LR            *1             S01328
     C***********@02LR     IFLT @02BR                      B*2            S01328
     C***********          MOVE '1'       *IN25            **2            S01328
     C***********          MOVE '1'       *IN26            **2            S01328
     C***********          MOVE '1'       @EM,6            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          ELSE                            X1             S01328
     C***********@@ERCD    IFEQ 1                          B*2            S01328
     C***********          MOVE '1'       *IN26            **2            S01328
     C***********          MOVE '1'       @EM,9            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          ELSE                            X*2            S01328
     C***********          MOVE '1'       *IN26            **2            S01328
     C***********          MOVE '1'       @EM,2            **2            S01328
     C***********          MOVE '1'       *IN64            **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***IF*AN*ERROR*HAS*OCCURED BEFORE THE SUBFILE VALIDATION            S01328
     C***THEN*SEND*THE*APPROPRIATE ERROR MESSAGE                          S01328
     C************IN22     IFEQ '1'                        B1             S01328
     C************IN23     OREQ '1'                        *1             S01328
     C************IN25     OREQ '1'                        *1             S01328
     C************IN26     OREQ '1'                        *1             S01328
     C***********                                          *1             S01328
     C****SET*'PRIOR ERROR'*FLAG****************************1**********   S01328
     C***********          MOVE 'Y'       @PERR            *1             S01328
     C****       @EM,1     IFEQ '1'                        B*2
     C****                 MOVEL'FDM0170' @MSGID           **2
     C****                 CALL 'ZA0240'                   **2
     C****                 PARM           @MSGID           **2
     C****                 MOVE '1'       @EM,3            **2
     C****                 END                             E*2
     C***********@EM,2     IFEQ '1'                        B*2            S01328
     C***********          MOVEL'FDM0494' @MSGID           **2            S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE '1'       @EM,4            **2            S01328
     C***********          END                             E*2            S01328
     C***********@EM,5     IFEQ '1'                        B*2            S01328
     C***********          MOVEL'FDM0492' @MSGID           **2            S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE '1'       @EM,7            **2            S01328
     C***********          END                             E*2            S01328
     C***********@EM,6     IFEQ '1'                        B*2            S01328
     C***********          MOVEL'FDM0493' @MSGID           **2            S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE '1'       @EM,8            **2            S01328
     C***********          END                             E*2            S01328
     C***********@EM,9     IFEQ '1'                        B*2            S01328
     C******               MOVEL'FDM0209' @MSGID           **2            E12802
     C***********          MOVEL'FDM0801' @MSGID           **2     E12802 S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE '1'       @EM,10           **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C*
     C*
     C** VALIDATE ALL THE FIELDS IN THE SUBFILE
     C                     Z-ADD1         RECNO                           S01328
     C           1         DO   @CNT      @RRN1            B1
     C           @RRN1     CHAINFD0550S5             77    *1
     C                     MOVE '0'       *IN30            *1
     C                     MOVE '0'       *IN31            *1
     C*
     C** BORROW RATE
     C*                                                                   S01328
     C* FOR YEARS 2 TO 10, DEFAULT PREVIOUS BORROW RATE IF NOT ENTERED    S01328
     C* (AS LONG AS SO FAR NO ERROR WAS DETECTED FOR THAT INPUT)          S01328
     C*                                                                   S01328
     C           @RRN1     IFGT 12                                        S01328
     C           DD03BR    ANDEQ*BLANK                                    S01328
     C                     MOVELPP03BR    DD03BR                          S01328
     C                     ELSE                                           S01328
     C*                                                                   S01328
     C           DD03BR    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN30            **2
     C***********@PERR     IFEQ ' '                        B**3           S01328
     C                     MOVE '1'       *IN34            ***3
     C***********          END                             E**3           S01328
     C                     MOVE '1'       @EM,5            **2
     C                     MOVE '1'       *IN64            **2
     C                     END                             E*2
     C                     END                                            S01328
     C*
     C***CHECK*THAT*IF*SPOT*DAYS*= 1,SPOT/NEXT*IS*THE*SAME*AS****** S01136S01328
     C***TOMORROW/NEXT:******************************************** S01136S01328
     C***********SPDY******IFEQ 1                                   S01136S01328
     C***********DD03BR****ANDNEDD02BR                              S01136S01328
     C*********************MOVEL'FDM0495' @MSGID                    S01136S01328
     C*********************CALL 'ZA0240'                            S01136S01328
     C*********************PARM           @MSGID                    S01136S01328
     C*********************END                                      S01136S01328
     C                     MOVE *BLANKS   @@ALPH
     C                     MOVELDD03BR    @@ALPH           *1
     C                     EXSR ZA0840                     *1
     C           @@ERCD    IFEQ *ZERO                      B1
     C                     Z-ADD@RRN1     @X               *1
     C           @@AMT     DIV  @H,8      @BR,@X           *1
     C                     ELSE                            X1
     C           @@ERCD    IFEQ 1                          B*2
     C                     MOVE '1'       *IN30            **2
     C***********@PERR     IFEQ ' '                        B**3           S01328
     C                     MOVE '1'       *IN34            ***3
     C***********          END                             E**3           S01328
     C                     MOVE '1'       @EM,9            **2
     C                     MOVE '1'       *IN64            **2
     C                     ELSE                            X*2
     C                     MOVE '1'       *IN30            **2
     C***********@PERR     IFEQ ' '                        B**3           S01328
     C                     MOVE '1'       *IN34            ***3
     C***********          END                             E**3           S01328
     C                     MOVE '1'       @EM,2            **2
     C                     MOVE '1'       *IN64            **2
     C                     END                             E*2
     C                     END                             E1
     C*                                                                   S01328
     C** IF NO ERROR SO FAR CHECK THAT IF SPOT DAYS = 1,SPOT/NEXT         S01328
     C** IS THE SAME AS TOMORROW/NEXT:                                    S01328
     C           A6SPDY    IFEQ 1                                         S01328
     C           @RRN1     ANDEQ3                                         S01328
     C           *IN30     ANDEQ'0'                                       S01328
     C           @BR,3     ANDNE@BR,2                                     S01328
     C                     MOVE '1'       @EM,1                           S01328
     C                     MOVE '1'       *IN30                           S01328
     C                     MOVE '1'       *IN34                           S01328
     C                     MOVE '1'       *IN64                           S01328
     C                     END                                            S01328
     C*
     C**  LEND RATES
     C*                                                                   S01328
     C* FOR YEARS 2 TO 10, DEFAULT PREVIOUS LEND RATE IF NOT ENTERED      S01328
     C* (AS LONG AS SO FAR NO ERROR WAS DETECTED FOR THAT INPUT)          S01328
     C*                                                                   S01328
     C           @RRN1     IFGT 12                                        S01328
     C           DD03LR    ANDEQ*BLANK                                    S01328
     C                     MOVELPP03LR    DD03LR                          S01328
     C                     ELSE                                           S01328
     C*                                                                   S01328
     C           DD03LR    IFEQ *BLANKS                    B*2
     C                     MOVE '1'       *IN31            **2
     C***********@PERR     IFEQ ' '                        B**3           S01328
     C                     MOVE '1'       *IN35            ***3
     C***********          END                             E**3           S01328
     C                     MOVE '1'       @EM,5            **2
     C                     MOVE '1'       *IN64            **2
     C                     END                             E*2
     C                     END                                            S01328
     C*
     C***CHECK*THAT*IF*SPOT*DAYS*=*1,SPOT/NEXT*IS*THE*SAME*AS****** S01136S01328
     C***TOMORROW/NEXT:******************************************** S01136S01328
     C***********SPDY******IFEQ 1                                   S01136S01328
     C***********DD03LR****ANDNEDD02LR                              S01136S01328
     C*********************MOVEL'FDM0495' @MSGID                    S01136S01328
     C*********************CALL 'ZA0240'                            S01136S01328
     C*********************PARM           @MSGID                    S01136S01328
     C*********************END                                      S01136S01328
     C                     MOVE *BLANKS   @@ALPH
     C                     MOVELDD03LR    @@ALPH           *1
     C                     EXSR ZA0840                     *1
     C           @@ERCD    IFEQ *ZERO                      B*2
     C                     Z-ADD@RRN1     @X               **2
     C           @@AMT     DIV  @H,8      @LR,@X           **2
     C           @LR,@X    IFLT @BR,@X                     B**3
     C                     MOVE '1'       *IN30            ***3
     C                     MOVE '1'       *IN31            ***3
     C                     MOVE '1'       @EM,6            ***3
     C                     MOVE '1'       *IN64            ***3
     C                     END                             E**3
     C                     ELSE                            X*2
     C           @@ERCD    IFEQ 1                          B**2
     C                     MOVE '1'       *IN31            ***3
     C***********@PERR     IFEQ ' '                        B***4          S01328
     C                     MOVE '1'       *IN35            ****4
     C***********          END                             E***4          S01328
     C                     MOVE '1'       @EM,9            ***3
     C                     MOVE '1'       *IN64            ***3
     C                     ELSE                            X**3
     C                     MOVE '1'       *IN31            ***3
     C***********@PERR     IFEQ ' '                        B***4          S01328
     C                     MOVE '1'       *IN35            ****4
     C***********          END                             E***4          S01328
     C                     MOVE '1'       @EM,2            ***3
     C                     MOVE '1'       *IN64            ***3
     C                     END                             E**3
     C                     END                             E*2
     C*                                                                   S01328
     C** IF NO ERROR SO FAR CHECK THAT IF SPOT DAYS = 1,SPOT/NEXT         S01328
     C** IS THE SAME AS TOMORROW/NEXT:                                    S01328
     C           A6SPDY    IFEQ 1                                         S01328
     C           @RRN1     ANDEQ3                                         S01328
     C           *IN31     ANDEQ'0'                                       S01328
     C           @LR,3     ANDNE@LR,2                                     S01328
     C                     MOVE '1'       @EM,1                           S01328
     C                     MOVE '1'       *IN31                           S01328
     C                     MOVE '1'       *IN35                           S01328
     C                     MOVE '1'       *IN64                           S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C* STORE PREVIOUS BORROW AND LEND RATES (IF NO ERRORS ON THEM)       S01328
     C*                                                                   S01328
     C                     MOVEL*BLANK    PP03BR 12                       S01328
     C                     MOVEL*BLANK    PP03LR 12                       S01328
     C           *IN30     IFEQ '0'                                       S01328
     C                     MOVELDD03BR    PP03BR                          S01328
     C                     END                                            S01328
     C           *IN31     IFEQ '0'                                       S01328
     C                     MOVELDD03LR    PP03LR                          S01328
     C                     END                                            S01328
     C*                                                                   S01328
     C* SET RECORD NUMBER FOR SUBFILE PAGE DISPLAY                        S01328
     C*                                                                   S01328
     C           *IN64     IFEQ '1'                                       S01328
     C           RECNO     ANDEQ1                                         S01328
     C                     Z-ADD@RRN1     RECNO                           S01328
     C                     END                                            S01328
     C                     UPDATFD0550S5                   *1
     C                     END                             E1
     C*
     C** IF ANY ERRORS OCCURED AFTER SPOT RATE VALIDATION BUT NOT
     C** BEFORE SEND THE ERROR MESSAGE
     C*****      @EM,1     IFEQ '1'                        B1
     C****       @EM,3     ANDEQ' '                        *1
     C****                 MOVEL'FDM0170' @MSGID           *1
     C****                 CALL 'ZA0240'                   *1
     C****                 PARM           @MSGID           *1
     C****                 END                             E1
     C           @EM,2     IFEQ '1'                        B1
     C***********@EM,4     ANDEQ' '                        *1             S01328
     C                     MOVEL'FDM0494' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C           @EM,5     IFEQ '1'                        B1
     C***********@EM,7     ANDEQ' '                        *1             S01328
     C                     MOVEL'FDM0492' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C           @EM,6     IFEQ '1'                        B1
     C***********@EM,8     ANDEQ' '                        *1             S01328
     C                     MOVEL'FDM0493' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C           @EM,9     IFEQ '1'                        B1
     C***********@EM,10    ANDEQ' '                        *1             S01328
     C******               MOVEL'FDM0209' @MSGID           *1             E12802
     C                     MOVEL'FDM0801' @MSGID           *1             E12802
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     END                             E1
     C           @EM,1     IFEQ '1'                                       S01328
     C                     MOVEL'FDM0495' @MSGID                          S01328
     C                     CALL 'ZA0240'                                  S01328
     C                     PARM           @MSGID                          S01328
     C                     END                                            S01328
     C*
     C           #ZC9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      *  ZA0840 - VALIADTE AND REFORMAT AN INPUT AMOUNT               *
      *                                                               *
      *           This subroutine will take as input a 16A field      *
      *           a 1N number of integers and a 1N number of decimal  *
      *           places. Ignoring the leading and trailing blanks    *
      *           it will ensure that the field contains only numeric *
      *           characters and a decimal point, and that it has no  *
      *           embedded blanks, or more than one decimal point.    *
      *           It will also check that the number of figures before*
      *           and after the decimal point do not exceed the input *
      *           parameters. The subroutine will output the number as*
      *           a 16A field and a 15N field, along with an error    *
      *           code. The alpha field will be right aligned with    *
      *           the leading zeros blanked, and trailing blanks zero *
      *           filled. The number returned will be 15 long with 0  *
      *           decimal places. The error code will contain 0 if    *
      *           there was no error, 1 if there was a non-numeric    *
      *           character found, and 2 if the number of decimal     *
      *           places are wrong.                                   *
      *                                                               *
      *  Input  : @@ALPH - 16A field containing the field to validate *
      *           @@IDP  - number of decimal places                   *
      *           @@IINT - number of integers                         *
      *                                                               *
      *  Output : @@ALPH - 16A field for display                      *
      *           @@AMT  - 15N field for calculation                  *
      *           @@ERCD - 1N error code                              *
      *                                                               *
      *  Uses   : @F     - array of 16 elements 1 character long      *
      *           @G     - array of 16 elements 1 character long      *
      *           @@CADP - calculated number of decimal places        *
      *           @@CINT - calculated number of integers              *
      *           @@PIDP - position of dp in input array              *
      *           @@PODP - position of dp in output array             *
      *           @@C    - index for array @F                         *
      *           @@D    - index for array @G                         *
      *           @@WK7  - workfield used for converting array element*
      *                    to a 1N number.                            *
      *           @H     - array containing powers of 10              *
      *           @@E    - index to array @H                          *
      *           @@WK5  - work field                                 *
      *           @@ALP1 - feild used to right align 0 decimal places *
      *                                                              *
      *     LAST AMEND NO. XXXXXX             DATE   XX/XX/XX        *
      *                                                              *
      *****************************************************************
      *
     C           ZA0840    BEGSR
      *
      ** initialize the fields and the arrays
     C                     MOVE '0'       *IN81
     C                     MOVE '0'       *IN82
     C                     Z-ADD0         @@ERCD  10
     C                     Z-ADD0         @@AMT  150
     C                     MOVEA*BLANKS   @G
     C                     MOVEA@@ALPH    @F
     C                     MOVE *BLANKS   @@ALPH 16
     C                     Z-ADD0         @@WK7   10
     C                     Z-ADD0         @@CADP  30
     C                     Z-ADD0         @@CINT  30
     C                     Z-ADD0         @@PIDP  30
     C                     Z-ADD0         @@PODP  30
     C                     Z-ADD0         @@C     20
     C                     Z-ADD0         @@D     20
     C                     Z-ADD0         @@E     20
      *
      ** define the input fields
     C           *LIKE     DEFN @@CADP    @@IDP
     C           *LIKE     DEFN @@CINT    @@IINT
      *
      ** first check that the number input will not produce a number
      ** output with more than 15 figures.
     C           @@IDP     ADD  @@IINT    @@WK2   20
     C           @@WK2     IFGT 15                         B1
     C                     Z-ADD2         @@ERCD           *1
     C                     GOTO ZA0849                     *1
     C                     END                             E1
      *
      ** work through input array, ignoring leading zeros and blanks,
      ** also blanking the leading zeros in the input array.
     C                     MOVE '0'       *IN83
     C                     ADD  1         @@C
     C           @@C       DOWLE16                         B1
     C           *IN83     ANDEQ'0'                        *1
     C           @F,@@C    IFNE ' '                        B*2
     C           @F,@@C    ANDNE'0'                        **2
     C                     MOVE '1'       *IN83            **2
     C                     SUB  1         @@C              **2
     C                     END                             E*2
     C                     ADD  1         @@C              **2
     C                     END                             E1
     C                     MOVE 'N'       WFIRST  1                                         AR851109
     C                     MOVE 'N'       WNGTV   1                                         AR851109
      *
      ** check the integer part of the number for valid characters.
     C           @@C       DOWLE16                         B1
     C********** @F,@@C    ANDNE'.'                        *1                               AR851109
     C********** @F,@@C    ANDNE' '                        *1                               AR851109
      *                                                                                     AR851109
     C           @F,@@C    IFEQ '.'                                                         AR851109
     C           @F,@@C    OREQ ' '                                                         AR851109
     C                     LEAVE                                                            AR851109
     C                     ENDIF                                                            AR851109
      *                                                                                     AR851109
     C           @F,@@C    IFEQ '-'                                                         AR851109
     C           WFIRST    ANDEQ'N'                                                         AR851109
     C                     MOVEL'Y'       WFIRST                                            AR851109
     C                     MOVEL'Y'       WNGTV                                             AR851109
     C                     ELSE                                                             AR851109
      *
      ** check for non numeric characters
     C           @F,@@C    IFGT '9'                        B*2
     C           @F,@@C    ORLT '0'                        **2
     C                     Z-ADD0         @@AMT            **2
     C                     Z-ADD1         @@ERCD           **2
     C                     GOTO ZA0849                     **2
      *
     C                     ELSE                            X*2
      *
     C                     ADD  1         @@CINT           **2
      *
      ** check number of integers is not greater than that required
     C           @@CINT    IFGT @@IINT                     B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
      ** multiply the output amount by 10 then add the number in
      ** the input array element being processed.
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C           @@AMT     ADD  @@WK7     @@AMT            **2
     C                     END                             E*2
     C                     ENDIF                                                            AR851109
      *
      ** increase array index
     C                     ADD  1         @@C              *1
     C                     END                             E1
      *
      ** set up position of decimal point in input array
     C                     Z-ADD@@C       @@PIDP
      *
      ** if the character pointed to is a decimal point add 1 to the
      ** index
     C           @@C       IFLE 16                         B1
     C           @F,@@C    ANDEQ'.'                        *1
     C                     ADD  1         @@C              *1
     C                     MOVE '1'       *IN82            *1
     C                     END                             E1
      *
      ** now validate the decimal part of the number
     C           @@C       DOWLE16                         B1
      *
      ** if a blank is found set on the blank input indicator
     C           @F,@@C    IFEQ ' '                        B*2
     C                     MOVE '1'       *IN81            **2
     C                     END                             E*2
      *
      ** if the figure is numeric, check that the number of decimal
      ** places does not exceed that specified, and that no blanks
      ** have been entered.
     C           @F,@@C    IFGE '0'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C                     ADD  1         @@CADP           **2
      *
     C           @@CADP    IFGT @@IDP                      B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD2         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
     C           *IN81     IFEQ '1'                        B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
      ** update output amount
     C           @@AMT     MULT 10        @@AMT            **2
     C                     MOVE @F,@@C    @@WK7            **2
     C                     ADD  @@WK7     @@AMT            **2
      *
     C                     ELSE                            X*2
      *
      ** if the character is not numeric and not a blank then it is
      ** invalid
     C           @F,@@C    IFNE ' '                        B**3
     C                     Z-ADD0         @@AMT            ***3
     C                     Z-ADD1         @@ERCD           ***3
     C                     GOTO ZA0849                     ***3
     C                     END                             E**3
      *
     C                     END                             E*2
      *
      ** increase index
     C                     ADD  1         @@C              *1
      *
     C                     END                             E1
      *
      ** correct the output number for any decimal places not input
      ** in the alpha field.
     C           @@IDP     SUB  @@CADP    @@E
      *
      ** increase the index by one to get correct array entry
     C                     ADD  1         @@E
     C           @@AMT     MULT @H,@@E    @@AMT
      *
      ** now format the output alpha field, first calculate where
      ** the decimal point goes
     C           16        SUB  @@IDP     @@PODP
     C           @@PODP    SUB  1         @@PIDP
      *
      ** if there are no decimal points set the position to 17
     C           @@IDP     IFEQ 0                          B1
     C                     Z-ADD17        @@PODP           *1
     C                     END                             E1
      *
      ** move the output number into the input array
     C                     MOVEA*BLANKS   @F
     C                     MOVE @@AMT     @@AMTA 15
     C                     MOVEA@@AMTA    @F
      *
      ** set up indexes
     C                     Z-ADD1         @@C
     C                     Z-ADD1         @@D
     C                     Z-ADD0         WSTRPT  20                                        AR851109
     C                     MOVE '0'       *IN80
      *
      ** now fill up the output array
     C           @@D       DOWLE16                         B1
      *
      ** insert decimal point if the position is found
     C           @@D       IFEQ @@PODP                     B*2
     C                     MOVE '.'       @G,@@D           **2
     C                     ADD  1         @@D              **2
     C                     END                             E*2
      *
      ** insert the zero before the decimal point
     C           *IN80     IFEQ '0'                        B*2
     C           @@D       ANDEQ@@PIDP                     **2
     C           @F,@@C    ANDEQ'0'                        **2
     C                     MOVE '1'       *IN80            **2
     C                     MOVE '0'       @G,@@D           **2
     C           WSTRPT    IFEQ 0                                                           AR851109
     C                     Z-ADD@@D       WSTRPT                                            AR851109
     C                     ENDIF                                                            AR851109
     C                     END                             E*2
      *
      ** blank leading zeros
     C           *IN80     IFEQ '0'                        B*2
     C           @F,@@C    ANDEQ'0'                        **2
     C                     MOVE ' '       @G,@@D           **2
     C                     END                             E*2
      *
      ** move a normal character
     C           @F,@@C    IFGE '1'                        B*2
     C           @F,@@C    ANDLE'9'                        **2
     C                     MOVE @F,@@C    @G,@@D           **2
     C                     MOVE '1'       *IN80            **2
     C           WSTRPT    IFEQ 0                                                           AR851109
     C                     Z-ADD@@D       WSTRPT                                            AR851109
     C                     ENDIF                                                            AR851109
     C                     END                             E*2
      *
      ** non blanked zero
     C           @F,@@C    IFEQ '0'                        B*2
     C           *IN80     ANDEQ'1'                        **2
     C                     MOVE '0'       @G,@@D           **2
     C           WSTRPT    IFEQ 0                                                           AR851109
     C                     Z-ADD@@D       WSTRPT                                            AR851109
     C                     ENDIF                                                            AR851109
     C                     END                             E*2
      *
     C                     ADD  1         @@C              *1
     C                     ADD  1         @@D              *1
     C                     END                             E1
      *                                                                                     AR851109
     C           WNGTV     IFEQ 'Y'                                                         AR851109
     C           WSTRPT    SUB  1         @@D                                               AR851109
     C                     MOVE '-'       @G,@@D                                            AR851109
     C                     ENDIF                                                            AR851109
      *
      *
      ** put output array into output amount
     C                     MOVEA@G        @@ALPH
      *
      ** align figure with zero decimal places.
     C           @@IDP     IFEQ 0                          B1
     C                     MOVE *BLANKS   @@ALP1 17        *1
     C                     MOVE @@ALPH    @@ALP1           *1
     C                     MOVEL@@ALP1    @@ALPH           *1
     C                     END                             E1
      *
     C           WNGTV     IFEQ 'Y'                                                         AR851109
     C                     MOVE 'N'       WNGTV   1                                         AR851109
     C                     Z-SUB@@AMT     @@AMT                                             AR851109
     C                     MOVE *BLANKS   @@ALP1                                            AR851109
     C                     MOVE @@ALPH    @@ALP1                                            AR851109
     C                     MOVEL'-'       @@ALP1                                            AR851109
     C                     MOVEL@@ALP1    @@ALPH                                            AR851109
     C                     ENDIF                                                            AR851109
     C           ZA0849    ENDSR                           ZA0849 TAG
      *
      *****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZD  - THIS SUBROUTINE IS USED TO PERFORM ANY UPDATES TO MAIN *
     C*        FILE                                                   *
     C*                                                               *
     C* CALLED BY : #ZI                                               *
     C*             #ZJ
     C*             #BD
     C*                                                               *
     C* CALLS :     MM1003                                            *
     C*             ZA0240                                            *
     C*             ZA0250                                            *
     C*             ZA0270                                            *
     C*             ZTNLU1                                            *
     C*                                                               *
     C* USES :      @CCYX  - CURRENCY FOR CMTTXT                      *
     C*             @CNT   - NUMBER OF RECORDS IN POINTS SFILE        *
     C*             @MDATE - 6,0 DATE
     C*             @EXKY  - KEYLIST FOR FDINTRLL                     *
     C*             @LR    - ARRAY OF HIPOINTS                        *
     C**************@KEY***-*KEY*FOR*ACCESSING*FDTTOTLL,FDCCYTLL*******   S01194
     C*             @KEY   - KEY FOR ACCESSING FDTTOTLL               *   S01194
     C*             @BR    - ARRAY OF LOW POINTS                      *
     C**************@TSPC**- SAVED TIME  OF LAST UPDATE               *   S01194
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @MTH   - ARRAY HOLDING THE MONTH SHORTNAMES       *
     C*             @P     - ARRAY INDEX                              *
     C*             @PRD   - ARRAY OF PERIODS                         *
     C*             @PTP   - ARRAY OF PERIOD TYPES                    *
     C*             @RRN1  - REL REC NO OF POINTS SFILE               *
     C**************@SCRKY*- KEY FOR FDCCYTLL                         *   S01194
     C*             @USER  - USER ID                                  *
     C*             @X     - ARRAY INDEX                              *
     C*             @XDLUP - DAY OF LAST UPDATE FDINTRLL              *
     C*             @XMLUP - MONTH OF LAST UPDATE FDINTRLL            *
     C*             @XYLUP - TIME OF LAST UPDATE FDINTRLL             *
     C*             @XTLUP - YEAR OF LAST UPDATE FDINTRLL             *
     C*             @XTIME - TIME OF UPDATE                           *
     C**************@01LR  - FIRST LEND POINT                         *   S01328
     C**************@01BR  - FIRST BORROW POINT                       *   S01328
     C**************@02LR  - SECOND LEND POINT                        *   S01328
     C**************@02BR  - SECOND BORROW POINT                      *   S01328
     C*             @@SPDD  SPOT DATE     FORMAT(8N)                  *
     C**************@@CCY1  CURRENCY 1    FORMAT(3A)                  *   S01117
     C*             @@PDAT  SPOT DATE RETURNED FORMAT(8N)             *
     C*             @@ESWT  SWITCH SET IF ERROR OCCURS  FORMAT(1A)    *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZD       BEGSR
     C*
     C***GET*UPDATE*RECORD*                                               S01194
     C***********@SCRKY****CHAINFDCCYTLL             6874                 S01194
     C*EJECT***************                                               S01194
     C****DATA*BASE*ERROR**                                               S01194
     C************IN76*****IFEQ '1'                        B1             S01194
     C*********************MOVEL@KEY      DBKEY            ***************S01194
     C*********************MOVEL'FDINTULL'DBFILE           * DB ERROR 010*S01194
     C*********************MOVE '010'     DBASE            ***************S01194
     C*********************MOVE '1'       *INU7            *1             S01194
     C*********************MOVE '1'       *INU8            *1             S01194
     C*********************EXSR *PSSR                      *1             S01194
     C*********************GOTO #ZD9                       *1             S01194
     C*********************END                             E1             S01194
     C*EJECT***************                                               S01194
     C***IF**IN74*IS*ON*THEN THE RECORD IS LOCKED                         S01194
     C************IN74*****IFEQ '1'                        B1             S01194
     C*********************CALL 'ZA0250'                   *1             S01194
     C*********************MOVEL'FDM0120' @MSGID           *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************GOTO #ZD9                       *1             S01194
     C*********************END                             E1             S01194
     C*EJECT***************                                               S01194
     C***IF*ANY*OF*THE*DATE AND TIME FIELDS HAVE CHANGED SINCE            S01194
     C***THE*FILE*WAS*INITIALLY READ, THEN THE RECORD HAS BEEN            S01194
     C***UPDATED*BY*ANOTHER WORKSTATION                                   S01194
     C***********DDACTN****IFNE 'I'                        B1             S01194
     C***********@CHGD*****IFNE CHGD                       B*2            S01194
     C***********@TSPC*****ORNE TSPC                       **2            S01194
     C*********************MOVEL'FDM0139' @MSGID           **2            S01194
     C*********************CALL 'ZA0240'                   **2            S01194
     C*********************PARM           @MSGID           **2            S01194
     C*********************MOVE 'Y'       @UPDWS           **2            S01194
     C*********************ROLBK                           **2            S01194
     C*********************GOTO #ZD9                       **2            S01194
     C*********************END                             E*2            S01194
     C*********************END                             E1             S01194
     C*
     C** GET HEADER RECORD FOR UPDATE
     C                     MOVE *BLANKS   @KEY
     C                     MOVE 'HW'      @KEY1
     C           @KEY      CHAINFDTTOTLL             7674
     C*
     C**  DATA BASE ERROR
     C           *IN76     IFEQ '1'                        B1
     C                     MOVEL@KEY      DBKEY            ***************
     C                     MOVEL'FDTTOTLL'DBFILE           * DB ERROR 011*
     C                     MOVE '011'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #ZD9                       *1
     C                     END                             E1
     C*
     C** IF RECORD LOCKED SEND MESSAGE AND RELEASE MAIN UPDATE RECORD
     C           *IN74     IFEQ '1'                        B1
     C                     CALL 'ZA0250'                   *1
     C                     MOVEL'FDM0120' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     ROLBK                           *1
     C                     GOTO #ZD9                       *1
     C                     END                             E1
     C*
     C** NOW UPDATE ALL THE POINTS RECORDS
     C** THE FIRST ONE
     C** RECORD LOCKED
     C           @EXKY     SETLLFDINTULL
     C***********          READ FDINTULL               7877               S01328
     C************IN78     IFEQ '1'                        B1             S01328
     C***********          MOVEL'FDM0120' @MSGID           *1             S01328
     C***********          CALL 'ZA0250'                   *1             S01328
     C***********          CALL 'ZA0240'                   *1             S01328
     C***********          PARM           @MSGID           *1             S01328
     C***********          ROLBK                           *1             S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***DATA*BASE*ERROR***********************************************   S01328
     C************IN77     IFEQ '1'                        B1             S01328
     C***********          MOVEL'FDINTULL'DBFILE           ***************S01328
     C***********          MOVE '012'     DBASE            * DB ERROR 012*S01328
     C***********          MOVE DDCCY     DBKEY            ***************S01328
     C***********          MOVE '1'       *INU7            *1             S01328
     C***********          MOVE '1'       *INU8            *1             S01328
     C***********          EXSR *PSSR                      *1      S01194 S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***RECORD*HAS*BEEN*UPDATED*AND*NOT*BEING*INSERTED****************   S01328
     C***********DDACTN    IFNE 'I'                        B1             S01328
     C***********@XDLUP    IFNE HWDLUP                     B*2            S01328
     C***********@XMLUP    ORNE HWMLUP                     **2            S01328
     C***********@XYLUP    ORNE HWYLUP                     **2            S01328
     C***********@XTLUP    ORNE HWTLUP                     **2            S01328
     C***********          CALL 'ZA0250'                   **2            S01328
     C***********          MOVEL'FDM0139' @MSGID           **2            S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE 'Y'       @UPDWS           **2            S01328
     C***********          ROLBK                           **2            S01328
     C***********          GOTO #ZD9                       **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***IF*THE*ACTION*CODE IS I THEN CHECK THAT THE LAST CHANGE WAS      S01328
     C***A*DELETE**********                                               S01328
     C***********DDACTN    IFEQ 'I'                        B1             S01328
     C***********HWCHTP    ANDNE'D'                        *1             S01328
     C***********          MOVEL'FDM0139' @MSGID           *1             S01328
     C***********          CALL 'ZA0240'                   *1             S01328
     C***********          PARM           @MSGID           *1             S01328
     C***********          MOVE 'Y'       @UPDWS           *1             S01328
     C***********          ROLBK                           *1             S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***SET*UP*COMMON FIELDS                                             S01328
     C***********          MOVE 'HW'      HWRCID                          S01328
     C***********DDACTN    IFEQ 'D'                        B1             S01328
     C***********          MOVE '*'       HWDLTF           *1             S01328
     C***********          ELSE                            X1             S01328
     C***********          MOVE *BLANK    HWDLTF           *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVEL@USER     HWLUID                          S01328
     C***********          MOVE DDACTN    HWCHTP                          S01328
     C*****                Z-ADDRUND      HWLCD                           S01194
     C***********          Z-ADDBJRDNB    HWLCD                    S01194 S01328
     C***********          Z-ADD@DD       HWDLUP                          S01328
     C***********          MOVE @MMM      HWMLUP                          S01328
     C***********          Z-ADD@YY       HWYLUP                          S01328
     C***********          Z-ADD@01LR     HWLDRT                          S01328
     C***********          Z-ADD@01BR     HWBRRT                          S01328
     C***********          Z-ADD@MDATE    HWCHGD                          S01328
     C***********          MOVE DDPDX1    HWPRDX                          S01328
     C***********          MOVE DDCCY     HWCCY                           S01328
     C***********DDACTN    IFEQ 'I'                        B1             S01328
     C***********                                                         S01328
     C***Load*fields*required*by*MM1003*for*period*date*calculation****   S01328
     C***********          MOVELHWCCY     @@CCY   3        *1             S01328
     C***********          MOVELMSPD      @@SPOT           *1             S01328
     C*****                Z-ADD@PRD,1    @@PNUM  10       *1             S01328
     C***********          Z-ADD@PRD,1    @@PNUM  20       *1             S01328
     C***********          MOVELHWTPRD    @@PTYP  1        *1             S01328
     C***********                                                         S01328
     C***********          EXSR MM1003                     *1             S01328
     C***********                                                         S01328
     C***********          Z-ADD@@PDAT    HWPRDD           *1             S01328
     C***********                                                         S01328
     C***********          END                             E1             S01328
     C***********          TIME           HWTLUP                          S01328
     C***********          UPDATFDINTUP0                                  S01328
     C***********          Z-ADDHWTLUP    @XTIME  60                      S01328
     C***********                                                         S01328
     C***SEND*SECOND*RECORD********************************************   S01328
     C***********          READ FDINTULL               7877               S01328
     C************IN78     IFEQ '1'                        B1             S01328
     C***********          MOVEL'FDM0120' @MSGID           *1             S01328
     C***********          CALL 'ZA0250'                   *1             S01328
     C***********          CALL 'ZA0240'                   *1             S01328
     C***********          PARM           @MSGID           *1             S01328
     C***********          ROLBK                           *1             S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***DATA*BASE*ERROR***********************************************   S01328
     C************IN77     IFEQ '1'                        B1             S01328
     C***********          MOVEL'FDINTRLL'DBFILE           ***************S01328
     C***********          MOVE '013'     DBASE            * DB ERROR 013*S01328
     C***********          MOVE DDCCY     DBKEY            ***************S01328
     C***********          MOVE '1'       *INU7            *1             S01328
     C***********          MOVE '1'       *INU8            *1             S01328
     C***********          EXSR *PSSR                      *1      S01194 S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***RECORD*HAS*BEEN*UPDATED*BUT*NO*CHECK*FOR*INSERT***************   S01328
     C***********DDACTN    IFNE 'I'                        B1             S01328
     C***********@XDLUP    IFNE HWDLUP                     B*2            S01328
     C***********@XMLUP    ORNE HWMLUP                     **2            S01328
     C***********@XYLUP    ORNE HWYLUP                     **2            S01328
     C***********@XTLUP    ORNE HWTLUP                     **2            S01328
     C***********          CALL 'ZA0250'                   **2            S01328
     C***********          MOVEL'FDM0139' @MSGID           **2            S01328
     C***********          CALL 'ZA0240'                   **2            S01328
     C***********          PARM           @MSGID           **2            S01328
     C***********          MOVE 'Y'       @UPDWS           **2            S01328
     C***********          ROLBK                           **2            S01328
     C***********          GOTO #ZD9                       **2            S01328
     C***********          END                             E*2            S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***IF*THE*ACTION*CODE*IS*I*THEN*CHECK*THAT*THE*LAST*CHANGE*WAS***   S01328
     C***A*DELETE******************************************************   S01328
     C***********DDACTN    IFEQ 'I'                        B1             S01328
     C***********HWCHTP    ANDNE'D'                        *1             S01328
     C***********          MOVEL'FDM0139' @MSGID           *1             S01328
     C***********          CALL 'ZA0240'                   *1             S01328
     C***********          PARM           @MSGID           *1             S01328
     C***********          MOVE 'Y'       @UPDWS           *1             S01328
     C***********          ROLBK                           *1             S01328
     C***********          GOTO #ZD9                       *1             S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***SET*UP*COMMON*FIELDS******************************************   S01328
     C***********          MOVE 'HW'      HWRCID                          S01328
     C***********DDACTN    IFEQ 'D'                        B1             S01328
     C***********          MOVE '*'       HWDLTF           *1             S01328
     C***********          ELSE                            X1             S01328
     C***********          MOVE *BLANK    HWDLTF           *1             S01328
     C***********          END                             E1             S01328
     C***********          MOVEL@USER     HWLUID                          S01328
     C***********          MOVE DDACTN    HWCHTP                          S01328
     C*****                Z-ADDRUND      HWLCD                           S01194
     C***********          Z-ADDBJRDNB    HWLCD                    S01194 S01328
     C***********          Z-ADD@DD       HWDLUP                          S01328
     C***********          MOVE @MMM      HWMLUP                          S01328
     C***********          Z-ADD@YY       HWYLUP                          S01328
     C***********          Z-ADD@02LR     HWLDRT                          S01328
     C***********          Z-ADD@02BR     HWBRRT                          S01328
     C***********          Z-ADD@MDATE    HWCHGD                          S01328
     C***********          MOVE DDPDX2    HWPRDX                          S01328
     C***********          MOVE DDCCY     HWCCY                           S01328
     C***********                                                         S01328
     C***WORK*OUT*PERIOD*DATE******************************************   S01328
     C***********DDACTN    IFEQ 'I'                        B1             S01328
     C***********                                                         S01328
     C***Load*fields*required*by MM1003 for period date calculation       S01328
     C***********          MOVELHWCCY     @@CCY            *1             S01328
     C***********          MOVELMSPD      @@SPOT           *1             S01328
     C***********          Z-ADD@PRD,2    @@PNUM           *1             S01328
     C***********          MOVELHWTPRD    @@PTYP           *1             S01328
     C***********                                          *1             S01328
     C***********          EXSR MM1003                     *1             S01328
     C***********                                                         S01328
     C***********          Z-ADD@@PDAT    HWPRDD           *1             S01328
     C***********                                                         S01328
     C***********          END                             E1             S01328
     C***********                                                         S01328
     C***********          Z-ADD@XTIME    HWTLUP                          S01328
     C***********          UPDATFDINTUP0                                  S01328
     C                     TIME           @XTIME  60                      S01328
     C*
     C** LOOP UNTIL ALL RECORDS HAVE BEEN UPDATED
     C           1         DO   @CNT      @RRN1            B1
     C*
     C** GET SUBFILE RECORD
     C           @RRN1     CHAINFD0550S5             78    *1
     C*
     C** SET INDEX
     C***********@RRN1     ADD  2         @X               *1             S01328
     C                     Z-ADD@RRN1     @X               *1             S01328
     C                     Z-ADD@RRN1     @P               *1
     C*
     C** SEND ALL OTHER RECORDS
     C                     READ FDINTULL               7877*1
     C           *IN78     IFEQ '1'                        B*2
     C                     MOVEL'FDM0120' @MSGID           **2
     C                     CALL 'ZA0250'                   **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     ROLBK                           **2
     C                     GOTO #ZD9                       **2
     C                     END                             E*2
     C*
     C** DATA BASE ERROR
     C           *IN77     IFEQ '1'                        B*2
     C                     MOVEL'FDINTULL'DBFILE           ***************
     C                     MOVE '014'     DBASE            * DB ERROR 014*
     C                     MOVE DDCCY     DBKEY            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #ZD9                       **2
     C                     END                             E*2
     C*
     C** RECORD HAS BEEN UPDATED, BUT NO CHECKING FOR INSERTS
     C           DDACTN    IFNE 'I'                        B*2
     C           @XDLUP    IFNE HWDLUP                     B**3
     C           @XMLUP    ORNE HWMLUP                     ***3
     C           @XYLUP    ORNE HWYLUP                     ***3
     C           @XTLUP    ORNE HWTLUP                     ***3
     C                     CALL 'ZA0250'                   ***3
     C                     MOVEL'FDM0139' @MSGID           ***3
     C                     CALL 'ZA0240'                   ***3
     C                     PARM           @MSGID           ***3
     C                     MOVE 'Y'       @UPDWS           ***3
     C                     ROLBK                           ***3
     C                     GOTO #ZD9                       ***3
     C                     END                             E**3
     C                     END                             E*2
     C*
     C** IF THE ACTION CODE IS I THEN CHECK THAT THE LAST CHANGE WAS
     C** A DELETE
     C           DDACTN    IFEQ 'I'                        B*2
     C           HWCHTP    ANDNE'D'                        **2
     C                     MOVEL'FDM0139' @MSGID           **2
     C                     CALL 'ZA0240'                   **2
     C                     PARM           @MSGID           **2
     C                     MOVE 'Y'       @UPDWS           **2
     C                     ROLBK                           **2
     C                     GOTO #ZD9                       **2
     C                     END                             E*2
     C*
     C** SET UP COMMON FIELDS
     C                     MOVE 'HW'      HWRCID           *1
     C           DDACTN    IFEQ 'D'                        B*2
     C                     MOVE '*'       HWDLTF           **2
     C                     ELSE                            X*2
     C                     MOVE *BLANK    HWDLTF           **2
     C                     END                             E*2
     C*********************MOVEL@USER     HWLUID           *1             S01117
     C                     MOVEL@USER     HWLUSI           *1             S01117
     C                     MOVE DDACTN    HWCHTP           *1
     C*****T***************Z-ADDRUND      HWLCD            *1             S01194
     C                     Z-ADDBJRDNB    HWLCD            *1             S01194
     C                     Z-ADD@DD       HWDLUP           *1
     C                     MOVE @MMM      HWMLUP           *1
     C                     Z-ADD@YY       HWYLUP           *1
     C           DDACTN    IFNE 'D'                                       S01328
     C                     Z-ADD@LR,@P    HWLDRT           *1
     C                     Z-ADD@BR,@P    HWBRRT           *1
     C                     END                                            S01328
     C                     Z-ADD@MDATE    HWCHGD           *1
     C                     MOVE DDPDX3    HWPRDX           *1
     C                     MOVE DDCCY     HWCCY            *1
     C           DDACTN    IFEQ 'I'                        B*2
     C*********************MOVELHWCCY     @@CCY            **2            S01195
     C*********************MOVELMSPD      @@SPOT           **2            S01194
     C                     MOVELHWCCY     ZCCY             **2            S01195
     C                     MOVELA6MMSD    @@SPOT           **2            S01194
     C                     Z-ADD@PRD,@X   @@PNUM           **2
     C                     MOVELHWTPRD    @@PTYP           **2
     C*
     C                     EXSR MM1003                     **2
     C*
     C                     Z-ADD@@PDAT    HWPRDD           *1
     C                     MOVE @@PRDN    HWPRDN           **2            S01328
     C*
     C                     END                             E*2
     C                     Z-ADD@XTIME    HWTLUP           *1
     C                     UPDATFDINTUP0                   *1
     C                     END                             E1
     C           DDACTN    IFEQ 'A'
     C***********          ADD  12        NAMD                            S01328
     C                     ADD  21        NAMD                            S01328
     C                     END
     C           DDACTN    IFEQ 'D'
     C***********          ADD  12        NDEL                            S01328
     C                     ADD  21        NDEL                            S01328
     C                     END
     C           DDACTN    IFEQ 'I'
     C***********          ADD  12        NINS                            S01328
     C                     ADD  21        NINS                            S01328
     C                     END
     C                     UPDATTABLETXF
     C*********************                                               S01328
     C***GET*HEADER*RECORD*FOR UPDATE                                     S01328
     C*********************MOVE *BLANKS   @KEY                            S01328
     C*********************MOVE '20'      @KEY1                           S01328
     C***********@KEY******CHAINFDTTOTLL             7674                 S01328
     C*********************                                               S01328
     C****DATA*BASE*ERROR**                                               S01328
     C************IN76*****IFEQ '1'                        B1             S01328
     C*********************MOVEL@KEY      DBKEY            ***************S01328
     C*********************MOVEL'FDTTOTLL'DBFILE           * DB ERROR 015*S01328
     C*********************MOVE '015'     DBASE            ***************S01328
     C*********************MOVE '1'       *INU7            *1             S01328
     C*********************MOVE '1'       *INU8            *1             S01328
     C*********************EXSR *PSSR                      *1             S01194
     C*********************GOTO #ZD9                       *1             S01328
     C*********************END                             E1             S01328
     C*********************                                               S01328
     C***IF*RECORD*LOCKED*SEND MESSAGE AND RELEASE MAIN UPDATE RECORD     S01328
     C************IN74*****IFEQ '1'                        B1             S01328
     C*********************CALL 'ZA0250'                   *1             S01328
     C*********************MOVEL'FDM0120' @MSGID           *1             S01328
     C*********************CALL 'ZA0240'                   *1             S01328
     C*********************PARM           @MSGID           *1             S01328
     C*********************ROLBK                           *1             S01328
     C*********************GOTO #ZD9                       *1             S01328
     C*********************END                             E1             S01328
     C*********************                                               S01328
     C***UPDATE*LAST*TRANSACTION NUMBER                                   S01328
     C*********************EXSR ZTNLU1                                    S01328
     C*********************                                               S01328
     C***NOW*UPDATE*HEADER*                                               S01328
     C*********************ADD  1         NAMD                            S01328
     C*********************UPDATTABLETXF                                  S01328
     C*                                                                   FM1100
     C****IF*DRS*IS*PRESENT*****************************************E21137S01319
     C****MOVE*STANDARD*DATA*TO*CMSDULL*****************************FM1100S01319
     C***********BGDRCM****IFEQ*'Y'*********************************E21137S01319
     C*********************MOVE*'BC'******SURCID********************FM1100S01319
     C*********************MOVE*'FD'******SUMOID********************FM1100S01319
     C*********************MOVE*'HW'******SUFIID********************FM1100S01319
     C*********************MOVE*'449'*****SULREC********************FM1100S01319
     C*********************MOVE*HWCHTP****SUACTC********************FM1100S01319
     C**************************************************************FM1100S01319
     C****MOVE*RECORD*I.D.*AND*CURRENCY*CODE*TO*@SUS****************FM1100S01319
     C*********************MOVE*'HW'******@WRCID********************FM1100S01319
     C*********************MOVE*DDCCY*****@WCCY*********************FM1100S01319
     C*********************END**************************************E21137S01319
     C*                                                                   FM1100
     C**  SET POINTER TO RECORD IN FDINTRLL,ENSURE CURRENCY               FM1100
     C**  IS THAT ENTERED ON SCREEN FOR COMPARE                           FM1100
     C                     MOVE DDCCY     @CCY                            FM1100
     C           DDCCY     SETLLFDINTRLL                                  FM1100
     C*                                                                   FM1100
     C**  READ RECORD ON FDINTRLL                                         FM1100
     C           DDCCY     READEFDINTRLL                 57               FM1100
     C*                                                                   FM1100
     C**  SET ARRAY USED TO HOLD DATA TO BLANK AND ZERO                   FM1100
     C           2         OCUR @INTL2                                    FM1100
     C                     MOVEA@INTL2    @A,1                            FM1100
     C*                                                                   FM1100
     C**  RESET @1X TO ZERO                                               FM1100
     C                     Z-ADD0         @1X                             FM1100
     C           1         OCUR @INTL2                                    FM1100
     C*                                                                   FM1100
     C**  MOVE CURRENCY CODE TO @INTL2                                    FM1100
     C                     MOVE HWCCY     @CCY                            FM1100
     C*                                                                   FM1100
     C**  DO UNTIL THE ARRAY IS FULL OR THERE IS NO CHANGE                FM1100
     C**  IN CURRENCY                                                     FM1100
     C           @1X       DOWNE12                         B1             FM1100
     C           DDCCY     ANDEQ@CCY                       *1             FM1100
     C*                                                                   FM1100
     C**  MOVE THE FIELDS TO DATA STRUCTURE @INTL2                        FM1100
     C                     MOVELHWPRDD    @WPD             *1             FM1100
     C                     MOVELHWPRD     @WPR             *1             FM1100
     C                     MOVELHWTPRD    @WTP             *1             FM1100
     C                     MOVELHWPRDX    @WPX             *1             FM1100
     C                     MOVELHWBRRT    @WBR             *1             FM1100
     C                     MOVELHWLDRT    @WLD             *1             FM1100
     C**  MOVE THE DATA STRUCTURE TO THE CORRESPONDING                    FM1100
     C**  ELEMENT OF ARRAY @A                                             FM1100
     C                     ADD  1         @1X     20       *1             FM1100
     C*                                                                   FM1100
     C                     MOVE @INTL2    @A,@1X           *1             FM1100
     C*                                                                   FM1100
     C**  READ THE NEXT RECORD ON THE FILE                                FM1100
     C           DDCCY     READEFDINTRLL                 57*1             FM1100
     C*                                                                   FM1100
     C                     END                             E1             FM1100
     C*                                                                   FM1100
     C****MOVE*@SUS*AND*BORROW/LEND*RATES*TO*ARRAY*ELEMENT**********FM1100S01319
     C*********************MOVE*@SUS******@S,1**********************FM1100S01319
     C*********************MOVEA@A********@S,2*********************FM1100*S01319
     C**************************************************************FM1100S01319
     C****IF*DRS*IS*PRESENT*****************************************E21137S01319
     C****MOVE*THE*ARRAY*TO*CMSDUPP*********************************FM1100S01319
     C***********BGDRCM****IFEQ*'Y'*********************************E21137S01319
     C*********************MOVEA@S********SUSDUD********************FM1100S01319
     C**************************************************************FM1100S01319
     C****WRITE*THE*RECORD*TO*CMSDUPP*******************************FM1100S01319
     C*********************WRITECMSDUP0*****************************FM1100S01319
     C*********************END**************************************E21137S01319
     C*                                                                   FM1100
     C**  RESET @1XTO ZERO                                                FM1100
     C                     Z-ADD0         @1X              *1             FM1100
     C*
     C           CMTTXT    COMIT
     C*
     C           #ZD9      ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZE  - THIS SUBROUTINE IS USED TO WRITE NEW RECORDS TO THE MAIN
     C*        FILE                                                   *
     C*                                                               *
     C* CALLED BY : #BD                                               *
     C*                                                               *
     C* CALLS :     ZA0270                                            *
     C*             ZA0240                                           *
     C*             ZA0250                                           *
     C*             MM1003                                           *
     C*             ZTNLU1                                           *
     C*                                                               *
     C* USES :      @CCYX  - CURRENCY FOR CMTTXT                      *
     C*             @CNT   - NUMBER OF RECORDS IN POINTS SFILE        *
     C*             @MDATE - 6,0 DATE                                 *
     C*             @LR    - ARRAY OF HIPOINTS                        *
     C**************@KEY***-*KEY FOR ACCESSING FDTTOTLL,FDCCYTLL      *   S01194
     C*             @KEY   - KEY FOR ACCESSING FDTTOTLL               *   S01194
     C*             @BR    - ARRAY OF LOW POINTS                      *
     C*             @MSGID - MESSAGE ID FOR ZA0240 TO SEND            *
     C*             @MTH   - ARRAY HOLDING THE MONTH SHORTNAMES       *
     C*             @P     - ARRAY INDEX                              *
     C*             @PRD   - ARRAY OF PERIODS                         *
     C*             @PTP   - ARRAY OF PERIOD TYPES                    *
     C*             @RRN1  - REL REC NO OF POINTS SFILE               *
     C**************@SCRKY*- KEY FOR FDCCYTLL                         *   S01194
     C*             @USER  - USER ID                                  *
     C*             @X     - ARRAY INDEX                              *
     C**************@01LR  - FIRST LEND POINT                         *   S01328
     C**************@01BR  - FIRST BORROW POINT                       *   S01328
     C**************@02LR  - SECOND LEND POINT                        *   S01328
     C**************@02BR  - SECOND BORROW POINT                      *   S01328
     C*             @@SPDD  SPOT DATE     FORMAT(8N)                  *
     C**************@@CCY1  CURRENCY 1    FORMAT(3A)                  *   S01117
     C*             @@PDAT  SPOT DATE RETURNED FORMAT(8N)             *
     C*             @@ESWT  SWITCH SET IF ERROR OCCURS  FORMAT(1A)    *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZE       BEGSR
     C*
     C***GET*UPDATE*RECORD*                                               S01194
     C***********@SCRKY****CHAINFDCCYTLL             6874                 S01194
     C*EJECT***************                                               S01194
     C***IF**IN74*IS*ON*THEN THE RECORD IS LOCKED                         S01194
     C************IN74*****IFEQ '1'                        B1             S01194
     C*********************CALL 'ZA0250'                   *1             S01194
     C*********************MOVEL'FDM0120' @MSGID           *1             S01194
     C*********************CALL 'ZA0240'                   *1             S01194
     C*********************PARM           @MSGID           *1             S01194
     C*********************GOTO #ZE9                       *1             S01194
     C*********************END                             E1             S01194
     C*
     C** GET HEADER RECORD FOR UPDATE
     C                     MOVE *BLANKS   @KEY
     C                     MOVE 'HW'      @KEY1
     C           @KEY      CHAINFDTTOTLL             7674
     C*
     C**  DATA BASE ERROR
     C           *IN76     IFEQ '1'                        B1
     C                     MOVEL@KEY      DBKEY            ***************
     C                     MOVEL'FDTTOTLL'DBFILE           * DB ERROR 016*
     C                     MOVE '016'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     ROLBK                           *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #ZE9                       *1
     C                     END                             E1
     C*
     C** IF RECORD LOCKED SEND MESSAGE AND RELEASE MAIN UPDATE RECORD
     C           *IN74     IFEQ '1'                        B1
     C                     CALL 'ZA0250'                   *1
     C                     MOVEL'FDM0120' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     ROLBK                           *1
     C                     GOTO #ZE9                       *1
     C                     END                             E1
     C*
     C** SET UP COMMON FIELDS
     C                     MOVE 'HW'      HWRCID
     C           DDACTN    IFEQ 'D'                        B1
     C                     MOVE '*'       HWDLTF           *1
     C                     ELSE                            X1
     C                     MOVE *BLANK    HWDLTF           *1
     C                     END                             E1
     C*********************MOVEL@USER     HWLUID                          S01117
     C                     MOVEL@USER     HWLUSI                          S01117
     C                     MOVE DDACTN    HWCHTP
     C******               Z-ADDRUND      HWLCD                           S01194
     C                     Z-ADDBJRDNB    HWLCD                           S01194
     C                     Z-ADD@DD       HWDLUP
     C                     MOVE @MMM      HWMLUP
     C                     Z-ADD@YY       HWYLUP
     C                     TIME           HWTLUP
     C***********          Z-ADD01        HWPRD                           S01328
     C***********          Z-ADD@01LR     HWLDRT                          S01328
     C***********          Z-ADD@01BR     HWBRRT                          S01328
     C                     Z-ADD@MDATE    HWCHGD
     C***********          MOVE @PTP,1    HWTPRD                          S01328
     C***********          MOVE DDPDX1    HWPRDX                          S01328
     C***********          MOVE DDCCY     HWCCY                           S01328
     C*
     C***Load*fields*required by MM1003 for period date calculation       S01328
     C***********          MOVELHWCCY     @@CCY                           S01328
     C***********          MOVELMSPD      @@SPOT                          S01328
     C***********          Z-ADD@PRD,1    @@PNUM                          S01328
     C***********          MOVELHWTPRD    @@PTYP                          S01328
     C*
     C***********          EXSR MM1003                                    S01328
     C*
     C***********          Z-ADD@@PDAT    HWPRDD                          S01328
     C*
     C***********          WRITEFDINTUP0                                  S01328
     C*
     C***********          Z-ADD02        HWPRD                           S01328
     C***********          Z-ADD@02LR     HWLDRT                          S01328
     C***********          Z-ADD@02BR     HWBRRT                          S01328
     C***********          MOVE @PTP,2    HWTPRD                          S01328
     C***********          MOVE DDPDX2    HWPRDX                          S01328
     C***********          MOVE DDCCY     HWCCY                           S01328
     C*
     C** WORK OUT PERIOD DATE
     C***********          MOVELHWCCY     @@CCY            *1             S01328
     C***********          MOVELMSPD      @@SPOT           *1             S01328
     C***********          Z-ADD@PRD,2    @@PNUM           *1             S01328
     C***********          MOVELHWTPRD    @@PTYP           *1             S01328
     C*
     C***********          EXSR MM1003                                    S01328
     C*
     C***********          Z-ADD@@PDAT    HWPRDD                          S01328
     C*
     C***********          WRITEFDINTUP0                                  S01328
     C*
     C** LOOP UNTIL ALL RECORDS HAVE BEEN UPDATED
     C           1         DO   @CNT      @RRN1            B1
     C*
     C** GET SUBFILE RECORD
     C           @RRN1     CHAINFD0550S5             78    *1
     C*
     C** SET INDEX
     C***********@RRN1     ADD  2         @X               *1             S01328
     C                     Z-ADD@RRN1     @X               *1             S01328
     C                     Z-ADD@RRN1     @P               *1
     C*
     C* IF PROCESSING FIRST 2 PERIODS SET PERIOD NUMBER EQUAL TO COUNTER  S01328
     C*                                                                   S01328
     C           @X        IFLE 2                                         S01328
     C                     Z-ADD@X        HWPRD                           S01328
     C                     ELSE                                           S01328
     C                     Z-ADD@PRD,@X   HWPRD            *1
     C                     END                                            S01328
     C                     Z-ADD@LR,@P    HWLDRT           *1
     C                     Z-ADD@BR,@P    HWBRRT           *1
     C                     MOVE @PTP,@X   HWTPRD           *1
     C                     MOVE DDPDX3    HWPRDX           *1
     C                     MOVE DDCCY     HWCCY            *1
     C*
     C** ZERO DAYS FOR SPOT/NEXT
     C           @X        IFEQ 3                          B*2
     C*                    Z-ADD1         @TIM             **2
     C                     Z-ADD03        HWPRD            **2
     C                     END                             E*2
     C*
     C*********************MOVELHWCCY     @@CCY            *1             S01195
     C*********************MOVELMSPD      @@SPOT           *1             S01194
     C                     MOVELHWCCY     ZCCY             *1             S01195
     C                     MOVELA6MMSD    @@SPOT           *1             S01194
     C                     Z-ADD@PRD,@X   @@PNUM           *1
     C                     MOVELHWTPRD    @@PTYP           *1
     C*                                                    *1
     C                     EXSR MM1003                     *1
     C*
     C                     Z-ADD@@PDAT    HWPRDD           *1
     C                     MOVE @@PRDN    HWPRDN           **2            S01328
     C*
     C                     MOVEASTAMP,1   HXTMST           Default Timestamp                  CPK015
     C                     MOVEASTAMP,1   HWBOTM           Default Timestamp                  CPK015
     C                     MOVEASTAMP,1   HWLETM           Default Timestamp                  CPK015
     C                     WRITEFDINTUP0                   *1
     C*
     C                     END                             E1
     C*
     C***********          ADD  12        NINS                            S01328
     C                     ADD  21        NINS                            S01328
     C                     UPDATTABLETXF
     C*
     C** GET HEADER RECORD FOR UPDATE
     C                     MOVE *BLANKS   @KEY
     C                     MOVE '20'      @KEY1
     C           @KEY      CHAINFDTTOTLL             7674
     C*
     C**  DATA BASE ERROR
     C           *IN76     IFEQ '1'                        B1
     C                     MOVEL@KEY      DBKEY            ***************
     C                     MOVEL'FDTTOTLL'DBFILE           * DB ERROR 017*
     C                     MOVE '017'     DBASE            ***************
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     ROLBK                           *1
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #ZE9                       *1
     C                     END                             E1
     C*
     C** IF RECORD LOCKED SEND MESSAGE AND RELEASE MAIN UPDATE RECORD
     C           *IN74     IFEQ '1'                        B1
     C                     CALL 'ZA0250'                   *1
     C                     MOVEL'FDM0120' @MSGID           *1
     C                     CALL 'ZA0240'                   *1
     C                     PARM           @MSGID           *1
     C                     ROLBK                           *1
     C                     GOTO #ZE9                       *1
     C                     END                             E1
     C*
     C** UPDATE LAST TRANSACTION NUMBER
     C                     EXSR ZTNLU1
     C*
     C** NOW UPDATE HEADER
     C                     ADD  1         NAMD
     C                     UPDATTABLETXF
     C*
     C****IF*DRS*IS*PRESENT*****************************************E21137S01319
     C****MOVE*STANDARD*DATA*TO*CMSDULL*****************************FM1100S01319
     C***********BGDRCM****IFEQ*'Y'*********************************E21137S01319
     C*********************MOVE*'BC'******SURCID********************FM1100S01319
     C*********************MOVE*'FD'******SUMOID********************FM1100S01319
     C*********************MOVE*'HW'******SUFIID********************FM1100S01319
     C*********************MOVE*'449'*****SULREC********************FM1100S01319
     C*********************MOVE*HWCHTP****SUACTC********************FM1100S01319
     C**************************************************************FM1100S01319
     C****MOVE*RECORD*I.D.*AND*CURRENCY*CODE*TO*@SUS****************FM1100S01319
     C*********************MOVE*'HW'******@WRCID********************FM1100S01319
     C*********************MOVE*DDCCY*****@WCCY*********************FM1100S01319
     C*********************END**************************************E21137S01319
     C**************************************************************FM1100S01319
     C**  SET POINTER TO RECORD IN FDINTRLL,ENSURE CURRENCY               FM1100
     C**  IS THAT ENTERED ON SCREEN FOR COMPARE                           FM1100
     C                     MOVE DDCCY     @CCY                            FM1100
     C           DDCCY     SETLLFDINTRLL
     C*                                                                   FM1100
     C**  READ RECORDS ON FDINTRLL                                        FM1100
     C           DDCCY     READEFDINTRLL                 57               FM1100
     C*                                                                   FM1100
     C**  SET ARRAY USED TO HOLD DATA TO BLANK AND ZERO                   FM1100
     C           2         OCUR @INTL2                                    FM1100
     C                     MOVEA@INTL2    @A,1                            FM1100
     C*                                                                   FM1100
     C**  RESET @1X TO ZERO                                               FM1100
     C                     Z-ADD0         @1X                             FM1100
     C           1         OCUR @INTL2                                    FM1100
     C*                                                                   FM1100
     C**  MOVE CURRENCY CODE TO @INTL2                                    FM1100
     C                     MOVE HWCCY     @CCY                            FM1100
     C*                                                                   FM1100
     C**  DO UNTIL ARRAY @A IS FULL OR THERE IS NO                        FM1100
     C**  CHANGE IN CURRENCY                                              FM1100
     C           @1X       DOWNE12                         B1             FM1100
     C           DDCCY     ANDEQ@CCY                       *1             FM1100
     C*                                                                   FM1100
     C**  MOVE THE FIELDS TO DATA STRUCTURE @INTL2                        FM1100
     C                     MOVELHWPRDD    @WPD             *1             FM1100
     C                     MOVELHWPRD     @WPR             *1             FM1100
     C                     MOVELHWTPRD    @WTP             *1             FM1100
     C                     MOVELHWPRDX    @WPX             *1             FM1100
     C                     MOVELHWBRRT    @WBR             *1             FM1100
     C                     MOVELHWLDRT    @WLD             *1             FM1100
     C**  MOVE THE DATA STRUCTURE TO THE CORRESPONDING                    FM1100
     C**  ELEMENT OF ARRAY @A                                             FM1100
     C                     ADD  1         @1X     20       *1             FM1100
     C*                                                                   FM1100
     C                     MOVE @INTL2    @A,@1X           **2            FM1100
     C*                                                                   FM1100
     C*                                                                   FM1100
     C**  READ THE NEXT RECORD ON THE FILE                                FM1100
     C           DDCCY     READEFDINTRLL                 57*1             FM1100
     C*                                                                   FM1100
     C                     END                             E1             FM1100
     C*                                                                   FM1100
     C****MOVE*@SUS*AND*BORROW/LEND*RATES*TO*ARRAY*ELEMENT**********FM1100S01319
     C*********************MOVE*@SUS******@S,1**********************FM1100S01319
     C*********************MOVEA@A********@S,2**********************FM1100S01319
     C**************************************************************FM1100S01319
     C****IF*DRS*IS*PRESENT*****************************************E21137S01319
     C****MOVE*THE*ARRAY*TO*CMSDUPP*********************************FM1100S01319
     C***********BGDRCM****IFEQ*'Y'*********************************E21137S01319
     C*********************MOVEA@S********SUSDUD********************FM1100S01319
     C********************************************************************S01319
     C****WRITE*THE*RECORD*TO*CMSDUPP*******************************FM1100S01319
     C*********************WRITECMSDUP0*****************************FM1100S01319
     C*********************END**************************************E21137S01319
     C*                                                                   FM1100
     C**  RESET @1XTO ZERO                                                FM1100
     C                     Z-ADD0         @1X              *1             FM1100
     C*
     C           CMTTXT    COMIT
     C*
     C           #ZE9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*   MM1003 - CALCULATE A PERIOD DATE                            *
     C*                                                               *
     C*   PERIOD DATES ARE CALCULATED FOR THE FOLLOWING PERIODS       *
     C*      PERIOD TYPE       PERIOD NUMBER     PERIOD SHORTNAME     *
     C*           D                 -1             OVERNIGHT          *
     C*           D                  0             TOMORROW / NEXT    *
     C*           D                  1             SPOT / NEXT        *
     C*           W                  1             1 WEEK             *
     C*           W                  2             2 WEEK             *
     C*           W                  3             3 WEEK             *
     C*           M                  1             1 MONTH            *
     C*           M                  2             2 MONTH            *
     C*           M                  3             3 MONTH            *
     C*           M                  6             6 MONTH            *
     C*           M                  9             9 MONTH            *
     C*           Y                  1             1 YEAR             *
     C*           Y                  2             2 YEARS            *   S01328
     C*           Y                  3             3 YEARS            *   S01328
     C*           Y                  4             4 YEARS            *   S01328
     C*           Y                  5             5 YEARS            *   S01328
     C*           Y                  6             6 YEARS            *   S01328
     C*           Y                  7             7 YEARS            *   S01328
     C*           Y                  8             8 YEARS            *   S01328
     C*           Y                  9             9 YEARS            *   S01328
     C*           Y                 10            10 YEARS            *   S01328
     C*                                                               *
     C*  CALLED BY    -                                               *
     C*                                                               *
     C*  CALLS        -                                               *
     C*                                                               *
     C*  ZA0770       - CONVERT DATE YYYYMMDD TO DDMMYY               *
     C***ZA0830       - CHECK IF DAY IS A WORKING DAY                 *   S01195
     C***ZA0730       - FIND NEXT WORKING DAY                         *   S01195
     C*  ZA073C       - FIND NEXT WORKING DAY                         *   S01195
     C*  ZCKHK        - CHECK IF DAY IS A WORKING DAY                 *   S01195
     C***ZA0710*******- CONVERT MIDAS DAY NO TO YYYYMMDD              *   S01328
     C***ZA0680*******- CONVERT DATE TO MIDAS DAY NUMBER              *   S01328
     C*  ZDATE9       - CONVERT MIDAS DAY NO TO YYYYMMDD              *   S01328
     C*  ZDAT10       - CONVERT DATE TO MIDAS DAY NUMBER              *   S01328
     C*                                                               *
     C*  CALLS PROGRAM ZA0270 CONVERT DATE TO MIDAS DAY NUMBER WITH   *
     C*                VALIDATION CHECK                               *
     C*                                                               *
     C*  FIELDS INPUT -                                               *
     C*                                                               *
     C***@@CCY***3**  - CURRENCY                                      *   S01117
     C*  ZCCY    3    - CURRENCY                                      *   S01117
     C*  @@SPOT  8,0  - MONEY MARKET SPOT DATE                        *
     C***@@PNUM**1,0  - PERIOD NUMBER                                 *   S01328
     C*  @@PNUM  2,0  - PERIOD NUMBER                                 *   S01328
     C*  @@PTYP  1    - PERIOD TYPE                                   *
     C*                                                               *
     C*  FIELDS OUTPUT                                                *
     C*                                                               *
     C*  @@PDAT  8,0  - PERIOD DATE                                   *
     C*  @@PRDN  5,0  - PERIOD DAY NUMBER                             *   S01328
     C*                                                               *
     C*  WORK FIELDS                                                  *
     C*                                                               *
     C*  @@DTIN  8,0  - DATE INPUT TO ZA0770 IN YYYYMMDD FORMAT       *
     C***@@DFMT**1****- DATE FORMAT                                   *   S01328
     C*  @@DATF  1    - DATE FORMAT (M OR D)                          *   S01328
     C*  @@RTNC  1    - RETURN INDICATOR FROM ZA0270                  *
     C*  @@DAYN  5,0  - MIDAS DAY NUMBER                              *
     C*  @@MNO   5,0  - MIDAS DAY NUMBER                              *
     C*  @@HIND  1    - HOLIDAY INDICATOR H OR W                      *
     C*  @@ADD   3,0  - CALCULATION WORK FIELD                        *
     C***@@VDT***8,0**- DATE OUTPUT FROM ZA0710                       *   S01328
     C*  @@VDT   8,0  - DATE OUTPUT FROM ZDATE9                       *   S01328
     C*  @@RUND  8    - RUN DATE IN YYYYMMDD FORMAT                   *
     C*                                                               *
     C*****************************************************************
     C*
     C           MM1003    BEGSR
     C*
     C                     Z-ADD*ZERO     @@STRT
     C                     Z-ADD*ZERO     @@DTIN
     C                     Z-ADD*ZERO     @@SPDD
     C                     Z-ADD*ZERO     @@DATE
     C                     Z-ADD*ZERO     @@DTOU
     C                     Z-ADD*ZERO     @@Z71Y
     C                     Z-ADD*ZERO     @@VDT
     C*
     C                     ADD  @@SPOT    @@SPDD
     C**  SET UP STARTING POINT DATE AS SPOT DATE
     C                     Z-ADD@@SPDD    @@STRT
     C*
     C**  ADD PERIOD NUMBERS TO DATE
     C           @@PTYP    IFEQ 'M'                        B1
     C                     ADD  @@PNUM    @@STMT           *1
     C           @@STMT    IFGT 12                         B*2
     C                     SUB  12        @@STMT           **2
     C                     ADD  1         @@STYR           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C           @@PTYP    IFEQ 'Y'                        B1
     C*****                ADD  1         @@STYR           *1             S01328
     C                     ADD  @@PNUM    @@STYR           *1             S01328
     C                     END                             E1
     C*
     C**  CONVERT DATE FORMAT FROM YYYYMMDD TO DDMMYY
     C                     MOVEL'D'       @@DATF  1                       S01328
     C                     Z-ADD@@STRT    @@DTIN
     C                     EXSR ZA0770
     C                     Z-ADD@@DTOU    @@DATE
     C*
     C*
     C*********************MOVEL'D'       @@DFMT  1                       S01328
     C                     MOVE @@DATE    @@DATC  60
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C           @@RTNC    DOUEQ'0'                        B1
     C                     CALL 'ZA0270'                   *1
     C                     PARM           @@DATC           *1
     C******               PARM           DATF             *1             S01194
     C******               PARM           BJDFIN           *1      S01194 S01328
     C                     PARM           @@DATF           *1             S01328
     C           @@RTNC    PARM           @@RTNC  1        *1
     C           @@DAYN    PARM           @@DAYN  50       *1
     C*
     C                     SUB  1         @@DAY2           *1
     C                     MOVE @@DATE    @@DATC           *1
     C*
     C                     END                             E1
     C*
     C****                 Z-ADD@@DAYN    @@MNO                           S01195
     C                     Z-ADD@@DAYN    ZDAYNO                          S01195
     C                     MOVEL@@RTNC    @@RTN
     C*
     C**  RESET STARTING POINT
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C                     Z-ADD@@VDT     @@STRT
     C** SAVE THE MIDAS DAY NO. EQUIVALENT FOR POSSIBLE OUTPUT            S01328
     C                     Z-ADD@@DAYN    @@STDN  50                      S01328
     C*
     C**  PROCESS PERIOD TYPE 'D'
     C           @@PTYP    IFEQ 'D'                        B1
     C*
     C**  IF PERIOD NUMBER = 1 FIND NEXT WORKING DAY
     C           @@PNUM    IFEQ 1                          B*2
     C*****      @@HIND    DOUEQ'W'                        B**3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C*****                ADD  1         @@MNO            ***3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER NE 1 FIND TOMORROW/NEXT DAY (AND OVERNIGHT)
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFLT 1                          B*2
     C*****                Z-ADDRUND      @@MNO            **2            S01195
     C                     Z-ADDBJRDNB    ZDAYNO           **2            S01195
     C*****      @@HIND    DOUEQ'W'                        B**3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C*****                ADD  1         @@MNO            ***3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C**  IF PERIOD NUMBER IS -1 FIND NEXT WORKING DAY TOMM/NEXT.
     C**  IE FIND NEXT WORKING DAY BEYOND RUND
     C           @@PNUM    IFEQ 0                          B*2
     C*****      @@HIND    DOUEQ'W'                        B**3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C*****                ADD  1         @@MNO            ***3           S01195
     C                     ADD  1         ZDAYNO           ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'W'
     C           @@PTYP    IFEQ 'W'                        B1
     C*
     C**  INCREMENT DAY NUMBER
     C           @@PNUM    MULT 7         @@ADD   30       *1
     C*****                ADD  @@ADD     @@MNO            *1             S01195
     C                     ADD  @@ADD     ZDAYNO           *1             S01195
     C*
     C**  FIND NEXT WORKING DAY
     C*****                EXSR ZA0830                     *1             S01195
     C                     EXSR ZCHKH                      *1             S01195
     C*****      @@HIND    DOWEQ'H'                        B*2            S01195
     C           ZIND      DOWEQ'H'                        B*2            S01195
     C*****                ADD  1         @@MNO            **2            S01195
     C                     ADD  1         ZDAYNO           **2            S01195
     C*****                EXSR ZA0830                     **2            S01195
     C                     EXSR ZCHKH                      **2            S01195
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  PROCESS PERIOD TYPE 'M' OR 'Y'
     C           @@PTYP    IFEQ 'M'                        B1
     C           @@PTYP    OREQ 'Y'                        *1
     C*
     C**  IS SPOT LAST WORKING DAY IN MONTH
     C                     Z-ADD@@SPDD    @@DTIN           *1
     C*****                EXSR ZA0730                     *1             S01195
     C                     EXSR ZA073C                     *1             S01195
     C           @@SPMT    IFNE @@Z71M                     B*2
     C                     Z-ADD1         @@STDY           **2
     C           @@STMT    IFEQ 12                         B**3
     C                     Z-ADD1         @@STMT           ***3
     C                     ADD  1         @@STYR           ***3
     C                     ELSE                            X**3
     C                     ADD  1         @@STMT           ***3
     C                     END                             E**3
     C*
     C**  CONVERT STARTING DATE TO MIDAS DAY NUMBER FORMAT
     C*********************Z-ADD@@STRT    @@DTIN           **2            S01328
     C                     Z-ADD@@STRT    ZZDTIN                          S01328
     C*********************EXSR ZA0680                     **2            S01328
     C                     EXSR ZDAT10                                    S01328
     C*****                Z-ADD@@MDNO    @@MNO            **2            S01195
     C*********************Z-ADD@@MDNO    ZDAYNO           **2      S01195S01328
     C                     Z-ADDZZMDNO    ZDAYNO                          S01328
     C*****      @@HIND    DOUEQ'W'                        B**3           S01195
     C           ZIND      DOUEQ'W'                        B**3           S01195
     C*****                SUB  1         @@MNO            ***3           S01195
     C                     SUB  1         ZDAYNO           ***3           S01195
     C*****                EXSR ZA0830                     ***3           S01195
     C                     EXSR ZCHKH                      ***3           S01195
     C                     END                             E**3
     C                     GOTO M10038                     **2
     C                     END                             E*2
     C*
     C**  IF THE STARTING POINT DAY IS A NON WORKING DAY AND THE NEXT
     C**  WORKING DAY FALLS IN THE NEXT MONTH  FIND LAST WORKING DAY
     C**  IN STARTING MONTH.
     C*********************Z-ADD@@STRT    @@DTIN           *1             S01328
     C                     Z-ADD@@STRT    ZZDTIN           *1             S01328
     C*********************EXSR ZA0680                     *1             S01328
     C                     EXSR ZDAT10                                    S01328
     C*****                Z-ADD@@MDNO    @@MNO            *1             S01195
     C*********************Z-ADD@@MDNO    ZDAYNO           *1       S01195S01328
     C                     Z-ADDZZMDNO    ZDAYNO           *1             S01328
     C*****                EXSR ZA0830                     *1             S01195
     C                     EXSR ZCHKH                      *1             S01195
     C*****      @@HIND    IFEQ 'H'                        B*2            S01195
     C           ZIND      IFEQ 'H'                        B*2            S01195
     C                     Z-ADD@@STRT    @@DTIN           **2
     C*****                EXSR ZA0730                     **2            S01195
     C                     EXSR ZA073C                     **2            S01195
     C*
     C           @@STMT    IFNE @@Z71M                     B**3
     C*****      @@HIND    DOUEQ'W'                        B***4          S01195
     C           ZIND      DOUEQ'W'                        B***4          S01195
     C*****                SUB  1         @@MNO            ****4          S01195
     C                     SUB  1         ZDAYNO           ****4          S01195
     C*****                EXSR ZA0830                     ****4          S01195
     C                     EXSR ZCHKH                      ****4          S01195
     C                     END                             E***4
     C                     END                             E**3
     C                     GOTO M10038                     ***3
     C                     END                             E*2
     C*
     C**  IF STARTING DATE IS A WORKING DAY IN CURRENCY & SPOT DATE
     C**  IS NOT LAST WORKING DAY IN MONTH PERIOD DATE IS STARTING DAY
     C                     Z-ADD@@STRT    @@PDAT           *1
     C                     Z-ADD@@STDN    @@PRDN           *1             S01328
     C                     GOTO M10039                     *1
     C*
     C                     END                             E1
     C*
     C           M10038    TAG
     C*
     C**  CONVERT DATE TO YYYYMMDD FORMAT
     C*****                Z-ADD@@MNO     @@DAYN                          S01195
     C                     Z-ADDZDAYNO    @@DAYN                          S01195
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C*                                                                   S01328
     C** OUTPUT DATE IN YYYYMMDD FORMAT AND MIDAS DAY NO. FORMAT          S01328
     C                     Z-ADD@@VDT     @@PDAT  80
     C                     Z-ADD@@DAYN    @@PRDN  50                      S01328
     C*
     C                     GOTO M10039
     C                     ADD  0         @@SPOT  80
     C*********************MOVE *BLANKS   @@CCY   3                       S01117
     C*********************ADD  0         @@PNUM  10                      S01328
     C                     ADD  0         @@PNUM  20                      S01328
     C                     MOVE *BLANKS   @@PTYP  1
     C*
     C           M10039    ENDSR
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #ZX    - Load Screen Fields                                   *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C           #ZX       BEGSR
     C*
     C***FIRST*GET*ALL*THE INTEREST RATES RECORDS                         S01328
     C***MOVE*THE*FIELDS*IN FROM THE FIRST RECORD                         S01328
     C***********          Z-ADDHWBRRT    @@INPR                          S01328
     C***********          EXSR MM1017                                    S01328
     C***********          MOVEL@@OUTR    DD01BR                          S01328
     C***********          Z-ADDHWLDRT    @@INPR                          S01328
     C***********          EXSR MM1017                                    S01328
     C***********          MOVEL@@OUTR    DD01LR                          S01328
     C***********          MOVELHWPRDX    DDPDX1                          S01328
     C***********          MOVELHWCCY     @SCCY                           S01328
     C*
     C***NOW*FOR*THE*SECOND RECORD                                        S01328
     C***********          EXSR #ZA                                       S01328
     C*
     C***IF*THE*CURRENCY*HAS CHANGED IT IS A DATA BASE ERROR              S01328
     C***********@SCCY     IFNE HWCCY                      B1             S01328
     C***********          MOVE 'FDINTRLL'DBFILE           ***************S01328
     C***********          MOVE '001'     DBASE            * DB ERROR 001*S01328
     C***********          MOVE DDCCY     DBKEY            ***************S01328
     C***********          MOVE '1'       *INU7            *1             S01328
     C***********          MOVE '1'       *INU8            *1             S01328
     C***********          MOVE '1'       *INLR            *1             S01328
     C***********          EXSR *PSSR                      *1      S01194 S01328
     C***********          GOTO #ZX9                       *1             S01328
     C***********          END                             E1             S01328
     C*
     C***MOVE*THE*FIELDS*IN FROM THE SECOND RECORD                        S01328
     C***********          Z-ADDHWBRRT    @@INPR                          S01328
     C***********          EXSR MM1017                                    S01328
     C***********          MOVEL@@OUTR    DD02BR                          S01328
     C***********          Z-ADDHWLDRT    @@INPR                          S01328
     C***********          EXSR MM1017                                    S01328
     C***********          MOVEL@@OUTR    DD02LR                          S01328
     C***********          MOVELHWPRDX    DDPDX2                          S01328
     C***********          MOVELHWCCY     @SCCY                           S01328
     C*                                                                   S01328
     C* POSITION POINTER TO START OF CURRENCY                             S01328
     C*                                                                   S01328
     C                     MOVELHWCCY     DDCCY                           S01328
     C                     MOVELHWCCY     @SCCY                           S01328
     C           @EXKY     SETLLFDINTRLL                   *1             S01328
     C*
     C** NOW LOOP TO FILL UP THE SUBFILE
     C           1         DO   @CNT      @RRN1            B1
     C*
     C** GET THE SUBFILE RECORD
     C           @RRN1     CHAINFD0550S5             77    *1
     C***NOW*FOR*THE*THIRD RECORD                                         S01328
     C** NOW FOR THE NEXT RECORD                                          S01328
     C                     EXSR #ZA                        *1
     C*
     C** IF THE CURRENCY HAS CHANGED IT IS A DATA BASE ERROR
     C           @SCCY     IFNE HWCCY                      B*2
     C                     MOVE 'FDINTRLL'DBFILE           ***************
     C                     MOVE '002'     DBASE            * DB ERROR 002*
     C                     MOVE DDCCY     DBKEY            ***************
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     MOVE '1'       *INLR            **2
     C                     EXSR *PSSR                      *1             S01194
     C                     GOTO #ZX9                       **2
     C                     END                             E*2
     C*
     C** MOVE THE FIELDS IN FROM THE SECOND RECORD
     C                     Z-ADDHWBRRT    @@INPR           *1
     C                     EXSR MM1017                     *1
     C                     MOVEL@@OUTR    DD03BR           *1
     C                     Z-ADDHWLDRT    @@INPR           *1
     C                     EXSR MM1017                     *1
     C                     MOVEL@@OUTR    DD03LR           *1
     C                     MOVELHWPRDX    DDPDX3           *1
     C                     MOVELHWCCY     @SCCY            *1
     C*
     C** UPDATE THE SUBFILE RECORD
     C                     UPDATFD0550S5                   *1
     C*
     C                     END                             E1
     C*
     C** NOW GET THE CURRENCY NAME  AND SPOT RATES
     C*********************MOVE @SCCY     DDCCY                           S01194
     C***********@SCRKY****CHAINFDCCYTLL             68                   S01194
     C*EJECT***************                                               S01194
     C***IF*THE*CURRENCY*DOES NOT EXIST DATA BASE ERROR                   S01194
     C************IN68*****IFEQ '1'                        B1             S01194
     C*********************MOVE 'FDINTRLL'DBFILE           ***************S01194
     C*********************MOVE '003'     DBASE            * DB ERROR 003*S01194
     C*********************MOVE DDCCY     DBKEY            ***************S01194
     C*********************MOVE '1'       *INU7            *1             S01194
     C*********************MOVE '1'       *INU8            *1             S01194
     C*********************MOVE '1'       *INLR            *1             S01194
     C*********************EXSR *PSSR                      *1      S01194 S01194
     C*********************GOTO #ZX9                       *1             S01194
     C*********************END                             E1             S01194
     C*********************MOVELCCNM      DDCCNM                          S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '       ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM DDCCY     @CRKEY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
032  C*                                                                   S01194
032  C* DATABASE ERROR IF CURRENCY NOT FOUND                              S01194
032  C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01194
     C                     MOVE '003'     DBASE            * DB ERROR 003*S01194
     C                     MOVE DDCCY     DBKEY            ***************S01194
     C                     MOVE '1'       *INU7                           S01194
     C                     MOVE '1'       *INU8                           S01194
     C                     MOVE '1'       *INLR                           S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO #ZX9                                      S01194
     C                     END                                            S01194
     C                     MOVELA6CYNM    DDCCNM                          S01194
     C*
     C** SAVE THE TIME AND DATE FIELDS
     C                     Z-ADDHWDLUP    @XDLUP
     C                     MOVE HWMLUP    @XMLUP
     C                     Z-ADDHWYLUP    @XYLUP
     C                     Z-ADDHWTLUP    @XTLUP
     C                     Z-ADDHWTLUP    @XTLUP
     C*********************Z-ADDCHGD      @CHGD                           S01194
     C*********************Z-ADDTSPC      @TSPC                           S01194
     C*
     C           #ZX9      ENDSR
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* MM1017 - Subroutine to convert a rate to display, no sign     *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* INPUT  : @@INPR Rate to be edited.                            *
     C*                                                               *
     C* OUTPUT : @@OUTR Edited output rate.                           *
     C*                                                               *
     C* USES :   @@INPR Rate to be edited.                            *
     C*          @@OUTR Edited output rate.                           *
     C*          @@DECS Field to hold decimal digits for input rate.  *
     C*          @@INTS Field to hold integers for input rate.        *
     C*          @@N    Counter field.                                *
     C*          @@Q    Second counter field.                         *
     C*          @@STRP Rate start position after zero suppression.   *
     C*          @W     Work array.                                   *
     C*                                                               *
     C*****************************************************************
     C           MM1017    BEGSR
     C*
     C**  Define fields used.
     C                     Z-ADD@@INPR    @@INPR 117
     C                     MOVE *BLANKS   @@OUTR 13
     C                     MOVE *BLANKS   @@DECS  7
     C                     MOVE *BLANKS   @@INTS  4
     C                     Z-ADD0         @@N     20
     C                     Z-ADD0         @@Q     20
     C                     Z-ADD0         @@STRP  20
     C*
     C**  Initialise work array.
     C                     MOVEA*BLANKS   @W
     C                     MOVE 'N'       WNGTV                                             AR851109
     C*
     C**  If the rate is negative reverse the sign.
     C           @@INPR    IFLT 0                          B1
     C                     MOVE 'Y'       WNGTV                                             AR851109
     C                     Z-SUB@@INPR    @@INPR           *1
     C                     END                             E1
     C*
     C**  Seperate integers and decimal digits into two fields.
     C                     MOVE @@INPR    @@DECS
     C                     MOVEL@@INPR    @@INTS
     C*
     C**  Move integers, decimal seperator and decimal digits into
     C**  work array.
     C                     MOVEA@@INTS    @W
     C                     MOVE '.'       @W,5
     C                     MOVEA@@DECS    @W,6
     C*
     C**  Remove leading zeros from the rate and replace with blanks.
     C                     Z-ADD1         @@N
     C           @@N       DOWLE3                          B1
     C           @W,@@N    ANDEQ'0'                        X1
     C                     MOVE *BLANK    @W,@@N           *1
     C                     ADD  1         @@N              *1
     C                     END                             E1
     C*
     C                     Z-ADD@@N       @@STRP
     C*
     C**  Truncate trailing zeros and replace with blanks. If rate is
     C**  an integer a single zero after the decimal place should be
     C**  displayed.
     C                     Z-ADD12        @@N
     C           @@N       DOWGE7                          B1
     C           @W,@@N    ANDEQ'0'                        X1
     C                     MOVE *BLANK    @W,@@N           *1
     C                     SUB  1         @@N              *1
     C                     END                             E1
     C*
     C**  Right justify the array.
     C                     Z-ADD12        @@Q
     C           @@N       IFNE @@Q                        B1
     C           @@N       DOWGE@@STRP                       B2
     C                     MOVE @W,@@N    @W,@@Q             *2
     C                     MOVE *BLANK    @W,@@N             *2
     C                     SUB  1         @@N                *2
     C                     SUB  1         @@Q                *2
     C                     END                               E1
     C                     END                             E2
      *                                                                                     AR851109
      ** Provide negative sign if rate is negative.                                         AR851109
      *                                                                                     AR851109
     C           WNGTV     IFEQ 'Y'                                                         AR851109
     C                     MOVEL'N'       WNGTV                                             AR851109
     C                     Z-ADD2         Y       20                                        AR851109
     C                     Z-ADD0         Z       20                                        AR851109
     C           Y         DOWLE12                                                          AR851109
     C           Y         SUB  1         Z                                                 AR851109
     C           @W,Y      IFNE *BLANK                                                      AR851109
     C                     MOVE '-'       @W,Z                                              AR851109
     C                     LEAVE                                                            AR851109
     C                     ENDIF                                                            AR851109
     C                     ADD  1         Y                                                 AR851109
     C                     ENDDO                                                            AR851109
     C                     ENDIF                                                            AR851109
     C*
     C**  Move the final array into the output field.
     C                     MOVEA@W        @@OUTR
     C*
     C           M10179    ENDSR                           **M10179**
     C/EJECT
      /COPY ZSRSRC,ZDATE9Z3                                               S01328
     C/EJECT                                                              S01328
      /COPY ZSRSRC,ZDAT10Z2                                               S01328
     C*******************************************************************
     C*
     C**ZA0680*-*THIS*SUBROUTINE CONVERTS YYYYMMDD FORMAT DATE TO         S01328
     C***********MIDAS*DAY NUMBER FORMAT (NO. DAYS FROM 31/12/71)         S01328
     C*
     C**CALLED*BY*:                                                       S01328
     C*
     C**CALLS*:                                                           S01328
     C*
     C**INPUT**:*@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)   S01328
     C*
     C**OUTPUT*:*@@MDNO MIDAS DAY NUMBER  (SIZE : 5N)                     S01328
     C*
     C**USES*:***@@CC   NUMBER OF CENTURIES IN DATE                       S01328
     C***********@@DAY  DAY NUMBER                                        S01328
     C***********@@REM  REMAINDER FROM DIVIDE                             S01328
     C***********@@MTH  MONTH NUMBER                                      S01328
     C***********@MD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     S01328
     C***********       MONTH                                             S01328
     C***********@@WK2  WORK FIELD (2,0)                                  S01328
     C***********@@WK5  WORK FIELD (5,0)                                  S01328
     C***********@@YYYY YEAR (4 CHARACTER)                                S01328
     C***********@@YY   YEAR (2 CHARACTER)                                S01328
     C***********@YD    COMPILATION TIME ARRAY FOR CUMULATIVE DAYS IN     S01328
     C***********       A FOUR YEAR PERIOD                                S01328
     C*
     C******LAST AMEND NO. ME1257              DATE 02/04/87              S01328
     C******When date input is zero set output date to zeroes             S01328
     C*
     C*******************************************************************
     C*
     C***********ZA0680    BEGSR                                          S01328
     C*
     C****CLEAR*OUT*ANY 'OLD' DATA IN FIELD                               S01328
     C*********************Z-ADD0         @@MDNO  50                      S01328
     C*
     C***********@@DTIN    CABEQ0         ZA0689                    ME1257S01328
     C*
     C*****IF*DATE GREATER THAN 31/12/2071 NEED EXTRA PROCESSING          S01328
     C*****WORK*OUT THE NUMBER OF CENTURIES PASSED SINCE 1971,            S01328
     C*****BY*SUBTRACTING 1972 FROM THE YEAR FIELD.                       S01328
     C***********@@YYYY    IFGE 2072                       B1             S01328
     C***********@@YYYY    SUB  1972      @@YYYY           *1             S01328
     C*
     C*****MULTIPLY BY NUMBER OF DAYS IN CENTURY (SINCE 1971)             S01328
     C*****THEN RESTORE THE YEAR WHICH WAS INPUT BACK TO THE              S01328
     C*****ORIGINAL VALUE BEFORE CONTINUING WITH NORMAL CALCULATIONS.     S01328
     C**
     C***********@@CC      MULT 36524     @@MDNO           *1             S01328
     C***********@@YYYY    ADD  1972      @@YYYY           *1             S01328
     C***********          END                             E1             S01328
     C*
     C***********@@YYYY    ADD  28        @@WK2   20                      S01328
     C*
     C***********@@WK2     DIV  4         @@WK2                           S01328
     C***********          MVR            @@REM   10                      S01328
     C*
     C******MULTIPLY BY NUMBER OF DAYS IN FOUR YEAR PERIOD                S01328
     C***********@@WK2     MULT 1461      @@WK5   50                      S01328
     C***********          ADD  @@WK5     @@MDNO                          S01328
     C*
     C****CHECK*REMAINDER AND MONTH NUMBER                                S01328
     C***********@@REM     IFEQ 0                          B1             S01328
     C***********@@MTH     ANDGT2                          B1             S01328
     C***********          ADD  1         @@MDNO           *1             S01328
     C***********          END                             E1             S01328
     C*
     C****YEAR*NOT LEAP YEAR,  ADD CUMULATIVE DAYS FOR YEAR               S01328
     C***********@@REM     IFNE 0                          B1             S01328
     C***********          ADD  @YD,@@REM @@MDNO           *1             S01328
     C***********          END                             E1             S01328
     C*
     C****ADD*MONTHS THIS YEAR                                            S01328
     C***********          ADD  @MD,@@MTH @@MDNO                          S01328
     C*
     C****ADD*DAYS THIS MONTH                                             S01328
     C***********          ADD  @@DAY     @@MDNO                          S01328
     C*
     C***********ZA0689    ENDSR                           **ZA0689 TAG** S01328
     C*****************************************************************
     C/EJECT
      *****************************************************************
      *                                                               *
      ********TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   S01328
      *                                                               *
      ********SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   S01328
      ********PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   S01328
      ********THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   S01328
      ********SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   S01328
      ********IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   S01328
      ********'@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   S01328
      *                                                               *
      **NOTE:*FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  S01328
      *                                                               *
      ********1) @@DAYN   LENGTH 5,0.                                 *   S01328
      *                                                               *
      ********FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   S01328
      *                                                               *
      ********1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   S01328
      ********2) @@RTN    LENGTH 1,0.                                 *   S01328
      ********3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   S01328
      ********4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   S01328
      ********5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   S01328
      ********6) @@RDAY   LENGTH 5,0.                                 *   S01328
      ********7) @@LEAP   LENGTH 1,0.                                     S01328
      *                                                               *
      ********INDICATORS USED ARE:                                    *   S01328
      *                                                               *
      ********1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   S01328
      ********2) 81       CHECK FOR LOW ON ARRAY @MD.                 *   S01328
      *                                                               *
      **INPUT*FIELD:       @@DAYN                                     *   S01328
      *                                                               *
      **OUTPUT*FIELD:      @@VDT                                      *   S01328
      *                                                               *
      **WORK*FIELDS:       @@RTN                                      *   S01328
      *************        @@Z71Y                                     *   S01328
      *************        @@RDAY                                     *   S01328
      *************        @@LEAP                                     *   S01328
      *************        @@I                                        *   S01328
      *************        @@J                                        *   S01328
      *                                                               *
      **ARRAYS*USED:       @YD COMPILE TIME ARRAY.                        S01328
      *************        @MD COMPILE TIME ARRAY.                        S01328
      *
      ******LAST*AMEND NO. ME1257              DATE 02/04/87              S01328
      ******When*date input is zero set output date to zeroes             S01328
      *
      *****************************************************************
     C*
     C***********ZA0710    BEGSR                                          S01328
     C*
     C***********          SETOF                     8081                 S01328
     C***********          Z-ADD0         @@RTN   10                      S01328
     C***********          Z-ADD0         @@VDT                           S01328
     C***********          Z-ADD1         @@I     20                      S01328
     C***********          Z-ADD1         @@J     20                      S01328
     C***********          Z-ADD1         @@LEAP  10                      S01328
     C*
     C***********@@DAYN    CABEQ0         ZA0719                    ME1257S01328
     C*
     C***********@@DAYN    IFLT 1                                         S01328
     C***********          Z-ADD1         @@RTN                           S01328
     C***********          GOTO ZA0719                                    S01328
     C***********          END                                            S01328
     C*
     C**DIVISION*TO*DETERMINE WETHER LEAP YEAR.                           S01328
     C*
     C***********@@DAYN    DIV  1461      @@Z71Y                          S01328
     C***********          MVR            @@RDAY  50                      S01328
     C*
     C**CALCULATING*YEAR.                                                 S01328
     C*
     C***********@@Z71Y    MULT 4         @@Z71Y                          S01328
     C***********          ADD  1972      @@Z71Y                          S01328
     C*
     C**CHECKING*IF*YEAR IS GREATER THAN OR EQUAL TO 2100                 S01328
     C*
     C***********@@Z71Y    IFGE 2100                                      S01328
     C***********          ADD  @@SSY2    @@RDAY                          S01328
     C***********          END                                            S01328
     C*
     C**LOKUP*ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        S01328
     C**HAVE*PASSED.                                                      S01328
     C*
     C***********@@RDAY    LOKUP@YD,@@I                8080               S01328
     C*
     C**IF*YEAR*IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     S01328
     C*
     C************IN80     IFEQ '0'                                       S01328
     C***********          Z-ADD0         @@LEAP                          S01328
     C***********          END                                            S01328
     C*
     C**ADD*INDEX*TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       S01328
     C*
     C***********@@LEAP    IFEQ 1                                         S01328
     C***********@@RDAY    SUB  @YD,@@I   @@RDAY                          S01328
     C***********          ADD  @@I       @@Z71Y                          S01328
     C***********          END                                            S01328
     C*
     C**PROCESSING*FOR A LEAP YEAR.                                       S01328
     C*
     C***********@@LEAP    IFEQ 0                                         S01328
     C*
     C**IF*'@@RDAY'*= 60 DATE MUST BE 29TH OF FEBRUARY.                   S01328
     C*
     C***********@@RDAY    IFEQ 60                                        S01328
     C***********          Z-ADD29        @@Z71D                          S01328
     C***********          Z-ADD2         @@Z71M                          S01328
     C***********          GOTO ZA0711                                    S01328
     C***********          END                                            S01328
     C*
     C**IF*'@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    S01328
     C**PROCEED*AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     S01328
     C**YEAR.*NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          S01328
     C*
     C***********@@RDAY    IFGT 60                                        S01328
     C***********@@RDAY    SUB  1         @@RDAY                          S01328
     C***********          END                                            S01328
     C*
     C***********          END                                            S01328
     C*
     C**IF*DAY*'@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      S01328
     C**IN*4*YEARS)*THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      S01328
     C**GROUP.******                                                      S01328
     C*
     C***********@@RDAY    IFEQ 0                                         S01328
     C***********          Z-ADD31        @@Z71D                          S01328
     C***********          Z-ADD12        @@Z71M                          S01328
     C***********          SUB  1         @@Z71Y                          S01328
     C***********          GOTO ZA0711                                    S01328
     C***********          END                                            S01328
     C*
     C**LOOK*UP*ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         S01328
     C**OCCURS*IN                                                         S01328
     C*
     C***********@@RDAY    LOKUP@MD,@@J                81                 S01328
     C***********          Z-ADD@@J       @@Z71M                          S01328
     C***********@@RDAY    SUB  @MD,@@J   @@Z71D                          S01328
     C*
     C**DS*@@VDT  IS RETURNED IN YYYYMMDD FORMAT                          S01328
     C*
     C***********ZA0711    TAG                                            S01328
     C*
     C***********          MOVE @@Z71Y    @@YR                            S01328
     C*
     C***********ZA0719    ENDSR                                          S01328
     C*****************************************************************
      /EJECT
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C*                                                                   S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C*****************************************************************
     C*                                                               *
     C*       TITLE:DETERMINE NEXT WORKING DAY.                       *
     C*                                                               *
     C*       SUBROUTINE ZA0730 EXPECTS FIELD '@@DTIN' TO BE          *
     C*       PASSED TO IT IN 'YYYYMMDD' FORMAT.IT THEN DETERMINES    *
     C*       THE NEXT WORKING DAY AND RETURNS.                       *
     C*                                                               *   S01328
     C* CALLS : ZDATE9 - CONVERTS MIDAS DAY NUMBER TO YYYYMMDD        *   S01328
     C*         ZDAT10 - CONVERTS YYYYMMDD TO MIDAS DAY NUMBER        *   S01328
     C*                                                               *
     C* INPUT  :@@DTIN DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*
     C**********@@CCY**CURRENCY CODE   - IN FORMAT(3A)                *   S01195
     C*         ZCCY   CURRENCY CODE   - IN FORMAT(3A)                *   S01195
     C*                                                               *
     C* OUTPUT :@@VDT  DATE (YYYYMMDD) - IN DATA STRUCTURE (SIZE : 8N)*
     C*                                                               *
     C**USES*:***@@MDNO*MIDAS*DAY*NO*USED*BY*SR*ZA0680*****************   S01328
     C***********@@DAYN*MIDAS*DAY*NO*USED*BY*SR*ZA0710*****************   S01328
     C* USES :   ZZMDNO MIDAS DAY NO USED BY SR ZDAT10                *   S01328
     C*          @@DAYN MIDAS DAY NO USED BY SR ZDATE9                *   S01328
     C*          @@MNO  MIDAS DAY NO USED BY SR ZA0830                *
     C*          @@LRND HOLIDAY IND.RETURNED BY ZA0830                *
     C*                                                               *
     C*****************************************************************
     C****       ZA0730    BEGSR                                          S01195
     C           ZA073C    BEGSR                                          S01195
     C*
     C* CONVERT YYYYMMDD FORMAT TO MIDAS DAY NO.
     C*
     C*********************EXSR ZA0680                                    S01328
     C                     Z-ADD@@DTIN    ZZDTIN                          S01328
     C                     EXSR ZDAT10                                    S01328
     C*
     C           ZA0731    TAG
     C*
     C*********************ADD  1         @@MDNO  50                      S01328
     C                     ADD  1         ZZMDNO  50                      S01328
     C*
     C* CHECK IF DAY NO. IS A HOLIDAY          .
     C*
     C****                 Z-ADD@@MDNO    @@MNO   50                      S01195
     C*********************Z-ADD@@MDNO    ZDAYNO  50                S01195S01328
     C                     Z-ADDZZMDNO    ZDAYNO  50                      S01328
     C*
     C****                 EXSR ZA0830                                    S01195
     C                     EXSR ZCHKH                                     S01195
     C*
     C****       @@HIND    IFEQ 'H'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C                     GOTO ZA0731
     C                     END
     C*
     C* CONVERT MIDAS DAY NO. TO YYYYMMDD FORMAT.
     C*
     C*********************Z-ADD@@MDNO    @@DAYN  50                      S01328
     C                     Z-ADDZZMDNO    @@DAYN  50                      S01328
     C*
     C*********************EXSR ZA0710                                    S01328
     C                     EXSR ZDATE9                                    S01328
     C*
     C           ZA0739    ENDSR                                       **
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  SUBROUTINE ZA0770 - THIS SUBROUTINE RECEIVES A 8/0 INPUT     *
     C*                      DATE - FORMAT YYYYMMDD AND OUTPUTS A     *
     C*                      6/0 DATE. IF INPUT FIELD @@DATF = 'M'    *   S01328
     C*                      OUTPUT FORMAT MMDDYY. IF INPUT FIELD     *   S01328
     C*                      @@DATF = 'D' OUTPUT FORMAT DDMMYY.       *   S01328
     C***********************6/0 DATE. IF FIELD DATF ON TABTB10 =     *   S01328
     C***********************'M' OUTPUT FORMAT MMDDYY. IF FIELD       *   S01328
     C***********************DATF = 'D' OUTPUT FORMAT DDMMYY.         *   S01328
     C*                                                               *
     C*  CALLED BY   :                                                *
     C*                                                               *
     C*  INPUT       : @@DTIN  - DATE INPUT (8,0)                     *
     C*              : @@DATF  - DATE FORMAT INDICATOR (M OR D)       *   S01328
     C*  OUTPUT      : @@DTOU  - DATE OUTPUT (6,0)                    *
     C*                                                               *
     C*  WORK FIELDS : @@YYY   - YEAR IN (2,0)                        *
     C*              : @@MM    - MONTH IN (2,0)                       *
     C*              : @@DD    - DAY IN (2,0)                         *
     C*                                                               *
     C*              : @@DAT1  - IF DATE DD/MM/YY DAY ELSE MONTH (2,0)*
     C*              : @@DAT2  - IF DATE DD/MM/YY MONTH ELSE DAY (2,0)*
     C*                                                               *
     C*****************************************************************
     C           ZA0770    BEGSR
     C*
     C                     Z-ADD@@YY      @@YYY
     C*
     C**  DATF = 'D' CONVERT TO DDMMYY FORMAT
     C*****      DATF      IFEQ 'D'                        B1             S01194
     C***********BJDFIN    IFEQ 'D'                        B1      S01194 S01328
     C           @@DATF    IFEQ 'D'                        B1             S01328
     C                     Z-ADD@@DD      @@DAT1           *1
     C                     Z-ADD@@MM      @@DAT2           *1
     C                     END                             E1
     C*
     C*
     C**  DATF = 'M' CONVERT TO MMDDYY FORMAT
     C*******    DATF      IFEQ 'M'                        B1             S01194
     C***********BJDFIN    IFEQ 'M'                        B1      S01194 S01328
     C           @@DATF    IFEQ 'M'                        B1             S01328
     C                     Z-ADD@@DD      @@DAT2           *1
     C                     Z-ADD@@MM      @@DAT1           *1
     C                     END                             E1
     C*
     C**  MOVE YEAR PART OF DATA STRUCTURE
     C                     MOVE @@YYY     @@YY
     C*
     C           ZA0779    ENDSR                           ***ZA0779***
     C/EJECT
     C/COPY ZSRSRC,ZDATE2Z2                                               S01328
     C***********************************************************************
     C*****                                                               S01195
     C**ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01195
     C*****      IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01195
     C*****                                                               S01195
     C**CALLED BY :                                                       S01195
     C*****                                                               S01195
     C**CALLS :                                                           S01195
     C*****                                                               S01195
     C**INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01195
     C*****      @@CCY  CURRENCY CODE 3A                                  S01195
     C*****                                                               S01195
     C**OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01195
     C*****                                                               S01195
     C**USES :   @@MNO  MIDAS DAY NUMBER                                  S01195
     C*****      @@CCY  CURRENCY CODE                                     S01195
     C*****      @@ONCE FIRST TIME THROUGH INDICATOR                      S01195
     C*****      @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01195
     C*****      @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01195
     C*****      @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                  S01195
     C****       @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01195
     C****       @@INEX INCLUDE/EXCLUDE INDICATOR                         S01195
     C****                                                                S01195
     C****       INDICATORS                                               S01195
     C*****      80 RECORD NOT FOUND                                      S01195
     C*****      81 CURRENCY NOT FOUND ON RECORD                          S01195
     C*****                                                               S01195
     C********************************************************************S01195
     C*****      ZA0830    BEGSR                                          S01195
     C*****                                                               S01195
     C***OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 S01195
     C*****      @@ONCE    IFNE 'Y'                        B1             S01195
     C*****                OPEN FDTABJLL                   *1             S01195
     C*****                MOVE 'Y'       @@ONCE  1        *1             S01195
     C*****                END                             E1             S01195
     C*                                                                   S01195
     C***BLANK OUT ARRAY                                                  S01195
     C*****                MOVE *BLANKS   @@CY1                           S01195
     C*****                MOVE *BLANKS   @@CY2                           S01195
     C*****                                                               S01195
     C***ACCESS TABLE ON FIRST KEY                                        S01195
     C*****                MOVEL@@MNO     @@MNO6  6                       S01195
     C*****                MOVE @@MNO6    @@0830 12                       S01195
     C*****                MOVEL'22    '  @@0830                          S01195
     C*****                MOVE '1'       @@0830                          S01195
     C*****      @@0830    CHAINTABLETJF             80                   S01195
     C*                                                                   S01195
     C** IF RECORD NOT FOUND OR DELETED                                   S01195
     C*****      *IN80     IFEQ '1'                        B1             S01195
     C*****      RECI      OREQ '*'                        *1             S01195
     C*****                MOVE 'W'       @@HIND           *1             S01195
     C*****                GOTO ZA0839                     *1             S01195
     C*****                END                             E1             S01195
     C*                                                                   S01195
     C***MOVE FIRST 25 CURRENCIES TO ARRAY                                S01195
     C*****                MOVE HCCY      @@CY1                           S01195
     C*****                                                               S01195
     C** ACCESS TABLE ON SECOND KEY                                       S01195
     C****                 MOVE '2'       @@0830                          S01195
     C****       @@0830    CHAINTABLETJF             80                   S01195
     C****                                                                S01195
     C***IF SECOND RECORD FOUND AND NOT DELETED                           S01195
     C*****     *IN80     IFEQ '0'                        B1              S01195
     C*****      RECI      ANDNE'*'                        *1             S01195
     C****                 MOVE HCCY      @@CY2            *1             S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***SEARCH ARRAY FOR INPUT CURRENCY                                  S01195
     C****       @@CCY     LOKUP@CY                      81               S01195
     C****                                                                S01195
     C***IF INPUT CURRENCY IS IN ARRAY                                    S01195
     C****       *IN81     IFEQ '1'                        B1             S01195
     C****                                                                S01195
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              S01195
     C****       INEX      IFEQ 'E'                        B*2            S01195
     C****                 MOVE 'W'       @@HIND  1        **2            S01195
     C****                 ELSE                            X*2            S01195
     C****                 MOVE 'H'       @@HIND           **2            S01195
     C****                 END                             E*2            S01195
     C****                 END                             E1             S01195
     C****                                                                S01195
     C***IF INPUT CURRENCY IS NOT IN ARRAY                                S01195
     C****       *IN81     IFEQ '0'                        B1             S01195
     C*****                                                               S01195
     C****F INCLUDE/EXCLUDE INDICATOR EQ 'I'                              S01195
     C****       INEX      IFEQ 'I'                        B*2            S01195
     C****                 MOVE 'W'       @@HIND           **2            S01195
     C****                 ELSE                            X*2            S01195
     C****                 MOVE 'H'       @@HIND           **2            S01195
     C****                 END                             E*2            S01195
     C****                 END                             E1             S01195
     C****       ZA0839    ENDSR                                          S01195
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* ZTNLU - TO LOCK AND UPDATE THE TRANSACTION NUMBER DATA AREA   *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZTNLU1    BEGSR
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     MOVE FNATN     NATN
     C                     MOVE FNATN     ZZWK05
     C                     ADD  1         ZZWK05
     C                     MOVE ZZWK05    FNATN
     C                     OUT  DNATN
     C                     MOVE 'FD'      MDID
     C                     MOVEL'FD0550'  PGMN
     C*********************MOVE DDWID     WSIDX                           S01117
     C                     MOVELDDJOB     WSIDX                           S01117
     C                     TIME           MTIME
     C                     MOVE DDACTN    ACTCDX
     C                     MOVE @USER     USRIDX
     C                     MOVE DDCCY     @CCYX
     C                     MOVE @MSG,1    @MSGX
     C                     Z-ADDNATN      TNLU
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #A  - INITIALISES THE DISPLAY FIELDS AND FIELDS USED FOR THE  *
     C* SUBFILE MESSAGE FILE.                                         *
     C*                                                               *
     C* CALLED BY : MAIN                                              *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES : @JOB - THE JOB NAME FROM THE PSDS                      *
     C*                                                               *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*                                                                   E21137
     C** Access SDMMODPD for CM ind.                                      E21137
     C*                                                                   E21137
     C                     CALL 'AOMMODR0'                                E21137
     C                     PARM '*DBERR ' @RTCD   7                       E21137
     C                     PARM '*FIRST ' @OPTN   7                       E21137
     C           SDMMOD    PARM SDMMOD    DSFDY                           E21137
     C*
     C           *LIKE     DEFN DDACTN    @ACTN
     C           *LIKE     DEFN DDCCNM    @CCNM
     C           *LIKE     DEFN DDCCY     @CCY
     C*****      *LIKE     DEFN RUND      @RUND                           S01194
     C           *LIKE     DEFN BJRDNB    @RUND                           S01194
     C************LIKE*****DEFN CHGD      @CHGD                           S01194
     C************LIKE*****DEFN TSPC      @TSPC                           S01194
     C           *LIKE     DEFN HWPRD     @PRDJ
     C           *LIKE     DEFN HWCCY     @SCCY
     C           *LIKE     DEFN HWTPRD    @TPRD
     C           *LIKE     DEFN HWDLUP    @XDLUP
     C           *LIKE     DEFN HWMLUP    @XMLUP
     C           *LIKE     DEFN HWTLUP    @XTLUP
     C           *LIKE     DEFN HWYLUP    @XYLUP
     C*
     C** CLEAR THE PROGRAM MESSAGE QUEUE
     C                     CALL 'ZA0250'
     C*
     C                     Z-ADD0         STATUS
     C*
     C** DEFINE ALL WORK FIELDS USED IN PROGRAM
     C                     Z-ADD0         @CNT    50
     C                     MOVE *BLANKS   @MSGID 10
     C                     MOVE *BLANKS   @FLDS  66
     C                     Z-ADD0         @P      50
     C***********          MOVE ' '       @PERR   1                       S01328
     C                     Z-ADD1         RECNO   20                      S01328
     C                     Z-ADD0         @PWR    20
     C                     Z-ADD0         @RRN    50
     C                     Z-ADD0         @RRN1   50
     C*                    MOVE *BLANKS   @RTN    1
     C*                    Z-ADD0         @TDAT   50
     C*                    Z-ADD0         @TIM    50
     C                     Z-ADD0         @X      50
     C***********          Z-ADD0         @01LR  117                      S01328
     C***********          Z-ADD0         @01BR  117                      S01328
     C***********          Z-ADD0         @02LR  117                      S01328
     C***********          Z-ADD0         @02BR  117                      S01328
     C                     MOVE *BLANKS   EXTTAG  6
     C                     Z-ADD0         ZZWK05  50
     C                     MOVE 'N'       @UPDWS  1
     C*
     C** INITIALISE SCREEN FIELDS
     C                     MOVE *BLANKS   @@INPR
     C                     MOVE *BLANKS   DDCCNM
     C                     MOVE *BLANKS   DDCCY
     C***********          MOVE *BLANKS   DD01LR                          S01328
     C***********          MOVE *BLANKS   DD01BR                          S01328
     C***********          MOVE *BLANKS   DDPDX1                          S01328
     C***********          MOVE *BLANKS   DD02LR                          S01328
     C***********          MOVE *BLANKS   DD02BR                          S01328
     C***********          MOVE *BLANKS   DDPDX2                          S01328
     C                     MOVEL'*'       DDPGMQ
     C                     MOVE '1'       *IN10
     C                     MOVEL'FD0550'  DBPROG
     C*********************MOVEL@JOB      DDWID                           S01117
     C                     MOVEL@USER     DDUSER                          S01117
     C                     MOVEL@JOB      DDJOB                           S01117
     C                     Z-ADD0         DDTIME
     C                     MOVE '1'       *IN65
     C*
     C** NEGAT PERIOD 1
     C                     Z-SUB@PRD,1    @PRD,1
     C*
     C***INITIALISE*KEY*TO*FDCCYTLL                                       S01194
     C*********************MOVEL'20'      @SCRKY                          S01194
     C*********************MOVE '1'       @KEY4                           S01194
     C*
     C** DEFINE KEY TO FDINTRLL
     C           @EXKY     KLIST
     C                     KFLD           DDCCY
     C                     KFLD           @TPRD
     C                     KFLD           @PRDJ
     C*
     C                     MOVEACPY@      BIS@   80                       S01194
     C*
     C** INITIALISE KEY TO FDINTRLL
     C                     Z-ADD1         @PRDJ
     C                     MOVE @PTP,1    @TPRD
     C*
     C***OBTAIN*THE*DECIMAL*SEPERATOR*FROM*FDINSTLL***********************S01319
     C***********1*********CHAINFDINSTLL*************77*******************S01319
     C************IN77*****IFEQ*'1'************************B1*************S01319
     C***********IDDLTF****ORNE**BLANK*********************X1*************S01319
     C*********************MOVE*'018'*****DBASE***************************S01319
     C*********************MOVEL'FDINSTLL'DBFILE*************DB*ERROR*018*S01319
     C*********************MOVE**BLANKS***DBKEY***************************S01319
     C*********************MOVE*'1'********INU7*************1*************S01319
     C*********************MOVE*'1'********INU8*************1*************S01319
     C*********************EXSR**PSSR***********************1*******S01194S01319
     C*********************GOTO*#A9*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C**********           CALL 'AODEALR0'                                S01319              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01319              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*
     C** FIRST CLEAR SUBFILE
     C                     MOVE '1'       *IN43
     C                     WRITEFD0550S4
     C                     MOVE '0'       *IN43
     C*
     C* THIS SETS UP THE INPUT SUBFILE TO ENTER THE PERIOD DESCRIPTIONS
     C* IN TO IT
     C*
     C** SET UP SUBFILE FIELDS
     C                     Z-ADD1         @RRN1
     C*
     C** SET UP THE FIRST TWO FIELDS
     C***********          MOVE @PDD,1    DDDSC1                          S01328
     C***********          MOVE @PDD,2    DDDSC2                          S01328
     C***********          Z-ADD3         @CNT                            S01328
     C                     Z-ADD1         @CNT                            S01328
     C*
     C** NOW THE SUBFILE FIELDS
     C           @PDD,@CNT DOWNE*BLANKS                    B1
     C***********@CNT      ANDLT21                         *1             S01328
     C           @CNT      ANDLT25                         *1             S01328
     C                     MOVE @PDD,@CNT DDDSC3           *1
     C                     MOVE *BLANKS   DD03LR
     C                     MOVE *BLANKS   DD03BR
     C                     MOVE *BLANKS   DDPDX3
     C                     WRITEFD0550S5                   *1
     C                     ADD  1         @CNT             *1
     C                     ADD  1         @RRN1            *1
     C                     END                             E1
     C           @RRN1     SUB  1         @CNT
     C*
     C****ACCESS*INSTALLATION*FILE*FDICDRLL*TO*GET*DATE*DETAILS.          S01194
     C*****                EXSR ZA0150                                    S01194
     C** CALL ACCESS PROGRAM FOR BANK DETAILS                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR  '@RTCD   7                       S01194
     C                     PARM '*FIRST  '@OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*
     C***********@RTCD     IFNE *BLANK                              S01194S01314
     C*********************MOVEL'SDBANKPD'DBFILE            ********S01194S01314
     C*********************MOVEL'01'      DBASE   3         *DBERRORS01194S01314
     C*********************MOVEL@OPTN     DBOPTN  7         ********S01194S01314
     C*********************SETON                     U7U8LR         S01194S01314
     C*********************EXSR *PSSR                               S01194S01314
     C*********************GOTO #A9                                 S01194S01314
     C*********************END                                      S01194S01314
     C*                                                                   S01328
     C**  SET DATE FORMAT INDICATOR FOR LATER USE IN SR ZDATE2            S01328
     C           BJDFIN    IFEQ 'M'                                       S01328
     C                     MOVE '1'       *IN98                           S01328
     C                     END                                            S01328
     C                     MOVELBJMRDT    XXMRDT                          S01328
     C*                                                                   S01328
     C**  CONVERT MONTH TO NUMERIC FORM.
     C                     Z-ADD1         X
     C           @MMM      LOKUP@MTH,X                   69
     C                     MOVE '0'       *IN69
     C                     MOVE @DD       @DLUP
     C                     MOVE @YY       @YLUP
     C                     MOVE @DATE     @MDATE  60
     C*
     C**  CLEAR THE FIELDS IN FDDINTLL  USING @A                          FM1100
     C           2         OCUR @INTL2                                    FM1100
     C                     MOVE *ZERO     @WPD                            FM1100
     C                     MOVE *ZERO     @WPR                            FM1100
     C                     MOVE *BLANK    @WTP                            FM1100
     C                     MOVE *BLANK    @WPX                            FM1100
     C                     MOVE *ZERO     @WBR                            FM1100
     C                     MOVE *ZERO     @WLD                            FM1100
     C*                                                                   FM1100
     C**  INITIALISE THE ALL THE ELEMENTS IN @A                           FM1100
     C***********          DO   12        @1X              B1      FM1100 S01328
     C                     DO   21        @1X              B1      FM1100 S01328
     C                     MOVE @INTL2    @A,@1X           *1             FM1100
     C                     END                             E1             FM1100
     C*                                                                   FM1100
     C**  RESET @1X TO ZERO                                               FM1100
     C                     Z-ADD0         @1X                             FM1100
     C*
     C** READ DATA AREA - RUNDAT                                          S01319
     C           *NAMVAR   DEFN           RUNDAT                          S01319
     C                     IN   RUNDAT                                    S01319
     C**  GET ZMUSER to access default branch.                            S01319
     C**                                                                  S01319
     C           *NAMVAR   DEFN           ZMUSER                          S01319
     C                     IN   ZMUSER                                    S01319
     C                     UNLCKZMUSER                                    S01319
     C**                                                                  S01319
     C           #A9       ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* #C  - TERMINATES THE PROGRAM BY SETTING ON LR                 *
     C*                                                               *
     C* CALLED BY : MAIN                                              *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           #C        BEGSR
     C*
     C                     MOVE '1'       *INLR
     C*
     C           #C9       ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*****                                                           *   S01194
     C*****   SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C*****   FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C*****   1 (HELD ON PF/TABTB10)                                  *   S01194
     C*****   INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C*****   IS FLAGGED FOR DELETION.                                *   S01194
     C*****   IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C*****   ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C*****                                                           *   S01194
     C*****   FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C*****                                                           *   S01194
     C*****************************************************************   S01194
     C*****                                                               S01194
     C*****      ZA0150    BEGSR                                          S01194
     C*****                                                               S01194
     C***SET UP KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C*****                MOVEL'01'      SS0150 12                       S01194
     C*****                MOVE '10'      SS0150                          S01194
     C*****                                                               S01194
     C***CHAIN TO FILE FDICDRLL                                           S01194
     C*****      SS0150    CHAINFDICDRLL             80                   S01194
     C*****      RECI      IFNE 'D'                        B1             S01194
     C*****                MOVE '1'       *IN80            *1             S01194
     C*****                END                             E1             S01194
     C*****                                                               S01194
     C***DEAL WITH DATA BASE ERROR                                        S01194
     C*****      *IN80     IFEQ '1'                        ***************S01194
     C*****                MOVEL'FDICDRLL'DBFILE           *             *S01194
     C*****                MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C*****                MOVELSS0150    DBKEY            *             *S01194
     C*****                END                             ***************S01194
     C*****                                                               S01194
     C*****      ZA0159    ENDSR                                          S01194
     C*****************************************************************   S01194
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR - THIS SUBROUTINE CHECKS THAT THE ERROR ON THE FILE     *
     C*         FDLCY3LL WAS TRYING TO INSERT A RECORD                *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :    ZA0240                                             *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           INFSR     BEGSR
     C*
     C           STATUS    IFEQ 01021                      B1
     C*
     C** CHAIN TO THE FILE
     C                     MOVE HWTPRD    @TPRD            *1
     C                     Z-ADDHWPRD     @PRDJ            *1
     C           @EXKY     CHAINFDINTRLL             68    *1
     C           *IN68     IFEQ '0'                        B*2
     C*
     C** CLEAR PROGRAM MESSAGE QUEUE
     C                     CALL 'ZA0250'                   **2
     C                     ROLBK                           **2
     C*
     C** SEND MESSAGE RECORD UPDATED BY ANOTHER WORKSTATION
     C                     MOVELDDCCY     @DATA            **2
     C                     MOVEL'FDM0132' @MSGID           **2
     C                     CALL 'ZA0440'                   **2
     C                     PARM           @MSGID           **2
     C                     PARM           @DATA            **2
     C                     MOVE '*DETC '  EXTTAG           **2
     C                     ELSE                            X*2
     C                     MOVE '*CANCL'  EXTTAG           **2
     C                     DUMP                            **2
     C                     END                             E*2
     C                     ELSE                            X1
     C                     MOVE '*CANCL'  EXTTAG           *1
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C                     ENDSREXTTAG
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR - THIS SUBROUTINE IS CALLED FOR ANY PROGARM OR FILE     *
     C*         ERRORS                                                *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :                                                       *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C           @RUN      IFEQ *BLANK                                    S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     SETON                     U7U8LR               S01194
     C                     DUMP
     C                     END                                            S01194
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
** ARRAY TO HOLD MONTHS NAMES FOR THE UPDATES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** ARRAY FOR PERIOD NAMES
Overnight      Tomorrow/Next  Spot/Next      1 Week
2 Weeks        3 Weeks        1 Month        2 Months
3 Months       6 Months       9 Months        1 Year
 2 Years        3 Years        4 Years        5 Years
 6 Years        7 Years        8 Years        9 Years
10 Years
** ARRAY FOR PERIOD TYPES
DDDWWWMMMMMYYYYYYYYYY
** ARRAY FOR PERIOD LENGTH
010001010203010203060901020304050607080910000000
** COMMIT TEXT MESSAGE
Exchange Rates Points Records for Currency Code
** @YD  USED BY SR. ZA0680 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0680 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** array of powers of 10 from 0 to 8
000000000000001
000000000000010
000000000000100
000000000001000
000000000010000
000000000100000
000000001000000
000000010000000
000000100000000
000001000000000
000010000000000
000100000000000
001000000000000
010000000000000
100000000000000
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
