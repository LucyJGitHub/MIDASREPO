     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FD Deal type/subtypes maintenance subfile')      *
/*XBI1*  OVRDBF FILE(GPPRDXL0) TOFILE(GPPRODXL0)                      *                       CGP001
/*XBI2*  OVRDBF FILE(GPINSXL0) TOFILE(GPINSTXL0)                      *                       CGP001
      *****************************************************************
      *                                                               *
      *  Midas - Dealing Fixed Data Module                            *
      *                                                               *
      *  FD0650M - Midas Edit Deal Types/Subtypes                     *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CGL165             Date 17Feb15               *
      *  Prev Amend No. CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 AR1068283          Date 19Aug14               *
      *                 MD023642           Date 21Nov13               *
      *                 207288             Date 17Jul12               *
      *                 AR921326           Date 24Feb12               *
      *                 AR795970           Date 05Jul11               *
      *                 AR787620           Date 10Jun11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23955A          Date 21May09               *
      *                 BUG23955           Date 11May09               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK027             Date 30Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 BUG11551           Date 20Jun06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10816           Date 09Mar06               *
      *                 BUG10791           Date 08Mar06               *
      *                 BUG10153           Date 01Feb06               *
      *                 CAS011             Date 16May05               *
      *                 231563             Date 10Jan05               *
      *                 CAS009             Date 04May04               *
      *                 CDL038             Date 10May05               *
      *                 CDL033             Date 10Feb05               *
      *                 BUG6307            Date 18Mar05               *
      *                 CAS008             Date 16Jun04               *
      *                 BUG5677            Date 01Feb05               *
      *                 BUG3039            Date 10Jun04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL014             Date 20Oct03               *
      *                 CDL019             Date 09Feb04               *
      *                 BG0257             Date 23May03               *
      *                 CGP001             Date 23May03               *
      *                 CRE008             Date 10Apr02               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAS001             Date 23Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      *                 180781             Date 25Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 151162             Date 23May00               *
      *                 CFT008             Date 04Jan00               *
      *                 CFT006             Date 20Oct99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             DATE 29Jun99               *
      *                 165341             DATE 13Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CDL006             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPL002             Date 08Mar99               *
      *                 107662             Date 09Jun98               *
      *                 096515             DATE 26FEB97               *
      *                 101310             DATE 04JUL96               *
      *                 093958             DATE 20OCT95               *
      *                 S01408             DATE 12DEC95               *
      *                 S01408             DATE 06MAR95               *
      *                 S01486             DATE 08NOV94               *
      *                 057329             DATE 05NOV93               *
      *                 053717             DATE 13SEP93               *
      *                 AUS011             DATE 18JUN92               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  AR1068283 - Description field is 35 long not 30 long         *
      *              Applied for MD021909A (Recompile)                *
      *  MD023642 - Deal Type/Subtype Maintenance errors.             *
      *           - Instrument Type not available even if CGL014      *
      *             is switched 'ON'.                                 *
      *  207288 - Display spot indicator.                             *
      *           Applied for AR999664 (Child: AR999668)              *
      *  AR921326 - Fix Base Rate field was not updated (Recompile)   *
      *  AR795970 - Change §24c to plain 24c (Recompile)              *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,FDH00019                                 *
      *             WNCPYSRC,FDH00020                                 *
      *             WNCPYSRC,FDH00021                                 *
      *             WNCPYSRC,FDH00022                                 *
      *             WNCPYSRC,FDH00023                                 *
      *             WNCPYSRC,FDH00024                                 *
      *             WNCPYSRC,FDH00025                                 *
      *             WNCPYSRC,FDH00026                                 *
      *             WNCPYSRC,FDH00027                                 *
      *             WNCPYSRC,FDH00028                                 *
      *             WNCPYSRC,FDH00029                                 *
      *             WNCPYSRC,FDH00030                                 *
      *             WNCPYSRC,FDH00033                                 *
      *             WNCPYSRC,FDH00031                                 *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *         - LT045 Cannot amend deal type sub-type.              *
      *  BUG23955A - 24c must be in lower case (Recompile).           *
      *  BUG23955 - New Field show correct symbol "§" (Recompile)     *
      *             DSPF Modification                                 *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *  CPK027 - External field name entry is longer than six(6)     *
      *           characters                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG11551 - Deletion is not allowed (Recompile)               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10816 - Product Code is missing (Recompile)               *
      *  BUG10791 -Include CF deal type in validating Amortised Cost  *
      *            Accounting.                                        *
      *  BUG10153 -Errors in validation of deal type/sub-type/class   *
      *  CAS011 - EIR/AC Accouting Upgrade to MP1                     *
      *  231563 - Additional Validation For ACAI                      *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CDL038 - Extended Deal Sub Type                              *
      *  CDL033 - Floating Rate CDs Issued                            *
      *  BUG6307- Global Product and Instrument should be non-manda-  *
      *           tory.                                               *
      *  CAS008 - IAS 39 Enhancements                                 *
      *  BUG5677- Global Instrument Code is not mandatory if          *
      *           Management Limit (CGP003) is OFF.                   *
      *  BUG3039 - Webfacing Changes. Recompile.                      *
      *  CLE025 - Credit Lines                                        *
      *  CGL014 - Collateral Processing                               *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *  BG0257 - Errors in Deal Type/Sub Type input                  *
      *           (Display file changed)                              *
      *  CGP001 - Global Processing                                   *
      *  CRE008 - Cash Management                                     *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *  CAS001 - Net Present Value (NPV) Accounting                  *
      *  180781 - Only check instrument type if Private Banking is    *
      *           switched on.                                        *
      *  151162 - Add deal type NX for nostro transfers               *
      *  CFT008 - MT102 message addition for outgoing/incoming CCT    *
      *  CFT006 - MT101 message addition for outgoing/incoming RFT    *
      *  CPB001 - 'Private Banking' Module                            *
      *  165341 - Amend validation routine. Endif statement moved as  *
      *           it is preventing the main validation codes from     *
      *           being executed.                                     *
      *  CDL006 - Dealing Fiduciary.                                  *
      *  CPL002 - Addition of Midas-Plato Interface fields.           *
      *  107662 - Add FRA/IRS Deal types to list.                     *
      *  096515 - Program failed to pass the retrieved instrument     *
      *           type from AOPLINR0. Wrong values being written to   *
      *           file. Also, Message queue being cleared abnormally. *
      *  101310 - Deletion should not be allowed when the system      *
      *           set up is complete.                                 *
      *  093958 - Add extra payment types fpr Funds Transfer. Extra   *
      *           types are 'IN' 'CC' 'CP' 'NT' and 'RP' - 'OP' is    *
      *           already included as it used for Options in FX as    *
      *           well as Outgpong Payments in FT, but deal type 'OP' *
      *           in FX is rarely used so shouldn't cause a problem.  *
      *  S01408 - Addition of core hooks FD0650MFP1                   *
      *                                  FD0650MC10                   *
      *                                  FD0650MC11                   *
      *  S01408 - Addition of core hooks FD0650MCP9                   *
      *                                  FD0650MCP1                   *
      *                                  FD0650MCP2                   *
      *                                  FD0650MCP3 (3 times)         *
      *                                  FD0650MCP4                   *
      *                                  FD0650MCP5 (3 times)         *
      *                                  FD0650MCP6                   *
      *                                  FD0650MCP7                   *
      *                                  FD0650MCP8                   *
      *                                  FD0650MCPG                   *
      *                                  FD0650MADU                   *
      *                                  FD0650MCAU                   *
      *                                  FD0650MDAU                   *
      *                                  FD0650MFPG                   *
      *                                  FD0650MIPG                   *
      *                                  FD0650MVSF                   *
      *  S01486 - Portfolio Management Upgrade to Release 10.         *
      *  057329 - Add internal contract deal types PS, ID, & IL.      *
      *  053717 - Allow input of deal type/subtype combinations for   *
      *           NA'S purchased/sold.                                *
      *           NAP'S - C1 C2 BP BD TB DA TA                        *
      *           NAS'S - CS BS BR TS RA TR                           *
      *           Synon generated header information replaced         *
      *           by Standard Header Box.                             *   AUS011
      *  AUS011 - AUSTRALIAN PRODUCT - DEAL TYPE/SUB TYPE VALIDATION  *   AUS011
      *                                                               *
      *****************************************************************
      *                                                                   S01408
     F/COPY WNCPYSRC,FD0650MFP1                                           S01408
      *                                                                   S01408
     FFD0650M#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Edit Deal type/subtypes   Edit file
      *
     FFDDTSTL1IF  E           K        DISK
     F                                              KINFDS INFDS1
     F            FDDTSTPD                          KRENAME@FDDTST1
      * RTV: Deal types/subtypes       Retrieval index
     F/COPY WNCPYSRC,FDH00019
      *
     F*SDDLSTL1IF**E***********K********DISK                                                  CDL038
      **RTV:*Deal*subtypes*************Retrieval index                                        CDL038
      **********************************                                                      CDL038
     FFDDTSTL0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
     F            FDDTSTPD                          KRENAME@FDDTST0
      * UPD: Deal types/sub types      Update index
      *
     FFDDTSTYTIF  E           K        DISK                                                   207288
     F            FDDTSTD0                          KRENAMERTVIDX                             207288
      *                                                                                       207288
     FFDDTSTXTUF  E           K        DISK         KCOMIT       A    UC                      207288
     F            FDDTSTD0                          KRENAMEUPDIDX                             207288
      *                                                                                       207288
     FGPPRDXL0UF  E           K        DISK                      A    UC                      CGP001
     F                                              KINFSR *PSSR                              CGP001
     F            GPPRODXD0                         KRENAMEGPPRDXD0                           CGP001
     F                                              KCOMIT                                    CGP001
      ** Midas GP Global Products X-Reference                                                 CGP001
      *                                                                                       CGP001
     FGPINSXL0UF  E           K        DISK                      A    UC                      CGP001
     F                                              KINFSR *PSSR                              CGP001
     F            GPINSTXD0                         KRENAMEGPINSXD0                           CGP001
     F                                              KCOMIT                                    CGP001
      ** Midas GP Global Instruments X-Reference                                              CGP001
      *                                                                                       CGP001
     FSCSARPL1IF  E           K        DISK                                                   231563
      ** Midas SC Switchable Feature Initialisation PGM index                                 231563
      *                                                                                       231563
     F***DEALSL7 IF  E           K        DISK                                         231563 CAS011
     FDEALSL10IF  E           K        DISK                                                   CAS011
      ** Midas DL DEALSDB/DEALSDC by Deal Type/Sub Type                                       231563
     F*                                                                   S01408
     F/COPY WNCPYSRC,FD0650MFPG                                           S01408
     F*                                                                   S01408
     E********************TXT     1   2 78                                101310
     E                    TXT     1   3 78                                101310
     E* Description     : Copyright notice for inclusion in all programs
     E*
     E********************************************************************
     E                    CPY@    1   1 80               Copyright     array
     E                    @CN     1  23 25               Long constants.
     E                    OVRC    1   2 80                                                    CGP001
      ** Override Command Array                                                               CGP001
      *                                                                                       CGP001
     E                    @DL     1  14  2               Deal types                           CAS009
     I*
     I* Description     : Copyright notice for inclusion in all programs
     I*
      /EJECT
     I/COPY WNCPYSRC,FD0650MI01
     I              'GOGETZONE'           C         GOPGM                                     CGP001
     I              'ERROR IN GOGETZONE'  C         GOMSG                                     CGP001
      ** Global Processing Constants                                                          CGP001
      *                                                                                       CGP001
      * Data structures:-
     ISDDLST    E DSSDDLSTPD                                                                  CDL038
     I** Dummy record format for access to Deal Sub-Types                                     CDL038
     I*                                                                                       CDL038
     ISDTCLS    E DSSDTCLSPD                                                                  CDL038
     I** Dummy record format for access to Transaction Classes                                CDL038
     I*                                                                                       CDL038
     ISDPLIN    E DSSDPLINPD                                              S01486
     I** Dummy record format for access to Instrument Types               S01486
     I*                                                                   S01486
     ISDMMOD    E DSSDMMODPD                                              S01486
     I** Dummy record format for access to Modules File                   S01486
     I*                                                                   S01486
     ISDPORT    E DSSDPORTPD                                              S01486
     I** Dummy record format for Portfolio Management ICD Details.        S01486
     I*                                                                   S01486
     ILDA         DS                            256                                           CAS005
      ** Local data area for database error details                                           CAS005
      *                                                                                       CAS005
     ISCSARD    E DSSCSARDPD                                              CDL006
      ** Dummy record format for access to Switchable Features Details.   CDL006
      *                                                                   CDL006
     I/COPY WNCPYSRC,FD0650MI06
     IDSFDY     E DSDSFDY                                                 S01486
     I** First DS for access programs, short data structure               S01486
     I*                                                                   S01486
     IDSSDY     E DSDSSDY                                                 S01486
      **  Long data structure for access programs                         S01486
      *                                                                   S01486
     ISDYLDC    E DSSDYLDCPD                                                                  CAS001
      ** Dummy record format for access to Yield Curve files                                  CAS001
     I              FSYLDCA                         FYSLCA                                    CPK027
      *                                                                                       CAS001
     IGPPROD    E DSGPPRODPD                                                                  CGP001
     I              PDLCD                           PDGLCD                                    CGP001
     I              PDCHTP                          PDGCHT                                    CGP001
      ** Global Product Code Details Data Structure                                           CGP001
      *                                                                                       CGP001
     IGPINST    E DSGPINSTPD                                                                  CGP001
      ** Global Instrument Code Details Data Structure                                        CGP001
      *                                                                                       CGP001
     IPGMDS     ESDSY2PGDSP
      * Program data structure.
     I/COPY WNCPYSRC,FD0650MI03
     IJBDTTM      DS
      * Job date/time.
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS#    E DSY2I#DSP
      * Display file data structure.
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure.
      *
     I/COPY WNCPYSRC,FD0650MI04
     I@1DBRC    E DSFDDTSTL0
      * Current/previous master file format fields for change control.
      *
     I/COPY WNCPYSRC,FD0650MI05
     IRUNDAT      DS
     I                                        1   7 MRDT                  S01229
     I                                    P   8  100RDNB                  S01229
     I                                       11  11 SUC                   S01229
     I                                       12  12 DFF                   S01229
     I                                       13  13 MBIN                  S01229
     I/COPY WNCPYSRC,FD0650MI02
     IA@CPY       DS
     I* Copyright array
     I                                        1  80 CPY@
     I            DS
     I                                        1 132 ZAMSDA
     I*  Data structure for passing data to messages
     I                                        1  30 ZA0001
     I                                        1  30 ZA0003
     I*                                                                   S01408
     I/COPY WNCPYSRC,FD0650MIPG                                           S01408
     I*                                                                   S01408
      /EJECT
      *****************************************************************
     C           *ENTRY    PLIST                           Entry parameter
     C                     PARM           P0RTN   7        Return code
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page.
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested:
     C           W0RSF     DOWEQ'N'
      * Display screen.
     C                     EXSR CAEXFM
      * Process response:
      * Exit request: Cancel & exit program.
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload.
     C   05                CAS            FBRQRL
      *   Display next SFL page.
     C   27                CAS            BBLDSF
      * Process screen input.
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & Load subfile page.
      *================================================================
      * Clear subfile.
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile.
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile header
     C*                                                                   101310
     C                     MOVEL'N'       WUDELA           Deletion Allowe101310
      * CASE: WRK.Set Up Complete is No                                   101310
     C           WUSUC     IFEQ 'N'                        *IF            101310
      * CASE: PGM.*Program mode is *CHANGE                                101310
     C           W0PMD     IFEQ 'CHG'                      *IF            101310
     C                     MOVEL'Y'       WUDELA           Deletion Allowe101310
     C                     END                             *FI            101310
     C                     END                             *FI            101310
     C*                                                                   101310
      * Set Up Function Key Text - Standard Functions  *
     C*
     C*  If program mode is ADD:                                          101310
     C*                                                                   101310
     C           W0PMD     IFEQ 'ADD'                                     101310
     C                     MOVEATXT,2     ##CTX1                          101310
     C                     ELSE                                           101310
     C*                                                                   101310
     C*  If set up is not complete:                                       101310
     C*                                                                   101310
     C           WUSUC     IFEQ 'N'                                       101310
     C/COPY WNCPYSRC,FD0650MC01
     C                     MOVEATXT,1     ##CTX1                          101310
     C/COPY WNCPYSRC,FD0650MC02
     C                     ELSE                                           101310
     C                     MOVEATXT,3     ##CTX1                          101310
     C                     END                                            101310
     C                     END                                            101310
     C*                                                                   101310
     C***********W0PMD     IFEQ 'CHG'                                     101310
     C***********          MOVEATXT,1     ##CTX1                    S01229101310
     C***********          END                                            101310
     C***********W0PMD     IFEQ 'ADD'                                     101310
     C***********          MOVEATXT,2     ##CTX1                    S01229101310
     C***********          END                                            101310
     C*                                                                   101310
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           *LIKE     DEFN #2DTPE    WZDTPE
     C                     MOVEL#2DTPE    WZDTPE           Deal type
     C           *LIKE     DEFN #2DLST    WZDLST
     C                     MOVEL#2DLST    WZDLST           Subtype
     C           *LIKE     DEFN #2CLAS    WZCLAS                                              CDL038
     C                     MOVEL#2CLAS    WZCLAS           Class                              CDL038
     C           KPOS      KLIST
     C                     KFLD           DTPE11           Deal type
     C                     KFLD           DLST11           Deal type
     C                     KFLD           CLAS11           Class                              CDL038
      * Setup key.
     C                     MOVEL#2DTPE    DTPE11           Deal type
     C                     MOVEL#2DLST    DLST11           Deal type
     C                     MOVEL#2CLAS    CLAS11           Class                              CDL038
     C/COPY WNCPYSRC,FD0650MC37
     C           KPOS      SETLL@FDDTST1             82    *82=EOF
     C  N82                READ @FDDTST1               9182*82=EOF
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCPG                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page.
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message.
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     END                             FI ##RR = *ZERO
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode).
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record.
     C   27      W0PMD     IFNE 'ADD'
     C/COPY WNCPYSRC,FD0650MC38
     C  N82                READP@FDDTST1                 90*
     C  N82                READ @FDDTST1                 90*
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP1                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C/COPY WNCPYSRC,FD0650MC33
      * Setof record error indicators.
     C***********          MOVE *ALL'0'   WKIND0  5                       S01486
     C*********************MOVE *ALL'0'   WKIND0  6                       S01486              CDL038
     C**********           MOVE *ALL'0'   WKIND0  9                                    CDL038 207288
     C**********           MOVE *ALL'0'   WKIND0 10                                  207288 MD023642
     C                     MOVE *ALL'0'   WKIND0  9                                         MD023642
     C/COPY WNCPYSRC,FD0650MC27
      * Start at previous highest SFL record reached.
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      *................................................................
      * Load next page of SFL:
     C  N82      ##RROK    DOWLT##SFPG                     DO
     C/COPY WNCPYSRC,FD0650MC18
     C*********************MOVEAWKIND0    *IN,32                                              CDL038
     C                     MOVEAWKIND0    *IN,30                                              CDL038
     C/COPY WNCPYSRC,FDH00020
     C                     MOVE *OFF      *IN71                                               CAS001
     C                     MOVE *OFF      *IN72                                               CAS001
     C                     MOVE *OFF      *IN73                                               CAS001
     C                     MOVE *OFF      *IN74                                               CAS005
     C                     MOVE *OFF      *IN75                                               CAS005
     C                     MOVE *OFF      *IN76                                               CAS005
     C                     MOVE *OFF      *IN41                                               CGP001
     C                     MOVE *OFF      *IN42                                               CGP001
     C                     MOVE *OFF      *IN58                                               CDL019
     C                     MOVE *OFF      *IN61                                               CAS008
     C                     MOVE *OFF      *IN62                                               CAS008
     C                     MOVE *OFF      *IN63                                               CAS008
     C                     MOVE *OFF      *IN69                                               CAS009
      *                                                                                       CER047
     C           CER047    IFEQ 'Y'                                                           CER047
     C                     SETOF                     45                                       CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP3                                           S01408
     C*                                                                   S01408
     C                     SETOF                     87    *
      * Clear SFL fields.
     C                     EXSR MAIZ#1
      * If change mode, load SFL fields.
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Record will be selected unless overridden.
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record (existing record)
     C*********************MOVEL@CN,01    WUDELA           Deletion Allowe101310
     C                     MOVEL@CN,01    WUAMAL           Amend allowed
      * If record dropped...
     C           W0RSL     CABNE'Y'       BB020
      * Validate subfile record and calculate derived fields.
     C                     EXSR DFV2RC
     C                     ELSE
      * USER: Initialise subfile record (new record)
     C                     MOVEL@CN,01    WUAMAL           Amend allowed
      *CASE:     PGM.*Program mode is *ADD
     C           W0PMD     IFEQ @CN,06                     *IF
     C                     MOVEL@CN,05    WUDELA           Deletion Allowe
     C                     END                             *FI
     C                     END
      * Output to subfile.
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators.
     C                     EXSR GADSA1
      *                                                                   S01408
     C/COPY WNCPYSRC,FD0650MC10                                           S01408
      *                                                                   S01408
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
     C/COPY WNCPYSRC,FD0650MC39
     C                     READ @FDDTST1                 82*82=EOF
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP2                                           S01408
     C*                                                                   S01408
     C                     END
     C  N82                END                             OD 1 - #SFPG
      *................................................................
      * Save highest SFL rec, so load can continue at end point.
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
     C/COPY WNCPYSRC,FD0650MC14
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests.
      *================================================================
      * Set screen conditioning indicators.
     C                     EXSR GBDSA2
      * Update screen time.
     C                     TIME           ##TME            Screen time.
     C           W0HLP     DOUEQ'N'
      * PUTOVR unless conditioned fields change.
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
     C                     MOVEL'N'       W0HLP   1        Reset help requ
      * If help requested, display help text.
     C   25                EXSR ZHHPKY                     Display help te
     C                     END
      * Update job time.
     C                     TIME           ##JTM            Job time.
      * Clear messages from program message queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag.
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input.
      *================================================================
      * Maintain subfile position where possible.
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      *
     C           W0PMD     IFNE 'ADD'
      * Change of position specified?
     C           WZDTPE    CASNE#2DTPE    FBRQRL           Deal type
     C           WZDLST    CASNE#2DLST    FBRQRL           Subtype
     C           WZCLAS    CASNE#2CLAS    FBRQRL           Class                              CDL038
     C                     END
     C                     END
      * Quit if reload requested.
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet.
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not defered.
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records.
     C                     EXSR DBPRSF
      * If error, exit:
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested:
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered.
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile.
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END                             OD 81
      *=====Process function keys=====
     C/COPY WNCPYSRC,FD0650MC03
      * Switch between *ADD/*CHANGE modes.
     C   09                EXSR FACHMD
     C/COPY WNCPYSRC,FD0650MC04
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile records.
      *================================================================
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators.
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record.
      *================================================================
      * Setoff error indicators.
     C/COPY WNCPYSRC,FD0650MC19
     C*********************MOVEAWKIND0    *IN,32                                              CDL038
     C                     MOVEAWKIND0    *IN,30                                              CDL038
     C/COPY WNCPYSRC,FDH00021
     C                     MOVE *OFF      *IN71                                               CAS001
     C                     MOVE *OFF      *IN72                                               CAS001
     C                     MOVE *OFF      *IN73                                               CAS001
     C                     MOVE *OFF      *IN74                                               CAS005
     C                     MOVE *OFF      *IN75                                               CAS005
     C                     MOVE *OFF      *IN76                                               CAS005
     C                     MOVE *OFF      *IN41                                               CGP001
     C                     MOVE *OFF      *IN42                                               CGP001
     C                     MOVE *OFF      *IN58                                               CDL019
     C                     MOVE *OFF      *IN61                                               CAS008
     C                     MOVE *OFF      *IN62                                               CAS008
     C                     MOVE *OFF      *IN63                                               CAS008
     C                     MOVE *OFF      *IN69                                               CAS009
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP3                                           S01408
     C*                                                                   S01408
     C                     SETOF                     98    No errors
     C                     SETOF                     84    NO SFLNXTCHG
     C           W0PMD     IFEQ 'ADD'
      * Check for null record.
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue.
     C                     END
     C                     MOVEL'Y'       WKIPIN           Data entered
     C                     SETON                     84    *SFLNXTCHG
      * If delete request, bypass validation.
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
     C/COPY WNCPYSRC,FD0650MC05
      * Validate subfile record.
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact.
     C   98N99             Z-ADD##RR      ##SFRC     99    Invalid SFLRCD
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record.
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #1DTPE    CABNE*BLANK    DDEXIT           Deal type
     C           #1DLST    CABNE*BLANK    DDEXIT           Subtype
     C           #1CLAS    CABNE*BLANK    DDEXIT           Class                              CDL038
     C           #1NARR    CABNE*BLANK    DDEXIT           Description of
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP4                                           S01408
     C*                                                                   S01408
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record.
      *================================================================
      * USER: Validate subfile record fields
     C/COPY WNCPYSRC,FD0650MC08
      *                                                                   S01486
      ** Validate Instrument type                                         S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL014    OREQ 'Y'                                                           CGL014
     C           CLE025    OREQ 'Y'                                                           CLE025
     C           #1INNR    IFNE *BLANK                                    S01486
     C                     CALL 'AOPLINR0'                                S01486
     C                     PARM '*MSG   ' @RTCD   7                       S01486
     C                     PARM '*KEY   ' @OPTN   7                       S01486
     C                     PARM #1INNR    @INNR   3                       S01486
     C           SDPLIN    PARM SDPLIN    DSSDY                           S01486
      *                                                                   S01486
     C**Clear*messages*from*program*message*queue.*****************S01486 096515
     C*********            CALL 'Y2CLMSC'                          S01486 096515
     C*********            PARM ##PGM     ZAPGM  10                S01486 096515
     C*********            PARM '*SAME'   ZAPGRL  5                S01486 096515
     C**Reset*first*message*only*flag.*****************************S01486 096515
     C*********            MOVEL'Y'       ZAFSMS  1      99*       S01486 096515
     C*                                                                   096515
     C** Pass the value retrieved from AOPLINR0.                          096515
     C*                                                                   096515
     C                     MOVEL@INNR     #1INNR                          096515
      *                                                                   S01486
      ** Instrument Type invalid                                          S01486
     C           @RTCD     IFEQ '*NRF'                                    S01486
     C           #1INNR    ANDNE'?'                                       S01486
     C                     SETON                     9837  *              S01486
     C                     MOVE *BLANKS   ZAMSGF           Message file.  S01486
     C******               MOVEL'USR4272' ZAMSID           Message S01486 CPB001
     C                     MOVEL'USR4523' ZAMSID           Message id.    CPB001
     C                     EXSR ZASNMS                     Send message   S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          S01486
     C                     ENDIF                                          165341
      *----------------------------------------------------------------   S01486
      *CASE:     PGM.*Program mode is *ADD
     C           W0PMD     IFEQ @CN,06                     *IF
     C                     MOVEL#1DTPE    WUTQKF           Test ? in Key F
      *CASE:     WRK.Test ? in Key Field is Question Mark
     C           WUTQKF    IFEQ @CN,07                     *IF
     C                     MOVEL@CN,08    W0RTN            *Return code
      * Send message 'Question Mark Invalid'
     C                     MOVEL'USR0380' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     SETON                     9834  *
      *
     C                     END                             *FI
     C*********************MOVEL#1DLST    WUTQKF           Test ? in Key F                    CDL038
      *CASE:*****WRK.Test*? in Key Field is Question Mark                                     CDL038
     C***********WUTQKF****IFEQ @CN,07                     *IF                                CDL038
     C*********************MOVEL@CN,08    W0RTN            *Return code                       CDL038
      **Send*message*'Question Mark Invalid'                                                  CDL038
     C*********************MOVEL'USR0380' ZAMSID           Message id.                        CDL038
     C*********************EXSR ZASNMS                     Send message                       CDL038
     C*********************SETON                     9835  *                                  CDL038
      *********************                                                                   CDL038
     C*********************END                             *FI                                CDL038
     C                     END                             *FI
      * Validate subfile record relations.
     C                     EXSR DFV2RC
      * Deal type required.
     C           #1DTPE    IFEQ *BLANK                     IF
     C                     SETON                     9834  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     END                             FI
      * Subtype required.
     C           #1DLST    IFEQ *BLANK                     IF
     C                     SETON                     9835  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     END                             FI
      * Class required. (NOT FT TYPES OR CM)                                                  CDL038
     C           #1CLAS    IFEQ *BLANK                     IF                                 CDL038
     C           CDL038    ANDEQ'Y'                                                           CDL038
     C           #1DTPE    ANDNE'OP'                                                        BUG10153
     C           #1DTPE    ANDNE'IN'                                                        BUG10153
     C           #1DTPE    ANDNE'CC'                                                        BUG10153
     C           #1DTPE    ANDNE'CP'                                                        BUG10153
     C           #1DTPE    ANDNE'NT'                                                        BUG10153
     C           #1DTPE    ANDNE'RP'                                                        BUG10153
     C           #1DTPE    ANDNE'RI'                                                        BUG10153
     C           #1DTPE    ANDNE'RO'                                                        BUG10153
     C           #1DTPE    ANDNE'BI'                                                        BUG10153
     C           #1DTPE    ANDNE'BO'                                                        BUG10153
     C           #1DTPE    ANDNE'CM'                                                        BUG10153
     C                     SETON                     9838  *                                  CDL038
      * Send message '*Value required'                                                        CDL038
     C                     MOVEL'Y2U0001' ZAMSID           Message id.                        CDL038
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.                      CDL038
     C                     EXSR ZASNMS                     Send message                       CDL038
     C                     END                             FI                                 CDL038
      * Class NOT required.  (FT TYPES AND CM)                                              BUG10153
     C           #1CLAS    IFNE *BLANK                     IF                               BUG10153
     C           CDL038    ANDEQ'Y'                                                         BUG10153
     C           #1DTPE    IFEQ 'IN'                                                        BUG10153
     C           #1DTPE    OREQ 'CC'                                                        BUG10153
     C           #1DTPE    OREQ 'CP'                                                        BUG10153
     C           #1DTPE    OREQ 'NT'                                                        BUG10153
     C           #1DTPE    OREQ 'RI'                                                        BUG10153
     C           #1DTPE    OREQ 'RO'                                                        BUG10153
     C           #1DTPE    OREQ 'BI'                                                        BUG10153
     C           #1DTPE    OREQ 'BO'                                                        BUG10153
     C           #1DTPE    OREQ 'CM'                                                        BUG10153
     C                     SETON                     9838  *                                BUG10153
      * Send message '*Value not required'                                                  BUG10153
     C                     MOVEL'Y2U0002' ZAMSID           Message id.                      BUG10153
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.                    BUG10153
     C                     EXSR ZASNMS                     Send message                     BUG10153
     C                     END                                                              BUG10153
     C                     END                             FI                               BUG10153
      *----------------------------------------------------------------   S01486
      *                                                                   S01486
      ** Instrument type                                                  S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           CGL014    OREQ 'Y'                                                           CGL014
     C           CLE025    OREQ 'Y'                                                           CLE025
      *                                                                   S01486
      ** Process '?' processing                                           S01486
     C           #1INNR    IFEQ '?'                                       S01486
     C                     MOVELPDINNR    #1INNR                          S01486
     C                     ENDIF                                          S01486
     C***********          ENDIF                                    S01486180781
      *                                                                   S01486
      ** Default SDPORTPD Instrument Type.                                S01486
      ** Only if PM is ON                                                 CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C           CGL014    OREQ 'Y'                                                           CGL014
     C           CLE025    OREQ 'Y'                                                           CLE025
     C           #1INNR    IFEQ *BLANK                                    S01486
     C                     MOVE FCDINR    #1INNR                          S01486
     C                     ENDIF                                          S01486
     C                     ELSE                                           CPB001
      *                                                                   CPB001
      ** Instruement type must be entered                                 CPB001
     C           #1INNR    IFEQ *BLANK                                    CPB001
     C                     SETON                     9837  *              CPB001
     C                     MOVE *BLANKS   ZAMSGF           Message file.  CPB001
     C                     MOVEL'USR4524' ZAMSID           Message id.    CPB001
     C                     EXSR ZASNMS                     Send message   CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          180781
     C***********          ENDIF                                    S01486165341
      *                                                                                       CAS009
      ** If CAS009 is ON, validate Amortised Cost Accounting Indicator                        CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           #1ACAI    IFNE ' '                                                           CAS009
     C           #1ACAI    ANDNE'Y'                                                           CAS009
     C           #1ACAI    ANDNE'N'                                                           CAS009
     C                     MOVE *ON       *IN69                                               CAS009
     C                     MOVE *ON       *IN98                                               CAS009
      **Send message 'Valid values are 'Y', 'N' and blank'                                    CAS009
     C                     MOVEL'USR9155' ZAMSID           Message id.                        CAS009
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      CAS009
     C                     EXSR ZASNMS                     Send message                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C           #1ACAI    IFEQ 'Y'                                                           CAS009
     C           #1ACAI    OREQ 'N'                                                           CAS009
      *                                                                                       CAS009
     C           #1DTPE    LOKUP@DL                      85                                   CAS009
      *                                                                                       CAS009
     C           *IN85     IFEQ *OFF                                                          CAS009
     C           CDL033    ANDEQ'N'                                                         BUG10791
     C**********           MOVEL'USR9651' ZAMSID           Message id.                 CAS009 CAS011
     C                     MOVEL'CAS0017' ZAMSID           Message id.                        CAS011
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      CAS009
     C                     EXSR ZASNMS                     Send message                       CAS009
     C                     MOVE *ON       *IN69                                               CAS009
     C                     MOVE *ON       *IN98                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                     BUG10791
     C           *IN85     IFEQ *OFF                                                        BUG10791
     C           CDL033    ANDEQ'Y'                                                         BUG10791
     C           #1DTPE    ANDNE'CF'                                                        BUG10791
     C                     MOVEL'CAS0018' ZAMSID                                            BUG10791
     C                     MOVEL'SDUSRMSG'ZAMSGF                                            BUG10791
     C                     EXSR ZASNMS                                                      BUG10791
     C                     MOVE *ON       *IN69                                             BUG10791
     C                     MOVE *ON       *IN98                                             BUG10791
     C                     ENDIF                                                            BUG10791
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** If Initialisation program has run, do additional validation                          231563
     C           WCAS9I    IFEQ 'Y'                                                           231563
      *                                                                                       231563
      ** Retrieve Deal Type/Sub Type Record                                                   231563
     C           KDTST#    CHAINFDDTSTL1             70                                       231563
      *                                                                                       231563
     C           #1ACAI    IFNE FSACAI                                                        231563
      *                                                                                       231563
      ** Check If Deal Type/Sub Type is attached to a Live Deal.                              231563
      ** If it is, do not allow changing of ACAI                                              231563
     C********** KDTST#    CHAINDEALSL7              70                                231563 CAS011
     C           KDTST#    CHAINDEALSL10             70                                       CAS011
     C           *IN70     IFEQ *OFF                                                          231563
     C                     MOVEL'USR9652' ZAMSID           Message id.                        231563
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      231563
     C                     EXSR ZASNMS                     Send message                       231563
     C                     MOVE *ON       *IN69                                               231563
     C                     MOVE *ON       *IN98                                               231563
     C                     ENDIF                                                              231563
      *                                                                                       231563
     C                     ENDIF                                                              231563
      *                                                                                       231563
     C                     ENDIF                                                              231563
      *                                                                                       231563
     C           CER047    IFEQ 'Y'                                                           CER047
      *                                                                                       CER047
     C           #1K24C    IFNE 'Y'                                                           CER047
     C           #1K24C    ANDNE'N'                                                           CER047
      *                                                                                       CER047
     C                     SETON                     9845                                     CER047
      *                                                                                       CER047
      ** Send Message                                                                         CER047
      *                                                                                       CER047
     C                     MOVEL'USR3973' ZAMSID                                              CER047
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CER047
     C                     EXSR ZASNMS                                                        CER047
      *                                                                                       CER047
     C                     ELSE                                                               CER047
     C                     SETOF                     45                                       CER047
      *                                                                                       CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C/COPY WNCPYSRC,FD0650MC09
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations.
      *================================================================
      * USER: Validate subfile record relations
      *CASE:     RCD.Description of Deal type/subtype is *blank
     C           #1NARR    IFEQ *BLANK                     *IF
      * Setup message data for message.
     C                     MOVEL#1NARR    ZA0003           Description of
      * Send message 'Description not entered'
     C           CDL038    IFNE 'Y'                                                           CDL038
     C                     MOVEL'USR1776' ZAMSID           Message id.
     C                     MOVEL'GBMIDAS' ZAMSGF           Message file.
     C                     ELSE                                                               CDL038
     C                     MOVEL'USR9010' ZAMSID           Message id.                        CDL038
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      CDL038
     C                     ENDIF                                                              CDL038
     C                     EXSR ZASNMS                     Send message
     C                     SETON                     9836  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,FD0650MC34
      *CASE:     RCD.Subtype is invalid
     C***********KLDLST****KLIST                                                              CDL038
     C*********************KFLD           #1DLST                                              CDL038
     C***********KLDLST****CHAINSDDLSTL1             91                                       CDL038
     C************IN91*****IFEQ '1'                                                           CDL038
     C                     CALL 'AODLSTR0'                                                    CDL038
     C                     PARM *BLANK    P@RTCD  7                                           CDL038
     C                     PARM '*KEY   ' P@OPTN  7                                           CDL038
     C                     PARM #1DLST    P@DLST  2                                           CDL038
     C                     PARM           SDDLST                                              CDL038
     C           P@RTCD    IFEQ '*NRF   '                                                     CDL038
      * Send message 'Subtype invalid'
     C                     MOVEL'USR1777' ZAMSID           Message id.
     C                     MOVEL'GBMIDAS' ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     SETON                     9835  *
     C                     ELSE                                                               CDL038
     C                     MOVELASDSTC    #1DLST                                              CDL038
     C                     END                             *FI
      * Send message 'Class invalid' if blank and shouldn't be.                             BUG10153
     C           CDL038    IFEQ 'Y'                        IF                               BUG10153
     C           #1CLAS    IFEQ *BLANK                                                      BUG10153
     C           #1DTPE    ANDNE'OP'                                                        BUG10153
     C           #1DTPE    ANDNE'IN'                                                        BUG10153
     C           #1DTPE    ANDNE'CC'                                                        BUG10153
     C           #1DTPE    ANDNE'CP'                                                        BUG10153
     C           #1DTPE    ANDNE'NT'                                                        BUG10153
     C           #1DTPE    ANDNE'RP'                                                        BUG10153
     C           #1DTPE    ANDNE'RI'                                                        BUG10153
     C           #1DTPE    ANDNE'RO'                                                        BUG10153
     C           #1DTPE    ANDNE'BI'                                                        BUG10153
     C           #1DTPE    ANDNE'BO'                                                        BUG10153
     C           #1DTPE    ANDNE'CM'                                                        BUG10153
     C                     SETON                     9838  *                                BUG10153
     C                     MOVEL'USR9012' ZAMSID           Message id.                      BUG10153
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                    BUG10153
     C                     EXSR ZASNMS                     Send message                     BUG10153
     C                     END                                                              BUG10153
      * Send message 'Class invalid' if not blank and should be.                            BUG10153
     C           #1CLAS    IFNE *BLANK                                                      BUG10153
     C           #1DTPE    IFEQ 'IN'                                                        BUG10153
     C           #1DTPE    OREQ 'CC'                                                        BUG10153
     C           #1DTPE    OREQ 'CP'                                                        BUG10153
     C           #1DTPE    OREQ 'NT'                                                        BUG10153
     C           #1DTPE    OREQ 'RI'                                                        BUG10153
     C           #1DTPE    OREQ 'RO'                                                        BUG10153
     C           #1DTPE    OREQ 'BI'                                                        BUG10153
     C           #1DTPE    OREQ 'BO'                                                        BUG10153
     C           #1DTPE    OREQ 'CM'                                                        BUG10153
     C                     SETON                     9838  *                                BUG10153
      * Send message '*Value not required'                                                  BUG10153
     C                     MOVEL'USR9012' ZAMSID           Message id.                      BUG10153
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                    BUG10153
     C                     EXSR ZASNMS                     Send message                     BUG10153
     C                     END                                                              BUG10153
     C                     END                                                              BUG10153
     C                     END                             FI                               BUG10153
      *CASE:     RCD.Class is invalid                                                         CDL038
     C           CDL038    IFEQ 'Y'                                                           CDL038
     C***********W0PMD     IFEQ 'ADD'                                              CDL038   BUG10153
     C***********#1CLAS    ORNE *BLANK                                             CDL038   BUG10153
     C           #1CLAS    IFNE *BLANK                                                      BUG10153
     C                     CALL 'AOTCLSR0'                                                    CDL038
     C                     PARM *BLANK    P@RTCD  7                                           CDL038
     C                     PARM '*KEY   ' P@OPTN  7                                           CDL038
     C                     PARM #1CLAS    P@CLAS  4                                           CDL038
     C                     PARM           SDTCLS                                              CDL038
     C           P@RTCD    IFEQ '*NRF   '                                                     CDL038
      * Send message 'Class invalid'                                                          CDL038
     C                     MOVEL'USR9012' ZAMSID           Message id.                        CDL038
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      CDL038
     C                     EXSR ZASNMS                     Send message                       CDL038
     C                     SETON                     9838  *                                  CDL038
     C                     ELSE                                                               CDL038
     C                     MOVELTCCLAS    #1CLAS                                              CDL038
     C                     END                             *FI                                CDL038
     C                     END                             *FI                                CDL038
     C                     END                             *FI                                CDL038
      *                                                                   CFT006
     C                     MOVEL'N'       WERR    1                       CFT006
      *CASE:     RCD.Deal type is invalid
     C           #1DTPE    IFNE 'IT'                       *IF
     C           #1DTPE    ANDNE'IP'
     C           #1DTPE    ANDNE'TD'
     C           #1DTPE    ANDNE'TI'
     C           #1DTPE    ANDNE'CI'
     C           #1DTPE    ANDNE'LN'
     C           #1DTPE    ANDNE'CD'
     C           #1DTPE    ANDNE'CL'
     C           #1DTPE    ANDNE'DL'
     C           #1DTPE    ANDNE'FP'
     C           #1DTPE    ANDNE'FS'
     C           #1DTPE    ANDNE'CX'
     C           #1DTPE    ANDNE'PI'
     C           #1DTPE    ANDNE'SI'
     C           #1DTPE    ANDNE'OP'
     C           #1DTPE    ANDNE'OT'
     C           #1DTPE    ANDNE'SW'
     C           #1DTPE    ANDNE'C1'                                      053717
     C           #1DTPE    ANDNE'C2'                                      053717
     C           #1DTPE    ANDNE'BP'                                      053717
     C           #1DTPE    ANDNE'BD'                                      053717
     C           #1DTPE    ANDNE'TB'                                      053717
     C           #1DTPE    ANDNE'DA'                                      053717
     C           #1DTPE    ANDNE'TA'                                      053717
     C           #1DTPE    ANDNE'CS'                                      053717
     C           #1DTPE    ANDNE'BS'                                      053717
     C           #1DTPE    ANDNE'BR'                                      053717
     C           #1DTPE    ANDNE'TS'                                      053717
     C           #1DTPE    ANDNE'RA'                                      053717
     C           #1DTPE    ANDNE'TR'                                      053717
     C           #1DTPE    ANDNE'PS'                                      057329
     C           #1DTPE    ANDNE'ID'                                      057329
     C           #1DTPE    ANDNE'IL'                                      057329
     C           #1DTPE    ANDNE'IN'                                      093958
     C           #1DTPE    ANDNE'CC'                                      093958
     C           #1DTPE    ANDNE'CP'                                      093958
     C           #1DTPE    ANDNE'NT'                                      093958
     C           #1DTPE    ANDNE'RP'                                      093958
     C           #1DTPE    ANDNE'FR'                                      107662
     C           #1DTPE    ANDNE'RS'                                      107662
     C           #1DTPE    ANDNE'RX'                                      107662
     C           #1DTPE    ANDNE'RR'                                      107662
     C           #1DTPE    ANDNE'RF'                                      107662
     C           #1DTPE    ANDNE'NX'                                      151162
     C/COPY WNCPYSRC,FD0650MC53
     C***********CDL006    ANDEQ'N'                                 CDL006CFT006
     C                     MOVEL'Y'       WERR                            CFT006
     C                     ENDIF                                          CFT006
      *                                                                                       CDL033
     C           CDL033    IFEQ 'Y'                                                           CDL033
     C           #1DTPE    ANDEQ'CF'                                                          CDL033
     C                     MOVEL'N'       WERR                                                CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CDL033
      ***********                                                   CDL006CFT006
      ***If*CDL006*is*ON,*allow*also*deal*types*FL,DP,LP,FT,DT*and  CDL006CFT006
      ***********                                                   CDL006CFT006
     C***********CDL006    OREQ 'Y'                                 CDL006CFT006
     C***********#1DTPE    ANDNE'FL'                                CDL006CFT006
     C***********#1DTPE    ANDNE'DP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'LP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'FT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'DT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'LT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'IT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'IP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TD'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TI'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CI'                                CDL006CFT006
     C***********#1DTPE    ANDNE'LN'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CD'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CL'                                CDL006CFT006
     C***********#1DTPE    ANDNE'DL'                                CDL006CFT006
     C***********#1DTPE    ANDNE'FP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'FS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CX'                                CDL006CFT006
     C***********#1DTPE    ANDNE'PI'                                CDL006CFT006
     C***********#1DTPE    ANDNE'SI'                                CDL006CFT006
     C***********#1DTPE    ANDNE'OP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'OT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'SW'                                CDL006CFT006
     C***********#1DTPE    ANDNE'C1'                                CDL006CFT006
     C***********#1DTPE    ANDNE'C2'                                CDL006CFT006
     C***********#1DTPE    ANDNE'BP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'BD'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TB'                                CDL006CFT006
     C***********#1DTPE    ANDNE'DA'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TA'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'BS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'BR'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RA'                                CDL006CFT006
     C***********#1DTPE    ANDNE'TR'                                CDL006CFT006
     C***********#1DTPE    ANDNE'PS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'ID'                                CDL006CFT006
     C***********#1DTPE    ANDNE'IL'                                CDL006CFT006
     C***********#1DTPE    ANDNE'IN'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CC'                                CDL006CFT006
     C***********#1DTPE    ANDNE'CP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'NT'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RP'                                CDL006CFT006
     C***********#1DTPE    ANDNE'FR'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RS'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RX'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RR'                                CDL006CFT006
     C***********#1DTPE    ANDNE'RF'                                CDL006CFT006
      *                                                                   CFT006
      ** If CDL006 is ON, allow also deal types FL,DP,LP,FT,DT and LT.    CFT006
      *                                                                   CFT006
     C           CDL006    IFEQ 'Y'                                       CFT006
     C           #1DTPE    IFEQ 'FL'                                      CFT006
     C           #1DTPE    OREQ 'DP'                                      CFT006
     C           #1DTPE    OREQ 'LP'                                      CFT006
     C           #1DTPE    OREQ 'FT'                                      CFT006
     C           #1DTPE    OREQ 'DT'                                      CFT006
     C           #1DTPE    OREQ 'LT'                                      CFT006
     C           #1DTPE    OREQ 'IT'                                      CFT006
     C           #1DTPE    OREQ 'IP'                                      CFT006
     C           #1DTPE    OREQ 'TD'                                      CFT006
     C           #1DTPE    OREQ 'TI'                                      CFT006
     C           #1DTPE    OREQ 'CI'                                      CFT006
     C           #1DTPE    OREQ 'LN'                                      CFT006
     C           #1DTPE    OREQ 'CD'                                      CFT006
     C           #1DTPE    OREQ 'CL'                                      CFT006
     C           #1DTPE    OREQ 'DL'                                      CFT006
     C           #1DTPE    OREQ 'FP'                                      CFT006
     C           #1DTPE    OREQ 'FS'                                      CFT006
     C           #1DTPE    OREQ 'CX'                                      CFT006
     C           #1DTPE    OREQ 'PI'                                      CFT006
     C           #1DTPE    OREQ 'SI'                                      CFT006
     C           #1DTPE    OREQ 'OP'                                      CFT006
     C           #1DTPE    OREQ 'OT'                                      CFT006
     C           #1DTPE    OREQ 'SW'                                      CFT006
     C           #1DTPE    OREQ 'C1'                                      CFT006
     C           #1DTPE    OREQ 'C2'                                      CFT006
     C           #1DTPE    OREQ 'BP'                                      CFT006
     C           #1DTPE    OREQ 'BD'                                      CFT006
     C           #1DTPE    OREQ 'TB'                                      CFT006
     C           #1DTPE    OREQ 'DA'                                      CFT006
     C           #1DTPE    OREQ 'TA'                                      CFT006
     C           #1DTPE    OREQ 'CS'                                      CFT006
     C           #1DTPE    OREQ 'BS'                                      CFT006
     C           #1DTPE    OREQ 'BR'                                      CFT006
     C           #1DTPE    OREQ 'TS'                                      CFT006
     C           #1DTPE    OREQ 'RA'                                      CFT006
     C           #1DTPE    OREQ 'TR'                                      CFT006
     C           #1DTPE    OREQ 'PS'                                      CFT006
     C           #1DTPE    OREQ 'ID'                                      CFT006
     C           #1DTPE    OREQ 'IL'                                      CFT006
     C           #1DTPE    OREQ 'IN'                                      CFT006
     C           #1DTPE    OREQ 'CC'                                      CFT006
     C           #1DTPE    OREQ 'CP'                                      CFT006
     C           #1DTPE    OREQ 'NT'                                      CFT006
     C           #1DTPE    OREQ 'RP'                                      CFT006
     C           #1DTPE    OREQ 'FR'                                      CFT006
     C           #1DTPE    OREQ 'RS'                                      CFT006
     C           #1DTPE    OREQ 'RX'                                      CFT006
     C           #1DTPE    OREQ 'RR'                                      CFT006
     C           #1DTPE    OREQ 'RF'                                      CFT006
     C           #1DTPE    OREQ 'NX'                                      151162
     C                     MOVEL'N'       WERR                            CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
      ** If CFT006 is ON, allow also deal types RI,RO                     CFT006
      *                                                                   CFT006
     C           CFT006    IFEQ 'Y'                                       CFT006
     C           #1DTPE    IFEQ 'RI'                                      CFT006
     C           #1DTPE    OREQ 'RO'                                      CFT006
     C                     MOVEL'N'       WERR                            CFT006
     C                     ENDIF                                          CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT008
      ** If CFT008 is ON, allow also deal types BI,BO                     CFT008
      *                                                                   CFT008
     C           CFT008    IFEQ 'Y'                                       CFT008
     C           #1DTPE    IFEQ 'BI'                                      CFT008
     C           #1DTPE    OREQ 'BO'                                      CFT008
     C                     MOVEL'N'       WERR                            CFT008
     C                     ENDIF                                          CFT008
     C                     ENDIF                                          CFT008
     C/COPY WNCPYSRC,FDH00022
      *                                                                   CRE008
      ** If CRE008 is ON, allow also deal type  CM                        CRE008
      *                                                                   CRE008
     C           CRE008    IFEQ 'Y'                                       CRE008
     C           #1DTPE    IFEQ 'CM'                                      CRE008
     C                     MOVEL'N'       WERR                            CRE008
     C                     ENDIF                                          CRE008
     C                     ENDIF                                          CRE008
      *                                                                   S01408
     C/COPY WNCPYSRC,FD0650MC11                                           S01408
     C           WERR      IFEQ 'Y'                                       CFT006
      *                                                                   S01408
      * Send message 'Deal type invalid'
     C                     MOVEL'USR1778' ZAMSID           Message id.
     C                     MOVEL'GBMIDAS' ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     SETON                     9834  *
     C                     END                             *FI
      *                                                                                       207288
      ** Validate spot indicator                                                              207288
      *                                                                                       207288
     C           BGN4ST    IFEQ 'Y'                                                           207288
     C                     EXSR VALSPT                                                        207288
     C                     ENDIF                                                              207288
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MVSF                                           S01408
     C*                                                                   S01408
      ** If CAS001 enhancement is ON, validate Yield Curves:                                  CAS001
      *                                                                                       CAS001
     C           CAS001    IFEQ 'Y'                                                           CAS001
     C/COPY WNCPYSRC,FDH00048
      *                                                                                       CAS001
      ** Validate Buy/Our Yield Curve                                                         CAS001
      *                                                                                       CAS001
     C           #1OURY    IFNE *BLANK                                                        CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM *BLANK    PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM #1OURY    PYLDC   5                                           CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
     C                     MOVELPYLDC     #1OURY                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NRF'                                                        CAS001
     C                     MOVE *ON       *IN71                                               CAS001
     C                     MOVE *ON       *IN98                                               CAS001
     C                     MOVEL'USR9157' ZAMSID                                              CAS001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Validate Sell/Their Yield Curve                                                      CAS001
      *                                                                                       CAS001
     C           #1THRY    IFNE *BLANK                                                        CAS001
     C                     CALL 'AOYLDCR0'                                                    CAS001
     C                     PARM *BLANK    PRTCD                                               CAS001
     C                     PARM '*KEY   ' POPTN                                               CAS001
     C                     PARM #1THRY    PYLDC                                               CAS001
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS001
      *                                                                                       CAS001
     C                     MOVELPYLDC     #1THRY                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ '*NRF'                                                        CAS001
     C                     MOVE *ON       *IN72                                               CAS001
     C                     MOVE *ON       *IN98                                               CAS001
     C                     MOVEL'USR9182' ZAMSID                                              CAS001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Optional only for the following deal type:                                           CAS001
      ** FP,FS,CX,OP,OT,SW,SI,PI,RX                                                           CAS001
      ** When CAS005 is On, Their Sell Yield Curve is                                         CAS005
      ** also optional for deal type RS                                                       CAS005
      *                                                                                       CAS001
     C           #1DTPE    IFEQ 'FP'                                                          CAS001
     C           #1DTPE    OREQ 'FS'                                                          CAS001
     C           #1DTPE    OREQ 'CX'                                                          CAS001
     C           #1DTPE    OREQ 'OP'                                                          CAS001
     C           #1DTPE    OREQ 'OT'                                                          CAS001
     C           #1DTPE    OREQ 'SW'                                                          CAS001
     C           #1DTPE    OREQ 'SI'                                                          CAS001
     C           #1DTPE    OREQ 'PI'                                                          CAS001
     C           #1DTPE    OREQ 'RX'                                                          CAS001
     C           CAS005    OREQ 'Y'                                                           CAS005
     C           #1DTPE    ANDEQ'RS'                                                          CAS005
     C                     ELSE                                                               CAS001
     C                     MOVE *ON       *IN72                                               CAS001
     C                     MOVE *ON       *IN98                                               CAS001
     C                     MOVEL'USR9156' ZAMSID                                              CAS001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** Validate Yield Curve Mandatory entry                                                 CAS001
      *                                                                                       CAS001
     C           #1YLDM    IFEQ *BLANK                                                        CAS001
     C           #1YLDM    OREQ 'Y'                                                           CAS001
     C           #1YLDM    OREQ 'N'                                                           CAS001
      *                                                                                       CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE *ON       *IN73                                               CAS001
     C                     MOVE *ON       *IN98                                               CAS001
     C                     MOVEL'USR9155' ZAMSID                                              CAS001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS001
     C                     EXSR ZASNMS                                                        CAS001
     C                     ENDIF                                                              CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
      ** If CAS005 is ON, validate Yield Curves:                                              CAS005
      *                                                                                       CAS005
     C           CAS005    IFEQ 'Y'                                                           CAS005
      *                                                                                       CAS005
      ** Validate Buy/Our Forward Yield Curve                                                 CAS005
      *                                                                                       CAS005
     C           #1ORFY    IFNE *BLANK                                                        CAS005
     C                     CALL 'AOYLDCR0'                                                    CAS005
     C                     PARM *BLANK    PRTCD                                               CAS005
     C                     PARM '*KEY   ' POPTN                                               CAS005
     C                     PARM #1ORFY    PYLDC                                               CAS005
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS005
      *                                                                                       CAS005
     C                     MOVELPYLDC     #1ORFY                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ '*NRF'                                                        CAS005
     C                     MOVE *ON       *IN74                                               CAS005
     C                     MOVE *ON       *IN98                                               CAS005
     C                     MOVEL'USR9644' ZAMSID                                              CAS005
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Sell/Their Forward Yield Curve                                              CAS005
      *                                                                                       CAS005
     C           #1THFY    IFNE *BLANK                                                        CAS005
     C                     CALL 'AOYLDCR0'                                                    CAS005
     C                     PARM *BLANK    PRTCD                                               CAS005
     C                     PARM '*KEY   ' POPTN                                               CAS005
     C                     PARM #1THFY    PYLDC                                               CAS005
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS005
      *                                                                                       CAS005
     C                     MOVELPYLDC     #1THFY                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ '*NRF'                                                        CAS005
     C                     MOVE *ON       *IN75                                               CAS005
     C                     MOVE *ON       *IN98                                               CAS005
     C                     MOVEL'USR9645' ZAMSID                                              CAS005
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Optional only for the following deal type:                                           CAS005
      ** FP,FS,CX,OP,OT,SW,SI,PI,RX,RS                                                        CAS005
      *                                                                                       CAS005
     C           #1DTPE    IFEQ 'FP'                                                          CAS005
     C           #1DTPE    OREQ 'FS'                                                          CAS005
     C           #1DTPE    OREQ 'CX'                                                          CAS005
     C           #1DTPE    OREQ 'OP'                                                          CAS005
     C           #1DTPE    OREQ 'OT'                                                          CAS005
     C           #1DTPE    OREQ 'SW'                                                          CAS005
     C           #1DTPE    OREQ 'SI'                                                          CAS005
     C           #1DTPE    OREQ 'PI'                                                          CAS005
     C           #1DTPE    OREQ 'RS'                                                          CAS005
     C           #1DTPE    OREQ 'RX'                                                          CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE *ON       *IN75                                               CAS005
     C                     MOVE *ON       *IN98                                               CAS005
     C                     MOVEL'USR9156' ZAMSID                                              CAS005
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
      ** Validate Yield Curve Mandatory entry                                                 CAS005
      *                                                                                       CAS005
     C           #1FYCM    IFEQ *BLANK                                                        CAS005
     C           #1FYCM    OREQ 'Y'                                                           CAS005
     C           #1FYCM    OREQ 'N'                                                           CAS005
      *                                                                                       CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE *ON       *IN76                                               CAS005
     C                     MOVE *ON       *IN98                                               CAS005
     C                     MOVEL'USR9155' ZAMSID                                              CAS005
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS005
     C                     EXSR ZASNMS                                                        CAS005
     C                     ENDIF                                                              CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CDL019
      ** If CDL019 enhancement is ON, validate Fix Base Rate                                  CDL019
      *                                                                                       CDL019
     C           CDL019    IFEQ 'Y'                                                           CDL019
      *                                                                                       CDL019
     C           #1DTPE    IFEQ 'IT'                                                          CDL019
     C           #1DTPE    OREQ 'TD'                                                          CDL019
     C           #1DTPE    OREQ 'IP'                                                          CDL019
     C           #1DTPE    OREQ 'TI'                                                          CDL019
     C                     MOVE *ON       *IN59                                               CDL019
     C                     ELSE                                                               CDL019
     C                     MOVE *OFF      *IN59                                               CDL019
     C                     ENDIF                                                              CDL019
      *                                                                                       CDL019
     C           #1FBRT    IFNE *BLANK                                                        CDL019
     C           #1FBRT    ANDNE'Y'                                                           CDL019
     C           #1FBRT    ANDNE'N'                                                           CDL019
      *                                                                                       CDL019
     C                     MOVE *ON       *IN58                                               CDL019
     C                     MOVE *ON       *IN98                                               CDL019
     C                     MOVEL'USR9155' ZAMSID                                              CDL019
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CDL019
     C                     EXSR ZASNMS                                                        CDL019
     C                     ELSE                                                               CDL019
     C           #1FBRT    IFEQ *BLANK                                                        CDL019
     C           W0PMD     ANDEQ'ADD'                                                         CDL019
     C                     MOVE 'N'       #1FBRT                                              CDL019
     C                     ENDIF                                                              CDL019
     C                     ENDIF                                                              CDL019
     C                     ENDIF                                                              CDL019
      *                                                                                       CAS005
      ** Validate the Global Product and Instrument Codes if CGP001                           CGP001
      ** is enabled.                                                                          CGP001
      *                                                                                       CGP001
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     EXSR SRVGPC                                                        CGP001
     C                     EXSR SRVGIC                                                        CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
      ** If CAS008 and CIR003, Validate Fwd Commitment yield curve                            CAS008
      *                                                                                       CAS008
     C           CAS008    IFEQ 'Y'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                           CAS008
      *                                                                                       CAS008
      ** Validate Buy/Our Forward Cmt Yield Curve                                             CAS008
      *                                                                                       CAS008
     C           #1OFCY    IFNE *BLANK                                                        CAS008
     C           #1DTPE    ANDEQ'RX'                                                          CAS008
     C                     CALL 'AOYLDCR0'                                                    CAS008
     C                     PARM *BLANK    PRTCD                                               CAS008
     C                     PARM '*KEY   ' POPTN                                               CAS008
     C                     PARM #1OFCY    PYLDC                                               CAS008
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS008
      *                                                                                       CAS008
     C                     MOVELPYLDC     #1OFCY                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ '*NRF'                                                        CAS008
     C                     MOVE *ON       *IN61                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Buy/Our Forward Commitment Yield Curve not valid                                     CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9655' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           #1OFCY    IFNE *BLANK                                                        CAS008
     C           #1DTPE    ANDNE'RX'                                                          CAS008
      *                                                                                       CAS008
     C                     MOVE *ON       *IN61                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Forward Commitment Yield Curve must be blank if deal type                            CAS008
      ** is not 'RX'.                                                                         CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9657' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Validate Sell/Their Forward Cmt Yield Curve                                          CAS008
      *                                                                                       CAS008
     C           #1TFCY    IFNE *BLANK                                                        CAS008
     C           #1DTPE    ANDEQ'RX'                                                          CAS008
     C                     CALL 'AOYLDCR0'                                                    CAS008
     C                     PARM *BLANK    PRTCD                                               CAS008
     C                     PARM '*KEY   ' POPTN                                               CAS008
     C                     PARM #1TFCY    PYLDC                                               CAS008
     C           SDYLDC    PARM SDYLDC    DSSDY                                               CAS008
      *                                                                                       CAS008
     C                     MOVELPYLDC     #1TFCY                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ '*NRF'                                                        CAS008
     C                     MOVE *ON       *IN62                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Sell/Their Forward Commitment Yield Curve not valid                                  CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9656' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           #1TFCY    IFNE *BLANK                                                        CAS008
     C           #1DTPE    ANDNE'RX'                                                          CAS008
      *                                                                                       CAS008
     C                     MOVE *ON       *IN62                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Forward Commitment Yield Curve must be blank if deal type                            CAS008
      ** is not 'RX'.                                                                         CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9658' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Validate Fwd Cmt Yield Curve Mandatory entry                                         CAS008
      *                                                                                       CAS008
     C           #1DTPE    IFEQ 'RX'                                                          CAS008
      *                                                                                       CAS008
     C           #1FCCM    IFEQ *BLANK                                                        CAS008
     C           #1FCCM    OREQ 'Y'                                                           CAS008
     C           #1FCCM    OREQ 'N'                                                           CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE *ON       *IN63                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Valid values are 'Y', 'N' and blank                                                  CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9155' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ELSE                                                               CAS008
      *                                                                                       CAS008
     C           #1FCCM    IFNE *BLANK                                                        CAS008
     C                     MOVE *ON       *IN63                                               CAS008
     C                     MOVE *ON       *IN98                                               CAS008
      *                                                                                       CAS008
      ** Forward Commitment Yield Curve Mandatory must be blank if                            CAS008
      ** deal type is not 'RX'.                                                               CAS008
      *                                                                                       CAS008
     C                     MOVEL'USR9659' ZAMSID                                              CAS008
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CAS008
     C                     EXSR ZASNMS                                                        CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile records.
      *================================================================
      * Initialise subfile reload flag.
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records.
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record.
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes.
     C                     ROLBK
     C                     ELSE
      * Otherwise COMMIT any DBF changes.
     C                     COMIT
     C                     END
     C                     MOVEL*BLANK    #1SEL
      * Set screen conditioning indicators.
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload.
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record.
      *================================================================
      * Set off error indicators.
     C/COPY WNCPYSRC,FD0650MC20
     C*********************MOVEAWKIND0    *IN,32           Clear errors                       CDL038
     C                     MOVEAWKIND0    *IN,30                                              CDL038
     C                     MOVE *OFF      *IN71                                               CAS001
     C                     MOVE *OFF      *IN72                                               CAS001
     C                     MOVE *OFF      *IN73                                               CAS001
     C                     MOVE *OFF      *IN74                                               CAS005
     C                     MOVE *OFF      *IN75                                               CAS005
     C                     MOVE *OFF      *IN76                                               CAS005
     C                     MOVE *OFF      *IN41                                               CGP001
     C                     MOVE *OFF      *IN42                                               CGP001
     C                     MOVE *OFF      *IN58                                               CDL019
     C                     MOVE *OFF      *IN61                                               CAS008
     C                     MOVE *OFF      *IN62                                               CAS008
     C                     MOVE *OFF      *IN63                                               CAS008
     C                     MOVE *OFF      *IN69                                               CAS009
      *                                                                                       CER047
     C           CER047    IFEQ 'Y'                                                           CER047
     C                     SETOF                     45                                       CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP3                                           S01408
     C*                                                                   S01408
     C                     SETOF                     98    No errors
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request.
     C           #1SEL     IFNE 'D'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
      * Process delete request.
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request.
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact.
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    Error on update
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request.
      *================================================================
      * USER: Create DBF record
      * Create Deal type/subtype record
     C                     EXSR SACRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected.
     C/COPY WNCPYSRC,FD0650MC21
     C                     MOVE '1'       *IN,34           Screen errors
     C                     MOVE '1'       *IN,35           Screen errors
     C                     MOVE '1'       *IN,36           Screen errors
     C                     MOVE '1'       *IN,37           Screen errors  S01486
     C                     MOVE '1'       *IN,38           Screen errors                      CDL038
     C                     MOVE '1'       *IN,38                                              207288
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP5                                           S01408
     C*                                                                   S01408
     C                     SETON                     98    Format Error
     C                     SETOF                     87    Enable entry
     C                     SETON                     84    SFLNXTCHG
     C                     ELSE
      * DBF Write successful.
     C                     SETON                     87    Disable entry
     C                     SETOF                     84    No SFLNXTCHG
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request.
      *================================================================
      * USER: Delete DBF record
      * Delete Deal type/Subtype record  *
     C/COPY WNCPYSRC,FD0650MC06
     C                     EXSR SCDLRC
     C/COPY WNCPYSRC,FD0650MC07
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful.
     C/COPY WNCPYSRC,FD0650MC22
     C                     MOVE '1'       *IN,33           Screen errors
     C                     MOVE '1'       *IN,34           Screen errors
     C                     MOVE '1'       *IN,35           Screen errors
     C                     MOVE '1'       *IN,36           Screen errors
     C                     MOVE '1'       *IN,37           Screen errors  S01486
     C                     MOVE '1'       *IN38                                               207288
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP5                                           S01408
     C*                                                                   S01408
     C                     SETON                     98    Format Error
     C                     SETOF                     87    Enable entry
     C                     SETON                     84    SFLNXTCHG
      * If record altered, reset subfile record.
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF Delete successful.
      * Blank out record and protect from entry.
     C                     EXSR MAIZ#1
     C                     SETON                     87    Disable entry
     C                     SETOF                     84    No SFLNXTCHG
     C                     MOVEL'Y'       W0RSF   1        Reload subfile
     C                     END                             FI W0RTCD
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request.
      *================================================================
      * USER: Change DBF record
      * Change Deal type/subtype record
     C                     EXSR SECHRC
     C           W0RTN     IFNE *BLANK
      * DBF Update error detected.
     C/COPY WNCPYSRC,FD0650MC23
     C                     MOVE '1'       *IN,34           Screen errors
     C                     MOVE '1'       *IN,35           Screen errors
     C                     MOVE '1'       *IN,36           Screen errors
     C                     MOVE '1'       *IN,37           Screen errors  S01486
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP5                                           S01408
     C*                                                                   S01408
     C                     SETON                     98    Format Error
     C                     SETOF                     87    Enable entry
     C                     SETON                     84    SFLNXTCHG
      * Reset subfile record if changed record.
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF Update successful.
     C                     SETOF                     87    Enable entry
     C                     SETOF                     84    No SFLNXTCHG
     C                     END                             FI W0RTCD
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Flip between *ADD and *CHANGE modes.
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload.
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record.
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record.
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           WUDELA    IFEQ @CN,05                     *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL*IN87     *IN78
     C/COPY WNCPYSRC,FD0650MC35
     C           WUAMAL    IFEQ @CN,05                     *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control.
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record.
      *================================================================
     C                     MOVEL*BLANK    #1DBRC           Previous values
     C                     Z-ADD*ZERO     #1LCD            Last Change Dat
     C                     MOVEL*BLANK    #1TYLC           Type of Last Ch
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #1DTPE           Deal type
     C                     MOVEL*BLANK    #1DLST           Subtype
     C                     MOVEL*BLANK    #1CLAS           Class                              CDL038
     C                     MOVEL*BLANK    #1NARR           Description of
     C                     MOVEL*BLANK    #1INNR           Instrument typeS01486
     C                     MOVEL*BLANK    #1FBRT           Fix Base Rate                      CDL019
     C/COPY WNCPYSRC,FD0650MC40
     C                     MOVEL*BLANK    #1PLDP           Pricing Group  CPL002
     C/COPY WNCPYSRC,FDH00023
     C                     MOVEL*BLANK    #1PLDR           Reporting GroupCPL002
     C                     MOVEL*BLANK    #1PLCR           Credit Rating  CPL002
     C                     MOVEL*BLANK    #1SFLG                                              207288
     C                     MOVEL*BLANK    #1OURY                                              CAS001
     C                     MOVEL*BLANK    #1THRY                                              CAS001
     C                     MOVEL*BLANK    #1YLDM                                              CAS001
     C/COPY WNCPYSRC,FDH00049
     C                     MOVEL*BLANK    #1ORFY                                              CAS005
     C                     MOVEL*BLANK    #1THFY                                              CAS005
     C                     MOVEL*BLANK    #1FYCM                                              CAS005
     C                     MOVE *BLANKS   #1PRDC                                              CGP001
     C                     MOVE *BLANKS   #1INSC                                              CGP001
     C                     MOVEL*BLANK    #1OFCY                                              CAS008
     C                     MOVEL*BLANK    #1TFCY                                              CAS008
     C                     MOVEL*BLANK    #1FCCM                                              CAS008
     C                     MOVE *BLANK    #1ACAI           Amort Cost Acct Ind.               CAS009
      *                                                                                       CER047
     C           CER047    IFEQ 'Y'                                                           CER047
     C                     MOVEL'Y'       #1K24C                                              CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP6                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @FDDTST1 fields to subfile.
      *================================================================
     C/COPY WNCPYSRC,FD0650MC36
     C                     Z-ADDLCD11     #1LCD            Last Change Dat
     C                     MOVELTYLC11    #1TYLC           Type of Last Ch
     C                     MOVELDTPE11    #1DTPE           Deal type
     C                     MOVELDLST11    #1DLST           Subtype
     C                     MOVELCLAS11    #1CLAS           Class                              CDL038
     C                     MOVELNARR11    #1NARR           Description of
     C                     MOVELINNR      #1INNR           Instrument typeS01486
     C                     MOVELFDFBRT    #1FBRT           Fix Base Rate                      CDL019
     C/COPY WNCPYSRC,FD0650MC41
     C                     MOVELPLDPCD    #1PLDP           Pricing Group  CPL002
     C                     MOVELPLDRCD    #1PLDR           Reporting GroupCPL002
     C                     MOVELPLCRED    #1PLCR           Credit Rating  CPL002
      *                                                                                       207288
      ** Load spot indicator.                                                                 207288
      *                                                                                       207288
     C           KSECU     KLIST                                                              207288
     C                     KFLD           TFDTPE                                              207288
     C                     KFLD           TFDLST                                              207288
      *                                                                                       207288
     C           BGN4ST    IFEQ 'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     MOVELDTPE11    TFDTPE                                              207288
     C                     MOVELDLST11    TFDLST                                              207288
     C           KSECU     CHAINRTVIDX               90                                       207288
     C           *IN90     IFEQ '0'                                                           207288
     C                     MOVE TFSPOT    #1SFLG                                              207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C                     MOVELFSOURY    #1OURY                                              CAS001
     C                     MOVELFSTHRY    #1THRY                                              CAS001
     C                     MOVELFSYLDM    #1YLDM                                              CAS001
     C                     MOVELFSORFY    #1ORFY                                              CAS005
     C                     MOVELFSTHFY    #1THFY                                              CAS005
     C                     MOVELFSFYCM    #1FYCM                                              CAS005
      *                                                                                       CDL019
     C           CDL019    IFEQ 'Y'                                                           CDL019
     C           #1DTPE    IFEQ 'IT'                                                          CDL019
     C           #1DTPE    OREQ 'TD'                                                          CDL019
     C           #1DTPE    OREQ 'IP'                                                          CDL019
     C           #1DTPE    OREQ 'TI'                                                          CDL019
     C                     MOVE *ON       *IN59                                               CDL019
     C                     ELSE                                                               CDL019
     C                     MOVE *OFF      *IN59                                               CDL019
     C                     ENDIF                                                              CDL019
     C                     ENDIF                                                              CDL019
      *                                                                                       CGP001
      ** Move the Global Product and Instrument Codes to screen fields                        CGP001
      ** if CGP001 is enabled.                                                                CGP001
      *                                                                                       CGP001
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     EXSR SRGPPI                                                        CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CAS008
     C                     MOVELFSOFCY    #1OFCY                                              CAS008
     C                     MOVELFSTFCY    #1TFCY                                              CAS008
     C                     MOVELFSFCCM    #1FCCM                                              CAS008
     C                     MOVE FSACAI    #1ACAI                                              CAS009
      *                                                                                       CER047
     C           CER047    IFEQ 'Y'                                                           CER047
     C                     MOVELFSK24C    #1K24C                                              CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP7                                           S01408
     C*                                                                   S01408
      * Hold current record image for change detection.
     C                     MOVEL@1DBRC    #1DBRC
     C/COPY WNCPYSRC,FDH00024
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control.
      *================================================================
     C                     MOVEL*BLANK    #2DTPE           Deal type
     C                     MOVEL*BLANK    #2DLST           Subtype
     C                     MOVEL*BLANK    #2CLAS           Class                              CDL038
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SACRRC    BEGSR
      *================================================================
      * Create Deal type/subtypes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to record
     C                     MOVEL#1DTPE    DTPE11           Deal type
     C                     MOVEL#1DLST    DLST11           Subtype
     C                     MOVEL#1CLAS    CLAS11           Class                              CDL038
     C                     Z-ADDWURDNB    LCD11            Last Change Dat
     C                     MOVEL@CN,19    TYLC11           Type of Last Ch
     C                     MOVEL#1NARR    NARR11           Description of
     C                     MOVEL#1INNR    INNR             Instrument typeS01486
     C                     MOVEL#1FBRT    FDFBRT           Fix Base Rate                      CDL019
     C/COPY WNCPYSRC,FD0650MC42
     C                     MOVEL#1PLDP    PLDPCD           Pricing Group  CPL002
     C                     MOVEL#1PLDR    PLDRCD           Reporting GroupCPL002
     C                     MOVEL#1PLCR    PLCRED           Credit Rating  CPL002
     C                     MOVEL#1OURY    FSOURY                                              CAS001
     C                     MOVEL#1THRY    FSTHRY                                              CAS001
     C                     MOVEL#1YLDM    FSYLDM                                              CAS001
     C                     MOVEL#1ORFY    FSORFY                                              CAS005
     C                     MOVEL#1THFY    FSTHFY                                              CAS005
     C                     MOVEL#1FYCM    FSFYCM                                              CAS005
     C                     MOVEL#1OFCY    FSOFCY                                              CAS008
     C                     MOVEL#1TFCY    FSTFCY                                              CAS008
     C                     MOVEL#1FCCM    FSFCCM                                              CAS008
     C                     MOVE #1ACAI    FSACAI                                              CAS009
      *                                                                                       CER047
     C           CER047    IFEQ 'Y'                                                           CER047
     C                     MOVEL#1K24C    FSK24C                                              CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C/COPY WNCPYSRC,FD0650MC15
      *
     C           KLCRSA    KLIST
     C                     KFLD           DTPE11           Deal type
     C                     KFLD           DLST11           Subtype
     C                     KFLD           CLAS11           Class                              CDL038
      * Check for duplicate primary key.
     C/COPY WNCPYSRC,FD0650MC43
     C           KLCRSA    SETLL@FDDTST0                 90*
     C/COPY WNCPYSRC,FD0650MC28
     C           *IN90     IFEQ '1'
     C           CDL038    IFNE 'Y'                                                           CDL038
     C                     MOVEL'USR1779' W0RTN   7
      * Send message 'Deal type/subtype exists '
     C                     MOVEL'USR1779' ZAMSID           Message id.
     C                     MOVEL'GBMIDAS' ZAMSGF           Message file.
     C                     ELSE                                                               CDL038
     C                     MOVEL'USR9011' W0RTN   7                                           CDL038
      * Send message 'Deal type/subtype/class exists'                                         CDL038
     C                     MOVEL'USR9011' ZAMSID           Message id.                        CDL038
     C                     MOVEL'SDUSRMSG'ZAMSGF           Message file.                      CDL038
     C                     ENDIF                                                              CDL038
     C                     EXSR ZASNMS                     Send message
     C                     GOTO SAEXIT
     C                     END
      *
     C/COPY WNCPYSRC,FD0650MC24
     C                     WRITE@FDDTST0               91  *
     C/COPY WNCPYSRC,FDH00025
      *                                                                                       207288
      ** Write new record on extension file.                                                  207288
      *                                                                                       207288
     C           *IN91     IFEQ '0'                                                           207288
     C           BGN4ST    ANDEQ'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     MOVEL#1DTPE    TFDTPE                                              207288
     C                     MOVEL#1DLST    TFDLST                                              207288
     C           KSECU     CHAINUPDIDX               90                                       207288
     C           *IN90     IFEQ '1'                                                           207288
     C                     MOVEL#1SFLG    TFSPOT                                              207288
     C                     WRITEUPDIDX                 91                                     207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
      *
     C           *IN91     IFEQ '1'
      * Write error detected.
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
      ** Save the Global Product and Instrument Codes to the Cross-                           CGP001
      ** Reference Files if CGP001 is enabled.                                                CGP001
      *                                                                                       CGP001
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     EXSR SRGPXU                                                        CGP001
     C                     ENDIF                                                              CGP001
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCAU                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SCDLRC    BEGSR
      *================================================================
      * Delete Deal type/subtypes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @FDDTST0
     C                     MOVEL#1DTPE    DTPE11           Deal type
     C                     MOVEL#1DLST    DLST11           Subtype
     C                     MOVEL#1CLAS    CLAS11           Class                              CDL038
      *
     C           KLDLSC    KLIST
     C                     KFLD           DTPE11           Deal type
     C                     KFLD           DLST11           Subtype
     C                     KFLD           CLAS11           Class                              CDL038
     C/COPY WNCPYSRC,FD0650MC44
     C           KLDLSC    CHAIN@FDDTST0             9091  *
     C           *IN90     IFEQ '0'                                                           207288
     C           *IN91     ANDEQ'0'                                                           207288
     C           BGN4ST    ANDEQ'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     MOVELDTPE11    TFDTPE                                              207288
     C                     MOVELDLST11    TFDLST                                              207288
     C           KSECU     CHAINUPDIDX               9091                                     207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C/COPY WNCPYSRC,FD0650MC29
     C           *IN90     IFEQ '1'
      * Record already deleted.
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked.
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SCEXIT
     C                     END
      *
      * Check for changed record.
     C           #1DBRC    IFNE @1DBRC                     IF
     C/COPY WNCPYSRC,FDH00026
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
      * Use SETLL to release record lock.
     C/COPY WNCPYSRC,FD0650MC45
     C           KLDLSC    SETLL@FDDTST0             9091  *
     C           BGN4ST    IFEQ 'Y'                                                           207288
     C           KSECU     SETLLUPDIDX                                                        207288
     C                     ENDIF                                                              207288
     C/COPY WNCPYSRC,FD0650MC30
     C                     GOTO SCEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C/COPY WNCPYSRC,FD0650MC46
     C                     DELET@FDDTST0               91  *
     C/COPY WNCPYSRC,FDH00027
      *                                                                                       207288
      ** Delete record on extension file.                                                     207288
      *                                                                                       207288
     C           *IN91     IFEQ '0'                                                           207288
     C           BGN4ST    ANDEQ'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     DELETUPDIDX                 91                                     207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C           *IN91     IFEQ '1'
      * Delete error detected.
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
      ** Enforce referential integrity if CGP001 is enabled.                                  CGP001
      *                                                                                       CGP001
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     EXSR SRGPXD                                                        CGP001
     C                     ENDIF                                                              CGP001
     C/COPY WNCPYSRC,FD0650MC16
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MDAU                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change Deal type/subtypes
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @FDDTST0
     C                     MOVEL#1DTPE    DTPE11           Deal type
     C                     MOVEL#1DLST    DLST11           Subtype
     C                     MOVEL#1CLAS    CLAS11           Class                              CDL038
      *
     C           KLCHSE    KLIST
     C                     KFLD           DTPE11           Deal type
     C                     KFLD           DLST11           Subtype
     C                     KFLD           CLAS11           Class                              CDL038
     C/COPY WNCPYSRC,FD0650MC47
     C           KLCHSE    CHAIN@FDDTST0             9091  *
     C           *IN90     IFEQ '0'                                                           207288
     C           *IN91     ANDEQ'0'                                                           207288
     C           BGN4ST    ANDEQ'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     MOVELDTPE11    TFDTPE                                              207288
     C                     MOVELDLST11    TFDLST                                              207288
     C           KSECU     CHAINUPDIDX               9091                                     207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C/COPY WNCPYSRC,FD0650MC31
      *
     C           *IN90     IFEQ '1'
      * Record not found.
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked.
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Check for changed record.
     C           #1DBRC    IFNE @1DBRC                     IF
     C/COPY WNCPYSRC,FDH00028
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID           Message id.
     C                     MOVEL'Y2USRMSG'ZAMSGF           Message file.
     C                     EXSR ZASNMS                     Send message
      * Use SETLL to release record lock.
     C/COPY WNCPYSRC,FD0650MC48
     C           KLCHSE    SETLL@FDDTST0             9091  *
     C           BGN4ST    IFEQ 'Y'                                                           207288
     C           KSECU     SETLLUPDIDX                                                        207288
     C                     ENDIF                                                              207288
     C                     GOTO SEEXIT
     C                     END                             FI #1DBRC
     C/COPY WNCPYSRC,FD0650MC25
      * Move Non-key fields to @FDDTST0
     C                     Z-ADDWURDNB    LCD11            Last Change Dat
     C                     MOVEL@CN,23    TYLC11           Type of Last Ch
     C                     MOVEL#1NARR    NARR11           Description of
     C                     MOVEL#1INNR    INNR             Instrument typeS01486
     C                     MOVEL#1FBRT    FDFBRT           Fix Base Rate                      CDL019
     C/COPY WNCPYSRC,FD0650MC49
     C                     MOVEL#1PLDP    PLDPCD           Pricing Group  CPL002
     C                     MOVEL#1PLDR    PLDRCD           Reporting GroupCPL002
     C                     MOVEL#1PLCR    PLCRED           Credit Rating  CPL002
     C                     MOVEL#1SFLG    TFSPOT                                              207288
     C                     MOVEL#1OURY    FSOURY                                              CAS001
     C                     MOVEL#1THRY    FSTHRY                                              CAS001
     C                     MOVEL#1YLDM    FSYLDM                                              CAS001
     C                     MOVEL#1ORFY    FSORFY                                              CAS005
     C                     MOVEL#1THFY    FSTHFY                                              CAS005
     C                     MOVEL#1FYCM    FSFYCM                                              CAS005
     C                     MOVEL#1OFCY    FSOFCY                                              CAS008
     C                     MOVEL#1TFCY    FSTFCY                                              CAS008
     C                     MOVEL#1FCCM    FSFCCM                                              CAS008
     C                     MOVE #1ACAI    FSACAI                                              CAS009
      *                                                                                       CER047
     C                     MOVE #1K24C    FSK24C                                              CER047
      *
     C/COPY WNCPYSRC,FD0650MC50
     C                     UPDAT@FDDTST0               91  *
      *                                                                                       207288
      ** Update extension file.                                                               207288
      *                                                                                       207288
     C           *IN91     IFEQ '0'                                                           207288
     C           BGN4ST    ANDEQ'Y'                                                           207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C                     UPDATUPDIDX                                                        207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
     C/COPY WNCPYSRC,FD0650MC32
     C           *IN91     IFEQ '1'
      * Change error detected.
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,FDH00029
      * DBF Change successful.
      * Update saved record image.
     C                     MOVEL@1DBRC    #1DBRC
      *                                                                                       CGP001
      ** Save the Global Product and Instrument Codes to the Cross-                           CGP001
      ** Reference Files if CGP001 is enabled.                                                CGP001
      *                                                                                       CGP001
     C/COPY WNCPYSRC,FDH00030
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     EXSR SRGPXU                                                        CGP001
     C                     ENDIF                                                              CGP001
     C/COPY WNCPYSRC,FD0650MC17
      *
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MADU                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRVGPC - Validates the Global Product Code.                  *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRVGPC    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     MOVE *BLANKS   ZAMSID                                              CGP001
     C                     MOVE *BLANKS   ZAMSGF                                              CGP001
      *                                                                                       CGP001
      ** Product Code must be entered.                                                        CGP001
      *                                                                                       CGP001
     C********** #1PRDC    IFEQ *BLANKS                                               CGP001 BUG6307
     C**********           MOVE 'GPM0004' ZAMSID                                      CGP001 BUG6307
     C**********           ELSE                                                       CGP001 BUG6307
      *                                                                                      BUG6307
     C           #1PRDC    IFNE *BLANKS                                                      BUG6307
      *                                                                                       CGP001
     C                     CALL 'AOGPRDR0'                                                    CGP001
     C                     PARM *BLANKS   PRTCD                                               CGP001
     C                     PARM '*KEY   ' POPTN                                               CGP001
     C                     PARM #1PRDC    PGPRD  10                                           CGP001
     C           GPPROD    PARM GPPROD    DSFDY                                               CGP001
      *                                                                                       CGP001
     C           PRTCD     IFEQ *BLANKS                                                       CGP001
     C                     MOVE PGPRD     #1PRDC                                              CGP001
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
     C                     SELEC                                                              CGP001
     C           PRTCD     WHEQ '*NOSEL '                                                     CGP001
     C                     MOVE 'GPM0004' ZAMSID                                              CGP001
      *                                                                                       CGP001
      ** Invalid Product Code.                                                                CGP001
      *                                                                                       CGP001
     C           PRTCD     WHEQ '*NRF   '                                                     CGP001
     C                     MOVE 'GPM0005' ZAMSID                                              CGP001
     C                     OTHER                                                              CGP001
     C                     MOVEL'GPPRODPD'DBFILE                                              CGP001
     C                     MOVELPGPRD     DBKEY                                               CGP001
     C                     MOVEL'08'      DBASE                                               CGP001
     C                     MOVE *ON       *INU7                                               CGP001
     C                     MOVE *ON       *INU8                                               CGP001
     C                     MOVE *ON       *INLR                                               CGP001
     C                     EXSR *PSSR                                                         CGP001
     C                     ENDSL                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C           ZAMSID    IFNE *BLANKS                                                       CGP001
     C                     MOVE *ON       *IN41                                               CGP001
     C                     MOVE *ON       *IN98                                               CGP001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CGP001
     C                     EXSR ZASNMS                                                        CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRVGIC - Validates the Global Instrument Code.               *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRVGIC    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     MOVE *BLANKS   ZAMSID                                              CGP001
     C                     MOVE *BLANKS   ZAMSGF                                              CGP001
      *                                                                                       CGP001
      ** Instrument Code must be entered.                                                     CGP001
      *                                                                                       CGP001
     C           #1INSC    IFEQ *BLANKS                                                       CGP001
     C           CGP003    IFEQ 'Y'                                                          BUG5677
     C                     MOVE 'GPM0006' ZAMSID                                              CGP001
     C                     ENDIF                                                             BUG5677
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
     C                     CALL 'AOGINSR0'                                                    CGP001
     C                     PARM *BLANKS   PRTCD                                               CGP001
     C                     PARM '*KEY   ' POPTN                                               CGP001
     C                     PARM #1INSC    PGINS  10                                           CGP001
     C           GPINST    PARM GPINST    DSFDY                                               CGP001
      *                                                                                       CGP001
     C           PRTCD     IFEQ *BLANKS                                                       CGP001
     C                     MOVE PGINS     #1INSC                                              CGP001
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
     C                     SELEC                                                              CGP001
     C           PRTCD     WHEQ '*NOSEL '                                                     CGP001
     C                     MOVE 'GPM0006' ZAMSID                                              CGP001
      *                                                                                       CGP001
      ** Invalid Instrument Code.                                                             CGP001
      *                                                                                       CGP001
     C           PRTCD     WHEQ '*NRF   '                                                     CGP001
     C                     MOVE 'GPM0007' ZAMSID                                              CGP001
     C                     OTHER                                                              CGP001
     C                     MOVEL'GPPRODPD'DBFILE                                              CGP001
     C                     MOVELPGPRD     DBKEY                                               CGP001
     C                     MOVEL'09'      DBASE                                               CGP001
     C                     MOVE *ON       *INU7                                               CGP001
     C                     MOVE *ON       *INU8                                               CGP001
     C                     MOVE *ON       *INLR                                               CGP001
     C                     EXSR *PSSR                                                         CGP001
     C                     ENDSL                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C           ZAMSID    IFNE *BLANKS                                                       CGP001
     C                     MOVE *ON       *IN42                                               CGP001
     C                     MOVE *ON       *IN98                                               CGP001
     C                     MOVEL'SDUSRMSG'ZAMSGF                                              CGP001
     C                     EXSR ZASNMS                                                        CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRGPPI - Gets the Global Product and Instrument Codes.       *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRGPPI    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     MOVE *BLANKS   #1PRDC                                              CGP001
     C                     MOVE *BLANKS   #1INSC                                              CGP001
      *                                                                                       CGP001
     C                     MOVE WZONE     KZONE                                               CGP001
     C                     MOVE 'DL'      KMOD                                                CGP001
     C                     MOVELDTPE11    KTRTP                                               CGP001
     C                     MOVELDLST11    KTRST                                               CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPPRDXL0            N43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *OFF                                                          CGP001
     C                     MOVE PDGPRD    #1PRDC                                              CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPINSXL0            N43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *OFF                                                          CGP001
     C                     MOVE INGINS    #1INSC                                              CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRGPOF - Opens the Global Processing Cross-Reference Files.  *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRGPOF    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     Z-ADD80        PLEN   155                                          CGP001
      *                                                                                       CGP001
     C                     DO   2         WIDX    10                                          CGP001
      *                                                                                       CGP001
     C                     MOVE OVRC,WIDX PCMD   80                                           CGP001
      *                                                                                       CGP001
     C                     CALL 'QCMDEXC'                                                     CGP001
     C                     PARM           PCMD                                                CGP001
     C                     PARM           PLEN                                                CGP001
      *                                                                                       CGP001
     C                     ENDDO                                                              CGP001
      *                                                                                       CGP001
     C                     OPEN GPPRDXL0                                                      CGP001
     C                     OPEN GPINSXL0                                                      CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRGPGZ - Gets the Zone via GOGETZONE.                        *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRGPGZ    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     CALL GOPGM                                                         CGP001
     C                     PARM *BLANKS   PZRTCD  7                                           CGP001
     C                     PARM *BLANKS   PZERMS 50                                           CGP001
     C                     PARM 'N'       PZFCHK  1                                           CGP001
     C                     PARM *BLANKS   PZZONE 10                                           CGP001
     C                     PARM *BLANKS   PZSHTC  4                                           CGP001
     C                     PARM *ZERO     PZRDNB  50                                          CGP001
     C                     PARM *ZERO     PZDNWD  50                                          CGP001
     C                     PARM *BLANKS   PZBCCY  3                                           CGP001
     C                     PARM *ZERO     PZNJOB  10                                          CGP001
      *                                                                                       CGP001
     C           PZRTCD    IFEQ *BLANKS                                                       CGP001
     C                     MOVE PZZONE    WZONE  10                                           CGP001
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
     C           PZRTCD    IFEQ '*ERROR'                                                      CGP001
     C                     MOVELGOMSG     PZERMS                                              CGP001
     C                     MOVE *ON       *INU7                                               CGP001
     C                     MOVE *ON       *INU8                                               CGP001
     C                     MOVE *ON       *INLR                                               CGP001
     C                     EXSR *PSSR                                                         CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRGPXU - Writes and updates records on the Global            *                       CGP001
      *           Processing Cross-Reference Files.                   *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRGPXU    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     MOVE WZONE     KZONE                                               CGP001
     C                     MOVE 'DL'      KMOD                                                CGP001
     C                     MOVELDTPE11    KTRTP                                               CGP001
     C                     MOVELDLST11    KTRST                                               CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPPRDXL0             43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *ON                                                           CGP001
     C                     MOVE KZONE     PDZONE                                              CGP001
     C                     MOVE KMOD      PDMOD                                               CGP001
     C                     MOVE KTRTP     PDTRTP                                              CGP001
     C                     MOVE KTRST     PDTRST                                              CGP001
     C                     MOVE #1PRDC    PDGPRD                                              CGP001
     C                     WRITEGPPRDXD0                                                      CGP001
     C                     ELSE                                                               CGP001
     C                     MOVE #1PRDC    PDGPRD                                              CGP001
     C                     UPDATGPPRDXD0                                                      CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPINSXL0             43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *ON                                                           CGP001
     C                     MOVE KZONE     INZONE                                              CGP001
     C                     MOVE KMOD      INMOD                                               CGP001
     C                     MOVE KTRTP     INTRTP                                              CGP001
     C                     MOVE KTRST     INTRST                                              CGP001
     C                     MOVE #1INSC    INGINS                                              CGP001
     C                     WRITEGPINSXD0                                                      CGP001
     C                     ELSE                                                               CGP001
     C                     MOVE #1INSC    INGINS                                              CGP001
     C                     UPDATGPINSXD0                                                      CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
      *                                                               *                       CGP001
      *  SRGPXD - Deletes records on the Global Processing Cross-     *                       CGP001
      *           Reference Files.                                    *                       CGP001
      *                                                               *                       CGP001
      *****************************************************************                       CGP001
     C           SRGPXD    BEGSR                                                              CGP001
      *                                                                                       CGP001
     C                     MOVE WZONE     KZONE                                               CGP001
     C                     MOVE 'DL'      KMOD                                                CGP001
     C                     MOVELDTPE11    KTRTP                                               CGP001
     C                     MOVELDLST11    KTRST                                               CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPPRDXL0             43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *OFF                                                          CGP001
     C                     DELETGPPRDXD0                                                      CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C           KGPXR     CHAINGPINSXL0             43                                       CGP001
      *                                                                                       CGP001
     C           *IN43     IFEQ *OFF                                                          CGP001
     C                     DELETGPINSXD0                                                      CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDSR                                                              CGP001
      *****************************************************************                       CGP001
      /EJECT                                                                                  CGP001
      *****************************************************************                       CGP001
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue.
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
      * If no message file specified use default.
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      * Clear all fields for default mechanism next time.
     C                     MOVEL*BLANK    ZAPGM            Program queue
     C                     MOVEL*BLANK    ZAPGRL           Rel queue
     C                     MOVEL*BLANK    ZAMSID           Message Id.
     C                     MOVEL*BLANK    ZAMSGF           Message file.
     C                     MOVEL*BLANK    ZAMSDA           Message data.
     C                     MOVEL*BLANK    ZAMSTP           Message type.
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text.
      *================================================================
     C                     MOVEL'Y'       W0HLP   1        Signal help req
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Member name.
     C                     PARM *BLANK    YYHPFL 10        *DFT text file.
     C                     PARM *BLANK    YYHPLB 10        Help text lib.
     C                     PARM           W0RTN   7        Return Code.
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal.
      *================================================================
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct.
      *================================================================
      * ROLLBACK any uncommitted DBF changes.
     C                     ROLBK                       90
      *                                                                                       207288
      ** Close extension file.                                                                207288
      *                                                                                       207288
     C           BGN4ST    IFEQ 'Y'                                                           207288
     C                     CLOSEFDDTSTXT               99                                     207288
     C                     ENDIF                                                              207288
      *                                                                                       CGP001
     C           CGP001    IFEQ 'Y'                                                           CGP001
     C                     CLOSEGPPRDXL0                                                      CGP001
     C                     CLOSEGPINSXL0                                                      CGP001
     C                     ENDIF                                                              CGP001
      *
      * Terminate program.
     C                     SETON                     LR
      *
      * Exit program.
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation.
      *================================================================
      *                                                                                       CGP001
      ** Global Processing X-Reference Key List                                               CGP001
      *                                                                                       CGP001
     C           KGPXR     KLIST                                                              CGP001
     C                     KFLD           KZONE  10                                           CGP001
     C                     KFLD           KMOD    2                                           CGP001
     C                     KFLD           KTRTP   5                                           CGP001
     C                     KFLD           KTRST   5                                           CGP001
      *                                                                                       CGP001
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
      * Setup job date/time.
     C                     Z-ADDUDATE     ##JDT            Job date.
     C                     TIME           ##JTM            Job time.
     C                     TIME           ##TME   60       Screen time.
      * Define work field Deletion Allowed
     C                     MOVEL*BLANK    WUDELA  1
      * Define work field Amend allowed
     C                     MOVEL*BLANK    WUAMAL  1
      * Define work field Set Up Complete
     C                     MOVEL*BLANK    WUSUC   1
      * Define work field Test ? in Key Field
     C                     MOVEL*BLANK    WUTQKF  1
      * Define LDA                                                                            CAS005
     C           *NAMVAR   DEFN           LDA                                                 CAS005
      * Obtain default message file.
     C           *NAMVAR   DEFN Y2MGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Run day number
     C                     Z-ADD*ZERO     WURDNB  50
      * Define work field Type of Last Change
     C                     MOVEL*BLANK    WUTYLC  1
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Date format flag
     C                     MOVEL*BLANK    WUDFF   1
      * Open files.
      * Begin commit control.
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
     C                     OPEN FDDTSTL0
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP8                                           S01408
     C*                                                                   S01408
      *
     C**********           Z-ADD13        ##SFPG  30       SFLPAG                             CAS001
     C**********           Z-ADD6         ##SFPG  30                                   CAS001 CAS005
     C**********           Z-ADD5         ##SFPG  30                                   CAS005 CAS008
     C                     Z-ADD4         ##SFPG  30                                          CAS008
     C/COPY WNCPYSRC,FDH00033
     C                     Z-ADD1         ##SFRC
     C                     Z-ADD*ZERO     ##RRMX           MAX RECNO
      *................................................................
      * If member empty, set to *ADD mode, else to *CHANGE mode.
     C           @1NROP    IFEQ *ZERO
     C                     MOVEL'ADD'     W0PMD   3        Add mode
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD            Change mode
     C                     END
      * USER: Initialise program
      * Standard RPG Creation PAR - Standard Functions  *
      * Get Rundate - Rundate  *
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT           RUN DATE       S01229
     C                     MOVE MRDT      WUMRDT                          S01229
     C                     MOVE RDNB      WURDNB           RUNDAY NO.     S01229
     C                     MOVE SUC       WUSUC            SET UP COMPLT  S01229
     C                     MOVE DFF       WUDFF            DTE FMT FLAG   S01229
     C/COPY WNCPYSRC,FD0650MC51
      *                                                                                       CGP001
      ** Check if CGP001 is enabled.                                                          CGP001
      *                                                                                       CGP001
     C                     CALL 'AOSARDR0'                                                    CGP001
     C                     PARM *BLANKS   PRTCD                                               CGP001
     C                     PARM '*VERIFY' POPTN                                               CGP001
     C                     PARM 'CGP001'  PSARD                                               CGP001
     C           SCSARD    PARM SCSARD    DSFDY                                               CGP001
      *                                                                                       CGP001
     C                     MOVE 'N'       CGP001  1                                           CGP001
     C           PRTCD     IFEQ *BLANKS                                                       CGP001
     C                     MOVE 'Y'       CGP001                                              CGP001
     C                     MOVE *ON       *IN40                                               CGP001
      *                                                                                       CGP001
      ** Open the Global Processing Files.                                                    CGP001
      *                                                                                       CGP001
     C                     EXSR SRGPOF                                                        CGP001
      *                                                                                       CGP001
      ** Get the Zone.                                                                        CGP001
      *                                                                                       CGP001
     C                     EXSR SRGPGZ                                                        CGP001
     C                     ELSE                                                               CGP001
      *                                                                                       CGP001
     C           PRTCD     IFNE '*NRF'                                                        CGP001
     C                     MOVEL'SCSARDPD'DBFILE                                              CGP001
     C                     MOVEL'CGP001'  DBKEY                                               CGP001
     C                     MOVEL'07'      DBASE                                               CGP001
     C                     MOVE *ON       *INU7                                               CGP001
     C                     MOVE *ON       *INU8                                               CGP001
     C                     MOVE *ON       *INLR                                               CGP001
     C                     EXSR *PSSR                                                         CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CGP001
     C                     ENDIF                                                              CGP001
      *                                                                                       CAS001
      ** Determine if CAS001 is installed                                                     CAS001
      *                                                                                       CAS001
     C                     CALL 'AOSARDR0'                                                    CAS001
     C                     PARM *BLANKS   PRTCD                                               CAS001
     C                     PARM '*VERIFY 'POPTN                                               CAS001
     C                     PARM 'CAS001'  PSARD                                               CAS001
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS001
      *                                                                                       CAS001
     C           PRTCD     IFNE *BLANKS                                                       CAS001
     C           PRTCD     ANDNE'*NRF   '                                                     CAS001
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS001
     C                     MOVEL'06'      DBASE                                               CAS001
     C                     MOVEL'CAS001'  DBKEY  29                                           CAS001
     C                     EXSR *PSSR                                                         CAS001
     C                     ENDIF                                                              CAS001
      *                                                                                       CAS001
     C           PRTCD     IFEQ *BLANKS                                                       CAS001
     C                     MOVE 'Y'       CAS001  1                                           CAS001
     C                     MOVE *ON       *IN55                                               CAS001
     C                     ELSE                                                               CAS001
     C                     MOVE 'N'       CAS001                                              CAS001
     C                     MOVE *OFF      *IN55                                               CAS001
     C                     ENDIF                                                              CAS001
     C/COPY WNCPYSRC,FDH00050
      *                                                                                       CAS001
      ** Determine if CAS005 is installed                                                     CAS005
      *                                                                                       CAS005
     C                     CALL 'AOSARDR0'                                                    CAS005
     C                     PARM *BLANKS   PRTCD                                               CAS005
     C                     PARM '*VERIFY 'POPTN                                               CAS005
     C                     PARM 'CAS005'  PSARD                                               CAS005
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS005
      *                                                                                       CAS005
     C           PRTCD     IFNE *BLANKS                                                       CAS005
     C           PRTCD     ANDNE'*NRF   '                                                     CAS005
     C           *LOCK     IN   LDA                                                           CAS005
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS005
     C                     MOVEL'07'      DBASE                                               CAS005
     C                     MOVEL'CAS005'  DBKEY                                               CAS005
     C                     OUT  LDA                                                           CAS005
     C                     EXSR *PSSR                                                         CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                       CAS005
     C           PRTCD     IFEQ *BLANKS                                                       CAS005
     C                     MOVE 'Y'       CAS005  1                                           CAS005
     C                     MOVE *ON       *IN56                                               CAS005
     C                     ELSE                                                               CAS005
     C                     MOVE 'N'       CAS005                                              CAS005
     C                     MOVE *OFF      *IN56                                               CAS005
     C                     ENDIF                                                              CAS005
      *                                                                                      BUG5677
      ** Determine if Management Limit (CGP003) enhancement is on.                           BUG5677
      *                                                                                      BUG5677
     C                     MOVE 'N'       CGP003  1                                          BUG5677
      *                                                                                      BUG5677
     C                     CALL 'AOSARDR0'                                                   BUG5677
     C                     PARM *BLANKS   PRTCD                                              BUG5677
     C                     PARM '*VERIFY' POPTN                                              BUG5677
     C                     PARM 'CGP003'  PSARD                                              BUG5677
     C           SCSARD    PARM SCSARD    DSFDY                                              BUG5677
      *                                                                                      BUG5677
     C           PRTCD     IFNE *BLANKS                                                      BUG5677
     C           PRTCD     ANDNE'*NRF   '                                                    BUG5677
     C           *LOCK     IN   LDA                                                          BUG5677
     C                     MOVEL'SCSARDPD'DBFILE                                             BUG5677
     C                     MOVEL'CGP003'  DBKEY                                              BUG5677
     C                     MOVEL'12'      DBASE                                              BUG5677
     C                     OUT  LDA                                                          BUG5677
     C                     MOVE *ON       *INU7                                              BUG5677
     C                     MOVE *ON       *INU8                                              BUG5677
     C                     EXSR *PSSR                                                        BUG5677
     C                     ENDIF                                                             BUG5677
      *                                                                                      BUG5677
     C           PRTCD     IFEQ *BLANKS                                                      BUG5677
     C                     MOVE 'Y'       CGP003                                             BUG5677
     C                     ENDIF                                                             BUG5677
      *                                                                                       CDL019
      ** Determine if CDL019 is installed                                                     CDL019
      *                                                                                       CDL019
     C                     CALL 'AOSARDR0'                                                    CDL019
     C                     PARM *BLANKS   PRTCD                                               CDL019
     C                     PARM '*VERIFY 'POPTN                                               CDL019
     C                     PARM 'CDL019'  PSARD                                               CDL019
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL019
      *                                                                                       CDL019
     C           PRTCD     IFEQ *BLANKS                                                       CDL019
     C                     MOVE 'Y'       CDL019  1                                           CDL019
     C                     MOVE *ON       *IN57                                               CDL019
     C                     ELSE                                                               CDL019
     C                     MOVE 'N'       CDL019                                              CDL019
     C                     MOVE *OFF      *IN57                                               CDL019
     C                     ENDIF                                                              CDL019
      *                                                                                       CAS005
      ** Determine if CAS008 is installed                                                     CAS008
      *                                                                                       CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   PRTCD                                               CAS008
     C                     PARM '*VERIFY 'POPTN                                               CAS008
     C                     PARM 'CAS008'  PSARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C           PRTCD     IFNE *BLANKS                                                       CAS008
     C           PRTCD     ANDNE'*NRF   '                                                     CAS008
     C           *LOCK     IN   LDA                                                           CAS008
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS008
     C                     MOVEL'08'      DBASE                                               CAS008
     C                     MOVEL'CAS008'  DBKEY                                               CAS008
     C                     OUT  LDA                                                           CAS008
     C                     EXSR *PSSR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ *BLANKS                                                       CAS008
     C                     MOVE 'Y'       CAS008  1                                           CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE 'N'       CAS008                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      ** Determine if CIR003 is installed                                                     CAS008
      *                                                                                       CAS008
     C                     CALL 'AOSARDR0'                                                    CAS008
     C                     PARM *BLANKS   PRTCD                                               CAS008
     C                     PARM '*VERIFY 'POPTN                                               CAS008
     C                     PARM 'CIR003'  PSARD                                               CAS008
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS008
      *                                                                                       CAS008
     C           PRTCD     IFNE *BLANKS                                                       CAS008
     C           PRTCD     ANDNE'*NRF   '                                                     CAS008
     C           *LOCK     IN   LDA                                                           CAS008
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS008
     C                     MOVEL'09'      DBASE                                               CAS008
     C                     MOVEL'CIR003'  DBKEY                                               CAS008
     C                     OUT  LDA                                                           CAS008
     C                     EXSR *PSSR                                                         CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           PRTCD     IFEQ *BLANKS                                                       CAS008
     C                     MOVE 'Y'       CIR003  1                                           CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE 'N'       CIR003                                              CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
     C           CAS008    IFEQ 'Y'                                                           CAS008
     C           CIR003    ANDEQ'Y'                                                           CAS008
     C                     MOVE *ON       *IN64                                               CAS008
     C                     ELSE                                                               CAS008
     C                     MOVE *OFF      *IN64                                               CAS008
     C                     ENDIF                                                              CAS008
      *                                                                                       CAS008
      * Copyright Statement - Standard Functions  * copyright
      * Initialise subfile control.
     C                     EXSR MEIZ#2
      *                                                                   S01486
      **  Access module file                                              S01486
      *                                                                   S01486
     C                     CALL 'AOMMODR0'                                S01486
     C                     PARM '*MSG   ' @RTCD                           S01486
     C                     PARM '*FIRST ' @OPTN                           S01486
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01486
      *                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVEL'SDMMODPD'DBFILE 10         ************* S01486
     C                     MOVEL'01'      DBASE   3         *DBERROR 001* S01486
     C                     MOVEL@OPTN     DBOPTN  7         ************* S01486
     C                     SETON                     U7U8LR               S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
      *                                                                   CPB001
      **  Instrument type is maintained if Private Banking is ON          CPB001
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *ON       *IN39                           CPB001
     C                     OPEN FDDTSTXT                                                      207288
     C                     ENDIF                                          CPB001
      *                                                                   S01486
      **  Access SDPORTPD for default Instrument Type                     S01486
      *                                                                   S01486
     C           BGPFMG    IFEQ 'Y'                                       S01486
     C/COPY WNCPYSRC,FD0650MC12
     C                     MOVE *ON       *IN39                           S01486
     C/COPY WNCPYSRC,FD0650MC13
     C                     CALL 'AOPORTR0'                                S01486
     C                     PARM '*MSG   ' @RTCD                           S01486
     C                     PARM '*FIRST ' @OPTN                           S01486
     C           SDPORT    PARM SDPORT    DSFDY                           S01486
      *                                                                   S01486
     C           @RTCD     IFNE *BLANK                                    S01486
     C                     MOVEL'SDPORTPD'DBFILE 10         ************* S01486
     C                     MOVEL'02'      DBASE   3         *DBERROR 002* S01486
     C                     MOVEL@OPTN     DBOPTN  7         ************* S01486
     C                     SETON                     U7U8LR               S01486
     C                     EXSR *PSSR                                     S01486
     C                     END                                            S01486
     C                     END                                            S01486
      *                                                                   CDL006
      **  Access Switchable Feature Details, Check if CDL006 is ON.       CDL006
      *                                                                   CDL006
     C                     MOVE 'N'       CDL006  1                       CDL006
     C                     CALL 'AOSARDR0'                                CDL006
     C                     PARM *BLANKS   PRTCD   7                       CDL006
     C                     PARM '*VERIFY' POPTN   7                       CDL006
     C                     PARM 'CDL006'  PSARD   6                       CDL006
     C           SCSARD    PARM SCSARD    DSFDY                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFEQ *BLANKS                                   CDL006
     C                     MOVE 'Y'       CDL006                          CDL006
     C                     ELSE                                           CDL006
      *                                                                   CDL006
     C           PRTCD     IFNE '*NRF   '                                 CDL006
     C                     MOVEL'SDSARDPD'DBFILE 10        ************   CDL006
     C                     MOVEL'03'      DBASE   3        * DBERR 03 *   CDL006
     C                     MOVELPOPTN     DBOPTN  7        ************   CDL006
     C                     MOVE *ON       *INU7                           CDL006
     C                     MOVE *ON       *INU8                           CDL006
     C                     MOVE *ON       *INLR                           CDL006
     C                     EXSR *PSSR                                     CDL006
     C                     ENDIF                                          CDL006
      *                                                                   CDL006
     C                     END                                            CDL006
      *                                                                   CFT006
      **  Access Switchable Feature Details, Check if CFT006 is ON.       CFT006
      *                                                                   CFT006
     C                     MOVE 'N'       CFT006  1                       CFT006
     C                     CALL 'AOSARDR0'                                CFT006
     C                     PARM *BLANKS   PRTCD   7                       CFT006
     C                     PARM '*VERIFY' POPTN   7                       CFT006
     C                     PARM 'CFT006'  PSARD   6                       CFT006
     C           SCSARD    PARM SCSARD    DSFDY                           CFT006
      *                                                                   CFT006
     C           PRTCD     IFEQ *BLANKS                                   CFT006
     C                     MOVE 'Y'       CFT006                          CFT006
     C                     ELSE                                           CFT006
      *                                                                   CFT006
     C           PRTCD     IFNE '*NRF   '                                 CFT006
     C                     MOVEL'SDSARDPD'DBFILE 10        ************   CFT006
     C                     MOVEL'04'      DBASE   3        * DBERR 04 *   CFT006
     C                     MOVELPOPTN     DBOPTN  7        ************   CFT006
     C                     MOVE *ON       *INU7                           CFT006
     C                     MOVE *ON       *INU8                           CFT006
     C                     MOVE *ON       *INLR                           CFT006
     C                     EXSR *PSSR                                     CFT006
     C                     ENDIF                                          CFT006
      *                                                                   CFT006
     C                     END                                            CFT006
      *                                                                   CFT008
      **  Access Switchable Feature Details, Check if CFT008 is ON.       CFT008
      *                                                                   CFT008
     C                     MOVE 'N'       CFT008  1                       CFT008
     C                     CALL 'AOSARDR0'                                CFT008
     C                     PARM *BLANKS   PRTCD   7                       CFT008
     C                     PARM '*VERIFY' POPTN   7                       CFT008
     C                     PARM 'CFT008'  PSARD   6                       CFT008
     C           SCSARD    PARM SCSARD    DSFDY                           CFT008
      *                                                                   CFT008
     C           PRTCD     IFEQ *BLANKS                                   CFT008
     C                     MOVE 'Y'       CFT008                          CFT008
     C                     ELSE                                           CFT008
      *                                                                   CFT008
     C           PRTCD     IFNE '*NRF   '                                 CFT008
     C                     MOVEL'SDSARDPD'DBFILE 10        ************   CFT008
     C                     MOVEL'05'      DBASE   3        * DBERR 05 *   CFT008
     C                     MOVELPOPTN     DBOPTN  7        ************   CFT008
     C                     MOVE *ON       *INU7                           CFT008
     C                     MOVE *ON       *INU8                           CFT008
     C                     MOVE *ON       *INLR                           CFT008
     C                     EXSR *PSSR                                     CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CFT008
     C                     ENDIF                                          CFT008
      *                                                                   CRE008
      **  Access Switchable Feature Details, Check if CRE008 is ON.       CRE008
      *                                                                   CRE008
     C                     MOVE 'N'       CRE008  1                       CRE008
     C                     CALL 'AOSARDR0'                                CRE008
     C                     PARM *BLANKS   PRTCD   7                       CRE008
     C                     PARM '*VERIFY' POPTN   7                       CRE008
     C                     PARM 'CRE008'  PSARD   6                       CRE008
     C           SCSARD    PARM SCSARD    DSFDY                           CRE008
      *                                                                   CRE008
     C           PRTCD     IFEQ *BLANKS                                   CRE008
     C                     MOVE 'Y'       CRE008                          CRE008
     C                     ELSE                                           CRE008
      *                                                                   CRE008
     C           PRTCD     IFNE '*NRF   '                                 CRE008
     C                     MOVEL'SCSARDPD'DBFILE 10        ************   CRE008
     C                     MOVEL'06'      DBASE   3        * DBERR 06 *   CRE008
     C                     MOVELPOPTN     DBOPTN  7        ************   CRE008
     C                     MOVE *ON       *INU7                           CRE008
     C                     MOVE *ON       *INU8                           CRE008
     C                     MOVE *ON       *INLR                           CRE008
     C                     EXSR *PSSR                                     CRE008
     C                     ENDIF                                          CRE008
      *                                                                   CRE008
     C                     END                                            CRE008
     C/COPY WNCPYSRC,FD0650MC52
      *                                                                   CFT006
      ** Determine if CGL014 is installed                                                     CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   PRTCD                                               CGL014
     C                     PARM '*VERIFY 'POPTN                                               CGL014
     C                     PARM 'CGL014'  PSARD                                               CGL014
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL014
      *                                                                                       CGL014
     C           PRTCD     IFNE *BLANKS                                                       CGL014
     C           PRTCD     ANDNE'*NRF   '                                                     CGL014
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL014
     C                     MOVEL'10'      DBASE                                               CGL014
     C                     MOVEL'CGL014'  DBKEY                                               CGL014
     C                     MOVE *ON       *INU7                                               CGL014
     C                     MOVE *ON       *INU8                                               CGL014
     C                     MOVE *ON       *INLR                                               CGL014
     C                     EXSR *PSSR                                                         CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C                     ENDIF                                                              CGL014
     C/COPY WNCPYSRC,FDH00031
      *                                                                                       CLE025
      ** Determine if CLE025 is installed                                                     CLE025
      *                                                                                       CLE025
     C                     CALL 'AOSARDR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*VERIFY 'POPTN                                               CLE025
     C                     PARM 'CLE025'  PSARD                                               CLE025
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           PRTCD     ANDNE'*NRF   '                                                     CLE025
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE025
     C                     MOVEL'11'      DBASE                                               CLE025
     C                     MOVEL'CLE025'  DBKEY                                               CLE025
     C                     MOVE *ON       *INU7                                               CLE025
     C                     MOVE *ON       *INU8                                               CLE025
     C                     MOVE *ON       *INLR                                               CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     MOVE 'Y'       CLE025  1                                           CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE 'N'       CLE025                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           CLE025    OREQ 'Y'                                                           CLE025
     C                     MOVE *ON       *IN39                                               CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CAS009
      ** Determine if CAS009 is installed                                                     CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   PRTCD                                               CAS009
     C                     PARM '*VERIFY 'POPTN                                               CAS009
     C                     PARM 'CAS009'  PSARD                                               CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           PRTCD     IFNE *BLANKS                                                       CAS009
     C           PRTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     MOVEL'19'      DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY  29                                           CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           PRTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     MOVE *ON       *IN60                                               CAS009
      *                                                                                       231563
     C                     MOVE '      '  KSARN   6                                           231563
     C           '   '     CAT  '      '  KPNAM  10                                           231563
      *                                                                                       231563
     C           KSARP     KLIST                                                              231563
     C                     KFLD           KSARN                                               231563
     C                     KFLD           KPNAM                                               231563
      *                                                                                       231563
     C                     MOVEL'CAS009'  KSARN                                               231563
     C           'DLC'     CAT  '000020'  KPNAM                                               231563
      *                                                                                       231563
     C           KSARP     CHAIN@SARPL1              70                                       231563
      *                                                                                       231563
     C           *IN70     IFEQ *ON                                                           231563
     C           *LOCK     IN   LDA                                                           231563
     C                     MOVEL'SCSARPPD'DBFILE                                              231563
     C                     MOVEL'20'      DBASE                                               231563
     C                     MOVEL'CAS009'  DBKEY                                               231563
     C                     OUT  LDA                                                           231563
     C                     EXSR *PSSR                                                         231563
     C                     ELSE                                                               231563
      *                                                                                       231563
      ** Check if Initialisation Program for CAS009 Fee Codes has run                         231563
      *                                                                                       231563
     C           AKPRVC    IFEQ 'Y'                                                           231563
      *                                                                                       231563
      ** Set CAS009 Initialised Flag to Yes                                                   231563
      *                                                                                       231563
     C                     MOVE 'Y'       WCAS9I  1                                           231563
     C                     ENDIF                                                              231563
     C                     ENDIF                                                              231563
      *                                                                                       231563
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     MOVE *OFF      *IN60                                               CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           KDTST#    KLIST                                                              231563
     C                     KFLD           #1DTPE                                              231563
     C                     KFLD           #1DLST                                              231563
      *                                                                                       CDL038
      ** Determine if CDL038 is installed                                                     CDL038
      *                                                                                       CDL038
     C                     CALL 'AOSARDR0'                                                    CDL038
     C                     PARM *BLANKS   PRTCD                                               CDL038
     C                     PARM '*VERIFY 'POPTN                                               CDL038
     C                     PARM 'CDL038'  PSARD                                               CDL038
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL038
      *                                                                                       CDL038
     C           PRTCD     IFEQ *BLANKS                                                       CDL038
     C                     MOVE 'Y'       CDL038  1                                           CDL038
     C                     MOVE *ON       *IN65                                               CDL038
     C                     ELSE                                                               CDL038
     C                     MOVE 'N'       CDL038                                              CDL038
     C                     MOVE *OFF      *IN65                                               CDL038
     C                     ENDIF                                                              CDL038
      *                                                                   CPL002
      * If Midas-Plato Module is swtched on, set on indicator 50          CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C                     MOVE *ON       *IN50                           CPL002
     C                     ELSE                                           CPL002
     C                     MOVE *OFF      *IN50                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                                       CDL033
      ** Determine if CDL033 is installed                                                     CDL033
     C                     CALL 'AOSARDR0'                                                    CDL033
     C                     PARM *BLANKS   PRTCD                                               CDL033
     C                     PARM '*VERIFY 'POPTN                                               CDL033
     C                     PARM 'CDL033'  PSARD                                               CDL033
     C           SCSARD    PARM SCSARD    DSFDY                                               CDL033
      *                                                                                       CDL033
     C                     MOVE 'N'       CDL033  1                                           CDL033
     C           PRTCD     IFEQ *BLANKS                                                       CDL033
     C                     MOVE 'Y'       CDL033                                              CDL033
     C                     ELSE                                                               CDL033
     C           PRTCD     IFNE '*NRF   '                                                     CDL033
     C                     MOVE '12'      DBASE                                               CDL033
     C                     MOVEL'CDL033  'DBKEY                                               CDL033
     C                     MOVEL'SCSARDPD'DBFILE                                              CDL033
     C                     MOVE *ON       *INU7                                               CDL033
     C                     MOVE *ON       *INU8                                               CDL033
     C                     MOVE *ON       *INLR                                               CDL033
     C                     EXSR *PSSR                                                         CDL033
     C                     ENDIF                                                              CDL033
     C                     ENDIF                                                              CDL033
      *                                                                                       CER047
      ** Call AOSARDR0 to check for CER047                                                    CER047
      *                                                                                       CER047
     C                     CALL 'AOSARDR0'                                                    CER047
     C                     PARM *BLANKS   PRTCD                                               CER047
     C                     PARM '*VERIFY 'POPTN                                               CER047
     C                     PARM 'CER047'  PSARD                                               CER047
     C           SCSARD    PARM SCSARD    DSFDY                                               CER047
      *                                                                                       CER047
     C           PRTCD     IFEQ *BLANKS                                                       CER047
      *                                                                                       CER047
     C                     MOVE 'Y'       CER047  1                                           CER047
     C                     MOVE *OFF      *IN44                                               CER047
     C                     ELSE                                                               CER047
     C                     MOVE 'N'       CER047                                              CER047
     C                     MOVE *ON       *IN44                                               CER047
      *                                                                                       CER047
     C                     ENDIF                                                              CER047
      *                                                                                       CER047
     C           PRTCD     IFNE *BLANKS                                                       CER047
     C           PRTCD     ANDNE'*NRF   '                                                     CER047
      *                                                                                       CER047
     C           *LOCK     IN   LDA                                                           CER047
     C                     MOVE '010'     DBASE                                               CER047
     C                     MOVEL'CER047  'DBKEY                                               CER047
     C                     MOVEL'SCSARDPD'DBFILE                                              CER047
     C                     OUT  LDA                                                           CER047
     C                     EXSR *PSSR                                                         CER047
      *                                                                                       CER047
     C                     ENDIF                                                              CER047
      *================================================================
     CSR         ZZEXIT    ENDSR
     C*                                                                   S01408
     C/COPY WNCPYSRC,FD0650MCP9                                           S01408
     C*                                                                   S01408
      *================================================================   S01486
     C*                                                                   S01486
     C           *PSSR     BEGSR                                          S01486
      *                                                                   S01486
     C                     DUMP                                           S01486
     C/COPY WNCPYSRC,FD0650MC26
     C                     RETRN                                          S01486
      *                                                                   S01486
     C                     ENDSR                                          S01486
      *================================================================   S01486
      /EJECT                                                                                  207288
      *****************************************************************                       207288
      *                                                               *                       207288
      * VALSPT - Validate spot indicator                              *                       207288
      *                                                               *                       207288
      * Called by: DFV2RC                                             *                       207288
      *                                                               *                       207288
      * Calls: None                                                   *                       207288
      *                                                               *                       207288
      *****************************************************************                       207288
     C           VALSPT    BEGSR                                                              207288
      *                                                                                       207288
     C           #1DTPE    IFNE 'FP'                                                          207288
     C           #1DTPE    ANDNE'FS'                                                          207288
     C           #1DTPE    ANDNE'CX'                                                          207288
     C           #1DTPE    ANDNE'PI'                                                          207288
     C           #1DTPE    ANDNE'SI'                                                          207288
     C           #1DTPE    ANDNE'OP'                                                          207288
     C           #1DTPE    ANDNE'OT'                                                          207288
     C           #1DTPE    ANDNE'SW'                                                          207288
     C           #1SFLG    ANDNE' '                                                           207288
     C                     MOVEL'USR1780' ZAMSID                                              207288
     C                     MOVEL'GBMIDAS' ZAMSGF                                              207288
     C                     EXSR ZASNMS                                                        207288
     C                     MOVE '1'       *IN38                                               207288
     C                     MOVE '1'       *IN98                                               207288
     C                     ENDIF                                                              207288
      *                                                                                       207288
     C           #1DTPE    IFEQ 'FP'                                                          207288
     C           #1DTPE    OREQ 'FS'                                                          207288
     C           #1DTPE    OREQ 'CX'                                                          207288
     C           #1DTPE    OREQ 'PI'                                                          207288
     C           #1DTPE    OREQ 'SI'                                                          207288
     C           #1DTPE    OREQ 'OP'                                                          207288
     C           #1DTPE    OREQ 'OT'                                                          207288
     C           #1DTPE    OREQ 'SW'                                                          207288
     C           #1SFLG    IFEQ ' '                                                           207288
     C                     MOVE 'Y'       #1SFLG                                              207288
     C                     ENDIF                                                              207288
     C                     ENDIF                                                              207288
      *                                                                                       207288
     C           #1SFLG    IFNE 'Y'                                                           207288
     C           #1SFLG    ANDNE'N'                                                           207288
     C           #1SFLG    ANDNE' '                                                           207288
     C           *IN38     ANDEQ'0'                                                           207288
     C                     MOVEL'USR1781' ZAMSID                                              207288
     C                     MOVEL'GBMIDAS' ZAMSGF                                              207288
     C                     EXSR ZASNMS                                                        207288
     C                     MOVE '1'       *IN38                                               207288
     C                     MOVE '1'       *IN98                                               207288
     C                     ENDIF                                                              207288
      *                                                                                       207288
     C                     ENDSR                                                              207288
      *                                                                                       207288
      *****************************************************************                       207288
**
D=Delete   F3=Exit   F5=Refresh   F9=Go to 'Add' Mode
F3=Exit   F5=Reset Screen   F9=Go to 'Change' Mode
F3=Exit   F5=Refresh   F9=Go to 'Add' Mode
** CPY@     : Copyright notice for inclusion in all programs
(c) Misys International Banking Systems Ltd. 2001
** @CN Long constants used in program.
Y
CHG
01
50
N
ADD
?
?INVAL
00
33
02
32
34
36
47
49
44
46
I
NARRAT
*ERROR*
D
A
** OVRC                                                                                       CGP001
OVRDBF FILE(GPPRDXL0) TOFILE(GPPRODXL0)                                                       CGP001
OVRDBF FILE(GPINSXL0) TOFILE(GPINSTXL0)                                                       CGP001
** @DL (Deal Types valid to maintain Amortised Cost Accounting Indicator)                     CAS009
IP                                                                                            CAS009
TI                                                                                            CAS009
CL                                                                                            CAS009
DL                                                                                            CAS009
IT                                                                                            CAS009
TD                                                                                            CAS009
CI                                                                                            CAS009
CD                                                                                            CAS009
C2                                                                                            CAS009
BP                                                                                            CAS009
BD                                                                                            CAS009
TB                                                                                            CAS009
DA                                                                                            CAS009
TA                                                                                            CAS009
