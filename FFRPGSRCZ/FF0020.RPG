     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Trades input (main)')                         *
/*XBIA*  OVRDBF TRANSIN TRANS                                         *
/*XBIB*  OVRDBF TRSETIN TRSET                                         *
/*XBIC*  OVRDBF FOCLTB FOCLT                                          *
/*XBID*  OVRDBF FOCLTC FOCLT                                          *
     F*****************************************************************
     F*                                                               *
     F*  Midas  -  Futures and Options Module                         *
     F*                                                               *
     F*  FF0020  -  TRADES INPUT (DETAILS)                            *
     F*                                                               *
     F*     This program will be made redundant at DBA R4.00          *
     F*     In the interim please check the new ILE RPG versions      *
     F*     and apply any new fixes if they are appropriate.          *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CSD095             Date 08Apr14               *
      *                 CAP208             Date 06Dec10               *
      *                 AR746662           Date 03May11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23967           Date 14May09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246526             Date 21Mar07               *
      *                 247517             Date 09May07               *
      *                 CPK027             Date 16Apr07               *
      *                 243826A            Date 25Jan07               *
      *                 241147A            Date 07Nov06               *
      *                 241147             Date 26Oct06               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CDL031             Date 20Nov04               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 28Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGP001             Date 08Sep03               *
      *                 CDE005             Date 19Aug03               *
      *                 215528             Date 21Mar03               *
      *                 215092             Date 11Mar03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205075             Date 22Oct02               *
      *                 209483             Date 14Oct02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun02               *
      *                 CAS002             Date 14Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 04Oct01               *
      *                 172644             Date 09Jul01               *
      *                 CFF007             Date 13Feb01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 180497             Date 26Jun00               *
      *                 CFF006             Date 28Nov00               *
      *                 186482             Date 04Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 126117             Date 20Apr00               *
     F*                 140017             Date 20Apr00               *
     F*                 140455             Date 20Apr00               *
     F*                 136056             Date 18Apr00               *
     F*                 174957             Date 11Feb00               *
     F*                 CDE001             Date 10Feb00               *
     F*                 176510             DATE 07Apr00               *
     F*                 150367             DATE 07Apr00               *
     F*                 152234             DATE 29Mar00               *
     F*                 148384             DATE 24Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             DATE 18Jun99               *
     F*                 162534             Date 26Jul99               *
     F*                 167877             Date 21Sep99               *
     F*                 167824             Date 20Sep99               *
     F*                 167551             DATE 14SEP99               *
      * Midas DBA 3.01 Patch E ---------------------------------------*
      *                 171172             Date 25Nov99               *
      *                 170520             Date 19Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             DATE 08Mar99               *
     F*                 CAP003             DATE 22JUL98                  *
     F*                 111728             DATE 23FEB98               *
     F*                 111607             DATE 19FEB98               *
     F*                 117558             DATE 18FEB98               *
     F*                 122246             DATE 18FEB98               *
     F*                 125923             DATE 13NOV97               *
     F*                 125868             DATE 12NOV97               *
     F*                 CFF003             Date 14Apr97               *
     F*                 119910             Date 30Jun97               *
     F*                 118909             Date 05Jun97               *
     F*                 CAC003             Date 25Feb97               *
     F*                 117475             DATE 01MAY97               *
     F*                 111204             DATE 05MAR97               *
     F*                 102892             DATE 04MAR97               *
     F*                 105808             DATE 20FEB97               *
     F*                 105749             DATE 17FEB97               *
     F*                 CFF005             DATE 15OCT96               *
     F*                 CFF004             DATE 13SEP96               *
     F*                 S01408             DATE 07OCT96               *
     F*                 S01408             DATE 02SEP96               *
     F*                 S01408             DATE 23AUG96               *
     F*                 098644             DATE 29JUL96               *
     F*                 085995             DATE 08JUL96               *
     F*                 098501             DATE 28JUN96               *
     F*                 097069             DATE 16JAN96               *
     F*                 CPM003             DATE 13DEC95               *
     F*                 S71062             DATE 19AUG94               *
     F*                 077485             DATE 17OCT94               *
     F*                 068525             DATE 06APR94               *
     F*                 S01235             DATE 26JUN90               *
     F*                 S01408             DATE 22JAN96               *
     F*                 S01408             DATE 17OCT95               *
     F*                 087338             DATE 10MAY95               *
     F*                 S01408             DATE 06OCT95               *
     F*                 S01408             DATE 21SEP95               *
     F*                 CFF001             DATE 01JUN95               *
     F*                 073714             DATE 01MAR95               *
     F*                 085490             DATE 08JUN95               *
     F*                 081630             DATE 30MAR95               *
     F*                 084791             DATE 20MAR95               *
     F*                 S01408             DATE 13MAR95               *
     F*                 046303             DATE 17JAN94               *
     F*                 059376             DATE 15JAN94               *
     F*                 S01457             DATE 23DEC93               *
     F*                 S01455             DATE 05NOV93               *
     F*                 S04662             DATE 12JUL93               *
     F*                 S01411             DATE 05JUL93               *  *
     F*                 E35914             DATE 10MAY93               *
     F*                 054174             DATE 21APR93               *
     F*                 E30416             DATE 02MAR93               *
     F*                 E03643             DATE 19FEB93               *
     F*                 E30422             DATE 15FEB93               *
     F*                 E27760             DATE 15FEB93               *
     F*                 S01393             DATE 30OCT92               *
     F*                 E44985             DATE 25SEP92               *
     F*                  FUJI-FF0011        DATE 21SEP92                 *
     F*                  E38323             DATE 30JUL92                *
     F*                  E35979             DATE 17SEP92                 *
     F*                  AUS022             DATE 06AUG92                 *
     F*                  E36432             DATE 10MAR92                 *
     F*                  E26723             DATE 19SEP91                 *
     F*                  E26451             DATE 18JUL91                 *
     F*                  S01332             DATE 07JUN91                 *
     F*                  FO0096             DATE 26APR91                 *
     F*                  FO0025             DATE 18JAN91                 *
     F*                  FO0020             DATE 14JAN91                 *
     F*                  FO0019             DATE 14JAN91                 *
     F*                  FO0003             DATE 09JAN91                 *
     F*                  FO0018             DATE 08JAN91                 *
     F*                  FO0017             DATE 19DEC90                 *
     F*                  S01199             DATE 27FEB90                 *
     F*                  S01195             DATE 05FEB90                 *
     F*                  S01117             DATE 05FEB90                 *
     F*                  S01240             DATE 03JAN90                 *
     F*                  E17776             DATE 28/04/89                *
     F*                  E90100             DATE 30/01/89                *
     F*                                                                  *
     F*---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD095 - Allow Deal Sub-Type and Branch for MM and FX SSIs   *
      *           (Recompile)                                         *
      *  CAP208 - F&O Market Instrument API (Recompile)               *
      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
      *             screen and Projected Available Balance Enquiry    *
      *             Applied fix 249171. (Recompile)                   *
      *             (Child: Artf746663)                               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23967 - Add Local Industry Code Field.                    *
      *  246526 - Recompiled due to change in FFSETLZ4.               *
      *  247517 - Reversed fix 241147.                                *
      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
      *           changed FFTVCLZ2.                                   *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  241147A - Recompile.                                         *
      *  241147 - Recompile.                                          *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CDL031 - Effective Date on Extended SSI (Recompile)          *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines                                        *
      *  CAAA03 - Webfacing Changes. (recompile)                      *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGP001 - Global Processing.                                  *
      *           - SDWEIG* files renamed to GPWEIG*.                 *
      *           - AOWEIGR0 renamed to GPAOWEIGR0.                   *
      *  CDE005 - Data Export  - Reservation ID                       *
      *  215528 - System is associating a wrong premium amount.       *
      *           Recompiled only.                                    *
      *  215092 - Errors encountered while inserting Non-currencies   *
      *           OTCs.  Data area not allocated for output and       *
      *           database error due to Intrument Type not found in   *
      *           PF/INTYPD.  Lock data area LDA before executing the *
      *           OUT operation.  Initialise variable WWIN73          *
      *           accordingly.                                        *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  205075 - Instrument should be sent before the transaction.   *
      *  209483 - Initialise value of timestamp field of PF/TRANSD.   *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed FFYTOPZ1.                    *
      *  CAS002 - Hedge Strategy/Linkage (Recompile)                  *
      *  CPK014 - Release 4 packaging.  Rename of timestamp field.    *
      *  172644 - Review validation of Portfolio Reference            *
      *  CFF007 - Futures and Options Enhancement for Private Banking *
     F*  180497 - Validate Month and Year for Close Out reversal      *
      *  CFF006 - Fractional Ticks Enhancement.                       *
     F*  186482 - Portfolio reference field is highlighted though the *
     F*           customer is not a private banking customer.         *
     F*  126117 - Recompiled due to changes to FFYTOPZ1.              *
     F*  140017 - Recompiled due to changes to FFPMCLZ1.              *
     F*  140455 - Recompiled due to changes to FFPMCLZ1.              *
     F*  136056 - Calculate Australian option premiums correctly      *
     F*           Recompiled due to changes in FFYTOPZ1               *
     F*  174957 - Always update the database if a transaction is      *
     F*           amended. This is required in order to trigger CCRM  *
     F*           extracts. It was doing this inconsistently anyway,  *
     F*           i.e. it wouldn't do it for the first transaction    *
     F*           updated but it would for the second, etc.           *
     F*  CDE001 - Data Export - CCRM Limits                           *
     F*  176510 - Enhancement of parameters passed to AOPRFMR0 -      *  *
     F*           Account Officer is now also used.                   *  *
      *  150367 - Recompile over changed /copy FFSTDPZ4.                 *
     F*  152234 - Problem with OTC enhancements in the way it defines    *
     F*           minimum price fluctuation. It means that prices can    *
     F*           only be entered to 6 decimal places instead of 7.      *
     F*  148384 - If OTC Instrument Type entered populate screen with *
     F*           default values.                                     *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  162534 - Field SINNR must be displayed when PM in *on and    *
     F*           not depending on CFF001 (OTC enhancements)          *
     F*  167877 - For some OTC trades, the Plato information is not   *
     F*           being validated.                                    *
     F*  167824 - Unable to amend Spot price for Non-OTC trade.       *
     F*           (Recompile change of display file).                 *
     F*  167551 - Change of Plato requirement- the term to maturity   *
     F*           is now in the format nnnX.                          *
     F*  171172 - Recompile over changed POSTNCD/POSTNKD              *
      *  170520 - Recompile over changed TRANSD file                  *
     F*  CPL002 - Midas-Plato Interface                               *
     F*         - Second screen will be available for OTC options with*
     F*           Processing Type 4 or 6.                             *
     F*         - Add Spot Price to all options screens.              *
     F*         - If the Midas-Plato Interface is installed, the      *
     F*           Premium Currency for an OTC Currency Option must    *
     F*           be equal to the Counter Currency.                   *
     F*  CAP003 - APIs conversion phase 2 - recompile to handle       *
     F*           timestamp fields.  Also put in fix to 125923, to    *
     F*           correct question-mark processing (qm processing     *
     F*           was calling AOCUSTR0 instead of AOFOCSR0).          *
     F*  111728 - Problems with OTC in OTC Enquiry                    *
     F*  111607 - REMOVE PARTLY OF 105749 : THE DELIVERY AMOUNT AND   *
     F*           THE DELIVERY CURRENCY MUST BE VALIDATE              *
     F*           REMOVE PARTLY OF 111204 : THE DELIVERY CURRENCY     *
     F*           IS NOW CORRECTLY SETTED UP                          *
     F*  117558 - When warning message W74 is produced for OTC input's*
     F*           (W74 because OTC not found in PRICSD) *IN08 is ON   *
     F*           then for Instrument processing type 4(other than 5) *
     F*           field WQOTC is uncorrectly setted up and then in    *
     F*           redisplay after press ENTER on warning W74 error msg*
     F*           324 appear.                                         *
     F*  122246 - IF A TRANSACTION IS DELETED, ALSO DELETE THE        *
     F*           CLOSE-OUT ONE GENERATED BY THE SYSTEM (RECOGNIZED   *
     F*           BY THE MINUS SIGN) IF EXISTS                        *
     F*  125923 - Program not accessing F&O cust details correctly.   *
     F*           Amend fix 105808 to first access SDCUSTPD to check  *
     F*           that the customer is on the file and then access    *
     F*           SDFOCSPD to determine if it is an F&O customer and  *
     F*           whether it is a broker.                             *
     F*  125868 - No reason for # of contracts to default to 1        *
     F*  CFF003 - ENHANCED OTC PROCESSING - PHASE II                  *
     F*           UPGRADE FROM BLI LBL001                             *
     F*  119910 - Portfolio Reference should only be entred for custmr*
     F*  118909 - Settlement Account not found but Account exists     *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  117475 - HOOK INSERTED FOR WINDOWS PROCESSING                *
     F*  111204 - IF CURRENCY FOR AMOUNT = *BLANK TAKE INSTRUMENT CCY *
     F*  102892 - AFTER FIRST INPUT FIELD WCCAM WRONGLY SETUP FOR     *
     F*           OTC INPUT                                           *
     F*  105808 - WRONG FILE FOR FF CUSTOMER                          *
     F*  105749 - VALIDATION OF CURRENCY CHANGES                      *
     F*  CFF005 - '?' processing for market instrument.               *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  S01408 - Core Hook FF0020CP50 Added                          *
     F*         - Core Hook FF0020CP49 Added                          *
     F*  S01408 - Core Hook FF0020CP48 Added                          *
     F*  S01408 - Core Hook FF0020CP47 Added                          *
     F*         - Core Hook FF0020CP46 Added                          *
     F*         - Core Hook FF0020CP45 Added                          *
     F*         - Core Hook FF0020CP44 Added                          *
     F*         - Core Hook FF0020CP43 Added                          *
     F*         - Core Hook FF0020CP42 Added                          *
     F*         - Core Hook FF0020CP41 Added                          *
     F*         - Core Hook FF0020CP40 Added                          *
     F*         - Core Hook FF0020CP39 Added                          *
     F*         - Core Hook FF0020CP38 Added                          *
     F*         - Core Hook FF0020CP37 Added                          *
     F*         - Core Hook FF0020CP36 Added                          *
     F*         - Core Hook FF0020CP35 Added                          *
     F*         - Core Hook FF0020CP34 Added                          *
     F*         - Core Hook FF0020CP33 Added                          *
     F*         - Core Hook FF0020CP32 Added                          *
     F*         - Core Hook FF0020CP31 Added                          *
     F*         - Core Hook FF0020CP30 Added                          *
     F*         - Core Hook FF0020CP29 Added                          *
     F*  098644 - Counter amount field is not initialised for OTC     *
     F*           non-FX options. This field in PF/INTYPD would then  *
     F*           contain blanks, but it is initialised to zero when  *
     F*           the instrument is amended via OTC maintenance. When *
     F*           a second trade is input on this instrument with all *
     F*           essential fields same as those of the instrument,   *
     F*           pgm still invalidates the trade (error code 324) as *
     F*           it compares zeros with blanks for counter amount.   *
     F*  085995 - Incorrect branch used for settlement account. Set   *
     F*           up branch code correctly for sett. type '05'        *
     F*  098501 - Nostro code field can be left blank when settlement *
     F*           method 08 is used. This causes subsequent DB error  *
     F*           in update by AOSPOSU0 (which is called by AOOUOTU0).*
     F*  097069 - Remove validation (other than non-zero and numeric) *
     F*           from Linked Reference Number field. This has been   *
     F*           done to match other deal input programs which do not*
     F*           validate this field.  Also, do not update the trade *
     F*           record for the linked trade if input.               *
     F*  CPM003 - FF PM Interface Upgrade to R10.                     *
     F*         - Core Hook FF0020IIP3 Added                          *
     F*         - Core Hook FF0020CP26 Added                          *
     F*         - Core Hook FF0020CP27 Added                          *
     F*         - Core Hook FF0020CP28 Added                          *
     F*  S71062 - FF/PM INTERFACE DEVELOPMENT                         *
     F*  077485 - FF/PM INTERFACE : MATURE FLAT POSITIONS NOT         *
     F*           EXTRACTED FOR FF TRADES                             *
     F*  068525 - When linked reference specified, that trade number  *
     F*           was written in FFACMVD. (Produced by read TRANSIN)  *
     F*  S01235 - PORTFOLIO MANAGEMENT AMENDMENT                      *
     F*  S01408 - Core Hook FF0020IIP2 Added                          *
     F*         - Core Hook FF0020CP22 Added                          *
     F*         - Core Hook FF0020CP23 Added                          *
     F*         - Core Hook FF0020CP24 Added                          *
     F*         - Core Hook FF0020CP25 Added                          *
     F*  S01408 - Addition of Core Hook  FF0020IIP1                   *
     F*  087338 - OTC premium value date should be validated against  *
     F*           holidays for premium currency rather than local     *
     F*           currency.                                           *
     F*  S01408 - Addition of Core Hooks FF0020CCP4                   *
     F*                                  FF0020CCP5                   *
     F*                                  FF0020CCP6                   *
     F*                                  FF0020CCP7                   *
     F*                                  FF0020CCP8                   *
     F*                                  FF0020CCP9                   *
     F*                                  FF0020CP10                   *
     F*                                  FF0020CP11                   *
     F*                                  FF0020CP12                   *
     F*                                  FF0020CP13                   *
     F*                                  FF0020CP14                   *
     F*                                  FF0020CP15                   *
     F*                                  FF0020CP16                   *
     F*                                  FF0020CP17                   *
     F*                                  FF0020CP18                   *
     F*                                  FF0020CP19                   *
     F*                                  FF0020CP20                   *
     F*                                  FF0020CP21                   *
     F*  S01408 - Addition of Core Hooks FF0020FFP1                   *
     F*         - Core hook FF0020CCP1 added                          *
     F*         - Core hook FF0020CCP2 added                          *
     F*         - Core hook FF0020CCP3 added                          *
     F*  CFF001 - MAKE OTC ENHANCEMENTS SWITCHABLE                    *
     F*  073714 - OTC ENHANCEMENTS                                    *
     F*  085490 - Projected Account movements for OTC's should go to  *
     F*           ordinary enquiries like MEMOS, PRONO, RSACMTPD.     *
     F*  081630 - If Amend mode and nothing has been changed, do not  *
     F*           update file.  This will prevent generation of       *
     F*           unnecessary projected movenemt records.             *
     F*  084791 - Correct validation for Month/Year fields - if month *
     F*           is not a quoted month on the instrument and forward *
     F*           spot months is zero, error 045 should show.         *
     F*  S01408 - Core hook FF0020IIPG added                          *
     F*         - Core hook FF0020CCPG added                          *
     F*         - Core hook FF0020CVSF added                          *
     F*         - Core hook FF0020CVS1 added                          *
     F*         - Core hook FF0020CVS2 added                          *
     F*         - Core hook FF0020CVS3 added                          *
     F*         - Core hook FF0020CVS4 added                          *
     F*         - Core hook FF0020CVS5 added                          *
     F*         - Core hook FF0020CVS6 added                          *
     F*  046303 - /COPY source subr. ZFWDT amended to prevent array   *
     F*           error if no holiday record found - fixed by S01434. *
     F*           Program recompiled.                                 *
     F*  059376 - AOBRCHR0 is called with blank branch code.          *
     F*  S01457 - Enable brokers to deal with OTC's                   *
     F*  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                      *
     F*           Recompiled due to changes in PF/TABTB80.            *
     F*  S04662 - Switchable Feature for Init Margins for Futures;    *
     F*           Deposit and Spread Margin Rate added to DEFLTD.     *
     F*           Recompile only.                                     *
     F*  S01411 - 'ORIGINAL ENTRY DATE' field added to PF/TRANSD      *  *
     F*  E35914 - Profit centre is not a mandatory field therefore    *
     F*           blank is a valid value.                             *
     F*  054174 - Premium Calculation introduced by E30422            *
     F*           should only apply to processing type 8              *
     F*  E30416 - Recompiled due to amendments on subroutine FFYTOP   *
     F*  E03643 - Recompile because of change to pf/clostt            *
     F*  E30422 - Premium calculations appear to be incorrect on      *
     F*           options purchased. To fix the error, the strike     *
     F*           price is used in the tick value computations        *
     F*           instead of the contract price.                      *
     F*  E27760 - Cannot enquire on a deleted future and options      *
     F*           trade.  Error message indicates that an enquiry     *
     F*           should be possible.                                 *
     F*   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT            *
     F*                                                                  *
     F*   E44985  -  ZYIELD requires 3 new parameters. Recompile only    *
     F*                                                                  *
     F* FUJI-FF0011 - The system does not differentiate between          *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*               *** RECOMPILE ONLY ***                             *
     F*                                                                  *
     F*   E38323  -  Recompilation of the program done due to a change   *
     F*              in copy source ZFWDT subroutine                     *
     F*   E35979  -  Change year/month validation to prevent validation  *
     F*              error 045 occuring if any of the dates defined for  *
     F*              the instrument are after 1999.                      *
     F*                                                                  *
     F*  AUS022 - AUSTRALIAN CHANGE : Introduction of Processing         *
     F*           Types 7 and 8.                                         *
     F*  E36432 - Defaulting of branches is incorrectly coded.  /If      *
     F*           multibranching, do not display default branches at     *
     F*           first screen.  Booking branch should use the           *
     F*           default branch if entry is blank.  Originating         *
     F*           branch should default to the booking branch if         *
     F*           entry is blank.                                        *
     F*   E26723  -  The validation of profit centre should not be       *
     F*              conditioned on whether a customer has been entered  *
     F*              on the trade but only on whether profit centres     *
     F*              are used and amendment is possible.                 *
     F*   E26451  -  Del/Amd  of trades in matured instruments should    *
     F*              not be allowed.                                     *
     F*   S01332  -  Amended for Exposure Management Release 10 to       *
     F*              allow linked enquiry                                *
     F*   FO0096  -  IF A CUSTOMER NUMBER IS IN THE 'FOR ACCOUNT OF'     *
     F*              FIELD THEN IT SHOULD BE LEFT ADJUSTED NOT RIGHT.    *
     F*   FO0025  -  PASS DATA TO SR.WACMVD IN WORK FIELDS WITH NOSTRO   *
     F*   FO0020  -  REMOVE UPDAT OF FILES FOPCCD AND FOPCKD - POSITION  *
     F*              PROFIT CENTRES NOW AMENDED USING SEPARATE PROGRAM   *
     F*   FO0019  -  SET UP PGM TO HANDLE 'UPD. BY ANOTHER WRKSTN' FOR   *
     F*              FILES FOPCCD AND FOPCKD                             *
     F*   FO0003  -  CHANGE PROFIT CENTRE PROCESSING - OUTPUT SHOULD BE  *
     F*              CONDITIONED ON PROFIT CENTRES FLAG = 'Y', NOT ON    *
     F*              CUSTOMER DETAILS TO BE DISPLAYED (*IN15 ON)         *
     F*   FO0018  -  SET UP LCD, CHTP AND TNLU FIELDS ON FOPCCD AND      *
     F*              FOPCKD                                              *
     F*   FO0017  -  ADD BRCA ON UPDATE OF ACCOUNT MOVEMENTS FILE        *
     F*   S01199  -  HELP SYSTEM                                         *
     F*   S01195  -  HOLIDAY AMENDMENT                                   *
     F*   S01117  -  MULTIBRANCHING                                      *
     F*   S01240  -  ADDITION OF REAL-TIME STATEMENTS                    *
     F*   E17776  -  F9 & F12 STILL CONFUSED IN COMMENTS                 *
     F*              F10 & F12 NOT WORKING DUE TO WRONG DF               *
     F*   E90100  -  F9(TO CHANGE MARKET CODE) HAS NO EFFECT DUE TO      *
     F*              A CONVERSION ERROR WHEN IT BECAME CONFUSED WITH F12 *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*     IGNDECERR(*YES)                                              *
     F*     OVRDBF     FILE(TRANSIN) TOFILE(TRANS)                       *
     F*     OVRDBF     FILE(TRSETIN) TOFILE(TRSET)                       *
     F******OVRDBF*****FILE(TRANSLK) TOFILE(TRANS)                       *097069
     F*     OVRDBF     FILE(FOCLTB) TOFILE(FOCLT)                        *
     F*     OVRDBF     FILE(FOCLTC) TOFILE(FOCLT)                        *
     F*                                                                  *
     F********************************************************************
     F/EJECT
     FTRANSA  UF  E                    DISK         KCOMIT
     FPOSTNK  UF  E           K        DISK         KCOMIT       A
     FPOSTNC  UF  E           K        DISK         KCOMIT       A
     F/COPY WNCPYSRC,FF0020F003
     FPRONOM  UF  E           K        DISK         KCOMIT       A
     F/COPY WNCPYSRC,FF0020F001
     FMEMOSM  UF  E           K        DISK         KCOMIT       A    U2
     FFFACMVD O   E           K        DISK         KCOMIT       A        S01240
     FCLOST   UF  E           K        DISK         KCOMIT
     F*RANSLK*UF**E           K        DISK         KCOMIT                097069
     F************TRANSDF                           KRENAMETRANSLKF       097069
     FTRSET   UF  E           K        DISK         KCOMIT       A
     FTRANS   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     F***INTYPD*O***E           K        DISK         KCOMIT       073714 CPL002
     F*INTYP1***UF  E           K        DISK         KCOMIT       A                    CPL002CFF006
     FINTYP1  UF  E           K        DISK                      A                            CFF006
     F            INTYPDF                           KRENAMEINTYPWRT       073714
     FINTYPA  UF  E                    DISK         KCOMIT                073714
     FCNFRPD  O   E           K        DISK         KCOMIT                073714
     FFOPCC   UF  E           K        DISK         KCOMIT       A    UC  S01117
     F                                              KINFDS INFD1          FO0019
     FFOPCK   UF  E           K        DISK         KCOMIT       A    UC  S01117
     F                                              KINFDS INFD2          FO0019
     FCLOST2  IF  E           K        DISK
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FCHGCM   IF  E           K        DISK
     FDEFLT   IF  E           K        DISK
     FSDEXSTL1IF  E           K        DISK                               073714
     F*OOKD***IF* E           K        DISK                               S01117
     FFOCLTC  IF  E           K        DISK
     F            FOCLTDF                           KRENAMEFOCLTDCF
     FFOCLTB  IF  E           K        DISK
     F            FOCLTDF                           KRENAMEFOCLTDBF
     FSNAME   IF  E           K        DISK
     F            CLINTCBF                          KRENAMESNAMECBF
     FPRICS   IF  E           K        DISK
     FPRISP1  IF  E           K        DISK                               CPL002
     FINTYP2  IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYP2DF
     FINTYP   IF  E           K        DISK
     FTRSETIN IF  E           K        DISK
     F            TRSETDF                           KRENAMETRSETINF
     FTRANS8  IF  E           K        DISK
     F            TRANSDF                           KRENAMETRANS8DF
     FTRANSIN IF  E           K        DISK
     F            TRANSDF                           KRENAMETRANSINF
     FTRANS2  IF  E           K        DISK
     F            TRANSDF                           KRENAMETRANS2DF
     F*ABLETJ*IF* E           K        DISK                               S01117
     FTABFF   IF  E           K        DISK
     F            TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD 3     TABTB20F                          KIGNORE
     F* ICD 5     TABTB40F                          KIGNORE
     F* ICD-FF    TABTB80F                          KIGNORE
     F* A/C 1     TABTE10F                          KIGNORE
     F* CCY 1     TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F* NOSTROS   TABLETLF                          KIGNORE
     F* BRANCH    TABLETRF                          KIGNORE               S01117
     F            TABLETRF                          KIGNORE               S01117
     F* CPTY NOS  TABLET2F                          KIGNORE
     FPMPORTPDIF  E           K        DISK                           UC  S01235
     FFF0010DFCF  E                    WORKSTN
     F            FF0010F1                          KIGNORE
     FPRONO   UF  E           K        DISK         KCOMIT                CFF007
     F            PRONOHHF                          KIGNORE               CFF007
     FSECTY   IF  E           K        DISK                           UC  CFF007
      *                                                                                       CSD015
      ** Compliance Watch Hit List by Function Type, Identifier, Branch                       CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
     F*
     F/COPY WNCPYSRC,FF0020FFP1
     F*
     F*
     F/EJECT
     F*                  FUNCTION OF INDICATORS
     F*                 ************************
     F* ID F  C  H  L
     F*
     F*******01**      'HELP' key                                         S01199
     F*      01        Analytical Accounting Module is installed          CAC003
     F*
     F*      02        Insert  )
     F*      03        Amend   )  Action Codes
     F*      04        Delete  )
     F*      05        Enquire )
     F*
     F*      06        DSPF/FF0010DF - Read fail
     F*      07        FRCDTA enabled - for pgm FF0010
     F*      08        Not OTC FX Option                                  073714
     F*      09        Transaction Profit Centre is amendable             CAC003
     F*
     F*      10        Valid exit indicator / FRCDTA+LOCK enabled
     F*      11        Trade / Linked Trade Updated by Another Wrkstn
     F*
     F*******12**      Write new Book Posn Profit Centre record    FO0020 CAC003
     F*      12        Display Transaction Profit Centre                  CAC003
     F*      13        Display  Settlement Instructions (for insert)
     F*      14        Display  Broker Settlement Instructions
     F*      15        Display  Customer Settlement Instructions
     F*      16        Portfolio Reference                                S01235
     F*      17        Portfolio Reference to be protected                S01235
     F*
     F*      18        General Error Ind.
     F*      19        General Warning Error Ind.
     F*
     F*
     F*    Field Error Indicators
     F*   ~~~~~~~~~~~~~~~~~~~~~~~~
     F*      20        Action Code   (in FF0010)
     F*      21        Market Centre (in FF0010)
     F*      22        Transaction Reference
     F*
     F*    23-37     Mkt Instr / O.T.C. details
     F*      23        Purchase or Sale
     F*      24        No. of Contracts
     F*      25        Instrument / O.T.C. Type
     F*      26        Month
     F*      27        Year
     F*      28        Put/Call
     F*      29        Strike Price
     F*      30        Contract Price
     F*      31        Transaction Date
     F*      32        Broker
     F*      33        Customer
     F*      34        Book
     F*      35        Branch
     F*      36        To Be Left Open
     F*      37        Linked Reference
     F*
     F*****40-49*****Broker*Settlement*Instructions***********************S01117
     F*    39-49     Broker Settlement Instructions                       S01117
     F*      39        Commission Code (Standard)                         S01117
     F*      40        Commission Code (Same Day)                         S01117
     F*      41        Commission Amount                                  S01117
     F*      42        Charge Code                                        S01117
     F*      43        Charge Amount                                      S01117
     F*      44        Initial Margin                                     S01117
     F*      45        Settlement Type                                    S01117
     F*      46        Settlement Account                                 S01117
     F*      47        For Account Of                                     S01117
     F*      48        Counterparty Nostro                                S01117
     F*      49        Settlement Branch                                  S01117
     F*******40********Commission*Code*(Standard)*************************S01117
     F*******41********Commission*Code*(Same*Day)*************************S01117
     F*******42********Commission*Amount**********************************S01117
     F*******43********Charge*Code****************************************S01117
     F*******44********Charge*Amount**************************************S01117
     F*******45********Initial*Margin*************************************S01117
     F*******46********Settlement*Type************************************S01117
     F*******47********Settlement*Account*********************************S01117
     F*******48********For*Account*Of*************************************S01117
     F*******49********Counterparty*Nostro********************************S01117
     F*
     F*****50-59*****Customer*Settlement*Instructions*********************S01117
     F*    50-60     Customer Settlement Instructions                     S01117
     F*      50        Commission Code (Standard)
     F*                Non-display Underlying Instrument Details          CPL002
     F*      51        Commission Code (Same Day)
     F*                Protect fields on Enquiry                          CPL002
     F*      52        Commission Amount
     F*                Error in Instrument Type                           CPL002
     F*      53        Charge Code
     F*                Error in Term to Maturity                          CPL002
     F*      54        Charge Amount
     F*                Error in Coupon Rate                               CPL002
     F*      55        Initial Margin
     F*                Error in Coupon Frequency                          CPL002
     F*      56        Settlement Type
     F*                Error in Coupon Pricing Convention                 CPL002
     F*      57        Settlement Account
     F*                Error in Coupon Volatility Type                    CPL002
     F*      58        For Account Of
     F*                Error in Coupon Pricing Method                     CPL002
     F*      59        Counterparty Nostro
     F*      60        Settlement Branch                                  S01117
     F*
     F*
     F*      61        Originating Branch Used 'Y'                        S01117
     F*      62        Profit Centre Used 'Y'                             S01117
     F*******63**      Profit Centre is Amendable                  S01117 CAC003
     F*      63        Book Profit Centre is amendable                    CAC003
     F*      64        Multi-Branch Ind. 'N'
     F*      65        EOC Processed Ind. 'N'  (Amend only)
     F*      66        No. Contracts = No. Open Contracts  (Amd/Del only)
     F*
     F*******67**      Customer No./ Shortname in error                   CAC003
     F*      67        ERROR - Transaction Profit Centre                  CAC003
     F*
     F*      68        Enhanced OTC is present                            CFF001
     F*                                                                   CFF001
     F*******68********PF/FOPCCD - Write Fail.                     FO0019 CFF001
     F*      69        PF/FOPCCD - Write Fail.                            FO0019
     F*                                                                   FO0019
     F*      70        LF/TABFF    - Read/Chain fail,
     F*                + for Set Type 05 if A/c seq no is outside
     F*                range for Branch when Multi-Branch ind. = 'Y'
     F*      71        Other files - Read/Chain fail
     F*      72        Enquiry on a deleted record
     F*      73        LF/TRANS - Write fail
     F*      74        Counterparty nostro field contains customer
     F*                shortname
     F*
     F*      75        TESTN  Work indicator
     F*      76        LOKUP  Work indicator
     F*            OR  PM Intrument Type                                  CPM003
     F*
     F*      77        Program part of stack                              S01332
     F*                                                                   S01332
     F*      78        Originating Branch                                 S01117
     F*******79**      Profit Centre                               S01117 CAC003
     F*      79        ERROR- Book Profit Centre                          CAC003
     F*
     F*    80-89       Reserved for Standard FF Subroutines
     F*
     F*    90-99       Reserved for Standard MIDAS Subroutines
     F*      98        Date Format - MMDDYY if ON, DDMMYY if OFF
     F*
     F*      KC        F3 - exit program
     F*      KL        F12 - Previous Screen
     F*      KJ        F10 - delete
     F*******KL********F12 - Initial Screen (Change Action/Market)        E90100
     F*      KI        F9  - Initial Screen (Change Action/Market)        E90100
     F*
     F*      U1        Close Out Reversal required, due to trade deletion
     F*      U2        Retail II module present
     F*******U3********F12 - Initial Screen (Change Action/Market)        S01240
     F*      U3        F9 - Initial Screen (Change Action/Market)         S01240
     F*    U7+U8       Database Errors
     F*
     F/EJECT
     F/COPY WNCPYSRC,FF0020F002
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,FF0020E001
      **  Arrays of dates and balances retrieved from PRONOPN/PF          CFF007
     E                    @DT         6  5 0                              CFF007
     E                    @BL         5 15 0                              CFF007
     E                    @OLDBL      5 15 0                              CFF007
     E                    ERR        40  4
     E*    Error Codes
     E*    Warning Error Codes
     E********************WERR        5  4                                S71062
     E                    WERR        6  4                                S71062
     E*    Messages
     E/COPY WNCPYSRC,FF0020E002
     E***********         MSG     1   9 76                                S01332
     E**********          MSG     1  10 76                         S01332 CFF007
     E                    MSG     1  10 60                                CFF007
     E/COPY WNCPYSRC,FF0020E003
     E*    Broker Settlement Error codes
     E***********         BSEC   12  23  4                                S01117
     E**********          BSEC   12  25  4                         S01117 CFF007
     E                    BSEC   12  31  4                                CFF007
     E*    Customer Settlement Error codes
     E***********         CSEC   12  23  4                                S01117
     E**********          CSEC   12  25  4                         S01117 CFF007
     E                    CSEC   12  31  4                                CFF007
     E/COPY WNCPYSRC,FF0020E004
     E*    Settlement Fields - Error indicators  (value '0' or '1')
     E***********         SEI        10  1                                S01117
     E                    SEI        11  1                                S01117
     E*    Settlement Error codes array   (value ' ' or 'Y')
     E/COPY WNCPYSRC,FF0020E005
     E***********         SEA        23  1                                S01117
     E**********          SEA        25  1                         S01117 CFF007
     E                    SEA        31  1                                CFF007
     E/COPY WNCPYSRC,FF0020E006
     E*    Instrument Months Quoted
     E                    IMQ        12  1
     E*    Used in SR. FFSTDP
     E*    - Currencies / Currency decimal places
     E/COPY ZSRSRC,FFSTDPZ1
     E*    Used in SR. FFPRCS/FFPRVL
     E/COPY ZSRSRC,FFPRVLZ2
     E*    Used in SR. ZALIGN/ZEDIT
     E*    - Input + Output arrays
     E/COPY ZSRSRC,ZALIGNZ1
     E*    Used in SR. ZSEDIT                                             073714
     E*    - Input + Output arrays                                        073714
     E/COPY ZSRSRC,ZSEDITZ1                                               073714
     E*    Used in SR. ZDATE1/ZDATE2 :
     E*    - Years in days, cumulative 4-year span
     E*    - Months in days, cumulative through year
     E*    - Months, Shortnames
     E/COPY ZSRSRC,ZDATE2Z1
     E*    Used in SR. FFDATE
     E/COPY ZSRSRC,FFDATEZ1
     E*****Used*in*SR.*ZDATE3*********************************************S01195
     E*COPY*ZSRSRC,ZDATE3Z1                                               S01195
     E*****Used*in*SR.*ZDATE5*********************************************S01195
     E*****-*Holiday*Currencies*******************************************S01195
     E*COPY*ZSRSRC,ZDATE5Z1                                               S01195
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E                    POWER   1   7  7 3             POWER ARRAY      073714
      *                                                                   CFF007
     E                    RNG         9  5 0             RANGES           CFF007
     E                    AMT         9 13 0             AMOUNTS          CFF007
      *                                                                                       CSD015
      ** Arrays used for Midas Compliance Watch                                               CSD015
      ** XML Opening Tags for the Compliance Engine                                           CSD015
     E                    XOT     1   6 27                                                    CSD015
      *                                                                                       CSD015
      ** XML Closing Tags for the Compliance Engine                                           CSD015
     E                    XCT     1   6 28                                                    CSD015
      *                                                                                       CSD015
      ** Watch List Fields Array                                                              CSD015
     E                    WLF         6 35                                                    CSD015
      *                                                                                       CSD015
     E/COPY WNCPYSRC,FF0020E007
     E*
     E/EJECT
     I*                                                                   S71062
     IACCNTABF                                                            S71062
     I*                                                                   S71062
     I              PTFR                            ACPTFR                S71062
     I              PFCU                            ACPFCU                                    CLE025
     I*                                                                   S71062
     IACNUMABF                                                            S71062
     I*                                                                   S71062
     I              PTFR                            NUPTFR                S71062
     ITRANSDF
     I*    Trades (Main Update)
     I*
     I***********   BRCD                            BRCDTR                S01117
     I              BRCA                            BRCATR                S01117
     I              BOCO                            BOCOTR
     I              CUSC                            CUSCTR
     I              BOKC                            BOKCTR
     I              YRNO                            YRNOTR
     I              MTHN                            MTHNTR
     I              PCAL                            PCALTR
     I              STRP                            STRPTR
     I              TRTY                            TRTYTR
     I              NOCO                            NOCOTR
     I              NOBO                            NOBOTR
     I              COPR                            COPRTR
     I              PLSPTP                          SPTPTR                CPL002
     ITRANS8DF
     I*    Trades in Transaction Type within Closure Reference
     I*
     I              RECI                            RECI8
     I              TRTY                            TRTY8
     I              CLSR                            CLSR8
     ITRANSINF                                                            E26451
     I*                                                                   E26451
     I* Rename fields which could be overwritten during validation        E26451
     I*                                                                   E26451
     I              LCD                             LCDI                  E26451
     I              CHTP                            CHTPI                 E26451
     I              TNLU                            TNLUI                 E26451
     IINTYPDF
     I*    Instrument Types
     I*
     I              BCPT                            BCPTI
     I              CCPT                            CCPTI
     I              CTAM                            FFCTAM                AUS022
     I              CNTT                            FFCNTT                AUS022
     I              FRTK                            FRTKI                 CFF006
     IINTYP2DF
     I*    Selected Instrument Type details
     I*
     I              RECI                            RECI2
     I              ISTT                            ISTT2
     I              ISTI                            ISTI2
     I              ISPT                            ISPT2
     I              ISCY                            ISCY2
     I              QOTC                            QOTC2
     I              TKDM                            TKDM2
     I              MNPF                            MNPF2
     I              TKVL                            TKVL2
     I              OTHC                            OTHC2
     I              UNSE                            UNSE2                 CFF007
     I              TECO                            TECO2                 CFF007
     I              TNAT                            TNAT2                 CFF007
     I              CRIK                            CRIK2                 CFF007
     I              CCYR                            CCYR2                 CFF007
     I              TWEI                            TWEI2                 CFF007
     I/COPY WNCPYSRC,FF0020I027
     IFOCLTDBF
     I*    Futures + Options clients : Brokers
     I*
     I              SETP                            SETPB
     I              SETA                            SETAB
     I              FACO                            FACOB
     I              CNOS                            CNOSB
     I              SEBR                            SEBRB                 S01117
     IFOCLTDCF
     I*    Futures + Options clients : Customers
     I*
     I              SETP                            SETPC
     I              SETA                            SETAC
     I              FACO                            FACOC
     I              CNOS                            CNOSC
     I              SEBR                            SEBRC                 S01117
     IFOPCCDF                                                             S01117
     I*    Customer/Broker Position Profit Centre                         S01117
     I*                                                                   S01117
     I              RECI                            RECICC                S01117
     I              BRCA                            BRCACC                S01117
     I              CBCD                            CBCDCC                S01117
     I              ISTT                            ISTTCC                S01117
     I*                                                                   S01117
     IFOPCKDF                                                             S01117
     I*    Book Position Profit Centre                                    S01117
     I*                                                                   S01117
     I              RECI                            RECICK                S01117
     I              BRCA                            BRCACK                S01117
     I              BOKC                            BOKCCK                S01117
     I              ISTT                            ISTTCK                S01117
      *                                                                   CFF007
     ISECTYDF                                                             CFF007
     I              RECI                            RECISE                CFF007
     ICLOSTDF                                                                                 180497
     I*    Close Out Sets                                                                     180497
     I*                                                                                       180497
     I              ISTT                            ISTTCL                                    180497
     I              MTHN                            MTHNCL                                    180497
     I              YRNO                            YRNOCL                                    180497
     I*                                                                                       180497
     I/COPY WNCPYSRC,FF0020I028
     I*                                                                   CPL002
     IPRISPDF                                                             CPL002
     I*    Spot Price                                                     CPL002
     I*                                                                   CPL002
     I              RECI                            RECISP                CPL002
     I              ISTT                            ISTTSP                CPL002
     I*
     I*COPY*ZSRSRC,ZDATE3Z2                                               S01195
     I*COPY*ZSRSRC,ZDATE3Z3                                               S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
     I/COPY ZSRSRC,ZSEDITZ2                                               073714
     I*
     ISAMKDS      DS                             23
     I*    Screen - Action Code / Market Centre + Name
     I                                        1   1 SACTN
     I                                        2   3 SMRKT
     I                                        4  23 SMKTN
     I/COPY WNCPYSRC,FF0020I029
     I*                                                                   CFF004
     I*XSMIO***** DS                            264                 CFF004CPL002
     I***XSMIO**     DS                            280             CPL002 CFF007
     IXSMIO       DS                            306                       CFF007
     I*                                                                   CFF004
     I*SMIOSV**** DS                            264                 CFF004CPL002
     I***SMIOSV*     DS                            280             CPL002 CFF007
     ISMIOSV      DS                            306                       CFF007
     I*
     I*MIODS***** DS                            113                       S01117
     I*SMIODS*****DS                            116                S01117 073714
     I***SMIODS******DS                            228             073714 S01235
     I/COPY WNCPYSRC,FF0020I001
     I*SMIODS**** DS                            232                 S01235CFF004
     I/COPY WNCPYSRC,FF0020I002
     I*SMIODS*****DS                            264                 CFF004CPL002
     I***SMIODS*     DS                            280             CPL002 CFF007
     ISMIODS      DS                            306                       CFF007
     I/COPY WNCPYSRC,FF0020I030
     I*    Screen - Market Instrument / O.T.C.  details
     I                                        1   6 STNBR
     I                                        7   7 STRTY
     I                                        8  12 SNUCO
     I                                       13  15 SISTC
     I                                       16  20 SISTT
     I                                       21  23 SMTHN
     I                                       24  25 SYRNO
     I                                       26  26 SPCAL
     I/COPY WNCPYSRC,FF0020I003
     I***********                            27  38 SSTRP                 CFF004
     I***********                            39  50 SCOPR                 CFF004
     I/COPY WNCPYSRC,FF0020I004
     I                                       51  56 STRSD
     I                                       57  66 SBOCO
     I                                       57  57 SBOCO1
     I                                       58  66 SBOCO2
     I                                       67  76 SCUSC
     I                                       77  78 SBOKC
     I                                       79  81 SBRCD
     I                                       82 106 STNAR
     I                                      107 107 STBLO
     I                                      108 113 SLNKR
     I                                      114 116 SORBR                 S01117
     I                                      117 117 SAEIN                 073714
     I                                      118 131 SCTAM                 073714
     I                                      132 134 SDCCY                 073714
     I                                      135 148 SCCAM                 073714
     I                                      149 151 SCTCY                 073714
     I                                      152 154 SISCY                 073714
     I                                      155 155 SPUPF                 073714
     I                                      156 157 SQOTC                 073714
     I                                      158 163 SVALD                 073714
     I                                      164 169 SFTDT                 073714
     I                                      170 175 SFTTM                 073714
     I                                      170 173 SFTTMP                073714
     I                                      174 175 SFTTML                073714
     I                                      176 181 SSETD                 073714
     I                                      182 191 SCMRF                 073714
     I                                      192 202 STKVL                 073714
     I                                      203 213 SMNPF                 073714
     I                                      214 228 SPREM                 073714
     I                                      229 232 SPTFR                 S01235
     I/COPY WNCPYSRC,FF0020I005
     I                                      233 248 SSTRP                 CFF004
     I                                      249 264 SCOPR                 CFF004
     I                                      265 280 SSPTP                 CPL002
     I                                      281 281 SCOVE                 CFF007
     I                                      282 282 SHETR                 CFF007
     I                                      283 283 SBLUP                 CFF007
     I                                      284 293 SUNSE                 CFF007
     I                                      294 296 STECO                 CFF007
     I                                      297 299 STNAT                 CFF007
     I                                      300 301 SCRIK                 CFF007
     I                                      302 304 SCCYR                 CFF007
     I                                      305 306 STWEI                 CFF007
     I/COPY WNCPYSRC,FF0020I031
     I*
     I*SETDS***** DS                            164                       S01117
     I*SETDS***** DS                            174                S01117 CPM003
     I*SETDS***** DS                            177                CPM003 CAC003
     I***SSETDS*     DS                            185                                 CAC003 CGL029
     ISSETDS      DS                            197                                           CGL029
     I*    Screen - Settlement Instructions
     I                                        1   4 SPRFC                 S01117
     I**********                              5  89 SBSET                              S01117 CGL029
     I                                        5  95 SBSET                                     CGL029
     I                                        5   6 SBCMC                 S01117
     I                                        7   8 SBCMS                 S01117
     I                                        9  22 SBCMA                 S01117
     I                                        9   9 SBCMA1                S01117
     I                                       23  24 SBCHC                 S01117
     I                                       25  38 SBCHA                 S01117
     I                                       39  52 SBMAR                 S01117
     I                                       53  54 SBSLT                 S01117
     I                                       55  57 SBSBR                 S01117
     I                                       58  75 SBSLA                                     CGL029
     I                                       76  85 SBCPN                                     CGL029
     I                                       86  95 SBFAO                                     CGL029
     I                                       96 186 SCSET                                     CGL029
     I                                       96  97 SCCMC                                     CGL029
     I                                       98  99 SCCMS                                     CGL029
     I                                      100 113 SCCMA                                     CGL029
     I                                      100 100 SCCMA1                                    CGL029
     I                                      114 115 SCCHC                                     CGL029
     I                                      116 129 SCCHA                                     CGL029
     I                                      130 143 SCMAR                                     CGL029
     I                                      144 145 SCSLT                                     CGL029
     I                                      146 148 SBRSC                                     CGL029
     I                                      149 166 SCSLA                                     CGL029
     I                                      167 176 SCCPN                                     CGL029
     I                                      177 186 SCFAO                                     CGL029
     I                                      187 189 SINNR                                     CGL029
     I                                      190 193 SBPRC                                     CGL029
     I                                      194 197 STPRC                                     CGL029
     I**********                             58  69 SBSLA                              S01117 CGL029
     I**********                             70  79 SBCPN                              S01117 CGL029
     I**********                             80  89 SBFAO                              S01117 CGL029
     I**********                             90 174 SCSET                              S01117 CGL029
     I**********                             90  91 SCCMC                              S01117 CGL029
     I**********                             92  93 SCCMS                              S01117 CGL029
     I**********                             94 107 SCCMA                              S01117 CGL029
     I**********                             94  94 SCCMA1                             S01117 CGL029
     I**********                            108 109 SCCHC                              S01117 CGL029
     I**********                            110 123 SCCHA                              S01117 CGL029
     I**********                            124 137 SCMAR                              S01117 CGL029
     I**********                            138 139 SCSLT                              S01117 CGL029
     I**********                            140 142 SBRSC                              S01117 CGL029
     I**********                            143 154 SCSLA                              S01117 CGL029
     I**********                            155 164 SCCPN                              S01117 CGL029
     I**********                            165 174 SCFAO                              S01117 CGL029
     I**********                            175 177 SINNR                              CPM003 CGL029
     I**********                            178 181 SBPRC                              CAC003 CGL029
     I**********                            182 185 STPRC                              CAC003 CGL029
     I***********                             1  82 SBSET                 S01117
     I***********                             1   2 SBCMC                 S01117
     I***********                             3   4 SBCMS                 S01117
     I***********                             5  18 SBCMA                 S01117
     I***********                             5   5 SBCMA1                S01117
     I***********                            19  20 SBCHC                 S01117
     I***********                            21  34 SBCHA                 S01117
     I***********                            35  48 SBMAR                 S01117
     I***********                            49  50 SBSLT                 S01117
     I***********                            51  62 SBSLA                 S01117
     I***********                            63  72 SBCPN                 S01117
     I***********                            73  82 SBFAO                 S01117
     I***********                            83 164 SCSET                 S01117
     I***********                            83  84 SCCMC                 S01117
     I***********                            85  86 SCCMS                 S01117
     I***********                            87 100 SCCMA                 S01117
     I***********                            87  87 SCCMA1                S01117
     I***********                           101 102 SCCHC                 S01117
     I***********                           103 116 SCCHA                 S01117
     I***********                           117 130 SCMAR                 S01117
     I***********                           131 132 SCSLT                 S01117
     I***********                           133 144 SCSLA                 S01117
     I***********                           145 154 SCCPN                 S01117
     I***********                           155 164 SCFAO                 S01117
     I*
     I*XSET****** DS                             82                       S01117
     I***SXSET**     DS                             85                                 S01117 CGL029
     ISXSET       DS                             91                                           CGL029
     I*    Settlement Instructions  Redefined (Broker/Customer)
     I                                        1   4 SXCM
     I                                        1   2 SXCMC
     I                                        3   4 SXCMS
     I                                        5  18 SXCMA
     I                                        5   5 SXCMA1
     I                                        6  18 SXCMA2
     I                                       19  20 SXCHC
     I                                       21  34 SXCHA
     I                                       35  48 SXMAR
     I                                       49  50 SXSLT
     I                                       51  53 SXSLB                 S01117
     I                                       54  71 SXSLA                                     CGL029
     I                                       54  55 SXSLA1                                    CGL029
     I                                       56  71 SXSLA2                                    CGL029
     I                                       54  59 SXSLA3                                    CGL029
     I                                       60  71 SXSLA4                                    CGL029
     I                                       60  69 SXSLA5                                    CGL029
     I                                       70  71 SXSLA6                                    CGL029
     I                                       54  69 SXSLA7                                    CGL029
     I                                       72  81 SXCPN                                     CGL029
     I                                       82  91 SXFAO                                     CGL029
     I**********                             54  65 SXSLA                              S01117 CGL029
     I**********                             54  55 SXSLA1                             S01117 CGL029
     I**********                             56  65 SXSLA2                             S01117 CGL029
     I**********                             54  59 SXSLA3                             S01117 CGL029
     I**********                             60  65 SXSLA4                             S01117 CGL029
     I**********                             60  63 SXSLA5                             S01117 CGL029
     I**********                             64  65 SXSLA6                             S01117 CGL029
     I**********                             54  63 SXSLA7                             S01117 CGL029
     I**********                             66  75 SXCPN                              S01117 CGL029
     I**********                             76  85 SXFAO                              S01117 CGL029
     I***********                            51  62 SXSLA                 S01117
     I***********                            51  52 SXSLA1                S01117
     I***********                            53  62 SXSLA2                S01117
     I***********                            51  56 SXSLA3                S01117
     I***********                            57  62 SXSLA4                S01117
     I***********                            57  60 SXSLA5                S01117
     I***********                            61  62 SXSLA6                S01117
     I***********                            51  60 SXSLA7                S01117
     I***********                            63  72 SXCPN                 S01117
     I***********                            73  82 SXFAO                 S01117
     I*
     I*WMIODS*****DS                             48                       073714
     I/COPY WNCPYSRC,FF0020I006
     I*WMIODS**** DS                             53                 073714CFF004
     I/COPY WNCPYSRC,FF0020I007
      *                                                                   CPL002
     ISMPIDS      DS                                                      CPL002
      **   Screen - Midas-Plato Interface details                         CPL002
     I                                        1   1 SMIIT                 CPL002
     I                                        2   5 SMITM                 CPL002
     I************                            2   2 SPREF          CPL002 167551
     I************                            3   4 STERM          CPL002 167551
     I                                        2   4 STERM                 167551
     I                                        5   5 SSIGN                 CPL002
     I                                        6  17 SMICP                 CPL002
     I                                       18  18 SMICF                 CPL002
     I                                       19  19 SMIPC                 CPL002
     I                                       20  20 SMIVT                 CPL002
     I                                       21  21 SMIPM                 CPL002
     I                                       22  29 SMIPG                 CPL002
     I                                       30  37 SMIRG                 CPL002
     I                                       38  41 SMICR                 CPL002
     I                                       42  57 SMSPT                 CPL002
     I                                       58  63 SMITD                 CPL002
      *                                                                   CPL002
     I*WMIODS**** DS                             61                 CFF004CPL002
     IWMIODS      DS                             76                       CPL002
     I*    Work fields - Market Instrument / O.T.C.  details
     I**********                              1   60WBOCO                                     CSD027
     I**********                              7  120WCUSC                                     CSD027
     I                                        1   6 WBOCO                                     CSD027
     I                                        7  12 WCUSC                                     CSD027
     I                                       13  140WMTHN
     I                                       15  160WYRNO
     I***********                            17  277WSTRP                 CFF004
     I***************************************28  48 WMIOAM                073714
     I/COPY WNCPYSRC,FF0020I008
     I***********                            28  53 WMIOAM          073714CFF004
     I***********                            28  320WTRSD                 CFF004
     I***********                            33  370WNUCO                 CFF004
     I***********                            38  487WCOPR                 CFF004
     I***********                            38  410WCPINT                CFF004
     I***********                            42  420WCPDP1                CFF004
     I***********                            42  430WCPDP2                CFF004
     I***********                            42  440WCPDP3                CFF004
     I***********                            49  530WVALD           073714CFF004
     I/COPY WNCPYSRC,FF0020I009
      *                                                                   CFF004
     I                                       17  318WSTRP                 CFF004
     I                                       32  61 WMIOAM                CFF004
     I                                       32  360WTRSD                 CFF004
     I                                       37  410WNUCO                 CFF004
     I                                       42  568WCOPR                 CFF004
     I                                       42  480WCPINT                CFF004
     I                                       49  490WCPDP1                CFF004
     I                                       49  500WCPDP2                CFF004
     I                                       49  510WCPDP3                CFF004
     I                                       57  610WVALD                 CFF004
     I                                       62  768WSPTP                 CPL002
     I*
     IWSETDS      DS                             78
     I*    Work fields - Settlement Instructions
     I                                        1  130WBCMA
     I                                       14  260WCCMA
     I                                       27  390WBCHA
     I                                       40  520WCCHA
     I                                       53  650WBMAR
     I                                       66  780WCMAR
     I*                                                                   073714
     I/COPY WNCPYSRC,FF0020I010
     I*WINDET**** DS                             79                 073714CFF004
     I/COPY WNCPYSRC,FF0020I011
     I***WINDET*     DS                             83             CFF004 CFF007
     IWINDET      DS                            106                       CFF007
     I/COPY WNCPYSRC,FF0020I032
     I*    Work fields - O.T.C Instrument details                         073714
     I                                        1   1 WAEIN                 073714
     I                                        2  140WCTAM                 073714
     I                                       15  17 WOTHC                 073714
     I                                       18  300WCCAM                 073714
     I                                       31  33 WCTCY                 073714
     I                                       34  36 WISCY                 073714
     I                                       37  37 WPUPF                 073714
     I                                       38  380WQOTC                 073714
     I                                       39  430WFTDT                 073714
     I                                       44  49 WFTTM                 073714
     I                                       50  540WSETD                 073714
     I/COPY WNCPYSRC,FF0020I012
     I                                       55  685WTKVL                 073714
     I***********                            69  797WMNPF           073714CFF004
     I                                       69  838WMNPF                 CFF004
     I                                       84  93 WUNSE                 CFF007
     I                                       94  96 WTECO                 CFF007
     I                                       97  99 WTNAT                 CFF007
     I                                      100 101 WCRIK                 CFF007
     I                                      102 104 WCCYR                 CFF007
     I                                      105 1060WTWEI                 CFF007
     I*                                                                   073714
     I*FINDET**** DS                             79                 073714CFF004
     I/COPY WNCPYSRC,FF0020I013
     I***FINDET*     DS                             83             CFF004 CFF007
     IFINDET      DS                            106                       CFF007
     I/COPY WNCPYSRC,FF0020I033
     I*    File fields - O.T.C Instrument details                         073714
     I                                        1   1 AEIN                  073714
     I                                        2  140FFCTAM                073714
     I                                       15  17 OTHC                  073714
     I                                       18  300CCAM                  073714
     I                                       31  33 CTCY                  073714
     I                                       34  36 ISCY                  073714
     I                                       37  37 PUPF                  073714
     I                                       38  380QOTC                  073714
     I                                       39  430FTDT                  073714
     I                                       44  49 FTTM                  073714
     I                                       50  540SETD                  073714
     I                                       55  685TKVL                  073714
     I/COPY WNCPYSRC,FF0020I014
     I***********                            69  797MNPF            073714CFF004
     I/COPY WNCPYSRC,FF0020I015
     I                                       69  838MNPF                  CFF004
     I                                       84  93 UNSE                  CFF007
     I                                       94  96 TECO                  CFF007
     I                                       97  99 TNAT                  CFF007
     I                                      100 101 CRIK                  CFF007
     I                                      102 104 CCYR                  CFF007
     I                                      105 1060TWEI                  CFF007
     I/COPY WNCPYSRC,FF0020I034
     I*                                                                   073714
     I            DS                                                      073714
     I                                        1  20 ISTN                  073714
     I                                        1   3 ISTN01                073714
     I                                        4   4 ISTN02                073714
     I                                        5   7 ISTN03                073714
     I                                        9  15 ISTN04                073714
     I*
     I            DS
     I*    New Price redefined
     I/COPY WNCPYSRC,FF0020I016
     I***********                             1  117NEWP                  CFF004
     I***********                             1   40NPINT                 CFF004
     I***********                             5   50NPDP1                 CFF004
     I***********                             5   60NPDP2                 CFF004
     I***********                             5   70NPDP3                 CFF004
     I/COPY WNCPYSRC,FF0020I017
     I                                        1  158NEWP                  CFF004
     I                                        1   70NPINT                 CFF004
     I                                        8   80NPDP1                 CFF004
     I                                        8   90NPDP2                 CFF004
     I                                        8  100NPDP3                 CFF004
     I*
     I***WBSLA**     DS                             12                                        CGL029
     IWBSLA       DS                             18                                           CGL029
     I*    Broker Settlement A/c redefined
     I                                        1   6 WBSLA1
     I                                        7  16 WBSLA2                                    CGL029
     I                                       17  18 WBSLA3                                    CGL029
     I**********                              7  10 WBSLA2                                    CGL029
     I**********                             11  12 WBSLA3                                    CGL029
     I*
     I***WCSLA**     DS                             12                                        CGL029
     IWCSLA       DS                             18                                           CGL029
     I*    Customer Settlement A/c redefined
     I                                        1   6 WCSLA1
     I                                        7  16 WCSLA2                                    CGL029
     I                                       17  18 WCSLA3                                    CGL029
     I**********                              7  10 WCSLA2                                    CGL029
     I**********                             11  12 WCSLA3                                    CGL029
     I*                                                                   S01117
     I*
     IXBCCPT      DS                              2
     I*    Holds Broker/Customer Charge Pattern
     I                                        1   1 XBCPT
     I                                        2   2 XCCPT
     I*
     I            DS
     I*    Current Trading date - (MMDDYY or DDMMYY)
     I                                        1   6 CTD
     I                                        1   2 CT1
     I                                        3   4 CT2
     I                                        5   6 CT3
     I*
     I            DS
     I*    Current Year-Month
     I**********                              1   40CYM                   E35979
     I**********                              1   20CY                    E35979
     I**********                              3   40CM                    E35979
     I                                        1   60CYM                   E35979
     I                                        1   20CCN                   E35979
     I                                        3   40CY                    E35979
     I                                        5   60CM                    E35979
     I*
     I            DS
     I*    Work/Screen input  Year-Month
     I**********                              1   40WYM                   E35979
     I**********                              1   20WY                    E35979
     I**********                              3   40WM                    E35979
     I                                        1   60WYM                   E35979
     I                                        1   20WCN                   E35979
     I                                        3   40WY                    E35979
     I                                        5   60WM                    E35979
     I*
     I            DS
     I*    'Furthest Fwd Traded Period'/ Maximum Traded Year-Month
     I**********                              1   40MTYM                  E35979
     I**********                              1   20MTY                   E35979
     I**********                              3   40MTM                   E35979
     I                                        1   60MTYM                  E35979
     I                                        1   20MTCN                  E35979
     I                                        3   40MTY                   E35979
     I                                        5   60MTM                   E35979
     I*
     I            DS
     I*    'Furthest Forward Spot'/ Maximum Spot Year-Month
     I**********                              1   40MSYM                  E35979
     I**********                              1   20MSY                   E35979
     I**********                              3   40MSM                   E35979
     I                                        1   60MSYM                  E35979
     I                                        1   20MSCN                  E35979
     I                                        3   40MSY                   E35979
     I                                        5   60MSM                   E35979
     I*
     IISTTK       DS                              5
     I*   Key to LF/INTYP
     I*   Also, re-defines Instr. Type  into Mkt Centre + Instr. Code
     I                                        1   5 KISTT
     I                                        1   2 KMRKT
     I                                        3   5 KISTC
     I*
     I/COPY WNCPYSRC,FF0020I018
     I*PSTNCK**** DS                             30                       CFF004
     I/COPY WNCPYSRC,FF0020I019
     IPSTNCK      DS                             34                       CFF004
     I*    Key to LF/POSTNC
     I***********                             1   30KBRCDC                S01117
     I                                        1   3 KBRCAC                S01117
     I**********                              4   90KCBCDC                                    CSD027
     I                                        4   9 KCBCDC                                    CSD027
     I                                       10  14 KISTTC
     I                                       15  160KYRNOC
     I                                       17  180KMTHNC
     I                                       19  19 KPCALC
     I***********                            20  307KSTRPC                CFF004
     I                                       20  348KSTRPC                CFF004
     I*
     I/COPY WNCPYSRC,FF0020I020
     I*PSTNKK**** DS                             26                       CFF004
     I/COPY WNCPYSRC,FF0020I021
     IPSTNKK      DS                             30                       CFF004
     I*    Key to LF/POSTNK
     I***********                             1   30KBRCDK                S01117
     I                                        1   3 KBRCAK                S01117
     I                                        4   5 KBOKCK
     I                                        6  10 KISTTK
     I                                       11  120KYRNOK
     I                                       13  140KMTHNK
     I                                       15  15 KPCALK
     I/COPY WNCPYSRC,FF0020I022
     I***********                            16  267KSTRPK                CFF004
     I/COPY WNCPYSRC,FF0020I023
     I                                       16  308KSTRPK                CFF004
     I**   File Format of Price
     I/COPY ZSRSRC,FFSRDSZ1
     I**   Screen Format of Price
     I**   Minimum Price FluctN
     I/COPY ZSRSRC,FFPRCSZ3
     I/COPY ZSRSRC,FFDATEZ2
     I*
     IKICD        DS                             12
     I*    Key for ICD records
     I                                        1   2 KICD1
     I                                       11  12 KICD2
     I/COPY ZSRSRC,FFSTDPZ2
     I*    Key for Currencies Table file
     I*
     I*BRCD****** DS                             12                       S01117
     I*****Key*for*Branch*Codes*Table*file********************************S01117
     I***********                             1   2 KBRCD1                S01117
     I***********                            10  120FFBRCD                S01117
     I*    Settlement A/c redefined
     I*    Keys for  Nostro Codes / Account Codes  Table file
     I/COPY ZSRSRC,FFSETLZ1
     I*
     IKCPSH       DS                             12
     I*    Key for Counterparty Nostro Table file
     I                                        1   2 KCPSH1
     I                                        5  12 KCPSH2
     I*
     IKCSNM       DS                             10
     I*    Key to LF/SNAME
     I*    Also, re-defines Client Number/Shortname
     I                                        1   1 KCSNM1
     I                                        1   6 KCSNM2
     I                                        7  10 KCSNM3
     I*
     IERRDS       DS                            160
     I*    Display  Error Codes / Messages
     I                                        1 160 ERR
     I                                        1  77 SERCD1
     I                                       77 153 SERCD2
     I*
     I*EIDS****** DS                             10                       S01117
     ISEIDS       DS                             11                       S01117
     I*    Settlement Fields- Error inds redefined
     I***********                             1  10 SEI                   S01117
     I                                        1  11 SEI                   S01117
     I*
     IPSDS       SDS
     I*    Program Status data structure
     I/COPY WNCPYSRC,FF0020I026
     I                                      244 246 WSID
     I                                      254 263 USRID
     I*                                                                   FO0018
     IRUNDAT      DS                                                      FO0018
     I*    System Data Area For Midas Run Date.                           FO0018
     I                                        8  100RUND                  FO0018
     I*                                                                   FO0018
     IMNATN       DS                                                      FO0018
     I*    System Data Area For Trans No. of Last Update.                 FO0018
     I                                        1   5 TRAN                  FO0018
     I                                        1   50TRAN2                 FO0018
     I*
     ILDA         DS                            256
     I*    Local Data Area for Database Error Details
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I/COPY WNCPYSRC,FF0020I024
     I***********                           142 170 DBKEY           S01117CFF004
     I***********                           171 180 DBPGM           S01117CFF004
     I***********                           181 1830DBASE           S01117CFF004
     I/COPY WNCPYSRC,FF0020I025
     I                                      142 176 DBKEY                 CFF004
     I                                      177 186 DBPGM                 CFF004
     I                                      187 1890DBASE                 CFF004
     ISDPLIN    E DSSDPLINPD                                              CPM003
     I** Instrument types details                                         CPM003
     I              PDWEIG                          P2WEIG                                    CLE025
      *                                                                                       CLE025
     ISDMMOD    E DSSDMMODPD                                              CPM003
     I** EXTERNAL DS FOR LANGUAGE ID'S                                    CPM003
     I*                                                                   CPM003
     ISDPORT    E DSSDPORTPD                                              CPM003
     I** PM MODULE ACCESSED VIA ACCESS PROGRAM                            CPM003
     I*                                                                   CPM003
     ISDPLCS    E DSSDPLCSPD                                              CPM003
     I* Portfolio Customer Details Accessed Via Access Program            CPM003
     I*                                                                   CPM003
      ** Watch List Transaction Details (OPM)                                                 CSD015
     ISDWLTO    E DSSDWLTOPD                                                                  CSD015
      *                                                                                       CSD015
      ** Watch List Checking Details                                                          CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      *                                                                                       CSD015
      ** SD data area                                                                         CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      *                                                                                       CSD015
      ** 24X7 status data area                                                                CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      *                                                                                       CSD015
      ** External DS for SAR Details                                                          CSD015
     ISCSARD    E DSSCSARDPD                                                                  CSD015
     I              LCD                             SARLCD                                    CSD015
      *                                                                                       CSD015
      ** Compliance Watch Configuration Data File                                             CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      *                                                                                       CSD015
      ** DS for 2nd parameter of Compliance Engine                                            CSD015
     IPXML        DS                           9999                                           CSD015
      *                                                                                       CSD015
     ISDBOOK    E DSSDBOOKPD                                              S01117
     I** BOOK DETAILS                                                     S01117
     I              BDBKCD                          BOOK                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** BRANCH DETAILS                                                   S01117
     I              A8BRCD                          BRCH                  S01117
     I              A8LCCD                          LCCD                  S01195
     ISDCUST    E DSSDCUSTPD                                              S01117
     I** CUSTOMER DETAILS                                                 S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I              BBCUST                          CUST                  S01117
     I              BBCSSN                          CSSN                  S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I** GENERAL LEDGER DETAILS                                           S01117
     I              BKPRCU                          PFCU                  S01117
     I              BKPRCA                          PFCA                  S01117
     I              BKPCDU                          PFCD                  S01117
     I              BKOBRU                          OBUU                  S01117
     I              BKOBUV                          OBUV                  S01117
     ISDPRFC    E DSSDPRFCPD                                              S01117
     I** PROFIT CENTRE DETAILS                                            S01117
     I**                                                                  S01117
     I*                                                                   S01408
     I/COPY WNCPYSRC,FF0020IIPG                                           S01408
     I*                                                                   S01408
     ISDFOCS    E DSSDFOCSPD                                              105808
     I** FF Customer/Broker Details                                       105808
     ISDECOS    E DSSDECOSPD                                              CFF007
     I** SD Economic Sector Details                                       CFF007
     ISDNATU    E DSSDNATUPD                                              CFF007
     I** SD Nature Code Details                                           CFF007
     I*SDWEIG***E*DSSDWEIGPD***                                                        CFF007 CGP001
     IGPWEIG    E DSGPWEIGPD                                                                  CGP001
     I              PDLCD                           P2LCD                 CFF007
     I** SD Weighting Code Details                                        CFF007
     ISDCURR    E DSSDCURRPD                                              CFF007
     I** SD Currency Details                                              CFF007
     ISDINDS    E DSSDINDSPD                                              CFF007
     I** SD Local Industry Codes Details                                  CFF007
     ISDCTRY    E DSSDCTRYPD                                              CFF007
     I** SD Country codes Details                                         CFF007
      *                                                                                       CGL029
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I              QQACCD                          QQACC1                                    CGL029
      ** Account Code Details                                                                 CGL029
      *                                                                                       CGL029
     I@DSFDY    E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     I*                                                                   S01117
     IDSLDY     E DSDSLDY                                                 CPB001
     I*  FIRST DS FOR ACCESS PROGRAMS, VERY LONG DATA STRUCTURE           CPB001
     I*                                                                   CPB001
     I*    DTAARA/MNATN
     I/COPY ZSRSRC,ZTNLU1Z1
     I*
     IINFDS       DS
     I*    For File Exception/Error Handling on LF/TRANS
     I                                     *STATUS  STATUS
     I*                                                                   FO0019
     IINFD1       DS                                                      FO0019
     I*    For File Exception/Error Handling on PF/FOPCCD                 FO0019
     I                                     *STATUS  STATS1                FO0019
     IINFD2       DS                                                      FO0019
     I*    For File Exception/Error Handling on PF/FOPCKD                 FO0019
     I                                     *STATUS  STATS2                FO0019
     I*                                                                   FO0019
     I*MTTXT***** DS                            350                       S01117
     I*MTTXT***** DS                            363                S01117 S01235
     I*MTTXT***** DS                            367                S01235 CAC003
     I***CMTTXT*     DS                            382                                 CAC003 CGL029
     ICMTTXT      DS                            394                                           CGL029
     I*    To provide Text on COMIT Entry in journal
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 SACTNX
     I                                       26  35 USRIDX
     I                                       51  73 SAMK
     I***********                            74 193 SMIO           S01117 S01235
     I***********                           194 363 SSET           S01117 S01235
     I***********                            74 186 SMIO                  S01117
     I***********                           187 350 SSET                  S01117
     I                                       74 197 SMIO                  S01235
     I***********                           198 367 SSET           S01235 CAC003
     I**********                            198 382 SSET                               CAC003 CGL029
     I                                      198 394 SSET                                      CGL029
      *                                                                   S01332
     IEMSDS     E DSEMDTA                                                 S01332
      * External Data Area for Linked Enquiry Processing                  S01332
      *                                                                   S01332
     I@TRANS    E DSTRANSD                                                085490
     I              BRCA                            BRCATR                085490
     I              TRTY                            TRTYTR                085490
     I              COPR                            COPRTR                085490
     I              ISCY                            XXISCY                085490
     I              CUSC                            CUSCTR                CFF007
      *
      *                                                                   CFF007
      ** Redefine PRONOPN/PF data as arrays of dates and values           CFF007
      *                                                                   CFF007
     I            DS                                                      CFF007
     I                                        1  40 PNB                   CFF007
     I                                    P   1  40 @BL                   CFF007
     I                                       41  55 PND                   CFF007
     I                                    P  41  58 @DT                   CFF007
      *                                                                   CFF007
      ** Redefine @OLDBL for comparison                                   CFF007
      *                                                                   CFF007
     I                                       61 100 @@PNB2                CFF007
     I                                    P  61 100 @OLDBL                CFF007
     I/COPY WNCPYSRC,FF0020IIP1
      *
     I**********    CUSC                            CUSCTR         CFF003 CFF007
      *                                                                   CFF003
     I@TRSET    E DSTRSETD                                                085490
     I              RECI                            XXRECI                085490
     I              TNBR                            XXTNBR                085490
      *                                                                   CAP003
     I              FRNT                            XXFRNT                CAP003
     I              AFRT                            XXAFRT                CAP003
     I              REPA                            XXREPA                CAP003
     I              TMST                            XXTMST                                    CPK014
     I              ZONE                            XXZONE                                    CGP001
      *                                                                   CAP003
     IZ#BSTS    E DSZ#BST                                                 085490
     IZ#ASTS    E DSZ#AST                                                 085490
     IZ#WSTS    E DSZ#WST                                                 085490
     IZ#XSTS    E DSZ#XST                                                 085490
      * External Data Areas for OTC Account Movements update.             085490
      *                                                                   S01332
     I/EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                   CFF007
     IWRNG        DS                             45                       CFF007
      ** Data structure to store all CHRG/COMS lower range limit          CFF007
     I                                        1  450RNG                   CFF007
     I                                        1   50LR01                  CFF007
     I                                        6  100LR02                  CFF007
     I                                       11  150LR03                  CFF007
     I                                       16  200LR04                  CFF007
     I                                       21  250LR05                  CFF007
     I                                       26  300LR06                  CFF007
     I                                       31  350LR07                  CFF007
     I                                       36  400LR08                  CFF007
     I                                       41  450LR09                  CFF007
      *                                                                   CFF007
     IWAMT        DS                            117                       CFF007
      ** Data structure to store all CHRG/COMS amount                     CFF007
     I                                        1 1170AMT                   CFF007
     I                                        1  130CA01                  CFF007
     I                                       14  260CA02                  CFF007
     I                                       27  390CA03                  CFF007
     I                                       40  520CA04                  CFF007
     I                                       53  650CA05                  CFF007
     I                                       66  780CA06                  CFF007
     I                                       79  910CA07                  CFF007
     I                                       92 1040CA08                  CFF007
     I                                      105 1170CA09                  CFF007
      *                                                                   S01408
     I/COPY WNCPYSRC,FF0020IIP2                                           S01408
      *                                                                   S01408
     I/COPY ZSRSRC,ZYLDZ1                                                 AUS022
     I*                                                                   CPM003
     I*  DATA STRUCTURE TO PASS DATA TO WN0010 AND RETURN PGM             CPM003
      /COPY WNCPYSRC,FF0020IIP3                                           CPM003
      /COPY QWINDSRC,FF0020GDTA                                           117475
     C********************************************************************
     C**                                                                 *
     C**      K   E   Y        L   I   S   T   S                         *
     C**                                                                 *
     C********************************************************************
     C**
     C**   LF/TRANS8
     C           KTRNS8    KLIST
     C                     KFLD           KCLSR8  60
     C                     KFLD           KTRTY8  1
     C/COPY WNCPYSRC,FF0020C056
     C**   LF/PRICS
     C           KPRICS    KLIST
     C                     KFLD           KISTTP  5
     C                     KFLD           KYRNOP  20
     C                     KFLD           KMTHNP  20
     C                     KFLD           KPCALP  1
     C/COPY WNCPYSRC,FF0020CP76
     C*CO*Y WN*PY*RC*FF0020C046
     C/COPY WNCPYSRC,FF0020CQ76
     C***********          KFLD           KSTRPP 117                      CFF004
     C                     KFLD           KSTRPP                          CFF004
     C/COPY WNCPYSRC,FF0020CP77
     C*CO*Y WN*PY*RC*FF0020C047
     C/COPY WNCPYSRC,FF0020CQ77
     C           *LIKE     DEFN STRP      KSTRPP                          CFF004
      *                                                                   CFF004
     C**   LF/DEFLT
     C           KDEFLT    KLIST
     C**********           KFLD           KCBCD   60                                          CSD027
     C                     KFLD           KCBCD   6                                           CSD027
     C                     KFLD           KMRKT   2
     C                     KFLD           KISTC   3
     C**   LF/SDEXSTL1                                                    073714
     C           KEXST     KLIST                                          073714
     C                     KFLD           BYCYCD                          073714
     C                     KFLD           BYCUST                          073714
     C                     KFLD           BYTRTY                          073714
     C**   LF/CHGCM
     C           KCHGCM    KLIST
     C                     KFLD           KCCY    3
     C                     KFLD           KCGCM   20
     C**   LF/CLINT
     C           KCLINT    KLIST
     C**********           KFLD           KCBCD   60                                          CSD027
     C                     KFLD           KCBCD   6                                           CSD027
     C                     KFLD           KRCDT   1
     C**   LF/ACCNT
     C/COPY ZSRSRC,FFSETLZ2
     C**   LF/CLOST2
     C           KCLST2    KLIST
     C                     KFLD           KTNBR   60
     C                     KFLD           KCLON   60
     C**   LF/MEMOSM
     C*****uses*same*KLIST*as*LF/ACCNT**ie.*FFACTK************************S01117
     C           KMEMOS    KLIST                                          S01117
     C                     KFLD           MMBRCA  3                       S01117
     C**********           KFLD           MMCNUM  60                                   S01117 CSD027
     C                     KFLD           MMCNUM  6                                           CSD027
     C                     KFLD           MMCURR  3                       S01117
     C**********           KFLD           MMACOD  40                                   S01117 CGL029
     C                     KFLD           MMACOD 100                                          CGL029
     C                     KFLD           MMACSQ  20                      S01117
     C**   LF/PRONOM
     C           KPRONO    KLIST
     C                     KFLD           FFNCCY  3
     C                     KFLD           FFNOSN  20
     C**   LF/POSTNC
     C           KPSTNC    KLIST
     C***********          KFLD           KBRCDC  30                      S01117
     C                     KFLD           KBRCAC  3                       S01117
     C**********           KFLD           KCBCDC  60                                          CSD027
     C                     KFLD           KCBCDC  6                                           CSD027
     C                     KFLD           KISTTC  5
     C                     KFLD           KYRNOC  20
     C                     KFLD           KMTHNC  20
     C                     KFLD           KPCALC  1
     C/COPY WNCPYSRC,FF0020CP78
     C*CO*Y WN*PY*RC*FF0020C048
     C/COPY WNCPYSRC,FF0020CQ78
     C***********          KFLD           KSTRPC 117                      CFF004
     C                     KFLD           KSTRPC                          CFF004
     C/COPY WNCPYSRC,FF0020CP79
     C*CO*Y WN*PY*RC*FF0020C049
     C/COPY WNCPYSRC,FF0020CQ79
      *                                                                   CFF004
     C**   LF/POSTNK
     C           KPSTNK    KLIST
     C***********          KFLD           KBRCDK  30                      S01117
     C                     KFLD           KBRCAK  3                       S01117
     C                     KFLD           KBOKCK  2
     C                     KFLD           KISTTK  5
     C                     KFLD           KYRNOK  20
     C                     KFLD           KMTHNK  20
     C                     KFLD           KPCALK  1
     C/COPY WNCPYSRC,FF0020CR60
     C*CO*Y WN*PY*RC*FF0020C030
     C***********          KFLD           KSTRPK 117                      CFF004
     C/COPY WNCPYSRC,FF0020CR61
     C*CO*Y WN*PY*RC*FF0020C031
     C                     KFLD           KSTRPK                          CFF004
     C*                                                                   S01117
     C**   LF/FOPCC                                                       S01117
     C*                                                                   S01117
     C           KFPCC     KLIST                                          S01117
     C                     KFLD           KBRCAO  3                       S01117
     C**********           KFLD           KCBCDO  60                                   S01117 CSD027
     C                     KFLD           KCBCDO  6                                           CSD027
     C                     KFLD           KISTTO  5                       S01117
     C*                                                                   S01117
     C**   LF/FOPCK                                                       S01117
     C*                                                                   S01117
     C           KFPCK     KLIST                                          S01117
     C                     KFLD           KBRCAF  3                       S01117
     C                     KFLD           KBOKCF  2                       S01117
     C                     KFLD           KISTTF  5                       S01117
     C**   PF/PMPORTPD                                                    S01235
     C           PORTKY    KLIST                                          S01235
     C**********           KFLD           KPCNUM  60                                   S01235 CSD027
     C                     KFLD           KPCNUM  6                                           CSD027
     C                     KFLD           WWPTFR  4                       S01235
      *                                                                                       CSD015
      **   Key List for LF/SDCWHTL1                                                           CSD015
      *                                                                                       CSD015
     C           KCWHTL    KLIST                                                              CSD015
     C                     KFLD           KFUNT   8                                           CSD015
     C                     KFLD           KIDEN  40                                           CSD015
     C                     KFLD           KBRCH   3                                           CSD015
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP36                                           S01408
     C*                                                                   S01408
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**      M  A  I  N     P  R  O  C  E  S  S  I  N  G                *
     C**                                                                 *
     C********************************************************************
     C/COPY WNCPYSRC,FF0020C052
     C**
     C**   Receive/Pass  Parameters
     C**
     C           *ENTRY    PLIST
     C                     PARM           PACTN   1
     C                     PARM           PMRKT   2
     C                     PARM           PMKTN  20
     C                     PARM           PMKLC   3
     C                     PARM           PMLOC   3                       S01195
     C                     PARM           PBUSD   50
     C                     PARM           PISPT   1                       073714
     C                     PARM           PRUNA   7
     C                     PARM           PRUND   50
     C                     PARM           PDATF   1
     C***********          PARM           PDFBR   30                      S01117
     C                     PARM           PDFBR   3                       S01117
     C                     PARM           PMBIN   1                       S01117
     C                     PARM           PFRST   1                       S01332
     C/COPY WNCPYSRC,FF0020C030
     C**
     C**   Initial Processing
     C**
     C                     EXSR INITL
     C*                                                                   S01457
      *** Check the switchable features file to see if S01457 is on.      S01457
      *                                                                   S01457
     C                     MOVE *BLANKS   S0CUST 12                       S01457
     C                     MOVE *BLANKS   S1CUST 12                       S01457
     C                     MOVE 'N'       S01457  1                       S01457
     C                     CALL 'AOSARDR0'                                S01457
     C                     PARM '       ' @RTCD   7                       S01457
     C                     PARM '*VERIFY' @OPTN   7                       S01457
     C                     PARM 'S01457 ' @SARD   6                       S01457
      *                                                                   S01457
     C           @RTCD     IFEQ *BLANKS                                   S01457
     C           SMRKT     ANDEQ*BLANKS                                   S01457
     C                     MOVE 'Y'       S01457                          S01457
     C                     MOVEL'Counter' S0CUST                          S01457
     C                     MOVE 'party'   S0CUST                          S01457
     C                     MOVEL'COUNTER' S1CUST                          S01457
     C                     MOVE 'PARTY'   S1CUST                          S01457
     C                     ELSE                                           S01457
     C                     MOVEL'Cust'    S0CUST                          S01457
     C                     MOVE 'omer    'S0CUST                          S01457
     C                     MOVEL'CUSTO'   S1CUST                          S01457
     C                     MOVE 'MER    ' S1CUST                          S01457
     C                     ENDIF                                          S01457
      *                                                                   CDE001
      ** Determine if Data Export for CCRM Limits is active               CDE001
      *                                                                   CDE001
     C                     CALL 'AOSARDR0'                                CDE001
     C                     PARM '       ' @RTCD                           CDE001
     C                     PARM '*VERIFY' @OPTN                           CDE001
     C                     PARM 'CDE001 ' @SARD                           CDE001
     C           @RTCD     IFEQ *BLANKS                                   CDE001
     C                     MOVE 'Y'       CDE001  1                       CDE001
     C                     ELSE                                           CDE001
     C                     MOVE 'N'       CDE001                          CDE001
     C           @RTCD     IFNE '*NRF    '                                CDE001
     C           *LOCK     IN   LDA                                       CDE001
     C                     MOVEL'SCSARDPD'DBFILE           ************   CDE001
     C                     Z-ADD35        DBASE            * DBERR 35 *   CDE001
     C                     MOVEL'CDE001'  DBKEY            ************   CDE001
     C                     EXSR DBERR                                     CDE001
     C                     ENDIF                                          CDE001
     C                     ENDIF                                          CDE001
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP37                                           S01408
     C*                                                                   S01408
      *                                                                   S01457
     C**
     C**   Select screen to process
     C**
     C           PACTN     IFEQ 'I'
     C**   Insert
     C           PMRKT     IFNE '  '
     C**   - Mkt Instr.
     C                     EXSR INSMKI
     C                     ELSE
     C**   - O.T.C.
     C           PISPT     COMP '5'                  0808  *              073714
     C                     EXSR INSOTC
     C                     END
     C**
     C                     ELSE
     C**   Amd/Del/Enq
     C                     EXSR PROMPT
     C**
     C                     END
     C**
     C*****F5****                                                         E90100
     C*+**********INKL     IFEQ '1'                                       E90100
     C**   F9
     C           *INKI     IFEQ '1'
     C                     SETON                     U3
     C                     END
      *                                                                   S01332
      *  If pgm called as part of stack check whether F1 F3 or F12        S01332
      *                                                                   S01332
     C           *IN77     IFEQ '1'                                       S01332
     C           *LOCK     IN   EMSDS                                     S01332
      *                                                                   S01332
     C           *INKA     IFEQ '1'                                       S01332
     C                     MOVE 'S'       RETND                           S01332
     C                     END                                            S01332
      *                                                                   S01332
     C           *INKL     IFEQ '1'                                       S01332
     C                     MOVE 'U'       RETND                           S01332
     C                     END                                            S01332
      *                                                                   S01332
     C           *INKC     IFEQ '1'                                       S01332
     C                     MOVE 'Q'       RETND                           S01332
     C                     END                                            S01332
     C/COPY WNCPYSRC,FF0020C060
      *                                                                   S01332
     C                     OUT  EMSDS                                     S01332
     C                     END                                            S01332
     C**
     C/COPY WNCPYSRC,FF0020C031
     C                     SETON                     LR
     C/COPY WNCPYSRC,FF0020C032
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C*       S   U   B   R   O   U   T   I   N   E   S                  *
     C*                                                                  *
     C********************************************************************
     C*
     C*                  SUMMARY  OF  SUBROUTINES
     C*                 **************************
     C*
     C*     INITL       Initial Processing  (inc. ICD access)
     C*     DBERR       Database Error Handling : Terminates program
     C*     INFSR       File Exception/Error Handling : Cancels program
     C*
     C*    Screen Handling
     C*    ~~~~~~~~~~~~~~~
     C*     INSMKI      Insert  Market Instrument details Control
     C*     INSOTC      Insert  O.T.C. details Control
     C*     INSSET      Insert  Settlement Instructions Control
     C*
     C*     PROMPT      Prompt for  Transaction Reference No (Amd/Del/Enq)
     C*     ADEMKI      Amd/Del/Enq  Market Instrument Control
     C*     ADEOTC      Amd/Del/Enq  O.T.C. Control
     C*
     C*    Write/Read Screens, + handle 'HELP'
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*     SCRNF2      Trans Ref prompt
     C*     SCRNF3      Insert  Market Instrument details
     C*     SCRNF4      Insert  O.T.C. details
     C*     SCRNF5      Insert  Settlement Instructions
     C*     SCRNF6      Amd/Del/Enq  Market Instrument
     C*     SCRNF7      Amd/Del/Enq  O.T.C.
     C*     SCRNF8      'Record (Related) Updated by Another WorkstN'
     C*
     C*    Screen Initialisation / Resets
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*     IBRDFT      Initialise  Broker Settlement Defaults  (Insert)
     C*     ICUDFT      Initialise  Customer Settlement Defaults (Insert)
     C*     IPRFC1      Initialise  Profit Centre (Insert) Main routine   S01117
     C*     IPRFC2      Initialise  Profit Centre (Insert) AO rountine    S01117
     C*     ISADEW      Initialise  Screen details (Amd/Del/Enq, TUDBAW)
     C*
     C*     RSTINS      Reset processing for Insert
     C*     RSTADE      Reset processing for Amend/Delete/Enquire
     C*
     C*    Validation
     C*    ~~~~~~~~~~
     C*     VINSRT      Insert  Mkt Instr./O.T.C. details Control
     C*     VINSET      Insert  Settlement Instructions Control
     C*     VAMEND      Amend Control
     C*     VDELET      Delete Control
     C*     VTNBR       Transaction Reference
     C*
     C*     VNUCO       No. of Contracts
     C*     VMKI        Market Instrument
     C*     VYRMTH      Instrument Year/Month
     C*     VOTC        O.T.C. Type
     C*     VPCAL       Put/Call
     C*     VSTRP       Strike Price
     C*     VCOPR       Contract Price
     C*     VTRSD       Transaction Date
     C*     VBOCO       Broker
     C*     VCUSC       Customer
     C******VXNOSM******Broker/Customer**Number/Shortname*****************S01117
     C*     VBOKC       Book
     C*     VBRCD       Branch
     C*     VTBLO       To Be Left Open ind.
     C*     VLNKR       Linked Reference
     C*     VORBR       Originating Branch                                S01117
     C*     VPRFC       Profit Centre                                     S01117
     C*
     C*     VXCHCM      Broker/Customer  Charges + Commissions details
     C*     VXMAR       Broker/Customer  Initial Margin
     C*     VXSET       Broker/Customer  Settlement details
     C*
     C*    Updates + Related Processes
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*     UINSRT      Update  Insert Control
     C*     UAMEND      Update  Amend  Control
     C*     UDELET      Update  Delete Control
     C*
     C*     ICOMIT      Initialise 'COMIT' text
     C*     WTRANS      Write record to  LF/TRANS
     C*     WINTYP      Write record to  PF/INTYPD                        073714
     C*     WTRSET      Write record to  LF/TRSET
     C*     UTRANS      Update  LF/TRANS main
     C*     UTRSET      Update  LF/TRSET
     C*     PBCPT       Determine  Broker Commission Pattern
     C*     PCCPT       Determine  Customer Commission Pattern
     C******UTRNLK******Update**LF/TRANS*(New Linked Ref)**               097069
     C******UTROLK******Update**LF/TRANS*(Old Linked Ref)**               097069
     C*     UCLOST      Update  LF/CLOST
     C*     URMEMS      Update  LF/MEMOSM (Reverse-out Shadow posting)
     C*     UAMEMS      Update  LF/MEMOSM (Apply Shadow posting)
     C*     URPRON      Update  LF/PRONOM (Reverse-out Proj Nostro Bal)
     C*     UAPRON      Update  LF/PRONOM (Apply Proj Nostro Bal)
     C*     WACMVD      Write record to PF/FFACMVD                        S01240
     C*     UAPRFC      Update  LF/FOPCC + LF/FOPCK                       S01117
     C*                 (Apply Position Profit Centre)                    S01117
     C*     UPSTNC      Update  LF/POSTNC (Customer)
     C*     UPSTNB      Update  LF/POSTNC (Broker)
     C*     UPSTNK      Update  LF/POSTNK (Book)
     C*     UTRNSA      Update  PF/TRANSA (Audit)
     C*     TUDBAW      'Trade Updated by Another Workstation' Control
     C*     PCFUAW      'Profit Centre File Updated by another WRKSTN'    FO0019
     C*
     C*    Standard FF Subroutines
     C*    ~~~~~~~~~~~~~~~~~~~~~~~
     C*     FFSTDP      Determine No. of Currency dec. places
     C*     FFPRCS      Format Price fields (File to Screen)
     C*     FFPRVL      Validates + Formats Prices (Screen to File)
     C*     FFDATE etc  Convert date formula to a MIDAS day number
     C*     FFPMCL      Calculate  Premiums Payable
     C*     FFTVCL      Calculate  Total Transaction Value
     C*     FFSETL      Determines whether MEMOS or PRONO Reversal
     C*                  updating is required.
     C*
     C*    Standard MIDAS Subroutines
     C*    ~~~~~~~~~~~~~~~~~~~~~~~~~~
     C*     ZALIGN      Validate and Right-align numeric fields
     C*     ZEDIT       Convert amount field from file to screen format
     C*     ZDATE1      Validate a Date, and convert to a MIDAS day no.
     C*     ZDATE2      Convert a MIDAS day no. to Date Format
     C******ZDATE3******Discover*next*working*day*************************S01117
     C******ZDATE5******Determine*if*a*MIDAS*day*no.*is*a*Holiday*********S01117
     C*     ZTNLU1      Lock, Update and Release DTAARA/MNATN
     C*
      *    Enhancement Subroutines                                                            CSD015
      *    ~~~~~~~~~~~~~~~~~~~~~~~                                                            CSD015
      *     SRWTCH      Sends transaction details to compliance engine                        CSD015
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   INITL SR. -  Initial Processing, including                    *
     C**   ~~~~~~~~~     access 'Installation Control Data' Records      *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       Main Processing              SR. DBERR                    *
     C**                                                                 *
     C********************************************************************
     C**
     C           INITL     BEGSR                           ** INITL SR ***
     C**
     C**   Reset LDA
     C**
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C***********          MOVE *BLANKS   DBLOT                           S01117
     C                     MOVE *BLANKS   DBFILE                          S01117
     C                     MOVE *BLANKS   DBKEY                           S01117
     C                     MOVE 'FF0020  'DBPGM
     C                     Z-ADD*ZEROS    DBASE                           S01117
     C                     OUT  LDA
     C**                                                                  FO0018
     C**   Define Dtaara's RUNDAT and MNATN to Pgm.                       FO0018
     C**                                                                  FO0018
     C           *NAMVAR   DEFN           RUNDAT                          FO0018
     C           *NAMVAR   DEFN           MNATN                           FO0018
      *                                                                   S01332
      *  Retrieve data area EMSDS.                                        S01332
      *                                                                   S01332
     C           *NAMVAR   DEFN           EMSDS                           S01332
     C           *LOCK     IN   EMSDS                                     S01332
     C                     MOVE RQDTD     MODI    2                       S01332
      *                                                                   S01332
     C           MODI      IFNE *BLANKS                                   S01332
      *                                                                   S01332
     C           PFRST     IFEQ 'Y'                                       S01332
     C                     MOVELRQDTD     STNBR                           S01332
     C                     ELSE                                           S01332
     C                     MOVE *BLANKS   STNBR                           S01332
     C                     END                                            S01332
      *                                                                   S01332
     C                     SETON                     77                   S01332
     C                     END                                            S01332
     C                     OUT  EMSDS                                     S01332
     C*                                                                   111728
     C** Initialise Counter Currency Fields                               111728
     C*                                                                   111728
     C                     Z-ADD*ZERO     CCAM                            111728
     C                     MOVE *BLANK    SCCAM                           111728
     C                     Z-ADD*ZERO     WCCAM                           111728
     C                     MOVEL'0'       *IN68                           CFF007
     C**                                                                  FO0018
     C/SPACE 2
     C**   NB. ICD/10 data is passed in as parameters
     C**
     C           PDATF     COMP 'M'                      98 MMDDYY, 98 ON
     C           PMBIN     COMP 'N'                      64               S01117
     C**
     C**   ICD/11
     C                     MOVE '01'      KICD1                           S01332
     C                     MOVE '11'      KICD2                           S01332
     C           KICD      CHAINTABTB11F             70                   S01332
     C***********          READ TABTB11F                 70               S01332
     C  N70      RECI      COMP 'D'                  7070
     C**
     C           *IN70     IFEQ '0'
     C***********MBIN      COMP 'N'                      64               S01117
     C**
     C                     ELSE
     C           *LOCK     IN   LDA
     C***********          MOVE '01'      DBASE            ** DBERR  01 **S01117
     C                     Z-ADD1         DBASE            ** DBERR  01 **S01117
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVE '01'      KICD1
     C                     MOVE '11'      KICD2
     C                     MOVELKICD      DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   ICD/20
     C                     READ TABTB20F                 70
     C  N70      RECI      COMP 'D'                  7070
     C**
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '02'      DBASE            ** DBERR  02 **S01117
     C                     Z-ADD2         DBASE            ** DBERR  02 **S01117
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVE '01'      KICD1
     C                     MOVE '20'      KICD2
     C                     MOVELKICD      DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   ICD/40
     C                     READ TABTB40F                 70
     C  N70      RECI      COMP 'D'                  7070
     C**
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '03'      DBASE            ** DBERR  03 **S01117
     C                     Z-ADD3         DBASE            ** DBERR  03 **S01117
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVE '01'      KICD1
     C                     MOVE '40'      KICD2
     C                     MOVELKICD      DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   ICD/80 (Financial Futures + Options)
     C**
     C                     READ TABTB80F                 70
     C  N70      RECI      COMP 'D'                  7070
     C**
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '04'      DBASE            ** DBERR  04 **S01117
     C                     Z-ADD4         DBASE            ** DBERR  04 **S01117
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVE '01'      KICD1
     C                     MOVE '80'      KICD2
     C                     MOVELKICD      DBKEY
     C                     EXSR DBERR
     C                     END
     C**                                                                  S01117
     C**   General Ledger Details                                         S01117
     C**                                                                  S01117
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    @DSFDY                                       S01117 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD22        DBASE            ** DBERR  22 **S01117
     C                     MOVE 'SDGELRPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     EXSR DBERR                                     S01117
     C**                                                                  S01117
     C                     ELSE                                           S01117
     C           OBUU      COMP 'Y'                      61               S01117
     C           PFCU      COMP 'Y'                      62               S01117
     C                     END                                            S01117
     C*                                                                   S01235
     C**   SDMMODPD - TO SEE IF PORTFOLIO MANAGEMENT IS SWITCHED ON       S01235
     C*                                                                   S01235
     C                     CALL 'AOMMODR0'                                CPM003
     C                     PARM *BLANKS   @RTCD                           CPM003
     C                     PARM '*FIRST ' @OPTN                           CPM003
     C           SDMMOD    PARM SDMMOD    @DSFDY                          CPM003
     C           @RTCD     IFNE *BLANKS                                   CPM003
     C                     MOVE *BLANKS   DBKEY                           CPM003
     C           *LOCK     IN   LDA                                       S01235
     C                     Z-ADD23        DBASE            **DB ERROR 23**CPM003
     C                     MOVE 'SDMMODPD'DBFILE                          S01235
     C                     MOVEL*BLANKS   DBKEY                           S01235
     C                     EXSR DBERR                                     S01235
     C                     ELSE                                           S01235
     C           BGPFMG    IFNE 'Y'                                       S01235
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '1'       *IN17                           S01235
     C                     END                                            S01235
     C           BGSECS    IFNE 'Y'                                       CFF007
     C                     MOVE '1'       *IN69                           CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C066
     C                     END                                            S01235
     C*                                                                   CAC003
     C** Check if SAR CAC003 is installed using AOSARDR0                  CAC003
     C*                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM '       ' @RTCD                           CAC003
     C                     PARM '*VERIFY' @OPTN                           CAC003
     C                     PARM 'CAC003'  @SARD   6                       CAC003
     C           @RTCD     IFNE *BLANK                                    CAC003
     C           @RTCD     ANDNE'*NRF   '                                 CAC003
     C           *LOCK     IN   LDA                                       CAC003
     C                     Z-ADD33        DBASE            ** DBERR  33 **CAC003
     C                     MOVE 'SCSARDPD'DBFILE                          CAC003
     C                     MOVEL@OPTN     DBKEY                           CAC003
     C                     MOVEL@OPTN     DBOPTN                          CAC003
     C                     EXSR DBERR                                     CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Seton *IN01 if Analytical Accounting and SAR CAC003 is on        CAC003
     C*                                                                   CAC003
     C           @RTCD     IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN01                           CAC003
     C                     ENDIF                                          CAC003
     C**                                                                  S01235
     C** CHECK IF PORTFOLIO MODULE PRESENT                                S01235
     C           BGPFMG    IFEQ 'Y'                                       S01235
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     OPEN PMPORTPD                                  S01235
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C* ACCESS PORTFOLIO ICD FOR DEFAULT PORTFOLIO VALUE                  S01235
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM *BLANKS   @RTCD                           CPM003
     C                     PARM '*FIRST ' @OPTN                           CPM003
     C           SDPORT    PARM SDPORT    @DSFDY                          CPM003
     C           @RTCD     IFNE *BLANKS                                   CPM003
     C* IF NO RECORD FOUND, DATA BASE ERROR                               S01235
     C                     MOVE *BLANKS   DBKEY                           CPM003
     C           *LOCK     IN   LDA                                       S01235
     C                     Z-ADD24        DBASE            ** DBERR  23 **S01235
     C                     MOVE 'SDPORTPD'DBFILE                          S01235
     C                     EXSR DBERR                                     S01235
     C                     END                                            S01235
     C*                                                                   CPM003
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C*                                                                   CPM003
     C           FCPORS    IFEQ 'B'                                       CPM003
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE '1'       *IN17                           CPM003
     C                     END                                            CPM003
     C                     ENDIF                                          CPB001
     C                     END                                            S01235
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP29                                           S01408
     C*                                                                   S01408
     C**                                                                  CFF001
     C** Access SAR Details to determine whether Enhanced OTC is present  CFF001
     C**                                                                  CFF001
     C                     CALL 'AOSARDR0'                                CFF001
     C                     PARM '       ' @RTCD                           CFF001
     C                     PARM '*VERIFY' @OPTN                           CFF001
     C                     PARM 'CFF001'  @SARD   6                       CFF001
     C           @RTCD     IFNE *BLANK                                    CFF001
     C           @RTCD     ANDNE'*NRF   '                                 CFF001
     C           *LOCK     IN   LDA                                       CFF001
     C                     Z-ADD25        DBASE            ** DBERR  25 **CFF001
     C                     MOVE 'SCSARDPD'DBFILE                          CFF001
     C                     MOVEL@OPTN     DBKEY                           CFF001
     C                     MOVEL@OPTN     DBOPTN                          CFF001
     C                     EXSR DBERR                                     CFF001
     C                     END                                            CFF001
     C           @RTCD     IFEQ *BLANK                                    CFF001
     C                     MOVEL'Y'       CFF001  1                       CFF001
     C                     MOVEL'1'       *IN68                           CFF001
     C                     END                                            CFF001
      *                                                                   CFF005
     C* Check if ? processing is available for Intrument Type.            CFF005
     C                     MOVE 'N'       CFF005  1                       CFF005
     C                     CALL 'AOSARDR0'                                CFF005
     C                     PARM *BLANKS   @RTCD                           CFF005
     C                     PARM '*VERIFY' @OPTN                           CFF005
     C                     PARM 'CFF005'  @SARD                           CFF005
     C           @RTCD     IFEQ *BLANKS                                   CFF005
     C                     MOVE 'Y'       CFF005                          CFF005
     C                     ENDIF                                          CFF005
     C*
     C/COPY WNCPYSRC,FF0020CCP1
     C*
     C**                                                                  CFF003
     C** Access SAR Details to determine if OTC enhancement is present    CFF003
     C**                                                                  CFF003
     C                     CALL 'AOSARDR0'                                CFF003
     C                     PARM '       ' @RTCD                           CFF003
     C                     PARM '*VERIFY' @OPTN                           CFF003
     C                     PARM 'CFF003'  @SARD   6                       CFF003
     C           @RTCD     IFNE *BLANK                                    CFF003
     C           @RTCD     ANDNE'*NRF   '                                 CFF003
     C           *LOCK     IN   LDA                                       CFF003
     C                     Z-ADD27        DBASE            ** DBERR  27 **CFF003
     C                     MOVE 'SCSARDPD'DBFILE                          CFF003
     C                     MOVEL@OPTN     DBKEY                           CFF003
     C                     MOVEL@OPTN     DBOPTN                          CFF003
     C                     EXSR DBERR                                     CFF003
     C                     ENDIF                                          CFF003
     C           @RTCD     IFEQ *BLANK                                    CFF003
     C                     MOVEL'Y'       CFF003  1                       CFF003
     C                     ENDIF                                          CFF003
     C*                                                                   CFF003
      ** Access SAR Details to determine if Fractional Ticks              CFF006
      ** enhancement is present                                           CFF006
      *                                                                   CFF006
     C                     CALL 'AOSARDR0'                                CFF006
     C                     PARM '       ' @RTCD                           CFF006
     C                     PARM '*VERIFY' @OPTN                           CFF006
     C                     PARM 'CFF006'  @SARD                           CFF006
     C           @RTCD     IFNE *BLANK                                    CFF006
     C           @RTCD     ANDNE'*NRF   '                                 CFF006
     C           *LOCK     IN   LDA                                       CFF006
     C                     Z-ADD43        DBASE                           CFF006
     C                     MOVE 'SCSARDPD'DBFILE                          CFF006
     C                     MOVEL@OPTN     DBKEY                           CFF006
     C                     MOVEL@OPTN     DBOPTN                          CFF006
     C                     EXSR DBERR                                     CFF006
     C                     ENDIF                                          CFF006
     C           @RTCD     IFEQ *BLANK                                    CFF006
     C                     MOVEL'Y'       CFF006  1                       CFF006
     C                     ENDIF                                          CFF006
      *                                                                   CFF007
      ** Initialise Data Structure Fields                                 CFF007
      *                                                                   CFF007
     C                     Z-ADD*ZERO     @DT                             CFF007
     C                     Z-ADD*ZERO     @BL                             CFF007
      *                                                                   CFF007
      ** Access SAR Details to determine whether FF Value Date is present CFF007
      *                                                                   CFF007
     C                     MOVEL'N'       CFF007  1                       CFF007
     C                     MOVE '0'       *IN21                           CFF007
     C                     CALL 'AOSARDR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*VERIFY' @OPTN                           CFF007
     C                     PARM 'CFF007'  @SARD                           CFF007
     C                     PARM           @DSFDY                          CFF007
     C           @RTCD     IFEQ *BLANK                                    CFF007
     C                     MOVEL'Y'       CFF007                          CFF007
     C                     MOVEL'1'       *IN68                           CFF007
     C                     OPEN SECTY                                     CFF007
     C           BGN4ST    IFEQ 'Y'                                       CFF007
     C                     MOVE '1'       *IN21                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                                       CSD015
      ** Define dataara SDSTAT and SC24X7                                                     CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Check if 24x7 Midas Availability is installed                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSC011'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    @DSFDY                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVE 'SCSARDPD'DBFILE                                              CSD015
     C                     MOVE 'CSC011'  DBKEY                                               CSD015
     C                     Z-ADD43        DBASE                                               CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011  1                                           CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if Compliance Watch Enhancement (CSD015) is installed                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    @DSFDY                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVE 'SCSARDPD'DBFILE                                              CSD015
     C                     MOVE 'CSD015'  DBKEY                                               CSD015
     C                     Z-ADD44        DBASE                                               CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if switchable feature CCF001 is installed                                      CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CCF001'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    @DSFDY                                              CSD015
      *                                                                                       CSD015
      ** If return code not blank or *NRF, then issue database error                          CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVE 'SCSARDPD'DBFILE                                              CSD015
     C                     MOVE 'CCF001'  DBKEY                                               CSD015
     C                     Z-ADD46        DBASE                                               CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM 'FUTURES 'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    @DSFDY                                              CSD015
      *                                                                                       CSD015
      ** If return code not blank or *NRF, then issue database error                          CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVE 'FUTURES 'DBKEY                                               CSD015
     C                     MOVE 'SCWLCCPD'DBFILE                                              CSD015
     C                     Z-ADD45        DBASE                                               CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access compliance watch configuration                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*FIRST ' @OPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank, then issue database error                                  CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           *LOCK     IN   LDA                                                           CSD015
     C                     MOVE @OPTN     DBKEY                                               CSD015
     C                     MOVE 'SDCWCDPD'DBFILE                                              CSD015
     C                     Z-ADD46        DBASE                                               CSD015
     C                     EXSR DBERR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C/SPACE 2
     C**   Set Up Processing
     C**  ~~~~~~~~~~~~~~~~~~~
     C**   Screen fields (constant)
     C                     MOVE PACTN     SACTN
     C                     MOVE PMRKT     SMRKT
     C                     MOVE PMKTN     SMKTN
     C                     MOVE PISPT     SISPT                           073714
     C                     MOVE PRUNA     SRUNA
     C                     MOVE WSID      SWSID
     C/COPY WNCPYSRC,FF0020C033
     C**
     C**   Determine Current Trading Date
     C**
     C**   - Mkt Instr (= Market Business date)
     C           SMRKT     IFNE '  '
     C                     Z-ADDPBUSD     CTDATE  50
     C**   - O.T.C. (= Run date)
     C                     ELSE
     C                     Z-ADDPRUND     CTDATE
     C                     END
     C**
     C**   Determine  Start of Historical Data Period
     C           CTDATE    SUB  HISP      STHDP   50
     C**
     C**   Action Code inds
     C           SACTN     COMP 'I'                      02
     C           SACTN     COMP 'A'                      03
     C           SACTN     COMP 'D'                      04
     C           SACTN     COMP 'E'                      05
     C**
     C**   TESTN work fields
     C                     MOVE *BLANK    WTSTN2  2
     C                     MOVE '0'       WTSTN2
     C                     MOVE *BLANK    WTSTN3  3
     C                     MOVE '0'       WTSTN3
     C                     MOVE *BLANK    WTSTN4  4
     C                     MOVE *BLANK    WTSTN5  5                       073714
     C                     MOVE '0'       WTSTN5                          073714
     C                     MOVE '0'       WTSTN4
     C                     MOVE *BLANK    WTSTN7  7
     C                     MOVE '0'       WTSTN7
     C                     MOVE *BLANK    WTST11 11
     C                     MOVE '0'       WTST11
     C                     MOVE *BLANK    WTST13 13
     C                     MOVE '0'       WTST13
     C**
     C**   Initialise broker shortname needed and customer
     C**   shortname needed flags
     C                     Z-ADD0         BSNAME  10
     C                     Z-ADD0         CSNAME  10
     C**
     C**   Key fields
     C***********          MOVE '10'      KBRCD1                          S01117
     C                     MOVE '71'      KCPSH1
     C                     MOVE 'A'       KRCDT
     C**
     C**   Standard FF subroutines
     C/COPY ZSRSRC,FFSTDPZ3
     C/COPY ZSRSRC,FFSETLZ3
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCPG                                           S01408
     C*                                                                   S01408
     C/COPY ZSRSRC,DFTTSTAMPC
     C*                                                                                       209483
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   DBERR SR. - Database Error Handling : Terminates program      *
     C**   ~~~~~~~~~                                                     *
     C**      Called From    DB Err No.    File                          *
     C*********SR.*INITL**********01*******TABFF***(ICD/11)***************S01117
     C****************************02*******TABFF***(ICD/20)***************S01117
     C**       SR. INITL          02       TABFF   (ICD/20)              *S01117
     C**                          03       TABFF   (ICD/40)              *
     C**                          04       TABFF   (ICD/80 FF)           *
     C*********SR.*VTNBR**********05*******TABFF***(Branch)***************S01117
     C**       SR. VSTRP          06       INTYP2  (Future Type Ref)     *
     C**       SR. INSSET         07       TABFF   (CCY/1)               *
     C**       SR. ISADEW         08       INTYP                         *
     C**                          09       INTYP2  (Future Type Ref)     *
     C**                          10       TABFF   (CCY/1)               *
     C**                          11       TRSETIN                       *
     C**       SR. UAMEND         12       TRANS                         *
     C**       SR. UDELET         13       TRANS                         *
     C**       SR. UTRSET         14       TRSET                         *
     C*********SR.*UTRNLK*********15       TRANSLK (new link)            *097069
     C*********SR.*UTROLK*********16       TRANSLK (old link)            *097069
     C**       SR. UCLOST         17       CLOST                         *
     C**       SR. UPSTNC         18       POSTNC  (Customer)            *
     C**       SR. UPSTNB         19       POSTNC  (Broker)              *
     C**       SR. UPSTNK         20       POSTNK  (Book)                *
     C**       SR. UTRNSA         21       TRANSA  (Audit)               *
     C**       SR. INITL          22       SDGELRPD                      *S01117
     C**       SR. VTRSD          24       SDBRCHPD                      *S01195
     C**                                                                 *
     C********************************************************************
     C*
     C           DBERR     BEGSR                           ** DBERR SR **
     C/COPY WNCPYSRC,FF0020C034
     C                     OUT  LDA
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
      *                                                                   S01332
     C           *LOCK     IN   EMSDS                                     S01332
     C                     MOVE 'E'       RETND                           S01332
     C                     OUT  EMSDS                                     S01332
      *                                                                   S01332
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   INFSR SR. -  File Exception/Error Handling : Cancels program  *
     C**   ~~~~~~~~~                                                     *
     C**      Called From    File      Reason                            *
     C**       SR. UINSRT     TRANS     Write fail (not dup. key error)  *
     C**       SR. TUDBAW     TRANSIN   Chain fail                       *
     C**                                                                 *
     C********************************************************************
     C**
     C           INFSR     BEGSR                           *** INFSR SR **
     C**
     C                     MOVE '*CANCL'  EXTTAG  6
     C**
     C                     ENDSREXTTAG
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   INSMKI SR. -  Insert Market Instrument details Control        *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       Main Processing              SR. VINSRT                   *
     C**                                    SR. INSSET                   *
     C**                                    SR. SCRNF3                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           INSMKI    BEGSR                           ** INSMKI SR **
     C**
     C**   Read screen
     C                     READ FF0010F3                 06
     C*****Allow*'HELP'                                                   S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ FF0010F3                 06               S01199
     C**********           END                                            S01199
     C**
     C*****Continue*until F3 or F12 taken                                 S01240
     C**   Continue until F3 or F9 taken                                  S01240
     C**
     C           *INKC     DOWNE'1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C**
     C**   Validate Input
     C                     EXSR VINSRT
     C**
     C*****If*valid*-*add*Settlement*Instructions*to*screen*              FO0003
     C**   If valid - add Settlement Instructions and Profit Centre       FO0003
     C**              to the Screen.                                      FO0003
     C**
     C           *IN18     IFEQ '0'
     C           *IN19     ANDEQ'0'
     C                     SETON                     13
     C**                                                                  FO0003
     C           PFCU      IFEQ 'Y'                                       FO0003
     C                     EXSR IPRFC1                                    FO0003
     C                     END                                            FO0003
     C**                                                                  FO0003
     C                     EXSR INSSET
     C                     END
     C**
     C**   Redisplay screen
     C**
     C           *INKC     IFNE '1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCP4                                           S01408
     C*                                                                   S01408
     C                     EXSR SCRNF3
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   INSOTC SR. -  Insert O.T.C. details Control                   *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       Main Processing              SR. VINSRT                   *
     C**                                    SR. INSSET                   *
     C**                                    SR. SCRNF4                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           INSOTC    BEGSR                           ** INSOTC SR **
      *                                                                   CPL002
     C                     MOVE 'Y'       W1ST    1                       CPL002
     C**
     C** Set up to use FF0010FA for currency OTC if Plato                 CPL002
     C** interface is present.                                            CPL002
     C**   Read screen
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           PISPT     ANDEQ'5'                                       CPL002
     C                     READ FF0010FA                 06               CPL002
     C                     ELSE                                           CPL002
     C                     READ FF0010F4                 06
     C                     END                                            CPL002
     C*
     C*****Allow*'HELP'*
     C**********
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ FF0010F4                 06               S01199
     C**********           END                                            S01199
     C**
     C*****Continue*until F3 or F12 taken                                 S01240
     C**   Continue until F3 or F9 taken                                  S01240
     C**
     C           *INKC     DOWNE'1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
      *                                                                   148384
     C                     MOVE 'N'       WRDPLY  1                       CFF007
      **   Insert Fields from Instrument Type                             148384
      *                                                                   148384
     C                     EXSR IOTCST                                    148384
     C**
     C**   Validate Input
     C                     EXSR VINSRT
     C**
     C*****If*valid*-*add*Settlement*Instructions*to*screen*              FO0003
     C**   If valid - add Settlement Instructions and Profit Centre       FO0003
     C**              to the Screen.                                      FO0003
     C**
     C           *IN18     IFEQ '0'
     C           *IN19     ANDEQ'0'
     C           WRDPLY    ANDEQ'N'                                       CFF007
     C                     SETON                     13
     C                     MOVEL*BLANKS   ##STT                           148384
     C**                                                                  FO0003
     C           PFCU      IFEQ 'Y'                                       FO0003
     C                     EXSR IPRFC1                                    FO0003
     C                     END                                            FO0003
     C**                                                                  FO0003
     C                     EXSR INSSET
     C                     END
     C**
     C**   Redisplay screen
     C**
     C           *INKC     IFNE '1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCP5                                           S01408
     C*                                                                   S01408
     C                     EXSR SCRNF4
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   INSSET SR. -  Insert Settlement Instructions                  *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSMKI                   SR. FFSTDP                   *
     C**       SR. INSOTC                   SR. IBRDFT                   *
     C**                                    SR. ICUDFT                   *
     C**                                    SR. IPRFC1                   *S01117
     C**                                    SR. VINSET                   *
     C**                                    SR. UINSRT                   *
     C**                                    SR. SCRNF5                   *
     C**                                    SR. SCRNF8                   *
     C**                                    SR. RSTINS                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           INSSET    BEGSR                           ** INSSET SR **
     C*                                                                   CPM003
     C/COPY WNCPYSRC,FF0020CP26                                           CPM003
     C*                                                                   CPM003
     C**
     C**   Determine  Instrument Currency  dec. places
     C**
     C                     MOVE KCCY      FFCCY   3
     C                     MOVE *IN84     WIN84   1                       CFF007
     C                     EXSR FFSTDP
     C                     MOVE WIN84     *IN84                           CFF007
     C**
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '07'      DBASE            ** DBERR  07 **S01117
     C                     Z-ADD7         DBASE            ** DBERR  07 **S01117
     C                     MOVELFFCKY     DBKEY
     C                     MOVE 'TABFF'   DBFILE
     C                     EXSR DBERR
     C                     END
     C**
     C                     Z-ADDFFCDP     ZADEC
     C           13        SUB  FFCDP     ZADIG
     C**
     C**   Initialise  Broker  Settlement Defaults
     C           *IN14     IFEQ '1'
     C                     EXSR IBRDFT
     C                     END
     C**
     C**   Initialise  Customer Settlement Defaults
     C************and**Profit*Centre*                               S01117FO0003
     C**                                                                  S01117
     C           *IN15     IFEQ '1'
     C                     EXSR ICUDFT
     C***********PFCU*     IFEQ 'Y'                                 S01117FO0003
     C***********          EXSR IPRFC1                              S01117FO0003
     C***********          END                                      S01117FO0003
     C                     END
     C**
     C**   Display screen  (overlay  Settlement Instructions on  F3/F4)
     C**
     C**   - Mkt Instr.
     C           SMRKT     IFNE '  '
     C                     WRITEFF0010F3
     C**   - O.T.C.
     C                     ELSE
     C*                                                                   CPL002
     C** Set up to use FF0010FA for currency OTC if Plato                 CPL002
     C** interface is present.                                            CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           PISPT     ANDEQ'5'                                       CPL002
     C                     WRITEFF0010FA                                  CPL002
     C                     ELSE                                           CPL002
     C                     WRITEFF0010F4
     C                     END                                            CPL002
     C                     END
      *                                                                   CFF007
     C                     WRITEFF0010FC                                  CFF007
     C*                                                                   CPM003
     C/COPY WNCPYSRC,FF0020CP27                                           CPM003
     C*                                                                   CPM003
     C**
     C**********           MOVEAMSG,1     STEXT                           CFF007
     C                     MOVELMSG,1     STEXT                           CFF007
     C                     EXSR SCRNF5
     C**
     C*****Continue*until*F3 or F12 taken, or valid exit.                 S01240
     C**   Continue until F3,F9 or F12 taken, or valid exit.              S01240
     C**
     C           *INKC     DOWNE'1'
     C           *INKL     ANDNE'1'
     C           *INKI     ANDNE'1'                                       E90100
     C           *IN10     ANDNE'1'
     C**
     C**   Validate Input
     C                     EXSR VINSET
     C**
     C**   If error - redisplay screen
     C           *IN18     IFEQ '1'
     C           *IN19     OREQ '1'                                       S71062
     C                     EXSR SCRNF5
     C**
     C                     ELSE
      **   Display Midas-Plato Screen if,                                 CPL002
      **      1. MIDAS-PLATO Module is installed (BGN2ST='Y') and         CPL002
      **      2. Processing Type is "4" OR "6"                       C     PL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           SISPT     ANDEQ'4'                                       CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           SISPT     ANDEQ'6'                                       CPL002
      *                                                                   CPL002
     C                     EXSR MPSCRN                                    CPL002
      *                                                                   CPL002
     C                     ELSE                                           CPL002
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCP6                                           S01408
     C*                                                                   S01408
     C**   Otherwise - attempt update
     C                     SETON                     10
     C**********           MOVEAMSG,4     STEXT                           CFF007
     C                     MOVELMSG,4     STEXT                           CFF007
     C                     WRITEFF0010F5
     C**
     C                     EXSR UINSRT
     C**
     C**   If Update by another workstN
     C           *IN11     IFEQ '1'
     C                     EXSR SCRNF8
     C                     END
     C**
     C/COPY WNCPYSRC,FF0020CCP7                                           S01408
     C*                                                                   S01408
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     END
     C**
     C                     END
     C**
     C**   Reset
     C           *INKC     IFNE '1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCP8                                           S01408
     C*                                                                   S01408
     C                     EXSR RSTINS
     C                     END
     C*                                                                   CPM003
     C/COPY WNCPYSRC,FF0020CP28                                           CPM003
     C*                                                                   CPM003
     C**
     C                     ENDSR
     C/COPY WNCPYSRC,FF0020C059
     C**
     C********************************************************************
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   MPSCRN SR. -  Process Midas-Plato Detail Screen               *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. INSSET                   SR.                          *CPL002
     C**                                    SR.                          *CPL002
     C**                                    SR.                          *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           MPSCRN    BEGSR                                          CPL002
      *                                                                   CPL002
      ** Save existing indicator values and reset for reuse.              CPL002
      *                                                                   CPL002
     C                     MOVEA*IN,50    W#I50   9                       CPL002
     C                     MOVEA'00000000'*IN,50                          CPL002
     C                     MOVEA'00'      *IN,58                          CPL002
     C                     MOVEA'00'      *IN,18                          CPL002
      *                                                                   CPL002
      ** Set up the Processing Type                                       CPL002
      *                                                                   CPL002
     C           WISPT     IFEQ *ZERO                                     CPL002
     C                     MOVELSISPT     WISPT                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Save screen fields.                                              CPL002
      *                                                                   CPL002
     C           *LIKE     DEFN SMPIDS    SMPISV                          CPL002
     C                     MOVE SMPIDS    SMPISV                          CPL002
      *                                                                   CPL002
      ** If insert (New or Over Deleted Record) and first call            CPL002
      ** Initialize all fields on the record (ie Zeroize/Blank Out)       CPL002
      *                                                                   CPL002
     C           SACTN     IFEQ 'I'                                       CPL002
     C           W1ST      ANDEQ'Y'                                       CPL002
     C                     EXSR INITR2                                    CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Dot not display Underlying Instrument Details if                 CPL002
      ** Processing Type = 5 or 6                                         CPL002
      *                                                                   CPL002
     C           WISPT     IFEQ 5                                         CPL002
     C           WISPT     OREQ 6                                         CPL002
     C                     MOVEA'1'       *IN,50                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Dot not display Option Volatility Type or Pricing Method         CPL002
      **   for Processing Type = 5                                        CPL002
      *                                                                   CPL002
     C           WISPT     IFEQ 5                                         CPL002
     C                     MOVEA'0'       *IN,08                          CPL002
     C                     ELSE                                           CPL002
     C                     MOVEA'1'       *IN,08                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ***Set*on *IN51 to protect fields on ENQUIRY/AMEND            CPL002CPL002
      ** Set on *IN51 to protect fields on ENQUIRY                        CPL002
      *                                                                   CPL002
     C           SACTN     IFEQ 'E'                                       CPL002
     C                     MOVEA'1'       *IN,51                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Set up screen footer (F3, F9 and F12)                            CPL002
      *                                                                   CPL002
     C**********           MOVEAMSG,1     STEXT                    CPL002 CFF007
     C                     MOVELMSG,1     STEXT                           CFF007
      *                                                                   CPL002
      ** Continue until F3, F9, or F12 taken, or valid exit               CPL002
      *                                                                   CPL002
     C           *INKC     DOWEQ'0'                                       CPL002
     C           *INKL     ANDEQ'0'                                       CPL002
     C           *INKI     ANDEQ'0'                                       CPL002
     C           *IN10     ANDEQ'0'                                       CPL002
      *                                                                   CPL002
      ** Display and Read Midas-Plato Detail Screen                       CPL002
      *                                                                   CPL002
     C                     EXFMTFF0010F9                                  CPL002
      *                                                                   CPL002
      ** Enter taken (F3, F9 and F12 are OFF)                             CPL002
      *                                                                   CPL002
     C           *INKC     IFEQ '0'                                       CPL002
     C           *INKL     ANDEQ'0'                                       CPL002
     C           *INKI     ANDEQ'0'                                       CPL002
      *                                                                   CPL002
     C                     SELEC                                          CPL002
     C           SACTN     WHEQ 'I'                                       CPL002
      *                                                                   CPL002
      ***Validate*screen details on INSERT                                CPL002
     C                     EXSR VALID2                                    CPL002
      *                                                                   CPL002
      ** ....No error(s) or warning(s)                                    CPL002
     C           *IN18     IFEQ *OFF                                      CPL002
     C           *IN19     ANDEQ*OFF                                      CPL002
     C                     MOVEA'1'       *IN,10                          CPL002
     C**********           MOVEAMSG,4     STEXT                    CPL002 CFF007
     C                     MOVELMSG,4     STEXT                           CFF007
     C                     WRITEFF0010F9                                  CPL002
     C                     EXSR UINSRT                                    CPL002
      *                                                                   CPL002
      **     If Update by another workstn                                 CPL002
     C           *IN11     IFEQ '1'                                       CPL002
     C                     EXSR SCRNF8                                    CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SACTN     WHEQ 'E'                                       CPL002
     C                     MOVEA'1'       *IN,10                          CPL002
     C           SACTN     WHEQ 'A'                                       CPL002
      *                                                                   CPL002
      ***Validate*screen details on AMEND                                 CPL002
     C                     EXSR VALID2                                    CPL002
      *                                                                   CPL002
      ** ....No error(s) or warning(s)                                    CPL002
     C           *IN18     IFEQ *OFF                                      CPL002
     C           *IN19     ANDEQ*OFF                                      CPL002
      *                                                                   CPL002
     C                     MOVEA'1'       *IN,10                          CPL002
     C**********           MOVEAMSG,5     STEXT                    CPL002 CFF007
     C                     MOVELMSG,5     STEXT                           CFF007
     C                     WRITEFF0010F9                                  CPL002
     C                     EXSR UAMEND                                    CPL002
      *                                                                   CPL002
      ** If Update by another workstn                                     CPL002
     C           *IN11     IFEQ '1'                                       CPL002
     C                     EXSR SCRNF8                                    CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDSL                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** End of Processing Loop                                           CPL002
      *                                                                   CPL002
     C                     ENDDO                                          CPL002
      *                                                                   CPL002
      ** Restore the original value of *IN50-*IN58                        CPL002
      *                                                                   CPL002
     C                     MOVEAW#I50     *IN,50                          CPL002
      *                                                                   CPL002
      ** Check if F12 is taken                                            CPL002
      *                                                                   CPL002
     C           *INKL     IFEQ *ON                                       CPL002
     C                     MOVE '*PREV'   WPREV   5                       CPL002
     C                     ELSE                                           CPL002
     C                     MOVE *BLANKS   WPREV                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   INITR2 SR. -  Initialise all file fields to zero/blank        *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. MPSCRN                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           INITR2    BEGSR                                          CPL002
      *                                                                   CPL002
      ** Initialise all data on record defined on DETREC                  CPL002
      *                                                                   CPL002
     C                     MOVEL*BLANK    PLMIIT                          CPL002
     C                     MOVEL*BLANK    PLMITM                          CPL002
     C                     Z-ADD*ZERO     PLMICP                          CPL002
     C                     MOVEL*BLANK    PLMICF                          CPL002
     C                     MOVEL*BLANK    PLMIPC                          CPL002
     C                     MOVEL*BLANK    PLMIVT                          CPL002
     C                     MOVEL*BLANK    PLMIPM                          CPL002
     C                     MOVEL*BLANK    PLMIPG                          CPL002
     C                     MOVEL*BLANK    PLMIRG                          CPL002
     C                     MOVEL*BLANK    PLMICR                          CPL002
     C                     Z-ADD*ZERO     PLMIMD                          CPL002
      *                                                                   CPL002
      ** Move 'N' to first call work variable                             CPL002
      *                                                                   CPL002
     C                     MOVE 'N'       W1ST                            CPL002
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   TRSFS2 SR. -  Format records fields to screen                 *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. MPSCRN                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           TRSFS2    BEGSR                                          CPL002
      *                                                                   CPL002
     C                     MOVE ISPT      SISPT                           CPL002
      *                                                                   CPL002
     C                     MOVE PLMIIT    SMIIT                           CPL002
     C                     MOVE PLMITM    SMITM                           CPL002
      *                                                                   CPL002
     C                     Z-ADD7         ZADEC                           CPL002
     C                     Z-ADD4         ZADIG                           CPL002
      *                                                                   CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C           SMIIT     OREQ 'D'                                       CPL002
     C                     MOVE PLMICP    ZFIELD                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C                     MOVE PLMIMD    ZDAYNO                          CPL002
     C                     EXSR ZDATE2                                    CPL002
     C                     MOVE ZDATE     SMITD                           CPL002
     C                     END                                            CPL002
     C                     ELSE                                           CPL002
     C                     MOVE *BLANKS   SMICP                           CPL002
     C                     MOVE *BLANKS   SMITD                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     MOVE PLMICF    SMICF                           CPL002
     C                     MOVE PLMIPC    SMIPC                           CPL002
     C                     MOVE PLMIVT    SMIVT                           CPL002
     C                     MOVE PLMIPM    SMIPM                           CPL002
     C                     MOVE PLMIPG    SMIPG                           CPL002
     C                     MOVE PLMIRG    SMIRG                           CPL002
     C                     MOVE PLMICR    SMICR                           CPL002
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   VALID2 SR. -  Validate Midas-Plato Detail Screen              *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. MPSCRN                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           VALID2    BEGSR                                          CPL002
      *                                                                   CPL002
      ** Set error indicators & count to zero                             CPL002
      *                                                                   CPL002
     C                     MOVEA'0000000' *IN,52                          CPL002
     C                     MOVE '0'       *IN59
     C                     MOVEA'0'       *IN,83                          CPL002
     C                     Z-ADD*ZERO     E                               CPL002
     C                     MOVE *BLANKS   ERR                             CPL002
     C                     Z-ADD*ZERO     W#MICP 117                      CPL002
      *                                                                   CPL002
     C           SACTN     IFEQ 'I'                                       CPL002
     C           SACTN     OREQ 'A'                                       CPL002
      *                                                                   CPL002
      ** Validate Underlying Instrument Type                              CPL002
      *                                                                   CPL002
     C           *IN50     IFEQ *OFF                                      CPL002
      *                                                                   CPL002
     C           SMIIT     IFNE 'B'                                       CPL002
     C           SMIIT     ANDNE'D'                                       CPL002
     C           SMIIT     ANDNE'L'                                       CPL002
     C                     ADD  1         E          52                   CPL002
     C                     MOVEL' 392'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
     C** If Instrument Type is Bond, then only maturity Date is allowed.  CPL002
     C*                                                                   CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C*                                                                   CPL002
     C           SMITM     IFNE *BLANKS                                   CPL002
     C                     ADD  1         E          53                   CPL002
     C                     MOVE ' 406'    ERR,E                           CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C                     EXSR VALMD                                     CPL002
     C*                                                                   CPL002
     C                     ELSE                                           CPL002
     C*                                                                   CPL002
     C** Maturity date should be blank.                                   CPL002
     C*                                                                   CPL002
     C           SMITD     IFNE *BLANKS                                   CPL002
     C                     ADD  1         E          59                   CPL002
     C                     MOVEL' 407'    ERR,E                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Underlying Term to Maturity                             CPL002
      *                                                                   CPL002
     C                     EXSR VALDA2                                    CPL002
      *                                                                   CPL002
      ** Error in Underlying Term to Maturity                             CPL002
      *                                                                   CPL002
     C           *IN99     IFEQ '1'                                       CPL002
     C                     ADD  1         E          53                   CPL002
     C                     MOVEL' 393'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Underlying Coupon and related Underlying Coupon Frequency only   CPL002
      ** valid for Underlying Instrument Type = 'B' & 'D'                 CPL002
      *                                                                   CPL002
     C                     Z-ADD7         ZADEC                           CPL002
     C                     Z-ADD4         ZADIG                           CPL002
     C                     MOVEL*BLANK    ZFIELD                          CPL002
     C                     MOVE SMICP     ZFIELD                          CPL002
     C                     EXSR ZALIGN                                    CPL002
     C*                                                                   CPL002
     C           *IN,99    IFEQ '1'                                       CPL002
     C                     ADD  1         E          54                   CPL002
     C                     MOVEL' 394'    ERR,E                           CPL002
     C                     ELSE                                           CPL002
     C                     MOVE ZFIELD    W#MICP                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Validate Coupon Frequency                                        CPL002
      *                                                                   CPL002
     C           SMICF     IFEQ 'M'                                       CPL002
     C           SMICF     OREQ 'Q'                                       CPL002
     C           SMICF     OREQ 'X'                                       CPL002
     C           SMICF     OREQ 'Y'                                       CPL002
     C           SMICF     OREQ ' '                                       CPL002
     C                     ELSE                                           CPL002
     C                     ADD  1         E          55                   CPL002
     C                     MOVEL' 395'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      *                                                                   CPL002
      ** Entry on Underlying Coupon and related Underlying Coupon Freq    CPL002
      ** is not allowed if  Underlying Instrument Type = "L" ("Bill")     CPL002
      *                                                                   CPL002
     C           SMIIT     IFEQ 'L'                                       CPL002
      *                                                                   CPL002
     C           W#MICP    IFNE *ZERO                                     CPL002
     C                     MOVEA'1'       *IN,54                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SMICF     IFNE *BLANKS                                   CPL002
     C                     MOVEA'1'       *IN,55                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           *IN54     IFEQ '1'                                       CPL002
     C           *IN55     OREQ '1'                                       CPL002
     C                     ADD  1         E                               CPL002
     C                     MOVEL' 396'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Validate Spot Price                                              CPL002
      *                                                                   CPL002
     C                     MOVELSMSPT     SSPTP                           CPL002
     C                     EXSR VSPTP                                     CPL002
      *                                                                   CPL002
     C           *IN08     IFEQ '1'                                       CPL002
     C************IN50     ANDEQ'0'                                CPL002 167877
     C           *IN51     ANDEQ'0'                                       167877
      *                                                                   CPL002
      ** Validate Price Convention Indicator                              CPL002
      *                                                                   CPL002
     C           SMIPC     IFNE 'P'                                       CPL002
     C           SMIPC     ANDNE'F'                                       CPL002
     C           *IN50     ANDNE'1'                                       167877
     C                     ADD  1         E          56                   CPL002
     C                     MOVEL' 397'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Validate Volatility Type                                         CPL002
      *                                                                   CPL002
     C           SISPT     IFEQ '6'                                       CPL002
     C           SMIVT     ANDNE'P'                                       CPL002
     C                     ADD  1         E          57                   CPL002
     C                     MOVEL' 398'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SMIVT     IFNE 'P'                                       CPL002
     C           SMIVT     ANDNE'Y'                                       CPL002
     C                     ADD  1         E          57                   CPL002
     C                     MOVEL' 399'    ERR,E                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Pricing Method                                          CPL002
      *                                                                   CPL002
     C           SMIPM     IFNE 'B'                                       CPL002
     C           SMIPM     ANDNE'S'                                       CPL002
     C                     ADD  1         E          58                   CPL002
     C                     MOVEL' 400'    ERR,E                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** If Pricing Group, Reporting Group or Credit Rating blank, defaultCPL002
      *                                                                   CPL002
     C           SMIPG     IFEQ *BLANK                                    CPL002
     C                     MOVELSISCY     SMIPG                           CPL002
     C                     MOVE 'Midas'   SMIPG                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SMIRG     IFEQ *BLANK                                    CPL002
     C                     MOVEL'Midas'   SMIRG                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SMICR     IFEQ *BLANK                                    CPL002
     C                     MOVEL'AAA '    SMICR                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           ERR,1     IFEQ *BLANKS                                   CPL002
     C                     MOVEA'0'       *IN,18                          CPL002
     C                     ELSE                                           CPL002
     C                     MOVEA'1'       *IN,18                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   VALMD  SR. -  Validate Maturity Date                          *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. VALID2                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           VALMD     BEGSR                                          CPL002
     C*                                                                   CPL002
     C                     MOVE '0'       *IN99                           CPL002
     C*                                                                   CPL002
     C**   1. Valid date format                                           CPL002
     C                     MOVELSMITD     WTSTN7                          CPL002
     C                     TESTN          WTSTN7     75                   CPL002
     C**   - if numeric                                                   CPL002
     C           *IN75     IFEQ '1'                                       CPL002
     C                     MOVE SMITD     ZDATE                           CPL002
     C                     EXSR ZDATE1                                    CPL002
     C                     END                                            CPL002
     C**                                                                  CPL002
     C**   - invalid format or not numeric                                CPL002
     C           *IN99     IFEQ '1'                                       CPL002
     C           *IN75     OREQ '0'                                       CPL002
     C                     ADD  1         E                               CPL002
     C                     MOVE ' 408'    ERR,E                           CPL002
     C                     SETON                     59                   CPL002
     C                     ELSE                                           CPL002
     C                     Z-ADDZDAYNO    PLMIMD                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C**   2. Must not be after the instrument's final transaction date   CPL002
     C**     (only if final transaction date - expiry date - not in error)CPL002
     C*                                                                   CPL002
     C           PLMIMD    IFLT WFTDT                                     CPL002
     C           *IN59     ANDEQ'0'                                       CPL002
     C           E         ADD  1         E                               CPL002
     C                     MOVE ' 409'    ERR,E                           CPL002
     C                     SETON                     59                   CPL002
     C                     SETON                     99                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C*                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   VALDA2 SR. -  Validate Term to Maturity                       *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. VALID2                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           VALDA2    BEGSR                                          CPL002
     C*                                                                   CPL002
     C                     SETOF                     99                   CPL002
     C*                                                                   CPL002
     C***********SPREF     IFNE '+'                                CPL002 167551
     C***********          SETON                     99            CPL002 167551
     C***********          GOTO XTVDA2                             CPL002 167551
     C***********          END                                     CPL002 167551
      *                                                                   CPL002
     C** Format position 2 to 4 and check for Numeric                     167551
     C***Are*positions*2*&*3*numeric*?**************************** CPL002 167551
      *                                                                   CPL002
     C************         TESTN          STERM      44            CPL002 167551
     C*                                                                   167551
     C*** Right align the input field if it is non-Blank.                 167551
     C*                                                                   167551
     C           SMITM     IFNE *BLANK                                    167551
     C                     MOVE *BLANKS   ZFIELD                          167551
     C                     MOVE SMITM     ZFIELD                          167551
     C                     MOVEAZFIELD    ZA1                             167551
     C           ZA1,16    DOWEQ' '                                       167551
     C                     Z-ADD16        ZX                              167551
     C                     Z-ADD15        ZY                              167551
     C                     DO   4                                         167551
     C                     MOVE ZA1,ZY    ZA1,ZX                          167551
     C                     SUB  1         ZX                              167551
     C                     SUB  1         ZY                              167551
     C                     END                                            167551
     C                     END                                            167551
     C                     MOVEAZA1       ZFIELD                          167551
     C                     MOVE ZFIELD    SMITM                           167551
     C                     END                                            167551
     C                     Z-ADD0         ZADEC                           167551
     C                     Z-ADD3         ZADIG                           167551
     C                     MOVEL*BLANK    ZFIELD                          167551
     C                     MOVE STERM     ZFIELD                          167551
     C                     Z-ADD0         ZADEC                           167551
     C                     Z-ADD3         ZADIG                           167551
     C                     MOVEL*BLANK    ZFIELD                          167551
     C                     MOVE STERM     ZFIELD                          167551
     C                     EXSR ZALIGN                                    167551
     C************IN44     IFEQ '0'                                CPL002 167551
     C***********          SETON                     99            CPL002 167551
     C           *IN99     IFEQ '1'                                       167551
     C                     GOTO XTVDA2                                    CPL002
     C                     END                                            CPL002
     C                     MOVE ZFIELD    STERM                           167551
      *                                                                   CPL002
     C******If*not*numeric***************************************  CPL002 167551
     C** If it is numeric, it can not be zero.                            167551
     C*                                                                   167551
     C           STERM     IFEQ '000'                                     167551
     C                     MOVE '1'       *IN99                           167551
     C                     END                                            167551
     C*                                                                   167551
     C           SSIGN     IFNE 'D'                                       CPL002
     C           SSIGN     ANDNE'M'                                       CPL002
     C           SSIGN     ANDNE'Y'                                       CPL002
     C                     SETON                     99                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C           XTVDA2    ENDSR                                          CPL002
     C********************************************************************CPL002
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   PROMPT SR. -  Prompt for Transaction Reference No.            *
     C**   ~~~~~~~~~~    (Amend/Delete/Enquire)                          *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       Main Processing              SR. VTNBR                    *
     C**                                    SR. ADEMKI                   *
     C**                                    SR. ADEOTC                   *
     C**                                    SR. SCRNF2                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           PROMPT    BEGSR                           ** PROMPT SR **
     C**
     C**   Read screen
     C           PFRST     IFNE 'Y'                                       S01332
     C/COPY WNCPYSRC,FF0020C042
     C                     READ FF0010F2                 06
     C                     END                                            S01332
     C*****Allow*'HELP'*                                                  S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ FF0010F2                 06               S01199
     C**********           END                                            S01199
     C**
     C*****Continue*until F3 or F12 taken                                 S01240
     C*****Continue*until*F3*or*F9*taken                            S01240S01332
     C**   Continue until F1 F3 or F12 taken                              S01332
     C**
     C/COPY WNCPYSRC,FF0020C054
      *                                                                   CPB001
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C           WW9997    IFEQ 'Y'                                       CPB001
     C                     MOVE *BLANKS   PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVE SPTFR     PTFR                            CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
      *                                                                   CPB001
     C           *INKC     DOWNE'1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C           *INKA     ANDNE'1'                                       S01332
     C           *INKL     ANDNE'1'                                       S01332
     C/COPY WNCPYSRC,FF0020C053
     C**
     C**   Validate Input
     C**   and perform SPF checking                                       S01117
     C                     EXSR VTNBR
     C**
     C**   If valid - proceed to full details screen
     C**
     C           *IN18     IFEQ '0'
     C***04*****           MOVEAMSG,2     SERCD2                          CFF007
     C   04                MOVELMSG,2     SERCD2                          CFF007
      *                                                                   S01332
     C           *IN77     IFEQ '0'                                       S01332
     C**********           MOVEAMSG,1     STEXT                           CFF007
     C                     MOVELMSG,1     STEXT                           CFF007
     C                     ELSE                                           S01332
     C**********           MOVEAMSG,10    STEXT                    S01332 CFF007
     C                     MOVELMSG,10    STEXT                           CFF007
     C                     END                                            S01332
     C/COPY WNCPYSRC,FF0020C061
     C**
     C           SMRKT     IFNE '  '
     C                     EXSR ADEMKI
     C**
     C                     ELSE
     C                     EXSR ADEOTC
     C                     END
     C/COPY WNCPYSRC,FF0020C063
     C**
     C                     END
     C**
     C**   Redisplay screen
     C**
     C           *INKC     IFNE '1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C           *INKA     ANDNE'1'                                       S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CCP9                                           S01408
     C*                                                                   S01408
     C                     EXSR SCRNF2
     C/COPY WNCPYSRC,FF0020C055
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   ADEMKI SR. -  Amd/Del/Enq  Market Instrument Control          *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. PROMPT                   SR. ISADEW                   *
     C**                                    SR. VAMEND                   *
     C**                                    SR. VDELET                   *
     C**                                    SR. UAMEND                   *
     C**                                    SR. UDELET                   *
     C**                                    SR. SCRNF6                   *
     C**                                    SR. SCRNF8                   *
     C**                                    SR. RSTADE                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           ADEMKI    BEGSR                           ** ADEMKI SR **
     C**
     C**   Initialise  Screen fields
     C**
     C                     EXSR ISADEW
     C**
     C/COPY WNCPYSRC,FF0020C043
     C**   Display screen
     C                     EXSR SCRNF6
     C**
     C           SACTN     IFNE 'E'
     C**
     C*****Continue*until*F3 or F12 taken, or valid exit.                 S01240
     C**   Continue until F3,F9 or F12 taken, or valid exit.              S01240
     C**
     C           *INKC     DOWNE'1'
     C           *INKL     ANDNE'1'
     C           *INKI     ANDNE'1'                                       E90100
     C           *IN10     ANDNE'1'
     C**
     C**   Validate Input
     C           SACTN     IFEQ 'A'
     C                     EXSR VAMEND
     C                     ELSE
     C                     EXSR VDELET
     C                     END
     C**
     C**   If error - redisplay screen
     C           *IN18     IFEQ '1'
     C           *IN19     OREQ '1'
     C                     EXSR SCRNF6
     C**
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP10                                           S01408
     C*                                                                   S01408
     C**   Otherwise - attempt update
     C                     SETON                     10
     C**
     C           SACTN     IFEQ 'A'
     C**********           MOVEAMSG,5     STEXT                           CFF007
     C                     MOVELMSG,5     STEXT                           CFF007
     C                     WRITEFF0010F6
     C                     EXSR UAMEND
     C**
     C                     ELSE
     C**********           MOVEAMSG,6     STEXT                           CFF007
     C                     MOVELMSG,6     STEXT                           CFF007
     C                     WRITEFF0010F6
     C                     EXSR UDELET
     C**                                                                  122246
     C**   Also delete the minus transaction if exists                    122246
     C                     Z-SUBKTNBR     KTNBR                           122246
     C                     EXSR UDELE2                                    122246
     C                     Z-SUBKTNBR     KTNBR                           122246
     C                     END
     C**
     C**   If Update by another workstN
     C           *IN11     IFEQ '1'
     C                     EXSR SCRNF8
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP11                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP12                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C/COPY WNCPYSRC,FF0020C044
     C**
     C**   Reset
     C           *INKC     IFNE '1'
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C           *INKA     ANDNE'1'                                       S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP13                                           S01408
     C*                                                                   S01408
     C                     EXSR RSTADE
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   ADEOTC SR. -  Amd/Del/Enq  O.T.C. Control                     *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. PROMPT                   SR. ISADEW                   *
     C**                                    SR. VAMEND                   *
     C**                                    SR. VDELET                   *
     C**                                    SR. UAMEND                   *
     C**                                    SR. UDELET                   *
     C**                                    SR. SCRNF7                   *
     C**                                    SR. SCRNF8                   *
     C**                                    SR. RSTADE                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           ADEOTC    BEGSR                           ** ADEOTC SR **
     C**
     C**   Initialise  Screen fields
     C**
     C                     EXSR ISADEW
     C/COPY WNCPYSRC,FF0020C045
     C**
     C**   Display screen
     C                     EXSR SCRNF7
     C**
     C           SACTN     IFNE 'E'
     C**
     C*****Continue*until*F3, or F12 taken, or valid exit.                S01240
     C**   Continue until F3,F9 or F12 taken, or valid exit.              S01240
     C**
     C           *INKC     DOWNE'1'
     C           *INKL     ANDNE'1'
     C           *INKI     ANDNE'1'                                       E90100
     C           *IN10     ANDNE'1'
     C**
     C**   Validate Input
     C           SACTN     IFEQ 'A'
     C                     EXSR VAMEND
     C                     ELSE
     C                     EXSR VDELET
     C                     END
     C**
     C**   If error - redisplay screen
     C           *IN18     IFEQ '1'
     C           *IN19     OREQ '1'
     C                     EXSR SCRNF7
     C**
     C                     ELSE
      *                                                                   CFF007
      ** PB Screen                                                        CFF007
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C           SACTN     ANDEQ'A'                                       CFF007
     C                     EXSR SRSFD                                     CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ4                                         CPL002
     C           SACTN     ANDEQ'A'                                       CPL002
     C           SACTN     ANDEQ'A'                                       CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           WISPT     ANDEQ6                                         CPL002
     C           SACTN     ANDEQ'A'                                       CPL002
     C                     EXSR MPSCRN                                    CPL002
     C           WPREV     IFEQ '*PREV'                                   CPL002
     C                     MOVE *BLANKS   ERR                             CPL002
     C                     MOVEA'00'      *IN,18                          CPL002
     C                     EXSR SCRNF7                                    CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ELSE                                           CPL002
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP14                                           S01408
     C*                                                                   S01408
     C**   Otherwise - attempt update
     C                     SETON                     10
     C**
     C           SACTN     IFEQ 'A'
     C**********           MOVEAMSG,5     STEXT                           CFF007
     C                     MOVELMSG,5     STEXT                           CFF007
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ5                                         CPL002
     C                     WRITEFF0010FB                                  CPL002
     C                     ELSE                                           CPL002
     C                     WRITEFF0010F7
     C                     END                                            CPL002
     C                     EXSR UAMEND
     C**
     C                     ELSE
     C**********           MOVEAMSG,6     STEXT                           CFF007
     C                     MOVELMSG,6     STEXT                           CFF007
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ5                                         CPL002
     C                     WRITEFF0010FB                                  CPL002
     C                     ELSE                                           CPL002
     C                     WRITEFF0010F7
     C                     END                                            CPL002
     C                     EXSR UDELET
     C**                                                                  122246
     C**   Also delete the minus transaction if exists                    122246
     C                     Z-SUBKTNBR     KTNBR                           122246
     C                     EXSR UDELE2                                    122246
     C                     Z-SUBKTNBR     KTNBR                           122246
     C                     END
     C**
     C**   If Update by another workstN
     C           *IN11     IFEQ '1'
     C                     EXSR SCRNF8
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP15                                           S01408
     C*                                                                   S01408
     C**
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CFF007
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP16                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           CPL002
     C/COPY WNCPYSRC,FF0020C121
     C           *INKC     DOWNE'1'                                       CFF007
     C           *INKL     ANDNE'1'                                       CFF007
     C           *INKI     ANDNE'1'                                       CFF007
      *                                                                   CFF007
      ** PB Screen                                                        CFF007
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C                     EXSR SRSFD                                     CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ4                                         CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           WISPT     ANDEQ6                                         CPL002
     C                     EXSR MPSCRN                                    CPL002
     C           WPREV     IFEQ '*PREV'                                   CPL002
     C                     EXSR SCRNF7                                    CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CFF007
     C                     ENDDO                                          CFF007
     C**
     C                     END
     C/COPY WNCPYSRC,FF0020C046
     C**
     C**   Reset
     C           *INKC     IFNE '1'                                       E17776
     C************INKA     IFNE '1'                                       E17776
     C************INKL     ANDNE'1'                                       E90100
     C           *INKI     ANDNE'1'                                       E90100
     C           *INKA     ANDNE'1'                                       S01332
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP17                                           S01408
     C*                                                                   S01408
     C                     EXSR RSTADE
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF2 SR. -  To  Write/Read  Transaction Ref Prompt Screen   *
     C**   ~~~~~~~~~~     + handle 'HELP'                                *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. PROMPT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF2    BEGSR                           ** SCRNF2 SR **
     C**
     C                     EXFMTFF0010F2
     C*****Allow*'HELP'*                                                  S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F2                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF3 SR. -  To  Write/Read  Insert Market Instrument        *
     C**   ~~~~~~~~~~     details screen, + handle 'HELP'                *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. INSMKI                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF3    BEGSR                           ** SCRNF3 SR **
     C**
     C                     EXFMTFF0010F3
     C*****Allow*'HELP'*                                                  S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F3                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF4 SR. -  To  Write/Read  Insert O.T.C. details screen    *
     C**   ~~~~~~~~~~     + handle 'HELP'                                *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. INSOTC                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF4    BEGSR                           ** SCRNF4 SR **
     C**
     C** Set up to use FF0010FA for currency OTC if Plato                 CPL002
     C** interface is present.                                            CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           PISPT     ANDEQ'5'                                       CPL002
     C                     EXFMTFF0010FA                                  CPL002
     C                     ELSE                                           CPL002
     C                     EXFMTFF0010F4
     C                     END                                            CPL002
     C*****Allow*'HELP'*                                                  S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F4                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF5 SR. -  To Write/Read  Insert Settlement Instructions   *
     C**   ~~~~~~~~~~     screen + handle 'HELP'                         *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF5    BEGSR                           ** SCRNF5 SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP18                                           S01408
     C*                                                                   S01408
     C**
     C                     EXFMTFF0010F5
     C*****Allow*'HELP'*                                                  S01199
     C**********                                                          S01199
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F5                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF6 SR. -  To  Write/Read  Amd/Del/Enq  Market Instrument  *
     C**   ~~~~~~~~~~     screen, + handle 'HELP'                        *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF6    BEGSR                           ** SCRNF6 SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP19                                           S01408
     C*                                                                   S01408
     C**
     C**   If first time through, save screen details for later use       081630
     C**                                                                  081630
     C           @FIRST    IFNE 'Y'                                       081630
     C                     MOVE 'Y'       @FIRST  1                       081630
     C/COPY WNCPYSRC,FF0020CR62
      ** SMIOSV Redefined as Data Structure as max. field size is 256     CFF004
     C************LIKE     DEFN SMIODS    SMIOSV                    081630CFF004
     C/COPY WNCPYSRC,FF0020CR63
     C           *LIKE     DEFN SSETDS    SSETSV                          081630
     C                     MOVE SMIODS    SMIOSV                          081630
     C                     MOVE SSETDS    SSETSV                          081630
     C                     END                                            081630
     C**                                                                  081630
     C                     EXFMTFF0010F6
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP30                                           S01408
     C*                                                                   S01408
     C**   Allow 'HELP'
     C**********
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F6                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C/COPY WNCPYSRC,FF0020C049
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF7 SR. -  To  Write/Read  Amd/Del/Enq  O.T.C. screen      *
     C**   ~~~~~~~~~~     + handle 'HELP'                                *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. ADEOTC                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF7    BEGSR                           ** SCRNF7 SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP20                                           S01408
     C*                                                                   S01408
     C**
     C**   If first time through, save screen details for later use       081630
     C**                                                                  081630
     C           @FIRST    IFNE 'Y'                                       081630
     C                     MOVE 'Y'       @FIRST  1                       081630
     C                     MOVE SMIODS    SMIOSV                          081630
     C                     MOVE SSETDS    SSETSV                          081630
     C                     END                                            081630
     C**                                                                  081630
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ5                                         CPL002
     C                     EXFMTFF0010FB                                  CPL002
     C                     ELSE                                           CPL002
     C                     EXFMTFF0010F7
     C                     END                                            CPL002
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP31                                           S01408
     C*                                                                   S01408
     C*****Allow*'HELP'*
     C**********
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F7                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C/COPY WNCPYSRC,FF0020C050
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   SCRNF8 SR. -  To  Write/Read  'Trade / Linked Trade  Updated  *
     C**   ~~~~~~~~~~   by another Workstation' screen, + handle 'HELP'  *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                                                *
     C**       SR. ADEMKI                                                *
     C**       SR. ADEOTC                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           SCRNF8    BEGSR                           ** SCRNF8 SR **
     C**
     C**   Display screen, protected with updated details
     C**   - Mkt Instr.
     C           SMRKT     IFNE '  '
     C                     WRITEFF0010F6
     C**   - O.T.C.
     C                     ELSE
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           WISPT     ANDEQ5                                         CPL002
     C                     WRITEFF0010FB                                  CPL002
     C                     ELSE                                           CPL002
     C                     WRITEFF0010F7
     C                     END                                            CPL002
     C                     END
     C**
     C                     EXFMTFF0010F8
     C*****Allow*'HELP'*
     C**********
     C********** *IN01     DOWEQ'1'                                       S01199
     C**********
     C**********           MOVE 'FF0020  'HBPGM   8                       S01199
     C**********           MOVEAERR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********                                                          S01199
     C**********           READ FF0010F8                 06               S01199
     C**********           END                                            S01199
     C**
     C                     ENDSR
     C**
     C********************************************************************
      /EJECT                                                              CFF007
      *****************************************************************   CFF007
      *                                                               *   CFF007
      *  SRSFD - Display and Validate Private Banking Screen          *   CFF007
      *                                                               *   CFF007
      *****************************************************************   CFF007
      *                                                                   CFF007
     C           SRSFD     BEGSR                                          CFF007
      *                                                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     MOVELSTEXT     WTEXT  76                       CFF007
      *                                                                   CFF007
     C           *INKC     DOWEQ'0'                                       CFF007
     C           *INKL     ANDEQ'0'                                       CFF007
     C           WRDPLY    ANDEQ'Y'                                       CFF007
     C                     MOVEL*BLANKS   STEXT                           CFF007
      *                                                                   CFF007
     C                     EXFMTFF0010FD                                  CFF007
      *                                                                   CFF007
     C                     Z-ADD*ZERO     E                               CFF007
     C                     MOVE *BLANKS   ERR                             CFF007
     C           *INKL     IFNE '1'                                       CFF007
     C           *INKC     ANDNE'1'                                       CFF007
     C                     MOVE 'N'       WRDPLY                          CFF007
     C                     MOVE '0'       *IN18                           CFF007
      *                                                                   CFF007
     C           SACTN     IFEQ 'A'                                       CFF007
     C                     EXSR VPBFL                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     SELEC                                          CFF007
     C           *IN18     WHEQ '1'                                       CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
      *                                                                   CFF007
     C           *IN18     WHEQ '0'                                       CFF007
     C           WRDPLY    ANDEQ'N'                                       CFF007
     C           BGN2ST    ANDEQ'N'                                       CFF007
     C           SACTN     ANDEQ'A'                                       CFF007
     C                     MOVE '1'       *IN10                           CFF007
     C                     MOVELMSG,5     STEXT                           CFF007
     C                     WRITEFF0010FD                                  CFF007
     C                     EXSR UAMEND                                    CFF007
      *                                                                   CFF007
     C           *IN18     WHEQ '0'                                       CFF007
     C           WRDPLY    ANDEQ'N'                                       CFF007
     C           BGN2ST    ANDEQ'Y'                                       CFF007
     C           WISPT     IFEQ 4                                         CFF007
     C           WISPT     OREQ 6                                         CFF007
     C                     EXSR MPSCRN                                    CFF007
     C           WPREV     IFEQ '*PREV'                                   CFF007
     C                     MOVE *BLANKS   ERR                             CFF007
     C                     MOVEA'00'      *IN,18                          CFF007
     C                     MOVE '0'       *INKL                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C                     ENDSL                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** Back to main screen                                              CFF007
      *                                                                   CFF007
     C                     MOVELWTEXT     STEXT                           CFF007
     C           *INKL     IFEQ '1'                                       CFF007
     C                     MOVE *BLANKS   ERR                             CFF007
     C                     MOVEA'00'      *IN,18                          CFF007
     C                     EXSR SCRNF7                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
      *****************************************************************   CFF007
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   IBRDFT SR. - Initialise  Broker Defaults                      *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           IBRDFT    BEGSR                           ** IBRDFT SR **
     C**
     C**   Access  Broker Defaults from LF/DEFLT
     C                     MOVE WBOCO     KCBCD
     C**
     C           KDEFLT    CHAINDEFLT                71
     C  N71      RECI      COMP 'D'                  7171
     C/SPACE 2
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP38                                           S01408
     C*                                                                   S01408
     C**   Instrument Defaults
     C**   ~~~~~~~~~~~~~~~~~~~
     C           *IN71     IFEQ '1'
     C**   - from LF/INTYP
     C           BCPTI     IFNE ' '
     C                     MOVE BCPTI     XBCPT
     C                     MOVE BCMC      SBCMC
     C                     MOVE BCMS      SBCMS
     C                     END
     C**
     C           STRTY     IFEQ 'P'
     C           BCGP      IFNE 00
     C                     MOVE BCGP      SBCHC
     C                     END
     C**
     C                     ELSE
     C           BCGS      IFNE 00
     C                     MOVE BCGS      SBCHC
     C                     END
     C**
     C                     END
     C**
     C                     ELSE
     C**   LF/DEFLT record exists
     C**
     C**   - 1. Commission details
     C           CPAT      IFNE ' '
     C**    (from LF/DEFLT)
     C                     MOVE CPAT      XBCPT
     C                     MOVE CMCD      SBCMC
     C                     MOVE CMSD      SBCMS
     C**
     C                     ELSE
     C**    (from LF/INTYP)
     C           BCPTI     IFNE ' '
     C                     MOVE BCPTI     XBCPT
     C                     MOVE BCMC      SBCMC
     C                     MOVE BCMS      SBCMS
     C                     END
     C**
     C                     END
     C**
     C**   - 2. Charge code (Purchase)
     C           STRTY     IFEQ 'P'
     C**
     C           CGEP      IFNE 00
     C**    (from LF/DEFLT)
     C                     MOVE CGEP      SBCHC
     C                     ELSE
     C**    (from LF/INTYP)
     C           BCGP      IFNE 00
     C                     MOVE BCGP      SBCHC
     C                     END
     C**
     C                     END
     C**
     C**   - 3. Charge code (Sale)
     C                     ELSE
     C**
     C           CGES      IFNE 00
     C**    (from LF/DEFLT)
     C                     MOVE CGES      SBCHC
     C                     ELSE
     C**    (from LF/INTYP)
     C           BCGS      IFNE 00
     C                     MOVE BCGS      SBCHC
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           SBCMC     IFNE *BLANK                                    CFF007
     C           WBPRBA    ANDEQ'Y'                                       CFF007
     C           SBCMC     ANDEQSBCMS                                     CFF007
      *                                                                   CFF007
     C           BCPTI     IFEQ 'S'                                       CFF007
     C           BCPTI     OREQ 'H'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO                           CFF007
     C                     MOVE SBCMC     CGCM                            CFF007
     C                     Z-ADD0         WRATA                           CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCMA  14                       CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SBCMA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WBCMA                           CFF007
     C                     MOVE ZXCMA     SBCMA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SBCHC     IFNE *BLANK                                    CFF007
     C           WBPRBA    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO                           CFF007
     C                     MOVE SBCHC     CGCM                            CFF007
     C                     Z-ADD0         WRATA                           CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCMA  14                       CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SBCHA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WBCHA                           CFF007
     C                     MOVE ZXCMA     SBCHA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020CP39                                           S01408
     C*                                                                   S01408
     C/SPACE 2
     C**   Settlement Defaults
     C**   ~~~~~~~~~~~~~~~~~~~
     C           *IN71     IFEQ '0'
     C           SETP      ANDNE00
     C**   - from LF/DEFLT
     C                     MOVE SETP      SBSLT
     C                     MOVE SETA      SBSLA
     C                     MOVE FACO      SBFAO
     C                     MOVELCNOS      SBCPN
     C                     MOVE SEBR      SBSBR                           S01117
     C**
     C                     ELSE
     C**   - from LF/FOCLTB
     C                     MOVE SETPB     SBSLT
     C                     MOVE SETAB     SBSLA
     C                     MOVE FACOB     SBFAO
     C                     MOVELCNOSB     SBCPN
     C                     MOVE SEBRB     SBSBR                           S01117
     C                     END
     C***********                                                         S01117
     C***********SBSLT     IFEQ '05'                                      S01117
     C************IN64     ANDEQ'0'                                       S01117
     C***********          MOVE NSACS     SBSLA                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   ICUDFT SR. -  Initialise  Customer Defaults                   *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           ICUDFT    BEGSR                           ** ICUDFT SR **
     C**
     C**   Access  Customer Defaults from LF/DEFLT
     C**   - no defaults exist for O.T.C.'s
     C                     MOVE WCUSC     KCBCD
     C**
     C           SMRKT     IFNE '  '
     C           KDEFLT    CHAINDEFLT                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C                     ELSE
     C                     SETON                     71
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP40                                           S01408
     C*                                                                   S01408
     C/SPACE 2
     C**   Instrument Defaults
     C**   ~~~~~~~~~~~~~~~~~~~
     C           *IN71     IFEQ '1'
     C**   - from LF/INTYP
     C           CCPTI     IFNE ' '
     C                     MOVE CCPTI     XCCPT
     C                     MOVE CCMC      SCCMC
     C                     MOVE CCMS      SCCMS
     C                     END
     C**
     C           STRTY     IFEQ 'P'
     C           CCGP      IFNE 00
     C                     MOVE CCGP      SCCHC
     C                     END
     C**
     C                     ELSE
     C           CCGS      IFNE 00
     C                     MOVE CCGS      SCCHC
     C                     END
     C**
     C                     END
     C**
     C                     ELSE
     C**   LF/DEFLT record exists
     C**
     C**   - 1. Commission details
     C           CPAT      IFNE ' '
     C**    (from LF/DEFLT)
     C                     MOVE CPAT      XCCPT
     C                     MOVE CMCD      SCCMC
     C                     MOVE CMSD      SCCMS
     C**
     C                     ELSE
     C**    (from LF/INTYP)
     C           CCPTI     IFNE ' '
     C                     MOVE CCPTI     XCCPT
     C                     MOVE CCMC      SCCMC
     C                     MOVE CCMS      SCCMS
     C                     END
     C**
     C                     END
     C**
     C**   - 2. Charge code (Purchase)
     C           STRTY     IFEQ 'P'
     C**
     C           CGEP      IFNE 00
     C**    (from LF/DEFLT)
     C                     MOVE CGEP      SCCHC
     C                     ELSE
     C**    (from LF/INTYP)
     C           CCGP      IFNE 00
     C                     MOVE CCGP      SCCHC
     C                     END
     C**
     C                     END
     C**
     C**   - 3. Charge code (Sale)
     C                     ELSE
     C**
     C           CGES      IFNE 00
     C**    (from LF/DEFLT)
     C                     MOVE CGES      SCCHC
     C                     ELSE
     C**    (from LF/INTYP)
     C           CCGP      IFNE 00
     C                     MOVE CCGS      SCCHC
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           SCCMC     IFNE *BLANK                                    CFF007
     C           BBPRBA    ANDEQ'Y'                                       CFF007
     C           SCCMC     ANDEQSCCMS                                     CFF007
      *                                                                   CFF007
     C           CCPTI     IFEQ 'S'                                       CFF007
     C           CCPTI     OREQ 'H'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO                           CFF007
     C                     MOVE SCCMC     CGCM                            CFF007
     C                     Z-ADD0         WRATA                           CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCMA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SCCMA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WCCMA                           CFF007
     C                     MOVE ZXCMA     SCCMA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SCCHC     IFNE *BLANK                                    CFF007
     C           BBPRBA    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO                           CFF007
     C                     MOVE SCCHC     CGCM                            CFF007
     C                     Z-ADD0         WRATA                           CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCMA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SCCHA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WCCHA                           CFF007
     C                     MOVE ZXCMA     SCCHA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020CP41                                           S01408
     C*                                                                   S01408
     C/SPACE 2
     C**   Settlement Defaults
     C**   ~~~~~~~~~~~~~~~~~~~
     C           *IN71     IFEQ '0'
     C           SETP      ANDNE00
     C**   - from LF/DEFLT
     C                     MOVE SETP      SCSLT
     C                     MOVE SETA      SCSLA
     C                     MOVE FACO      SCFAO
     C                     MOVELCNOS      SCCPN
     C                     MOVE SEBR      SBRSC                           S01117
     C**
     C                     ELSE
     C**   - from LF/FOCLTC
     C                     MOVE SETPC     SCSLT
     C                     MOVE SETAC     SCSLA
     C                     MOVE FACOC     SCFAO
     C                     MOVELCNOSC     SCCPN
     C                     MOVE SEBRC     SBRSC                           S01117
     C                     END
     C**                                                                  073714
     C** For OTCS default settlement instructions                         073714
     C** if Enhanced OTC is present                                       CFF001
     C**                                                                  073714
     C           SMRKT     IFEQ *BLANK                                    073714
     C           CFF001    ANDEQ'Y'                                       CFF001
     C                     EXSR DOTCST                                    073714
     C                     END                                            073714
     C***********                                                         S01117
     C***********SCSLT     IFEQ '05'                                      S01117
     C************IN64     ANDEQ'0'                                       S01117
     C***********          MOVE NSACS     SCSLA                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                 *S01117
     C**   IPRFC1 SR. -  Initialise  Profit Centre (Insert) Main routine *S01117
     C**   ~~~~~~~~~                                                     *S01117
     C**                                                                 *S01117
     C**      Called From                  Calls                         *S01117
     C**       SR. INSMKI                                                *S01117
     C**       SR. INSOTC                                                *S01117
     C**                                                                 *S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           IPRFC1    BEGSR                           ** IPRFC1 SR **S01117
     C*                                                                   CAC003
     C** Initialize fields                                                CAC003
     C*                                                                   CAC003
     C                     MOVE *BLANKS   SBPRC                           CAC003
     C                     MOVE *BLANKS   STPRC                           CAC003
     C*                                                                   S01117
     C                     MOVE *BLANKS   SPRFC                           S01117
     C                     SETON                     63                   S01117
     C***********          SETOF                     12            FO0020 CAC003
     C                     MOVE '0'       WIN12   1                       CAC003
     C*                                                                   FO0020
     C** Determine If a Book Position Profit Centre Exists for Trade.     FO0020
     C*                                                                   FO0020
     C           @FOPCK    IFNE 'Y'                                       FO0020
     C                     MOVE 'Y'       @FOPCK  1                       FO0020
     C                     OPEN FOPCK                                     FO0020
     C                     END                                            FO0020
     C                     MOVE SBRCD     KBRCAF                          FO0020
     C                     MOVE SBOKC     KBOKCF                          FO0020
     C           SMRKT     IFEQ '  '                                      FO0020
     C                     MOVE SISTT     KISTTF                          FO0020
     C                     ELSE                                           FO0020
     C                     MOVELSMRKT     KISTTF                          FO0020
     C                     MOVE SISTC     KISTTF                          FO0020
     C                     END                                            FO0020
     C*                                                                   FO0020
     C           KFPCK     CHAINFOPCK                71                   FO0020
     C*                                                                   FO0020
     C**   - new position                                                 FO0020
     C*                                                                   FO0020
     C           *IN71     IFEQ '1'                                       FO0020
     C           RECI      ORNE 'D'                                       FO0020
     C**                                                                  FO0020
     C**   - Set on *IN12 to allow Write on new Book Posn Profit Centre   FO0020
     C**         record in SR/UAPRFC                                      FO0020
     C                     SETON                     12                   FO0020
     C                     MOVE '1'       WIN12                           CAC003
     C*                                                                   FO0020
     C                     END                                            FO0020
     C*                                                                   S01117
     C**   1. If reconcile trade/book position profit centre = 'N'        S01117
     C*                                                                   S01117
     C           TBRC      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**   - Profit Centre Default used = 'Y'                             S01117
     C*                                                                   S01117
     C           PFCD      IFEQ 'Y'                                       S01117
     C                     EXSR IPRFC2                                    S01117
     C                     MOVE WW52      *IN79                           CAC003
     C                     MOVE WPRFC     SPRFC                           CAC003
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C*****2.*If*reconcile*trade/book*position*profit*centre*=*'Y'**S01117FO0020
     C**********                                                    S01117FO0020
     C********** @FOPCK    IFNE 'Y'                                 S01117FO0020
     C**********           MOVE 'Y'       @FOPCK  1                 S01117FO0020
     C**********           OPEN FOPCK                               S01117FO0020
     C**********           END                                      S01117FO0020
     C**********           MOVE SBRCD     KBRCAF                    S01117FO0020
     C**********           MOVE SBOKC     KBOKCF                    S01117FO0020
     C********** SMRKT     IFEQ '  '                                S01117FO0020
     C**********           MOVE SISTT     KISTTF                    S01117FO0020
     C**********           ELSE                                     S01117FO0020
     C**********           MOVELSMRKT     KISTTF                    S01117FO0020
     C**********           MOVE SISTC     KISTTF                    S01117FO0020
     C**********           END                                      S01117FO0020
     C**********                                                    S01117FO0020
     C********** KFPCK     CHAINFOPCK                71             S01117FO0020
     C**********                                                    S01117FO0020
     C*****-*new*position                                           S01117FO0020
     C**********                                                    S01117FO0020
     C********** *IN71     IFEQ '1'                                 S01117FO0020
     C********** RECI      ORNE 'D'                                 S01117FO0020
     C**********                                                          FO0020
     C*                                                                   FO0020
     C** If a New Book Position                                           FO0020
     C*                                                                   FO0020
     C************IN12     IFEQ '1'                                FO0020 CAC003
     C           WIN12     IFEQ '1'                                       CAC003
     C*                                                                   S01117
     C**   - Profit Centre Default used = 'Y'                             S01117
     C*                                                                   S01117
     C           PFCD      IFEQ 'Y'                                       S01117
     C                     EXSR IPRFC2                                    S01117
     C                     MOVE WW52      *IN79                           CAC003
     C*                                                                   CAC003
     C** Move WPRFC to SBPRC if *IN01 is on                               CAC003
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE WPRFC     SBPRC                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE WPRFC     SPRFC                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   - old position                                                 S01117
     C*                                                                   S01117
     C                     SETOF                     63                   S01117
     C*                                                                   CAC003
     C** Move PCBK to SBPRC if *IN01 is on                                CAC003
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE PCBK      SBPRC                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE PCBK      SPRFC                           S01117
     C                     ENDIF                                          CAC003
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            S01117
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C*                                                                   CAC003
     C** Display Trans. Profit Centre and make it amendable               CAC003
     C*                                                                   CAC003
     C********** WCUSC     IFEQ *ZEROS                                                 CAC003 CSD027
     C           WCUSC     IFEQ *BLANKS                                                       CSD027
     C                     MOVE '0'       *IN12                           CAC003
     C                     MOVE '0'       *IN09                           CAC003
     C                     MOVE '0'       WIN13   1                       CAC003
     C                     ELSE                                           CAC003
     C                     MOVE '1'       *IN12                           CAC003
     C                     MOVE '1'       *IN09                           CAC003
     C                     MOVE '0'       WIN13                           CAC003
     C*                                                                   CAC003
     C** Determine if a Customer position profit centre exists            CAC003
     C** for the customer                                                 CAC003
     C*                                                                   CAC003
     C           @FOPCC    IFNE 'Y'                                       CAC003
     C                     MOVE 'Y'       @FOPCC                          CAC003
     C                     OPEN FOPCC                                     CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     MOVE SBRCD     KBRCAO                          CAC003
     C                     MOVE WCUSC     KCBCDO                          CAC003
     C*                                                                   CAC003
     C           SMRKT     IFEQ *BLANKS                                   CAC003
     C                     MOVE SISTT     KISTTO                          CAC003
     C                     ELSE                                           CAC003
     C                     MOVELSMRKT     KISTTO                          CAC003
     C                     MOVE SISTC     KISTTO                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C           KFPCC     CHAINFOPCC                71                   CAC003
     C           *IN71     IFEQ '1'                                       CAC003
     C           RECI      ORNE 'D'                                       CAC003
     C                     MOVE '1'       WIN13                           CAC003
     C           PFCD      IFEQ 'Y'                                       CAC003
     C                     EXSR IPRFC2                                    CAC003
     C                     MOVE WW52      *IN67                           CAC003
     C                     MOVE WPRFC     STPRC                           CAC003
     C                     ENDIF                                          CAC003
     C                     ELSE                                           CAC003
     C                     MOVE '0'       *IN09                           CAC003
     C                     MOVE PCCB      STPRC                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                 *S01117
     C**   IPRFC2 SR. -  Initialise  Profit Centre (Insert) AO routine   *S01117
     C**   ~~~~~~~~~                                                     *S01117
     C**                                                                 *S01117
     C**      Called From                  Calls                         *S01117
     C**       SR. IPRFC1                                                *S01117
     C**                                                                 *S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           IPRFC2    BEGSR                           ** IPRFC2 SR **S01117
     C*                                                                   S01117
     C                     MOVE SBRCD     @BRCD   3                       S01117
     C                     MOVE BBACOC    ACOF    2                       176510
     C*                                                                   S01117
     C**   Set up base fields for Profit Centre default taking            S01117
     C*                                                                   S01117
     C                     CALL 'AOPRFMR0'                                S01117
     C                     PARM *BLANKS   @RTCD1  1                       S01117
     C                     PARM SBOKC     @BKCD   2                       S01117
     C                     PARM *BLANKS   @TRTY   5                       S01117
     C                     PARM *BLANKS   @SBTY   2                       S01117
     C                     PARM           @BRCD   3                       S01117
     C                     PARM *BLANKS   @DPCD   3                       S01117
     C                     PARM USRID     @USID  10                       S01117
     C*******************  PARM *BLANKS   @ACOC   2                S01117 176510
     C                     PARM ACOF      @ACOC   2                       176510
     C                     PARM CUST      @CUST   6                       S01117
     C                     PARM *BLANK    PRFC    4                       S01117
     C*********  @RTCD1    IFEQ *BLANK                              S01117FO0003
     C           @RTCD1    IFNE '2'                                       FO0003
     C***********          MOVELPRFC      SPRFC                    S01117 CAC003
     C                     MOVELPRFC      WPRFC   4                       CAC003
     C                     MOVE '0'       WW52    1                       CAC003
     C                     ELSE                                           S01117
     C                     Z-ADD*ZEROS    E                               S01117
     C                     MOVEL*BLANKS   ERR                             S01117
     C***********          MOVEL*BLANKS   SPRFC                    S01117 CAC003
     C                     MOVEL*BLANKS   WPRFC                           CAC003
     C           E         ADD  1         E                               S01117
     C                     MOVE ' W52'    ERR,E                           S01117
     C***********          SETON                     1879          S01117 CAC003
     C                     SETON                     18                   CAC003
     C                     MOVE '1'       WW52                            CAC003
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************073714
     C**                                                                 *073714
     C**   DOTCST SR. -  Default OTC Settlement Instructions             *073714
     C**   ~~~~~~~~~                                                     *073714
     C**                                                                 *073714
     C**      Called From                  Calls                         *073714
     C**       SR. ICUDFT                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           DOTCST    BEGSR                           ** DOTCST SR **073714
     C**                                                                  073714
     C** Access option transaction settlement instructions                073714
     C**                                                                  073714
     C                     MOVE SISCY     BYCYCD                          073714
     C                     MOVE WCUSC     BYCUST                          073714
     C                     MOVE 'OP'      BYTRTY                          073714
     C           KEXST     CHAINSDEXSTL1             71                   073714
     C           *IN71     IFEQ '0'                                       073714
     C**                                                                  073714
     C** Pay instructions                                                 073714
     C**                                                                  073714
     C           STRTY     IFEQ 'P'                                       073714
     C                     MOVELBYPSTY    SCSLT                           073714
     C                     MOVELBYPONO    SCSLA                           073714
     C                     MOVELBYBYNB    SCFAO                           073714
     C                     MOVELBYACBN    SCCPN                           073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C** Receive instructions                                             073714
     C**                                                                  073714
     C                     MOVELBYRSTY    SCSLT                           073714
     C                     MOVELBYRONO    SCSLA                           073714
     C                     MOVEL*BLANK    SCFAO                           073714
     C                     MOVELBYRIBN    SCCPN                           073714
     C                     END                                            073714
     C**                                                                  073714
     C** Access 'ALL' transaction settlement instructions                 073714
     C**                                                                  073714
     C                     ELSE                                           073714
     C                     MOVE 'AT'      BYTRTY                          073714
     C           KEXST     CHAINSDEXSTL1             71                   073714
     C           *IN71     IFEQ '0'                                       073714
     C**                                                                  073714
     C** Pay instructions                                                 073714
     C**                                                                  073714
     C           STRTY     IFEQ 'P'                                       073714
     C                     MOVELBYPSTY    SCSLT                           073714
     C                     MOVELBYPONO    SCSLA                           073714
     C                     MOVELBYBYNB    SCFAO                           073714
     C                     MOVELBYACBN    SCCPN                           073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C** Receive instructions                                             073714
     C**                                                                  073714
     C                     MOVELBYRSTY    SCSLT                           073714
     C                     MOVELBYRONO    SCSLA                           073714
     C                     MOVEL*BLANK    SCFAO                           073714
     C                     MOVELBYRIBN    SCCPN                           073714
     C                     END                                            073714
     C                     END                                            073714
     C**                                                                  073714
     C                     END                                            073714
     C                     ENDSR                                          073714
     C**                                                                  073714
     C********************************************************************073714
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   ISADEW SR. -  Initialise  Screen details for Amd/Del/Enq,     *
     C**   ~~~~~~~~~      and Rec Upd by Another Wrkstn                  *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                   SR. FFSTDP                   *
     C**       SR. ADEOTC                                                *
     C**       SR. TUDBAW                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           ISADEW    BEGSR                           ** ISADEW SR **
     C**
     C                     MOVE '0'       *IN83                           CPL002
     C*                                                                   CPL002
     C           SACTN     IFNE 'E'
     C           *IN11     ANDNE'1'
     C/COPY WNCPYSRC,FF0020C047
     C**
     C**   If 'End of Centre Processed ind.' = 'N'
     C           ECPI      IFEQ 'N'
     C                     SETON                     65
     C                     END
     C**                                                                  S01117
     C**   If Amend                                                       S01117
     C**   and 'Profit Centre Used' = 'Y'                                 S01117
     C**   and 'Profit Centre Amendable' = 'Y'                            S01117
     C**   and 'Reconcile Trade/Position Profit Centre' = 'N'             S01117
     C**      Allow input with standard validation                        S01117
     C**   Else                                                           S01117
     C**      Protect Profit Centre field                                 S01117
     C**                                                                  S01117
     C           SACTN     IFEQ 'A'                                       S01117
     C           PFCU      ANDEQ'Y'                                       S01117
     C           PFCA      ANDEQ'Y'                                       S01117
     C           TBRC      ANDEQ'N'                                       S01117
     C                     SETON                     63                   S01117
     C                     ELSE                                           S01117
     C                     SETOF                     63                   S01117
     C                     END                                            S01117
     C**
     C**   If 'No. of Contracts' = 'No. of Open Contracts'
     C**                           (for Customer, + Broker if involved)
     C           NUCO      IFEQ NOCO
     C**
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     SETON                     66
     C                     ELSE
     C**
     C           NUCO      IFEQ NOBO
     C                     SETON                     66
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Access INTYP record
     C**
     C                     MOVE ISTT      KISTT
     C**
     C           KISTT     CHAININTYP                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C**   Not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '08'      DBASE            ** DBERR  08 **S01117
     C                     Z-ADD8         DBASE            ** DBERR  08 **S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELKISTT     DBKEY
     C                     EXSR DBERR
     C                     END
     C/SPACE 2
     C**   Initialise Work fields
     C**********           Z-ADDBOCO      WBOCO                                               CSD027
     C**********           Z-ADDCUSC      WCUSC                                               CSD027
     C                     MOVE BOCO      WBOCO                                               CSD027
     C                     MOVE CUSC      WCUSC                                               CSD027
     C                     Z-ADDMTHN      WMTHN
     C                     Z-ADDYRNO      WYRNO
     C                     Z-ADDSTRP      WSTRP
     C                     Z-ADDTRSD      WTRSD
     C                     Z-ADDVALD      WVALD                           073714
     C                     Z-ADDNUCO      WNUCO
     C                     Z-ADDCOPR      WCOPR
     C                     MOVE FINDET    WINDET                          073714
     C                     Z-ADDISPT      WISPT                           CPL002
     C                     Z-ADDPLSPTP    WSPTP                           CPL002
     C/COPY WNCPYSRC,FF0020C001
     C**
     C**   Mkt Instr.
     C           MTHN      IFNE 00
     C                     MOVE ISTT      SISTC
     C                     MOVE ZMNM,MTHN SMTHN
     C                     MOVE YRNO      SYRNO
     C**
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANK    SBOCO
     C                     ELSE
     C                     SETON                     14
     C                     MOVELBOCO      SBOCO
     C                     END
     C**   O.T.C.
     C                     ELSE
     C                     MOVE ISTT      SISTT
     C                     MOVE INNR      SINNR                           CPM003
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C                     MOVE UNSE      SUNSE                           CFF007
     C                     MOVE TECO      STECO                           CFF007
     C                     MOVE TNAT      STNAT                           CFF007
     C                     MOVE CRIK      SCRIK                           CFF007
     C                     MOVE CCYR      SCCYR                           CFF007
     C                     MOVE TWEI      STWEI                           CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C067
     C                     END
     C**   Common details
     C                     MOVE TRTY      STRTY
     C/COPY WNCPYSRC,FF0020C068
     C                     MOVE COVE      SCOVE                           CFF007
     C                     MOVE HETR      SHETR                           CFF007
     C                     MOVE BLUP      SBLUP                           CFF007
      *                                                                   CFF007
     C********** WCUSC     IFNE *ZEROS                                                 CFF007 CSD027
     C           WCUSC     IFNE *BLANKS                                                       CSD027
     C                     MOVELWCUSC     WWKY10    P                     CFF007
     C                     CALL 'AOCUSTR1'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           WWKY10                          CFF007
     C                     PARM           @KYST                           CFF007
     C           SDCUST    PARM SDCUST    DSLDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     MOVEL'SDCUSTPD'DBFILE                          CFF007
     C                     MOVELWCUSC     DBKEY            ************   CFF007
     C                     MOVE '*KEY   ' DBOPTN           * DBERR 39 *   CFF007
     C                     Z-ADD39        DBASE            ************   CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
     C                     MOVE BBPRBA    WCPRBA  1                       CFF007
     C                     MOVELBBCRPC    WLCRPC                                              CSD015
     C                     MOVELBBLICD    WLLICD                                              CSD015
     C                     MOVELBBCRNM    WLCRNM                                              CSD015
     C                     MOVELBBCRTN    WLCRTN                                              CSD015
     C                     MOVELCUST      WLCUST                                              CSD015
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       WCPRBA                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C********** WBOCO     IFNE *ZEROS                                                 CFF007 CSD027
     C           WBOCO     IFNE *BLANKS                                                       CSD027
     C                     MOVELWBOCO     WWKY10    P                     CFF007
     C                     CALL 'AOCUSTR1'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           WWKY10                          CFF007
     C                     PARM           @KYST                           CFF007
     C           SDCUST    PARM SDCUST    DSLDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     MOVEL'SDCUSTPD'DBFILE                          CFF007
     C                     MOVELWBOCO     DBKEY            ************   CFF007
     C                     MOVE '*KEY   ' DBOPTN           * DBERR 40 *   CFF007
     C                     Z-ADD40        DBASE            ************   CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
     C                     MOVE BBPRBA    WBPRBA  1                       CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       WBPRBA  1                       CFF007
     C                     ENDIF                                          CFF007
     C**
     C                     Z-ADD0         ZADEC   10
     C                     Z-ADD5         ZADIG   20
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE NUCO      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNUCO
     C**
     C                     MOVE PCAL      SPCAL
     C*                                                                   S01117
     C                     MOVE ORBR      SORBR                           S01117
     C                     MOVE PRFC      SPRFC                           S01117
     C*                                                                   CAC003
     C** Determine value of SBPRC, STPRC and *IN12                        CAC003
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE BPRC      SBPRC                           CAC003
     C                     MOVE TPRC      STPRC                           CAC003
     C********** CUSC      IFEQ 0                                                      CAC003 CSD027
     C           CUSC      IFEQ *BLANKS                                                       CSD027
     C                     MOVE '0'       *IN12                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE '1'       *IN12                           CAC003
     C                     ENDIF                                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01117
     C**   'Futures'
     C           ISPT      IFLE 3
     C           ISPT      OREQ 7                                         AUS022
     C                     MOVE *BLANK    SSTRP
     C                     MOVEL'0'       *IN80                           CPL002
     C                     MOVEL*BLANKS   SSPTP                           CPL002
     C**   'Options'
     C                     ELSE
     C**
     C           SMRKT     IFNE '  '
     C**   If a Market Instrument Trade, access Future Type Ref. for
     C**    Min Price Fluctn + Ticks Denom.
     C**
     C                     MOVELSMRKT     KFTRF   5
     C                     MOVE FTRF      KFTRF
     C**
     C           KFTRF     CHAININTYP2DF             71
     C  N71      RECI2     COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '09'      DBASE            ** DBERR  09 **S01117
     C                     Z-ADD9         DBASE            ** DBERR  09 **S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELKFTRF     DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C**
     C                     ELSE
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     END
     C**
     C                     Z-ADDSTRP      FFPRIC
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SSTRP
      *                                                                   CPL002
      ** If Midas-Plato module installed, format Spot Price for Output    CPL002
      ** Set indicator *IN80 if Midas-Plato Interface installed.          CPL002
      *                                                                   CPL002
     C                     MOVE '0'       *IN80                           CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
      *                                                                   CPL002
     C           SACTN     IFEQ 'I'                                       CPL002
     C                     MOVE '1'       *IN80                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SACTN     IFEQ 'E'                                       CPL002
     C           SACTN     OREQ 'D'                                       CPL002
     C           SACTN     OREQ 'A'                                       CPL002
      *                                                                   CPL002
     C           WISPT     IFGE 4                                         CPL002
     C           WISPT     ANDLE6                                         CPL002
     C           WISPT     OREQ 8                                         CPL002
     C                     MOVEL'1'       *IN80                           CPL002
     C                     Z-ADDPLSPTP    FFPRIC                          CPL002
     C                     EXSR FFPRCS                                    CPL002
     C                     MOVE FFSPRC    SSPTP                           CPL002
     C                     MOVE FFSPRC    SMSPT                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
     C**                                                                  CPL002
     C                     END
     C**
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SCOPR
     C**
     C                     MOVE TRSD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     STRSD
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C                     MOVE VALD      ZDAYNO                          CFF007
     C                     EXSR ZDATE2                                    CFF007
     C                     MOVE ZDATE     SVALD                           CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C002
     C**                                                                  073714
     C**   O T C    D E T A I L S                                         073714
     C**                                                                  073714
     C           SMRKT     IFEQ '  '                       b1             073714
     C**                                                                  073714
     C           ISPT      COMP 5                    0808  *              073714
     C**                                                                  073714
     C**   Style                                                          073714
     C                     MOVE AEIN      SAEIN                           073714
     C**                                                                  073714
     C**   Delivery & Counter Currency                                    073714
     C                     MOVE OTHC      SDCCY                           073714
     C           ISPT      IFEQ 5                          b2             073714
     C                     MOVE CTCY      SCTCY                           073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**   Delivery Currency Decimal Places                               073714
     C                     MOVE SDCCY     FFCCY                           073714
     C           FFCCY     IFEQ *BLANKS                                   111204
     C                     MOVE ISCY      FFCCY                           111204
     C                     MOVE ISCY      SDCCY                           111607
     C                     END                                            111204
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b2             073714
     C           *LOCK     IN   LDA                                       073714
     C                     MOVE '30'      DBASE            ** DBERR  30 **073714
     C                     MOVELFFCKY     DBKEY                           073714
     C                     MOVE 'TABFF'   DBFILE                          073714
     C                     EXSR DBERR                                     073714
     C                     END                             e2             073714
     C                     Z-ADDFFCDP     DCDP                            073714
     C**                                                                  073714
     C**   Counter Currency Decimal Places                                073714
     C           ISPT      IFEQ 5                          b2             073714
     C                     MOVE SCTCY     FFCCY                           073714
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b3             073714
     C           *LOCK     IN   LDA                                       073714
     C                     MOVE '31'      DBASE            ** DBERR  31 **073714
     C                     MOVELFFCKY     DBKEY                           073714
     C                     MOVE 'TABFF'   DBFILE                          073714
     C                     EXSR DBERR                                     073714
     C                     END                             e3             073714
     C                     Z-ADDFFCDP     CCDP                            073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**   Delivery (Contingent) Amount                                   073714
     C                     Z-ADDDCDP      ZADEC                           073714
     C           13        SUB  DCDP      ZADIG                           073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE FFCTAM    ZFIELD                          073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SCTAM                           073714
     C**                                                                  073714
     C**   Counter Currency Amount                                        073714
     C           ISPT      IFEQ 5                          b2             073714
     C                     Z-ADDCCDP      ZADEC                           073714
     C           13        SUB  CCDP      ZADIG                           073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE CCAM      ZFIELD                          073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SCCAM                           073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**   Premium Currency                                               073714
     C                     MOVE ISCY      SISCY                           073714
     C**                                                                  073714
     C**   Premium Currency Decimal Places                                073714
     C                     MOVE SISCY     FFCCY                           073714
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b2             073714
     C           *LOCK     IN   LDA                                       073714
     C                     MOVE '32'      DBASE            ** DBERR  32 **073714
     C                     MOVELFFCKY     DBKEY                           073714
     C                     MOVE 'TABFF'   DBFILE                          073714
     C                     EXSR DBERR                                     073714
     C                     END                             e2             073714
     C                     Z-ADDFFCDP     PCDP                            073714
     C**                                                                  073714
     C**   Premium up Front                                               073714
     C                     MOVE PUPF      SPUPF                           073714
     C**                                                                  073714
     C**   Quotation Convention                                           073714
     C           ISPT      IFEQ 5                          b2             073714
     C           QOTC      IFLT 0                          b3             073714
     C                     Z-SUBQOTC      Z010                            073714
     C                     MOVE Z010      SQOTC                           073714
     C                     MOVEL'-'       SQOTC                           073714
     C                     ELSE                            X3             073714
     C                     Z-ADDQOTC      Z010                            073714
     C                     MOVE Z010      SQOTC                           073714
     C                     MOVEL' '       SQOTC                           073714
     C                     END                             e3             073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**   Value Date                                                     073714
     C                     MOVE VALD      ZDAYNO                          073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZDATE     SVALD                           073714
     C**                                                                  073714
     C**   Expiry (Final Transaction) Date                                073714
     C                     MOVE FTDT      ZDAYNO                          073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZDATE     SFTDT                           073714
     C**                                                                  073714
     C**   Expiry (Final Transaction) Time                                073714
     C                     MOVE FTTM      SFTTM                           073714
     C**                                                                  073714
     C**   Settlement Date                                                073714
     C                     MOVE SETD      ZDAYNO                          073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZDATE     SSETD                           073714
     C**                                                                  073714
     C**   Commodity Ref                                                  073714
     C                     MOVE CMRF      SCMRF                           073714
     C**                                                                  073714
     C           ISPT      IFNE 5                          b2             073714
     C**                                                                  073714
     C**   Tick Value                                                     073714
     C                     Z-ADDTKVL      Z152   152H                     073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE Z152      ZFIELD                          073714
     C           PCDP      ADD  2         ZADEC                           073714
     C           10        SUB  ZADEC     ZADIG                           073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    STKVL                           073714
     C**                                                                  073714
     C**   Minimum Price Fluctuation                                      073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE MNPF      ZFIELD                          073714
     C/COPY WNCPYSRC,FF0020CR64
     C***********          Z-ADD7         ZADEC                     073714CFF004
     C***********          Z-ADD3         ZADIG                     073714CFF004
     C                     Z-ADD8         ZADEC                           CFF004
     C                     Z-ADD6         ZADIG                           CFF004
     C/COPY WNCPYSRC,FF0020CR65
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SMNPF                           073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**   Calculate Premium For Display                                  073714
     C                     EXSR CPRMD                                     073714
     C**                                                                  073714
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           ISPT      ANDEQ4                                         CPL002
     C           SACTN     ANDNE'D'                                       CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           ISPT      ANDEQ6                                         CPL002
     C           SACTN     ANDNE'D'                                       CPL002
      *                                                                   CPL002
      ** Translate record details from file layout to screen layout       CPL002
      *                                                                   CPL002
     C                     EXSR TRSFS2                                    CPL002
     C                     ENDIF                                          CPL002
     C                     END                             e1             073714
     C**
     C********** CUSC      IFEQ 0                                                             CSD027
     C           CUSC      IFEQ *BLANKS                                                       CSD027
     C                     MOVE *BLANK    SCUSC
     C                     ELSE
     C                     SETON                     15
     C                     MOVELCUSC      SCUSC
     C                     END
     C**
     C                     MOVE BOKC      SBOKC
     C***********          MOVE BRCD      SBRCD                           S01117
     C                     MOVE BRCA      SBRCD                           S01117
     C                     MOVE TNAR      STNAR
     C                     MOVE TBLO      STBLO
     C**
     C           LNKR      IFEQ 0
     C                     MOVE *BLANK    SLNKR
     C                     ELSE
     C                     MOVE LNKR      SLNKR
     C                     END
     C* MOVE IN PORTFOLIO REFERENCE, CONVERTING '9997' IF NECESSARY       S01235
     C           BGPFMG    IFEQ 'Y'                                       CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           PTFR      ANDNE*BLANKS                                   S01235
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PTFR      ANDNE*BLANKS                                   CPB001
     C           PTFR      IFNE '9997'                                    S01235
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVELPTFR      SPTFR                           S01235
     C                     ELSE                                           S01235
     C                     MOVE FCR997    SPTFR                           CPM003
     C                     END                                            S01235
     C                     ELSE                                           S01235
     C                     MOVE *BLANKS   SPTFR                           S01235
     C                     END                                            S01235
     C/SPACE 2
     C**   Determine  Instrument Currency  dec. places
     C**
     C                     MOVE KCCY      FFCCY   3
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP
     C                     MOVE WIN84     *IN84                           CFF007
     C**
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '10'      DBASE            ** DBERR  10 **S01117
     C                     Z-ADD10        DBASE            ** DBERR  10 **S01117
     C                     MOVELFFCKY     DBKEY
     C                     MOVE 'TABFF'   DBFILE
     C                     EXSR DBERR
     C                     END
     C**
     C                     Z-ADDFFCDP     ZADEC
     C           13        SUB  FFCDP     ZADIG
     C/SPACE 2
     C**   Access TRSETIN record
     C**
     C           KTNBR     CHAINTRSETIN              71
     C  N71N72   RECI      COMP 'D'                  7171
     C**
     C**   Not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '11'      DBASE            ** DBERR  11 **S01117
     C                     Z-ADD11        DBASE            ** DBERR  11 **S01117
     C                     MOVE 'TRSET'   DBFILE
     C                     MOVELKTNBR     DBKEY
     C                     EXSR DBERR
     C                     END
     C/SPACE 2
     C**   Initialise  Broker  Settlement Instructions
     C**
     C           *IN14     IFEQ '1'
     C**
     C           BCMC      IFNE 0
     C                     MOVE BCMC      SBCMC
     C                     END
     C**
     C           BCMA      IFEQ 0
     C**
     C           BCPT      IFEQ 'A'
     C                     MOVEL'A'       SBCMA
     C                     END
     C**
     C                     ELSE
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE BCMA      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBCMA
     C                     END
     C**
     C           BCMS      IFNE 0
     C                     MOVE BCMS      SBCMS
     C                     END
     C**
     C           BCHC      IFNE 0
     C                     MOVE BCHC      SBCHC
     C                     END
     C**
     C           BCHA      IFNE 0
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE BCHA      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBCHA
     C                     END
     C**
     C           BMAR      IFEQ 0
     C                     MOVE *BLANK    SBMAR
     C**
     C                     ELSE
     C**
     C           BMAR      IFEQ -1
     C                     Z-ADD0         XBMAR  130
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE XBMAR     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBMAR
     C**
     C                     ELSE
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE BMAR      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SBMAR
     C                     END
     C**
     C                     END
     C**
     C                     MOVE BSLT      SBSLT
     C**
     C           BSLT      IFEQ 04
     C           BSLT      OREQ 06
     C           BSLT      OREQ 15
     C                     MOVE *BLANK    SBSLA
     C                     MOVE *BLANK    SBSBR                           S01117
     C                     ELSE
     C                     MOVE BSLA      SBSLA
     C                     MOVE BSBR      SBSBR                           S01117
     C                     END
     C**
     C                     MOVE BFAO      SBFAO
     C                     MOVELBCPN      SBCPN
     C**
     C                     END
     C/SPACE 2
     C**   Initialise  Customer Settlement Instructions
     C**
     C           *IN15     IFEQ '1'
     C**
     C           CCMC      IFNE 0
     C                     MOVE CCMC      SCCMC
     C                     END
     C**
     C           CCMA      IFEQ 0
     C**
     C           CCPT      IFEQ 'A'
     C                     MOVEL'A'       SCCMA
     C                     END
     C**
     C                     ELSE
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE CCMA      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SCCMA
     C                     END
     C**
     C           CCMS      IFNE 0
     C                     MOVE CCMS      SCCMS
     C                     END
     C**
     C           CCHC      IFNE 0
     C                     MOVE CCHC      SCCHC
     C                     END
     C**
     C           CCHA      IFNE 0
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE CCHA      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SCCHA
     C                     END
     C**
     C           CMAR      IFEQ 0
     C                     MOVE *BLANK    SCMAR
     C**
     C                     ELSE
     C**
     C           CMAR      IFEQ -1
     C                     Z-ADD0         XCMAR  130
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE XCMAR     ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SCMAR
     C**
     C                     ELSE
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE CMAR      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SCMAR
     C                     END
     C**
     C                     END
     C**
     C                     MOVE CSLT      SCSLT
     C**
     C           CSLT      IFEQ 04
     C           CSLT      OREQ 06
     C           CSLT      OREQ 15
     C                     MOVE *BLANK    SCSLA
     C                     MOVE *BLANK    SBRSC                           S01117
     C                     ELSE
     C                     MOVE CSLA      SCSLA
     C                     MOVE BRSC      SBRSC                           S01117
     C                     END
     C**
     C                     MOVE CFAO      SCFAO
     C                     MOVELCCPN      SCCPN
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   RSTINS SR. -  Reset processing for Insert                     *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           RSTINS    BEGSR                           ** RSTINS SR **
     C**
     C                     SETOF                     18
     C                     SETOF                     19                   S01117
     C                     Z-ADD0         E       20
     C                     MOVE *BLANK    ERR
     C                     Z-ADD0         F       10
     C                     MOVE *BLANK    WERR
     C**
     C                     SETOF                     1011
     C                     SETOF                     131415
     C                     SETOF                     7879                 S01117
     C                     SETOF                     76                   CPM003
     C                     MOVE '0'       *IN67                           CAC003
     C                     MOVEA'0'       *IN,39                          S01117
     C                     MOVEA'00000'   *IN,40
     C                     MOVEA'00000'   *IN,45
     C                     MOVEA'00000'   *IN,50
     C                     MOVEA'00000'   *IN,55
     C                     MOVEA'0'       *IN,60                          S01117
     C                     MOVEA'0'       *IN,83                          CPL002
     C                     MOVEA'0000'    *IN,85                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVEA'00'      *IN,73                          CFF007
     C                     MOVE '0'       *IN84                           CFF007
     C**
     C           *INKL     IFNE '1'
     C                     MOVE *BLANK    SMIODS
     C                     MOVE *BLANK    SMPIDS                          CPL002
     C***********          MOVE '    1'   SNUCO                    073714 125868
     C                     MOVE 'N'       STBLO
     C**
     C***********MBIN      IFEQ 'N'                                       S01117
     C***********          MOVE PDFBR     SBRCD                           S01117
     C***********          END                                            S01117
     C***********                                                  S01117 E36432
     C*****Set*up*Booking*branch*and*Originating*Branch*IF*NOT*F12 S01117 E36432
     C***********                                                  S01117 E36432
     C***********          MOVE PDFBR     SBRCD                    S01117 E36432
     C***********          MOVE PDFBR     SORBR                    S01117 E36432
     C**
     C                     END
     C**
     C                     MOVE *BLANK    SSETDS
     C**
     C                     MOVE *ZEROS    WMIODS
     C                     MOVE *ZEROS    WSETDS
     C                     MOVE *ZEROS    WINDET                          073714
     C           *IN08     IFEQ '1'                                       102892
     C                     MOVE *BLANKS   WINDET                          102892
     C                     END                                            102892
     C**
     C                     MOVE *BLANK    XSMIO
     C                     MOVE *BLANK    XBCCPT
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   RSTADE SR. -  Reset processing for Amend/Delete/Enquire       *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                                                *
     C**       SR. ADEOTC                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           RSTADE    BEGSR                           ** RSTADE SR **
     C**
     C                     SETOF                     18
     C                     Z-ADD0         E
     C                     MOVE *BLANK    ERR
     C                     Z-ADD0         F
     C                     MOVE *BLANK    WERR
     C**
     C                     SETOF                     1011
     C                     SETOF                     131415
     C                     SETOF                     243031
     C                     SETOF                     3637
     C                     MOVE '0'       *IN67                           CAC003
     C* IF PORTFOLIO PROTECT FIELD HAD BEEN SET ON IN SR VPTFR BECAUSE THES01235
     C* USER TRIED TO AMEND A TRADE INPUT IN THE PAST, RESET INDICATOR    S01235
     C* FOR THE NEXT TRANSACTION. ALSO RESET THE ERROR FIELD INDICATOR.   S01235
     C                     MOVE '0'       *IN16                           S01235
     C           BGPFMG    IFEQ 'Y'                                       S01235
     C           FCPORS    ANDNE'B'                                       CPM003
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     MOVE '0'       *IN17                           S01235
     C                     END                                            S01235
     C                     SETOF                     7879                 S01117
     C/COPY WNCPYSRC,FF0020C003
     C                     MOVEA'0'       *IN,39                          S01117
     C                     MOVEA'00000'   *IN,40
     C                     MOVEA'00000'   *IN,45
     C                     MOVEA'00000'   *IN,50
     C                     MOVEA'00000'   *IN,55
     C                     MOVEA'0'       *IN,60                          S01117
     C                     MOVEA'0'       *IN,83                          CPL002
     C                     MOVEA'0000'    *IN,85                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVEA'00'      *IN,73                          CFF007
     C                     MOVE '0'       *IN84                           CFF007
     C                     SETOF                     656672
     C**
     C                     MOVE *BLANK    SMIODS
     C                     MOVE *BLANK    SSETDS
     C                     MOVE *BLANK    SMPIDS                          CPL002
     C**
     C                     MOVE *ZEROS    WMIODS
     C                     MOVE *ZEROS    WSETDS
     C                     MOVE *ZEROS    WINDET                          073714
     C           *IN08     IFEQ '1'                                       102892
     C                     MOVE *BLANKS   WINDET                          102892
     C                     END                                            102892
     C**
     C                     MOVE *BLANK    XSMIO
     C                     MOVE *BLANK    XSSET
     C                     MOVE *BLANK    XBCCPT
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VINSRT SR. -  Validate  Insert details Control                *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSMKI                   SR. VTNBR                    *
     C**       SR. INSOTC                   SR. VNUCO                    *
     C**                                    SR. VMKI                     *
     C**                                    SR. VYRMTH                   *
     C**                                    SR. VOTC                     *
     C**                                    SR. VPCAL                    *
     C**                                    SR. VSTRP                    *
     C**                                    SR. VCOPR                    *
     C**************************************SR.*VTRSD*********************S01117
     C**                                    SR. VBOCO                    *
     C**                                    SR. VCUSC                    *
     C**                                    SR. VBOKC                    *
     C**                                    SR. VBRCD                    *
     C**                                    SR. VTRSD                    *S01117
     C**                                    SR. VTBLO                    *
     C**                                    SR. VLNKR                    *
     C**                                    SR. VORBR                    *S01117
     C**                                                                 *
     C********************************************************************
     C**
     C           VINSRT    BEGSR                           ** VINSRT SR **
     C**
     C**   Reset Processing
     C                     MOVEA'00000000'*IN,23
     C                     MOVEA'00000000'*IN,31
     C                     MOVEA'00000000'*IN,39                          073714
     C                     MOVEA'000'     *IN,47                          073714
     C                     MOVEA'0'       *IN,78                          S01117
     C                     MOVEA'0'       *IN,83                          CPL002
     C                     MOVEA'0000'    *IN,85                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVEA'00'      *IN,73                          CFF007
     C                     MOVE '0'       *IN84                           CFF007
     C/COPY WNCPYSRC,FF0020C004
     C           SBRCD     IFEQ *BLANKS                                   059376
     C                     MOVELPDFBR     SBRCD                           059376
     C                     END                                            059376
     C**
     C**   If Warning Errors only + screen unchanged - bypass validation
     C           *IN18     IFEQ '0'
     C           *IN19     ANDEQ'1'
     C           SMIODS    ANDEQXSMIO
     C                     SETOF                     19
     C                     GOTO VINSED
     C                     END
     C**   Validate
     C**   ~~~~~~~~
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP50                                           S01408
      *                                                                   S01408
     C                     MOVE *ZEROS    WMIODS
     C**
     C**   Transaction Reference
     C**   & SPF Checking                                                 S01117
     C**                                                                  S01117
     C                     EXSR VTNBR
     C**
     C**   Purchase or Sale
     C           STRTY     IFNE 'P'
     C           STRTY     ANDNE'S'
     C           E         ADD  1         E
     C                     MOVE ' 031'    ERR,E
     C                     SETON                     1823
     C                     END
     C**
     C**   No. of Contracts
     C                     EXSR VNUCO
     C**
     C**   Market Instrument
     C           SMRKT     IFNE '  '
     C                     EXSR VMKI
     C**   - Year / Month
     C                     EXSR VYRMTH
     C**
     C                     ELSE
     C**   O.T.C. Type
     C                     EXSR VOTC
     C**   O.T.C. Instrument Details                                      073714
     C  N25                EXSR VOTCD                                     073714
     C                     END
     C**
     C           *IN25     IFEQ '0'
     C**   PM Instrument Type                                             CPM003
     C                     MOVE INNR      KINNR   3                       CPM003
     C**   Save Instr Ccy
     C                     MOVE ISCY      KCCY
     C**   Put/Call
     C                     EXSR VPCAL
     C**   Strike Price
     C                     EXSR VSTRP
     C**   Contract Price
     C                     EXSR VCOPR
      *                                                                   CPL002
      ** If Midas-Plato installed, validate Spot Price.                   CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           SMRKT     ANDNE'  '                                      CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           SMRKT     ANDEQ'  '                                      CPL002
     C           SISPT     ANDEQ'5'
     C                     MOVEL'1'       *IN80                           CPL002
     C                     EXSR VSPTP                                     CPL002
     C                     ELSE                                           CPL002
     C                     MOVEL'0'       *IN80                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ELSE                                           CPM003
     C                     MOVEL'1'       *IN80                           CPL002
     C                     MOVE *BLANKS   KINNR                           CPM003
     C                     END
     C***********                                                         S01117
     C*****Transaction*Date***********************************************S01117
     C***********          EXSR VTRSD                                     S01117
     C**
     C**   Reset Broker/Customer inds.
     C                     SETOF                     1415
     C**   Broker
     C           SMRKT     IFNE '  '
     C**   (An '*           ' confirms that no broker is reqd,
     C**     and therefore no validation.)
     C           SBOCO1    IFNE '*'
     C                     EXSR VBOCO
     C                     ELSE
     C           SBOCO2    IFNE *BLANK
     C                     EXSR VBOCO
     C                     END
     C                     END
     C**
     C                     END
     C**   Customer
     C                     EXSR VCUSC
     C**   Book
     C                     EXSR VBOKC
     C**   Branch
     C***********MBIN      IFEQ 'Y'                                       S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     EXSR VBRCD
     C                     ELSE
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 303'    ERR,E                           S01117
     C                     SETON                     1820                 S01117
     C                     END                                            S01117
     C***********          Z-ADD01        FFDASQ                          S01117
     C                     END
     C*                                                                   S01117
     C**   Transaction Date                                               S01117
     C**   This SR. has been moved to a place after the validation of     S01117
     C**   booking branch because it has to access sdbrchpd to look for   S01117
     C**   the location code of the booking branch                        S01117
     C*                                                                   S01117
     C                     EXSR VTRSD                                     S01117
     C/COPY WNCPYSRC,FF0020C005
     C**                                                                  073714
     C           CFF007    IFEQ 'N'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C**   If OTC                                                         073714
     C********** SMRKT     IFEQ '  '                               073714 CFF007
     C**                                                                  073714
     C**   Validate Value Date                                            073714
     C                     EXSR VVALD                                     073714
     C**                                                                  073714
     C**   Calculate Premium For Display                                  073714
     C                     EXSR CPRMD                                     073714
     C**********           END                                     073714 CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
      ** Validate Value Date                                              CFF007
      *                                                                   CFF007
     C                     EXSR VVDAT                                     CFF007
      *                                                                   CFF007
      ** Calculate Premium For Display                                    CFF007
      *                                                                   CFF007
     C                     EXSR CPRMD                                     CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C006
     C**
     C**   To Be Left Open Ind ?
     C                     EXSR VTBLO
     C**
     C**   Linked Reference
     C           SLNKR     IFNE *BLANK
     C                     EXSR VLNKR
     C                     END
     C**                                                                  S01117
     C**   Originating Branch                                             S01117
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C           OBUU      ANDEQ'Y'                                       S01117
     C                     EXSR VORBR                                     S01117
     C                     END                                            S01117
     C**                                                                  S01235
     C**   PORTFOLIO REFERENCE                                            S01235
     C                     EXSR VPTFR                                     S01235
      *                                                                   CFF007
      ** Private banking fields                                           CFF007
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C                     EXSR VPBFL                                     CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C069
     C/SPACE 2
      *                                                                   148384
      ** If no errors (yet), but redisplay reqd, force an error           148384
     C           *IN18     IFEQ *OFF                                      148384
     C           *IN19     ANDEQ*OFF                                      148384
     C           WRDSPS    ANDEQ'Y'                                       148384
     C                     MOVEL*ON       *IN18                           148384
     C                     MOVEL'N'       WRDSPS                          148384
     C                     END                                            148384
     C**   If Warning Errors
     C           *IN19     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVEAWERR      ERR,E
     C**
     C**   - warning errors only, save screen
     C           *IN18     IFEQ '0'
     C***********          MOVE SMIODS    XSMIO 113                       S01117
     C***********          MOVE SMIODS    XSMIO 116                S01117 073714
     C***********          MOVE SMIODS    XSMIO 228                073714 S01235
     C/COPY WNCPYSRC,FF0020CR66
     C***********          MOVE SMIODS    XSMIO 232                 S01235CFF004
      ** XSMIO Redefined as Data Structure as max. field size is 256      CFF004
     C                     MOVE SMIODS    XSMIO                           CFF004
     C/COPY WNCPYSRC,FF0020CR67
     C                     END
     C**
     C                     END
     C**
     C           VINSED    ENDSR                           *** VINSED ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************148384
     C**                                                                 *148384
     C**   IOTCST SR. -  Insert    Default Instrument fields             *148384
     C**   ~~~~~~~~~~                                                    *148384
     C**      Called From                  Calls                         *148384
     C**       SR. INSOTC                   SR. FFSTDP                   *148384
     C**                                    SR. ZEDIT                    *148384
     C**                                    SR. ZDATE2                   *148384
     C**                                                                 *148384
     C********************************************************************148384
     C**                                                                  148384
     C           IOTCST    BEGSR                           ** IOTCST SR **148384
     C**                                                                  148384
     C**   Access INTYP record and default Detail if change in OTC Type   148384
     C**                                                                  148384
     C           *LIKE     DEFN SISTT     ##STT                           148384
      *                                                                   148384
      ** Redisplay populated screen indicator starts as "No"              148384
     C                     MOVEL'N'       WRDSPS  1                       148384
     C                     MOVEL*BLANKS   WOSCRN 32                       148384
     C                     MOVEL*BLANKS   WNSCRN 32                       148384
     C**                                                                  148384
     C           SISTT     IFNE ##STT                                     148384
     C**                                                                  148384
     C                     MOVE SISTT     ##STT                           148384
     C                     MOVE SISTT     KISTT                           148384
     C**                                                                  148384
     C           KISTT     CHAININTYP                71                   148384
     C  N71      RECI      COMP 'D'                  7171                 148384
     C**                                                                  148384
     C**   If Found                                                       148384
     C           *IN71     IFEQ '0'                                       148384
     C**                                                                  148384
     C** Update Details                                                   148384
     C** (Screen should be redisplayed if a screen field has changed)     148384
     C**                                                                  148384
     C                     MOVELSISTT     WOSCRN    P                     148384
     C                     MOVE ISTT      SISTT                           148384
     C                     MOVELSISTT     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     MOVELSINNR     WOSCRN    P                     148384
     C           SINNR     IFEQ *BLANKS                                   CFF007
     C                     MOVE INNR      SINNR                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSINNR     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     MOVELSORBR     WOSCRN    P                     148384
     C           SORBR     IFEQ *BLANKS                                   CFF007
     C                     MOVE ORBR      SORBR                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSORBR     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C           ISPT      COMP 5                    0808  *              148384
     C**                                                                  148384
     C**   Style                                                          148384
     C                     MOVELSAEIN     WOSCRN    P                     148384
     C           SAEIN     IFEQ *BLANKS                                   CFF007
     C                     MOVE AEIN      SAEIN                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSAEIN     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Delivery & Counter Currency                                    148384
     C                     MOVELSDCCY     WOSCRN    P                     148384
     C           SDCCY     IFEQ *BLANKS                                   CFF007
     C                     MOVE OTHC      SDCCY                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSDCCY     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C           ISPT      IFEQ 5                          b2             148384
     C                     MOVELSCTCY     WOSCRN    P                     148384
     C           SCTCY     IFEQ *BLANKS                                   CFF007
     C                     MOVE CTCY      SCTCY                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSCTCY     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     END                             e2             148384
     C**                                                                  148384
     C**   Delivery Currency Decimal Places                               148384
     C                     MOVE SDCCY     FFCCY                           148384
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    148384
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b2             148384
     C           *LOCK     IN   LDA                                       148384
     C                     MOVE '40'      DBASE            ** DBERR  40 **148384
     C                     MOVELFFCKY     DBKEY                           148384
     C                     MOVE 'TABFF'   DBFILE                          148384
     C                     EXSR DBERR                                     148384
     C                     END                             e2             148384
     C                     Z-ADDFFCDP     DCDP                            148384
     C**                                                                  148384
     C**   Counter Currency Decimal Places                                148384
     C           ISPT      IFEQ 5                          b2             148384
     C                     MOVE SCTCY     FFCCY                           148384
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    148384
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b3             148384
     C           *LOCK     IN   LDA                                       148384
     C                     MOVE '41'      DBASE            ** DBERR  41 **148384
     C                     MOVELFFCKY     DBKEY                           148384
     C                     MOVE 'TABFF'   DBFILE                          148384
     C                     EXSR DBERR                                     148384
     C                     END                             e3             148384
     C                     Z-ADDFFCDP     CCDP                            148384
     C                     END                             e2             148384
     C**                                                                  148384
     C**   Delivery (Contingent) Amount                                   148384
     C                     Z-ADDDCDP      ZADEC                           148384
     C           13        SUB  DCDP      ZADIG                           148384
     C                     MOVEL*BLANK    ZFIELD                          148384
     C                     MOVE FFCTAM    ZFIELD                          148384
     C                     EXSR ZEDIT                                     148384
     C                     MOVELSCTAM     WOSCRN    P                     148384
     C           SCTAM     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZFIELD    SCTAM                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSCTAM     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Counter Currency Amount                                        148384
     C           ISPT      IFEQ 5                          b2             148384
     C                     Z-ADDCCDP      ZADEC                           148384
     C           13        SUB  CCDP      ZADIG                           148384
     C                     MOVEL*BLANK    ZFIELD                          148384
     C                     MOVE CCAM      ZFIELD                          148384
     C                     EXSR ZEDIT                                     148384
     C                     MOVELSCCAM     WOSCRN    P                     148384
     C           SCCAM     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZFIELD    SCCAM                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSCCAM     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     END                             e2             148384
     C****                                                                148384
     C**                                                                  148384
     C**   Exchange Rate (The following code will calculate Strike        148384
     C**                  Price - but is not consistant due to lack of    148384
     C**                  validation of the Price)                        148384
     C**                                                                  148384
     C****       ISPT      IFEQ 5                          b2             148384
     C****       CCAM      IFNE *ZERO                                     148384
     C****       FFCTAM    DIV  CCAM      FFPRIC    H                     148384
     C****                 Z-ADDTKDM      FFTKDM                          148384
     C****                 Z-ADDMNPF      FFMNPF                          148384
     C****                 EXSR FFPRCS                                    148384
     C****                 MOVE FFSPRC    SSTRP                           148384
     C****                 ELSE                                           148384
     C****                 MOVE *BLANKS   SSTRP                           148384
     C****                 ENDIF                                          148384
     C****                 ENDIF                           e2             148384
     C**                                                                  148384
     C**   Premium Currency                                               148384
     C                     MOVELSISCY     WOSCRN    P                     148384
     C           SISCY     IFEQ *BLANKS                                   CFF007
     C                     MOVE ISCY      SISCY                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSISCY     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Premium Currency Decimal Places                                148384
     C                     MOVE SISCY     FFCCY                           148384
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    148384
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                        b2             148384
     C           *LOCK     IN   LDA                                       148384
     C                     MOVE '42'      DBASE            ** DBERR  42 **148384
     C                     MOVELFFCKY     DBKEY                           148384
     C                     MOVE 'TABFF'   DBFILE                          148384
     C                     EXSR DBERR                                     148384
     C                     END                             e2             148384
     C                     Z-ADDFFCDP     PCDP                            148384
     C**                                                                  148384
     C**   Premium up Front                                               148384
     C                     MOVELSPUPF     WOSCRN    P                     148384
     C           SPUPF     IFEQ *BLANKS                                   CFF007
     C                     MOVE PUPF      SPUPF                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSPUPF     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Quotation Convention                                           148384
     C           ISPT      IFEQ 5                          b2             148384
     C                     MOVELSQOTC     WOSCRN    P                     148384
     C           SQOTC     IFEQ *BLANKS                                   CFF007
     C           QOTC      IFLT 0                          b3             148384
     C                     Z-SUBQOTC      Z010                            148384
     C                     MOVE Z010      SQOTC                           148384
     C                     MOVEL'-'       SQOTC                           148384
     C                     ELSE                            X3             148384
     C                     Z-ADDQOTC      Z010                            148384
     C                     MOVE Z010      SQOTC                           148384
     C                     MOVEL' '       SQOTC                           148384
     C                     END                             e3             148384
     C                     ENDIF                                          CFF007
     C                     MOVELSQOTC     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     END                             e2             148384
     C**                                                                  148384
     C**   Expiry (Final Transaction) Date                                148384
     C                     MOVE FTDT      ZDAYNO                          148384
     C                     EXSR ZDATE2                                    148384
     C                     MOVELSFTDT     WOSCRN    P                     148384
     C           SFTDT     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZDATE     SFTDT                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSFTDT     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Expiry (Final Transaction) Time                                148384
     C                     MOVELSFTTM     WOSCRN    P                     148384
     C           SFTTM     IFEQ *BLANKS                                   CFF007
     C                     MOVE FTTM      SFTTM                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSFTTM     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Settlement Date                                                148384
     C                     MOVE SETD      ZDAYNO                          148384
     C                     EXSR ZDATE2                                    148384
     C                     MOVELSSETD     WOSCRN    P                     148384
     C           SSETD     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZDATE     SSETD                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSSETD     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Commodity Ref                                                  148384
     C                     MOVELSCMRF     WOSCRN    P                     148384
     C           SCMRF     IFEQ *BLANKS                                   CFF007
     C                     MOVE CMRF      SCMRF                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSCMRF     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C           ISPT      IFNE 5                          b2             148384
     C**                                                                  148384
     C**   Tick Value                                                     148384
     C                     Z-ADDTKVL      Z152   152H                     148384
     C                     MOVEL*BLANK    ZFIELD                          148384
     C                     MOVE Z152      ZFIELD                          148384
     C           PCDP      ADD  2         ZADEC                           148384
     C           10        SUB  ZADEC     ZADIG                           148384
     C                     EXSR ZEDIT                                     148384
     C                     MOVELSTKVL     WOSCRN    P                     148384
     C           STKVL     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZFIELD    STKVL                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSTKVL     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C**                                                                  148384
     C**   Minimum Price Fluctuation                                      148384
     C                     MOVEL*BLANK    ZFIELD                          148384
     C                     MOVE MNPF      ZFIELD                          148384
     C                     Z-ADD7         ZADEC                           148384
     C                     Z-ADD3         ZADIG                           148384
     C                     EXSR ZEDIT                                     148384
     C                     MOVELSMNPF     WOSCRN    P                     148384
     C           SMNPF     IFEQ *BLANKS                                   CFF007
     C                     MOVE ZFIELD    SMNPF                           148384
     C                     ENDIF                                          CFF007
     C                     MOVELSMNPF     WNSCRN    P                     148384
     C           WOSCRN    IFNE WNSCRN                                    148384
     C           WOSCRN    ANDNE*BLANKS                                   148384
     C                     MOVEL'Y'       WRDSPS                          148384
     C                     END                                            148384
     C                     END                             e2             148384
      *                                                                   CFF007
      ** If PB Module is switched on and CFF007 is installed              CFF007
      *                                                                   CFF007
     C           BGN4ST    IFEQ 'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
      ** Underlying Security                                              CFF007
      *                                                                   CFF007
     C                     MOVELSUNSE     WOSCRN    P                     CFF007
     C           SUNSE     IFEQ *BLANKS                                   CFF007
     C                     MOVE UNSE      SUNSE                           CFF007
     C           UNSE      IFNE *BLANKS                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVELSUNSE     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Economic Sector                                                  CFF007
      *                                                                   CFF007
     C                     MOVELSTECO     WOSCRN    P                     CFF007
     C           STECO     IFEQ *BLANKS                                   CFF007
     C                     MOVE TECO      STECO                           CFF007
     C           TECO      IFNE *BLANKS                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVELSTECO     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Nature Code                                                      CFF007
      *                                                                   CFF007
     C                     MOVELSTNAT     WOSCRN    P                     CFF007
     C           STNAT     IFEQ *BLANKS                                   CFF007
     C                     MOVE TNAT      STNAT                           CFF007
     C           TNAT      IFNE *BLANKS                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVELSTNAT     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Country of Risk                                                  CFF007
      *                                                                   CFF007
     C                     MOVELSCRIK     WOSCRN    P                     CFF007
     C           SCRIK     IFEQ *BLANKS                                   CFF007
     C                     MOVE CRIK      SCRIK                           CFF007
     C           CRIK      IFNE *BLANKS                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVELSCRIK     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Currency of Risk                                                 CFF007
      *                                                                   CFF007
     C                     MOVELSCCYR     WOSCRN    P                     CFF007
     C           SCCYR     IFEQ *BLANKS                                   CFF007
     C                     MOVE CCYR      SCCYR                           CFF007
     C           CCYR      IFNE *BLANKS                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVELSCCYR     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Weighting Code                                                   CFF007
      *                                                                   CFF007
     C                     MOVELSTWEI     WOSCRN    P                     CFF007
     C           STWEI     IFEQ *BLANKS                                   CFF007
     C           TWEI      IFEQ *ZEROS                                    CFF007
     C                     MOVE *BLANKS   STWEI                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE TWEI      STWEI                           CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     MOVELSTWEI     WNSCRN    P                     CFF007
     C           WOSCRN    IFNE WNSCRN                                    CFF007
     C           WOSCRN    ANDNE*BLANKS                                   CFF007
     C                     MOVEL'Y'       WRDSPS                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C**                                                                  148384
     C                     ENDIF                            INTPY Found   148384
     C                     ENDIF                            INTPY Chg     148384
     C**                                                                  148384
     C           IOTCSF    ENDSR                           *** IOTCST *** 148384
     C**        ~~~~~~~~                                                  148384
     C**                                                                  148384
     C********************************************************************148384
     C/EJECT                                                              148384
     C********************************************************************
     C**                                                                 *
     C**   VINSET SR. -  Validate  Insert Settlement Instructions Control*
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                   SR. VXCHCM                   *
     C**                                    SR. VXMAR                    *
     C**                                    SR. VXSET                    *
     C**                                    SR. VPRFC                    *S01117
     C**                                                                 *
     C********************************************************************
     C**
     C           VINSET    BEGSR                           ** VINSET SR **
     C**
     C**   Reset Processing
     C                     SETOF                     18
     C                     Z-ADD0         E
     C                     MOVE *BLANK    ERR
     C                     Z-ADD0         F                               CPM003
     C                     MOVE *BLANK    WERR                            CPM003
     C                     MOVEA'0'       *IN,39                          S01117
     C                     MOVEA'00000'   *IN,40
     C                     MOVEA'00000'   *IN,45
     C                     MOVEA'00000'   *IN,50
     C                     MOVEA'00000'   *IN,55
     C                     MOVEA'0'       *IN,60                          S01117
     C                     MOVE '0'       *IN67                           CAC003
     C                     MOVEA'0'       *IN,79                          S01117
     C                     MOVEA'0'       *IN,76                          CPM003
     C                     MOVEA'0000'    *IN,85                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVEA'00'      *IN,73                          CFF007
     C                     MOVE '0'       *IN84                           CFF007
     C**
     C**   If Warning Errors only + screen unchanged - bypass validation  S71062
     C           *IN18     IFEQ '0'                                       S71062
     C           *IN19     ANDEQ'1'                                       S71062
     C           SMIODS    ANDEQXSMIO                                     S71062
     C           SSETDS    ANDEQXSSET                                     S71062
     C                     SETOF                     19                   S71062
     C                     GOTO INSETE                                    S71062
     C                     END                                            S71062
     C**   Validate                                                       S71062
     C**   ~~~~~~~~                                                       S71062
     C                     SETOF                     1819                 S71062
     C                     MOVE *ZEROS    WSETDS
     C**
     C                     MOVE 'N'       BPIND   1
     C                     MOVE 'N'       BMIND   1
     C                     MOVE 'N'       CPIND   1
     C                     MOVE 'N'       CMIND   1
     C/SPACE 2
     C**   Broker  Instructions
     C**   ~~~~~~~~~~~~~~~~~~~~
     C           *IN14     IFEQ '1'
     C**
     C                     MOVE *ZEROS    SEI
     C                     MOVE *BLANKS   SEA
     C                     MOVE SBSET     SXSET
     C/COPY WNCPYSRC,FF0020C070
      ** Determine Commission Pattern                                     CFF007
     C                     EXSR PBCPT                                     CFF007
     C                     MOVE BCPT      XCPT    1                       CFF007
      *                                                                   CFF007
     C                     MOVE 'Y'       XBRKI   1                       CFF007
     C**
     C**   Charges/Commsns
     C                     MOVE WBPRBA    WPBFLG  1                       CFF007
     C                     EXSR VXCHCM
     C                     Z-ADDWXCMA     WBCMA
     C                     Z-ADDWXCHA     WBCHA
     C**   Initial Margin
     C                     EXSR VXMAR
     C                     Z-ADDWXMAR     WBMAR
     C**   Settlement details
     C/COPY WNCPYSRC,FF0020C071
     C**********           MOVE 'Y'       XBRKI   1                       CFF007
     C                     MOVE WBPRBA    WWTOFC  1                       CFF007
     C/COPY WNCPYSRC,FF0020C072
     C                     EXSR VXSET
     C                     MOVE WXSLB     BBID                            S01117
     C                     MOVE FFCNUM    WBSLA1
     C                     MOVE FFACOD    WBSLA2
     C                     MOVE FFACSQ    WBSLA3
     C                     MOVE FFNOSN    XXBNOS  20
     C**
     C**   Restore formatted screen details
     C                     MOVE SXSET     SBSET
     C**
     C**   No errors - set Prono + Memos update indicators
     C           SEIDS     IFEQ *ZEROS
     C                     MOVE XPIND     BPIND
     C                     MOVE XMIND     BMIND
     C**
     C                     ELSE
     C**   Setup error information
     C                     SETON                     18
     C***********          MOVEASEI       *IN,40                          S01117
     C                     MOVEASEI       *IN,39                          S01117
     C                     Z-ADD0         S       20
     C**
     C***********          DO   23                                        S01117
     C/COPY WNCPYSRC,FF0020C073
     C**********           DO   25                                 S01117 CFF007
     C/COPY WNCPYSRC,FF0020C074
     C                     DO   31                                        CFF007
     C                     ADD  1         S
     C**
     C           SEA,S     IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE BSEC,S    ERR,E
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVSF                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Customer  Instructions
     C**   ~~~~~~~~~~~~~~~~~~~~~~
     C           *IN15     IFEQ '1'
     C**
     C                     MOVE *ZEROS    SEI
     C                     MOVE *BLANKS   SEA
     C                     MOVE SCSET     SXSET
     C/COPY WNCPYSRC,FF0020C075
      ** Determine Commission Pattern                                     CFF007
     C                     EXSR PCCPT                                     CFF007
     C                     MOVE CCPT      XCPT                            CFF007
      *                                                                   CFF007
     C                     MOVE 'N'       XBRKI                           CFF007
     C**
     C**   Charges/Commsns
     C                     MOVE WCPRBA    WPBFLG                          CFF007
     C                     EXSR VXCHCM
     C                     Z-ADDWXCMA     WCCMA
     C                     Z-ADDWXCHA     WCCHA
     C**   Initial Margin
     C                     EXSR VXMAR
     C                     Z-ADDWXMAR     WCMAR
     C**   Settlement details
     C/COPY WNCPYSRC,FF0020C076
     C**********           MOVE 'N'       XBRKI                           CFF007
     C/COPY WNCPYSRC,FF0020C077
     C                     MOVE WCPRBA    WWTOFC                          CFF007
     C                     EXSR VXSET
     C                     MOVE WXSLB     CBID                            S01117
     C                     MOVE FFCNUM    WCSLA1
     C                     MOVE FFACOD    WCSLA2
     C                     MOVE FFACSQ    WCSLA3
     C                     MOVE FFNOSN    XXCNOS  20
     C**
     C**   Restore formatted screen details
     C                     MOVE SXSET     SCSET
     C**
     C**   No errors - set Prono + Memos update indicators
     C           SEIDS     IFEQ *ZEROS
     C                     MOVE XPIND     CPIND
     C                     MOVE XMIND     CMIND
     C**
     C                     ELSE
     C**   Setup error information
     C                     SETON                     18
     C                     MOVEASEI       *IN,50
     C                     Z-ADD0         S
     C**
     C***********          DO   23                                        S01117
     C/COPY WNCPYSRC,FF0020C078
     C**********           DO   25                                 S01117 CFF007
     C/COPY WNCPYSRC,FF0020C079
     C                     DO   31                                        CFF007
     C                     ADD  1         S
     C**
     C           SEA,S     IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE CSEC,S    ERR,E
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS1                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C***********                                                  S01117 E26723
     C*****Profit Centre                                           S01117 E26723
     C***********                                                  S01117 E26723
     C***********PFCU      IFEQ 'Y'                                S01117 E26723
     C***********          EXSR VPRFC                              S01117 E26723
     C***********          END                                     S01117 E26723
     C**
     C** TEST WARNING                                                     S71062
     C**                                                                  S71062
     C           *IN19     IFEQ '1'                                       S71062
     C           E         ADD  1         E                               S71062
     C                     MOVEAWERR      ERR,E                           S71062
     C**   - warning errors only, save screen                             S71062
     C           *IN18     IFEQ '0'                                       S71062
     C                     MOVE SMIODS    XSMIO                           S71062
     C                     MOVE SSETDS    XSSET                           S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C                     END
     C*                                                                   E26723
     C**   Profit Centre                                                  E26723
     C*                                                                   E26723
     C** The validation of profit centre takes place if profit centres    E26723
     C** are used and the profit centre is amendable, either because      E26723
     C** trade and book position profit centres are not reconcilable      E26723
     C** or the trade is for a new position (branch/book/instrument).     E26723
     C*                                                                   E26723
     C           PFCU      IFEQ 'Y'                                       E26723
     C           *IN63     ANDEQ'1'                                       E26723
     C           SPRFC     ANDNE*BLANK                                    E35914
     C           *IN01     ANDEQ'0'                                       CAC003
     C*                                                                   E26723
     C                     MOVE SPRFC     WPRFC                           CAC003
     C                     EXSR VPRFC                                     E26723
     C                     MOVE WPRFC     SPRFC                           CAC003
     C                     MOVE WPVALD    *IN79                           CAC003
     C                     END                                            E26723
     C*                                                                   CAC003
     C** Validate Book Position Profit Centre                             CAC003
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C           *IN63     ANDEQ'1'                                       CAC003
     C*                                                                   CAC003
     C           SBPRC     IFEQ *BLANKS                                   CAC003
     C                     ADD  1         E                               CAC003
     C                     MOVE ' 160'    ERR,E                           CAC003
     C                     MOVE '1'       *IN18                           CAC003
     C                     MOVE '1'       *IN79                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE SBPRC     WPRFC                           CAC003
     C                     EXSR VPRFC                                     CAC003
     C                     MOVE WPRFC     SBPRC                           CAC003
     C                     MOVE WPVALD    *IN79                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Validate Transaction Profit Centre                               CAC003
     C*                                                                   CAC003
     C           *IN01     IFEQ '1'                                       CAC003
     C           *IN09     ANDEQ'1'                                       CAC003
     C           *IN12     ANDEQ'1'                                       CAC003
     C*                                                                   CAC003
     C           STPRC     IFEQ *BLANKS                                   CAC003
     C                     ADD  1         E                               CAC003
     C                     MOVE ' 160'    ERR,E                           CAC003
     C                     MOVE '1'       *IN18                           CAC003
     C                     MOVE '1'       *IN67                           CAC003
     C                     ELSE                                           CAC003
     C                     MOVE STPRC     WPRFC                           CAC003
     C                     EXSR VPRFC                                     CAC003
     C                     MOVE WPRFC     STPRC                           CAC003
     C                     MOVE WPVALD    *IN67                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CPM003
     C**   PM Instrument Type                                             CPM003
     C*                                                                   CPM003
     C** Validate Intrument Type if Portfolio Management Module is presentCPM003
     C*                                                                   CPM003
     C           *IN17     IFEQ '0'                        B1             CPM003
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           FCPORS    ANDEQ'B'                                       CPB001
     C*                                                                   CPM003
     C** The validation of PM Instrument Type takes place if enhanced     CPM003
     C** OTC is present and only for OTC Instrument                       CPM003
     C*                                                                   CPM003
     C           SMRKT     IFEQ '  '                       B2             CPM003
     C************IN68     ANDEQ'1'                                CPM003 162534
     C           *IN17     ANDEQ'0'                                       162534
     C*                                                                   CPM003
     C***********ISTI      IFEQ 'Y'                        B3      CPM003 CPB001
     C***********          MOVE '1'       *IN34                    CPM003 CPB001
     C***********          ELSE                                    CPM003 CPB001
     C                     EXSR VINNR                                     CPM003
     C***********          END                             E3      CPM003 CPB001
     C                     END                             E2             CPM003
     C                     END                             E1             CPM003
     C**                                                                  S71062
     C           INSETE    TAG                                            S71062
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VAMEND SR. -  Validate  Amend Control                         *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                   SR. VNUCO                    *
     C**       SR. ADEOTC                   SR. VCOPR                    *
     C**                                    SR. VTRSD                    *
     C**                                    SR. VTBLO                    *
     C**                                    SR. VLNKR                    *
     C**                                    SR. VORBR                    *S01117
     C**                                    SR. VPRFC                    *S01117
     C**                                    SR. VXCHCM                   *
     C**                                    SR. VXMAR                    *
     C**                                    SR. VXSET                    *
     C**                                                                 *
     C********************************************************************
     C**
     C           VAMEND    BEGSR                           ** VAMEND SR **
     C**
     C**   Reset Processing
     C                     Z-ADD0         E
     C                     MOVE *BLANK    ERR
     C                     Z-ADD0         F
     C                     MOVE *BLANK    WERR
     C**
     C                     SETOF                     243031
     C                     SETOF                     3637
     C                     SETOF                     7879                 S01117
     C                     MOVE '0'       *IN67                           CAC003
     C/COPY WNCPYSRC,FF0020C007
     C                     MOVEA'0'       *IN,39                          S01117
     C                     MOVEA'00000'   *IN,40
     C                     MOVEA'00000'   *IN,45
     C                     MOVEA'00000'   *IN,50
     C                     MOVEA'00000'   *IN,55
     C                     MOVEA'0'       *IN,60                          S01117
     C                     MOVEA'0'       *IN,83                          CPL002
     C                     MOVEA'0000'    *IN,85                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVEA'00'      *IN,73                          CFF007
     C                     MOVE '0'       *IN84                           CFF007
     C**
     C**   If Warning Errors only + screen unchanged - bypass validation
     C           *IN18     IFEQ '0'
     C           *IN19     ANDEQ'1'
     C           SMIODS    ANDEQXSMIO
     C           SSETDS    ANDEQXSSET
     C                     SETOF                     19
     C                     GOTO VAMDED
     C                     END
     C**   Validate
     C**   ~~~~~~~~
     C                     SETOF                     1819
     C                     MOVE *ZEROS    WSETDS
     C**
     C           *IN65     IFEQ '1'
     C           *IN66     ANDEQ'1'
     C                     MOVE *ZEROS    WMIOAM
     C**   No. of Contracts
     C                     EXSR VNUCO
     C**   - restore Instr. Ccy values
     C                     Z-ADDFFCDP     ZADEC
     C           13        SUB  FFCDP     ZADIG
     C**   Contract Price
     C                     EXSR VCOPR
     C**   Transaction Date
     C                     EXSR VTRSD
     C/COPY WNCPYSRC,FF0020C008
     C**                                                                  073714
     C**   If OTC                                                         073714
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    ANDNE'Y'                                       CFF007
     C           SMRKT     ANDNE*BLANKS                                   CFF007
     C                     EXSR VVDAT                                     CFF007
     C                     ELSE                                           CFF007
     C           SMRKT     IFEQ '  '                                      073714
     C**                                                                  073714
     C**   Value Date                                                     073714
     C                     EXSR VVALD                                     073714
     C                     END                                            073714
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C009
     C**
     C                     END
     C**
     C**   To Be Left Open Ind ?
     C                     EXSR VTBLO
     C**
     C**   Linked Reference
     C           SLNKR     IFNE *BLANK
     C                     EXSR VLNKR
     C                     END
     C*                                                                   S01117
     C**   Originating Branch                                             S01117
     C*                                                                   S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C           OBUU      ANDEQ'Y'                                       S01117
     C                     EXSR VORBR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Profit Centre                                                  S01117
     C*                                                                   S01117
     C           PFCU      IFEQ 'Y'                                       S01117
     C           TBRC      ANDEQ'N'                                       S01117
     C           PFCA      ANDEQ'Y'                                       S01117
     C           SPRFC     ANDNE*BLANK                                    E35914
     C                     MOVE SPRFC     WPRFC                           CAC003
     C                     EXSR VPRFC                                     S01117
     C                     MOVE WPRFC     SPRFC                           CAC003
     C                     MOVE WPVALD    *IN79                           CAC003
     C                     END                                            S01117
     C/COPY WNCPYSRC,FF0020C080
     C**                                                                  S01235
      ** Customer                                                         CFF007
      *                                                                   CFF007
     C                     EXSR VCUSC                                     CFF007
      *                                                                   CFF007
     C**   PORTFOLIO REFERENCE                                            S01235
     C                     EXSR VPTFR                                     S01235
     C/COPY WNCPYSRC,FF0020C081
      *                                                                   CFF007
      ** Private banking fields                                           CFF007
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C                     EXSR VPBFL                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CPL002
      ** If Midas-Plato installed, validate Spot Price.                   CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           SMRKT     ANDNE'  '                                      CPL002
     C           BGN2ST    OREQ 'Y'                                       CPL002
     C           SMRKT     ANDEQ'  '                                      CPL002
     C           WISPT     ANDEQ5
     C                     EXSR VSPTP                                     CPL002
     C                     ENDIF                                          CPL002
     C/SPACE 2
     C**   Broker  Settlement Instructions
     C**   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C           *IN14     IFEQ '1'
     C**
     C                     MOVE *ZEROS    SEI
     C                     MOVE *BLANKS   SEA
     C                     MOVE SBSET     SXSET
     C**
     C**   Charges/Commsns
     C           *IN65     IFEQ '1'
     C/COPY WNCPYSRC,FF0020C082
      ** Determine Commission Pattern                                     CFF007
     C                     EXSR PBCPT                                     CFF007
     C                     MOVE BCPT      XCPT                            CFF007
     C                     MOVE 'Y'       XBRKI                           CFF007
     C                     MOVE WBPRBA    WPBFLG                          CFF007
     C                     EXSR VXCHCM
     C                     Z-ADDWXCMA     WBCMA
     C                     Z-ADDWXCHA     WBCHA
     C                     END
     C**   Initial Margin
     C                     EXSR VXMAR
     C                     Z-ADDWXMAR     WBMAR
     C**   Settlement details
     C           *IN65     IFEQ '1'
     C/COPY WNCPYSRC,FF0020C083
     C**********           MOVE 'Y'       XBRKI                           CFF007
     C/COPY WNCPYSRC,FF0020C084
     C                     MOVE WBPRBA    WWTOFC                          CFF007
     C                     EXSR VXSET
     C                     MOVE WXSLB     BBID                            S01117
     C                     MOVE FFCNUM    WBSLA1
     C                     MOVE FFACOD    WBSLA2
     C                     MOVE FFACSQ    WBSLA3
     C                     MOVE FFNOSN    XXBNOS
     C                     END
     C**
     C**   Restore formatted screen details
     C                     MOVE SXSET     SBSET
     C**
     C**   No errors - set Prono + Memos update indicators
     C           SEIDS     IFEQ *ZEROS
     C                     MOVE XPIND     BPIND
     C                     MOVE XMIND     BMIND
     C**
     C                     ELSE
     C**   Setup error information
     C                     SETON                     18
     C***********          MOVEASEI       *IN,40                          S01117
     C                     MOVEASEI       *IN,39                          S01117
     C                     Z-ADD0         S
     C**
     C***********          DO   23                                        S01117
     C/COPY WNCPYSRC,FF0020C085
     C**********           DO   25                                 S01117 CFF007
     C/COPY WNCPYSRC,FF0020C086
     C                     DO   31                                        CFF007
     C                     ADD  1         S
     C**
     C           SEA,S     IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE BSEC,S    ERR,E
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS2                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Customer Settlement Instructions
     C**   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     C           *IN15     IFEQ '1'
     C**
     C                     MOVE *ZEROS    SEI
     C                     MOVE *BLANKS   SEA
     C                     MOVE SCSET     SXSET
     C**
     C**   Charges/Commsns
     C           *IN65     IFEQ '1'
     C/COPY WNCPYSRC,FF0020C087
      ** Determine Commission Pattern                                     CFF007
     C                     EXSR PCCPT                                     CFF007
     C                     MOVE CCPT      XCPT                            CFF007
     C                     MOVE 'N'       XBRKI                           CFF007
     C                     MOVE WCPRBA    WPBFLG                          CFF007
     C                     EXSR VXCHCM
     C                     Z-ADDWXCMA     WCCMA
     C                     Z-ADDWXCHA     WCCHA
     C                     END
     C**   Initial Margin
     C                     EXSR VXMAR
     C                     Z-ADDWXMAR     WCMAR
     C**   Settlement details
     C           *IN65     IFEQ '1'
     C/COPY WNCPYSRC,FF0020C088
     C**********           MOVE 'N'       XBRKI                           CFF007
     C/COPY WNCPYSRC,FF0020C089
     C                     MOVE WCPRBA    WWTOFC                          CFF007
     C                     EXSR VXSET
     C                     MOVE WXSLB     CBID                            S01117
     C                     MOVE FFCNUM    WCSLA1
     C                     MOVE FFACOD    WCSLA2
     C                     MOVE FFACSQ    WCSLA3
     C                     MOVE FFNOSN    XXCNOS
     C                     END
     C**
     C**   Restore formatted screen details
     C                     MOVE SXSET     SCSET
     C**
     C**   No errors - set Prono + Memos update indicators
     C           SEIDS     IFEQ *ZEROS
     C                     MOVE XPIND     CPIND
     C                     MOVE XMIND     CMIND
     C**
     C                     ELSE
     C**   Setup error information
     C                     SETON                     18
     C                     MOVEASEI       *IN,50
     C                     Z-ADD0         S
     C**
     C***********          DO   23                                        S01117
     C/COPY WNCPYSRC,FF0020C090
     C**********           DO   25                                 S01117 CFF007
     C/COPY WNCPYSRC,FF0020C091
     C                     DO   31                                        CFF007
     C                     ADD  1         S
     C**
     C           SEA,S     IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE CSEC,S    ERR,E
     C                     END
     C**
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS3                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   If Warning Errors
     C           *IN19     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVEAWERR      ERR,E
     C**
     C**   - warning errors only, save screen
     C           *IN18     IFEQ '0'
     C                     MOVE SMIODS    XSMIO
     C***********          MOVE SSETDS    XSSET 164                       S01117
     C***********          MOVE SSETDS    XSSET 174                S01117 CPM003
     C***********          MOVE SSETDS    XSSET 177                CPM003 CAC003
     C**********           MOVE SSETDS    XSSET 185                                    CAC003 CGL029
     C                     MOVE SSETDS    XSSET 197                                           CGL029
     C                     END
     C**
     C                     END
     C**
     C           VAMDED    ENDSR                           *** VAMDED ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VDELET SR. -  Validate  Delete Control                        *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                                                *
     C**       SR. ADEOTC                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VDELET    BEGSR                           ** VDELET SR **
     C**
     C**   Reset Processing
     C                     SETOF                     18
     C                     MOVE *BLANK    SERCD2
     C**
     C**   F10 must be taken
     C           *INKJ     IFNE '1'
     C**********           MOVEAMSG,3     SERCD2                          CFF007
     C                     MOVELMSG,3     SERCD2                          CFF007
     C                     SETON                     18
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT                                                              S01235
     C********************************************************************S01235
     C**                                                                 *S01235
     C**   VPTFR SR. -  VALIDATE  PORTFOLIO REFERENCE                    *S01235
     C**   ~~~~~~~~~                                                     *S01235
     C**      Called From                  Calls                         *S01235
     C**       SR. VINSRT                   SR. DBERR                    *S01235
     C**       SR. VAMEND                                                *S01235
     C**                                                                 *S01235
     C********************************************************************S01235
     C**                                                                  S01235
     C           VPTFR     BEGSR                           *** VPTFR SR **S01235
     C*                                                                   172644
     C                     CALL 'AOCUSTR0'                                172644
     C                     PARM *BLANKS   @RTCD   7                       172644
     C                     PARM '*KEY   ' @OPTN   7                       172644
     C                     PARM SCUSC     @KEY1  10                       172644
     C                     PARM           @KYST   7                       172644
     C           SDCUST    PARM SDCUST    DSSDY                           172644
     C*                                                                   CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD                           CPB001
     C                     PARM '*KEY   ' @OPTN                           CPB001
     C                     PARM SCUSC     WWKY10                          CPB001
     C                     PARM           @KYST   7                       CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C*                                                                   S71062
     C                     MOVE '0'       *IN16                           S71062
     C* INITIALISE DEFAULT PORTFOLIO INDICATOR                            S01235
     C                     MOVE 'N'       WW9997                          S01235
     C* ONLY VALIDATE IF PORTFOLIO MANAGEMENT IS SWITCHED ON              S01235
     C* OR IF PRIVATE BANKING MODULE IS SWITCHED ON                       CPB001
     C           BGPFMG    IFEQ 'Y'                        B1             S01235
     C           FCPORS    ANDNE'B'                                       CPM003
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C* IF AMEND AND TRANSACTION DATE IS NOT EQUAL TO RUN DATE, PROTECT   S01235
     C* FIELD AND LEAVE ROUTINE (AND GIVE WARNING)                        S01235
     C           SACTN     IFEQ 'A'                        B2             S01235
     C           TRSD      ANDNEPRUND                                     S01235
     C* RESTORE FILE VALUE TO SCREEN VALUE                                S01235
     C                     MOVE PTFR      SPTFR                           S01235
     C           E         ADD  1         E                               S01235
     C                     MOVE ' WA1'    ERR,E                           S01235
     C                     MOVE '1'       *IN19                           S01235
     C                     MOVE '1'       *IN16                           CPM003
     C***********          MOVE '1'       *IN17                    CPM003 CPB001
     C                     GOTO VPFRED                                    S01235
     C                     END                             E2             S01235
     C* VALIDATE THE CUSTOMER AS A PORTFOLIO CUSTOMER IF AN REFERENCE IS  S01235
     C* ENTERED                                                           S01235
     C***********SACTN     IFEQ 'I'                        B2      S01235 119910
     C***********          MOVELKCBCD     WWCNUM  6                S01235 119910
     C***********          ELSE                                    S01235 119910
     C***********          MOVELSCUSC     WWCNUM                   S71062 119910
     C***********          MOVELSCUSC     WWCNUM  6                119910 CPB001
     C                     MOVELCUST      WWCNUM  6                       CPB001
     C***********          END                             E2      S01235 119910
     C* USE A WORKING FIELD TO INDICATE IF CUSTOMER IS A CLIENT PORTFOLIO S71062
     C* AND IF THE PORTFOLIO EXISTS IN PMPORTPD                           S71062
     C                     MOVE 'N'       WWPORT  1                       S71062
     C*                                                                   S71062
     C                     MOVE 'N'       WWPMPB  1                       CPB001
     C                     MOVE BBPRBA    WWPMPB                          CPB001
     C*                                                                   CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C***********          MOVELWWCNUM    WWCLIN 10                CPM003 CPB001
     C                     MOVELSCUSC     WWCLIN 10                       CPB001
     C                     CALL 'AOPLCSR0'                                CPM003
     C                     PARM '*MSG   ' @RTCD   7                       CPM003
     C                     PARM '*KEY   ' @OPTN   7                       CPM003
     C                     PARM WWCLIN    WWKY10 10                       CPM003
     C           SDPLCS    PARM SDPLCS    @DSFDY                          CPM003
     C*                                                                   CPB001
     C           @RTCD     IFEQ *BLANKS                                   CPB001
     C                     MOVE 'Y'       WWPMPB                          CPB001
     C                     ELSE                                           186482
     C                     MOVE 'N'       WWPMPB                          186482
     C                     ENDIF                                          CPB001
     C*                                                                   CPB001
     C                     ENDIF                                          CPB001
     C* IF NOT ON FILE  AND AN ENTRY HAS BEEN MADE                        S01235
     C*****      @RTCD     IFNE *BLANKS                            CPM003 CPB001
     C*****      SPTFR     ANDNE*BLANKS                            S01235 CPB001
     C           WWPMPB    IFEQ 'N'                                       CPB001
     C           SPTFR     ANDNE*BLANKS                                   CPB001
     C* OR IF NOT A PORTFOLIO CUSTOMER                                    S01235
     C           E         ADD  1         E                               S01235
     C                     MOVE ' ER1'    ERR,E                           S01235
     C                     MOVE '1'       *IN18                           S01235
     C                     MOVE '1'       *IN16                           CPM003
     C                     ELSE                            X2             S01235
     C* IF NOT A PORTFOLIO CUSTOMER, BUT PORTFOLIO REFERENCE              S01235
     C* IS BLANK, LEAVE ROUTINE                                           S01235
     C*****      @RTCD     IFNE *BLANKS                            CPM003 CPB001
     C           WWPMPB    IFEQ 'N'                                       CPB001
     C           SPTFR     ANDEQ*BLANKS                                   CPB001
     C           SCUSC     OREQ *BLANKS                                   172644
     C                     GOTO VPFRED                                    S01235
     C                     END                             E3             S01235
     C* VALIDATE PORTFOLIO REFERENCE - IF BLANK, DEFAULT TO REFERENCE     S01235
     C* ON PM ICD                                                         S01235
     C                     MOVELQBCUST    WWKY10    P                     CFF007
     C                     CALL 'AOCUSTR1'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           WWKY10                          CFF007
     C                     PARM           @KYST                           CFF007
     C           SDCUST    PARM SDCUST    DSLDY                           CFF007
     C/COPY WNCPYSRC,FF0020CP80
     C*CO*Y WN*PY*RC*FF0020C050
     C/COPY WNCPYSRC,FF0020CQ80
     C           SPTFR     IFEQ *BLANKS                    B3             S01235
     C* Setup of FCR997 must be down only if PB is OFF                    CPB001
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVE FCR997    SPTFR                           CPM003
     C* SET ON INDICATOR TO SHOW THAT '9997' SHOULD GO TO FILE            S01235
     C                     MOVE 'Y'       WW9997  1                       S01235
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   SPTFR                           CPB001
     C                     MOVE 'Y'       WW9997                          CPB001
     C           WWPMPB    IFEQ 'Y'                                       CPB001
     C           SCUSC     ANDNE*BLANKS                                   CPB001
     C           *IN33     ANDEQ'0'                                       CPB001
     C* If PB is ON, retrieve the first portfolio reference of PMPORTPD   CPB001
     C                     MOVELCUST      KPCNUM                          CPB001
     C                     MOVE 'N'       WWVAL   1                       CPB001
     C           KPCNUM    SETLLPMPORTPD                                  CPB001
     C           KPCNUM    READEPMPORTPD                 89               CPB001
     C*                                                                   CPB001
     C           *IN89     DOWEQ*OFF                                      CPB001
     C           WWVAL     ANDEQ'N'                                       CPB001
     C           PNDPCL    IFEQ 0                                         CPB001
     C           PNRECI    ANDEQ'D'                                       CPB001
     C                     MOVE PNPTFR    SPTFR                           CPB001
     C                     MOVE 'N'       WW9997                          CPB001
     C                     MOVE 'Y'       WWVAL                           CPB001
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     MOVE 'Y'       WWPORT                          CPB001
     C                     ENDIF                                          CPB001
     C                     ELSE                                           CPB001
     C           KPCNUM    READEPMPORTPD                 89               CPB001
     C                     ENDIF                                          CPB001
     C                     ENDDO                                          CPB001
     C*                                                                   CPB001
     C                     ENDIF                                          CPB001
     C                     ENDIF                                          CPB001
     C/COPY WNCPYSRC,FF0020CP81
     C*CO*Y WN*PY*RC*FF0020C051
     C/COPY WNCPYSRC,FF0020CQ81
     C                     ELSE                            X3             S01235
     C/COPY WNCPYSRC,FF0020CP82
     C*CO*Y WN*PY*RC*FF0020C052
     C/COPY WNCPYSRC,FF0020CQ82
     C* REFERENCE ENTERED                                                 S01235
     C                     MOVELSPTFR     WWPTFR                          S01235
     C********** SACTN     IFEQ 'I'                        B4      S01235 CPB001
     C**********           MOVELKCBCD     KPCNUM                   S01235 CPB001
     C**********           ELSE                                    S01235 CPB001
     C**********           MOVELSCUSC     KPCNUM                   S71062 CPB001
     C**********           END                             E4      S01235 CPB001
     C                     MOVELCUST      KPCNUM                          CPB001
     C           PORTKY    CHAINPMPORTPD             71                   CPM003
     C  N71      PNRECI    COMP 'D'                  7171                 S01235
     C* REFERENCE NOT ON FILE OR NOT A LIVE RECORD, ACCESS PM ICD         S01235
     C* TO SEE IF IT REFERS TO THE '9997' REFERENCE                       S01235
     C           *IN71     IFEQ '1'                        B4             S01235
     C* VALIDATE '9997' PORTFOLIO REFERENCE                               S01235
     C           SPTFR     IFNE FCR997                     B5             CPM003
     C           SPTFR     OREQ FCR997                                    172644
     C           FCR997    ANDEQ*BLANKS                                   172644
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           E         ADD  1         E                               S01235
     C                     MOVE ' ER2'    ERR,E                           S01235
     C                     MOVE '1'       *IN18                           S01235
     C                     MOVE '1'       *IN16                           CPM003
     C                     ELSE                            X5             S01235
     C* SET ON INDICATOR TO SHOW THAT '9997' SHOULD GO TO FILE            S01235
     C                     MOVE 'Y'       WW9997                          S01235
     C                     END                             E5             S01235
     C* PORTFOLIO IS FOUND, BUT IS FLAGGED FOR CLOSURE                    S01235
     C                     ELSE                            X4             S01235
     C           PNDPCL    IFGT 0                                         S01235
     C           E         ADD  1         E                B5             S01235
     C                     MOVE ' WA1'    ERR,E                           S01235
     C                     MOVE '1'       *IN19                           S01235
     C                     MOVE '1'       *IN16                           CPM003
     C                     END                             E5             S01235
     C                     MOVE 'Y'       WWPORT                          S71062
     C                     END                             E4             S01235
     C/COPY WNCPYSRC,FF0020CP83
     C*CO*Y WN*PY*RC*FF0020C053
     C/COPY WNCPYSRC,FF0020CQ83
     C                     END                             E3             S01235
     C                     END                             E2             S01235
     C                     END                             E1             S01235
     C*                                                                   S01235
     C*                                                                   S01235
     C           VPFRED    ENDSR                           *** VPFRED   **S01235
     C**        ~~~~~~~~                                                  S01235
     C**                                                                  S01235
     C********************************************************************S01235
      /EJECT                                                              CFF007
      *****************************************************************   CFF007
      *                                                               *   CFF007
      *  VPBFL - Validate fields for Private Banking                  *   CFF007
      *                                                               *   CFF007
      *  Called From: VINSRT, VAMEND                                  *   CFF007
      *                                                               *   CFF007
      *  Calls      : DBERR                                           *   CFF007
      *                                                               *   CFF007
      *****************************************************************   CFF007
      *                                                                   CFF007
     C           VPBFL     BEGSR                                          CFF007
      *                                                                   CFF007
     C                     MOVEA'000'     *IN,85                          CFF007
      *                                                                   CFF007
      ** Covered                                                          CFF007
      *                                                                   CFF007
     C           SCOVE     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'N'       SCOVE                           CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ELSE                                           CFF007
     C           SCOVE     IFNE 'Y'                                       CFF007
     C           SCOVE     ANDNE'N'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 170'    ERR,E                           CFF007
     C                     SETON                     1885                 CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Hedged/Traded                                                    CFF007
      *                                                                   CFF007
     C           SHETR     IFEQ *BLANKS                                   CFF007
      *                                                                   CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C           SCOVE     IFEQ 'Y'                                       CFF007
     C                     MOVE 'H'       SHETR                           CFF007
     C                     ELSE                                           CFF007
     C           SCOVE     IFEQ 'N'                                       CFF007
     C                     MOVE 'T'       SHETR                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C           SHETR     IFNE 'H'                                       CFF007
     C           SHETR     ANDNE'T'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 171'    ERR,E                           CFF007
     C                     SETON                     1886                 CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Block Underlying Position                                        CFF007
      *                                                                   CFF007
     C           SBLUP     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'N'       SBLUP                           CFF007
     C                     MOVE 'Y'       WRDPLY                          CFF007
     C                     ELSE                                           CFF007
     C           SBLUP     IFNE 'Y'                                       CFF007
     C           SBLUP     ANDNE'N'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 172'    ERR,E                           CFF007
     C                     SETON                     1887                 CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
      *****************************************************************   CFF007
     C/COPY WNCPYSRC,FF0020C092
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VTNBR SR. -  Validate Transaction Reference                   *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. PROMPT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VTNBR     BEGSR                           *** VTNBR SR **
     C**
     C**   Reset Processing
     C                     SETOF                     181922
     C                     SETOF                     72
     C                     Z-ADD0         E
     C                     MOVE *BLANK    ERR
     C                     Z-ADD0         F
     C                     MOVE *BLANK    WERR
     C**
     C**   1. Must be numeric, greater than zero.
     C                     MOVELSTNBR     WTSTN7
     C                     TESTN          WTSTN7     75
     C**
     C           *IN75     IFEQ '0'
     C           STNBR     OREQ '000000'
     C           E         ADD  1         E
     C                     MOVE ' 020'    ERR,E
     C                     SETON                     1822
     C                     GOTO VTNEND
     C                     END
     C/SPACE 2
     C                     MOVE STNBR     KTNBR   60
     C**
     C           SACTN     IFEQ 'I'
     C**   Insert
     C**   ~~~~~~
     C**   2. Record must not already exist
     C           KTNBR     CHAINTRANS2               71
     C**
     C           *IN71     IFEQ '0'
     C           E         ADD  1         E
     C                     MOVE ' 021'    ERR,E
     C                     SETON                     1822
     C                     END
     C**
     C                     ELSE
     C**   Amd/Del/Enq
     C**   ~~~~~~~~~~~
     C/COPY WNCPYSRC,FF0020C062
     C**   3. Record must already exist
     C           KTNBR     CHAINTRANSIN              71
     C**
     C           *IN71     IFEQ '0'
     C   05      RECI      COMP '*'                      72
     C*                                                                   E27760
     C** Check if the record ID is 'R' as system changes the record ID    E27760
     C** of a deleted trade to 'R' during COB                             E27760
     C*                                                                   E27760
     C           *IN05     IFEQ '1'                                       E27760
     C           *IN72     ANDEQ'0'                                       E27760
     C           RECI      ANDEQ'R'                                       E27760
     C                     MOVE '1'       *IN72                           E27760
     C                     END                                            E27760
     C  N72      RECI      COMP 'D'                  7171
     C                     END
     C**
     C**   - Record does not exist (NB. can enquire on deleted records)
     C           *IN71     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 022'    ERR,E
     C                     SETON                     1822
     C                     GOTO VTNEND
     C**                                                                  S01117
     C**   - SPF Checking                                                 S01117
     C**                                                                  S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   (Single Branch environment)                                    S01117
     C*                                                                   S01117
     C           *IN77     IFNE '1'                                       S01332
     C           PMBIN     IFNE 'Y'                                       S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 303'    ERR,E                           S01117
     C                     SETON                     1820                 S01117
     C                     GOTO VTNEND                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   (MultiBranch environment)                                      S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM BRCA      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 304'    ERR,E                           S01117
     C                     SETON                     182022               S01117
     C                     GOTO VTNEND                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           OBUU      IFEQ 'Y'                                       S01117
     C           OBUV      ANDEQ'Y'                                       S01117
     C           PACTN     ANDNE'E'                                       S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 307'    ERR,E                           S01117
     C                     SETON                     1822                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01332
     C                     END
     C**
     C**   4. Transaction type must be 'P' or 'S'
     C           TRTY      IFNE 'P'
     C           TRTY      ANDNE'S'
     C           E         ADD  1         E
     C                     MOVE ' 023'    ERR,E
     C                     SETON                     1822
     C                     GOTO VTNEND
     C                     END
     C**
     C**   5. If delete, a transaction must not exist on LF/TRANS8 with
     C**    its' Closure Ref. = this Transaction No.
     C           SACTN     IFEQ 'D'
     C                     MOVE STNBR     KCLSR8
     C                     MOVE 'E'       KTRTY8
     C**
     C           KTRNS8    SETLLTRANS8
     C                     READ TRANS8DF                 71
     C**    - record exists
     C           *IN71     IFEQ '0'
     C           CLSR8     ANDEQKCLSR8
     C           E         ADD  1         E
     C                     MOVE ' 024'    ERR,E
     C                     SETON                     1822
     C                     GOTO VTNEND
     C                     END
     C**
     C                     END
     C*                                                                   E26451
     C**   6. If delete or amend, the settlement date of the instrument   E26451
     C**      associated with the trade must be greater than or equal     E26451
     C**      to the current trading date, whcih is the rundate for       E26451
     C**      an OTC and mkt centre business for a mkt traded inst.       E26451
     C*                                                                   E26451
     C           SACTN     IFEQ 'D'                                       E26451
     C           SACTN     OREQ 'A'                                       E26451
      *                                                                   E26451
      ** Access INTYP for set.date formula & currency details             E26451
      *                                                                   E26451
     C           ISTT      CHAININTYP                71                   E26451
      *                                                                   E26451
      ** If a live record not found,Database Error 23                     E26451
      *                                                                   E26451
     C           *IN71     IFEQ '1'                                       E26451
     C           RECI      ORNE 'D'                                       E26451
     C           *LOCK     IN   LDA                        ***************E26451
     C                     Z-ADD23        DBASE            **DB ERROR 23**E26451
     C                     MOVEL'INTYP'   DBFILE           ***************E26451
     C                     MOVELISTT      DBKEY                           E26451
     C                     EXSR DBERR                                     E26451
     C                     END                                            E26451
      *                                                                   E26451
      ** If the instrument is a market instrument the settlement          E26451
      ** date for the instrument must be calculated from a settlement     E26451
      ** date formula using SR.FFDATE. Note for OTC's the settlement      E26451
      ** date is held as part of the instrument details.                  E26451
      *                                                                   E26451
     C           PMRKT     IFNE '  '                                      E26451
      *                                                                   E26451
     C                     MOVE SEDF      FFDATC                          E26451
     C                     MOVE PMKLC     FFCCY1                          E26451
     C                     MOVE PMLOC     FFLOC                           E26451
     C                     MOVE ISCY      FFCCY2                          E26451
     C                     MOVE OTHC      FFCCY3                          E26451
     C                     Z-ADDYRNO      FFYR                            E26451
     C                     Z-ADDMTHN      FFMTH                           E26451
     C                     MOVE *IN81     WIN81   1                       CFF007
     C                     MOVE *IN82     WIN82   1                       CFF007
     C                     EXSR FFDATE                                    E26451
     C                     MOVE WIN81     *IN81                           CFF007
     C                     MOVE WIN82     *IN82                           CFF007
     C                     MOVE FFDAY     SETD                            E26451
     C                     END                                            E26451
      *                                                                   E26451
      ** If settlement  date is less than the current trading date,       E26451
      ** date validation error '025' has occured.                         E26451
      *                                                                   E26451
     C           SETD      IFLT CTDATE                                    E26451
     C           E         ADD  1         E                               E26451
     C                     MOVE ' 025'    ERR,E                           E26451
     C                     SETON                     1822                 E26451
     C                     GOTO VTNEND                                    E26451
     C                     END                                            E26451
      *                                                                   E26451
     C                     END                                            E26451
     C/COPY WNCPYSRC,FF0020C048
     C           SACTN     IFEQ 'D'                                       CFF007
     C           CLSR      ANDNE*ZEROS                                    CFF007
     C**                                                                  CFF007
     C           TRTY      IFEQ 'P'                                       CFF007
     C           TRTY      OREQ 'S'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 026'    ERR,E                           CFF007
     C                     SETON                     1822                 CFF007
     C                     GOTO VTNEND                                    CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C/SPACE 2
     C**   Save Date, Type and No. of last change,  Linked Ref.
     C**    and Instr. ccy
     C*                                                                   E26451
     C** NB. Fields which could be overwritten because of new             E26451
     C**     validation have been renamed so that they are now unique.    E26451
     C*                                                                   E26451
     C***********          Z-ADDLCD       XLCD    50                      E26451
     C***********          MOVE CHTP      XCHTP   1                       E26451
     C***********          Z-ADDTNLU      XTNLU   50                      E26451
     C                     Z-ADDLCDI      XLCD    50                      E26451
     C                     MOVE CHTPI     XCHTP   1                       E26451
     C                     Z-ADDTNLUI     XTNLU   50                      E26451
     C                     MOVE LNKR      XLNKR   6
     C                     MOVE ISCY      KCCY
     C**
     C*****Setup*Default*Account*Sequence*********************************S01117
     C***********MBIN      IFEQ 'N'                                       S01117
     C***********          MOVE '01'      FFDASQ                          S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********          MOVE BRCD      FFBRCD                          S01117
     C***********                                                         S01117
     C***********KBRCD     CHAINTABLETRF             70                   S01117
     C**N70******RECI      COMP 'D'                  7070                 S01117
     C*****-*record*not*found*********************************************S01117
     C************IN70     IFEQ '1'                                       S01117
     C************LOCK     IN   LDA                                       S01117
     C***********          MOVE '05'      DBASE            ** DBERR  05 **S01117
     C***********          MOVE 'TABFF'   DBFILE                          S01117
     C***********          MOVELKBRCD     DBKEY                           S01117
     C***********          EXSR DBERR                                     S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          MOVE NSACS     FFDASQ                          S01117
     C***********          END                                            S01117
     C**
     C                     END
     C**
     C           VTNEND    ENDSR                           *** VTNEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VNUCO SR. -  Validate  No. of Contracts                       *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VNUCO     BEGSR                           *** VNUCO SR **
     C**
     C                     Z-ADD0         ZADEC
     C                     Z-ADD5         ZADIG
     C**
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SNUCO     ZFIELD
     C                     EXSR ZALIGN
     C**   - invalid
     C           *IN99     IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C           E         ADD  1         E
     C                     MOVE ' 071'    ERR,E
     C                     SETON                     1824
     C**   - valid
     C                     ELSE
     C                     MOVE ZFIELD    WNUCO
     C**
     C           WNUCO     IFEQ 0
     C                     MOVE *BLANK    SNUCO
     C                     ELSE
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SNUCO
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VMKI SR. -  Validate  Market Instrument                       *
     C**   ~~~~~~~~                                                      *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VMKI      BEGSR                           *** VMKI SR ***
      *                                                                   CFF005
      * If ? processing available on Instr. Type and ? entered            CFF005
     C           CFF005    IFEQ 'Y'                                       CFF005
     C           SISTC     ANDEQ'?'                                       CFF005
     C                     CALL 'FF0151'                                  CFF005
     C                     PARM           SMRKT                           CFF005
     C                     PARM *BLANKS   PPISTC  3                       CFF005
     C                     PARM           PPRTCD  4                       CFF005
      *                                                                   CFF005
     C           PPISTC    IFNE *BLANKS                                   CFF005
     C                     MOVE PPISTC    SISTC                           CFF005
     C                     ENDIF                                          CFF005
     C                     ENDIF                                          CFF005
     C**
     C                     MOVE SMRKT     KMRKT
     C                     MOVE SISTC     KISTC
     C**
     C           KISTT     CHAININTYP                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C**   - Instrument Type does not exist
     C           *IN71     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 041'    ERR,E
     C                     SETON                     1825
     C**
     C                     ELSE
     C**   - Instrument ind. must not be 'Y' (must be 'N')
     C           ISTI      IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE ' 042'    ERR,E
     C                     SETON                     1825
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VOTC SR. -  Validate  O.T.C. Type                             *
     C**   ~~~~~~~~                                                      *
     C**                                                                 *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VOTC      BEGSR                           *** VOTC SR ***
     C**
     C                     MOVE SISTT     KISTT
     C**                                                                  073714
     C**   - O.T.C. Type must be defined                                  073714
     C           SISTT     IFEQ *BLANK                     b1             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 046'    ERR,E                           073714
     C                     SETON                     182549               073714
     C                     ELSE                            x1             073714
     C**                                                                  073714
     C                     MOVE *BLANK    ISTI                            073714
     C           KISTT     CHAININTYP                71                   073714
     C**                                                                  073714
     C**   - O.T.C. Type exists                                           073714
     C           *IN71     IFEQ '0'                        b2             073714
     C**                                                                  073714
     C**   - It must be live                                              073714
     C           RECI      IFNE 'D'                        b3             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 046'    ERR,E                           073714
     C                     SETON                     182549               073714
     C                     ELSE                            x3             073714
     C**                                                                  073714
     C**   - Instrument ind. must be 'Y'                                  073714
     C           ISTI      IFNE 'Y'                        b4             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 047'    ERR,E                           073714
     C                     SETON                     182549               073714
     C                     ELSE                            x4             073714
     C**                                                                  073714
     C**   - Instrument Processing Type must equal that from 1st screen   073714
     C                     MOVE SISPT     WISPT   10                      073714
     C           ISPT      IFNE WISPT                      b5             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 048'    ERR,E                           073714
     C                     SETON                     182549               073714
     C                     END                             e5             073714
     C                     END                             e4             073714
     C                     END                             e3             073714
     C                     ELSE                            x2             073714
     C                     MOVE SISPT     ISPT                            073714
     C                     END                             e2             073714
     C                     END                             e1             073714
     C***********                                                         073714
     C***********KISTT     CHAININTYP                71                   073714
     C**N71******RECI      COMP 'D'                  7171                 073714
     C***********                                                         073714
     C*****-*O.T.C. Type does not exist                                   073714
     C************IN71     IFEQ '1'                                       073714
     C***********E         ADD  1         E                               073714
     C***********          MOVE ' 046'    ERR,E                           073714
     C***********          SETON                     1825                 073714
     C***********                                                         073714
     C***********          ELSE                                           073714
     C*****-*Instrument ind. must be 'Y'                                  073714
     C***********ISTI      IFNE 'Y'                                       073714
     C***********E         ADD  1         E                               073714
     C***********          MOVE ' 047'    ERR,E                           073714
     C***********          SETON                     1825                 073714
     C***********          END                                            073714
     C***********                                                         073714
     C***********          END                                            073714
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT                                                              073714
     C********************************************************************073714
     C**                                                                 *073714
     C**   VOTCD SR. -  Validate  O.T.C. Instrument Details              *073714
     C**   ~~~~~~~~                                                      *073714
     C**                                                                 *073714
     C**      Called From                  Calls                         *073714
     C**       SR. VINSRT                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           VOTCD     BEGSR                           ***VOTCD  SR***073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - Style                                                        073714
     C           SAEIN     IFNE 'E'                                       073714
     C           SAEIN     ANDNE'A'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 301'    ERR,E                           073714
     C                     SETON                     1826                 073714
     C                     ELSE                                           073714
     C                     MOVE SAEIN     WAEIN                           073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - Delivery Currency must be defined                            073714
     C           SDCCY     IFEQ *BLANK                                    073714
     C***********ISPT      IFEQ 5                                  105749 111607
     C                     ADD  1         E                               073714
     C                     MOVE ' 302'    ERR,E                           073714
     C                     SETON                     1832                 073714
     C***********          END                                     105749 111607
     C**                                                                  073714
     C**   - Delivery Currency must be a valid currency                   073714
     C                     ELSE                                           073714
     C                     MOVE SDCCY     FFCCY                           073714
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 303'    ERR,E                           073714
     C                     SETON                     1832                 073714
     C                     ELSE                                           073714
     C           *LIKE     DEFN CDP       DCDP                            073714
     C                     Z-ADDFFCDP     DCDP                            073714
     C                     END                                            073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - If an FX Option                                              073714
     C           ISPT      IFEQ 5                                         073714
     C**                                                                  073714
     C**   - Counter Currency must be defined                             073714
     C**     and not equal to delivery currency                           073714
     C           SCTCY     IFEQ *BLANK                                    073714
     C           SCTCY     OREQ SDCCY                                     073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 304'    ERR,E                           073714
     C                     SETON                     1839                 073714
     C**                                                                  073714
     C**   - Counter Currency must be a valid currency                    073714
     C                     ELSE                                           073714
     C                     MOVE SCTCY     FFCCY                           073714
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 305'    ERR,E                           073714
     C                     SETON                     1839                 073714
     C                     ELSE                                           073714
     C           *LIKE     DEFN CDP       CCDP                            073714
     C                     Z-ADDFFCDP     CCDP                            073714
     C                     END                                            073714
     C                     END                                            073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - For OTCs, Delivery Currency is Other Currency                073714
     C**   - If an FX option, update Counter Currency                     073714
     C**                                                                  073714
     C                     MOVE SDCCY     WOTHC                           073714
     C           ISPT      IFEQ 5                                         073714
     C                     MOVE SCTCY     WCTCY                           073714
     C                     ELSE                                           073714
     C                     MOVE *BLANK    WCTCY                           073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - Delivery Amount (Contingent amount) must be defined          073714
     C           SCTAM     IFEQ *BLANK                                    073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 306'    ERR,E                           073714
     C                     SETON                     1827                 073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C**   - Delivery Amount must be a valid amount in delivery currency  073714
     C           *IN32     IFEQ '0'                                       073714
     C***********ISPT      IFEQ 5                                  105749 111607
     C                     Z-ADDDCDP      ZADEC   10                      073714
     C           13        SUB  DCDP      ZADIG   20                      073714
     C***********          ELSE                                    105749 111607
     C***********SDCCY     IFEQ *BLANKS                            111204 111607
     C***********          MOVE SISCY     FFCCY                    105749 111607
     C***********          ELSE                                    111204 111607
     C***********          MOVE SDCCY     FFCCY                    111204 111607
     C***********          END                                     111204 111607
     C***********          EXSR FFSTDP                             105749 111607
     C***********          Z-ADDFFCDP     PCDP                     105749 111607
     C***********          Z-ADDPCDP      ZADEC   10               105749 111607
     C***********13        SUB  PCDP      ZADIG   20               105749 111607
     C***********          END                                     105749 111607
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE SCTAM     ZFIELD                          073714
     C                     EXSR ZALIGN                                    073714
     C**                                                                  073714
     C**   - Invalid Delivery Amount                                      073714
     C           *IN,99    IFEQ '1'                                       073714
     C********** ZFIELD    OREQ *ZERO                              073714 105749
     C           ZFIELD    OREQ *BLANKS                                   105749
     C           ZFIELD    OREQ *ZERO                                     111607
     C                     ADD  1         E                               073714
     C                     MOVE ' 307'    ERR,E                           073714
     C                     SETON                     1827                 073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C**   - Edit Delivery Amount For Re-Display                          073714
     C                     MOVE ZFIELD    WCTAM                           073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SCTAM                           073714
     C                     END                                            073714
     C                     END                                            073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - If an FX Option                                              073714
     C           ISPT      IFEQ 5                                         073714
     C**                                                                  073714
     C**   - Counter Amount must be defined                               073714
     C           SCCAM     IFEQ *BLANK                                    073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 308'    ERR,E                           073714
     C                     SETON                     1838                 073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C**   - Counter Amount must be a valid amount in counter currency    073714
     C           *IN39     IFEQ '0'                                       073714
     C                     Z-ADDCCDP      ZADEC   10                      073714
     C           13        SUB  CCDP      ZADIG   20                      073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE SCCAM     ZFIELD                          073714
     C                     EXSR ZALIGN                                    073714
     C**                                                                  073714
     C**   - Invalid Counter Amount                                       073714
     C           *IN,99    IFEQ '1'                                       073714
     C********** ZFIELD    OREQ *ZERO                              073714 105749
     C           ZFIELD    OREQ *BLANKS                                   105749
     C           ZFIELD    OREQ *ZERO                                     111607
     C                     ADD  1         E                               073714
     C                     MOVE ' 309'    ERR,E                           073714
     C                     SETON                     1838                 073714
     C                     ELSE                                           073714
     C**                                                                  073714
     C**   - Edit Counter Amount For Re-Display                           073714
     C                     MOVE ZFIELD    WCCAM                           073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SCCAM                           073714
     C                     END                                            073714
     C                     END                                            073714
     C                     END                                            073714
     C*                                                                   098644
     C**  Initialise Counter Amount to 0 if not OTC FX Option             098644
     C                     ELSE                                           098644
     C           SCCAM     IFEQ *BLANKS                                   105749
     C                     Z-ADD0         WCCAM                           098644
     C                     END                                            105749
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - Premium (Instrument) Currency must be defined                073714
     C           SISCY     IFEQ *BLANK                                    073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 310'    ERR,E                           073714
     C                     SETON                     1840                 073714
     C**                                                                  073714
     C**   - Premium (Instrument) Currency must be a valid currency       073714
     C                     ELSE                                           073714
     C                     MOVE SISCY     FFCCY                           073714
     C                     MOVE *IN84     WIN84                           CFF007
     C                     EXSR FFSTDP                                    073714
     C                     MOVE WIN84     *IN84                           CFF007
     C           *IN89     IFEQ '1'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 311'    ERR,E                           073714
     C                     SETON                     1840                 073714
     C                     ELSE                                           073714
     C           *LIKE     DEFN CDP       PCDP                            073714
     C                     Z-ADDFFCDP     PCDP                            073714
     C                     MOVE SISCY     WISCY                           073714
     C                     END                                            073714
     C                     END                                            073714
     C**                                                                  CFF001
     C** - If Enhanced OTC not present, premium currency must be          CFF001
     C**   either the delivery currency or the counter currency           CFF001
     C           *IN40     IFEQ '0'                                       CFF001
     C           CFF001    ANDNE'Y'                                       CFF001
     C           SISCY     IFNE SDCCY                                     CFF001
     C           SISCY     ANDNESCTCY                                     CFF001
     C***********ISPT      IFEQ 5                                  105749 111607
     C                     ADD  1         E                               CFF001
     C                     MOVE ' 311'    ERR,E                           CFF001
     C                     SETON                     1840                 CFF001
     C***********          END                                     105749 111607
     C                     END                                            CFF001
     C                     END                                            CFF001
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - Premium Up front                                             073714
     C           SPUPF     IFNE 'Y'                                       073714
     C           SPUPF     ANDNE'N'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 312'    ERR,E                           073714
     C                     SETON                     1841                 073714
     C                     ELSE                                           073714
     C                     MOVE SPUPF     WPUPF                           073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   - If an FX Option                                              073714
     C           ISPT      IFEQ 5                          b1             073714
     C**                                                                  073714
     C**   - Quotation Convention                                         073714
     C           SQOTC     IFNE *BLANK                     b2             073714
     C                     MOVE SQOTC     QDIGT   1                       073714
     C                     MOVELSQOTC     QSIGN   1                       073714
     C**   - Can be +/-  1-3   Only the first character can contain a sign073714
     C**     First character is 'QSIGN', second 'QDIGT'                   073714
     C           QDIGT     IFEQ *BLANK                     b3             073714
     C**                                                                  073714
     C**   - If second character is blank first must contain digit        073714
     C           QSIGN     IFLT '0'                        b4             073714
     C           QSIGN     ORGT '3'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 313'    ERR,E                           073714
     C                     SETON                     1842                 073714
     C                     ELSE                            x4             073714
     C**                                                                  073714
     C**   - Format field if not in error                                 073714
     C                     MOVE QSIGN     WQOTC                           073714
     C                     END                             e4             073714
     C**                                                                  073714
     C**   - Second character non-blank - first character must be +,- or B073714
     C                     ELSE                            x3             073714
     C           QSIGN     IFNE *BLANK                     b4             073714
     C           QSIGN     ANDNE'+'                                       073714
     C           QSIGN     ANDNE'-'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 314'    ERR,E                           073714
     C                     SETON                     1842                 073714
     C                     ELSE                            x4             073714
     C**                                                                  073714
     C**   - First character valid, second must be a digit                073714
     C           QDIGT     IFLT '0'                        b5             073714
     C           QDIGT     ORGT '3'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 315'    ERR,E                           073714
     C                     SETON                     1842                 073714
     C                     END                             e5             073714
     C                     END                             e4             073714
     C**                                                                  073714
     C**   - Format field if not in error                                 073714
     C           *IN42     IFEQ '0'                        b4             073714
     C                     MOVE QDIGT     WQOTC                           073714
     C           QSIGN     IFEQ '-'                        b5             073714
     C                     Z-SUBWQOTC     WQOTC                           073714
     C                     END                             e5             073714
     C                     END                             e4             073714
     C                     END                             e3             073714
     C                     END                             e2             073714
     C                     END                             e1             073714
     C**                                                                  073714
     C**   - If blank, initialize file fields                             073714
     C           SQOTC     IFEQ *BLANK                                    073714
     C           SQOTC     OREQ ' 0'                                      117558
     C                     Z-ADD0         WQOTC                           073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   -  Expiry Date (Final Transaction Date)                        073714
     C                     MOVELSFTDT     WTSTN7                          073714
     C                     TESTN          WTSTN7     75                   073714
     C**   - if numeric                                                   073714
     C           *IN75     IFEQ '1'                                       073714
     C                     MOVE SFTDT     ZDATE                           073714
     C                     EXSR ZDATE1                                    073714
     C                     END                                            073714
     C**                                                                  073714
     C**   - invalid format or not numeric                                073714
     C           *IN99     IFEQ '1'                                       073714
     C           *IN75     OREQ '0'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 316'    ERR,E                           073714
     C                     SETON                     1844                 073714
     C                     ELSE                                           073714
     C                     Z-ADDZDAYNO    WFTDT                           073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVELZADATE    WFTDTA  7                       073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   -  Expiry Time (Final Transaction Time)                        073714
     C                     MOVELSFTTMP    WTSTN5  5                       073714
     C                     TESTN          WTSTN5     75                   073714
     C**                                                                  073714
     C**   - invalid format or not numeric                                073714
     C           *IN75     IFEQ '0'                                       073714
     C           SFTTML    ORNE 'AM'                                      073714
     C           SFTTML    ANDNE'PM'                                      073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 317'    ERR,E                           073714
     C                     SETON                     1845                 073714
     C                     ELSE                                           073714
     C                     MOVE SFTTM     WFTTM                           073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   -  Settlement Date                                             073714
     C                     MOVELSSETD     WTSTN7                          073714
     C                     TESTN          WTSTN7     75                   073714
     C**   - if numeric                                                   073714
     C           *IN75     IFEQ '1'                                       073714
     C                     MOVE SSETD     ZDATE                           073714
     C                     EXSR ZDATE1                                    073714
     C                     END                                            073714
     C**                                                                  073714
     C**   - invalid format or not numeric                                073714
     C           *IN99     IFEQ '1'                                       073714
     C           *IN75     OREQ '0'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 318'    ERR,E                           073714
     C                     SETON                     1846                 073714
     C                     ELSE                                           073714
     C                     Z-ADDZDAYNO    WSETD                           073714
     C**                                                                  073714
     C**   -  Must not be less than the expiry date (final transaction    073714
     C**      date (only if that date is not in error).                   073714
     C           WSETD     IFLT WFTDT                                     073714
     C           *IN44     ANDEQ'0'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 319'    ERR,E                           073714
     C                     SETON                     1846                 073714
     C                     END                                            073714
     C                     END                                            073714
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   -  Set ticks denominator                                       073714
     C                     Z-ADD100       TKDM                            073714
      *                                                                   CFF006
      ** Initialise Fractional Ticks Indicator if CFF006 is installed     CFF006
      *                                                                   CFF006
     C           CFF006    IFEQ 'Y'                                       CFF006
     C                     MOVE 'N'       FRTK    1                       CFF006
     C                     ENDIF                                          CFF006
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**   -  If FX option                                                073714
     C**                                                                  073714
     C**      Determine minimum price fluctuation and tick value          073714
     C           ISPT      IFEQ 5                          b1             073714
     C***********          Z-ADD0.000001  WMNPF                     073714152234
     C                     Z-ADD0.0000001 WMNPF                           152234
     C           *IN27     IFEQ '0'                        b2             073714
     C           *IN32     ANDEQ'0'                                       073714
     C           *IN40     ANDEQ'0'                                       073714
     C           *IN42     ANDEQ'0'                                       073714
     C                     Z-ADDWCTAM     ZAMFR                           073714
     C           4         ADD  WQOTC     Z010                            073714
     C           WMNPF     MULT POWER,Z010ZEXR                            073714
     C                     Z-ADDDCDP      ZFCDP                           073714
     C                     Z-ADDPCDP      ZTCDP                           073714
     C                     EXSR ZAMCON                                    073714
     C                     Z-ADDZAMTO     WTKVL     H                     073714
     C                     END                             e2             073714
     C**------------------------------------------------------------------073714
     C                     ELSE                            x1             073714
     C**                                                                  073714
     C**   -  If not FX option                                            073714
     C**                                                                  073714
     C**      Validate tick value                                         073714
     C**      (if premium currency is not in error)                       073714
     C           *IN40     IFEQ '0'                        b2             073714
     C           STKVL     IFEQ *BLANK                     b3             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 320'    ERR,E                           073714
     C                     SETON                     1847                 073714
     C                     ELSE                            x3             073714
     C**                                                                  073714
     C**   - Tick value must be a valid amount in premium currency        073714
     C           PCDP      ADD  2         ZADEC                           073714
     C           10        SUB  ZADEC     ZADIG                           073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE STKVL     ZFIELD                          073714
     C                     EXSR ZALIGN                                    073714
     C           *IN,99    IFEQ '0'                        b4             073714
     C           PCDP      ADD  5         ZADEC                           073714
     C           14        SUB  ZADEC     ZADIG                           073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE STKVL     ZFIELD                          073714
     C                     EXSR ZALIGN                                    073714
     C                     END                             e4             073714
     C**                                                                  073714
     C**   - Invalid tick value                                           073714
     C           *IN,99    IFEQ '1'                        b4             073714
     C********** ZFIELD    OREQ *ZERO                              073714 105749
     C           ZFIELD    OREQ *BLANKS                                   105749
     C           ZFIELD    OREQ *ZERO                                     111607
     C                     ADD  1         E                               073714
     C                     MOVE ' 321'    ERR,E                           073714
     C                     SETON                     1847                 073714
     C                     ELSE                            x4             073714
     C**                                                                  073714
     C**   - Edit tick value for re-display                               073714
     C                     MOVE ZFIELD    WTKVL                           073714
     C                     Z-ADDWTKVL     Z152      H                     073714
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE Z152      ZFIELD                          073714
     C           PCDP      ADD  2         ZADEC                           073714
     C           10        SUB  ZADEC     ZADIG                           073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    STKVL                           073714
     C                     END                             e4             073714
     C                     END                             e3             073714
     C                     END                             e2             073714
     C**                                                                  073714
     C**      Validate minimum price fluctuation                          073714
     C           SMNPF     IFEQ *BLANK                     b2             073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 322'    ERR,E                           073714
     C                     SETON                     1848                 073714
     C                     ELSE                            x2             073714
     C**                                                                  073714
     C**   - Minimum price fluctuation must be a valid number             073714
     C/COPY WNCPYSRC,FF0020CR68
     C***********          Z-ADD7         ZADEC                     073714CFF004
     C***********          Z-ADD3         ZADIG                     073714CFF004
     C                     Z-ADD8         ZADEC                           CFF004
     C                     Z-ADD6         ZADIG                           CFF004
     C/COPY WNCPYSRC,FF0020CR69
     C                     MOVEL*BLANK    ZFIELD                          073714
     C                     MOVE SMNPF     ZFIELD                          073714
     C                     EXSR ZALIGN                                    073714
     C**                                                                  073714
     C**   - Invalid minimum price fluctuation                            073714
     C           *IN,99    IFEQ '1'                        b3             073714
     C********** ZFIELD    OREQ *ZERO                              073714 105749
     C           ZFIELD    OREQ *BLANKS                                   105749
     C           ZFIELD    OREQ *ZERO                                     111607
     C                     ADD  1         E                               073714
     C                     MOVE ' 323'    ERR,E                           073714
     C                     SETON                     1848                 073714
     C                     ELSE                            x3             073714
     C**                                                                  073714
     C**   - Edit minimum price fluctuation For re-display                073714
     C                     MOVE ZFIELD    WMNPF                           073714
     C                     EXSR ZEDIT                                     073714
     C                     MOVE ZFIELD    SMNPF                           073714
     C                     END                             e3             073714
     C                     END                             e2             073714
     C                     END                             e1             073714
     C/COPY WNCPYSRC,FF0020C093
     C                     Z-ADD*ZEROS    WTWEI                           CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C           SACTN     ANDEQ'I'                                       CFF007
     C                     MOVE *BLANKS   WUNSE                           CFF007
     C                     MOVE *BLANKS   WTECO                           CFF007
     C                     MOVE *BLANKS   WTNAT                           CFF007
     C                     MOVE *BLANKS   WCRIK                           CFF007
     C                     MOVE *BLANKS   WCCYR                           CFF007
      ** Underlying Security                                              CFF007
     C           SUNSE     IFNE *BLANKS                                   CFF007
     C           BGSECS    ANDEQ'Y'                                       CFF007
     C           SUNSE     CHAINSECTY                71                   CFF007
      *                                                                   CFF007
     C           *IN71     IFEQ '1'                                       CFF007
     C           *IN71     OREQ '0'                                       CFF007
     C           RECISE    ANDNE'D'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 173'    ERR,E                           CFF007
     C                     SETON                     1881                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE SUNSE     WUNSE                           CFF007
      *                                                                   CFF007
      ** Economic Sector                                                  CFF007
      *                                                                   CFF007
     C           STECO     IFEQ *BLANKS                                   CFF007
     C**********           MOVE SIDY      PINCD   3                                  CFF007 BUG23967
     C                     MOVE LOIC      PINCD   3                                         BUG23967
      *                                                                   CFF007
      ** Access Local Industry Codes file                                 CFF007
      *                                                                   CFF007
     C                     CALL 'AOINDSR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           PINCD                           CFF007
     C           SDINDS    PARM SDINDS    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE AOECOS    STECO                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Nature Code                                                      CFF007
      *                                                                   CFF007
     C           STNAT     IFEQ *BLANKS                                   CFF007
     C                     MOVE NATU      STNAT                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Country of Risk                                                  CFF007
      *                                                                   CFF007
     C           SCRIK     IFEQ *BLANKS                                   CFF007
     C                     MOVE SCOR      SCRIK                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Currency of Risk                                                 CFF007
      *                                                                   CFF007
     C           SCCYR     IFEQ *BLANKS                                   CFF007
      *                                                                   CFF007
      ** Access Country Codes File                                        CFF007
      *                                                                   CFF007
     C                     CALL 'AOCTRYR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCRIK                           CFF007
     C           SDCTRY    PARM SDCTRY    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE A4CTAY    SCCYR                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Weighting Code                                                   CFF007
      *                                                                   CFF007
     C           STWEI     IFEQ *BLANKS                                   CFF007
     C                     MOVE WEIC      STWEI                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Economic Sector                                                  CFF007
      *                                                                   CFF007
     C                     CALL 'AOECOSR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           STECO                           CFF007
     C           SDECOS    PARM SDECOS    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 174'    ERR,E                           CFF007
     C                     SETON                     1882                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE PCECOS    WTECO                           CFF007
     C                     MOVE PCECOS    STECO                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Nature Code                                                      CFF007
      *                                                                   CFF007
     C                     CALL 'AONATUR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           STNAT                           CFF007
     C           SDNATU    PARM SDNATU    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 175'    ERR,E                           CFF007
     C                     SETON                     1884                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE TNNATU    WTNAT                           CFF007
     C                     MOVE TNNATU    STNAT                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Country of Risk                                                  CFF007
     C                     CALL 'AOCTRYR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCRIK                           CFF007
     C           SDCTRY    PARM SDCTRY    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 176'    ERR,E                           CFF007
     C                     SETON                     1888                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE A4CNCD    WCRIK                           CFF007
     C                     MOVE A4CNCD    SCRIK                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Currency of Risk                                                 CFF007
      *                                                                   CFF007
     C                     CALL 'AOCURRR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCCYR                           CFF007
     C           SDCURR    PARM SDCURR    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 177'    ERR,E                           CFF007
     C                     SETON                     1873                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE A6CYCD    WCCYR                           CFF007
     C                     MOVE A6CYCD    SCCYR                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Weighting Code                                                   CFF007
      *                                                                   CFF007
     C                     MOVEL'GP'      AOPGM  10                                           CGP001
     C                     MOVE 'AOWEIGR0'AOPGM                                               CGP001
     C**********           CALL 'AOWEIGR0'                                             CFF007 CGP001
     C                     CALL AOPGM                                                         CGP001
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           STWEI                           CFF007
     C********** SDWEIG    PARM SDWEIG    DSSDY                                        CFF007 CGP001
     C           GPWEIG    PARM GPWEIG    @DSFDY                                              CGP001
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 178'    ERR,E                           CFF007
     C                     SETON                     1874                 CFF007
     C                     ELSE                                           CFF007
     C                     MOVE PDWEIG    WTWEI                           CFF007
     C                     MOVE PDWEIG    STWEI                           CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C**------------------------------------------------------------------073714
     C**                                                                  073714
     C**      Check that instrument details match those input             073714
     C           *IN26     IFEQ '0'                        b1             073714
     C           *IN27     ANDEQ'0'                                       073714
     C           *IN32     ANDEQ'0'                                       073714
     C           *IN38     ANDEQ'0'                                       073714
     C           *IN39     ANDEQ'0'                                       073714
     C           *IN40     ANDEQ'0'                                       073714
     C           *IN41     ANDEQ'0'                                       073714
     C           *IN42     ANDEQ'0'                                       073714
     C           *IN44     ANDEQ'0'                                       073714
     C           *IN45     ANDEQ'0'                                       073714
     C           *IN46     ANDEQ'0'                                       073714
     C           *IN47     ANDEQ'0'                                       073714
     C           *IN48     ANDEQ'0'                                       073714
     C           *IN81     ANDEQ'0'                                       CFF007
     C           *IN82     ANDEQ'0'                                       CFF007
     C           *IN84     ANDEQ'0'                                       CFF007
     C           *IN88     ANDEQ'0'                                       CFF007
     C           *IN73     ANDEQ'0'                                       CFF007
     C           *IN74     ANDEQ'0'                                       CFF007
     C/COPY WNCPYSRC,FF0020C094
     C**                                                                  073714
     C**   -  If instrument type exists                                   073714
     C           ISTI      IFEQ 'Y'                        b2             073714
     C           FINDET    IFNE WINDET                     b3             073714
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP49                                           S01408
      *                                                                   S01408
     C                     ADD  1         E                               073714
     C                     MOVE ' 324'    ERR,E                           073714
     C           AEIN      IFNE WAEIN                      b4             073714
     C                     SETON                         26               073714
     C                     END                             e4             073714
     C           FFCTAM    IFNE WCTAM                      b4             073714
     C                     SETON                         27               073714
     C                     END                             e4             073714
     C           OTHC      IFNE WOTHC                      b4             073714
     C                     SETON                         32               073714
     C                     END                             e4             073714
     C           CCAM      IFNE WCCAM                      b4             073714
     C                     SETON                         38               073714
     C                     END                             e4             073714
     C           CTCY      IFNE WCTCY                      b4             073714
     C                     SETON                         39               073714
     C                     END                             e4             073714
     C           ISCY      IFNE WISCY                      b4             073714
     C                     SETON                         40               073714
     C                     END                             e4             073714
     C           PUPF      IFNE WPUPF                      b4             073714
     C                     SETON                         41               073714
     C                     END                             e4             073714
     C           QOTC      IFNE WQOTC                      b4             073714
     C                     SETON                         42               073714
     C                     END                             e4             073714
     C           FTDT      IFNE WFTDT                      b4             073714
     C                     SETON                         44               073714
     C                     END                             e4             073714
     C           FTTM      IFNE WFTTM                      b4             073714
     C                     SETON                         45               073714
     C                     END                             e4             073714
     C           SETD      IFNE WSETD                      b4             073714
     C                     SETON                         46               073714
     C                     END                             e4             073714
     C           TKVL      IFNE WTKVL                      b4             073714
     C                     SETON                         47               073714
     C                     END                             e4             073714
     C           MNPF      IFNE WMNPF                      b4             073714
     C                     SETON                         48               073714
     C                     END                             e4             073714
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C           UNSE      IFNE WUNSE                      b4             CFF007
     C                     SETON                         81               CFF007
     C                     ENDIF                                          CFF007
     C           TECO      IFNE WTECO                                     CFF007
     C                     SETON                         82               CFF007
     C                     ENDIF                                          CFF007
     C           TNAT      IFNE WTNAT                                     CFF007
     C                     SETON                         84               CFF007
     C                     ENDIF                                          CFF007
     C           CRIK      IFNE WCRIK                                     CFF007
     C                     SETON                         88               CFF007
     C                     ENDIF                                          CFF007
     C           CCYR      IFNE WCCYR                                     CFF007
     C                     SETON                         73               CFF007
     C                     ENDIF                                          CFF007
     C           TWEI      IFNE WTWEI                                     CFF007
     C                     SETON                         74               CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C095
     C                     SETON                     182549               073714
     C                     END                             e3             073714
     C                     ELSE                            x2             073714
     C                     MOVELWINDET    FINDET                          073714
     C                     END                             e2             073714
     C**                                                                  073714
     C                     ELSE                            x1             073714
     C                     SETON                     1825                 073714
     C                     END                             e1             073714
     C**------------------------------------------------------------------073714
     C                     ENDSR                                          073714
     C**                                                                  073714
     C********************************************************************073714
     C/EJECT                                                              073714
     C********************************************************************073714
     C**                                                                 *073714
     C**   ZAMCON SR.-  Amount Conversion                                *073714
     C**   ~~~~~~~~~                                                     *073714
     C**                                                                 *073714
     C**      Called From                  Calls                         *073714
     C**       SR. VOTCD                                                 *073714
     C**       SR. VSTRP                                                 *073714
     C**       SR. VSPTP                                                 *CPL002
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           ZAMCON    BEGSR                           **ZAMCON  SR***073714
     C                     Z-ADDZAMFR     ZAMFR  150                      073714
     C                     Z-ADDZEXR      ZEXR   159                      073714
     C                     Z-ADDZFCDP     ZFCDP   10                      073714
     C                     Z-ADDZTCDP     ZTCDP   10                      073714
     C           ZTCDP     SUB  ZFCDP     Z010    10                      073714
     C                     ADD  4         Z010                            073714
     C           POWER,Z010IFLT 1                                         073714
     C           ZAMFR     MULT POWER,Z010Z153   153       b1             073714
     C           Z153      MULT ZEXR      ZAMTO  205H                     073714
     C                     ELSE                            x1             073714
     C           ZAMFR     MULT POWER,Z010Z150   150                      073714
     C           Z150      MULT ZEXR      ZAMTO     H                     073714
     C                     END                             e1             073714
     C                     ENDSR                                          073714
     C**                                                                  073714
     C********************************************************************073714
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VYRMTH SR. -  Validate  Year/Month                            *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VYRMTH    BEGSR                           ** VYRMTH SR **
     C**                                                                  CPM003
     C**   Save content of *IN76                                          CPM003
     C                     MOVE *IN76     WWIN76  1                       CPM003
     C**
     C**   Month
     C                     Z-ADD1         M       20
     C           SMTHN     LOKUPZMNM,M                   76
     C**
     C**   - if not valid short name
     C           *IN76     IFEQ '0'
     C           E         ADD  1         E
     C                     MOVE ' 043'    ERR,E
     C                     SETON                     1826
     C**
     C                     ELSE
     C                     Z-ADDM         WMTHN
     C                     Z-ADDWMTHN     WM
     C                     END
     C**                                                                  CPM003
     C**   Restore content of *IN76                                       CPM003
     C                     MOVE WWIN76    *IN76                           CPM003
     C**
     C**   Year
     C                     MOVELSYRNO     WTSTN3
     C                     TESTN          WTSTN3     75
     C**   - if not numeric
     C           *IN75     IFEQ '0'
     C           E         ADD  1         E
     C                     MOVE ' 044'    ERR,E
     C                     SETON                     1827
     C**
     C                     ELSE
     C                     MOVE SYRNO     WYRNO
     C                     Z-ADDWYRNO     WY
     C*                                                                   E35979
     C* Midas Calender began in 1972, so if Year is *LT 72, it must be    E35979
     C* in the next Century.                                              E35979
     C*                                                                   E35979
     C                     Z-ADD0         WCN                             E35979
     C           WY        IFLT 72                                        E35979
     C                     Z-ADD20        WCN                             E35979
     C                     ELSE                                           E35979
     C                     Z-ADD19        WCN                             E35979
     C                     END                                            E35979
     C*                                                                   E35979
     C                     END
     C**
     C           *IN25     IFEQ '1'
     C           *IN26     OREQ '1'
     C           *IN27     OREQ '1'
     C                     GOTO VYMEND
     C                     END
     C/SPACE 2
     C**   Year/Month - must represent valid  Traded/Forward Spot month
     C**   ( WYM )
     C**   1. Determine Current Trading Year-Month
     C                     MOVE CTDATE    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     CTD
     C**
     C                     MOVE CT3       CY
     C*                                                                   E35979
     C* Midas Calender began in 1972, so if Year is *LT 72, it must be    E35979
     C* in the next Century.                                              E35979
     C*                                                                   E35979
     C                     Z-ADD0         CCN                             E35979
     C           CY        IFLT 72                                        E35979
     C                     Z-ADD20        CCN                             E35979
     C                     ELSE                                           E35979
     C                     Z-ADD19        CCN                             E35979
     C                     END                                            E35979
     C*                                                                   E35979
     C           *IN98     IFEQ '1'
     C                     MOVE CT1       CM
     C                     ELSE
     C                     MOVE CT2       CM
     C                     END
     C**
     C**   - must not be before  Current Year-Month
     C           WYM       IFLT CYM
     C           E         ADD  1         E
     C                     MOVE ' 045'    ERR,E
     C                     SETON                     182627
     C                     GOTO VYMEND
     C                     END
     C**
     C**   2. Determine 'Furthest Traded Fwd Period' / Max. Year-Month
     C                     Z-ADDCM        MTM
     C                     Z-ADDCY        MTY
     C                     MOVEAISMQ      IMQ
     C                     Z-ADD0         Q       20
     C**
     C           Q         DOWLTTFPD
     C**     - traded month
     C           IMQ,MTM   IFEQ 'Y'
     C                     ADD  1         Q
     C                     END
     C**
     C           Q         IFNE TFPD
     C                     ADD  1         MTM
     C**     - new year
     C           MTM       IFGT 12
     C                     Z-ADD1         MTM
     C                     ADD  1         MTY
     C                     END
     C**
     C                     END
     C**
     C                     END
     C*                                                                   E35979
     C* Midas Calender began in 1972, so if Year is *LT 72, it must be    E35979
     C* in the next Century.                                              E35979
     C*                                                                   E35979
     C                     Z-ADD0         MTCN                            E35979
     C           MTY       IFLT 72                                        E35979
     C                     Z-ADD20        MTCN                            E35979
     C                     ELSE                                           E35979
     C                     Z-ADD19        MTCN                            E35979
     C                     END                                            E35979
     C**
     C**   - must not be after  Maximum Traded Year-Month (Furthest TFPD)
     C           WYM       IFGT MTYM
     C           E         ADD  1         E
     C                     MOVE ' 045'    ERR,E
     C                     SETON                     182627
     C                     GOTO VYMEND
     C                     END
     C**
     C**   3. Quoted Traded Month ?
     C           IMQ,WM    IFEQ 'Y'
     C**     - valid Year-Month
     C                     GOTO VYMEND
     C                     END
      *                                                                   084791
      * If not a quoted month and Fwd Spot Months is zero the date is     084791
      * in error.                                                         084791
     C           FSPM      IFEQ 0                                         084791
     C           E         ADD  1         E                               084791
     C                     MOVE ' 045'    ERR,E                           084791
     C                     SETON                     182627               084791
     C                     GOTO VYMEND                                    084791
     C                     END                                            084791
     C**
     C**   4. Determine 'Furthest Fwd Spot' / Max. Spot Year-Month
     C**
     C********** FSPM      IFEQ 0                                         084791
     C**********           Z-ADD0         MSYM                            084791
     C**********           ELSE                                           084791
     C**
     C                     Z-ADDCM        MSM
     C                     Z-ADDCY        MSY
     C                     Z-ADD0         Q
     C**
     C           Q         DOWLTFSPM
     C**
     C                     ADD  1         Q
     C**
     C           Q         IFNE FSPM
     C                     ADD  1         MSM
     C**     - new year
     C           MSM       IFGT 12
     C                     Z-ADD1         MSM
     C                     ADD  1         MSY
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C************         END                                            084791
     C*                                                                   E35979
     C* Midas Calender began in 1972, so if Year is *LT 72, it must be    E35979
     C* in the next Century.                                              E35979
     C*                                                                   E35979
     C                     Z-ADD0         MSCN                            E35979
     C           MSY       IFLT 72                                        E35979
     C                     Z-ADD20        MSCN                            E35979
     C                     ELSE                                           E35979
     C                     Z-ADD19        MSCN                            E35979
     C                     END                                            E35979
     C**
     C**   - must not be after  Maximum Spot Year-Month (Furthest FSPM)
     C           WYM       IFGT MSYM
     C           E         ADD  1         E
     C                     MOVE ' 045'    ERR,E
     C                     SETON                     182627
     C                     END
     C**
     C           VYMEND    ENDSR                           *** VYMEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VPCAL SR. -  Validate  Put/Call indicator                     *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VPCAL     BEGSR                           *** VPCAL SR **
     C**
     C*****'Futures'*(Instr.*Process*Type*=*1,2,3)*-*must*bE*blank***     AUS022
     C**   'Futures' (Instr. Process Type = 1,2,3,7) - must be blank      AUS022
     C**
     C           ISPT      IFLE 3
     C           ISPT      OREQ 7                                         AUS022
     C**
     C           SPCAL     IFNE ' '
     C           E         ADD  1         E
     C                     MOVE ' 062'    ERR,E
     C                     SETON                     1828
     C                     END
     C**
     C                     ELSE
     C**
     C**   'Options' (Instr. Process Type = 4,5,6) - must be 'P' or 'C'
     C**
     C           SPCAL     IFNE 'P'
     C           SPCAL     ANDNE'C'
     C           E         ADD  1         E
     C                     MOVE ' 061'    ERR,E
     C                     SETON                     1828
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VSTRP SR. -  Validate  Strike Price                           *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VSTRP     BEGSR                           *** VSTRP SR **
     C**
     C*****'Futures'*(Instr.*Process*Type*=*1,2,3)*-*must*be*blank***     AUS022
     C**   'Futures' (Instr. Process Type = 1,2,3,7) - must be blank      AUS022
     C**
     C           ISPT      IFLE 3
     C           ISPT      OREQ 7                                         AUS022
     C**
     C           SSTRP     IFNE *BLANK
     C           E         ADD  1         E
     C                     MOVE ' 063'    ERR,E
     C                     SETON                     1829
     C                     END
     C**
     C                     ELSE
     C**
     C**   'Options' (Instr. Process Type = 4,5,6) - must be entered
     C**
     C           SSTRP     IFEQ *BLANK
     C           E         ADD  1         E
     C                     MOVE ' 063'    ERR,E
     C                     SETON                     1829
     C                     GOTO VSPEND
     C                     END
     C**
     C           SMRKT     IFNE '  '
     C**   If a Market Instrument Trade, access Future Type Ref. for
     C**    Min Price Fluctn + Ticks Denom.
     C**
     C                     MOVELSMRKT     KFTRF   5
     C                     MOVE FTRF      KFTRF
     C**
     C           KFTRF     CHAININTYP2DF             71
     C  N71      RECI2     COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '06'      DBASE            ** DBERR  06 **S01117
     C                     Z-ADD6         DBASE            ** DBERR  06 **S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELKFTRF     DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C**
     C                     ELSE
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     END
     C**
     C                     MOVE SSTRP     FFSPRC
     C                     EXSR FFPRVL
     C**   - invalid format
     C           *IN89     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 065'    ERR,E
     C                     SETON                     1829
     C                     SETOF                     89
     C                     GOTO VSPEND
     C                     END
     C**
     C                     Z-ADDFFPRIC    WSTRP
     C**   - cannot be zero
     C           WSTRP     IFEQ 0
     C           E         ADD  1         E
     C                     MOVE ' 064'    ERR,E
     C                     SETON                     1829
     C                     GOTO VSPEND
     C                     END
     C**                                                                  073714
     C**   - If FX OTC, must match exchange rate between deal amounts     073714
     C           ISPT      IFEQ 5                                         073714
     C           SMRKT     ANDEQ'  '                                      073714
     C                     Z-ADDWCTAM     ZAMFR                           073714
     C                     Z-ADDWSTRP     ZEXR                            073714
     C                     Z-ADDDCDP      ZFCDP                           073714
     C                     Z-ADDCCDP      ZTCDP                           073714
     C                     EXSR ZAMCON                                    073714
     C           ZAMTO     ADD  1         ZAMTA1 205                      073714
     C           ZAMTO     SUB  1         ZAMTS1 205                      073714
     C           WCCAM     IFGT ZAMTA1                                    073714
     C           WCCAM     ORLT ZAMTS1                                    073714
     C                     Z-ADDWCCAM     ZAMFR                           073714
     C                     Z-ADDWSTRP     ZEXR                            073714
     C                     Z-ADDCCDP      ZFCDP                           073714
     C                     Z-ADDDCDP      ZTCDP                           073714
     C                     EXSR ZAMCON                                    073714
     C           ZAMTO     ADD  1         ZAMTA1                          073714
     C           ZAMTO     SUB  1         ZAMTS1                          073714
     C           WCTAM     IFGT ZAMTA1                                    073714
     C           WCTAM     ORLT ZAMTS1                                    073714
     C**   - invalid format                                               073714
     C           E         ADD  1         E                               073714
     C                     MOVE ' 065'    ERR,E                           073714
     C                     SETON                     1829                 073714
     C                     GOTO VSPEND                                    073714
     C                     END                                            073714
     C                     END                                            073714
     C                     END                                            073714
     C**   - format price
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SSTRP
     C**
     C                     END
     C**
     C           VSPEND    ENDSR                           *** VSPEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   VSPTP SR. -  Validate  Spot Price                             *CPL002
     C**   ~~~~~~~~~                                                     *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. VINSRT                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
     C**                                                                  CPL002
     C           VSPTP     BEGSR                           *** VSPTP SR **CPL002
      *                                                                   CPL002
     C                     MOVEL'0'       *IN83                           CPL002
      *                                                                   CPL002
      **   'Futures' (Instr. Process Type = 1,2,3,7) - must be blank      CPL002
      *                                                                   CPL002
     C           ISPT      IFLE 3                                         CPL002
     C           ISPT      OREQ 7                                         CPL002
      *                                                                   CPL002
     C           SSPTP     IFNE *BLANK                                    CPL002
     C           E         ADD  1         E                               CPL002
     C                     MOVE ' 401'    ERR,E                           CPL002
     C                     SETON                     1883                 CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     ELSE                                           CPL002
      *                                                                   CPL002
     C           SMRKT     IFNE '  '                                      CPL002
      *                                                                   CPL002
      **   If a Market Instrument Trade, access Future Type Ref. for      CPL002
      **    Min Price Fluctn + Ticks Denom.                               CPL002
      *                                                                   CPL002
     C                     MOVELSMRKT     KFTRF                           CPL002
     C                     MOVE FTRF      KFTRF                           CPL002
      *                                                                   CPL002
     C           KFTRF     CHAININTYP2DF             71                   CPL002
     C  N71      RECI2     COMP 'D'                  7171                 CPL002
      *                                                                   CPL002
     C           *IN71     IFEQ '1'                                       CPL002
     C           *LOCK     IN   LDA                                       CPL002
     C                     Z-ADD34        DBASE            ** DBERR  34 **CPL002
     C                     MOVE 'INTYP'   DBFILE                          CPL002
     C                     MOVELKFTRF     DBKEY                           CPL002
     C                     EXSR DBERR                                     CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     Z-ADDTKDM2     FFTKDM                          CPL002
     C                     Z-ADDMNPF2     FFMNPF                          CPL002
     C*                                                                   CPL002
     C*** If Spot price not being enter, default it from Spot price       CPL002
     C*** File.                                                           CPL002
     C*                                                                   CPL002
     C           SSPTP     IFEQ *BLANK                                    CPL002
     C           ISTT      CHAINPRISP1               71                   CPL002
     C           *IN71     IFEQ '0'                                       CPL002
     C                     Z-ADDNSPR      FFPRIC                          CPL002
      **   - format price                                                 CPL002
     C                     EXSR FFPRCS                                    CPL002
     C                     MOVE FFSPRC    SSPTP                           CPL002
     C                     MOVE FFSPRC    SMSPT                           CPL002
     C                     END                                            CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     ELSE                                           CPL002
     C                     Z-ADDTKDM      FFTKDM                          CPL002
     C                     Z-ADDMNPF      FFMNPF                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      **   'Options' (Instr. Process Type = 4,5,6) - must be entered      CPL002
      *                                                                   CPL002
     C           SSPTP     IFEQ *BLANK                                    CPL002
     C           E         ADD  1         E                               CPL002
     C                     MOVE ' 402'    ERR,E                           CPL002
     C                     SETON                     1883                 CPL002
     C                     GOTO VSTEND                                    CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     MOVE SSPTP     FFSPRC                          CPL002
     C                     EXSR FFPRVL                                    CPL002
      **   - invalid format                                               CPL002
     C           *IN89     IFEQ '1'                                       CPL002
     C           E         ADD  1         E                               CPL002
     C                     MOVE ' 403'    ERR,E                           CPL002
     C                     SETON                     1883                 CPL002
     C                     SETOF                     89                   CPL002
     C                     GOTO VSTEND                                    CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     Z-ADDFFPRIC    WSPTP                           CPL002
      **   - cannot be zero                                               CPL002
     C           WSPTP     IFEQ 0                                         CPL002
     C           E         ADD  1         E                               CPL002
     C                     MOVE ' 404'    ERR,E                           CPL002
     C                     SETON                     1883                 CPL002
     C                     GOTO VSTEND                                    CPL002
     C                     END                                            CPL002
      **   - format price                                                 CPL002
     C                     EXSR FFPRCS                                    CPL002
     C                     MOVE FFSPRC    SSPTP                           CPL002
     C                     MOVE FFSPRC    SMSPT                           CPL002
      **                                                                  CPL002
     C                     END                                            CPL002
      **                                                                  CPL002
     C           VSTEND    ENDSR                           *** VSTEND *** CPL002
      **        ~~~~~~~~                                                  CPL002
     C********************************************************************CPL002
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VCOPR SR. -  Validate  Contract Price                         *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VCOPR     BEGSR                           *** VCOPR SR **
     C**
     C**   - cannot be blank
     C           SCOPR     IFEQ *BLANK
     C/COPY WNCPYSRC,FF0020C114
     C           E         ADD  1         E
     C                     MOVE ' 072'    ERR,E
     C                     SETON                     1830
     C                     GOTO VCPEND
     C                     END
     C**
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     MOVE SCOPR     FFSPRC
     C                     EXSR FFPRVL
     C**   - invalid format
     C           *IN89     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 073'    ERR,E
     C                     SETON                     1830
     C                     SETOF                     89
     C                     GOTO VCPEND
     C                     END
     C**
     C                     Z-ADDFFPRIC    WCOPR
     C/COPY WNCPYSRC,FF0020C064
     C**   - cannot be zero
     C           WCOPR     IFEQ 0
     C/COPY WNCPYSRC,FF0020C115
     C           E         ADD  1         E
     C                     MOVE ' 072'    ERR,E
     C                     SETON                     1830
     C                     GOTO VCPEND
     C                     END
     C/COPY WNCPYSRC,FF0020C065
     C**   - format price
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SCOPR
     C/SPACE 2
     C**   Warning Errors (process only if Year, Month, Put/Call,
     C**   ~~~~~~~~~~~~~~  Strike Price + Contract Price not in error)
     C**
     C           *IN26     IFEQ '1'
     C           *IN27     OREQ '1'
     C           *IN28     OREQ '1'
     C           *IN29     OREQ '1'
     C                     GOTO VCPEND
     C                     END
     C**
     C/COPY WNCPYSRC,FF0020C116
     C                     MOVE KISTT     KISTTP
     C                     MOVE WYRNO     KYRNOP
     C                     MOVE WMTHN     KMTHNP
     C                     MOVE SPCAL     KPCALP
     C                     MOVE WSTRP     KSTRPP
     C**
     C           KPRICS    CHAINPRICSDF              71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C**   1. No Prices record
     C           *IN71     IFEQ '1'
     C           F         ADD  1         F
     C                     MOVE ' W74'    WERR,F
     C                     SETON                     1930
     C                     GOTO VCPEND
     C                     END
     C**
     C**   Calculate upper and lower limits for the 'New Price'
     C/COPY WNCPYSRC,FF0020C058
     C***********          Z-ADD0         NEWPTK 137                      CFF004
     C***********          Z-ADD0         WCPTKS 137                      CFF004
     C                     Z-ADD0         NEWPTK 178                      CFF004
     C/COPY WNCPYSRC,FF0020CR70
     C                     Z-ADD0         WCPTKS 178                      CFF004
     C/COPY WNCPYSRC,FF0020CR71
     C**
     C**   - if Ticks Denom = 100 , decimal quotation
     C           TKDM      IFEQ 100
     C           WCOPR     MULT 100       WCPTKS
     C           NEWP      MULT 100       NEWPTK
     C**
     C                     ELSE
     C**
     C**   - Convert  Price integer to a No of Ticks
     C           WCPINT    MULT TKDM      WCPTKS
     C           NPINT     MULT TKDM      NEWPTK
     C**
     C**   - Add remaining Ticks to this
     C**
     C**     - if Ticks Denom <= 10  use 1st dec place
     C           TKDM      IFLE 10
     C                     ADD  WCPDP1    WCPTKS
     C                     ADD  NPDP1     NEWPTK
     C                     ELSE
     C**
     C**     - if Ticks Denom <= 99  use 1-2nd dec places
     C           TKDM      IFLE 99
     C                     ADD  WCPDP2    WCPTKS
     C                     ADD  NPDP2     NEWPTK
     C                     ELSE
     C**
     C**     - if Ticks Denom <= 999  use 1-3rd dec places
     C                     ADD  WCPDP3    WCPTKS
     C                     ADD  NPDP3     NEWPTK
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C/COPY WNCPYSRC,FF0020CR72
     C***********NEWPTK    MULT 1.1       MAXTKS 137H                     CFF004
     C***********NEWPTK    MULT 0.9       MINTKS 137H                     CFF004
     C           NEWPTK    MULT 1.1       MAXTKS 178H                     CFF004
     C           NEWPTK    MULT 0.9       MINTKS 178H                     CFF004
     C/COPY WNCPYSRC,FF0020CR73
     C**
     C**   2. Varies from new price by more than 10%
     C           WCPTKS    IFLT MINTKS
     C           WCPTKS    ORGT MAXTKS
     C           F         ADD  1         F
     C                     MOVE ' W75'    WERR,F
     C                     SETON                     1930
     C                     END
     C/COPY WNCPYSRC,FF0020C117
     C**
     C           VCPEND    ENDSR                           *** VCPEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VTRSD SR. -  Validate  Transaction Date                       *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VTRSD     BEGSR                           *** VTRSD SR **
     C*                                                                   S01195
     C**   Reset Holiday field                                            S01195
     C*                                                                   S01195
     C                     MOVE *BLANK    ZIND                            S01195
     C**
     C**   1. If blank, set equal to Current Trading date
     C           STRSD     IFEQ *BLANK
     C                     MOVE CTDATE    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     STRSD
     C                     END
     C**
     C**   2. Valid date format
     C                     MOVELSTRSD     WTSTN7
     C                     TESTN          WTSTN7     75
     C**   - if numeric
     C           *IN75     IFEQ '1'
     C                     MOVE STRSD     ZDATE
     C                     EXSR ZDATE1
     C                     END
     C**
     C**   - invalid format or not numeric
     C           *IN99     IFEQ '1'
     C           *IN75     OREQ '0'
     C           E         ADD  1         E
     C                     MOVE ' 081'    ERR,E
     C                     SETON                     1831
     C                     GOTO VTDEND
     C                     END
     C**
     C                     Z-ADDZDAYNO    WTRSD
     C**
     C**   3. Must not be greater than Current Trading date
     C           WTRSD     IFGT CTDATE
     C           E         ADD  1         E
     C                     MOVE ' 082'    ERR,E
     C                     SETON                     1831
     C                     GOTO VTDEND
     C                     END
     C**
     C**   4. Must not be before Start of Historical Data Period
     C           WTRSD     IFLT STHDP
     C           E         ADD  1         E
     C                     MOVE ' 084'    ERR,E
     C                     SETON                     1831
     C                     GOTO VTDEND
     C                     END
     C**
     C**   5. Must not be after the instrument's Final Transaction Date
     C**   (validate only if instr type, month + year not in error)
     C**   (          and if booking branch not in error)                 S01195
     C**   (          or  if instr type, month + year not in error)       S01195
     C**
     C           *IN25     IFEQ '0'
     C           *IN26     ANDEQ'0'
     C           *IN27     ANDEQ'0'
     C           *IN35     ANDEQ'0'                                       S01195
     C**
     C**   - If booking branch is valid,                                  S01195
     C**     use booking branch location.                                 S01195
     C**   - save BICN for settlement details processing.                 S01195
     C**                                                                  S01195
     C           SBRCD     IFEQ *BLANKS                                   059376
     C                     MOVELPDFBR     SBRCD                           059376
     C                     END                                            059376
     C*                                                                   059376
     C**********           CALL 'AOBRCHR0'                                             S01195 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01195
     C                     PARM '*KEY   ' @OPTN   7                       S01195
     C                     PARM SBRCD     @BRCD   3                       S01195
     C********** SDBRCH    PARM SDBRCH    @DSFDY                                       S01195 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01195
     C           *LOCK     IN   LDA                                       S01195
     C                     Z-ADD24        DBASE            ** DBERR  24 **S01195
     C                     MOVE 'SDBRCHPD'DBFILE                          S01195
     C                     MOVEL@BRCD     DBKEY                           S01195
     C                     MOVEL@OPTN     DBOPTN  7                       S01195
     C                     EXSR DBERR                                     S01195
     C                     ELSE                                           S01117
     C           *LIKE     DEFN A8BICN    BICN                            S01117
     C                     MOVE A8BICN    BICN                            S01117
     C                     END                                            S01195
     C**                                                                  S01195
     C           SMRKT     IFNE '  '
     C**    (Final Trans Date  calculated from the Formula for
     C**     the instrument)
     C                     MOVE FTDF      FFDATC
     C                     Z-ADDWMTHN     FFMTH
     C                     Z-ADDWYRNO     FFYR
     C                     MOVE PMKLC     FFCCY1
     C                     MOVE PMLOC     FFLOC   3                       S01195
     C                     MOVE KCCY      FFCCY2
     C                     MOVE OTHC      FFCCY3
     C                     MOVE *IN81     WIN81                           CFF007
     C                     MOVE *IN82     WIN82                           CFF007
     C                     EXSR FFDATE
     C                     MOVE WIN81     *IN81                           CFF007
     C                     MOVE WIN82     *IN82                           CFF007
     C                     Z-ADDFFDAY     FTDATE  50
     C**
     C                     ELSE
     C                     Z-ADDFTDT      FTDATE
     C                     END
     C**
     C           WTRSD     IFGT FTDATE
     C           E         ADD  1         E
     C                     MOVE ' 085'    ERR,E
     C                     SETON                     1831
     C                     GOTO VTDEND
     C                     END
     C**
     C                     END
     C**
     C**   6. Must not be a Holiday
     C**      Perform validation only when no error on branch code        S01195
     C**                                                                  S01195
     C           *IN35     IFEQ '0'                                       S01195
     C**                                                                  S01195
     C           SMRKT     IFNE '  '
     C                     MOVE PMKLC     ZCCY
     C                     MOVE PMLOC     ZLOC    3                       S01195
     C                     ELSE
     C                     MOVE LOCY      ZCCY
     C                     MOVE LCCD      ZLOC                            S01195
     C                     END
     C**
     C                     Z-ADDWTRSD     ZDAYNO
     C***********          MOVE 'N'       ZOPT                            S01195
     C***********          EXSR ZDATE5                                    S01195
     C                     EXSR ZCHKH                                     S01195
     C**
     C************IN99     IFEQ '1'                                       S01195
     C           ZIND      IFEQ 'H'                                       S01195
     C           E         ADD  1         E
     C                     MOVE ' 083'    ERR,E
     C                     SETON                     1831
     C                     END
     C**                                                                  S01195
     C                     END                                            S01195
     C**
     C           VTDEND    ENDSR                           *** VTDEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************073714
     C**                                                                 *073714
     C**   VVALD SR. -  Validate  Value Date                             *073714
     C**   ~~~~~~~~~                                                     *073714
     C**      Called From                  Calls                         *073714
     C**       SR. VINSRT                                                *073714
     C**       SR. VAMEND                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           VVALD     BEGSR                           *** VVALD SR **073714
     C**                                                                  073714
     C**   1. If blank, set equal to trade (transaction) date             073714
     C**      (only if trade date not in error)                           073714
     C           SVALD     IFEQ *BLANK                                    073714
     C           *IN31     ANDEQ'0'                                       073714
     C                     MOVELSTRSD     SVALD                           073714
     C                     END                                            073714
     C**                                                                  073714
     C**   2. Valid date format                                           073714
     C                     MOVELSVALD     WTSTN7                          073714
     C                     TESTN          WTSTN7     75                   073714
     C**   - if numeric                                                   073714
     C           *IN75     IFEQ '1'                                       073714
     C                     MOVE SVALD     ZDATE                           073714
     C                     EXSR ZDATE1                                    073714
     C                     END                                            073714
     C**                                                                  073714
     C**   - invalid format or not numeric                                073714
     C           *IN99     IFEQ '1'                                       073714
     C           *IN75     OREQ '0'                                       073714
     C                     ADD  1         E                               073714
     C                     MOVE ' 325'    ERR,E                           073714
     C                     SETON                     1843                 073714
     C                     GOTO VVDEND                                    073714
     C                     ELSE                                           073714
     C                     Z-ADDZDAYNO    WVALD                           073714
     C                     END                                            073714
     C**                                                                  073714
     C**                                                                  073714
     C**   3. Must not be less than the trade (transaction) date          073714
     C**      (only if trade date not in error)                           073714
     C           WVALD     IFLT WTRSD                                     073714
     C           *IN31     ANDEQ'0'                                       073714
     C           E         ADD  1         E                               073714
     C                     MOVE ' 326'    ERR,E                           073714
     C                     SETON                     1843                 073714
     C                     GOTO VVDEND                                    073714
     C                     END                                            073714
     C**                                                                  073714
     C**   4. Must not be after the instrument's final transaction date   073714
     C**     (only if final transaction date - expiry date - not in error)073714
     C**                                                                  073714
     C           WVALD     IFGT WFTDT                                     073714
     C           *IN25     ANDEQ'0'                                       073714
     C           *IN44     ANDEQ'0'                                       073714
     C           E         ADD  1         E                               073714
     C                     MOVE ' 327'    ERR,E                           073714
     C                     SETON                     1843                 073714
     C                     GOTO VVDEND                                    073714
     C                     END                                            073714
     C**                                                                  073714
     C*****5.*Must*not*be*a*holiday***                              087338073714
     C**   5. Must not be a holiday in premium currency                   087338
     C**     (only if branch code not in error)                           073714
     C**                                                                  073714
     C           *IN35     IFEQ '0'                                       073714
     C***********          MOVE LOCY      ZCCY                     073714 087338
     C                     MOVE SISCY     ZCCY                            087338
     C                     MOVE LCCD      ZLOC                            073714
     C                     Z-ADDWVALD     ZDAYNO                          073714
     C                     MOVE *BLANK    ZIND                            073714
     C                     EXSR ZCHKH                                     073714
     C**                                                                  073714
     C           ZIND      IFEQ 'H'                                       073714
     C           E         ADD  1         E                               073714
     C                     MOVE ' 328'    ERR,E                           073714
     C                     SETON                     1843                 073714
     C                     END                                            073714
     C**                                                                  073714
     C                     END                                            073714
     C**                                                                  073714
     C**                                                                  073714
     C           VVDEND    ENDSR                           *** VVDEND *** 073714
     C**        ~~~~~~~~                                                  073714
     C**                                                                  073714
     C********************************************************************073714
     C/EJECT                                                              073714
     C********************************************************************073714
     C**                                                                 *073714
     C**   CPRMD SR. -  Calculate Premium For Display                    *073714
     C**   ~~~~~~~~~                                                     *073714
     C**      Called From                  Calls                         *073714
     C**       SR. VINSRT                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           CPRMD     BEGSR                           *** CPRMD SR **073714
     C**                                                                  073714
     C**   - If fields are invalid                                        073714
     C           *IN24     IFEQ '1'                                       073714
     C           *IN25     OREQ '1'                                       073714
     C           *IN30     OREQ '1'                                       073714
     C           *IN19     ANDEQ'0'                                       073714
     C                     MOVE *BLANK    SPREM                           073714
     C                     ELSE                                           073714
     C                     Z-ADDWNUCO     FFNOC                           073714
     C                     Z-ADDWCOPR     FFPRIC                          073714
     C                     Z-ADDTKDM      FFTKDM                          073714
     C                     Z-ADDMNPF      FFMNPF                          073714
     C                     Z-ADDTKVL      FFTKVL                          073714
     C                     Z-ADDSTRPTR    FFSTRP                          136056
     C                     EXSR FFPMCL                                    073714
     C                     Z-ADDFFPREM    ZFLD15                          073714
     C                     Z-ADDPCDP      ZDECS                           073714
     C                     MOVE 'J'       ZECODE                          073714
     C                     EXSR ZSEDIT                                    073714
     C                     MOVE ZOUT21    SPREM                           073714
     C                     END                                            073714
     C                     ENDSR                                          073714
     C********************************************************************073714
     C/EJECT                                                              073714
     C********************************************************************
     C**                                                                 *
     C**   VBOCO SR. -  Validate  Broker                                 *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *S01117
     C*********SR.*VINSRT*******************SR.*VXNOSM********************S01117
     C**                                                                 *
     C********************************************************************
     C**
     C           VBOCO     BEGSR                           *** VBOCO SR **
     C**
     C           SBOCO     IFEQ *BLANK
     C**
     C**   Use Default Broker from the Instrument
     C**   ( only if the instrument is valid, and a default exists)
     C           *IN25     IFEQ '0'
     C********** DBRK      ANDNE0                                                             CSD027
     C           DBRK      ANDNE*BLANKS                                                       CSD027
     C                     MOVELDBRK      SBOCO
     C                     MOVE DBRK      WBOCO
     C                     SETON                     14
     C**
     C                     ELSE
     C           E         ADD  1         E
     C                     MOVE ' 093'    ERR,E
     C                     SETON                     1832
     C                     END
     C**
     C                     END
     C**
     C**   Broker entered
     C           SBOCO     IFNE *BLANK
     C**
     C*****-*determine*if*Number*or*Shortname*input***********************S01117
     C***********          MOVE SBOCO     KCSNM                           S01117
     C***********          EXSR VXNOSM                                    S01117
     C***                  CALL 'AOCUSTR0'                         S01117 105808
     C***                  PARM *BLANKS   @RTCD   7                S01117 105808
     C***                  PARM '*KEY   ' @OPTN   7                S01117 105808
     C***                  PARM SBOCO     @KEY1  10                S01117 105808
     C***                  PARM           @KYST   7                S01117 105808
     C***        SDCUST    PARM SDCUST    DSSDY                    S01117 105808
      *                                                                   125923
      * First verify customer number on customer master file              125923
      * ...but don't call AOCUSTR0 if '?' entered , because it's not much CAP003
      * use.                                                              CAP003
     C           '?'       SCAN SBOCO     FOUND   30                      CAP003
     C           FOUND     IFEQ *ZERO                                     CAP003
      *                                                                   CAP003
     C**********           CALL 'AOCUSTR0'                         125923 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       125923
     C                     PARM '*KEY   ' @OPTN   7                       125923
     C                     PARM SBOCO     @KEY1  10                       125923
     C                     PARM           @KYST   7                       125923
     C********** SDCUST    PARM SDCUST    DSSDY                    125923 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *                                                                   CAP003
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE BBPRBA    WBPRBA                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CAP003
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C           CUST      ANDNE'000000'                                  CFF007
     C                     MOVELCUST      @KEY1     P                     CFF007
     C                     CALL 'AOCUSTR1'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           @KEY1                           CFF007
     C                     PARM           @KYST                           CFF007
     C           SDCUST    PARM SDCUST    DSLDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     MOVEL'SDCUSTPD'DBFILE                          CFF007
     C                     MOVELCUST      DBKEY            ************   CFF007
     C                     MOVE *BLANKS   DBOPTN           * DBERR 41 *   CFF007
     C                     Z-ADD41        DBASE            ************   CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C096
      *                                                                   125923
      * If found on master, check whether a F&O client and                125923
      * whether a broker (done later)                                     125923
     C           @RTCD     IFEQ *BLANKS                                   125923
     C                     MOVELCSSN      SBOCO                           125923
     C                     CALL 'AOFOCSR0'                                105808
     C                     PARM *BLANK    @RTCD   7                       105808
     C                     PARM '*KEY   ' @OPTN   7                       105808
     C***********          PARM SBOCO     @CUST   6                105808 125923
     C                     PARM CUST      @CUST   6                       125923
     C           SDFOCS    PARM SDFOCS    @DSFDY                          105808
     C                     END                                            125923
     C**
     C*****-*must*exist*as*a*live*record*on*LF-SNAME/CLINT****************S01117
     C**   - must exist as a live record on SDCUSTPD                      S01117
     C**
     C************IN67     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           E         ADD  1         E
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE ' 391'    ERR,E                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 091'    ERR,E
     C                     END                                            S01117
     C                     SETON                     1832
     C**
     C                     ELSE
     C*                                                                   S01117
     C**   Set up SBOCO for display                                       S01117
     C*                                                                   S01117
     C***********          MOVE *BLANKS   SBOCO                    S01117 125923
     C****       @KYST     IFEQ '*CNUM'                            S01117 105808
     C****                 MOVE CUST      SBOCO                    S01117 105808
     C****                 ELSE                                    S01117 105808
     C****                 MOVE CSSN      SBOCO                    S01117 105808
     C****                 END                                     S01117 105808
     C***********          MOVELBHCUST    SBOCO                    105808 125923
     C*                                                                   S01117
     C**   must exist as a live record on LF/FOCLT                        S01117
     C*                                                                   S01117
     C****                 MOVE CUST      KCBCD                    S01117 105808
     C                     MOVE BHCUST    KCBCD                           105808
     C*                                                                   S01117
     C**
     C           KCBCD     CHAINFOCLTB               71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 091'    ERR,E
     C                     SETON                     1832
     C**
     C                     ELSE
     C**   - must be a Broker
     C           BRKI      IFNE 'Y'
     C           E         ADD  1         E
     C                     MOVE ' 092'    ERR,E
     C                     SETON                     1832
     C**
     C                     ELSE
     C                     MOVELKCBCD     WBOCO
     C                     SETON                     14
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VCUSC SR. -  Validate  Customer                               *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *S01117
     C*********SR.*VINSRT*******************SR.*VXNOSM********************S01117
     C**                                                                 *
     C********************************************************************
     C**
     C           VCUSC     BEGSR                           *** VCUSC SR **
     C**
     C           SCUSC     IFEQ *BLANK
     C**
     C**   Mandatory if no broker
     C           *IN14     IFNE '1'
     C           E         ADD  1         E
     C                     MOVE ' 103'    ERR,E
     C                     SETON                     1833
     C                     END
     C**
     C                     ELSE
     C**
     C**   Customer entered
     C*****-*determine*if*Number*or*Shortname*input***********************S01117
     C***********          MOVE SCUSC     KCSNM                           S01117
     C***********          EXSR VXNOSM                                    S01117
     C***                  CALL 'AOCUSTR0'                        S01117  105808
     C***                  PARM *BLANKS   @RTCD   7               S01117  105808
     C***                  PARM '*KEY   ' @OPTN   7               S01117  105808
     C***                  PARM SCUSC     @KEY1  10               S01117  105808
     C***                  PARM           @KYST   7               S01117  105808
     C***        SDCUST    PARM SDCUST    DSSDY                   S01117  105808
      *                                                                   125923
      * First verify customer number on customer master file              125923
      * ...but don't call AOCUSTR0 if '?' entered , because it's not much CAP003
      * use.                                                              CAP003
     C           '?'       SCAN SCUSC     FOUND   30                      CAP003
     C           FOUND     IFEQ *ZERO                                     CAP003
      *                                                                   CAP003
     C**********           CALL 'AOCUSTR0'                         125923 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       125923
     C                     PARM '*KEY   ' @OPTN   7                       125923
     C                     PARM SCUSC     @KEY1  10                       125923
     C                     PARM           @KYST   7                       125923
     C********** SDCUST    PARM SDCUST    DSSDY                    125923 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
      *                                                                   CAP003
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE BBPRBA    WCPRBA                          CFF007
     C                     MOVELBBCRPC    WLCRPC  1                                           CSD015
     C                     MOVELBBLICD    WLLICD  3                                           CSD015
     C                     MOVELBBCRNM    WLCRNM 20                                           CSD015
     C                     MOVELBBCRTN    WLCRTN 10                                           CSD015
     C                     MOVELCUST      WLCUST  6                                           CSD015
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CAP003
      *                                                                   125923
      * If found on master, check whether a F&O client                    125923
     C           @RTCD     IFEQ *BLANKS                                   125923
     C                     MOVELCSSN      SCUSC                           125923
     C                     CALL 'AOFOCSR0'                                105808
     C                     PARM *BLANK    @RTCD   7                       105808
     C                     PARM '*KEY   ' @OPTN   7                       105808
     C***********          PARM SCUSC     @CUST   6                105808 125923
     C                     PARM CUST      @CUST   6                       125923
     C           SDFOCS    PARM SDFOCS    @DSFDY                          105808
     C                     END                                            125923
     C**
     C*****-*must*exist*as*a*live*record*on*LF-SNAME/CLINT****************S01117
     C**   - must exist as a live record on SDCUSTPD                      S01117
     C**
     C************IN67     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           E         ADD  1         E
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE ' 301'    ERR,E                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 101'    ERR,E
     C                     END                                            S01117
     C                     SETON                     1833
     C**
     C                     ELSE
     C*                                                                   S01117
     C**   Set up SCUSC for display                                       S01117
     C*                                                                   S01117
     C***********          MOVE *BLANKS   SCUSC                    S01117 125923
     C****       @KYST     IFEQ '*CNUM'                            S01117 105808
     C****                 MOVE CUST      SCUSC                    S01117 105808
     C****                 ELSE                                    S01117 105808
     C****                 MOVE CSSN      SCUSC                    S01117 105808
     C****                 END                                     S01117 105808
     C************         MOVELBHCUST    SCUSC                    105808 125923
     C*                                                                   S01117
     C**   - must exist as a live record on LF/FOCLT                      S01117
     C*                                                                   S01117
     C****                 MOVE CUST      KCBCD                    S01117 105808
     C                     MOVE BHCUST    KCBCD                           105808
     C**
     C           KCBCD     CHAINFOCLTC               71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '1'
     C           E         ADD  1         E
     C                     MOVE ' 101'    ERR,E
     C                     SETON                     1833
     C**
     C                     ELSE
      *                                                                   S01457
      ** If the feature is present then allow the Broker to do the        S01457
      ** OTC deal.                                                        S01457
      *                                                                   S01457
     C           S01457    IFEQ 'Y'                                       S01457
     C           BRKI      ANDEQ'Y'                                       S01457
     C                     MOVELKCBCD     WCUSC                           S01457
     C                     SETON                     15                   S01457
     C                     ELSE                                           S01457
      *                                                                   S01457
     C**   - must not be a Broker                                         S01457
     C           BRKI      IFEQ 'Y'
     C           E         ADD  1         E
     C                     MOVE ' 102'    ERR,E
     C                     SETON                     1833
     C**
     C                     ELSE
     C                     MOVELKCBCD     WCUSC
     C                     SETON                     15
     C                     END
      **                                                                  S01457
     C                     END                                            S01457
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************S01117
     C********************************************************************S01117
     C*****VXNOSM*SR.*-**Validate*a**Client**Number/Shortname*************S01117
     C*****~~~~~~~~~~*******for*Brokers*+*Customers***********************S01117
     C********************************************************************S01117
     C********Called*From******************Calls**************************S01117
     C*********SR.*VBOCO**************************************************S01117
     C*********SR.*VCUSC**************************************************S01117
     C*********SR.*VXSET**************************************************S01117
     C********************************************************************S01117
     C********************************************************************S01117
     C***********                                                         S01117
     C***********VXNOSM    BEGSR                           ** VXNOSM SR **S01117
     C***********                                                         S01117
     C***********          SETOF                     67                   S01117
     C***********                                                         S01117
     C***********          MOVELKCSNM1    WTSTN2                          S01117
     C***********          TESTN          WTSTN2     75                   S01117
     C***********                                                         S01117
     C*****If*1st*character*not*numeric,*assume*Shortname*input***********S01117
     C***********                                                         S01117
     C************IN75     IFEQ '0'                                       S01117
     C***********KCSNM     CHAINSNAME                71                   S01117
     C**N71******RECI      COMP 'D'                  7171                 S01117
     C***********                                                         S01117
     C*****-*if*not*found*************************************************S01117
     C************IN71     IFEQ '1'                                       S01117
     C***********          SETON                     67                   S01117
     C***********          ELSE                                           S01117
     C***********          MOVE CNUM      KCBCD                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C*****assume*Number*input********************************************S01117
     C*****-*1st*6*characters*must*be*numeric,*last*4*blank***************S01117
     C***********                                                         S01117
     C***********          MOVELKCSNM2    WTSTN7                          S01117
     C***********          TESTN          WTSTN7     75                   S01117
     C***********                                                         S01117
     C************IN75     IFEQ '0'                                       S01117
     C***********KCSNM3    ORNE '    '                                    S01117
     C***********          SETON                     67                   S01117
     C***********          ELSE                                           S01117
     C***********          MOVE KCSNM2    KCBCD                           S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          ENDSR                                          S01117
     C***********                                                         S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VBOKC SR. -  Validate  Book Code                              *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VBOKC     BEGSR                           *** VBOKC SR **
     C**
     C**   If blank :-
     C           SBOKC     IFEQ *BLANK
     C**
     C           SCUSC     IFEQ *BLANK
     C**   - set to Default Trade Book
     C                     MOVE DFTB      SBOKC
     C                     ELSE
     C**   - set to Default Customer Book
     C                     MOVE DFCB      SBOKC
     C                     END
     C**
     C                     END
     C**
     C***********SBOKC     CHAINBOOKD                71                   S01117
     C**N71******RECI      COMP 'D'                  7171                 S01117
     C                     CALL 'AOBOOKR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBOKC     @BKCD   2                       S01117
     C           SDBOOK    PARM SDBOOK    @DSFDY                          S01117
     C**
     C**   Live record not found
     C************IN71     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           E         ADD  1         E
     C                     MOVE ' 111'    ERR,E
     C                     SETON                     1834
     C*                                                                   S01117
     C**   Selector is used                                               S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C                     MOVELBOOK      SBOKC                           S01117
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VBRCD SR. -  Validate  Branch Code                            *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VBRCD     BEGSR                           *** VBRCD SR **
     C**
     C***********          MOVELSBRCD     WTSTN4                          S01117
     C***********          TESTN          WTSTN4     75                   S01117
     C*****If*Not*Numeric*************************************************S01117
     C************IN75     IFEQ '0'                                       S01117
     C***********E         ADD  1         E                               S01117
     C***********          MOVE ' 121'    ERR,E                           S01117
     C***********          SETON                     1835                 S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C*****Must*exist*on*Branch*Codes*Table*******************************S01117
     C***********          MOVE SBRCD     FFBRCD                          S01117
     C***********                                                         S01117
     C***********KBRCD     CHAINTABLETRF             70                   S01117
     C**N70******RECI      COMP 'D'                  7070                 S01117
     C*                                                                   E36432
     C**   Use default if entry is blank                                  S01117
     C*                                                                   S01117
     C           SBRCD     IFEQ *BLANKS                                   E36432
     C                     MOVELPDFBR     SBRCD                           E36432
     C                     END                                            E36432
     C*                                                                   E36432
     C**                                                                  S01117
     C**   Must exist on SD                                               S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBRCD     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                                       S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C**
     C**   - live record not found
     C           @RTCD     IFNE *BLANKS                                   S01117
     C************IN70     IFEQ '1'                                       S01117
     C           E         ADD  1         E
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE ' 122'    ERR,E                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 121'    ERR,E
     C                     END                                            S01117
     C                     SETON                     1835
     C**
     C                     ELSE
     C*                                                                   S01117
     C**   Selector is used                                               S01117
     C*                                                                   S01117
     C                     MOVELBRCH      SBRCD                           S01117
     C*                                                                   S01117
     C**   - SPF Checking                                                 S01117
     C*                                                                   S01117
     C           *IN77     IFNE '1'                                       S01332
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTN     @ZACTN  1                       S01117
     C                     PARM SBRCD     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 304'    ERR,E                           S01117
     C                     SETON                     182035               S01117
     C                     END                                            S01117
     C***********          MOVE NSACS     FFDASQ                          S01117
     C***********          END                                            S01117
     C                     END                                            S01332
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VTBLO SR. -  Validate  To Be Left Open ind.                   *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VTBLO     BEGSR                           *** VTBLO SR **
     C**
     C           STBLO     IFNE 'Y'
     C           STBLO     ANDNE'N'
     C           E         ADD  1         E
     C                     MOVE ' 131'    ERR,E
     C                     SETON                     1836
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VLNKR SR. -  Validate  Linked Reference                       *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSRT                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VLNKR     BEGSR                           *** VLNKR SR **
     C**
     C**   1. Must be numeric, greater than zero
     C                     MOVELSLNKR     WTSTN7
     C                     TESTN          WTSTN7     75
     C**
     C           *IN75     IFEQ '0'
     C           SLNKR     OREQ '000000'
     C           E         ADD  1         E
     C                     MOVE ' 141'    ERR,E
     C                     SETON                     1837
     C                     GOTO VLKRED
     C                     END
     C**
     C**   Continue only if Transaction Ref. not in error
     C           *IN22     IFEQ '1'
     C                     GOTO VLKRED
     C                     END
     C***********                                                         097069
     C*****2.*Must not equal Transaction Ref.                             097069
     C***********SLNKR     IFEQ STNBR                                     097069
     C***********E         ADD  1         E                               097069
     C***********          MOVE ' 142'    ERR,E                           097069
     C***********          SETON                     1837                 097069
     C***********          GOTO VLKRED                                    097069
     C***********          END                                            097069
     C***********                                                         097069
     C*****3.*Access Linked Trade                                         097069
     C***********          MOVE SLNKR     KLNKR   60                      097069
     C***********KLNKR     CHAINTRANSIN              71                   097069
     C**N71******RECI      COMP 'D'                  7171                 097069
     C***********                                                         097069
     C*****-*live Trade record not found                                  097069
     C************IN71     IFEQ '1'                                       097069
     C***********TRTY      ORNE 'P'                                       097069
     C***********TRTY      ANDNE'S'                                       097069
     C***********E         ADD  1         E                               097069
     C***********          MOVE ' 141'    ERR,E                           097069
     C***********          SETON                     1837                 097069
     C***********          GOTO VLKRED                                    097069
     C***********          END                                            097069
     C***********                                                         097069
     C*****-*record found : it's Linked Ref must be = '0' or Trans No.    097069
     C***********LNKR      IFNE 0                                         097069
     C***********LNKR      ANDNEKTNBR                                     097069
     C***********E         ADD  1         E                               097069
     C***********          MOVE ' 143'    ERR,E                           097069
     C***********          SETON                     1837                 097069
     C***********          END                                            097069
     C**
     C           VLKRED    ENDSR                           *** VLKRED ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                 *S01117
     C**   VORBR SR. -  Validate  Originating Branch Code                *S01117
     C**   ~~~~~~~~~                                                     *S01117
     C**      Called From                  Calls                         *S01117
     C**       SR. VINSRT                                                *S01117
     C**                                                                 *S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           VORBR     BEGSR                           *** VORBR SR **S01117
     C*                                                                   E36432
     C**   Default to Booking Branch if entry is blank                    S01117
     C*                                                                   S01117
     C           SORBR     IFEQ *BLANKS                                   E36432
     C                     MOVELSBRCD     SORBR                           E36432
     C                     END                                            E36432
     C**                                                                  S01117
     C**   Must exist on SD                                               S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SORBR     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                                       S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C**                                                                  S01117
     C**   - live record not found                                        S01117
     C**                                                                  S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           E         ADD  1         E                               S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE ' 152'    ERR,E                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 151'    ERR,E                           S01117
     C                     END                                            S01117
     C                     SETON                     1878                 S01117
     C**                                                                  S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   Selector is used                                               S01117
     C*                                                                   S01117
     C                     MOVELBRCH      SORBR                           S01117
     C*                                                                   S01117
     C**   - SPF Checking                                                 S01117
     C*                                                                   S01117
     C           OBUV      IFEQ 'Y'                                       S01117
     C           PACTN     ANDNE'E'                                       S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM SORBR     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C           E         ADD  1         E                               S01117
     C                     MOVE ' 307'    ERR,E                           S01117
     C                     SETON                     1878                 S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                 *S01117
     C**   VPRFC SR. -  Validate  Profit Centre                          *S01117
     C**   ~~~~~~~~~                                                     *S01117
     C**      Called From                  Calls                         *S01117
     C**       SR. VAMEND                                                *S01117
     C**                                                                 *S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           VPRFC     BEGSR                           *** VPRFC SR **S01117
     C**                                                                  S01117
     C**   Must exist on SD                                               S01117
     C**                                                                  S01117
     C                     CALL 'AOPRFCR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C***********          PARM SPRFC     @PCCD   4                S01117 CAC003
     C                     PARM WPRFC     @PCCD   4                       CAC003
     C           SDPRFC    PARM SDPRFC    @DSFDY                          S01117
     C**                                                                  S01117
     C**   - live record not found                                        S01117
     C**                                                                  S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           E         ADD  1         E                               S01117
     C***********          SETON                     1879          S01117 CAC003
     C                     SETON                     18                   CAC003
     C                     MOVE '1'       WPVALD  1                       CAC003
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE ' 361'    ERR,E                           S01117
     C                     ELSE                                           S01117
     C                     MOVE ' 161'    ERR,E                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ELSE                                           S01117
     C***********          MOVE DSPCCD    SPRFC                    S01117 CAC003
     C                     MOVE DSPCCD    WPRFC                           CAC003
     C                     MOVE '0'       WPVALD                          CAC003
     C                     END                                            S01117
     C**                                                                  S01117
     C                     ENDSR                                          S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT                                                              CPM003
     C********************************************************************CPM003
     C**                                                                 *CPM003
     C**   VINNR SR. -  Validate  PM Instrument Type                     *CPM003
     C**   ~~~~~~~~~                                                     *CPM003
     C**      Called From                  Calls                         *CPM003
     C**       SR. VINSET                                                *CPM003
     C**                                                                 *CPM003
     C********************************************************************CPM003
     C*                                                                   CPM003
     C           VINNR     BEGSR                           *** VINNR SR **CPM003
     C*                                                                   CPM003
     C           SINNR     IFEQ *BLANKS                    B1             CPM003
     C           BGN4ST    ANDNE'Y'                                       CFF007
     C/COPY WNCPYSRC,FF0020C118
     C           SINNR     OREQ FCDINR                                    CPM003
     C           BGN4ST    ANDNE'Y'                                       CFF007
     C/COPY WNCPYSRC,FF0020C119
     C                     MOVE FCDINR    SINNR                           CPM003
     C                     ELSE                            X1             CPM003
     C                     CALL 'AOPLINR0'                                CPM003
     C                     PARM *BLANKS   @RTCD                           CPM003
     C                     PARM '*KEY   ' @OPTN                           CPM003
     C                     PARM SINNR     @KEY    3                       CPM003
     C           SDPLIN    PARM SDPLIN    @DSFDY                          CPM003
     C*                                                                   CPM003
     C           @RTCD     IFNE *BLANKS                    B2             CPM003
     C           @RTCD     OREQ *BLANKS                                   CPM003
     C           PDRECI    ANDNE'D'                                       CPM003
     C           E         ADD  1         E                               CPM003
     C                     SETON                     1876                 CPM003
     C           @RTCD     IFEQ '*NOSEL '                  B3             CPM003
     C                     MOVE ' 362'    ERR,E                           CPM003
     C                     ELSE                            X3             CPM003
     C                     MOVE ' 162'    ERR,E                           CPM003
     C                     END                             E3             CPM003
     C**                                                                  CPM003
     C                     ELSE                            X2             CPM003
     C                     MOVELPDINNR    SINNR                           CPM003
     C                     END                             B2             CPM003
     C*                                                                   CPM003
     C                     END                             E2             CPM003
     C*                                                                   CPM003
     C                     ENDSR                                          CPM003
     C*                                                                   CPM003
     C********************************************************************CPM003
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VXCHCM SR. -  Validate  Broker/Customer  Charges/Commissions  *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. VINSET                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VXCHCM    BEGSR                           ** VXCHCM SR **
     C**
     C                     Z-ADD0         WXCMA  130
     C                     Z-ADD0         WXCHA  130
     C**
     C**   1. Commission Code: Standard
     C**      ~~~~~~~~~~~~~~~~~~~~~~~~~
     C           SXCMC     IFNE '  '
     C**
     C                     MOVELSXCMC     WTSTN3
     C                     TESTN          WTSTN3     75
     C**   If Not Numeric
     C           *IN75     IFEQ '0'
     C                     MOVE '1'       SEI,1
     C                     MOVE 'Y'       SEA,1
     C**
     C                     ELSE
     C**
     C                     MOVE SXCMC     KCGCM
     C**
     C           KCHGCM    CHAINCHGCM                71
     C  N71      RECI      COMP 'D'                  7171
     C**   - invalid
     C           *IN71     IFEQ '1'
     C                     MOVE '1'       SEI,1
     C                     MOVE 'Y'       SEA,1
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   2. Commission Code: Same day
     C**      ~~~~~~~~~~~~~~~~~~~~~~~~~
     C           SXCMS     IFNE '  '
     C**
     C                     MOVELSXCMS     WTSTN3
     C                     TESTN          WTSTN3     75
     C**   If Not Numeric
     C           *IN75     IFEQ '0'
     C                     MOVE '1'       SEI,2
     C                     MOVE 'Y'       SEA,2
     C**
     C                     ELSE
     C**
     C                     MOVE SXCMS     KCGCM
     C**
     C           KCHGCM    CHAINCHGCM                71
     C  N71      RECI      COMP 'D'                  7171
     C**   - invalid
     C           *IN71     IFEQ '1'
     C                     MOVE '1'       SEI,2
     C                     MOVE 'Y'       SEA,2
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   3. Commission Codes
     C**      ~~~~~~~~~~~~~~~~
     C           SEI,1     IFEQ '0'
     C           SEI,2     ANDEQ'0'
     C           SXCM      ANDNE*BLANK
     C**
     C**   - if one entered, the other must also be entered
     C           SXCMC     IFEQ *BLANK
     C                     MOVE '1'       SEI,1
     C                     MOVE 'Y'       SEA,1
     C                     END
     C**
     C           SXCMS     IFEQ *BLANK
     C                     MOVE '1'       SEI,2
     C                     MOVE 'Y'       SEA,2
     C                     END
     C**
     C                     END
     C**
     C**   4. Commission Amount
     C**      ~~~~~~~~~~~~~~~~~
     C           SXCMA     IFNE *BLANKS
     C**
     C           SXCMA1    IFEQ 'A'
     C**
     C           SXCMA2    IFNE *BLANKS
     C                     MOVE '1'       SEI,3
     C                     MOVE 'Y'       SEA,3
     C                     END
     C**
     C                     ELSE
     C**
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SXCMA     ZFIELD
     C                     EXSR ZALIGN
     C**   - invalid
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       SEI,3
     C                     MOVE 'Y'       SEA,3
     C**   - valid
     C                     ELSE
     C                     MOVE ZFIELD    WXCMA
     C**
     C           WXCMA     IFEQ 0
     C                     MOVE *BLANK    SXCMA
     C                     ELSE
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SXCMA
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   5. Commission Codes + Amount
     C**      ~~~~~~~~~~~~~~~~~~~~~~~~~
     C           SEI,1     IFEQ '0'
     C           SEI,2     ANDEQ'0'
     C           SEI,3     ANDEQ'0'
     C**
     C           SXCMA1    IFEQ 'A'
     C**
     C**   - codes must be entered
     C           SXCM      IFEQ *BLANK
     C                     MOVEA'111'     SEI,1
     C                     MOVE 'Y'       SEA,4
     C                     END
     C**
     C                     ELSE
     C**
     C**   - codes and amount cannot both be entered
     C           SXCM      IFNE *BLANK
     C           SXCMA     ANDNE*BLANK
     C           CFF007    ANDNE'Y'                                       CFF007
     C           CFF007    OREQ 'Y'                                       CFF007
     C           SXCM      ANDNE*BLANK                                    CFF007
     C           SXCMA     ANDNE*BLANK                                    CFF007
     C           WPBFLG    ANDNE'Y'                                       CFF007
     C/COPY WNCPYSRC,FF0020C097
     C                     MOVEA'111'     SEI,1
     C                     MOVE 'Y'       SEA,4
     C                     ELSE                                           CFF007
     C           SXCM      IFEQ *BLANK                                    CFF007
     C           SXCMA     ANDNE*BLANK                                    CFF007
     C           WPBFLG    ANDEQ'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
     C                     MOVEA'11'      SEI,1                           CFF007
     C                     MOVE 'Y'       SEA,30                          CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           SXCM      IFNE *BLANK                                    CFF007
     C           SXCMC     ANDEQSXCMS                                     CFF007
     C           BBPRBA    ANDEQ'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           XCPT      IFEQ 'S'                                       CFF007
     C           XCPT      OREQ 'H'                                       CFF007
     C           XCPT      OREQ 'A'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO                           CFF007
     C                     MOVE SXCMC     CGCM                            CFF007
     C                     Z-ADD0         WRATA                           CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCMA  14                       CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SXCMA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WXCMA                           CFF007
     C                     MOVE ZXCMA     SXCMA                           CFF007
      *                                                                   CFF007
     C                     MOVE 'A'       XCPT                            CFF007
      *                                                                   CFF007
     C           XBRKI     IFEQ 'Y'                                       CFF007
     C                     MOVE 'Y'       CMCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'Y'       CMCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C098
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   6. Charge Code
     C**      ~~~~~~~~~~~
     C           SXCHC     IFNE '  '
     C**
     C                     MOVELSXCHC     WTSTN3
     C                     TESTN          WTSTN3     75
     C**   If Not Numeric
     C           *IN75     IFEQ '0'
     C                     MOVE '1'       SEI,4
     C                     MOVE 'Y'       SEA,5
     C**
     C                     ELSE
     C**
     C                     MOVE SXCHC     KCGCM
     C**
     C           KCHGCM    CHAINCHGCM                71
     C  N71      RECI      COMP 'D'                  7171
     C**   - invalid
     C           *IN71     IFEQ '1'
     C                     MOVE '1'       SEI,4
     C                     MOVE 'Y'       SEA,5
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   7. Charge Amount
     C**      ~~~~~~~~~~~~~
     C           SXCHA     IFNE *BLANKS
     C**
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SXCHA     ZFIELD
     C                     EXSR ZALIGN
     C**   - invalid
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       SEI,5
     C                     MOVE 'Y'       SEA,6
     C**   - valid
     C                     ELSE
     C                     MOVE ZFIELD    WXCHA
     C**
     C           WXCHA     IFEQ 0
     C                     MOVE *BLANK    SXCHA
     C                     ELSE
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SXCHA
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   8. Charge Code + Amount
     C**      ~~~~~~~~~~~~~~~~~~~~
     C           SEI,4     IFEQ '0'
     C           SEI,5     ANDEQ'0'
     C**
     C**   - code and amount cannot both be entered
     C           SXCHC     IFNE *BLANK
     C           SXCHA     ANDNE*BLANK
     C           CFF007    ANDNE'Y'                                       CFF007
     C           CFF007    OREQ 'Y'                                       CFF007
     C           SXCHC     ANDNE*BLANK                                    CFF007
     C           SXCHA     ANDNE*BLANK                                    CFF007
     C           WPBFLG    ANDNE'Y'                                       CFF007
     C/COPY WNCPYSRC,FF0020C099
     C                     MOVEA'11'      SEI,4
     C                     MOVE 'Y'       SEA,7
     C                     ELSE                                           CFF007
     C**                                                                  CFF007
     C           SXCHC     IFEQ *BLANK                                    CFF007
     C           SXCHA     ANDNE*BLANK                                    CFF007
     C           BBPRBA    ANDEQ'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
     C                     MOVEA'1'       SEI,4                           CFF007
     C                     MOVE 'Y'       SEA,29                          CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           SXCHC     IFNE *BLANK                                    CFF007
     C           BBPRBA    ANDEQ'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C                     Z-ADDWNUCO     WCONO   50                      CFF007
     C                     MOVE SXCHC     CGCM                            CFF007
     C                     Z-ADD0         WRATA  130                      CFF007
      *                                                                   CFF007
     C           WCONO     IFNE 0                                         CFF007
     C           CGCM      ANDNE0                                         CFF007
     C                     EXSR TTFCAL                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WRATA     IFNE 0                                         CFF007
     C                     Z-ADDFFCDP     ZADEC                           CFF007
     C           13        SUB  FFCDP     ZADIG                           CFF007
     C                     MOVEL*BLANK    ZFIELD                          CFF007
     C                     MOVE WRATA     ZFIELD                          CFF007
     C                     EXSR ZEDIT                                     CFF007
     C                     MOVE ZFIELD    ZXCHA  14                       CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           SXCHA     IFEQ *BLANK                                    CFF007
     C                     Z-ADDWRATA     WXCHA                           CFF007
     C                     MOVE ZXCHA     SXCHA                           CFF007
      *                                                                   CFF007
     C           XBRKI     IFEQ 'Y'                                       CFF007
     C                     MOVE 'Y'       CHCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'Y'       CHCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C100
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VXMAR SR. -  Validate  Broker/Customer Initial Margin         *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. VINSET                                                *
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VXMAR     BEGSR                           *** VXMAR SR **
     C**
     C                     Z-ADD0         WXMAR  130
     C**
     C                     MOVEL*BLANK    ZFIELD
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP48                                           S01408
      *                                                                   S01408
     C                     MOVE SXMAR     ZFIELD
     C**
     C                     EXSR ZALIGN
     C**   - invalid
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       SEI,6
     C                     MOVE 'Y'       SEA,8
     C**   - valid
     C                     ELSE
     C                     MOVE ZFIELD    WXMAR
     C**
     C**    - if Margin is input as zero, store it as -1
     C**    - if Margin is input as blank, store it as zero
     C**
     C           SXMAR     IFNE *BLANK
     C**
     C           WXMAR     IFEQ *ZERO
     C                     Z-SUB1         WXMAR
     C                     END
     C**
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SXMAR
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   VXSET SR. -  Validate  Broker/Customer Settlement details     *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C*********SR.*VINSET*******************SR.*VXNOSM********************S01117
     C**       SR. VINSET                                                *S01117
     C**       SR. VAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           VXSET     BEGSR                           *** VXSET SR **
     C**
     C                     MOVE *BLANK    WXSLB                           S01117
     C**********           Z-ADD*ZERO     FFCNUM                                              CSD027
     C                     MOVE *BLANKS   FFCNUM                                              CSD027
     C                     Z-ADD*ZERO     FFACOD
     C                     Z-ADD*ZERO     FFACSQ
     C                     Z-ADD*ZERO     FFNOSN
     C                     MOVE 'N'       XPIND   1
     C                     MOVE 'N'       XMIND   1
     C/SPACE 2
     C**   1. Settlement Type
     C**      ~~~~~~~~~~~~~~~
     C           SXSLT     IFEQ '  '
     C                     MOVE '00'      SXSLT
     C                     END
     C**   Valid values
     C           SXSLT     IFNE '00'
     C           SXSLT     ANDNE'01'
     C           SXSLT     ANDNE'02'
     C           SXSLT     ANDNE'03'
     C           SXSLT     ANDNE'04'
     C           SXSLT     ANDNE'05'
     C           SXSLT     ANDNE'06'
     C           SXSLT     ANDNE'07'
     C           SXSLT     ANDNE'08'
     C           SXSLT     ANDNE'12'
     C           SXSLT     ANDNE'14'
     C           SXSLT     ANDNE'15'
     C           CFF007    ANDNE'Y'                                       CFF007
      *                                                                   CFF007
     C           SXSLT     ORNE '00'                                      CFF007
     C           SXSLT     ANDNE'01'                                      CFF007
     C           SXSLT     ANDNE'02'                                      CFF007
     C           SXSLT     ANDNE'03'                                      CFF007
     C           SXSLT     ANDNE'04'                                      CFF007
     C           SXSLT     ANDNE'05'                                      CFF007
     C           SXSLT     ANDNE'06'                                      CFF007
     C           SXSLT     ANDNE'07'                                      CFF007
     C           SXSLT     ANDNE'08'                                      CFF007
     C           SXSLT     ANDNE'12'                                      CFF007
     C           SXSLT     ANDNE'14'                                      CFF007
     C           SXSLT     ANDNE'15'                                      CFF007
     C           WWTOFC    ANDNE'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           SXSLT     ORNE '04'                                      CFF007
     C           SXSLT     ANDNE'05'                                      CFF007
     C           SXSLT     ANDNE'14'                                      CFF007
     C           SXSLT     ANDNE'15'                                      CFF007
     C           WWTOFC    ANDEQ'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
     C/COPY WNCPYSRC,FF0020C101
     C**
     C                     MOVE '1'       SEI,7
     C/COPY WNCPYSRC,FF0020C102
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           WWTOFC    ANDEQ'Y'                                       CFF007
     C                     MOVE 'Y'       SEA,26                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'Y'       SEA,9
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C103
     C                     GOTO VXSEND
     C                     END
     C**
     C**   Types 04 + 14 only allowed if Retail present (ie. U2 on)
     C           *INU2     IFEQ '0'
     C**
     C           SXSLT     IFEQ '04'
     C           SXSLT     OREQ '14'
     C                     MOVE '1'       SEI,7
     C                     MOVE 'Y'       SEA,10
     C                     GOTO VXSEND
     C                     END
     C**
     C                     END
     C**
     C**   Type 07 - Instr. ccy must be U.S. ccy code
     C           SXSLT     IFEQ '07'
     C           KCCY      ANDNEUSCY
     C                     MOVE '1'       SEI,7
     C                     MOVE 'Y'       SEA,11
     C                     GOTO VXSEND
     C                     END
     C**
     C**   Type 14 - Retail A/c nos. must be supported
     C           SXSLT     IFEQ '14'
     C           RACN      ANDNE'Y'
     C                     MOVE '1'       SEI,7
     C                     MOVE 'Y'       SEA,12
     C                     GOTO VXSEND
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS4                                           S01408
     C*                                                                   S01408
     C/SPACE 2
     C**   Continue only if Settlement Type not in error
     C**
     C**   2. Settlement Account
     C**      ~~~~~~~~~~~~~~~~~~
     C**   - Settlement Types 00,04,06,15 : entry not allowed
     C           SXSLT     IFEQ '00'
     C           SXSLT     OREQ '04'
     C           SXSLT     OREQ '06'
     C           SXSLT     OREQ '15'
     C**
     C           SXSLA     IFNE *BLANK
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,13
     C**
     C                     ELSE
     C                     MOVE SBRCD     WXSLB   3                       S01117
     C**
     C           SXSLT     IFNE '00'
     C***********          MOVE FFDASQ    FFACSQ                          S01117
     C                     MOVE '01'      FFACSQ                          S01117
     C**
     C           SXSLT     IFEQ '04'
     C           XBRKI     IFEQ 'Y'
     C                     MOVE WBOCO     FFCNUM
     C                     ELSE
     C                     MOVE WCUSC     FFCNUM
     C                     END
     C                     MOVE CADC      FFACOD
     C                     END
     C**
     C           SXSLT     IFEQ '06'
     C                     MOVE BICN      FFCNUM
     C                     MOVE COMS      FFACOD
     C                     END
     C**
     C           SXSLT     IFEQ '15'
     C           XBRKI     IFEQ 'Y'
     C                     MOVE WBOCO     FFCNUM
     C                     MOVE DFBA      FFACOD
     C                     ELSE
     C                     MOVE WCUSC     FFCNUM
     C                     MOVE DFCA      FFACOD
     C*                                                                   S71062
     C* IF IT'S A CLIENT PORTFOLIO AND IF A PORTFOLIO EXISTS IN PMPORTPD  S71062
     C* USE MARGIN ACCOUNT SEQUENCE BY DEFAULT FOR THE SETTLEMENT ACCOUNT S71062
     C           BGPFMG    IFEQ 'Y'                                       S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C           WWPORT    ANDEQ'Y'                                       S71062
     C                     MOVE PNACSQ    FFACSQ                          S71062
     C                     END                                            S71062
     C                     END
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   - Settlement Types 01,02,07,08,12 : if entered, must be a
     C**   2 digit no. (left adjusted) which when combined with
     C**   Instr. Currency exists as a valid nostro code on PF/TABLETL
     C           SXSLT     IFEQ '01'
     C           SXSLT     OREQ '02'
     C           SXSLT     OREQ '07'
     C           SXSLT     OREQ '08'
     C           SXSLT     OREQ '12'
     C**  - set Prono update ind. to 'Y'
     C                     MOVE 'Y'       XPIND
     C                     MOVE KCCY      FFNCCY
     C**
     C           SXSLA     IFNE *BLANK
     C**
     C                     MOVELSXSLA1    WTSTN3
     C                     TESTN          WTSTN3     75
     C**
     C           *IN75     IFEQ '0'
     C           SXSLA2    ORNE *BLANK
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,14
     C**
     C                     ELSE
     C                     MOVE SXSLA1    FFNOSN
     C**
     C           FFNKY     CHAINTABLETLF             70
     C  N70      RECI      COMP 'D'                  7070
     C**  - no live record
     C           *IN70     IFEQ '1'
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,14
     C                     ELSE
     C**  - record found
     C                     MOVE CNUM      FFCNUM
     C                     MOVE ACOD      FFACOD
     C                     MOVE ACSQ      FFACSQ                          S01117
     C***********          MOVE FFDASQ    FFACSQ                          S01117
     C                     MOVE BRCA      WXSLB                           S01117
     C                     END
     C**
     C                     END
     C*                                                                   098501
     C**  - Nostro code must be entered                                   098501
     C                     ELSE                                           098501
     C                     MOVE '1'       SEI,8                           098501
     C                     MOVE 'Y'       SEA,14                          098501
     C**
     C                     END
     C**
     C                     END
     C**
     C**   - Settlement Type 03 : must be a left adjusted 6 digit no.
     C           SXSLT     IFEQ '03'
     C**
     C                     MOVELSXSLA3    WTSTN7
     C                     TESTN          WTSTN7     75
     C**
     C           *IN75     IFEQ '0'
     C           SXSLA3    OREQ '000000'
     C           SXSLA4    ORNE *BLANK
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,15
     C                     ELSE
     C                     MOVE BICN      FFCNUM
     C                     MOVE CSAC      FFACOD
     C                     MOVE '01'      FFACSQ                          S01117
     C***********          MOVE FFDASQ    FFACSQ                          S01117
     C                     MOVE SBRCD     WXSLB                           S01117
     C                     END
     C**
     C                     END
     C**
     C**   - Settlement Type 05 : PstNs (1 - 6)  Customer
     C**                                (7 -10)  Account Code
     C**                               (11 -12)  Account Seq No.
     C           SXSLT     IFEQ '05'
     C**
     C                     MOVELSXSLA     WTST13
     C**********           TESTN          WTST13     75                                       CSD027
     C**
     C********** *IN75     IFEQ '1'                                                           CSD027
     C**
     C                     MOVE SXSLA3    KCBCD
     C           KCLINT    CHAINCLINT                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '0'
     C                     MOVE SXSLA5    FFACOD
     C********** FFAKY     CHAINTABTE10F             70                                       CGL029
     C**N70***** RECI      COMP 'D'                  7070                                     CGL029
     C                     EXSR SRACOD                                                        CGL029
     C**
     C**         *IN70     IFEQ '0'
     C**         *IN64     ANDEQ'0'
     C**                   MOVE SXSLA6    WACSQ   20
     C**         WACSQ     IFLT NSACS
     C**         WACSQ     ORGT NEACS
     C**                   SETON                     70
     C**                   END
     C**
     C**                   END
     C**
     C                     END
     C**
     C**********           END                                                                CSD027
     C**
     C           *IN71     IFEQ '1'
     C           *IN70     OREQ '1'
     C           *IN75     OREQ '0'
     C           SXSLA6    OREQ '00'
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,16
     C                     ELSE
     C/COPY WNCPYSRC,FF0020C104
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           WWTOFC    ANDEQ'Y'                                       CFF007
     C           *IN70     ANDEQ'0'                                       CFF007
     C********** ATYP      ANDNE'R'                                                    CFF007 CGL029
     C           A5ACTY    ANDNE'R'                                                           CGL029
     C                     MOVE '1'       SEI,8                           CFF007
     C                     MOVE 'Y'       SEA,27                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE SXSLA3    FFCNUM
     C                     MOVE SXSLA5    FFACOD
     C                     MOVE SXSLA6    FFACSQ
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     MOVE SXSLB     WXSLB                           S01117
     C           KEYM      KLIST                                          085995
     C**********           KFLD           KYCNUM  60                                   085995 CSD027
     C                     KFLD           KYCNUM  6                                           CSD027
     C                     KFLD           KYCCY   3                       085995
     C**********           KFLD           KYACOD  40                                   085995 CGL029
     C                     KFLD           KYACOD 100                                          CGL029
     C                     KFLD           KYACSQ  20                      085995
     C                     KFLD           KYBRCA  3                       085995
     C                     MOVE SXSLA3    KYCNUM                          085995
     C                     MOVE ISCY      KYCCY                           085995
     C                     MOVE SXSLA5    KYACOD                          085995
     C                     MOVE SXSLA6    KYACSQ                          085995
     C                     MOVE SXSLB     KYBRCA                          085995
     C           KEYM      SETLLACCNT                    99               085995
     C  N99                MOVE '1'       SEI,8                           085995
     C  N99                MOVE 'Y'       SEA,16                          085995
     C                     ELSE                                           S01117
     C                     MOVE SBRCD     WXSLB                           S01117
     C                     END                                            S01117
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C105
     C                     END
     C**
     C                     END
     C**
     C**   - Settlement Type 14 : must be a left adjusted Retail A/c no.
     C**                           with the same ccy as the Instr. ccy
     C           SXSLT     IFEQ '14'
     C**
     C                     MOVELSXSLA7    WTST11
     C                     TESTN          WTST11     75
     C**
     C           *IN75     IFEQ '0'
     C           SXSLA6    ORNE '  '
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,17
     C                     ELSE
     C**
     C                     MOVE SXSLA7    KACNO  100
     C           KACNO     CHAINACNUM                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '1'
     C           CCY       ORNE KCCY
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,17
     C                     ELSE
     C**
     C**         *IN64     IFEQ '0'
     C**         ACSQ      IFLT NSACS
     C**         ACSQ      ORGT NEACS
     C**                   MOVE '1'       SEI,8
     C**                   MOVE 'Y'       SEA,17
     C**                   END
     C**                   END
     C**
     C                     END
     C**  - set Memos update ind. to 'Y'
     C           SEA,17    IFNE 'Y'
     C                     MOVE 'Y'       XMIND
     C                     MOVE CNUM      FFCNUM
     C                     MOVE ACOD      FFACOD
     C                     MOVE ACSQ      FFACSQ
     C                     MOVE BRCA      WXSLB                           S01117
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2                                                            S01117
     C**   3. Settlement Branch                                           S01117
     C**      ~~~~~~~~~~~~~~~~~                                           S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C**                                                                  S01117
     C           SXSLT     IFNE '05'                                      S01117
     C           XBRKI     IFEQ 'Y'                                       S01117
     C           SBSBR     ANDNE*BLANKS                                   S01117
     C           XBRKI     ORNE 'Y'                                       S01117
     C           SBRSC     ANDNE*BLANKS                                   S01117
     C                     MOVE '1'       SEI,11                          S01117
     C                     MOVE 'Y'       SEA,24                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SXSLB     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                                       S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C**                                                                  S01117
     C**   - live record not found                                        S01117
     C**                                                                  S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       SEI,11                          S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVE 'Y'       SEA,25                          S01117
     C                     ELSE                                           S01117
     C                     MOVE 'Y'       SEA,24                          S01117
     C                     END                                            S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**   Selector is used                                               S01117
     C*                                                                   S01117
     C                     MOVELBRCH      WXSLB                           S01117
     C                     MOVELBRCH      SXSLB                           S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            S01117
     C/SPACE 2
     C**   If Retail present, Settlement Account not yet in error,
     C**    and Settlement type not '00'
     C           *INU2     IFEQ '1'
     C           SEI,8     ANDEQ'0'
     C           SXSLT     ANDNE'00'
     C**
     C**   - if the Account Type for the Settlement A/c code is 'R' for
     C**      Retail, the account must exist on LF/ACCNT and be open
     C**
     C**   - access  Account codes table file
     C********** FFAKY     CHAINTABTE10F             70                                       CGL029
     C**N70***** RECI      COMP 'D'                  7070                                     CGL029
     C                     EXSR SRACOD                                                        CGL029
     C**
     C**  - if a Retail account access LF/ACCNT
     C           *IN70     IFEQ '0'
     C********** ATYP      ANDEQ'R'                                                           CGL029
     C           A5ACTY    ANDEQ'R'                                                           CGL029
     C**
     C                     MOVE WXSLB     FFBRCB                          S01117
     C           FFACTK    CHAINACCNT                71
     C                     MOVE *BLANK    FFBRCB                          S01117
     C  N71      RECI      COMP 'D'                  7171
     C**
     C**  - Error if no live open Retail A/c exists
     C**
     C           *IN71     IFEQ '1'
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,18
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS5                                           S01408
     C*                                                                   S01408
     C**  - record found, set Memos update ind. to 'Y'
     C                     MOVE 'Y'       XMIND
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CVS6                                           S01408
     C*                                                                   S01408
     C                     END
     C**
     C                     END
     C**                                                                  S71062
     C           BGPFMG    IFEQ 'Y'                                       CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           XBRKI     ANDEQ'N'                                       S71062
     C**                                                                  S71062
     C** TEST IF CUSTOMER OF SETTLEMENT ACCOUNT IS THE SAME AS CUSTOMER   S71062
     C** ENTERED ON THE TRANSACTION                                       S71062
     C           FFCNUM    IFNE WCUSC                                     S71062
     C                     ADD  1         F                               S71062
     C                     MOVE ' WA2'    WERR,F                          S71062
     C                     SETON                     1957                 S71062
     C                     GOTO VXSEND                                    S71062
     C                     END                                            S71062
     C**                                                                  S71062
     C** ACCESS ACCNT TO OBTAIN PORTFOLIO REFERENCE                       S71062
     C                     MOVE WXSLB     FFBRCB                          118909
     C           FFACTK    CHAINACCNT                71                   S71062
     C                     MOVE *BLANK    FFBRCB                          118909
     C  N71      RECI      COMP 'D'                  7171                 S71062
     C           *IN71     IFEQ '1'                                       S71062
     C                     ADD  1         F                               S71062
     C                     MOVE ' WA3'    WERR,F                          S71062
     C                     SETON                     1957                 S71062
     C                     GOTO VXSEND                                    S71062
     C                     ELSE                                           S71062
     C** TEST IF PORTFOLIO REFERENCE ON THE ACCOUNT IS THE SAME AS        S71062
     C** PORTFOLIO REFERENCE ON THE TRANSACTION                           S71062
     C           SPTFR     IFNE ACPTFR                                    S71062
     C           SPTFR     IFEQ FCR997                                    S71062
     C           ACPTFR    ANDNE'9997'                                    S71062
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           SPTFR     ORNE FCR997                                    S71062
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     ADD  1         F                               S71062
     C                     MOVE ' WA2'    WERR,F                          S71062
     C                     SETON                     1957                 S71062
     C                     GOTO VXSEND                                    S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C                     END                                            S71062
     C**
     C                     END
     C/SPACE 2
     C**   If Memos Update ind on, + Transaction Date not in error
     C**
     C           XMIND     IFEQ 'Y'
     C           *IN31     ANDEQ'0'
     C**
     C**   - determine Back Value Date
     C           CTDATE    SUB  BVLP      BVDATE  50
     C**
     C           DACO      IFGT BVDATE
     C                     MOVE DACO      BVDATE
     C                     END
     C**
     C**   - Transaction Date must not be before Back Value Date
     C           WTRSD     IFLT BVDATE
     C                     MOVE '1'       SEI,8
     C                     MOVE 'Y'       SEA,19
     C                     END
     C**
     C                     END
     C/SPACE 2
     C*****3.*For*Account*Of**********************************************S01117
     C**   4. For Account Of                                              S01117
     C**      ~~~~~~~~~~~~~~
     C**   Entry only allowed for Settlement Types 01,02,07,08,12
     C           SXFAO     IFNE *BLANK
     C**
     C           SXSLT     IFNE '01'
     C           SXSLT     ANDNE'02'
     C           SXSLT     ANDNE'07'
     C           SXSLT     ANDNE'08'
     C           SXSLT     ANDNE'12'
     C                     MOVE '1'       SEI,9
     C                     MOVE 'Y'       SEA,20
     C**
     C                     ELSE
     C**
     C*****-*determine*if*Number*or*Shortname*input***********************S01117
     C***********          MOVE SXFAO     KCSNM                           S01117
     C***********          EXSR VXNOSM                                    S01117
     C***********          CALL 'AOCUSTR0'                         S01117 CPB001
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SXFAO     @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C***********SDCUST    PARM SDCUST    DSSDY                    S01117 CPB001
     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
     C**
     C*****-*must*exist*as*a*live*record*on*LF-SNAME/CLINT****************S01117
     C**   - must exist as a live record on SDCUSTPD                      S01117
     C**
     C************IN67     IFEQ '1'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVE '1'       SEI,9
     C                     MOVE 'Y'       SEA,21
     C**
     C                     ELSE
     C*                                                                   S01117
     C**   Set up SXFAO for display                                       S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   SXFAO                           S01117
     C           @KYST     IFEQ '*CNUM'                                   S01117
     C*********************MOVE CUST      SXFAO                    S01117 FO0096
     C                     MOVELCUST      SXFAO                           FO0096
     C                     ELSE                                           S01117
     C                     MOVE CSSN      SXFAO                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   Set up key KCBCD                                               S01117
     C*                                                                   S01117
     C                     MOVE CUST      KCBCD                           S01117
     C**
     C***********KCLINT    CHAINCLINT                71                   S01117
     C**N71******RECI      COMP 'D'                  7171                 S01117
     C***********                                                         S01117
     C************IN71     IFEQ '1'                                       S01117
     C***********          MOVE '1'       SEI,9                           S01117
     C***********          MOVE 'Y'       SEA,21                          S01117
     C***********          END                                            S01117
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   4. Counterparty Nostro
     C**      ~~~~~~~~~~~~~~~~~~~
     C**   Entry only allowed for Settlement Types 01,02,07,08,12
     C           SXCPN     IFNE *BLANK
     C**
     C           SXSLT     IFNE '01'
     C           SXSLT     ANDNE'02'
     C           SXSLT     ANDNE'07'
     C           SXSLT     ANDNE'08'
     C           SXSLT     ANDNE'12'
     C                     MOVE '1'       SEI,10
     C                     MOVE 'Y'       SEA,22
     C**
     C                     ELSE
     C**
     C**   - must exist as a valid Counterparty Nostro on PF/TABLET2
     C**     or as a valid customer on PF/CLINTCB
     C                     MOVELSXCPN     SXCPN6  6
     C***********          TESTN          SXCPN6     75                                       CSD027
     C**
     C**   If counterparty nostro field entered is numeric, access
     C**   LF/CLINT to check that record exists
     C************IN75     IFEQ '1'                                                           CSD027
     C                     MOVE SXCPN6    KCBCD
     C           KCLINT    CHAINCLINTCBF             71
     C**N71******RECI      COMP 'D'                  7171                                     CSD027
     C**
     C*****-*no*live record exists                                                            CSD027
     C************IN71     IFEQ '1'                                                           CSD027
      * Record found but not live                                                             CSD027
     C           *IN71     IFEQ *OFF                                                          CSD027
     C           RECI      ANDNE'D'                                                           CSD027
     C                     MOVE '1'       SEI,10
     C                     MOVE 'Y'       SEA,23
     C                     END
     C**
     C*****Else*counterparty*nostro*field*entered*is*not*numeric,***                          CSD027
     C*****access*LF/SNAME*to*check*for*customer*shortname**********                          CSD027
      * Counterparty not found                                                                CSD027
     C           *IN71     IFEQ *ON                                                           CSD027
     C***********          ELSE                                                               CSD027
     C                     MOVE SXCPN     KCSNM
     C**
     C                     MOVE *IN74     WIN74   1                       CFF007
     C           KCSNM     CHAINSNAME                74
     C  N74      RECI      COMP 'D'                  7474
     C                     MOVE *IN74     WWIN74  1                       CFF007
     C                     MOVE WIN74     *IN74   1                       CFF007
     C**
     C**   If record found, store customer number for this customer
     C**   shortname in a work field
     C********** *IN74     IFEQ '0'                                       CFF007
     C           WWIN74    IFEQ '0'                                       CFF007
     C*
     C**   If broker counterparty nostro being processed, set on
     C**   broker shortname needed flag
     C           *IN14     IFEQ '1'
     C**********           Z-ADDCNUM      CNUMB   60                                          CSD027
     C                     MOVE CNUM      CNUMB   6                                           CSD027
     C                     Z-ADD1         BSNAME
     C                     END
     C*
     C**   If customer counterparty nostro being processed, set on
     C**   customer shortname needed flag
     C           *IN15     IFEQ '1'
     C**********           Z-ADDCNUM      CNUMC   60                                          CSD027
     C                     MOVE CNUM      CNUMC   6                                           CSD027
     C                     Z-ADD1         CSNAME
     C                     END
     C**
     C**   Else access PF/TABLET2 to check for valid counterparty
     C**   nostro
     C                     ELSE
     C*********************MOVE SXCPN     KCPSH2                          073714
     C                     MOVELSXCPN     KCPSH2                          073714
     C**
     C           KCPSH     CHAINTABLET2F             70
     C  N70      RECI      COMP 'D'                  7070
     C**
     C**   - no live record exists
     C           *IN70     IFEQ '1'
     C                     MOVE '1'       SEI,10
     C                     MOVE 'Y'       SEA,23
     C                     END
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C           VXSEND    ENDSR                           *** VXSEND ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UINSRT SR. -  Update  Insert Control                          *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. INSSET                   SR. ICOMIT                   *
     C**                                    SR. WTRANS                   *
     C**                                    SR. WINTYP                   *073714
     C**                                    SR. TUDBAW                   *
     C**                                    SR. INFSR                    *
     C**                                    SR. WTRSET                   *
     C**************************************SR. UTRNLK                   *097069
     C**                                    SR. UAMEMS                   *
     C**                                    SR. WACMVD                   *S01240
     C**                                    SR. UAPRON                   *
     C**                                    SR. UAPRFC                   *S01117
     C**                                    SR. FFTVCL                   *
     C**                                    SR. UPSTNC                   *
     C**                                    SR. UPSTNB                   *
     C**                                    SR. UPSTNK                   *
     C**                                    SR. UTRNSA                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           UINSRT    BEGSR                           ** UINSRT SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP32                                           S01408
     C*                                                                   S01408
     C**
     C**   Initialise 'COMIT' text
     C                     EXSR ICOMIT
     C/COPY WNCPYSRC,FF0020C106
     C**
     C**   LF/TRANS main
     C**   ~~~~~~~~~~~~~
     C**********           EXSR WTRANS                                                        205075
     C/COPY WNCPYSRC,FF0020C107
     C**                                                                  073714
     C**   PF/INTYPD - for undefined O.T.C.s                              073714
     C**   ~~~~~~~~~                                                      073714
     C                     MOVE '0'       WWIN73                                              215092
     C           SMRKT     IFEQ '  '                                      073714
     C           ISTI      ANDNE'Y'                                       073714
     C**N73*****           EXSR WINTYP                             073714 CFF007
     C           WWIN73    IFEQ '0'                                       CFF007
     C                     EXSR WINTYP                                    CFF007
     C                     ENDIF                                          CFF007
     C                     END                                            073714
     C/COPY WNCPYSRC,FF0020C108
     C                     EXSR WTRANS                                                        205075
     C**
     C**   If WRITE fail :-
     C********** *IN73     IFEQ '1'                                       CFF007
     C           WWIN73    IFEQ '1'                                       CFF007
     C**
     C           STATUS    IFEQ 01021
     C**   - 'Rec Upd by Another Wrkskn' - discontinue updates/Rollback
     C                     EXSR TUDBAW
     C                     Z-ADD0         STATUS  50
     C                     GOTO UINSED
     C                     ELSE
     C**   - cancel program
     C                     EXSR INFSR
     C                     END
     C**
     C                     END
     C**
     C**   LF/TRSET
     C**   ~~~~~~~~
     C                     EXSR WTRSET
     C/COPY WNCPYSRC,FF0020C035
     C**                                                                  073714
     C**   PF/CNFRPD - to produce O.T.C. confirmations                    073714
     C**   ~~~~~~~~~                                                      073714
     C**   (if Enhanced OTC is present)                                   CFF001
     C           SMRKT     IFEQ '  '                                      073714
     C           CFF001    ANDEQ'Y'                                       CFF001
     C/COPY WNCPYSRC,FF0020C036
     C                     EXSR WCNFRP                                    073714
     C/COPY WNCPYSRC,FF0020C037
     C                     END                                            073714
     C**
     C*****LF/TRANS new link****                                          097069
     C*****~~~~~~~~~~~~~~~~~****                                          097069
     C***********SLNKR     IFNE *BLANK                                    097069
     C************                                                        097069
     C************         EXSR UTRNLK                                    097069
     C************                                                        097069
     C*****-*If*Linked Ref record changed, discontinue updates            097069
     C************IN11     CABEQ'1'       UINSED                          097069
     C************                                                        097069
     C************         END                                            097069
     C/SPACE 2
     C**   LF/MEMOSM + LF/PRONOM - only updated for 'Options' with a
     C**   ~~~~~~~~~~~~~~~~~~~~~  Premium Up Front Ind. = 'Y'.
     C**                          (Premiums are not paid on 'Futures')
     C**
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C           PUPF      ANDEQ'Y'
     C**
     C** Also need to condition following updates on whether it is an     085490
     C** OTC trade. ISTI = 'N' means it is not an OTC trade.              085490
     C           ISTI      ANDEQ'N'                                       085490
     C**                                                                  085490
     C**   LF/MEMOSM (Apply)
     C**   ~~~~~~~~~
     C**   - Customer
     C           CMIND     IFEQ 'Y'
     C                     MOVE CBID      MMBRCA                          S01117
     C                     MOVE WCSLA1    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE WCSLA2    MMACOD                          S01117
     C                     MOVE WCSLA3    MMACSQ                          S01117
     C***********          MOVE WCSLA1    FFCNUM                          S01117
     C***********          MOVE WCSLA2    FFACOD                          S01117
     C***********          MOVE WCSLA3    FFACSQ                          S01117
     C   14      PRMP      MULT -1        PRMP
     C                     EXSR UAMEMS
     C   14      PRMP      MULT -1        PRMP
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND   1                       S01240
     C                     MOVE 'M'       MPIND   1                       S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA  3                       FO0017
     C**********           MOVE MMCNUM    FOCNUM  60                                   FO0025 CSD027
     C                     MOVE MMCNUM    FOCNUM  6                                           CSD027
     C                     MOVE MMCURR    FOCURR  3                       FO0025
     C**********           MOVE MMACOD    FOACOD  40                                   FO0025 CGL029
     C                     MOVE MMACOD    FOACOD 100                                          CGL029
     C                     MOVE MMACSQ    FOACSQ  20                      FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**   - Broker
     C           BMIND     IFEQ 'Y'
     C                     MOVE BBID      MMBRCA                          S01117
     C                     MOVE WBSLA1    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE WBSLA2    MMACOD                          S01117
     C                     MOVE WBSLA3    MMACSQ                          S01117
     C***********          MOVE WBSLA1    FFCNUM                          S01117
     C***********          MOVE WBSLA2    FFACOD                          S01117
     C***********          MOVE WBSLA3    FFACSQ                          S01117
     C                     EXSR UAMEMS
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C**   LF/PRONOM (Apply)
     C**   ~~~~~~~~~
     C**   - Customer
     C           CPIND     IFEQ 'Y'
     C                     MOVE XXCNOS    FFNOSN
     C   14      PRMP      MULT -1        PRMP
     C                     EXSR UAPRON
     C   14      PRMP      MULT -1        PRMP
     C**                                                                  S01240
     C           CMIND     IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XXCNOS    FONOSN  20                      FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**   - Broker
     C           BPIND     IFEQ 'Y'
     C                     MOVE XXBNOS    FFNOSN
     C                     EXSR UAPRON
     C**                                                                  S01240
     C           BMIND     IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XXBNOS    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C                     END
     C/SPACE 2                                                            S01117
     C**   LF/FOPCC + LF/FOPCK - Positions Profit Centre                  S01117
     C**   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                  S01117
     C           PFCU      IFEQ 'Y'                                       S01117
     C                     EXSR UAPRFC                                    S01117
     C                     END                                            S01117
     C**                                                                  085490
     C           ISTI      IFEQ 'Y'                                       085490
     C                     EXSR OTCACM                                    085490
     C                     END                                            085490
     C**                                                                  085490
     C/SPACE 2
     C**   LF/POSTN - Positions
     C**   ~~~~~~~~~~~~~~~~~~~~
     C**   - Calculate  Total Transaction Value
     C**
     C                     Z-ADDWNUCO     FFNOC
     C                     Z-ADDCOPRTR    FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C**
     C                     EXSR FFTVCL
     C                     Z-ADDFFTNVL    WCTNVL 130
     C**
     C**   LF/POSTNC (apply)
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNC
     C                     END
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNB
     C                     END
     C**
     C**   LF/POSTNK (apply)
     C**   ~~~~~~~~~
     C**   - Book
     C********** BOCOTR    IFNE 0                                                             CSD027
     C********** CUSCTR    ANDEQ0                                                             CSD027
     C********** BOCOTR    OREQ 0                                                             CSD027
     C********** CUSCTR    ANDNE0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C           CUSCTR    ANDEQ*BLANKS                                                       CSD027
     C           BOCOTR    OREQ *BLANKS                                                       CSD027
     C           CUSCTR    ANDNE*BLANKS                                                       CSD027
     C                     EXSR UPSTNK
     C                     END
     C/SPACE 2
     C**   PF/TRANSA
     C**   ~~~~~~~~~
     C                     EXSR UTRNSA
     C*
     C/COPY WNCPYSRC,FF0020CCP2
     C*
     C*                                                                   CFF003
     C** If value date is greater than or equal to run date,              CFF003
     C** call program FF1706                                              CFF003
     C*                                                                   CFF003
     C           CFF003    IFEQ 'Y'                                       CFF003
     C*                                                                   CFF003
     C           VALD      IFGE PRUND                                     CFF003
     C                     CALL 'FF1706'                                  CFF003
     C                     PARM           @TRANS                          CFF003
     C                     PARM           @TRSET                          CFF003
     C                     PARM *BLANK    @RTCD                           CFF003
     C                     PARM *BLANK    @ERRF   8                       CFF003
     C                     PARM *BLANK    @ERRK  29                       CFF003
     C                     PARM 'I'       @MODE   1                       CFF003
     C*                                                                   CFF003
     C** Check for return code of '*ERROR'                                CFF003
     C*                                                                   CFF003
     C           @RTCD     IFEQ '*ERROR'                                  CFF003
     C           *LOCK     IN   LDA                                                           215092
     C                     ROLBK                                          CFF003
     C                     Z-ADD28        DBASE            *************  CFF003
     C                     MOVEL@ERRF     DBFILE           *DB ERROR 28*  CFF003
     C                     MOVEL@ERRK     DBKEY            *************  CFF003
     C                     EXSR DBERR                                     CFF003
     C                     ENDIF                                          CFF003
     C*                                                                   CFF003
     C** Check for return code of 'NO DEAL' or 'NO TRAD'                  CFF003
     C*                                                                   CFF003
     C           @RTCD     IFEQ 'NO DEAL'                                 CFF003
     C           @RTCD     OREQ 'NO TRAD'                                 CFF003
     C           *LOCK     IN   LDA                                                           215092
     C                     ROLBK                                          CFF003
     C                     Z-ADD29        DBASE            *************  CFF003
     C                     MOVEL'FF1706'  DBFILE           *DB ERROR 29*  CFF003
     C                     MOVEL@RTCD     DBKEY            *************  CFF003
     C                     EXSR DBERR                                     CFF003
     C                     ENDIF                                          CFF003
     C*                                                                   CFF003
     C                     ENDIF                                          CFF003
     C                     ENDIF                                          CFF003
     C*                                                                   CFF003
     C**
     C**   End of Commitment Cycle
     C**
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP22                                           S01408
      *                                                                   S01408
     C**
     C           UINSED    ENDSR                           *** UINSED ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
      /EJECT                                                              CFF007
      *****************************************************************   CFF007
      *                                                               *   CFF007
      *  VVDAT - Validate Value Date                                  *   CFF007
      *  Called from: VINSRT                                          *   CFF007
      *                                                               *   CFF007
      *  Calls      : ZDATE3                                          *   CFF007
      *                                                               *   CFF007
      *****************************************************************   CFF007
      *                                                                   CFF007
     C           VVDAT     BEGSR                                          CFF007
      *                                                                   CFF007
      ** Validate when CFF007 is installed                                CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
      ** If blank and Trade date is not in error                          CFF007
      ** set equal to Trade date plus two working days for OTC            CFF007
      ** and to Trade + 1 working day for MARKET                          CFF007
      **                                                                  CFF007
     C           SVALD     IFEQ *BLANK                                    CFF007
     C           *IN31     ANDNE*ON                                       CFF007
     C                     Z-ADDWTRSD     ZDAYNO                          CFF007
     C                     MOVE KCCY      ZCCY                            CFF007
      *                                                                   CFF007
     C           ISTI      IFEQ 'Y'                                       CFF007
     C                     Z-ADD2         ZNRDYS                          CFF007
     C                     MOVE *BLANKS   ZLOC                            CFF007
     C                     ELSE                                           CFF007
     C                     Z-ADD1         ZNRDYS                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     EXSR ZFWDT                                     CFF007
     C                     MOVE ZDYNBR    ZDAYNO                          CFF007
     C                     EXSR ZDATE2                                    CFF007
     C                     MOVE ZDATE     SVALD                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Valid date format                                                CFF007
      *                                                                   CFF007
     C                     MOVELSVALD     WTSTN7                          CFF007
     C                     TESTN          WTSTN7     71                   CFF007
      *                                                                   CFF007
      ** If numeric                                                       CFF007
      *                                                                   CFF007
     C           *IN71     IFEQ *ON                                       CFF007
     C                     MOVE SVALD     ZDATE                           CFF007
     C                     EXSR ZDATE1                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Invalid format or not numeric                                    CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ *ON                                       CFF007
     C           *IN71     OREQ *OFF                                      CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 325'    ERR,E                           CFF007
     C                     SETON                     1843                 CFF007
     C                     GOTO VVEND                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     Z-ADDZDAYNO    WVALD                           CFF007
      *                                                                   CFF007
      ** Must not be greater than settlement date                         CFF007
      *                                                                   CFF007
     C           SMRKT     IFNE '  '                                      CFF007
     C                     MOVE SEDF      FFDATC                          CFF007
     C                     Z-ADDWMTHN     FFMTH                           CFF007
     C                     Z-ADDWYRNO     FFYR                            CFF007
     C                     MOVE PMKLC     FFCCY1                          CFF007
     C                     MOVE KCCY      FFCCY2                          CFF007
     C                     MOVE OTHC      FFCCY3                          CFF007
     C                     MOVE *IN81     WIN81                           CFF007
     C                     MOVE *IN82     WIN82                           CFF007
     C                     EXSR FFDATE                                    CFF007
     C                     MOVE WIN81     *IN81                           CFF007
     C                     MOVE WIN82     *IN82                           CFF007
     C                     Z-ADDFFDAY     WSETD   50                      CFF007
     C                     ELSE                                           CFF007
     C                     Z-ADDSETD      WSETD                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           WVALD     IFGT WSETD                                     CFF007
     C           *IN46     ANDEQ'0'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 329'    ERR,E                           CFF007
     C                     SETON                     1843                 CFF007
     C                     GOTO VVEND                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Must not be before Trade Date                                    CFF007
      *                                                                   CFF007
     C           WVALD     IFLT WTRSD                                     CFF007
     C           *IN31     ANDEQ'0'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 326'    ERR,E                           CFF007
     C                     SETON                     1843                 CFF007
     C                     GOTO VVEND                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Must not be a Holiday                                            CFF007
      *                                                                   CFF007
     C           SMRKT     IFNE '  '                                      CFF007
     C                     MOVE PMKLC     ZCCY                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE LOCY      ZCCY                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     Z-ADDWVALD     ZDAYNO                          CFF007
     C                     MOVE *BLANK    ZIND                            CFF007
     C                     MOVE *BLANKS   ZLOC                            CFF007
     C                     EXSR ZCHKH                                     CFF007
      *                                                                   CFF007
     C           ZIND      IFEQ 'H'                                       CFF007
     C           E         ADD  1         E                               CFF007
     C                     MOVE ' 328'    ERR,E                           CFF007
     C                     SETON                     1843                 CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           VVEND     ENDSR                                          CFF007
      *****************************************************************   CFF007
     C/COPY WNCPYSRC,FF0020CP25                                           S01408
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UAMEND SR. -  Update  Amend Control                           *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                   SR. INFSR                    *
     C**       SR. ADEOTC                   SR. TUDBAW                   *
     C**                                    SR. ICOMIT                   *
     C**                                    SR. UTRANS                   *
     C**                                    SR. UTRSET                   *
     C**************************************SR. UTROLK                   *097069
     C**************************************SR. UTRNLK                   *097069
     C**                                    SR. URMEMS                   *
     C**                                    SR. WACMVD                   *S01240
     C**                                    SR. UAMEMS                   *
     C**                                    SR. URPRON                   *
     C**                                    SR. UAPRON                   *
     C**                                    SR. UAPRFC                   *S01117
     C**                                    SR. FFTVCL                   *
     C**                                    SR. UPSTNC                   *
     C**                                    SR. UPSTNB                   *
     C**                                    SR. UPSTNK                   *
     C**                                    SR. UTRNSA                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           UAMEND    BEGSR                           ** UAMEND SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP33                                           S01408
     C*                                                                   S01408
     C**
     C**    If screen details have been amended, process updates          081630
     C**                                                                  081630
     C***********SMIODS    IFNE SMIOSV                              081630174957
     C***********SSETDS    ORNE SSETSV                              081630174957
     C***********SMPIDS    ORNE SMPISV                              CPL002174957
     C/COPY WNCPYSRC,FF0020C120
     C**                                                                  081630
     C**   Access LF/TRANS main
     C**          ~~~~~~~~~~~~~
     C           KTNBR     CHAINTRANS                71
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the trade details before they are changed in any way.       085490
     C                     MOVEL@TRANS    Z#BSTS                          085490
     C**
     C**   - not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '12'      DBASE            ** DBERR  12 **S01117
     C                     Z-ADD12        DBASE            ** DBERR  12 **S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELKTNBR     DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   - if Rec Upd by Another Wrkstn - discontinue updates/Rollback
     C           TNLU      IFNE XTNLU
     C                     EXSR TUDBAW
     C                     GOTO UAMDED
     C                     END
     C**
     C**   Initialise 'COMIT' text
     C                     EXSR ICOMIT
     C**
     C**   Update LF/TRANS main
     C**          ~~~~~~~~~~~~~
     C                     EXSR UTRANS
     C**
     C**   LF/TRSET
     C**   ~~~~~~~~
     C                     EXSR UTRSET
     C/COPY WNCPYSRC,FF0020C038
     C**                                                                  CFF001
     C**   PF/CNFRPD - to produce O.T.C. confirmations                    CFF001
     C**   ~~~~~~~~~                                                      CFF001
     C**   (if Enhanced OTC is present)                                   CFF001
     C           SMRKT     IFEQ '  '                                      CFF001
     C           CFF001    ANDEQ'Y'                                       CFF001
     C**                                                                  CFF001
     C**   If premium payable or settlement instructions have changed     CFF001
     C**                                                                  CFF001
     C           XPRMP     IFNE PRMP                                      CFF001
     C           XCSLT     ORNE CSLT                                      CFF001
     C           XCSLA     ORNE CSLA                                      CFF001
     C           XBRSC     ORNE BRSC                                      CFF001
     C/COPY WNCPYSRC,FF0020C039
     C                     EXSR WCNFRP                                    CFF001
     C/COPY WNCPYSRC,FF0020C040
     C                     END                                            CFF001
     C                     END                                            CFF001
     C**
     C*****LF/TRANS link****                                              097069
     C*****~~~~~~~~~~~~~****                                              097069
     C***********SLNKR     IFNE XLNKR                                     097069
     C*****-old*link                                                      097069
     C***********XLNKR     IFNE *ZEROS                                    097069
     C************         EXSR UTROLK                                    097069
     C************         END                                            097069
     C*****-new*link                                                      097069
     C***********SLNKR     IFNE *BLANK                                    097069
     C************         EXSR UTRNLK                                    097069
     C************         END                                            097069
     C************                                                        097069
     C*****-*If*Linked Ref record changed, discontinue updates            097069
     C************                                                        097069
     C************IN11     CABEQ'1'       UAMDED                          097069
     C************                                                        097069
     C************         END                                            097069
     C/SPACE 2
     C**   LF/MEMOSM + LF/PRONOM - only updated for 'Options' with a
     C**   ~~~~~~~~~~~~~~~~~~~~~  Premium Up Front ind. = 'Y'.
     C**                          (Premiums are not paid on 'Futures')
     C**                          and if EOC processed ind. = 'N'
     C**
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C           PUPF      ANDEQ'Y'
     C           *IN65     ANDEQ'1'
     C**
     C** Also need to condition following updates on whether it is an     085490
     C** OTC trade. ISTI = 'N' means it is not an OTC trade.              085490
     C           ISTI      ANDEQ'N'                                       085490
     C**                                                                  085490
     C**   LF/MEMOSM
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**
     C**     - Reverse
     C                     MOVE SBRCD     FFBRCA                          S01117
     C                     MOVE CUSCTR    FFCBCD
     C                     MOVE 'N'       FFBRKI
     C                     MOVE XCSLT     FFSETP
     C                     MOVE XCSLA     FFSETA
     C                     MOVE XBRSC     FFSETB                          S01117
     C                     EXSR FFSETL
     C                     SETOF                     89
     C                     MOVE FFPIND    FFCPIN  1
     C                     MOVE FFNOSN    XCNOSN  20
     C                     MOVE FFMIND    SAVCMN  1                       S01240
     C**
     C           FFMIND    IFEQ 'Y'
     C   14      XPRMP     MULT -1        XPRMP
     C                     MOVE FFBRCB    MMBRCA                          S01117
     C                     MOVE FFCNUM    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE FFACOD    MMACOD                          S01117
     C                     MOVE FFACSQ    MMACSQ                          S01117
     C                     EXSR URMEMS
     C   14      XPRMP     MULT -1        XPRMP
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C**     - Apply
     C           CMIND     IFEQ 'Y'
     C                     MOVE CBID      MMBRCA                          S01117
     C                     MOVE WCSLA1    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE WCSLA2    MMACOD                          S01117
     C                     MOVE WCSLA3    MMACSQ                          S01117
     C***********          MOVE WCSLA1    FFCNUM                          S01117
     C***********          MOVE WCSLA2    FFACOD                          S01117
     C***********          MOVE WCSLA3    FFACSQ                          S01117
     C   14      PRMP      MULT -1        PRMP
     C                     EXSR UAMEMS
     C   14      PRMP      MULT -1        PRMP
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C                     END
     C**
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C**     - Reverse
     C                     MOVE SBRCD     FFBRCA                          S01117
     C                     MOVE BOCOTR    FFCBCD
     C                     MOVE 'Y'       FFBRKI
     C                     MOVE XBSLT     FFSETP
     C                     MOVE XBSLA     FFSETA
     C                     MOVE XBSBR     FFSETB                          S01117
     C                     EXSR FFSETL
     C                     SETOF                     89
     C                     MOVE FFPIND    FFBPIN  1
     C                     MOVE FFNOSN    XBNOSN  20
     C                     MOVE FFMIND    SAVBMN  1                       S01240
     C           FFMIND    IFEQ 'Y'
     C                     MOVE FFBRCB    MMBRCA                          S01117
     C                     MOVE FFCNUM    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE FFACOD    MMACOD                          S01117
     C                     MOVE FFACSQ    MMACSQ                          S01117
     C                     EXSR URMEMS
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C**     - Apply
     C           BMIND     IFEQ 'Y'
     C                     MOVE BBID      MMBRCA                          S01117
     C                     MOVE WBSLA1    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE WBSLA2    MMACOD                          S01117
     C                     MOVE WBSLA3    MMACSQ                          S01117
     C***********          MOVE WBSLA1    FFCNUM                          S01117
     C***********          MOVE WBSLA2    FFACOD                          S01117
     C***********          MOVE WBSLA3    FFACSQ                          S01117
     C                     EXSR UAMEMS
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C                     END
     C**
     C**   LF/PRONOM
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**
     C**     - Reverse
     C           FFCPIN    IFEQ 'Y'
     C                     MOVE XCNOSN    FFNOSN
     C   14      XPRMP     MULT -1        XPRMP
     C                     EXSR URPRON
     C   14      XPRMP     MULT -1        XPRMP
     C**                                                                  S01240
     C           SAVCMN    IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XCNOSN    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C**     - Apply
     C           CPIND     IFEQ 'Y'
     C                     MOVE XXCNOS    FFNOSN
     C   14      PRMP      MULT -1        PRMP
     C                     EXSR UAPRON
     C   14      PRMP      MULT -1        PRMP
     C**                                                                  S01240
     C           CMIND     IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XXCNOS    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C                     END
     C**
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C**     - Reverse
     C           FFBPIN    IFEQ 'Y'
     C                     MOVE XBNOSN    FFNOSN
     C                     EXSR URPRON
     C**                                                                  S01240
     C           SAVBMN    IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XBNOSN    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C**     - Apply
     C           BPIND     IFEQ 'Y'
     C                     MOVE XXBNOS    FFNOSN
     C                     EXSR UAPRON
     C**                                                                  S01240
     C           BMIND     IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'A' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'A'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XXBNOS    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2                                                            S01117
     C**   LF/FOPCC + LF/FOPCK - Positions Profit Centre                  S01117
     C**   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~                  S01117
     C           PFCU      IFEQ 'Y'                                       S01117
     C           PFCA      ANDEQ'Y'                                       S01117
     C           TBRC      ANDEQ'N'                                       S01117
     C                     EXSR UAPRFC                                    S01117
     C                     END                                            S01117
     C**                                                                  085490
     C           ISTI      IFEQ 'Y'                                       085490
     C                     EXSR OTCACM                                    085490
     C                     END                                            085490
     C**                                                                  085490
     C/SPACE 2
     C**   LF/POSTN - Positions
     C**   ~~~~~~~~~~~~~~~~~~~~
     C**   - Calculate  Total Transaction Value
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C**    - old
     C                     Z-ADDXNUCO     FFNOC
     C                     Z-ADDXCOPR     FFPRIC
     C                     EXSR FFTVCL
     C                     Z-ADDFFTNVL    XCTNVL 130
     C**    - new
     C                     Z-ADDWNUCO     FFNOC
     C                     Z-ADDCOPRTR    FFPRIC
     C                     EXSR FFTVCL
     C                     Z-ADDFFTNVL    WCTNVL 130
     C**   LF/POSTNC
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNC
     C                     END
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNB
     C                     END
     C**   LF/POSTNK
     C**   ~~~~~~~~~
     C**   - Book
     C********** BOCOTR    IFNE 0                                                             CSD027
     C********** CUSCTR    ANDEQ0                                                             CSD027
     C********** BOCOTR    OREQ 0                                                             CSD027
     C********** CUSCTR    ANDNE0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C           CUSCTR    ANDEQ*BLANKS                                                       CSD027
     C           BOCOTR    OREQ *BLANKS                                                       CSD027
     C           CUSCTR    ANDNE*BLANKS                                                       CSD027
     C                     EXSR UPSTNK
     C                     END
     C/SPACE 2
     C**   PF/TRANSA
     C**   ~~~~~~~~~
     C                     EXSR UTRNSA
     C/COPY WNCPYSRC,FF0020C041
      *                                                                   CPL002
      ** If Midas-Plato Interface Installed, then set up fields           CPL002
      ** introduced by this module                                        CPL002
      *                                                                   CPL002
     C**   PF/INTYPD - for undefined O.T.C.s                              CPL002
     C**   ~~~~~~~~~                                                      CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C           SMRKT     ANDEQ'  '                                      CPL002
     C                     EXSR UINTYP                                    CPL002
     C                     END                                            CPL002
     C**
     C**   End of Commitment Cycle
     C**
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP23                                           S01408
      *                                                                   S01408
     C**
     C***********          END                                      081630174957
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP34                                           S01408
     C*                                                                   S01408
     C**
     C           UAMDED    ENDSR                           *** UAMDED ***
     C**        ~~~~~~~~
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UDELET SR. -  Update  Delete Control                          *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. ADEMKI                   SR. INFSR                    *
     C**       SR. ADEOTC                   SR. TUDBAW                   *
     C**                                    SR. ICOMIT                   *
     C**                                    SR. UTRANS                   *
     C**                                    SR. UTRSET                   *
     C**************************************SR. UTROLK                   *097069
     C**                                    SR. UCLOST                   *
     C**                                    SR. URMEMS                   *
     C**                                    SR. WACMVD                   *S01240
     C**                                    SR. URPRON                   *
     C**                                    SR. FFTVCL                   *
     C**                                    SR. UPSTNC                   *
     C**                                    SR. UPSTNB                   *
     C**                                    SR. UPSTNK                   *
     C**                                    SR. UTRNSA                   *
     C**                                                                 *
     C********************************************************************
     C**
     C           UDELET    BEGSR                           ** UDELET SR **
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP35                                           S01408
     C*                                                                   S01408
     C**
     C**   Access LF/TRANS main
     C**          ~~~~~~~~~~~~~
     C           KTNBR     CHAINTRANS                71
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the trade details before they are changed in any way.       085490
     C                     MOVEL@TRANS    Z#BSTS                          085490
     C**
     C**   - not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '13'      DBASE            ** DBERR  13 **S01117
     C                     Z-ADD13        DBASE            ** DBERR  13 **S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELKTNBR     DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   - if Rec Upd by Another Wrkstn - discontinue updates/Rollback
     C           TNLU      IFNE XTNLU
     C                     EXSR TUDBAW
     C                     GOTO UDELED
     C                     END
     C**
     C**   Initialise 'COMIT' text
     C                     EXSR ICOMIT
     C**
     C**   Update LF/TRANS main
     C**          ~~~~~~~~~~~~~
     C                     EXSR UTRANS
     C**
     C**   LF/TRSET
     C**   ~~~~~~~~
     C                     EXSR UTRSET
     C**
     C*****LF/TRANS old link****                                          097069
     C*****~~~~~~~~~~~~~~~~~****                                          097069
     C***********SLNKR     IFNE *BLANK                                    097069
     C************         EXSR UTROLK                                    097069
     C************         END                                            097069
     C**
     C**   LF/CLOST
     C**   ~~~~~~~~
     C           *IN66     IFEQ '0'
     C                     EXSR UCLOST
     C                     END
     C/SPACE 2
     C**   LF/MEMOSM + LF/PRONOM - only updated for 'Options' with a
     C**   ~~~~~~~~~~~~~~~~~~~~~  Premium Up Front ind. = 'Y'.
     C**                          (Premiums are not paid on 'Futures')
     C**
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C           PUPF      ANDEQ'Y'
     C**
     C** Also need to condition following updates on whether it is an     085490
     C** OTC trade. ISTI = 'N' means it is not an OTC trade.              085490
     C           ISTI      ANDEQ'N'                                       085490
     C**                                                                  085490
     C**   LF/MEMOSM (Reverse)
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**
     C                     MOVE SBRCD     FFBRCA                          S01117
     C                     MOVE CUSCTR    FFCBCD
     C                     MOVE 'N'       FFBRKI
     C                     MOVE XCSLT     FFSETP
     C                     MOVE XCSLA     FFSETA
     C                     MOVE XBRSC     FFSETB                          S01117
     C                     EXSR FFSETL
     C                     SETOF                     89
     C                     MOVE FFPIND    FFCPIN  1
     C                     MOVE FFNOSN    XCNOSN  20
     C                     MOVE FFMIND    SAVCMN                          S01240
     C**
     C           FFMIND    IFEQ 'Y'
     C   14      XPRMP     MULT -1        XPRMP
     C                     MOVE FFBRCB    MMBRCA                          S01117
     C                     MOVE FFCNUM    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE FFACOD    MMACOD                          S01117
     C                     MOVE FFACSQ    MMACSQ                          S01117
     C                     EXSR URMEMS
     C   14      XPRMP     MULT -1        XPRMP
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C                     END
     C**
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C                     MOVE SBRCD     FFBRCA                          S01117
     C                     MOVE BOCOTR    FFCBCD
     C                     MOVE 'Y'       FFBRKI
     C                     MOVE XBSLT     FFSETP
     C                     MOVE XBSLA     FFSETA
     C                     MOVE XBSBR     FFSETB                          S01117
     C                     EXSR FFSETL
     C                     SETOF                     89
     C                     MOVE FFPIND    FFBPIN  1
     C                     MOVE FFNOSN    XBNOSN  20
     C           FFMIND    IFEQ 'Y'
     C                     MOVE FFBRCB    MMBRCA                          S01117
     C                     MOVE FFCNUM    MMCNUM                          S01117
     C                     MOVE FFCCY     MMCURR                          S01117
     C                     MOVE FFACOD    MMACOD                          S01117
     C                     MOVE FFACSQ    MMACSQ                          S01117
     C                     EXSR URMEMS
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'M'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE MMCNUM    FOCNUM                          FO0025
     C                     MOVE MMCURR    FOCURR                          FO0025
     C                     MOVE MMACOD    FOACOD                          FO0025
     C                     MOVE MMACSQ    FOACSQ                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END
     C**
     C                     END
     C**
     C**   LF/PRONOM (Reverse)
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**
     C           FFCPIN    IFEQ 'Y'
     C                     MOVE XCNOSN    FFNOSN
     C   14      XPRMP     MULT -1        XPRMP
     C                     EXSR URPRON
     C   14      XPRMP     MULT -1        XPRMP
     C**                                                                  S01240
     C           SAVCMN    IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE CBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XCNOSN    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C                     END
     C**
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C           FFBPIN    IFEQ 'Y'
     C                     MOVE XBNOSN    FFNOSN
     C                     EXSR URPRON
     C**                                                                  S01240
     C           SAVBMN    IFNE 'Y'                                       S01240
     C**                                                                  S01240
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         S01240
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 S01240
     C                     MOVE 'R'       RAIND                           S01240
     C                     MOVE 'P'       MPIND                           S01240
     C**                                                                  S01240
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       FO0017
     C                     MOVE BBID      FOBRCA                          FO0017
     C                     MOVE FFCCY     FOCURR                          FO0025
     C                     MOVE XBNOSN    FONOSN                          FO0025
     C**                                                                  FO0025
     C**     Write record to PF/FFACMVD                                   S01240
     C                     EXSR WACMVD                                    S01240
     C*                                                                   S01240
     C                     END                                            S01240
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**                                                                  085490
     C           ISTI      IFEQ 'Y'                                       085490
     C                     EXSR OTCACM                                    085490
     C                     END                                            085490
     C**                                                                  085490
     C/SPACE 2
     C**   LF/POSTN - Positions
     C**   ~~~~~~~~~~~~~~~~~~~~
     C**   - Calculate  Total Transaction Value (Customer/Book)
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C**
     C                     Z-ADDXNUCO     FFNOC
     C                     Z-ADDXCOPR     FFPRIC
     C                     EXSR FFTVCL
     C                     Z-ADDFFTNVL    XCTNVL 130
     C**
     C**   LF/POSTNC (Reverse)
     C**   ~~~~~~~~~
     C**   - Customer
     C********** CUSCTR    IFNE 0                                                             CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNC
     C                     END
     C**   - Broker
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNB
     C                     END
     C**
     C**   LF/POSTNK (Reverse)
     C**   ~~~~~~~~~
     C**   - Book
     C********** BOCOTR    IFNE 0                                                             CSD027
     C********** CUSCTR    ANDEQ0                                                             CSD027
     C********** BOCOTR    OREQ 0                                                             CSD027
     C********** CUSCTR    ANDNE0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C           CUSCTR    ANDEQ*BLANKS                                                       CSD027
     C           BOCOTR    OREQ *BLANKS                                                       CSD027
     C           CUSCTR    ANDNE*BLANKS                                                       CSD027
     C                     EXSR UPSTNK
     C                     END
     C/SPACE 2
     C**   PF/TRANSA
     C**   ~~~~~~~~~
     C                     EXSR UTRNSA
     C**
     C**   End of Commitment Cycle
     C**
     C           CMTTXT    COMIT
      *                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP24                                           S01408
      *                                                                   S01408
     C**
     C           UDELED    ENDSR                           *** UDELED ***
     C**        ~~~~~~~~
     C**
     C/COPY WNCPYSRC,FF0020C051
     C********************************************************************
     C/EJECT                                                              122246
     C********************************************************************122246
     C**                                                                 *122246
     C**   UDELE2 SR. -  Update  Delete Control For close-out trades     *122246
     C**   ~~~~~~~~~~                                                    *122246
     C**      Called From                  Calls                         *122246
     C**       SR. ADEMKI                   SR. INFSR                    *122246
     C**       SR. ADEOTC                   SR. TUDBAW                   *122246
     C**                                    SR. ICOMIT                   *122246
     C**                                    SR. UTRANS                   *122246
     C**                                    SR. UTRSET                   *122246
     C**                                    SR. UCLOST                   *122246
     C**                                    SR. URMEMS                   *122246
     C**                                    SR. WACMVD                   *122246
     C**                                    SR. URPRON                   *122246
     C**                                    SR. FFTVCL                   *122246
     C**                                    SR. UPSTNC                   *122246
     C**                                    SR. UPSTNB                   *122246
     C**                                    SR. UPSTNK                   *122246
     C**                                    SR. UTRNSA                   *122246
     C**                                                                 *122246
     C********************************************************************122246
     C**                                                                  122246
     C           UDELE2    BEGSR                           ** UDELET SR **122246
     C**                                                                  122246
     C**   Access LF/TRANS main                                           122246
     C**          ~~~~~~~~~~~~~                                           122246
     C           KTNBR     CHAINTRANS                71                   122246
     C**                                                                  122246
     C**   - not found no database error and goto ENDSR                   122246
     C           *IN71     IFEQ '1'                                       122246
     C                     GOTO UDELE3                                    122246
     C                     END                                            122246
     C**                                                                  122246
     C**   Initialise 'COMIT' text                                        122246
     C                     EXSR ICOMIT                                    122246
     C**                                                                  122246
     C**   Update LF/TRANS main                                           122246
     C**          ~~~~~~~~~~~~~                                           122246
     C                     EXSR UTRANS                                    122246
     C**                                                                  122246
     C**   LF/TRSET                                                       122246
     C**   ~~~~~~~~                                                       122246
     C                     EXSR UTRSET                                    122246
     C**                                                                  122246
     C/SPACE 2                                                            122246
     C**   LF/MEMOSM + LF/PRONOM - only updated for 'Options' with a      122246
     C**   ~~~~~~~~~~~~~~~~~~~~~  Premium Up Front ind. = 'Y'.            122246
     C**                          (Premiums are not paid on 'Futures')    122246
     C**                                                                  122246
     C           ISPT      IFGE 4                                         122246
     C           ISPT      ANDNE7                                         122246
     C           PUPF      ANDEQ'Y'                                       122246
     C**                                                                  122246
     C** Also need to condition following updates on whether it is an     122246
     C** OTC trade. ISTI = 'N' means it is not an OTC trade.              122246
     C           ISTI      ANDEQ'N'                                       122246
     C**                                                                  122246
     C**   LF/MEMOSM (Reverse)                                            122246
     C**   ~~~~~~~~~                                                      122246
     C**   - Customer                                                     122246
     C********** CUSCTR    IFNE 0                                                      122246 CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**                                                                  122246
     C                     MOVE SBRCD     FFBRCA                          122246
     C                     MOVE CUSCTR    FFCBCD                          122246
     C                     MOVE 'N'       FFBRKI                          122246
     C                     MOVE XCSLT     FFSETP                          122246
     C                     MOVE XCSLA     FFSETA                          122246
     C                     MOVE XBRSC     FFSETB                          122246
     C                     EXSR FFSETL                                    122246
     C                     SETOF                     89                   122246
     C                     MOVE FFPIND    FFCPIN  1                       122246
     C                     MOVE FFNOSN    XCNOSN  20                      122246
     C                     MOVE FFMIND    SAVCMN                          122246
     C**                                                                  122246
     C           FFMIND    IFEQ 'Y'                                       122246
     C   14      XPRMP     MULT -1        XPRMP                           122246
     C                     MOVE FFBRCB    MMBRCA                          122246
     C                     MOVE FFCNUM    MMCNUM                          122246
     C                     MOVE FFCCY     MMCURR                          122246
     C                     MOVE FFACOD    MMACOD                          122246
     C                     MOVE FFACSQ    MMACSQ                          122246
     C                     EXSR URMEMS                                    122246
     C   14      XPRMP     MULT -1        XPRMP                           122246
     C**                                                                  122246
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         122246
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 122246
     C                     MOVE 'R'       RAIND                           122246
     C                     MOVE 'M'       MPIND                           122246
     C**                                                                  122246
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       122246
     C                     MOVE CBID      FOBRCA                          122246
     C                     MOVE MMCNUM    FOCNUM                          122246
     C                     MOVE MMCURR    FOCURR                          122246
     C                     MOVE MMACOD    FOACOD                          122246
     C                     MOVE MMACSQ    FOACSQ                          122246
     C**                                                                  122246
     C**     Write record to PF/FFACMVD                                   122246
     C                     EXSR WACMVD                                    122246
     C*                                                                   122246
     C                     END                                            122246
     C**                                                                  122246
     C                     END                                            122246
     C**                                                                  122246
     C**   - Broker                                                       122246
     C********** BOCOTR    IFNE 0                                                      122246 CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**                                                                  122246
     C                     MOVE SBRCD     FFBRCA                          122246
     C                     MOVE BOCOTR    FFCBCD                          122246
     C                     MOVE 'Y'       FFBRKI                          122246
     C                     MOVE XBSLT     FFSETP                          122246
     C                     MOVE XBSLA     FFSETA                          122246
     C                     MOVE XBSBR     FFSETB                          122246
     C                     EXSR FFSETL                                    122246
     C                     SETOF                     89                   122246
     C                     MOVE FFPIND    FFBPIN  1                       122246
     C                     MOVE FFNOSN    XBNOSN  20                      122246
     C           FFMIND    IFEQ 'Y'                                       122246
     C                     MOVE FFBRCB    MMBRCA                          122246
     C                     MOVE FFCNUM    MMCNUM                          122246
     C                     MOVE FFCCY     MMCURR                          122246
     C                     MOVE FFACOD    MMACOD                          122246
     C                     MOVE FFACSQ    MMACSQ                          122246
     C                     EXSR URMEMS                                    122246
     C**                                                                  122246
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         122246
     C**     Update Indicator to 'M' (used in SR. WACMVD)                 122246
     C                     MOVE 'R'       RAIND                           122246
     C                     MOVE 'M'       MPIND                           122246
     C**                                                                  122246
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       122246
     C                     MOVE BBID      FOBRCA                          122246
     C                     MOVE MMCNUM    FOCNUM                          122246
     C                     MOVE MMCURR    FOCURR                          122246
     C                     MOVE MMACOD    FOACOD                          122246
     C                     MOVE MMACSQ    FOACSQ                          122246
     C**                                                                  122246
     C**     Write record to PF/FFACMVD                                   122246
     C                     EXSR WACMVD                                    122246
     C*                                                                   122246
     C                     END                                            122246
     C**                                                                  122246
     C                     END                                            122246
     C**                                                                  122246
     C**   LF/PRONOM (Reverse)                                            122246
     C**   ~~~~~~~~~                                                      122246
     C**   - Customer                                                     122246
     C********** CUSCTR    IFNE 0                                                      122246 CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C**                                                                  122246
     C           FFCPIN    IFEQ 'Y'                                       122246
     C                     MOVE XCNOSN    FFNOSN                          122246
     C   14      XPRMP     MULT -1        XPRMP                           122246
     C                     EXSR URPRON                                    122246
     C   14      XPRMP     MULT -1        XPRMP                           122246
     C**                                                                  122246
     C           SAVCMN    IFNE 'Y'                                       122246
     C**                                                                  122246
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         122246
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 122246
     C                     MOVE 'R'       RAIND                           122246
     C                     MOVE 'P'       MPIND                           122246
     C**                                                                  122246
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       122246
     C                     MOVE CBID      FOBRCA                          122246
     C                     MOVE FFCCY     FOCURR                          122246
     C                     MOVE XCNOSN    FONOSN                          122246
     C**                                                                  122246
     C**     Write record to PF/FFACMVD                                   122246
     C                     EXSR WACMVD                                    122246
     C*                                                                   122246
     C                     END                                            122246
     C                     END                                            122246
     C**                                                                  122246
     C                     END                                            122246
     C**                                                                  122246
     C**   - Broker                                                       122246
     C********** BOCOTR    IFNE 0                                                      122246 CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**                                                                  122246
     C           FFBPIN    IFEQ 'Y'                                       122246
     C                     MOVE XBNOSN    FFNOSN                          122246
     C                     EXSR URPRON                                    122246
     C**                                                                  122246
     C           SAVBMN    IFNE 'Y'                                       122246
     C**                                                                  122246
     C**     Set Reverse/Apply Indicator to 'R' and MEMOSM/PRONOM         122246
     C**     Update Indicator to 'P' (used in SR. WACMVD)                 122246
     C                     MOVE 'R'       RAIND                           122246
     C                     MOVE 'P'       MPIND                           122246
     C**                                                                  122246
     C**     SET UP BRANCH FOR UPDATE OF PF/FFACMVD                       122246
     C                     MOVE BBID      FOBRCA                          122246
     C                     MOVE FFCCY     FOCURR                          122246
     C                     MOVE XBNOSN    FONOSN                          122246
     C**                                                                  122246
     C**     Write record to PF/FFACMVD                                   122246
     C                     EXSR WACMVD                                    122246
     C*                                                                   122246
     C                     END                                            122246
     C                     END                                            122246
     C**                                                                  122246
     C                     END                                            122246
     C**                                                                  122246
     C                     END                                            122246
     C**                                                                  122246
     C           ISTI      IFEQ 'Y'                                       122246
     C                     EXSR OTCACM                                    122246
     C                     END                                            122246
     C**                                                                  122246
     C/SPACE 2                                                            122246
     C**   LF/POSTN - Positions                                           122246
     C**   ~~~~~~~~~~~~~~~~~~~~                                           122246
     C**   - Calculate  Total Transaction Value (Customer/Book)           122246
     C                     Z-ADDTKDM      FFTKDM                          122246
     C                     Z-ADDMNPF      FFMNPF                          122246
     C**                                                                  122246
     C                     Z-ADDXNUCO     FFNOC                           122246
     C                     Z-ADDXCOPR     FFPRIC                          122246
     C                     EXSR FFTVCL                                    122246
     C                     Z-ADDFFTNVL    XCTNVL 130                      122246
     C**                                                                  122246
     C**   LF/POSTNC (Reverse)                                            122246
     C**   ~~~~~~~~~                                                      122246
     C**   - Customer                                                     122246
     C********** CUSCTR    IFNE 0                                                      122246 CSD027
     C           CUSCTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNC                                    122246
     C                     END                                            122246
     C**   - Broker                                                       122246
     C********** BOCOTR    IFNE 0                                                      122246 CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     EXSR UPSTNB                                    122246
     C                     END                                            122246
     C**                                                                  122246
     C**   LF/POSTNK (Reverse)                                            122246
     C**   ~~~~~~~~~                                                      122246
     C**   - Book                                                         122246
     C********** BOCOTR    IFNE 0                                                      122246 CSD027
     C********** CUSCTR    ANDEQ0                                                      122246 CSD027
     C********** BOCOTR    OREQ 0                                                      122246 CSD027
     C********** CUSCTR    ANDNE0                                                      122246 CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C           CUSCTR    ANDEQ*BLANKS                                                       CSD027
     C           BOCOTR    OREQ *BLANKS                                                       CSD027
     C           CUSCTR    ANDNE*BLANKS                                                       CSD027
     C                     EXSR UPSTNK                                    122246
     C                     END                                            122246
     C/SPACE 2                                                            122246
     C**   PF/TRANSA                                                      122246
     C**   ~~~~~~~~~                                                      122246
     C                     EXSR UTRNSA                                    122246
     C**                                                                  122246
     C**   End of Commitment Cycle                                        122246
     C**                                                                  122246
     C           CMTTXT    COMIT                                          122246
     C**                                                                  122246
     C           UDELE3    ENDSR                           *** UDELED *** 122246
     C**        ~~~~~~~~                                                  122246
     C**                                                                  122246
     C********************************************************************122246
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   ICOMIT SR. -  Initialise 'COMIT' text                         *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                   SR. ZTNLU1                   *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           ICOMIT    BEGSR                           ** ICOMIT SR **
     C**
     C**   Access/Update  Next Available Transaction No.
     C                     EXSR ZTNLU1
     C**
     C**   Setup standard information for COMIT text d.s.
     C                     MOVE 'FF'      MDID
     C                     MOVEL'FF0020  'PGMN
     C                     MOVE WSID      WSIDX
     C                     TIME           MTIME   60
     C                     MOVE SACTN     SACTNX
     C                     MOVE USRID     USRIDX
     C                     MOVE SAMKDS    SAMK
     C                     MOVE SMIODS    SMIO
     C                     MOVE SSETDS    SSET
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   WTRANS SR. -  Write record to  LF/TRANS                       *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           WTRANS    BEGSR                           ** WTRANS SR **
     C**
     C                     MOVE 'D'       RECI
     C                     MOVE STNBR     TNBR
     C**
     C***********          MOVE SBRCD     BRCDTR                          S01117
     C                     MOVE SBRCD     BRCATR                          S01117
     C                     MOVE WCUSC     CUSCTR
     C                     MOVE SBOKC     BOKCTR
     C                     MOVE KISTT     ISTT
     C                     MOVE SPCAL     PCALTR
     C                     Z-ADDWSTRP     STRPTR
     C                     Z-ADDWSPTP     SPTPTR                          CPL002
     C                     MOVE STRTY     TRTYTR
     C                     MOVE ' '       ULTT
     C                     MOVE WTRSD     TRSD
     C/COPY WNCPYSRC,FF0020C010
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C                     MOVE WVALD     VALD                            073714
     C                     ELSE                                           CFF007
     C                     MOVE WTRSD     VALD                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     MOVELSCOVE     COVE                            CFF007
     C                     MOVELSHETR     HETR                            CFF007
     C                     MOVELSBLUP     BLUP                            CFF007
     C/COPY WNCPYSRC,FF0020C011
     C                     Z-ADDWNUCO     NUCO
     C                     Z-ADDWNUCO     NOCOTR
     C                     Z-ADDWCOPR     COPRTR
     C                     MOVE STNAR     TNAR
     C                     MOVE STBLO     TBLO
     C                     MOVE SLNKR     LNKR
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C           OBUU      ANDEQ'Y'                                       S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     ELSE                                           S01117
     C**                                                                  S01117
     C**   For MBIN = 'N' or OBUU = 'N', originating branch changes with  S01117
     C**   booking branch.                                                S01117
     C**                                                                  S01117
     C                     MOVE SBRCD     ORBR                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     MOVE SPRFC     PRFC                            S01117
     C           WW9997    IFEQ 'Y'                                       S01235
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVE *BLANKS   PTFR                            CPB001
     C                     ELSE                                           CPB001
     C                     MOVEL'9997'    PTFR                            S01235
     C                     ENDIF                                          CPB001
     C                     ELSE                                           S01235
     C                     MOVE SPTFR     PTFR                            S01235
     C                     END                                            S01235
     C/COPY WNCPYSRC,FF0020CP84
     C*CO*Y WN*PY*RC*FF0020C054
     C/COPY WNCPYSRC,FF0020CQ84
     C                     Z-ADD0         CLSR
     C                     MOVE 'N'       ECPI
     C                     MOVE KCCY      ISCY
     C                     MOVE 'N'       CBPI
     C                     Z-ADD0         FCDA
     C                     MOVE 'N'       FCIN
      *                                                                   S01411
      ** Move Run date into 'ORIGINAL ENTRY DATE'                         S01411
      *                                                                   S01411
     C                     Z-ADDPRUND     ORED                            S01411
     C**
     C                     Z-ADDCTDATE    LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNATN      TNLU
     C**   - Mkt Instr
     C           SMRKT     IFNE '  '
     C                     MOVE WBOCO     BOCOTR
     C                     Z-ADDWYRNO     YRNOTR
     C                     Z-ADDWMTHN     MTHNTR
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     Z-ADDWNUCO     NOBOTR
     C                     MOVE 'N'       FBIN
     C                     ELSE
     C                     Z-ADD0         NOBOTR
     C                     MOVE 'Y'       FBIN
     C                     END
     C**   - O.T.C.
     C                     ELSE
     C**********           MOVE *ZEROS    BOCOTR                                              CSD027
     C                     MOVE *BLANKS   BOCOTR                                              CSD027
     C                     Z-ADD0         YRNOTR
     C                     Z-ADD0         MTHNTR
     C                     Z-ADD0         NOBOTR
     C                     MOVE 'Y'       FBIN
     C*
     C/COPY WNCPYSRC,FF0020CCP3
     C*
     C*                                                                   CFF003
     C** Update pay/receiver indicator                                    CFF003
     C*                                                                   CFF003
     C           CFF003    IFEQ 'Y'                                       CFF003
     C                     MOVE 'N'       PYRC                            CFF003
     C                     ENDIF                                          CFF003
     C*                                                                   CFF003
     C                     END
     C*                                                                   S71062
     C** SETUP NEW FIELDS ON PF/TRANSD                                    S71062
     C                     MOVE 'N'       ACNI                            S71062
     C                     Z-ADD0         MABK                            S71062
     C                     Z-ADD0         MACU                            S71062
     C                     Z-ADD0         CUUN                            S71062
     C                     Z-ADD0         UNPL                            S71062
     C                     Z-ADD0         UPLS                            S71062
     C**                                                                  077485
     C                     Z-ADD0         CENT                            CFF007
     C                     MOVE *BLANKS   MHEX                            077485
     C*                                                                   CAC003
     C** Get values of BPRC and TPRC                                      CAC003
     C*                                                                   CAC003
     C                     MOVE SBPRC     BPRC                            CAC003
     C                     MOVE STPRC     TPRC                            CAC003
     C                     MOVE TSTAMP    TMST                                                209483
      *                                                                                       CSD015
      ** Perform compliance watch processing before writing new record                        CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y'                                                                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
      *                                                                                       CSD015
     C           SBSLT     IFEQ '04'                                                          CSD015
     C           SBSLT     OREQ '06'                                                          CSD015
     C           SBSLT     OREQ '15'                                                          CSD015
     C                     MOVELWBSLA     WLF,1                                               CSD015
     C                     MOVELWCSLA     WLF,4                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSBSLA     WLF,1                                               CSD015
     C                     MOVELSCSLA     WLF,4                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BSNAME    IFEQ 1                                                             CSD015
     C                     MOVELCNUMB     WLF,3                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSBCPN     WLF,3                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSNAME    IFEQ 1                                                             CSD015
     C                     MOVELCNUMC     WLF,6                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSCCPN     WLF,6                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELSBFAO     WLF,2                                               CSD015
     C                     MOVELSCFAO     WLF,5                                               CSD015
      *                                                                                       CSD015
     C                     Z-ADD6         WY      20                                          CSD015
     C                     Z-ADD1         WX      20                                          CSD015
     C                     MOVE 'N'       WCWFLG  1                                           CSD015
      *                                                                                       CSD015
     C           WX        DOUGTWY                                                            CSD015
     C           WCWFLG    OREQ 'Y'                                                           CSD015
     C           WLF,WX    IFNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ADD  1         WX                                                  CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** If watch list fields are not blanks, see also if 24x7 is not                         CSD015
      ** installed. If it is installed, it should be in the main system                       CSD015
      *                                                                                       CSD015
     C           WCWFLG    IFEQ 'Y'                                                           CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C**
     C**   Write new record
     C                     MOVE *IN73     WIN73                           CFF007
     C                     WRITETRANSDF                73
     C                     MOVE *IN73     WWIN73                          CFF007
     C                     MOVE WIN73     *IN73                           CFF007
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the trade details exactly as they are updated on TRANSD.    085490
     C** Also need to clear the before details for insert.                085490
     C                     MOVEL@TRANS    Z#ASTS                          085490
     C                     CLEARZ#BSTS                                    085490
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           SMRKT     ANDEQ'  '                                      CDE001
     C                     MOVELTNBR      T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C**********           PARM           T#TREF 20                                    CDE001 CGL029
     C                     PARM           T#TREF 26                                           CGL029
     C                     PARM 'OTCC'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************073714
     C**                                                                 *073714
     C**   WINTYP SR. -  Write record to  PF/INTYPD                      *073714
     C**   ~~~~~~~~~~                                                    *073714
     C**      Called From                  Calls                         *073714
     C**       SR. UINSRT                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           WINTYP    BEGSR                           ** WINTYP SR **073714
     C**                                                                  073714
     C                     MOVE 'D'       RECI                            073714
     C                     MOVE SISTT     ISTT                            073714
     C*                                                                   073714
     C** Instrument Type                                                  073714
     C                     MOVEL'Y'       ISTI                            073714
     C*                                                                   073714
     C** Instrument Name                                                  073714
     C                     MOVELSDCCY     ISTN01                          073714
     C           ISPT      IFEQ 5                                         073714
     C                     MOVEL'/'       ISTN02                          073714
     C                     MOVELSCTCY     ISTN03                          073714
     C                     END                                            073714
     C                     MOVELWFTDTA    ISTN04                          073714
     C**                                                                  073714
     C                     Z-ADDFFCTAM    CTAM                            073714
     C**                                                                  073714
     C**********           Z-ADD0         DBRK                                         073714 CSD027
     C                     MOVE *BLANKS   DBRK                                                CSD027
     C                     MOVE *BLANK    BCPT                            073714
     C                     Z-ADD0         BCMC                            073714
     C                     Z-ADD0         BCMS                            073714
     C                     Z-ADD0         BCGP                            073714
     C                     Z-ADD0         BCGS                            073714
     C                     MOVE *BLANK    CCPT                            073714
     C                     Z-ADD0         CCMC                            073714
     C                     Z-ADD0         CCMS                            073714
     C                     Z-ADD0         CCGP                            073714
     C                     Z-ADD0         CCGS                            073714
     C                     MOVE SCMRF     CMRF                            073714
     C                     MOVE *BLANK    STRC                            073714
     C                     MOVE *BLANK    PRRF                            073714
     C                     Z-ADD0         ULPD                            073714
     C                     MOVE *BLANK    FTRF                            073714
     C                     MOVE *BLANK    FTDF                            073714
     C                     MOVE *BLANK    SEDF                            073714
     C                     MOVE *BLANK    SPMF                            073714
     C                     Z-ADDFTDT      SPDT                            073714
     C                     Z-ADD0         TFPD                            073714
     C                     Z-ADD0         FSPM                            073714
     C                     MOVE *BLANK    ISMQ                            073714
     C                     MOVE SINNR     INNR                            CPM003
      *                                                                   CPL002
      ** If Midas-Plato Interface Installed, then set up fields           CPL002
      ** introduced by this module                                        CPL002
      *                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
      *                                                                   CPL002
      ** Underlying Instrument Type                                       CPL002
     C                     MOVELSMIIT     PLMIIT                          CPL002
      *                                                                   CPL002
      ** Underlying Term to Maturity                                      CPL002
     C                     MOVELSMITM     PLMITM                          CPL002
      *                                                                   CPL002
      ** Underlying Coupon Rate                                           CPL002
     C                     Z-ADDW#MICP    PLMICP                          CPL002
      *                                                                   CPL002
      ** Underlying Coupon Frequency                                      CPL002
     C                     MOVELSMICF     PLMICF                          CPL002
      *                                                                   CPL002
      ** Underlying Price Convention                                      CPL002
     C                     MOVELSMIPC     PLMIPC                          CPL002
      *                                                                   CPL002
      ** Options Volatility Type                                          CPL002
     C                     MOVELSMIVT     PLMIVT                          CPL002
      *                                                                   CPL002
      ** Options Pricing Method                                           CPL002
     C                     MOVELSMIPM     PLMIPM                          CPL002
      *                                                                   CPL002
      ** Pricing Group                                                    CPL002
     C                     MOVELSMIPG     PLMIPG                          CPL002
      *                                                                   CPL002
      ** Reporting Group                                                  CPL002
     C                     MOVELSMIRG     PLMIRG                          CPL002
      *                                                                   CPL002
      ** Credit Group                                                     CPL002
     C                     MOVELSMICR     PLMICR                          CPL002
     C                     ENDIF                                          CPL002
     C                     MOVE SUNSE     UNSE                            CFF007
     C                     MOVE STECO     TECO                            CFF007
     C                     MOVE STNAT     TNAT                            CFF007
     C                     MOVE SCRIK     CRIK                            CFF007
     C                     MOVE SCCYR     CCYR                            CFF007
     C                     MOVE STWEI     TWEI                            CFF007
     C/COPY WNCPYSRC,FF0020C057
     C**                                                                  073714
     C                     Z-ADDCTDATE    LCD                             073714
     C                     MOVE 'I'       CHTP                            073714
     C                     Z-ADDNATN      TNLU                            073714
     C**                                                                  073714
     C**   Write new record                                               073714
     C                     MOVE *IN73     WIN73   1                       CFF007
     C                     WRITEINTYPWRT               73                 073714
     C           *IN73     IFEQ '0'                                       073714
     C           1         CHAININTYPAF              73                   073714
     C           *IN73     IFEQ '0'                                       073714
     C                     ADD  1         NINS                            073714
     C                     ADD  1         NORE                            073714
     C                     UPDATINTYPAF                                   073714
     C                     END                                            073714
     C                     END                                            073714
     C   73                MOVEL' '       ISTI                            073714
     C                     MOVE *IN73     WWIN73  1                       CFF007
     C                     MOVE WIN73     *IN73                           CFF007
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP47                                           S01408
     C*                                                                   S01408
     C**                                                                  073714
     C                     ENDSR                                          073714
     C**                                                                  073714
     C********************************************************************CPL002
     C/EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   UINTYP SR. - Update record on  PF/INTYPD                      *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. UAMEND                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           UINTYP    BEGSR                           ** WINTYP SR **CPL002
      *                                                                   CPL002
      **   Access record                                                  CPL002
     C           K#LI1     KLIST                                          CPL002
     C                     KFLD           K#ISTI  1                       CPL002
     C                     KFLD           K#ISTT  5                       CPL002
     C                     MOVEL'Y'       K#ISTI                          CPL002
     C                     MOVELISTT      K#ISTT                          CPL002
     C                     MOVE *IN73     WIN73                           CFF007
     C           K#LI1     CHAININTYPWRT             73                   CPL002
     C           *IN73     IFEQ '0'                                       CPL002
      *                                                                   CPL002
      ** Underlying Instrument Type                                       CPL002
     C                     MOVELSMIIT     PLMIIT                          CPL002
     C*                                                                   CPL002
     C** If Instrument Type is Bond then update Maturity Date             CPL002
     C*                                                                   CPL002
     C           PLMIIT    IFEQ 'B'                                       CPL002
     C                     MOVE SMITD     ZDATE                           CPL002
     C                     EXSR ZDATE1                                    CPL002
     C                     Z-ADDZDAYNO    PLMIMD                          CPL002
     C                     MOVE *BLANKS   PLMITM                          CPL002
     C                     ELSE                                           CPL002
      *                                                                   CPL002
      ** Else update Underlying Term to Maturity                          CPL002
     C                     MOVELSMITM     PLMITM                          CPL002
     C                     Z-ADD*ZERO     PLMIMD                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Underlying Coupon Rate                                           CPL002
     C                     Z-ADDW#MICP    PLMICP                          CPL002
      *                                                                   CPL002
      ** Underlying Coupon Frequency                                      CPL002
     C                     MOVELSMICF     PLMICF                          CPL002
      *                                                                   CPL002
      ** Underlying Price Convention                                      CPL002
     C                     MOVELSMIPC     PLMIPC                          CPL002
      *                                                                   CPL002
      ** Options Volatility Type                                          CPL002
     C                     MOVELSMIVT     PLMIVT                          CPL002
      *                                                                   CPL002
      ** Options Pricing Method                                           CPL002
     C                     MOVELSMIPM     PLMIPM                          CPL002
      *                                                                   CPL002
      ** Pricing Group                                                    CPL002
     C                     MOVELSMIPG     PLMIPG                          CPL002
      *                                                                   CPL002
      ** Reporting Group                                                  CPL002
     C                     MOVELSMIRG     PLMIRG                          CPL002
      *                                                                   CPL002
      ** Credit Group                                                     CPL002
     C                     MOVELSMICR     PLMICR                          CPL002
      *                                                                   CPL002
      ** Transaction details.                                             CPL002
     C                     Z-ADDCTDATE    LCD                             CPL002
     C                     MOVE 'A'       CHTP                            CPL002
     C                     Z-ADDNATN      TNLU                            CPL002
      *                                                                   CPL002
      **   Update record                                                  CPL002
     C                     UPDATINTYPWRT               73                 CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      **   Update trailer                                                 CPL002
     C           *IN73     IFEQ '0'                                       CPL002
     C           1         CHAININTYPAF              73                   CPL002
     C           *IN73     IFEQ '0'                                       CPL002
     C                     ADD  1         NAMD                            CPL002
     C                     UPDATINTYPAF                                   CPL002
     C                     END                                            CPL002
     C                     END                                            CPL002
     C                     MOVE *IN73     WWIN73                          CFF007
     C                     MOVE WIN73     *IN73                           CFF007
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C**                                                                  CPL002
     C********************************************************************073714
     C/EJECT                                                              073714
     C********************************************************************
     C**                                                                 *
     C**   WTRSET SR. -  Write record to  LF/TRSET                       *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                   SR. FFPMCL                   *
     C**                                    SR. PBCPT                    *
     C**                                    SR. PCCPT                    *
     C**                                                                 *
     C********************************************************************
     C**
     C           WTRSET    BEGSR                           ** WTRSET SR **
     C**
     C                     MOVE 'D'       RECI
     C                     MOVE STNBR     TNBR
     C/COPY WNCPYSRC,FF0020C109
     C**
     C                     MOVE 'N'       CMCB                            CFF007
     C                     MOVE 'N'       CHCB                            CFF007
     C                     MOVE 'N'       CMCC                            CFF007
     C                     MOVE 'N'       CHCC                            CFF007
     C                     Z-ADD0         OCSB
     C                     Z-ADD0         OCDB
     C                     Z-ADD0         CCSB
     C                     Z-ADD0         CCDB
     C                     Z-ADD0         CPSB
     C                     Z-ADD0         CPDB
     C                     Z-ADD0         OCSC
     C                     Z-ADD0         OCDC
     C                     Z-ADD0         CCSC
     C                     Z-ADD0         CCDC
     C                     Z-ADD0         CPSC
     C                     Z-ADD0         CPDC
     C                     Z-ADD0         NCCP
     C**
     C**   Premiums Paid (- Options only)
     C           ISPT      IFEQ 1
     C           ISPT      OREQ 2
     C           ISPT      OREQ 3
     C           ISPT      OREQ 7                                         AUS022
     C                     Z-ADD0         PRMP
     C                     ELSE
     C**
     C                     Z-ADDWNUCO     FFNOC
     C***********          Z-ADDCOPRTR    FFPRIC                          E30422
     C*                                                                   E30422
     C**   Use the strike price in the Premium calculation.               E30422
      **   for processing type 8                                          054174
     C*                                                                   E30422
     C***********ISPT      IFEQ 8                                  054174 136056
     C***********          Z-ADDSTRPTR    FFPRIC                   E30422 136056
     C*                                                                   054174
      **   for other types of options use the contract price              054174
     C*                                                                   054174
     C***********          ELSE                                    054174 136056
     C                     Z-ADDCOPRTR    FFPRIC                          054174
     C***********          END                                     054174 136056
     C*                                                                   054174
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKVL      FFTKVL
     C                     Z-ADDSTRPTR    FFSTRP                          136056
     C                     EXSR FFPMCL
     C*                                                                   054174
      **   for processing type 8, multiply the amount calculated          054174
      **   by the contract price.                                         054174
     C*                                                                   054174
     C***********ISPT      IFEQ 8                                  054174 136056
     C***********          MULT COPRTR    FFPREM                   E30422 136056
     C***********          END                                     054174 136056
     C*                                                                   054174
     C                     Z-ADDFFPREM    PRMP
     C                     END
     C**
     C**   Broker  Settlement Instructions
     C**
     C           SBOCO     IFNE *BLANK
     C           SBOCO     ANDNE'*'
     C**
     C**   - Determine Commission Pattern
     C                     EXSR PBCPT
     C**
     C                     MOVE SBCMC     BCMC
     C                     MOVE SBCMS     BCMS
     C                     Z-ADDWBCMA     BCMA
     C                     MOVE SBCHC     BCHC
     C                     Z-ADDWBCHA     BCHA
     C                     Z-ADDWBMAR     BMAR
     C/COPY WNCPYSRC,FF0020C113
     C           WWTOFC    IFEQ 'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           BCMC      IFNE *ZEROS                                    CFF007
     C           BCMA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CMCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CMCB                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           BCHC      IFNE *ZEROS                                    CFF007
     C           BCHA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CHCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CHCB                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C**
     C                     MOVE SBSLT     BSLT
     C**
     C           SBSLT     IFEQ '04'
     C           SBSLT     OREQ '06'
     C           SBSLT     OREQ '15'
     C**   Store the determined Settlement A/c on file
     C                     MOVE WBSLA     BSLA
     C                     MOVE BBID      BSBR                            S01117
     C                     ELSE
     C**
     C                     MOVE SBSLA     BSLA
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     MOVE SBSBR     BSBR                            S01117
     C                     ELSE                                           S01117
     C           SBSLT     IFEQ '05'                                      S01117
     C                     MOVE BBID      BSBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    BSBR                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
     C**
     C                     MOVE SBFAO     BFAO
     C**
     C**   If broker shortname needed flag set on, write customer
     C**   number for shortname to file, else write screen field
     C**   to file
     C           BSNAME    IFEQ 1
     C                     MOVELCNUMB     BCPN
     C                     Z-ADD0         BSNAME
     C                     ELSE
     C                     MOVELSBCPN     BCPN
     C                     END
     C**
     C                     ELSE
     C                     MOVE ' '       BCPT
     C                     Z-ADD0         BCMC
     C                     Z-ADD0         BCMS
     C                     Z-ADD0         BCMA
     C                     Z-ADD0         BCHC
     C                     Z-ADD0         BCHA
     C                     Z-ADD0         BMAR
     C                     Z-ADD0         BSLT
     C                     MOVE *BLANK    BSLA
     C                     MOVE *BLANK    BFAO
     C                     MOVE *BLANK    BCPN
     C                     MOVE *BLANK    BSBR                            S01117
     C                     MOVE *BLANK    BBID                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP42                                           S01408
     C*                                                                   S01408
     C                     END
     C**
     C                     Z-ADD0         BCHP
     C                     Z-ADD0         BCMP
     C**
     C**   Customer  Settlement Instructions
     C**
     C           SCUSC     IFNE *BLANK
     C**
     C**   - Determine Commission Pattern
     C                     EXSR PCCPT
     C**
     C                     MOVE SCCMC     CCMC
     C                     MOVE SCCMS     CCMS
     C                     Z-ADDWCCMA     CCMA
     C                     MOVE SCCHC     CCHC
     C                     Z-ADDWCCHA     CCHA
     C                     Z-ADDWCMAR     CMAR
     C/COPY WNCPYSRC,FF0020C110
     C           WWTOFC    IFEQ 'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           CCMC      IFNE *ZEROS                                    CFF007
     C           CCMA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CMCC                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CMCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           CCHC      IFNE *ZEROS                                    CFF007
     C           CCHA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CHCC                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CHCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C**
     C                     MOVE SCSLT     CSLT
     C**
     C           SCSLT     IFEQ '04'
     C           SCSLT     OREQ '06'
     C           SCSLT     OREQ '15'
     C**   Store the determined Settlement A/c on file
     C                     MOVE WCSLA     CSLA
     C                     MOVE CBID      BRSC                            S01117
     C                     ELSE
     C**
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     MOVE SBRSC     BRSC                            S01117
     C                     ELSE                                           S01117
     C           SCSLT     IFEQ '05'                                      S01117
     C                     MOVE CBID      BRSC                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    BRSC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     MOVE SCSLA     CSLA
     C                     END
     C**
     C                     MOVE SCFAO     CFAO
     C**
     C**   If customer shortname needed flag set on, write customer
     C**   number for shortname to file, else write screen field
     C**   to file
     C           CSNAME    IFEQ 1
     C                     MOVELCNUMC     CCPN
     C                     Z-ADD0         CSNAME
     C                     ELSE
     C                     MOVELSCCPN     CCPN
     C                     END
     C**
     C                     ELSE
     C                     MOVE ' '       CCPT
     C                     Z-ADD0         CCMC
     C                     Z-ADD0         CCMS
     C                     Z-ADD0         CCMA
     C                     Z-ADD0         CCHC
     C                     Z-ADD0         CCHA
     C                     Z-ADD0         CMAR
     C                     Z-ADD0         CSLT
     C                     MOVE *BLANK    CSLA
     C                     MOVE *BLANK    CFAO
     C                     MOVE *BLANK    CCPN
     C                     MOVE *BLANK    BRSC                            S01117
     C                     MOVE *BLANK    CBID                            S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP43                                           S01408
     C*                                                                   S01408
     C                     END
     C**
     C                     Z-ADD0         CCHP
     C                     Z-ADD0         CCMP
     C**
     C**   Write new record
     C                     WRITETRSETDF
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP44                                           S01408
     C*                                                                   S01408
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the settlement details exactly as they are updated on       085490
     C** TRSETD. Also need to clear the before details for insert.        085490
     C                     MOVEL@TRSET    Z#XSTS                          085490
     C                     CLEARZ#WSTS                                    085490
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************073714
     C**                                                                 *073714
     C**   WCNFRP SR. -  Write record to  PF/CNFRPD                      *073714
     C**   ~~~~~~~~~~                                                    *073714
     C**      Called From                  Calls                         *073714
     C**       SR. UINSRT                                                *073714
     C**                                                                 *073714
     C********************************************************************073714
     C**                                                                  073714
     C           WCNFRP    BEGSR                           ** WCNFRP SR **073714
     C**                                                                  073714
     C                     MOVE 'D'       RECI                            073714
     C                     MOVE SBRCD     BRCA                            073714
     C                     MOVE WCUSC     CBCD                            073714
     C                     MOVE KCCY      ISCY                            073714
     C                     MOVE KISTT     ISTT                            073714
     C                     Z-ADD0         YRNO                            073714
     C                     Z-ADD0         MTHN                            073714
     C                     MOVE SPCAL     PCAL                            073714
     C                     Z-ADDWSTRP     STRP                            073714
     C                     MOVE WTRSD     POCD                            073714
     C                     MOVE '0'       PAYI                            073714
     C                     Z-ADD0         REVI                            073714
     C                     MOVE STNBR     TNBR                            073714
     C                     Z-ADDWNUCO     TOCN                            073714
     C                     Z-ADDCCMA      TOCM                            073714
     C                     Z-ADDCCHA      TOCG                            073714
     C                     Z-ADDPRMP      TOPR                            073714
     C                     MOVE CSLT      SETP                            073714
     C                     MOVE CSLA      SETA                            073714
     C                     MOVE CFAO      FACO                            073714
     C                     MOVE CCPN      CNOS                            073714
     C**                                                                  073714
     C**   Write new record                                               073714
     C                     WRITECNFRPDF                                   073714
     C**                                                                  073714
     C                     ENDSR                                          073714
     C**                                                                  073714
     C********************************************************************073714
     C/EJECT                                                              073714
     C********************************************************************
     C**                                                                 *
     C**   UTRANS SR. -  Update  LF/TRANS main                           *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UTRANS    BEGSR                           ** UTRANS SR **
     C**
     C**   Save  Old  No. of Open Contracts + Contract Price
     C                     Z-ADDNUCO      XNUCO   50
     C***********          Z-ADDCOPRTR    XCOPR  117                      CFF004
     C           *LIKE     DEFN COPR      XCOPR                           CFF004
     C/COPY WNCPYSRC,FF0020CR74
     C                     Z-ADDCOPRTR    XCOPR                           CFF004
     C/COPY WNCPYSRC,FF0020CR75
     C**
     C                     Z-ADDCTDATE    LCD
     C                     Z-ADDNATN      TNLU
     C**   Amend
     C           SACTN     IFEQ 'A'
     C**
     C           *IN65     IFEQ '1'
     C           *IN66     ANDEQ'1'
     C                     MOVE WTRSD     TRSD
     C/COPY WNCPYSRC,FF0020C012
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C                     MOVE WVALD     VALD                            073714
     C                     ELSE                                           CFF007
     C                     MOVE WTRSD     VALD                            CFF007
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C013
     C                     Z-ADDWNUCO     NUCO
     C                     Z-ADDWNUCO     NOCOTR
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C                     Z-ADDWNUCO     NOBOTR
     C                     ELSE
     C                     Z-ADD0         NOBOTR
     C                     END
     C                     Z-ADDWCOPR     COPRTR
     C                     END
     C**
     C                     MOVE STNAR     TNAR
     C                     MOVE STBLO     TBLO
     C                     MOVE SLNKR     LNKR
     C                     MOVE SCOVE     COVE                            CFF007
     C                     MOVE SHETR     HETR                            CFF007
     C                     MOVE SBLUP     BLUP                            CFF007
     C*                                                                   CPL002
     C** Update Spot price if Plato Present.                              CPL002
     C*                                                                   CPL002
     C                     Z-ADDWSPTP     SPTPTR                          CPL002
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C           OBUU      ANDEQ'Y'                                       S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     ELSE                                           S01117
     C**                                                                  S01117
     C**   For MBIN = 'N' or OBUU = 'N', originating branch changes with  S01117
     C**   booking branch.                                                S01117
     C**                                                                  S01117
     C                     MOVE SBRCD     ORBR                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     MOVE SPRFC     PRFC                            S01117
     C           WW9997    IFEQ 'Y'                                       S01235
     C           BGN4ST    IFEQ 'Y'                                       CPB001
     C                     MOVEL'9997'    PTFR                            S01235
     C                     ELSE                                           CPB001
     C                     MOVE *BLANKS   PTFR                            CPB001
     C                     ENDIF                                          CPB001
     C                     ELSE                                           S01235
     C                     MOVE SPTFR     PTFR                            S01235
     C                     END                                            S01235
     C/COPY WNCPYSRC,FF0020CP85
     C*CO*Y WN*PY*RC*FF0020C055
     C/COPY WNCPYSRC,FF0020CQ85
     C**
     C           XLCD      IFNE CTDATE
     C                     MOVE 'A'       CHTP
     C                     END
      *                                                                                       CSD015
      ** Perform compliance watch processing before updating record                           CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y'                                                                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** Set up KLIST fields for accessing compliance watch hit list                          CSD015
      ** to check for hit status                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'TRANSD  'KFUNT                                               CSD015
     C                     MOVELTNBR      KIDEN                                               CSD015
     C                     MOVELBRCA      KBRCH                                               CSD015
      *                                                                                       CSD015
      ** Check status of item in compliance watch hit list                                    CSD015
      *                                                                                       CSD015
     C           KCWHTL    CHAINSDCWHTL1             71                                       CSD015
     C           *IN71     IFEQ '1'                                                           CSD015
     C                     MOVE *BLANKS   W3UNCF                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEA*BLANKS   WLF,1                                               CSD015
     C                     MOVE 'N'       WCWFLG  1                                           CSD015
      *                                                                                       CSD015
      ** For UNCONFIRMED statuses, send all watch list fields that are                        CSD015
      ** not blank.                                                                           CSD015
      *                                                                                       CSD015
     C           W3UNCF    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           SBSLT     IFEQ '04'                                                          CSD015
     C           SBSLT     OREQ '06'                                                          CSD015
     C           SBSLT     OREQ '15'                                                          CSD015
     C                     MOVELWBSLA     WLF,1                                               CSD015
     C                     MOVELWCSLA     WLF,4                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSBSLA     WLF,1                                               CSD015
     C                     MOVELSCSLA     WLF,4                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           BSNAME    IFEQ 1                                                             CSD015
     C                     MOVELCNUMB     WLF,3                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSBCPN     WLF,3                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           CSNAME    IFEQ 1                                                             CSD015
     C                     MOVELCNUMC     WLF,6                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELSCCPN     WLF,6                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELSBFAO     WLF,2                                               CSD015
     C                     MOVELSCFAO     WLF,5                                               CSD015
      *                                                                                       CSD015
     C                     Z-ADD6         WY                                                  CSD015
     C                     Z-ADD1         WX                                                  CSD015
      *                                                                                       CSD015
     C           WX        DOUGTWY                                                            CSD015
     C           WCWFLG    OREQ 'Y'                                                           CSD015
     C           WLF,WX    IFNE *BLANKS                                                       CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ADD  1         WX                                                  CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
      ** Otherwise, send only watch list fields that have changed and                         CSD015
      ** are not blank                                                                        CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           SBSLT     IFEQ '04'                                                          CSD015
     C           SBSLT     OREQ '06'                                                          CSD015
     C           SBSLT     OREQ '15'                                                          CSD015
     C           WBSLA     IFNE BSLA                                                          CSD015
     C           WBSLA     ANDNE*BLANKS                                                       CSD015
     C                     MOVELWBSLA     WLF,1                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C           WCSLA     IFNE CSLA                                                          CSD015
     C           WCSLA     ANDNE*BLANKS                                                       CSD015
     C                     MOVELWCSLA     WLF,4                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ELSE                                                               CSD015
     C           SBSLA     IFNE BSLA                                                          CSD015
     C           SBSLA     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSBSLA     WLF,1                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C           SCSLA     IFNE CSLA                                                          CSD015
     C           SCSLA     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSCSLA     WLF,4                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELCNUMB     WCNUMB  6                                           CSD015
     C           BSNAME    IFEQ 1                                                             CSD015
     C           WCNUMB    ANDNEBCPN                                                          CSD015
     C           WCNUMB    ANDNE*BLANKS                                                       CSD015
     C                     MOVELCNUMB     WLF,3                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ELSE                                                               CSD015
     C           SBCPN     IFNE BCPN                                                          CSD015
     C           SBCPN     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSBCPN     WLF,3                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVELCNUMC     WCNUMC  6                                           CSD015
     C           CSNAME    IFEQ 1                                                             CSD015
     C           WCNUMC    ANDNECCPN                                                          CSD015
     C           WCNUMC    ANDNE*BLANKS                                                       CSD015
     C                     MOVELCNUMC     WLF,6                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ELSE                                                               CSD015
     C           SCCPN     IFNE CCPN                                                          CSD015
     C           SCCPN     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSCCPN     WLF,6                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     END                                                                CSD015
      *                                                                                       CSD015
     C           SBFAO     IFNE BFAO                                                          CSD015
     C           SBFAO     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSBFAO     WLF,2                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           SCFAO     IFNE CFAO                                                          CSD015
     C           SCFAO     ANDNE*BLANKS                                                       CSD015
     C                     MOVELSCFAO     WLF,5                                               CSD015
     C                     MOVE 'Y'       WCWFLG                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** If conditions above are met, check if 24x7 is not installed.                         CSD015
      ** If it is installed, system should be in the main system                              CSD015
      *                                                                                       CSD015
     C           WCWFLG    IFEQ 'Y'                                                           CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           CSC011    OREQ 'Y'                                                           CSD015
     C           S1MAIN    ANDEQLIBR                                                          CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C**
     C                     EXCPTATRANS
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the trade details exactly as they are updated on TRANSD     085490
     C                     MOVEL@TRANS    Z#ASTS                          085490
     C**   Delete
     C                     ELSE
     C**
     C                     MOVE '*'       RECI
     C***********          Z-ADD0         LNKR                            097069
     C                     MOVE 'D'       CHTP
     C**
     C                     EXCPTDTRANS
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the trade details exactly as they are updated on TRANSD     085490
     C                     MOVEL@TRANS    Z#ASTS                          085490
     C**
     C                     END
      *                                                                   CDE001
      * Data export for CCRM - Limits                                     CDE001
      *                                                                   CDE001
     C           CDE001    IFEQ 'Y'                                       CDE001
     C           SMRKT     ANDEQ'  '                                      CDE001
     C                     MOVELTNBR      T#TREF                          CDE001
     C                     CALL 'DEWTTRIG'                                CDE001
     C**********           PARM           T#TREF 20                                    CDE001 CGL029
     C                     PARM           T#TREF 26                                           CGL029
     C                     PARM 'OTCC'    T#TCAT  4                       CDE001
     C                     PARM *BLANKS   T#RSRV 10                       CDE005
     C                     ENDIF                                          CDE001
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UTRSET SR. -  Update  LF/TRSET main                           *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UAMEND                   SR. INFSR                    *
     C**       SR. UDELET                   SR. FFPMCL                   *
     C**                                    SR. PBCPT                    *
     C**                                    SR. PCCPT                    *
     C**                                                                 *
     C********************************************************************
     C**
     C           UTRSET    BEGSR                           ** UTRSET SR **
     C**                                                                  S01117
     C**   Save  BBID & CBID to avoid being overwritten by TRSET          S01117
     C                     MOVE BBID      SBBID   3                       S01117
     C                     MOVE CBID      SCBID   3                       S01117
     C**
     C**   Access LF/TRSET main
     C           KTNBR     CHAINTRSET                71
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the settlement details before they are changed.             085490
     C                     MOVEL@TRSET    Z#WSTS                          085490
     C**
     C**   - not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '14'      DBASE            ** DBERR  14 **S01117
     C                     Z-ADD14        DBASE            ** DBERR  14 **S01117
     C                     MOVE 'TRSET'   DBFILE
     C                     MOVELKTNBR     DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   Save  Old - Premium Paid
     C**             - Broker/Customer Margins
     C**             - Broker/Customer Settlement Type + A/c
     C**             - Broker/Customer Settlement Branch                  S01117
     C                     Z-ADDPRMP      XPRMP  130
     C                     Z-ADDBMAR      XBMAR  130
     C                     Z-ADDCMAR      XCMAR  130
     C                     MOVE BSLT      XBSLT   20
     C                     MOVE CSLT      XCSLT   20
     C**********           MOVE BSLA      XBSLA  12                                           CGL029
     C**********           MOVE CSLA      XCSLA  12                                           CGL029
     C                     MOVE BSLA      XBSLA  18                                           CGL029
     C                     MOVE CSLA      XCSLA  18                                           CGL029
     C                     MOVE BSBR      XBSBR   3                       S01117
     C                     MOVE BRSC      XBRSC   3                       S01117
     C**
     C**   Delete
     C           SACTN     IFEQ 'D'
     C                     MOVE '*'       RECI
     C**
     C                     EXCPTDTRSET
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the settlement details exactly as they are updated on       085490
     C** TRSETD.                                                          085490
     C                     MOVEL@TRSET    Z#XSTS                          085490
     C**
     C                     ELSE
     C**   Amend
     C**
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP45                                           S01408
     C*                                                                   S01408
     C**   - Margins (always amendable)
     C                     Z-ADDWBMAR     BMAR
     C                     Z-ADDWCMAR     CMAR
     C**
     C**   - EOC processed ind = 'N'
     C**
     C           *IN65     IFEQ '1'
     C**
     C**   - No. contracts = No. open contracts
     C           *IN66     IFEQ '1'
     C**
     C**     - Premiums Paid (- Options only)
     C           ISPT      IFEQ 1
     C           ISPT      OREQ 2
     C           ISPT      OREQ 3
     C           ISPT      OREQ 7                                         AUS022
     C                     Z-ADD0         PRMP
     C                     ELSE
     C**
     C                     Z-ADDWNUCO     FFNOC
     C***********          Z-ADDCOPRTR    FFPRIC                          E30422
     C*                                                                   E30422
     C**   Use the strike price in the Premium calculation.               E30422
      **   for processing type 8                                          054174
     C*                                                                   E30422
     C***********ISPT      IFEQ 8                                  054174 136056
     C***********          Z-ADDSTRPTR    FFPRIC                   E30422 136056
     C*                                                                   054174
      **   for other types of options use the contract price              054174
     C*                                                                   054174
     C***********          ELSE                                    054174 136056
     C                     Z-ADDCOPRTR    FFPRIC                          054174
     C***********          END                                     054174 136056
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     Z-ADDTKVL      FFTKVL
     C                     Z-ADDSTRPTR    FFSTRP                          136056
     C                     EXSR FFPMCL
     C*                                                                   054174
      **   for processing type 8, multiply the amount calculated          054174
      **   by the contract price.                                         054174
     C*                                                                   054174
     C***********ISPT      IFEQ 8                                  054174 136056
     C***********          MULT COPRTR    FFPREM                   E30422 136056
     C***********          END                                     054174 136056
     C*                                                                   054174
     C                     Z-ADDFFPREM    PRMP
     C                     END
     C**
     C                     END
     C**
     C**     - Broker  Settlement Instructions
     C**
     C           SBOCO     IFNE *BLANK
     C**
     C**       - Determine Commission Pattern
     C                     EXSR PBCPT
     C**
     C                     MOVE SBCMC     BCMC
     C                     MOVE SBCMS     BCMS
     C                     Z-ADDWBCMA     BCMA
     C                     MOVE SBCHC     BCHC
     C                     Z-ADDWBCHA     BCHA
     C                     MOVE SBSLT     BSLT
     C                     MOVE SBBID     BBID                            S01117
     C/COPY WNCPYSRC,FF0020C111
      *                                                                   CFF007
     C           WWTOFC    IFEQ 'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           BCMC      IFNE *ZEROS                                    CFF007
     C           BCMA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CMCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CMCB                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           BCHC      IFNE *ZEROS                                    CFF007
     C           BCHA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CHCB                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CHCB                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C**
     C           SBSLT     IFEQ '04'
     C           SBSLT     OREQ '06'
     C           SBSLT     OREQ '15'
     C**   Store the determined Settlement A/c on file
     C                     MOVE WBSLA     BSLA
     C                     MOVE BBID      BSBR                            S01117
     C                     ELSE
     C**
     C                     MOVE SBSLA     BSLA
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     MOVE SBSBR     BSBR                            S01117
     C                     ELSE                                           S01117
     C           SBSLT     IFEQ '05'                                      S01117
     C                     MOVE BBID      BSBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    BSBR                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
     C**
     C                     MOVE SBFAO     BFAO
     C**
     C**   If broker shortname needed flag set on, write customer
     C**   number for shortname to file, else write screen field
     C**   to file
     C           BSNAME    IFEQ 1
     C                     MOVELCNUMB     BCPN
     C                     Z-ADD0         BSNAME
     C                     ELSE
     C                     MOVELSBCPN     BCPN
     C                     END
     C**
     C                     END
     C**
     C**     - Customer  Settlement Instructions
     C**
     C           SCUSC     IFNE *BLANK
     C**       - Determine Commission Pattern
     C                     EXSR PCCPT
     C**
     C                     MOVE SCCMC     CCMC
     C                     MOVE SCCMS     CCMS
     C                     Z-ADDWCCMA     CCMA
     C                     MOVE SCCHC     CCHC
     C                     Z-ADDWCCHA     CCHA
     C**
     C                     MOVE SCSLT     CSLT
     C                     MOVE SCBID     CBID                            S01117
     C/COPY WNCPYSRC,FF0020C112
     C           WWTOFC    IFEQ 'Y'                                       CFF007
     C           CFF007    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C           CCMC      IFNE *ZEROS                                    CFF007
     C           CCMA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CMCC                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CMCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           CCHC      IFNE *ZEROS                                    CFF007
     C           CCHA      ANDNE*ZEROS                                    CFF007
     C                     MOVE 'Y'       CHCC                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CHCC                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C**
     C           SCSLT     IFEQ '04'
     C           SCSLT     OREQ '06'
     C           SCSLT     OREQ '15'
     C**   Store the determined Settlement A/c on file
     C                     MOVE WCSLA     CSLA
     C                     MOVE CBID      BRSC                            S01117
     C                     ELSE
     C**
     C                     MOVE SCSLA     CSLA
     C**                                                                  S01117
     C           PMBIN     IFEQ 'Y'                                       S01117
     C                     MOVE SBRSC     BRSC                            S01117
     C                     ELSE                                           S01117
     C           SCSLT     IFEQ '05'                                      S01117
     C                     MOVE CBID      BRSC                            S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANK    BRSC                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END
     C**
     C                     MOVE SCFAO     CFAO
     C**
     C**   If customer shortname needed flag set on, write customer
     C**   number for shortname to file, else write screen field
     C**   to file
     C           CSNAME    IFEQ 1
     C                     MOVELCNUMC     CCPN
     C                     Z-ADD0         CSNAME
     C                     ELSE
     C                     MOVELSCCPN     CCPN
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**   Update record
     C                     UPDATTRSETDF
     C** Update parameter for new enquiry update program AOOUOTU0         085490
     C** with the settlement details exactly as they are updated on       085490
     C** TRSETD.                                                          085490
     C                     MOVEL@TRSET    Z#XSTS                          085490
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0020CP46                                           S01408
     C*                                                                   S01408
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   PBCPT SR. - Determine  Broker Commission Pattern              *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. WTRSET                                                *
     C**       SR. UTRSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           PBCPT     BEGSR                           *** PBCPT SR **
     C**
     C**   If a CommsN Amount entered, or = 'A'
     C           SBCMA1    IFEQ 'A'
     C           WBCMA     ORNE 0
     C                     MOVE 'A'       BCPT
     C**
     C                     ELSE
     C**   CommsN Amount blank
     C**   - If CommsN Codes not entered
     C           SBCMC     IFEQ *BLANK
     C           SBCMS     ANDEQ*BLANK
     C                     MOVE ' '       BCPT
     C**
     C                     ELSE
     C**   - CommsN Codes entered
     C**     - access default value (for Amend)
     C           SACTN     IFEQ 'A'
     C                     MOVELSBOCO     KCBCD
     C**
     C           KDEFLT    CHAINDEFLT                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '0'
     C           CPAT      ANDNE' '
     C**     - from LF/DEFLT
     C                     MOVE CPAT      XBCPT
     C                     ELSE
     C**     - from LF/INTYP
     C                     MOVE BCPTI     XBCPT
     C                     END
     C**
     C                     END
     C**
     C**     - use default value if it exists, otherwise 'A'
     C           XBCPT     IFNE *BLANK
     C                     MOVE XBCPT     BCPT
     C                     ELSE
     C                     MOVE 'A'       BCPT
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   PCCPT SR. - Determine  Customer Commission Pattern            *
     C**   ~~~~~~~~~                                                     *
     C**      Called From                  Calls                         *
     C**       SR. WTRSET                                                *
     C**       SR. UTRSET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           PCCPT     BEGSR                           *** PCCPT SR **
     C**
     C**   If a CommsN Amount entered, or = 'A'
     C           SCCMA1    IFEQ 'A'
     C           WCCMA     ORNE 0
     C                     MOVE 'A'       CCPT
     C**
     C                     ELSE
     C**   CommsN Amount blank
     C**   - If CommsN Codes not entered
     C           SCCMC     IFEQ *BLANK
     C           SCCMS     ANDEQ*BLANK
     C                     MOVE ' '       CCPT
     C**
     C                     ELSE
     C**   - CommsN Codes entered
     C**     - access default value (for Amend)
     C           SACTN     IFEQ 'A'
     C                     MOVELSCUSC     KCBCD
     C**
     C           KDEFLT    CHAINDEFLT                71
     C  N71      RECI      COMP 'D'                  7171
     C**
     C           *IN71     IFEQ '0'
     C           CPAT      ANDNE' '
     C**     - from LF/DEFLT
     C                     MOVE CPAT      XCCPT
     C                     ELSE
     C**     - from LF/INTYP
     C                     MOVE CCPTI     XCCPT
     C                     END
     C**
     C                     END
     C**
     C**     - use default value if it exists, otherwise 'A'
     C           XCCPT     IFNE *BLANK
     C                     MOVE XCCPT     CCPT
     C                     ELSE
     C                     MOVE 'A'       CCPT
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                        *097069
     C*****UTRNLK SR. -  Update  LF/TRANS for  NEW Linked Reference      *097069
     C*****~~~~~~~~~~                                                    *097069
     C********Called From                  Calls                         *097069
     C*********SR. UINSRT                                                *097069
     C*********SR. UAMEND                                                *097069
     C***********                                                        *097069
     C********************************************************************097069
     C***********                                                         097069
     C***********UTRNLK    BEGSR                           ** UTRNLK SR **097069
     C***********                                                         097069
     C*****Access LF/TRANSLK (new link)                                   097069
     C***********                                                         097069
     C***********          MOVE SLNKR     KLNKR                           097069
     C***********KLNKR     CHAINTRANSLK              71                   097069
     C***********                                                         097069
     C*****-*not*found                                                    097069
     C************IN71     IFEQ '1'                                       097069
     C************LOCK     IN   LDA                                       097069
     C***********          MOVE '15'      DBASE      ** DBE** DBERR*S151**S01117
     C***********          Z-ADD15        DBASE      ** DBE** DBERR*S151**S01117
     C***********          MOVE 'TRANS'   DBFILE                          097069
     C***********          MOVELKLNKR     DBKEY                           097069
     C***********          EXSR DBERR                                     097069
     C***********          END                                            097069
     C***********                                                         097069
     C***********RECI      IFEQ '*'                                       097069
     C***********LNKR      ORNE 0                                         097069
     C***********                                                         097069
     C*****Related Rec Upd by another wrkstn                              097069
     C***********          ROLBK                                          097069
     C***********          MOVEAMSG,7     SERCD1                          097069
     C***********          MOVEAMSG,9     SERCD2                          097069
     C***********          SETON                     11                   097069
     C***********                                                         097069
     C***********          ELSE                                           097069
     C***********          MOVE STNBR     LNKR                            097069
     C***********          Z-ADDNATN      TNLU                            097069
     C***********                                                         097069
     C***********          EXCPTTRLINK                                    097069
     C***********                                                         097069
     C***********          END                                            097069
     C***********                                                         097069
     C***********          ENDSR                                          097069
     C***********                                                         097069
     C********************************************************************097069
     C*EJECT*****                                                         097069
     C********************************************************************
     C***********                                                        *097069
     C*****UTROLK SR. -  Update  LF/TRANS for  OLD Linked Reference      *097069
     C*****~~~~~~~~~~                                                    *097069
     C********Called From                  Calls                         *097069
     C*********SR. UAMEND                                                *097069
     C*********SR. UDELET                                                *097069
     C***********                                                        *097069
     C********************************************************************097069
     C***********                                                         097069
     C***********UTROLK    BEGSR                           ** UTROLK SR **097069
     C***********                                                         097069
     C*****Access LF/TRANSLK (old link)                                   097069
     C***********                                                         097069
     C***********          MOVE XLNKR     KLNKR                           097069
     C***********KLNKR     CHAINTRANSLK              71                   097069
     C***********                                                         097069
     C*****-*not*found                                                    097069
     C************IN71     IFEQ '1'                                       097069
     C************LOCK     IN   LDA                                       097069
     C***********          MOVE '16'      DBASE      ** DBE** DBERR*S161**S01117
     C***********          Z-ADD16        DBASE      ** DBERR  16 **S01117097069
     C***********          MOVE 'TRANS'   DBFILE                          097069
     C***********          MOVELKLNKR     DBKEY                           097069
     C***********          EXSR DBERR                                     097069
     C***********          END                                            097069
     C***********                                                         097069
     C***********          Z-ADD0         LNKR                            097069
     C***********          Z-ADDNATN      TNLU                            097069
     C***********                                                         097069
     C***********          EXCPTTRLINK                                    097069
     C***********                                                         097069
     C***********          ENDSR                                          097069
     C***********                                                         097069
     C********************************************************************097069
     C*EJECT*****                                                         097069
     C********************************************************************
     C**                                                                 *
     C**   UCLOST SR. -  Update  LF/CLOST                                *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UCLOST    BEGSR                           ** UCLOST SR **
     C**
     C**   Identify Close-Outs which reference this transaction
     C**    by reading LF/CLOST2
     C                     MOVE STNBR     KTNBR
     C                     Z-ADD0         KCLON
     C**
     C           KCLST2    SETLLCLOSTTF
     C                     READ CLOSTTF                  71
     C**
     C           TNBR      DOWEQKTNBR
     C           *IN71     ANDEQ'0'
     C**
     C**   Access LF/CLOST
     C           CLON      CHAINCLOST                71
     C**
     C**   - not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '17'      DBASE            ** DBERR  17 **S01117
     C                     Z-ADD17        DBASE            ** DBERR  17 **S01117
     C                     MOVE 'CLOST'   DBFILE
     C                     MOVELCLON      DBKEY
     C                     EXSR DBERR
     C                     END
     C** Validate Close Out is for same instrument as Trade                                   180497
     C           ISTT      IFEQ ISTTCL                                                        180497
     C           MTHN      ANDEQMTHNCL                                                        180497
     C           YRNO      ANDEQYRNOCL                                                        180497
     C**
     C**   If not already flagged for reversal
     C           CORI      IFNE 'Y'
     C                     MOVE 'Y'       CORI
     C                     MOVE 'N'       SHPI
     C                     Z-ADDCTDATE    LCD
     C                     MOVE 'A'       CHTP
     C                     Z-ADDNATN      TNLU
     C**   - Close Out Reversal
     C                     EXCPTCLOSTR
     C                     SETON                     U1
     C                     END
     C**                                                                                      180497
     C                     END                                                                180497
     C**
     C                     READ CLOSTTF                  71
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   URMEMS SR. -  Update  LF/MEMOSM :                             *
     C**   ~~~~~~~~~~              Reverse Retail A/c Shadow Balance     *
     C**      Called From                  Calls                         *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           URMEMS    BEGSR                           ** URMEMS SR **
     C**
     C**   Access  LF/MEMOSM
     C           KMEMOS    CHAINMEMOSM               71                   S01117
     C***********FFACTK    CHAINMEMOSM               71                   S01117
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         LDBL
     C                     Z-ADD0         CLBL
     C                     END
     C**                                                                  S01240
     C**   Store Ledger Balance in a work field for use in SR. WACMVD     S01240
     C                     Z-ADDLDBL      WLDBL  150                      S01240
     C**
     C**   'Reverse' updates due to the new trade
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LDBL      ADD  XPRMP     LDBL
     C/COPY WNCPYSRC,FF0020C014
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CLBL      ADD  XPRMP     CLBL
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C015
     C**    - Sale
     C                     ELSE
     C           LDBL      SUB  XPRMP     LDBL
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C/COPY WNCPYSRC,FF0020C016
     C           CLBL      SUB  XPRMP     CLBL
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C017
     C                     END
     C**
     C**   Update  LF/MEMOSM
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C                     MOVE MMBRCA    BRCA                            S01117
     C                     MOVE MMCNUM    CNUM                            S01117
     C                     MOVE MMCURR    CCY                             S01117
     C                     MOVE MMACOD    ACOD                            S01117
     C                     MOVE MMACSQ    ACSQ                            S01117
     C***********          MOVE FFCNUM    CNUM                            S01117
     C***********          MOVE FFCCY     CCY                             S01117
     C***********          MOVE FFACOD    ACOD                            S01117
     C***********          MOVE FFACSQ    ACSQ                            S01117
     C                     WRITEMEMOSMEF
     C**
     C                     ELSE
     C                     UPDATMEMOSMEF
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UAMEMS SR. -  Update  LF/MEMOSM :                             *
     C**   ~~~~~~~~~~              Apply Retail A/c Shadow Balance       *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UAMEMS    BEGSR                           ** UAMEMS SR **
     C**
     C**   Access  LF/MEMOSM
     C           KMEMOS    CHAINMEMOSM               71                   S01117
     C***********FFACTK    CHAINMEMOSM               71                   S01117
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         LDBL
     C                     Z-ADD0         CLBL
     C                     END
     C**                                                                  S01240
     C**   Store Ledger Balance in a work field for use in SR. WACMVD     S01240
     C                     Z-ADDLDBL      WLDBL                           S01240
     C**
     C**   'Apply' updates due to the new trade
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LDBL      SUB  PRMP      LDBL
     C/COPY WNCPYSRC,FF0020C018
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CLBL      SUB  PRMP      CLBL
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C019
     C**    - Sale
     C                     ELSE
     C           LDBL      ADD  PRMP      LDBL
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C           VALD      ANDLEPRUND                                     CFF007
     C/COPY WNCPYSRC,FF0020C020
     C           CLBL      ADD  PRMP      CLBL
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C021
     C                     END
     C**
     C**   Update  LF/MEMOSM
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C                     MOVE MMBRCA    BRCA                            S01117
     C                     MOVE MMCNUM    CNUM                            S01117
     C                     MOVE MMCURR    CCY                             S01117
     C                     MOVE MMACOD    ACOD                            S01117
     C                     MOVE MMACSQ    ACSQ                            S01117
     C***********          MOVE FFCNUM    CNUM                            S01117
     C***********          MOVE FFCCY     CCY                             S01117
     C***********          MOVE FFACOD    ACOD                            S01117
     C***********          MOVE FFACSQ    ACSQ                            S01117
     C                     WRITEMEMOSMEF
     C**
     C                     ELSE
     C                     UPDATMEMOSMEF
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   URPRON SR. -  Update  LF/PRONOM :                             *
     C**   ~~~~~~~~~~              Reverse Projected Nostro Balance      *
     C**      Called From                  Calls                         *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           URPRON    BEGSR                           ** URPRON SR **
     C/COPY WNCPYSRC,FF0020C022
     C**
     C           CFF007    IFEQ 'N'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C**   Access  LF/PRONOM
     C           KPRONO    CHAINPRONOM               71
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         PNBL
     C                     END
     C**                                                                  S01240
     C**   Store Projected Nostro Balance in a work field for use         S01240
     C**   in SR. WACMVD                                                  S01240
     C                     Z-ADDPNBL      WPNBL  150                      S01240
     C**
     C**   'Reverse' updates due to the new trade
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           PNBL      ADD  XPRMP     PNBL
     C**    - Sale
     C                     ELSE
     C           PNBL      SUB  XPRMP     PNBL
     C                     END
     C**
     C**   Update  LF/PRONOM
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C                     MOVE FFNCCY    CCY
     C                     MOVE FFNOSN    NOSN
     C                     WRITEPRONOMEF
     C**
     C                     ELSE
     C                     UPDATPRONOMEF
     C                     END
     C/COPY WNCPYSRC,FF0020C023
     C                     ELSE                                           CFF007
      * Access  LF/PRONO                                                  CFF007
     C           KPRONO    CHAINPRONO                71                   CFF007
      *                                                                   CFF007
     C           *IN71     IFEQ '1'                                       CFF007
     C           *IN71     OREQ '0'                                       CFF007
     C           RECI      ANDNE'D'                                       CFF007
     C                     MOVE '37'      DBASE            ************   CFF007
     C                     MOVE 'PRONOPN' DBFILE           * DBERR 37 *   CFF007
     C                     MOVELFFNCCY    WPRON1  5        ************   CFF007
     C                     MOVE FFNOSN    WPRON1                          CFF007
     C                     MOVELWPRON1    DBKEY                           CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Calculate next working day after the fifth date in               CFF007
      ** the array in PRONOPN/PF, and store as the sixth date             CFF007
      ** Also store balances, to detect if a change is made               CFF007
      *                                                                   CFF007
     C                     Z-ADD@BL       @OLDBL                          CFF007
      *                                                                   CFF007
      ** Check if day number is a holiday                                 CFF007
      *                                                                   CFF007
     C                     Z-ADD@DT,5     ZDAYNO                          CFF007
     C                     MOVE FFNCCY    ZCCY                            CFF007
     C                     MOVE *BLANKS   ZLOC                            CFF007
     C                     EXSR ZCHKH                                     CFF007
     C                     Z-ADDZDAYNO    @DT,6                           CFF007
      *                                                                   CFF007
      ** Update each of the five balances in turn                         CFF007
      ** according to whether the test date is before                     CFF007
      ** the cut-off date for each balance                                CFF007
      *                                                                   CFF007
     C           1         DO   5         @N      20                      CFF007
      *                                                                   CFF007
     C           @N        ADD  1         @N2     20                      CFF007
     C           VALD      IFLT @DT,@N2                                   CFF007
     C           TRTYTR    IFEQ 'P'                                       CFF007
     C                     ADD  XPRMP     @BL,@N                          CFF007
     C                     ELSE                                           CFF007
     C                     SUB  XPRMP     @BL,@N                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** Write the results back to Nostro Balance File                    CFF007
      *                                                                   CFF007
     C           @@PNB2    IFNE PNB                                       CFF007
     C                     EXCPT#PROUP                                    CFF007
     C                     ELSE                                           CFF007
     C                     EXCPT#PRREL                                    CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UAPRON SR. -  Update  LF/PRONOM :                             *
     C**   ~~~~~~~~~~              Apply Projected Nostro Balance        *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UAPRON    BEGSR                           ** UAPRON SR **
     C/COPY WNCPYSRC,FF0020C024
     C**
     C           CFF007    IFEQ 'N'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C**   Access  LF/PRONOM
     C           KPRONO    CHAINPRONOM               71
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         PNBL
     C                     END
     C**                                                                  S01240
     C**   Store Projected Nostro Balance in a work field for use         S01240
     C**   in SR. WACMVD                                                  S01240
     C                     Z-ADDPNBL      WPNBL                           S01240
     C**
     C**   'Apply' updates due to the new trade
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           PNBL      SUB  PRMP      PNBL
     C**    - Sale
     C                     ELSE
     C           PNBL      ADD  PRMP      PNBL
     C                     END
     C**
     C**   Update  LF/PRONOM
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C                     MOVE FFNCCY    CCY
     C                     MOVE FFNOSN    NOSN
     C                     WRITEPRONOMEF
     C**
     C                     ELSE
     C                     UPDATPRONOMEF
     C                     END
     C/COPY WNCPYSRC,FF0020C025
     C                     ELSE                                           CFF007
      * Access  LF/PRONO                                                  CFF007
     C           KPRONO    CHAINPRONO                71                   CFF007
      *                                                                   CFF007
     C           *IN71     IFEQ '1'                                       CFF007
     C           *IN71     OREQ '0'                                       CFF007
     C           RECI      ANDNE'D'                                       CFF007
     C                     MOVE '38'      DBASE            ************   CFF007
     C                     MOVE 'PRONOPN' DBFILE           * DBERR 38 *   CFF007
     C                     MOVELFFNCCY    WPRON1           ************   CFF007
     C                     MOVE FFNOSN    WPRON1                          CFF007
     C                     MOVE WPRON1    DBKEY                           CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Calculate next working day after the fifth date in               CFF007
      ** the array in PRONOPN/PF, and store as the sixth date             CFF007
      ** Also store balances, to detect if a change is made               CFF007
      *                                                                   CFF007
     C                     Z-ADD@BL       @OLDBL                          CFF007
      *                                                                   CFF007
      ** Check if day number is a holiday                                 CFF007
      *                                                                   CFF007
     C                     Z-ADD@DT,5     ZDAYNO                          CFF007
     C                     MOVE FFNCCY    ZCCY                            CFF007
     C                     MOVE *BLANKS   ZLOC                            CFF007
     C                     EXSR ZCHKH                                     CFF007
     C                     Z-ADDZDAYNO    @DT,6                           CFF007
      *                                                                   CFF007
      ** Update each of the five balances in turn                         CFF007
      ** according to whether the test date is before                     CFF007
      ** the cut-off date for each balance                                CFF007
      *                                                                   CFF007
     C           1         DO   5         @N      20                      CFF007
      *                                                                   CFF007
     C           @N        ADD  1         @N2     20                      CFF007
     C           VALD      IFLT @DT,@N2                                   CFF007
     C           TRTYTR    IFEQ 'P'                                       CFF007
     C                     SUB  PRMP      @BL,@N                          CFF007
     C                     ELSE                                           CFF007
     C                     ADD  PRMP      @BL,@N                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** Write the results back to Nostro Balance File                    CFF007
      *                                                                   CFF007
     C           @@PNB2    IFNE PNB                                       CFF007
     C                     EXCPT#PROUP                                    CFF007
     C                     ELSE                                           CFF007
     C                     EXCPT#PRREL                                    CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01240
     C**                                                                 *S01240
     C**   WACMVD SR. -  Write record to PF/FFACMVD                      *S01240
     C**   ~~~~~~~~~~                                                    *S01240
     C**      Called From                  Calls                         *S01240
     C**       SR. UINSRT                                                *S01240
     C**       SR. UAMEND                                                *S01240
     C**       SR. UDELET                                                *S01240
     C**                                                                 *S01240
     C********************************************************************S01240
     C**                                                                  S01240
     C           WACMVD    BEGSR                           ** WACMVD SR **S01240
     C**                                                                  S01240
     C**   Set up fields for output to PF/FFACMVD                         S01240
     C**                                                                  S01240
     C**   Branch Code                                                    S01240
     C***********          MOVE *BLANK    BRCA                      S01240FO0017
     C                     MOVE FOBRCA    BRCA                            FO0017
     C**                                                                  S01240
     C**   Customer Number                                                S01240
     C***********          Z-ADDFFCNUM    CUSN                      S01240FO0025
     C**********           Z-ADDFOCNUM    CUSN                                         FO0025 CSD027
     C                     MOVE FOCNUM    CUSN                                                CSD027
     C**                                                                  S01240
     C**   Currency Code                                                  S01240
     C***********          MOVE FFCCY     CCYD                      S01240FO0025
     C                     MOVE FOCURR    CCYD                            FO0025
     C**                                                                  S01240
     C**   Account Code                                                   S01240
     C************         Z-ADDFFACOD    ACDE                      S01240FO0025
     C                     Z-ADDFOACOD    ACDE                            FO0025
     C**                                                                  S01240
     C**   Account Sequence                                               S01240
     C************         Z-ADDFFACSQ    ASNC                      S01240FO0025
     C                     Z-ADDFOACSQ    ASNC                            FO0025
     C**                                                                  FO0025
     C**   Nostro Code                                                    FO0025
     C                     Z-ADDFONOSN    NOSN                            FO0025
     C**                                                                  S01240
     C**   Posting Date                                                   S01240
     C                     Z-ADDPRUND     PTDT                            S01240
     C**                                                                  S01240
     C**   Value Date                                                     S01240
     C/COPY WNCPYSRC,FF0020C026
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C                     Z-ADDWVALD     VUDT                            CFF007
     C                     ELSE                                           CFF007
     C                     Z-ADDPRUND     VUDT                            S01240
     C                     ENDIF                                          CFF007
     C/COPY WNCPYSRC,FF0020C027
     C**                                                                  S01240
     C**   Transaction Type                                               S01240
     C                     MOVE TRTYTR    TRYP                            S01240
     C**                                                                  S01240
     C**   Narrative Code                                                 S01240
     C                     Z-ADD0         NRTC                            S01240
     C**                                                                  S01240
     C**   Narrative Description                                          S01240
     C                     MOVELISTN      NRTD                            S01240
     C**                                                                  S01240
     C**   Transaction Number                                             S01240
     C**   Take the value in field screen otherwise when linked ref       068525
     C**   is specified, TNBR contains the linked ref (read TRANSIN)      068525
     C*********************MOVE TNBR      TNMR                     S01240 068525
     C                     MOVE STNBR     TNMR                            068525
     C**                                                                  S01240
     C**   Cheque Number                                                  S01240
     C                     Z-ADD*ZERO     CQNR                            S01240
     C**                                                                  S01240
     C**   Movement Amount                                                S01240
     C           RAIND     IFEQ 'A'                                       S01240
     C                     Z-ADDPRMP      MVAM                            S01240
     C                     ELSE                                           S01240
     C                     Z-ADDXPRMP     MVAM                            S01240
     C                     END                                            S01240
     C**                                                                  S01240
     C**   Debit or Credit                                                S01240
     C           MPIND     IFEQ 'M'                                       S01240
     C           LDBL      IFGE WLDBL                                     S01240
     C                     Z-ADD0         DORC                            S01240
     C                     ELSE                                           S01240
     C                     Z-ADD1         DORC                            S01240
     C                     END                                            S01240
     C                     END                                            S01240
     C**                                                                  S01240
     C**  If Nostro Code is Zero then Settlement Instructions are Blank   FO0025
     C**                                                                  FO0025
     C           MPIND     IFEQ 'P'                                       S01240
     C**                                                                  FO0025
     C           NOSN      IFNE 0                                         FO0025
     C**                                                                  FO0025
     C                     MOVE NOSN      FFNOSN                          FO0025
     C**                                                                  S01240
     C**  Access PF/TABLETL for Customer Number, Account Code, Account    S01240
     C**  Sequence                                                        S01240
     C           FFNKY     CHAINTABLETLF             70                   S01240
     C  N70      RECI      COMP 'D'                  7070                 S01240
     C           *IN70     IFEQ '1'                                       S01240
     C           *LOCK     IN   LDA                                       S01240
     C                     MOVE '22'      DBASE            ** DBERR  22 **S01240
     C                     MOVE 'TABFF'   DBFILE                          S01240
     C                     MOVELFFNKY     DBKEY                           S01240
     C                     EXSR DBERR                                     S01240
     C                     ELSE                                           S01240
     C*                                                                   FO0017
     C* BRANCH Not moved from TABLE File because it has the same field    FO0017
     C* name as BRANCH on the Account Movements File (ie BRCA to BRCA)    FO0017
     C*                                                                   FO0017
     C                     MOVE CNUM      CUSN                            S01240
     C                     Z-ADDACOD      ACDE                            S01240
     C************         Z-ADDFFDASQ    ASNC                      S01240FO0017
     C                     Z-ADDACSQ      ASNC                            FO0017
     C                     END                                            S01240
     C**                                                                  FO0025
     C                     ELSE                                           FO0025
     C                     MOVE *BLANKS   BRCA                            FO0025
     C**********           Z-ADD0         CUSN                                         FO0025 CSD027
     C                     MOVE *BLANKS   CUSN                                                CSD027
     C                     Z-ADD0         ACDE                            FO0025
     C                     Z-ADD0         ASNC                            FO0025
     C                     END                                            FO0025
     C/COPY WNCPYSRC,FF0020C028
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           CFF001    OREQ 'Y'                                       CFF007
     C           SMRKT     ANDEQ*BLANKS                                   CFF007
     C*                                                                   S01240
     C           PNBL      IFGE WPNBL                                     S01240
     C                     Z-ADD0         DORC                            S01240
     C                     ELSE                                           S01240
     C                     Z-ADD1         DORC                            S01240
     C                     END                                            S01240
     C/COPY WNCPYSRC,FF0020C029
     C                     ELSE                                           CFF007
     C           PNB       IFGE @@PNB2                                    CFF007
     C                     Z-ADD0         DORC                            CFF007
     C                     ELSE                                           CFF007
     C                     Z-ADD1         DORC                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C                     END                                            S01240
     C**                                                                  S01240
     C**  Write record to PF/FFACMVD                                      S01240
     C                     WRITEFFACMVDF                                  S01240
     C**                                                                  S01240
     C                     ENDSR                                          S01240
     C**                                                                  S01240
     C********************************************************************S01240
     C/EJECT                                                              S01240
     C********************************************************************085490
     C**                                                                 *085490
     C**   OTCACM SR. -  Updates enquiry files for OTC's                 *085490
     C**   ~~~~~~~~~~                                                    *085490
     C**      Called From                  Calls                         *085490
     C**       SR. UINSRT                   AOOUOTU0                     *085490
     C**       SR. UAMEND                                                *085490
     C**       SR. UDELET                                                *085490
     C**                                                                 *085490
     C********************************************************************085490
     C**                                                                  085490
     C           OTCACM    BEGSR                           ** OTCACM SR **085490
     C**                                                                  085490
     C**   Call new program AOOUOTU0 to update enquiry files.             085490
     C                     CALL 'AOOUOTU0'                                085490
     C                     PARM           ##RTCD  7                       085490
     C                     PARM           Z#BSTS                          085490
     C                     PARM           Z#ASTS                          085490
     C                     PARM           Z#WSTS                          085490
     C                     PARM           Z#XSTS                          085490
     C           ##RTCD    IFEQ '*ERROR*'                                 085490
     C           *LOCK     IN   LDA                                       085490
     C                     Z-ADD25        DBASE            ** DBERR  25 **085490
     C                     MOVE 'AOOUOTU0'DBFILE                          085490
     C                     EXSR DBERR                                     085490
     C                     END                                            085490
     C                     ENDSR                                          085490
     C**                                                                  085490
     C********************************************************************085490
     C/EJECT                                                              085490
     C********************************************************************S01117
     C**                                                                 *S01117
     C**   UAPRFC SR. -  Update  LF/FOPCC + LF/FOPCK                     *S01117
     C**   ~~~~~~~~~~              Apply Profit Centre                   *S01117
     C**      Called From                  Calls                         *S01117
     C**       SR. UINSRT                                                *S01117
     C**       SR. UAMEND                                                *S01117
     C**                                                                 *S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C           UAPRFC    BEGSR                           ** UAPRFC SR **S01117
     C*                                                                   S01117
     C**   - open LF/FOPCC and LF/FOPCK                                   S01117
     C*                                                                   S01117
     C           @FOPCC    IFNE 'Y'                                       S01117
     C                     OPEN FOPCC                                     S01117
     C                     MOVE 'Y'       @FOPCC  1                       S01117
     C                     END                                            S01117
     C           @FOPCK    IFNE 'Y'                                       S01117
     C                     OPEN FOPCK                                     S01117
     C                     MOVE 'Y'       @FOPCK  1                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   - set up key fields to chain LF/FOPCC for customer             S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '1'                                       S01117
     C           *IN01     ANDEQ'0'                                       CAC003
     C           *IN15     OREQ '1'                                       CAC003
     C           *IN01     ANDEQ'1'                                       CAC003
     C           WIN13     ANDEQ'1'                                       CAC003
     C*                                                                   S01117
     C                     MOVE SBRCD     KBRCAO                          S01117
     C                     MOVE WCUSC     KCBCDO                          S01117
     C           SMRKT     IFEQ '  '                                      S01117
     C                     MOVE SISTT     KISTTO                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSMRKT     KISTTO                          S01117
     C                     MOVE SISTC     KISTTO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           KFPCC     CHAINFOPCC                71                   S01117
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE *IN71     WIN13                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01117
     C**   - set up fields for LF/FOPCC                                   S01117
     C*                                                                   S01117
     C                     MOVE 'D'       RECICC                          S01117
     C                     MOVE SBRCD     BRCACC                          S01117
     C                     MOVE WCUSC     CBCDCC                          S01117
     C           SMRKT     IFEQ '  '                                      S01117
     C                     MOVE SISTT     ISTTCC                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSMRKT     ISTTCC                          S01117
     C                     MOVE SISTC     ISTTCC                          S01117
     C                     END                                            S01117
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE STPRC     PCCB                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE SPRFC     PCCB                            S01117
     C                     ENDIF                                          CAC003
     C*                                                                   FO0018
     C**  Set up new fields LCD with RUNDAT, CHTP with 'I', and TNLU      FO0018
     C*    with Trans No. of Last Update from DTAARA MNATN.               FO0018
     C*                                                                   FO0018
     C                     MOVE RUND      LCD                             FO0018
     C*                                                                   FO0018
     C                     MOVE 'I'       CHTP                            FO0018
     C*                                                                   FO0018
     C           *LOCK     IN   MNATN                                     FO0018
     C                     MOVE TRAN      TNLU                            FO0018
     C*                                                                   FO0018
     C*  Increase Trans No. of Last Update by One.                        FO0018
     C*                                                                   FO0018
     C                     ADD  1         TRAN2                           FO0018
     C                     OUT  MNATN                                     FO0018
     C*                                                                   S01117
     C**   - new position                                                 S01117
     C*                                                                   S01117
     C           *IN71     IFEQ '1'                                       S01117
     C*************        WRITEFOPCCDF                             S01117FO0019
     C           WIN13     IFEQ '1'                                       CAC003
     C                     MOVE '0'       WIN13                           CAC003
     C                     MOVE *IN69     WIN69   1                       CFF007
     C                     WRITEFOPCCDF                69                 FO0019
     C                     MOVE *IN69     WWIN69  1                       CFF007
     C                     MOVE WIN69     *IN69                           CFF007
     C                     ENDIF                                          CAC003
     C**********           ELSE                                     S01117FO0020
     C**********           UPDATFOPCCDF                             S01117FO0020
     C                     END                                            S01117
     C**                                                                  FO0019
     C**   If WRITE fail :-                                               FO0019
     C********** *IN69     IFEQ '1'                                FO0019 CFF007
     C           WWIN69    IFEQ '1'                                       CFF007
     C**                                                                  FO0019
     C           STATS1    IFEQ 01021                                     FO0019
     C**   - 'Rec Upd by Another Wrkstn' - discontinue updates/Rollback   FO0019
     C                     EXSR PCFUAW                                    FO0019
     C                     Z-ADD0         STATS1  50                      FO0019
     C                     GOTO UAPRE                                     FO0019
     C                     ELSE                                           FO0019
     C**   - cancel program                                               FO0019
     C                     EXSR DBERR                                     FO0019
     C                     END                                            FO0019
     C**                                                                  FO0019
     C                     END                                            FO0019
     C**                                                                  FO0019
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   - set up key fields to chain LF/FOPCC for broker               S01117
     C*                                                                   S01117
     C           *IN14     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C                     MOVE SBRCD     KBRCAO                          S01117
     C                     MOVE WBOCO     KCBCDO                          S01117
     C           SMRKT     IFEQ '  '                                      S01117
     C                     MOVE SISTT     KISTTO                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSMRKT     KISTTO                          S01117
     C                     MOVE SISTC     KISTTO                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           KFPCC     CHAINFOPCC                71                   S01117
     C*                                                                   S01117
     C**   - set up fields for LF/FOPCC                                   S01117
     C*                                                                   S01117
     C                     MOVE 'D'       RECICC                          S01117
     C                     MOVE SBRCD     BRCACC                          S01117
     C                     MOVE WBOCO     CBCDCC                          S01117
     C           SMRKT     IFEQ '  '                                      S01117
     C                     MOVE SISTT     ISTTCC                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSMRKT     ISTTCC                          S01117
     C                     MOVE SISTC     ISTTCC                          S01117
     C                     END                                            S01117
     C                     MOVE SPRFC     PCCB                            S01117
     C*                                                                   FO0018
     C**  Set up new fields LCD with RUNDAT, CHTP with 'I', and TNLU      FO0018
     C*    with Trans No. of Last Update from DTAARA MNATN.               FO0018
     C*                                                                   FO0018
     C                     MOVE RUND      LCD                             FO0018
     C*                                                                   FO0018
     C                     MOVE 'I'       CHTP                            FO0018
     C*                                                                   FO0018
     C           *LOCK     IN   MNATN                                     FO0018
     C                     MOVE TRAN      TNLU                            FO0018
     C*                                                                   FO0018
     C*  Increase Trans No. of Last Update by One.                        FO0018
     C*                                                                   FO0018
     C                     ADD  1         TRAN2                           FO0018
     C                     OUT  MNATN                                     FO0018
     C*                                                                   S01117
     C**   - new position                                                 S01117
     C*                                                                   S01117
     C           *IN71     IFEQ '1'                                       S01117
     C************         WRITEFOPCCDF                             S01117FO0019
     C                     MOVE *IN69     WIN69                           CFF007
     C                     WRITEFOPCCDF                69                 FO0019
     C                     MOVE *IN69     WWIN69                          CFF007
     C                     MOVE WIN69     *IN69                           CFF007
     C************         ELSE                                     S01117FO0020
     C************         UPDATFOPCCDF                             S01117FO0020
     C                     END                                            S01117
     C**                                                                  FO0019
     C**   If WRITE fail :-                                               FO0019
     C********** *IN69     IFEQ '1'                                FO0019 CFF007
     C           WWIN69    IFEQ '1'                                       CFF007
     C**                                                                  FO0019
     C           STATS1    IFEQ 01021                                     FO0019
     C**   - 'Rec Upd by Another Wrkstn' - discontinue updates/Rollback   FO0019
     C                     EXSR PCFUAW                                    FO0019
     C                     Z-ADD0         STATS1  50                      FO0019
     C                     GOTO UAPRE                                     FO0019
     C                     ELSE                                           FO0019
     C**   - cancel program                                               FO0019
     C                     EXSR DBERR                                     FO0019
     C                     END                                            FO0019
     C**                                                                  FO0019
     C                     END                                            FO0019
     C**                                                                  FO0019
     C                     END                                            S01117
     C***********                                                   S01117FO0020
     C*****-*set*up key fields to chain LF/FOPCK                    S01117FO0020
     C***********                                                   S01117FO0020
     C***********          MOVE SBRCD     KBRCAF                    S01117FO0020
     C***********          MOVE SBOKC     KBOKCF                    S01117FO0020
     C***********SMRKT     IFEQ '  '                                S01117FO0020
     C***********          MOVE SISTT     KISTTF                    S01117FO0020
     C***********          ELSE                                     S01117FO0020
     C***********          MOVELSMRKT     KISTTF                    S01117FO0020
     C***********          MOVE SISTC     KISTTF                    S01117FO0020
     C***********          END                                      S01117FO0020
     C***********                                                   S01117FO0020
     C***********KFPCK     CHAINFOPCK                71             S01117FO0020
     C*                                                                   FO0020
     C** Write to FOPCKD for a New Book Position Profit Centre            FO0020
     C*                                                                   FO0020
     C************IN12     IFEQ '1'                                FO0020 CAC003
     C           WIN12     IFEQ '1'                                       CAC003
     C***********          SETOF                     12            FO0020 CAC003
     C                     MOVE '0'       WIN12                           CAC003
     C*                                                                   S01117
     C**   - set up fields for LF/FOPCK                                   S01117
     C*                                                                   S01117
     C                     MOVE 'D'       RECICK                          S01117
     C                     MOVE SBRCD     BRCACK                          S01117
     C                     MOVE SBOKC     BOKCCK                          S01117
     C           SMRKT     IFEQ '  '                                      S01117
     C                     MOVE SISTT     ISTTCK                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSMRKT     ISTTCK                          S01117
     C                     MOVE SISTC     ISTTCK                          S01117
     C                     END                                            S01117
     C           *IN01     IFEQ '1'                                       CAC003
     C                     MOVE SBPRC     PCBK                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE SPRFC     PCBK                            S01117
     C                     ENDIF                                          CAC003
     C*                                                                   FO0018
     C**  Set up new fields LCD with RUNDAT, CHTP with 'I', and TNLU      FO0018
     C*    with Trans No. of Last Update from DTAARA MNATN.               FO0018
     C*                                                                   FO0018
     C                     MOVE RUND      LCD                             FO0018
     C*                                                                   FO0018
     C                     MOVE 'I'       CHTP                            FO0018
     C*                                                                   FO0018
     C           *LOCK     IN   MNATN                                     FO0018
     C                     MOVE TRAN      TNLU                            FO0018
     C*                                                                   FO0018
     C*  Increase Trans No. of Last Update by One.                        FO0018
     C*                                                                   FO0018
     C                     ADD  1         TRAN2                           FO0018
     C                     OUT  MNATN                                     FO0018
     C*                                                                   S01117
     C**   - new position                                                 S01117
     C*                                                                   S01117
     C********** *IN71     IFEQ '1'                                 S01117FO0020
     C************         WRITEFOPCKDF                             S01117FO0019
     C************         WRITEFOPCKDF                68          FO0019 CFF001
     C                     MOVE *IN69     WIN69                           CFF007
     C                     WRITEFOPCKDF                69                 CFF001
     C                     MOVE *IN69     WWIN69                          CFF007
     C                     MOVE WIN69     *IN69                           CFF007
     C************         ELSE                                     S01117FO0020
     C************         UPDATFOPCKDF                             S01117FO0020
     C************         END                                      S01117FO0020
     C**                                                                  FO0019
     C**   If WRITE fail :-                                               FO0019
     C************IN68     IFEQ '1'                                FO0019 CFF001
     C********** *IN69     IFEQ '1'                                CFF001 CFF007
     C           WWIN69    IFEQ '1'                                       CFF007
     C**                                                                  FO0019
     C           STATS2    IFEQ 01021                                     FO0019
     C**   - 'Rec Upd by Another Wrkstn' - discontinue updates/Rollback   FO0019
     C                     EXSR PCFUAW                                    FO0019
     C                     Z-ADD0         STATS2  50                      FO0019
     C                     GOTO UAPRE                                     FO0019
     C                     ELSE                                           FO0019
     C**   - cancel program                                               FO0019
     C                     EXSR DBERR                                     FO0019
     C                     END                                            FO0019
     C**                                                                  FO0019
     C                     END                                            FO0019
     C*                                                                   S01117
     C                     END                                            FO0020
     C**                                                                  FO0020
     C***********          ENDSR                                    S01117FO0019
     C           UAPRE     ENDSR                                          FO0019
     C**                                                                  S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UPSTNC SR. -  Update  LF/POSTNC : Customer Position           *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UPSTNC    BEGSR                           ** UPSTNC SR **
     C**
     C**   Access  Customer Position off LF/POSTNC
     C***********          MOVE BRCDTR    KBRCDC                          S01117
     C                     MOVE BRCATR    KBRCAC                          S01117
     C                     MOVE CUSCTR    KCBCDC
     C                     MOVE KISTT     KISTTC
     C                     MOVE YRNOTR    KYRNOC
     C                     MOVE MTHNTR    KMTHNC
     C                     MOVE PCALTR    KPCALC
     C                     MOVE STRPTR    KSTRPC
     C**
     C           KPSTNC    CHAINPOSTNC               71
     C**
     C**   1. Record must exist (if Action not an insert)
     C**   2. Must be a live record if a record exists.
     C           *IN71     IFEQ '1'
     C           SACTN     ANDNE'I'
     C           *IN71     OREQ '0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C***********          MOVE '18'      DBASE            ** DBERR  18 **S01117
     C                     Z-ADD18        DBASE            ** DBERR  18 **S01117
     C                     MOVE 'PSTNC'   DBFILE
     C                     MOVELPSTNCK    DBKEY
     C                     EXSR DBERR
     C                     END
     C/SPACE 2
     C**   1. 'Reverse out' updates due to the old trade  (not Insert)
     C**
     C           SACTN     IFNE 'I'
     C**
     C**   - a) Broker involved
     C**
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOPC      SUB  XNUCO     LOPC
     C           CUTV      SUB  XCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           SOPC      SUB  XNUCO     SOPC
     C           CUTV      ADD  XCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           XCMAR     IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOCO      SUB  XNUCO     LOCO
     C**    - Sale
     C                     ELSE
     C           SOCO      SUB  XNUCO     SOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           XCMAR     IFGT 0
     C           TOTM      SUB  XCMAR     TOTM
     C                     END
     C**
     C                     END
     C**
     C**   - b) Broker not involved
     C**
     C                     ELSE
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOPC      SUB  XNUCO     SOPC
     C           CUTV      ADD  XCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           LOPC      SUB  XNUCO     LOPC
     C           CUTV      SUB  XCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           XCMAR     IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOCO      SUB  XNUCO     SOCO
     C**    - Sale
     C                     ELSE
     C           LOCO      SUB  XNUCO     LOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           XCMAR     IFGT 0
     C           TOTM      SUB  XCMAR     TOTM
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   2. 'Apply' updates due to the new trade  (not for Delete)
     C**
     C           SACTN     IFNE 'D'
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         LOPC
     C                     Z-ADD0         SOPC
     C                     Z-ADD0         CUTV
     C                     Z-ADD0         TOTM
     C                     Z-ADD0         LOCO
     C                     Z-ADD0         SOCO
     C                     END
     C**
     C**   - a) Broker involved
     C**
     C********** BOCOTR    IFNE 0                                                             CSD027
     C           BOCOTR    IFNE *BLANKS                                                       CSD027
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOPC      ADD  WNUCO     LOPC
     C           CUTV      ADD  WCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           SOPC      ADD  WNUCO     SOPC
     C           CUTV      SUB  WCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           CMAR      IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOCO      ADD  WNUCO     LOCO
     C**    - Sale
     C                     ELSE
     C           SOCO      ADD  WNUCO     SOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           CMAR      IFGT 0
     C           TOTM      ADD  CMAR      TOTM
     C                     END
     C**
     C                     END
     C**
     C**   - b) Broker not involved
     C**
     C                     ELSE
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOPC      ADD  WNUCO     SOPC
     C           CUTV      SUB  WCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           LOPC      ADD  WNUCO     LOPC
     C           CUTV      ADD  WCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           CMAR      IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOCO      ADD  WNUCO     SOCO
     C**    - Sale
     C                     ELSE
     C           LOCO      ADD  WNUCO     LOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           CMAR      IFGT 0
     C           TOTM      ADD  CMAR      TOTM
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Update  Customer's Instrument Position
     C**
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCDC    BRCD                            S01117
     C                     MOVE KBRCAC    BRCA                            S01117
     C                     MOVE KCBCDC    CBCD
     C                     MOVE KISTTC    ISTT
     C                     MOVE KYRNOC    YRNO
     C                     MOVE KMTHNC    MTHN
     C                     MOVE KPCALC    PCAL
     C                     Z-ADDKSTRPC    STRP
     C                     MOVE 'N'       BRKI
     C                     MOVE KCCY      ISCY
     C**
     C                     Z-ADD0         LSPO
     C                     Z-ADD0         LSCP
     C                     Z-ADD0         LSDA
     C                     Z-ADD0         LTPO
     C                     Z-ADD0         LTCP
     C                     Z-ADD0         LTDA
     C                     Z-ADD0         LOPE
     C                     Z-ADD0         SOPE
     C                     Z-ADD0         CUPL
     C                     Z-ADD0         UPLP
     C                     Z-ADD0         UPSP
     C                     Z-ADD0         RPLD
     C                     Z-ADD0         RPLY
     C                     Z-ADD0         UPLY
     C                     Z-ADD0         TOPL
     C                     Z-ADD0         CMTM
     C                     Z-ADD0         CHTM
     C                     Z-ADD0         PMTM
     C                     Z-ADD0         UPLM
     C                     Z-ADD0         RPLM
     C**
     C                     WRITEPOSTNCDF
     C**
     C                     ELSE
     C**
     C                     EXCPTCBPSTN
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UPSTNB SR. -  Update  LF/POSTNC : Broker Position             *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UPSTNB    BEGSR                           ** UPSTNB SR **
     C**
     C**   Access  Broker Position off LF/POSTNC
     C***********          MOVE BRCDTR    KBRCDC                          S01117
     C                     MOVE BRCATR    KBRCAC                          S01117
     C                     MOVE BOCOTR    KCBCDC
     C                     MOVE KISTT     KISTTC
     C                     MOVE YRNOTR    KYRNOC
     C                     MOVE MTHNTR    KMTHNC
     C                     MOVE PCALTR    KPCALC
     C                     MOVE STRPTR    KSTRPC
     C**
     C           KPSTNC    CHAINPOSTNC               71
     C**
     C**   1. Record must exist (if Action not an insert)
     C**   2. Must be a live record if a record exists.
     C           *IN71     IFEQ '1'
     C           SACTN     ANDNE'I'
     C           *IN71     OREQ '0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C***********          MOVE '19'      DBASE            ** DBERR  19 **S01117
     C                     Z-ADD19        DBASE            ** DBERR  19 **S01117
     C                     MOVE 'PSTNC'   DBFILE
     C                     MOVELPSTNCK    DBKEY
     C                     EXSR DBERR
     C                     END
     C/SPACE 2
     C**   1. 'Reverse out' updates due to the old trade  (not Insert)
     C**
     C           SACTN     IFNE 'I'
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOPC      SUB  XNUCO     SOPC
     C           CUTV      ADD  XCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           LOPC      SUB  XNUCO     LOPC
     C           CUTV      SUB  XCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           XBMAR     IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOCO      SUB  XNUCO     SOCO
     C**    - Sale
     C                     ELSE
     C           LOCO      SUB  XNUCO     LOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           XBMAR     IFGT 0
     C           TOTM      SUB  XBMAR     TOTM
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   2. 'Apply' updates due to the new trade  (not for Delete)
     C**
     C           SACTN     IFNE 'D'
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         LOPC
     C                     Z-ADD0         SOPC
     C                     Z-ADD0         CUTV
     C                     Z-ADD0         TOTM
     C                     Z-ADD0         LOCO
     C                     Z-ADD0         SOCO
     C                     END
     C**
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOPC      ADD  WNUCO     SOPC
     C           CUTV      SUB  WCTNVL    CUTV
     C**    - Sale
     C                     ELSE
     C           LOPC      ADD  WNUCO     LOPC
     C           CUTV      ADD  WCTNVL    CUTV
     C                     END
     C**
     C**    Margin
     C           BMAR      IFEQ 0
     C**    - Purchase
     C           TRTYTR    IFEQ 'P'
     C           SOCO      ADD  WNUCO     SOCO
     C**    - Sale
     C                     ELSE
     C           LOCO      ADD  WNUCO     LOCO
     C                     END
     C**
     C                     ELSE
     C**
     C           BMAR      IFGT 0
     C           TOTM      ADD  BMAR      TOTM
     C                     END
     C**
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Update  Broker's Instrument Position
     C**
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCDC    BRCD                            S01117
     C                     MOVE KBRCAC    BRCA                            S01117
     C                     MOVE KCBCDC    CBCD
     C                     MOVE KISTTC    ISTT
     C                     MOVE KYRNOC    YRNO
     C                     MOVE KMTHNC    MTHN
     C                     MOVE KPCALC    PCAL
     C                     Z-ADDKSTRPC    STRP
     C                     MOVE 'Y'       BRKI
     C                     MOVE KCCY      ISCY
     C**
     C                     Z-ADD0         LSPO
     C                     Z-ADD0         LSCP
     C                     Z-ADD0         LSDA
     C                     Z-ADD0         LTPO
     C                     Z-ADD0         LTCP
     C                     Z-ADD0         LTDA
     C                     Z-ADD0         LOPE
     C                     Z-ADD0         SOPE
     C                     Z-ADD0         CUPL
     C                     Z-ADD0         UPLP
     C                     Z-ADD0         UPSP
     C                     Z-ADD0         RPLD
     C                     Z-ADD0         RPLY
     C                     Z-ADD0         UPLY
     C                     Z-ADD0         TOPL
     C                     Z-ADD0         CMTM
     C                     Z-ADD0         CHTM
     C                     Z-ADD0         PMTM
     C                     Z-ADD0         UPLM
     C                     Z-ADD0         RPLM
     C**
     C                     WRITEPOSTNCDF
     C**
     C                     ELSE
     C**
     C                     EXCPTCBPSTN
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UPSTNK SR. -  Update  LF/POSTNK  : Book Position              *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UPSTNK    BEGSR                           ** UPSTNK SR **
     C**
     C**   Access  Book Position off LF/POSTNK
     C***********          MOVE BRCDTR    KBRCDK                          S01117
     C                     MOVE BRCATR    KBRCAK                          S01117
     C                     MOVE BOKCTR    KBOKCK
     C                     MOVE KISTT     KISTTK
     C                     MOVE YRNOTR    KYRNOK
     C                     MOVE MTHNTR    KMTHNK
     C                     MOVE PCALTR    KPCALK
     C                     MOVE STRPTR    KSTRPK
     C**
     C           KPSTNK    CHAINPOSTNK               71
     C**
     C**   1. Record must exist (if Action not an insert)
     C**   2. Must be a live record if a record exists.
     C           *IN71     IFEQ '1'
     C           SACTN     ANDNE'I'
     C           *IN71     OREQ '0'
     C           RECI      ANDNE'D'
     C           *LOCK     IN   LDA
     C***********          MOVE '20'      DBASE            ** DBERR  20 **S01117
     C                     Z-ADD20        DBASE            ** DBERR  20 **S01117
     C                     MOVE 'PSTNK'   DBFILE
     C                     MOVELPSTNKK    DBKEY
     C                     EXSR DBERR
     C                     END
     C/SPACE 2
     C**   1. 'Reverse out' updates due to the old trade  (not Insert)
     C**
     C           SACTN     IFNE 'I'
     C**
     C**   - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOPC      SUB  XNUCO     LOPC
     C           CUTV      SUB  XCTNVL    CUTV
     C**   - Sale
     C                     ELSE
     C           SOPC      SUB  XNUCO     SOPC
     C           CUTV      ADD  XCTNVL    CUTV
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   2. 'Apply' updates due to the new trade  (not for Delete)
     C**
     C           SACTN     IFNE 'D'
     C**
     C           *IN71     IFEQ '1'
     C                     Z-ADD0         LOPC
     C                     Z-ADD0         SOPC
     C                     Z-ADD0         CUTV
     C                     END
     C**
     C**   - Purchase
     C           TRTYTR    IFEQ 'P'
     C           LOPC      ADD  WNUCO     LOPC
     C           CUTV      ADD  WCTNVL    CUTV
     C**   - Sale
     C                     ELSE
     C           SOPC      ADD  WNUCO     SOPC
     C           CUTV      SUB  WCTNVL    CUTV
     C                     END
     C**
     C                     END
     C/SPACE 2
     C**   Update  Book's Instrument Position
     C**
     C           *IN71     IFEQ '1'
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCDK    BRCD                            S01117
     C                     MOVE KBRCAK    BRCA                            S01117
     C                     MOVE KBOKCK    BOKC
     C                     MOVE KISTTK    ISTT
     C                     MOVE KYRNOK    YRNO
     C                     MOVE KMTHNK    MTHN
     C                     MOVE KPCALK    PCAL
     C                     Z-ADDKSTRPK    STRP
     C                     MOVE KCCY      ISCY
     C**
     C                     Z-ADD0         LOPE
     C                     Z-ADD0         SOPE
     C                     Z-ADD0         POSM
     C                     Z-ADD0         CUPL
     C                     Z-ADD0         UPLP
     C                     Z-ADD0         UPSP
     C                     Z-ADD0         RPLD
     C                     Z-ADD0         RPLY
     C                     Z-ADD0         UPLY
     C                     Z-ADD0         TOPL
     C                     Z-ADD0         TOTP
     C                     Z-ADD0         TOTS
     C                     Z-ADD0         CMSP
     C                     Z-ADD0         CMSR
     C                     Z-ADD0         CPTM
     C                     Z-ADD0         CRTM
     C                     Z-ADD0         PMTM
     C                     Z-ADD0         UPLM
     C                     Z-ADD0         RPLM
     C**
     C                     WRITEPOSTNKDF
     C**
     C                     ELSE
     C**
     C                     EXCPTBKPSTN
     C**
     C                     END
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   UTRNSA SR. -  Update  Transaction Audit file                  *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                                                *
     C**       SR. UAMEND                                                *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           UTRNSA    BEGSR                           ** UTRNSA SR **
     C**
     C**   Access audit record
     C**
     C           1         CHAINTRANSA               71
     C**
     C**   - not found
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVE '21'      DBASE            ** DBERR  21 **S01117
     C                     Z-ADD21        DBASE            ** DBERR  21 **S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVEL'AUDIT'   DBKEY
     C                     EXSR DBERR
     C                     END
     C**
     C**   Insert
     C           SACTN     IFEQ 'I'
     C                     ADD  1         NORE
     C                     ADD  1         NINS
     C**
     C                     ELSE
     C**   Amend
     C           SACTN     IFEQ 'A'
     C**
     C           XLCD      IFNE CTDATE
     C                     ADD  1         NAMD
     C                     END
     C**
     C                     ELSE
     C**   Delete
     C                     SUB  1         NORE
     C                     ADD  1         NDEL
     C**
     C           XLCD      IFEQ CTDATE
     C**
     C           XCHTP     IFEQ 'I'
     C                     SUB  1         NINS
     C                     END
     C**
     C           XCHTP     IFEQ 'A'
     C                     SUB  1         NAMD
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C**   Update audit record
     C**
     C                     UPDATTRANSAF
     C**
     C                     ENDSR
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**   TUDBAW SR. -  'Trade Updated By Another Workstation' Control  *
     C**   ~~~~~~~~~~                                                    *
     C**      Called From                  Calls                         *
     C**       SR. UINSRT                   SR. INFSR                    *
     C**       SR. UAMEND                   SR. ISADEW                   *
     C**       SR. UDELET                                                *
     C**                                                                 *
     C********************************************************************
     C**
     C           TUDBAW    BEGSR                           ** TUDBAW SR **
     C**
     C                     ROLBK
     C**
     C**   Access TRANS record
     C           KTNBR     CHAINTRANSIN              71
     C**
     C**   - Cancel if trade belongs to another market
     C           *IN71     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C**
     C**   Check if now deleted
     C           RECI      COMP '*'                      72
     C**
     C**   Save Instr. Ccy
     C                     MOVE ISCY      KCCY
     C**
     C**   Reset Processing
     C                     SETON                     11
     C                     SETOF                     1415
     C                     MOVE *BLANK    SMIODS
     C                     MOVE *BLANK    SSETDS
     C                     MOVE *BLANK    SMPIDS                          CPL002
     C**
     C**   Initialise  updated screen details
     C                     MOVE KTNBR     STNBR
     C                     EXSR ISADEW
     C**
     C**********           MOVEAMSG,7     SERCD1                          CFF007
     C**********           MOVEAMSG,8     SERCD2                          CFF007
     C                     MOVELMSG,7     SERCD1                          CFF007
     C                     MOVELMSG,8     SERCD2                          CFF007
     C**
     C                     ENDSR
     C**
     C********************************************************************FO0019
     C**                                                                 *FO0019
     C**   PCFUAW SR. -  'Profit Centre File Updated By Another Wrkstn'  *FO0019
     C**   ~~~~~~~~~~                                                    *FO0019
     C**      Called From:- UAPRFC                                       *FO0019
     C**                                                                 *FO0019
     C********************************************************************FO0019
     C**                                                                  FO0019
     C           PCFUAW    BEGSR                           ** PCFUAW SR **FO0019
     C**                                                                  FO0019
     C                     ROLBK                                          FO0019
     C**                                                                  FO0019
     C**   Reset Processing                                               FO0019
     C                     SETON                     11                   FO0019
     C**                                                                  FO0019
     C**********           MOVEAMSG,7     SERCD1                   FO0019 CFF007
     C**********           MOVEAMSG,8     SERCD2                   FO0019 CFF007
     C                     MOVELMSG,7     SERCD1                          CFF007
     C                     MOVELMSG,8     SERCD2                          CFF007
     C**                                                                  FO0019
     C                     ENDSR                                          FO0019
     C**                                                                  FO0019
     C********************************************************************FO0019
      /EJECT                                                              CFF007
      *****************************************************************   CFF007
      *                                                               *   CFF007
      *  TTFCAL - To calculate tier, threshold or flat rate           *   CFF007
      *  Called From: BPTCHA, BPTCHS, BPTCHH, BPTCHE,                 *   CFF007
      *               CPTCHA, CPTCHS, CPTCHH, CPTCHE                  *   CFF007
      *  Calls      : None                                            *   CFF007
      *                                                               *   CFF007
      *****************************************************************   CFF007
      *                                                                   CFF007
     C           TTFCAL    BEGSR                                          CFF007
      *                                                                   CFF007
      ** Access CHGCM for charges and commissions detail                  CFF007
      *                                                                   CFF007
     C                     MOVE ISCY      KCCY                            CFF007
     C                     Z-ADDCGCM      KCGCM                           CFF007
      *                                                                   CFF007
     C           KCHGCM    CHAINCHGCM                71                   CFF007
      *                                                                   CFF007
      ** Database error                                                   CFF007
      *                                                                   CFF007
     C           *IN71     IFEQ *ON                                       CFF007
     C           RECI      ORNE 'D'                                       CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     MOVEL'CHGCM   'DBFILE                          CFF007
     C                     MOVELISCY      CHGCMT  5                       CFF007
     C                     MOVE CGCM      CHGCMT                          CFF007
     C                     MOVELCHGCMT    DBKEY            ************   CFF007
     C                     MOVE *BLANKS   DBOPTN           * DBERR 36 *   CFF007
     C                     Z-ADD36        DBASE            ************   CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Locate the highest valued charged range lower limit on CHGCM     CFF007
      ** whose value is less than or equal to the contract number         CFF007
      *                                                                   CFF007
     C                     Z-ADD9         Y       10                      CFF007
     C                     MOVE 'N'       WFOUND  1                       CFF007
      *                                                                   CFF007
     C           WFOUND    DOWEQ'N'                                       CFF007
     C           Y         ANDGT1                                         CFF007
      *                                                                   CFF007
     C           RNG,Y     IFNE 0                                         CFF007
     C           RNG,Y     ANDLEWCONO                                     CFF007
     C                     MOVE 'Y'       WFOUND                          CFF007
     C                     ELSE                                           CFF007
     C                     SUB  1         Y                               CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** If charges are tiered                                            CFF007
      *                                                                   CFF007
     C           TTFI      IFEQ 'T'                                       CFF007
     C           WCONO     SUB  RNG,Y     TCONO   50                      CFF007
     C                     ADD  1         TCONO                           CFF007
     C           TCONO     MULT AMT,Y     WRATA                           CFF007
     C*                                                                   CFF007
     C           Y         DOWGE2                                         CFF007
     C           Y         SUB  1         Z       10                      CFF007
     C           RNG,Y     SUB  RNG,Z     TCONO                           CFF007
     C           TCONO     MULT AMT,Z     TRATA  130                      CFF007
     C                     ADD  TRATA     WRATA                           CFF007
     C                     SUB  1         Y                               CFF007
     C                     ENDDO                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If charges are threshold                                         CFF007
      *                                                                   CFF007
     C           TTFI      IFEQ 'X'                                       CFF007
     C           WCONO     MULT AMT,Y     WRATA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If charges are flat                                              CFF007
      *                                                                   CFF007
     C           TTFI      IFEQ 'F'                                       CFF007
     C                     Z-ADDAMT,Y     WRATA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If rate amount < min charge commission                           CFF007
      *                                                                   CFF007
     C           WRATA     IFLT MINC                                      CFF007
     C           MINC      ANDNE0                                         CFF007
     C                     Z-ADDMINC      WRATA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If rate amount > max charge commission                           CFF007
      *                                                                   CFF007
     C           WRATA     IFGT MAXC                                      CFF007
     C           MAXC      ANDNE0                                         CFF007
     C                     Z-ADDMAXC      WRATA                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
      *****************************************************************   CFF007
      *                                                               *                       CSD015
      *  SRWTCH - Set-up parameters for compliance engine program and *                       CSD015
      *           sends transaction details by calling SDWLCLOP.      *                       CSD015
      *                                                               *                       CSD015
      *  Called From : WTRANS, UTRANS                                 *                       CSD015
      *  Calls       : SDWLCLOP, SDCWLFMT                             *                       CSD015
      *                                                               *                       CSD015
      *****************************************************************                       CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Initialise then set-up 1st parameter for SDWLCLOP                                    CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   SDWLTO                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'FFOTCO'  W4ITEM                                              CSD015
     C                     MOVELTNBR      W4IDEN                                              CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVEL'TRANSD'  W4FUNT                                              CSD015
     C                     Z-ADDTRSD      W4DDAT                                              CSD015
     C                     Z-ADDVALD      W4VDAT                                              CSD015
     C                     Z-ADD0         W4MDAT                                              CSD015
     C                     MOVELISTT      W4DEN1                                              CSD015
     C                     MOVEL*BLANKS   W4DEN2                                              CSD015
     C                     Z-ADDNUCO      W4AMT1                                              CSD015
     C                     Z-ADD0         W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** If return code is blank, process counterparty details of 1st                         CSD015
      ** parameter                                                                            CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
     C           WLCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ELSE                                                               CSD015
     C           WLLICD    IFNE *BLANKS                                                       CSD015
     C           WLLICD    ANDNEW1IND1                                                        CSD015
     C           WLLICD    ANDNEW1IND2                                                        CSD015
     C           WLLICD    ANDNEW1IND3                                                        CSD015
     C           WLLICD    ANDNEW1IND4                                                        CSD015
     C           WLLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       W4CTYP                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       W4CTYP                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C           WLCRNM    CAT  WLCRTN    W4CUST                                              CSD015
     C                     MOVELWLCUST    W4CNUM                                              CSD015
      *                                                                                       CSD015
      ** Initialise then set-up 2nd parameter for SDWLCLOP                                    CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PXML                                                CSD015
     C                     MOVE *BLANKS   PWLOUT216                                           CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     Z-ADD6         WY                                                  CSD015
      *                                                                                       CSD015
     C           WX        DOUGTWY                                                            CSD015
      *                                                                                       CSD015
     C           WLF,WX    IFNE *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM WLF,WX    PWLIN1 35                                           CSD015
     C                     PARM *BLANKS   PWLIN2 35                                           CSD015
     C                     PARM *BLANKS   PWLIN3 35                                           CSD015
     C                     PARM *BLANKS   PWLIN4 35                                           CSD015
     C                     PARM *BLANKS   PWLIN5 35                                           CSD015
     C                     PARM *BLANKS   PWLIN6 35                                           CSD015
     C                     PARM ISCY      PCCY    3                                           CSD015
     C                     PARM           PWLOUT                                              CSD015
     C                     PARM           PWLOP2  6                                           CSD015
      *                                                                                       CSD015
     C           PWLOUT    IFNE *BLANKS                                                       CSD015
     C                     CAT  XOT,WX:0  PXML                                                CSD015
     C                     CAT  PWLOUT:0  PXML                                                CSD015
     C                     CAT  XCT,WX:0  PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PWLOUT                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ADD  1         WX                                                  CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C           PXML      IFNE *BLANKS                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           SDWLTO                                              CSD015
     C                     PARM           PXML                                                CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *                                                                                       CSD015
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACOD - Gets Account Codes via AOACODR0.                    *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACOD    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     MOVE FFACOD    PACCD                                               CGL029
      *                                                                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7                                           CGL029
     C                     PARM '*VERIFY' POPTN   7                                           CGL029
     C                     PARM           PACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C                     MOVE *ON       *IN70                                               CGL029
     C           PRTCD     IFEQ *BLANKS                                                       CGL029
     C                     MOVE *OFF      *IN70                                               CGL029
     C                     ELSE                                                               CGL029
     C           PRTCD     IFNE '*NRF'                                                        CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     MOVE 'SDACODPD'DBFILE                                              CGL029
     C                     MOVE PACCD     DBKEY                                               CGL029
     C                     Z-ADD101       DBASE                                               CGL029
     C                     OUT  LDA                                                           CGL029
     C                     EXSR DBERR                                                         CGL029
     C                     ENDIF                                                              CGL029
     C                     ENDIF                                                              CGL029
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
     C*****************************************************************                       CSD015
      /EJECT                                                                                  CSD015
      *****************************************************************                       CSD015
     C*
     C/COPY WNCPYSRC,FF0020CP21
     C*
     C/EJECT
     C/COPY ZSRSRC,FFSTDPZ4
     C/EJECT
     C/COPY ZSRSRC,FFPRCSZ4
     C/EJECT
     C/COPY ZSRSRC,FFPRVLZ4
     C/EJECT
     C/COPY ZSRSRC,FFPMCLZ1
     C/EJECT
     C/COPY ZSRSRC,FFTVCLZ2
     C/EJECT
     C/COPY ZSRSRC,FFSETLZ4
     C/EJECT
     C/COPY ZSRSRC,ZALIGNZ2
     C/EJECT
     C/COPY ZSRSRC,ZEDITZ2
     C/EJECT                                                              073714
     C/COPY ZSRSRC,ZSEDITZ3                                               073714
     C/EJECT
     C/COPY ZSRSRC,ZDATE1Z2
     C/EJECT
     C/COPY ZSRSRC,ZDATE2Z2
     C/EJECT
     C/COPY ZSRSRC,FFDATEZ3
     C/EJECT
     C*COPY*ZSRSRC,ZDATE3Z4                                               S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/EJECT
     C*COPY*ZSRSRC,ZDATE5Z2                                               S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/EJECT                                                              S01195
     C/COPY ZSRSRC,ZTNLU1Z2
     C/EJECT
     C/COPY ZSRSRC,FFYTOPZ1                                               AUS022
     C/EJECT                                                              AUS022
     O*
     OTRANSDF E                ATRANS
     O*    Amend LF/TRANS
     O                         TRSD
     O                         NUCO
     O                         NOCOTR
     O                         NOBOTR
     O                         COPRTR
     O                         TNAR
     O                         TBLO
     O                         LNKR
     O                         LCD
     O                         CHTP
     O                         TNLU
     O                         ORBR                                       S01117
     O                         PRFC                                       S01117
     O                         VALD                                       073714
     O                         PTFR                                       S01235
     O                         SPTPTR                                     CPL002
     O                         COVE                                       CFF007
     O                         HETR                                       CFF007
     O                         BLUP                                       CFF007
     O/COPY WNCPYSRC,FF0020O002
     O*
     OTRANSDF E                DTRANS
     O*    Delete LF/TRANS
     O                         RECI
     O                         LNKR
     O                         LCD
     O                         CHTP
     O                         TNLU
     O                         PTFR                                       S01235
     O*
     O*TRANSLKFE*               TRLINK                                    097069
     O*****LF/TRANS (link)                                                097069
     O***********              LNKR                                       097069
     O***********              TNLU                                       097069
     O*
     OTRSETDF E                DTRSET
     O*    Delete LF/TRSET
     O                         RECI
     O*
     OCLOSTDF E                CLOSTR
     O*    Close Out reversal LF/CLOST
     O                         CORI
     O                         SHPI
     O                         LCD
     O                         CHTP
     O                         TNLU
     O*
     OPOSTNCDFE                CBPSTN
     O*    Customer/Broker  Position
     O                         LOPC
     O                         SOPC
     O                         CUTV
     O                         TOTM
     O                         LOCO
     O                         SOCO
     O*
     OPOSTNKDFE                BKPSTN
     O*    Book  Position
     O                         LOPC
     O                         SOPC
     O                         CUTV
     OPRONOPNFE                #PROUP                                     CFF007
     O                         PNB                                        CFF007
      *                                                                   CFF007
     O        E                #PRREL                                     CFF007
     O/COPY WNCPYSRC,FF0020O001
     O/EJECT
      *                                                                   S01117
      **  THE FOLLOWING ARRAYS ARE CHANGED                                S01117
      *                                                                   S01117
      **  BROKER SETTLEMENT ERROR CODES                                   S01117
      *200 201 202 203 204 205 206 207 220 221 222 223                    S01117
      *224 225 226 227 228 229 230 231 232 234 235                        S01117
      **  CUSTOMER SETTLEMENT ERROR CODES                                 S01117
      *210 211 212 213 214 215 216 217 240 241 242 243                    S01117
      *244 245 246 247 248 249 250 251 252 254 255                        S01117
      *                                                                   S01117
**  CPY@
(c) Finastra International Limited 2001
**  MESSAGES
F3=Exit  F9=Change Action/Market  F12=Previous Screen
F10=Delete
 Invalid Command Key: Press F10 to Delete                                                     CFF007
 Trade Creation in progress
 Trade Amendment in progress
 Trade Deletion in progress
 Transaction Failed:
 Trade has been Updated by Another Workstation
 Linked Trade has been Updated by Another Workstation
F1=Initial  F3=Exit  F9=Change Action/Market  F12=Previous Screen
**  BROKER SETTLEMENT ERROR CODES
 200 201 202 203 204 205 206 207 220 221 222 223
 224 225 226 227 228 229 230 231 232 234 235 236
 237         240 241 242 243                                                                  CFF007
**  CUSTOMER SETTLEMENT ERROR CODES
 210 211 212 213 214 215 216 217 240 241 242 243
 244 245 246 247 248 249 250 251 252 254 255 256
 257 258 259 260 261 262 263                                                                  CFF007
**   ZYDY -YEARS IN DAYS CUMULATIVE,FOUR YEAR SPAN
0366073110961461
**   ZMDY -MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   TABDY/TABNO - SHORTNAMES & DAY NUMBERS
F0S1X2M3U4W5T6
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                       073714
0000001                                                                   073714
0000010                                                                   073714
0000100                                                                   073714
0001000                                                                   073714
0010000                                                                   073714
0100000                                                                   073714
1000000                                                                   073714
** XOT - Array for watch list fields' Opening XML Tags                                        CSD015
<Broker Settlement Account>                                                                   CSD015
<Broker For Account of>                                                                       CSD015
<Broker Counterparty>                                                                         CSD015
<Customer Settlmnt Account>                                                                   CSD015
<Customer For Account of>                                                                     CSD015
<Customer Counterparty>                                                                       CSD015
** XCT - Array for watch list fields' Closing XML Tags                                        CSD015
</Broker Settlement Account>                                                                  CSD015
</Broker For Account of>                                                                      CSD015
</Broker Counterparty>                                                                        CSD015
</Customer Settlmnt Account>                                                                  CSD015
</Customer For Account of>                                                                    CSD015
</Customer Counterparty>                                                                      CSD015
