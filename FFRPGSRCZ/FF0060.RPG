     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Manual closure - main')                       *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Futures and Options Module                           *
     F*                                                               *
     F*  FF0060 - MANUAL CLOSURE MAIN PROGRAM                         *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. AR746662           Date 03May11               *
      *  Prev Amend No. 261141             Date 16Jul09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247517             Date 09May07               *
      *                 CPK027             Date 16Apr07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243826A            Date 25Jan07               *
      *                 241147A            Date 07Nov06               *
      *                 241147             Date 26Oct06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 233679             Date 26Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 215528             Date 21Mar03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 17Jun02               *
      *                 CAS002             Date 14Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CFF007             Date 07Feb01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 126117             Date 20Apr00               *
      *                 140017             Date 20Apr00               *
     F*                 140455             Date 20Apr00               *
     F*                 141747             Date 20Apr00               *
     F*                 136056             Date 20Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
     F*                 CPB001             Date 21Jun99               *
      * Midas DBA 3.01 Patch E ---------------------------------------*
     F*                 170520             Date 19Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CPL002             Date 08Mar99               *
      *                 CAP003             Date 18Aug98               *
      *                 CAC003             Date 25Feb97               *
     F*                 CFF004             Date 13SEP96               *
     F*                 CPM003             DATE 01MAY96               *
     F*                 076714             DATE 08DEC95               *
     F*                 S71062             DATE 08DEC95               *
     F*                 S01457             DATE 04JAN94               *
     F*                 S01456             DATE 08NOV93               *
     F*                 S01455             DATE 05NOV93               *
     F*                 S01411             DATE 05JUL93               *
     F*                 E30419             DATE 16MAR93               *
     F*                 E30416             DATE 16MAR93               *
     F*                 E03643             DATE 19FEB93               *
     F*                 E39121             DATE 15FEB93               *
     F*                 E37652             DATE 15FEB93               *
     F*                 E39280             DATE 15FEB93               *
     F*                 S01393             DATE 30OCT92               *
     F*                 E44985             DATE 25SEP92               *
     F*                 FUJI-FF0011        DATE 10AUG92               *
     F*                 AUS022             DATE 06AUG92               *
     F*                 FO0103             DATE 01MAY91               *
     F*                 S01199             DATE 27FEB90               *
     F*                 S01117             DATE 12FEB90               *
     F*                 E18343             DATE 11NOV89               *
     F*                 S01179             DATE 23/09/88              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  AR746662 - Discrepancy in premium amount in Currency OTC     *
      *             screen and Projected Available Balance Enquiry    *
      *             Applied fix 249171. (Recompile)                   *
      *             (Child: Artf746663)                               *
      *  261141 - Recompiled due to change in FF0060DF display file.  *
      *  247517 - Reversed fix 241147.                                *
      *  CPK027 - Errors in compiling MP1_3_TTTS - recompile over     *
      *           changed FFTVCLZ2.                                   *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  241147A - Use old processing for the computation of p/l.     *
      *  241147 - Recompile.                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  233679 - The number of close out positions to be processed   *
      *           is limited to a max of 80.  "Close out set is too   *
      *           large" appears if selected transactions is > 80.    *
      *           Pgm is amended to disregard the checking to fix     *
      *           the problem.                                        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  215528 - System is associating a wrong premium amount.       *
      *           Recompiled only.                                    *
      *  CPK015 - Conversion of ZYIELD from PLI to RPG.               *
      *           Recompile over changed FFYTOPZ1.                    *
      *  CAS002 - Hedge Strategy/Linkage (Recompile)                  *
      *  CFF007 - Futures and Options Enhancement for Private Banking *
      *  CFF006 - Fractional Ticks Enhancement.                       *
     F*  126117 - Recompiled due to changes to FFYTOPZ1.              *
     F*  140017 - Recompiled due to changes to FFPMCLZ1.              *
     F*  140455 - Recompiled due to changes to FFPMCLZ1.              *
     F*  141747 - Calculated realised P/L as for Unrealised P/L       *
     F*  136056 - Recompiled due to changes in FFYTOPZ1               *
     F*  CPB001 - 'Private Banking' Module                               *
      *  170520 - Recompile over changed TRANSD file                  *
     F*  CPL002 - Midas-Plato Interface (Recompiled)                  *
      *  CAP003 - Conversion of Midas inputs to modular API structure *
      *           (phase 2) - recompiled                              *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*         - Recompiled due to changes in TRANSD.                *
     F*  CFF004 - Increase in size of Price Fields                    *
     F*  CPM003 - FF PM Interface Upgrade to R10.                     *
     F*  076714 - FF/PM INTERFACE                                     *
     F*           FOR NON-PORTFOLIO CUSTOMER BYPASS PORTFOLIO PROC.   *
     F*  S71062 - FF/PM Interface - Manual closure                    *
     F*  S01457 -  Enable Brokers to deal with OTC's.                 *
     F*  S01456 - 'FF' MONTHLY P&L ENHANCEMENTS.                      *
     F*           Recompiled due to change to PF/MKCTLD.              *
     F*  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                      *
     F*           Recompiled due to changes in file TABFF.            *
     F*  S01411 - Recompiled as field 'ORIGINAL ENTRY DATE' added to  *  *
     F*           PF/TRANSD.                                          *  *
     F*  E03643 - Commissions, though calculated correctly on         *
     F*         - a trade basis for accounting purposes are not       *
     F*         - reported correctly by individual closeout.          *
     F*  E30419 - Recompiled due to amendments on subroutine FFPLCL   *
     F*           due to rounding errors and incorrect sign of        *
     F*           profit/loss.                                        *
     F*  E39121 - Records added to CLOSTT and TRANSD after            *
     F*           rolback.                                            *
     F*  E37652 - Manual closeout produces incorrect Profit/Loss on   *
     F*           Futures but an autoclosure produces the correct     *
     F*           results except for the sign +/-. To fix the error,  *
     F*           E39280 was amended such that it is applied to bank  *
     F*           bill futures only. The error on sign was already    *
     F*           fixed by E30419.                                    *
     F*  E30416 - Recompiled due to amendments on subroutines FFPLCL  *
     F*           and FFYTOP                                          *
     F*  E39280 - Realised P/L on SFE traded bank bill options        *
     F*           appears incorrect. To fix the error, the Strike     *
     F*           Price is used instead of the Contract Price in      *
     F*           the Premium/Realised P/L computations.              *
     F*  S01393 - Recompiled for Strategic Risk Management            *
     F*  E44985 - ZYIELD requires 3 new parameters. Recompile only    *
     F* FUJI-FF0011 - The system does not differentiate between       *
     F*               american and european option on exercise        *
     F*               validation and OTC confirmation wording.        *
     F*               *** RECOMPILE ONLY ***                          *
     F*  AUS022 - AUSTRALIAN CHANGE : Introduction of Processing      *
     F*           Types 7 and 8.                                      *
     F*  FO0103 - Error message incorrect                             *
     F*  S01199 -  Help System                                     *
     F*  S01117 - Multibranching                                      *
     F*  E18343 - Program recompiled due to change in ZSRSRC          *
     F*           member ZFRPEDZ3                                     *
     F*  S01179     ****** AS400 CONVERSION ******                    *
     F*     The keyword RTGAID is no longer supported on the AS400    *
     F*     and command keys and indicators have been used to replace *
     F*     this in the display file. To disrupt the structure of the *
     F*     program as little as possible a new subroutine - ASCHGS - *
     F*     has been coded. This moves the values which would have    *
     F*     been passed to the program (via RTGAID) into the AID      *
     F*     field depending on which function key has been pressed.   *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                     *
     F*                                                               *
     F*     IGNDECERR(*NO)                                            *
     F*                                                               *
     F*****************************************************************
     FTABFF   IF  E           K        DISK
     F/COPY WNCPYSRC,FF0060F003
     F* ICD 1     TABTB10F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE
     F**********  TABTB20F                          KIGNORE               CFF007
     F            TABTB40F                          KIGNORE
     F**********  TABTB80F                          KIGNORE               CFF007
     F            TABTE10F                          KIGNORE
     F* CURRENCY  TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F* BRANCH    TABLETRF                          KIGNORE
     F/COPY WNCPYSRC,FF0060F004
     FBOOKD   IF  E           K        DISK
     FCLINT   IF  E           K        DISK
     FMARKT   IF  E           K        DISK
     FMKCTL   IF  E           K        DISK
     FINTYP2  IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYP2DF
     FINTYP   IF  E           K        DISK
     FTRANS   UF  E           K        DISK
     F                                              KCOMIT
     FTRANS9  IF  E           K        DISK
     F            TRANSDF                           KRENAMETRANS9DF
     FPMPORTLLIF  E           K        DISK                           UC  S71062
     FFF0060DFCF  E                    WORKSTN
     F                                        RRN   KSFILE FF0060S0
     F                                              KINFDS FILDS
     FCLOSTD  O   E           K        DISK
     F                                              KCOMIT
     F/COPY WNCPYSRC,FF0060F002
     FCLOSTT  O   E           K        DISK
     F                                              KCOMIT
     F/COPY WNCPYSRC,FF0060F001
     FDEFLT   IF  E           K        DISK                           UC  CFF007
     FACNUM   IF  E           K        DISK                           UC  CFF007
     F*
     F************        FUNCTIONS OF INDICATORS        *************
     F*
     F*                 10            VLDCMDKY FOR DISPLAY FILE           S01179
     F*                                                                   S01179
     F*                 17            MULTIBRANCH INDICATOR IS Y          S01117
     F*                 18            MAKE SURE ERR CODE 305 OCCURS ONLY  S01117
     F*                               ONCE                                S01117
     F*                 19            SPF ERROR ON ORGINATING BRANCH      S01117
     F*                 20            SCREEN ERROR INPUT FIELD
     F*                 21            TEMPORARY ERROR INDICATOR
     F*                 22            SCREEN MESSAGE FIELD
     F*                 23            ERROR IND (INPUT)
     F*
     F**********        26            HELP HAS BEEN PRESSED               S01199
     F*                                                                   S01179
     F*                 30            SUBFILE NOT EMPTY
     F*                 31            ROLLBACK OCCURRED
     F*
     F*                 40            NON DISPLAY OF SUBFILE
     F*                 41            NON DISPLAY OF SBFLCTL & SBFLEND
     F*                 42            CLEAR/ENABLE SUBFILE
     F*
     F*                 50            DATABASE FILE ACCESS ERROR
     F*                                                                   CFF007
     F*   51  - No record found for CHAIN operation                       CFF007
     F*   52  - Database file access error                                CFF007
     F*
     F*                 80-89         USED IN MODULE STANDARD SUBROUTIN
     F*                 90-95         USED IN Z-SUBROUTINES
     F*                 98            DATE FORMAT IS MMMDDYY
     F*
     F*                      U5       F12 HAS BEEN PRESSED
     F*                      U7 U8    DATABASE ERROR
     F*
     F*                      LR       SETON IN PROGRAM END
     F*
     F*****************************************************************
     F/EJECT
     E                    CPY@    1   1 80
     E*****************************************************************
     E*
     E                    ARR        19  4
     E*  ERROR CODES
     E*
     E/COPY ZSRSRC,ZDATE2Z1
     E** SR.ARRAY FOR BOTH ZDATE1 AND ZDATE2
     E*
     E/COPY ZSRSRC,FFPRCSZ2
     E*
     E/COPY ZSRSRC,ZALIGNZ1
     E** SR.ARRAY FOR ZALIGN
     E/COPY ZSRSRC,ZFRPEDZ1
     E** SR.ARRAY FOR ZFRPED
     E*
     E***********         MESSA   1   4 71                                S01117
     E                    MESSA   1   5 71                                S01117
     E*  MESSAGES
     E*
     E*****************************************************************
     E/EJECT
     I*****************************************************************
     I*
     IINTYPDF                                                             AUS022
     I              CTAM                            FFCTAM                AUS022
     I              CNTT                            FFCNTT                AUS022
     IINTYP2DF
     I*
     I              ISTT                            ISTT2
     I              ISTI                            ISTI2
     I              ISPT                            ISPT2
     I              ISCY                            ISCY2
     I              QOTC                            QOTC2
     I              TKDM                            TKDM2
     I              MNPF                            MNPF2
     I              TKVL                            TKVL2
     I              OTHC                            OTHC2
     I*                                                                   CFF007
     ITRANSDF                                                             CFF007
     I              PTFR                            PTFR2                 CFF007
     I*                                                                   CFF007
     ITRANS9DF                                                            CFF007
     I              PTFR                            PTFR2                 CFF007
     I*
     ILDA         DS                            256
     I*
     I**      DATA STRUCTURE FOR DB ERROR HANDLING
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
      **                                                                  S01117
     ISDGELR    E DSSDGELRPD                                              S01117
     I** GENERAL LEDGER DETAILS                                           S01117
     I              BKOBRU                          OBUU                  S01117
     I              BKOBUV                          OBUV                  S01117
     ISDMMOD    E DSSDMMODPD                                              S71062
     I** Modules id's details                                             S71062
     ISDPORT    E DSSDPORTPD                                              S71062
     I** Portfolio ICD                                                    S71062
     I**                                                                  S01117
     I@DSFDY    E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
     IRUNDT       DS                                                      S01117
      **  DATA AREA RUNDAT                                                S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      **                                                                  S01117
     I*
     IICDKY       DS                             12
     I*
     I**      DATA STRUCTURE FOR DB ERROR HANDLING
     I*
     I                                        1   2 ICD1
     I                                        3  10 ICD2
     I                                       11  12 ICD3
     I                                        1  11 ICD4
     I*
     IARRDS       DS
     I*
     I**      DATA STRUCTURE FOR RENAMING ERROR ARRAY AS ONE FIELD
     I*
     I                                        1  78 SERCD
     I                                        1  76 ARR
     I*
     IRINST       DS                              5
     I*
     I**      DATA STRUCTURE FOR LOADING ARRAY WITH TRADED MONTHS FIELD
     I*
     I                                        1   2 SMKT
     I                                        3   5 SINS
     I*
     IFILDS       DS
     I*
     I**      DATA STRUCTURE FOR LOADING ARRAY WITH TRADED MONTHS FIELD
     I*
     I                                      287 288 AID
     I*
     IPSDS       SDS
     I/COPY WNCPYSRC,FF0060I001
     I*
     I**      DATA STRUCTURE FOR WOKSTATION ID FOR SCREEN OUTPUT
     I*
     I                                      244 246 WSID
     I                                      254 263 USRID
     I*                                                                   CFF007
     I** MIDAS Switchable Features Accessed Via Access Program            CFF007
     I*                                                                   CFF007
     ISCSARD    E DSSCSARDPD                                              CFF007
     I*                                                                   CFF007
     I** FF Customer/Broker Details                                       CFF007
     I*                                                                   CFF007
     ISDFOCS    E DSSDFOCSPD                                              CFF007
     I*                                                                   CFF007
     I** Nostro Details                                                   CFF007
     I*                                                                   CFF007
     ISDNOST    E DSSDNOSTPD                                              CFF007
     I              QQACCD                          QQACC1                                    CGL029
     I*                                                                   CFF007
     I** Extended Client Details                                          CFF007
     I*                                                                   CFF007
     ISDCUST    E DSSDCUSTPD                                              CFF007
     I*                                                                   CFF007
     I** Long data structure for access objects                           CFF007
     I*                                                                   CFF007
     I@DSSDY    E DSDSSDY                                                 CFF007
     I*                                                                   CFF007
     I** Very long data structure for access objects                      CFF007
     I*                                                                   CFF007
     I@DSLDY    E DSDSLDY                                                 CFF007
     I*                                                                   S71062
     IWWKEY       DS                                                      S71062
     I*                                                                   S71062
     I**      DATA STRUCTURE FOR ACCESS TO PMPORTPD                       S71062
     I*                                                                   S71062
     I**********                              1   60PMCUS                              S71062 CSD027
     I                                        1   6 PMCUS                                     CSD027
     I                                        7  10 WWTFR                 S71062
     I/COPY WNCPYSRC,FF0060I002
     I            DS                                                      CFF007
     I**********                              1  15 STTA                               CFF007 CGL029
     I                                        1  21 STTA                                      CGL029
     I                                        1   6 WCNUM                 CFF007
     I                                        7   9 WCCY                  CFF007
     I                                       10  19 WACOD                                     CGL029
     I                                       20  21 WACSQ                                     CGL029
     I**********                             10  13 WACOD                              CFF007 CGL029
     I**********                             14  15 WACSQ                              CFF007 CGL029
     I*
     I/COPY ZSRSRC,FFSRDSZ1
     I*
     I/COPY ZSRSRC,ZFRPEDZ2
     I*
     I/COPY ZSRSRC,FFPRCSZ3
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I**   DATA AREA FOR NEXT AVAILABLE TRANSACTION NUMBER
     I*
     IDNACON      DS                              6
     I                                        1   60FCLON
     I*
     I*****************************************************************
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I/COPY ZSRSRC,ZYLDZ1                                                 AUS022
     C/EJECT
     C*****************************************************************
     C*
     C**   MAIN BODY OF PROGRAM
     C*
     C*****************************************************************
     C                     EXSR START
     C                     EXSR MIDDLE
     C                     EXSR END
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**                 INDEX OF SUB-ROUTINES
     C*
     C*****************************************************************
     C*
     C**         1. START   - INTIALLISATION, ACCESSING ICD FILES
     C**         2. MIDDLE  - SCREEN PROCESSING
     C**         3. END     - ENDS PROGRAM
     C**         4. HEADNG  - PROCESSING FOR HEADINGS
     C**         5. ENTER   - VALIDATION OF SCREEN
     C**       5.5. ORGV    - VALIDATION OF ORGINATION BRANCH             S01117
     C**         6. CLOSE   - CREATE CLOSE OUT SET
     C**         7. CLODET  - CLOSE OUT DETAIL RECORD
     C**         8. NEXCLO  - GET NEXT CLOSE OUT NUMBER FROM NACON
     C********** 9. HELP    - CALLS HELP TEXT PROGRAM                     S01199
     C**        10. ZDATE1  - VALIDATE & CONVERT DATE TO DAY NUMBER
     C**        11. ZDATE2  - CONVERT DAY NUMBER TO DATE FORMAT
     C**        12. FFPRCS  - CONVERT FILE PRICE TO SCREEN FORMAT
     C**        13. ZALIGN  - VALIDATE & RIGHT ALIGN NUMERIC FIELD
     C**        14. ZFRPED  - EDIT AMOUNT FOR REPORT FORMAT
     C**        15. FFTVCL  - CALCULATE TRANSACTION VALUE
     C**        16. ZTNLU1  - GET NEXT TRANSACTION NUMBER FROM MNATN
     C**        17. ERR     - DATABASE ERROR HANDLING
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   START SUB ROUITNE - ACCESS ICD FILES
     C**                        CALLED BY - MAIN BODY
     C**                        CALLS S/R - ERR, ZDATE2, FFPRCS, HEADNG
     C**                                    HELP, ERR, ENTER.
     C*
     C*****************************************************************
     C*
     C           START     BEGSR
     C*                                                                   S71062
     C           PMKEY     KLIST                                          S71062
     C                     KFLD           PMCUS                           S71062
     C                     KFLD           WWTFR                           S71062
     C/COPY WNCPYSRC,FF0060C010
     C*                                                                   CFF007
     C** Key access fields for LF/DEFLT                                   CFF007
     C*                                                                   CFF007
     C           KDEFLT    KLIST                                          CFF007
     C**********           KFLD           KCBCD   60                                   CFF007 CSD027
     C                     KFLD           KCBCD   6                                           CSD027
     C                     KFLD           KMRKT   2                       CFF007
     C                     KFLD           KISTC   3                       CFF007
     C*
     C**   BLANK OUT DBKEY IN CASE OF DATABASE ERROR
     C**   RESET LDA
     C*
     C***********          MOVE *BLANKS   DBLOT                           S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL*BLANK    DBFILE                          S01117
     C                     MOVEL*BLANK    DBKEY                           S01117
     C                     MOVE 'FF0060  'DBPGM
     C                     Z-ADD*ZEROS    DBASE                           S01117
     C                     OUT  LDA                                       S01117
     C**                                                                  S01117
      *
      ** Check to see if the switchable feature is present.
      *
     C                     MOVE 'N'       S01457  1                       S01457
     C                     CALL 'AOSARDR0'                                S01457
     C                     PARM '       ' @RTCD   7                       S01457
     C                     PARM '*VERIFY' @OPTN   7                       S01457
     C                     PARM 'S01457 ' @SARD   6                       S01457
      *                                                                   S01457
     C           @RTCD     IFEQ *BLANKS                                   S01457
     C                     MOVE 'Y'       S01457                          S01457
     C                     ENDIF                                          S01457
      *                                                                   CFF006
      ** Check to see if the switchable feature CFF006 is present.        CFF006
      *                                                                   CFF006
     C                     CALL 'AOSARDR0'                                CFF006
     C                     PARM '       ' @RTCD                           CFF006
     C                     PARM '*VERIFY' @OPTN                           CFF006
     C                     PARM 'CFF006 ' @SARD                           CFF006
      *                                                                   CFF006
     C           @RTCD     IFNE *BLANK                                    CFF006
     C           @RTCD     ANDNE'*NRF   '                                 CFF006
     C           *LOCK     IN   LDA                                       CFF006
     C                     Z-ADD16        DBASE                           CFF006
     C                     MOVE 'SCSARDPD'DBFILE                          CFF006
     C                     MOVEL@OPTN     DBKEY                           CFF006
     C                     MOVEL@OPTN     DBOPTN                          CFF006
     C                     EXSR ERR                                       CFF006
     C                     ELSE                                           CFF006
      *                                                                   CFF006
     C           @RTCD     IFEQ *BLANKS                                   CFF006
     C                     MOVE 'Y'       CFF006  1                       CFF006
     C                     ELSE                                           CFF006
     C                     MOVE 'N'       CFF006                          CFF006
     C                     ENDIF                                          CFF006
     C                     ENDIF                                          CFF006
      *                                                                   CFF007
      ** Check if switchable feature CFF007 is installed                  CFF007
      *                                                                   CFF007
     C                     CALL 'AOSARDR0'                                CFF007
     C                     PARM '       ' @RTCD                           CFF007
     C                     PARM '*VERIFY' @OPTN                           CFF007
     C                     PARM 'CFF007'  @SARD                           CFF007
     C           SCSARD    PARM SCSARD    @DSSDY                          CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           @RTCD     ANDNE'*NRF   '                                 CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD17        DBASE                           CFF007
     C                     MOVE 'SCSARDPD'DBFILE                          CFF007
     C                     MOVEL@SARD     DBKEY                           CFF007
     C                     MOVEL@OPTN     DBOPTN                          CFF007
     C                     EXSR ERR                                       CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'Y'       CFF007  1                       CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CFF007                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   S01457
     C**********           CALL 'AOGELRR0'                                             S01117 CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C********** SDGELR    PARM SDGELR    @DSFDY                                       S01117 CGL029
     C           SDGELR    PARM SDGELR    @DSSDY                                              CGL029
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD01        DBASE            ** DBERR  01 **S01117
     C                     MOVE 'SDGELRPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     EXSR ERR                                       S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     MOVE *BLANKS   ICDKY
     C*
     C                     MOVE '000000'  OFF     6
     C                     Z-ADD1         RRN     40
     C                     Z-ADDRRN       TRRN
     C*
     C************LIKE     DEFN BRCD      PBRCD                           S01117
     C           *LIKE     DEFN BRCA      PBRCD                           S01117
     C           *LIKE     DEFN ISTT      PINST
     C           *LIKE     DEFN CLON      NCLON
     C           *LIKE     DEFN TNLU      NTNLU
     C           *LIKE     DEFN ISTT      KINST
     C           *LIKE     DEFN YRNO      PYR
     C           *LIKE     DEFN MTHN      PMN
     C           *LIKE     DEFN PCAL      PPTCL
     C           *LIKE     DEFN STRP      PSTPR
     C           *LIKE     DEFN BOCO      PBRK
     C           *LIKE     DEFN CUSC      PCUS
     C           *LIKE     DEFN BOKC      PBOK
     C           *LIKE     DEFN MRKT      PMKT
     C           *LIKE     DEFN FCIN      BPUIND
     C************LIKE     DEFN FFTNVL    TRANSV                          AUS022
     C           *LIKE     DEFN FCLON     WORK60
     C           *LIKE     DEFN FCLON     CLON2
     C************LIKE     DEFN TKVL      FFTKVL                   AUS022 141747
     C************LIKE     DEFN YIELDX    FFYLD                    AUS022 141747
     C*
     C**   SET UP PARAMETERS
     C*
     C           *ENTRY    PLIST
     C                     PARM           PBRCD
     C                     PARM           PINST
     C                     PARM           PYR
     C                     PARM           PMN
     C                     PARM           PPTCL
     C                     PARM           PSTPR
     C                     PARM           PBRK
     C                     PARM           PCUS
     C                     PARM           PBOK
     C                     PARM           PMKT
     C                     PARM           BPUIND
     C                     PARM           PPTFR   4                       S71062
     C*                                                                   S71062
     C                     MOVELPPTFR     WWTFR   4                       S71062
     C*                                                                   S71062
     C**   Read SDMMODL1 to verify if Portfolio Management is present     S71062
     C*                                                                   S71062
     C                     CALL 'AOMMODR0'                                S71062
     C                     PARM *BLANKS   @RTCD   7                       S71062
     C                     PARM '*FIRST ' @OPTN   7                       S71062
     C           SDMMOD    PARM SDMMOD    @DSFDY                          S71062
     C           @RTCD     IFNE *BLANKS                                   S71062
     C           *LOCK     IN   LDA                                       S71062
     C                     MOVE *BLANKS   DBKEY                           S71062
     C                     MOVE 'SDMMODPD'DBFILE                          S71062
     C                     Z-ADD13        DBASE                           S71062
     C                     EXSR ERR                                       S71062
     C                     END                                            S71062
     C*                                                                   S71062
     C**   If Portfolio Management is present, access Portfolio ICD to    S71062
     C**   retrieve "the reference attached to 9997 portfolio"            S71062
     C*                                                                   S71062
     C           BGPFMG    IFEQ 'Y'                                       S71062
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   S71062
     C                     OPEN PMPORTLL                                  S71062
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPORTR0'                                S71062
     C                     PARM *BLANKS   @RTCD                           S71062
     C                     PARM '*FIRST ' @OPTN                           S71062
     C           SDPORT    PARM SDPORT    @DSFDY                          S71062
     C           @RTCD     IFNE *BLANKS                                   S71062
     C           *LOCK     IN   LDA                                       S71062
     C                     MOVE *BLANKS   DBKEY                           S71062
     C                     MOVE 'SDPORTPD'DBFILE                          S71062
     C                     Z-ADD14        DBASE                           S71062
     C                     EXSR ERR                                       S71062
     C                     END                                            S71062
     C                     ENDIF                                          CPB001
     C*                                                                   S71062
     C                     END                                            S71062
     C*
     C**  BROKER & CUSTOMER SET TO -1 IN FF0050 SO THAT
     C**  IN FFC0230 OPNQRYF SCANS FOR ZERO BROKER & CUSTOMER
     C*
     C***********PBRK      IFEQ -1                                                            CSD027
     C***********          Z-ADD*ZERO     PBRK                                                CSD027
     C           PBRK      IFEQ '******'                                                      CSD027
     C                     MOVE *BLANKS   PBRK                                                CSD027
     C                     END
     C*
     C***********PCUS      IFEQ -1                                                            CSD027
     C***********          Z-ADD*ZERO     PCUS                                                CSD027
     C           PCUS      IFEQ '******'                                                      CSD027
     C                     MOVE *BLANKS   PCUS                                                CSD027
     C                     END
     C***********                                                         S01117
     C*****SETUP*KEY*FOR*TABTB10******************************************S01117
     C***********                                                         S01117
     C***********          MOVEL'01'      ICD1                            S01117
     C***********          MOVEL'10'      ICD3                            S01117
     C***********                                                         S01117
     C*****ACCESS*TABTB10*FOR*RUN*DATE*AND*DEFAULT*BRANCH*CODE************S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 50               S01117
     C***********                                                         S01117
     C*****CHECK*THAT*INSTALLATION*CONTROL*DATA*PRESENT*******************S01117
     C*****IF*NOT*THEN*DATABASE*ERROR*************************************S01117
     C***********                                                         S01117
     C************IN50     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                        ***DBERR 01*** S01117
     C***********                                                         S01117
     C********SET*UP*DATABASE*ERROR***************************************S01117
     C***********                                                         S01117
     C************NAMVAR   DEFN           LDA                             S01117
     C************LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABFF'   DBFILE                          S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C***********          MOVE '01'      DBASE                           S01117
     C***********          EXSR ERR                                       S01117
     C***********          END                                            S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     17                   S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C*
     C                     SETON                     404142
     C                     WRITEFF0060C0
     C                     SETOF                     404142
     C*
     C**   FIND DATE FORMAT REQUIRED
     C*
     C           DATF      COMP 'M'                      98
     C*
     C**   SET HEADINGS FOR SCREEN DISPLAY
     C*
     C                     EXSR HEADNG
     C*
     C**   ACCESS LF/TRANS9 FOR SUBFILE LOAD
     C*
     C                     READ TRANS9                   50
     C*
     C           *IN50     DOWNE'1'
     C           RECI      IFEQ 'D'
     C*
     C** BROKER ONLY SELECTED - CHECK NUMBER OF BROKER OPEN CONTRACTS
     C*
     C***********PCUS      IFEQ *ZERO                                                         CSD027
     C           PCUS      IFEQ *BLANKS                                                       CSD027
     C           PBOK      ANDEQ*BLANKS
     C           NOBO      ANDNE*ZEROS
     C*
     C** OTHERWISE CUST/BOOK - CHECK NUMBER OF CUST/BOOK OPEN CONTRACTS
     C*
     C***********PCUS      ORNE *ZEROS                                                        CSD027
     C           PCUS      ORNE *BLANKS                                                       CSD027
     C           NOCO      ANDNE*ZEROS
     C*
     C           PBOK      ORNE *BLANKS
     C           NOCO      ANDNE*ZEROS
     C*
     C/COPY WNCPYSRC,FF0060C001
     C                     Z-ADDTRSD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    STRSD
     C*
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SCOPR
     C*
     C***********PCUS      IFEQ *ZERO                                                         CSD027
     C           PCUS      IFEQ *BLANKS                                                       CSD027
     C           PBOK      ANDEQ*BLANKS
     C*
     C                     Z-ADDNOBO      SNOCT
     C*
     C                     ELSE
     C*
     C                     Z-ADDNOCO      SNOCT
     C*
     C                     END
     C*
     C***** SAVE THE ORGINATING BRANCH OF THE TRANS RECORD                S01117
     C                     MOVE ORBR      SORBR                           S01117
     C                     WRITEFF0060S0
     C                     ADD  1         RRN
     C                     SETON                     30
     C*
     C/COPY WNCPYSRC,FF0060C002
     C                     END
     C*
     C                     END
     C*
     C                     READ TRANS9                   50
     C*
     C                     END
     C*
     C/COPY WNCPYSRC,FF0060C003
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   SUB-ROUTINE MIDDLE - MAIN PROCESSING -SCREEN, VALIDATION
     C**                        CALLED BY - MAIN BODY
     C**                        CALLS SR  - HELP, ERR, ENTER.
     C*
     C*****************************************************************
     C*
     C           MIDDLE    BEGSR
     C*
     C                     WRITEFF0060F0
     C*
     C**   IF - SUBFILE EMPTY PUT OUT SCREEN PLUS ERROR MESSAGE
     C*
     C           *IN30     IFNE '1'
     C*
     C                     MOVELMESSA,3   MESS
     C                     SETON                     4022
     C                     EXFMTFF0060C0
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C**********                                                          S01179
     C*****DOW*HELP KEY PRESSED                                           S01199
     C**********                                                          S01199
     C********** AID       DOWEQ'HP'                                      S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ FF0060DF                 50               S01199
     C**********           END                                            S01199
     C*
     C**   ELSE - SUBFILE NOT EMPTY
     C*
     C                     ELSE
     C*
     C           AID       DOWNE'01'
     C           AID       ANDNE'05'
     C*
     C                     EXFMTFF0060C0
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C**********                                                          S01179
     C*****DOW*HELP KEY PRESSED                                           S01199
     C**********                                                          S01199
     C********** AID       DOWEQ'HP'                                      S01199
     C**********           EXSR HELP                                      S01199
     C**********           READ FF0060DF                 50               S01199
     C**********           END                                            S01199
     C*
     C**   IF - ENTER WAS PRESSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C**   VALIDATE SUBFILE INPUT
     C*
     C                     EXSR ENTER
     C*
     C**   END IF - ENTER WAS PRESSED
     C*
     C                     END
     C*
     C**   END DOW - NOT F3 & NOT F12
     C*
     C                     END
     C*
     C                     END
     C*
     C**   END MIDDLE
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   SUB-ROUTINE END - ENDS PROGRAM
     C**                        CALLED BY - MAIN BODY, CLOSE.
     C*
     C*****************************************************************
     C*
     C           END       BEGSR
     C*
     C**   HAS F3 BEEN PRESSED
     C*
     C           AID       IFEQ '01'
     C*
     C                     SETON                     U1
     C*
     C                     END
     C*
     C                     SETON                     LR
     C                     RETRN
     C*
     C**   END SUB-ROUTINE END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   SUB-ROUTINE HEADNG - PROCESS HEADINGS AND DETAILS FOR SCREEN
     C**                        CALLED BY - START
     C**                        CALLS S/R - ERR, FFPRCS.
     C*
     C*****************************************************************
     C*
     C           HEADNG    BEGSR
     C*
     C**   SETUP KEY FOR TABLETR
     C*
     C                     MOVE *BLANKS   ICDKY
     C                     MOVEL'10'      ICD1
     C                     MOVE PBRCD     ICDKY
     C*
     C**   ACCESS TABTB10 FOR RUN DATE AND DEFAULT BRANCH CODE
     C*
     C           ICDKY     CHAINTABLETRF             50
     C*
     C*    DOES ENTERED BRANCH EXIST
     C*
     C           *IN50     IFEQ '1'
     C           RECI      ORNE 'D'                        ***DBERR 02***
     C*
     C**      SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVELICDKY     DBKEY
     C***********          MOVE '02'      DBASE                           S01117
     C                     Z-ADD2         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C/COPY WNCPYSRC,FF0060C011
     C*                                                                   CFF007
     C** Access TABTB20                                                   CFF007
     C*                                                                   CFF007
     C                     MOVE *BLANKS   ICDKY                           CFF007
     C                     MOVEL'01'      ICDKY                           CFF007
     C                     MOVE '20'      ICDKY                           CFF007
     C           ICDKY     CHAINTABTB20F             51                   CFF007
     C*                                                                   CFF007
     C** Record not found OR no valid record                              CFF007
     C*                                                                   CFF007
     C           *IN51     IFEQ '1'                                       CFF007
     C           RECI      ORNE 'D'                                       CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD23        DBASE            ************   CFF007
     C                     MOVE 'TABFF'   DBFILE           *DB ERR 023*   CFF007
     C                     MOVELICDKY     DBKEY            ************   CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Access TABTB80                                                   CFF007
     C*                                                                   CFF007
     C                     MOVE *BLANKS   ICDKY                           CFF007
     C                     MOVEL'01'      ICDKY                           CFF007
     C                     MOVE '80'      ICDKY                           CFF007
     C           ICDKY     CHAINTABTB80F             51                   CFF007
     C*                                                                   CFF007
     C** Record not found OR no valid record                              CFF007
     C*                                                                   CFF007
     C           *IN51     IFEQ '1'                                       CFF007
     C           RECI      ORNE 'D'                                       CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD24        DBASE            ************   CFF007
     C                     MOVE 'TABFF'   DBFILE           *DB ERR 024*   CFF007
     C                     MOVELICDKY     DBKEY            ************   CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C           PMKT      IFNE *BLANKS                                ***
     C*
     C           PMKT      CHAINMARKT                50
     C*
     C**   IF NO VALID RECORD THEN ERROR
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 03 ***
     C           RECI      ORNE 'D'
     C*
     C**      SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'MARKT'   DBFILE
     C                     MOVELPMKT      DBKEY
     C***********          MOVE '03'      DBASE                           S01117
     C                     Z-ADD3         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C           PMKT      CHAINMKCTL                50
     C*
     C**   IF NO VALID RECORD THEN DBERROR
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 04 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'MKCTL'   DBFILE
     C                     MOVELPMKT      DBKEY
     C***********          MOVE '04'      DBASE                           S01117
     C                     Z-ADD4         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     END
     C*
     C**   ACCESS LF/INTYP WITH INSTRUMENT CODE
     C*
     C           PINST     CHAININTYP                50
     C*
     C**   IF NO VALID RECORD FOUND
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 05 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELPINST     DBKEY
     C***********          MOVE '05'      DBASE                           S01117
     C                     Z-ADD5         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*                                                                   AUS022
     C*   IF ISPT IS IN RANGE 1-6, SET CONTRACT TYPE = 0; ELSE            AUS022
     C*   (ISPT = 7,8), THEN CONTRACT TYPE IS SAME AS FROM LF/INTYP       AUS022
     C*                                                                   AUS022
     C           ISPT      IFLE 6                                         AUS022
     C                     Z-ADD0         FFCNTT                          AUS022
     C                     END                                            AUS022
     C*
     C**   SETUP KEY FOR TABTG10
     C*
     C                     MOVE *BLANKS   ICDKY
     C                     MOVEL'20'      ICD1
     C                     MOVE ISCY      ICD4
     C                     MOVE 1         ICDKY
     C*
     C**   ACCESS TABTG10 FOR CURRENCY DECIMAL PLACES
     C*
     C           ICDKY     CHAINTABTG10F             50
     C*
     C*    CHECK THAT INSTALLATION CONTROL DATA PRESENT
     C*    IF NOT THEN DATABASE ERROR
     C*
     C           *IN50     IFEQ '1'
     C           RECI      ORNE 'D'                        ***DBERR 06***
     C*
     C**      SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVELICDKY     DBKEY
     C                     Z-ADD6         DBASE                           S01117
     C***********          MOVE '06'      DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C**   IF - INSTRUMENT A MARKET INSTRUMENT
     C*
     C           ISTI      IFEQ 'N'
     C*
     C                     MOVELPMKT      KINST
     C                     MOVE FTRF      KINST
     C*
     C**   IF - INSTRUMENT IS NOT AN OPTION
     C*
     C***********ISPT      IFGE 4                                         AUS022
     C***********ISPT      ANDLE6                                         AUS022
     C           ISPT      IFGT 3                                         AUS022
     C           ISPT      ANDNE7                                         AUS022
     C*
     C           KINST     CHAININTYP2               50
     C*
     C**   IF NO VALID RECORD THEN DBERROR
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 07 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELKINST     DBKEY
     C***********          MOVE '07'      DBASE                           S01117
     C                     Z-ADD7         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C*
     C**   END IF - AN OPTION
     C*
     C                     END
     C*
     C                     MOVE PYR       SYR
     C                     Z-ADD0         X       10
     C                     MOVE ZMNM,PMN  SMN
     C*
     C**   ELSE - NOT A MARKET INSTRUMENT
     C*
     C                     ELSE
     C*
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C*
     C                     MOVE *BLANKS   SYR
     C                     MOVE *BLANKS   SMN
     C*
     C**   END IF/ELSE - MARKET INSTRUMENT
     C*
     C                     END
     C*
     C**   IF - INSTRUMENT IS AN OPTION
     C*
     C***********ISPT      IFGE 4                                         AUS022
     C***********ISPT      ANDLE6                                         AUS022
     C           ISPT      IFGT 3                                         AUS022
     C           ISPT      ANDNE7                                         AUS022
     C*
     C                     Z-ADDPSTPR     FFPRIC
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    SSTPR
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANKS   SSTPR
     C*
     C                     END
     C*
     C                     MOVE PPTCL     SPTCL
     C*
     C**   IF - BROKER ZERO
     C*
     C***********PBRK      IFEQ *ZEROS                                                        CSD027
     C           PBRK      IFEQ *BLANKS                                                       CSD027
     C*
     C           S01457    IFEQ 'Y'                                       S01457
     C                     MOVEL'C''     'SNARR1                          S01457
     C                     MOVE 'party '  SNARR1                          S01457
     C                     ELSE                                           S01457
     C                     MOVEL'Customer'SNARR1
     C                     ENDIF                                          S01457
      *                                                                   S01457
     C                     MOVEL'Book'    SNARR2
     C*
     C           PCUS      CHAINCLINT                50
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 08 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELPCUS      DBKEY
     C***********          MOVE '08'      DBASE                           S01117
     C                     Z-ADD8         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     MOVELCRNM      SDETL1
     C*
     C           PBOK      CHAINBOOKD                50
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 09 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'BOOKD'   DBFILE
     C                     MOVELPBOK      DBKEY
     C***********          MOVE '09'      DBASE                           S01117
     C                     Z-ADD9         DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     MOVELBOKD      SDETL2
     C*
     C                     ELSE
     C*
     C                     MOVEL'Broker'  SNARR1
     C*
     C           PBRK      CHAINCLINT                50
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 10 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELPBRK      DBKEY
     C***********          MOVE '10'      DBASE                           S01117
     C                     Z-ADD10        DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     MOVELCRNM      SDETL1
     C*
     C**   IF - CUSTOMER NOT ZERO
     C*
     C***********PCUS      IFNE *ZEROS                                                        CSD027
     C           PCUS      IFNE *BLANKS                                                       CSD027
     C*
     C                     MOVEL'Customer'SNARR2
     C*
     C           PCUS      CHAINCLINT                50
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 11 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELPCUS      DBKEY
     C***********          MOVE '11'      DBASE                           S01117
     C                     Z-ADD11        DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     MOVELCRNM      SDETL2
     C*
     C                     END
     C*
     C**   IF - BOOK NOT BLANK
     C*
     C           PBOK      IFNE *BLANK
     C                     MOVEL'Book'    SNARR2
     C*
     C           PBOK      CHAINBOOKD                50
     C*
     C           *IN50     IFEQ '1'                        ***DBERR 12 ***
     C           RECI      ORNE 'D'
     C*
     C*       SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA
     C                     MOVE 'BOOKD'   DBFILE
     C                     MOVELPBOK      DBKEY
     C***********          MOVE '12'      DBASE                           S01117
     C                     Z-ADD12        DBASE                           S01117
     C                     EXSR ERR
     C                     END
     C*
     C                     MOVELBOKD      SDETL2
     C*
     C                     END
     C*
     C                     END
     C*                                                                   S71062
     C**     DISPLAY PORTFOLIO ONLY IF PM IS ON AND IF THE CUST. APPEAR   S71062
     C**     ON THE SCREEN                                                S71062
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C*                                                                   S71062
     C           BGPFMG    IFEQ 'Y'                        *B1            S71062
     C           FCPORS    ANDNE'B'                                       CPM003
     C           WWTFR     ANDNE*BLANKS                                   076714
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WWTFR     ANDNE*BLANKS                                   CPB001
     C*                                                                   S71062
     C           SNARR1    IFEQ 'Customer'                 **B2           S71062
     C           SNARR2    OREQ 'Customer'                                S71062
     C*                                                                   S71062
     C                     MOVEL'Portfoli'WNARR3  9                       S71062
     C                     MOVE 'o'       WNARR3                          S71062
     C                     MOVELWNARR3    SNARR3                          S71062
     C*                                                                   S71062
     C           WWTFR     IFEQ '9997'                     ***B3          S71062
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELFCR997    SDETL3    P                     S71062
     C                     ELSE                            ***X3          S71062
     C*                                                                   S71062
     C***********          Z-ADDPCUS      PMCUS   60                      S71062              CSD027
     C                     MOVELPCUS      PMCUS                           S71062              CSD027
     C           PMKEY     CHAINPMPORTLL             50    ***DBERR 15*** S71062
     C*                                                                   S71062
      ** Record not found, process database error                         S71062
     C*                                                                   S71062
     C           *IN50     IFEQ '1'                        ****B4         S71062
     C           *LOCK     IN   LDA                                       S71062
     C                     MOVE 'PMPORTLL'DBFILE                          S71062
     C                     MOVELWWKEY     DBKEY                           S71062
     C                     Z-ADD15        DBASE                           S71062
     C                     EXSR ERR                                       S71062
     C                     ELSE                            ****X4         S71062
     C                     MOVELPNPTFN    SDETL3    P                     S71062
     C                     END                             ***X4          S71062
     C                     END                             **X3           S71062
     C*                                                                   S71062
     C**      DISPLAY NARRATIVE IN THE CORRECT ORDER                      S71062
     C                     MOVELSNARR1    WWNAR1  9 P                     S71062
     C                     MOVELSDETL1    WWDET1 20 P                     S71062
     C                     MOVELSNARR2    WWNAR2  9 P                     S71062
     C                     MOVELSDETL2    WWDET2 20 P                     S71062
     C                     MOVELSNARR3    WWNAR3  9 P                     S71062
     C                     MOVELSDETL3    WWDET3 20 P                     S71062
     C           SNARR1    IFEQ 'Customer'                 ***B3          S71062
     C                     MOVELWWNAR1    SNARR3    P                     S71062
     C                     MOVELWWDET1    SDETL3    P                     S71062
     C                     MOVELWWNAR3    SNARR1    P                     S71062
     C                     MOVELWWDET3    SDETL1    P                     S71062
     C                     END                             ***E3          S71062
     C           SNARR2    IFEQ 'Customer'                 ***B3          S71062
     C                     MOVELWWNAR1    SNARR3    P                     S71062
     C                     MOVELWWDET1    SDETL3    P                     S71062
     C                     MOVELWWNAR2    SNARR1    P                     S71062
     C                     MOVELWWDET2    SDETL1    P                     S71062
     C                     MOVELWWNAR3    SNARR2    P                     S71062
     C                     MOVELWWDET3    SDETL2    P                     S71062
     C                     END                             ***E3          S71062
     C                     END                             **E2           S71062
     C*                                                                   S71062
     C**      MODULE PM IS OFF                                            S71062
     C                     ELSE                            *X1            S71062
     C                     MOVEL*BLANKS   SNARR3                          S71062
     C                     MOVEL*BLANKS   SDETL3                          S71062
     C                     END                             *E1            S71062
     C*
     C**   END HEADNG - PROCESSING FOR SCREEN HEADINGS
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   SUB-ROUTINE ENTER- PROCESSING FOLLOWING 'ENTER'
     C**                        CALLED BY - MIDDLE
     C**                        CALLS SR  - ZALIGN, CLOSE.
     C*
     C*****************************************************************
     C*
     C           ENTER     BEGSR
     C*
     C                     MOVE *BLANKS   MESS
     C                     MOVEAOFF       *IN,20
     C                     Z-ADD0         X       10
     C                     Z-ADD1         TRRN
     C                     MOVE *BLANKS   ARR
     C                     Z-ADD*ZEROS    PURCHS
     C                     Z-ADD*ZEROS    SALES
     C*
     C                     Z-ADD*ZEROS    COUNT   50
     C*
     C                     READCFF0060S0                 50
     C*
     C           *IN50     DOWNE'1'
     C*                                                                   S01117
     C           SCLOS     IFNE *BLANKS                                   S01117
     C                     MOVE '0'       *IN19                           S01117
     C                     EXSR ORGV                       SPF CHECK      S01117
     C           *IN19     IFEQ '1'                                       S01117
     C                     SETON                     2023                 S01117
     C                     Z-ADDRRN       TRRN                            S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C**   IF - NUMBER OF CONTRACTS TO CLOSE IS NOT BLANK
     C*
     C           SCLOS     IFNE *BLANKS
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCLOS     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD5         ZADIG
     C*
     C                     EXSR ZALIGN
     C*
     C**   IF - NUMBER OF CONTRACTS TO CLOSE IS NUMERIC VALUE
     C*
     C           *IN99     IFEQ '1'
     C*
     C           *IN24     IFNE '1'
     C           *IN25     ANDNE'1'
     C           *IN19     ANDNE'1'                                       S01117
     C                     Z-ADDRRN       TRRN
     C                     END
     C*
     C**   SETON TEMP ERROR INDICATOR & MOVE ERROR CODE TO ARRAY
     C*
     C                     SETON                     2023
     C*
     C           *IN24     IFNE '1'
     C*
     C           X         ADD  1         X
     C                     MOVE '201'     ARR,X
     C                     SETON                     24
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C                     MOVE ZFIELD    NCLOS   60
     C*
     C           NCLOS     IFGT SNOCT
     C*
     C           *IN20     IFNE '1'
     C           *IN25     ANDNE'1'
     C           *IN19     ANDNE'1'                                       S01117
     C                     Z-ADDRRN       TRRN
     C                     END
     C*
     C**   SETON TEMP ERROR INDICATOR & MOVE ERROR CODE TO ARRAY
     C*
     C                     SETON                     2023
     C*
     C           *IN25     IFNE '1'
     C*
     C           X         ADD  1         X
     C                     MOVE '202'     ARR,X
     C                     SETON                     25
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C**   ADD TO THE RUNNING TOTALS
     C*
     C                     ADD  1         COUNT
     C*
     C           TRTY      IFEQ 'P'
     C                     ADD  NCLOS     PURCHS 150
     C*
     C                     ELSE
     C                     ADD  NCLOS     SALES  150
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     UPDATFF0060S0
     C                     SETOF                     20
     C*
     C                     READCFF0060S0                 50
     C*
     C                     END
     C*
     C*
     C           *IN23     IFNE '1'
     C*
     C           SALES     IFEQ *ZEROS
     C           PURCHS    ANDEQ*ZEROS
     C*
     C                     MOVELMESSA,1   MESS
     C                     Z-ADD1         TRRN
     C                     SETON                       22
     C*
     C                     ELSE
     C*
     C********** COUNT     IFGT 80                                                            233679
     C*
     C**********           MOVELMESSA,4   MESS                                                233679
     C**********           SETON                       22                                     233679
     C**********           Z-ADD1         TRRN                                                233679
     C*
     C**********           ELSE                                                               233679
     C*
     C           SALES     IFNE PURCHS
     C*
     C                     MOVELMESSA,2   MESS
     C                     SETON                       22
     C                     Z-ADD1         TRRN
     C*
     C                     ELSE
     C*
     C                     MOVEAOFF       *IN,20
     C                     SETON                     40
     C                     Z-ADDSALES     NCLOS
     C*
     C                     WRITEFF0060C0
     C/COPY WNCPYSRC,FF0060C004
     C                     EXFMTFF0060F1
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C/COPY WNCPYSRC,FF0060C005
     C           AID       IFEQ 'RA'
     C                     EXSR CLOSE
     C                     END
     C/COPY WNCPYSRC,FF0060C006
     C*
     C                     END
     C*
     C**********           END                                                                233679
     C*
     C                     END
     C*
     C                     END
     C*
     C**   END ENTER - PROCESSING FOR ENTER (VALIDATION OF SUBFILE)
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01117
     C**   SUB-ROUTINE ORGV  - VALIDATION OF ORGINATING BRANCH            S01117
     C**                      CALLED BY - ENTER                           S01117
     C**                      CALLS SR - NIL                              S01117
     C*****************************************************************   S01117
     C           ORGV      BEGSR                                          S01117
      *                                                                   S01117
      **  ONLY VALIDATED VS USER IF 'ORIG BR/USER VALIDATION' = Y         S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                        *B1            S01117
     C           OBUU      ANDEQ'Y'                        ORG BRCA USED  S01117
     C*                                                                   S01117
     C           OBUV      IFEQ 'Y'                        *B2            S01117
     C                     CALL 'ZVOBU'                    ORG BRCA CHECK S01117
     C                     PARM SORBR     @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                      *B3            S01117
     C                     SETON                     19                   S01117
     C*                                                                   S01117
     C                     MOVELMESSA,5   MESS                            S01117
     C                     SETON                       22                 S01117
     C*                                                                   S01117
     C                     END                             *E3            S01117
     C                     END                             *E2            S01117
     C                     END                             *E1            S01117
     C                     ENDSR                                          S01117
     C/EJECT                                                              S01117
     C*****************************************************************
     C*
     C**   SUB-ROUTINE CLOSE - CREATE CLOSE OUT SET PROCESSING
     C**                      CALLED BY - ENTER
     C**                      CALLS SR - NEXCLO, ZTNLU1, ZALIGN, FFTVC
     C**                                 CLODET, ZFRPED, HELP, END.
     C*
     C*****************************************************************
     C*
     C           CLOSE     BEGSR
     C*
     C/COPY WNCPYSRC,FF0060C007
     C                     Z-ADD*ZEROS    PURCHS
     C                     Z-ADD*ZEROS    SALES
     C*
     C                     EXSR NEXCLO
     C                     Z-ADDCLON2     NCLON
     C*
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      NTNLU
     C                     Z-ADD1         RRN
     C*
     C           RRN       CHAINFF0060S0             50
     C*
     C           *IN50     DOWNE'1'
     C           SCLOS     ANDEQ*BLANKS
     C*
     C                     ADD  1         RRN
     C           RRN       CHAINFF0060S0             50
     C*
     C                     END
     C*
     C           *IN50     DOWNE'1'
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE SCLOS     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD5         ZADIG
     C                     EXSR ZALIGN
     C*
     C**   IF - NUMBER OF CONTRACTS TO CLOSE IS NUMERIC VALUE
     C*
     C           *IN99     IFNE '1'
     C*
     C                     MOVE ZFIELD    NCLOS
     C                     MOVE 'N'       FCLI
     C*
     C           TNBR      CHAINTRANS                50
     C*
     C**   IF - NOT A VALID RECORD ON LF/TRANS
     C*
     C           *IN50     IFEQ '1'
     C*
     C           RECI      ORNE 'D'
     C*
     C**  BROKER ONLY SELECTED -
     C**  CHECK NUMBER OF BROKER OPEN CONTRACTS IS UNCHANGED
     C*
     C***********PCUS      OREQ *ZEROS                                                        CSD027
     C           PCUS      OREQ *BLANKS                                                       CSD027
     C           PBOK      ANDEQ*BLANKS
     C           NOBO      ANDNESNOCT
     C*
     C**  OTHERWISE CUSTOMER OR BOOK SELECTED -
     C**  CHECK NUMBER OF CUSTOMER/BOOK OPEN CONTRACTS IS UNCHANGED
     C*
     C***********PCUS      ORNE *ZEROS                                                        CSD027
     C           PCUS      ORNE *BLANKS                                                       CSD027
     C           NOCO      ANDNESNOCT
     C*
     C           PBOK      ORNE *BLANKS
     C           NOCO      ANDNESNOCT
     C*
     C                     ROLBK
     C                     SETON                     31
     C*                                                                   E39121
     C** Exit loops to display failed screen                              E39121
     C*                                                                   E39121
     C                     GOTO ROLBKT                                    E39121
     C*                                                                   E39121
     C*
     C                     ELSE
     C*
     C**  CUSTOMER OR BOOK SELECTED
     C*
     C***********PCUS      IFNE *ZEROS                                                        CSD027
     C           PCUS      IFNE *BLANKS                                                       CSD027
     C           PBOK      ORNE *BLANKS
     C*
     C**   SET NUMBER OF CUSTOMER/BOOK OPEN CONTRACTS LEFT
     C*
     C           NOCO      SUB  NCLOS     NOCO
     C*
     C**   IF NEW NUMBER OF CUSTOMER/BOOK OPEN CONTRACTS IS ZERO
     C**   THEN SET THE FINAL CLOSURE IND ON PF/CLOSTT TO 'Y'
     C*
     C           NOCO      IFEQ *ZEROS
     C*
     C                     MOVE 'Y'       FCLI
     C*
     C                     END
     C*
     C                     END
     C*
     C**   IF BROKER SELECTED
     C*
     C***********PBRK      IFNE *ZEROS                                                        CSD027
     C           PBRK      IFNE *BLANKS                                                       CSD027
     C*
     C**   IF - BROKER POSITIONS UPDATE IND IS 'Y'
     C*
     C           BPUIND    ANDEQ'Y'
     C*
     C**   SET NUMBER OF BROKER OPEN CONTRACTS LEFT
     C*
     C           NOBO      SUB  NCLOS     NOBO
     C*
     C**   IF NEW NUMBER OF BROKER OPEN CONTRACTS IS ZERO
     C**   THEN SET THE FINAL CLOSURE IND ON PF/CLOSTT TO 'Y'
     C*
     C           NOBO      IFEQ *ZEROS
     C*
     C                     MOVE 'Y'       FCLI
     C*
     C                     END
     C*
     C                     END
     C*
     C**   WRITE RECORD TO PF/CLOSTT FOR TRANSACTION
     C*
     C                     MOVE 'D'       RECI
     C                     Z-ADDNCLON     CLON
     C                     Z-ADDNTNLU     TNLU
     C                     Z-ADDNCLOS     NCCL
     C*                                                                   E03643
     C**   Zero the fields containing the the no. of opening contracts    E03643
     C**   and the no. of closing contracts within the closeout for       E03643
     C**   the trade.                                                     E03643
     C*                                                                   E03643
     C                     Z-ADD0         OCOC                            E03643
     C                     Z-ADD0         CCOC                            E03643
     C                     Z-ADD0         OCOB                            E03643
     C                     Z-ADD0         CCOB                            E03643
     C*                                                                   E03643
     C                     WRITECLOSTTF
     C*
     C**   UPDATE RECORD ON LF/TRANS WITH NEW NUMBER OF OPEN CONTRACTS
     C*
     C                     EXCPTTRANSO
     C*
     C                     Z-ADDNCLOS     FFNOC
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C*
     C           ISPT      IFLE 6                                         AUS022
     C                     EXSR FFTVCL
     C*
     C***********          Z-ADDFFTNVL    TRANSV                          AUS022
     C                     Z-ADDFFTNVL    TRANSV 152                      AUS022
     C                     ELSE                                           AUS022
     C** ISPT = 7,8                                                       AUS022
     C***********          Z-ADDCOPR      FFPRCX 117               AUS022 E39280
     C***********          Z-ADD100       FFPRCY 117               AUS022 E39280
     C           ISPT      IFEQ 7                                         E37652
     C***********          Z-ADDCOPR      FFPRCX 117                E37652CFF004
     C***********          Z-ADD100       FFPRCY 117                E37652CFF004
     C           *LIKE     DEFN COPR      FFPRCX                          CFF004
     C                     Z-ADDCOPR      FFPRCX                          CFF004
     C           *LIKE     DEFN STRP      FFPRCY                          CFF004
     C                     Z-ADD100       FFPRCY                          CFF004
     C                     ELSE                                           E37652
     C*                                                                   E39280
     C** Use the Strike Price not the Contract Price                      E39280
     C*                                                                   E39280
     C***********          Z-ADDSTRP      FFPRCX 117                E39280CFF004
     C***********STRP      SUB  0.01      FFPRCY 117                E39280CFF004
     C***********          Z-ADDSTRP      FFPRCX                   CFF004 141747
     C***********STRP      SUB  0.01      FFPRCY                   CFF004 141747
     C                     Z-ADDSTRP      FFSTRP                          141747
     C                     Z-ADDCOPR      FFPRCX                          141747
     C                     Z-ADD0         FFPRCY                          141747
     C                     END                                            E37652
     C*                                                                   E37652
     C***********          EXSR FFPLCL                             AUS022 141747
     C                     EXSR FFUNPL                             AUS022 141747
     C***********          Z-ADDFFPOL     TRANSV                   AUS022 E39280
     C           ISPT      IFEQ 7                                         E37652
     C                     Z-ADDFFPOL     TRANSV                          E37652
     C                     ELSE                                           E37652
     C***********FFPOL     MULT COPR      TRANSV                   E39280 141747
     C***********          MULT 100       TRANSV                   E39280 141747
     C                     Z-ADDFFPOL     TRANSV                          141747
     C                     END                                            E37652
     C*                                                                   E37652
     C                     END                                            AUS022
     C*
     C**   IF - SALE TRANSACTION TYPE
     C*
     C           TRTY      IFEQ 'S'
     C*
     C***********          ADD  TRANSV    TRANST 150                      AUS022
     C                     ADD  TRANSV    TRANST 172                      AUS022
     C                     ELSE
     C*
     C                     ADD  NCLOS     PURCHS
     C                     SUB  TRANSV    TRANST
     C                     END
     C*
     C**   END IF/ELSE - INVALID RECORD ON LF/TRANS
     C*
     C                     END
     C*
     C**   END IF - NUM OF OPEN CONTRACTS IS NOT ZERO
     C*
     C                     END
     C*
     C**   ACCESS SUBFILE FOR NEXT RECORD
     C*
     C                     ADD  1         RRN
     C           RRN       CHAINFF0060S0             50
     C*
     C           *IN50     DOWNE'1'
     C           SCLOS     ANDEQ*BLANKS
     C*
     C                     ADD  1         RRN
     C           RRN       CHAINFF0060S0             50
     C*
     C                     END
     C*
     C                     END
     C*
     C**   IF - ROLLBACK OCCURRED ON ANY RECORDS
     C*
     C*                                                                   E39121
     C           ROLBKT    TAG                                            E39121
     C*                                                                   E39121
     C           *IN31     IFEQ '1'
     C*
     C                     SETOF                     31
     C*
     C                     EXFMTFF0060F3
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C           AID       DOWNE'01'
     C           AID       ANDNE'05'
     C*
     C********** AID       IFEQ 'HP'                                      S01199
     C**********           EXSR HELP                                      S01199
     C**********           END                                            S01199
     C*
     C                     READ FF0060F3                 50
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C                     END
     C*
     C                     ELSE
     C*
     C                     EXSR CLODET
     C*
     C                     CALL 'FF0360'
     C                     PARM           PMKT
     C                     PARM           IND     10
     C*
     C           IND       IFEQ 1
     C*
     C                     SETON                     U1U7U8
     C                     EXSR END
     C*
     C                     ELSE
     C*
     C                     MOVE CDP       ZDECS
     C                     Z-ADDCOPL      ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SPRLS
     C                     Z-ADDPURCHS    NCLOS
     C*
     C                     EXFMTFF0060F2
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C           AID       DOWNE'01'
     C           AID       ANDNE'05'
     C*
     C********** AID       IFEQ 'HP'                                      S01199
     C**********           EXSR HELP                                      S01199
     C**********           END                                            S01199
     C*
     C                     READ FF0060F2                 50
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C**   END CLOSO - CREATE CLOSE OUT SET
     C*
     C/COPY WNCPYSRC,FF0060C008
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
      **           ****** AS400 CONVERSION ******                         S01179
      **                                                                  S01179
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,        S01179
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.                S01179
      ** CALLED FROM UPDATE                                               S01179
      **                                                                  S01179
     C*================================================================   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN10     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C**********                                                    S01179S01199
     C**If*HELP*key pressed                                         S01179S01199
     C**********                                                    S01179S01199
     C********** *IN26     IFEQ '1'                                 S01179S01199
     C**********           MOVE 'HP'      AID                       S01179S01199
     C**********           MOVE '0'       *IN26                     S01179S01199
     C**********           END                                      S01179S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*================================================================
      /EJECT
     C*================================================================
     C*
     C**   SUB-ROUTINE CLODET - CLOSE OUT DETAIL RECORD
     C**                        CALLED BY - CLOSE
     C*
     C*****************************************************************
     C*
     C           CLODET    BEGSR
     C*
     C**   CLOSE SUCCUSSFUL, WRITE CLOSE OUT DETAIL TO PF-CLOSTD
     C*
     C           ISPT      IFLE 6                                         AUS022
      *****************************************************************               CFF006 241147A
      ***Use*the*new*computation*of*the*Close*out*Profit*and*loss******               CFF006 241147A
      ***if*CFF006*is*installed*and*Fractional*Ticks*indicator*is*'Y'**               CFF006 241147A
      *****************************************************************               CFF006 241147A
     C********** CFF006    IFEQ 'Y'                                                   CFF006 241147A
     C********** FRTK      ANDEQ'Y'                                                   CFF006 241147A
     C********** TKVL      MULT MNPF      ADTV   178H                                 CFF006 241147A
     C********** ADTV      MULT TRANST    COPL      H                                 CFF006 241147A
     C**********           ELSE                                                       CFF006 241147A
      *                                                                                       247517
      ** Use the new computation of the Close out Profit and loss                             247517
      ** if CFF006 is installed and Fractional Ticks indicator is 'Y'                         247517
      *                                                                                       247517
     C           CFF006    IFEQ 'Y'                                                           247517
     C           FRTK      ANDEQ'Y'                                                           247517
     C           TKVL      MULT MNPF      ADTV   178H                                         247517
     C           ADTV      MULT TRANST    COPL      H                                         247517
     C                     ELSE                                                               247517
     C           TKVL      MULT TRANST    COPL      H
     C**********           ENDIF                                                      CFF006 241147A
     C                     ENDIF                                                              247517
      *                                                                   CFF006
     C                     ELSE                                           AUS022
     C                     Z-ADDTRANST    COPL                            AUS022
     C                     END                                            AUS022
     C*
     C**   IF - MARKET INSTRUMENT
     C*
     C           PMKT      IFNE *BLANKS
     C*
     C                     Z-ADDBUSD      CLOD
     C*
     C                     ELSE
     C*
     C                     Z-ADDRUND      CLOD
     C*
     C**   END IF/ELSE - MARKET INSTRUMENT
     C*
     C                     END
     C*
     C**   IF - BROKER POSITIONS UPDATE IND IS NO
     C**   AND- INSTRUMENT IS A FUTURE
     C**   AND- CUSTOMER PARAMETER IS NOT ZERO
     C*
     C           BPUIND    IFEQ 'N'
     C           ISPT      ANDLE3
     C***********PCUS      ANDNE*ZEROS                                                        CSD027
     C           PCUS      ANDNE*BLANKS                                                       CSD027
     C           BPUIND    OREQ 'N'                                       AUS022
     C           ISPT      ANDEQ7                                         AUS022
     C***********PCUS      ANDNE*ZEROS                                    AUS022              CSD027
     C           PCUS      ANDNE*BLANKS                                                       CSD027
     C*
     C**   OR - BROKER POSITIONS UPDATE IND IS NO
     C**   AND- INSTRUMENT IS A FUTURE
     C**   AND- BOOK PARAMETER IS NOT BLANK
     C*
     C           BPUIND    OREQ 'N'
     C           ISPT      ANDLE3
     C           PBOK      ANDNE*BLANKS
     C           BPUIND    OREQ 'N'                                       AUS022
     C           ISPT      ANDEQ7                                         AUS022
     C           PBOK      ANDNE*BLANKS                                   AUS022
     C*
     C**   BROKER WRITTEN TO PF/CLOSTD IS ZERO
     C*
     C************         Z-ADD*ZEROS    BOCO                                                CSD027
     C                     MOVEL*BLANKS   BOCO                                                CSD027
     C*
     C                     ELSE
     C*
     C************         Z-ADDPBRK      BOCO                                                CSD027
     C                     MOVELPBRK      BOCO                                                CSD027
     C*
     C**   END IF/ELSE - CUSTOMER NOT ZERO, OR BOOK IS NOT BLANK
     C*
     C                     END
     C*
     C                     Z-ADDNCLON     CLON
     C***********          Z-ADDPBRCD     BRCD                            S01117
     C                     MOVE PBRCD     BRCA                            S01117
     C                     MOVE PINST     ISTT
     C                     Z-ADDPYR       YRNO
     C                     Z-ADDPMN       MTHN
     C                     MOVE PPTCL     PCAL
     C                     Z-ADDPSTPR     STRP
     C***********          Z-ADDPCUS      CUSC                                                CSD027
     C                     MOVELPCUS      CUSC                                                CSD027
     C                     MOVE PBOK      BOKC
     C                     MOVE 'M'       CLOT
     C                     MOVE 'N'       CORI
     C                     MOVE 'N'       SHPI
     C                     MOVE 'N'       ECPI
     C                     Z-ADDRUND      LCD
     C                     MOVE 'I'       CHTP
     C                     Z-ADDNTNLU     TNLU
     C/COPY WNCPYSRC,FF0060C012
     C*                                                                   CFF007
     C** If enhancement CFF007 is installed                               CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C                     MOVE *BLANKS   STTA                            CFF007
     C                     MOVE *BLANKS   STTB                            CFF007
     C*                                                                   CFF007
     C***********CUSC      IFNE *ZEROS                                    CFF007              CSD027
     C           CUSC      IFNE *BLANKS                                   CFF007              CSD027
     C*                                                                   CFF007
     C** Access LF/DEFLT via key list KDEFLT                              CFF007
     C*                                                                   CFF007
     C************         Z-ADDCUSC      KCBCD                           CFF007              CSD027
     C                     MOVELCUSC      KCBCD                           CFF007              CSD027
     C                     MOVELPMKT      KMRKT                           CFF007
     C                     MOVE PINST     WTEMP3  3                       CFF007
     C                     MOVE WTEMP3    KISTC                           CFF007
     C                     OPEN DEFLT                                     CFF007
     C           KDEFLT    CHAINDEFLT                5152                 CFF007
     C*                                                                   CFF007
     C                     MOVE *BLANKS   WSETP   2                       CFF007
     C**********           MOVE *BLANKS   WSTTA  12                                    CFF007 CGL029
     C                     MOVE *BLANKS   WSTTA  18                                           CGL029
     C                     MOVE *BLANKS   WSEBR   3                       CFF007
     C                     MOVE *BLANKS   WSECY   3                       CFF007
     C                     MOVE *BLANKS   WSTTA1  9                       CFF007
     C**********           MOVE *BLANKS   WSTTA2  6                                    CFF007 CGL029
     C                     MOVE *BLANKS   WSTTA2 12                                           CGL029
     C*                                                                   CFF007
     C           *IN52     IFEQ *ON                                       CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD18        DBASE            ************   CFF007
     C                     MOVE 'DEFLT   'DBFILE           *DB ERR 018*   CFF007
     C                     MOVELKCBCD     DBKEY            ************   CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** DEFLT record not found                                           CFF007
     C** OR record found AND settlement type is zero                      CFF007
     C*                                                                   CFF007
     C           *IN51     IFEQ *ON                                       CFF007
     C           *IN51     OREQ *OFF                                      CFF007
     C           SETP      ANDEQ*ZEROS                                    CFF007
     C*                                                                   CFF007
     C** Access Futures and Options Client Details                        CFF007
     C*                                                                   CFF007
     C                     MOVE CUSC      @CUST   6                       CFF007
     C                     CALL 'AOFOCSR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM @CUST     @CUST                           CFF007
     C           SDFOCS    PARM SDFOCS    @DSFDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE BHSTTY    WSETP                           CFF007
     C                     MOVE BHSMAC    WSTTA                           CFF007
     C                     MOVE BHSEBR    WSEBR                           CFF007
     C                     MOVE BHCYCD    WSECY                           CFF007
     C                     ELSE                                           CFF007
     C*                                                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD19        DBASE            ************   CFF007
     C                     MOVE 'SDFOCSPD'DBFILE           *DB ERR 019*   CFF007
     C                     MOVEL@CUST     DBKEY            ************   CFF007
     C                     MOVEL@OPTN     DBOPTN                          CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** DEFLT record found OR  settlement type is not zero               CFF007
     C*                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE SETP      WSETP                           CFF007
     C                     MOVE SETA      WSTTA                           CFF007
     C                     MOVE SEBR      WSEBR                           CFF007
     C                     MOVE ISCY      WSECY                           CFF007
     C*                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** 01 - Nostro by Telex                                             CFF007
     C** 07 - Nostro by CHIPS                                             CFF007
     C** 08 - Nostro by SWIFT                                             CFF007
     C*                                                                   CFF007
     C                     SELEC                                          CFF007
     C           WSETP     WHEQ '01'                                      CFF007
     C           WSETP     OREQ '07'                                      CFF007
     C           WSETP     OREQ '08'                                      CFF007
     C*                                                                   CFF007
     C** Access Nostro Details                                            CFF007
     C*                                                                   CFF007
     C                     MOVELWSTTA     WNOSN   2                       CFF007
     C                     CALL 'AONOSTR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM *BLANKS   @CUST                           CFF007
     C                     PARM ISCY      @CYCD   3                       CFF007
     C**********           PARM *BLANKS   @ACCD   4                                    CFF007 CGL029
     C                     PARM *BLANKS   @ACCD  10                                           CGL029
     C                     PARM *BLANKS   @ACSN   2                       CFF007
     C                     PARM WNOSN     @NONB   2                       CFF007
     C                     PARM *BLANKS   @BRCD   3                       CFF007
     C                     PARM *BLANKS   @CSSN  10                       CFF007
     C                     PARM *BLANKS   @PNOI   1                       CFF007
     C           SDNOST    PARM SDNOST    @DSFDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFEQ *BLANK                                    CFF007
     C                     MOVELA7CUST    WSTTA1                          CFF007
     C                     MOVE ISCY      WSTTA1                          CFF007
     C                     MOVELA7ACCD    WSTTA2                          CFF007
     C                     MOVE A7ACSN    WSTTA2                          CFF007
     C                     MOVELWSTTA1    STTA                            CFF007
     C                     MOVE WSTTA2    STTA                            CFF007
     C                     MOVE A7BRCD    WSEBR                           CFF007
     C                     ELSE                                           CFF007
     C*                                                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD20        DBASE            ************   CFF007
     C                     MOVE 'SDNOSTPD'DBFILE           *DB ERR 020*   CFF007
     C                     MOVEL@CYCD     DBKEY            ************   CFF007
     C                     MOVEL@OPTN     DBOPTN                          CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** 04 - Counter party's prime retail account                        CFF007
     C** 15 - Counter party designated account                            CFF007
     C*                                                                   CFF007
     C           WSETP     WHEQ '04'                                      CFF007
     C           WSETP     OREQ '15'                                      CFF007
     C                     MOVELCUSC      WSTTA1                          CFF007
     C                     MOVE ISCY      WSTTA1                          CFF007
     C           WSETP     IFEQ '04'                                      CFF007
     C                     MOVELCADC      WSTTA2                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVELDFCA      WSTTA2                          CFF007
     C                     ENDIF                                          CFF007
     C                     MOVE '01'      WSTTA2                          CFF007
     C                     MOVELWSTTA1    STTA                            CFF007
     C                     MOVE WSTTA2    STTA                            CFF007
     C*                                                                   CFF007
     C** Access Extended Client Details                                   CFF007
     C*                                                                   CFF007
     C                     MOVELCUSC      @KEY1  10 P                     CFF007
     C                     CALL 'AOCUSTR1'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           @KEY1                           CFF007
     C                     PARM *BLANKS   @KYST   7                       CFF007
     C           SDCUST    PARM SDCUST    @DSLDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFEQ *BLANK                                    CFF007
     C                     MOVE BBBRCD    WSEBR                           CFF007
     C                     ELSE                                           CFF007
     C*                                                                   CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD21        DBASE            ************   CFF007
     C                     MOVE 'SDCUSTPD'DBFILE           *DB ERR 021*   CFF007
     C                     MOVEL@KEY1     DBKEY            ************   CFF007
     C                     MOVEL@OPTN     DBOPTN                          CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** 05 - Any account                                                 CFF007
     C*                                                                   CFF007
     C           WSETP     WHEQ '05'                                      CFF007
     C**********           MOVELWSTTA     WSTTA2                                       CFF007 CGL029
     C**********           MOVE WSTTA     WSTTA1                                       CFF007 CGL029
     C**********           MOVELISCY      WSTTA1                                       CFF007 CGL029
     C**********           MOVELWSTTA2    STTA                                         CFF007 CGL029
     C**********           MOVE WSTTA1    STTA                                         CFF007 CGL029
     C                     MOVELWSTTA     WSTTA1                                              CGL029
     C                     MOVE ISCY      WSTTA1                                              CGL029
     C                     MOVE WSTTA     WSTTA2                                              CGL029
     C                     MOVELWSTTA1    STTA                                                CGL029
     C                     MOVE WSTTA2    STTA                                                CGL029
     C*                                                                   CFF007
     C** 06 - Suspense account                                            CFF007
     C*                                                                   CFF007
     C           WSETP     WHEQ '06'                                      CFF007
     C                     MOVELBICN      WSTTA1                          CFF007
     C                     MOVE ISCY      WSTTA1                          CFF007
     C                     MOVELCOMS      WSTTA2                          CFF007
     C                     MOVE '01'      WSTTA2                          CFF007
     C                     MOVELWSTTA1    STTA                            CFF007
     C                     MOVE WSTTA2    STTA                            CFF007
     C                     MOVE PBRCD     WSEBR                           CFF007
     C*                                                                   CFF007
     C** 14 - Any current account                                         CFF007
     C*                                                                   CFF007
     C           WSETP     WHEQ '14'                                      CFF007
     C                     MOVELWSTTA     KACNO  100                      CFF007
     C                     OPEN ACNUM                                     CFF007
     C*                                                                   CFF007
     C** Access Account Numbers File                                      CFF007
     C*                                                                   CFF007
     C           KACNO     CHAINACNUM                5152                 CFF007
     C*                                                                   CFF007
     C           *IN52     IFEQ *ON                                       CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD22        DBASE            ************   CFF007
     C                     MOVE 'ACNUM   'DBFILE           *DB ERR 022*   CFF007
     C                     MOVELKACNO     DBKEY            ************   CFF007
     C                     EXSR ERR                                       CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C           *IN51     IFEQ *OFF                                      CFF007
     C                     MOVELCNUM      WSTTA1                          CFF007
     C                     MOVE CCY       WSTTA1                          CFF007
     C                     MOVELACOD      WSTTA2                          CFF007
     C                     MOVE ACSQ      WSTTA2                          CFF007
     C                     MOVELWSTTA1    STTA                            CFF007
     C                     MOVE WSTTA2    STTA                            CFF007
     C                     MOVE BRCA      WSEBR                           CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     ENDSL                                          CFF007
     C*                                                                   CFF007
     C           WSETP     IFNE *BLANKS                                   CFF007
     C           STTA      ANDEQ*BLANKS                                   CFF007
     C                     MOVELBICN      WSTTA1                          CFF007
     C                     MOVE ISCY      WSTTA1                          CFF007
     C                     MOVELCOMS      WSTTA2                          CFF007
     C                     MOVE '01'      WSTTA2                          CFF007
     C                     MOVELWSTTA1    STTA                            CFF007
     C                     MOVE WSTTA2    STTA                            CFF007
     C                     MOVE PBRCD     WSEBR                           CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C           BGPFMG    IFEQ 'Y'                                       CFF007
     C           FCPORS    ANDNE'B'                                       CFF007
     C           BGN4ST    OREQ 'Y'                                       CFF007
     C*                                                                   CFF007
     C** If the display field is equal to the "reference attached to      CFF007
     C** 9997 portfolio"                                                  CFF007
     C*                                                                   CFF007
     C           PPTFR     IFEQ FCR997                                    CFF007
     C           PPTFR     ANDNE*BLANKS                                   CFF007
     C           BGN4ST    ANDNE'Y'                                       CFF007
     C                     MOVEL'9997'    PTFR                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVELPPTFR     PTFR                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C           STTA      IFNE *BLANKS                                   CFF007
     C           STTB      ANDEQ*BLANKS                                   CFF007
     C                     MOVE WSEBR     STTB                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     MOVE 'D'       RECI                            CFF007
     C                     Z-ADDRUND      LCD                             CFF007
     C                     MOVE 'I'       CHTP                            CFF007
     C                     Z-ADDNTNLU     TNLU                            CFF007
     C*                                                                   CFF007
     C                     CLOSEDEFLT                                     CFF007
     C                     CLOSEACNUM                                     CFF007
     C*                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITECLOSTDF
     C*
     C**   END CLODET - CLOSE OUT DETAIL OUTPUT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  NEXCLO SR. - TO LOCK THE CLOSEOUT NUMBER DATA AREA,         *
     C**               ACCESS THE NEXT AVAILABLE CLOSE OUT NUMBER,    *
     C**               THEN UPDATE AND RELEASE THE DATA AREA.         *
     C**               CALLED BY - CLOSE                              *
     C**                                                              *
     C*****************************************************************
     C**
     C           NEXCLO    BEGSR
     C**
     C           *NAMVAR   DEFN NACON     DNACON
     C           *LOCK     IN   DNACON
     C                     MOVE FCLON     CLON2
     C                     MOVE FCLON     WORK60
     C                     ADD  1         WORK60
     C                     MOVE WORK60    FCLON
     C                     OUT  DNACON
     C**
     C                     ENDSR
     C**
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01199
     C**********                                                          S01199
     C*****SUB-ROUTINE HELP - CALLS HELP TEXT                             S01199
     C**********                CALLED BY - MIDDLE                        S01199
     C**********                CALLS PGM MHELP.                          S01199
     C**********                                                          S01199
     C*****************************************************************   S01199
     C********** HELP      BEGSR                                          S01199
     C**********                                                          S01199
     C**********           MOVEL'FF0060'  HBPGM   6                       S01199
     C**********           MOVEAARR       HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           ENDSR                                          S01199
     C*****************************************************************
     C/EJECT
     C** ZDATE1 SUBROUTINE
     C/COPY ZSRSRC,ZDATE1Z2
     C*
     C/EJECT
     C** ZDATE2 SUBROUTINE
     C/COPY ZSRSRC,ZDATE2Z2
     C** FFPRCS SUBROUTINE
     C/COPY ZSRSRC,FFPRCSZ4
     C** ZALIGN SUBROUTINE
     C/COPY ZSRSRC,ZALIGNZ2
     C** ZFRPED SUBROUTINE
     C/COPY ZSRSRC,ZFRPEDZ3
     C** FFTVCL SUBROUTINE
     C/COPY ZSRSRC,FFTVCLZ2
     C** ZTNLU1 SUBROUTINE
     C/COPY ZSRSRC,ZTNLU1Z2
     C/EJECT                                                              AUS022
     C/COPY ZSRSRC,FFYTOPZ1                                               AUS022
     C/EJECT                                                              AUS022
     C/COPY ZSRSRC,FFPLCLZ1                                               AUS022
     C/EJECT                                                              141747
     C/COPY ZSRSRC,FFUNPLZ1                                               141747
     C/EJECT                                                              141747
     C/COPY ZSRSRC,FFPMCLZ1                                               141747
     C*
     C/EJECT
     C*****************************************************************
     C*
     C**   SUB-ROUTINE ERR - DATABASE ERROR SUBROUTINE
     C**                        CALLED BY - START, INST.
     C*
     C*****************************************************************
     C*
     C           ERR       BEGSR
     C                     SETON                     U7U8LR
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     OUT  LDA
     C                     RETRN
     C                     ENDSR
     C*
     C*****************************************************************
     C/COPY WNCPYSRC,FF0060C009
     C/EJECT
     O*****************************************************************
     O*
     OTRANSDF E                TRANSO
     O                         NOCO
     O                         NOBO
     O                         TNLU
     O*
     O*****************************************************************
     O/EJECT
      * THE LAST STATEMENT IS FOR S01117                                  S01117
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   MESSA - MESSAGES                                                     FO0103
  *** NO SELECTION FOR CLOSURE HAS BEEN MADE ***
    PURCHASE CONTRACTS TO CLOSE DOES NOT EQUAL SALE CONTRACTS TO CLOSE
  *** NO TRANSACTIONS FOUND FOR THIS COMBINATION ***
  *** CLOSE OUT SET IS TOO LARGE ***
  *** USER NOT AUTHORISED TO ORIGINATING BRANCH OF THE TRADE(S) ***
