     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Market instruments maintenance')              *
/*XBI *: OVRDBF INTYP1X INTYP1                                      : *
      *****************************************************************
      *                                                               *
      *  Midas - Futures and Options Module                           *
      *                                                               *
      *   FF0150  -  MARKET INSTRUMENTS MAINTENANCE                   *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CAP208             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 243821             Date 24Nov06               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG1046            Date 10Feb06               *
      *                 BUG7865            Date 13Jul05               *
      *                 CER001             Date 25Apr05               *
      *                 CSE071             Date 19Jul05               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2405            Date 06May04               *
      *                 BUG2234            Date 05Feb04               *
      *                 CAAA02             Date 05Feb04               *
      *                 CGP001             Date 08Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 198555             Date 12Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CFF007             Date 02Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      *                 185772             Date 07Dec00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 180523             Date 20Jun00               *
      *                 095053             DATE 29Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             DATE 13Sep99               *
      *                 167551             DATE 14SEP99               *
      *                 167554             DATE 14SEP99               *
      *                 167555             DATE 02SEP99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CPL002             DATE 08MAR99               *
      *                 123872             DATE 15OCT97               *
      *                 101432             DATE 09APR96               *
      *                 CFF004             DATE 13SEP96               *
      *                 104633             DATE 08JUL96               *
      *                 CPM003             DATE 01MAY96               *
      *                 S71062             DATE 08DEC95               *
      *                 PMC143             DATE 08DEC95               *
      *                 S01235             DATE 08DEC95               *
      *                  S01408             DATE 04SEP95              *
      *                  084771             DATE 13MAR95              *
      *                  083884             DATE 13MAR95              *
      *                  063328             DATE 05JAN94              *
      *                  046303             DATE 05JAN94              *
      *                  S01456             DATE 08NOV93              *
      *                  S04662             DATE 12JUL93              *
      *                  S01393             DATE 13OCT92              *
      *                  FUJI-FF0011        DATE 21SEP92              *
      *                  E38323             DATE 30JUL92              *
      *                  AUS022             DATE 06AUG92              *
      *                  E26293             DATE 12JUL91              *
      *                  FO0006             DATE 29JAN91              *
      *                  FO0007             DATE 28JAN91              *
      *                  S01299             DATE 17SEP90              *
      *                  E19546             DATE 06APR90              *
      *                  E21615             DATE 06APR90              *
      *                  E21614             DATE 06APR90              *
      *                  S01117             DATE 19MAR90              *
      *                  S01195             DATE 13MAR90              *
      *                  S01199             DATE 27FEB90              *
      *                  E19366             DATE 01SEP89              *
      *                  E18188             DATE 04/05/89             *
      *                  E16369             DATE 31/01/89             *
      *                  E16371             DATE 31/01/89             *
      *                  E16757             DATE 17/01/89             *
      *                  E14168             DATE 08/12/88             *
      *                  E15872             DATE 22/11/88             *
      *                  S01179             DATE 23/09/88             *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CAP208 - F&O Market Instrument API (Recompile)               *
      *  243821 - Used of formula in Settlement Date is not possible. *
      *           Amended program in a way that use of 31st date and  *
      *           formula are allowed when February is a quoted month.*
      *           Applied fix 208981.                                 *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10462 - Market Instruments should not be deleted if       *
      *             there are live Defaults attached to it. Apply     *
      *             fix 192609.                                       *
      *  BUG7865- Enabled F10 Delete (Recompile)                      *
      *  CER001 - LUX Upgrade to MidasPlus                           *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines                                        *
      *  BUG2405 - Recompile due to change in FF0150DF.               *
      *  BUG2234 - Set off *IN10 and *IN11 when setting *IN42 on to   *
      *           allow file update when BGN2ST and BGN4ST are 'Y'    *
      *           and CFF007 is on. Also removed redundant display    *
      *           of Private Banking screen and erroneous F12 Cancel  *
      *           message in enquiry.                                 *
      *  CAAA02 - Midasplus webfacing  changes                        *
      *  CGP001 - Global Processing.                                  *
      *           - SDWEIG* files renamed to GPWEIG*.                 *
      *           - AOWEIGR0 renamed to GPAOWEIGR0.                   *
      *  198555 - Do not allow deletion of instruments with live      *
      *           records in POSTNCD and POSTNKD regardless of the    *
      *           long and short position amounts.                    *
      *  CFF007 - Futures and Options Enhancement for Private Banking *
      *  CFF006 - Fractional Ticks Enhancement.                       *
      *  185772 - Portfolio Management Instrument selection correction   *
      *  180523 - CPL002 duplicated hooks FF0150CCP2 and FF0150CCP3.     *
      *           - Replaced with FF0150C018 and FF0150C019.             *
      *  095053 - Allow other settlement dates in settlement formula     *
      *  CPB001 - 'Private Banking' Module                               *
      *  167551 - Change of Plato requirement- the term to maturity      *
      *           is now in the format nnnX.                             *
      *  167554 - Unable to display/Update Plato screen because of       *
      *           warning error.                                         *
      *  167555 - Problem with Decmial Data Error with Plato field.      *
      *  CPL002 - Midas-Plato Interface                                  *
      *  123872 - Change size of interface parameter using between       *
      *           program and AOCURRR0 to avoid problem of journaling.   *
      *  101432 - WHEN DELETION, CHECK ALSO IF ACTIVE RECORDS            *
      *           IN TRANSD (LF TRANS13).                                *
      *  CFF004 - Increase in size of Price Fields                       *
      *  104633 - GUI Amendments to DSPF with non-standard footers    *
      *  CPM003 - FF PM Interface Upgrade to R10.                     *
      *  S71062 - FF/PM Interface (Just Recompiled)                   *
      *  PMC143 - ALLOW DEFAULT INSTRUMENT TYPE WITH PM MODULE        *
      *  S01235 - Portfolio Management Amendment.                     *
      *   S01408 - Addition of hooks FF0150IIP1                          *
      *                              FF0150IIP2                          *
      *                              FF0150CCP1                          *
      *                              FF0150CCP2                          *
      *                              FF0150CCP3                          *
      *                              FF0150CCP4                          *
      *   084771  -  Initialise new fields added for Enhanced OTC        *
      *              processing                                          *
      *   083884  -  In Amend mode, some fields should not be amendable  *
      *              if there are outstanding positions for the instr't  *
      *              as this will corrupt P/L and average price calcs.   *
      *              Fields are Processing Type, Currency, Quotation     *
      *              Convention, Ticks Denominator, Min Price Fluct'n    *
      *              and Tick Value.                                     *
      *   S01456  -  'FF' MONTHLY P&L ENHANCEMENTS.                      *
      *              Recompiled due to change to PF/MKCTLD.              *
      *   S04662  -  Switchable Feature for Init Margins for Futures;    *
      *              Deposit and Spread Margin Rate added to DEFLTD.     *
      *              Recompile only.                                     *
      *   S01393  -  AMENDMENT FOR LINKED ENQUIRY FROM RISK MANAGEMENT:  *
      *              WHEN CALLED FROM RM0003 MARKET AND INSTRUMENT       *
      *              CODES ARE PASSED AS PARAMETERS AND RELAVENT         *
      *              DETAILS ARE DISPLAYED.ORIGINAL FUNCTIONALITY HAS    *
      *              BEEN FULLY MAINTAINED .                             *
      *              Also added a new field for Underlying Period.       *
      *              The old field is renamed to P&L Amortisation        *
      *              Period.                                             *
      * FUJI-FF0011 - The system does not differentiate between          *
      *               american and european option on exercise           *
      *               validation and OTC confirmation wording.           *
      *   E38323  -  Recompilation of the program done due to a change   *
      *              in copy source ZFWDT subroutine                     *
      *   AUS022  -  AUSTRALIAN CHANGE : Introduction of Processing      *
      *              Types 7 and 8.                                      *
      *   E26293  -  Error in date formula validation allows:            *
      *            a) An adjustment (pos 4- 6) to the based date (pos 1  *
      *              to2) to be entered without a '+' or '-' sign having *
      *              to be specified in position 3, to indicate          *
      *              if the adjustment should be added or subtracted     *
      *              from the base date.                                 *
      *            b) An 'A' , 'B' or 'C' to be specified in pos 6, to   *
      *              indicate an adjustment in actual or business days   *
      *              without the no. of days to adjust being specified   *
      *              in pos. 4 to 5                                      *
      *   FO0006  -  Tick value is formated prior to display on screen   *
      *              such that the no. of decimal places is equal to     *
      *              instrument currency decimal places + 2.             *
      *   FO0007  -  CALCULATION OF TICK VALUE CORRECTED - IT WAS WRONG  *
      *              BY A FACTOR OF 10 DUE TO INCORRECT POWERS9 ARRAY.   *
      *              ALSO, TICK VALUE NOW CALCULATED ONLY IF ALL         *
      *              REQUIRED FIELDS VALID.                              *
      *   S01299  -  ALLOW 32 MARKET CENTRES AS PER ORIGINAL             *
      *              SPECIFICATION.                                      *
      *   E19546  -  THIS FIX CAUSES P/L CALCULATIONS TO BE OUT BY A     *
      *              FACTOR OF 100.FIX NOT INCORPORATED.                 *
      *   E21615  -  ADD  USE OF EC  FOR  ERROR MESSAGE 101.FIX NOT      *
      *              INCORPORATED - ALREADY IN R.10 CORE.                *
      *   E21614  -  PREVENT ERRONEOUS DISPLAY OF ERROR MESSAGE 101      *
      *   S01117  -  MULTIBRANCHING                                      *
      *   S01195  -  HOLIDAY AMENDMENT                                   *
      *   S01199  -  HELP SYSTEM                                     *
      *   E19366  -  CORRECTS VALIDATION OF MRKT, AND REMOVES THE        *
      *              REDUNDANT READ OF FF0150F1 AFTER HELP HAS BEEN USED.*
      *   E18188  -  CORRECT TICK VALUE WHICH MUST HAVE 5 DECIMAL        *
      *              PLACES.                                             *
      *   E16369  -  TO ENSURE INF. MSG. APPEARS ON EACH SCREEN.         *
      *   E16371  -  TICK VALUE TO ALLOW 2 DEC. PLACES MORE THAN         *
      *              INSTRUMENT CURRENCY.                                *
      *   E16757  -  HIGHLIGHT TICK VALUE FIELD IF W01 WARNING           *
      *              INDICATOR IS ON.                                    *
      *   E14168  -  CHECK VALUE OF TICK VALUE.                          *
      *   E15872  -  ALLOW ENQUIRY ON DELETED INSTRUMENTS                *
      *   S01179     ****** AS400 CONVERSION ******                      *
      *     The keyword RTGAID is no longer supported on the AS400       *
      *     and command keys and indicators have been used to replace    *
      *     this in the display file. To disrupt the structure of the    *
      *     program as little as possible a new subroutine - ASCHGS -    *
      *     has been coded. This moves the values which would have       *
      *     been passed to the program (via RTGAID) into the AID         *
      *     field depending on which function key has been pressed.      *
      *                                                                  *
      *------------------------------------------------------------------*
      *     CREATION REQUIREMENTS                                        *
      *                                                                  *
      *     IGNDECERR(*NO)                                               *
      *     OVRDBF     FILE(INTYP1X) TOFILE(INTYP1)                      *
      *                                                                  *
      ********************************************************************
     FINTYP1  UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FTRANS13 IF  E           K        DISK                               101432
     FINTYPA  UF  E                    DISK         KCOMIT
     F*OSTN2**IF**E***********K        DISK                               S01299
     FPOSTNCO IF  E           K        DISK                               S01299
     FPOSTNKO IF  E           K        DISK                               S01299
     FPOSTNC6 IF  E           K        DISK                                                   198555
     F            POSTNCDF                          KRENAMEPOSTNC6F                           198555
     FPOSTNK6 IF  E           K        DISK                                                   198555
     F            POSTNKDF                          KRENAMEPOSTNK6F                           198555
     FCHGCM   IF  E           K        DISK
     FMARKT   IF  E           K        DISK
     FMKCTL   IF  E           K        DISK
     FDEFLT1  IF  E           K        DISK
     FSNAME   IF  E           K        DISK
     F            CLINTCBF                          KRENAMESNAMECBF
     FFOCLT   IF  E           K        DISK
     F*ABLETJ*IF* E           K        DISK                               S01195
     F*ABFF***IF* E           K        DISK                               S01117
     F**ICD*1**** TABTB10F                          KIGNORE               S01117
     F*********** TABTB11F                          KIGNORE               S01117
     F*********** TABTB20F                          KIGNORE               S01117
     F*********** TABTB40F                          KIGNORE               S01117
     F*********** TABTB80F                          KIGNORE               S01117
     F*********** TABTE10F                          KIGNORE               S01117
     F**CCY*1**** TABTG10F                          KIGNORE               S01117
     F**COUNTRIES TABLETHF                          KIGNORE               S01117
     F*********** TABLETLF                          KIGNORE               S01117
     F*********** TABLETRF                          KIGNORE               S01117
     F*********** TABLET2F                          KIGNORE               S01117
     FFF0150DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE FF0150S0
     FINTYP1X IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYPDFX
     F/COPY WNCPYSRC,FF0150F001
     FSECTY   IF  E           K        DISK                               CFF007
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       01         S/FF0150C0  SFLDSP
     F*       02         S/FF0150C0  SFLDSPCTL
     F*       03         S/FF0150C0  SFLEND
     F*       04         S/FF0150C0  ROLLDOWN NOT ALLOWED
     F*       05         S/FF0150F1  PROTECT/NON-DISPLAY ON LOCATION
     F*       06         S/FF0150F0  PROTECT FIELDS
     F*
     F*       07         S/FF0150F0  ERROR ON SMQ1
     F*       08         S/FF0150F0  ERROR ON SMQ2
     F*       09         S/FF0150F0  ERROR ON SMQ3
     F*
     F*       10         START  SCREEN
     F*       11         REVIEW SCREEN
     F*       12         UPDATE SCREEN
     F*
     F*       13         S/FF0150F0 ERROR ON SMQ4
     F*       14         S/FF0150F0 ERROR ON SMQ5
     F*       15         S/FF0150F0 ERROR ON SMQ6
     F*
     F*       16         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION
     F*                                    CALL OF INFSR
     F*
     F*       17         S/FF0150F0 ERROR ON SMQ7
     F*       18         S/FF0150F0 ERROR ON SMQ8
     F*       19         S/FF0150F0 ERROR ON SMQ9
     F*
     F*       20         S/FF0150F1  ERROR-ACTN
     F*       21         S/FF0150F1  ERROR-MRKT
     F*       22         S/FF0150F1  ERROR-ISTC
     F*
     F*       23         S/FF0150F2  START SCREEN IS BEING DISPLAYED,
     F*                              F12 NOT ALLOWED
     F*
     F*       24         TESTN/LOKUP INDICATOR
     F*
     F*       25         ADD RECORD
     F*       26         PROTECT INDICATOR FOR AMENDMENTS WITH SSF ON
     F*
     F*       27         S/FF0150F0 ERROR ON SMQ10
     F*       28         S/FF0150F0 ERROR ON SMQ11
     F*       29         S/FF0150F0 ERROR ON SMQ12
     F*
     F*       30         S/FF0150F0  POSITION CURSOR
     F*                  S/FF0150F4  ERROR-INSTRUMENT TYPE                CPL002
     F*       31         S/FF0150F0  ERROR-ISTN
     F*                  S/FF0150F4  ERROR-TERM TO MATURITY               CPL002
      *                  S/FF0150F5  ERROR-SUNSE                          CFF007
     F*       32         S/FF0150F0  ERROR-ISPT
     F*                  S/FF0150F4  ERROR-COUPON RATE                    CPL002
      *                  S/FF0150F5  ERROR-STECO                          CFF007
     F*       33         S/FF0150F0  ERROR-ISCY
     F*                  S/FF0150F4  ERROR-COUPON FREQUENCY               CPL002
      *                  S/FF0150F5  ERROR-STNAT                          CFF007
     F*       34         S/FF0150F0  ERROR-CTAM
     F*                  S/FF0150F4  ERROR-PRICING CONVENTION             CPL002
      *                  S/FF0150F5  ERROR-SCRIK                          CFF007
     F*       35         S/FF0150F0  ERROR-QOTC
     F*                  S/FF0150F4  ERROR-VOLATILITY TYPE                CPL002
      *                  S/FF0150F5  ERROR-SCCYR                          CFF007
     F*       36         S/FF0150F0  ERROR-TKDM
     F*                  S/FF0150F4  ERROR-PRICING METHOD                 CPL002
      *                  S/FF0150F5  ERROR-STWEI                          CFF007
     F*       37         S/FF0150F0  ERROR-MNPF
      *                  S/FF0150F5  No Display-SUNSE                     CFF007
     F*       38         S/FF0150F0  ERROR-TKVL
      *                  S/FF0150F5  Protect                              CFF007
     F*       39         S/FF0150F0  ERROR-DBRK
     F*
     F*       40         ROLLUP                                           S01179
     F*       41         ROLLDOWN                                         S01179
     F********42*        HELP                                       S01179S01199
     F*       42         UPDAT2 SCREEN                                    CPL002
     F*                                                                   S01179
     F*       43         S/FF0150F1  ERROR-SPF CHECKING                   S01117
     F*       45         VLDCMDKY INDICATOR FOR DISPLAY FILE              S01179
     F*                                                                   S01179
     F*       46         S/FF0150F0  ERROR-BCPT
     F*       47         S/FF0150F0  ERROR-CCPT
     F*       48         S/FF0150F0  ERROR-BCMC
     F*       49         S/FF0150F0  ERROR-CCMC
     F*       50         S/FF0150F0  ERROR-BCMS
     F*       51         S/FF0150F0  ERROR-CCMS
     F*       52         S/FF0150F0  ERROR-BCGP
     F*       53         S/FF0150F0  ERROR-BCGS
     F*       54         S/FF0150F0  ERROR-CCGP
     F*       55         S/FF0150F0  ERROR-CCGS
     F*       56         S/FF0150F0  ERROR-CMRF
     F*       57         PRICING REF ERROR IND - RI ON DSPF
     F*       58         STATUTORY RETURNS CODE ERROR IND - RI ON DSPF
     F*       59         S/FF0150F0  ERROR-OTHC
     F*       60         S/FF0150F0  ERROR-FTRF
     F*                  S/FF0150F4  NON-DISPLAY UNDERLING DETAILS        CPL002
     F*       61         S/FF0150F0  ERROR-PUPF
     F*                  S/FF0150F4  NON-DISPLAY OPTION DETAILS           CPL002
     F*       62         S/FF0150F0  PROTECT SMQ1
     F*       63         S/FF0150F0  PROTECT SMQ2
     F*       64         S/FF0150F0  PROTECT SMQ3
     F*       65         S/FF0150F0  PROTECT SMQ4
     F*                  S/FF0150F4  PROTECT FIELDS ON ENQUIRY            CPL002
     F*       66         S/FF0150F0  PROTECT SMQ5
     F*       67         S/FF0150F0  PROTECT SMQ6
     F*       68         S/FF0150F0  PROTECT SMQ7
     F*       69         S/FF0150F0  PROTECT SMQ8
     F*       70         S/FF0150F0  PROTECT SMQ9
     F*       71         S/FF0150F0  PROTECT SMQ10
     F*       72         S/FF0150F0  PROTECT SMQ11
     F*       73         S/FF0150F0  PROTECT SMQ12
     F*       74         S/FF0150F0  ERROR-FTFD
     F*       75         S/FF0150F0  ERROR-SEDF
     F*       76         S/FF0150F0  ERROR-SPMF
     F*       77         S/FF0150F0  ERROR-TFPD
     F*       78         S/FF0150F0  ERROR-FSPM
     F*       79         S/FF0150F0  ERROR-ULPD
     F*       80         S/FF0150F0  ERROR-CNTT                           FF0011
     F*       81         S/FF0150F0  ERROR-AEIN                           FF0011
     F*       82         S/FF0150F0  ERROR-ALPD                           S01393
     F*       83         S/FF0150F0  PROTECT FIELDS IN AMEND MODE         083884
     F*                                                                   101432
     F*       84         READ TRANS13  FILE                               101432
     F*
     F*       85         Linked enquiry                                   S01393
     F*       86         S/FF0150F0  ERROR-SINNR                          S01235
     F*       87         S/FF0150F0  NON-DISPLAY SINNR                    S01235
     F*
     F*       98         DATF = MMDDYY
     F*       99         WORK
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F*       'AID' VALUES USED
     F*
     F*       01         CA3                                              S01179
     F*       04         CA10                                             S01179
     F*       05         CA12                                             S01179
     F*       RA         ENTER PRESSED
     F*       UP         ROLLUP
     F*       DN         ROLLDOWN
     F********HP**       HELP PRESSED                                     S01199
     F*
     F* NOT USED ARE
     F*
     F*       PT         PRINT
     F*       CL         CLEAR
     F*       HM         HOME
     F*
     E                    CPY@    1   1 80
     E*
     E                    DET       256  1
     E*
     E**********          POWER9  1   9  9 0                              FO0007
     E                    POWER9  1   9 10 0                              FO0007
     E/COPY WNCPYSRC,FF0150E001
     E********************INF     1  12 76                                S01393
     E** Extra entry in array for use when program is called as           S01393
     E** linked enquiry.                                                  S01393
     E*************       INF     1  13 76                          S01393CPL002
     E                    INF     1  15 76                                CPL002
     E/COPY WNCPYSRC,FF0150E002
     E                    ERR        40  4
     E                    WER        10  4
     E                    SMQ        12  1
     E                    FMQ        12  1
     E                    MQ         12  1               MTHS QUOTED
     E                    LETT    7   7  1
     E*
      /COPY ZSRSRC,FFDATEZ1
     E*
     E** Replaced by ZDATE2Z1                                             CPL002
     E*COPY*ZSRSRC,ZDATE1Z1***                                            CPL002
     E***SR.ARRAY*FOR*ZDATE1**                                            CPL002
     E*
     E/COPY ZSRSRC,ZDATE2Z1                                               CPL002
     E*COPY*ZSRSRC,ZDATE3Z1********************************************   S01195
     E**&SR.ARRAY*FOR*ZDATE3*******************************************   S01195
     E*
     E*COPY*ZSRSRC,ZDATE5Z1********************************************   S01195
     E***SR.ARRAY*FOR*ZDATE5*******************************************   S01195
     E*
     E/COPY ZSRSRC,ZALIGNZ1
     E** SR.ARRAY FOR BOTH ZALIGN AND ZEDIT
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E** SR.ARRAY FOR ZACCH, ZCHKH AND ZFWDT                              S01195
     E/COPY WNCPYSRC,FF0150E003
     ISECTYDF                                                             CFF007
     I              RECI                            RECISE                CFF007
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I** SR.ARRAY FOR ZACCH, ZCHKH AND ZFWDT                              S01195
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLDS                                                 S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS AND ACCESS OBJECTS              S01195
     I*                                                                   S01408
     I/COPY WNCPYSRC,FF0150IIP2                                           S01408
     I*                                                                   S01408
     I*                                                                   S01195
     I*COPY*ZSRSRC,ZDATE3Z2********************************************   S01195
     I*COPY.ZSRSRC,ZDATE3Z3********************************************   S01195
     I*****DATA*STRUCTURE*FOR*ZDATE3***********************************   S01195
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I                                        3   7 ISTT
     I                                        3   4 MRKT
     I                                        5   7 ISTC
     I                                        8  12 PISTT
     I                                        8   9 PMRKT
     I                                       10  12 PISTC
     I*
     I*
     IDETREC    E DSINTYPD
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I              ISTI                            ISTIX
     I              ISTT                            ISTTX
     I*DETS******E DSFF0150DF                                             S01179
     IDETS        DS                                                      S01179
     I*
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT
     I                                        1  20 SISTN                 S01179
     I                                       21  21 SISPT                 S01179
     I                                       22  24 SISCY                 S01179
     I                                       25  38 SCTAM                 S01179
     I                                       39  40 SQOTC                 S01179
     I                                       41  43 STKDM                 S01179
     I                                       44  55 SMNPF                 S01179
     I                                       56  70 STKVL                 S01179
     I                                       71  80 SDBRK                 S01179
     I                                       81  81 SBCPT                 S01179
     I                                       82  82 SCCPT                 S01179
     I                                       83  84 SBCMC                 S01179
     I                                       85  86 SBCMS                 S01179
     I                                       87  88 SCCMC                 S01179
     I                                       89  90 SCCMS                 S01179
     I                                       91  92 SBCGP                 S01179
     I                                       93  94 SBCGS                 S01179
     I                                       95  96 SCCGP                 S01179
     I                                       97  98 SCCGS                 S01179
     I                                       99 108 SCMRF                 S01179
     I                                      109 118 SPRRF                 S01179
     I                                      119 123 SSTRC                 S01179
     I                                      124 126 SOTHC                 S01179
     I                                      127 129 SFTRF                 S01179
     I                                      130 130 SPUPF                 S01179
     I                                      131 131 SMQ1                  S01179
     I                                      132 132 SMQ2                  S01179
     I                                      133 133 SMQ3                  S01179
     I                                      134 134 SMQ4                  S01179
     I                                      135 135 SMQ5                  S01179
     I                                      136 136 SMQ6                  S01179
     I                                      137 137 SMQ7                  S01179
     I                                      138 138 SMQ8                  S01179
     I                                      139 139 SMQ9                  S01179
     I                                      140 140 SMQ10                 S01179
     I                                      141 141 SMQ11                 S01179
     I                                      142 142 SMQ12                 S01179
     I                                      143 149 SFTDF                 S01179
     I                                      150 156 SSEDF                 S01179
     I                                      157 163 SSPMF                 S01179
     I                                      164 165 STFPD                 S01179
     I                                      166 167 SFSPM                 S01179
     I                                      168 170 SULPD                 S01179
     I                                      171 175 SALPD                 S01393
     I                                      176 176 SFRTK                 CFF006
     I                                      195 204 SUNSE                 CFF007
     I                                      205 207 STECO                 CFF007
     I                                      208 210 STNAT                 CFF007
     I                                      211 212 SCRIK                 CFF007
     I                                      213 215 SCCYR                 CFF007
     I                                      216 217 STWEI                 CFF007
     I/COPY WNCPYSRC,FF0150I001
     I**  H A R D   C O D E D   F I E L D   P O S I T I O N S
     I                                      131 142 SMQ
     IDETS2       DS                                                      CPL002
     I*                                                                   CPL002
     I** DATA STRUCTURE FOR SCREEN 2 DETAIL OUTPUT TO CMTTXT              CPL002
     I                                        1   1 SMIIT                 CPL002
     I                                        2   5 SMITM                 CPL002
     I** UNDERLYING TERM TO MATURITY                                      CPL002
     I************                            2   2 SPREF          CPL002 167551
     I************                            3   4 STERM          CPL002 167551
     I                                        2   4 STERM                 167551
     I                                        5   5 SSIGN                 CPL002
     I                                        6  17 SMICP                 CPL002
     I                                       18  18 SMICF                 CPL002
     I                                       19  19 SMIPC                 CPL002
     I                                       20  20 SMIVT                 CPL002
     I                                       21  21 SMIPM                 CPL002
     I                                       22  29 SMIPG                 CPL002
     I                                       30  37 SMIRG                 CPL002
     I                                       38  41 SMICR                 CPL002
     I                                       42  47 SMIMD                 CPL002
     ICCYK        DS                             12
     I*
     I** DATA STRUCTURE FOR CHAIN TO CURRENCY TABLE
     I                                        1   2 CCY1
     I                                        9  11 TCCY
     I                                       12  12 CCY3
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR FF0150F2 TO SCREEN
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I                                      287 288 AID
     IINFDS       DS
     I*
     I** FILE STATUS DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I                                     *STATUS  STATUS
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      **                                                                  S01117
     IZMUSER      DS                             17                       S01117
      ** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
     ISDCURR    E DSSDCURRPD                                              S01117
     I** CURRENCY DETAILS                                                 S01117
     I              A6CYCD                          CURR                  S01117
     I              A6NBDP                          CDP                   S01117
      *                                                                   CFF007
      ** DS for Economic Sector Description Access Object                 CFF007
      *                                                                   CFF007
     ISDECOS    E DSSDECOSPD                                              CFF007
      *                                                                   CFF007
      ** DS for Local Industry Codes Access Object                        CFF007
      *                                                                   CFF007
     ISDINDS    E DSSDINDSPD                                              CFF007
      *                                                                   CFF007
      ** DS for Nature Code Description Access Object                     CFF007
      *                                                                   CFF007
     ISDNATU    E DSSDNATUPD                                              CFF007
      *                                                                   CFF007
      ** DS for Country Code Access Object                                CFF007
      *                                                                   CFF007
     ISDCTRY    E DSSDCTRYPD                                              CFF007
      *                                                                   CFF007
      ** DS for Weighting Code Description Access Object                  CFF007
      *                                                                   CFF007
     I*SDWEIG***E*DSSDWEIGPD***                                                        CFF007 CGP001
     IGPWEIG    E DSGPWEIGPD                                                                  CGP001
     I              PDLCD                           PDLCDX                CFF007
      *                                                                   CFF007
     ISDPLIN    E DSSDPLINPD                                              S01235
     I** Instrument details                                               S01235
     I              PDWEIG                          P2WEIG                                    CLE025
     ISDMMOD    E DSSDMMODPD                                              S01235
     I** Modules details                                                  S01235
     ISDPORT    E DSSDPORTPD                                              PMC143
     I** Portfolio Management ICD                                         PMC143
      **                                                                  S01117
     ISCSARD    E DSSCSARDPD                                              CFF006
      ** External DS for SAR Details                                      CFF006
     I              LCD                             SALCD                 CFF006
      *                                                                   CFF006
     I@DSFDY    E DSDSFDY                                                 S01117
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               S01117
      **                                                                  S01117
     IMONQ        DS
     I*
     I*  DS FOR MONTHS QUOTED ON MARKET FILE
     I                                        1  12 MKMQ
     I                                        1  12 MQ
      /COPY ZSRSRC,FFDATEZ2
     I*
     IFORMDT      DS
     I*
     I**  DS FOR FORMULA DATES
     I                                        1   7 SDATE
     I                                        1   1 SWRK1
     I                                        2   2 SWRK2
     I                                        1   2 SDN1
     I                                        3   3 SWRK3
     I                                        4   4 SWRK4
     I                                        5   5 SWRK5
     I                                        4   5 SDN2
     I                                        6   6 SWRK6
     I                                        4   6 S456
     I                                        7   7 SWRK7
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I**   DATA STRUCTURE TO UPDATE LAST TRANSACTION NUMBER DTAARA
     I*
     I*
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I** and passed parameter indicator,used when called as               S01393
     I** a linked enquiry.                                                S01393
     I                                       37  390WWPARM                S01393
     I                                      244 246 WSID
     I                                      254 263 USID
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*                                                                   S01408
     I/COPY WNCPYSRC,FF0150IIP1                                           S01408
     I*                                                                   S01408
     C* CALCULATION SPECIFICATIONS:KEY LISTS
     C*
      **  DEFINE KEY LIST FOR CHAINING TO INTYP1 FILE
     C*
     C           INTP1K    KLIST
     C                     KFLD           ISTI
     C                     KFLD           ISTT
     C*
      **  DEFINE KEY LIST FOR CHAINING TO INTYP1 FILE-FUTURE TYPE REF
     C*
     C           INTP1L    KLIST
     C                     KFLD           ISTI
     C                     KFLD           ISTTR   5
     C*
      **  DEFINE KEY LIST FOR CHAINING TO CHGCM FILE
     C*
     C           CHGCMK    KLIST
     C                     KFLD           CCY
     C                     KFLD           CGCM
     C*
      **  DEFINE KEY LIST FOR CHAINING TO DEFLT1 FILE
     C**
     C           DFLTK1    KLIST
     C                     KFLD           MRKT
     C                     KFLD           ISTC
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
      ** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
     C*
      ** MAIN PROCESS - PERFORM UNTIL F3 OR ERROR
     C*
     C           AID       DOUEQ'01'
     C*
     C           *IN10     CASEQ'1'       START
     C*
     C           *IN11     CASEQ'1'       REVIEW
     C*
     C           *IN12     CASEQ'1'       UPDATE
     C*                                                                   CPL002
     C           *IN42     CASEQ'1'       UPDAT2                          CPL002
     C*
     C                     END
     C                     END
     C*
      ** TERMINATE PROGRAM
     C*
     C                     SETON                         LR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      /EJECT
      ********************************************************************
      ** INDEX OF SUBROUTINES
      **
      ** INIT              INITIALISATION OF STANDARD FIELDS,
      **                   ACCESS OF STANDING DATA
      **
      ** START             OUTPUT AND PROCESS KEY FIELDS SCREEN
      **
      ** REVIEW            PROCESS SUBFILE SELECTION SCREEN
      **
      ** UPDATE            PROCESS DETAIL SCREEN AND UPDATE FILE
      **                                                                  CPL002
      ** UPDAT2            PROCESS MIDAS-PLATO SCREEN AND UPDATE FILE     CPL002
      **
      ** VALIDK            VALIDATE KEY FIELDS
      **
      ** VALIDD            VALIDATE DETAIL SCREEN
      **                                                                  CPL002
      ** VALID2            VALIDATE MIDAS-PLATO SCREEN                    CPL002
      **
      ** VALDAT            VALIDATE DATE FORMULA
      **                                                                  CPL002
      ** VALDA2            VALIDATE TERM TO MATURITY                      CPL002
      **
      ** DEFLTS            FORMAT DEFAULT FIELD VALUES
      **                                                                  CPL002
      ** DEFLT2            FORMAT DEFAULT VALUES FOR MIDAS-PLATO SCREEN   CPL002
      **
      ** INITRC            INITIALISE ALL FILE FIELDS TO ZERO/BLANK
      **                                                                  CPL002
      ** INITR2            INITIALISE ALL MIDAS/PLATO FIELDS              CPL002
      **
      ** TRSSTF            FORMAT SCREEN FIELDS FOR FILE
      **
      ** TRSFS             FORMAT RECORD FIELDS FOR SCREEN
      **                                                                  CPL002
      ** TRSFS2            FORMAT RECORD FIELDS FOR MIDAS-PLATO SCREEN    CPL002
      **
      ** UPDFLS            UPDATE FILE RECORDS
      **
      ** UPDOWS            PROCESS UPDATE BY ANOTHER WORKSTATION
      **
      ** ZALIGN            VALIDATE AMOUNT FIELDS
      **
      ** FFDATE            CONVERTS DATE FORMULA TO DAY NO.
      **
     C*   CALLS:    FFDE31   CALC LAST WORKING DAY IN MONTH
     C*             FFDN31   CALC SPECIFIED WORKING DAY IN MONTH
     C*             FFDAAD   ADJUST DAY WITH AN ACTUAL NO. OF DAYS
     C*             FFDABD   ADJUST DAY WITH NO. OF BUSINESS DAYS IN
     C*                      MARKET CENTRE CCY
     C*             FFDACD   ADJUST DAY WITH NO. OF BUSINESS DAYS IN
     C*                      MARKET CENTRE CCY & INST CCY & OTHER CCY
     C*             FFDAWD   ADJUST DAY WITH BY 1 BUSINESS DAY IN
     C*                      MARKET CENTRE CCY IF NOT A WORKING DAY
     C**************FFDCYH***DETERMINE*WHETHER*CCY*PASSED*IS*A*WORKING****S01195
     C***********************DAY*FOR*THE*LAST*DAY*OUPUT*BY*ZDATE/5********S01195
     C*             ZCHKH    DETERMINE WHETHER CCY PASSED IS A WORKING*   S01195
     C*                      DAY FOR THE LAST DAY OUPUT BY ZFWDT/ZBKDT*   S01195
     C*                      IN THE SPECIFIED LOCATION.               *   S01195
     C**************FFDAT3***CALCULATE*A*NO.*OF*WORKING*DAYS*BACK*********S01195
     C***********************IN*A*GIVEN*CCY*******************************S01195
     C**************FFDAT5***DETERMINE*WHETHER*A*DAY*IS*A*WORKING*DAY*****S01195
     C***********************&*FIND*THE*PREV*WORKING*DAY*IF*IT*IS*NOT*****S01195
     C*
     C*             ZDATE1   CONVERT A DATE TO A NO. OF DAYS
     C*     ZDATE2      Convert a MIDAS day no. to Date Format            CPL002
     C**************ZDATE3***CALCULATE*A*NO.*OF*WORKING*DAYS*FORWARDS*****S01195
     C***********************IN*A*GIVEN*CCY*******************************S01195
     C**************ZDATE5***DETERMINE*WHETHER*A*DAY*IS*A*WORKING*DAY*****S01195
     C***********************&*FIND*THE*NEXT*WORKING*DAY*IF*IT*IS*NOT*****S01195
     C*             ZFWDT    DETERMINE WHETHER A DAY IS A WORKING DAY *   S01195
     C*                      IN THE SPECIFIED LOCATION;               *   S01195
     C*                      & FIND THE NEXT WORKING DAY IF IT IS NOT *   S01195
     C*             ZBKDT    DETERMINE WHETHER A DAY IS A WORKING DAY *   S01195
     C*                      IN THE SPECIFIED LOCATION;               *   S01195
     C*                      & FIND THE PREV WORKING DAY IF IT IS NOT *   S01195
      **
      ** ZEDIT             FORMAT AMOUNT FIELDS FOR DISPLAY
      **
      ** ZDATE1            CONVERT DATE TO DAYNO. AND REPORT IF ERROR
      **
      ** ZTNLU1            ACCESS DATAAREA FOR NEXT TRANSACTION NO.
      **
      ** INFSR             FILE ERROR HANDLING S/R
      **
      ** DBERR             TERMINATE PROGRAM ON DATABASE ERROR
      **
      ********************************************************************
      /EJECT
      ********************************************************************
      **
      ** INIT S/R - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
      ** If program is called as a linked enquiry the market and          S01393
      ** instrument parameters are moved to the relavent fields           S01393
      ** and indicator 85 is set on.                                      S01393
      ** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
      ** CALLS NO OTHER ROUTINES
      **
      ********************************************************************
     C*
     C           INIT      BEGSR                           * INIT BEGSR *
     C*
      ** Linked enquiry                                                   S01393
     C*                                                                   S01393
     C           *ENTRY    PLIST                                          S01393
     C                     PARM           PPMRKT  2                       S01393
     C                     PARM           PPISTC  3                       S01393
     C                     PARM           PPRTCD  4                       S01393
     C*                                                                   S01393
     C           WWPARM    IFNE 0                          B1             S01393
     C                     MOVE PPMRKT    MRKT             *1             S01393
     C                     MOVE PPISTC    ISTC             *1             S01393
     C                     MOVE 'E'       ACTN             *1             S01393
     C                     SETON                     85    *1             S01393
     C                     END                             E1             S01393
     C*                                                                   S01393
      ** PREPARE LDA
     C*
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL*BLANK    DBLOT                           S01117
     C                     MOVEL*BLANK    DBFILE                          S01117
     C                     MOVEL*BLANK    DBKEY                           S01117
     C                     MOVEL'FF0150'  DBPGM
     C                     Z-ADD*ZEROS    DBASE                           S01117
     C                     OUT  LDA                                       S01117
     C*
      ** CURRENCY RECORD KEY
     C*
     C                     MOVEL'20'      CCY1
     C                     MOVEL'1'       CCY3
     C*
      ** PREPARE COMIT TEXT
     C*
     C                     MOVEL'FF'      MDID
     C                     MOVEL'FF0150'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
      ** HELP PROGRAM PARAMETER
     C*
     C                     MOVEL'FF0150'  HBPGM   8
     C                     MOVEL*BLANK    WBLNK   1
     C*
      ** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1
     C                     BITON'267'     HI
     C                     MOVELHI        INF,7
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C                     MOVELHI        INF,11
     C                     MOVELHI        INF,14                          CFF007
     C                     MOVELHI        INF,15                          CFF007
     C/COPY WNCPYSRC,FF0150C014
     C***********                                                         S01117
      ***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********                                                         S01117
      ***IF*FOUND*CHECK*SYSTEM*DATE*FORMAT,*DDMMYY*OR*MMDDYY.*************S01117
     C*                                                                   S01117
     C** IN THE DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C** IN THE DATAAREA ZMUSER                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C*
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C***********          ELSE                                           S01117
     C***********                                                         S01117
      ***OTHERWISE*DB*ERROR***********************************************S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8LR***************S01117
     C***********          MOVEL'01'      DBASE            * DB ERROR 01 *S01117
     C***********          MOVEL'TABFF'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '10'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          EXSR DBERR                                     S01117
     C***********          END                                            S01117
     C*
      ** PROCEED TO START SCREEN UNLESS DATABASE ERRPR
      ** or program has been called as a linked enquiry in which case     S01393
      ** display market instrument details ('UPDATE' subroutine)          S01393
     C*
     C           *INU7     IFNE '1'
     C**********           MOVEA'1'       *IN,10                          S01393
     C  N85                SETON                       10                 S01393
     C   85                SETON                       12                 S01393
     C                     END
     C*                                                                   S01235
     C** DO NOT DISPLAY INSTRUMENT TYPE INPUT FIELD IF NO PORTF MGMT      S01235
     C*                                                                   S01235
     C                     CALL 'AOMMODR0'                                S01235
     C                     PARM *BLANKS   @PRTCD  7                       S01235
     C                     PARM '*FIRST  '@POPTN  7                       S01235
     C           SDMMOD    PARM SDMMOD    @DSFDY                          S01235
     C           @PRTCD    IFNE *BLANKS                                   S01235
     C           *LOCK     IN   LDA                                       S01235
     C                     Z-ADD31        DBASE                           S01235
     C                     MOVE 'SDMMODPD'DBFILE           ***************S01235
     C                     MOVEL'*NONE'   DBKEY            * DBASE ERR 31*S01235
     C                     OUT  LDA                        ***************S01235
     C                     EXSR *PSSR                                     S01235
     C                     ELSE                                           S01235
     C           BGPFMG    IFNE 'Y'                                       S01235
     C                     MOVE *ON       *IN88                           CPB001
     C           BGN4ST    IFNE 'Y'                                       CPB001
     C                     MOVE *ON       *IN87                           S01235
     C                     ENDIF                                          CPB001
     C                     ELSE                                           S01235
     C*                                                                   PMC143
     C                     CALL 'AOPORTR0'                                PMC143
     C                     PARM *BLANKS   @RTCD   7                       PMC143
     C                     PARM '*FIRST ' @OPTN   7                       PMC143
     C           SDPORT    PARM SDPORT    @DSFDY                          PMC143
     C           @RTCD     IFNE *BLANKS                                   PMC143
     C           *LOCK     IN   LDA                                       PMC143
     C                     SETON                     U7U8  ***************PMC143
     C                     Z-ADD9         DBASE            * DB ERROR 09 *PMC143
     C                     MOVE 'SDPORTPD'DBFILE           ***************PMC143
     C                     MOVE *BLANKS   DBKEY                           PMC143
     C                     OUT  LDA                                       PMC143
     C                     EXSR *PSSR                                     PMC143
     C                     END                                            PMC143
     C*                                                                   PMC143
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C*                                                                   CPM003
     C           FCPORS    IFEQ 'B'                                       CPM003
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE *ON       *IN87                           CPM003
     C                     END                                            CPM003
     C*                                                                   CPM003
     C                     END                                            PMC143
     C                     END                                            S01235
      *                                                                   CFF006
      **  Access SAR details file to see if switchable feature            CFF006
      **  CFF006 - Fractional Ticks Enhancement is installed.             CFF006
      *                                                                   CFF006
     C                     CALL 'AOSARDR0'                                CFF006
     C                     PARM *BLANKS   PRTCD   7                       CFF006
     C                     PARM '*VERIFY' POPTN   7                       CFF006
     C                     PARM 'CFF006'  PSARD   6                       CFF006
     C           SCSARD    PARM SCSARD    @DSFDY                          CFF006
      *                                                                   CFF006
     C           PRTCD     IFEQ *BLANK                                    CFF006
     C                     MOVE *OFF      *IN89                           CFF006
     C                     MOVE 'Y'       CFF006  1                       CFF006
     C                     ELSE                                           CFF006
     C                     MOVE *ON       *IN89                           CFF006
     C                     MOVE 'N'       CFF006                          CFF006
     C                     ENDIF                                          CFF006
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0150CCP1                                           S01408
     C*                                                                   S01408
      *                                                                   CFF007
      ** Check if switchable feature CFF007 is installed                  CFF007
      *                                                                   CFF007
     C                     CALL 'AOSARDR0'                                CFF007
     C                     PARM *BLANKS   @RTCD   7                       CFF007
     C                     PARM '*VERIFY' @OPTN   7                       CFF007
     C                     PARM 'CFF007'  @SARD   6                       CFF007
     C           SCSARD    PARM SCSARD    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           @RTCD     ANDNE'*NRF   '                                 CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD15        DBASE             **************CFF007
     C                     MOVE 'SCSARDPD'DBFILE            *DB ERROR 015*CFF007
     C                     MOVEL@SARD     DBKEY             **************CFF007
     C                     EXSR *PSSR                                     CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'Y'       CFF007  1                       CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CFF007                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                                       CER001
      ** Check if switchable feature ULX004 is installed                                      CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD                                               CER001
     C                     PARM '*VERIFY' POPTN                                               CER001
     C                     PARM 'ULX004'  PSARD                                               CER001
     C           SCSARD    PARM SCSARD    @DSFDY                                              CER001
     C           PRTCD     IFEQ *BLANK                                                        CER001
     C                     MOVE 'Y'       ULX004  1                                           CER001
     C                     ELSE                                                               CER001
     C                     MOVE 'N'       ULX004                                              CER001
     C           PRTCD     IFNE '*NRF    '                                                    CER001
     C                     MOVEL'SCSARDPD'DBFILE                                              CER001
     C                     Z-ADD16        DBASE            **************                     CER001
     C                     MOVEL'ULX004'  DBKEY            *DB ERROR 016*                     CER001
     C                     EXSR *PSSR                      **************                     CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
      ** Check if switchable feature ULX043 is installed                                      CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD                                               CER001
     C                     PARM '*VERIFY' POPTN                                               CER001
     C                     PARM 'ULX043'  PSARD                                               CER001
     C           SCSARD    PARM SCSARD    @DSFDY                                              CER001
     C           PRTCD     IFEQ *BLANK                                                        CER001
     C                     MOVE 'Y'       ULX043  1                                           CER001
     C                     ELSE                                                               CER001
     C                     MOVE 'N'       ULX043                                              CER001
     C           PRTCD     IFNE '*NRF    '                                                    CER001
     C                     MOVEL'SCSARDPD'DBFILE                                              CER001
     C                     Z-ADD17        DBASE            **************                     CER001
     C                     MOVEL'ULX043'  DBKEY            *DB ERROR 017*                     CER001
     C                     EXSR *PSSR                      **************                     CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           *LIKE     DEFN ACTN      ACTCD                                               CER001
     C           *LIKE     DEFN ISTT      #ISST                                               CER001
     C*
     C           XTINIT    ENDSR                           ** XTINIT ESR**
     C*===================================================================
      /EJECT
      ********************************************************************
      **
      ** START S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: VALIDK TO VALIDATE KEY FIELDS IF ENTERED
      **
      ********************************************************************
     C*
     C           START     BEGSR                           ** START BSR **
     C*
      ** INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'001'     *IN,21
     C                     MOVEA'0'       *IN,26
     C                     MOVEL*BLANK    SCRCTL
     C*********************MOVELINF,1     INFMSG                          E16369
     C                     MOVEL*BLANK    ERRMSG
     C*
      ** CLEAR WHOLE SCREEN
     C*
     C                     WRITEFF0150F3
     C*
      ** PERFORM UNTIL CHANGE OF REQUEST (TO END/REVIEW/DETAIL)
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
      ** OUTPUT START SCREEN AND READ IN
     C*
     C                     MOVELINF,1     INFMSG                          E16369
     C*********************WRITEFF0150F1                                  CAAA02
     C                     WRITEFF0150F2
     C                     WRITEFF0150F1                                  CAAA02
     C                     READ FF0150F1                 99
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEA*BLANK    ERR
     C*
      ** KEY FIELDS SCREEN OUTPUT - READ UNTIL REQUEST TO PROCESS
     C*
      **  CK3, HELP, OR ENTER CAN BE TAKEN
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
      ** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C***HELP*-*CALL HELP PROGRAM                                         S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVELHERCD     ERRMSG                          S01199
     C***********                                                         S01199
     C***IF*ERRORS ARE PRESENT, HIGHLIGHT MESSAGE LINE                    S01199
     C***********                                                         S01199
     C***********ERRMSG    IFNE *BLANK                                    S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********                                                         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C*********************READ FF0150F1                 99               E19366
     C***********                                                         S01199
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C*********************EXSR ASCHGS                             S01179 E19366
     C*                                                                   S01179
     C***END*OF*HELP*PROCESSING                                           S01199
     C***********                                                         S01199
     C***********          END                                            S01199
     C*
      ** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C           AID       IFEQ 'RA'
     C                     EXSR VALIDK
     C*
      ** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C*
      **  - IF INSTRUMENT TYPE KEY FIELD IS BLANK, FORMAT FOR A REVIEW
     C*
     C           ISTT      IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
      **  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
      ** SET OFF INDICATOR CONDITIONING F12
     C*
     C                     MOVEA'0'       *IN,23
      ** IF AMEND, AND SSF IS ON, SET SCREEN INDICATOR
      ** DISALLOWING AMENDMENT OF ISCY, ISPT, TKDM AND OTHC.
     C*
     C           ACTN      IFEQ 'A'
     C***********SFLG      ANDEQ1                                         S01117
     C           SSF       ANDEQ'Y'                                       S01117
     C                     SETON                     26
     C                     END
     C*
      ** END OF PROCESSING FOR CLEAN OF ERRORS
     C*
     C                     END
     C*
      ** END OF ENTER PROCESSING
     C*
     C                     END
     C*
      ** END OF START SCREEN PROCESSING LOOP
     C*
     C                     END
     C*
     C           XTSTAR    ENDSR                           ** XTSTAR ESR**
     C*
      /EJECT
     C********************************************************************
      **
      ** REVIEW S/R TO PROCESS SUBFILE SELECTION SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS NO OTHER ROUTINES
      **
     C********************************************************************
     C*
     C           REVIEW    BEGSR                           ** REVIEW BSR**
     C*
      ** SET OFF PROCESS REVIEW INDICATOR
      ** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEA'0'       *IN,26
     C                     MOVEA'0'       *IN,11
     C                     MOVEL'RA'      AID
     C*
      ** PERFORM UNTIL CHANGE OF REQUEST (TO END/KEY SCREEN/DETAIL)
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
      ** SUBFILE PROCESSING - ROLLUP, ROLLDOWN OR ENTER
     C*
      ** REBUILD SUBFILE
     C*
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
      ** WRITE CONTROL RECORD
     C*
     C                     MOVEA'000'     *IN,1
     C                     Z-ADD*ZERO     RRN
     C                     WRITEFF0150C0
     C                     MOVEA'1'       *IN,4
     C*
      ** SET FILE POINTER - PAGE BACK
     C*
     C           AID       IFEQ 'DN'
     C                     MOVEL'N'       ISTI
     C                     MOVEL*BLANK    ISTT
     C                     MOVEL*BLANK    PPAGK   5
     C           INTP1K    SETLLINTYP1X
     C*
      **  - PAGE FORWARD
     C*
     C                     ELSE
     C                     MOVEL'N'       ISTI
     C                     MOVELPISTT     ISTT
     C                     MOVELPISTT     PPAGK
     C           INTP1K    SETLLINTYP1X
     C                     END
     C*
      ** READ IN DETAILS-FILL UP SUBFILE
     C*
     C                     MOVEL*BLANK    MKTN
     C*
     C           RRN       DOUEQ18
     C           MRKT      ORNE MRKTIN
     C           *IN,03    OREQ '1'
     C*
      ** READ DETAILS UNTIL SUBFILE PAGE IS FULL
      ** OR MRKT CHANGES FROM THAT OF 1ST READ
     C*
     C                     READ INTYP1X                  03
     C*
      ** IF END OF MARKET INSTRUMENT RECORDS REACHED THEN EOF
     C*
     C           ISTI      IFEQ 'Y'
     C                     SETON                         03
     C                     END
     C*
     C           *IN,03    IFEQ '0'
     C*
      ** IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'D'       STAT    1
     C                     ELSE
     C                     MOVEL*BLANK    STAT
     C                     END
     C*
     C                     ADD  1         RRN     40     04
     C*
      ** FIRST TIME OUTPUT TO SUBFILE-SO STORE RECORD MRKT
     C*
     C           RRN       IFEQ 1
     C                     MOVELMRKT      MRKTIN  2
     C*
      ** GET MARKET NAME TO DISPLAY ON REVIEW SCREEN
     C*
     C           MRKT      CHAINMARKT                99
     C*
     C                     END
     C*
      ** OUTPUT TO SUBFILE AS LONG AS MRKT OF RECORD JUST READ IS SAME
      ** AS THAT FROM THE 1ST RECORD OUTPUT TO THE SUBFILE ON THIS PAGE
     C*
     C           MRKT      IFEQ MRKTIN
     C                     WRITEFF0150S0
     C                     END
     C*
      ** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END
     C*
      ** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
      **  READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C           *IN,03    IFEQ '0'
     C           MRKT      ANDEQMRKTIN
     C                     READ INTYP1X                  03
     C                     END
     C*
      ** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN,03    IFEQ '0'
     C                     MOVELISTT      PISTT
     C                     ELSE
     C                     MOVEL*BLANK    PISTT
     C                     END
     C*
      ** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C                     MOVEA'010'     *IN,1
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
     C*
      ** END OF PAGING PROCESSING
     C*
     C                     END
     C*
      ** OUTPUT REVIEW SCREEN AND READ REQUEST
     C*
     C           *IN04     IFEQ '0'
     C                     MOVELINF,2     INFMSG
     C                     ELSE
     C                     MOVELINF,12    INFMSG
     C                     END
     C*********************WRITEFF0150C0                                  CAAA02
     C                     WRITEFF0150F2
     C                     WRITEFF0150C0                                  CAAA02
     C                     READ FF0150C0                 99
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEA*BLANK    ERR
     C                     MOVEL*BLANK    REVW
     C*
      ** PROCESS REQUEST - F3, F12, HELP OR RECORD SELECT
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
      ** CK3
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C                     END
     C*
      ** CK12
     C*
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C                     END
     C***********                                                         S01199
     C****HELP***                                                         S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C************         MOVELHERCD     ERRMSG                          S01199
     C************                                                        S01199
     C***HIGHLIGHT IF ERROR                                               S01199
     C************                                                        S01199
     C***********ERRMSG    IFNE *BLANK                                    S01199
     C************         MOVELHI        ERRMSG                          S01199
     C************         END                                            S01199
     C************                                                        S01199
     C************         CALL 'MHELP'                                   S01199
     C************         PARM           HBPGM                           S01199
     C************         PARM           HERCD                           S01199
     C************         READ FF0150C0                 99               S01199
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C**********           END                                            S01199
     C*
      ** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C           AID       IFEQ 'RA'
     C                     MOVEA'1'       *IN,99
     C           *IN,04    IFEQ '0'
     C                     READCFF0150S0                 99
     C                     END
     C*
      ** VALIDATE RECORD SELECTION
     C*
     C           *IN99     IFEQ '0'
     C                     EXSR VALIDK
     C*
      ** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C*
      ** IF AMEND, AND SSF IS ON, SET SCREEN INDICATOR
      ** DISALLOWING AMENDMENT OF ISCY, ISPT, TKDM AND OTHC.
     C*
     C           ACTN      IFEQ 'A'
     C***********SFLG      ANDEQ1                                         S01117
     C           SSF       ANDEQ'Y'                                       S01117
     C                     SETON                     26
     C                     END
     C                     END
     C*
      ** END OF RECORD VALIDATION
     C*
     C                     END
     C*
      ** END OF ENTER PROCESSING
     C*
     C                     END
     C*
      ** END OF PROCESSING LOOP
     C*
     C                     END
     C*
     C           XTREVI    ENDSR                           ** XTREVI ESR**
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
      **
      ** UPDATE S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: VALIDD, UPDFLS, INITRC, TRSFS, DEFLTS
      **
     C********************************************************************
     C*
     C           UPDATE    BEGSR                           ** UPDATE BSR**
     C*
      ** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
      ** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C                     SETOF                     070809
     C                     SETOF                     131415
     C                     SETOF                     171819
     C                     SETOF                     272829
     C                     MOVEA'10000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'0000'    *IN,74
     C                     MOVEA'00'      *IN,78
     C                     MOVE '0'       *IN80                           AUS022
     C                     MOVEA'0'       *IN,81                          FF0011
     C                     MOVEA'0'       *IN,82                          S01393
     C                     MOVEA'0'       *IN,86                          S01235
     C*                                                                   CPL002
     C*  DO NOT REINITIALISE SCREEN IF F/12                               CPL002
     C*                                                                   CPL002
     C           AID       IFNE '05'                                      CPL002
     C*
      ** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
      ** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C                     MOVEL'N'       ISTI
     C           INTP1K    CHAININTYP1X              99
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
      ** IF INSERT (NEW OR OVER DELETED RECORD)
      ** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
     C                     END
     C*
      ** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'E'       ACTN
     C                     MOVEL'DELETED' DELT
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
     C*
      ** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     EXSR TRSFS
     C*
      ** DATABASE ERROR CAN OCCUR IN TRSFS - EXIT S/R
     C*
     C           *INU7     CABEQ'1'       XTUPDT
     C*
      ** SET UP DEFAULTS (DONE ON BLANK FIELDS)
     C*
     C                     EXSR DEFLTS
     C*                                                                   CPL002
     C                     ENDIF                                          CPL002
     C*
      ** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/FF0150F0
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C                     MOVEA'1'       *IN,6
     C                     END
     C*                                                                   083884
      ** IF AMEND AND THERE ARE OUTSTANDING POSITIONS FOR THIS            083884
      ** INSTRUMENT, PROTECT FIELDS                                       083884
     C*                                                                   083884
     C                     SETOF                     83                   083884
     C           ACTN      IFEQ 'A'                                       083884
     C           ISTT      CHAINPOSTNCO              99                   083884
     C           *IN99     IFEQ '1'                                       083884
     C           ISTT      CHAINPOSTNKO              99                   083884
     C                     END                                            083884
      *                                                                   083884
     C           *IN99     IFEQ '0'                                       083884
     C           RECI      ANDEQ'D'                                       083884
     C                     SETON                     83                   083884
     C                     END                                            083884
      *                                                                   083884
     C                     END                                            083884
     C*
      ** PERFORM UNTIL CHANGE OF REQUEST
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C           *IN42     OREQ '1'                                       CPL002
     C*
      ** FORMAT INFORMATIONAL MESSAGE IF NOT ALREADY PRESENT
     C*
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,3     INFMSG
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C*                                                                   S01393
     C** Use linked enquiry text message if program called as such.       S01393
     C*                                                                   S01393
     C**********           MOVELINF,5     INFMSG                          S01393
     C  N85                MOVELINF,5     INFMSG                          S01393
     C   85                MOVELINF,13    INFMSG                          S01393
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,6     INFMSG
     C                     END
     C                     END
     C*
      ** OUTPUT DETAIL SCREEN AND READ - SAVE OLD SCREEN FOR COMPARISON
     C*
     C           *LIKE     DEFN DETS      DETO
     C                     MOVELDETS      DETO
     C                     WRITEFF0150F1
     C*********************WRITEFF0150F0                                  CAAA02
     C                     WRITEFF0150F2
     C                     WRITEFF0150F0                                  CAAA02
     C                     READ FF0150F0                 99
     C                     MOVEAERR       HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVELHERCD     WERC    2
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEA*BLANK    ERR
     C                     MOVEA*BLANK    WER
     C*
      ** CMD3, CMD12, HELP, OR ROLL REQUEST PROCESSING
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
      ** CK3
      ** Set exit parameter if program called as linked enquiry           S01393
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C   85                MOVE 'EXIT'    PPRTCD                          S01393
     C                     END
     C*
      ** CK12
      ** Set exit parameter if program called as a linked enquiry         S01393
      ** and force program to terminate.                                  S01393
     C*
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C   85                MOVE 'PREV'    PPRTCD                          S01393
     C   85                MOVE '01'      AID                             S01393
     C                     END
     C*
     C***HELP****                                                         S01199
     C***********                                                         S01199
     C***********AID       IFEQ 'HP'                                      S01199
     C***********          MOVEAHERCD     ERR                             S01199
     C***********                                                         S01199
     C***HIGHLIGHT ERROR IF ONE EXISTS                                    S01199
     C***********                                                         S01199
     C***********ERR,1     IFNE *BLANK                                    S01199
     C***********          MOVEAERR       ERRMSG                          S01199
     C***********          MOVELHI        ERRMSG                          S01199
     C***********          END                                            S01199
     C***********                                                         S01199
     C***********                                                         S01199
     C***FORMAT*SECOND HALF OF ERROR BANK IF PRESENT                      S01199
     C***********                                                         S01199
     C***********ERR,20    IFNE *BLANK                                    S01199
     C***********          MOVEAERR,20    INFMSG                          S01199
     C***********          MOVELHI        INFMSG                          S01199
     C***********          END                                            S01199
     C***********                                                         S01199
     C***********          CALL 'MHELP'                                   S01199
     C***********          PARM           HBPGM                           S01199
     C***********          PARM           HERCD                           S01199
     C***********          READ FF0150F0                 99               S01199
     C***Call*S/R to move values into AID                                 S01179
     C***********                                                         S01179
     C***********          EXSR ASCHGS                                    S01179
     C***********                                                         S01179
     C***********          END
     C*
      ** PAGE FORWARD TAKEN, READ NEXT RECORD
     C*
     C           AID       IFEQ 'UP'
     C           ACTN      ANDNE'I'
     C                     READ INTYP1X                  12
     C*
      ** END OF MARKET INSTRUMENTS ON FILE
     C*
     C           *IN12     IFEQ '0'
     C           ISTI      ANDEQ'Y'
     C                     SETON                     12
     C                     READPINTYP1X                  99
     C                     END
     C*
     C*
      ** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,7     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C                     END
     C*
      ** PAGE BACK TAKEN, READ PREVIOUS RECORD
     C*
     C           AID       IFEQ 'DN'
     C           ACTN      ANDNE'I'
     C                     READPINTYP1X                  12
     C*
      ** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C                     END
     C*
      ** ENTER PRESSED/F10 TAKEN
      ** Set exit parameter if program called as a linked enquiry         S01393
      ** and force program to terminate.                                  S01393
     C*
     C           AID       IFEQ 'RA'
     C           AID       OREQ '04'
     C   85                MOVE 'PREV'    PPRTCD                          S01393
     C   85                MOVE '01'      AID                             S01393
     C*
      ** VALIDATE DETAIL SCREEN INPUT UNLESS THERE IS NO CHANGE SINCE
      ** WARNING ERRORS WERE ISSUED
     C*
     C           DETS      IFNE DETO
     C           WERC      ORNE ' W'
     C                     EXSR VALIDD
     C/COPY WNCPYSRC,FF0150C008
     C                     END
      *                                                                                       CER001
     C                     MOVE *BLANK    RTNCDE 10                                           CER001
     C                     MOVE *BLANK    W0RTN   7                                           CER001
      *                                                                                       CER001
     C           ULX004    IFEQ 'Y'                                                           CER001
     C                     CALL 'FF0152'                                                      CER001
     C                     PARM *BLANKS   RTNCDE                                              CER001
     C                     PARM ACTN      ACTCD                                               CER001
     C                     PARM ISTT      #ISST                                               CER001
     C                     PARM           W0RTN                                               CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVEA'1'       *IN,10                                              CER001
     C                     MOVE '01'      AID                                                 CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C           *IN85     IFEQ *OFF                                                          CER001
     C                     MOVEA'1'       *IN,10                                              CER001
     C                     ELSE                                                               CER001
     C                     MOVEA'1'       *IN,12                                              CER001
     C                     ENDIF                                                              CER001
     C                     MOVE '05'      AID                                                 CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           W0RTN     IFEQ *BLANK                                                        CER001
     C           ULX043    ANDEQ'Y'                                                           CER001
     C                     CALL 'FF0153'                                                      CER001
     C                     PARM *BLANKS   RTNCDE                                              CER001
     C                     PARM ACTN      ACTCD                                               CER001
     C                     PARM ISTT      #ISST                                               CER001
     C                     PARM           W0RTN                                               CER001
     C           W0RTN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVEA'1'       *IN,10                                              CER001
     C                     MOVE '01'      AID                                                 CER001
     C                     ENDIF                                                              CER001
     C           W0RTN     IFEQ 'USR0790'                                                     CER001
     C                     MOVEA'1'       *IN,10                                              CER001
     C                     MOVE '05'      AID                                                 CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     ENDIF                                                              CER001
     C*
      ** N O    D E T A I L   S C R E E N    E R R O R S    -  S T A R T
     C*                                                                   CPL002
      ** PROCEED TO SECOND SCREEN IF APPROPRIATE                          CPL002
     C*
     C           SCRMSG    IFEQ *BLANK
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0150CCP2                                           S01408
     C*                                                                   S01408
      *                                                                   CFF007
      ** If enhancement CFF007 and PB module are installed,               CFF007
      ** execute SRDTS3 S/R                                               CFF007
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C           W2ND      ANDNE'Y'                                                          BUG2234
     C*                                                                   CFF007
     C           ACTN      IFEQ 'I'                                       CFF007
     C           ACTN      OREQ 'A'                                       CFF007
     C           ACTN      OREQ 'E'                                       CFF007
      *                                                                   CFF007
     C                     EXSR SRDTS3                                    CFF007
     C                     MOVEA'000000'  *IN,31                          CFF007
      *                                                                   CFF007
     C           AID       IFEQ '01'                                      CFF007
     C                     LEAVE                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           AID       IFEQ '05'                                      CFF007
     C                     MOVE '0'       *IN10                           CFF007
     C                     MOVE UNSE      SUNSE                           CFF007
     C                     MOVE TECO      STECO                           CFF007
     C                     MOVE TNAT      STNAT                           CFF007
     C                     MOVE CRIK      SCRIK                           CFF007
     C                     MOVE CCYR      SCCYR                           CFF007
      *                                                                   CFF007
     C           TWEI      IFNE *ZERO                                     CFF007
     C                     MOVE TWEI      STWEI                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE *BLANK    STWEI                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     SELEC                                          CFF007
     C           ACTN      WHEQ 'A'                                       CFF007
     C                     MOVELINF,14    INFMSG                          CFF007
     C           ACTN      WHEQ 'I'                                       CFF007
     C                     MOVELINF,15    INFMSG                          CFF007
     C                     OTHER                                          CFF007
     C                     MOVE *BLANKS   INFMSG                          CFF007
     C                     ENDSL                                          CFF007
      *                                                                   CFF007
     C                     ITER                                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*
      ** DETERMINE NEXT SCREEN TO BE DISPLAYED - REVIEW OR KEY
     C*
     C           W2ND      IFEQ 'Y'                                       CPL002
     C                     MOVEA'1'       *IN,42                          CPL002
     C                     MOVEA'00'      *IN,10                                             BUG2234
     C                     ELSE                                           CPL002
     C           REVW      IFEQ 'Y'
     C                     MOVELPPAGK     PISTT
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
     C/COPY WNCPYSRC,FF0150C007
     C                     END                                            CPL002
     C/COPY WNCPYSRC,FF0150C017
     C*
      ** UPDATE FILES IF LAST ACTION WAS NOT ENQUIRE
      ** AND ONLY IF MIDAS-PLATO SCREEN IS NOT TO BE SHOWN                CPL002
     C*
     C           BGN2ST    IFEQ 'N'                                       CPL002
     C           SISPT     OREQ '2'                                       CPL002
     C           SISPT     OREQ '5'                                       CPL002
     C           ACTN      OREQ 'D'                                       CPL002
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR UPDFLS
     C                     END
     C                     ENDIF                                          CPL002
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0150CCP3                                           S01408
     C*                                                                   S01408
     C*
      ** END OF CLEAR OF ERRORS PROCESSING
     C*
     C                     END
     C*
      ** END OF ENTER/F10 PROCESSING
     C*
     C                     END
     C*
      ** END OF PROCESSING LOOP
     C*
     C                     END
     C*
      ** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*
     C           XTUPDT    ENDSR                           ** XTUPDA ESR**
     C********************************************************************
     C/COPY WNCPYSRC,FF0150C009
      ********************************************************************CFF007
      **                                                                  CFF007
      ** SRDTS3 S/R to process detail screen 3                            CFF007
      **                                                                  CFF007
      ** CALLED BY: UPDATE, UPDAT2                                        CFF007
      **                                                                  CFF007
      ** CALLS: ASCHGS, SRROLL, SRVLD3                                    CFF007
      **                                                                  CFF007
      ********************************************************************CFF007
      *                                                                   CFF007
     C           SRDTS3    BEGSR                                          CFF007
      *                                                                   CFF007
      ** Perform until change of request                                  CFF007
      *                                                                   CFF007
     C           *IN10     DOUEQ'1'                                       CFF007
     C           *IN11     OREQ '1'                                       CFF007
     C           *IN12     OREQ '1'                                       CFF007
      *                                                                   CFF007
      ** Format informational message if not already present              CFF007
      *                                                                   CFF007
     C           INFMSG    IFEQ *BLANKS                                   CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'I'                                       CFF007
     C                     MOVELINF,3     INFMSG                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'A'                                       CFF007
     C                     MOVELINF,4     INFMSG                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'E'                                       CFF007
      *                                                                   CFF007
      ** Use linked enquiry text message if program called as such.       CFF007
      *                                                                   CFF007
     C           *IN85     IFEQ '0'                                       CFF007
     C                     MOVELINF,5     INFMSG                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVELINF,13    INFMSG                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     MOVE 'N'       WPRTEC  1                       CFF007
      *                                                                   CFF007
     C           BGSECS    IFEQ 'Y'                                       CFF007
      *                                                                   CFF007
     C           ISTT      SETLLTRANS13                                   CFF007
     C           ISTT      READETRANS13                  99               CFF007
      *                                                                   CFF007
     C           *IN99     DOWEQ'0'                                       CFF007
     C           WPRTEC    ANDEQ'N'                                       CFF007
      *                                                                   CFF007
     C           BLUP      IFEQ 'Y'                                       CFF007
     C           NOCO      ANDGT*ZEROS                                    CFF007
     C                     MOVE 'Y'       WPRTEC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           ISTT      READETRANS13                  99               CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** Display UNDERLYING SECURITY                                      CFF007
      *                                                                   CFF007
     C                     MOVE '0'       *IN37                           CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C                     MOVE '1'       *IN37                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If delete/enquire, protect fields                                CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'D'                                       CFF007
     C           ACTN      OREQ 'E'                                       CFF007
     C                     MOVE '1'       *IN38                           CFF007
     C                     ELSE                                                              BUG2234
     C                     MOVE '0'       *IN38                                              BUG2234
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Output detail screen and read (save old screen for comparison)   CFF007
      *                                                                   CFF007
     C                     WRITEFF0150F1                                  CFF007
     C                     WRITEFF0150F2                                  CFF007
     C                     EXFMTFF0150F5                                  CFF007
      *                                                                   CFF007
     C                     MOVEA'00000000'*IN,31                          CFF007
     C                     MOVEAERR       HERCD                           CFF007
     C                     MOVELWBLNK     HERCD                           CFF007
     C                     MOVELHERCD     WERC                            CFF007
     C                     MOVE *BLANKS   SCRMSG                          CFF007
     C                     MOVEA*BLANKS   ERR                             CFF007
     C                     MOVEA*BLANKS   WER                             CFF007
      *                                                                   CFF007
      ** CMD3, CMD12, HELP, or ROLL request processing                    CFF007
      *                                                                   CFF007
     C                     EXSR ASCHGS                                    CFF007
      *                                                                   CFF007
      ** CMD3                                                             CFF007
      ** Set exit parameter if program called as linked enquiry           CFF007
      *                                                                   CFF007
     C           AID       IFEQ '01'                                      CFF007
     C                     MOVE '1'       *IN12                           CFF007
      *                                                                   CFF007
     C           *IN85     IFEQ '1'                                       CFF007
     C                     MOVE 'EXIT'    PPRTCD                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** CMD12                                                            CFF007
      *                                                                   CFF007
     C           AID       IFEQ '05'                                      CFF007
     C                     MOVE '1'       *IN10                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** PAGE FORWARD taken, read next record                             CFF007
      *                                                                   CFF007
     C           AID       IFEQ 'UP'                                      CFF007
     C           ACTN      ANDNE'I'                                       CFF007
      *                                                                   CFF007
     C                     READ INTYP1X                  99               CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C           ISTI      ANDEQ'Y'                                       CFF007
     C           *IN99     OREQ '1'                                       CFF007
     C                     MOVELINF,7     INFMSG                          CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     READPINTYP1X                  99               CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     EXSR SRROLL                                    CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** PAGE BACK taken, read previous record                            CFF007
      *                                                                   CFF007
     C           AID       IFEQ 'DN'                                      CFF007
     C           ACTN      ANDNE'I'                                       CFF007
     C                     READPINTYP1X                  99               CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '1'                                       CFF007
     C                     MOVELINF,8     INFMSG                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     EXSR SRROLL                                    CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** ENTER pressed/F10 taken                                          CFF007
      ** Set exit parameter if program called as a linked enquiry         CFF007
      ** and force program to terminate.                                  CFF007
      *                                                                   CFF007
     C           AID       IFEQ 'RA'                                      CFF007
     C           AID       OREQ '04'                                      CFF007
      *                                                                   CFF007
     C           *IN85     IFEQ '1'                                       CFF007
     C                     MOVE 'PREV'    PPRTCD                          CFF007
     C                     MOVE '01'      AID                             CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate detail screen input unless there is no change since     CFF007
      ** warning errors were issued                                       CFF007
      *                                                                   CFF007
     C           DETS      IFNE DETO                                      CFF007
     C           WERC      ORNE ' W'                                      CFF007
      *                                                                   CFF007
     C           ACTN      IFNE 'E'                                       CFF007
     C                     EXSR SRVLD3                                    CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If no detail screen errors                                       CFF007
      *                                                                   CFF007
     C           SCRMSG    IFEQ *BLANKS                                   CFF007
      *                                                                   CFF007
      ** Determine next screen to be displayed (REVIEW or KEY)            CFF007
      *                                                                   CFF007
     C           REVW      IFEQ 'Y'                                       CFF007
     C                     MOVELPPAGK     PISTT                           CFF007
     C                     MOVE '1'       *IN11                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN10                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** End of 'CLEAR OF ERRORS' processing                              CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** End of ENTER/F10 processing                                      CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** End of processing loop                                           CFF007
      *                                                                   CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
      ** End of SRDTS3 S/R                                                CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
     C********************************************************************CFF007
      /EJECT                                                              CFF007
     C********************************************************************CFF007
      **                                                                  CFF007
      ** SRROLL S/R to process rollup/rolldown request                    CFF007
      **                                                                  CFF007
      ** CALLED BY: SRDTS3                                                CFF007
      **                                                                  CFF007
      ** CALLS: TRSFS, DEFLTS                                             CFF007
      **                                                                  CFF007
     C********************************************************************CFF007
      *                                                                   CFF007
     C           SRROLL    BEGSR                                          CFF007
      *                                                                   CFF007
      ** Set screen indicators                                            CFF007
      *                                                                   CFF007
     C                     MOVE '1'       *IN05                           CFF007
     C                     MOVE '1'       *IN30                           CFF007
     C                     MOVEA'000'     *IN,07                          CFF007
     C                     MOVEA'0000'    *IN,12                          CFF007
     C                     MOVEA'000'     *IN,17                          CFF007
     C                     MOVEA'000'     *IN,27                          CFF007
     C                     MOVEA'00000000'*IN,31                          CFF007
     C                     MOVEA'00000000'*IN,39                          CFF007
     C                     MOVEA'00000000'*IN,47                          CFF007
     C                     MOVEA'0000000' *IN,55                          CFF007
     C                     MOVEA'0000000' *IN,74                          CFF007
     C                     MOVEA'00'      *IN,81                          CFF007
     C                     MOVE '0'       *IN86                           CFF007
      *                                                                   CFF007
      ** Access file record for old TNLU to check at update time;         CFF007
      ** If no record presently on file, zeroise stored TNLU              CFF007
      *                                                                   CFF007
     C                     Z-ADD*ZEROS    STNLU                           CFF007
     C                     MOVE 'N'       ISTI                            CFF007
     C           INTP1K    CHAININTYP1X              99                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     Z-ADDTNLU      STNLU                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If record is deleted                                             CFF007
      *                                                                   CFF007
     C           RECI      IFEQ '*'                                       CFF007
     C                     MOVE 'E'       ACTN                            CFF007
     C                     MOVEL'DELETED' DELT                            CFF007
     C                     ELSE                                           CFF007
     C                     MOVE *BLANKS   DELT                            CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Translate record details from file layout to screen layout       CFF007
      *                                                                   CFF007
     C                     EXSR TRSFS                                     CFF007
      *                                                                   CFF007
     C           *INU7     IFEQ '0'                                       CFF007
      *                                                                   CFF007
      ** Set up defaults                                                  CFF007
      *                                                                   CFF007
     C                     EXSR DEFLTS                                    CFF007
      *                                                                   CFF007
      ** If delete/enquire, protect fields                                CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'D'                                       CFF007
     C           ACTN      OREQ 'E'                                       CFF007
     C                     MOVE '1'       *IN38                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     MOVE '0'       *IN83                           CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'A'                                       CFF007
     C           ISTT      CHAINPOSTNCO              99                   CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '1'                                       CFF007
     C           ISTT      CHAINPOSTNKO              99                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C           RECI      ANDEQ'D'                                       CFF007
     C                     MOVE '1'       *IN83                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** End of SRROLL S/R                                                CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
     C********************************************************************CFF007
      /EJECT                                                              CPL002
     C********************************************************************CPL002
      **                                                                  CPL002
      ** UPDAT2 S/R TO PROCESS MIDAS-PLATO DETAIL SCREEN & UPDATE FILE    CPL002
      ** CALLED FROM MAIN PROCESSING                                      CPL002
      ** CALLS: VALID2, UPDFLS, INITR2, TRSFS2, DEFLT2                    CPL002
      **                                                                  CPL002
     C********************************************************************CPL002
     C*                                                                   CPL002
     C           UPDAT2    BEGSR                                          CPL002
     C*                                                                   CPL002
      ** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,         CPL002
      ** POSITION CURSOR                                                  CPL002
     C*                                                                   CPL002
      ** Save existing indicator values and reset for reuse.              CPL002
     C*                                                                   CPL002
     C                     SETOF                     42                   CPL002
     C                     MOVEA'11'      *IN,5                                              BUG2234
     C                     MOVEA*IN,30    W#I30  10                       CPL002
     C                     MOVEA*IN,60    W#I60   9                       CPL002
     C                     MOVEA'00000000'*IN,30                          CPL002
     C                     MOVEA'00'      *IN,38                          CPL002
     C                     MOVEA'00000000'*IN,60                          CPL002
     C                     MOVEA'0'       *IN,69                          CPL002
     C*                                                                   CPL002
      ** IF INSERT (NEW OR OVER DELETED RECORD)                           CPL002
      ** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)       CPL002
     C*                                                                   CPL002
     C           ACTN      IFEQ 'I'                                       CPL002
     C                     EXSR INITR2                                    CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT       CPL002
     C*                                                                   CPL002
     C                     EXSR TRSFS2                                    CPL002
     C*                                                                   CPL002
      ** SET UP DEFAULTS (DONE ON BLANK FIELDS)                           CPL002
     C*                                                                   CPL002
     C                     EXSR DEFLT2                                    CPL002
     C*                                                                   CPL002
      ** IF ENQUIRY PROTECT FIELD INPUT ON S/FF0150F4                     CPL002
     C*                                                                   CPL002
     C*                                                                   CPL002
     C           ACTN      IFEQ 'E'                                       CPL002
     C                     MOVEA'1'       *IN,65                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** PERFORM UNTIL CHANGE OF REQUEST                                  CPL002
     C*                                                                   CPL002
     C           *IN10     DOUEQ'1'                                       CPL002
     C           *IN11     OREQ '1'                                       CPL002
     C           *IN12     OREQ '1'                                       CPL002
     C           *IN42     OREQ '1'                                       CPL002
     C*                                                                   CPL002
      ** FORMAT INFORMATIONAL MESSAGE IF NOT ALREADY PRESENT              CPL002
     C*                                                                   CPL002
     C           ACTN      IFEQ 'I'                                       CPL002
     C                     MOVELINF,3     INFMSG                          CPL002
     C                     END                                            CPL002
     C           ACTN      IFEQ 'A'                                       CPL002
     C                     MOVELINF,14    INFMSG                          CPL002
     C                     END                                            CPL002
     C           ACTN      IFEQ 'E'                                       CPL002
     C*                                                                   CPL002
     C** Use linked enquiry text message if program called as such.       CPL002
     C*                                                                   CPL002
     C**N85*****           MOVELINF,15    INFMSG                                      CPL002 BUG2234
     C  N85                MOVELINF,5     INFMSG                                             BUG2234
     C   85                MOVELINF,13    INFMSG                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** OUTPUT DETAIL SCREEN AND READ - SAVE OLD SCREEN FOR COMPARISON   CPL002
     C*                                                                   CPL002
     C           *LIKE     DEFN DETS2     DETO2                           CPL002
     C                     MOVELDETS2     DETO2                           CPL002
     C                     WRITEFF0150F2                                  CPL002
     C                     EXFMTFF0150F4                                  CPL002
     C                     MOVEAERR       HERCD                           CPL002
     C                     MOVELWBLNK     HERCD                           CPL002
     C                     MOVELHERCD     WERC    2                       CPL002
     C                     MOVEL*BLANK    SCRMSG                          CPL002
     C                     MOVEA*BLANK    ERR                             CPL002
     C                     MOVEA*BLANK    WER                             CPL002
     C*                                                                   CPL002
      ** CMD3, CMD12, OR HELP REQUEST PROCESSING                          CPL002
     C*                                                                   CPL002
     C** Call S/R to move values into AID                                 CPL002
     C*                                                                   CPL002
     C                     EXSR ASCHGS                                    CPL002
     C*                                                                   CPL002
      ** CK3                                                              CPL002
      ** Set exit parameter                                               CPL002
     C*                                                                   CPL002
     C           AID       IFEQ '01'                                      CPL002
     C                     MOVEA'1'       *IN,12                          CPL002
     C   85                MOVE 'EXIT'    PPRTCD                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** CK12                                                             CPL002
      ** Set parameter to return to previous screen                       CPL002
     C*                                                                   CPL002
     C           AID       IFEQ '05'                                      CPL002
     C                     MOVEA'1'       *IN,12                          CPL002
     C   85                MOVE 'PREV'    PPRTCD                          CPL002
     C                     MOVEAW#I30     *IN,30                          CPL002
     C                     MOVEAW#I60     *IN,60                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** ENTER PRESSED/F10 TAKEN                                          CPL002
      ** Set exit parameter if program called as a linked enquiry         CPL002
      ** and force program to terminate.                                  CPL002
     C*                                                                   CPL002
     C           AID       IFEQ 'RA'                                      CPL002
     C           AID       OREQ '04'                                      CPL002
     C   85                MOVE 'PREV'    PPRTCD                          CPL002
     C   85                MOVE '01'      AID                             CPL002
     C*                                                                   CPL002
      ** VALIDATE DETAIL SCREEN INPUT UNLESS THERE IS NO CHANGE SINCE     CPL002
      ** WARNING ERRORS WERE ISSUED                                       CPL002
     C*                                                                   CPL002
     C           DETS2     IFNE DETO2                                     CPL002
     C           WERC      ORNE ' W'                                      CPL002
     C                     EXSR VALID2                                    CPL002
      *                                                                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** N O    D E T A I L   S C R E E N    E R R O R S    -  S T A R T  CPL002
     C*                                                                   CPL002
     C           SCRMSG    IFEQ *BLANK                                    CPL002
     C*                                                                   CPL002
     C*/C*PY*WNCPYSRC,FF0150CCP2**************************************                 CPL002 180523
     C/COPY WNCPYSRC,FF0150C018                                                               180523
     C*                                                                   CFF007
     C** If enhancement CFF007 and PB module are installed,               CFF007
     C** execute SRDTS3 S/R                                               CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C           ACTN      IFEQ 'I'                                       CFF007
     C           ACTN      OREQ 'A'                                       CFF007
     C           ACTN      OREQ 'E'                                       CFF007
     C*                                                                   CFF007
     C                     EXSR SRDTS3                                    CFF007
     C                     MOVEA'000000'  *IN,31                          CFF007
     C*                                                                   CFF007
     C           AID       IFEQ '01'                                      CFF007
     C                     LEAVE                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C           AID       IFEQ '05'                                      CFF007
     C                     MOVE '0'       *IN10                           CFF007
     C                     MOVE UNSE      SUNSE                           CFF007
     C                     MOVE TECO      STECO                           CFF007
     C                     MOVE TNAT      STNAT                           CFF007
     C                     MOVE CRIK      SCRIK                           CFF007
     C                     MOVE CCYR      SCCYR                           CFF007
      *                                                                   CFF007
     C           TWEI      IFNE *ZERO                                     CFF007
     C                     MOVE TWEI      STWEI                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE *BLANK    STWEI                           CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     SELEC                                          CFF007
     C           ACTN      WHEQ 'A'                                       CFF007
     C                     MOVELINF,14    INFMSG                          CFF007
     C           ACTN      WHEQ 'I'                                       CFF007
     C                     MOVELINF,15    INFMSG                          CFF007
     C                     OTHER                                          CFF007
     C                     MOVE *BLANKS   INFMSG                          CFF007
     C                     ENDSL                                          CFF007
     C*                                                                   CFF007
     C                     ITER                                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CPL002
     C*                                                                   CPL002
      ** DETERMINE NEXT SCREEN TO BE DISPLAYED - REVIEW OR KEY            CPL002
     C*                                                                   CPL002
     C           REVW      IFEQ 'Y'                                       CPL002
     C                     MOVELPPAGK     PISTT                           CPL002
     C                     MOVEA'1'       *IN,11                          CPL002
     C                     ELSE                                           CPL002
     C                     MOVEA'1'       *IN,10                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** UPDATE FILES IF LAST ACTION WAS NOT ENQUIRE                      CPL002
     C*                                                                   CPL002
     C           W2PRO     IFEQ 'Y'                                       CPL002
     C           ACTN      IFEQ 'I'                                       CPL002
     C           ACTN      OREQ 'A'                                       CPL002
     C                     EXSR UPDFLS                                    CPL002
     C                     END                                            CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
     C*/C*PY*WNCPYSRC,FF0150CCP3*****************************************              CPL002 180523
     C/COPY WNCPYSRC,FF0150C019                                                               180523
     C*                                                                   CPL002
     C*                                                                   CPL002
      ** END OF CLEAR OF ERRORS PROCESSING                                CPL002
     C*                                                                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** END OF ENTER/F10 PROCESSING                                      CPL002
     C*                                                                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** END OF PROCESSING LOOP                                           CPL002
     C*                                                                   CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** RESET PROTECT/NON-DISPLAY INDS                                   CPL002
     C*                                                                   CPL002
     C                     MOVEA'00'      *IN,5                           CPL002
     C*                                                                   CPL002
     C           XTUPD2    ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT
     C********************************************************************
      **           ****** AS400 CONVERSION ******                         S01179
      **                                                                  S01179
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,        S01179
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.                S01179
      ** CALLED FROM UPDATE                                               S01179
      **                                                                  S01179
     C*================================================================   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN45     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F10                                                            S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN40     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN40                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN41     IFEQ '1'                                       S01179
     C                     MOVE 'DN'      AID                             S01179
     C                     MOVE '0'       *IN41                           S01179
     C                     END                                            S01179
     C***********                                                   S01179S01199
     C**If*HELP*key pressed                                         S01179S01199
     C**********                                                    S01179S01199
     C************IN42     IFEQ '1'                                 S01179S01199
     C***********          MOVE 'HP'      AID                       S01179S01199
     C***********          MOVE '0'       *IN42                     S01179S01199
     C***********          END                                      S01179S01199
     C***********                                                   S01179S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*================================================================
      /EJECT
     C*================================================================
      ** VALIDK S/R TO VALIDATE KEY FIELDS
      ** CALLED FROM S/R START, REVIEW
      ** CALLS NO OTHER S/R'S
      **
     C********************************************************************
     C*
     C           VALIDK    BEGSR                           ** VALIDK BSR**
     C*
      ** RESET ERROR INDICATORS AND SET DEFAULT KEY FIELD FOR FILE
      ** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVEA'000'     *IN,20
     C                     Z-ADD*ZERO     EC      40
     C*
      ** VALIDATE ACTION CODE - MUST BE BLANK, I, A, E OR D
     C*
     C           ACTN      IFNE *BLANK
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C                     ADD  1         EC         20
     C                     MOVEL' 100'    ERR,EC
     C                     END
     C*                                                                   S01117
     C           ACTN      IFEQ 'I'                                       S01117
     C           ACTN      OREQ 'A'                                       S01117
     C           ACTN      OREQ 'E'                                       S01117
     C           ACTN      OREQ 'D'                                       S01117
     C*                                                                   S01117
     C**   IF SINGLE BRANCH ENVIRONMENT                                   S01117
     C                     MOVE '0'       *IN43            INT SPF ERR    S01117
     C           MBIN      IFEQ 'N'                                       S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     MOVE '1'       *IN43            SPF ERROR      S01117
     C                     ADD  1         EC         20                   S01117
     C                     MOVE ' 303'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   IF MULTIBRANCHING ENVIRONMENT                                  S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C**                                                                  S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     MOVE '1'       *IN43            SPF ERROR      S01117
     C                     ADD  1         EC         20                   S01117
     C                     MOVE ' 304'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN43     IFEQ '1'                                       S01117
     C                     GOTO XVALI                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
      ** ACTION CODE BLANK - CROSS VALIDATE WITH REFERENCE;
      ** KEY SHOULD ALSO BE BLANK
     C*
     C           ACTN      IFEQ *BLANK
     C           ISTT      ANDNE*BLANK
     C*
     C                     ADD  1         EC         20
     C                     MOVEL' 101'    ERR,EC
     C*
     C                     END
     C*
      ** IF ACTION CODE ENTERED KEY SHOULD BE ENTERED AND MRKT SHOULD     E19366
      ** NOT BE BLANK                                                     E19366
     C*
     C           ACTN      IFNE *BLANK
     C           ISTT      ANDEQ*BLANK
     C           MRKT      OREQ *BLANK                                    E19366
     C           ACTN      ANDNE*BLANK                                    E21614
     C*
     C                     ADD  1         EC         20
     C                     MOVEL' 101'    ERR,EC
     C*
     C                     END
     C*
      ** IF ACTION CODE IS 'D',SYSTEM SET UP FLAG MUST NOT BE ON
     C*
     C           ACTN      IFEQ 'D'
     C***********SFLG      ANDEQ1                                         S01117
     C           SSF       ANDEQ'Y'                                       S01117
     C                     ADD  1         EC         20
     C                     MOVEL' 102'    ERR,EC
     C                     END
     C*
      ** N O   E R R O R  O N  K E Y  F I E L D S
     C*
     C           *IN,20    IFEQ '0'
     C*
      ** VALIDATE MARKET CENTRE
     C*
      **  IF ENTERED,INSTRUMENT CODE MUST BE ENTERED
     C*
     C           MRKT      IFNE *BLANK
     C           ISTC      ANDEQ*BLANK
     C                     ADD  1         EC         21
     C                     MOVEL' 103'    ERR,EC
     C                     END
     C*
      ** IF ENTERED A MARKET CODE MUST EXIST ON MARKTD
     C*
     C           MRKT      IFNE *BLANK
     C           MRKT      CHAINMARKT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         21
     C                     MOVEL' 104'    ERR,EC
     C                     ELSE
     C*
      ** IF MARKET CENTRE FOUND, EOC FOR MARKET MUST NOT BE ACTIVE
     C*
     C           MRKT      CHAINMKCTL                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
      ** DATABASE ERROR IF MARKET CONTROL RECORD NOT FOUND.
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELMRKT      DBKEY
     C                     MOVE 'MKCTL'   DBFILE
     C***********          MOVE '06'      DBASE            ***************S01117
     C                     Z-ADD6         DBASE            ***************S01117
     C                     SETON                     U7U8LR* DB ERROR 06 *
     C                     OUT  LDA                        ***************S01117
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C           MKCI      IFEQ 'E'
     C                     ADD  1         EC         21
     C                     MOVEL' 105'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
      **  VALIDATE INSTRUMENT CODE AGAINST ACTION, IF INPUT IS VALID
     C*
     C           *IN20     IFEQ '0'
     C           *IN21     ANDEQ'0'
     C*
      ** A C T I O N  C O D E   I - NO LIVE RECORD TO EXIST
     C*
     C           ACTN      IFEQ 'I'
     C*
      ** CHECK FOR MKT/INSTR REFERENCE ALREADY ON FILE
     C*
     C                     MOVE 'N'       ISTI
     C           INTP1K    CHAININTYP1X              99
     C*
      ** IF LIVE RECORD FOUND, ERROR.
     C*
     C           *IN99     IFEQ '0'
     C***        RECI      ANDEQ'D'                                       E15872
     C           RECI      IFEQ 'D'                                       E15872
     C           RECI      OREQ '*'                                       E15872
     C                     ADD  1         EC         22
     C                     MOVEL' 106'    ERR,EC
     C                     END
     C                     END                                            E15872
     C*
      ** CHECK FOR OTC REFERENCE ALREADY ON FILE
     C*
     C                     MOVE 'Y'       ISTI
     C           INTP1K    CHAININTYP1X              99
     C*
      ** IF LIVE RECORD FOUND, ERROR.
     C*
     C           *IN99     IFEQ '0'
     C***        RECI      ANDEQ'D'                                       E15872
     C           RECI      IFEQ 'D'                                       E15872
     C           RECI      OREQ '*'                                       E15872
     C                     ADD  1         EC         22
     C                     MOVEL' 107'    ERR,EC
     C                     END
     C                     END                                            E15872
     C*
      ** END OF INSERT
     C*
     C                     END
     C*
      ** A C T I O N    C O D E  A , D   -  LIVE  RECORD MUST EXIST
     C*
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C                     MOVE 'N'       ISTI
     C           INTP1K    CHAININTYP1X              99
     C*
      ** NO LIVE RECORD FOUND, ERROR
     C*
     C           *IN99     IFEQ '1'
     C           RECI      OREQ '*'
     C                     ADD  1         EC         22
     C                     MOVEL' 108'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** A C T I O N    C O D E    E  - RECORD MUST BE ON FILE
     C*
     C           ACTN      IFEQ 'E'
     C                     MOVE 'N'       ISTI
     C           INTP1K    CHAININTYP1X              99
     C*
      ** NO RECORD FOUND
     C*
     C           *IN99     IFEQ '1'
     C***        RECI      OREQ '*'                                       E15872
     C                     ADD  1         EC         22
     C                     MOVEL' 109'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** IF DELETION REQUESTED, NO OUTSTANDING POSITIONS ALLOWED
     C*
     C           ACTN      IFEQ 'D'
     C***********ISTT      CHAINPOSTN2               99                   S01299
      *                                                                   S01299
     C********** ISTT      CHAINPOSTNCO              99                                S01299 198555
     C           ISTT      CHAINPOSTNC6              99                                       198555
     C           *IN99     IFEQ '1'                                       S01299
     C********** ISTT      CHAINPOSTNKO              99                                S01299 198555
     C           ISTT      CHAINPOSTNK6              99                                       198555
     C                     END                                            S01299
      *                                                                   S01299
      ** IF DELETION REQUESTED, NO TRANSACTION MUST EXIST ON TRANSD       101432
     C           *IN99     IFEQ '1'                        - B3           101432
     C           ISTT      CHAINTRANS13              84                   101432
     C*                                                                   101432
     C           *IN84     IFEQ '0'                        - B4           101432
     C                     MOVE '0'       *IN99                           101432
     C                     END                             - E4           101432
     C*                                                                   101432
     C                     END                             - E3           101432
     C* If *in99 is off, there are still positions and/or transactions    101432
     C*
     C           *IN99     IFEQ '0'
     C***********RECI      ANDEQ'D'                                       101432
     C                     ADD  1         EC         22
     C                     MOVEL' 110'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** IF ACTION CODE IS 'D',NO ACTIVE CUSTOMER/INSTRUMENT ALLOWED
     C*
     C           ACTN      IFEQ 'D'
     C           DFLTK1    CHAINDEFLT1               99
     C*
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C********** RVDT      ANDLERUND                                                        BUG10462
     C                     ADD  1         EC         22
     C                     MOVEL' 111'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** END OF CROSSREF VALIDATION
     C*
     C                     END
     C           XVALI     TAG                                            S01117
     C*
      ** HIGHLIGHT ERRORS IF ANY OCCURRED
     C*
     C           EC        IFNE *ZERO
     C                     MOVEAERR       ERRMSG
     C                     MOVELHI        ERRMSG
     C                     MOVEL*BLANK    AID
     C                     END
     C*
     C           XTVALK    ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
      **
      ** VALIDD S/R - TO VALIDATE DETAIL SCREEN
      ** CALLED FROM UPDATE S/R
      ***CALLS:*DEFLTS;*ZEDIT;*ZALIGN;*ZDATE1;*ZDATE5*********************S01195
      ** CALLS: DEFLTS; ZEDIT; ZALIGN; ZDATE1                             S01195
      **
     C********************************************************************
     C*
     C           VALIDD    BEGSR
     C*
      ** RESET SCREEN ERROR INDICATORS
     C*
     C                     SETOF                     070809
     C                     SETOF                     131415
     C                     SETOF                     171819
     C                     SETOF                     272829
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'00000000'*IN,46
     C                     MOVEA'00000000'*IN,54
     C                     MOVEA'0000'    *IN,74
     C                     MOVEA'00'      *IN,78
     C                     MOVE '0'       *IN80                           AUS022
     C                     MOVEA'0'       *IN,81                          FF0011
     C                     MOVEA'0'       *IN,82                          S01393
     C*
      ** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C                     Z-ADD*ZERO     W       10
     C*
      ** ENTER KEY PRESSSED
     C*
     C           AID       IFEQ 'RA'
     C*
      ** ACTION = I OR A
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*
      ** DO DEFAULTS
     C*
     C                     EXSR DEFLTS
     C*
      ** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
      ** VALIDATE INSTRUMENT NAME - MUST BE ENTERED
     C*
     C           SISTN     IFEQ *BLANK
     C                     MOVEL'1'       *IN,30
     C                     ADD  1         EC         31
     C                     MOVEL' 201'    ERR,EC
     C                     END
     C*                                                                   S01235
      ** VALIDATE INSTRUMENT TYPE IF PORTFOLIO MGMT MODULE IS PRESENT     S01235
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C*                                                                   S01235
     C           BGPFMG    IFEQ 'Y'                        b1             S01235
     C           FCPORS    ANDNE'B'                                       CPM003
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C*                                                                   PMC143
     C           SINNR     IFEQ *BLANKS                    b2             PMC143
     C/COPY WNCPYSRC,FF0150C015
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           SINNR     OREQ FCDINR                                    PMC143
     C/COPY WNCPYSRC,FF0150C016
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCDINR    SINNR                           PMC143
     C                     MOVE *OFF      *IN86                           PMC143
     C                     ELSE                            x2             PMC143
     C                     CALL 'AOPLINR0'                                S01235
     C                     PARM *BLANKS   @RTCD   7                       S01235
     C                     PARM '*KEY   ' @OPTN   7                       S01235
     C                     PARM SINNR     @KEY    3                       S01235
     C           SDPLIN    PARM SDPLIN    @DSFDY                          S01235
     C           @RTCD     IFNE *BLANKS                    b3             S01235
     C           @RTCD     OREQ *BLANKS                                   S01235
     C           PDRECI    ANDNE'D'                                       PMC143
     C                     MOVE *ON       *IN86                           PMC143
     C                     ADD  1         EC                              S01235
     C                     MOVE '251'     ERR,EC                          S01235
     C                     ELSE                            x3             S01235
     C**************       MOVELSINNR     INNR                     S01235 185772
     C                     MOVELPDINNR    SINNR                           185772
     C                     END                             e3             PMC143
     C*                                                                   PMC143
     C                     END                             e2             S01235
     C*                                                                   S01235
     C                     END                             e1             S01235
     C*                                                                   S01235
     C*
      ***VALIDATE*PROCESSING*TYPE*-*MUST*BE*FROM*1-6******                AUS022
      ** VALIDATE PROCESSING TYPE - MUST BE FROM 1-8                      AUS022
     C*
     C           SISPT     IFLT '1'
     C***********SISPT     ORGT '6'                                       AUS022
     C           SISPT     ORGT '8'                                       AUS022
     C                     ADD  1         EC         32
     C                     MOVEL' 202'    ERR,EC
     C                     END
     C*
      ** VALIDATE INSTRUMENT CURRENCY
     C*
      ** MANDATORY FIELD
     C*
     C           SISCY     IFEQ *BLANK
     C                     ADD  1         EC         33
     C                     MOVEL' 203'    ERR,EC
     C                     END
     C*
      ***MUST*BE*ON*TABTG10*-*ERROR*IF*NOT*FOUND,*OR*STORE*DECIMAL*PLACES*S01117
      ** MUST BE ON SD - ERROR IF NOT FOUND, OR STORE DECIMAL PLACES      S01117
     C*
     C           SISCY     IFNE *BLANK
     C***********          MOVE SISCY     TCCY                            S01117
     C***********CCYK      CHAINTABFF                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SISCY     @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         33
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVEL' 304'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C                     MOVEL' 204'    ERR,EC
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE
     C                     MOVE CURR      SISCY                           S01117
     C                     Z-ADDCDP       ICDP    10
     C                     END
     C*
     C                     END
     C*
      ** ACCESS TABLE FILE FOR OTHER CCY DEC PLACES IF PTYP 2/5
     C*
     C           SISPT     IFEQ '2'
     C           SISPT     OREQ '5'
     C*
      ***MUST*BE*ON*TABTG10***********************************************S01117
      ** MUST BE ON SD                                                    S01117
     C*
     C           SOTHC     IFNE *BLANK
     C***********          MOVE SOTHC     TCCY                            S01117
     C***********CCYK      CHAINTABFF                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SOTHC     @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         59
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL '                                 S01117
     C                     MOVEL' 330'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C                     MOVEL' 230'    ERR,EC
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE
     C                     MOVE CURR      SOTHC                           S01117
     C                     Z-ADDCDP       OCDP    10
     C                     END
     C*
      ** MUST NOT BE BLANK FOR ABOVE PROCESSING TYPES
     C*
     C                     ELSE
     C                     MOVE '1'       *IN,59
     C                     END
     C*
     C                     END
     C*
      ** VALIDATE CONTINGENT AMOUNT
     C*
      ** MUST BE ENTERED
     C*
     C           SCTAM     IFEQ *BLANK
     C                     ADD  1         EC         34
     C                     MOVE ' 205'    ERR,EC
     C                     ELSE
     C*
      ** MUST BE VALID AMOUNT IN EITHER INSTRUMENT CCY, OR OTHER CCY IF
      ** PROCESSING TYPE IS 2/5
      ** CANNOT THEREFORE BE VALIDATED IF THESE ARE NOT VALID THEMSELVES
     C*
     C           *IN32     IFEQ '0'
     C*
      ** PROCESSING TYPE VALID
     C*
      ** SET INTEGER FIELD FOR ZALIGN TO ZERO - IF THIS CHANGES THEN
      ** PROCESSING MAY TAKE PLACE
     C*
     C                     Z-ADD0         ZADIG
     C*
      ** IF OTHER CCY REQUIRED AND VALID, SET UP OTHER CCY DECIMAL PLACES
     C*
     C           SISPT     IFEQ '2'
     C           *IN59     ANDEQ'0'
     C           SISPT     OREQ '5'
     C           *IN59     ANDEQ'0'
     C                     Z-ADDOCDP      ZADEC
     C           13        SUB  OCDP      ZADIG
     C                     END
     C*
      ** IF INSTRUMENT CCY RQD AND VALID, SET UP INSTRUMENT CDP
     C*
     C           SISPT     IFNE '2'
     C           SISPT     ANDNE'5'
     C           *IN33     ANDEQ'0'
     C                     Z-ADDICDP      ZADEC
     C           13        SUB  ICDP      ZADIG
     C                     END
     C*
     C           ZADIG     IFNE 0
     C*
      ** ABOVE PROCESSING HAS CHANGED ZADIG, THEREFORE VALID CASE FOUND
     C*
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SCTAM     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CTAM                            E14168
     C*
     C           *IN,99    IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C                     ADD  1         EC         34
     C                     MOVEL' 206'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE QUOTATION CONVENTION
     C*
     C           *LIKE     DEFN SQOTC     QDIG  - 1
     C           *LIKE     DEFN SQOTC     QSIGN - 1
     C                     MOVE SQOTC     QDIG
     C                     MOVELSQOTC     QSIGN
     C*
      ** CANNOT BE VALIDATED IF PROCESSING TYPE INVALID
     C*
     C           *IN32     IFEQ '0'
     C*
      ** NOT MANDATORY
     C*
     C           SQOTC     ANDNE*BLANK
     C*
      ** MUST ONLY BE ENTERED FOR PROCESSING TYPES 2&5
     C*
     C           SISPT     IFNE '2'
     C           SISPT     ANDNE'5'
     C                     ADD  1         EC         35
     C                     MOVEL' 207'    ERR,EC
     C                     ELSE
     C*
      ** CAN BE +/-  1-9   ONLY THE FIRST CHARACTER CAN CONTAIN A SIGN
      ** FIRST CHAR QSIGN, SECOND QDIG
     C*
     C           QDIG      IFEQ *BLANK
     C*
      ** IF SECOND CHARACTER IS BLANK FIRST MUST CONTAIN DIGIT
     C*
     C           QSIGN     IFLT '0'
     C           QSIGN     ORGT '9'
     C                     ADD  1         EC         35
     C                     MOVEL' 208'    ERR,EC
     C                     END
     C*
     C                     ELSE
     C*
      ** SECOND CHARACTER NON-BLANK - FIRST CHARACTER MUST BE +,- OR BLANK
     C*
     C           QSIGN     IFNE *BLANK
     C           QSIGN     ANDNE'+'
     C           QSIGN     ANDNE'-'
     C                     ADD  1         EC         35
     C                     MOVEL' 208'    ERR,EC
     C                     ELSE
     C*
      ** FIRST CHARACTER VALID, SECOND MUST BE A DIGIT
     C*
     C           QDIG      IFLT '0'
     C           QDIG      ORGT '9'
     C                     ADD  1         EC         35
     C                     MOVEL' 208'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     END
     C                     END
     C*
      ** IF BLANK, ZEROISE FILE FIELD
     C*
     C           SQOTC     IFEQ *BLANK
     C                     Z-ADD0         QOTC
     C                     END
     C*
      ** VALIDATE TICK DENOMINATOR MUST BE NUMERIC
     C*
     C           STKDM     IFNE *BLANK
     C*
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE STKDM     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN,99    IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C                     ADD  1         EC         36
     C                     MOVEL' 209'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    TKDM
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STKDM
     C                     END
     C                     END
     C*
      ** IF PROCESSING TYPE IS 2/5, TICKS DENOMINATOR MUST BE 100
     C*
     C           SISPT     IFEQ '2'
     C           SISPT     OREQ '5'
     C           STKDM     IFNE '100'
     C                     ADD  1         EC         36
     C                     MOVEL' 210'    ERR,EC
     C                     END
     C                     END
      *                                                                   CFF006
      ** Validate Fractional Ticks Indicator if CFF006 is installed       CFF006
      *                                                                   CFF006
     C           CFF006    IFEQ 'Y'                                       CFF006
      *                                                                   CFF006
     C                     SELEC                                          CFF006
     C           SFRTK     WHNE 'Y'                                       CFF006
     C           SFRTK     ANDNE'N'                                       CFF006
     C                     MOVE *ON       *IN44                           CFF006
     C                     ADD  1         EC                              CFF006
     C                     MOVEL' 254'    ERR,EC                          CFF006
      *                                                                   CFF006
      ** Must be 'N' if Ticks denominator is 100                          CFF006
      *                                                                   CFF006
     C           TKDM      WHEQ 100                                       CFF006
     C           SFRTK     ANDNE'N'                                       CFF006
     C                     MOVE *ON       *IN44                           CFF006
     C                     ADD  1         EC                              CFF006
     C                     MOVEL' 255'    ERR,EC                          CFF006
      *                                                                   CFF006
      ** Not amendable from 'Y' to 'N'                                    CFF006
      *                                                                   CFF006
     C           FRTK      WHEQ 'Y'                                       CFF006
     C           SFRTK     ANDEQ'N'                                       CFF006
     C                     MOVE *ON       *IN44                           CFF006
     C                     ADD  1         EC                              CFF006
     C                     MOVEL' 256'    ERR,EC                          CFF006
     C                     ENDSL                                          CFF006
     C                     ENDIF                                          CFF006
     C*
      ** MINIMUM PRICE FLUCTUATION MUST BE ENTERED FOR TICKS DENOM 100
      ** NOT ALLOWED FOR TKDM = 100
      ** When CFF006 is installed, minimum price fluctuation must be      CFF006
      ** entered if fractional ticks indicator is 'Y', otherwise          CFF006
      ** it must be left blank.                                           CFF006
     C*
     C           STKDM     IFEQ '100'
     C           SMNPF     ANDEQ*BLANK
     C                     ADD  1         EC         37
     C                     MOVEL' 212'    ERR,EC
     C                     END
     C*
     C           STKDM     IFNE '100'
     C           *IN36     ANDEQ'0'
      *                                                                   CFF006
     C           CFF006    IFEQ 'N'                                       CFF006
     C           SMNPF     ANDNE*BLANK
      *                                                                   CFF006
     C           CFF006    OREQ 'Y'                                       CFF006
     C           SFRTK     ANDEQ'Y'                                       CFF006
     C           SMNPF     ANDEQ*BLANK                                    CFF006
      *                                                                   CFF006
     C           CFF006    OREQ 'Y'                                       CFF006
     C           SFRTK     ANDEQ'N'                                       CFF006
     C           SMNPF     ANDNE*BLANK                                    CFF006
     C                     ADD  1         EC         37
     C                     MOVEL' 212'    ERR,EC
     C                     ENDIF                                          CFF006
     C                     END
     C*
      ** VALIDATE MINIMUM PRICE FLUCTUATION IF ENTERED, MUST BE NUMERIC,
      ***MAX*11,7*AND*NON*ZERO*****************************************   CFF004
      ** MAX 15,8 AND NON ZERO                                            CFF004
     C*
     C           SMNPF     IFNE *BLANK
     C           *IN37     ANDEQ'0'
     C*
     C/COPY WNCPYSRC,FF0150C001
     C***********          Z-ADD7         ZADEC                           CFF004
     C***********          Z-ADD4         ZADIG                           CFF004
     C/COPY WNCPYSRC,FF0150C002
     C                     Z-ADD8         ZADEC                           CFF004
     C                     Z-ADD7         ZADIG                           CFF004
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SMNPF     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         37
     C                     MOVEL' 211'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    MNPF
     C           MNPF      IFEQ *ZERO
     C                     ADD  1         EC         37
     C                     MOVEL' 211'    ERR,EC
     C                     END
     C                     END
     C*
     C                     END
     C*
      ** VALIDATE TICK VALUE MANDATORY, NUMERIC 11,5
      ** UNLESS PROCESSING TYPE = 7 OR 8 WHEN IT IS PROHIBITED            AUS022
     C*
     C           STKVL     IFNE *BLANK
     C           *IN33     ANDEQ'0'
     C*
     C           SISPT     IFEQ '7'                                       AUS022
     C           SISPT     OREQ '8'                                       AUS022
     C                     ADD  1         EC         38                   AUS022
     C                     MOVEL' 253'    ERR,EC                          AUS022
     C                     ELSE                                           AUS022
     C*
     C***********ICDP      ADD  5         ZADEC                           E16371
     C           ICDP      ADD  2         ZADEC                           E16371
     C           14        SUB  ZADEC     ZADIG
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE STKVL     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '0'                                       E18188
     C           ICDP      ADD  5         ZADEC                           E18188
     C           14        SUB  ZADEC     ZADIG                           E18188
     C                     MOVEL*BLANK    ZFIELD                          E18188
     C                     MOVE STKVL     ZFIELD                          E18188
     C                     EXSR ZALIGN                                    E18188
     C                     END                                            E18188
     C*                                                                   E18188
     C           *IN99     IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C                     ADD  1         EC         38
     C                     MOVEL' 214'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    TKVL
     C                     END
     C                     END                                            AUS022
     C*
     C                     END
     C*
     C           STKVL     IFEQ *BLANK
     C           SISPT     IFNE '7'                                       AUS022
     C           SISPT     ANDNE'8'                                       AUS022
     C                     ADD  1         EC         38
     C                     MOVEL' 213'    ERR,EC
     C                     ELSE                                           AUS022
     C                     Z-ADD0         TKVL                            AUS022
     C                     END                                            AUS022
     C                     END
     C*                                                                  E14168
     C*   CHECK TICK VALUE (IF FOREX) = CONT. AM. * MIN. PRICE FLUCT.    E14168
     C*                                 * 10 TO POWER (QUOT. CONV.)      E14168
     C*   WARNING MESSAGE IF UNEQUAL.                                    E14168
     C*                                                                  E14168
     C           SISPT     IFEQ '2'                                      E14168
     C           SISPT     OREQ '5'                                       E14168
     C*                                                                   FO0007
     C** ONLY VALIDATE IF NO ERRORS ON FIELDS USED IN CALCULATION OF      FO0007
     C** TICK VALUE.                                                      FO0007
     C*                                                                   FO0007
     C           *IN34     IFNE '1'                                       FO0007
     C           *IN35     ANDNE'1'                                       FO0007
     C           *IN37     ANDNE'1'                                       FO0007
     C*                                                                   E14168
     C           CTAM      MULT MNPF      TEMP   145                      E14168
     C**********                                                          E14168
     C***CHECK*SIGN, IF EXISTS, OF QUOTATION CONVENTION                   E14168
     C**********                                                          E14168
     C********** SQOTC     IFEQ *BLANK                              FO0007E14168
     C**********           Z-ADD1         N       10                FO0007E14168
     C********** TEMP      MULT POWER9,N  TEMP                      FO0007E14168
     C**********           ELSE                                     FO0007E14168
     C********** QDIG      IFEQ *BLANK                              FO0007E14168
     C**********           MOVE QSIGN     QDIG                      FO0007E14168
     C**********           END                                      FO0007E14168
     C**********           MOVE QDIG      N       10                FO0007E14168
     C********** QSIGN     IFEQ '-'                                 FO0007E14168
     C********** TEMP      DIV  POWER9,N  TEMP                      FO0007E14168
     C**********           ELSE                                     FO0007E14168
     C********** TEMP      MULT POWER9,N  TEMP                      FO0007E14168
     C**********           END                                      FO0007E14168
     C**********           END                                      FO0007E14168
     C*                                                                   FO0007
     C** IF THE DIGIT IN THE QUOTATION CONVENTION IS NON ZERO SCALE       FO0007
     C** UP OR DOWN DEPENDANT ON THE SIGN.                                FO0007
     C*                                                                   FO0007
     C           SQOTC     IFNE *BLANK                                    FO0007
     C           QDIG      IFEQ *BLANK                                    FO0007
     C                     MOVE QSIGN     QDIG                            FO0007
     C                     END                                            FO0007
     C           QDIG      IFGE '1'                                       FO0007
     C                     MOVE QDIG      N       10                      FO0007
     C           QSIGN     IFEQ '-'                                       FO0007
     C           TEMP      DIV  POWER9,N  TEMP                            FO0007
     C                     ELSE                                           FO0007
     C           TEMP      MULT POWER9,N  TEMP                            FO0007
     C                     END                                            FO0007
     C                     END                                            FO0007
     C                     END                                            FO0007
     C*                                                                   E14168
     C*  CHECK TICK VALUE EQUALS EQUATION                                 E14168
     C*                                                                   E14168
     C           TKVL      IFNE TEMP                                      E14168
     C*******              ADD  1         W                         E14168E16757
     C                     ADD  1         W          38                   E16757
     C                     MOVEL' W01'    WER,W                           E14168
     C                     END                                            E14168
     C                     END                                            E14168
     C                     END                                            FO0007
     C*
     C*
      ** VALIDATE DEFAULT BROKER-DBRK
     C*
      ** IF ENTERED BROKER MUST EXIST ON FOCLTD
      ** CHECK SNAME FIRST, THEN FOCLT IF VALID NUMBER FOUND
     C*
     C           SDBRK     IFNE *BLANK
     C                     MOVE SDBRK     CSNM
     C           CSNM      CHAINSNAMECBF             99
     C*
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C                     MOVE CNUM      CBCD
     C*
      ** NO SNAME RECORD
     C*
     C                     ELSE
     C           *LIKE     DEFN SDBRK     WRK7A - 3
     C                     MOVELSDBRK     WRK7A
     C                     MOVE '0'       WRK7A
     C           *LIKE     DEFN SDBRK     WRK4A - 6
     C                     MOVE SDBRK     WRK4A
     C**********           TESTN          WRK7A      24                                       CSD027
     C*
      ** VALID NUMBER ENTERED
     C*
     C********** *IN24     IFEQ '1'                                                           CSD027
     C********** WRK4A     ANDEQ*BLANK                                                        CSD027
     C           WRK4A     IFEQ *BLANK                                                        CSD027
     C                     MOVELSDBRK     CBCD
     C                     ELSE
     C*
      ** ENTRY NEITHER SHORTNAME NOR A VALID NUMBER 6-CHAR LONG
     C*
     C                     ADD  1         EC         39
     C                     MOVEL' 215'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** NUMBER AVAILABLE FOR CHAIN TO FOCLT
     C*
     C           *IN39     IFEQ '0'
     C           CBCD      CHAINFOCLT                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         39
     C                     MOVEL' 215'    ERR,EC
     C*
      ** IF FOUND THE BROKER INDICATOR MUST BE 'Y'
     C*
     C                     ELSE
     C                     MOVEL*BLANK    SDBRK
     C                     MOVELCBCD      SDBRK
     C*
     C           BRKI      IFNE 'Y'
     C                     ADD  1         EC         39
     C                     MOVEL' 216'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C*
      ** VALIDATE BROKER CHARGE/COMMISSION PATTERN
     C*
     C           SBCPT     IFNE *BLANK
     C           SBCPT     ANDNE'S'
     C           SBCPT     ANDNE'H'
     C           SBCPT     ANDNE'E'
     C                     ADD  1         EC         46
     C                     MOVEL' 217'    ERR,EC
     C                     END
     C*
     C*
      ** VALIDATE CUSTOMER CHARGE/COMMISSION PATTERN
     C*
     C                     MOVELSCCPT     CCPT
     C*
     C           SCCPT     IFNE *BLANK
     C           SCCPT     ANDNE'S'
     C           SCCPT     ANDNE'H'
     C           SCCPT     ANDNE'E'
     C                     ADD  1         EC         47
     C                     MOVEL' 217'    ERR,EC
     C                     END
     C*
      ** VALIDATE BROKER COMMISSION CODE - MUST BE NUMERIC IF ENTERED
      ** MUST BE ENTERED ONLY IF PATTERN IS ENTERED
     C*
     C           SBCMC     IFEQ *BLANK
     C           SBCPT     ANDNE*BLANK
     C                     ADD  1         EC         48
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C           SBCMC     IFNE *BLANK
     C           SBCPT     ANDEQ*BLANK
     C                     ADD  1         EC         48
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C           SBCMC     IFNE *BLANK
     C           *IN48     ANDEQ'0'
     C           *LIKE     DEFN SBCMC     WRK3A + 1
     C                     MOVE 0         WRK3A
     C                     MOVELSBCMC     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         48
     C                     MOVEL' 218'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN48     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SBCMC     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         48
     C                     MOVE ' 219'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE CUSTOMER COMMISSION CODE - MUST BE NUMERIC IF ENTERED
      ** MUST BE ENTERED ONLY IF PATTERN IS ENTERED
     C*
     C           SCCMC     IFEQ *BLANK
     C           SCCPT     ANDNE*BLANK
     C                     ADD  1         EC         49
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C           SCCMC     IFNE *BLANK
     C           SCCPT     ANDEQ*BLANK
     C                     ADD  1         EC         49
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C           SCCMC     IFNE *BLANK
     C           *IN49     ANDEQ'0'
     C                     MOVE 0         WRK3A
     C                     MOVELSCCMC     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         49
     C                     MOVEL' 218'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN49     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SCCMC     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         49
     C                     MOVE ' 219'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE BROKER COMMISSION CODE FOR SAME DAY
      ** MUST ENTERED ONLY IF PATTERN IS ENTERED
     C*
     C           SBCMS     IFEQ *BLANK
     C           SBCPT     ANDNE*BLANK
     C                     ADD  1         EC         50
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C*
     C           SBCMS     IFNE *BLANK
     C           SBCPT     ANDEQ*BLANK
     C                     ADD  1         EC         50
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C*
     C           SBCMS     IFNE *BLANK
     C           *IN50     ANDEQ'0'
     C                     MOVE 0         WRK3A
     C                     MOVELSBCMS     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         50
     C                     MOVEL' 221'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN50     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SBCMS     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         50
     C                     MOVE ' 222'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE CUSTOMER COMMISSION CODE FOR SAME DAY
      ** MUST ENTERED ONLY IF PATTERN IS ENTERED
     C*
     C           SCCMS     IFEQ *BLANK
     C           SCCPT     ANDNE*BLANK
     C                     ADD  1         EC         51
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C*
     C           SCCMS     IFNE *BLANK
     C           SCCPT     ANDEQ*BLANK
     C                     ADD  1         EC         51
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C*
     C*
     C           SCCMS     IFNE *BLANK
     C                     MOVE 0         WRK3A
     C                     MOVELSCCMS     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         51
     C                     MOVEL' 221'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN51     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SCCMS     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         51
     C                     MOVE ' 222'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE BROKER CHARGES CODE FOR PURCHASE IF ENTERED
     C*
     C           SBCGP     IFNE *BLANK
     C                     MOVE 0         WRK3A
     C                     MOVELSBCGP     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         52
     C                     MOVEL' 224'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN52     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SBCGP     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         52
     C                     MOVE ' 225'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C*
      ** VALIDATE CUSTOMER CHARGES CODE FOR PURCHASE IF ENTERED
     C*
     C           SCCGP     IFNE *BLANK
     C                     MOVE 0         WRK3A
     C                     MOVELSCCGP     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         54
     C                     MOVEL' 224'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN54     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SCCGP     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         54
     C                     MOVE ' 225'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE BROKER CHARGES CODE FOR SALE IF ENTERED
     C*
     C           SBCGS     IFNE *BLANK
     C                     MOVE 0         WRK3A
     C                     MOVELSBCGS     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         53
     C                     MOVEL' 226'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN53     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SBCGS     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         53
     C                     MOVE ' 227'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE CUSTOMER CHARGES CODE FOR SALE IF ENTERED
     C*
     C           SCCGS     IFNE *BLANK
     C                     MOVE 0         WRK3A
     C                     MOVELSCCGS     WRK3A
     C                     TESTN          WRK3A      24
     C*
     C           *IN24     IFEQ '0'
     C                     ADD  1         EC         55
     C                     MOVEL' 226'    ERR,EC
     C                     END
     C*
      ** MUST EXIST FOR THE INSTRUMENT CCY ON FL-CHGCM
      ** ONLY IF INSTRUMENT CCY IS VALID
     C*
     C           *IN33     IFEQ '0'
     C           *IN55     ANDEQ'0'
     C                     MOVE SISCY     CCY
     C                     MOVE SCCGS     CGCM
     C           CHGCMK    CHAINCHGCM                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     ADD  1         EC         55
     C                     MOVE ' 227'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
      ** VALIDATE COMMODITY REFERENCE - IF ENTERED, PROCESSING TYPE 3/6
     C*
     C           SISPT     IFNE '6'
     C           SISPT     ANDNE'3'
     C           SCMRF     ANDNE*BLANK
     C                     ADD  1         EC         56
     C                     MOVEL' 228'    ERR,EC
     C                     END
     C*
      ** VALIDATE OTHER CURRENCY
     C*
      ** MANDATORY FIELD FOR TYPES 2&5, FORBIDDEN OTHERWISE
     C*
     C           SOTHC     IFEQ *BLANK
     C           SISPT     ANDEQ'2'
     C           SOTHC     OREQ *BLANK
     C           SISPT     ANDEQ'5'
     C                     ADD  1         EC         59
     C                     MOVEL' 229'    ERR,EC
     C                     END
     C*
     C           *IN32     IFEQ '0'
     C           SOTHC     ANDNE*BLANK
     C           SISPT     ANDNE'2'
     C           SISPT     ANDNE'5'
     C                     ADD  1         EC         59
     C                     MOVEL' 229'    ERR,EC
     C                     END
     C*
     C           *IN59     IFEQ '0'
     C           SOTHC     ANDEQSISCY
     C                     ADD  1         EC         59
     C                     MOVEL' 231'    ERR,EC
     C                     END
     C*
      ***MUST*BE*ON*TABTG10***********************************************S01117
      ** MUST BE ON SD                                                    S01117
     C*
     C           SOTHC     IFNE *BLANK
     C           *IN59     ANDEQ'0'
     C***********          MOVE SOTHC     TCCY                            S01117
     C***********CCYK      CHAINTABFF                99                   S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SOTHC     @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         59
     C                     MOVEL' 231'    ERR,EC
     C                     END
     C                     END
     C*
      ** VALIDATE PREMIUM UP FRONT - MUST BE Y/N DEPENDANT ON PROC TYPE
     C*
     C           *IN32     IFEQ '0'
     C*
     C           SPUPF     IFNE *BLANK
     C***********SISPT     ANDNE'4'                                       AUS022
     C***********SISPT     ANDNE'5'                                       AUS022
     C***********SISPT     ANDNE'6'                                       AUS022
     C           SISPT     ANDLE'3'                                       AUS022
     C           SPUPF     ORNE *BLANK                                    AUS022
     C           SISPT     ANDEQ'7'                                       AUS022
     C*                                                                   AUS022
     C                     ADD  1         EC         61
     C                     MOVEL' 232'    ERR,EC
     C                     END
     C*
     C           SPUPF     IFNE *BLANK
     C           *IN61     ANDEQ'0'
     C           SPUPF     ANDNE'Y'
     C           SPUPF     ANDNE'N'
     C                     ADD  1         EC         61
     C                     MOVEL' 233'    ERR,EC
     C                     END
     C                     END
     C*                                                                   FF0011
      ** Validate American/European option indicator                      FF0011
     C*                                                                   FF0011
     C           *IN32     IFEQ '0'                                       FF0011
     C*                                                                   FF0011
     C           SAEIN     IFNE *BLANK                                    FF0011
     C           SISPT     ANDNE'4'                                       FF0011
     C           SISPT     ANDNE'5'                                       FF0011
     C           SISPT     ANDNE'6'                                       FF0011
     C           SISPT     ANDNE'8'                                       FF0011
     C                     ADD  1         EC         81                   FF0011
     C                     MOVEL' 275'    ERR,EC                          FF0011
     C                     END                                            FF0011
     C*                                                                   FF0011
     C           SAEIN     IFNE *BLANK                                    FF0011
     C           *IN80     ANDEQ'0'                                       FF0011
     C           SAEIN     ANDNE'A'                                       FF0011
     C           SAEIN     ANDNE'E'                                       FF0011
     C                     ADD  1         EC         81                   FF0011
     C                     MOVEL' 276'    ERR,EC                          FF0011
     C                     END                                            FF0011
     C                     END                                            FF0011
     C*
      ** VALIDATE FUTURE TYPE REFERENCE
     C*
     C           *IN32     IFEQ '0'
     C*
      ** PROCESSING TYPE MUST BE 4,5 OR 6 IF FUTURE TYPE IS ENTERED
     C***********SISPT     IFEQ '4'                                       AUS022
     C***********SISPT     OREQ '5'                                       AUS022
     C***********SISPT     OREQ '6'                                       AUS022
     C           SISPT     IFGT '3'                                       AUS022
     C           SISPT     ANDNE'7'                                       AUS022
     C*                                                                   AUS022
     C           SFTRF     IFEQ *BLANK
     C                     ADD  1         EC         60
     C                     MOVEL' 234'    ERR,EC
     C                     END
     C                     END
     C*
      ** FUTURE TYPE MUST BE BLANK IF PROCESSING TYPE IS 1,2 OR 3
     C*
     C***********SISPT     IFEQ '1'                                       AUS022
     C***********SISPT     OREQ '2'                                       AUS022
     C***********SISPT     OREQ '3'                                       AUS022
     C           SISPT     IFLE '3'                                       AUS022
     C           SISPT     OREQ '7'                                       AUS022
     C*                                                                   AUS022
     C           SFTRF     IFNE *BLANK
     C                     ADD  1         EC         60
     C                     MOVEL' 234'    ERR,EC
     C                     END
     C                     END
     C*
     C           SFTRF     IFEQ ISTC
     C                     ADD  1         EC         60
     C                     MOVEL' 235'    ERR,EC
     C                     END
     C*
      ** MUST BE A VALID INSTRUMENT ON INTYPD WITH PROCSSING TYPE
      ** EQUAL TO 1,2 OR 3 AND INSTR IND EQUAL TO 'N'
     C*
     C           *IN60     IFEQ '0'
     C           SFTRF     ANDNE*BLANK
     C                     MOVEL'N'       ISTI
     C                     MOVELMRKT      ISTTR
     C                     MOVE SFTRF     ISTTR
     C*
      ** SAVE INSTRUMENT KEY
     C*
     C                     MOVELISTT      ISTTX
     C*
     C           INTP1L    CHAININTYP1X              99
     C*
      ** RESTORE INSTRUMENT KEY
     C*
     C                     MOVELISTTX     ISTT
     C*
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
      ** VALID RECORD FOUND - CHECK PROCESSING TYPE
      ** OPTION MUST REFERENCE CORRESPONDING FUTURE  (4:1  5:2  6:3)
      ** AND CURRENCIES MUST CORRESPOND
     C*
     C           SISPT     IFEQ '4'
     C           ISPT      ANDNE1
     C*
     C           SISPT     OREQ '5'
     C           ISPT      ANDNE2
     C*
     C           SISPT     OREQ '6'
     C           ISPT      ANDNE3
     C*
     C           SISPT     OREQ '8'                                       AUS022
     C           ISPT      ANDNE7                                         AUS022
     C*                                                                   AUS022
     C           *IN33     OREQ '0'
     C           SISCY     ANDNEISCY
     C*
     C           *IN59     OREQ '0'
     C           SOTHC     ANDNEOTHC
     C*
     C                     ADD  1         EC         60
     C                     MOVEL' 236'    ERR,EC
     C                     END
     C*
      ** NO RECORD FOUND
     C*
     C                     ELSE
     C                     ADD  1         EC         60
     C                     MOVEL' 236'    ERR,EC
     C                     END
     C                     END
     C*
     C                     END
     C*
      ** VALIDATE MONTHS QUOTED
     C*
      ** IF ENTERED MUST BE 'Y' OR 'N' AND A QUOTED MONTH
      ** FOR THE MARKET CENTRE ON MARKTD
     C*
     C           MRKT      CHAINMARKT                99
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
      ** DATABASE ERROR IF RECORD HAS DISAPPEARED
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8LR***************
     C***********          MOVEL'05'      DBASE            * DB ERROR 05 *S01117
     C                     Z-ADD5         DBASE            * DB ERROR 05 *S01117
     C                     MOVEL'MARKT'   DBFILE           ***************
     C                     MOVELMRKT      DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C           SMQ1      IFNE *BLANK
     C           SMQ1      ANDNE'Y'
     C                     ADD  1         EC         07
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ1      IFEQ 'Y'
     C           MQ,1      ANDNE'Y'
     C                     ADD  1         EC         07
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ2      IFNE *BLANK
     C           SMQ2      ANDNE'Y'
     C                     ADD  1         EC         08
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ2      IFEQ 'Y'
     C           MQ,2      ANDNE'Y'
     C                     ADD  1         EC         08
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ3      IFNE *BLANK
     C           SMQ3      ANDNE'Y'
     C                     ADD  1         EC         09
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ3      IFEQ 'Y'
     C           MQ,3      ANDNE'Y'
     C                     ADD  1         EC         09
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ4      IFNE *BLANK
     C           SMQ4      ANDNE'Y'
     C                     ADD  1         EC         13
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ4      IFEQ 'Y'
     C           MQ,4      ANDNE'Y'
     C                     ADD  1         EC         13
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ5      IFNE *BLANK
     C           SMQ5      ANDNE'Y'
     C                     ADD  1         EC         14
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ5      IFEQ 'Y'
     C           MQ,5      ANDNE'Y'
     C                     ADD  1         EC         14
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ6      IFNE *BLANK
     C           SMQ6      ANDNE'Y'
     C                     ADD  1         EC         15
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ6      IFEQ 'Y'
     C           MQ,6      ANDNE'Y'
     C                     ADD  1         EC         15
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C*
     C           SMQ7      IFNE *BLANK
     C           SMQ7      ANDNE'Y'
     C                     ADD  1         EC         17
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ7      IFEQ 'Y'
     C           MQ,7      ANDNE'Y'
     C                     ADD  1         EC         17
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ8      IFNE *BLANK
     C           SMQ8      ANDNE'Y'
     C                     ADD  1         EC         18
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ8      IFEQ 'Y'
     C           MQ,8      ANDNE'Y'
     C                     ADD  1         EC         18
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ9      IFNE *BLANK
     C           SMQ9      ANDNE'Y'
     C                     ADD  1         EC         19
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ9      IFEQ 'Y'
     C           MQ,9      ANDNE'Y'
     C                     ADD  1         EC         19
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ10     IFNE *BLANK
     C           SMQ10     ANDNE'Y'
     C                     ADD  1         EC         27
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ10     IFEQ 'Y'
     C           MQ,10     ANDNE'Y'
     C                     ADD  1         EC         27
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ11     IFNE *BLANK
     C           SMQ11     ANDNE'Y'
     C                     ADD  1         EC         28
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ11     IFEQ 'Y'
     C           MQ,11     ANDNE'Y'
     C                     ADD  1         EC         28
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
     C           SMQ12     IFNE *BLANK
     C           SMQ12     ANDNE'Y'
     C                     ADD  1         EC         29
     C                     MOVEL' 237'    ERR,EC
     C                     END
     C*
     C           SMQ12     IFEQ 'Y'
     C           MQ,12     ANDNE'Y'
     C                     ADD  1         EC         29
     C                     MOVEL' 238'    ERR,EC
     C                     END
     C*
      **  AT LEAST ONE MONTH MUST BE SET UP AS A QUOTED MONTH
     C*
     C                     MOVEASMQ       WSMQ   12
     C           WSMQ      IFEQ *BLANK
     C                     ADD  1         EC         07
     C                     MOVEL' 239'    ERR,EC
     C                     END
     C*
     C*
      ** VALIDATE TRADED FORWARD PERIODS
      ** IT MUST BE NUMERIC, MANDATORY
     C*
     C           STFPD     IFNE *BLANK
     C*
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE STFPD     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN,99    IFEQ '1'
     C                     ADD  1         EC         77
     C                     MOVEL' 240'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    TFPD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STFPD
     C                     END
     C*
      ** ERROR IF BLANK
     C*
     C                     ELSE
     C                     ADD  1         EC         77
     C                     MOVEL' 240'    ERR,EC
     C                     END
     C*
      ** VALIDATE FORWARD SPOT MONTHS
      ** IT MUST BE NUMERIC,IF ENTERED
     C*
     C           SFSPM     IFNE *BLANK
     C*
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SFSPM     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN,99    IFEQ '1'
     C                     ADD  1         EC         78
     C                     MOVEL' 241'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    FSPM
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SFSPM
     C                     END
     C                     END
     C*
      ** VALIDATE FINAL TRANSACTION DATE
      ** IT MUST BE ENTERED
     C*
     C           SFTDF     IFEQ *BLANK
     C                     ADD  1         EC         74
     C                     MOVEL' 242'    ERR,EC
     C                     END
     C*
      ** TO BE A VALID DATE FORMULA
     C*
     C           SFTDF     IFNE *BLANK
     C*
      **   MOVE SCREEN FIELD TO DATE VALIDATION DATASTRUCTURE
     C*
     C                     MOVEL*BLANKS   SDATE
     C                     MOVE SFTDF     SDATE
     C                     EXSR VALDAT
     C*
      ** IF ERROR, SET UP CODE, OTHERWISE MOVE SCREEN TO FILE FIELD
     C*
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         74
     C                     MOVEL' 243'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** VALIDATE SETTLEMENT DATE FORMULA
      **      MUST BE ENTERED
     C*
     C           SSEDF     IFEQ *BLANK
     C                     ADD  1         EC         75
     C                     MOVEL' 245'    ERR,EC
     C                     END
     C*
      ** TO BE A VALID DATE
     C*
     C           SSEDF     IFNE *BLANK
     C*
      **    MOVE SCREEN FIELD TO FIELD WITH 7 POSITIONS
     C*
     C                     MOVEL*BLANKS   SDATE
     C                     MOVE SSEDF     SDATE
     C                     EXSR VALDAT
     C*
      ** IF INVALID, SET UP ERROR CODE, ELSE MOVE TO FILE
     C*
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         75
     C                     MOVEL' 246'    ERR,EC
     C                     END
     C*
     C                     END
     C*
      ** FINAL TRANS DATE MUST BE LESS OR EQUAL TO SETTLEMENT DATE
      **   WHEN  CONVERTED
     C*
      ** CHECK FOR MONTHS QUOTED ERRORS (CANNOT CONVERT DATES IF ERRORS)
     C*
     C           *IN07     IFEQ '0'
     C           *IN08     ANDEQ'0'
     C           *IN09     ANDEQ'0'
     C           *IN13     ANDEQ'0'
     C           *IN14     ANDEQ'0'
     C           *IN15     ANDEQ'0'
     C           *IN17     ANDEQ'0'
     C           *IN18     ANDEQ'0'
     C           *IN19     ANDEQ'0'
     C           *IN27     ANDEQ'0'
     C           *IN28     ANDEQ'0'
     C           *IN29     ANDEQ'0'
     C*
      ** TO CONVERT FINAL TRANS DATE USING FFDATE
     C*
      **   TO FIND FIRST MONTH QUOTED
     C*
     C                     Z-ADD1         X       20
     C           'Y'       LOKUPSMQ,X                    24
     C                     Z-ADDX         FFMTH
     C*
     C           *IN74     IFEQ '0'
     C*
      **      MOVE FIELDS FOR FFDATE
     C*
     C                     MOVE *BLANKS   FFDATC  7
     C                     MOVELSFTDF     FFDATC
     C                     MOVE RUNA      FFYR
     C                     MOVE MKLC      FFCCY1  3
     C                     MOVE SISCY     FFCCY2  3
     C                     MOVE SOTHC     FFCCY3  3
     C                     EXSR FFDATE
     C                     MOVE FFDAY     DAT1    60
     C                     END
     C*
     C*  TO CONVERT SETTLEDMENT DATE USING FFDATE
     C*
     C*       MOVE FIELDS FOR FFDATE
     C*
     C           *IN75     IFEQ '0'
     C                     MOVE *BLANKS   FFDATC  7
     C                     MOVE SSEDF     FFDATC  7
     C                     MOVE RUNA      FFYR
     C                     Z-ADDX         FFMTH
     C                     MOVE MKLC      FFCCY1  3
     C                     MOVE SISCY     FFCCY2  3
     C                     MOVE SOTHC     FFCCY3  3
     C                     EXSR FFDATE
     C                     MOVE FFDAY     DAT2    60
     C                     END
     C*
      ** COMPARE CONVERTED DATES
     C*
     C           *IN74     IFEQ '0'
     C           *IN75     ANDEQ'0'
     C           DAT1      ANDGTDAT2
     C                     ADD  1         EC         74
     C                     MOVEL' 244'    ERR,EC
     C                     END
     C*
      ** END OF CROSS VALIDATION - MONTHS QUOTED VALID
     C*
     C                     END
     C*
      ** VALIDATE SPOT MONTH DATE FORMULA
      **      MUST BE ENTERED
     C*
     C           SSPMF     IFEQ *BLANK
     C                     ADD  1         EC         76
     C                     MOVEL' 247'    ERR,EC
     C                     END
     C*
      ** TO BE A VALID DATE
     C*
     C           SSPMF     IFNE *BLANK
     C*
     C*     MOVE SCREEN FIELD TO FIELD WITH 7 POSITIONS
     C                     MOVEL*BLANKS   SDATE   7
     C                     MOVE SSPMF     SDATE
     C                     EXSR VALDAT
     C*
      ** IF ERROR, SET UP ERROR CODE, ELSE MOVE TO FILE FIELD
     C*
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         76
     C                     MOVEL' 248'    ERR,EC
     C                     END
     C*
      **   IF SSPMF IS BLANK
     C*
     C                     END
     C*
     C*
      ** SPOT MONTH DATE MUST BE LESS THAN OR EQUAL TO FINAL
      **  TRANSACTION DATE,WHEN CONVERTED
     C*
      ** TO CONVERT SPOT MONTH DATE USING FFDATE
     C*
      **      MOVE FIELDS FOR FFDATE
     C*
     C           *IN07     IFEQ '0'
     C           *IN08     ANDEQ'0'
     C           *IN09     ANDEQ'0'
     C           *IN13     ANDEQ'0'
     C           *IN14     ANDEQ'0'
     C           *IN15     ANDEQ'0'
     C           *IN17     ANDEQ'0'
     C           *IN18     ANDEQ'0'
     C           *IN19     ANDEQ'0'
     C           *IN27     ANDEQ'0'
     C           *IN28     ANDEQ'0'
     C           *IN29     ANDEQ'0'
     C*
     C           *IN76     IFEQ '0'
     C                     MOVEL*BLANKS   FFDATC  7
     C                     MOVELSSPMF     FFDATC
     C                     MOVE RUNA      FFYR
     C                     Z-ADDX         FFMTH
     C                     MOVE MKLC      FFCCY1  3
     C                     MOVE SISCY     FFCCY2  3
     C                     MOVE SOTHC     FFCCY3  3
     C                     EXSR FFDATE
     C                     MOVE FFDAY     DAT3    60
     C                     END
     C*
      ** COMPARE DATES CONVERTED
     C*
     C           *IN74     IFEQ '0'
     C           *IN76     ANDEQ'0'
     C           DAT3      ANDGTDAT1
     C                     ADD  1         EC         76
     C                     MOVEL' 249'    ERR,EC
     C                     END
     C*
      ** END OF SPOT MONTH CROSS VALIDATION - MONTHS QUOTED VALID
     C*
     C                     END
     C*
      ***VALIDATE*UNDERLYING*PERIOD*-*MUST*BE*NUMERIC                     S01393
      ** VALIDATE P&L AMORTISATION PERIOD - MUST BE NUMERIC               S01393
     C*
     C           SULPD     IFNE *BLANK
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C*
     C                     MOVEL*BLANK    ZFIELD
     C                     MOVE SULPD     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN,99    IFEQ '1'
     C           ZFIELD    OREQ *ZERO
     C                     ADD  1         EC         79
     C                     MOVEL' 250'    ERR,EC
     C                     ELSE
     C                     MOVE ZFIELD    ULPD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SULPD
     C                     END
     C*
     C                     END
     C*                                                                   S01393
      ** Validate Underlying Period - Must be numeric                     S01393
     C*                                                                   S01393
     C           SALPD     IFNE *BLANK                                    S01393
     C                     Z-ADD0         ZADEC                           S01393
     C                     Z-ADD5         ZADIG                           S01393
     C*                                                                   S01393
     C                     MOVEL*BLANK    ZFIELD                          S01393
     C                     MOVE SALPD     ZFIELD                          S01393
     C                     EXSR ZALIGN                                    S01393
     C*                                                                   S01393
     C           *IN,99    IFEQ '1'                                       S01393
     C           ZFIELD    OREQ *ZERO                                     S01393
     C                     ADD  1         EC         82                   S01393
     C                     MOVEL' 250'    ERR,EC                          S01393
     C                     ELSE                                           S01393
     C                     MOVE ZFIELD    ALPD                            S01393
     C                     EXSR ZEDIT                                     S01393
     C                     MOVE ZFIELD    SALPD                           S01393
     C                     END                                            S01393
     C*                                                                   S01393
     C                     END                                            S01393
     C* Validate contract type - Must be blank for processing types       AUS022
     C* one through six or mandatory if processing type is seven or       AUS022
     C* eight                                                             AUS022
     C*                                                                   AUS022
     C           SISPT     IFLE '6'                                       AUS022
     C           SCNTT     ANDNE*BLANK                                    AUS022
     C           SISPT     ORGT '6'                                       AUS022
     C           SCNTT     ANDEQ*BLANK                                    AUS022
     C                     ADD  1         EC         80                   AUS022
     C                     MOVEL' 251'    ERR,EC                          AUS022
     C                     ELSE                                           AUS022
     C/COPY WNCPYSRC,FF0150C020
     C*                                                                   AUS022
     C* Contract type if required can only be one, two or three           AUS022
     C*                                                                   AUS022
     C           SCNTT     IFLT '1'                                       AUS022
     C           SISPT     ANDGT'6'                                       AUS022
     C           SCNTT     ORGT '3'                                       AUS022
     C           SISPT     ANDGT'6'                                       AUS022
     C                     ADD  1         EC         80                   AUS022
     C                     MOVEL' 252'    ERR,EC                          AUS022
     C                     END                                            AUS022
     C/COPY WNCPYSRC,FF0150C021
     C*                                                                   AUS022
     C                     END                                            AUS022
     C*
     C*  END OF INSERT/AMEND PROCESSING
     C*
     C                     END
     C*
     C*  IF ACTION IS 'D' AND ENTER WAS PRESSED, THIS IS AN ERROR
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,9     INFMSG
     C                     END
     C*
     C*  END OF 'ENTER' PROCESSING
     C*
     C                     END
     C*
     C*  IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C*  COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C*  FOR LATER FORMAT PROCESSING
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C* COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,10    INFMSG
     C                     END
     C                     END
     C*
      ** MOVE WARNINGS OT ARRAY IF SOME HAVE OCCURRED
     C*
     C           WER,1     IFNE *BLANK
     C                     ADD  1         EC
     C                     MOVEAWER       ERR,EC
     C                     END
     C*
      ** IF ERRORS OCCURED, HIGHLIGHT ERROR BAND
     C*
     C           EC        IFNE *ZERO
     C                     MOVEAERR       ERRMSG
     C                     MOVELHI        ERRMSG
     C                     END
     C*
      ** IF MORE THAN 19 ERRORS OCCURRED, DISPLAY ON SECOND LINE
     C*
     C           EC        IFGT 19
     C                     MOVEAERR,20    INFMSG
     C                     MOVELHI        INFMSG
     C                     END
     C*                                                                   CPL002
     C*   SET INDICATOR TO DISPLAY MIDAS/PLATO SCRREN IF APPROPRIATE      CPL002
     C*                                                                   CPL002
     C           BGN2ST    IFEQ 'Y'                                       CPL002
     C*                                                                   167554
     C** Check ERR,1 to ensure it is not just a warning error.            167554
     C*                                                                   167554
     C                     MOVELERR,1     @WERR   2                       167554
     C           ERR,1     IFNE *BLANK                                    167554
     C           @WERR     ANDEQ' W'                                      167554
     C                     MOVE *BLANK    @WERR                           167554
     C                     END                                            167554
     C*                                                                   167554
     C***********ERR,1     IFEQ ' '                                CPL002 167554
     C           @WERR     IFEQ *BLANK                                    167554
     C           SISPT     ANDNE'2'                                       CPL002
     C           SISPT     ANDNE'5'                                       CPL002
     C           ACTN      ANDNE'D'                                       CPL002
     C                     MOVE 'Y'       W2ND    1                       CPL002
     C                     ELSE                                           CPL002
     C                     MOVE 'N'       W2ND                            CPL002
     C                     END                                            CPL002
     C                     ENDIF                                          CPL002
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT                                                              CPL002
     C********************************************************************CPL002
     C**                                                                 *CPL002
     C**   VALMD  SR. -  Validate Maturity Date                          *CPL002
     C**   ~~~~~~~~~~                                                    *CPL002
     C**      Called From                  Calls                         *CPL002
     C**       SR. VALID2                                                *CPL002
     C**                                                                 *CPL002
     C********************************************************************CPL002
      *                                                                   CPL002
     C           VALMD     BEGSR                                          CPL002
     C*                                                                   CPL002
     C                     MOVE '0'       *IN99                           CPL002
     C*                                                                   CPL002
     C**   1. Valid date format                                           CPL002
     C                     MOVE *BLANK    WTSTN6  6                       CPL002
     C                     MOVELSMITD     WTSTN6                          CPL002
     C                     TESTN          WTSTN6     75                   CPL002
     C**   - if numeric                                                   CPL002
     C           *IN75     IFEQ '1'                                       CPL002
     C                     MOVE SMITD     ZDATE                           CPL002
     C                     EXSR ZDATE1                                    CPL002
     C                     END                                            CPL002
     C**                                                                  CPL002
     C**   - invalid format or not numeric                                CPL002
     C           *IN99     IFEQ '1'                                       CPL002
     C           *IN75     OREQ '0'                                       CPL002
     C                     ADD  1         EC                              CPL002
     C                     MOVE ' 408'    ERR,EC                          CPL002
     C                     SETON                     38                   CPL002
     C                     ELSE                                           CPL002
     C                     Z-ADDZDAYNO    WMIMD   50                      CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT
     C********************************************************************CPL002
      **                                                                  CPL002
      ** VALID2 S/R - TO VALIDATE DETAIL SCREEN 2 (MIDAS/PLATO)           CPL002
      ** CALLED FROM UPDAT2 S/R                                           CPL002
      ** CALLS: VALDA2; ZEDIT; ZALIGN                                     CPL002
      **                                                                  CPL002
     C********************************************************************CPL002
     C*                                                                   CPL002
     C           VALID2    BEGSR                                          CPL002
     C*                                                                   CPL002
      ** SET ERROR COUNT TO ZERO                                          CPL002
     C*                                                                   CPL002
     C                     MOVEA'00000000'*IN,30                          CPL002
     C                     MOVEA'00'      *IN,38                          CPL002
     C                     Z-ADD*ZERO     EC                              CPL002
     C                     Z-ADD*ZERO     W#MICP 117                      CPL002
     C           ACTN      IFEQ 'I'                                       CPL002
     C           ACTN      OREQ 'A'                                       CPL002
     C*                                                                   CPL002
      ** ENTER KEY PRESSSED                                               CPL002
     C*                                                                   CPL002
     C           AID       IFEQ 'RA'                                      CPL002
     C*                                                                   CPL002
      *                                                                   CPL002
      ** Validate Underlying Instrument Type                              CPL002
     C           *IN60     IFEQ *OFF                              1       CPL002
     C           SMIIT     IFNE 'B'                                       CPL002
     C           SMIIT     ANDNE'D'                                       CPL002
     C           SMIIT     ANDNE'L'                                       CPL002
     C                     ADD  1         EC         30                   CPL002
     C                     MOVEL' 340'    ERR,EC                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C** If Instrument Type is Bond, then only maturity Date is allowed.  CPL002
     C*                                                                   CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C*                                                                   CPL002
     C           SMITM     IFNE *BLANKS                                   CPL002
     C                     ADD  1         EC         31                   CPL002
     C                     MOVE ' 406'    ERR,EC                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C                     EXSR VALMD                                     CPL002
     C*                                                                   CPL002
     C                     ELSE                                           CPL002
     C*                                                                   CPL002
     C** Maturity date should be blank.                                   CPL002
     C*                                                                   CPL002
     C           SMITD     IFNE *BLANKS                                   CPL002
     C                     ADD  1         EC         38                   CPL002
     C                     MOVEL' 407'    ERR,EC                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Underlying Term to Maturity                             CPL002
     C                     EXSR VALDA2                                    CPL002
     C*                                                                   CPL002
      ** IF ERROR, SET UP CODE, OTHERWISE MOVE SCREEN TO FILE FIELD       CPL002
     C*                                                                   CPL002
     C           *IN99     IFEQ '1'                                       CPL002
     C                     ADD  1         EC         31                   CPL002
     C                     MOVEL' 341'    ERR,EC                          CPL002
     C                     ELSE                                           CPL002
     C                     MOVE '0'       *IN,31                          CPL002
     C                     END                                            CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Underlying Coupon and related Underlying Coupon Frequency only   CPL002
      ** valid for Underlying Instrument Type = 'B' or 'D'                CPL002
      *                                                                   CPL002
     C*                                                                   CPL002
     C                     Z-ADD7         ZADEC                           CPL002
     C                     Z-ADD4         ZADIG                           CPL002
     C                     MOVEL*BLANK    ZFIELD                          CPL002
     C                     MOVE SMICP     ZFIELD                          CPL002
     C                     EXSR ZALIGN                                    CPL002
     C*                                                                   CPL002
     C           *IN,99    IFEQ '1'                                       CPL002
     C                     ADD  1         EC         32                   CPL002
     C                     MOVEL' 342'    ERR,EC                          CPL002
     C                     ELSE                                           CPL002
     C                     MOVE ZFIELD    W#MICP                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Coupon Frequency                                        CPL002
     C*                                                                   CPL002
     C           SMICF     IFEQ 'M'                                       CPL002
     C           SMICF     OREQ 'Q'                                       CPL002
     C           SMICF     OREQ 'X'                                       CPL002
     C           SMICF     OREQ 'Y'                                       CPL002
     C           SMICF     OREQ ' '                                       CPL002
     C                     ELSE                                           CPL002
     C                     ADD  1         EC         33                   CPL002
     C                     MOVEL' 344'    ERR,EC                          CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
     C           SMIIT     IFEQ 'L'                                       CPL002
      *                                                                   CPL002
      ** Underlying Coupon and related Underlying Coupon Frequency invalidCPL002
     C           W#MICP    IFNE 0                                         CPL002
     C                     MOVEL'1'       *IN,32                          CPL002
     C                     END                                            CPL002
     C           SMICF     IFNE *BLANKS                                   CPL002
     C                     MOVEL'1'       *IN,33                          CPL002
     C                     END                                            CPL002
     C           *IN32     IFEQ '1'                                       CPL002
     C           *IN33     OREQ '1'                                       CPL002
     C                     ADD  1         EC                              CPL002
     C                     MOVEL' 345'    ERR,EC                          CPL002
     C                     END                                            CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Pricing Convention                                      CPL002
      *                                                                   CPL002
     C           SMIPC     IFNE 'P'                                       CPL002
     C           SMIPC     ANDNE'F'                                       CPL002
     C                     MOVEL'1'       *IN,34                          CPL002
     C                     ADD  1         EC                              CPL002
     C                     MOVEL' 346'    ERR,EC                          CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** Validate Volatility Type                                         CPL002
      *                                                                   CPL002
     C                     MOVEA'00'      *IN,35                          CPL002
      *                                                                   CPL002
     C           *IN61     IFEQ *OFF                                      CPL002
     C           SISPT     IFEQ '6'                                       CPL002
     C           SMIVT     ANDNE'P'                                       CPL002
     C                     ADD  1         EC         35                   CPL002
     C                     MOVEL' 347'    ERR,EC                          CPL002
     C                     END                                            CPL002
     C           SMIVT     IFNE 'P'                                       CPL002
     C           SMIVT     ANDNE'Y'                                       CPL002
     C                     ADD  1         EC         35                   CPL002
     C                     MOVEL' 348'    ERR,EC                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Validate Pricing Method                                          CPL002
      *                                                                   CPL002
     C           SMIPM     IFNE 'B'                                       CPL002
     C           SMIPM     ANDNE'S'                                       CPL002
     C                     ADD  1         EC         36                   CPL002
     C                     MOVEL' 349'    ERR,EC                          CPL002
     C                     END                                            CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** If Pricing Group, Reporting Group or Credit Rating blank, defaultCPL002
      *                                                                   CPL002
     C           SMIPG     IFEQ *BLANK                                    CPL002
     C                     MOVELSISCY     SMIPG                           CPL002
     C                     MOVE 'Midas'   SMIPG                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C           SMIRG     IFEQ *BLANK                                    CPL002
     C                     MOVEL'Midas'   SMIRG                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C           SMICR     IFEQ *BLANK                                    CPL002
     C                     MOVEL'AAA '    SMICR                           CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C                     END                                            CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
      ** MOVE WARNINGS OT ARRAY IF SOME HAVE OCCURRED                     CPL002
     C*                                                                   CPL002
     C           WER,1     IFNE *BLANK                                    CPL002
     C                     ADD  1         EC                              CPL002
     C                     MOVEAWER       ERR,EC                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** IF ERRORS OCCURED, HIGHLIGHT ERROR BAND                          CPL002
     C*                                                                   CPL002
     C           EC        IFNE *ZERO                                     CPL002
     C                     MOVEAERR       ERRMSG                          CPL002
     C                     MOVELHI        ERRMSG                          CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
      ** IF MORE THAN 19 ERRORS OCCURRED, DISPLAY ON SECOND LINE          CPL002
     C*                                                                   CPL002
     C           EC        IFGT 19                                        CPL002
     C                     MOVEAERR,20    INFMSG                          CPL002
     C                     MOVELHI        INFMSG                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
     C           ERR,1     IFEQ *BLANKS                                   CPL002
     C                     MOVE 'Y'       W2PRO   1                       CPL002
     C                     SETOF                     42                   CPL002
     C                     ELSE                                           CPL002
     C                     MOVE 'N'       W2PRO                           CPL002
     C                     ENDIF                                          CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
      **                                                                  CPL002
      ** DEFLT2 S/R TO FORMAT DEFAULT VALUES FOR MIDAS/PLATO SCREEN       CPL002
      ** CALLED FROM UPDAT2                                               CPL002
      ** CALLS NO OTHER S/R'S                                             CPL002
      **                                                                  CPL002
     C********************************************************************CPL002
     C           DEFLT2    BEGSR                                          CPL002
      *                                                                   CPL002
      ** Fields available on screen depends on the processing type        CPL002
     C           SISPT     IFNE '1'                                       CPL002
     C           SISPT     ANDNE'7'                                       CPL002
     C                     SETON                     60                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SISPT     IFNE '4'                                       CPL002
     C           SISPT     ANDNE'6'                                       CPL002
     C           SISPT     ANDNE'8'                                       CPL002
     C                     SETON                     61                   CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
      ** DEFAULTS FOR RECORD                                              CPL002
     C*                                                                   CPL002
      ** ACTION = I                                                       CPL002
     C*                                                                   CPL002
     C           ACTN      IFEQ 'I'                                       CPL002
     C*                                                                   CPL002
     C                     MOVEL'N'       WDFT    1                       CPL002
     C*                                                                   CPL002
     C           SISPT     IFEQ '4'                                       CPL002
     C           SISPT     OREQ '6'                                       CPL002
     C           SISPT     OREQ '8'                                       CPL002
     C*                                                                   CPL002
     C*  FOR OPTIONS, GET DEFAULTS FROM UNDERLYING FUTURE                 CPL002
     C*                                                                   CPL002
     C                     MOVEL'N'       ISTI                            CPL002
     C                     MOVELMRKT      ISTTR                           CPL002
     C                     MOVE SFTRF     ISTTR                           CPL002
     C*                                                                   CPL002
      ** SAVE INSTRUMENT KEY                                              CPL002
     C*                                                                   CPL002
     C                     MOVELISTT      ISTTX                           CPL002
     C*                                                                   CPL002
     C           INTP1L    CHAININTYP1X              99                   CPL002
     C*                                                                   CPL002
      ** RESTORE INSTRUMENT KEY                                           CPL002
     C*                                                                   CPL002
     C                     MOVELISTTX     ISTT                            CPL002
     C*                                                                   CPL002
     C           *IN99     IFEQ '0'                                       CPL002
     C           RECI      ANDEQ'D'                                       CPL002
     C                     MOVEL'Y'       WDFT                            CPL002
     C                     MOVE PLMIIT    SMIIT                           CPL002
     C                     MOVE PLMITM    SMITM                           CPL002
     C*                                                                   CPL002
     C           PLMICP    IFEQ *ZERO                                     CPL002
     C                     MOVE *BLANKS   SMICP                           CPL002
     C                     ELSE                                           CPL002
     C                     Z-ADD7         ZADEC                           CPL002
     C                     Z-ADD4         ZADIG                           CPL002
     C                     MOVEL*BLANK    ZFIELD                          CPL002
     C                     MOVE PLMICP    ZFIELD                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
     C                     MOVE PLMICF    SMICF                           CPL002
     C                     MOVE PLMIPC    SMIPC                           CPL002
     C                     MOVE PLMIVT    SMIVT                           CPL002
     C                     MOVE PLMIPM    SMIPM                           CPL002
     C                     MOVE PLMIPG    SMIPG                           CPL002
     C                     MOVE PLMIRG    SMIRG                           CPL002
     C                     MOVE PLMICR    SMICR                           CPL002
     C*                                                                   CPL002
     C* FOR PROCESSING TYPE 6, VOLATILITY TYPE MUST BE 'P'                CPL002
     C           SISPT     IFEQ '6'                                       CPL002
     C                     MOVE 'P'       SMIVT                           CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      * IF NO UNDERLYING FUTURE, DEFAULT VARIOUSLY                        CPL002
     C           WDFT      IFEQ 'N'                                       CPL002
      *                                                                   CPL002
     C                     MOVE 'P'       SMIPC                           CPL002
      *                                                                   CPL002
     C           SISPT     IFEQ '7'                                       CPL002
     C           SISPT     OREQ '8'                                       CPL002
     C                     MOVE 'F'       SMIPC                           CPL002
     C           SCNTT     IFEQ '1'                                       CPL002
     C                     MOVE 'L'       SMIIT                           CPL002
     C***********          MOVE '+90D'    SMITM                    CPL002 167551
     C                     MOVE '090D'    SMITM                           167551
     C                     ELSE                                           CPL002
     C           SCNTT     IFEQ '2'                                       CPL002
     C                     MOVE 'B'       SMIIT                           CPL002
     C***********          MOVE '+03Y'    SMITM                    CPL002 167551
     C                     MOVE '003Y'    SMITM                           167551
     C                     MOVE 'X'       SMICF                           CPL002
     C                     ELSE                                           CPL002
     C           SCNTT     IFEQ '3'                                       CPL002
     C                     MOVE 'B'       SMIIT                           CPL002
     C***********          MOVE '+10Y'    SMITM                    CPL002 167551
     C                     MOVE '010Y'    SMITM                           167551
     C                     MOVE 'X'       SMICF                           CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           *IN61     IFEQ *OFF                                      CPL002
     C           SISPT     ANDEQ'6'                                       CPL002
     C                     MOVE 'P'       SMIVT                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           SISCY     CAT  'Midas'   SMIPG                           CPL002
     C                     MOVEL'Midas'   SMIRG                           CPL002
     C                     MOVEL'AAAA'    SMICR                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
      ** ACTION = "A"                                                     CPL002
      ** Re-access option instrument as details have been overwritten     CPL002
      **   by access to underlying futures instrument.                    CPL002
      *                                                                   CPL002
     C           ACTN      IFEQ 'A'                                       CPL002
      *                                                                   CPL002
     C           SISPT     IFEQ '4'                                       CPL002
     C           SISPT     OREQ '6'                                       CPL002
     C           SISPT     OREQ '8'                                       CPL002
      *                                                                   CPL002
     C                     MOVEL'N'       ISTI                            CPL002
     C                     MOVELMRKT      ISTTR                           CPL002
     C                     MOVE ISTC      ISTTR                           CPL002
     C                     MOVELISTTR     ISTT                            CPL002
      *                                                                   CPL002
     C           INTP1K    CHAININTYP1X              99                   CPL002
      *                                                                   CPL002
     C           *IN99     IFEQ '0'                                       CPL002
     C                     MOVELPLMIIT    SMIIT                           CPL002
     C                     MOVELPLMITM    SMITM                           CPL002
     C                     MOVE PLMICP    ZFIELD                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C                     MOVELPLMICF    SMICF                           CPL002
     C                     MOVELPLMIPC    SMIPC                           CPL002
     C                     MOVELPLMIVT    SMIVT                           CPL002
     C                     MOVELPLMIPM    SMIPM                           CPL002
     C                     MOVELPLMIPG    SMIPG                           CPL002
     C                     MOVELPLMIRG    SMIRG                           CPL002
     C                     MOVELPLMICR    SMICR                           CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C                     ENDSR                                          CPL002
     C******************************************************************* CPL002
      /EJECT                                                              CPL002
     C********************************************************************CPL002
      **                                                                  CPL002
      ** VALDA2 S/R TO VALIDATE TERM TO MATURITY                          CPL002
      ** CALLED FROM VALID2                                               CPL002
      ** CALLS NO OTHER S/R'S                                             CPL002
      **                                                                  CPL002
      ** INPUT: SCREEN VALUE                                              CPL002
      ** OUTPUT: *IN99 SET ON IF DATE FORMULA INVALID                     CPL002
      **                                                                  CPL002
     C********************************************************************CPL002
     C           VALDA2    BEGSR                                          CPL002
     C*                                                                   CPL002
     C                     SETOF                     99                   CPL002
     C*                                                                   CPL002
     C***********SPREF     IFNE '+'                                CPL002 167551
     C***********          SETON                     99            CPL002 167551
     C***********          GOTO XTVDA2                             CPL002 167551
     C***********          END                                     CPL002 167551
      *                                                                   CPL002
     C** Format position 2 to 4 and check for Numeric                     167551
     C***ARE*POSITIONS*2&3*NUMERIC*?****************************** CPL002 167551
      *                                                                   CPL002
     C************         TESTN          STERM      44            CPL002 167551
     C*                                                                   167551
     C*** Right align the input field if it is non-Blank.                 167551
     C*                                                                   167551
     C           SMITM     IFNE *BLANK                                    167551
     C                     MOVE *BLANKS   ZFIELD                          167551
     C                     MOVE SMITM     ZFIELD                          167551
     C                     MOVEAZFIELD    ZA1                             167551
     C           ZA1,16    DOWEQ' '                                       167551
     C                     Z-ADD16        ZX                              167551
     C                     Z-ADD15        ZY                              167551
     C                     DO   4                                         167551
     C                     MOVE ZA1,ZY    ZA1,ZX                          167551
     C                     SUB  1         ZX                              167551
     C                     SUB  1         ZY                              167551
     C                     END                                            167551
     C                     END                                            167551
     C                     MOVEAZA1       ZFIELD                          167551
     C                     MOVE ZFIELD    SMITM                           167551
     C                     END                                            167551
     C                     Z-ADD0         ZADEC                           167551
     C                     Z-ADD3         ZADIG                           167551
     C                     MOVEL*BLANK    ZFIELD                          167551
     C                     MOVE STERM     ZFIELD                          167551
     C                     EXSR ZALIGN                                    167551
     C************IN44     IFEQ '0'                                CPL002 167551
     C***********          SETON                     99            CPL002 167551
     C           *IN99     IFEQ '1'                                       167551
     C                     GOTO XTVDA2                                    CPL002
     C                     END                                            CPL002
     C                     MOVE ZFIELD    STERM                           167551
      *                                                                   CPL002
     C******IF*NOT*NUMERIC***************************************  CPL002 167551
     C** If it is numeric, it can not be zero.                            167551
     C*                                                                   167551
     C           STERM     IFEQ '000'                                     167551
     C                     MOVE '1'       *IN99                           167551
     C                     END                                            167551
     C*                                                                   167551
     C           SSIGN     IFNE 'D'                                       CPL002
     C           SSIGN     ANDNE'M'                                       CPL002
     C           SSIGN     ANDNE'Y'                                       CPL002
     C                     SETON                     99                   CPL002
     C                     GOTO XTVDA2                                    CPL002
     C                     END                                            CPL002
     C*                                                                   CPL002
     C           XTVDA2    ENDSR                                          CPL002
     C********************************************************************CPL002
     C/COPY WNCPYSRC,FF0150C010
      /EJECT                                                              CFF007
     C********************************************************************CFF007
      **                                                                  CFF007
      ** SRVLD3 S/R to validate detail screen 2                           CFF007
      **                                                                  CFF007
      ** CALLED BY: SRDTS3 S/R                                            CFF007
      **                                                                  CFF007
      ** CALLS NO OTHER SUBROUTINES                                       CFF007
      **                                                                  CFF007
     C********************************************************************CFF007
      *                                                                   CFF007
     C           SRVLD3    BEGSR                                          CFF007
      *                                                                   CFF007
     C                     MOVEA'000000'  *IN,31                          CFF007
     C                     Z-ADD*ZERO     EC                              CFF007
      *                                                                   CFF007
      ** For FOREX instruments, risk currency defaults to                 CFF007
      ** other currency                                                   CFF007
      *                                                                   CFF007
     C           SISPT     IFEQ '2'                                       CFF007
     C           SISPT     OREQ '5'                                       CFF007
      *                                                                   CFF007
     C           SCRIK     IFEQ *BLANK                                    CFF007
     C                     MOVE SOTHC     SCRIK                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C** Validate Underlying Security                                     CFF007
     C*                                                                   CFF007
     C           SUNSE     IFNE *BLANKS                                   CFF007
     C           BGSECS    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C           SUNSE     CHAINSECTY                99                   CFF007
     C*                                                                   CFF007
     C           *IN99     IFEQ '1'                                       CFF007
     C           *IN99     OREQ '0'                                       CFF007
     C           RECISE    ANDNE'D'                                       CFF007
     C*                                                                   CFF007
     C                     MOVE '1'       *IN31                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 400'    ERR,EC                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       WPRTEC                          CFF007
      *                                                                   CFF007
     C           ACTN      IFEQ 'A'                                       CFF007
      *                                                                   CFF007
     C           ISTT      SETLLTRANS13                                   CFF007
     C           ISTT      READETRANS13                  99               CFF007
      *                                                                   CFF007
     C           *IN99     DOWEQ'0'                                       CFF007
     C           WPRTEC    ANDEQ'N'                                       CFF007
      *                                                                   CFF007
     C           BLUP      IFEQ 'Y'                                       CFF007
     C           NOCO      ANDGT*ZEROS                                    CFF007
     C                     MOVE 'Y'       WPRTEC                          CFF007
     C                     MOVE '1'       *IN31                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 406'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C           ISTT      READETRANS13                  99               CFF007
     C                     ENDDO                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate PB Economic Sector                                      CFF007
      *                                                                   CFF007
     C           STECO     IFNE *BLANKS                                   CFF007
      *                                                                   CFF007
     C                     CALL 'AOECOSR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           STECO                           CFF007
     C           SDECOS    PARM SDECOS    @DSFDY                          CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN32                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 401'    ERR,EC                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE PCECOS    STECO                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGSECS    IFEQ 'Y'                                       CFF007
      *                                                                   CFF007
     C           SUNSE     CHAINSECTY                99                   CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     MOVE SIDY      @LICD   3                       CFF007
     C                     CALL 'AOINDSR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           @LICD                           CFF007
     C           SDINDS    PARM SDINDS    @DSFDY                          CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN32                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 401'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE AOECOS    STECO                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN32                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 401'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN32                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 401'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate Nature Code                                             CFF007
      *                                                                   CFF007
     C           STNAT     IFNE *BLANKS                                   CFF007
     C*                                                                   CFF007
     C                     CALL 'AONATUR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           STNAT                           CFF007
     C           SDNATU    PARM SDNATU    @DSFDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN33                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 402'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE TNNATU    STNAT                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGSECS    IFEQ 'Y'                                       CFF007
      *                                                                   CFF007
     C           SUNSE     CHAINSECTY                99                   CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     MOVE NATU      STNAT                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN33                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 402'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN33                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 402'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate Country of Risk                                         CFF007
      *                                                                   CFF007
     C           SCRIK     IFNE *BLANKS                                   CFF007
      *                                                                   CFF007
     C                     CALL 'AOCTRYR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCRIK                           CFF007
     C           SDCTRY    PARM SDCTRY    @DSFDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN34                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 403'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE A4CNCD    SCRIK                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGSECS    IFEQ 'Y'                                       CFF007
      *                                                                   CFF007
     C           SUNSE     CHAINSECTY                99                   CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     MOVE SCOR      SCRIK                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN34                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 403'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN34                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 403'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate Currency of Risk                                        CFF007
      *                                                                   CFF007
     C           SCCYR     IFNE *BLANKS                                   CFF007
      *                                                                   CFF007
     C                     CALL 'AOCURRR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCCYR                           CFF007
     C           SDCURR    PARM SDCURR    DSSDY                           CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN35                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 404'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE CURR      SCCYR                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C                     CALL 'AOCTRYR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           SCRIK                           CFF007
     C           SDCTRY    PARM SDCTRY    @DSFDY                          CFF007
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN35                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 404'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE A4CTAY    SCCYR                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** Validate Weighting Code                                          CFF007
      *                                                                   CFF007
     C           STWEI     IFNE *BLANKS                                   CFF007
     C                     MOVE STWEI     @WEIG   2                       CFF007
     C                     MOVEL'GP'      AOPGM  10                                           CGP001
     C                     MOVE 'AOWEIGR0'AOPGM                                               CGP001
     C**********           CALL 'AOWEIGR0'                                             CFF007 CGP001
     C                     CALL AOPGM                                                         CGP001
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*KEY   ' @OPTN                           CFF007
     C                     PARM           @WEIG                           CFF007
     C********** SDWEIG    PARM SDWEIG    @DSFDY                                       CFF007 CGP001
     C           GPWEIG    PARM GPWEIG    @DSFDY                                              CGP001
      *                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C                     MOVE '1'       *IN36                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 405'    ERR,EC                          CFF007
     C                     ELSE                                           CFF007
     C                     MOVE PDWEIG    STWEI                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
      *                                                                   CFF007
     C           BGSECS    IFEQ 'Y'                                       CFF007
      *                                                                   CFF007
     C           SUNSE     CHAINSECTY                99                   CFF007
      *                                                                   CFF007
     C           *IN99     IFEQ '0'                                       CFF007
     C                     MOVE WEIC      STWEI                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN36                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 405'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ELSE                                           CFF007
     C                     MOVE '1'       *IN36                           CFF007
     C                     ADD  1         EC                              CFF007
     C                     MOVEL' 405'    ERR,EC                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** If errors occured, highlight error band                          CFF007
      *                                                                   CFF007
     C           EC        IFNE *ZERO                                     CFF007
     C                     MOVEAERR       ERRMSG                          CFF007
     C                     MOVELHI        ERRMSG                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
      ** End of SRVLD3 S/R                                                CFF007
      *                                                                   CFF007
     C                     ENDSR                                          CFF007
     C********************************************************************CFF007
      /EJECT                                                              CPL002
     C********************************************************************
      **
      ** VALDAT S/R TO VALIDATE A SCREEN DATE ENTRY
      ** CALLED FROM VALIDD
      ** CALLS NO OTHER S/R'S
      **
      ** INPUT: DATE PASSED VIA DATASTRUCTURE SDATE
      ** OUTPUT: *IN99 SET ON IF DATE FORMULA INVALID
      **
     C********************************************************************
     C           VALDAT    BEGSR
     C*
     C                     SETOF                     99
     C*
      ** VALIDATE FIRST TWO POSITIONS
      **  FIRST TWO POSITIONS ARE MANDATORY
     C*
     C           SDN1      IFEQ *BLANK
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
      **       ARE POSITIONS 1&2 NUMERIC  ?
     C*
     C                     MOVE 0         WRK3A
     C                     MOVELSDN1      WRK3A
     C                     TESTN          WRK3A      24
     C*
      **       IF SDN1   IS NUMERIC
     C*
     C           *IN24     IFEQ '1'
     C                     MOVE SDN1      WRK2N   20
     C*
      **       NUMBER MUST BE BETWEEN 1 AND 28, OR BE 31.
     C*
     C***********WRK2N     IFGT 28                                        095053
     C           WRK2N     IFGT 30                                        095053
     C           SDN1      ANDNE'31'
     C           WRK2N     ORLT 1
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
     C*                                                                   095053
     C********** WRK2N     IFGT 28                                                     095053 243821
     C********** SMQ2      ANDEQ'Y'                                                    095053 243821
     C**********           SETON                     99                                095053 243821
     C**********           GOTO XTVDAT                                                 095053 243821
     C**********           END                                                         095053 243821
     C*                                                                   095053
      **    IF NOT NUMERIC
     C*
     C                     ELSE
     C*
      **   POSITION 1 TO BE  NUMERIC  1-4 INCL
     C*
     C           SWRK1     IFLT '1'
     C           SWRK1     ORGT '4'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
      ** 1ST CHARACTER VALID - CHECK 2ND IS IN ARRAY OF DAY IN WEEK CODES
     C*
     C           SWRK2     LOKUPLETT                     24
     C           *IN24     IFEQ '0'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
      ** END OF NON-NUMERIC VALIDATION
     C*
     C                     END
     C*
      ** VALIDATE POSITION 3
     C*
      **  IF POSITION 1/2 IS 31, POS 3 MUST BE BLANK, OR 4,5,6 HAVE ENTRY
      **  IF POSITION 1 AND 2 ARE NOT '31' POS.3 MUST BE '+' OR '-'
     C*
     C*
     C           SDN1      IFEQ '31'
     C           SWRK3     ANDNE*BLANK
     C           S456      ANDEQ*BLANK
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
     C           SDN1      IFNE '31'
     C           SWRK3     ANDNE'+'
     C           SWRK3     ANDNE'-'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
     C           SDN1      IFEQ '31'
     C           SWRK3     ANDNE'+'
     C           SWRK3     ANDNE'-'
     C           SWRK3     ANDNE' '
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*                                                                   E26293
     C** If an adjustment has been entered in positions 4,5 & 6           E26293
     C** the a '+' or '-' must be entered in position 3.                  E26293
     C*                                                                   E26293
     C           S456      IFNE *BLANK                                    E26293
     C           SWRK3     IFNE '+'                                       E26293
     C           SWRK3     ANDNE'-'                                       E26293
     C                     SETON                     99                   E26293
     C                     GOTO XTVDAT                                    E26293
     C                     END                                            E26293
     C                     END                                            E26293
     C*                                                                   E26293
     C** If details of an adjustment have been specified in positions     E26293
     C** 4, 5 or 6  all three positions must contain details of the       E26293
     C** adjust.                                                          E26293
     C*                                                                   E26293
     C           SWRK4     IFNE *BLANK                                    E26293
     C           SWRK5     ORNE *BLANK                                    E26293
     C           SWRK6     ORNE *BLANK                                    E26293
     C*                                                                   E26293
     C           SWRK4     IFEQ *BLANK                                    E26293
     C           SWRK5     OREQ *BLANK                                    E26293
     C           SWRK6     OREQ *BLANK                                    E26293
     C                     SETON                     99                   E26293
     C                     GOTO XTVDAT                                    E26293
     C                     END                                            E26293
     C                     END                                            E26293
     C*
      **  VALIDATE POSITIONS 4 AND 5
      **    IF ENTERED MUST BE NUMERIC,BETWEEN 1 AND 28 INCLUSIVE
     C*
     C           SDN2      IFNE *BLANK
     C*
     C                     MOVE 0         WRK3A
     C                     MOVELSDN2      WRK3A
     C                     TESTN          WRK3A      24
     C*
      ** NOT VALID NUMERIC
     C*
     C           *IN24     IFEQ '0'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     ELSE
     C*
      ** VALID NUMBER, CHECK RANGE
     C*
     C                     MOVE SDN2      WRK2N
     C           WRK2N     IFLT 1
     C           WRK2N     ORGT 28
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C                     END
     C*
      ** END OF NUMERIC VALIDATION FOR POS 4/5
     C*
     C                     END
     C*
      ** VALIDATE POSITION 6
     C*
      **    IF POSITIONS 4 AND 5 ARE ENTERED POS.6 MUST BE A,B OR C
     C*
     C           SDN2      IFNE *BLANK
     C           SWRK6     ANDNE'A'
     C           SWRK6     ANDNE'B'
     C           SWRK6     ANDNE'C'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
      ** VALIDATE POSITION 7
     C*
      **   IF POSITION 6 IS 'A' THEN POS.7 MUST BE '+' OR'-'
      **   OTHERWISE IT MUST BE BLANK.
     C*
     C           SWRK6     IFEQ 'A'
     C           SWRK7     IFNE '+'
     C           SWRK7     ANDNE'-'
     C                     SETON                     99
     C                     GOTO XTVDAT
     C                     END
     C*
     C                     ELSE
     C           SWRK7     IFNE ' '
     C                     SETON                     99
     C                     END
     C*
     C                     END
     C*
     C           XTVDAT    ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      **
      ** DEFLTS S/R TO FORMAT DEFAULT FIELD VALUES FOR INSERT SCREEN ETC
      ** CALLED FROM UPDATE; VALIDD
      ** CALLS NO OTHER S/R'S
      **
     C********************************************************************
     C           DEFLTS    BEGSR
     C*
      ** DEFAULTS FOR RECORD
     C*
      ** TICKS VALUE DEFAULTS TO 100
     C*
     C           STKDM     IFEQ *BLANK
     C                     MOVE '100'     STKDM
     C                     END
     C*
      ** PREMIUM UP FRONT DEFAULTS TO 'Y'
     C*
     C           SPUPF     IFEQ *BLANK
     C***********SISPT     IFEQ '4'                                       AUS022
     C***********SISPT     OREQ '5'                                       AUS022
     C***********SISPT     OREQ '6'                                       AUS022
     C           SISPT     IFGT '3'                                       AUS022
     C           SISPT     ANDNE'7'                                       AUS022
      *                                                                   AUS022
     C                     MOVE 'Y'       SPUPF
     C                     END
     C                     END
     C*
     C*                                                                   FF0011
      ** The American/European option indicator defaults to 'A' for       FF0011
      ** American.                                                        FF0011
      *                                                                   FF0011
     C           SAEIN     IFEQ *BLANK                                    FF0011
     C           SISPT     IFEQ '4'                                       FF0011
     C           SISPT     OREQ '5'                                       FF0011
     C           SISPT     OREQ '6'                                       FF0011
     C           SISPT     OREQ '8'                                       FF0011
     C                     MOVE 'A'       SAEIN                           FF0011
     C                     END                                            FF0011
     C                     END                                            FF0011
     C*
     C                     ENDSR
     C*******************************************************************
      /EJECT
     C*******************************************************************
      **
      ** INITRC S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK
      ** CALLED FROM UPDATE; UPDFLS
      ** CALLS NO OTHER S/R'S
      **
     C*******************************************************************
     C*
     C           INITRC    BEGSR
     C*
      ** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANK    DETREC
     C                     Z-ADD*ZERO     ISPT
     C                     Z-ADD*ZERO     QOTC
     C                     Z-ADD*ZERO     TKDM
     C                     Z-ADD*ZERO     MNPF
     C                     Z-ADD*ZERO     TKVL
     C                     Z-ADD*ZERO     CCMC
     C                     Z-ADD*ZERO     CCMS
     C                     Z-ADD*ZERO     CCGP
     C                     Z-ADD*ZERO     CCGS
     C                     Z-ADD*ZERO     CTAM
     C                     Z-ADD*ZERO     ULPD
     C                     Z-ADD*ZERO     ALPD                            S01393
     C                     Z-ADD*ZERO     FTDT
     C                     Z-ADD*ZERO     SETD
     C                     Z-ADD*ZERO     SPDT
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
     C*
     C**********           Z-ADD*ZERO     DBRK                                                CSD027
     C                     MOVE *BLANKS   DBRK                                                CSD027
     C                     Z-ADD*ZERO     BCMC
     C                     Z-ADD*ZERO     BCMS
     C                     Z-ADD*ZERO     BCGP
     C                     Z-ADD*ZERO     BCGS
     C                     Z-ADD*ZERO     TFPD
     C                     Z-ADD*ZERO     FSPM
     C                     Z-ADD*ZERO     CNTT                            AUS022
     C                     Z-ADD*ZERO     CCAM                            084771
     C                     Z-ADD*ZERO     TWEI                            CFF007
     C/COPY WNCPYSRC,FF0150C011
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT                                                              CPL002
     C******************************************************************* CPL002
      **                                                                  CPL002
      ** INITR2 S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK           CPL002
      ** CALLED FROM UPDAT2                                               CPL002
      ** CALLS NO OTHER S/R'S                                             CPL002
      **                                                                  CPL002
     C******************************************************************* CPL002
     C*                                                                   CPL002
     C           INITR2    BEGSR                                          CPL002
     C*                                                                   CPL002
      ** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)   CPL002
     C*                                                                   CPL002
     C                     MOVEL*BLANK    PLMIIT                          CPL002
     C                     MOVEL*BLANK    PLMITM                          CPL002
     C                     Z-ADD*ZERO     PLMICP                          CPL002
     C                     MOVEL*BLANK    PLMICF                          CPL002
     C                     MOVEL*BLANK    PLMIPC                          CPL002
     C                     MOVEL*BLANK    PLMIVT                          CPL002
     C                     MOVEL*BLANK    PLMIPM                          CPL002
     C                     MOVEL*BLANK    PLMIPG                          CPL002
     C                     MOVEL*BLANK    PLMIRG                          CPL002
     C                     MOVEL*BLANK    PLMICR                          CPL002
     C*                                                                   CPL002
     C                     ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT
     C********************************************************************
      **
      ** TRSSTF S/R - TO CONVERT SCREEN FIELDS TO FILE
      ** CALLED FROM UPDFLS S/R
      ***CALLS:*DEFLTS;*ZEDIT;*ZALIGN;*ZDATE1;*ZDATE5*********************S01195
      ** CALLS: DEFLTS; ZEDIT; ZALIGN; ZDATE1                             S01195
      **
     C********************************************************************
     C*
     C           TRSSTF    BEGSR
     C*
      ** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE
     C*
     C*
      ** ALPHA VALUES
     C*
      ** INSTRUMENT NAME
     C                     MOVELSISTN     ISTN
     C*                                                                   S01235
      ** INSTRUMENT TYPE (PORTFOLIO MGMT)                                 S01235
     C                     MOVELSINNR     INNR                            S01235
     C*
      ** INSTRUMENT CURRENCY
     C                     MOVELSISCY     ISCY
     C*
      ** OTHER CURRENCY
     C                     MOVELSOTHC     OTHC
     C*
      ** PREMIUM UP FRONT
     C                     MOVELSPUPF     PUPF
     C*
      ** FUTURE TYPE REF
     C                     MOVELSFTRF     FTRF
     C*
      ** STATUTORY RETURNS
     C                     MOVELSSTRC     STRC
     C*
      ** PRICING REF
     C                     MOVELSPRRF     PRRF
     C*
      ** COMMODITY REF
     C                     MOVELSCMRF     CMRF
     C*
      ** CUSTOMER CHARGE COMMISSION PATTERN
     C                     MOVELSCCPT     CCPT
     C*
      ** BROKER CHARGE COMMISSION PATTERN
     C                     MOVELSBCPT     BCPT
      *                                                                   FF0011
      ** AMERICAN/EUROPEAN INDICATOR                                      FF0011
      *                                                                   FF0011
     C                     MOVELSAEIN     AEIN                            FF0011
      ** MONTHS QUOTED
     C                     MOVEASMQ       ISMQ
     C*
      ** FINAL TRANSACTION DATE
     C                     MOVELSFTDF     FTDF
     C*
      ** SETTLEMENT DATE
     C                     MOVELSSEDF     SEDF
     C*
      ** SPOT MONTH DATE
     C                     MOVELSSPMF     SPMF
     C*
      ** TRANSLATE QUOTATION CONVENTION - SIGNED NUMERIC
     C*
     C           SQOTC     IFNE *BLANK
     C*
     C                     MOVE SQOTC     QDIG
     C                     MOVELSQOTC     QSIGN
     C*
      ** CAN BE +/-  1-9   ONLY THE FIRST CHARACTER CAN CONTAIN A SIGN
      ** FIRST CHAR QSIGN, SECOND QDIG
      ** IF SECOND CHARACTER IS BLANK FIRST MUST CONTAIN DIGIT
     C*
     C           QDIG      IFEQ *BLANK
     C           QSIGN     ANDGE'0'
     C           QSIGN     ANDLE'9'
     C                     MOVE QSIGN     QOTC
     C*
     C                     ELSE
     C                     MOVE QDIG      QOTC
     C           QSIGN     IFEQ '-'
     C                     Z-SUBQOTC      QOTC
     C                     END
     C                     END
     C                     END
     C*
      ** ZEROISE IF BLANK
     C*
     C           SQOTC     IFEQ *BLANK
     C                     Z-ADD0         QOTC
     C                     END
     C*
      ** INTEGER FIELDS
     C*
      ** INSTRUMENT PROCESSING TYPE
     C           SISPT     IFNE *BLANK
     C                     MOVELSISPT     ISPT
     C                     ELSE
     C                     Z-ADD0         ISPT
     C                     END
     C*                                                                   AUS022
      ** CONTRACT TYPE                                                    AUS022
     C           SCNTT     IFNE *BLANK                                    AUS022
     C                     MOVELSCNTT     CNTT                            AUS022
     C                     ELSE                                           AUS022
     C                     Z-ADD0         CNTT                            AUS022
     C                     END                                            AUS022
     C*
      ** DEFAULT BROKER CODE
     C           SDBRK     IFNE *BLANK
     C                     MOVELSDBRK     DBRK
     C                     ELSE
     C**********           Z-ADD0         DBRK                                                CSD027
     C                     MOVE *BLANKS   DBRK                                                CSD027
     C                     END
     C*
      ** BROKER COMMISSION CODE
     C           SBCMC     IFNE *BLANK
     C                     MOVELSBCMC     BCMC
     C                     ELSE
     C                     Z-ADD0         BCMC
     C                     END
     C*
     C*
      ** CUSTOMER COMMISSION CODE
     C           SCCMC     IFNE *ZERO
     C                     MOVELSCCMC     CCMC
     C                     ELSE
     C                     Z-ADD0         CCMC
     C                     END
     C*
      ** BROKER COMMISSION CODE - SAME DAY
     C           SBCMS     IFNE *BLANK
     C                     MOVELSBCMS     BCMS
     C                     ELSE
     C                     Z-ADD0         BCMS
     C                     END
     C*
      ** CUSTOMER COMMISSION CODE - SAME DAY
     C           SCCMS     IFNE *BLANK
     C                     MOVELSCCMS     CCMS
     C                     ELSE
     C                     Z-ADD0         CCMS
     C                     END
     C*
      ** BROKER CHARGE CODE - PURCHASES
     C           SBCGP     IFNE *BLANK
     C                     MOVELSBCGP     BCGP
     C                     ELSE
     C                     Z-ADD0         BCGP
     C                     END
     C*
      ** CUSTOMER CHARGE CODE - PURCHASES
     C           SCCGP     IFNE *BLANK
     C                     MOVELSCCGP     CCGP
     C                     ELSE
     C                     Z-ADD0         CCGP
     C                     END
     C*
      ** BROKER CHARGE CODE - SALES
     C           SBCGS     IFNE *BLANK
     C                     MOVELSBCGS     BCGS
     C                     ELSE
     C                     Z-ADD0         BCGS
     C                     END
     C*
      ** CUSTOMER CHARGE CODE - SALES
     C           SCCGS     IFNE *BLANK
     C                     MOVELSCCGS     CCGS
     C                     ELSE
     C                     Z-ADD0         CCGS
     C                     END
     C*
      ** NUMERIC FIELDS WITH DECIMAL PLACES
     C*
      ** TICK DENOMINATOR
     C           STKDM     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C                     MOVE STKDM     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TKDM
     C                     ELSE
     C                     Z-ADD0         TKDM
     C                     END
      *                                                                   CFF006
     C           CFF006    IFEQ 'Y'                                       CFF006
     C                     MOVE SFRTK     FRTK                            CFF006
     C                     ENDIF                                          CFF006
     C*
      ***UNDERLYING*PERIOD*********                                       S01393
      ** P&L AMORTISATION PERIOD                                          S01393
     C           SULPD     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C                     MOVE SULPD     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ULPD
     C                     ELSE
     C                     Z-ADD0         ULPD
     C                     END
     C*                                                                   S01393
      ** Underlying Period                                                S01393
     C           SALPD     IFNE *BLANK                                    S01393
     C                     MOVEL*BLANK    ZFIELD                          S01393
     C                     Z-ADD0         ZADEC                           S01393
     C                     Z-ADD5         ZADIG                           S01393
     C                     MOVE SALPD     ZFIELD                          S01393
     C                     EXSR ZALIGN                                    S01393
     C                     MOVE ZFIELD    ALPD                            S01393
     C                     ELSE                                           S01393
     C                     Z-ADD0         ALPD                            S01393
     C                     END                                            S01393
     C*
      ** MINIMUM PRICE FLUCTUATION
     C           SMNPF     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C/COPY WNCPYSRC,FF0150C003
     C***********          Z-ADD7         ZADEC                           CFF004
     C***********          Z-ADD4         ZADIG                           CFF004
     C/COPY WNCPYSRC,FF0150C004
     C                     Z-ADD8         ZADEC                           CFF004
     C                     Z-ADD7         ZADIG                           CFF004
     C                     MOVE SMNPF     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    MNPF
     C                     ELSE
     C                     Z-ADD0         MNPF
     C                     END
     C*
      ** TRADED FORWARD PERIODS
     C           STFPD     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVE STFPD     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TFPD
     C                     ELSE
     C                     Z-ADD0         TFPD
     C                     END
     C*
      ** FORWARD SPOT MONTHS
     C           SFSPM     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVE SFSPM     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    FSPM
     C                     ELSE
     C                     Z-ADD0         FSPM
     C                     END
     C*
      ** AMOUNT FIELDS
     C*
      ***ACCESS*TABLE*FILE*FOR*INSTRUMENT*CURRENCY*DECIMAL*POSITIONS***   S01117
      ** CALL ACCESS OBJECT FOR INSTRUMENT CURRENCY DECIMAL POSITIONS     S01117
     C*
     C***********          MOVE ISCY      TCCY                            S01117
     C                     Z-ADD0         CDP
     C***********CCYK      CHAINTABFF                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ISCY      @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
      ** DATABASE ERROR IF NO RECORD FOUND
      ** NO DATABASE ERROR FOR INSERTS, OR IF ACTION IS 'E' AND DELT SET UP
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABFF'   DBFILE           ***************S01117
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01117
     C***********          MOVE '07'      DBASE            * DB ERROR 07 *S01117
     C                     Z-ADD7         DBASE            * DB ERROR 07 *S01117
     C***********          MOVELCCYK      DBKEY            ***************S01117
     C                     MOVELISCY      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C                     Z-ADDCDP       ICDP
     C*
      ***ACCESS*TABLE*FILE*FOR*OTHER*CURRENCY*DECIMAL*POSITIONS********   S01117
      ** CALL ACCESS OBJECT FOR OTHER CURRENCY DECIMAL POSITIONS          S01117
     C*
     C           ISPT      IFEQ 2
     C           ISPT      OREQ 5
     C***********          MOVE OTHC      TCCY                            S01117
     C                     Z-ADD0         CDP
     C***********CCYK      CHAINTABFF                99                   S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM OTHC      @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
      ** DATABASE ERROR IF NO RECORD FOUND
      ** NO DATABASE ERROR FOR INSERTS, OR IF ACTION IS 'E' AND DELT SET UP
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABFF'   DBFILE           ***************S01117
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01117
     C***********          MOVE '08'      DBASE            * DB ERROR 08 *S01117
     C                     Z-ADD8         DBASE            * DB ERROR 08 *S01117
     C***********          MOVELCCYK      DBKEY            ***************S01117
     C                     MOVELOTHC      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C                     Z-ADDCDP       OCDP
     C                     END
     C*
      ** TICK VALUE - DEPENDANT ON INSTRUMENT CCY
     C           STKVL     IFNE *BLANK
     C                     MOVEL*BLANK    ZFIELD
     C***********ICDP      ADD  5         ZADEC                           E16371
     C***********ICDP      ADD  2         ZADEC                     E16371E18188
     C           ICDP      ADD  5         ZADEC                           E18188
     C           14        SUB  ZADEC     ZADIG
     C                     MOVE STKVL     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    TKVL
     C                     ELSE
     C                     Z-ADD0         TKVL
     C                     END
     C*
      ** AMOUNTS IN INSTRUMENT CURRENCY
     C*
     C                     Z-ADDICDP      ZADEC
     C           13        SUB  ICDP      ZADIG
     C*
      ** CONTINGENT AMOUNT
     C*
      ** WILL BE IN OTHER CURRENCY FOR PROCESSING TYPE 2&5
     C*
     C           SCTAM     IFNE *BLANK
     C           ISPT      IFEQ 2
     C           ISPT      OREQ 5
     C                     Z-ADDOCDP      ZADEC
     C           13        SUB  OCDP      ZADIG
     C                     END
     C*
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE SCTAM     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CTAM
     C                     ELSE
     C                     Z-ADD0         CTAM
     C                     END
     C/COPY WNCPYSRC,FF0150C012
     C*  IF MIDAS/PLATO INTERFACE INSTALLED, THEN SET UP THESE FIELDS     CPL002
     C*                                                                   CPL002
     C                     Z-ADD0         PLMIMD                          167555
     C                     Z-ADD0         PLMICP                          167555
     C*                                                                   167555
     C           BGN2ST    IFEQ 'Y'                                       CPL002
      *                                                                   CPL002
      ** Underlying Instrument Type                                       CPL002
     C                     MOVELSMIIT     PLMIIT                          CPL002
      *                                                                   CPL002
      ** Underlying Term to Maturity                                      CPL002
     C                     MOVELSMITM     PLMITM                          CPL002
     C*                                                                   CPL002
     C** If instrument is Bond then update Maturity Date                  CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C                     Z-ADDWMIMD     PLMIMD                          CPL002
     C                     ELSE                                           CPL002
     C                     Z-ADD0         PLMIMD                          CPL002
     C                     END                                            CPL002
      *                                                                   CPL002
      ** Underlying Coupon Rate                                           CPL002
     C                     Z-ADDW#MICP    PLMICP                          CPL002
      *                                                                   CPL002
      ** Underlying Coupon Frequency                                      CPL002
     C                     MOVELSMICF     PLMICF                          CPL002
      *                                                                   CPL002
      ** Underlying Price Convention                                      CPL002
     C                     MOVELSMIPC     PLMIPC                          CPL002
      *                                                                   CPL002
      ** Options Volatility Type                                          CPL002
     C                     MOVELSMIVT     PLMIVT                          CPL002
      *                                                                   CPL002
      ** Options Pricing Method                                           CPL002
     C                     MOVELSMIPM     PLMIPM                          CPL002
      *                                                                   CPL002
      ** Pricing Group                                                    CPL002
     C                     MOVELSMIPG     PLMIPG                          CPL002
      *                                                                   CPL002
      ** Reporting Group                                                  CPL002
     C                     MOVELSMIRG     PLMIRG                          CPL002
      *                                                                   CPL002
      ** Credit Group                                                     CPL002
     C                     MOVELSMICR     PLMICR                          CPL002
     C                     ENDIF                                          CPL002
      *                                                                   CPL002
     C           CFF007    IFEQ 'Y'                                       CFF007
     C                     MOVE SUNSE     UNSE                            CFF007
     C                     MOVE STECO     TECO                            CFF007
     C                     MOVE STNAT     TNAT                            CFF007
     C                     MOVE SCRIK     CRIK                            CFF007
     C                     MOVE SCCYR     CCYR                            CFF007
     C                     MOVE STWEI     TWEI                            CFF007
     C                     ENDIF                                          CFF007
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      **
      ** TRSFS S/R TO FORMAT RECORD FIELDS FOR SCREEN
      ** CALLED FROM UPDATE
      ** CALLS NO OTHER S/R'S
      **
     C********************************************************************
     C*
     C           TRSFS     BEGSR
     C*
      ** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C*
      ** ALPHA VALUES
     C*
      ** INSTRUMENT NAME
     C                     MOVELISTN      SISTN
     C*                                                                   S01235
      ** INSTRUMENT TYPE (PORTFOLIO MGMT)                                 S01235
     C                     MOVELINNR      SINNR                           S01235
     C*
      ** INSTRUMENT CURRENCY
     C                     MOVELISCY      SISCY
     C*
      ** OTHER CURRENCY
     C                     MOVELOTHC      SOTHC
     C*
      ** PREMIUM UP FRONT
     C                     MOVELPUPF      SPUPF
     C*
      ** FUTURE TYPE REF
     C                     MOVELFTRF      SFTRF
     C*
      ** STATUTORY RETURNS
     C                     MOVELSTRC      SSTRC
     C*
      ** PRICING REF
     C                     MOVELPRRF      SPRRF
     C*
      ** COMMODITY REF
     C                     MOVELCMRF      SCMRF
     C*
      ** CUSTOMER CHARGE COMMISSION PATTERN
     C                     MOVELCCPT      SCCPT
     C*
      ** BROKER CHARGE COMMISSION PATTERN
     C                     MOVELBCPT      SBCPT
      *                                                                   FF0011
      ** AMERICAN/EUROPEAN INDICATOR                                      FF0011
      *                                                                   FF0011
     C                     MOVELAEIN      SAEIN                           FF0011
     C*                                                                   FF0011
      ** MONTHS QUOTED
     C                     MOVEAISMQ      SMQ
     C*
      ** FINAL TRANSACTION DATE
     C                     MOVELFTDF      SFTDF
     C*
      ** SETTLEMENT DATE
     C                     MOVELSEDF      SSEDF
     C*
      ** SPOT MONTH DATE
     C                     MOVELSPMF      SSPMF
     C*
      ** TRANSLATE QUOTATION CONVENTION - SIGNED NUMERIC
      ** AS THIS IS A DIFFERENT LENGTH ON FILE/SCREEN, MUST BE BLANKED FIRST
     C*
     C                     MOVE *BLANK    SQOTC
     C           QOTC      IFGE 0
     C                     MOVE QOTC      SQOTC
     C                     ELSE
     C                     MOVEL'-'       SQOTC
     C           *LIKE     DEFN QOTC      WRKN1
     C                     Z-SUBQOTC      WRKN1
     C                     MOVE WRKN1     SQOTC
     C                     END
     C*
      ** BLANK IF ZERO
     C*
     C           QOTC      IFEQ 0
     C                     MOVE *BLANK    SQOTC
     C                     END
     C*
      ** INTEGER FIELDS
     C*
      ** INSTRUMENT PROCESSING TYPE
     C           ISPT      IFNE *ZERO
     C                     MOVELISPT      SISPT
     C                     ELSE
     C                     MOVEL*BLANK    SISPT
     C                     END
     C*
      ** CONTRACT TYPE                                                    AUS022
     C           CNTT      IFNE *ZERO                                     AUS022
     C                     MOVELCNTT      SCNTT                           AUS022
     C                     ELSE                                           AUS022
     C                     MOVEL*BLANK    SCNTT                           AUS022
     C                     END                                            AUS022
     C*                                                                   AUS022
      ** DEFAULT BROKER CODE
     C********** DBRK      IFNE *ZERO                                                         CSD027
     C           DBRK      IFNE *BLANKS                                                       CSD027
     C                     MOVEL*BLANK    SDBRK
     C                     MOVELDBRK      SDBRK
     C                     ELSE
     C                     MOVEL*BLANK    SDBRK
     C                     END
     C*
      ** BROKER COMMISSION CODE
     C           BCMC      IFNE *ZERO
     C                     MOVELBCMC      SBCMC
     C                     ELSE
     C                     MOVEL*BLANK    SBCMC
     C                     END
     C*
      ** CUSTOMER COMMISSION CODE
     C           CCMC      IFNE *ZERO
     C                     MOVELCCMC      SCCMC
     C                     ELSE
     C                     MOVEL*BLANK    SCCMC
     C                     END
     C*
      ** BROKER COMMISSION CODE - SAME DAY
     C           BCMS      IFNE *ZERO
     C                     MOVELBCMS      SBCMS
     C                     ELSE
     C                     MOVEL*BLANK    SBCMS
     C                     END
     C*
      ** CUSTOMER COMMISSION CODE - SAME DAY
     C           CCMS      IFNE *ZERO
     C                     MOVELCCMS      SCCMS
     C                     ELSE
     C                     MOVEL*BLANK    SCCMS
     C                     END
     C*
      ** BROKER CHARGE CODE - PURCHASES
     C           BCGP      IFNE *ZERO
     C                     MOVELBCGP      SBCGP
     C                     ELSE
     C                     MOVEL*BLANK    SBCGP
     C                     END
     C*
      ** CUSTOMER CHARGE CODE - PURCHASES
     C           CCGP      IFNE *ZERO
     C                     MOVELCCGP      SCCGP
     C                     ELSE
     C                     MOVEL*BLANK    SCCGP
     C                     END
     C*
      ** BROKER CHARGE CODE - SALES
     C           BCGS      IFNE *ZERO
     C                     MOVELBCGS      SBCGS
     C                     ELSE
     C                     MOVEL*BLANK    SBCGS
     C                     END
     C*
      ** CUSTOMER CHARGE CODE - SALES
     C           CCGS      IFNE *ZERO
     C                     MOVELCCGS      SCCGS
     C                     ELSE
     C                     MOVEL*BLANK    SCCGS
     C                     END
     C*
      ** NUMERIC FIELDS WITH DECIMAL PLACES
     C*
      ** TICK DENOMINATOR
     C           TKDM      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C                     MOVE TKDM      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STKDM
     C                     ELSE
     C                     MOVEL*BLANK    STKDM
     C                     END
      *                                                                   CFF006
     C           CFF006    IFEQ 'Y'                                       CFF006
     C                     MOVE FRTK      SFRTK                           CFF006
     C                     ENDIF                                          CFF006
     C*
      ***UNDERLYING*PERIOD********                                        S01393
      ** P&L AMORTISATION PERIOD                                          S01393
     C           ULPD      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C                     MOVE ULPD      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SULPD
     C                     ELSE
     C                     MOVEL*BLANK    SULPD
     C                     END
     C*                                                                   S01393
      ** Underlying Period                                                S01393
     C           ALPD      IFNE *ZERO                                     S01393
     C                     MOVEL*BLANK    ZFIELD                          S01393
     C                     Z-ADD0         ZADEC                           S01393
     C                     Z-ADD5         ZADIG                           S01393
     C                     MOVE ALPD      ZFIELD                          S01393
     C                     EXSR ZEDIT                                     S01393
     C                     MOVE ZFIELD    SALPD                           S01393
     C                     ELSE                                           S01393
     C                     MOVEL*BLANK    SALPD                           S01393
     C                     END                                            S01393
     C*
      ** MINIMUM PRICE FLUCTUATION
     C           MNPF      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C/COPY WNCPYSRC,FF0150C005
     C***********          Z-ADD7         ZADEC                           CFF004
     C***********          Z-ADD4         ZADIG                           CFF004
     C/COPY WNCPYSRC,FF0150C006
     C                     Z-ADD8         ZADEC                           CFF004
     C                     Z-ADD7         ZADIG                           CFF004
     C                     MOVE MNPF      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SMNPF
     C                     ELSE
     C                     MOVEL*BLANK    SMNPF
     C                     END
     C*
      ** TRADED FORWARD PERIODS
     C           TFPD      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVE TFPD      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    STFPD
     C                     ELSE
     C                     MOVEL*BLANK    STFPD
     C                     END
     C*
      ** FORWARD SPOT MONTHS
     C           FSPM      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C                     MOVE FSPM      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SFSPM
     C                     ELSE
     C                     MOVEL*BLANK    SFSPM
     C                     END
     C*
      ** AMOUNT FIELDS
     C*
      ***ACCESS*TABLE*FILE*FOR*INSTRUMENT CURRENCY*DECIMAL*POSITIONS***   S01117
      ** NO DB ERROR FOR ACTION IS 'I' OR                                 S01117
      **             FOR ACTION IS 'E' AND DELT IS NOT EQUAL TO BLANK     S01117
      ** CALL ACCESS OBJECT FOR INSTRUMENT CURRENCY DECIMAL POSITIONS     S01117
     C*
     C***********          MOVE ISCY      TCCY                            S01117
     C                     Z-ADD0         CDP
     C***********CCYK      CHAINTABFF                99                   S01117
     C           ACTN      IFNE 'I'                                       S01117
     C           ACTN      IFNE 'E'                                       S01117
     C           DELT      OREQ *BLANK                                    S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ISCY      @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
      ***DATABASE*ERROR*IF*NO*RECORD*FOUND********************************S01117
      ***NO*DATABASE*ERROR*FOR*INSERTS,*OR*IF*ACTION*IS*'E'*AND*DELT*SET*US01117
     C*
     C***********ACTN      IFNE 'E'                                       S01117
     C***********DELT      ANDNE*BLANK                                    S01117
     C***********ACTN      ORNE 'I'                                       S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABFF'   DBFILE           ***************S01117
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01117
     C***********          MOVE '02'      DBASE            * DB ERROR 02 *S01117
     C                     Z-ADD2         DBASE            * DB ERROR 02 *S01117
     C***********          MOVELCCYK      DBKEY            ***************S01117
     C                     MOVELISCY      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C                     END
     C                     END                                            S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       ICDP
     C*
      ***ACCESS*TABLE*FILE*FOR*OTHER*CURRENCY*DECIMAL*POSITIONS********   S01117
      ** NO DB ERROR FOR ACTION IS 'I' OR                                 S01117
      **             FOR ACTION IS 'E' AND DELT IS NOT EQUAL TO BLANK     S01117
      ** ACCESS OBJECT FOR OTHER CURRENCY DECIMAL POSITIONS               S01117
     C*
     C           ISPT      IFEQ 2
     C           ISPT      OREQ 5
     C***********          MOVE OTHC      TCCY                            S01117
     C                     Z-ADD0         CDP
     C***********CCYK      CHAINTABFF                99                   S01117
     C           ACTN      IFNE 'I'                                       S01117
     C           ACTN      IFNE 'E'                                       S01117
     C           DELT      OREQ *BLANK                                    S01117
     C                     CALL 'AOCURRR0'                                S01117
     C                     PARM '*DBERR'  @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM OTHC      @AJCD   3                       S01117
     C***********SDCURR    PARM SDCURR    @DSFDY                    S01117123872
     C           SDCURR    PARM SDCURR    DSSDY                           123872
     C*
      ***DATABASE*ERROR*IF*NO*RECORD*FOUND********************************S01117
      ***NO*DATABASE*ERROR*FOR*INSERTS,*OR*IF*ACTION*IS*'E'*AND*DELT*SET*US01117
     C*
     C***********ACTN      IFNE 'E'
     C***********DELT      ANDNE*BLANK
     C***********ACTN      ORNE 'I'
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABFF'   DBFILE           ***************S01117
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01117
     C***********          MOVE '03'      DBASE            * DB ERROR 03 *S01117
     C                     Z-ADD3         DBASE            * DB ERROR 03 *S01117
     C***********          MOVELCCYK      DBKEY            ***************S01117
     C                     MOVELOTHC      DBKEY            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C                     END
     C                     END                                            S01117
     C*                                                                   S01117
     C                     Z-ADDCDP       OCDP
     C                     END
     C*
      ** TICK VALUE - DEPENDANT ON INSTRUMENT CCY
     C           TKVL      IFNE *ZERO
     C                     MOVEL*BLANK    ZFIELD
     C***********ICDP      ADD  5         ZADEC                           E16371
     C***********ICDP      ADD  2         ZADEC                     E16371E18188
     C           ICDP      ADD  5         ZADEC                           E18188
     C           14        SUB  ZADEC     ZADIG
     C                     MOVE TKVL      ZFIELD
     C                     EXSR ZEDIT
     C***********          MOVE ZFIELD    STKVL                           FO0006
     C                     MOVELZFIELD    TKVLX  13                       FO0006
     C                     MOVE *BLANK    STKVL                           FO0006
     C                     MOVE TKVLX     STKVL                           FO0006
     C                     ELSE
     C                     MOVEL*BLANK    STKVL
     C                     END
     C*
      ** AMOUNTS IN INSTRUMENT CURRENCY
     C*
     C                     Z-ADDICDP      ZADEC
     C           13        SUB  ICDP      ZADIG
     C*
      ** CONTINGENT AMOUNT
     C*
      ** WILL BE IN OTHER CURRENCY FOR PROCESSING TYPE 2&5
     C*
     C           CTAM      IFNE 0
     C           ISPT      IFEQ 2
     C           ISPT      OREQ 5
     C                     Z-ADDOCDP      ZADEC
     C           13        SUB  OCDP      ZADIG
     C                     END
     C*
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE CTAM      ZFIELD
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SCTAM
     C                     ELSE
     C                     MOVE *BLANK    SCTAM
     C                     END
     C*
      ** QUOTED MONTHS MUST BE PROTECTED IF AMEND WITH SSF ON
     C*
     C                     MOVEA'00000000'*IN,62
     C                     MOVEA'0000'    *IN,70
     C*
     C           *IN26     IFEQ '1'
     C*
      ** FOR EACH OF THE 12 MONTHS, IF THE FILE VALUE IS 'Y', PROTECT IT
      ** USING THE ERROR INDICATOR FROM THE INDICATOR SUMMARY
     C*
     C                     MOVEAISMQ      FMQ
     C                     Z-ADD62        Y       20
     C*
     C                     DO   12        X
     C*
     C           FMQ,X     IFEQ 'Y'
     C                     MOVE '1'       *IN,Y
     C                     END
     C                     ADD  1         Y
     C*
      ** ENDDO
     C*
     C                     END
     C*
      ** END OF SSF ON FOR AMEND PROCESSING
     C*
     C                     END
     C/COPY WNCPYSRC,FF0150C013
      *                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
      *                                                                   CFF007
     C                     MOVE UNSE      SUNSE                           CFF007
     C                     MOVE TECO      STECO                           CFF007
     C                     MOVE TNAT      STNAT                           CFF007
     C                     MOVE CRIK      SCRIK                           CFF007
     C                     MOVE CCYR      SCCYR                           CFF007
      *                                                                   CFF007
     C           TWEI      IFNE *ZERO                                     CFF007
     C                     MOVE TWEI      STWEI                           CFF007
     C                     ELSE                                           CFF007
     C                     MOVE *BLANK    STWEI                           CFF007
     C                     ENDIF                                          CFF007
      *                                                                   CFF007
     C                     ENDIF                                          CFF007
     C*
     C           XTTRSF    ENDSR
     C********************************************************************
      /EJECT                                                              CPL002
     C********************************************************************CPL002
      **                                                                  CPL002
      ** TRSF2 S/R TO FORMAT RECORD FIELDS FOR SCREEN                     CPL002
      ** CALLED FROM UPDAT2                                               CPL002
      ** CALLS NO OTHER S/R'S                                             CPL002
      **                                                                  CPL002
     C********************************************************************CPL002
     C*                                                                   CPL002
     C           TRSFS2    BEGSR                                          CPL002
     C*                                                                   CPL002
     C                     MOVE PLMIIT    SMIIT                           CPL002
     C                     MOVE PLMITM    SMITM                           CPL002
     C*                                                                   CPL002
     C                     Z-ADD7         ZADEC                           CPL002
     C                     Z-ADD4         ZADIG                           CPL002
     C*                                                                   CPL002
     C                     MOVE PLMICP    ZFIELD                          CPL002
     C                     EXSR ZEDIT                                     CPL002
     C                     MOVE ZFIELD    SMICP                           CPL002
     C                     MOVE PLMICF    SMICF                           CPL002
     C                     MOVE PLMIPC    SMIPC                           CPL002
     C                     MOVE PLMIVT    SMIVT                           CPL002
     C                     MOVE PLMIPM    SMIPM                           CPL002
     C                     MOVE PLMIPG    SMIPG                           CPL002
     C                     MOVE PLMIRG    SMIRG                           CPL002
     C                     MOVE PLMICR    SMICR                           CPL002
     C*                                                                   CPL002
     C           SMIIT     IFEQ 'B'                                       CPL002
     C                     MOVE PLMIMD    ZDAYNO                          CPL002
     C                     EXSR ZDATE2                                    CPL002
     C                     MOVE ZDATE     SMITD                           CPL002
     C                     ELSE                                           CPL002
     C                     MOVE *BLANKS   SMITD                           CPL002
     C                     ENDIF                                          CPL002
     C*                                                                   CPL002
     C           XTTRS2    ENDSR                                          CPL002
     C********************************************************************CPL002
      /EJECT
     C********************************************************************
      **
      ** UPDFLS S/R TO UPDATE FILE RECORDS
      ** CALLED FROM UPDATE
      ** CALLS INITRC; ZTNLU1; INFSR
      **
     C           UPDFLS    BEGSR
     C*
      ** U P D A T E   F I L E S
     C*
      ** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
      ** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
      ** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
     C*
      **               I  N  S  E  R  T  S
     C*
     C           ACTN      IFEQ 'I'
     C           INTP1K    CHAININTYPDF              25
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
      ** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
      ** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR TRSSTF
     C                     MOVEL'D'       RECI
     C                     MOVEL'N'       ISTI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C   25                WRITEINTYPDF                16
     C*
      ** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN16     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           INTP1K    CHAININTYP1X              16
     C*
     C           *IN16     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
     C*
     C           *IN16     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C  N25                UPDATINTYPDF
     C                     END
     C*
      **               A  M  E  N  D  S
     C*
     C           ACTN      IFEQ 'A'
     C           INTP1K    CHAININTYPDF              25
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
      ** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C* TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR TRSSTF
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N25                UPDATINTYPDF
     C                     END
     C*
      **               D  E  L  E  T  E  S
     C*
     C           ACTN      IFEQ 'D'
     C           INTP1K    CHAININTYPDF              25
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
      ** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C                     MOVEL'*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N25                UPDATINTYPDF
     C                     END
     C*
      ** GET AUDIT RECORD
     C*
     C           1         CHAININTYPAF              99
     C*
      ** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C*
      ** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE
      ** RECORDS
     C*
     C           ACTN      IFEQ 'I'
     C                     ADD  1         NINS
     C                     ADD  1         NORE
     C                     END
     C*
      ** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         NAMD
     C                     END
     C*
      **  FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECORDS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         NDEL
     C                     SUB  1         NORE
     C                     END
     C*
      ** FORMAT COMIT TEXT
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C                     MOVEADETS      DET,08
     C*
      ** UPDATE AUDIT RECORD
     C*
     C                     UPDATINTYPAF
     C*
      ** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
      ** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C           *LOCK     IN   LDA                                       S01117
     C                     SETON                     U7U8LR***************
     C***********          MOVEL'04'      DBASE            * DB ERROR 04 *S01117
     C                     Z-ADD4         DBASE            * DB ERROR 04 *S01117
     C                     MOVEL'INTYP'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C           XTUPDF    ENDSR
     C*
      ********************************************************************
      /EJECT
      ********************************************************************
      **
      ** UPDOWS S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION
      ** CALLED FROM UPDFLS
      ** CALLS NO OTHER S/R'S
      **
     C           UPDOWS    BEGSR
      **
     C                     ROLBK
      **
      **   SET UP NEXT SCREEN TO BE DISPLAYED:
      **   IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
      **
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       ACTN
     C                     ELSE
      **
      **   IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
      **
     C                     MOVEL'E'       ACTN
     C                     END
      **
      **   SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
      **
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,11    INFMSG
      **
     C                     ENDSR
      **
      ********************************************************************
     C/EJECT
      /COPY ZSRSRC,FFDATEZ3
      /EJECT
     C** ZALIGN SUBROUTINE
     C/COPY ZSRSRC,ZALIGNZ2
     C*
      /EJECT
     C** ZEDIT SUBROUTINE
     C/COPY ZSRSRC,ZEDITZ2
     C*
     C/EJECT
     C** ZTNLU1 SUBROUTINE
     C/COPY ZSRSRC,ZTNLU1Z2
     C*
     C/EJECT
     C** ZDATE1 SUBROUTINE
     C/COPY ZSRSRC,ZDATE1Z2
     C*
     C/EJECT
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZACCH  --- SUBROUTINE TO ACCESS A HOLIDAY RECORD FOR A            S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: ZFWDT, ZBKDT                                         S01195
     C*                                                                   S01195
     C* CALLS: NOTHING                                                    S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/EJECT                                                              S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZFWDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            FORWARD FROM A GIVEN START DATE FOR ANY                S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FFDATE                                               S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C/EJECT                                                              S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZBKDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            BACKWARD FROM A GIVEN START DATE FOR ANY               S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FFDATE                                               S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/EJECT                                                              S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZCHKH  --- SUBROUTINE TO VALIDATE THE GIVEN DATE FOR ANY          S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FFDATE                                               S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/EJECT                                                              CPL002
     C/COPY ZSRSRC,ZDATE2Z2                                               CPL002
     C***ZDATE2*SUBROUTINE************************************************S01195
     C*COPY*ZSRSRC,ZDATE3Z4***********************************************S01195
     C********************************************************************S01195
     C*EJECT**************************************************************S01195
     C***ZDATE5*SUBROUTINE************************************************S01195
     C*COPY*ZSRSRC,ZDATE5Z2***********************************************S01195
     C*
      /EJECT
      *****************************************************************
      **
      **   FILE EXEPTION/ERROR HANDLING SUBROUTINE
      **
     C           INFSR     BEGSR
      **
      ** ROLL BACK CHANGES AND CALCEL PROGRAM
      **
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
      **
     C                     ENDSREXTTAG
      ********************************************************************
     C/EJECT
     C*****************************************************************
      **
      **   SUBROUTINE DBERR:  TO EXIT PROGRAM
      **
      **   CALLED FROM SUBROUTINES:
      **
      **   CALLS NO OTHER SUBROUTINES
      **
     C           DBERR     BEGSR
     C*                                                                   S01117
      **   PRODUCE DUMP.                                                  S01117
     C*                                                                   S01117
     C                     EXSR *PSSR                                     S01117
     C*
      **   LEAVE PROGRAM.
      ** If program has been called from as a linked enquiry then set     S01393
      ** return code and return to calling program.                       S01393
     C*
     C                     RETRN
     C   85                MOVE 'ERR '    PPRTCD                          S01393
     C*
     C                     ENDSR
     C*****************************************************************
     C/SPACE 3                                                            S01117
     C********************************************************************S01117
      **                                                                  S01117
      ** *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0150CCP4                                           S01408
     C*                                                                   S01408
      * /104633/ Change
      * INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:help
      * INF,10 F10 is reqiured
      * INF,11 F10 is not reqiured
      *                                                                   CFF007
      ** INF,14 F12 Taken - Update Cancelled                              CFF007
      ** INF,15 F12 Taken - Insert Cancelled                              CFF007
      *                                                                   CFF007
**  CPY@
(c) Finastra International Limited 2001
** POWER9                                                                 E14168
0000000010                                                                E14168
0000000100                                                                E14168
0000001000                                                                E14168
0000010000                                                                E14168
0000100000                                                                E14168
0001000000                                                                E14168
0010000000                                                                E14168
0100000000                                                                E14168
1000000000                                                                E14168
** INF
 Enter:Action Code I,A,D,E and selection:Review from point;F3;Help
 Enter:Review from point;Action Code A,D,E;F3;F12;Rollup;Rolldown;     Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm
 
 Record has been updated by another workstation
 No Records Found: Enter Review from point; F12; F3; Help
 LINKED ENQUIRY Enter: F3; F12; Help
 F12 Taken - Update Cancelled                                             CFF007
 F12 Taken - Insert Cancelled                                             CFF007
     X/COPY WNCPYSRC,FF0150X001
**   LETT - LETTERS FOR DAYS TO VALIDATE DATE FORMULAS
MUWTFSX
**   TABDY/TABNO - SHORTNAMES & DAY NUMBERS
F0S1X2M3U4W5T6
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
