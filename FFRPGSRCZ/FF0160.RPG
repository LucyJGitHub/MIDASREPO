     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Defaults Maintenance')                        *
/*OVRF*: OVRDBF DEFLTX DEFLT                                        : *
      *****************************************************************
      *                                                               *
      *  Midas  -  Futures and Options Module                         *
      *                                                               *
      *   FF0160  -  DEFAULTS MAINTENANCE                             *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CLE064             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Prev Amend No. 247931             Date 24May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD027B            Date 29Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA089             Date 26Mar04               *
      *                 TDA051             Date 21Mar04               *
      *                 CAAA03             Date 10Mar04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CFF004             Date 02Oct96               *
      *                 104633             Date 08Jul96               *
      *                 S71062             Date 19DEC95               *
      *                 S01408             Date 13MAR95               *
      *                 S01455             Date 05NOV93               *
      *                 S04662             Date 12JUL93               *
      *                 S01393             Date 30OCT92               *
      *                 FUJI-FF0011        Date 21AUG92               *
      *                 AUS022             Date 10AUG92               *
      *                 E27424             Date 15AUG91               *
      *                 E25437             Date 14JUN91               *
      *                 E23409             Date 31AUG90               *
      *                 HK0000             Date 10APR90               *
      *                 S01199             Date 27FEB90               *
      *                 S01195             Date 23JAN90               *
      *                 S01117             Date 22JAN90               *
      *                 S01179             Date 23/09/8 8             *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  247931 - Applied fix 220888.                                 *
      *  220888 - Screen select does not work correctly.              *
      *  CSD027B- Further Customer Number changes.                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA089 - Recompiled due to changes in FF0160DF. Conditioned  *
      *           F10 to be active only on delete mode.               *
      *  TDA051 - Correct size of work variable of settlement account *
      *           for settlement type '14'.                           *
      *  CAAA03 - Webfacing Changes                                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
      *  104633 - GUI Amendments to DSPF with non-standard footers    *
      *  S71062 - FF/PM Interface (Just recompiled)                   *
      *  S01408 - Core hook FF0160IIPG added                          *
      *         - Core hook FF0160CCPG added                          *
      *         - Core hook FF0160CVSF added                          *
      *         - Core hook FF0160CVS1 added                          *
      *         - Core hook FF0160CVS2 added                          *
      *  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                      *
      *           Recompiled due to changes in file TABFF.            *
      *   S04662  -  Switchable Feature for Init Margins for Futures; *
      *              Deposit and Spread Margin Rate added to DEFLTD.  *
      *   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT         *
      * FUJI-FF0011 - The system does not differentiate between       *
      *               american and european option on exercise        *
      *               validation and OTC confirmation wording.        *
      *               *** RECOMPILE ONLY ***                          *
      *   AUS022  -  AUSTRALIAN CHANGE : Contract Type (CNTT) added to*
      *              PF/INTYPD.  Recompile program only.              *
      *   E27424  -  Settlement method 04 can be used if either       *
      *              the retail module or interest on accounts is on. *
      *   E25437  -  If you enter a shortname in the c/party nostro   *
      *              field and then enquire on the default details    *
      *              without leaving the program. The short name is   *
      *              is converted to a customer no. for display but   *
      *              the c/party nostro screen field is not cleared   *
      *              prior to moving the customer no. in.             *
      *   E23409  -  SETTLEMENT TYPES 4 OR 14 ALLOWED IF RETAIL II OR *
      *              INTEREST ON ACCOUNTS ON IN SYSTEM                *
      *   HK0000  -  WRONG VARIABLE USED WHEN VALIDATING C/P NOSTRO;  *
      *              IT SHOULD BE 'SCNOS'. ALSO, C/P NOSTRO IN FILE   *
      *              SHOULD BE SET TO BLANK WHEN BLANK VALUE INPUT ON *
      *              SCREEN.                                          *
      *   S01199  -  HELP SYSTEM                                      *
      *   S01195  -  HOLIDAY PROCESSING AMENDMENT                     *
      *   S01117  -  MULTIBRANCHING                                   *
      *   S01179     ****** AS400 CONVERSION ******                   *
      *     The keyword RTGAID is no longer supported on the AS400    *
      *     and command keys and indicators have been used to replace *
      *     this in the display file. To disrupt the structure of the *
      *     program as little as possible a new subroutine - ASCHGS - *
      *     has been coded. This moves the values which would have    *
      *     been passed to the program (via RTGAID) into the AID      *
      *     field depending on which function key has been pressed.   *
      *                                                               *
      *---------------------------------------------------------------*
      *     CREATION REQUIREMENTS                                     *
      *                                                               *
      *     IGNDECERR(*NO)                                            *
      *     OVRDBF     FILE(DEFLTX) TOFILE(DEFLT)                     *
      *                                                               *
      *****************************************************************
     FDEFLT   UF  E           K        DISK         KCOMIT       A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     FDEFLTA  UF  E                    DISK         KCOMIT
     F*LINT***IF* E           K        DISK                               S01117
     F*********** CLINTCAF                          KIGNORE               S01117
     F*********** CLINTCCF                          KIGNORE               S01117
     F*********** CLINTC1F                          KIGNORE               S01117
     F*NAME***IF* E           K        DISK                               S01117
     F*********** CLINTCBF                          KRENAMESNAMECBF       S01117
     FFOCLT   IF  E           K        DISK
     FMARKT   IF  E           K        DISK
     FINTYP   IF  E           K        DISK
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     FCHGCM   IF  E           K        DISK
     F*ABLETJ*IF* E           K        DISK                               S01195
     FTABFF   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE               S01117
     F* ICD 3     TABTB20F                          KIGNORE
     F* ICD 5     TABTB40F                          KIGNORE
     F            TABTB80F                          KIGNORE
     F* A/C 1     TABTE10F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F* NOSTROS   TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F* CPTY NOS  TABLET2F                          KIGNORE
     FFF0160DFCF  E                    WORKSTN      KINFDS SCRDS
     F                                        RRN   KSFILE FF0160S0
     FDEFLTX  IF  E           K        DISK
     F            DEFLTDF                           KRENAMEDEFLTDFX
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*       01         S/FF0160C0  SFLDSP
     F*       02         S/FF0160C0  SFLDSPCTL
     F*       03         S/FF0160C0  SFLEND
     F*       04         S/FF0160C0  ROLLDOWN NOT ALLOWED
     F*       05         S/FF0160F1  PROTECT/NON-DISPLAY ON LOCATION
     F*       06         S/FF0160F0  PROTECT FIELDS
     F*
     F*       10         START  SCREEN
     F*       11         REVIEW SCREEN
     F*       12         UPDATE SCREEN
     F*
     F*       15         INDICATOR USED ON WRITE/UPDATE OPS TO CONDITION
     F*                                    CALL OF INFSR
     F********16*********COUNTERPARTY*NOSTRO*FIELD*CONTAINS*CUSTOMER******S01117
     F*******************SHORTNAME****************************************S01117
     F*
     F*       21         S/FF0160F1  ERROR-ACTN
     F*       22         S/FF0160F1  ERROR-CSNM
     F*       23         S/FF0160F1  ERROR-MRKT
     F*       24         S/FF0160F1  ERROR-ISTC
     F*
     F*       25         S/FF0160F2  DISABLE COMMAND 4/5
     F*
     F*       30         S/FF0160F0  POSITION CURSOR
     F*       31         S/FF0160F0  ERROR-SETP
     F*       32         S/FF0160F0  ERROR-SETA
     F*       33         S/FF0160F0  ERROR-FACO
     F*       34         S/FF0160F0  ERROR-CNOS
     F*       35         S/FF0160F0  ERROR-CPAT
     F*       36         S/FF0160F0  ERROR-CMCD
     F*       37         S/FF0160F0  ERROR-CMSD
     F*       38         S/FF0160F0  ERROR-CGEP
     F*       39         S/FF0160F0  ERROR-CGES
     F*       40         S/FF0160F0  ERROR-RVFR
     F*       41         S/FF0160F0  ERROR-RVDY
     F*       42         S/FF0160F0  ERROR-RVDT
     F*       43         S/FF0160F0  ERROR-EXPD
     F*       44         S/FF0160F0  ERROR-SEBR                           S01117
     F*       45         S/FF0160F0  ERROR-INMC                           S04662
     F*       46         S/FF0160F0  ERROR-SPMC                           S04662
     F*
     F*       50         ROLLUP                                           S01179
     F*       51         ROLLDOWN                                         S01179
     F********52*        HELP                                      S01179 S01199
     F*                                                                   S01179
     F*       53         SWITCHABLE FEATURE - INITIAL MARGINS - S04662    S04662
     F*                                                                   S04662
     F*       55         VLDCMDKY INDICATOR FOR DISPLAY FILE              S01179
     F*                                                                   S01179
     F*       60         ADD RECORD
     F*                                                                   S01117
     F*       70         MBIN = Y                                         S01117
     F*
     F*       98         DATF = MMDDYY
     F*       99         WORK
     F*
     F*       U7         DATABASE ERROR
     F*       U8         PROGRAM  ERROR
     F*
     F*       'AID' VALUES USED
     F*
     F*       01         CA3                                              S01179
     F*       04         CA10                                             S01179
     F*       05         CA12                                             S01179
     F*       RA         ENTER PRESSED
     F*       UP         ROLLUP
     F*       DN         ROLLDOWN
     F********HP*        HELP PRESSED                                     S01199
     E                    CPY@    1   1 80
     E*
     E                    DET       256  1
     E** ARRAY FOR COMMIT TEXT
     E*
     E                    ERR        19  4
     E** ARRAY FOR ERROR MESSAGES
     E*
     E                    INF     1  12 76
     E** ARRAY FOR INFORM MESSAGES
     E*
      /COPY ZSRSRC,ZDATE2Z1
     E*
      /COPY ZSRSRC,ZALIGNZ1
     E*
     E                    VST     8   8  2
     E** ARRAY FOR SETTLEMENT TYPE CHECK
     E*
     E                    FREQ   17  17  1
     E** ARRAY FOR STATEMENT FREQUENCY
     E*
      /COPY ZSRSRC,ZFRQAZ1
     E*
     E** ARRAY FOR HOLIDAY PROCESSING                                     S01195
     E*                                                                   S01195
      /COPY ZSRSRC,ZHOLE                                                  S01195
     E*                                                                   S01195
     E                    PK         11  1
     E** ARRAY FOR PCBCDA CHECK
     E*
     I*LINTCBF***                                                         S01117
     I***********                                                         S01117
     I***CLINT*FILE*******************************************************S01117
     I***********                                                         S01117
     I***********   CRNM                            CRNMX                 S01117
     I***********   CSNM                            CSNMX                 S01117
     I*NAMECBF***                                                         S01117
     I***********                                                         S01117
     I***SHORTNAME*FILE***************************************************S01117
     I***********                                                         S01117
     I***********   CRNM                            CRNMX                 S01117
     I***********   CSNM                            CSNMX                 S01117
     IACCNTABF                                                            S01117
     I*                                                                   S01117
     I** ACCOUNT MASTER FILE                                              S01117
     I*                                                                   S01117
     I              CNUM                            CNUMA                 S01117
     IACNUMABF                                                            S01117
     I*                                                                   S01117
     I** ACCOUNT NUMBER FILE                                              S01117
     I*                                                                   S01117
     I              CNUM                            CNUMA                 S01117
     ITABLETLF                                                            S01117
     I              CNUM                            CNUMN                 S01117
     ISCRCTL      DS
     I*
     I** KEY FIELDS (TAKEN FROM 'KEY' PORTION OF SCREEN)
     I*
     I                                        1   1 REVW
     I                                        2   2 ACTN
     I                                        3 017 INPK
     I                                        3 012 CSNM
     I                                      013 014 MRKT
     I                                      015 017 ISTC
     I                                      018 028 PK
     I                                      018 028 PAGK
     I                                      018 023 PCBCDA
     I                                      024 025 PMRKT
     I                                      026 028 PISTC
     I*
     IDETREC    E DSDEFLTD
     I*
     I** DATA STRUCTURE FOR INITIALISING A RECORD
     I*
     I              CBCD                            CBCDX
     I              MRKT                            MRKTX
     I              ISTC                            ISTCX
     I*
     I*DETS******E DSFF0160DF                                             S01179
     IDETS        DS                                                      S01179
     I*
     I** DATA STRUCTURE FOR SCREEN DETAIL OUTPUT TO CMTTXT
     I                                        1   2 SSETP                 S01179
     I**********                              3  14 SSETA                              S01179 CGL029
     I***********                            15  24 SCNOS           S01179S01117
     I***********                            25  34 SFACO           S01179S01117
     I***********                            35  35 SCPAT           S01179S01117
     I***********                            36  37 SCMCD           S01179S01117
     I***********                            38  39 SCMSD           S01179S01117
     I***********                            40  41 SCGEP           S01179S01117
     I***********                            42  43 SCGES           S01179S01117
     I***********                            44  44 SRVFR           S01179S01117
     I***********                            45  46 SRVDY           S01179S01117
     I***********                            47  52 SRVDT           S01179S01117
     I***********                            53  58 SEXPD           S01179S01117
     I**********                             15  17 SSEBR                              S01117 CGL029
     I**********                             18  27 SCNOS                              S01117 CGL029
     I**********                             28  37 SFACO                              S01117 CGL029
     I**********                             38  38 SCPAT                              S01117 CGL029
     I**********                             39  40 SCMCD                              S01117 CGL029
     I**********                             41  42 SCMSD                              S01117 CGL029
     I**********                             43  44 SCGEP                              S01117 CGL029
     I**********                             45  46 SCGES                              S01117 CGL029
     I**********                             47  47 SRVFR                              S01117 CGL029
     I**********                             48  49 SRVDY                              S01117 CGL029
     I**********                             50  55 SRVDT                              S01117 CGL029
     I**********                             56  61 SEXPD                              S01117 CGL029
     I**********                             62  74 SINMC                              S04662 CGL029
     I**********                             75  87 SSPMC                              S04662 CGL029
     I                                        3  20 SSETA                                     CGL029
     I                                       21  23 SSEBR                                     CGL029
     I                                       24  33 SCNOS                                     CGL029
     I                                       34  43 SFACO                                     CGL029
     I                                       44  44 SCPAT                                     CGL029
     I                                       45  46 SCMCD                                     CGL029
     I                                       47  48 SCMSD                                     CGL029
     I                                       49  50 SCGEP                                     CGL029
     I                                       51  52 SCGES                                     CGL029
     I                                       53  53 SRVFR                                     CGL029
     I                                       54  55 SRVDY                                     CGL029
     I                                       56  61 SRVDT                                     CGL029
     I                                       62  67 SEXPD                                     CGL029
     I                                       68  80 SINMC                                     CGL029
     I                                       81  93 SSPMC                                     CGL029
     I*
     ISETLAC      DS
     I*
     I** DATA STRUCTURE FOR SETTLEMENT ACCOUNT
     I*
     I**********                              1  120XSETA                                     CGL029
     I**********                              1  180XSETA                             CGL029 CSD027B
     I                                        1  18 XSETA                                    CSD027B
     I**********                              1   60XCNUM                                     CSD027
     I                                        1   6 XCNUM                                     CSD027
     I                                        7  160XACOD                                     CGL029
     I                                       17  180XACSQ                                     CGL029
     I**********                              7  100XACOD                                     CGL029
     I**********                             11  120XACSQ                                     CGL029
     ISCRMSG      DS                          1 152
     I*
     I** DATA STRUCTURE FOR ERROR MESSAGES TO SCREEN
     I*
     I                                        1  76 ERR
     I                                        1  76 ERRMSG
     I                                       77 152 INFMSG
     I*
     ISCRDS       DS
     I*
     I** DISPLAY FORMAT STATUS DATA STRUCTURE
     I*
     I                                      287 288 AID
     IINFDS       DS
     I*
     I** DATA STRUCTURE FOR RPG 01021 ERROR HANDLING
     I*
     I                                     *STATUS  STATUS
     I*
     ILDA         DS                            256                       S01117
     I*DA********UDS                            256                       S01117
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
      *                                                                   S01117
     IZMUSER      DS                             17                       S01117
     I** DATA AREA OF MENU USER                                           S01117
     I                                       11  13 USRBCH                S01117
      *                                                                   S01117
     IRUNDT       DS                                                      S01117
      **  DATA AREA RUNDAT                                                S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01195
      **  EXTERNAL DS FOR BANK DETAILS                                    S01195
     I              BJLCCY                          LOCY                  S01195
     I              BJSLCD                          SYSL                  S01195
      *                                                                   S01117
     ISDCUST    E DSSDCUSTPD                                              S01117
      **  EXTERNAL DS FOR CLIENT DETAILS                                  S01117
     I              BBCUST                          CNUM                  S01117
     I              BBCRNM                          CRNMX                 S01117
     I              BBCSSN                          CSNMX                 S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              QQDFAC                          QQDFA1                                    CGL029
      ** EXTERNAL DS FOR BRANCHES DETAILS                                 S01117
      *                                                                   S04662
     ISDCURR    E DSSDCURRPD                                              S04662
      ** EXTERNAL DS FOR CURRENCY DETAILS                                 S04662
      *                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              S01117
      ** EXTERNAL DS FOR MODULES DETAILS                                  S01117
      *                                                                   S01117
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I              QQACCD                          QQACC1                                    CGL029
      ** Account Code Details                                                                 CGL029
      *                                                                                       CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,FF0160IIPG                                           S01408
     I*                                                                   S01408
     IDSFDY     E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I*
      /COPY ZSRSRC,ZTNLU1Z1
     I*                                                                   S01195
      /COPY ZSRSRC,ZAOZ2                                                  S01195
      /COPY ZSRSRC,ZHOLI                                                  S01195
      /COPY ZSRSRC,ZHOLDS                                                 S01195
     I*
     ICMTTXT      DS
     I*
     I** DATA STRUCTURE FOR SETUP OF COMMIT TEXT
     I*
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  15 PGMN
     I                                       16  18 WSIDX
     I                                       19  240MTIME
     I                                       25  25 ACTNX
     I                                       26  35 USIDX
     I                                       51 306 DET
     I*
     IPSDS       SDS
     I*
     I** PROGRAM STATUS DATA STRUCTURE FOR WS/USER ID'S
     I*
     I                                      244 246 WSID
     I                                      254 263 USID
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     C*================================================================
     C*
     C** CALCULATION SPECIFICATIONS:KEY LISTS
     C*
     C**  DEFINE KEY LIST FOR CHAINING TO DEFLT FILE
     C*
     C           DEFLTK    KLIST
     C                     KFLD           CBCD
     C                     KFLD           MRKT
     C                     KFLD           ISTC
     C*
     C** KEY LIST FOR CHAINING TO ACCNT FILE
     C*
     C           ACCNTK    KLIST
     C                     KFLD           XCNUM
     C                     KFLD           XCCY    3
     C                     KFLD           XACOD
     C                     KFLD           XACSQ
     C                     KFLD           XSEBR   3                       S01117
     C*
     C** KEY LIST FOR CHAINING TO CHGCM FILE
     C*
     C           CHGCMK    KLIST
     C                     KFLD           CCY     3
     C                     KFLD           CGCM    20
     C***********                                                         S01117
     C***KEY*LIST*FOR*CHAINING*TO*CLINT*FILE******************************S01117
     C***********                                                         S01117
     C***********CLINTK    KLIST                                          S01117
     C***********          KFLD           KCNUM   60                      S01117
     C***********          KFLD           KRCDT   1                       S01117
     C***********          MOVEL'A'       KRCDT                           S01117
     C*================================================================
      /EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C** PERFORM SETUP OF STANDARD FIELDS
     C*
     C                     EXSR INIT
     C*
     C** D O    U N T I L   C K 3   O R   E R R O R        -  S T A R T
     C*
     C           AID       DOUEQ'01'
     C           *INU7     OREQ '1'
     C*
     C           *IN10     CASEQ'1'       START
     C*
     C           *IN11     CASEQ'1'       REVIEW
     C*
     C           *IN12     CASEQ'1'       UPDATE
     C*
     C                     END
     C                     END
     C*
     C** D O    U N T I L   C K 3   O R   E R R O R        -  E N D
     C*
     C** TERMINATE PROGRAM
     C*
     C                     SETON                         LR
     C*================================================================
     C*  P R O G R A M     E N D
     C*================================================================
      /EJECT
     C*================================================================
      ** INDEX OF SUBROUTINES
      **
      ** INIT              INITIALISATION OF STANDARD FIELDS,
      **                   ACCESS OF STANDING DATA
      **
      ** START             OUTPUT AND PROCESS KEY FIELDS SCREEN
      **
      ** REVIEW            PROCESS SUBFILE SELECTION SCREEN
      **
      ** UPDATE            PROCESS DETAIL SCREEN AND UPDATE FILE
      **
      ** VALIDK            VALIDATE KEY FIELDS
      **
      ** VALIDD            VALIDATE DETAIL SCREEN
      **
      ** DEFLTS            FORMAT DEFAULT FIELD VALUES
      **
      ** INITRC            INITIALISE ALL FILE FIELDS TO ZERO/BLANK
      **
      ** TRSFS             FORMAT RECORD FIELDS FOR SCREEN
      **
      ** UPDFLS            UPDATE FILE RECORDS
      **
      ** UPDOWS            PROCESS UPDATE BY ANOTHER WORKSTATION
      **
      ** ZALIGN            VALIDATE AMOUNT FIELDS
      **
      ** ZEDIT             FORMAT AMOUNT FIELDS FOR DISPLAY
      **
      ** ZDATE1            CONVERT DATE TO DAYNO. AND REPORT IF ERROR
      **
      ** ZDATE2            CONVERT DAYNO. TO DATE FOR DISPLAY
      **
      ** ZFRQA             CALCULATE 'NEXT DATE' BASED ON FREQUENCY
      **
      ** ZTNLU1            ACCESS DATAAREA FOR NEXT TRANSACTION NO.
      **
      ** INFSR             FILE ERROR HANDLING S/R
      **                                                                  S01117
      ** *PSSR             HANDLES ABNORMAL ERROR CONDITIONS              S01117
      **
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** INIT S/R - TO INITIALISE STATIC FIELDS AND ACCESS STANDING DATA
      ** CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
      ** CALLS NO OTHER ROUTINES
      **
     C*================================================================
     C*
     C           INIT      BEGSR                           ** INIT  BSR **
     C*
     C** PREPARE LDA
     C*
     C***********          MOVEL*BLANK    DBLOT                           S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBFILE                          S01117
     C                     MOVE *BLANK    DBKEY                           S01117
     C                     MOVE *BLANK    DBPGM                           S01117
     C                     Z-ADD*ZERO     DBASE                           S01117
     C                     MOVEL'FF0160'  DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C** PREPARE COMIT TEXT
     C*
     C                     MOVEL'FF'      MDID
     C                     MOVEL'FF0160'  PGMN
     C                     MOVELWSID      WSIDX
     C                     MOVELUSID      USIDX
     C*
     C** HELP PROGRAM PARAMETER
     C*
     C**********           MOVEL'FF0160'  HBPGM   8                       S01199
     C                     MOVEL*BLANK    WBLNK   1
     C*
     C** FOR HIGH INTENSITY SCREEN ATTRIBUTE
     C*
     C                     BITOF'01234567'HI      1
     C                     BITON'267'     HI
     C                     MOVELHI        INF,8
     C                     MOVELHI        INF,9
     C                     MOVELHI        INF,10
     C                     MOVELHI        INF,11
     C                     MOVELHI        INF,12
      *                                                                   S01117
      **      IN THE DATAAREA                                             S01117
      *                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C           *NAMVAR   DEFN           LDA                             S01117
      *                                                                   S01117
      **      SET MULTIBRANCHING INDICATOR                                S01117
      *                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     70                   S01117
     C                     END                                            S01117
     C*
     C***GET*INSTALLATION*CONTROL*DATA*RECORD*1***************************S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '0'                                       S01117
     C*
     C** IF FOUND CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
     C*
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C***********          ELSE                                           S01117
     C*
     C***OTHERWISE*DB*ERROR***********************************************S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'01'      DBASE            **DB ERROR 01**S01117
     C***********          MOVEL'TABFF'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '10'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                                            S01117
      *                                                                   S01195
      **   ACCESS BANK DETAILS                                            S01195
      *                                                                   S01195
     C                     CALL 'AOBANKR0'                                S01195
     C                     PARM '*DBERR ' @RTCD   7                       S01195
     C                     PARM '*FIRST ' @OPTN   7                       S01195
     C           SDBANK    PARM SDBANK    DSFDY                           S01195
     C*                                                                   S01195
     C           @RTCD     IFNE *BLANK                                    S01195
     C                     SETON                     U7U8                 S01195
     C           *LOCK     IN   LDA                                       S01195
     C                     MOVEL'SDBANKPD'DBFILE           ***************S01195
     C                     Z-ADD1         DBASE            **DB ERROR 01**S01195
     C                     MOVEL@OPTN     DBKEY            ***************S01195
     C                     MOVEL@OPTN     DBOPTN  7                       S01195
     C                     OUT  LDA                                       S01195
     C                     EXSR *PSSR                                     S01195
     C                     END                                            S01195
     C*
     C**GET*INSTALLATION*CONTROL*DATA*RECORD*2****************************S01117
     C***********                                                         S01117
     C***********          READ TABTB11F                 99               S01117
     C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********                                                         S01117
     C***DB*ERROR*********************************************************S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8  ***************S01117
     C***********          MOVEL'03'      DBASE            **DB ERROR 03**S01117
     C***********          MOVEL'TABFF'   DBFILE           ***************S01117
     C***********          MOVEL'01'      ZTABKY 12                       S01117
     C***********          MOVE '11'      ZTABKY                          S01117
     C***********          MOVELZTABKY    DBKEY                           S01117
     C***********          END                                            S01117
     C*
     C* GET INSTALLATION CONTROL DATA RECORD 3
     C*
     C                     READ TABTB20F                 99
     C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
     C           *IN99     IFEQ '1'
     C*
     C** DB ERROR
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'04'      DBASE            **DB ERROR 04**S01117
     C                     Z-ADD4         DBASE            **DB ERROR 04**S01117
     C                     MOVEL'TABFF'   DBFILE           ***************
     C                     MOVEL'01'      ZTABKY 12
     C                     MOVE '20'      ZTABKY
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C* GET INSTALLATION CONTROL DATA RECORD 5
     C*
     C                     READ TABTB40F                 99
     C  N99      RECI      COMP 'D'                  9999  ON, IS DELETED
     C           *IN99     IFEQ '1'
     C*
     C** DB ERROR
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'05'      DBASE            **DB ERROR 05**S01117
     C                     Z-ADD5         DBASE            **DB ERROR 05**S01117
     C                     MOVEL'TABFF'   DBFILE           ***************
     C                     MOVEL'01'      ZTABKY 12
     C                     MOVE '40'      ZTABKY
     C                     MOVELZTABKY    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
      *                                                                   S04662
      **  Access Switchable Features file for Initial Margin for          S04662
      **  Fututres processing - S04662.                                   S04662
     C                     MOVE 'N'       S04662                          S04662
     C                     SETOF                     53                   S04662
     C                     CALL 'AOSARDR0'                                S04662
     C                     PARM '       ' @RTCD                           S04662
     C                     PARM '*VERIFY' @OPTN                           S04662
     C                     PARM 'S04662'  @SARD   6                       S04662
      *                                                                   S04662
     C           @RTCD     IFEQ *BLANK                                    S04662
     C                     MOVE 'Y'       S04662  1                       S04662
     C                     SETON                     53                   S04662
     C                     END                                            S04662
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0160CCPG                                           S01408
     C*                                                                   S01408
     C*
     C** PROCEED TO START SCREEN UNLESS DATABASE ERRPR
     C*
     C           *INU7     IFNE '1'
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C           XTINIT    ENDSR                           ** XTINIT ESR**
     C*===================================================================
      /EJECT
     C*===================================================================
      **
      ** START S/R TO OUTPUT AND PROCESS KEY FIELDS SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: VALIDK TO VALIDATE KEY FIELDS IF ENTERED
      **
     C*===================================================================
     C*
     C           START     BEGSR                           ** START BSR **
     C*
     C** INITIALISE SCREEN DATA
     C*
     C                     MOVEA'0'       *IN,10
     C                     MOVEA'00001'   *IN,21
     C                     MOVEL*BLANK    SCRCTL
     C                     MOVELINF,1     INFMSG
     C                     MOVEA'0'       *IN,26                                              TDA089
     C*
     C** CLEAR WHOLE SCREEN
     C*
     C                     WRITEFF0160F3
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** S T A R T   S C R E E N     O U T P U T           -  S T A R T
     C*
     C**********           WRITEFF0160F1                                                      CAAA03
     C                     WRITEFF0160F2
     C                     WRITEFF0160F1                                                      CAAA03
     C                     READ FF0160F1                 99
     C                     MOVELERRMSG    HERCD 160
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C** S T A R T   S C R E E N     O U T P U T           -  E N D
     C*
     C** C K 3 , H E L P , O R  E N T E R   P R E S S E D  -  S T A R T
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM                                         S01199
     C**********                                                          S01199
     C*********            ELSE                                           S01199
     C*********  AID       IFEQ 'HP'                                      S01199
     C*********            MOVELHERCD     ERRMSG                          S01199
     C*********  ERR,1     IFNE *BLANK                                    S01199
     C*********            MOVELHI        ERRMSG                          S01199
     C*********            END                                            S01199
     C*********            CALL 'MHELP'                                   S01199
     C*********            PARM           HBPGM                           S01199
     C*********            PARM           HERCD                           S01199
     C*
     C** ENTER TAKEN VALIDATE KEY INPUT
     C*
     C                     ELSE
     C                     EXSR VALIDK
     C*
     C** D E T E R M I N E    S C R E E N   C H A N G E    -  S T A R T
     C*
     C** IF NO ERRORS, DETERMINE NEXT SCREEN
     C*
     C           SCRMSG    IFEQ *BLANK
     C*
     C**  - IF KEY FIELD IS BLANK, NEXT SCREEN IS REVIEW SCREEN
     C*
     C           CSNM      IFEQ *BLANK
     C                     MOVEA'1'       *IN,11
     C*
     C**  - OTHERWISE, DISPLAY REQUESTED DETAIL SCREEN AS PER KEY INPUT
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C                     SETOF                     25
     C*
     C                     END
     C*
     C** D E T E R M I N E    S C R E E N   C H A N G E    -  E N D
     C*
     C                     END
     C                     END
     C*
     C** C K 3 , H E L P , O R  E N T E R   P R E S S E D  -  E N D
     C************                                                        S01199
     C************         END                                            S01199
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C*
     C           XTSTAR    ENDSR                           ** XTSTAR ESR**
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** REVIEW S/R TO PROCESS SUBFILE SELECTION SCREEN
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: VALIDK TO VALIDATE KEY FIELDS IF SUBFILE RECORD SELECTED
      **
     C*================================================================
     C*
     C           REVIEW    BEGSR                           ** REVIEW BSR**
     C*
     C                     MOVEA'0'       *IN,11
     C*
     C** SET PROCESSING FLAG TO FORCE SUBFILE REBUILD
     C*
     C                     MOVEL'RA'      AID
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** I F  R O L L   U P / D O W N   O R   E N T E R   P R E S S E D
     C*
     C** R E B U I L D   S U B F I L E                     -  S T A R T
     C*
     C                     MOVELINF,2     INFMSG
     C           AID       IFEQ 'DN'
     C           AID       OREQ 'UP'
     C           AID       OREQ 'RA'
     C*
     C** WRITE CONTROL RECORD
     C*
     C                     MOVEA'000'     *IN,1
     C                     Z-ADD*ZERO     RRN
     C                     WRITEFF0160C0
     C                     MOVEA'1'       *IN,4
     C*
     C** SET FILE POINTER - PAGE BACK
     C*
     C           AID       IFEQ 'DN'
     C**********           Z-ADD*ZERO     CBCD                                                CSD027
     C                     MOVE *BLANKS   CBCD                                                CSD027
     C                     MOVEL*BLANK    MRKT
     C                     MOVEL*BLANK    ISTC
     C                     MOVEL*ZERO     PPAGK
     C                     MOVE '     '   PPAGK 011
     C           DEFLTK    SETLLDEFLTX
     C*
     C** OTHERWISE        - PAGE FORWARD
     C*
     C                     ELSE
     C*
     C** CHECK THAT PCBCDA IS NUMERIC (BLANKS ARE TRANSLATED TO ZEROES)
     C** PK IS EQUATED TO PAGK-PCBCDA IS THE 1ST 6 CHARS OF THIS FIELD
     C** SEE DATA STRUCTURE SCRCTL
     C*
     C                     Z-ADD1         X       20
     C           X         DOUEQ7
     C**********           TESTN          PK,X       99                                       CSD027
     C********** *IN,99    IFEQ '0'                                                           CSD027
     C**********           MOVEL'0'       PK,X                                                CSD027
     C**********           END                                                                CSD027
     C                     ADD  1         X
     C                     END
     C*
     C                     MOVELPCBCDA    CBCD
     C                     MOVELPMRKT     MRKT
     C                     MOVELPISTC     ISTC
     C                     MOVELPAGK      PPAGK
     C           DEFLTK    SETLLDEFLTX
     C                     END
     C*
     C** READ IN DETAILS-FILL UP SUBFILE
     C*
     C           RRN       DOUEQ18
     C           *IN,03    OREQ '1'
     C*
     C** READ DETAILS UNTIL SUBFILE PAGE IS FULL
     C*
     C                     READ DEFLTX                   03
     C           *IN,03    IFEQ '0'
     C*
     C** IF RECORD IS DELETED, FLAG IT AS SO ON SCREEN
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'D'       STAT    1
     C                     ELSE
     C                     MOVEL*BLANK    STAT
     C                     END
     C*
     C                     ADD  1         RRN     40     04
     C*
     C** GET CUSTOMER NAME/SHORTNAME TO DISPLAY ON REVIEW SCREEN
     C*
     C***********          Z-ADDCBCD      KCNUM   60                      S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C                     SETOF                     99                   S01117
     C                     MOVELCBCD      WRK10A 10                       S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WRK10A    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C                     MOVELCRNMX     CRNM   20
     C                     MOVELCSNMX     CSNM   10
     C*
     C                     WRITEFF0160S0
     C*
     C** RECORD NOW WRITTEN TO SUBFILE
     C*
     C                     END
     C*
     C** PAGE NOW FULL (OR EOF)
     C*
     C                     END
     C*
     C** READ ONE MORE RECORD FOR NEXT SCREEN
     C*
     C           *IN,03    IFEQ '0'
     C                     READ DEFLTX                   03
     C                     END
     C*
     C** IF NOT EOF SET NEXT 'REVIEW FROM' KEY ELSE SET IT TO BLANK
     C*
     C           *IN,03    IFEQ '0'
     C                     MOVELCBCD      PCBCDA                                              220888
     C                     MOVELMRKT      PMRKT                                               220888
     C                     MOVELISTC      PISTC                                               220888
     C**********           MOVELINPK      PAGK                                                220888
     C                     ELSE
     C                     MOVEL*ZERO     PAGK
     C                     MOVE '     '   PAGK
     C                     END
     C*
     C** FOR SUBFILE CONTROL
     C*
     C           *IN,4     IFEQ '1'
     C                     MOVEA'010'     *IN,1
     C                     MOVELINF,3     INFMSG
     C                     ELSE
     C                     MOVEA'11'      *IN,1
     C                     END
     C                     END
     C*
     C** R E B U I L D   S U B F I L E     -     E N D
     C*
     C** R E V I E W   S C R E E N     O U T P U T         -  S T A R T
     C*
     C**********           WRITEFF0160C0                                                      CAAA03
     C                     WRITEFF0160F2
     C                     WRITEFF0160C0                                                      CAAA03
     C                     READ FF0160C0                 99
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C                     MOVEL*BLANK    REVW
     C*
     C** R E V I E W   S C R E E N     O U T P U T         -  E N D
     C*
     C** C K 3 , C K12 , H E L P , R E C O R D  S E L E C T-  S T A R T
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,11
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C***********                                                         S01199
     C***HELP*-*CALL HELP PROGRAM                                         S01199
     C*********                                                           S01199
     C*********            ELSE                                           S01199
     C*********  AID       IFEQ 'HP'                                      S01199
     C*********            MOVELHERCD     ERRMSG                          S01199
     C*********  ERR,1     IFNE *BLANK                                    S01199
     C*********            MOVELHI        ERRMSG                          S01199
     C*********            END                                            S01199
     C*********            CALL 'MHELP'                                   S01199
     C*********            PARM           HBPGM                           S01199
     C*********            PARM           HERCD                           S01199
     C*
     C** ENTER PRESSED, PROCESS RECORD SELECTION
     C*
     C                     ELSE
     C                     MOVEA'1'       *IN,99
     C           *IN,04    IFEQ '0'
     C                     READCFF0160S0                 99
     C                     END
     C*
     C** R E C O R D   S E L E C T   V A L I D A T I O N   -  S T A R T
     C*
     C           *IN99     IFEQ '0'
     C                     EXSR VALIDK
     C*
     C** NO ERRORS, UPDATE SCREEN CAN BE PROCESSED NEXT
     C*
     C           SCRMSG    IFEQ *BLANK
     C                     MOVEA'1'       *IN,12
     C                     MOVEL'Y'       REVW
     C                     END
     C                     END
     C*
     C** R E C O R D   S E L E C T   V A L I D A T I O N   -  E N D
     C*
     C                     END
     C                     END
     C                     END
     C*
     C** C K 3 , C K12 ,*H*E*L*P*, R E C O R D  S E L E C T - E N D       S01199
     C************                                                        S01199
     C************         END                                            S01199
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N   - S T A R T
     C*
     C           XTREVI    ENDSR                           ** XTREVI ESR**
     C*
     C*===================================================================
      /EJECT
     C*===================================================================
      **
      ** UPDATE S/R TO PROCESS DETAIL SCREEN AND UPDATE FILE
      ** CALLED FROM MAIN PROCESSING
      ** CALLS: VALIDD, UPDFLS, INITRC, TRSFS, DEFLTS
      **
     C*===================================================================
     C*
     C           UPDATE    BEGSR                           ** UPDATE BSR**
     C*
     C** SET SCREEN INDICATORS - PROTECT KEY, SET OFF ERROR INDS,
     C** POSITION CURSOR
     C*
     C                     MOVEA'1'       *IN,5
     C                     MOVEA'0'       *IN,12
     C                     MOVEA'10000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C*
     C** ACCESS FILE RECORD FOR OLD TNLU TO CHECK AT UPDATE TIME
     C** IF NO RECORD PRESENTLY ON FILE, ZEROISE STORED TNLU
     C*
     C                     Z-ADD*ZERO     STNLU   50
     C           DEFLTK    CHAINDEFLTX               99
     C           *IN,99    IFEQ '0'
     C                     Z-ADDTNLU      STNLU
     C                     END
     C*
     C** IF INSERT (NEW OR OVER DELETED RECORD)
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C           ACTN      IFEQ 'I'
     C                     EXSR INITRC
     C                     END
     C*
     C** IF DELETED RECORD-ENQUIRY ONLY (RECI IS SET TO BLANK FOR INSERTS)
     C*
     C           RECI      IFEQ '*'
     C                     MOVEL'E'       ACTN
     C                     MOVEL'DELETED' DELT    7
     C                     ELSE
     C                     MOVEL*BLANK    DELT
     C                     END
     C*
     C** GET CUSTOMER NAME
     C*
     C                     MOVEL*BLANK    CSNM
     C                     MOVELCBCD      CSNM
     C***********          Z-ADDCBCD      KCNUM                           S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C                     SETOF                     99                   S01117
     C                     MOVELCBCD      WRK10A 10                       S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WRK10A    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C                     MOVELCRNMX     CRNM
     C*
     C** GET INSTRUMENT
     C*
     C                     MOVELMRKT      ISTT
     C                     MOVE ISTC      ISTT
     C           ISTT      CHAININTYP                99
     C*                                                                   S04662
     C** If Switchable Feature, Initial Margin for Futures, S04662, is    S04662
     C** present then determine decimal places for Instrument Currency    S04662
     C** for validation and display purposes.                             S04662
     C           S04662    IFEQ 'Y'                                       S04662
     C                     CALL 'AOCURRR0'                                S04662
     C                     PARM '*DBERR ' @RTCD                           S04662
     C                     PARM '*KEY   ' @OPTN                           S04662
     C                     PARM ISCY      WCUCY   3                       S04662
     C           SDCURR    PARM SDCURR    DSSDY                           S04662
     C                     END                                            S04662
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C                     EXSR TRSFS
     C*
     C** SET UP DEFAULTS (DONE ON BLANK FIELDS)
     C*
     C                     EXSR DEFLTS
     C*
     C** IF DELETE/ENQUIRY PROTECT FIELD INPUT ON S/FF0160F0
     C*
     C           ACTN      IFEQ 'D'
     C           ACTN      OREQ 'E'
     C                     MOVEA'1'       *IN,6
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  S T A R T
     C*
     C           *IN10     DOUEQ'1'
     C           *IN11     OREQ '1'
     C           *IN12     OREQ '1'
     C*
     C** L O A D    U  P    I N F O M E S S A G E S        -  S T A R T
     C*
     C           INFMSG    IFEQ *BLANK
     C           ACTN      IFEQ 'I'
     C                     MOVELINF,4     INFMSG
     C                     END
     C           ACTN      IFEQ 'A'
     C                     MOVELINF,5     INFMSG
     C                     END
     C           ACTN      IFEQ 'E'
     C                     MOVELINF,6     INFMSG
     C                     END
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,7     INFMSG
     C                     MOVEA'1'       *IN,26                                              TDA089
     C                     END
     C                     END
     C*
     C** L O A D    U  P    I N F O M E S S A G E S        -  E N D
     C*
     C** D E T A I L   S C R E E N     O U T P U T         -  S T A R T
     C*
     C                     WRITEFF0160F1
     C**********           WRITEFF0160F0                                                      CAAA03
     C                     WRITEFF0160F2
     C                     WRITEFF0160F0                                                      CAAA03
     C                     READ FF0160F0                 99
     C                     MOVEA'0'       *IN,26                                              TDA089
     C                     MOVELERRMSG    HERCD
     C                     MOVELWBLNK     HERCD
     C                     MOVEL*BLANK    SCRMSG
     C*
     C** D E T A I L   S C R E E N     O U T P U T         -  E N D
     C*
     C** C K 3 , C K12 , H E L P , R O L L U P / D O W N   -  S T A R T
     C*
     C** Call S/R to move values into AID                                 S01179
     C*                                                                   S01179
     C                     EXSR ASCHGS                                    S01179
     C*                                                                   S01179
     C** CK3 - TERMINATE
     C*
     C           AID       IFEQ '01'
     C                     MOVEA'1'       *IN,12
     C*
     C** CK12- INITIAL SCREEN
     C*
     C                     ELSE
     C           AID       IFEQ '05'
     C                     MOVEA'1'       *IN,10
     C*
     C***HELP*-*CALL*HELP*PROGRAM                                         S01199
     C*********                                                           S01199
     C*********            ELSE                                           S01199
     C*********  AID       IFEQ 'HP'                                      S01199
     C*********            MOVELHERCD     ERRMSG                          S01199
     C*********  ERR,1     IFNE *BLANK                                    S01199
     C*********            MOVELHI        ERRMSG                          S01199
     C*********            END                                            S01199
     C********             CALL 'MHELP'                                   S01199
     C*********            PARM           HBPGM                           S01199
     C*********            PARM           HERCD                           S01199
     C*
     C** PAGE FORWARD TAKEN, READ NEXT RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'UP'
     C           ACTN      ANDNE'I'
     C                     READ DEFLTX                   12
     C*
     C** CHANGE MESSAGE IF END OF FILE REACHED - NO ROLL FWD
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,8     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C** PAGE BACK TAKEN, READ PREVIOUS RECORD
     C*
     C                     ELSE
     C           AID       IFEQ 'DN'
     C           ACTN      ANDNE'I'
     C                     READPDEFLTX                   12
     C*
     C** CHANGE MESSAGE IF BEGINNING OF FILE REACHED - NO ROLL BACK
     C*
     C           *IN,12    IFEQ '1'
     C                     MOVELINF,9     INFMSG
     C                     ELSE
     C                     MOVEA'1'       *IN,12
     C                     END
     C*
     C** NOT CK3,CK12,HELP,ROLLUP,ROLLDOWN
     C*
     C                     ELSE
     C*
     C** V A L I D A T E   D E T A I L   S C R E E N   I N P U T
     C*
     C                     EXSR VALIDD
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  S T A R T
     C*
     C           SCRMSG    IFEQ *BLANK
     C           AID       ANDEQ'RA'
     C*
     C**FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO -  S T A R T
     C*
     C           REVW      IFEQ 'Y'
     C                     MOVELPPAGK     PAGK
     C                     MOVEA'1'       *IN,11
     C                     ELSE
     C                     MOVEA'1'       *IN,10
     C                     END
     C*
     C**FOR REC.ADVANCE DETERMINE WHAT SCREEN TO RETURN TO -  E N D
     C*
     C**     U  P  D  A  T  E      F  I  L  E  S
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C           ACTN      OREQ 'D'
     C                     EXSR UPDFLS
     C                     END
     C*
     C** N O    D E T A I L   S C R E E N    E R R O R S   -  E N D
     C*
     C                     END
     C*
     C** C K 3 , C K12 , H E L P , R O L L U P / D O W N   -  E N D
     C*
     C                     END
     C                     END
     C                     END
     C**********           END                                            S01199
     C                     END
     C*
     C** D O    U N T I L   C H A N G E  O F  S C R E E N  -  E N D
     C*
     C                     END
     C*
     C** RESET PROTECT/NON-DISPLAY INDS
     C*
     C                     MOVEA'00'      *IN,5
     C*
     C           XTUPDT    ENDSR                           ** XTUPDA ESR**
     C*================================================================
      /EJECT
     C*================================================================
      ** VALIDK S/R TO VALIDATE KEY FIELDS
      ** CALLED FROM S/R START, REVIEW
      ** CALLS NO OTHER S/R'S
      **
     C*================================================================
     C*
     C           VALIDK    BEGSR                           ** VALIDK BSR**
     C*
     C** RESET ERROR INDICATORS
     C** SET ERROR ARRAY COUNTER TO ZERO
     C*
     C                     MOVEA'0000'    *IN,21
     C                     Z-ADD*ZERO     EC      40
     C*
     C** A C T I O N    C O D E    I N P U T - MUST BE BLANK,I,A,E,D
     C*
     C           ACTN      IFNE *BLANK
     C           ACTN      ANDNE'I'
     C           ACTN      ANDNE'A'
     C           ACTN      ANDNE'E'
     C           ACTN      ANDNE'D'
     C                     ADD  1         EC         21
     C                     MOVEL' 100'    ERR,EC
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** SPF CHECKING ON ACTION CODE                                      S01117
     C*                                                                   S01117
     C           ACTN      IFNE *BLANK                                    S01117
     C*                                                                   S01117
     C** WHEN SINGLE BRANCH                                               S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C*                                                                   S01117
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVEL' 303'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** WHEN MULTI-BRANCH                                                S01117
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM ACTN      @ZACTN  1                       S01117
     C                     PARM USRBCH    @ZBR    3                       S01117
     C                     PARM           @ERR    10                      S01117
     C           @ERR      IFNE *ZERO                                     S01117
     C                     ADD  1         EC         21                   S01117
     C                     MOVEL' 304'    ERR,EC                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C*
     C** A C T I O N    C O D E    I N P U T - CHECK KEY FIELDS
     C*
     C           *IN,21    IFNE '1'
     C*
     C           ACTN      IFNE *BLANK
     C*
     C***CHECK*IF*CSNM*IS*NUMERIC*****************************************S01117
     C***********                                                         S01117
     C***********          MOVELCSNM      WRK7A   7                       S01117
     C***********          MOVE '0'       WRK7A   7                       S01117
     C***********          MOVE CSNM      WRK4A   4                       S01117
     C***********          TESTN          WRK7A      99                   S01117
     C***********                                                         S01117
     C***IF*CSNM*IS*NUMERIC*CHECK*CLIENT*CODE*****************************S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********WRK4A     ANDEQ*BLANK                                    S01117
     C***********                                                         S01117
     C***********          MOVELCSNM      KCNUM                           S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********          ADD  1         EC         22                   S01117
     C***********          MOVEL' 106'    ERR,EC                          S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADDCNUM      CBCD                            S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***IF*CSNM*IS*NON-NUMERIC*CHECK*SHORTNAME***************************S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********CSNM      CHAINSNAME                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN,99    IFEQ '1'                                       S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CSNM      @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL'                                  S01117
     C                     ADD  1         EC         22                   S01117
     C                     MOVEL' 110'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     ADD  1         EC         22
     C                     MOVEL' 106'    ERR,EC
     C*                                                                   S01117
     C                     ELSE
     C***********          Z-ADDCNUM      CBCD                            S01117
     C                     MOVE CNUM      CBCD                            S01117
     C                     MOVEL*BLANKS   CSNM                            S01117
     C*                                                                   S01117
     C           @KYST     IFEQ '*CNUM'                                   S01117
     C                     MOVELCNUM      CSNM                            S01117
     C                     ELSE                                           S01117
     C                     MOVELCSNMX     CSNM                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C*
     C                     END
     C*
     C** IF CLIENT EXISTS CHECK THAT IT IS A FUTURES & OPTIONS CLIENT
     C*
     C           *IN,22    IFEQ '0'
     C*
     C           CBCD      CHAINFOCLT                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         22
     C                     MOVEL' 107'    ERR,EC
     C                     END
     C*
     C                     END
     C*
     C** VALIDATE MARKET
     C*
     C           MRKT      CHAINMARKT                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         23
     C                     MOVEL' 108'    ERR,EC
     C                     END
     C*
     C** VALIDATE INSTRUMENT CODE ( IT MUST NOT BE AN OTC AS WELL)
     C*
     C                     MOVELMRKT      ISTT    5
     C                     MOVE ISTC      ISTT
     C           ISTT      CHAININTYP                99
     C  N99      ISTI      COMP 'Y'                      99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         24
     C                     MOVEL' 109'    ERR,EC
     C                     END
     C*
     C                     ELSE
     C*
     C** ACTION CODE BLANK BUT KEY INPUT
     C*
     C           CSNM      IFNE *BLANK
     C           MRKT      ORNE *BLANK
     C           ISTC      ORNE *BLANK
     C*
     C                     ADD  1         EC         21
     C                     MOVEL' 102'    ERR,EC
     C*
     C                     END
     C                     END
     C*
     C***********          END                                            S01117
     C*
     C** N O   E R R O R  O N  K E Y  F I E L D S
     C*
     C           *IN,22    IFNE '1'
     C           *IN,23    ANDNE'1'
     C           *IN,24    ANDNE'1'
     C*
     C** A C T I O N    C O D E    I
     C*
     C           ACTN      IFEQ 'I'
     C           DEFLTK    CHAINDEFLTX               99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '0'
     C           CSNM      OREQ *BLANK
     C                     MOVEA'111'     *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 103'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    A , D
     C*
     C                     ELSE
     C           ACTN      IFEQ 'A'
     C           ACTN      OREQ 'D'
     C           DEFLTK    CHAINDEFLTX               99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     MOVEA'111'     *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 104'    ERR,EC
     C                     END
     C*
     C** A C T I O N    C O D E    E
     C*
     C                     ELSE
     C           ACTN      IFEQ 'E'
     C           DEFLTK    CHAINDEFLTX               99
     C           *IN99     IFEQ '1'
     C                     MOVEA'111'     *IN,22
     C                     ADD  1         EC
     C                     MOVEL' 105'    ERR,EC
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C                     END
     C                     END                                            S01117
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     MOVEL*BLANK    AID
     C                     END
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** VALIDD S/R - TO VALIDATE DETAIL SCREEN
      ** CALLED FROM UPDATE S/R
      ** CALLS: DEFLTS; ZEDIT; ZALIGN; ZDATE1; ZDATE2; ZFRQA
      **
     C*================================================================
     C*
     C           VALIDD    BEGSR                           ** VALIDD BSR**
     C*
     C** RESET SCREEN ERROR INDICATORS
     C*
     C                     MOVEA'00000000'*IN,30
     C                     MOVEA'00000000'*IN,38
     C                     MOVEA'0'       *IN,46                          S04662
     C*
     C** SET ERROR COUNT TO ZERO
     C*
     C                     Z-ADD*ZERO     EC
     C*
     C** ENTER KEY PRESSSED
     C*
     C           AID       IFEQ 'RA'
     C*
     C** ACTION = I OR A
     C*
     C           ACTN      IFEQ 'I'
     C           ACTN      OREQ 'A'
     C*
     C** DO DEFAULTS
     C*
     C                     EXSR DEFLTS
     C*
     C** VALIDATION OF FIELDS FOR INSERT/AMEND
     C*
     C** CHECK THAT SSETP IS A VALID SETTLEMENT TYPE
     C*
     C           SSETP     IFEQ *BLANK
     C                     Z-ADD*ZERO     SETP
     C                     ELSE
     C           SSETP     LOKUPVST                      99
     C           *IN,99    IFEQ '0'
     C                     Z-SUB1         SETP         30
     C                     ADD  1         EC         31
     C                     MOVEL' 200'    ERR,EC
     C                     ELSE
     C                     MOVELSSETP     SETP
     C                     END
     C                     END
     C*
     C*****FOR*TYPE*04*AND*14*RETAIL*MODULE*INDICATOR*MUST*BE*ON****      E23409
     C**   FOR TYPE 04 AND 14 RE II OR IA MUST BE ON IN SYSTEM            E23409
     C*
     C           SETP      IFEQ 04
     C           SETP      OREQ 14
     C***********          TESTB'2'       MODI1          99               S01117
     C************IN,99    IFEQ '0'                                       S01117
     C                     CALL 'AOMMODR0'                                S01117
     C                     PARM '*DBERR ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDMMODPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBOPTN           * DB ERROR 06 *S01117
     C                     Z-ADD6         DBASE            ***************S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     RETRN                                          S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C           BGRTBN    IFNE 'Y'                                       S01117
     C***********BGIOAC    ORNE 'Y'                               E23409  E27424
     C           BGIOAC    ANDNE'Y'                                       E27424
     C                     MOVEL'1'       *IN,30
     C                     ADD  1         EC         31
     C                     MOVEL' 201'    ERR,EC
     C                     END
     C                     END
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C** SETTLEMENT TYPE IS 07 BUT INSTRUMENT CCY IS NOT DOLLAR CCY
     C*
     C           SETP      IFEQ 07
     C           ISCY      ANDNEUSCY
     C                     MOVEL'1'       *IN,30
     C                     ADD  1         EC         31
     C                     MOVEL' 202'    ERR,EC
     C                     END
     C*
     C** SETTLEMENT TYPE IS 14 BUT RETAIL
     C** ACCOUNT NUMBERS ARE NOT SUPPORTED
     C** OR SYSTEM IS MULTIBRANCHING
     C*
     C           SETP      IFEQ 14
     C           RACN      IFNE 'Y'
     C                     MOVEL'1'       *IN,30
     C                     ADD  1         EC         31
     C                     MOVEL' 203'    ERR,EC
     C                     END
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0160CVSF                                           S01408
     C*                                                                   S01408
     C*
     C** SETA MUST BE BLANK IF TYPE IS 00,04,06,15
     C*
     C                     MOVELSSETA     SETA
     C                     MOVELSSEBR     SEBR                            S01117
     C*                                                                   S01117
     C** IF MULTIBRANCHING, AND SETTLEMENT TYPE IS NOT 05,                S01117
     C** SETTLEMENT BRANCH IS BLANK.                                      S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C           SETP      IFEQ 00                                        S01117
     C           SETP      OREQ 01                                        S01117
     C           SETP      OREQ 04                                        S01117
     C           SETP      OREQ 06                                        S01117
     C           SETP      OREQ 07                                        S01117
     C           SETP      OREQ 08                                        S01117
     C           SETP      OREQ 14                                        S01117
     C           SETP      OREQ 15                                        S01117
     C           SEBR      IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         44                   S01117
     C                     MOVEL' 301'    ERR,EC                          S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C           SETP      IFEQ 00
     C           SETP      OREQ 04
     C           SETP      OREQ 06
     C           SETP      OREQ 15
     C           SETA      IFNE *BLANK
     C                     ADD  1         EC         32
     C                     MOVEL' 204'    ERR,EC
     C                     END
     C                     END
     C*
     C** VALIDATE NOSTRO CODE IF TYPE 01,07,08
     C*
     C           SETP      IFEQ 01
     C           SETP      OREQ 07
     C           SETP      OREQ 08
     C*
     C** CHECK LH 02 CHARS OF SETA ARE NUMERIC AND NON ZERO
     C** CHECK RH 10 CHARS OF SETA ARE BLANK
     C*
     C**********           MOVE SETA      WRK10A 10                                           CGL029
     C                     MOVE SETA      WRK16A 16                                           CGL029
     C                     MOVELSETA      WRK3A   3
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C*
     C           *IN99     IFEQ '0'
     C           WRK3A     OREQ '000'
     C********** WRK10A    ORNE *BLANK                                                        CGL029
     C           WRK16A    ORNE *BLANK                                                        CGL029
     C                     MOVEA'1'       *IN,99
     C                     ELSE
     C*
     C** IF VALID NUMERIC NOSTRO CODE CHECK IT EXISTS ON NOSTRO FILE
     C*
     C                     MOVELSETA      WRK2A
     C                     MOVEL*BLANK    ZTABKY
     C                     MOVEL'70'      ZTABKY
     C                     MOVELISCY      WRK5A   5
     C                     MOVE WRK2A     WRK5A
     C                     MOVE WRK5A     ZTABKY
     C           ZTABKY    CHAINTABFF                99
     C  N99      RECI      COMP '*'                      99
     C                     END
     C*
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         32
     C                     MOVEL' 205'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0160CVS1                                           S01408
     C*                                                                   S01408
     C                     END
     C*
     C** ACCOUNT DETAILS CHECK FOR TYPES 05
     C*
     C           SETP      IFEQ 05
     C*
     C** CHECK THAT THE INPUT REQUIRED IS NUMERIC
     C*
     C**********           MOVELSETA      WRK13A 13                                           CGL029
     C                     MOVELSETA      WRK13A 19                                           CGL029
     C                     MOVE '0'       WRK13A
     C                     MOVE SETA      WRK2A
     C***********                                                         S01117
     C***MULTIBRANCHING*ONLY*REQUIRES*FIRST*TEN*CHARACTERS****************S01117
     C***********                                                         S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********WRK2A     ANDEQ*BLANKS                                   S01117
     C***********          MOVE '000'     WRK13A                          S01117
     C***********          END                                            S01117
     C*
     C**********           TESTN          WRK13A     99                                      CSD027B
     C*
     C********** *IN99     IFEQ '0'                                                          CSD027B
     C**********           ADD  1         EC         32                                      CSD027B
     C**********           MOVEL' 206'    ERR,EC                                             CSD027B
     C**********           ELSE                                                              CSD027B
     C                     MOVELWRK13A    XSETA
     C*
     C** VALIDATE CNUM
     C*
     C***********          Z-ADDXCNUM     KCNUM                           S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C                     SETOF                     99                   S01117
     C                     MOVELXCNUM     WRK10A 10                       S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM WRK10A    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     99                   S01117
     C                     END                                            S01117
     C*
     C** VALIDATE ACOD
     C*
     C           *IN,99    IFEQ '0'
     C**********           MOVEL*BLANK    ZTABKY                                              CGL029
     C**********           MOVEL'30'      ZTABKY                                              CGL029
     C**********           MOVELXACOD     WRK5A   5                                           CGL029
     C**********           MOVE '1'       WRK5A                                               CGL029
     C**********           MOVE WRK5A     ZTABKY                                              CGL029
     C********** ZTABKY    CHAINTABFF                99                                       CGL029
     C**N99***** RECI      COMP '*'                      99                                   CGL029
     C                     MOVELXACOD     PACCD                                               CGL029
     C                     EXSR SRACOD                                                        CGL029
     C                     END
     C***********                                                         S01117
     C***IF*MULTIBRANCHING************************************************S01117
     C***********                                                         S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********                                                         S01117
     C***LAST*TWO*CHARACTERS*MUST*BE*BLANK********************************S01117
     C***********                                                         S01117
     C***********          MOVE SETA      WRK2A   2                       S01117
     C***********WRK2A     IFNE *BLANK                                    S01117
     C***********          MOVE '00'      SETA                            S01117
     C***********          END                                            S01117
     C***********          ELSE                                           S01117
     C*
     C** VALIDATE ACSQ IS NON ZERO
     C*
     C           XACSQ     IFEQ *ZERO
     C                     MOVEA'1'       *IN,99
     C                     END
     C*                                                                   S01117
     C** VALIDATE SEBR IS VALID BRANCH                                    S01117
     C*                                                                   S01117
     C           MBIN      IFNE 'Y'                                       S01117
     C                     MOVELUSRBCH    SEBR                            S01117
     C                     MOVELUSRBCH    XSEBR                           S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SEBR      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     ADD  1         EC         44                   S01117
     C                     MOVEL' 301'    ERR,EC                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSEBR      XSEBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C** VALIDATE A/C EXISTS IF A/C CODE IS 'R' FOR RETAIL
     C*
     C           *IN,99    IFEQ '0'
     C           *IN,44    ANDEQ'0'                                       S01117
     C           ATYP      ANDEQ'R'
     C                     MOVELISCY      XCCY
     C           ACCNTK    CHAINACCNT                99
     C  N99      RECI      COMP '*'                      99
     C*                                                                   S01117
     C           *IN,99    IFEQ '1'                                       S01117
     C                     SETON                     44                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C*
     C***********          END                                            S01117
     C*
     C** CNUM,ACOD,OR ACSQ IN ERROR OR A/C DOES NOT EXIST
     C*
     C           *IN,99    IFEQ '1'
     C                     ADD  1         EC         32
     C                     MOVEL' 206'    ERR,EC
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0160CVS2                                           S01408
     C*                                                                   S01408
     C*
     C******               END                                                               CSD027B
     C                     END
     C*
     C** ACCOUNT CHECK FOR TYPES 14
     C*
     C           SETP      IFEQ 14
     C*
     C** CHECK LH 10 CHARS OF SETA ARE NUMERIC
     C** CHECK RH  2 CHARS OF SETA ARE BLANK
     C*
     C                     MOVE SETA      WRK2A   2
     C**********           MOVELSETA      WRK11A 11                                           CGL029
     C**********           MOVELSETA      WRK11A 17                                    CGL029 TDA051
     C                     MOVELSETA      WRK11A 11                                           TDA051
     C                     MOVE '0'       WRK11A
     C                     TESTN          WRK11A     99
     C*
     C           *IN99     IFEQ '0'
     C           WRK2A     ORNE *BLANK
     C                     MOVEA'1'       *IN,99
     C                     ELSE
     C                     MOVELSETA      ACNUMK 100
     C           ACNUMK    CHAINACNUM                99
     C  N99      RECI      COMP '*'                      99
     C                     END
     C*
     C** ERROR IF FIELD NON NUMERIC,CHAIN FAIL TO ACNUM,DIFFERENT CCY
     C*
     C           *IN,99    IFEQ '1'
     C           CCY       ORNE ISCY
     C                     ADD  1         EC         32
     C                     MOVEL' 207'    ERR,EC
     C                     END
     C*
     C                     END
     C*
     C**   VALIDATE 'FOR A/C OF' FIELD
     C**   MUST BE BLANK IF SETTLEMENT TYPE NOT 01,07,08
     C*
     C                     MOVELSFACO     FACO
     C           SETP      IFNE 01
     C           SETP      ANDNE07
     C           SETP      ANDNE08
     C           FACO      IFNE *BLANK
     C                     ADD  1         EC         33
     C                     MOVEL' 208'    ERR,EC
     C                     END
     C                     END
     C*
     C** VALIDATE 'FOR A/C OF' FIELD (IF NOT IN ERROR ALREADY)
     C** CHECK THAT FACO IS NUMERIC
     C*
     C           FACO      IFNE *BLANK
     C           *IN33     ANDNE'1'
     C                     MOVELFACO      WRK7A   7
     C                     MOVE '0'       WRK7A
     C                     MOVE FACO      WRK4A   4
     C***********          TESTN          WRK7A      99                                       CSD027
     C*
     C** IF SFACO REPRESENTS A CUSTOMER NUMBER
     C*
     C************IN99     IFEQ '1'                                                           CSD027
     C***********WRK4A     ANDEQ*BLANK                                                        CSD027
     C***********          MOVELFACO      KCNUM                           S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN,99    IFEQ '1'                                       S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM FACO      @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     ADD  1         EC         33
     C                     MOVEL' 209'    ERR,EC
     C***********          END                                                                CSD027
     C***********                                                                             CSD027
     C** OTHERWISE TEST FOR VALID SHORTNAME
     C*
     C***********          ELSE                                                               CSD027
     C***********FACO      CHAINSNAME                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
     C************IN,99    IFEQ '1'                                       S01117
      ***********                                                         S01117              CSD027
     C***********          CALL 'AOCUSTR0'                                S01117              CSD027
     C***********          PARM *BLANKS   @RTCD   7                       S01117              CSD027
     C***********          PARM '*KEY   ' @OPTN   7                       S01117              CSD027
     C***********          PARM FACO      @KEY1  10                       S01117              CSD027
     C***********          PARM           @KYST   7                       S01117              CSD027
     C***********SDCUST    PARM SDCUST    DSSDY                           S01117              CSD027
     C***********                                                         S01117              CSD027
     C***********@RTCD     IFNE *BLANK                                    S01117              CSD027
     C***********          ADD  1         EC         33                                       CSD027
     C***********          MOVEL' 210'    ERR,EC                                              CSD027
     C                     ELSE
     C                     MOVEL*BLANK    SFACO
     C                     MOVELCNUM      SFACO
     C                     MOVELSFACO     FACO
     C                     END
     C*
     C***********          END                                                                CSD027
     C                     END
     C*
     C**   C/P NOSTRO MUST BE BLANK IF SETTLEMENT TYPE NOT 01,07,08
     C*
     C           SETP      IFNE 01
     C           SETP      ANDNE07
     C           SETP      ANDNE08
     C           SCNOS     IFNE *BLANK
     C                     ADD  1         EC         34
     C                     MOVEL' 211'    ERR,EC
     C                     END
     C                     END
     C*
     C**   VALIDATE 'C/P NOSTRO' FIELD (IF NOT IN ERROR ALREADY )
     C*
     C           SCNOS     IFNE *BLANK
     C           *IN34     ANDNE'1'
     C                     MOVELSCNOS     SCNOS6  6
     C***********          TESTN          SCNOS6     18                                       CSD027
     C*
     C****IF*COUNTERPARTY*NOSTRO*NUMERIC,*ACCESS*CLINTCB*TO*CHECK*********S01117
     C****RECORD*EXISTS***************************************************S01117
     C**  IF COUNTERPARTY NOSTRO NUMERIC, ACCESS CUSTOMER DETAILS         S01117
     C**  WITH CUSTOMER NUMBER AS KEY TO CHECK RECORD EXISTS              S01117
     C************IN18     IFEQ '1'                                                           CSD027
     C***********          MOVE SCNOS6    KCNUM                           S01117
     C***********CLINTK    CHAINCLINT                99                   S01117
     C**N99******RECI      COMP '*'                      99               S01117
      *                                                                   S01117
     C                     CALL 'AOCUSTR0'                                S01117
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SCNOS6    @KEY1  10                       S01117
     C                     PARM           @KYST   7                       S01117
     C           SDCUST    PARM SDCUST    DSSDY                           S01117
     C*                                                                   S01117
     C***********@RTCD     IFNE *BLANK                                    S01117              CSD027
     C***********                                                                             CSD027
     C****IF*RECORD NOT FOUND, SET UP ERROR MESSAGE                                           CSD027
     C************IN,99    IFEQ '1'                                       S01117
     C***********          ADD  1         EC         34                                       CSD027
     C***********          MOVEL' 212'    ERR,EC                                              CSD027
     C***********                                                                             CSD027
     C****ELSE*MOVE SCREEN FIELD TO FILE FIELD                                                CSD027
     C***********          ELSE                                                               CSD027
     C***********          MOVELSCNOS     CNOS                                                CSD027
     C***********          END                                                                CSD027
     C***********                                                                             CSD027
     C***********          MOVE '0'       *IN18                                               CSD027
     C***********                                                                             CSD027
     C****ELSE*COUNTERPARTY*NOSTRO*IS*NOT*NUMERIC,*ACCESS*SNAME*FOR*******S01117
     C****CUSTOMER*SHORTNAME**********************************************S01117
     C****ELSE*COUNTERPARTY NOSTRO IS NOT NUMERIC, ACCESS CUSTOMER        S01117              CSD027
     C****DETAILS WITH CUSTOMER SHORTNAME AS KEY TO CHECK RECORD EXISTS   S01117              CSD027
     C***********          ELSE                                                               CSD027
     C***********                                                                             CSD027
     C***********SCNOS     CHAINSNAME                16                   S01117
     C**N16******RECI      COMP 'D'                  1616                 S01117
      ***********                                                         S01117              CSD027
     C***********          CALL 'AOCUSTR0'                                S01117              CSD027
     C***********          PARM *BLANKS   @RTCD   7                       S01117              CSD027
     C***********          PARM '*KEY   ' @OPTN   7                       S01117              CSD027
     C***********          PARM SCNOS     @KEY1  10                       S01117              CSD027
     C***********          PARM           @KYST   7                       S01117              CSD027
     C***********SDCUST    PARM SDCUST    DSSDY                           S01117              CSD027
     C***********                                                         S01117              CSD027
     C***********@RTCD     IFEQ *BLANK                                    S01117              CSD027
     C*
     C**  IF RECORD FOUND, MOVE CUSTOMER NUMBER FOR THIS CUSTOMER
     C**  SHORTNAME TO FILE FIELD
     C************IN16     IFEQ '0'                                       S01117
     C************         MOVELCNUM      CNOS                                                CSD027
     C           @RTCD     IFEQ *BLANKS                                                       CSD027
     C                     MOVELCNUM      CNOS                                                CSD027
     C*
     C**  ELSE ACCESS TABLET2 TO CHECK FOR VALID COUNTERPARTY NOSRTO
     C                     ELSE
     C*
3674 C                     MOVEL'71      'ZTABKY
3675 C***********          MOVE CNOS      ZTABKY                          HK0000
     C                     MOVE SCNOS     ZTABKY                          HK0000
     C           ZTABKY    CHAINTABFF                99
     C  N99      RECI      COMP '*'                      99
     C*
     C**  IF RECORD NOT FOUND, SET UP ERROR MESSAGE
     C           *IN,99    IFEQ '1'
     C                     ADD  1         EC         34
     C                     MOVEL' 212'    ERR,EC
     C*
     C**  ELSE MOVE SCREEN FIELD TO FILE FIELD
     C                     ELSE
     C                     MOVELSCNOS     CNOS
     C                     END
     C***********          END                                                                CSD027
     C                     END
     C*                                                                   HK0000
     C**  ELSE BLANK C/P NOSTRO IS INPUT, OUTPUT BLANK C/P NOSTRO TO FILE HK0000
     C                     ELSE                                           HK0000
     C                     MOVEL*BLANK    CNOS                            HK0000
     C                     END
     C*
     C** VALIDATE COMMISSION PATTERN
     C** IT MUST BE 'S','H' OR 'E' (OR BLANK)
     C*
     C                     MOVELSCPAT     CPAT
     C*
     C           CPAT      IFNE *BLANK
     C           CPAT      ANDNE'S'
     C           CPAT      ANDNE'H'
     C           CPAT      ANDNE'E'
     C                     ADD  1         EC         35
     C                     MOVEL' 213'    ERR,EC
     C                     END
     C*
     C** VALIDATE COMMISSION CODE:STANDARD
     C** IT MUST EXIST IN COMBINATION WITH INSTRUMENT CURRENCY
     C** IF COMMISSION PATTERN HAS BEEN SPECIFIED
     C*
     C                     MOVELISCY      CCY
     C*
     C** CHECK THAT SCMCD IS NUMERIC
     C*
     C                     Z-ADD*ZERO     CMCD
     C*
     C           CPAT      IFNE *BLANK
     C                     MOVELSCMCD     WRK3A   3
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C*
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         36
     C                     MOVEL' 214'    ERR,EC
     C                     ELSE
     C                     MOVELSCMCD     CMCD
     C*
     C** CHECK THAT THIS CODE EXISTS ON THE CHARGE/COMMISSION FILE
     C*
     C                     MOVELCMCD      CGCM
     C           CHGCMK    CHAINCHGCM                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         36
     C                     MOVEL' 214'    ERR,EC
     C                     END
     C                     END
     C*
     C** IT MUST BE BLANK
     C** IF COMMISSION PATTERN HAS NOT BEEN SPECIFIED
     C*
     C                     ELSE
     C           SCMCD     IFNE *BLANK
     C                     ADD  1         EC         36
     C                     MOVEL' 215'    ERR,EC
     C                     END
     C                     END
     C*
     C** VALIDATE COMMISSION CODE:SAME DAY
     C** IT MUST EXIST IN COMBINATION WITH INSTRUMENT CURRENCY
     C** IF COMMISSION PATTERN HAS BEEN SPECIFIED
     C*
     C** CHECK THAT SCMSD IS NUMERIC
     C*
     C                     Z-ADD*ZERO     CMSD
     C*
     C           CPAT      IFNE *BLANK
     C                     MOVELSCMSD     WRK3A   3
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C*
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         37
     C                     MOVEL' 216'    ERR,EC
     C                     ELSE
     C                     MOVELSCMSD     CMSD
     C*
     C** CHECK THAT THIS CODE EXISTS ON THE CHARGE/COMMISSION FILE
     C*
     C                     MOVELCMSD      CGCM
     C           CHGCMK    CHAINCHGCM                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         37
     C                     MOVEL' 216'    ERR,EC
     C                     END
     C                     END
     C*
     C** IT MUST BE BLANK
     C** IF COMMISSION PATTERN HAS NOT BEEN SPECIFIED
     C*
     C                     ELSE
     C           SCMSD     IFNE *BLANK
     C                     ADD  1         EC         37
     C                     MOVEL' 217'    ERR,EC
     C                     END
     C                     END
     C*
     C** CHARGE CODE PURCHASES
     C** IT MUST EXIST IN COMBINATION WITH INSTRUMENT CURRENCY
     C*
     C** CHECK THAT SCGEP IS NUMERIC
     C*
     C                     Z-ADD*ZERO     CGEP
     C*
     C           SCGEP     IFNE *BLANK
     C                     MOVELSCGEP     WRK3A   3
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C*
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         38
     C                     MOVEL' 218'    ERR,EC
     C                     ELSE
     C                     MOVELSCGEP     CGEP
     C*
     C** CHECK THAT THIS CODE EXISTS ON THE CHARGE/COMMISSION FILE
     C*
     C                     MOVELCGEP      CGCM
     C           CHGCMK    CHAINCHGCM                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         38
     C                     MOVEL' 218'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C** CHARGE CODE SALES
     C** IT MUST EXIST IN COMBINATION WITH INSTRUMENT CURRENCY
     C*
     C** CHECK THAT SCGES IS NUMERIC
     C*
     C                     Z-ADD*ZERO     CGES
     C*
     C           SCGES     IFNE *BLANK
     C                     MOVELSCGES     WRK3A   3
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C*
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         39
     C                     MOVEL' 219'    ERR,EC
     C                     ELSE
     C                     MOVELSCGES     CGES
     C*
     C** CHECK THAT THIS CODE EXISTS ON THE CHARGE/COMMISSION FILE
     C*
     C                     MOVELCGES      CGCM
     C           CHGCMK    CHAINCHGCM                99
     C  N99      RECI      COMP '*'                      99
     C           *IN99     IFEQ '1'
     C                     ADD  1         EC         39
     C                     MOVEL' 219'    ERR,EC
     C                     END
     C                     END
     C                     END
     C*
     C** VALIDATE REVIEW FREQUENCY
     C*
     C                     MOVELSRVFR     RVFR
     C*
     C           RVFR      LOKUPFREQ                     99
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         40
     C                     MOVEL' 220'    ERR,EC
     C                     END
     C*
     C** VALIDATE REVIEW BASE DAY - IT IS REQUIRED FOR M,T,Q,X,Y
     C*
     C           RVFR      IFEQ 'M'
     C           RVFR      OREQ 'T'
     C           RVFR      OREQ 'Q'
     C           RVFR      OREQ 'X'
     C           RVFR      OREQ 'Y'
     C*
     C** IT MUST BE NUMERIC AND >0 AND <=31
     C*
     C                     MOVELSRVDY     WRK3A
     C                     MOVE '0'       WRK3A
     C                     TESTN          WRK3A      99
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         41
     C                     MOVEL' 221'    ERR,EC
     C                     ELSE
     C                     MOVELSRVDY     RVDY
     C           RVDY      IFLE *ZERO
     C           RVDY      ORGT 31
     C                     ADD  1         EC         41
     C                     MOVEL' 221'    ERR,EC
     C                     END
     C                     END
     C*
     C** OTHERWISE ( IF FREQ NOT M,T,Q,X,Y AND
     C** IS NOT ALREADY IN ERROR ) IT SHOULD BE BLANK
     C*
     C                     ELSE
     C           SRVDY     IFNE *BLANK
     C           *IN40     ANDNE'1'
     C                     ADD  1         EC         41
     C                     MOVEL' 222'    ERR,EC
     C                     ELSE
     C                     Z-ADD*ZERO     RVDY
     C                     END
     C*
     C                     END
     C*
     C** IF NEXT DATE IS BLANK USE
1552 C** ZFRQA TO CALCULATE IT
1538 C*
     C           *IN,40    IFEQ '0'
     C           *IN,41    ANDEQ'0'
     C           SRVDT     ANDEQ*BLANK
     C*
     C** STARTING DATE FOR 'NEXT DATE' CALCULATION MUST
     C** BE CALCULATED DEPENDING ON THE FREQUENCY
     C*
     C           RVFR      IFEQ 'D'
1559 C           RUND      SUB  1         ZDAYNO
     C                     ELSE
     C           RVFR      IFEQ 'W'
     C           RVFR      OREQ 'F'
     C*
     C** WEEKLY AND FORTNIGHTLY STARTS FROM TODAY
     C*
1559 C                     Z-ADDRUND      ZDAYNO
     C                     ELSE
     C*
     C** FREQ OF Y, M, Q, T, X FROM BASE DAY OF CURRENT MONTH
     C*
     C           RVFR      IFEQ 'M'
     C           RVFR      OREQ 'T'
     C           RVFR      OREQ 'Q'
     C           RVFR      OREQ 'X'
     C           RVFR      OREQ 'Y'
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C  N98                MOVELRVDY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVE RVDY      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
     C                     ELSE
     C*
     C** THE REST START FROM THE 1ST DAY OF THE PREVIOUS MONTH
     C*
     C                     Z-ADDRUND      ZDAYNO
     C                     EXSR ZDATE2
     C                     SUB  1         ZMTH
     C           ZMTH      IFEQ *ZERO
     C                     SUB  1         ZYEAR
     C                     Z-ADD12        ZMTH
     C                     END
     C  N98                MOVEL'01'      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVE '01'      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C                     EXSR ZDATE1
     C                     END
     C                     END
     C                     END
     C*
     C** CALCULATE THE NEXT DATE FROM THIS STARTING DATE
     C*
     C                     MOVE RVFR      ZFREQ
     C                     MOVE RVDY      ZMDAY
     C                     MOVELLOCY      ZCCY
     C                     MOVELSYSL      ZLOC                            S01195
     C           ZDAYNO    DOUGERUND
     C                     EXSR ZFRQA
     C                     END
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SRVDT
     C                     END
     C*
     C** VALIDATE NEXT REVIEW DATE
     C** IT MUST BE NUMERIC AND VALID AS PER ZDATE1
     C*
     C                     MOVELSRVDT     WRK7A
     C                     MOVE '0'       WRK7A   7
     C                     TESTN          WRK7A      99
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         42
     C                     MOVEL' 223'    ERR,EC
     C                     ELSE
     C                     MOVE SRVDT     ZDATE
     C                     EXSR ZDATE1
     C           *IN,99    IFEQ '0'
     C                     Z-ADDZDAYNO    RVDT
     C*
     C** NEXT REVIEW DATE MUST NOT BE LESS THAN RUN DATE
     C*
     C           RVDT      IFLT RUND
     C                     ADD  1         EC         42
     C                     MOVEL' 224'    ERR,EC
     C                     END
     C                     ELSE
     C                     ADD  1         EC         42
     C                     MOVEL' 223'    ERR,EC
     C                     END
     C                     END
     C*
     C** VALIDATE EXPIRY DATE
     C** IF ENTERED IT MUST BE NUMERIC AND VALID AS PER ZDATE1
     C*
     C           SEXPD     IFNE *BLANKS
     C                     MOVELSEXPD     WRK7A
     C                     MOVE '0'       WRK7A   7
     C                     TESTN          WRK7A      99
     C           *IN99     IFEQ '0'
     C                     ADD  1         EC         43
     C                     MOVEL' 225'    ERR,EC
     C                     ELSE
     C                     MOVE SEXPD     ZDATE
     C                     EXSR ZDATE1
     C           *IN,99    IFEQ '0'
     C                     Z-ADDZDAYNO    EXPD
     C*
     C** EXPIRY DATE MUST NOT BE LESS THAN RUN DATE
     C*
     C           EXPD      IFLT RUND
     C                     ADD  1         EC         43
     C                     MOVEL' 226'    ERR,EC
     C                     END
     C                     ELSE
     C                     ADD  1         EC         43
     C                     MOVEL' 225'    ERR,EC
     C                     END
     C                     END
     C                     ELSE
     C                     Z-ADD*ZERO     EXPD
     C                     END
     C*                                                                   S04662
     C** Only validate the Deposit & Spread Margin Rate if Switchable     S04662
     C** Feature, Initial Margin for Futures, S04662, is present.         S04662
     C           S04662    IFEQ 'Y'                                       S04662
     C*                                                                   S04662
     C** VALIDATE DEPOSIT MARGIN RATE USING ZALIGN                        S04662
     C** IT MUST BE NUMERIC, MANDATORY                                    S04662
     C*                                                                   S04662
     C           SINMC     IFNE *BLANK                                    S04662
     C*                                                                   S04662
     C                     Z-ADDA6NBDP    ZADEC                           S04662
     C           13        SUB  A6NBDP    ZADIG                           S04662
     C                     MOVEL*BLANK    ZFIELD                          S04662
     C                     MOVE SINMC     ZFIELD                          S04662
     C                     EXSR ZALIGN                                    S04662
     C*                                                                   S04662
     C           *IN99     IFEQ '1'                                       S04662
     C                     ADD  1         EC         45                   S04662
     C                     MOVEL' 231'    ERR,EC                          S04662
     C                     ELSE                                           S04662
     C                     MOVE ZFIELD    INMC                            S04662
     C                     EXSR ZEDIT                                     S04662
     C                     MOVE ZFIELD    SINMC                           S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C** ERROR IF BLANK                                                   S04662
     C                     ELSE                                           S04662
     C                     ADD  1         EC         45                   S04662
     C                     MOVEL' 231'    ERR,EC                          S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C** VALIDATE SPREAD MARGIN RATE USING ZALIGN                         S04662
     C** IT MUST BE NUMERIC, MANDATORY                                    S04662
     C*                                                                   S04662
     C           SSPMC     IFNE *BLANK                                    S04662
     C*                                                                   S04662
     C                     Z-ADDA6NBDP    ZADEC                           S04662
     C           13        SUB  A6NBDP    ZADIG                           S04662
     C                     MOVEL*BLANK    ZFIELD                          S04662
     C                     MOVE SSPMC     ZFIELD                          S04662
     C                     EXSR ZALIGN                                    S04662
     C*                                                                   S04662
     C           *IN99     IFEQ '1'                                       S04662
     C                     ADD  1         EC         46                   S04662
     C                     MOVEL' 232'    ERR,EC                          S04662
     C                     ELSE                                           S04662
     C                     MOVE ZFIELD    SPMC                            S04662
     C                     EXSR ZEDIT                                     S04662
     C                     MOVE ZFIELD    SSPMC                           S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C** If no error on Deposit or Spread Margin Rate so far then         S04662
     C** check that the Spread Margin Rate is less than or equal to       S04662
     C** the Deposit Margin Rate.                                         S04662
     C           SSPMC     IFGT SINMC                                     S04662
     C           *IN45     ANDEQ'0'                                       S04662
     C           *IN46     ANDEQ'0'                                       S04662
     C                     ADD  1         EC         45                   S04662
     C                     SETON                     46                   S04662
     C                     MOVEL' 233'    ERR,EC                          S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C** ERROR IF BLANK                                                   S04662
     C                     ELSE                                           S04662
     C                     ADD  1         EC         46                   S04662
     C                     MOVEL' 232'    ERR,EC                          S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C** Else, feature not present, so set fields to zero.                S04662
     C                     ELSE                                           S04662
     C                     Z-ADD*ZERO     INMC                            S04662
     C                     Z-ADD*ZERO     SPMC                            S04662
     C                     END                                            S04662
     C*
     C                     ELSE
     C*
     C** IF ACTION=D WITH ENTER PRESSED THEN ERROR                         -
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVELINF,10    INFMSG
     C                     MOVEA'1'       *IN,26                                              TDA089
     C                     END
     C                     END
     C                     ELSE
     C*
     C** IF COMMAND 4 TAKEN
     C*
     C           AID       IFEQ '04'
     C*
     C** COMMAND 4 TAKEN CORRECTLY WHEN ACTION IS D-FORCE 'RECORD ADVANCE'
     C*
     C           ACTN      IFEQ 'D'
     C                     MOVEL'RA'      AID
     C*
     C** COMMAND 4 TAKEN INCORRECTLY WHEN ACTION IS NOT D-HENCE ERROR
     C*
     C                     ELSE
     C                     MOVELINF,11    INFMSG
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** ERROR ON SCREEN SO HIGHLIGHT ERROR CODES
     C*
     C           EC        IFNE *ZERO
     C                     MOVELHI        ERRMSG
     C                     END
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **           ****** AS400 CONVERSION ******                         S01179
      **                                                                  S01179
      ** ASCHGS S/R TO MOVE THE APPROPRIATE VALUES INTO FIELD AID,        S01179
      ** DEPENDING ON WHICH FUNCTION KEY HAS BEEN PRESSED.                S01179
      ** CALLED FROM UPDATE                                               S01179
      **                                                                  S01179
     C*================================================================   S01179
     C*                                                                   S01179
     C           ASCHGS    BEGSR                                          S01179
     C*                                                                   S01179
     C* If ENTER pressed, the VLDCMDKEY indicator will be off             S01179
     C*                                                                   S01179
     C           *IN55     IFEQ '0'                                       S01179
     C                     MOVE 'RA'      AID                             S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F3                                                             S01179
     C*                                                                   S01179
     C           *INKC     IFEQ '1'                                       S01179
     C                     MOVE '01'      AID                             S01179
     C                     MOVE '0'       *INKC                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F10                                                            S01179
     C*                                                                   S01179
     C           *INKJ     IFEQ '1'                                       S01179
     C                     MOVE '04'      AID                             S01179
     C                     MOVE '0'       *INKJ                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If F12                                                            S01179
     C*                                                                   S01179
     C           *INKL     IFEQ '1'                                       S01179
     C                     MOVE '05'      AID                             S01179
     C                     MOVE '0'       *INKL                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLUP pressed                                                 S01179
     C*                                                                   S01179
     C           *IN50     IFEQ '1'                                       S01179
     C                     MOVE 'UP'      AID                             S01179
     C                     MOVE '0'       *IN50                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C* If ROLLDOWN pressed                                               S01179
     C*                                                                   S01179
     C           *IN51     IFEQ '1'                                       S01179
     C                     MOVE 'DN'      AID                             S01179
     C                     MOVE '0'       *IN51                           S01179
     C                     END                                            S01179
     C*                                                                   S01179
     C**If*HELP*key pressed                                         S01179S01199
     C*********                                                     S01179S01199
     C*********  *IN52     IFEQ '1'                                 S01179S01199
     C*********            MOVE 'HP'      AID                       S01179S01199
     C*********            MOVE '0'       *IN52                     S01179S01199
     C*********            END                                      S01179S01199
     C*                                                                   S01179
     C                     ENDSR                                          S01179
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** DEFLTS S/R TO FORMAT DEFAULT FIELD VALUES FOR INSERT SCREEN ETC
      ** CALLED FROM UPDATE; VALIDD
      ** CALLS NO OTHER S/R'S
      **
     C*================================================================
     C           DEFLTS    BEGSR                           ** DEFLTS BSR**
     C*
     C** DEFAULTS FOR RECORD
     C*
     C** THARE ARE NO DEFAULTS FOR RECORD
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** INITRC S/R TO INITIALISE ALL FILE FIELDS TO ZERO/BLANK
      ** CALLED FROM UPDATE; UPDFLS
      ** CALLS NO OTHER S/R'S
      **
     C*================================================================
     C*
     C           INITRC    BEGSR                           ** INITRC BSR**
     C*
     C** INITIALIZE ALL DATA ON RECORD DEFINED IN DETREC (KEY EXCLUDED)
     C*
     C                     MOVEL*BLANK    DETREC
     C                     Z-ADD*ZERO     SETP
     C                     Z-ADD*ZERO     CMCD
     C                     Z-ADD*ZERO     CMSD
     C                     Z-ADD*ZERO     CGEP
     C                     Z-ADD*ZERO     CGES
     C                     Z-ADD*ZERO     RVDY
     C                     Z-ADD*ZERO     RVDT
     C                     Z-ADD*ZERO     EXPD
     C                     Z-ADD*ZERO     INMC                            S04662
     C                     Z-ADD*ZERO     SPMC                            S04662
     C                     Z-ADD*ZERO     LCD
     C                     Z-ADD*ZERO     TNLU
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** TRSFS S/R TO FORMAT RECORD FIELDS FOR SCREEN
      ** CALLED FROM UPDATE
      ** CALLS ZEDIT; ZDATE2
      **
     C*================================================================
     C*
     C           TRSFS     BEGSR                           ** TRSFS BSR **
     C*
     C** TRANSLATE RECORD DETAILS FROM FILE LAYOUT TO SCREEN LAYOUT
     C*
     C** TRANSLATE SETP
     C*
     C           SETP      IFEQ *ZERO
     C                     MOVEL*BLANK    SSETP
     C                     ELSE
     C                     MOVELSETP      SSETP
     C                     END
     C*
     C** TRANSLATE SETA
     C*
     C                     MOVELSETA      SSETA
     C*                                                                   S01117
     C** TRANSLATE SEBR                                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVELSEBR      SSEBR                           S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANK    SSEBR                           S01117
     C                     END                                            S01117
     C*
     C***IF*MULTIBRANCHING*AND*SETTLEMENT*TYPE*IS*05**********************S01117
     C***THE*LAST*10*CHARACTERS*ARE*ZERO*ON*FILE,BLANK*ON*SCREEN**********S01117
     C***********                                                         S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********SETP      ANDEQ05                                        S01117
     C***********          MOVE '  '      SSETA                           S01117
     C***********          END                                            S01117
     C*
     C** TRANSLATE FACO
     C*
     C                     MOVELFACO      SFACO
     C*
     C** TRANSLATE CNOS
     C*
     C                     MOVE *BLANK    SCNOS                           E25437
     C                     MOVELCNOS      SCNOS
     C*
     C** TRANSLATE CPAT
     C*
     C                     MOVELCPAT      SCPAT
     C*
     C** TRANSLATE CMCD
     C*
     C           CMCD      IFEQ *ZERO
     C                     MOVEL*BLANK    SCMCD
     C                     ELSE
     C                     MOVELCMCD      SCMCD
     C                     END
     C*
     C** TRANSLATE CMSD
     C*
     C           CMSD      IFEQ *ZERO
     C                     MOVEL*BLANK    SCMSD
     C                     ELSE
     C                     MOVELCMSD      SCMSD
     C                     END
     C*
     C** TRANSLATE CGEP
     C*
     C           CGEP      IFEQ *ZERO
     C                     MOVEL*BLANK    SCGEP
     C                     ELSE
     C                     MOVELCGEP      SCGEP
     C                     END
     C*
     C** TRANSLATE CGES
     C*
     C           CGES      IFEQ *ZERO
     C                     MOVEL*BLANK    SCGES
     C                     ELSE
     C                     MOVELCGES      SCGES
     C                     END
     C*
     C** TRANSLATE RVFR
     C*
     C                     MOVELRVFR      SRVFR
     C*
     C** TRANSLATE RVDY
     C*
     C           RVDY      IFEQ *ZERO
     C                     MOVEL*BLANK    SRVDY
     C                     ELSE
     C                     MOVELRVDY      SRVDY
     C                     END
     C*
     C** TRANSLATE RVDT
     C*
     C                     Z-ADDRVDT      ZDAYNO         99
     C           *IN,99    IFEQ '0'
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SRVDT
     C                     ELSE
     C                     MOVEL*BLANK    SRVDT
     C                     END
     C*
     C** TRANSLATE EXPD
     C*
     C                     Z-ADDEXPD      ZDAYNO         99
     C           *IN,99    IFEQ '0'
     C                     EXSR ZDATE2
     C                     MOVELZDATE     SEXPD
     C                     ELSE
     C                     MOVEL*BLANK    SEXPD
     C                     END
     C*                                                                   S04662
     C** Only translate Deposit & Spread Margin Rates if Switchable       S04662
     C** Feature, Initial Margin for Futures, S04662, is present.         S04662
     C           S04662    IFEQ 'Y'                                       S04662
     C*                                                                   S04662
     C** TRANSLATE INMC - Deposit Margin Spread                           S04662
     C                     Z-ADDA6NBDP    ZADEC                           S04662
     C           13        SUB  A6NBDP    ZADIG                           S04662
     C                     MOVEL*BLANK    ZFIELD                          S04662
     C                     MOVE INMC      ZFIELD                          S04662
     C                     EXSR ZEDIT                                     S04662
     C                     MOVE ZFIELD    SINMC                           S04662
     C*                                                                   S04662
     C** TRANSLATE SPMC - Spread Margin Rate                              S04662
     C                     Z-ADDA6NBDP    ZADEC                           S04662
     C           13        SUB  A6NBDP    ZADIG                           S04662
     C                     MOVEL*BLANK    ZFIELD                          S04662
     C                     MOVE SPMC      ZFIELD                          S04662
     C                     EXSR ZEDIT                                     S04662
     C                     MOVE ZFIELD    SSPMC                           S04662
     C*                                                                   S04662
     C                     END                                            S04662
     C*                                                                   S04662
     C                     ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** UPDFLS S/R TO UPDATE FILE RECORDS
      ** CALLED FROM UPDATE
      ** CALLS INITRC; ZTNLU1; INFSR
      **
     C*================================================================
     C           UPDFLS    BEGSR                           ** UPDFLS BSR**
     C*
     C** U P D A T E   F I L E S
     C*
     C** INITIALIZE ALL FIELDS ON THE RECORD (IE ZEROIZE/BLANK OUT)
     C*
     C                     EXSR INITRC
     C*
     C** RETRIEVE NEXT TRANSACTION NUMBER
     C*
     C                     EXSR ZTNLU1
     C*
     C** INITIALISE ERROR BAND
     C*
     C                     MOVEL*BLANK    INFMSG
     C*
     C**               I  N  S  E  R  T  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'I'
     C           DEFLTK    CHAINDEFLTDF              60
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     MOVEL'D'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'I'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C   60                WRITEDEFLTDF                15
     C*
     C** TEST FOR UPDATE BY ANOTHER W/S, OR A TERMINAL ERROR
     C*
     C           *IN15     IFEQ '1'
     C           STATUS    ANDEQ01021
     C           DEFLTK    CHAINDEFLTX               15
     C           *IN15     IFEQ '0'
     C                     EXSR UPDOWS
     C                     GOTO XTUPDF
     C                     END
     C                     END
     C           *IN15     IFEQ '1'
     C                     EXSR INFSR
     C                     END
     C*
     C  N60                UPDATDEFLTDF
     C                     ELSE
     C*
     C**               I  N  S  E  R  T  S                 -  E N D
     C*
     C**               A  M  E  N  D  S                    -  S T A R T
     C*
     C           ACTN      IFEQ 'A'
     C           DEFLTK    CHAINDEFLTDF              60
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C*
     C** TRANSLATE RECORD DETAILS FROM SCREEN LAYOUT TO FILE LAYOUT
     C*
     C                     EXSR VALIDD
     C                     Z-ADDRUND      LCD
     C                     MOVEL'A'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N60                UPDATDEFLTDF
     C                     ELSE
     C*
     C**               A  M  E  N  D  S                    -  E N D
     C*
     C**               D  E  L  E  T  E  S                 -  S T A R T
     C*
     C           ACTN      IFEQ 'D'
     C           DEFLTK    CHAINDEFLTDF              60
     C           TNLU      IFNE STNLU
     C                     EXSR UPDOWS
     C*
     C** IF NO PROCESSING OCCURRED EXIT TO SUPPRESS AUDIT UPDATE
     C*
     C                     GOTO XTUPDF
     C*
     C                     ELSE
     C                     MOVEL'*'       RECI
     C                     Z-ADDRUND      LCD
     C                     MOVEL'D'       CHTP
     C                     MOVELNATN      TNLU
     C                     END
     C  N60                UPDATDEFLTDF
     C                     END
     C*
     C**               D  E  L  E  T  E  S                 -  E N D
     C*
     C                     END
     C                     END
     C*
     C** GET AUDIT RECORD
     C*
     C           1         CHAINDEFLTAF              99
     C*
     C** UPDATE AUDIT RECORD IF FOUND
     C*
     C           *IN99     IFEQ '0'
     C*
     C** FOR INSERT, UPDATE LIVE RECORDS INSERTED TODAY, AND NO. OF LIVE
     C** RECORDS
     C*
     C           ACTN      IFEQ 'I'
     C                     ADD  1         NINS
     C                     ADD  1         NORE
     C                     END
     C*
     C** FOR AMENDS, UPDATE NO. OF RECORDS AMENDED TODAY
     C*
     C           ACTN      IFEQ 'A'
     C                     ADD  1         NAMD
     C                     END
     C*
     C** FOR DELETIONS, UPDATE NO. DELETIONS TODAY, AND NO. OF LIVE RECS
     C*
     C           ACTN      IFEQ 'D'
     C                     ADD  1         NDEL
     C                     SUB  1         NORE
     C                     END
     C*
     C** FORMAT COMIT TEXT
     C*
     C                     TIME           MTIME
     C                     MOVELACTN      ACTNX
     C                     MOVEASCRCTL    DET,01
     C                     MOVEADETS      DET,18
     C*
     C** UPDATE AUDIT RECORD
     C*
     C                     UPDATDEFLTAF
     C*
     C** C  O  M  I  T
     C*
     C           CMTTXT    COMIT
     C*
     C** AUDIT RECORD NOT FOUND: DATABASE ERROR
     C*
     C                     ELSE
     C*
     C                     SETON                     U7U8  ***************
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVEL'02'      DBASE            **DB ERROR 02**S01117
     C                     Z-ADD2         DBASE            **DB ERROR 02**S01117
     C                     MOVEL'DEFLT'   DBFILE           ***************
     C                     MOVEL'AUDIT'   DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR *PSSR                                     S01117
     C                     END
     C*
     C           XTUPDF    ENDSR
     C*================================================================
      /EJECT
     C*================================================================
      **
      ** UPDOWS S/R TO PROCESS UPDATE BY ANOTHER WORKSTATION
      ** CALLED FROM UPDFLS
      ** CALLS NO OTHER S/R'S
      **
     C*================================================================
     C           UPDOWS    BEGSR
     C**
     C                     ROLBK
     C**
     C**   SET UP NEXT SCREEN TO BE DISPLAYED:
     C**   IF RECORD IS LIVE, ALLOW AMEND PROCESSING;
     C**
     C           RECI      IFEQ 'D'
     C                     MOVEL'A'       ACTN
     C                     ELSE
     C**
     C**   IF RECORD HAS BEEN DELETED, ALLOW ENQUIRY
     C**
     C                     MOVEL'E'       ACTN
     C                     END
     C**
     C**   SET SCREEN PROCESSOR TO UPDATE AND MOVE UPDATE MESSAGE TO ERROR
     C**
     C                     MOVEA'001'     *IN,10
     C                     MOVELINF,12    INFMSG
     C**
     C                     ENDSR
     C**
     C*================================================================
      /EJECT
      /COPY ZSRSRC,ZDATE1Z2
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,ZALIGNZ2
      /EJECT
      /COPY ZSRSRC,ZEDITZ2
      /EJECT
      /COPY ZSRSRC,ZFRQAZ2
      /EJECT                                                              S01195
      /COPY ZSRSRC,ZACCH                                                  S01195
      /EJECT                                                              S01195
      /COPY ZSRSRC,ZCHKH                                                  S01195
      /EJECT
      /COPY ZSRSRC,ZTNLU1Z2
      /EJECT
     C*================================================================
     C**
     C**   FILE EXEPTION/ERROR HANDLING SUBROUTINE
     C**
     C           INFSR     BEGSR
     C**
     C** ROLL BACK CHANGES AND CANCEL PROGRAM
     C**
     C                     ROLBK
     C                     MOVE '*CANCL'  EXTTAG  6
     C**
     C                     ENDSREXTTAG
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACOD - Gets Account Codes via AOACODR0.                    *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACOD    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7                                           CGL029
     C                     PARM '*VERIFY' POPTN   7                                           CGL029
     C                     PARM           PACCD  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
      *                                                                                       CGL029
     C                     MOVE *ON       *IN99                                               CGL029
     C           PRTCD     IFEQ *BLANKS                                                       CGL029
     C                     MOVE *OFF      *IN99                                               CGL029
     C                     ELSE                                                               CGL029
     C           PRTCD     IFNE '*NRF'                                                        CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     MOVE 'SDACODPD'DBFILE                                              CGL029
     C                     MOVE PACCD     DBKEY                                               CGL029
     C                     Z-ADD101       DBASE                                               CGL029
     C                     OUT  LDA                                                           CGL029
     C                     MOVE *ON       *INU7                                               CGL029
     C                     MOVE *ON       *INU8                                               CGL029
     C                     EXSR *PSSR                                                         CGL029
     C                     ENDIF                                                              CGL029
     C                     ENDIF                                                              CGL029
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
     C*================================================================
      /EJECT                                                              S01117
     C********************************************************************S01117
      **                                                                  S01117
      ** *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
      ** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      * /104633/ Change
      * INF,7  DELETION F3:F10 to delete this record:F12:Rollup:Rolldown:help
      * INF,10 F10 is reqiured
      * INF,11 F10 is not reqiured
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** INF
 Enter:Action Code I,A,D,E and selection:Review from point:F3:Help
 Enter:Review from point:Action Code A,D,E:F3:F12:Rollup:Rolldown:     Help
 No Records Found: Enter Review from point; F3; F12; Help
 INSERTION Enter:F3:F12:Help
 AMENDMENT Enter:F3:F12:Rollup:Rolldown:Help
 ENQUIRY Enter:F3:F12:Rollup:Rolldown:Help
 DELETION F3:F10=Delete record:F12:Rollup:Rolldown:Help
 Rollup is not possible
 Rolldown is not possible
 F10=Confirm
 
 Record has been updated by another workstation
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   VST - 01,04,05,06,07,08,14,15
0104050607081415
**   FREQ - D,W,F,S,M,R,T,Q,X,Y,L,B,P,K,H,G,A
DWFSMRTQXYLBPKHGA
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
