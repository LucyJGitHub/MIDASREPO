     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Generate accounting entries')                 *
     F*****************************************************************
     F*                                                               *
     F*  Midas  -  Futures and Options Module                         *
     F*                                                               *
     F*   FF0420  -  GENERATE ACCOUNTING ENTRIES                      *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. AR988246           Date 04Dec12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247740             Date 15May07               *
      *                 246526             Date 21Mar07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243826A            Date 29Jan07               *
      *                 245059             Date 15Jan06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 163551             Date 12Jun01               *
      *                 CFF007             Date 19Feb01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 150367             Date 07Apr00
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 09Sep99               *
      *                 158309             Date 12Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01MAR99               *
      *                 133363             Date 29Apr99               *
      *                 CTI002             Date 11May99               *
     F*                 CAC003             Date 25Feb97               *
     F*                 CFF004             Date 16Sep96               *
     F*                 099326             Date 18Apr97                  *
     F*                 076819             DATE 13FEB97               *
     F*                 098904             DATE 29JUL96                  *
     F*                 CPM003             DATE 23NOV95               *
     F*                 075998             DATE 13NOV95               *
     F*                 S71062             DATE 13NOV95               *
     F*                 S01408             DATE 14SEP95               *
     F*                 089252             DATE 19JUN95                  *
     F*                 089254             DATE 23MAY95                  *
     F*                 087829             DATE 15MAY95                  *
     F*                 086015             DATE 03APR95                  *
     F*                 086125             DATE 16MAR95                  *
     F*                 S01522             DATE 25JAN95                  *
     F*                 S01456             DATE 08NOV93                  *
     F*                 S01455             DATE 05NOV93                  *
     F*                 E03643             DATE 23FEB93                  *
     F*                 S01393             DATE 30OCT92                  *
     F*                 S10736             DATE 04SEP92                  *
     F*                  FUJI-FF0011        DATE 21SEP92                 *
     F*                  E44684             DATE 19AUG92                 *
     F*                  AUS022             DATE 10AUG92                 *
     F*                  E23097             DATE 12SEP90                 *
     F*                  S01117             DATE 23MAR90                 *
     F*                  E18343             DATE 11NOV89                 *
     F*                  S01182             DATE 12OCT88                 *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  AR988246 - The BF APOST file does not generate account keys     *
      *             for the lending module.                              *
      *             Populate account keys is conditioned by CGL020       *
      *             switch. Omit the condition. (Child: AR988247)        *
      *  247740 - DBerror 27 occurred when posting reference used is 2.  *
      *           Only call AOACODR0 in SR/GETAS when ACOD field is not  *
      *           zero.                                                  *
      *  246526 - Recompiled due to change in FFSETLZ4.               *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  245059 - If inter-branch entries are via main branch, don't  *
      *           create the extra two postings if either settlement  *
      *           or booking branch are the same as the main branch   *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
      *           Information                                         *
      *  163551 - Call SR/GETAS to get the proper A/c Section before     *
      *           output record to MGEFFPD.                              *
      *  CFF007 - Futures and Options Enhancement for Private Banking *
      *  CFF006 - Fractional Ticks Enhancement.  (Recompiled)         *
      *  150367 - Recompile over changed /copy FFSTDPZ4.                 *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  158309 - If field NUM6 has a negative value, Z-SUB it to        *
     F*           make it positive so that it can be displayed           *
     F*           correctly when running a query                         *
      *  CGL007 - Account Postings Enquiry.                           *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
     F*  133363 - Account section not being written to MGEFFPD correctly *
     F*           Move work fields back before record written            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)  *
     F*  099326 - When TABTE10 accessed for Account code details         *
     F*           wrong field name is used for Account Section.          *
     F*  076819 - In case of posting reference 2 and payment on a     *
     F*           retail account this amount is wrongly posted on a   *
     F*           suspense computer account.                          *
     F*  098904 - Premium amount of a call GBP/JPY ccy option generated
     F*           to an account of CAD (Note that premium ccy=GBP).
     F*           Processing for settlement type 00 causes a wrong ccy
     F*           to be output to MGEFFPD.
     F*  CPM003 - FF/PM Interface upgrade to Release 10               *
     F*  075998 - Changes for FF / PM performance.                    *
     F*  S71062 - FF/PM Interface - Posting generation                *
     F*                           - Margin calculation                *
     F*  S01408 - Hook FF0420CCP1 added.                                 *
     F*  089252 Amend key for call to AOCUSTR0.                          *
     F*  089254 - Correct fill of period for FI narrative codes          *
     F*  087829 - Correct sequence number for converted narrative codes  *
     F*  086015 - Check for overflow before writing End of Report & DB   *
     F*           Error formats                                          *
     F*  086125 - Add new parameter to AOPNARR0                          *
     F*  S01522 - Call to AOPNARR0 if switchable feature installed       *
     F*           and UDC present                                        *
     F*  S01456 - 'FF' MONTHLY P&L ENHANCEMENTS.                         *
     F*           Recompiled due to change to PF/MKCTLD.                 *
     F*  S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                         *
     F*           Recompiled due to changes in PF/TABTB80.               *
     F*  E03643 - Recompile because of change to pf/clostt               *
     F*  S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT             *
     F*  S10736  -  MANAGEMENT ACCOUNTING                                *
     F*  FUJI-FF0011 - The system does not differentiate between         *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*               *** RECOMPILE ONLY ***                             *
     F*   E44684    - Posting narratives are not produced for the        *
     F*               reserved FF narrative codes.                       *
     F*   AUS022  -  AUSTRALIAN CHANGE : Contract Type (CNTT) added to   *
     F*              PF/INTYPD.  Recompile program only.                 *
     F*   E23097  -  Subroutine NARRAT amended because of change of      *
     F*              narrative code in TABLETP from 2N to 2A - code      *
     F*              amended and new array NARCD added to program.       *
     F*              Also, amended Narr. Codes FA, FC, FM, FN to allow   *
     F*              space for '*' (Reversal) in position 30.  For FB,   *
     F*              allow '*' to overwrite last char. of Report Name.   *
     F*   S01182  -  Maintains new account posting fields on the         *
     F*              generated entries file LF/MGEFF for MIS.            *
     F*   S01117  -  MULTIBRANCHING                                      *
     F*   E18343  -  PROGRAM RE-COMPILED DUE TO CHANGE IN ZSRSRC MEMBER  *
     F*              ZFRPEDZ3                                            *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*     IGNDECERR(*YES)                                              *
     F*                                                                  *
     F********************************************************************
     F/COPY WNCPYSRC,FF0420F002
     FTABFF   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F* ICD 2     TABTB11F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE               S01117
     F* ICD 3     TABTB20F                          KIGNORE
     F* ICD 5     TABTB40F                          KIGNORE
     F* ICD FF&O  TABTB80F                          KIGNORE
     F* AC CODE 1 TABTE10F                          KIGNORE
     F* AC CODE 2 TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F* NOSTROS   TABLETLF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F* BRANCHES  TABLETRF                          KIGNORE
     F            TABLETRF                          KIGNORE               S01117
     FTABLETP IF  E           K        DISK
     FFOKEYA  IF  E           K        DISK
     FMKCTL   IF  E           K        DISK
     FMARKT   IF  E           K        DISK
     FFOCLT   IF  E           K        DISK
     FCLINT   IF  E           K        DISK
     FACCNT   IF  E           K        DISK
     F*           ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     FFACKY   IF  E           K        DISK
     FINTYP2  IF  E           K        DISK
     FFOKEY   IP  E           K        DISK
     FMGEFFHH UF  E                    DISK                      A
     FMGEFFPD O   E                    DISK
     FMGEFFZZ UF  E                    DISK                      A
     FCLOST10 IF  E           K        DISK                           UC  075998
     FPMPORTLLIF  E           K        DISK                           UC  S71062
     FFF0420AUO   E                    PRINTER
     F                                              KINFDS SPOOLU         S01117
     FFF0420P2O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL2         S01117
     FFF0420P1O   E                    PRINTER                        UC  S01117
     F                                              KINFDS SPOOL1         S01117
     F***********                                   KINFDS PRINT2         S01117
     F*F0420P1O** E                    PRINTER                            S01117
     F***********                                   KINFDS PRINT1         S01117
     F/COPY WNCPYSRC,FF0420F001
     F*
     F************        FUNCTIONS OF INDICATORS        *************
     F*
     F*            01            FIRST CYCLE INDICATOR
     F*
     F*            10            MARKET BASED IND/PARM IS 'Y'
     F*            11            LF/FOKEY RECORD IS A REVERSAL
     F*            12            'DIFFERENCE' COMMENT ON FF0420AU
     F*            13            MISSING ACCOUNT KEY INDICATOR
     F*            14            AT LEAST ONE RECORD IN ACCRUAL SUMMARY
     F*            15            NARR CODE FOUND ON FF NARRATIVES ARRAY   E23097
     F*            20            Analytical Accounting and SAR CAC003
     F*
     F*            40            NO VALID RECORD FOUND
     F*            41            NO VALID RECORD FOUND ON LF/FOKEY
     F*            43            NUMERIC FIELD
     F*                                                                   S01117
     F*            50            MULTIBRANCHING IS 'Y'                    S01117
     F*            51            DETAILS REPORT P1 HAS BEEN OPENED        S01117
     F*            52            DETAILS REPORT P2 HAS BEEN OPENED        S01117
     F*            53            AT LEAST ONE ACCOUNT KEY                 S01117
     F*                          IS MISSING FOR A BRANCH                  S01117
     F*            54            AT LEAST ONE RECORD IN ACCRUAL SUMMARY   S01117
     F*                          FOR A BRANCH                             S01117
     F*
     F*                L1        CHANGE OF ACCOUNT KEY
     F*                L2        CHANGE OF CURRENCY
     F*                L3        CHANGE OF BRANCH
     F*
     F*            80-89         USED IN MODULE STANDARD SUBROUTIN
     F*            90-95         USED IN Z-SUBROUTINES
     F*            98            DATE FORMAT IS MMMDDYY
     F*
     F*                 U4       AT LEAST ONE ACCOUNT KEY
     F*                          IS MISSING
     F*
     F*                 U5       IMBALANCE FOUND IN BRANCH/CCY
     F*                          TOTAL
     F*
     F*                 U8       FILE CONTROLS OUT OF BALANCE
     F*
     F*                 U7 U8    DATABASE ERROR
     F*
     F*****************************************************************
     F/EJECT
     E                    CPY@    1   1 80
     E*****************************************************************
     E*
     E**********          ACARY       6  4 0                                                  CGL029
     E                    ACARY       6 10 0                                                  CGL029
     E**  ACCOUNT CODES
     E*
     E                    NAARY       6  2
     E**  NARRATIVE CODES
     E*
     E                    POARY       6  1 0
     E**  POSTING REFERENCE
     E*
     E                    MESS    1   4 20
     E**  MESSAGE ARRAY
     E*
     E/COPY WNCPYSRC,FF0420E001
     E                    NARTB1  7   7  2
     E**  NARRATIVE CODES FOR DESCRIPTION
     E*
     E                    NARTB2  4   7 15
     E**  NARRATIVE DESCRIPTION
     E*
     E                    NARCD  16  16  2                                E23097
     E/COPY WNCPYSRC,FF0420E002
     E**  FULL LIST OF FF NARRATIVE CODES                                 E23097
     E                    FULA       34  1
     E** ARRAY FOR UNDERLINING
     E*
     E/COPY ZSRSRC,FFSTDPZ1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,FFFMTZ1
     E/COPY ZSRSRC,FFPRCSZ2
     E                    #CD     1   9  2   #ID     2                    S01522
      **  Translation Table for S01522                                    S01522
      *                                                                   S01522
     E*
     E*****************************************************************
     E/EJECT
     I*****************************************************************
     I* Rename fields from CLOSTTF                                        075998
     ICLOSTTF                                                             075998
     I              RECI                            WRRECI                075998
     I              CLON                            WRCLON                075998
     I              TNBR                            WRTNBR                075998
     I              NCCL                            WRNCCL                075998
     I              TRSD                            WRTRSD                075998
     I              TRTY                            WRTRTY                075998
     I              FCLI                            WRFCLI                075998
     I*                                                                  *
     IFOKEYDF
     I                                              FFKY  L1
     I              CBCD                            FFCBCD
     I***********   BRCD                            FFBRCDL3              S01117
     I              BRCA                            FFBRCAL3              S01117
     I              CCY                             FFCCY L2
     I              SETP                            FFSETP
     I              SETA                            FFSETA
     I              SEBR                            FFSETB                S01117
     I              PTFR                            FFPTFR                S71062
     I              PRFC                            FFPRFC                CAC003
     I*                                                                  *
     IFOKEYAF
     I              RECI                            FRECI
     I              NORE                            FNORE
     I              HRWN                            FHRWN
     I              HRDC                            FHRDC
     I*                                                                  *
     IAPOSTZZF
     I              RECI                            ORECI
     I              NORE1                           ONORE
     I              HRWN                            OHRWN
     I              HRDC                            OHRDC
     I*
     I*                                                                  *
     I*ABLETRF***                                                         S01117
     I***********   BICN                            XXBICN                S01117
     I***********   NSACS                           XXNSCS                S01117
     I***********   NBACB                           XXBACB                S01117
     I***********   NBACH                           XXBACH                S01117
     I*                                                                   S01117
     IACCNTABF                                                            S01117
     I              PRFC                            PRFCX                 S01117
     I*
     IICDKY       DS
     I*
     I**      DATA STRUCTURE FOR KEY TO INSTALLATION CONTROL FILES
     I*
     I                                        1   2 ICD1
     I                                        3  10 ICD2
     I                                       11  12 ICD3
     I                                        8  11 ICD4
     I*
     IFFKY        DS
     I*
     I**      DATA STRUCTURE FOR ACCRUAL RECORD
     I*
     I                                        3   3 FFKY3
     I                                        6  10 FFKY6                 S01182
     I                                       14  14 FFKY14
     I*
     I            DS
     I*
     I**      DATA STRUCTURE TO LOAD ACCOUNT CODES ARRAY
     I*
     I**********                              1  240ACARY                                     CGL029
     I**********                              1   40ACD1                                      CGL029
     I**********                              5   80ACD2                                      CGL029
     I**********                              9  120ACD3                                      CGL029
     I**********                             13  160ACD4                                      CGL029
     I**********                             17  200ACD5                                      CGL029
     I**********                             21  240ACD6                                      CGL029
     I                                        1  600ACARY                                     CGL029
     I                                        1  100ACD1                                      CGL029
     I                                       11  200ACD2                                      CGL029
     I                                       21  300ACD3                                      CGL029
     I                                       31  400ACD4                                      CGL029
     I                                       41  500ACD5                                      CGL029
     I                                       51  600ACD6                                      CGL029
     I*
     I            DS
     I*
     I**      DATA STRUCTURE TO LOAD NARRATIVE CODES ARRAY
     I*
     I                                        1  12 NAARY
     I                                        1   2 NRC1
     I                                        3   4 NRC2
     I                                        5   6 NRC3
     I                                        7   8 NRC4
     I                                        9  10 NRC5
     I                                       11  12 NRC6
     I*
     I            DS
     I*
     I**      DATA STRUCTURE TO LOAD POSTING REFERENCES ARRAY
     I*
     I                                        1   60POARY
     I                                        1   10PRF1
     I                                        2   20PRF2
     I                                        3   30PRF3
     I                                        4   40PRF4
     I                                        5   50PRF5
     I                                        6   60PRF6
     I*
     IPNAR        DS
     I*
     I**      DATA STRUCTURE TO LOAD NARRATIVE FIELD
     I*
     I                                        4  30 NAR1
     I                                        8  30 NAR2
     I                                       14  30 NAR3
     I/COPY WNCPYSRC,FF0420I001
     I                                        5  10 NAR4
     I                                       11  13 NAR5
     I**********                             14  19 NAR6                                      CGL029
     I                                       14  25 NAR6                                      CGL029
     I                                       21  26 NAR7
     I                                       19  21 NAR8
     I                                       23  25 NAR9
     I                                       25  29 NAR10                 E23097
     I*
     IINST28      DS
     I*
     I**      DATA STRUCTURE TO LOAD INSTRUMENT FIELDS
     I*
     I                                        1   6 INST6
     I                                        1  10 INST10
     I                                        1  12 INST12
     I                                        1   2 MK
     I                                        4   6 INT
     I                                        8  12 PER
     I                                       14  14 XER
     I                                       16  28 NUM
     I                                        6  10 MTHYR
     I*
     I*RINT1***** DS                                                      S01117
     I***********                                                         S01117
     I********************DATA*STRUCTURE*FOR*PAGE*FULL*LINE*COUNT*P1******S01117
     I*
     I** FILE INFORMATION DATA STRUCTURE FOR P1                           S01117
     I*                                                                   S01117
     ISPOOL1      DS                                                      S01117
     I                                       83  92 SFILE1                S01117
     I                                    B 123 1240SFNUM1                S01117
     I                                    B 367 3680LINE1
     I*
     I*RINT2***** DS                                                      S01117
     I***********                                                         S01117
     I********************DATA*STRUCTURE*FOR*PAGE*FULL*LINE*COUNT*P2******S01117
     I*
     I** FILE INFORMATION DATA STRUCTURE FOR P2                           S01117
     I*                                                                   S01117
     ISPOOL2      DS                                                      S01117
     I                                       83  92 SFILE2                S01117
     I                                    B 123 1240SFNUM2                S01117
     I                                    B 367 3680LINE2
     I*                                                                   S01117
     I** FILE INFORMATION DATA STRUCTURE FOR AU                           S01117
     I*                                                                   S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I*
     I/COPY ZSRSRC,FFSTDPZ2
     I*
     I/COPY ZSRSRC,ZFRPEDZ2
     I*
     I/COPY ZSRSRC,FFFMTZ2
     I*
     I/COPY ZSRSRC,FFSETLZ1
     I*
     I/COPY ZSRSRC,FFSRDSZ1
     I*
     I/COPY ZSRSRC,FFPRCSZ3
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I** DATA AREA RUNDAT                                                 S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     I*
     ISDPLCS    E DSSDPLCSPD                                              S71062
     I**  External DS for portfolio customers details                     S71062
     ISDPCAC    E DSSDPCACPD                                              CAC003
     I** Profit Centre Accounting ICD                                     CAC003
     ISDBANK    E DSSDBANKPD                                              S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
     I*                                                                   S01117
     ISDMMOD    E DSSDMMODPD                                              S01522
     I* Module Details Accessed via access program                        S01522
     I*                                                                   S01522
     ISDPORT    E DSSDPORTPD                                              CPM003
     I** Portfolio Management ICD                                         CPM003
     I*                                                                   CPM003
     ISCSARD    E DSSCSARDPD                                              S01522
     I* SAR File details accessed via access program AOSARDR0             S01522
     I*                                                                   S01522
     ICGPNAR    E DSCGPNARPD                                              S01522
     I* UDC Multi-Language Narrative Data Structure                       S01522
     I*                                                                   S01522
     I##PRM1      DS                                                      086125
      **  Data Structure for Customer and Branch                          086125
      *                                                                   086125
     I                                        1   6 A#CUST                086125
     I                                        7   9 A#BRCA                086125
      *                                                                   086125
     ISDCUST    E DSSDCUSTPD                                              S01522
     I* Customer Details                                                  S01522
     I*                                                                   S01522
     I@DSSDY    E DSDSSDY                                                 S01117
     I* SECOND DS FOR ACCESS PROGRAMS; LONG DATA STRUCTURE                S01117
     I*                                                                   S01117
     IDSSDY     E DSDSSDY                                                                     CGL029
      ** Second DS for Access Programs, Long Data Structure                                   CGL029
     I              SDY1                            SDYZ1                                     CGL029
     I              SDY2                            SDYZ2                                     CGL029
     I              SDY3                            SDYZ3                                     CGL029
     I              SDY4                            SDYZ4                                     CGL029
      *                                                                                       CGL029
     I@DSLDY    E DSDSLDY                                                 CPB001
     I* SECOND DS FOR ACCESS PROGRAMS; VERY LONG DATA STRUCTURE           CPB001
     I*                                                                   CPB001
     ISDGELR    E DSSDGELRPD                                              S01117
     I**  EXTERNAL DS FOR GENERAL LEDGER DETAILS                          S01117
     I              QQACCD                          QQACD1                                    CGL029
     I              BKAKSI                          AKSI                  S01117
     I              BKMABR                          MABR                  S01117
     I              BKIEMB                          IEMB                  S01117
     I*                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I**  EXTERNAL DS FOR BRANCHES DETAILS                                S01117
     I              QQDFAC                          DFACQQ                                    CGL029
     I              A8DFAC                          XXDFAC                S01117
     I              A8DTAC                          XXDTAC                S01117
     I              A8BICN                          XXBICN                S01117
     I              A8BRNM                          BRNM                  S01117
      *                                                                   S01117
     ISDACOD    E DSSDACODPD                                              S01117
      **  EXTERNAL DS FOR ACCOUNT CODES DETAILS                           S01117
     I              QQACCD                          QQACD2                                    CGL029
     I              A5ACTY                          ATYP                  S01117
     I              A5ACSC                          ACSC                  S10736
     I              QQFNIC                          FNICQQ                                    CGL029
     I              QQFNAA                          FNAAQQ                                    CGL029
      *                                                                   S01117
     I@DSFDY    E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I*                                                                   S01117
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*
     I**      DATA STRUCTURE FOR DB ERROR HANDLING
     I*
     I***********                           134 177 DBLOT                 S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*
     I/COPY WNCPYSRC,FF0420I002
     I*                                                                   S71062
     I            DS                                                      S71062
     I                                        1  10 WPMKEY                S71062
     I**********                              1   60FFCBCD                             S71062 CSD027
     I                                        1   6 FFCBCD                                    CSD027
     I                                        7  10 FFPTFR                S71062
     I*****************************************************************
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     C/EJECT
     C*
     C**   SET UP PLIST FOR CALLING NEXT PROGRAM
     C*
     C           *ENTRY    PLIST
     C                     PARM           MARKET  2
     C                     PARM           MKBIND  1
     C                     PARM           AKMIND  1
     C                     PARM           POBIND  1
     C*****************************************************************
     C/COPY ZSRSRC,FFSETLZ2
     C/COPY ZSRSRC,FFSETLZ3
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                                  S71062
     C**  DEFINE KLIST:                                                   S71062
     C**                                                                  S71062
     C           PMKEY     KLIST                                          S71062
     C                     KFLD           FFCBCD                          S71062
     C                     KFLD           FFPTFR                          S71062
     C*
     C           *IN01     IFEQ '0'
     C                     EXSR START
     C                     END
     C*
     C**  BRANCH - PROCESSING FOR CHANGE IN BRANCH
     C*
     C           *INL3     IFEQ '1'
     C                     EXSR BRANCH
     C                     END
     C*
     C**  CURRCD - PROCESSING FOR CHANGE IN BRANCH/CURRENCY
     C*
     C           *INL2     IFEQ '1'
     C                     EXSR CURRCD
     C                     END
     C*
     C**  ACCKYD - PROCESSING FOR CHANGE IN BRANCH/CURRENCY/ACCOUNT KEY
     C*
     C           *INL1     IFEQ '1'
     C                     EXSR ACCKYD
     C                     END
     C*
     C**   INCREMENT NUMBER OF RECORDS READ
     C*
     C                     ADD  1         NUMREC
     C*
     C**   ADD POSTING AMOUNT TO HASH TOTAL
     C*
     C           EAMT      DIV  1000      ZZAMT
     C                     Z-ADDHASHI     ZZTOTI
     C                     Z-ADDHASHD     ZZTOTD
     C*
     C**    ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*
     C                     EXSR ZZADD
     C                     Z-ADDZZTOTI    HASHI
     C                     Z-ADDZZTOTD    HASHD
     C*
     C** EDIT TRANSACTION NUMBER FOR REPORT OUTPUT
     C** (TRADES AT MATURITY HAVE NEGATIVE TRANSACTION NUMBERS)
     C*
     C           TNBR      IFLT *ZERO
     C                     Z-SUBTNBR      WTNBR   60
     C                     MOVELWTNBR     RTNBR
     C                     MOVE '-(M)'    RTNBR
     C                     ELSE
     C                     MOVELTNBR      RTNBR
     C                     MOVE '    '    RTNBR
     C                     END
     C*
     C**   ZDATE2 - FORMAT EVENT DATE FOR REPORT OUTPUT
     C*
     C                     MOVE EDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    FFEDAT
     C*
     C**   ZFRPED - EDIT EVENT AMOUNT FOR REPORT OUTPUT
     C*
     C                     Z-ADDEAMT      ZFLD15
     C                     Z-ADDFFCDP1    ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    FFEAMT
     C*
     C**   IF - RECORD IS A REVERSAL
     C*
     C           REVI      IFEQ 1
     C                     SETON                     11
     C                     ELSE
     C                     SETOF                     11
     C                     END
     C*
     C                     MOVE REVI      VOIN                            S10736
     C*                                                                   S10736
     C**   ACCRUL - PROCESSING FOR ACCRUALS
     C*
     C                     EXSR ACCRUL
     C*
     C** WRITE TO MISSING ACCOUNT KEY FILE IF NO ACCOUNT KEY FOUND
     C*
     C           *IN51     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           LINE1     IFGT 56
     C           *IN13     ANDEQ'1'                                       S01117
     C           LINE1     ORLT 1                                         S01117
     C           *IN13     ANDEQ'1'                                       S01117
     C                     WRITEMAKYH
     C                     END
     C*
     C***13******          WRITEMAKYD                                     S01117
     C           *IN13     IFEQ '1'                                       S01117
     C                     WRITEMAKYD                                     S01117
     C                     SETON                     53                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C** ACCKYT - PROCESSING AT END OF BRANCH/CURRENCY/ACCOUNT KEY
     C*
     CL1                   EXSR ACCKYT
     C*
     C** CURRCT -PROCESSING AT END OF BRANCH/CURRENCY
     C*
     CL2                   EXSR CURRCT
     C*                                                                   S01117
     C** BRCHT - PROCESSING AT END OF BRANCH                              S01117
     C*                                                                   S01117
     CL3                   EXSR BRCHT                                     S01117
     C*
     C** END    -PROCESSING AT END OF PROGRAM
     C*
     CLR                   EXSR END
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C*    TABLE OF SUB-ROUTINES
     C*
     C*****************************************************************
     C*      START  - INITIALISATION
     C*      BRANCH - PROCESSING FOR CHANGE IN BRANCH
     C*      BRCHT  - PROCESSING AT END OF BRANCH                         S01117
     C*      CURRCD - PROCESSING FOR CHANGE IN BRANCH/CURRENCY
     C*      CURRCT - PROCESSING AT END OF BRANCH/CURRENCY
     C*      ACCKYD - PROCESSING FOR CHANGE IN BRANCH/CURRENCY/A/C KEY
     C*      ACCKYT - PROCESSING AT END OF BRANCH/CURRENCY/A/C KEY
     C*      ACCRUL - PROCESSING FOR ACCRUALS
     C*      ACCODE - PROCESSING FOR ACCOUNT CODES ON LF/FACKY RECORD
     C*      NARRAT - SETUP NARRATIVE CODE
     C*      POREF1 - PROCESSING FOR POSTING REFERENCE 1
     C*      POREF2 - PROCESSING FOR POSTING REFERENCE 2
     C*      POREF3 - PROCESSING FOR POSTING REFERENCE 3
     C*      FFSETL - STANDARD SUBROUTINE
     C*      SUMACC - ACCRUAL SUMMARY TOTAL
     C*      PSTENT - GENERATE ENTRIES TO PF-MGEFFPD
     C*      PSTSUS - GENERATE SUSPENSE POSTINGS TO PF-MGEFFPD
     C*      PSTINB - GENERATE INTER-BRANCH POSTINGS TO PF-MGEFFPD
     C*      FFSTDP - DETERMINE NUMBER OF DECIMAL PLACES
     C*      ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*      ZFRPED - EDIT AMOUNT FIELDS FOR REPORT OUTPUT
     C*      ZDATE2 - CONVERTS A DAY NUMBER TO DATE FORMAT
     C*      FFPRCS - CONVERTS A PRICE IN FILE FORMAT (11,7P) TO
     C*               SCREEN FORMAT (12A)
     C*      RCFAU  - RECORD SPOOLED FILE AUDIT REPORT BY CALLING RCF     S01117
     C*      END    - ENDS PROGRAM
     C*      SRPNAR - Posting narratives from CGPNARMSG                   S01522
     C*      DBERR  - DATABASE ERROR HANDLING
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   START SUB-ROUTINE - INITIALISES
     C**                       CALLS S/R'S - DBERR, FFFMT
     C*
     C*****************************************************************
     C*
     C           START     BEGSR
     C*
     C                     SETON                     01
     C*
     C************LIKE     DEFN ATYP      ATBACH                          S01117
     C************LIKE     DEFN ATYP      ATBACB                          S01117
     C           *LIKE     DEFN ATYP      XXATDF                          S01117
     C           *LIKE     DEFN ATYP      XXATDT                          S01117
     C           *LIKE     DEFN ATYP      MAATDF                          S01117
     C           *LIKE     DEFN ATYP      MAATDT                          S01117
     C           *LIKE     DEFN ATYP      ATDFAC                          S01117
     C           *LIKE     DEFN ATYP      ATDTAC                          S01117
     C           *LIKE     DEFN ATYP      ATCOMS
     C           *LIKE     DEFN ATYP      FFATYP
     C           *LIKE     DEFN ACSC      XXASDF                          S10736
     C           *LIKE     DEFN ACSC      XXASDT                          S10736
     C           *LIKE     DEFN ACSC      MAASDF                          S10736
     C           *LIKE     DEFN ACSC      MAASDT                          S10736
     C           *LIKE     DEFN ACSC      ASDFAC                          S10736
     C           *LIKE     DEFN ACSC      ASDTAC                          S10736
     C           *LIKE     DEFN ACSC      ASCOMS                          S10736
     C           *LIKE     DEFN ACSC      FFACSC                          S10736
     C           *LIKE     DEFN FFCDP     FFCDP1
     C           *LIKE     DEFN PSTA      POSTAM
     C*
     C           MKBIND    IFEQ 'Y'
     C                     SETON                     10
     C                     END
     C*
     C***********          MOVE *BLANKS   DBLOT                           S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBFILE                          S01117
     C                     MOVE *BLANKS   DBKEY                           S01117
     C                     MOVE *BLANKS   DBPGM                           S01117
     C                     Z-ADD*ZEROS    DBASE                           S01117
     C                     MOVE 'FF0420  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
     C/COPY ZSRSRC,FFSTDPZ3
     C*                                                                   S01117
     C** ACCESS DATAAREA RUNDAT                                           S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**  SETUP MULTIBRANCHING INDICATOR                                  S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     50                   S01117
     C                     END                                            S01117
     C*
     C**  SETUP KEY SUB-FIELDS FOR ICD RECORDS
     C*
     C                     MOVE '01'      ICD1
     C                     MOVE *BLANKS   ICD2
     C***********          MOVE '10'      ICD3                            S01117
     C*
     C****ACCESS*PF/TABTB10***********************************************S01117
     C*** ACCESS SDBANKPD                                                 S01117
     C*
     C***********          READ TABTB10F                 40               S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    @DSFDY                          S01117
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          MOVE '01'      DBASE                           S01117
     C***********          MOVE 'TABFF'   DBFILE           ***DBERR 01*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD1         DBASE                           S01117
     C                     MOVEL'SDBANKPD'DBFILE           ***DBERR 01*** S01117
     C                     MOVEL@OPTN     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*                                                                   S01522
     C* Call module program for module details                            S01522
     C                     CALL 'AOMMODR0'                                S01522
     C                     PARM '*MSG   ' @RTCD                           S01522
     C                     PARM '*FIRST ' @OPTN                           S01522
     C           SDMMOD    PARM SDMMOD    @DSFDY                          S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B1             S01522
     C           *LOCK     IN   LDA                         1             S01522
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * *  S01522
     C                     MOVEL'086'     DBASE            * DBERR 086 *  S01522
     C                     MOVEL@OPTN     DBOPTN           * * * * * * *  S01522
     C                     MOVEL@OPTN     DBKEY             1             S01522
     C                     OUT  LDA                         1             S01522
     C                     EXSR DBERR                       1             S01522
     C                     ELSE                            X1             S01522
     C*                                                                   CPM003
     C           BGPFMG    IFEQ 'Y'                                       CPM003
     C                     CALL 'AOPORTR0'                                CPM003
     C                     PARM *BLANKS   @RTCD                           CPM003
     C                     PARM '*FIRST  '@OPTN                           CPM003
     C           SDPORT    PARM SDPORT    @DSFDY                          CPM003
     C           @RTCD     IFNE *BLANKS                                   CPM003
     C           *LOCK     IN   LDA                                       CPM003
     C                     MOVE *BLANKS   DBKEY            ***************CPM003
     C                     Z-ADD88        DBASE            * DB ERROR 88 *CPM003
     C                     MOVE 'SDPORTPD'DBFILE           ***************CPM003
     C                     OUT  LDA                                       CPM003
     C                     EXSR DBERR                                     CPM003
     C                     END                                            CPM003
     C                     END                                            CPM003
     C*                                                                   CAC003
     C** Access PCA ICD if Analytical Accounting Module is installed      CAC003
     C*                                                                   CAC003
     C           BGN0ST    IFEQ 'Y'                                       CAC003
     C                     CALL 'AOPCACR0'                                CAC003
     C                     PARM *BLANKS   @RTCD                           CAC003
     C                     PARM '*FIRST  '@OPTN                           CAC003
     C           SDPCAC    PARM SDPCAC    @DSFDY                          CAC003
     C*                                                                   CAC003
     C           @RTCD     IFNE *BLANKS                                   CAC003
     C           *LOCK     IN   LDA                                       CAC003
     C                     MOVE *BLANKS   DBKEY            ***************CAC003
     C                     Z-ADD89        DBASE            * DB ERROR 89 *CAC003
     C                     MOVE 'SDPCACPD'DBFILE           ***************CAC003
     C                     OUT  LDA                                       CAC003
     C                     EXSR DBERR                                     CAC003
     C                     ENDIF                                          CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Check if SAR CAC003 is installed                                 CAC003
     C*                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM '       ' @RTCD                           CAC003
     C                     PARM '*VERIFY' @OPTN                           CAC003
     C                     PARM 'CAC003'  @SARD                           CAC003
     C           SCSARD    PARM SCSARD    @DSFDY                          CAC003
     C*                                                                   CAC003
     C           @RTCD     IFEQ *BLANK                                    CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN20                           CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CPM003
     C** Open files required for Portfolio Management                     CPM003
     C*                                                                   CPM003
     C           BGPFMG    IFEQ 'Y'                                       CPM003
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     OPEN CLOST10                                   CPM003
     C                     OPEN PMPORTLL                                  CPM003
     C                     END                                            CPM003
     C*                                                                   CPM003
     C/COPY WNCPYSRC,FF0420C013
     C*                                                                   S01522
     C* Call SAR program for Switchable Feature                           S01522
     C                     MOVE 'N'       FFPNAR  1                       S01522
     C           BGN1ST    IFEQ 'Y'                        B2             S01522
     C*                                                                   S01522
     C                     CALL 'AOSARDR0'                  2             S01522
     C                     PARM '       ' @RTCD             2             S01522
     C                     PARM '*VERIFY' @OPTN             2             S01522
     C                     PARM 'FFPNAR'  @SARD   6         2             S01522
     C           SCSARD    PARM SCSARD    @DSFDY             2            S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B3             S01522
     C           @RTCD     ANDNE'*NRF   '                   3             S01522
     C           *LOCK     IN   LDA                         3             S01522
     C                     MOVEL'SCSARDPD'DBFILE            ************* S01522
     C                     MOVEL'087'     DBASE             *DBERROR 087* S01522
     C                     MOVEL@SARD     DBKEY             ************* S01522
     C                     OUT  LDA                         3             S01522
     C                     EXSR DBERR                       3             S01522
     C                     ENDIF                           E3             S01522
     C*                                                                   S01522
     C           @RTCD     IFEQ *BLANK                     B3             S01522
     C                     MOVE 'Y'       FFPNAR            3             S01522
     C                     ENDIF                           E3             S01522
     C                     ENDIF                           E2             S01522
     C                     ENDIF                           E1             S01522
     C*
     C**   COMPARE DATE FORMAT REQUIRED
     C*
     C           DATF      COMP 'M'                      98
     C*
     C****SETUP*KEY*FOR*PF-TABTB11****************************************S01117
     C***********                                                         S01117
     C***********          MOVE '11'      ICD3                            S01117
     C*
     C****ACCESS*PF/TABTB11***********************************************S01117
     C**  ACCESS SDGELRPD                                                 S01117
     C*
     C***********ICDKY     CHAINTABTB11F             40                   S01117
     C**********           CALL 'AOGELRR0'                                S01117              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD                           S01117
     C                     PARM '*FIRST ' @OPTN                           S01117
     C********** SDGELR    PARM SDGELR    @DSFDY                          S01117              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          MOVE '02'      DBASE                           S01117
     C***********          MOVE 'TABFF'   DBFILE           ***DBERR 02*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD2         DBASE                           S01117
     C                     MOVEL'SDGELRPD'DBFILE           ***DBERR 02*** S01117
     C                     MOVEL@OPTN     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*                                                                   S01117
     C**  IF MULTIBRANCHING AND INTER-BRANCH ENTERIES BY MAIN BRANCH      S01117
     C**  GET ACCOUNT CODES AND ACCOUNT TYPES OF MAIN BRANCH              S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C           IEMB      ANDEQ'Y'                                       S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM MABR      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C**   IF - NOT A VALID RECORD                                        S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD22        DBASE                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***DBERR 22*** S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *LIKE     DEFN XXBICN    MABICN                          S01117
     C           *LIKE     DEFN XXDFAC    MADFAC                          S01117
     C           *LIKE     DEFN XXDTAC    MADTAC                          S01117
     C                     MOVE XXBICN    MABICN                          S01117
     C                     MOVE XXDFAC    MADFAC                          S01117
     C                     MOVE XXDTAC    MADTAC                          S01117
     C*                                                                   S01117
     C**   ACCESS SDACODPD - USING DUE FROM ACCOUNT CODE                  S01117
     C*                                                                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM MADFAC    @AFNB   4                                    S01117 CGL029
     C                     PARM MADFAC    @AFNB  10                                           CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*                                                                   S01117
     C**   IF - NOT A VALID RECORD                                        S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD23        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 23*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*****SAVE*ACCOUNT*TYPE******                                  S01117S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*                                                                   S01117
     C                     MOVE ATYP      MAATDF                          S01117
     C                     MOVE ACSC      MAASDF                          S10736
     C*                                                                   S01117
     C*                                                                   S01117
     C**   ACCESS SDACODPD - USING DUE TO ACCOUNT CODE                    S01117
     C*                                                                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM MADTAC    @AFNB   4                                    S01117 CGL029
     C                     PARM MADTAC    @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*                                                                   S01117
     C**  IF - NOT A VALID RECORD                                         S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD24        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 24*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*****SAVE*ACCOUNT*TYPE******                                  S01117S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*                                                                   S01117
     C                     MOVE ATYP      MAATDT                          S01117
     C                     MOVE ACSC      MAASDT                          S10736
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C**  SETUP KEY FOR PF-TABTB20
     C*
     C                     MOVE '20'      ICD3
     C*
     C**  ACCESS PF/TABTB20
     C*
     C           ICDKY     CHAINTABTB20F             40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '03'      DBASE                           S01117
     C                     Z-ADD3         DBASE                           S01117
     C                     MOVE 'TABFF'   DBFILE           ***DBERR 03***
     C                     MOVELICDKY     DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**  SETUP KEY FOR PF-TABTB40
     C*
     C                     MOVE '40'      ICD3
     C*
     C**  ACCESS PF/TABTB40
     C*
     C           ICDKY     CHAINTABTB40F             40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '04'      DBASE                           S01117
     C                     Z-ADD4         DBASE                           S01117
     C                     MOVE 'TABFF'   DBFILE           ***DBERR 04***
     C                     MOVELICDKY     DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**  SETUP KEY FOR PF-TABTB80
     C*
     C                     MOVE '80'      ICD3
     C*
     C**  ACCESS PF/TABTB80
     C*
     C           ICDKY     CHAINTABTB80F             40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '05'      DBASE                           S01117
     C                     Z-ADD5         DBASE                           S01117
     C                     MOVE 'TABFF'   DBFILE           ***DBERR 05***
     C                     MOVELICDKY     DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**   REPORT TITLES
     C*
     C           *IN10     IFEQ '1'
     C*
     C**   IF - MARKET PARAMETER BLANK
     C*
     C           MARKET    IFEQ *BLANKS
     C*
     C**   MOVE 'OVER THE COUNTER' TO MARKET NAME
     C*
     C                     MOVELMESS,1    FFNAM
     C                     MOVE RUNA      FFDAT
     C*
     C**   ELSE - FIND MARKET NAME
     C*
     C                     ELSE
     C*
     C**   ACCESS LF/MKCTL
     C*
     C           MARKET    CHAINMKCTL                40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '06'      DBASE                           S01117
     C                     Z-ADD6         DBASE                           S01117
     C                     MOVE 'MKCTL'   DBFILE           ***DBERR 06***
     C                     MOVELMARKET    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**   ACCESS LF/MARKT
     C*
     C           MARKET    CHAINMARKT                40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '07'      DBASE                           S01117
     C                     Z-ADD7         DBASE                           S01117
     C                     MOVE 'MARKT'   DBFILE           ***DBERR 07***
     C                     MOVELMARKET    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**   CONVERT BUSINESS DAY NUMBER TO DATE
     C*
     C                     MOVE BUSD      ZDAYNO
     C*
     C**   ZDATE2 - CONVERTS A DAY NUMBER TO DATE FORMAT
     C*
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    FFDAT
     C                     MOVELMKTN      FFNAM
     C*
     C**   END IF/ELSE - PARAMETER BLANK
     C*
     C                     END
     C*
     C** FORMAT REPORTING MARKET
     C*
     C                     EXSR FFFMT
     C                     MOVE FFTXT     RPMKT
     C*
     C**  Set up underlining for heading
     C**  Initialise array index
     C                     Z-ADD0         Y       20
     C*
     C**  FFULIN returned from SR. FFFMT contains number of characters
     C**  for underline
     C           Y         DOUEQFFULIN
     C                     ADD  1         Y
     C                     MOVEA'-'       FULA,Y
     C                     END
     C*
     C**  Move underline array to output field
     C                     MOVEAFULA      FULINE
     C*
     C                     END
     C*
     C*****IF*-*ACCRUAL*INDICATOR*=*'Y'***********************************S01117
     C***********                                                         S01117
     C***********AKSI      IFEQ 'Y'                                       S01117
     C***********                                                         S01117
     C*****WRITE*ACCRUAL*SUMMARY*REPORT*HEADINGS**************************S01117
     C***********                                                         S01117
     C***********          OPEN FF0420P2                                  S01117
     C***********          WRITEACCSUMH                                   S01117
     C***********                                                         S01117
     C*****END*IF*-*ACCRUAL*IND*=*'Y'*************************************S01117
     C***********                                                         S01117
     C***********          END                                            S01117
     C*
     C**  SETUP KEY FOR PF-TABTE10 RECORD
     C*
     C                     MOVE *BLANKS   ICDKY
     C                     MOVE '30'      ICD1
     C                     MOVE '1'       ICDKY
     C                     MOVE COMS      ICD4
     C                     MOVELCOMS      @AFNB                                               CGL029
     C*
     C**   ACCESS PF-TABTE10
     C*
     C********** ICDKY     CHAINTABTE10F             40                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                                               CGL029
     C                     PARM '*KEY   ' @OPTN                                               CGL029
     C                     PARM           @AFNB                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C********** *IN40     IFEQ '1'                                                           CGL029
     C********** RECI      ORNE 'D'                                                           CGL029
     C*
     C********** *LOCK     IN   LDA                                                    S01117 CGL029
     C***********          MOVE '08'      DBASE                           S01117
     C**********           Z-ADD8         DBASE                                        S01117 CGL029
     C**********           MOVE 'TABLE'   DBFILE           ***DBERR 08***                     CGL029
     C**********           MOVELICDKY     DBKEY                                               CGL029
     C           @RTCD     IFNE *BLANK                                                        CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     Z-ADD8         DBASE                                               CGL029
     C                     MOVEL'SDACODPD'DBFILE                                              CGL029
     C                     MOVEL@AFNB     DBKEY                                               CGL029
     C                     MOVEL@OPTN     DBOPTN                                              CGL029
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****SAVE*ACCOUNT*TYPE******                                        S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*
     C                     MOVE ATYP      ATCOMS
     C***                  MOVE ACSC      ASCOMS                S10736    099326
     C                     MOVE ACCS      ASCOMS                          099326
     C*
     C**   ACCESS HEADER RECORD
     C*
     C           1         CHAINMGEFFHH              40
     C*
     C**   IF FOUND - UPDATE HEADER RECORD
     C*
     C           *IN40     IFEQ '0'
     C                     MOVE 'H'       RECI
     C                     Z-ADD99999     FLSZ
     C                     UPDATAPOSTHHF
     C*
     C**   ELSE INCREMENT COUNT OF INSERTED RECORDS AND ..
     C*
     C                     ELSE
     C                     MOVE 'H'       RECI
     C                     Z-ADD99999     FLSZ
     C                     ADD  1         PONUM
     C*
     C**   WRITE PF-MGEFFHH HEADER RECORD
     C*
     C                     WRITEAPOSTHHF
     C                     END
     C*                                                                   S10736
     C**   SET UP POSTING TIME CONSTANT                                   S10736
     C*                                                                   S10736
     C                     Z-ADD235959    PTIM                            S10736
     C*
     C*****WRITE*MISSING*ACCOUNT*KEYS*REPORT*HEADING**********************S01117
     C***********                                                         S01117
     C***********          WRITEMAKYH                                     S01117
     C*
      *                                                                   CGL007
      **  Determine if feature CGL007 is installed.                       CGL007
      *                                                                   CGL007
     C                     MOVE 'N'       CGL007  1                       CGL007
     C                     CALL 'AOSARDR0'                                CGL007
     C                     PARM '       ' PRTCD   7                       CGL007
     C                     PARM '*KEY   ' POPTN   7                       CGL007
     C                     PARM 'CGL007'  PSARD   6                       CGL007
     C           SCSARD    PARM SCSARD    @DSFDY                          CGL007
      *                                                                   CGL007
     C           PRTCD     IFEQ *BLANKS                                   CGL007
     C                     MOVE 'Y'       CGL007                          CGL007
      *                                                                   CGL007
     C                     ELSE                                           CGL007
      *                                                                   CGL007
      ** Else, database error (return code other than *NRF)               CGL007
      *                                                                   CGL007
     C           PRTCD     IFNE '*NRF   '                                 CGL007
     C           *LOCK     IN   LDA                                       CGL007
     C                     Z-ADD29        DBASE            ************   CGL007
     C                     MOVEL'SDSARDPD'DBFILE           * DBERR 29 *   CGL007
     C                     MOVEL@AFNB     DBKEY            ************   CGL007
     C                     MOVELPOPTN     DBOPTN                          CGL007
     C                     OUT  LDA                                       CGL007
     C                     EXSR DBERR                                     CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C                     ENDIF                                          CGL007
     C/COPY WNCPYSRC,FF0420C005
      *                                                                   CFF007
      ** Check if switchable feature CFF007 is installed                  CFF007
      *                                                                   CFF007
     C                     CALL 'AOSARDR0'                                CFF007
     C                     PARM *BLANKS   @RTCD                           CFF007
     C                     PARM '*VERIFY' @OPTN                           CFF007
     C                     PARM 'CFF007'  @SARD   6                       CFF007
     C           SCSARD    PARM SCSARD    @DSSDY                          CFF007
     C*                                                                   CFF007
     C           @RTCD     IFNE *BLANKS                                   CFF007
     C           @RTCD     ANDNE'*NRF   '                                 CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD14        DBASE              *************CFF007
     C                     MOVE 'SCSARDPD'DBFILE             * DBERR 014 *CFF007
     C                     MOVEL@SARD     DBKEY              *************CFF007
     C                     MOVEL@OPTN     DBOPTN                          CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ELSE                                           CFF007
     C*                                                                   CFF007
     C           @RTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'Y'       CFF007  1                       CFF007
     C                     ELSE                                           CFF007
     C                     MOVE 'N'       CFF007                          CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    @DSFDY                                              CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD30        DBASE                                               CGL020
     C                     MOVEL@SARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR DBERR                                                         CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C           @RTCD     IFEQ *BLANK                                                        CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
     C*                                                                   CFF007
     C**   END SUB-ROUTINE - START
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   BRANCH SUB-ROUTINE - PROCESSING FOR CHANGE IN BRANCH
     C**                       CALLED BY MAIN PROCESSING
     C**                       CALLS S/R'S - DBERR.
     C*
     C*****************************************************************
     C*
     C           BRANCH    BEGSR
     C*
     C*****SETUP*KEY*TO*BRANCH*FILE***************************************S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   ICDKY                           S01117
     C***********          MOVE '10'      ICD1                            S01117
     C***********          MOVE FFBRCD    ICDKY                           S01117
     C*
     C*****ACCESS*PF-TABLETR**********************************************S01117
     C**   ACCESS SDBRCHPD                                                S01117
     C*
     C***********ICDKY     CHAINTABLETRF             40                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM FFBRCA    @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**   IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          MOVE '09'      DBASE                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***DBERR 09*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD9         DBASE                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***DBERR 09*** S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****USE*RENAMED*FIELDS*OFF*PF-TABLETR******************************S01117
     C**   USE RENAMED FIELDS OFF SDBRCHPD                                S01117
     C*
     C           *LIKE     DEFN XXBICN    BICN
     C************LIKE     DEFN XXNSCS    NSACS                           S01117
     C************LIKE     DEFN XXBACB    NBACB                           S01117
     C************LIKE     DEFN XXBACH    NBACH                           S01117
     C           *LIKE     DEFN XXDFAC    DFAC                            S01117
     C           *LIKE     DEFN XXDTAC    DTAC                            S01117
     C***********          Z-ADDXXBICN    BICN                            S01117
     C***********          Z-ADDXXNSCS    NSACS                           S01117
     C***********          Z-ADDXXBACB    NBACB                           S01117
     C***********          Z-ADDXXBACH    NBACH                           S01117
     C                     MOVE XXBICN    BICN                            S01117
     C                     MOVE XXDFAC    DFAC                            S01117
     C                     MOVE XXDTAC    DTAC                            S01117
     C*
     C**   IF - MULTIBRANCHING PRESENT
     C*
     C           MBIN      IFEQ 'Y'
     C*                                                                   S01117
     C**   SETUP BRANCH NAME FOR REPORT                                   S01117
     C*                                                                   S01117
     C                     MOVE BRNM      FFBRNM                          S01117
     C*
     C*****SETUP*KEY*TO*PF-TABTE10*-*USING*BRANCH*ACCOUNT*CODE************S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   ICDKY                           S01117
     C***********          MOVE '30'      ICD1                            S01117
     C***********          MOVE NBACB     ICD4                            S01117
     C***********          MOVE '1'       ICDKY                           S01117
     C*
     C*****ACCESS*PF-TABTE10**********************************************S01117
     C**   ACCESS SDACODPD - USING DUE FROM ACCOUNT CODE                  S01117
     C*
     C***********ICDKY     CHAINTABTE10F             40                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM DFAC      @AFNB   4                                    S01117 CGL029
     C                     PARM DFAC      @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C**   IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          MOVE '10'      DBASE                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***DBERR 10*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD10        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 10*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****SAVE*ACCOUNT*TYPE******                                        S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*
     C***********          MOVE ATYP      ATBACB                          S01117
     C                     MOVE ATYP      ATDFAC                          S01117
     C                     MOVE ACSC      ASDFAC                          S10736
     C*
     C*****SETUP*KEY*TO*PF-TABTE10*-*USING*HEAD*OFFICE*ACCOUNT*CODE*******S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   ICDKY                           S01117
     C***********          MOVE '30'      ICD1                            S01117
     C***********          MOVE NBACH     ICD4                            S01117
     C***********          MOVE '1'       ICDKY                           S01117
     C*
     C*****ACCESS*PF-TABTE10**********************************************S01117
     C**   ACCESS SDACODPD - USING DUE TO ACCOUNT CODE                    S01117
     C*
     C***********ICDKY     CHAINTABTE10F             40                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM DTAC      @AFNB   4                                    S01117 CGL029
     C                     PARM DTAC      @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          MOVE '11'      DBASE                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***DBERR 11*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD11        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 11*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****SAVE*ACCOUNT*TYPE******                                        S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*
     C***********          MOVE ATYP      ATBACH                          S01117
     C                     MOVE ATYP      ATDTAC                          S01117
     C                     MOVE ACSC      ASDTAC                          S10736
     C*
     C**   END IF - MULTIBRANCHING
     C*
     C                     END
     C*                                                                   S01117
     C**   AT CHANGE OF BOOKING BRANCH EXECUTE PRINT                      S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVELFFBRCA    WRK3A   3                       S01117
     C                     ELSE                                           S01117
     C                     MOVEL*BLANKS   WRK3A                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     SETON                     51                   S01117
     C                     OPEN FF0420P1                                  S01117
     C                     Z-ADD0         PAGE3                           S01117
     C                     Z-ADD0         LINE1                           S01117
     C*                                                                   S01117
     C**   ENSURE REPORT SPOOL FILE P1 RECORDED BY RCF                    S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM1    ZSNUM1  60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM WRK3A     SENTY   3                       S01117
     C                     PARM           SFILE1                          S01117
     C                     PARM           ZSNUM1                          S01117
     C                     PARM           ZSERR   1                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   IF - ACCRUAL INDICATOR = 'Y', OPEN ACCRUAL SUMMARY REPORT      S01117
     C*                                                                   S01117
     C           AKSI      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C                     SETON                     52                   S01117
     C                     OPEN FF0420P2                                  S01117
     C                     Z-ADD0         PAGE2                           S01117
     C                     Z-ADD0         LINE2                           S01117
     C*                                                                   S01117
     C**   ENSURE REPORT SPOOL FILE P2 RECORDED BY RCF                    S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM2    ZSNUM2  60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM WRK3A     SENTY   3                       S01117
     C                     PARM           SFILE2                          S01117
     C                     PARM           ZSNUM2                          S01117
     C                     PARM           ZSERR   1                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C**   END SUB-ROUTINE - BRANCH
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C**     BRCHT SUB-ROUTINE - PROCESSING FOR CHANGE IN BRANCH          S01117
     C**                         CALLED BY MAIN PROCESSING                S01117
     C**                         CALLS S/R'S -                            S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           BRCHT     BEGSR                                          S01117
     C*                                                                   S01117
     C           *IN51     IFEQ '1'                                       S01117
     C           *IN53     IFEQ '1'                                       S01117
     C           LINE1     IFGT 56                                        086015
     C                     WRITEMAKYH                                     086015
     C                     END                                            086015
     C                     WRITEENDREP                                    S01117
     C                     END                                            S01117
     C                     CLOSEFF0420P1                                  S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN52     IFEQ '1'                                       S01117
     C           *IN54     IFEQ '1'                                       S01117
     C           LINE1     IFGT 56                                        086015
     C                     WRITEACCSUMH                                   086015
     C                     END                                            086015
     C                     WRITEASENDR                                    S01117
     C                     END                                            S01117
     C                     CLOSEFF0420P2                                  S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     SETOF                     5152                 S01117
     C                     SETOF                     5354                 S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT
     C*****************************************************************
     C*
     C**   CURRCD SUB-ROUTINE - PROCESSING FOR CHANGE IN BRANCH/CURRENCY
     C**                      CALLED BY MAIN PROCESSING
     C**                      CALLS S/R'S - FFSTDP
     C*
     C*****************************************************************
     C*
     C           CURRCD    BEGSR
     C*
     C**   FFSTDP - DETERMINE NUMBER OF DECIMAL PLACES
     C*
     C                     EXSR FFSTDP
     C*
     C**   IF - CURRENCY NOT VALID
     C*
     C           *IN89     IFEQ '1'                        ***DBERR 13***
     C*
     C**      SET UP DATABASE ERROR
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '12'      DBASE                           S01117
     C                     Z-ADD12        DBASE                           S01117
     C                     MOVE 'TABLE'   DBFILE           ***DBERR 12***
     C                     MOVELFFCCY     DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C                     Z-ADDFFCDP     FFCDP1
     C*
     C**   END SUB-ROUTINE - CURRYD
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   CURRCT SUB-ROUTINE - PROCESSING AT END OF BRANCH/CURRENCY
     C**                      CALLED BY MAIN PROCESSING
     C**                      CALLS S/R'S - PSTSUS
     C*
     C*****************************************************************
     C*
     C           CURRCT    BEGSR
     C*
     C**   IF - CREDIT/DEBIT TOTALS DO NOT MATCH
     C*
     C           CDTTOT    IFNE DBTTOT
     C*
     C**   SET UP NARRATIVE FOR POSTING
     C**   ( TRADING IMBALANCE XXX XXX )
     C*
     C                     MOVE *BLANKS   PNAR
     C                     MOVELMESS,2    PNAR
     C***********          MOVE FFBRCD    NAR8                            S01117
     C                     MOVE FFBRCA    NAR8                            S01117
     C                     MOVE FFCCY     NAR9
     C*                                                                   S01522
     C                     MOVE *BLANKS   ##CUST                          S01522
     C                     MOVE *BLANKS   ##CYCD                          S01522
     C                     MOVE *BLANKS   ##ACCD                          S01522
     C                     MOVE *BLANKS   ##ACSQ                          S01522
     C                     MOVE *BLANKS   ##BRCA                          S01522
     C                     MOVE *BLANKS   ##TRNO                          S01522
     C                     MOVE *BLANKS   ##RACN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C                     MOVE *BLANKS   ##FFIC                          S01522
     C                     MOVE *BLANKS   ##FFMK                          S01522
     C                     MOVE *BLANKS   ##FFPD                          S01522
     C                     MOVE *BLANKS   ##FFPC                          S01522
     C                     MOVE *BLANKS   ##FFSP                          S01522
     C*                                                                   S01522
     C                     MOVE 'GB00010' ##MGID                          S01522
     C                     MOVE BICN      ##CUST                          S01522
     C                     MOVE FFCCY     ##CYCD                          S01522
     C                     MOVE COMS      ##ACCD                          S01522
     C                     MOVE '01'      ##ACSQ                          S01522
     C                     MOVE FFBRCA    ##BRCA                          S01522
     C*                                                                   S01117
     C**   SET UP PROFIT CENTER FOR POSTING                               S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   PRFC                            S01117
     C                     MOVE *BLANKS   FFPRFC                          CAC003
     C*
     C**   CALCULATE IMBALANCE
     C*
     C           CDTTOT    SUB  DBTTOT    PSTA
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C*
     C** OUTPUT A POSTING TO SUSPENSE
     C*
     C                     EXSR PSTSUS
     C*
     C**   IF - EOC RUNNING FOR MARKET
     C*
     C           MKCI      IFEQ 'E'
     C*
     C**   MOVE POST=OUT=OF=BALANCE IND
     C*
     C                     SETON                     U5
     C                     MOVE POBI      POBIND
     C*
     C**   END IF - EOC RUNNING
     C*
     C                     END
     C*
     C**   END IF - CREDIT/DEBIT TOTALS DO NOT MATCH
     C*
     C                     END
     C*
     C**   CLEAR CREDIT/DEBIT TOTALS
     C*
     C                     Z-ADD*ZEROS    CDTTOT
     C                     Z-ADD*ZEROS    DBTTOT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   ACCKYD SUB-ROUTINE - PROCESSING FOR CHANGE IN BRANCH/CURRENCY
     C**                        /ACCOUNT KEY
     C**                       CALLED BY MAIN PROCESSING
     C**                       CALLS S/R'S -
     C*
     C*****************************************************************
     C*
     C           ACCKYD    BEGSR
     C*
     C**   ACCESS LF/FACKY
     C*
     C           FFKY      CHAINFACKY                40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C**   OUTPUT MISSING ACCOUNT KEY DETAILS
     C*
     C                     SETON                     13U4
     C                     MOVE AKMI      AKMIND
     C*
     C                     ELSE
     C                     SETOF                     13
     C                     END
     C*
     C**   IF - CURRENT LF/FOKEY RECORD AN ACCRUAL
     C*
     C           FFKY3     IFEQ 'A'
     C           FFKY14    ANDEQ'L'
     C*
     C           FFKY3     OREQ 'A'
     C           FFKY14    ANDEQ'P'
     C*
     C                     MOVE 'Y'       ACRIND  1
     C*
     C**   ELSE - CURRENT LF/FOKEY RECORD NOT AN ACCRUAL
     C*
     C                     ELSE
     C*
     C                     MOVE 'N'       ACRIND
     C*
     C**   END IF/ELSE - CURRENT LF/FOKEY RECORD AN ACCRUAL
     C*
     C                     END
     C*
     C**   IF - ACCRUAL SUMMARY
     C*
     C           AKSI      IFEQ 'Y'
     C*
     C                     Z-ADD*ZEROS    ACCSUM 150
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - ACCKYD
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   ACCKYT SUB-ROUTINE - PROCESSING AT END OF BRANCH/CURRENCY/
     C**                        ACCOUNT KEY
     C**                       CALLED FROM MAIN PROCESSING
     C**                       CALLS S/R'S - SUMACC.
     C*
     C*****************************************************************
     C*
     C           ACCKYT    BEGSR
     C*
     C**   IF - ACCRUAL SUMMARY IS REQUIRED AND
     C**        PREVIOUS LF/FOKEY RECORD IS FOR ACCRUALS
     C*
     C           AKSI      IFEQ 'Y'
     C           ACRIND    ANDEQ'Y'
     C*
     C**   SUMACC - ACCRUAL SUMMARY TOTAL
     C*
     C                     EXSR SUMACC
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - ACCKYT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              S71062
     C*****************************************************************   S71062
     C*                                                                   S71062
     C**   EVNTYP SUB-ROUTINE - PROCESSING TO TEST EVENT TYPE             S71062
     C**                       CALLED BY MAIN PROCESSING                  S71062
     C*                                                                   S71062
     C*****************************************************************   S71062
     C*                                                                   S71062
     C           EVNTYP    BEGSR                                          S71062
     C*                                                                   S71062
     C           FFKY3     IFEQ 'J'                        - B1           S71062
     C           FFKY3     OREQ 'U'                                       S71062
     C*                                                                   S71062
     C** ACCESS FILE LF/SDPLCSL0                                          S71062
     C*                                                                   S71062
     C***********          MOVE FFCBCD    WCBCD   6                S71062 CPM003
     C***********WCBCD     CHAINSDPLCSL0             40            S71062 CPM003
     C                     MOVELFFCBCD    WWCLIN 10                       CPM003
     C                     CALL 'AOPLCSR0'                                CPM003
     C                     PARM *BLANKS   WWRTCD  7                       CPM003
     C                     PARM '*KEY   ' WWOPTN  7                       CPM003
     C                     PARM WWCLIN    WWKY10 10                       CPM003
     C           SDPLCS    PARM SDPLCS    @DSSDY                          CPM003
     C*                                                                   S71062
     C                     CALL 'AOCUSTR1'                                CPB001
     C                     PARM *BLANKS   W2RTCD  7                       CPB001
     C                     PARM '*KEY   ' WWOPTN  7                       CPB001
     C                     PARM WWCLIN    WWKY10 10                       CPB001
     C                     PARM           WWKY7   7                       CPB001
     C           SDCUST    PARM SDCUST    @DSLDY                          CPB001
     C*                                                                   CPB001
     C           WWRTCD    IFEQ *BLANKS                    - B2           CPM003
     C           QBTYLC    ANDNE'D'                                       S71062
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           BBPRBA    ANDEQ'Y'                                       CPB001
     C           W2RTCD    ANDEQ*BLANKS                                   CPB001
     C*                                                                   S71062
     C           FFPTFR    IFNE '9997'                     - B3           S71062
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           PMKEY     CHAINPMPORTLL             40                   S71062
     C           *IN40     IFEQ '1'                        - B4           S71062
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD28        DBASE                           S71062
     C                     MOVE 'PMPORTLL'DBFILE           ***DBERR 28*** S71062
     C                     MOVELWPMKEY    DBKEY                           S71062
     C                     OUT  LDA                                       CPM003
     C                     EXSR DBERR                                     S71062
     C                     ENDIF                           - E4           S71062
     C                     MOVE PNACSQ    FFACSQ                          S71062
     C                     ENDIF                           - E3           S71062
     C*                                                                   S71062
     C                     ENDIF                           - E2           S71062
     C*                                                                   S71062
     C                     ENDIF                           - E1           S71062
     C*                                                                   S71062
     C                     ENDSR                                          S71062
     C*                                                                   S71062
     C/EJECT
     C*****************************************************************
     C*
     C**   ACCRUL SUB-ROUTINE - PROCESSING FOR ACCRUAL SUMMARY AND
     C**                        CURRENT RECORD AN ACCRUAL
     C**                       CALLED BY MAIN PROCESSING
     C**                       CALLS S/R'S - ACCODE.
     C*
     C*****************************************************************
     C*
     C           ACCRUL    BEGSR
     C*
     C**   IF - ACCRUAL PROCESSING IS NOT BEING RUN
     C**        OR ACCOUNT KEY BEING PROCESSED IS NOT AN ACCRUAL
     C*
     C           AKSI      IFNE 'Y'
     C           ACRIND    ORNE 'Y'
     C*
     C**   IF ACCOUNT KEY IS NOT MISSING
     C*
     C           *IN13     IFEQ '0'
     C*
     C**   ACCODE - PROCESSING FOR ACCOUNT CODES ON LF/FACKY RECORD
     C**            ( GENERATION OF ENTRIES FOR LF/FOKEY RECORD )
     C*
     C                     EXSR ACCODE
     C                     END
     C*
     C**   ELSE - ACCRUAL PROCESSING IS BEING RUN
     C**          AND ACCOUNT KEY BEING PROCESSED IS AN ACCRUAL
     C*
     C                     ELSE
     C*
     C**   IF - RECORD IS A REVERSAL
     C*
     C           REVI      IFEQ 1
     C                     SUB  EAMT      ACCSUM
     C                     SETON                     11
     C                     ELSE
     C                     ADD  EAMT      ACCSUM
     C                     SETOF                     11
     C                     END
     C*
     C**   SET CREDIT/DEBIT INDICATOR
     C*
     C           EAMT      IFLT 0
     C                     MOVE 'CR'      CDTDBT
     C                     ELSE
     C                     MOVE *BLANKS   CDTDBT
     C                     END
     C*
     C**   OUTPUT ACCRUAL=SUM=DETAIL
     C*
     C           *IN52     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           LINE2     IFGT 55
     C           LINE2     ORLT 1                                         S01117
     C*
     C                     WRITEACCSUMH
     C*
     C                     END
     C*
     C                     WRITEACRSUM
     C***********          SETON                     14                   S01117
     C                     SETON                     1454                 S01117
     C                     END                                            S01117
     C*
     C**   END IF - NOT ACCRUAL
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - ACCRUL
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   ACCODE SUB-ROUTINE - PROCESSING ACCOUNTS
     C**          CALLED BY   - ACCRUL.
     C**          CALLS S/R'S - NARRAT, DBERR, POREF1, POREF2, POREF3
     C*
     C*****************************************************************
     C*
     C           ACCODE    BEGSR
     C*
     C                     Z-ADD1         N       20
     C*
     C**   DO WHILE - POSTING DETAILS EXIST ON LF/FACKY
     C*
     C           N         DOWLT7
     C*
     C**   PROCESS ACCOUNT CODE/POSTING REFERENCE IF NOT ZERO
     C*
     C           ACARY,N   IFNE *ZEROS
     C           POARY,N   ORNE *ZEROS
     C*
     C**   PROCESS ACCOUNT CODE IF DEFINED
     C*
     C           ACARY,N   IFNE *ZEROS
     C*
     C**   SETUP KEY TO PF-TABTE10 - USING ACCOUNT CODE OFF LF/FACKY
     C*
     C                     MOVE *BLANKS   ICDKY
     C                     MOVE '30'      ICD1
     C                     MOVE ACARY,N   ICD4
     C                     MOVE '1'       ICDKY
     C                     MOVELACARY,N   @AFNB                                               CGL029
     C*
     C**   ACCESS PF-TABTE10
     C*
     C********** ICDKY     CHAINTABTE10F             40                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                                               CGL029
     C                     PARM '*KEY   ' @OPTN                                               CGL029
     C                     PARM           @AFNB                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C********** *IN40     IFEQ '1'                                                           CGL029
     C********** RECI      ORNE 'D'                                                           CGL029
     C********** *LOCK     IN   LDA                                                    S01117 CGL029
     C***********          MOVE '13'      DBASE                           S01117
     C**********           Z-ADD13        DBASE                                        S01117 CGL029
     C**********           MOVE 'TABLE'   DBFILE           ***DBERR 13***                     CGL029
     C**********           MOVELICDKY     DBKEY                                               CGL029
     C           @RTCD     IFNE *BLANK                                                        CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     Z-ADD13        DBASE                                               CGL029
     C                     MOVEL'SDACODPD'DBFILE                                              CGL029
     C                     MOVEL@AFNB     DBKEY                                               CGL029
     C                     MOVEL@OPTN     DBOPTN                                              CGL029
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****SAVE*ACCOUNT*TYPE******                                        S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*
     C                     MOVE ATYP      FFATYP
     C***                  MOVE ACSC      FFACSC                S10736    099326
     C                     MOVE ACCS      FFACSC                          099326
     C*
     C                     END
     C*
     C**   SET THE POSTING AMOUNT TO GO OUT TO PF-MGEFFPD
     C*
     C                     Z-ADDEAMT      PSTA
     C*
     C**   DETERMINE SIGN OF POSTING AMOUNT
     C**   (NOTE:ALL EVENT AMOUNTS SHOULD BE POSITIVE)
     C*
     C           N         IFLE 3
     C*
     C**   THE FIRST 3 ACCOUNT CODES/NARRATIVE/POSTING REFERENCES
     C**   ARE FOR DEBIT POSTINGS.IF KEY IS A REVERSAL THEN CREDIT
     C*
     C           REVI      IFEQ 0
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C*
     C                     ELSE
     C*
     C**   THE LAST 3 ACCOUNT CODES/NARRATIVE/POSTING REFERENCES
     C**   ARE FOR CREDIT POSTINGS.IF KEY IS A REVERSAL THEN DEBIT
     C*
     C           REVI      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C*
     C                     END
     C*
     C**   NARRAT - SETUP NARRATIVE CODE
     C*
     C                     EXSR NARRAT
     C*
     C**   IF - POSTING REFERENCE IS '1'
     C*
     C           POARY,N   IFEQ 1
     C*
     C**   POREF1 - PROCESSING FOR POSTING REFERENCE 1
     C*
     C                     EXSR POREF1
     C*
     C                     END
     C*
     C**   IF - POSTING REFERENCE IS '2'
     C*
     C           POARY,N   IFEQ 2
     C*
     C**   POREF2 - PROCESSING FOR POSTING REFERENCE 2
     C*
     C                     EXSR POREF2
     C*
     C                     END
     C*
     C**   IF - POSTING REFERENCE IS '3'
     C*
     C           POARY,N   IFEQ 3
     C*
     C**   POREF3 - PROCESSING FOR POSTING REFERENCE 3
     C*
     C                     EXSR POREF3
     C*
     C                     END
     C*
     C**   END IF -PROCESS ACCOUNT CODE/POSTING REFERENCE IF NOT ZERO
     C*
     C                     END
     C*
     C                     ADD  1         N
     C*
     C**   END DO WHILE - POSTING DETAILS EXIST ON LF/FACKY
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - ACCODE
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   SUMACC SUB-ROUTINE - ACCRUAL SUMMARY TOTAL OUTPUT
     C**          CALLED BY   - ACCKYT.
     C**          CALLS S/R'S - ZFRPED, DBERR, POREF1
     C*
     C*****************************************************************
     C*
     C           SUMACC    BEGSR
     C*
     C**   EDIT FIELDS FOR OUTPUT TO REPORT
     C*
     C           ACCSUM    IFLT 0
     C                     MOVE 'CR'      CDTDBT
     C                     Z-SUBACCSUM    ZFLD15
     C                     ELSE
     C                     MOVE *BLANKS   CDTDBT
     C                     Z-ADDACCSUM    ZFLD15
     C                     END
     C*
     C                     Z-ADDFFCDP1    ZDECS
     C*
     C**   ZFRPED - EDIT AMOUNT FIELDS FOR REPORT OUTPUT
     C*
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    RACSUM
     C*
     C                     WRITEACSUMF
     C*
     C                     Z-ADD1         N       20
     C*
     C**   PROCESS IF THE ACCOUNT KEY WAS FOUND AND THE AMOUNT IS NON 0
     C*
     C           *IN13     IFEQ '0'
     C           ACCSUM    ANDNE0
     C*
     C**   DO WHILE - POSTING DETAILS EXIST ON LF/FACKY
     C*
     C           N         DOWLT7
     C*
     C**   PROCESS ACCOUNT CODE/POSTING REFERENCE IF NOT ZERO
     C*
     C           ACARY,N   IFNE *ZEROS
     C           POARY,N   ORNE *ZEROS
     C*
     C**   DATABASE ERROR IF POSTING REFERENCE IS NOT 1
     C*
     C           POARY,N   IFNE 1
     C                     MOVEL'POST REF'TEMP10 10
     C                     MOVE POARY,N   TEMP10
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVELTEMP10    DBKEY
     C***********          MOVE '14'      DBASE                           S01117
     C                     Z-ADD14        DBASE                           S01117
     C                     MOVE 'FACKY'   DBFILE           ***DBERR 14***
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**   SETUP KEY TO PF-TABTE10 - USING ACCOUNT CODE OFF LF/FACKY
     C*
     C                     MOVE *BLANKS   ICDKY
     C                     MOVE '30'      ICD1
     C                     MOVE ACARY,N   ICD4
     C                     MOVE '1'       ICDKY
     C                     MOVELACARY,N   @AFNB                                               CGL029
     C*
     C**   ACCESS PF-TABTE10
     C*
     C********** ICDKY     CHAINTABTE10F             40                                       CGL029
     C                     CALL 'AOACODR0'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                                               CGL029
     C                     PARM '*KEY   ' @OPTN                                               CGL029
     C                     PARM           @AFNB                                               CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C********** *IN40     IFEQ '1'                                                           CGL029
     C********** RECI      ORNE 'D'                                                           CGL029
     C********** *LOCK     IN   LDA                                                    S01117 CGL029
     C***********          MOVE '15'      DBASE                           S01117
     C**********           Z-ADD15        DBASE                                        S01117 CGL029
     C**********           MOVE 'TABLE'   DBFILE           ***DBERR 15***                     CGL029
     C**********           MOVELICDKY     DBKEY                                               CGL029
     C           @RTCD     IFNE *BLANK                                                        CGL029
     C           *LOCK     IN   LDA                                                           CGL029
     C                     Z-ADD15        DBASE                                               CGL029
     C                     MOVEL'SDACODPD'DBFILE                                              CGL029
     C                     MOVEL@AFNB     DBKEY                                               CGL029
     C                     MOVEL@OPTN     DBOPTN                                              CGL029
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C*****SAVE*ACCOUNT*TYPE******                                        S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*
     C                     MOVE ATYP      FFATYP
     C***                  MOVE ACSC      FFACSC                S10736    099326
     C                     MOVE ACCS      FFACSC                          099326
     C*
     C**   SET THE POSTING AMOUNT TO GO OUT TO PF-MGEFFPD
     C**   ( NOTE : NET OF ACCRUAL AMOUNTS MAY BE NEGATIVE.
     C**     IF IT IS NEGATIVE ITS SIGN WILL BE REVERSED BELOW)
     C*
     C                     Z-ADDACCSUM    PSTA
     C*
     C                     Z-ADD0         REVI
     C*
     C**   DETERMINE SIGN OF POSTING AMOUNT
     C*
     C           N         IFLE 3
     C*
     C**   THE FIRST 3 ACCOUNT CODES/NARRATIVE/POSTING REFERENCES
     C**   ARE FOR DEBIT POSTINGS.IF AMOUNT IS NEGATIVE THEN CREDIT
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C*
     C                     ELSE
     C*
     C**   THE LAST 3 ACCOUNT CODES/NARRATIVE/POSTING REFERENCES
     C**   ARE FOR CREDIT POSTINGS.IF AMOUNT IS NEGATIVE THEN DEBIT
     C*
     C           PSTA      IFLT 0
     C                     Z-SUBPSTA      PSTA
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END
     C*
     C                     END
     C*
     C**   NARRATIVE
     C*
     C                     MOVELMESS,3    PNAR
     C*                                                                   S01522
     C                     MOVE *BLANKS   ##CUST                          S01522
     C                     MOVE *BLANKS   ##CYCD                          S01522
     C                     MOVE *BLANKS   ##ACCD                          S01522
     C                     MOVE *BLANKS   ##ACSQ                          S01522
     C                     MOVE *BLANKS   ##BRCA                          S01522
     C                     MOVE *BLANKS   ##TRNO                          S01522
     C                     MOVE *BLANKS   ##RACN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C                     MOVE *BLANKS   ##FFIC                          S01522
     C                     MOVE *BLANKS   ##FFMK                          S01522
     C                     MOVE *BLANKS   ##FFPD                          S01522
     C                     MOVE *BLANKS   ##FFPC                          S01522
     C                     MOVE *BLANKS   ##FFSP                          S01522
     C*                                                                   S01522
     C                     MOVE 'GB00020' ##MGID                          S01522
     C*                                                                   S01117
     C**   SET UP PROFIT CENTER FOR POSTING                               S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   PRFC                            S01117
     C                     MOVE *BLANKS   FFPRFC                          CAC003
     C*
     C**   POREF1 - PROCESSING FOR POSTING REFERENCE 1
     C*
     C                     EXSR POREF1
     C*
     C**   END IF -PROCESS ACCOUNT CODE/POSTING REFERENCE IF NOT ZERO
     C*
     C                     END
     C*
     C                     ADD  1         N
     C*
     C**   END DO WHILE - POSTING DETAILS EXIST ON LF/FACKY
     C*
     C                     END
     C*
     C**   END IF - THE ACCOUNT KEY WAS FOUND AND THE AMOUNT IS NON 0
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - ACCODE
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   NARRAT SUB-ROUTINE - PROCESSING NARRATIVE CODES
     C**                       CALLED BY   - ACCODE.
     C**                       CALLS S/R'S - DBERR.
     C*
     C*****************************************************************
     C*
     C*  NOTE - SUBROUTINE AMENDED TO CATER FOR CHANGE OF NARRATIVE CODE  E23097
     C*         IN TABLETP FROM 2N TO 2A. THE STRUCTURE OF THE SUBROUTINE E23097
     C*         WAS CHANGED TO CATER FOR THIS, AND ALSO TO MAKE THE CODE  E23097
     C*         MORE EFFICIENT.                                           E23097
     C*****************************************************************
     C           NARRAT    BEGSR
     C*
     C**   SET UP NARRATIVE FIELD                                         E23097
     C*                                                                   E23097
     C                     MOVE *BLANKS   INST28                          E23097
     C                     MOVE *BLANKS   PNAR                            E23097
     C*                                                                   S01522
     C                     MOVE *BLANKS   ##CUST                          S01522
     C                     MOVE *BLANKS   ##CYCD                          S01522
     C                     MOVE *BLANKS   ##ACCD                          S01522
     C                     MOVE *BLANKS   ##ACSQ                          S01522
     C                     MOVE *BLANKS   ##BRCA                          S01522
     C                     MOVE *BLANKS   ##TRNO                          S01522
     C                     MOVE *BLANKS   ##RACN                          S01522
     C                     MOVE *BLANKS   ##FFIN                          S01522
     C                     MOVE *BLANKS   ##FFIC                          S01522
     C                     MOVE *BLANKS   ##FFMK                          S01522
     C                     MOVE *BLANKS   ##FFPD                          S01522
     C                     MOVE *BLANKS   ##FFPC                          S01522
     C                     MOVE *BLANKS   ##FFSP                          S01522
     C*                                                                   E23097
     C           SUSPSE    IFEQ 'Y'                                       E23097
     C*                                                                   E23097
     C                     MOVEL'SUS'     PNAR                            E23097
     C                     MOVE FFCNUM    NAR4                            E23097
     C                     MOVE FFCCY     NAR5                            E23097
     C                     MOVELFFACOD    NAR6                            E23097
     C                     MOVE FFACSQ    NAR6                            E23097
     C                     MOVE TNBR      NAR7                            E23097
     C*                                                                   E23097
     C                     ELSE                                           E23097
     C*                                                                   E23097
     C           MTHN      IFGT *ZERO                                     E23097
     C                     MOVELISTT      MK                              E23097
     C                     MOVE ISTT      INT                             E23097
     C                     MOVELZMNM,MTHN PER                             E23097
     C                     MOVE YRNO      PER                             E23097
     C                     ELSE                                           E23097
     C                     MOVELISTT      INST6                           E23097
     C                     END                                            E23097
     C                     END                                            E23097
     C*                                                                   E23097
     C**   IF FUTURES & OPTIONS NARRATIVE CODE, GENERATE NARRATIVE        E23097
     C*                                                                   E23097
     C           NAARY,N   LOKUPNARCD                    15               E23097
     C           *IN15     IFEQ '1'                                       E23097
     C*                                                                   E23097
     C**   IF - NARRATIVE CODE IS 01, FA, FB OR  FC
     C*
     C           NAARY,N   IFEQ '01'
     C           NAARY,N   OREQ 'FA'
     C           NAARY,N   OREQ 'FB'
     C           NAARY,N   OREQ 'FC'
     C*                                                                   S01408
     C/COPY WNCPYSRC,FF0420CCP1                                           S01408
     C*                                                                   S01408
     C*
     C**   ACCESS LF/CLINT FOR CUSTOMER REPORT NAME IF PRESENT
     C*
     C********** FFCBCD    IFNE 0                                                             CSD027
     C           FFCBCD    IFNE *BLANKS                                                       CSD027
     C           FFCBCD    CHAINCLINT                40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '16'      DBASE                           S01117
     C                     Z-ADD16        DBASE                           S01117
     C                     MOVE 'CLINT'   DBFILE           ***DBERR 16***
     C                     MOVELFFCBCD    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C                     ELSE
     C*
      ** IF NO CUSTOMER, FORMAT BOOK NAME
     C*
     C                     MOVE *BLANK    CRNM
     C                     MOVELMESS,4    CRNM
     C                     MOVE BOKC      CRNM
     C*
     C                     END
     C*                                                                   E23097
     C**   IF - '01'                                                      E23097
     C           NAARY,N   IFEQ '01'                                      E23097
     C                     MOVELCRNM      PNAR                            E23097
     C                     END                                            E23097
     C*                                                                   E23097
     C**   IF - 'FA'                                                      E23097
     C           NAARY,N   IFEQ 'FA'                                      E23097
     C                     MOVELRTNBR     PNAR                            E23097
     C                     MOVELCRNM      NAR2                            E23097
     C*                                                                   S01522
     C                     MOVELRTNBR     ##TRNO                          S01522
     C                     END                                            E23097
     C*                                                                   E23097
     C**   IF - 'FB'                                                      E23097
     C           NAARY,N   IFEQ 'FB'                                      E23097
     C                     MOVEL*BLANK    INST10                          E23097
     C           MTHN      IFGT *ZERO                                     E23097
     C                     MOVELZMNM,MTHN MTHYR                           E23097
     C                     MOVE YRNO      MTHYR                           E23097
     C                     END                                            E23097
     C                     MOVELISTT      INST10                          E23097
     C                     MOVE CRNM      PNAR                            E23097
     C                     MOVELINST10    PNAR                            E23097
     C*                                                                   S01522
     C                     MOVELMTHYR     ##FFPD                          S01522
     C                     MOVELISTT      ##FFMK                          S01522
     C                     MOVE ISTT      ##FFIC                          S01522
     C                     END                                            E23097
     C*                                                                   E23097
     C**   IF - 'FC'                                                      E23097
     C           NAARY,N   IFEQ 'FC'                                      E23097
     C                     MOVELINST6     PNAR                            E23097
     C                     MOVELCRNM      NAR2                            E23097
     C                     MOVELINST10    PNAR                            S01522
     C*                                                                   S01522
     C                     MOVELISTT      ##FFMK                          S01522
     C                     MOVE ISTT      ##FFIC                          S01522
     C                     END                                            E23097
     C/COPY WNCPYSRC,FF0420C001
     C*                                                                   E23097
     C*********************ELSE                                           E23097
     C************LIKE*****DEFN NAARY,N   NARY  + 1                       E23097
     C*********************MOVE NAARY,N   NARY                            E23097
     C*********************MOVEL'0'       NARY                            E23097
     C*********************TESTN          NARY       43                   E23097
     C*********************                                               E23097
     C*****IF*-*NUMERIC NARRATIVE CODE                                    E23097
     C************IN43     IFEQ '1'                                       E23097
     C*********************                                               E23097
     C*****ACCESS PF-TABLETP FOR NARRATIVE                                E23097
     C*********************MOVE NAARY,N   NARC                            E23097
     C***********NARC******CHAINTABLETP              40                   E23097
     C*********************                                               E23097
     C****IF*-*NOT A VALID RECORD                                         E23097
     C************IN40*****IFEQ '1'                                       E23097
     C***********RECI******ORNE 'D'                                       E23097
     C*
     C************LOCK     IN   LDA                                 S01117E23097
     C***********          MOVE '17'      DBASE                     S01117E23097
     C**********           Z-ADD17        DBASE                     S01117E23097
     C**********           MOVE 'TABLE'   DBFILE           ***DBERR 17*** E23097
     C**********           MOVELNARC      DBKEY                           E23097
     C**********           OUT  LDA                                 S01117E23097
     C**********           EXSR DBERR                                     E23097
     C**********           END                                            E23097
     C**********                                                          E23097
     C**********           ELSE                                           E23097
     C*                                                                   E44684
     C                     END                                            E44684
     C*
     C**   IF - NARRATIVE CODE FD, FE, FF, FG, FH, FI OR FJ
     C*
     C           NAARY,N   IFEQ 'FD'
     C           NAARY,N   OREQ 'FE'
     C           NAARY,N   OREQ 'FF'
     C           NAARY,N   OREQ 'FG'
     C           NAARY,N   OREQ 'FH'
     C           NAARY,N   OREQ 'FI'
     C           NAARY,N   OREQ 'FJ'
     C*
     C                     MOVEL*BLANK    NARD
     C                     Z-ADD1         X       20
     C           NAARY,N   LOKUPNARTB1,X                 40
     C                     MOVELNARTB2,X  NARD
     C/COPY WNCPYSRC,FF0420C030
     C**   IF - NARRATIVE CODE FD, FE, FF OR FG                           E23097
     C*                                                                   E23097
     C           NAARY,N   IFEQ 'FD'                                      E23097
     C           NAARY,N   OREQ 'FE'                                      E23097
     C           NAARY,N   OREQ 'FF'                                      E23097
     C           NAARY,N   OREQ 'FG'                                      E23097
     C                     MOVELNARD      NAR3                            E23097
     C                     MOVELRTNBR     PNAR                            E23097
     C*                                                                   S01522
     C                     MOVELRTNBR     ##TRNO                          S01522
     C                     END                                            E23097
     C*                                                                   E23097
     C**   IF - NARRATIVE CODE FH, FI OR FJ                               E23097
     C*                                                                   E23097
     C           NAARY,N   IFEQ 'FH'                                      E23097
     C           NAARY,N   OREQ 'FI'                                      E23097
     C           NAARY,N   OREQ 'FJ'                                      E23097
     C                     MOVELNARD      NAR3                            E23097
     C                     MOVELINST12    PNAR                            E23097
     C*                                                                   S01522
     C***********          MOVELMTHYR     ##FFPD                    S01522089254
     C                     MOVELPER       ##FFPD                          089254
     C                     MOVELISTT      ##FFMK                          S01522
     C                     MOVE ISTT      ##FFIC                          S01522
     C*
     C                     END
     C/COPY WNCPYSRC,FF0420C002
     C*
     C                     END
     C*
     C*********************END                                            E23097
     C*
     C*****SET*UP*NARRATIVE FIELD                                         E23097
     C*********************MOVE *BLANKS   INST28                          E23097
     C*********************MOVE *BLANKS   PNAR                            E23097
     C*********************                                               E23097
     C***********SUSPSE****IFEQ 'Y'                                       E23097
     C*********************MOVEL'SUS'     PNAR                            E23097
     C*********************MOVE FFCNUM    NAR4                            E23097
     C*********************MOVE FFCCY     NAR5                            E23097
     C*********************MOVELFFACOD    NAR6                            E23097
     C*********************MOVE FFACSQ    NAR6                            E23097
     C*********************MOVE TNBR      NAR7                            E23097
     C*********************                                               E23097
     C*********************ELSE                                           E23097
     C***********MTHN******IFGT *ZERO                                     E23097
     C*********************MOVELISTT      MK                              E23097
     C*********************MOVE ISTT      INT                             E23097
     C*********************MOVELZMNM,MTHN PER                             E23097
     C*********************MOVE YRNO      PER                             E23097
     C*********************ELSE                                           E23097
     C*********************MOVELISTT      INST6                           E23097
     C*********************END                                            E23097
     C***********PCAL******IFNE *BLANK                                    E23097
     C*********************MOVE PCAL      XER                             E23097
     C*********************                                               E23097
     C*****FORMAT*STRIKE PRICE BEFORE OUTPUT                              E23097
     C*****FFPRCS*-**CONVERT PRICE IN FILE FORMAT (11,7P) TO SCREEN       E23097
     C***************FORMAT (12A)                                         E23097
     C*********************                                               E23097
     C*****ACCESS LF/INTYP2 FOR TICKS DENOMINATOR AND MINIMUM PRICE       E23097
     C*****FLUCTUATION*****                                               E23097
     C*********************                                               E23097
     C***********ISTT******CHAININTYP2               40                   E23097
     C*********************                                               E23097
     C****IF*-*NOT A VALID RECORD                                         E23097
     C************IN40*****IFEQ '1'                                       E23097
     C***********RECI******ORNE 'D'                                       E23097
     C************LOCK     IN   LDA                                 S01117E23097
     C***********          MOVE '21'      DBASE                           S01117
     C***********          Z-ADD21        DBASE                     S01117E23097
     C*********************MOVE 'INTYP2'  DBFILE           ***DBERR 21*** E23097
     C*********************MOVELISTT      DBKEY                           E23097
     C**********           OUT  LDA                                 S01117E23097
     C*********************EXSR DBERR                                     E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****SET UP INPUT FIELDS TO STANDARD SR. FFPRCS                     E23097
     C*********************                                               E23097
     C*********************Z-ADDSTRP      FFPRIC                          E23097
     C*********************Z-ADDTKDM      FFTKDM                          E23097
     C*********************Z-ADDMNPF      FFMNPF                          E23097
     C*********************                                               E23097
     C*****INITIALISE OUTPUT FIELDS                                       E23097
     C*********************                                               E23097
     C*********************MOVE *BLANKS   FFSPRC                          E23097
     C*********************MOVE *BLANKS   NUM                             E23097
     C*********************EXSR FFPRCS                                    E23097
     C*********************MOVELFFSPRC    NUM                             E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*NARRATIVE CODE FD, FE, FF OR FG                           E23097
     C***********NAARY,N***IFEQ 'FD'                                      E23097
     C***********NAARY,N***OREQ 'FE'                                      E23097
     C***********NAARY,N***OREQ 'FF'                                      E23097
     C***********NAARY,N***OREQ 'FG'                                      E23097
     C*********************MOVELNARD      NAR3                            E23097
     C*********************MOVELRTNBR     PNAR                            E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*NARRATIVE CODE FH, FI OR FJ                               E23097
     C***********NAARY,N***IFEQ 'FH'                                      E23097
     C***********NAARY,N***OREQ 'FI'                                      E23097
     C***********NAARY,N***OREQ 'FJ'                                      E23097
     C*********************MOVELNARD      NAR3                            E23097
     C*********************MOVELINST12    PNAR                            E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*'01'                                                      E23097
     C***********NAARY,N   IFEQ '01'                                      E23097
     C*********************MOVELCRNM      PNAR                            E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*'FA'                                                      E23097
     C***********NAARY,N   IFEQ 'FA'                                      E23097
     C*********************MOVELRTNBR     PNAR                            E23097
     C*********************MOVE CRNM      PNAR                            E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*'FB'                                                      E23097
     C***********NAARY,N   IFEQ 'FB'                                      E23097
     C*********************MOVEL*BLANK    INST10                          E23097
     C***********MTHN      IFGT *ZERO                                     E23097
     C*********************MOVELZMNM,MTHN MTHYR                           E23097
     C*********************MOVE YRNO      MTHYR                           E23097
     C*********************END                                            E23097
     C*********************MOVELISTT      INST10                          E23097
     C*********************MOVE CRNM      PNAR                            E23097
     C*********************MOVELINST10    PNAR                            E23097
     C*********************END                                            E23097
     C*********************                                               E23097
     C*****IF*-*'FC'                                                      E23097
     C***********NAARY,N   IFEQ 'FC'                                      E23097
     C*********************MOVELINST6     PNAR                            E23097
     C*********************MOVE CRNM      PNAR                            E23097
     C*********************END                                            E23097
     C*
     C**   IF - 'FK'
     C*
     C           NAARY,N   IFEQ 'FK'
     C*
     C                     MOVELMARKET    PNAR
     C                     MOVELISTN      NAR1
     C*                                                                   S01522
     C                     MOVELISTN      ##FFIN                          S01522
     C                     MOVELMARKET    ##FFMK                          S01522
     C*
     C                     END
     C*
     C**   IF - 'FL'
     C*
     C           NAARY,N   IFEQ 'FL'
     C*                                                                   E23097
     C           PCAL      IFNE *BLANK                                    E23097
     C                     MOVE PCAL      XER                             E23097
     C**   FORMAT STRIKE PRICE BEFORE OUTPUT                              E23097
     C**   FFPRCS -  CONVERT PRICE IN FILE FORMAT (11,7P) TO SCREEN       E23097
     C**             FORMAT (12A)                                         E23097
     C*                                                                   E23097
     C**   ACCESS LF/INTYP2 FOR TICKS DENOMINATOR AND MINIMUM PRICE       E23097
     C**   FLUCTUATION                                                    E23097
     C*                                                                   E23097
     C           ISTT      CHAININTYP2               40                   E23097
     C*                                                                   E23097
     C**  IF - NOT A VALID RECORD                                         E23097
     C*                                                                   E23097
     C           *IN40     IFEQ '1'                                       E23097
     C           RECI      ORNE 'D'                                       E23097
     C                     MOVE '21'      DBASE                           E23097
     C                     MOVE 'INTYP2'  DBFILE           ***DBERR 21*** E23097
     C                     MOVELISTT      DBKEY                           E23097
     C                     EXSR DBERR                                     E23097
     C                     END                                            E23097
     C*                                                                   E23097
     C**   SET UP INPUT FIELDS TO STANDARD SR. FFPRCS                     E23097
     C                     Z-ADDSTRP      FFPRIC                          E23097
     C                     Z-ADDTKDM      FFTKDM                          E23097
     C                     Z-ADDMNPF      FFMNPF                          E23097
     C*                                                                   E23097
     C**   INITIALISE OUTPUT FIELDS                                       E23097
     C                     MOVE *BLANKS   FFSPRC                          E23097
     C                     MOVE *BLANKS   NUM                             E23097
     C*                                                                   E23097
     C                     EXSR FFPRCS                                    E23097
     C*                                                                   E23097
     C                     MOVELFFSPRC    NUM                             E23097
     C*                                                                   E23097
     C                     END                                            E23097
     C*
     C                     MOVELINST28    PNAR
     C*                                                                   S01522
     C                     MOVELMK        ##FFMK                          S01522
     C                     MOVELINT       ##FFIC                          S01522
     C                     MOVELPER       ##FFPD                          S01522
     C                     MOVELXER       ##FFPC                          S01522
     C                     MOVELFFSPRC    ##FFSP                          S01522
     C*
     C                     END
     C*
     C**   IF - 'FM'
     C*
     C           NAARY,N   IFEQ 'FM'
     C*
     C                     MOVELMARKET    PNAR
     C                     MOVELISTN      NAR1
     C******************   MOVE PER       PNAR                            E23097
     C                     MOVE PER       NAR10                           E23097
     C*                                                                   S01522
     C                     MOVELMK        ##FFMK                          S01522
     C                     MOVELISTN      ##FFIN                          S01522
     C                     MOVELPER       ##FFPD                          S01522
     C*
     C                     END
     C*
     C**   IF - 'FN'
     C*
     C           NAARY,N   IFEQ 'FN'
     C*
     C                     MOVELRTNBR     PNAR
     C*******************  MOVE ISTN      PNAR                            E23097
     C                     MOVE ISTN      NAR2                            E23097
     C*                                                                   S01522
     C                     MOVELRTNBR     ##TRNO                          S01522
     C                     MOVELISTN      ##FFIN                          S01522
     C*
     C                     END
     C*
     C**   IF - 'FO'
     C*
     C           NAARY,N   IFEQ 'FO'
     C*
     C                     MOVELINST6     PNAR
     C*                                                                   S01522
     C                     MOVELRTNBR     ##TRNO                          S01522
     C                     MOVELISTN      ##FFIN                          S01522
     C*
     C                     END
     C*
     C*                                                                   E23097
     C                     ELSE                                           E23097
     C**   ELSE, IF NOT FF NARRATIVE CODE (FA - FO OR 01), ACCESS         E23097
     C**     TABLETP FOR NARRATIVE                                        E23097
     C*                                                                   E23097
     C                     MOVE NAARY,N   NARC1                           E23097
     C           NARC1     CHAINTABLETP              40                   E23097
     C*                                                                   E23097
     C**  IF - NOT A VALID RECORD                                         E23097
     C*                                                                   E23097
     C           *IN40     IFEQ '1'                                       E23097
     C           RECI      ORNE 'D'                                       E23097
     C*                                                                   E23097
     C                     MOVE '17'      DBASE                           E23097
     C                     MOVE 'TABLE'   DBFILE           ***DBERR 17*** E23097
     C                     MOVELNARC1     DBKEY                           E23097
     C                     EXSR DBERR                                     E23097
     C                     END                                            E23097
     C*                                                                   E23097
     C                     MOVE NARD      PNAR                            E23097
     C                     END                                            E23097
     C**   IF - RECORD IS A REVERSAL
     C*
     C           REVI      IFEQ 1
     C*
     C                     MOVE '*'       PNAR
     C*
     C                     END
      *                                                                   S01522
      **  Determine if the Narrative Code requires translating before     S01522
      **  being used to set up the Posting Narrative Message ID (CPF      S01522
      **  will not allow a message id of the form GBxxnnn where xx has    S01522
      **  a value above FF.)                                              S01522
     C                     MOVE *ZEROS    ##MGID                          S01522
     C*                                                                   S01522
     C                     Z-ADD1         X                               S01522
     C           NAARY,N   LOKUP#CD,X                    40               S01522
     C           *IN40     IFEQ *ON                                       S01522
     C                     MOVE '1'       ##MGID                          087829
     C                     MOVE #ID,X     ##WK4   4                       S01522
     C                     ELSE                                           S01522
     C                     MOVE NAARY,N   ##WK4                           S01522
     C                     ENDIF                                          S01522
     C                     MOVEL##WK4     ##MGID                          S01522
     C                     MOVEL'GB'      ##MGID                          S01522
     C*
     C**********           END                                            E44684
     C*                                                                   S01522
     C**   END SUB-ROUTINE - NARRAT
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   POREF1 SUB-ROUTINE - PROCESSING POSTING REFERENCE 1
     C**                        CALLED BY - ACCODE, SUMACC
     C**                        CALLS S/R'S - PSTENT, PSTSUS
     C*
     C*****************************************************************
     C*
     C           POREF1    BEGSR
     C*
     C                     MOVE 'N'       SUSPSE
     C*
     C**   SET UP KEY TO LF/ACCNT
     C*
     C                     MOVE BICN      FFCNUM
     C                     MOVE ACARY,N   FFACOD
     C*
     C                     MOVE '01'      FFACSQ
     C                     MOVE FFBRCA    FFBRCB                          S01117
     C*                                                                   S01522
     C                     MOVE BICN      ##CUST                          S01522
     C                     MOVE FFCCY     ##CYCD                          S01522
     C                     MOVE ACARY,N   ##ACCD                          S01522
     C                     MOVE '01'      ##ACSQ                          S01522
     C                     MOVE FFBRCA    ##BRCA                          S01522
     C*
     C**   ACCESS LF/ACCNT
     C**   TO DETERMINE WHETHER,IF THE ACCOUNT CODE
     C**   IS RETAIL THAT THE ACCOUNT EXISTS                              S01117
     C*****IS*RETAIL*THAT*THE*ACCOUNT*EXISTS*OR***************************S01117
     C*****WHETHER*THE*ACCOUNT*IS*OF*ANOTHER*BRANCH***********************S01117
     C*
     C           FFACTK    CHAINACCNT                40
     C***40******          MOVE FFBRCD    BRCD                            S01117
     C   40                MOVE FFBRCA    BRCA                            S01117
     C   40                MOVE FFATYP    ATYP
     C   40                MOVE FFACSC    ACSC                            S10736
     C*
     C**   IF THE ACCOUNT CODE REPRESENTS A RETAIL ACCOUNT
     C**   (USING ACCOUNT TYPE ACCESSED OF PF-TABTE10 IN SUBR. ACCODE)
     C*
     C           FFATYP    IFEQ 'R'
     C*
     C**   IF THE ACCOUNT DOES NOT EXIST OR IS CLOSED
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C           ACST      ORNE ' '
     C*
     C                     MOVE 'Y'       SUSPSE  1
     C*
     C                     END
     C*
     C                     MOVE ACNO      ##RACN                          S01522
     C                     END
     C*
     C*****IF*THE*BRANCH*ON*THE*ACCOUNT*IS*DIFFERENT**********************S01117
     C*****FROM*THE*BRANCH*OFF*LF/FOKEY***********************************S01117
     C***********                                                         S01117
     C************IN40     IFEQ '0'                                       S01117
     C***********BRCD      ANDNEFFBRCD                                    S01117
     C***********                                                         S01117
     C***********          MOVE 'Y'       SUSPSE                          S01117
     C***********                                                         S01117
     C***********          END                                            S01117
     C*
     C** OUTPUT POSTING - IF A SUSPENSE ENTRY IS TO BE POSTED
     C**                  THE RECORD ID OF THIS ENTRY WILL BE '*'
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVEL'*'       RECI
     C                     ELSE
     C                     MOVEL'P'       RECI
     C                     END
     C*
     C                     MOVE FFACSC    ACSC                            133363
     C*                                                                   133363
     C                     EXSR PSTENT
     C*
     C** OUTPUT SUSPENSE ENTRY TO BE POSTED , IF REQUIRED
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVE 'GB00030' ##MGID                          S01522
     C                     EXSR PSTSUS
     C                     END
     C*
     C**   END SUB-ROUTINE - POREF1
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   POREF2 SUB-ROUTINE - PROCESSING POSTING REFERENCE 2
     C**                       CALLED BY   - ACCODE.
     C**                       CALLS S/R'S - DBERR, FFSETL, PSTENT
     C**                                     PSTSUS, PSTINB
     C*
     C*****************************************************************
     C*
     C           POREF2    BEGSR
     C*
     C                     MOVE 'N'       SUSPSE
     C                     MOVE 'N'       INTBRN
     C*
     C** INPUTS TO FFSETL FROM LF/FOKEY
     C*
     C**    Branch code
     C**    Customer/Broker code
     C**    Settlement Type
     C**    Settlement Account
     C**    Settlement Branch                                             S01117
     C**    Currency
     C*
     C***********          Z-ADDFFBRCD    FFBRCD                          S01117
     C                     MOVE FFBRCA    FFBRCA                          S01117
     C**********           Z-ADDFFCBCD    FFCBCD                                              CSD027
     C                     MOVE FFCBCD    FFCBCD                                              CSD027
     C                     Z-ADDFFSETP    FFSETP
     C                     MOVE FFSETA    FFSETA
     C                     MOVE FFSETB    FFSETB                          S01117
     C                     MOVE FFCCY     FFCCY
     C*
     C**   IF SETTLEMENT TYPE IS 15
     C*
     C           FFSETP    IFEQ 15
     C*
     C**   ACCESS LF/FOCLT TO DETERMINE WHETHER
     C*
     C           FFCBCD    CHAINFOCLT                40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '18'      DBASE                           S01117
     C                     Z-ADD18        DBASE                           S01117
     C                     MOVE 'FOCLT'   DBFILE           ***DBERR 18***
     C                     MOVELFFCBCD    DBKEY
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C                     MOVE BRKI      FFBRKI
     C*
     C                     END
     C*
     C**Default*Account*Sequence******************************************S01117
     C***********                                                         S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          Z-ADDNSACS     FFDASQ                          S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD01        FFDASQ                          S01117
     C***********          END                                            S01117
     C/COPY WNCPYSRC,FF0420C006
     C                     EXSR FFSETL
     C/COPY WNCPYSRC,FF0420C003
     C*                                                                   S01522
     C                     MOVE FFCNUM    ##CUST                          S01522
     C                     MOVE FFCCY     ##CYCD                          S01522
     C                     MOVE FFACOD    ##ACCD                          S01522
     C                     MOVE FFACSQ    ##ACSQ                          S01522
     C                     MOVE FFBRCB    ##BRCA                          S01522
     C*
      ** If settlement type is 00, FFSETL will ignore - post to suspense.
     C*
     C           FFSETP    IFEQ 00
     C***********          Z-ADDBICN      FFCNUM                          S01117
     C                     MOVE BICN      FFCNUM                          S01117
     C                     Z-ADDCOMS      FFACOD
     C***********          Z-ADDFFDASQ    FFACSQ                          S01117
     C                     Z-ADD01        FFACSQ                          S01117
     C                     MOVE FFBRCA    FFBRCB                          S01117
     C***********          MOVE CCY       FFCCY                           098904
     C                     MOVE 'Y'       SUSPSE
     C*                                                                   S01522
     C                     MOVE *ZEROS    ##CUST                          S01522
     C                     MOVE *ZEROS    ##ACCD                          S01522
     C                     MOVE '01'      ##ACSQ                          S01522
     C                     END
     C*                                                                   S01522
     C           ATYP      IFEQ 'R'                                       S01522
     C                     MOVELACNO      ##RACN                          S01522
     C                     ENDIF                                          S01522
     C*
     C**    IF *IN89 IS ON ( ERROR IN FFSETL )
     C** OR IF *IN89 IS OFF AND RETAIL SETTLEMENT IS INVOLVED BUT
     C**    THE RETAIL ACCOUNT ACCESSED IS NOT LIVE/OPEN
     C**               POST TO SUSPENSE
     C*
     C           *IN89     IFEQ '1'
     C           *IN89     OREQ '0'
     C           ATYP      ANDEQ'R'
     C***********FFMIND    ANDNE'Y'                                       076819
     C           ACST      ANDNE' '                                       076819
     C                     MOVEL'Y'       SUSPSE
     C                     ELSE
     C*
     C**    IF RETAIL SETTLEMENT , ACCOUNT HAS BEEN ACCESSED
     C**    IN FFSETL.IF NOT , ACCESS THE ACCOUNT NOW
     C**    (ACCOUNT TYPE IS FROM PF-TABTE10 IN SUBR. FFSETL)
     C*
     C           ATYP      IFNE 'R'
     C           FFACTK    CHAINACCNT                40
     C***40******          MOVELFFBRCD    BRCD                            S01117
     C   40                MOVELFFBRCA    BRCA                            S01117
     C                     END
     C*
     C                     END
     C*
     C**   IF - THE BRANCH CODE ON THE ACCOUNT IS
     C**        DIFFERENT FROM THE BRANCH CODE ON LF/FOKEY
     C**        AND NO ERROR HAS BEEN RECORDED SO FAR
     C*
     C***********BRCD      IFNE FFBRCD                                    S01117
     C           BRCA      IFNE FFBRCA                                    S01117
     C           SUSPSE    ANDEQ'N'
     C*
     C**   IF - MULTIBRANCHING IS NOT PRESENT
     C*
     C**   GENERATE THE POSTING TO SUSPENSE
     C*
     C           MBIN      IFNE 'Y'
     C*
     C                     MOVE 'Y'       SUSPSE
     C*
     C**   ELSE - MULTIBRANCHING IS PRESENT
     C*
     C                     ELSE
     C*
     C**   IF - SETTLEMENT TYPE IS 03 OR 06
     C*
     C           FFSETP    IFEQ 03
     C           FFSETP    OREQ 06
     C*
     C**   GENERATE THE POSTING TO SUSPENSE
     C*
     C                     MOVE 'Y'       SUSPSE
     C*
     C**   ELSE - SETTLEMENT TYPE IS NOT 03 OR 06
     C*
     C                     ELSE
     C*                                                                   S01117
     C*****SAVE*SETTLEMENT*ACCOUNT*TYPE******                             S10736
     C**   SAVE SETTLEMENT ACCOUNT TYPE AND SECTION                       S10736
     C*                                                                   S01117
     C           *LIKE     DEFN ATYP      XXATYP                          S01117
     C           *LIKE     DEFN ACSC      XXACSC                          S10736
     C                     MOVE ATYP      XXATYP                          S01117
     C                     MOVE ACSC      XXACSC                          S10736
     C*
     C*****SETUP*KEY*TO*PF-TABLETR*-*USING*BRANCH*CODE*FROM*LF/ACCNT******S01117
     C***********                                                         S01117
     C***********          MOVE *BLANKS   ICDKY                           S01117
     C***********          MOVE '10'      ICD1                            S01117
     C***********          MOVE BRCD      ICDKY                           S01117
     C*
     C****ACCESS*PF-TABLETR*FOR*BRANCH*INTERNAL*CUSTOMER*OF*THIS*BRANCH***S01117
     C**  ACCESS SDBRCHPD FOR BRANCH INTERNAL CUSTOMER OF THIS BRANCH     S01117
     C*
     C***********ICDKY     CHAINTABLETRF             40                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C************IN40     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********          MOVE '19'      DBASE                           S01117
     C***********          MOVE 'TABLE'   DBFILE           ***DBERR 19*** S01117
     C***********          MOVELICDKY     DBKEY                           S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD19        DBASE                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***DBERR 19*** S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C** SAVE SETTLEMENT BRANCH ( FOR USE IN SUBROUTINE PSTINB BELOW )
     C*
     C************LIKE     DEFN BRCD      XXBRCD                          S01117
     C***********          Z-ADDBRCD      XXBRCD                          S01117
     C           *LIKE     DEFN BRCA      XXBRCA                          S01117
     C                     MOVE BRCA      XXBRCA                          S01117
     C*                                                                   S01117
     C**   ACCESS SDACODPD - USING DUE FROM ACCOUNT CODE                  S01117
     C*                                                                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM XXDFAC    @AFNB   4                                    S01117 CGL029
     C                     PARM XXDFAC    @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*                                                                   S01117
     C**   IF - NOT A VALID RECORD                                        S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD25        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 25*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*****SAVE*ACCOUNT*TYPE******                                  S01117S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*                                                                   S01117
     C                     MOVE ATYP      XXATDF                          S01117
     C                     MOVE ACSC      XXASDF                          S10736
     C*                                                                   S01117
     C*                                                                   S01117
     C**   ACCESS SDACODPD - USING DUE TO ACCOUNT CODE                    S01117
     C*                                                                   S01117
     C                     CALL 'AOACODR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C**********           PARM XXDTAC    @AFNB   4                                    S01117 CGL029
     C                     PARM XXDTAC    @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       S01117 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C*                                                                   S01117
     C**  IF - NOT A VALID RECORD                                         S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     Z-ADD26        DBASE                           S01117
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 26*** S01117
     C                     MOVEL@AFNB     DBKEY                           S01117
     C                     MOVEL@OPTN     DBOPTN                          S01117
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*****SAVE*ACCOUNT*TYPE******                                  S01117S10736
     C**   SAVE ACCOUNT TYPE AND SECTION                                  S10736
     C*                                                                   S01117
     C                     MOVE ATYP      XXATDT                          S01117
     C                     MOVE ACSC      XXASDT                          S10736
     C*
     C*****GENERATE*TWO*INTER-BRANCH*POSTINGS*****************************S01117
     C**   GENERATE INTER-BRANCH POSTINGS                                 S01117
     C*
     C                     MOVE 'Y'       INTBRN  1
     C*                                                                   S01117
     C*****RESET*SETTLEMENT*ACCOUNT*TYPE******                      S01117S10736
     C**   RESET SETTLEMENT ACCOUNT TYPE AND SECTION                      S10736
     C*                                                                   S01117
     C                     MOVE XXATYP    ATYP                            S01117
     C                     MOVE XXACSC    ACSC                            S10736
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** OUTPUT POSTING - IF A SUSPENSE ENTRY IS TO BE POSTED
     C**                  THE RECORD ID OF THIS ENTRY WILL BE '*'
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVEL'*'       RECI
     C                     ELSE
     C                     MOVEL'P'       RECI
     C                     END
     C*
     C                     MOVE FFACSC    ACSC                            133363
     C*                                                                   133363
     C                     EXSR PSTENT
     C*
     C** OUTPUT SUSPENSE ENTRY TO BE POSTED , IF REQUIRED
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVE 'GB00030' ##MGID                          S01522
     C                     EXSR PSTSUS
     C                     END
     C*
     C****WRITE*TWO*EXTRA*INTER-BRANCH*POSTINGS*,*IF*REQUIRED*************S01117
     C**  WRITE EXTRA INTER-BRANCH POSTINGS , IF REQUIRED                 S01117
     C*
     C           INTBRN    IFEQ 'Y'
     C                     EXSR PSTINB
     C                     END
     C*
     C**   END SUB-ROUTINE - POREF2
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   POREF3 SUB-ROUTINE - PROCESSING POSTING REFERENCE 3
     C**                        CALLED BY - ACCODE.
     C**                        CALLS S/R'S - PSTENT, PSTSUS
     C*
     C*****************************************************************
     C*
     C           POREF3    BEGSR
     C*
     C                     MOVE 'N'       SUSPSE
     C*
     C**   SET UP KEY TO LF/ACCNT
     C*
     C**   IF THE CUSTOMER CODE IS 0 USE BRANCH INTERNAL CUSTOMER NUMBER
     C*
     C********** FFCBCD    IFEQ 0                                                             CSD027
     C           FFCBCD    IFEQ *BLANKS                                                       CSD027
     C***********          Z-ADDBICN      FFCNUM                          S01117
     C                     MOVE BICN      FFCNUM                          S01117
     C                     ELSE
     C                     MOVE FFCBCD    FFCNUM
     C                     END
     C*
     C                     MOVE ACARY,N   FFACOD
     C                     MOVE FFBRCA    FFBRCB                          S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          MOVE NSACS     FFACSQ                          S01117
     C***********          ELSE                                           S01117
     C                     MOVE '01'      FFACSQ
     C***********          END                                            S01117
     C/COPY WNCPYSRC,FF0420C004
     C*                                                                   S71062
     C** SETUP ACSQ                                                       S71062
     C           BGPFMG    IFEQ 'Y'                                       CPM003
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C                     EXSR EVNTYP                                    S71062
     C                     END                                            CPM003
     C*                                                                   S01522
     C                     MOVE FFCNUM    ##CUST                          S01522
     C                     MOVE FFCCY     ##CYCD                          S01522
     C                     MOVE FFACOD    ##ACCD                          S01522
     C                     MOVE FFACSQ    ##ACSQ                          S01522
     C                     MOVE FFBRCB    ##BRCA                          S01522
     C*
     C**   ACCESS LF/ACCNT
     C**   TO DETERMINE WHETHER,IF THE ACCOUNT CODE
     C**   IS RETAIL THAT THE ACCOUNT EXISTS OR
     C**   WHETHER THE ACCOUNT IS OF ANOTHER BRANCH
     C*
     C           FFACTK    CHAINACCNT                40
     C***40******          MOVE FFBRCD    BRCD                            S01117
     C   40                MOVE FFBRCA    BRCA                            S01117
     C   40                MOVE FFATYP    ATYP
     C   40                MOVE FFACSC    ACSC                            S10736
     C*
     C**   IF THE ACCOUNT CODE REPRESENTS A RETAIL ACCOUNT
     C**   (USING ACCOUNT TYPE ACCESSED OF PF-TABTE10 IN SUBR. ACCODE)
     C*
     C           FFATYP    IFEQ 'R'
     C*
     C**   IF THE ACCOUNT DOES NOT EXIST OR IS CLOSED
     C*
     C           *IN40     IFEQ '1'
     C           RECI      ORNE 'D'
     C           ACST      ORNE ' '
     C*
     C                     MOVE 'Y'       SUSPSE
     C*
     C                     END
     C*                                                                   S01522
     C                     MOVE ACNO      ##RACN                          S01522
     C*
     C                     END
     C*
     C*****IF*THE*BRANCH*ON*THE*ACCOUNT*IS*DIFFERENT**********************S01117
     C*****FROM*THE*BRANCH*OFF*LF/FOKEY***********************************S01117
     C***********                                                         S01117
     C************IN40     IFEQ '0'                                       S01117
     C***********BRCD      ANDNEFFBRCD                                    S01117
     C***********                                                         S01117
     C***********          MOVE 'Y'       SUSPSE                          S01117
     C***********                                                         S01117
     C***********          END                                            S01117
     C*
     C** OUTPUT POSTING - IF A SUSPENSE ENTRY IS TO BE POSTED
     C**                  THE RECORD ID OF THIS ENTRY WILL BE '*'
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVEL'*'       RECI
     C                     ELSE
     C                     MOVEL'P'       RECI
     C                     END
     C*
     C                     MOVE FFACSC    ACSC                            133363
     C*                                                                   133363
     C                     EXSR PSTENT
     C*
     C** OUTPUT SUSPENSE ENTRY TO BE POSTED , IF REQUIRED
     C*
     C           SUSPSE    IFEQ 'Y'
     C                     MOVE 'GB00030' ##MGID                          S01522
     C                     EXSR PSTSUS
     C                     END
     C*
     C**   END SUB-ROUTINE - POREF3
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   PSTENT SUB-ROUTINE. - GENERATES A POSTING TO PF-MGEFFPD       *
     C**            CALLED BY  - POREF1, POREF2, POREF3.
     C**            CALLS S/R'S - ZZADD
     C*                                                                  *
     C********************************************************************
     C*
     C           PSTENT    BEGSR
     C*
     C** FIELDS SET PRIOR TO SUBROUTINE EXECUTION :
     C**   RECORD ID - WILL BE 'P' IF TO BE POSTED,ELSE '*' IF NOT.
     C**   NARRATIVE
     C**   POSTING AMOUNT
     C**   DEBIT/CREDIT INDICATOR
     C**   ACCOUNT TYPE( OFF LF/ACCNT IF A/C EXISTS,ELSE PF-TABTE10)
     C**   BRANCH CODE ( OFF LF/ACCNT IF A/C EXISTS,ELSE LF/FOKEY)
     C*
     C                     MOVELFFCNUM    CNUM
     C                     MOVELFFCCY     CCY
     C                     MOVELFFACOD    ACOD
     C                     MOVELFFACSQ    ACSQ
     C*
     C**   SET UP CONSTANT VALUES FOR POSTING RECORD FIELDS
     C*
     C                     MOVE RUND      PSTD
     C                     MOVE 'GE-FF'   SPOS
     C                     MOVE 'T'       GETP
     C                     BITOF'01234567'PRIN
     C*
     C                     MOVE VDAT      VALD
     C*                                                                   S01182
     C**   Set up MIS account posting fields.                             S01182
     C*                                                                   S01182
     C**********           Z-ADDFFCBCD    ASOC                                         S01182 CSD027
     C                     MOVE FFCBCD    ASOC                                                CSD027
     C*                                                                   S01182
     C                     Z-ADDTNBR      NUM6    60                      S01182
     C           NUM6      IFLT 0                                         158309
     C                     Z-SUBNUM6      NUM6                            158309
     C                     END                                            158309
     C                     MOVELNUM6      OTRF                            S01182
     C*                                                                   S01182
     C                     MOVE *BLANKS   OTST                            S01182
     C                     MOVELFFKY6     OTTP                            S01182
     C                     Z-ADD0         SDCB                            S01182
     C                     Z-ADD0         SDLB                            S01182
     C***********          MOVE *BLANKS   PRFC                     S01182 S10736
      *                                                                   CGL007
      ** If CGL007 is ON, set-up TRST & OTST to allow enq. using APOSTL6. CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVEL'FF'      TRST                            CGL007
     C           TNBR      IFLT *ZEROS                                    CGL007
     C                     Z-SUBTNBR      NUM6                            CGL007
     C                     ENDIF                                          CGL007
     C                     MOVELNUM6      OTST                            CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FF0420C009
     C*                                                                   075998
     C** IF TRANSACTION NUMBER 0 AND CLOSE OUT NUMBER NOT ZERO            075998
     C** ACCESS LF/CLOST10 FOR REFERENCE OF ANY TRANSACTION IN            075998
     C** CLOSE OUT SET AND MOVE THIS INTO 'OTRF'                          075998
     C           TNBR      IFEQ 0                                         075998
     C           CLON      ANDNE0                                         075998
     C           BGPFMG    ANDEQ'Y'                                       CPM003
     C** If Bank Portfolios are supported, treat as if PM off             CPM003
     C           FCPORS    ANDNE'B'                                       CPM003
     C           TNBR      OREQ 0                                         CPB001
     C           CLON      ANDNE0                                         CPB001
     C           BGN4ST    ANDEQ'Y'                                       CPB001
     C*                                                                   075998
     C           CLON      CHAINCLOST10              40                   075998
     C* If transaction details not found                                  075998
     C           *IN40     IFEQ *ON                                       075998
     C*                                                                   075998
     C           *LOCK     IN   LDA                                       CPM003
     C                     Z-ADD24        DBASE                           075998
     C                     MOVE 'CLOST10' DBFILE           ***DBERR 27*** 075998
     C                     MOVELCLON      DBKEY                           075998
     C                     OUT  LDA                                       CPM003
     C                     EXSR DBERR                                     075998
     C                     END                                            075998
     C*                                                                   075998
     C                     Z-ADDWRTNBR    NUM6                            075998
     C           NUM6      IFLT 0                                         158309
     C                     Z-SUBNUM6      NUM6                            158309
     C                     END                                            158309
     C                     MOVELNUM6      OTRF                            075998
      *                                                                   CGL007
      ** If CGL007 is ON, set-up TRST & OTST to allow enq. using APOSTL6  CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVEL'CO'      TRST                            CGL007
     C           WRCLON    IFLT *ZEROS                                    CGL007
     C                     Z-SUBWRCLON    NUM6                            CGL007
     C                     ENDIF                                          CGL007
     C                     MOVELNUM6      OTST                            CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FF0420C010
     C                     END                                            075998
     C*
     C**   IF ACCOUNT IS RETAIL
     C*
     C           ATYP      IFEQ 'R'
     C                     Z-ADDACNO      ACNO
     C                     Z-ADD92060     TRAT
     C                     Z-ADD1         RIND
     C                     ELSE
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C                     END
     C*
     C**   WRITE OUT RECORD TO PF-MGEFFPD
     C*
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC003
     C** Move Account Profit Centre to PRFC                               CAC003
     C*                                                                   CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C           ATYP      ANDEQ'R'                                       CAC003
     C           SUSPSE    ANDNE'Y'                                       CAC003
     C           *IN20     OREQ '1'                                       CAC003
     C           ATYP      ANDEQ'N'                                       CAC003
     C           SUSPSE    ANDNE'Y'                                       CAC003
     C                     MOVE PRFCX     PRFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE FFPRFC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   S01522
     C/COPY WNCPYSRC,FF0420C007
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     MOVELFFKY      ACKEY                                             AR988246
      *                                                                                       CGL020
      ** Output Fees From FOKEY                                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C**********           MOVELFFKY      ACKEY                                      CGL020 AR988246
     C                     MOVELF1FFLG    FEEFLG                                              CGL020
     C                     Z-ADDF1FVAL    FEEVAL                                              CGL020
     C                     Z-ADDF1FPCT    FEEPCT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
      *                                                                                       CGL020
     C           ATYP      IFEQ 'R'                                                           CGL020
     C           ATYP      OREQ 'N'                                                           CGL020
     C                     MOVELF1RACT    RORACT                                              CGL020
     C                     MOVELF1RCTY    RORCTY                                              CGL020
     C                     MOVELF1RBNK    RORBNK                                              CGL020
     C                     MOVELF1RCDE    RORCDE                                              CGL020
     C                     MOVELF1PACT    PORACT                                              CGL020
     C                     MOVELF1PCTY    PORCTY                                              CGL020
     C                     MOVELF1PBNK    PORBNK                                              CGL020
     C                     MOVELF1PCDE    PORCDE                                              CGL020
     C                     MOVELF1DACT    DSTACT                                              CGL020
     C                     MOVELF1DCTY    DSTCTY                                              CGL020
     C                     MOVELF1DBNK    DSTBNK                                              CGL020
     C                     Z-ADDF1SDAT    SETDAT                                              CGL020
     C                     ELSE                                                               CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     WRITEAPOSTPDF
     C/COPY WNCPYSRC,FF0420C008
     C*
     C**  IF LIVE POSTING (IE NOT DELETED,IF GOING TO SUSPENSE)
     C**  AND THIS ENTRY IS NOT TO A DIFFERENT BRANCH
     C**  (THE LATTER ONLY BEING RELEVANT FOR POSTING REFERENCE 2 )
     C*
     C           RECI      IFEQ 'P'
     C*
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)
     C*
     C           DRCR      IFEQ 1
     C                     ADD  PSTA      CDTTOT 150
     C                     ELSE
     C                     ADD  PSTA      DBTTOT 150
     C                     END
     C*
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT
     C*
     C                     ADD  1         PONUM   50
     C*
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL
     C*
     C           PSTA      DIV  1000      ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*
     C                     EXSR ZZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   PSTSUS SUB-ROUTINE. - GENERATES A SUSP.POSTING TO PF-MGEFFPD  *
     C**            CALLED BY  - POREF1, POREF2, POREF3, CURRCT
     C**            CALLS S/R'S - ZZADD
     C*                                                                  *
     C********************************************************************
     C*
     C           PSTSUS    BEGSR
     C*
     C** IT IS ASSUMED THAT COMPUTER SUSPENSE IS A NON RETAIL ACCOUNT
     C*
     C** FIELDS SET PRIOR TO SUBROUTINE EXECUTION :
     C**   NARRATIVE
     C**   POSTING AMOUNT
     C**   DEBIT/CREDIT INDICATOR
     C*
     C                     MOVEL'P'       RECI
     C                     MOVELBICN      CNUM
     C                     MOVELFFCCY     CCY
     C                     MOVELCOMS      ACOD
     C*
     C                     MOVEL'01'      ACSQ
     C*
     C*****ACCOUNT*TYPE*FOR*COMPUTER*SUSPENSE******                       S10736
     C**   ACCOUNT TYPE AND SECTION FOR COMPUTER SUSPENSE                 S10736
     C*
     C                     MOVELATCOMS    ATYP
     C                     MOVELASCOMS    ACSC                            S10736
     C*
     C**   SET UP CONSTANT VALUES FOR POSTING RECORD FIELDS
     C*
     C                     MOVE RUND      PSTD
     C                     MOVE RUND      VALD
     C                     MOVE 'GE-FF'   SPOS
     C                     MOVE 'T'       GETP
     C                     BITOF'01234567'PRIN
     C*
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C*
     C***********          Z-ADDFFBRCD    BRCD                            S01117
     C                     MOVE FFBRCA    BRCA                            S01117
     C*                                                                   S01182
     C**   Set up MIS account posting fields.                             S01182
     C*                                                                   S01182
     C**********           Z-ADDFFCBCD    ASOC                                         S01182 CSD027
     C                     MOVE FFCBCD    ASOC                                                CSD027
     C*                                                                   S01182
     C                     Z-ADDTNBR      NUM6    60                      S01182
     C           NUM6      IFLT 0                                         158309
     C                     Z-SUBNUM6      NUM6                            158309
     C                     END                                            158309
     C                     MOVELNUM6      OTRF                            S01182
     C*                                                                   S01182
     C                     MOVE *BLANKS   OTST                            S01182
     C                     MOVELFFKY6     OTTP                            S01182
     C                     Z-ADD0         SDCB                            S01182
     C                     Z-ADD0         SDLB                            S01182
     C***********          MOVE *BLANKS   PRFC                     S01182 S10736
      *                                                                   CGL007
      ** If CGL007 is ON, set-up TRST & OTST to allow enq. using APOSTL6. CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVEL'FF'      TRST                            CGL007
     C           TNBR      IFLT *ZEROS                                    CGL007
     C                     Z-SUBTNBR      NUM6                            CGL007
     C                     ENDIF                                          CGL007
     C                     MOVELNUM6      OTST                            CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FF0420C011
     C*
     C**   WRITE OUT RECORD TO PF-MGEFFPD
     C*
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   CAC003
     C** Move Primary Funding Profit Centre to PRFC                       CAC003
     C*                                                                   CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE FFPRFC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C/COPY WNCPYSRC,FF0420C023
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     MOVELFFKY      ACKEY                                             AR988246
      *                                                                                       CGL020
      ** Output Fees From FOKEY                                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C**********           MOVELFFKY      ACKEY                                      CGL020 AR988246
     C                     MOVELF1FFLG    FEEFLG                                              CGL020
     C                     Z-ADDF1FVAL    FEEVAL                                              CGL020
     C                     Z-ADDF1FPCT    FEEPCT                                              CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     WRITEAPOSTPDF
     C*
     C/COPY WNCPYSRC,FF0420C014
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)
     C*
     C           DRCR      IFEQ 1
     C                     ADD  PSTA      CDTTOT 150
     C                     ELSE
     C                     ADD  PSTA      DBTTOT 150
     C                     END
     C*
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT
     C*
     C                     ADD  1         PONUM   50
     C*
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL
     C*
     C           PSTA      DIV  1000      ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*
     C                     EXSR ZZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   PSTINB SUB-ROUTINE. - GENERATES TWO INTER-BRANCH              *
     C**                         POSTINGS TO PF-MGEFFPD                  *
     C**            CALLED BY  - POREF2
     C**            CALLS S/R'S - ZZADD
     C*                                                                  *
     C********************************************************************
     C*
     C           PSTINB    BEGSR
     C*                                                                   CAC003
     C** Move the Primary Funding Profit Centre                           CAC003
     C*                                                                   CAC003
     C           *IN20     IFEQ '1'                                       CAC003
     C                     MOVE FTPRFP    PRFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE FFPRFC    PRFC                            CAC003
     C                     ENDIF                                          CAC003
     C*
     C** IT IS ASSUMED THAT INTER-BRANCH ACCOUNTS ARE NON RETAIL
     C*
     C** FIELDS SET PRIOR TO SUBROUTINE EXECUTION :
     C**   NARRATIVE
     C**   POSTING AMOUNT
     C**   DEBIT/CREDIT INDICATOR
     C*                                                                   S01117
     C** IF NOT GENERATE INTER-BRANCH ENTERIES BY MAIN BRANCH             S01117
     C*                                                                   S01117
     C           IEMB      IFNE 'Y'                                       S01117
     C           FFBRCA    OREQ MABR                                      245059
     C           XXBRCA    OREQ MABR                                      245059
     C*
     C** SET UP DETAILS FOR FIRST INTER-BRANCH POSTING
     C** TO BRANCH THAT ORIGINATED THE ENTRY IE FROM LF/FOKEY
     C** CUSTOMER IS THE BRANCH INTERNAL CUSTOMER OF SETTLEMENT BRANCH    S01117
     C*
     C                     MOVEL'P'       RECI
     C***********          MOVELBICN      CNUM                            S01117
     C                     MOVELXXBICN    CNUM                            S01117
     C                     MOVELFFCCY     CCY
     C***********          MOVELNBACB     ACOD                            S01117
     C                     MOVEL'01'      ACSQ
     C*
     C*****ACCOUNT*TYPE*FOR*BRANCH*ACCOUNT*CODE***************************S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE TO ACCOUNT CODE USED      S01117
     C**   ELSE DUE FROM ACCOUNT CODE USED                                S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*
     C***********          MOVELATBACB    ATYP                            S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELATDTAC    ATYP                            S01117
     C                     MOVELASDTAC    ACSC                            S10736
     C                     MOVELDTAC      ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELATDFAC    ATYP                            S01117
     C                     MOVELASDFAC    ACSC                            S10736
     C                     MOVELDFAC      ACOD                            S01117
     C                     END                                            S01117
     C*
     C**   SET UP CONSTANT VALUES FOR POSTING RECORD FIELDS
     C*
     C                     MOVE RUND      PSTD
     C                     MOVE RUND      VALD
     C                     MOVE 'GE-FF'   SPOS
     C                     MOVE 'T'       GETP
     C                     BITOF'01234567'PRIN
     C*
     C                     Z-ADD*ZEROS    ACNO
     C                     Z-ADD*ZEROS    TRAT
     C                     Z-ADD*ZEROS    RIND
     C*
     C**   Set up MIS account posting fields.                             S01182
     C*                                                                   S01182
     C**********           Z-ADDFFCBCD    ASOC                                         S01182 CSD027
     C                     MOVE FFCBCD    ASOC                                                CSD027
     C*                                                                   S01182
     C                     Z-ADDTNBR      NUM6    60                      S01182
     C           NUM6      IFLT 0                                         158309
     C                     Z-SUBNUM6      NUM6                            158309
     C                     END                                            158309
     C                     MOVELNUM6      OTRF                            S01182
     C*                                                                   S01182
     C                     MOVE *BLANKS   OTST                            S01182
     C                     MOVELFFKY6     OTTP                            S01182
     C                     Z-ADD0         SDCB                            S01182
     C                     Z-ADD0         SDLB                            S01182
     C***********          MOVE *BLANKS   PRFC                     S01182 S10736
     C**   BRANCH IS FROM LF/FOKEY
     C*
     C***********          Z-ADDFFBRCD    BRCD                            S01117
     C                     MOVE FFBRCA    BRCA                            S01117
      *                                                                   CGL007
      ** If CGL007 is ON, set-up TRST & OTST to allow enq. using APOSTL6. CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C                     MOVEL'FF'      TRST                            CGL007
     C           TNBR      IFLT *ZEROS                                    CGL007
     C                     Z-SUBTNBR      NUM6                            CGL007
     C                     ENDIF                                          CGL007
     C                     MOVELNUM6      OTST                            CGL007
     C                     ENDIF                                          CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FF0420C012
     C*
     C**   WRITE OUT FIRST INTER-BRANCH RECORD TO PF-MGEFFPD
     C*
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C024
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     MOVELFFKY      ACKEY                                             AR988246
      *                                                                                       CGL020
      ** Output Fees From FOKEY                                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C**********           MOVELFFKY      ACKEY                                      CGL020 AR988246
     C                     MOVELF1FFLG    FEEFLG                                              CGL020
     C                     Z-ADDF1FVAL    FEEVAL                                              CGL020
     C                     Z-ADDF1FPCT    FEEPCT                                              CGL020
     C                     MOVEL*BLANKS   RORACT                                              CGL020
     C                     MOVEL*BLANKS   RORCTY                                              CGL020
     C                     MOVEL*BLANKS   RORBNK                                              CGL020
     C                     MOVEL*BLANKS   RORCDE                                              CGL020
     C                     MOVEL*BLANKS   PORACT                                              CGL020
     C                     MOVEL*BLANKS   PORCTY                                              CGL020
     C                     MOVEL*BLANKS   PORBNK                                              CGL020
     C                     MOVEL*BLANKS   PORCDE                                              CGL020
     C                     MOVEL*BLANKS   DSTACT                                              CGL020
     C                     MOVEL*BLANKS   DSTCTY                                              CGL020
     C                     MOVEL*BLANKS   DSTBNK                                              CGL020
     C                     Z-ADD0         SETDAT                                              CGL020
     C                     MOVEL*BLANKS   TICKER                                              CGL020
     C                     MOVEL*BLANKS   EXCHNG                                              CGL020
     C                     Z-ADD0         NOMINL                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     WRITEAPOSTPDF
     C*
     C/COPY WNCPYSRC,FF0420C015
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)
     C*
     C           DRCR      IFEQ 1
     C                     ADD  PSTA      CDTTOT 150
     C                     ELSE
     C                     ADD  PSTA      DBTTOT 150
     C                     END
     C*
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT
     C*
     C                     ADD  1         PONUM   50
     C*
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL
     C*
     C           PSTA      DIV  1000      ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*
     C                     EXSR ZZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*
     C** SET UP DETAILS FOR SECOND INTER-BRANCH POSTING
     C** TO BRANCH WHERE SETTLEMENT IS TAKING PLACE (IE ON LF/ACCNT)
     C***BRANCH*INTERNAL*CUSTOMER*NUMBER*IS*OF*THE*SETTLEMENT*BRANCH******S01117
     C** CUSTOMER IS BRANCH INTERNAL CUSTOMER OF BRANCH OFF LF/FOKEY      S01117
     C*
     C***********          MOVELXXBICN    CNUM                            S01117
     C***********          MOVELNBACH     ACOD                            S01117
     C                     MOVELBICN      CNUM                            S01117
     C*
     C*****ACCOUNT*TYPE*FOR*HEAD*OFFICE*ACCOUNT*CODE**********************S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE FROM ACCOUNT CODE USED    S01117
     C**   ELSE DUE TO ACCOUNT CODE USED                                  S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*
     C***********          MOVELATBACH    ATYP                            S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELXXATDF    ATYP                            S01117
     C                     MOVELXXASDF    ACSC                            S10736
     C                     MOVELXXDFAC    ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELXXATDT    ATYP                            S01117
     C                     MOVELXXASDT    ACSC                            S10736
     C                     MOVELXXDTAC    ACOD                            S01117
     C                     END                                            S01117
     C*
     C**   REVERSE THE SIGN OF THIS ENTRY FROM THE LAST ENTRY (ABOVE)
     C*
     C           DRCR      IFEQ 0
     C                     Z-ADD1         DRCR
     C                     ELSE
     C                     Z-ADD0         DRCR
     C                     END
     C*
     C**   BRANCH IS FROM SETTLEMENT ACCOUNT (LF/ACCNT)
     C*
     C***********          Z-ADDXXBRCD    BRCD                            S01117
     C                     MOVE XXBRCA    BRCA                            S01117
     C*
     C**   WRITE OUT SECOND INTER-BRANCH RECORD TO PF-MGEFFPD
     C*
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C025
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITEAPOSTPDF
     C*
     C/COPY WNCPYSRC,FF0420C016
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)
     C*
     C           DRCR      IFEQ 1
     C                     ADD  PSTA      CDTTOT 150
     C                     ELSE
     C                     ADD  PSTA      DBTTOT 150
     C                     END
     C*
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT
     C*
     C                     ADD  1         PONUM   50
     C*
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL
     C*
     C           PSTA      DIV  1000      ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C*
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS
     C*
     C                     EXSR ZZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** GENERATE INTER-BRANCH ENTERIES BY MAIN BRANCH                    S01117
     C*                                                                   S01117
     C** SET UP DETAILS FOR FIRST INTER-BRANCH POSTING                    S01117
     C** TO BRANCH WHERE SETTLEMENT IS TAKING PLACE (IE ON LF/ACCNT)      S01117
     C** CUSTOMER IS BRANCH INTERNAL CUSTOMER OF MAIN BRANCH              S01117
     C*                                                                   S01117
     C                     MOVEL'P'       RECI                            S01117
     C                     MOVELMABICN    CNUM                            S01117
     C                     MOVELFFCCY     CCY                             S01117
     C                     MOVEL'01'      ACSQ                            S01117
     C*                                                                   S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE FROM ACCOUNT CODE USED    S01117
     C**   ELSE DUE TO ACCOUNT CODE USED                                  S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELXXATDF    ATYP                            S01117
     C                     MOVELXXASDF    ACSC                            S10736
     C                     MOVELXXDFAC    ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELXXATDT    ATYP                            S01117
     C                     MOVELXXASDT    ACSC                            S10736
     C                     MOVELXXDTAC    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   SET UP CONSTANT VALUES FOR POSTING RECORD FIELDS               S01117
     C*                                                                   S01117
     C                     MOVE RUND      PSTD                            S01117
     C                     MOVE RUND      VALD                            S01117
     C                     MOVE 'GE-FF'   SPOS                            S01117
     C                     MOVE 'T'       GETP                            S01117
     C                     BITOF'01234567'PRIN                            S01117
     C*                                                                   S01117
     C                     Z-ADD*ZEROS    ACNO                            S01117
     C                     Z-ADD*ZEROS    TRAT                            S01117
     C                     Z-ADD*ZEROS    RIND                            S01117
     C*                                                                   S01117
     C**   DEBIT/CREDIT INDICATOR WILL BE THE OPPOSITE                    S01117
     C**   OF THE ENTRY ACROSS THE SETTLEMENT ACCOUNT                     S01117
     C*                                                                   S01117
     C           *LIKE     DEFN DRCR      XXDRCR                          S01117
     C                     Z-ADDDRCR      XXDRCR                          S01117
     C           XXDRCR    IFEQ 0                                         S01117
     C                     Z-ADD1         DRCR                            S01117
     C                     ELSE                                           S01117
     C                     Z-ADD0         DRCR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   BRANCH IS FROM SETTLEMENT ACCOUNT (LF/ACCNT)                   S01117
     C*                                                                   S01117
     C                     MOVE XXBRCA    BRCA                            S01117
     C*                                                                   S01117
     C**   WRITE OUT FIRST INTER-BRANCH RECORD TO PF-MGEFFPD              S01117
     C*                                                                   S01117
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C026
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITEAPOSTPDF                                  S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FF0420C017
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)               S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     ADD  PSTA      CDTTOT 150                      S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      DBTTOT 150                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT                               S01117
     C*                                                                   S01117
     C                     ADD  1         PONUM   50                      S01117
     C*                                                                   S01117
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL                         S01117
     C*                                                                   S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     Z-ADDHRWN      ZZTOTI                          S01117
     C                     Z-ADDHRDC      ZZTOTD                          S01117
     C*                                                                   S01117
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS                          S01117
     C*                                                                   S01117
     C                     EXSR ZZADD                                     S01117
     C                     Z-ADDZZTOTI    HRWN                            S01117
     C                     Z-ADDZZTOTD    HRDC                            S01117
     C*                                                                   S01117
     C** SET UP DETAILS FOR SECOND INTER-BRANCH POSTING TO MAIN BRANCH    S01117
     C** CUSTOMER IS BRANCH INTERNAL CUSTOMER OF SETTLEMENT BRANCH        S01117
     C*                                                                   S01117
     C                     MOVELXXBICN    CNUM                            S01117
     C*                                                                   S01117
     C**   DEBIT/CREDIT INDICATOR WILL BE THE SAME                        S01117
     C**   OF THE ENTRY ACROSS THE SETTLEMENT ACCOUNT                     S01117
     C*                                                                   S01117
     C                     Z-ADDXXDRCR    DRCR                            S01117
     C*                                                                   S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE TO ACCOUNT CODE USED      S01117
     C**   ELSE DUE FROM ACCOUNT CODE USED                                S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELMAATDT    ATYP                            S01117
     C                     MOVELMAASDT    ACSC                            S10736
     C                     MOVELMADTAC    ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELMAATDF    ATYP                            S01117
     C                     MOVELMAASDF    ACSC                            S10736
     C                     MOVELMADFAC    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   BRANCH IS MAIN BRANCH                                          S01117
     C*                                                                   S01117
     C                     MOVE MABR      BRCA                            S01117
     C*                                                                   S01117
     C**   WRITE OUT SECOND INTER-BRANCH RECORD TO PF-MGEFFPD             S01117
     C*                                                                   S01117
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C027
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITEAPOSTPDF                                  S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FF0420C018
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)               S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     ADD  PSTA      CDTTOT 150                      S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      DBTTOT 150                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT                               S01117
     C*                                                                   S01117
     C                     ADD  1         PONUM   50                      S01117
     C*                                                                   S01117
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL                         S01117
     C*                                                                   S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     Z-ADDHRWN      ZZTOTI                          S01117
     C                     Z-ADDHRDC      ZZTOTD                          S01117
     C*                                                                   S01117
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS                          S01117
     C*                                                                   S01117
     C                     EXSR ZZADD                                     S01117
     C                     Z-ADDZZTOTI    HRWN                            S01117
     C                     Z-ADDZZTOTD    HRDC                            S01117
     C*                                                                   S01117
     C** SET UP DETAILS FOR THIRD INTER-BRANCH POSTING TO MAIN BRANCH     S01117
     C** CUSTOMER IS BRANCH INTERNAL CUSTOMER OF BRANCH OFF LF/FOKEY      S01117
     C*                                                                   S01117
     C                     MOVELBICN      CNUM                            S01117
     C*                                                                   S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE FROM ACCOUNT CODE USED    S01117
     C**   ELSE DUE TO ACCOUNT CODE USED                                  S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELMAATDF    ATYP                            S01117
     C                     MOVELMAASDF    ACSC                            S10736
     C                     MOVELMADFAC    ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELMAATDT    ATYP                            S01117
     C                     MOVELMAASDT    ACSC                            S10736
     C                     MOVELMADTAC    ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   DEBIT/CREDIT INDICATOR WILL BE THE OPPOSITE                    S01117
     C**   OF THE ENTRY ACROSS THE SETTLEMENT ACCOUNT                     S01117
     C*                                                                   S01117
     C           XXDRCR    IFEQ 0                                         S01117
     C                     Z-ADD1         DRCR                            S01117
     C                     ELSE                                           S01117
     C                     Z-ADD0         DRCR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   WRITE OUT THIRD INTER-BRANCH RECORD TO PF-MGEFFPD              S01117
     C*                                                                   S01117
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C029
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITEAPOSTPDF                                  S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FF0420C019
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)               S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     ADD  PSTA      CDTTOT 150                      S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      DBTTOT 150                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT                               S01117
     C*                                                                   S01117
     C                     ADD  1         PONUM   50                      S01117
     C*                                                                   S01117
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL                         S01117
     C*                                                                   S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     Z-ADDHRWN      ZZTOTI                          S01117
     C                     Z-ADDHRDC      ZZTOTD                          S01117
     C*                                                                   S01117
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS                          S01117
     C*                                                                   S01117
     C                     EXSR ZZADD                                     S01117
     C                     Z-ADDZZTOTI    HRWN                            S01117
     C                     Z-ADDZZTOTD    HRDC                            S01117
     C*                                                                   S01117
     C** SET UP DETAILS FOR FOURTH INTER-BRANCH POSTING                   S01117
     C** TO BRANCH THAT ORIGINATED THE ENTRY IE FROM LF/FOKEY             S01117
     C** CUSTOMER IS BRANCH INTERNAL CUSTOMER OF MAIN BRANCH              S01117
     C*                                                                   S01117
     C                     MOVELMABICN    CNUM                            S01117
     C*                                                                   S01117
     C**   DEBIT/CREDIT INDICATOR WILL BE THE SAME                        S01117
     C**   OF THE ENTRY ACROSS THE SETTLEMENT ACCOUNT                     S01117
     C*                                                                   S01117
     C                     Z-ADDXXDRCR    DRCR                            S01117
     C*                                                                   S01117
     C**   IF CREDIT (DEBIT/CREDIT IND.=1), DUE TO ACCOUNT CODE USED      S01117
     C**   ELSE DUE FROM ACCOUNT CODE USED                                S01117
     C*****ACCOUNT*TYPE*WILL*BE*THAT*OF*THE*ACCOUNT*CODE******      S01117S10736
     C**   ACCOUNT TYPE AND SECTION WILL BE THOSE OF THE ACCOUNT CODE     S10736
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     MOVELATDTAC    ATYP                            S01117
     C                     MOVELASDTAC    ACSC                            S10736
     C                     MOVELDTAC      ACOD                            S01117
     C                     ELSE                                           S01117
     C                     MOVELATDFAC    ATYP                            S01117
     C                     MOVELASDFAC    ACSC                            S10736
     C                     MOVELDFAC      ACOD                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   BRANCH IS FROM LF/FOKEY                                        S01117
     C*                                                                   S01117
     C                     MOVE FFBRCA    BRCA                            S01117
     C*                                                                   S01117
     C**   WRITE OUT FOURTH INTER-BRANCH RECORD TO PF-MGEFFPD             S01117
     C*                                                                   S01117
     C                     EXSR SRPNAR                                    S01522
     C/COPY WNCPYSRC,FF0420C028
     C*                                                                   S01522
     C                     EXSR GETAS                                     163551
     C*                                                                   CFF007
     C** If enhancement CFF007 and Private Banking module are installed,  CFF007
     C** set TRAT accordingly.                                            CFF007
     C*                                                                   CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C           BGN4ST    ANDEQ'Y'                                       CFF007
     C*                                                                   CFF007
     C** Call initial margin                                              CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'J'                                       CFF007
     C                     Z-ADD98500     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C** Call margin                                                      CFF007
     C*                                                                   CFF007
     C           FFKY3     IFEQ 'U'                                       CFF007
     C                     Z-ADD98501     TRAT                            CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*                                                                   CFF007
     C                     WRITEAPOSTPDF                                  S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FF0420C020
     C**  ADD AMOUNT TO DEBIT/CREDIT TOTAL (AS APPROPRIATE)               S01117
     C*                                                                   S01117
     C           DRCR      IFEQ 1                                         S01117
     C                     ADD  PSTA      CDTTOT 150                      S01117
     C                     ELSE                                           S01117
     C                     ADD  PSTA      DBTTOT 150                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   ADD 1 TO PF-MGEFFPD RECORD COUNT                               S01117
     C*                                                                   S01117
     C                     ADD  1         PONUM   50                      S01117
     C*                                                                   S01117
     C**   ADD TO AMOUNT TO PF-MGEFFPD HASH TOTAL                         S01117
     C*                                                                   S01117
     C           PSTA      DIV  1000      ZZAMT                           S01117
     C                     Z-ADDHRWN      ZZTOTI                          S01117
     C                     Z-ADDHRDC      ZZTOTD                          S01117
     C*                                                                   S01117
     C**   ZZADD  - ADD AMOUNTS INTO HASH FIELDS                          S01117
     C*                                                                   S01117
     C                     EXSR ZZADD                                     S01117
     C                     Z-ADDZZTOTI    HRWN                            S01117
     C                     Z-ADDZZTOTD    HRDC                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/COPY WNCPYSRC,FF0420C021
     C/EJECT
     C/COPY WNCPYSRC,FF0420C022
     C*****************************************************************
     C/COPY ZSRSRC,FFSTDPZ4
     C/COPY ZSRSRC,ZZADDZ1
     C/COPY ZSRSRC,ZFRPEDZ3
     C/COPY ZSRSRC,FFSETLZ4
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,FFFMTZ3
     C/COPY ZSRSRC,FFPRCSZ4
     C*****************************************************************
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C**     RCFAU   SUB-ROUTINE - RECORD AU REPORT FILE BY CALLING RCF   S01117
     C**                         CALLED BY END, DBERR                     S01117
     C**                         CALLS S/R'S -                            S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFAU     BEGSR                            ** RCFAU **   S01117
     C*                                                                   S01117
     C** ENSURE TOTAL SPOOL FILE RECORDED BY RCF                          S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANKS   SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   END SR. - END PROGRAM                                         *
     C*                                                                  *
     C********************************************************************
     C*
     C           END       BEGSR
     C*
     C           *IN01     IFEQ '0'
     C                     EXSR START
     C                     END
     C*
      ***WRITE*NO*DETAILS*IF*APPROPRIATE**********************************S01117
     C***********                                                         S01117
     C************INU4     IFEQ '0'                                       S01117
     C***********          WRITENOMAC                                     S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C************IN14     IFEQ '0'                                       S01117
     C***********AKSI      ANDEQ'Y'                                       S01117
     C***********          WRITENOACDT                                    S01117
     C***********          END                                            S01117
     C*
     C**   READ AUDIT RECORD FROM PF-FOKEYA
     C*
     C                     READ FOKEYA                   40
     C*
     C**  IF - NOT A VALID RECORD
     C*
     C           *IN40     IFEQ '1'
     C           FRECI     ORNE 'T'
     C*
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE '20'      DBASE                           S01117
     C                     Z-ADD20        DBASE                           S01117
     C                     MOVEL'AUDIT'   DBKEY                           S01117
     C                     MOVE 'FOKEY'   DBFILE           ***DBERR 20***
     C                     OUT  LDA                                       S01117
     C                     EXSR DBERR
     C                     END
     C*
     C**   IF - CALCULATED NUMBER OF RECORDS DIFFERENT TO FILE TOTAL
     C**   OR - HASH TOTAL DIFFERENT TO FILE TOTAL
     C**         (FILE TOTALS FROM LF/FOKEYA)
     C*
     C           NUMREC    IFNE FNORE
     C           HASHI     ORNE FHRWN
     C           HASHD     ORNE FHRDC
     C*
     C                     SETON                     U812
     C*
     C**   END IF - NO. OF REC. OR HASH TOTAL DIFFERENT
     C*
     C                     END
     C*
     C**   DETERMINE IF TRAILER RECORD EXISTS ON PF-MGEFFZZ
     C*
     C           1         CHAINMGEFFZZ              40
     C*
     C           *IN40     IFEQ '0'
     C*
     C**   IF TRAILER EXISTS, FORMAT HASH TOTALS
     C*
     C           HRDC      DIV  1000      ZZAMT
     C           ZZAMT     ADD  HRWN      ZZAMT
     C                     Z-ADDOHRWN     ZZTOTI
     C                     Z-ADDOHRDC     ZZTOTD
     C                     EXSR ZZADD
     C*
     C**   MOVE FIELDS TO FILE FIELDS
     C*
     C                     ADD  PONUM     ONORE
     C                     Z-ADDZZTOTI    OHRWN
     C                     Z-ADDZZTOTD    OHRDC
     C*
     C**   AND UPDATE EXISTING RECORD
     C*
     C                     UPDATAPOSTZZF
     C*
     C**   OTHERWISE MOVE REQUIRED FIELDS TO OUTPUT
     C*
     C                     ELSE
     C*
     C                     MOVE 'T'       ORECI
     C                     ADD  1         PONUM
     C                     Z-ADDPONUM     ONORE
     C                     Z-ADDHRWN      OHRWN
     C                     Z-ADDHRDC      OHRDC
     C*
     C**   AND WRITE NEW TRAILER RECORD
     C*
     C                     WRITEAPOSTZZF
     C*
     C                     END
     C*
     C**   WRITE FILE CONTROL REPORT TO AUDIT REPORT
     C*
     C***********AKSI      IFEQ 'Y'                                       S01117
     C***********          WRITEASENDR                                    S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C***********          WRITEENDREP                                    S01117
     C*
     C                     WRITEFILECON
     C*                                                                   S01117
     C** WRITE NO DETAILS IF APPROPRIATE                                  S01117
     C*                                                                   S01117
     C           *INU4     IFNE '1'                                       S01117
     C                     WRITENOMAC                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN14     IFEQ '0'                                       S01117
     C           AKSI      ANDEQ'Y'                                       S01117
     C                     WRITENOACDT                                    S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR RCFAU                                     S01117
     C*                                                                   S01117
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT                                                              S01522
     C********************************************************************S01522
     C**  Subroutine SRPNAR determines the required narratives.         **S01522
     C********************************************************************S01522
     C           SRPNAR    BEGSR                           * S R P N A R *S01522
     C*                                                                   S01522
     C* Define the data structure parameter:                              S01522
     C*                                                                   S01522
     C           *LIKE     DEFN CGPNAR    ##PNAR                          S01522
     C           *LIKE     DEFN MNCUST    ##CUST                          S01522
     C           *LIKE     DEFN MNCYCD    ##CYCD                          S01522
     C           *LIKE     DEFN MNACCD    ##ACCD                          S01522
     C           *LIKE     DEFN MNACSQ    ##ACSQ                          S01522
     C           *LIKE     DEFN MNBRCA    ##BRCA                          S01522
     C           *LIKE     DEFN MNTRNO    ##TRNO                          S01522
     C           *LIKE     DEFN MNRACN    ##RACN                          S01522
     C           *LIKE     DEFN MNFFIN    ##FFIN                          S01522
     C           *LIKE     DEFN MNFFIC    ##FFIC                          S01522
     C           *LIKE     DEFN MNFFMK    ##FFMK                          S01522
     C           *LIKE     DEFN MNFFPD    ##FFPD                          S01522
     C           *LIKE     DEFN MNFFPC    ##FFPC                          S01522
     C           *LIKE     DEFN MNFFSP    ##FFSP                          S01522
     C*                                                                   S01522
     C                     CLEARCGPNAR                                    S01522
     C                     CLEAR##PRM1                                    086125
     C*                                                                   S01522
     C* If the facility is switched off or unavailable,                   S01522
     C*  or UDC is not installed, exit this subroutine:                   S01522
     C*                                                                   S01522
     C           FFPNAR    IFNE 'Y'                                       S01522
     C                     GOTO EXPNAR                                    S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C* Determine the customer's name:                                    S01522
     C*                                                                   S01522
     C           ##CUST    IFEQ *BLANKS                                   089252
     C           ##CUST    OREQ '000000'                                  089252
     C                     MOVE BICN      ##CUST                          089252
     C                     END                                            089252
     C                     MOVEL##CUST    ##KEY     P                     S01522
     C*                                                                   S01522
     C                     CALL 'AOCUSTR0'                                S01522
     C                     PARM           ##RTN   7                       S01522
     C                     PARM '*KEY   ' ##OPT   7                       S01522
     C                     PARM           ##KEY  10                       S01522
     C                     PARM           ##STS   7                       S01522
     C           SDCUST    PARM SDCUST    @DSSDY                          S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'SDCUSTPD'DBFILE             *************S01522
     C                     MOVEL'101'     DBASE              * DBERR 101 *S01522
     C                     MOVEL##KEY     DBKEY              *************S01522
     C                     EXSR DBERR                                     S01522
     C                     ENDIF                                          S01522
     C*                                                                ...S01522
     C* Determine the posting narrative using AOPNARR0:                   S01522
     C*                                                                   S01522
     C                     MOVE 'FF'      MNMODI                          S01522
     C                     MOVE ##CUST    MNCUST                          S01522
     C                     MOVE ##CYCD    MNCYCD                          S01522
     C                     MOVE ##ACCD    MNACCD                          S01522
     C                     MOVE ##ACSQ    MNACSQ                          S01522
     C                     MOVE ##BRCA    MNBRCA                          S01522
     C                     MOVE BOKC      MNBOKC                          S01522
     C                     MOVE BBCRNM    MNCRNM                          S01522
     C                     MOVELPNAR      MNNARR    P                     S01522
     C                     MOVE ##TRNO    MNTRNO                          S01522
     C                     MOVE ##RACN    MNRACN                          S01522
     C                     MOVE ##FFIN    MNFFIN                          S01522
     C                     MOVE ##FFIC    MNFFIC                          S01522
     C                     MOVE ##FFMK    MNFFMK                          S01522
     C                     MOVE ##FFPD    MNFFPD                          S01522
     C                     MOVE ##FFPC    MNFFPC                          S01522
     C                     MOVE ##FFSP    MNFFSP                          S01522
     C*                                                                   S01522
     C                     CALL 'AOPNARR0'                                S01522
     C                     PARM           ##RTN                           S01522
     C                     PARM           ##MGID  7                       S01522
     C                     PARM           ##PRM1                          086125
     C           CGPNAR    PARM CGPNAR    ##PNAR                          S01522
     C                     PARM           ##NARR 50                       S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'CGPNARPD'DBFILE             *************S01522
     C                     MOVEL'102'     DBASE              * DBERR 102 *S01522
     C                     MOVELMNCUST    DBKEY              *************S01522
     C                     EXSR DBERR                                     S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C                     MOVEL##NARR    PNAR      P                     S01522
     C*                                                                   S01522
     C           EXPNAR    TAG                             < EXPNAR       S01522
     C*                                                                   S01522
     C                     ENDSR                                          S01522
     C********************************************************************S01522
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   GETAS SR. - Subroutine to get the A/c Section from A/c code   *163551
     C*                FILE                                              *163551
     C********************************************************************163551
     C           GETAS     BEGSR                                          163551
     C**********           MOVE ACOD      WKACOD  4                                    163551 CGL029
     ** Call of AOACODR0 should be done only if ACOD is not equals to zero to prevent         247740
     ** database error 27.                                                                    247740
     **                                                                                       247740
     C           ACOD      IFNE 0                                                             247740
     C                     MOVE ACOD      WKACOD 10                                           CGL029
     C                     CALL 'AOACODR0'                                163551
     C                     PARM '*MSG   ' @RTCD                           163551
     C                     PARM '*KEY   ' @OPTN                           163551
     C**********           PARM WKACOD    @AFNB                                        163551 CGL029
     C                     PARM WKACOD    @AFNB                                               CGL029
     C********** SDACOD    PARM SDACOD    @DSFDY                                       163551 CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C**  IF - not a valid record                                         163551
     C           @RTCD     IFNE *BLANK                                    163551
     C           *LOCK     IN   LDA                                       163551
     C                     Z-ADD27        DBASE                           163551
     C                     MOVEL'SDACODPD'DBFILE           ***DBERR 27*** 163551
     C                     MOVEL@AFNB     DBKEY                           163551
     C                     MOVEL@OPTN     DBOPTN                          163551
     C                     OUT  LDA                                       163551
     C                     EXSR DBERR                                     163551
     C                     ENDIF                                          163551
     C                     ENDIF                                                              247740
     C                     ENDSR                                          163551
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*                                                                  *
     C**   DBERR SR. - Database Error Handling : Terminates program      *
     C*                                                                  *
     C********************************************************************
     C*
     C           DBERR     BEGSR
     C*                                                                   S01117
     C**   REPORT DATABASE ERROR TO P1 IF P1 CONTAINS DETAILS OUTPUT      S01117
     C*                                                                   S01117
     C           *IN51     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           LINE1     IFGT 56                                        S01117
     C           *IN53     ANDEQ'1'                                       S01117
     C           LINE1     ORLT 1                                         S01117
     C           *IN53     ANDEQ'1'                                       S01117
     C                     WRITEMAKYH                                     S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN53     IFEQ '1'                                       S01117
     C           LINE1     IFGT 55                                        086015
     C                     WRITEMAKYH                                     086015
     C                     END                                            086015
     C                     WRITEDBERRF1                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   REPORT DATABASE ERROR TO P2 IF P2 CONTAINS DETAILS OUTPUT      S01117
     C*                                                                   S01117
     C           *IN52     IFEQ '1'                                       S01117
     C*                                                                   S01117
     C           LINE2     IFGT 55                                        S01117
     C           *IN54     ANDEQ'1'                                       S01117
     C           LINE2     ORLT 1                                         S01117
     C           *IN54     ANDEQ'1'                                       S01117
     C                     WRITEACCSUMH                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN54     IFEQ '1'                                       S01117
     C           LINE1     IFGT 55                                        086015
     C                     WRITEACCSUMH                                   086015
     C                     END                                            086015
     C                     WRITEDBERRF2                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*
     C**   WRITE FILE=CONTROL=REPORT TO AUDIT REPORT
     C*
     C                     WRITEFILECON
     C                     WRITEFMT9001
     C                     EXSR RCFAU                                     S01117
     C                     SETON                     U7U8LR
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     RETRN
     C                     ENDSR
     C*
     C********************************************************************
**  CPY@
(c) Finastra International Limited 2001
**   MESS - MESSAGES FOR OUTPUT, TO LONG FOR FIELDS
OVER THE COUNTER
TRADING IMBALANCE
FF ACCRUAL SUMMARY
INTERNAL BOOK  -
**   NARTB1 - NARRATIVE CODES
FDFEFFFGFHFIFJ
**   NARTB2 - NARRATIVE DESCRIPTIONS
COMMISSION     CHARGES DUE    PREMIUM DUE    EXERCISE OPTION
MARGIN CALL    REALISED PROFITREALISED LOSS
**   NARCD - FUTURES AND OPTIONS NARRATIVE CODES                          E23097
01FAFBFCFDFEFFFGFHFIFJFKFLFMFNFO
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** Translation table for S01522 Message IDs (Exceptions only included)    S01522
FGF1                                                                      S01522
FHF2                                                                      S01522
FIF3                                                                      S01522
FJF4                                                                      S01522
FKF5                                                                      S01522
FLF6                                                                      S01522
FMF7                                                                      S01522
FNF8                                                                      S01522
FOF9                                                                      S01522
