     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Account keys generated today list')
     F********************************************************************
     F*                                                                  *
     F*  Midas - Futures and Options Module
     F*                                                                  *
     F*   FF0427  -  ACCOUNT KEYS GENERATED TODAY LIST                   *
     F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *  Last Amend No. 243826A            Date 25Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 185214             Date 22Mar01               *
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 150367             Date 07Apr00
      *                 138767             Date 23Mar00                  *
      * Midas DBA 3.00 Patch D ---------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
     F*                 163444             DATE 03AUG99                  *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 107293             DATE 09SEP96                  *
     F*                  CFF004             DATE 12SEP96                 *
     F*                  S71062             DATE 08JAN96                 *
     F*                   B9582             DATE 08JAN96                 *
     F*                  084565             DATE 13APR95                 *
     F*                  S01456             DATE 08NOV93                 *
     F*                  S01455             DATE 05NOV93                 *
     F*                  S01393             DATE 30OCT92                 *
     F*                  FUJI-FF0011        DATE 21SEP92                 *
     F*                  E44682 (FUJI-F00008)DATE 17SEP92                *
     F*                  AUS022             DATE 07AUG92                 *
     F*                  FO0131/E27380      DATE 25JUN91                 *
     F*                  FO0091/E26453      DATE 01MAY91                 *
     F*                  S01117             DATE 11APR90                 *
     F*                  E18343             DATE 11NOV89                 *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  185214 - Recompile over changed FFKEY1PD.                       *
      *  CFF006 - Fractional Ticks Enhancement.  (Recompiled)         *
      *  150367 - Recompile over changed /copy FFSTDPZ4.                 *
     F*  138767 - Overflow Error on printing Report End                  *
     F*           Apply Fix 107293 (P1/SYA)                              *
     F*  163444 - Y2K SORT ORDER                                      *
     F*  107293 - I/O ERRORS OCCUR BECAUSE NOT ENOUGH LINES ARE          *
     F*           RESERVED FOR TOTALS.                                   *
     F*  CFF004 - Increase in size of Price Fields,(Recompiled Only)     *
     F*  S71062 - FF/PM Interface (Just recompiled)                   *
     F*  B9582  - Include a parameter to mean if it is EOC or not     *
     F*   084565  -  Ensure P1 report is logged by RCF.                  *
     F*   S01456  -  'FF' MONTHLY P&L ENHANCEMENTS.                      *
     F*              Recompiled due to change to PF/MKCTLD.              *
     F*   S01455  -  'FF' ACCOUNT KEY ENHANCEMENTS.                      *
     F*              Recompiled due to changes in TABFF.                 *
     F*   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT            *
     F* FUJI-FF0011 - The system does not differentiate between          *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*               *** RECOMPILE ONLY ***                             *
     F*   E44682    - I/O errors occur because not enough lines are
     F*               reserved for totals.
     F*   AUS022  -  AUSTRALIAN CHANGE : Introduction of Processing      *
     F*              Types 7 and 8.                                      *
     F*   FO0131  -  Include profit centre on report details             *
     F*   FO0091  -  TOTALS LINE SHOULD REFLECT WHETHER FOR MARKET OR    *
     F*              POTENTIALLY FOR JUST PART OF THE OTC'S              *
     F*   S01117  -  MULTIBRANCHING                                      *
     F*   E18343  -  PROGRAM RE-COMPILED DUE TO CHANGE IN ZSRSRC         *
     F*              MEMBER ZFRPEDZ3                                     *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*     IGNDECERR(*NO)                                               *
     F*                                                                  *
     F********************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*FOKEY1**IF**E*****      K        DISK                              163444
     FFFKEY1PDIF  E           K        DISK                               163444
     FMARKT   IF  E           K        DISK
     FTABFF   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE
     F            TABTB20F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTB80F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F* CCY 1     TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLET2F                          KIGNORE
     FMKCTL   IF  E           K        DISK
     FINTYP2  IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYPD2F
     FINTYP   IF  E           K        DISK
     F*F0427P1O** E                    PRINTER                            S01117
     F***********                                   KINFDS PRINT          S01117
     FFF0427P1O   E                    PRINTER                        UC  S01117
     F                                              KINFDS SPOOL          S01117
     FFF0427AUO   E                    PRINTER                            S01117
     F                                              KINFDS SPOOLU         S01117
     F********************************************************************
     F*
     F*                FUNCTION OF INDICATORS
     F*
     F*      10      PROGRAM RUN IN INPUT CYCLE
     F*
     F*      11      NO DETAILS TO REPORT
     F*
     F*      12      ON - MULTIBRANCHING                                  S01117
     F*                                                                   S01117
     F*      13      ON - P1 HAS BEEN OPENED                              S01117
     F*                                                                   S01117
     F*      30      END OF FILE - INTYP
     F*
     F*      31      CHANGE IN BRANCH CODE                                S01117
     F*                                                                   S01117
     F*******32      END OF FILE - FOKEY1                           S01117163444
     F*      32      END OF FILE - FFKEY1PD                               163444
     F*                                                                   FO0091
     F*      33      1= not a market related account key                  FO0091
     F*              0= a market related account key                      FO0091
     F*                                                                   S01117
     F*      80-89   FF&O STANDARD SUB-ROUTINES
     F*
     F*      98      DATE FORMAT
     F*      99      READ TABTB10
     F*
     F* U7 & U8      DATABASE ERROR
     F*
     F*****************************************************************
     E                    CPY@    1   1 80
     E/EJECT
     E*****************************************************************
     E*
     E                    FULA       34  1
     E**   UNDERLINING
     E*
     E*****************************************************************
     E*
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E**   FOR CONVERTING A DAY NUMBER TO A DATE FORMAT
     E*
     E*****************************************************************
     E*
     E/COPY ZSRSRC,FFFMTZ1
     E*
     E**   FOR FORMATTING MARKET NAME AND DATE FOR REPORT HEADING
     E*
     E*****************************************************************
     E*
     E/COPY ZSRSRC,FFPRCSZ2
     E**   FOR CONVERTING FILE FORMAT PRICE TO SCREEN FORMAT
     E*
     E*****************************************************************
     E*
     E/COPY ZSRSRC,FFSTDPZ1
     E*
     E**   FOR CURRENCY DECIMAL PLACE SUBROUTINE
     E*
     E*****************************************************************
     E*
     E/COPY ZSRSRC,ZFRPEDZ1
     E*
     E**   FOR REPORT AMOUNT EDIT SUBROUTINE
     E*
     E*****************************************************************
     E*
     E*****************************************************************
     E/EJECT
     I*****************************************************************
     I*                                                                   FO0091
     IMKCTLDF                                                             FO0091
     I*                                                                   FO0091
      ** Rename of fields from lf/mkctl so that market field on the       FO0091
      ** control record does not overwrite the details from lf/fokey1     FO0091
     I*                                                                   FO0091
     I              MRKT                            MRKT#                 FO0091
     I*
     IINTYPD2F
     I*
      ** Rename of fields from INTYP
     I*
     I              ISTT                            ISTT2
     I              ISTI                            ISTI2
     I              ISPT                            ISPT2
     I              ISCY                            ISCY2
     I              QOTC                            QOTC2
     I              TKDM                            TKDM2
     I              MNPF                            MNPF2
     I              TKVL                            TKVL2
     I              OTHC                            OTHC2
     I*RINT****** DS                                                      S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I                                    B 367 3680LINE
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     ILDA         DS                            256
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 177 DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
     IINSTR       DS
     I                                        1   5 ISTTX
     I                                        1   2 MRKT
     I                                        3   5 ISTC
     I**
     IINSTRM      DS
     I                                        1   2 MRKTI
     I                                        3   3 DASH1
     I                                        4   6 ISTCI
     I                                        7   7 DASH2
     I                                        8  10 MNTH
     I                                       11  11 DASH3
     I                                       12  130YRNO
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      **  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      **  EXTERNAL DS FOR BRANCH DETAILS                                  S01117
     I              A8BRNM                          BRNM                  S01117
      *                                                                   S01117
     I@DSFDY    E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I*
     I*****************************************************************
     I*
     I/COPY ZSRSRC,FFSTDPZ2
     I*
     I**   FOR CURRENCY DECIMAL PLACE SUBROUTINE
     I*
     I*****************************************************************
     I*
     I/COPY ZSRSRC,ZFRPEDZ2
     I*
     I**   FOR REPORT AMOUNT EDIT SUBROUTINE
     I*
     I*****************************************************************
     I*
     I/COPY ZSRSRC,FFFMTZ2
     I*
     I**   FOR REPORT HEADING FORMAT SUBROUTINE
     I*
     I*****************************************************************
     I*
     I/COPY ZSRSRC,FFSRDSZ1
     I/COPY ZSRSRC,FFPRCSZ3
     I*
     I**   FOR REPORT PRICE FORMAT SUBROUTINE
     I*
     I*****************************************************************
     I/EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C********************************************************************
     C**
     C**   Receive Parameters
     C**
     C           *ENTRY    PLIST
     C                     PARM           MARKET  2
     C                     PARM           MKBIND  1                       B9582
     C********************************************************************
     C/EJECT
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*
     C********************************************************************
     C** INDEX OF SUBROUTINES
     C*
     C** INIT              INITIALISATION OF STANDARD FIELDS,
     C*********************ACCESS*OF*ICD1******************************   S01117
     C*
     C** BODY              READ A RECORD AND PROCESS
     C*
     C** END               END PROCESSING
     C*
     C** FOKEYR            PREPARE EACH RECORD FOR REPORT
     C*
     C** PAGES             PROCESS REPORT PAGES
     C*
     C** ACCESS            READ NEXT VALID RECORD
     C*
     C** ZDATE2            TO CONVERT DAY NUMBER TO DATE FORMATS
     C*
     C** FFSTDP            TO DETERMINE NO.OF CURRENCY DEC.PL.
     C*
     C** ZFRPED            TO EDIT MIDAS AMOUNT FIELDS FOR OUTPUT
     C**                    TO EXTERNALLY DESCRIBED PRINTER FILE
     C*
     C** FFFMT             TO FORMAT MARKET NAME AND DATE FOR REPORT
     C**                    HEADING
     C*
     C** FFPRCS            TO FORMAT A PRICE FROM FILE FORMAT TO
     C**                    SCREEN FORMAT
     C*                                                                   S01117
     C** RCFAU             TO SPOOL AU THROUGH RCF                        S01117
     C*                                                                   S01117
     C** RCFP1             TO SPOOL P1 THROUGH RCF                        S01117
     C*                                                                   S01117
     C** DBERR             TO HANDLE ABNORMAL ERROR CONDITIONS            S01117
     C*                                                                   S01117
     C** PRTAU             PRINT AUDIT REPORT                             S01117
     C*                                                                   S01117
     C** GETBNM            GET BRANCH NAME FROM ACCESS OBJECT             S01117
     C*
     C*****************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** MAIN PROCESS
     C*
     C********************************************************************
     C*
     C                     EXSR INIT
     C                     EXSR BODY
     C                     EXSR END
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C*****INIT*S/R*-*TO*INITIALISE*FIELDS,ACESS*ICD1******************   S01117
     C**   INIT S/R - TO INITIALISE FIELDS, ACCESS STANDING DATA          S01117
     C**   CALLED ONCE AT START OF PROGRAM FROM MAIN LINE
     C**   CALLS: FFFMT
     C*
     C********************************************************************
     C*
     C           INIT      BEGSR
     C*
     C***************************************************************
     C*
     C/COPY ZSRSRC,FFSTDPZ3
     C***********                                                         S01117
     C*******ACCESS*ICD1*FROM*TABLE*FILE*******************************   S01117
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
     C*                                                                   S01117
     C*    INITIALISE LOCAL DATA AREA                                     S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANK    DBFILE                          S01117
     C                     MOVE *BLANK    DBKEY                           S01117
     C                     MOVE *BLANK    DBPGM                           S01117
     C                     MOVEL'FF0427  'DBPGM                           S01117
     C                     Z-ADD0         DBASE                           S01117
     C                     OUT  LDA                                       S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C*    CHECK FOR MULTIBRANCHING INDICATOR                             S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     MOVE '1'       *IN12                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    @DSFDY                          S01117
     C***********                                                         S01117
     C*****DB*ERROR*IF*RECORD*NOT*FOUND********************************   S01117
     C***********                                                         S01117
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C***********                                                         S01117
     C***********          SETON                     U7U8                 S01117
     C*
     C**   UPDATE LDA
     C*
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C***********          MOVE *BLANKS   DBKEY                           S01117
     C***********          MOVE '01'      DBASE            ***DBERR 01*** S01117
     C***********          MOVE 'TABFF'   DBFILE                          S01117
     C***********          MOVEL'01    '  TABKY  12                       S01117
     C***********          MOVE '    10'  TABKY                           S01117
     C***********          MOVELTABKY     DBKEY                           S01117
     C                     MOVEL'SDBANKPD'DBFILE           ***************S01117
     C                     MOVEL@OPTN     DBKEY            **DB ERROR 01**S01117
     C                     MOVEL@OPTN     DBOPTN  7        ***************S01117
     C                     Z-ADD1         DBASE                           S01117
     C                     OUT  LDA
     C***********          WRITEFMTP101                                   S01117
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C                     END
     C*
     C**  CHECK FOR DATE FORMAT
     C*
     C           DATF      COMP 'M'                      98
     C*                                                                   B9582
     C           MKBIND    IFEQ 'Y'                                       B9582
     C                     MOVE *ON       *IN20                           B9582
     C                     END                                            B9582
     C*
     C**  IF INPUT PARAMETER IS NOT BLANK, SET ON INDICATOR TO DISPLAY
     C**  FORMATTED HEADING
     C           MARKET    IFNE *BLANK
     C*
     C                     MOVE '1'       *IN10
     C*
     C**  ACCESS LF/MARKT FOR MARKET NAME
     C*
     C           MARKET    CHAINMARKT                99
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C***********          SETON                     U7U8                 S01117
     C*
     C**   UPDATE LDA
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C                     MOVELMARKET    DBKEY
     C***********          MOVE '02'      DBASE            ***DBERR 02*** S01117
     C                     Z-ADD2         DBASE            ***DBERR 02*** S01117
     C                     MOVE 'MARKT'   DBFILE
     C                     OUT  LDA
     C***********          WRITEFMTP101                                   S01117
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C*
     C**  ELSE MOVE MARKET NAME TO INPUT FIELD FOR STANDARD SR. FFFMT
     C                     ELSE
     C*
     C                     MOVE MKTN      FFNAM
     C                     END
     C*
     C**  ACCESS LF/MKCTL FOR BUSINESS DATE
     C           MARKET    CHAINMKCTL                99
     C*
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C*
     C***********          SETON                     U7U8                 S01117
     C*
     C**   UPDATE LDA
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C                     MOVELMARKET    DBKEY
     C***********          MOVE '03'      DBASE            ***DBERR 03*** S01117
     C                     Z-ADD3         DBASE            ***DBERR 03*** S01117
     C                     MOVE 'MKCTL'   DBFILE
     C                     OUT  LDA
     C***********          WRITEFMTP101                                   S01117
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C*
     C**  ELSE FORMAT BUSINESS DATE USING STANDARD SR. ZDATE2
     C                     ELSE
     C*
     C                     MOVE BUSD      ZDAYNO
     C                     EXSR ZDATE2
     C*
     C**  MOVE BUSINESS DATE TO INPUT FIELD FOR STANDARD SR. FFFMT
     C                     MOVE ZADATE    FFDAT
     C                     END
     C*
     C**  USE STANDARD SR. FFFMT TO FORMAT MARKET CENTRE NAME AND
     C**  BUSINESS DATE FOR REPORT HEADING
     C                     EXSR FFFMT
     C*
     C**  SET UP UNDERLINING FOR HEADING; INITIALISE ARRAY INDEX
     C                     Z-ADD0         Y       20
     C*
     C**  FFULIN RETURNED FROM SR. FFFMT CONTAINS NUMBER OF CHARACTERS
     C**  FOR UNDERLINING
     C           Y         DOUEQFFULIN
     C                     ADD  1         Y
     C                     MOVEA'-'       FULA,Y
     C                     END
     C*
     C**  MOVE UNDERLINE ARRAY TO OUTPUT FIELD
     C                     MOVEAFULA      FULINE
     C                     END
     C***********                                                         S01117
     C****OUTPUT*REPORT*HEADING*******************************************S01117
     C***********          WRITEFMTP101                                   S01117
     C*
     C**  INITIALISE CURRENCY WORK FIELD AND TOTALS FIELDS
     C                     MOVE *BLANK    CCYW    3
     C                     Z-ADD0         MKTTOT
     C***********          Z-ADD0         ACKTOT                          S01117
     C                     Z-ADD0         AUDTOT                          S01117
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   BODY S/R TO READ A RECORD AND PROCESS
     C**   CALLED FROM MAIN PROCESSING
     C**   CALLS: ACCESS
     C**          FOKEYR
     C*
     C*****************************************************************
     C*
     C           BODY      BEGSR
     C*
     C**   POSITION FILE BEFORE RECORDS FOR MARKET INPUT AS PARAMETER
     C**   OR IF PROGRAM CALLED FOR ALL MARKETS, POSITION AT
     C**   BEGINNING OF FILE
     C*
     C***********          MOVE *BLANK    KFOKEY  5                       S01117
     C***********          MOVELMARKET    KFOKEY                          S01117
     C***********KFOKEY    SETLLFOKEY1               30                   S01117
     C*                                                                   S01117
     C************LOVAL    SETLLFOKEY1               30             S01117163444
     C************         READ FOKEY1                   30         S01117163444
     C           *LOVAL    SETLLFFKEY1PD             30                   163444
     C                     READ FFKEY1PD                 30               163444
     C                     MOVELISTT      ISTTX                           S01117
     C*                                                                   S01117
     C           MARKET    IFNE *BLANK                                    S01117
     C           *IN30     DOWEQ'0'                                       S01117
     C           MARKET    ANDNEMRKT                                      S01117
     C***********          READ FOKEY1                   30         S01117163444
     C                     READ FFKEY1PD                 30               163444
     C                     MOVELISTT      ISTTX                           S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C*
     C**   IF - END OF FILE, NO VALID RECORDS
     C*
     C           *IN30     IFEQ '1'
     C*
     C**      - OUTPUT NO RECORDS TO REPORT TEXT
     C*
     C***********          WRITEFMTP105                                   S01117
     C*
     C**  SET ON NO DETAILS TO REPORT INDICATOR
     C*
     C                     MOVE '1'       *IN11
     C*
     C                     ELSE
     C***********                                                         S01117
     C****READ*RECORD*FROM*FOKEY1**************************************   S01117
     C***********                                                         S01117
     C***********          READ FOKEY1                   30               S01117
     C***********                                                         S01117
     C*****SET*UP*ISTTX*FOR*MARKET*************************************   S01117
     C***********                                                         S01117
     C***********          MOVELISTT      ISTTX                           S01117
     C*
     C**  IF PROGRAM CALLED WITH MARKET AS INPUT PARAMETER,
     C**  CHECK THAT RECORD READ IS FOR MARKET INPUT
     C*
     C           MARKET    IFNE *BLANK
     C*
     C           MARKET    IFNE MRKT
     C*
     C**  IF RECORD IS NOT FOR THIS MARKET, SET ON NO DETAILS
     C**  TO REPORT INDICATOR, WRITE NO DETAILS TO REPORT FORMAT
     C**  AND SET ON END OF FILE INDICATOR
     C*
     C                     MOVE '1'       *IN11
     C***********          WRITEFMTP105                                   S01117
     C                     MOVE '1'       *IN30
     C*
     C                     END
     C                     END
     C*
     C**  IF END OF FILE INDICATOR SET OFF, PROCESS RECORD
     C**  FROM FOKEY1
     C*
     C           *IN30     IFEQ '0'
     C*
     C**   INITIALISE MARKET WORK FIELD
     C**   AND BRANCH CODE                                                S01117
     C                     MOVE MRKT      MRKTW   2
     C                     MOVE BRCA      BRCAW   3                       S01117
     C*
     C**   ELSE - SET UP FIELDS FOR OUTPUT
     C*
     C                     EXSR FOKEYR
     C*
     C**   END IF/ELSE - NOT END OF FILE
     C*
     C                     END
     C                     END
     C*
     C**   END SUB-ROUTINE - BODY
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   END S/R FOR END PROCESSING
     C**   CALLED FROM MAIN PROCESSING
     C*
     C*****************************************************************
     C*
     C           END       BEGSR
     C*
     C**    IF PROGRAM CALLED IN CLOSE OF BUSINESS
     C           *IN10     IFEQ '0'
     C*
     C**    IF DETAILS HAVE BEEN OUTPUT, OUTPUT TOTALS FOR LAST MARKET
     C**    PROCESSED AND TOTAL ACCOUNT KEYS GENERATED
     C           *IN11     IFEQ '0'
     C*
     C**    CHECK IF PAGE IS FULL
     C           LINE      IFGT 56
     C                     WRITEFMTP101
     C                     END
     C*
     C**    OUTPUT MARKET TOTALS FORMAT
     C                     EXSR ENDFMT                                    FO0091
     C                     WRITEFMTP103
     C***********                                                         S01117
     C******CHECK*IF*PAGE*IS*FULL**************************************   S01117
     C***********LINE      IFGT 52                                        S01117
     C***********          WRITEFMTP101                                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C******OUTPUT*TOTAL*ACCOUNT*KEYS*FORMAT***************************   S01117
     C***********          WRITEFMTP104                                   S01117
     C*
     C**    OUTPUT END OF REPORT MESSAGE
     C*
     C                     MOVELBRCAW     BRCA                            S01117
     C*                                                                   E44682
     C**    CHECK IF PAGE IS FULL                                         E44682
     C           LINE      IFGT 56                                        E44682
     C                     WRITEFMTP101                                   E44682
     C                     END                                            E44682
     C*                                                                   E44682
     C                     WRITEFMTP106
     C                     EXSR PRTAU                                     S01117
     C                     EXSR RCFAU                                     S01117
     C*
     C**    ELSE NO DETAILS HAVE BEEN OUTPUT
     C                     ELSE
     C***********                                                         S01117
     C******CHECK*IF*PAGE*IS*FULL**************************************   S01117
     C***********LINE      IFGT 56                                        S01117
     C***********          WRITEFMTP101                                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C******OUTPUT*END*OF*REPORT*MESSAGE*******************************   S01117
     C***********                                                         S01117
     C***********          WRITEFMTP106                                   S01117
     C                     EXSR PRTAU                                     S01117
     C                     EXSR RCFAU                                     S01117
     C                     END
     C*
     C**    ELSE PROGRAM CALLED IN INPUT CYCLE
     C                     ELSE
     C*
     C**    IF DETAILS HAVE BEEN OUTPUT, OUTPUT TOTALS FOR MARKET
     C**    PROCESSED
     C           *IN11     IFEQ '0'
     C*
     C**  CHECK WHETHER PAGE IS FULL
     C           LINE      IFGE 52
     C                     WRITEFMTP101
     C                     END
     C*
     C**  WRITE MARKET TOTALS FORMAT
     C                     EXSR ENDFMT                                    FO0091
     C                     WRITEFMTP103
     C*
     C**    OUTPUT END OF REPORT MESSAGE
     C*
     C                     MOVELBRCAW     BRCA                            S01117
      *                                                                   138767
      **    CHECK IF PAGE IS FULL                                         138767
      *                                                                   138767
     C           LINE      IFGT 56                                        138767
     C                     WRITEFMTP101                                   138767
     C                     END                                            138767
      *                                                                   138767
     C                     WRITEFMTP106
     C                     EXSR PRTAU                                     S01117
     C                     EXSR RCFAU                                     S01117
     C*
     C**    ELSE NO DETAILS HAVE BEEN OUTPUT
     C                     ELSE
     C***********                                                         S01117
     C******CHECK*IF*PAGE*IS*FULL**************************************   S01117
     C***********LINE      IFGT 56                                        S01117
     C***********          WRITEFMTP101                                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C******OUTPUT*END*OF*REPORT*MESSAGE*******************************   S01117
     C***********                                                         S01117
     C***********          WRITEFMTP106                                   S01117
     C                     EXSR PRTAU                                     S01117
     C                     EXSR RCFAU                                     S01117
     C                     END
     C                     END
     C*
     C                     SETON                     LR
     C*
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**    FOKEYR S/R TO PREPARE EACH RECORD FOR REPORT
     C**    CALLED FROM SR.BODY
     C**    CALLS: PAGES
     C*
     C*****************************************************************
     C*
     C           FOKEYR    BEGSR
     C*
     C**   DOW NOT END OF FILE
     C*
     C*                                                                   S01117
     C**   NEW BRANCH CODE                                                S01117
     C                     MOVEL'1'       *IN31                           S01117
     C*                                                                   S01117
     C           *IN30     DOWEQ'0'
     C*                                                                   S01117
     C**   OPEN NEW SPOOL FILE FOR EACH BRANCH                            S01117
     C*                                                                   S01117
     C           *IN31     IFEQ '1'                                       S01117
     C                     Z-ADD0         PAGE3                           S01117
     C                     OPEN FF0427P1                                  S01117
     C                     MOVEL'1'       *IN13                           S01117
     C   12                EXSR GETBNM                                    S01117
     C                     WRITEFMTP101                                   S01117
     C                     MOVEL'0'       *IN31                           S01117
     C*                                                                   084565
     C**   ENSURE P1 SPOOL FILE RECORDED BY RCF                           084565
     C                     EXSR RCFP1                                     084565
     C*                                                                   084565
     C                     END                                            S01117
     C*
     C**   PROCESS RECORDS FOR EACH PAGE
     C*
     C                     EXSR PAGES
     C*
     C**  IF MARKET INPUT AS PARAMETER
     C           *IN10     IFEQ '1'
     C*
     C**  IF MARKET ON THIS RECORD NOT EQUAL TO INPUT PARAMETER
     C           MARKET    IFNE MRKT
     C*                                                                   S01117
     C**  CHECK FOR THE SAME MARKET FOR ANOTHER BRANCH                    S01117
     C*                                                                   S01117
     C***********          READ FOKEY1                   32         S01117163444
     C                     READ FFKEY1PD                 32               163444
     C                     MOVELISTT      ISTTX                           S01117
     C*                                                                   S01117
     C           *IN32     DOWEQ'0'                                       S01117
     C           MARKET    ANDNEMRKT                                      S01117
     C***********          READ FOKEY1                   32         S01117163444
     C                     READ FFKEY1PD                 32               163444
     C                     MOVELISTT      ISTTX                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           *IN32     IFEQ '1'                                       S01117
     C*
     C**  SET ON END OF FILE INDICATOR SINCE THERE ARE NO MORE RECORDS
     C**  TO PROCESS
     C                     MOVE '1'       *IN30
     C*
     C                     END                                            S01117
     C                     END
     C                     END
     C*
     C**   IF - NEW PAGE AND NOT END OF FILE
     C*
     C           *IN30     IFNE '1'
     C*                                                                   S01117
     C**    IF NEW PAGE BECAUSE NEW BRANCH CODE BEING PROCESSED,          S01117
     C**    WRITE MARKET TOTALS FORMAT                                    S01117
     C           BRCA      IFNE BRCAW                                     S01117
     C                     MOVE '1'       *IN31                           S01117
     C*                                                                   S01117
     C**   CHECK IF PAGE IS FULL                                          S01117
     C           LINE      IFGT 56                                        S01117
     C                     WRITEFMTP101                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE BRCA      BRCAW2  3                       S01117
     C                     MOVE BRCAW     BRCA                            S01117
     C*                                                                   S01117
     C                     EXSR ENDFMT                                    FO0091
     C                     WRITEFMTP103                                   S01117
      *                                                                   107293
      **  CHECK IF PAGE IS FULL                                           107293
      *                                                                   107293
     C           LINE      IFGT 56                                        107293
     C                     WRITEFMTP101                                   107293
     C                     END                                            107293
      *                                                                   107293
     C                     WRITEFMTP106                                   S01117
     C************         EXSR RCFP1                               S01117084565
     C                     CLOSEFF0427P1                                  S01117
     C                     MOVEL'0'       *IN13                           S01117
     C*                                                                   S01117
     C                     MOVE BRCAW2    BRCA                            S01117
     C                     Z-ADD0         MKTTOT                          S01117
     C*                                                                   S01117
     C**    STORE BRANCH & MARKET IN WORK FIELD                           S01117
     C                     MOVE BRCA      BRCAW                           S01117
     C                     MOVE MRKT      MRKTW                           S01117
     C                     END                                            S01117
     C*
     C**    IF NEW PAGE BECAUSE NEW MARKET BEING PROCESSED,
     C**    WRITE MARKET TOTALS FORMAT
     C           MRKT      IFNE MRKTW
     C*
     C**   CHECK IF PAGE IS FULL
     C           LINE      IFGT 56
     C                     WRITEFMTP101
     C                     END
     C*
     C                     EXSR ENDFMT                                    FO0091
     C                     WRITEFMTP103
     C*
     C                     Z-ADD0         MKTTOT
     C*
     C**    STORE MARKET IN WORK FIELD
     C                     MOVE MRKT      MRKTW
     C                     END
     C*                                                                   S01117
     C**    IF SAME BRANCH                                                S01117
     C           *IN31     IFEQ '0'                                       S01117
     C*
     C**      - OUTPUT NEW PAGE HEADINGS
     C*
     C                     WRITEFMTP101
     C*                                                                   S01117
     C*    END IF - SAME BRANCH                                           S01117
     C                     END                                            S01117
     C*
     C**   END IF - NEW PAGE
     C*
     C                     END
     C*
     C**   END DOW - NOT END OF FILE
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - FOKEYR
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   PAGES S/R TO PROCESS REPORT PAGES
     C**   CALLED FROM SR.FOKEYR
     C**   CALLS: FFPRCS
     C**          ZDATE2
     C**          FFSTDP
     C**          ZFRPED
     C**          ACCESS
     C*
     C*****************************************************************
     C*
     C           PAGES     BEGSR
     C*
     C**  DOW NOT END OF FILE OR NOT NEW PAGE OR NOT NEW MARKET
     C**  OR NOT NEW BRANCH                                               S01117
     C*
     C           *IN30     DOWNE'1'
     C           LINE      ANDLT58
     C           MRKT      ANDEQMRKTW
     C           BRCA      ANDEQBRCAW                                     S01117
     C*
     C**  IF INSTRUMENT TYPE IS BLANK, MOVE BLANK TO INSTRUMENT
     C**  NAME AND STRIKE PRICE ON REPORT
     C           ISTTX     IFEQ *BLANK
     C                     MOVE *BLANK    INSTRM
     C                     MOVE *BLANK    RSTRP
     C*
     C                     ELSE
     C*
     C**  ACCESS INTYP FOR INSTRUMENT DETAILS
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           ISTTX     CHAININTYP                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C                     MOVELISTTX     DBKEY
     C***********          MOVE '04'      DBASE            ***DBERR 04*** S01117
     C                     Z-ADD4         DBASE            ***DBERR 04*** S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     OUT  LDA
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C                     END
     C*
     C**  IF THE INSTRUMENT IS NOT AN OTC
     C*
     C           ISTI      IFNE 'Y'
     C*
     C**  SET UP DETAILS FOR OUTPUT TO REPORT
     C**  SET UP INSTRUMENT DETAILS
     C*
     C**   SET UP CONSTANT FIELDS FOR INSTRUMENT DETAILS
     C                     MOVE '-'       DASH1
     C                     MOVE '-'       DASH2
     C                     MOVE '-'       DASH3
     C                     MOVE MRKT      MRKTI
     C                     MOVE ISTC      ISTCI
     C                     MOVE ZMNM,MTHN MNTH
     C*
     C                     ELSE
     C*
     C** MOVE THE INSTRUMENT TYPE (OTC CODE) INTO THE INSTRUMENT
     C** DETAILS FIELD FOR OUTPUT.
     C*
     C                     MOVE *BLANKS   INSTRM
     C                     MOVELISTT      INSTRM
     C                     END
     C*
     C**  IF OPTION, ACCESS INTYP2 USING FUTURE REFERENCE FOR
     C**  UNDERLYING INSTRUMENT - EXCEPT IF IT IS AN OTC               g ins
     C**  IF RECORD NOT FOUND, DATABASE ERROR
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C           ISTI      IFNE 'Y'
     C                     MOVE ISTT      ISTTX
     C                     MOVE FTRF      ISTC
     C           ISTTX     CHAININTYP2               99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C                     MOVELISTTX     DBKEY
     C***********          MOVE '05'      DBASE            ***DBERR 05*** S01117
     C                     Z-ADD5         DBASE            ***DBERR 05*** S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     OUT  LDA
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C                     END
     C*
     C                     END
     C*
     C**  FORMAT STRIKE PRICE
     C                     Z-ADDSTRP      FFPRIC
     C*
     C** IF OTC TAKE DETAILS FROM INTYP
     C*
     C           ISTI      IFEQ 'Y'
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     ELSE
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C                     END
     C*
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RSTRP
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANKS   RSTRP
     C                     MOVE *BLANKS   PCAL
     C*
     C                     END
     C                     END
     C*
     C**  FORMAT TRANSACTION NUMBER
     C*
     C                     MOVE *BLANK    RTNBR
     C*
     C           TNBR      IFLT 0
     C                     MOVE '-'       RTNBR
     C                     Z-SUBTNBR      WTNBR   60
     C                     MOVELWTNBR     RTNBR
     C                     END
     C*
     C           TNBR      IFGT 0
     C                     MOVELTNBR      RTNBR
     C                     END
     C*
     C**  FORMAT CLOSE OUT NUMBER
     C*
     C                     MOVE *BLANK    RCLON
     C*
     C           CLON      IFNE 0
     C                     MOVELCLON      RCLON
     C                     END
     C*
     C**  FORMAT CUSTOMER BROKER CODE
     C*
     C                     MOVE *BLANK    RCBCD
     C*
     C********** CBCD      IFNE 0                                                             CSD027
     C           CBCD      IFNE *BLANKS                                                       CSD027
     C                     MOVE CBCD      RCBCD
     C                     END
     C*
     C**  FORMAT VALUE DATE USING STANDARD SR. ZDATE2
     C           VDAT      IFNE RUND
     C                     MOVE VDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RVDAT
     C                     ELSE
     C                     MOVE RUNA      RVDAT
     C                     END
     C*
     C**  IF CURRENCY HAS CHANGED, EXECUTE STANDARD SR. FFSTDP TO
     C**  DETERMINE NUMBER OF DECIMAL PLACES FOR CURRENCY
     C           CCY       IFNE CCYW
     C                     MOVE CCY       FFCCY
     C*
     C                     EXSR FFSTDP
     C*
     C**  CHECK FOR DATABASE ERROR
     C           *IN89     IFEQ '1'
     C           *LOCK     IN   LDA
     C***********          MOVEL'FF0427  'DBPGM                           S01117
     C                     MOVE *BLANKS   DBKEY
     C***********          MOVE '06'      DBASE            ***DBERR 06*** S01117
     C                     Z-ADD6         DBASE            ***DBERR 06*** S01117
     C                     MOVELFFCKY     DBKEY
     C                     MOVE 'TABFF'   DBFILE
     C                     OUT  LDA
     C***********          WRITEFMTP107                                   S01117
     C                     SETON                     U7U8LR
     C                     EXSR DBERR                                     S01117
     C                     RETRN
     C                     END
     C*
     C**  STORE CURRENCY
     C                     MOVE CCY       CCYW
     C                     END
     C*
     C**  FORMAT EVENT AMOUNT USING STANDARD SR. ZFRPED
     C                     Z-ADDFFCDP     ZDECS
     C                     Z-ADDEAMT      ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    REAMT
     C*
     C**  OUTPUT REVERSAL INDICATOR
     C           REVI      IFEQ 1
     C                     MOVE 'REV'     RREVI
     C                     ELSE
     C                     MOVE '   '     RREVI
     C                     END
     C*                                                                   FO0131
     C**  OUTPUT PROFIT CENTRE                                            FO0131
     C*                                                                   FO0131
     C                     MOVE PRFC      RPRFC                           FO0131
     C*
     C**   OUTPUT INSTRUMENT DETAIL LINE
     C*
     C                     WRITEFMTP102
     C*
     C**   ADD ONE TO MARKET AND ACCOUNT KEYS TOTALS
     C*
     C                     ADD  1         MKTTOT
     C***********          ADD  1         ACKTOT                          S01117
     C                     ADD  1         AUDTOT                          S01117
     C*
     C**   READ NEXT INSTRUMENT
     C*
     C                     EXSR ACCESS
     C*
     C**    IF NOT END OF FILE
     C*
     C           *IN30     IFNE '1'
     C*
     C**    SET UP ISTTX FOR MARKET
     C*
     C                     MOVELISTT      ISTTX
     C                     END
     C*
     C**   END DOW - NOT END OF FILE OR NOT NEW PAGE
     C*
     C                     END
     C*
     C**   END SUB-ROUTINE - BODY
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**   ACCESS S/R TO READ NEXT VALID RECORD
     C**   CALLED FROM SR.`S - BODY, PAGES
     C*
     C*****************************************************************
     C**
     C*    SUB-ROUTINE ACCESS - READ NEXT VALID RECORD
     C*
     C           ACCESS    BEGSR
     C*
     C***********          READ FOKEY1                   30               163444
     C                     READ FFKEY1PD                 30               163444
     C*
     C           *IN30     DOWNE'1'
     C           RECI      ANDNE'D'
     C***********          READ FOKEY1                   30               163444
     C                     READ FFKEY1PD                 30               163444
     C                     END
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C** ZDATE2 TO CONVERT DAY NUMBER TO DATE FORMAT
     C/COPY ZSRSRC,ZDATE2Z2
     C/EJECT
     C/COPY ZSRSRC,FFSTDPZ4
     C/EJECT
     C/COPY ZSRSRC,ZFRPEDZ3
     C/EJECT
     C/COPY ZSRSRC,FFFMTZ3
     C/EJECT
     C/COPY ZSRSRC,FFPRCSZ4
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** RCFAU  -- SUBROUTINE TO SPOOL AU THROUGH RCF                     S01117
     C** CALLED FROM: DBERR                                               S01117
     C** CALLS: NOTHING                                                   S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFAU     BEGSR                           ** RCFAU  **   S01117
     C*                                                                   S01117
     C**      ENSURE AU SPOOL FILE RECORDED BY RCF                        S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANK    SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** RCFAU  **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** RCFP1  -- SUBROUTINE TO SPOOL P1 THROUGH RCF                     S01117
     C** CALLED FROM: DBERR                                               S01117
     C** CALLS: NOTHING                                                   S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           RCFP1     BEGSR                           ** RCFP1  **   S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C**      ENSURE P1 SPOOL FILE RECORDED BY RCF                        S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM BRCA      SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C**  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** RCFP1  **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** DBERR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C** CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C** CALLS: PRTAU                                                     S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           DBERR     BEGSR                           ** DBERR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  OUTPUT DATABASE ERROR IF P1 HAS BEEN OPENED                     S01117
     C*                                                                   S01117
     C           *IN13     IFEQ '1'                                       S01117
     C                     WRITEFMTP107                                   S01117
      *                                                                   138767
      **    CHECK IF PAGE IS FULL                                         138767
      *                                                                   138767
     C           LINE      IFGT 56                                        138767
     C                     WRITEFMTP101                                   138767
     C                     END                                            138767
      *                                                                   138767
     C                     WRITEFMTP106                                   S01117
     C************         EXSR RCFP1                               S01117084565
     C                     END                                            S01117
     C*                                                                   S01117
     C                     EXSR PRTAU                                     S01117
     C                     EXSR RCFAU                                     S01117
     C*                                                                   S01117
     C                     ENDSR                           ** DBERR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C/EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** PRTAU --- SUBROUTINE TO PRINT AUDIT REPORT                       S01117
     C** CALLED FROM: BEFORE TERMINATION OF PROGRAM                       S01117
     C** CALLS: NOTHING                                                   S01117
     C**                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           PRTAU     BEGSR                           ** PRTAU **    S01117
     C*                                                                   S01117
     C                     WRITEFMTAU01                                   S01117
     C                     WRITEFMTAU02                                   S01117
     C*                                                                   S01117
     C**    NO DETAILS TO REPORT                                          S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '0'                                       S01117
     C           *IN11     ANDEQ'1'                                       S01117
     C                     WRITEFMTAU04                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**    DATABASE ERROR                                                S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     WRITEFMTAU03                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** PRTAU **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C**    GETBNM --- SUBROUTINE TO GET BRANCH NAME FROM AO              S01117
     C**    CALLED FROM: FOKEY1                                           S01117
     C**    CALLS: NOTHING                                                S01117
     C**                                                                  S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           GETBNM    BEGSR                           ** GETGNM **   S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL*BLANK    BRNM                            S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVELBRCA      DBKEY                           S01117
     C                     Z-ADD7         DBASE            ***DBERR 07*** S01117
     C                     MOVEL@OPTN     DBOPTN  7                       S01117
     C                     OUT  LDA                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     WRITEFMTP101                                   S01117
     C                     EXSR DBERR                                     S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** GETBNM **   S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT
     C********************************************************************STRDBG
     C**                                                                  FO0091
     C** ENDFMT CHECKS TO SEE WHICH TOTAL LINE SHOULD BE PRINTED          FO0091
     C**                                                                  FO0091
     C** CALLED FROM : END                                                FO0091
     C********************************************************************FO0091
     C           ENDFMT    BEGSR                                          FO0091
     C*                                                                   FO0091
     C** IF THIS REPORT IS FOR ALL MARKETS                                FO0091
     C*                                                                   FO0091
     C           *IN10     IFEQ '0'                                       FO0091
     C           MRKTW     CHAINMKCTL                99                   FO0091
     C*                                                                   FO0091
     C** IF *IN99 IS ON THEN THE REPORT PAGE IS FOR OTC DETAILS OR        FO0091
     C** OTHER NON MARKET SPECIFIC DETAILS EG. MARGINS                    FO0091
     C*                                                                   FO0091
     C           *IN99     IFEQ '1'                                       FO0091
     C                     SETON                     33                   FO0091
     C                     ELSE                                           FO0091
     C*                                                                   FO0091
     C** OTHERWISE IT IS FOR A SPECIFIC MARKET                            FO0091
     C*                                                                   FO0091
     C                     SETOF                     33                   FO0091
     C                     END                                            FO0091
     C                     END                                            FO0091
     C                     ENDSR                                          FO0091
     C********************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
