     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas FF Customer confirmations')
     F********************************************************************
     F*                                                                  *
     F*  Midas  -  Futures and Options Module                            *
     F*                                                                  *
     F*   FF0580  -  CUSTOMER CONFIRMATIONS                              *
     F*                                                                  *
     F*  (c) Finastra International Limited 2001                         *
     F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Prev Amend No. 243826A            Date 25Jan07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD053             Date 01Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CFF007             Date 13Feb01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 124246             Date 30Nov99               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 Patch E ------------------------------------------*
      *                 171172             Date 25Nov99               *
      * Midas DBA 3.00 ---------------- Base ----------------------------*
     F*                  CFF004             DATE 18SEP96                 *
     F*                  S71062             DATE 19DEC95                 *
     F*                  087284             DATE 01JUN95                 *
     F*                  084174             DATE 02MAR95                 *
     F*                  S01455             DATE 05NOV93                 *
     F*                  047565             DATE 08FEB94                 *
     F*                  S01411             DATE 16APR93                 *
     F*                  S01393             DATE 30OCT92                 *
     F*                  FUJI-FF0011        DATE  10AUG92                *
     F*                  AUS022             DATE  07AUG92                *
     F*                  FO0018             DATE  10JAN91                *
     F*                  CFE001             DATE  12OCT90                *
     F*                  S01299             DATE  05SEP90                *
     F*                  E22130             DATE  22JUN90                *
     F*                  E20526             DATE  03MAY90                *
     F*                  S01117             DATE  03APR90                *
     F*                  E18343             DATE  11NOV89                *
     F*                  E15904             DATE  14SEP89                *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade        *
      *         - (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFF007 - Futures and Options Enhancement for Private Banking *
      *  CFF006 - Fractional Ticks Enhancement.  (Recompiled)         *
     F*   124246 - Apply existing fix #115453, which completes fixes     *
     F*            #087284 and #084174: If CORA is equal to blanks,      *
     F*            set it to 'B'.                                        *
     F*   171172 - Recompile over changed POSTNCD/POSTNKD                *
     F*   CFF004 - Increase in size of Price Fields,(Recompiled Only)    *
     F*   S71062 - FF/PM Interface (Just recompiled)                     *
     F*   087284 - Use AOCUSTR0 to retrieve address reference B          *
     F*   084174 - Use AOALTNR0 to retrieve alternative addresses        *
     F*   S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                        *
     F*            Recompiled due to changes in file TABFF.              *
     F*   047565 - Incorrect number of contracts and price is being      *
     F*            carried from the previous Month/Year when there       *
     F*            is no transactions for the current Month/Year.        *
     F*                                                                  *
     A*   S01411 - RECOMPILED BECAUSE 'ORIGINAL ENTRY DATE' HAS BEEN     *
     A*            ADDED TO TRANSD.                                      *
     F*   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT            *
     F* FUJI-FF0011 - The system does not differentiate between          *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*               *** RECOMPILE ONLY ***                             *
     F*  AUS022  -  AUSTRALIAN CHANGE : Introduction of Processing       *
     F*             Types 7 and 8.                                       *
     F*  FO0018  -  APPLY MULTIBRANCHING CHANGES (S01117) FULLY.         *
     F*  CFE001  -  For each settlement account record read from         *
     F*             lf/tsccy2 and where associated position details are  *
     F*             to be output on the confirmation initialise the page *
     F*             counter to zero and start at the top of a new page.  *
     F*  S01299  -  ALLOW 32 MARKET CENTRES AS PER ORIGINAL SPECIFICATION*
     F*  E22130  -  TRADE SUMMARY NOT PRINTED IF LAST INSTR. PROCESSED   *
     F*             FOR A CUSTOMER IS OTC - OUTPUT TRADE SUMMARY IF ANY  *
     F*             INSTRUMENT PROCESSED IS MARKET INSTRUMENT.           *
     F*          -  UPDATE TOTAL PROFIT/LOSS, COMMISSION ETC FOR TRADE   *
     F*             SUMMARY ONLY FOR MARKET INSTRUMENTS - OTC TRADES     *
     F*             COMFIRMATIONS ARE PRODUCED SEPERATELY.               *
     F*  E20526  -  RECOMPILED OVER CHANGED FILE PRICS1                  *
     F*  S01117  -  MULTIBRANCHING                                       *
     F*  E18343  -  PROGRAM RE-COMPILED DUE TO CHANGE IN ZSRSRC MEMBER   *
     F*             ZFRPEDZ3                                             *
     F*  E15904  -  CONDITIONS PRINTER OUTPUT TO ONLY MKT INSTRUMENTS    *
     F*             (& MOVES FIRST OUTPUT TO WITHIN S/R POSTNR)          *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*     IGNDECERR(*YES)                                              *
     F******OVRDBF*****FILE(POCHG5X)*TOFILE(POCHG5)                      *S01299
     F*                                                                  *
     F********************************************************************
     FTSCCY2  UP  E           K        DISK
     F*
     FTABFF   IF  E           K        DISK
     F**ICD*1*****TABTB10F**************************KIGNORE***************S01117
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE
     F            TABTB20F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTB80F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F* CCY 1     TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F**BRANCH****TABLETRF**************************KIGNORE***************S01117
     F            TABLETRF                          KIGNORE               S01117
     F            TABLET2F                          KIGNORE
     F*
     F*CCNT***IF* E           K        DISK                               S01117
     F*********** ACCNTAAF                          KIGNORE               S01117
     F*********** ACCNTACF                          KIGNORE               S01117
     FPOSTNC1 UF  E           K        DISK
     F*POCHG5**UF**E***********K        DISK                              S01299
     F*********** POCHGRCF                          KIGNORE               S01299
     F*POCHG5X*UF**E***********K        DISK                              S01299
     F************POCHGTCF                          KIGNORE               S01299
     F************POCHGCCF                          KIGNORE               S01299
      *                                                                   S01299
     FPOCHG5C UF  E           K        DISK                               S01299
     FPOCHG5T UF  E           K        DISK                               S01299
     FPOCHG5R UF  E           K        DISK                               S01299
      *                                                                   S01299
     F*********** CLINT   IF  E           K        DISK                   084174
     F*********** CLINTCAF                          KIGNORE               084174
     F*********** CLINTCBF                          KIGNORE               084174
     F*********** CLINTC1F                          KIGNORE               084174
     FMARKT   IF  E           K        DISK
     FINTYP   IF  E           K        DISK
     FINTYP2  IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYPD2F
     FPRICS1  IF  E           K        DISK
     FTRANS2  IF  E           K        DISK
     FTRSET1  IF  E           K        DISK
     FFOCLT   IF  E           K        DISK
     F*
     FFF0580P1O   E                    PRINTER                        UC
     F***********                                   KINFDS PRINT          S01117
     F                                              KINFDS SPOOL          S01117
     FFF0580AUO   E                    PRINTER                            S01117
     F                                              KINFDS SPOOLU         S01117
     FCNFRPD  O   E           K        DISK                      A
      /SPACE 2
     F********************************************************************
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*             L3   CHANGE OF BRANCH ON TSCCY2
     F*             L2   CHANGE OF BUSTOMER/BROKER CODE ON TSCCY2
     F*             L1   CHANGE OF CURRENCY ON TSCCY2
     F*
     F*    01            POCHGRC RECORD
     F*    02            POCHGCC RECORD
     F*    03            POCHGTC RECORD
     F*
     F*        15        OPEN OF P1 INDICATOR                             S01117
     F*                                                                   S01117
     F*        20        FIRST CYCLE INDICATOR
     F*
     F*        25        FOR THE ATTENTION OF NON BLANK
     F*        26        If = 1 print header before next set of conf      CFE001
     F*                  details are output.                              CFE001
     F*
     F*        28        Either B/F and/or C/F position not zero          047565
     F*        30        UNREALISED P/L FOR INSTRUMENT IS NON-ZERO
     F*
     F*        50        POSTNC1 END OF FILE
     F*********51        POCHG5 END OF FILE                               S01299
     F*********52        POCHG5X END OF FILE                              S01299
     F*        51        POCHG5C OR POCHG5T END OF FILE                   S01299
     F*        52        POCHG5R END OF FILE                              S01299
     F*        53        POCHG5C END OF FILE                              S01299
     F*        54        POCHG5T END OF FILE                              S01299
     F*
     F*        60        MULTIBRANCHING INDICATOR                         S01117
     F*                                                                   S01117
     F*        60        AT LEAST ONE MARKET INSTRUMENT FOUND FOR CUST.   E22130
     F*                    - CONDITIONS OUTPUT OF TRADE SUMMARY REPORT    E22130
      *    62         CFF007 is switched on                           *   CFF007
     F*                                                                   E22130
     F*     80-89        Reserved for Standard FF Subroutines
     F*
     F*     90-99        Reserved for Standard MIDAS Subroutines
     F*
     F*        99        GENERAL CHAIN/READ FAIL INDICATOR FOR DB ERRORS
     F*
     F*     U7+U8        Database Errors
     F*
     F********************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E********************************************************************
      /COPY ZSRSRC,ZFRPEDZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,FFPRCSZ2
     E                    CY        150  3
     E* CURRENCIES
     E                    DP        150  1 0
     E* CURRENCY DECIMAL PLACES
     E                    NM        150 20
     E* CURRENCY NAMES
     E                    MSG     1   2 20
     E* REPORT LITERALS
     E                    MTH    12  12  3
     E* MONTH ABBREVIATIONS
      /EJECT
     I********************************************************************
     ITSCCYDF
     I*
      ** Level break descriptions for Branch, Customer/broker and Currency
      ** and rename of fields
     I*
     I***********                                   BRCD  L3              S01117
     I                                              BRCA  L3              S01117
     I                                              CBCD  L2
     I                                              CCY   L1
     I              SETP                            SETPTS
     I              SEBR                            SEBRTS                S01117
     I              SBID                            SBIDTS                S01117
     I              SETA                            SETATS
     I              FACO                            FACOTS
     I              CNOS                            CNOSTS
     I*CCNTABF***                                                         S01117
     I***********                                                         S01117
     I***Rename*of*fields*on*ACCNT****************************************S01117
     I***********                                                         S01117
     I***********   BRCD                            BRCDAT                S01117
     IPOSTNCDF
     I*
      ** Rename of fields on POSTNC1
     I*
     I***********   BRCD                            BRCDPC                S01117
     I              BRCA                            BRCDPC                S01117
     I              CBCD                            CBCDPC
     I              LSDA                            LSDAPC
     I              LTDA                            LTDAPC
     IPOCHGRCF    01
     I*
      ** Rename of fields on POCHGRC
     I*
     I***********   BRCD                            BRCDPG                S01117
     I**********    BRCA                            BRCD            S01117FO0018
     I              BRCA                            BRCAPG                FO0018
     I              CBCD                            CBCDPG
     I              ISCY                            ISCYPG
     I              ISTT                            ISTTPG
     I              YRNO                            YRNOPG
     I              MTHN                            MTHNPG
     I              PCAL                            PCALPG
     I              STRP                            STRPPG
     IPOCHGCCF    02
     I*
      ** Rename of fields on POCHGCC
     I*
     I***********   BRCD                            BRCDPG                S01117
     I***********   BRCA                            BRCDPG          S01117S01299
     I**************CBCD                            CBCDPG                S01299
     I**************ISCY                            ISCYPG                S01299
     I**************ISTT                            ISTTPG                S01299
     I**************YRNO                            YRNOPG                S01299
     I**************MTHN                            MTHNPG                S01299
     I**************PCAL                            PCALPG                S01299
     I**************STRP                            STRPPG                S01299
     I**************                                                      S01299
      ***Rename*Close*out*number*to*transaction*number*as*it*refers*to*oneS01299
     I**************                                                      S01299
     I**************CLON                            TNBR                  S01299
      *                                                                   S01299
     I              RECI                            RECIC                 S01269
     I              BRCA                            BRCAC                 S01299
     I              CBCD                            CBCDC                 S01299
     I              ISTT                            ISTTC                 S01299
     I              YRNO                            YRNOC                 S01299
     I              MTHN                            MTHNC                 S01299
     I              PCAL                            PCALC                 S01299
     I              STRP                            STRPC                 S01299
     I              POCD                            POCDC                 S01299
      *                                                                   S01299
      *  Rename Close out number to transaction number as it refers to oneS01299
      *                                                                   S01299
     I              CLON                            TNBRC                 S01299
      *                                                                   S01299
     I              RLPL                            RLPLC                 S01299
     I              ISCY                            ISCYC                 S01299
     I              AOSI                            AOSIC                 S01299
     I              ATCI                            ATCIC                 S01299
     I              PUPI                            PUPIC                 S01299
     I              REVI                            REVIC                 S01299
     IPOCHGTCF    03
     I*
      ** Rename of fields on POCHGTC
     I*
     I***********   BRCD                            BRCDPG                S01117
     I***********   BRCA                            BRCDPG          S01117S01299
     I**************CBCD                            CBCDPG                S01299
     I**************ISCY                            ISCYPG                S01299
     I**************ISTT                            ISTTPG                S01299
     I**************YRNO                            YRNOPG                S01299
     I**************MTHN                            MTHNPG                S01299
     I**************PCAL                            PCALPG                S01299
     I**************STRP                            STRPPG                S01299
     I*
     I              RECI                            RECID
     I              BRCA                            BRCAD                 S01299
     I              CBCD                            CBCDD                 S01299
     I              ISTT                            ISTTD                 S01299
     I              YRNO                            YRNOD                 S01299
     I              MTHN                            MTHND                 S01299
     I              PCAL                            PCALD                 S01299
     I              STRP                            STRPD                 S01299
     I              POCD                            POCDD                 S01299
     I              TNBR                            TNBRD                 S01299
     I              PCGT                            PCGTD                 S01299
     I              POCQ                            POCQD                 S01299
     I              PCGA                            PCGAD                 S01299
     I              ISCY                            ISCYD                 S01299
     I              AOSI                            AOSID                 S01299
     I              ATCI                            ATCID                 S01299
     I              PUPI                            PUPID                 S01299
     I              PAYI                            PAYID                 S01299
     I              REVI                            REVID                 S01299
     IINTYPD2F
     I*
      ** Rename of fields from INTYP
     I*
     I              ISTT                            ISTT2
     I              ISTI                            ISTI2
     I              ISPT                            ISPT2
     I              ISCY                            ISCY2
     I              QOTC                            QOTC2
     I              TKDM                            TKDM2
     I              MNPF                            MNPF2
     I              TKVL                            TKVL2
     I              OTHC                            OTHC2
     ITRANSDF
     I*
      ** Rename of fields on TRANS2
     I*
     I***********   BRCD                            BRCDT                 S01117
     I              BRCA                            BRCDT                 S01117
     I              ISCY                            ISCYT
     I              ISTT                            ISTTT
     I              YRNO                            YRNOT
     I              MTHN                            MTHNT
     I              PCAL                            PCALT
     I              STRP                            STRPT
      /COPY ZSRSRC,ZFRPEDZ2
      /COPY ZSRSRC,FFSRDSZ1
      /COPY ZSRSRC,FFPRCSZ3
     I*
     IISTTX       DS
     I*  DATASTRUCTURE TO SPLIT INSTRUMENT CODE INTO MARKTE & CODE
     I                                        1   2 MRKTI
     I                                        3   5 INSTC
     I***********                                                         S01117
     I*TIDX****** DS                             18                       S01117
     I***DATASTRUCTURE*TO*SPLIT*ACCOUNT*CODE*INTO*EDITED*FORM*************S01117
     I***********                             1   6 CUSTRX                S01117
     I***********                             7   7 DSH1                  S01117
     I***********                             8  10 CURRX                 S01117
     I***********                            11  11 DSH2                  S01117
     I***********                            12  15 ACDEX                 S01117
     I***********                            16  16 DSH3                  S01117
     I***********                            17  18 ASEQX                 S01117
     I***********                                                         S01117
     I*TIDX****** DS                                                      S01117
     I***DATASTRUCTURE*TO*SPLIT*ACCOUNT*CODE*INTO*EDITED*FORM*&*FOR*KEY***S01117
     I***********                             1   60CUSTRA                S01117
     I***********                             7   9 CURRA                 S01117
     I***********                            10  130ACDEA                 S01117
     I***********                            14  150ASEQA                 S01117
     I*
     ITBKEY       DS                             12
     I*  DATASTRUCTURE TO ACCESS TABLE FILES
     I                                        1   2 TBK1
     I                                        9  12 TBK2
     I*
     I*RINT****** DS                                                      S01117
     I***DS*FOR*LINE*NO.*TO*HANDLE*OVERFLOW*******************************S01117
     I*                                                                   S01117
     I** FILE INFORMATION DATA STRUCTURE                                  S01117
     I*                                                                   S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I                                    B 367 3680LINE
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*  LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   S01117
     I** DATA AREA RUNDAT                                                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   CFF007
      ** External data structure for SAR details                          CFF007
     ISCSARD    E DSSCSARDPD                                              CFF007
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      **  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      ** EXTERNAL DS FOR BRANCHES DETAILS                                 S01117
      *                                                                   S01117
     I@DSFDY    E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I**                                                                  S01117
     I*                                                                   S01299
     I*___________________________________________________________________084174
     I* 084174                                                            084174
     I*                                                                   084174
     I***P#CORR    E DSCGCORRPD                                     084174087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#ALTN    E DSSDALTNPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#CUSD    E DSSDCUSTPD                                              087284
     I              QQDFAC                          QQDFC1                                    CGL029
     I*                                                                   087284
     I* Data structure for returned values from AOCUSTR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     I* 084174                                                            084174
     I*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~084174
     I*                                                                   087284
     IDSSDY     E DSDSSDY                                                 087284
     I*                                                                   087284
     I** Second DS for access programs, Long data structure               087284
     IPCHG5C      DS                                                      S01299
     I*  Data structure to compare position change date,trans. no.        S01299
     I*  and reversal on lf-pochg5c                                       S01299
     I                                    P   1   30POCDC                 S01299
     I                                        4   90TNBRC                 S01299
     I                                       10  100REVIC                 S01299
     I*                                                                   S01299
     IPCHG5T      DS                                                      S01299
     I*  Data structure to compare position change date,trans. no.        S01299
     I*  and reversal on lf-pochg5t                                       S01299
     I                                    P   1   30POCDD                 S01299
     I                                        4   90TNBRD                 S01299
     I                                       10  100REVID                 S01299
     I*                                                                   S01299
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     C********************************************************************
     C*
      ** POSTNC1 KEY LIST
     C*
     C           POSTNK    KLIST
     C***********          KFLD           BRCD                            S01117
     C                     KFLD           BRCA                            S01117
     C                     KFLD           CBCD
     C                     KFLD           CCY
     C*
      ** POCHG5 KEY LIST
     C*
     C           POCHGK    KLIST
     C***********          KFLD           BRCD                            S01117
     C                     KFLD           BRCA                            S01117
     C                     KFLD           CBCD
     C                     KFLD           ISTT
     C                     KFLD           YRNO
     C                     KFLD           MTHN
     C                     KFLD           PCAL
     C                     KFLD           STRP
     C*
      ** PRICES FILE KEY
     C*
     C           PRICSK    KLIST
     C                     KFLD           ISTT
     C                     KFLD           YRNO
     C                     KFLD           MTHN
     C                     KFLD           PCAL
     C                     KFLD           STRP
     C*
      ** CLINT FILE KEY
     C*
     C********** *LIKE     DEFN CNUM      CUST                            084174
     C********** *LIKE     DEFN RCDT      TYPE                            084174
     C**********                                                          084174
     C********** CLINTK    KLIST                                          084174
     C**********           KFLD           CUST                            084174
     C**********           KFLD           TYPE                            084174
     C***********                                                         S01117
     C***ACCOUNTS*FILE*KEY************************************************S01117
     C***********                                                         S01117
     C***********ATIDK     KLIST                                          S01117
     C***********          KFLD           CUSTRA                          S01117
     C***********          KFLD           CURRA                           S01117
     C***********          KFLD           ACDEA                           S01117
     C***********          KFLD           ASEQA                           S01117
     C********************************************************************
      /EJECT
     C********************************************************************
      **             M A I N   P R O C E S S I N G
     C********************************************************************
     C*
      ** IF first cycle indicator is off
      **     Perform Initial processing
     C*
     C           *IN20     IFEQ '0'
     C                     EXSR INIT
     C                     END
     C*                                                                   S01117
      ** COUNT NO. OF TSCCY2 RECORDS READ                                 S01117
     C*                                                                   S01117
     C                     ADD  1         COUNT                           S01117
     C*
      ** IF Indicator L3 is on
      *******Access*TABLETR*for*branch************************************S01117
      **     ACCESS SDBRCHPD FOR BRANCH                                   S01117
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL3     IFEQ '1'
     C                     CLOSEFF0580P1                                  S01117
     C                     OPEN FF0580P1                                  S01117
     C                     SETON                     15                   S01117
     C*                                                                   S01117
     C                     Z-ADD0         PAGE                            S01117
     C*                                                                   S01117
     C*  GET BRANCH DETAILS IF MBIN = 'Y'                                 S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C***********          MOVE *BLANKS   TBKEY                           S01117
     C***********          MOVE '10'      TBK1                            S01117
     C***********          MOVE BRCD      TBK2                            S01117
     C***********TBKEY     CHAINTABLETRF             99                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                          S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C***********          MOVELTBKEY     DBKEY            ***************S01117
     C                     MOVEL@DSNB     DBKEY            ***************S01117
     C                     Z-ADD1         DBASE            * DB ERROR 01 *
     C                     MOVEL*BLANKS   BRNM   30        *             *S01117
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C                     MOVELA8BRNM    BRNM                            S01117
     C*                                                                   S01117
     C                     MOVE BRCA      BRCAZ   3                       S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     MOVE *BLANK    BRCAZ                           S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      **   ENSURE REPORT SPOOL FILE RECORDED BY RCF                       S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM BRCAZ     SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C*
      ** IF Indicator L2 is on
      **     Access CLINT for Customer/broker
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL2     IFEQ '1'
     C***********          MOVE CBCD      CUST                            084174
     C*
      ** Access FOCLT for correspondence address
     C           CBCD      CHAINFOCLT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'FOCLT'   DBFILE
     C                     MOVELCBCD      DBKEY            ***************
     C                     Z-ADD2         DBASE            * DB ERROR 02 *
     C                     EXSR DBERR                      ***************
     C                     END
      *                                                                   124246
      **  If correspondence address is blank, set it to 'B',              124246
      *                                                                   124246
     C           CORA      IFEQ *BLANK                                    124246
     C                     MOVE 'B'       CORA                            124246
     C                     END                                            124246
     C*
      ** If correspondence address not blank, access CLINT for
      ** alternate name/address
      ** This test is not necessary, see above test                       124246
      *                                                                   124246
     C*****      CORA      IFNE *BLANK                                    124246
     C**********           MOVE CORA      TYPE                            084174
     C********** CLINTK    CHAINCLINT                99                   084174
     C**********           END                                            084174
     C*                                                                   084174
     C* Retrieve correspondent details from CGCORRPD via AOALTNR0:        084174
     C*                                                                   084174
     C                     MOVELCBCD      P#CUST                          084174
     C*                                                                   084174
     C                     MOVEL*BLANKS   P#CUS1                          087284
     C                     MOVELCBCD      P#CUS1                          087284
      *                                                                   087284
      * If address reference is B use AOCUSTRO else AOALTNR0              087284
      *                                                                   087284
     C           CORA      IFEQ 'B'                                       087284
     C                     CALL 'AOCUSTR0'             9090               087284
     C                     PARM *BLANKS   P#RTCD  7                       087284
     C                     PARM '*KEY   ' P#OPTN  7                       087284
     C                     PARM           P#CUS1 10                       087284
     C                     PARM *BLANKS   P#KYST  7                       087284
     C           P#CUSD    PARM *BLANKS   DSSDY                           087284
      *                                                                   087284
     C           *IN90     IFEQ '1'                                       087284
     C           *LOCK     IN   LDA                                       087284
     C                     MOVEL'AOCUSTR0'DBFILE           ***************087284
     C                     MOVELP#CUS1    DBKEY            * DB ERROR 13 *087284
     C                     Z-ADD13        DBASE            ***************087284
     C                     OUT  LDA                                       087284
     C                     EXSR DBERR                                     087284
     C********             ELSE                                 087284    124246
     C                     END                                            124246
     C                     MOVELBBCNA1    CNA1                            087284
     C                     MOVELBBCNA2    CNA2                            087284
     C                     MOVELBBCNA3    CNA3                            087284
     C                     MOVELBBCNA4    CNA4                            087284
     C********             END                                  087284    124246
     C                     ELSE                                           087284
     C                     CALL 'AOALTNR0'                                084174
     C                     PARM *BLANKS   P#RTCD  7        B:Return code  084174
     C                     PARM '*KEY   ' P#OPTN  7        I:Option       084174
     C                     PARM           P#CUST  6        I:Customer no. 084174
     C                     PARM CORA      P#ADCD  1        I:Address code 084174
     C***********P#CORR    PARM P#CORR    @DSFDY           O:Format 084174087284
     C           P#ALTN    PARM P#ALTN    @DSFDY           O:Format       087284
     C********             ENDIF                                087284    124246
     C*                                                                   084174
     C           P#RTCD    IFEQ *BLANKS                                   084174
     C***********          MOVELCDADD1    CNA1                      084174087284
     C***********          MOVELCDADD2    CNA2                      084174087284
     C***********          MOVELCDADD3    CNA3                      084174087284
     C***********          MOVELCDADD4    CNA4                      084174087284
     C                     MOVELBCCNA1    CNA1                            087284
     C                     MOVELBCCNA2    CNA2                            087284
     C                     MOVELBCCNA3    CNA3                            087284
     C                     MOVELBCCNA4    CNA4                            087284
     C                     ENDIF                                          084174
     C                     ENDIF                                          084174
     C*
     C*********** If record not found or correspondence address is blank, 084174
     C***********  access CLINT for name/address                          084174
     C********** *IN99     IFEQ '1'                                       084174
     C********** RECI      ORNE 'D'                                       084174
     C********** CORA      OREQ *BLANK                                    084174
     C**********                                                          084174
     C***********          MOVE 'B'       TYPE                            084174
     C********** CLINTK    CHAINCLINT                99                   084174
     C***********                                                         084174
     C********** *IN99     IFEQ '1'                                       084174
     C********** RECI      ORNE 'D'                                       084174
     C********** *LOCK     IN   LDA                                 084174S01117
     C***********          MOVE 'CLINT'   DBFILE                          084174
     C***********          MOVELCBCD      DBKEY            ***************084174
     C***********          Z-ADD3         DBASE            * DB ERROR 03 *084174
     C***********          EXSR DBERR                      ***************084174
     C***********          END                                            084174
     C***********          END                                            084174
     C*                                                                   084174
     C**Retrieve*correspondent details from CGCORRPD via AOALTNR0:  084174087284
     C***********                                                   084174087284
     C***********P#RTCD    IFNE *BLANKS                             084174087284
     C***********CORA      OREQ *BLANK                              084174087284
     C***********          MOVE 'B'       P#ADCD                    084174087284
     C***********          MOVELCBCD      P#CUST                    084174087284
     C***********                                                   084174087284
     C***********          CALL 'AOALTNR0'                          084174087284
     C***********          PARM *BLANKS   P#RTCD           B:Return 084174087284
     C***********          PARM '*KEY   ' P#OPTN           I:Option 084174087284
     C***********          PARM           P#CUST           I:Custom 084174087284
     C***********          PARM           P#ADCD           I:Addres 084174087284
     C***********P#CORR    PARM P#CORR    @DSFDY           O:Format 084174087284
     C***********                                                   084174087284
     C***********P#RTCD    IFEQ *BLANKS                             084174087284
     C***********          MOVELCDADD1    CNA1                      084174087284
     C***********          MOVELCDADD2    CNA2                      084174087284
     C***********          MOVELCDADD3    CNA3                      084174087284
     C***********          MOVELCDADD4    CNA4                      084174087284
     C***********          ENDIF                                    084174087284
     C***********          ENDIF                                    084174087284
     C*
     C                     END
     C*
      ** IF Indicator L1 is on
      **     Access TABTG10 for currency
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL1     IFEQ '1'
     C*
     C           C2        IFLT 1
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELCCY       DBKEY            ***************
     C                     Z-ADD4         DBASE            * DB ERROR 04 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C           CCY       LOKUPCY,C2                    21
     C*
     C           *IN21     IFEQ '1'
     C                     Z-ADDDP,C2     CDP
     C                     MOVE NM,C2     CCNM
     C                     END
     C*
     C           *IN21     IFEQ '0'
     C                     MOVE *BLANKS   TBKEY
     C                     MOVE '20'      TBK1
     C                     MOVE '1'       TBK2
     C                     MOVELCCY       TBK2
     C           TBKEY     CHAINTABTG10F             99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELTBKEY     DBKEY            ***************
     C                     Z-ADD5         DBASE            * DB ERROR 05 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C           C1        SUB  1         C1
     C*
      **   MOVE CURRENCY AND NO. OF DECIMAL PLACES INTO ARRAYS
     C*
     C                     MOVE CCY       CY,C1
     C                     Z-ADDCDP       DP,C1
     C                     MOVE CCNM      NM,C1
     C*
     C                     END
     C*
     C                     Z-ADDC1        C2
     C*
     C                     END
     C*
     C***Re-set*page*number*count*to*one**********************************S01117
     C***Write*headings*to*FF0580P1***************************************S01117
      ** Perform POSTNC1-records
      ** Write trading summary
     C*
     C***********          Z-ADD0         PAGE                            S01117
     C           FTAO      COMP *BLANK               2525
     C*                                                                   E15904
     C*********************WRITEFMTP101                                   E15904
      *                                                                   CFE001
      ** Seton indicator 26 to cause a header to be printed if any        CFE001
      ** confirmation details are to be output for the current            CFE001
      ** settlement account record on lf/tsccy2.                          CFE001
      *                                                                   CFE001
     C                     SETON                     26                   CFE001
     C*                                                                   E15904
     C                     EXSR POSTNC
     C*                                                                   E15904
      **  OUTPUT TRADE SUMMARY IF AT LEAST ON MARKET INSTRUMENT IS READ   E22130
     C*                                                                   E22130
     C***********ISTI      IFEQ 'N'                                 E15904E22130
     C           *IN60     IFEQ '1'                                       E22130
     C                     EXSR TRDSUM
     C                     END                                            E15904
     C*                                                                   E15904
      *
      ** Update last telex/confirm bal, date and telex/confirm req ind
      ** on TSCCY2
      *
     C***********          MOVE CLBL      BFTB                            S01117
     C                     MOVE RUND      LTDA
     C                     MOVE ' '       TLCI
     C                     EXCPTTSUPD
     C*
     C*  WRITE AUDIT REPORT                                               S01117
     C*                                                                   S01117
     CLR                   EXSR WRITAU                                    S01117
     C********************************************************************
      /EJECT
     C********************************************************************
      **               INDEX TO SUBROUTINES
     C*
      ** POSTNC    READ THROUGH POSTNC1 FILE FOR A RECORD FROM TSCCY2
     C*
      ** POSTNR    PROCESS THE POSTNC1 RECORD AND ACCESS POCHG5 & POCHG5X
      **                                     (MARKET INSTRUMENT)
     C*
      ***POCHGX****READ*THROUGH*THE*POCHG5X*FILE*FOR*A*POSTNC1*DETAIL     S01299
      *  PCRVAL    TO READ THROUGH THE POCHG5R FILE FOR A POSTNC1 DETAIL  S01299
     C*
      *                                                                   S01299
      ** POCHGR    PROCESS A POCHG5 RECORD FOR A TRANSACTION
      *                                                                   S01299
      ** SELECT - Select the record from pochg5c and pochg5t with the     S01299
      **          lower key value for processing and move the values      S01299
      **          from the record selected into work fields.              S01299
     C*
      ** CHGTRN    PRINT TRANSACTION DETAILS FOR A POCHG5 RECORD
      **                                     (MARKET INSTRUMENT)
     C*
      ** CHGDTE    PERFORM CHANGE OF POSITION CHANGE DATE PROCESSING
      **                                     (MARKET INSTRUMENT)
     C*
      ** TRDSUM    PRINT TRADING SUMMARY
     C*
      ** POSTN1    ACCESS POCHG5 & POCHG5X FOR OTC RECORD
     C*
      ** POCHGO    READ THROUGH THE POCHG5 FILE FOR A POSTNC1 DETAIL(OTC)
     C*
      ** CHGTR1    OUTPUT TRANSACTION DETAILS FOR A POCHG5 RECORD (OTC)
     C*
      ** CHGDT1    PERFORM CHANGE OF POSITION CHANGE DATE PROCESSING (OTC)
     C*
      ** INIT      PERFORM FIRST CYCLE ONLY CALCULATIONS
     C*
      ** DBERR     PERFORM DATABASE ERROR EXIT FROM PROGRAM
     C*
      ** WRITAU    PERFORM PRINTING OF AUDIT REPORT                       S01117
     C*                                                                   S01117
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R POSTNC TO READ THROUGH POSTNC1 FILE FOR A RECORD FROM TSCCY2
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS POSTNR; ZFRPED; ZDATE2; FFPRCS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POSTNC    BEGSR
     C*                                                                   E22130
      ** INITIALIZE MARKET INSTRUMENT BEING READ INDICATOR                E22130
     C*                                                                   E22130
     C                     SETOF                     60                   E22130
     C*                                                                   E22130
     C*
      ** Access POSTNC1 for this Branch/Customer/Currency
     C*
     C           POSTNK    SETLLPOSTNC1
     C           POSTNK    READEPOSTNC1                  50
     C*
      ** DO WHILE Not end of file
      ** AND Same Branch/Customer/Currency as TSCCY2
     C*
     C           *IN50     DOWEQ'0'
     C*
      **     Access INTYP for instrument details
      **     IF no record found,
      **     OR record not live
      **          Perform Database-error
     C*
     C                     MOVE ISTT      ISTTO
     C           ISTT      CHAININTYP                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELISTT      DBKEY            ***************
     C                     Z-ADD7         DBASE            * DB ERROR 07 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*                                                                   E22130
      **     SET ON MARKET INSTRUMENT BEING READ INDICATOR                E22130
     C*                                                                   E22130
     C           ISTI      IFEQ 'N'                                       E22130
     C                     SETON                     60                   E22130
     C                     END                                            E22130
     C*
      **     IF Market instrument
      **     AND market has changed, access markt
     C*
     C                     MOVE ISTT      ISTTX
     C*
     C           MRKTI     IFNE MRKT
     C           ISTI      ANDEQ'N'
     C                     MOVE MRKTI     MRKT
     C           MRKT      CHAINMARKT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MARKT'   DBFILE
     C                     MOVELMRKT      DBKEY            ***************
     C                     Z-ADD8         DBASE            * DB ERROR 08 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C                     END                                            S01117
     C*                                                                   S01117
     C           ISTI      IFEQ 'N'                                       S01117
     C*                                                                   S01117
     C**********           WRITEFMTP101                            E15904 CFE001
     C*
     C                     END
     C*
      **         IF Option
      **         Access INTYP2 using Future reference for underlying ins
      **             IF no record found,
      **             OR record not live
      **                  Perform Database-error
     C*
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C           ISTI      ANDEQ'N'
     C                     MOVE FTRF      INSTC
     C           ISTTX     CHAININTYP2               99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELISTTX     DBKEY            ***************
     C                     Z-ADD9         DBASE            * DB ERROR 09 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C                     END
     C*
      **     DO WHILE Same instrument
      **          Save year month put/call/strike price
     C*
     C           *IN50     DOWEQ'0'
     C           ISTT      ANDEQISTTO
     C*
     C                     Z-ADDYRNO      YRNOO
     C                     Z-ADDMTHN      MTHNO
     C                     MOVE PCAL      PCALO
     C                     Z-ADDSTRP      STRPO
     C                     MOVE '0'       *IN28                           047565
     C*
      **          DO WHILE Same year/month/put call
      **              & strike price
     C*
     C           *IN50     DOWEQ'0'
     C           ISTT      ANDEQISTTO
     C           YRNO      ANDEQYRNOO
     C           MTHN      ANDEQMTHNO
     C           PCAL      ANDEQPCALO
     C           STRP      ANDEQSTRPO
      *
      ** IF the record is a market instrument
      *
     C           ISTI      IFEQ 'N'
     C*
     C*
      **                   IF Long open position is non-zero
      **                        Perform Transactions
     C*
     C           LOPE      IFNE 0
     C                     EXSR POSTNR
     C                     END
     C*
      **                   IF Long open position is zero
      **                   AND Short open position is non-zero
      **                        Perform Transactions
     C*
     C           LOPE      IFEQ 0
     C           SOPE      ANDNE0
     C                     EXSR POSTNR
     C                     END
     C*
      **                   IF Long open position is zero
      **                   AND Short open position is zero
      **                        Access POCHG5
      **                        IF records found for this key
      **                             Perform Transactions
     C*
     C           LOPE      IFEQ 0
     C           SOPE      ANDEQ0
      *                                                                   S01299
      ** Determine if a postion change record exists on LF-POCHG5C,       S01299
      ** LF-POCHG5T or LF-POCHG5R.                                        S01299
      *                                                                   S01299
     C***********POCHGK    SETLLPOCHG5                   51               S01299
     C***********POCHGK    SETLLPOCHG5X                  52               S01299
      *                                                                   S01299
     C           POCHGK    SETLLPOCHG5C                  51               S01299
     C           *IN51     IFEQ '0'                                       S01299
     C           POCHGK    SETLLPOCHG5T                  51               S01299
     C                     END                                            S01299
     C           POCHGK    SETLLPOCHG5R                  52               S01299
      *                                                                   S01299
     C   51
     COR 52                EXSR POSTNR
     C*
     C                     END
     C*
     C                     ELSE
      *
      ** Process OTC record
      *
     C                     EXSR POSTN1
     C                     END
      *
      ** Update POSTNC1 record with the c/f telex/confirm position,
      *  last end of centre price and run date
      *  only when there are movements-transactions and or revaluations   047565
     C           *IN28     IFEQ '1'                                       047565
     C                     MOVE NETP      LTPO
     C                     MOVE PLEC      LTCP
     C                     MOVE RUND      LTDAPC
     C                     EXCPTPOSTN
     C                     END                                            047565
     C           POSTNK    READEPOSTNC1                  50
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R POSTNR TO PROCESS THE POSTNC1 RECORD AND ACCESS POCHG5
     C*
      ** CALLED FROM POSTNC
     C*
      ** CALLS POCHG; ZDATE2; ZFRPED; FFPRCS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POSTNR    BEGSR
      *                                                                   CFE001
     C                     MOVE '1'       *IN28                           047565
      ** If this is the first position to be reported for the             CFE001
      ** settlement account print a report header.                        CFE001
      *                                                                   CFE001
     C           *IN26     IFEQ '1'                                       CFE001
     C*                                                                   CFE001
     C                     WRITEFMTP101                                   CFE001
     C                     SETOF                     26                   CFE001
     C*                                                                   CFE001
     C                     END                                            CFE001
     C*
     C                     MOVE *BLANK    RSTRP
     C*
      ** Fromat brought forward line
      ** Format strike price:
      ** IF Instrument is an option
      **          Convert strike price using MNPF and TKDM from INTYP2
     C*
     C           ISPT      IFGE 4
     C           ISPT      ANDNE7                                         AUS022
     C                     Z-ADDSTRP      FFPRIC
     C*
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C*
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RSTRP
     C                     END
     C*
     C*
      ** Format month
     C*
     C           MTHN      IFNE 0
     C                     MOVE MTH,MTHN  AMTH
     C                     ELSE
     C                     MOVE *BLANK    AMTH
     C                     END
     C*
      ** Set net position to last telex confirm position from POSTNC1
      ** IF last telex confirm position is positive
      **     Set brought forward stmt posn to last tlx confm position
      **     Set brought forward statement position to 'LGN'
      ** Otherwise
      **     Z-SUB brought forward tlx  posn to last statement position
      **     Set brought forward tlx confm position to 'SHT'
      ** Convert last tlx confm closing price using FFPRCS using INTYP
      ** Write to FF0580P1 for instrument brought forward
     C*
     C                     Z-ADDLTPO      NETP
     C                     Z-ADD0         ZFLD15
     C                     MOVE *BLANK    BFNAR
     C                     Z-ADD0         RLTPO
     C*
     C           LTPO      IFGT 0
     C                     Z-ADDLTPO      RLTPO
     C                     MOVE 'LNG'     BFNAR
     C                     END
     C*
     C           LTPO      IFLT 0
     C                     Z-SUBLTPO      RLTPO
     C                     MOVE 'SHT'     BFNAR
     C                     END
     C*
      ** Format last tlx confm closing price from POSTNC1
     C*
     C           LTCP      IFNE 0
     C                     Z-ADDLTCP      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C*
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RLTCP
     C*
     C                     ELSE
     C                     MOVE *BLANKS   RLTCP
     C                     END
     C*
     C                     Z-ADDLTDAPC    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RLTDA
     C*
     C           LINE      IFGE 56
     C                     WRITEFMTP101
     C                     END
     C*
     C                     WRITEFMTP102
     C*
      ** Perform POCHG5-records
     C*
     C                     EXSR POCHG
     C*
      ***Perform*POCHG5X*-records                                         S01299
     C***********                                                         S01299
     C***********          EXSR POCHGX                                    S01299
      *                                                                   S01299
      ** Perform POCHG5R -records                                         S01299
      *                                                                   S01299
     C                     EXSR PCRVAL                                    S01299
     C*
      ** Format carried forward line
     C*
     C                     MOVE *BLANK    CFNAR
     C                     Z-ADD0         RNETP
     C*
     C           NETP      IFGT 0
     C                     Z-ADDNETP      RNETP
     C                     MOVE 'LNG'     CFNAR
     C                     END
     C*
     C           NETP      IFLT 0
     C                     Z-SUBNETP      RNETP
     C                     MOVE 'SHT'     CFNAR
     C                     END
     C*
     C                     MOVE *BLANKS   RTIULP
     C                     MOVE '0'       *IN30
     C*
      ** Amount fields edited with edit code 'J'
     C*
     C                     MOVE 'J'       ZECODE
     C*
     C           TIURPL    IFNE 0
     C                     Z-SUBTIURPL    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTIULP
     C                     MOVE '1'       *IN30
     C                     END
     C                     Z-ADD0         TIURPL
     C*
     C                     MOVE *BLANKS   RCFPR
      *
      ** Access PRICS1 for last end of centre market price
      *
     C           PRICSK    CHAINPRICS1               99
     C*
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C                     Z-ADDPLEC      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCFPR
     C                     ELSE
     C                     MOVE *ZEROS    PLEC
     C                     MOVE *BLANKS   RCFPR
     C                     END
     C*
     C           LINE      IFGE 58
     C                     WRITEFMTP101
     C                     WRITEFMTP106
     C                     END
     C*
     C                     WRITEFMTP105
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R POCHG TO READ THROUGH THE POCHG5 FILE FOR A POSTNC1 DETAIL
     C*
      ** CALLED FROM POSTNR
     C*
      ** CALLS POCHGR; CHGTRN; CHGDTE
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POCHG     BEGSR
     C*
      ** Set limits on POCHG5 file for this key
      ** Read POCHG5
      ** AND key is same as limit
     C*
     C                     SETOF                     0203
     C*
     C                     Z-ADD0         POCD
     C                     Z-ADD0         TNBR
     C           *LIKE     DEFN TNBR      TNBRO
     C                     Z-ADD0         TNBRO
     C                     Z-ADD0         REVI
     C                     Z-ADD0         REVIO
     C*
     C***********POCHGK    SETLLPOCHG5                                    S01299
     C***********POCHGK    READEPOCHG5                   51               S01299
     C*
      *                                                                   S01299
      **  Access a position change record from   lf-pochg5c and           S01299
      **     lf-pochg5t for the branch, customer, inst type, year,        S01299
      **  month, put/call, and strike price from lf-postnc1 and           S01299
      **  process the record with the lower key value.                    S01299
      *                                                                   S01299
     C           POCHGK    SETLLPOCHG5C                                   S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
      *                                                                   S01299
     C           POCHGK    SETLLPOCHG5T                                   S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
      *                                                                   S01299
      **  Set the indicator to show end of file on lf-pochg5c and         S01299
      **  lf-pochg5t to 'N'.                                              S01299
      *                                                                   S01299
     C                     MOVE 'N'       EOF     1                       S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
      ** DO WHILE not end of file
      ** AND key is same as limit
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C                     Z-ADDPOCD      POCDO
     C*
     C                     Z-ADDPOCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RPOCD
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C*
     C                     Z-ADDTNBR      TNBRO
     C*
      **     IF Transaction number is non-zero
      **          Access TRANS2 for new transaction
      **          IF no record found,
      **          OR record not live
      **               Perform Database-error
     C*
     C           *IN01     IFEQ '0'
     C           TNBR      ANDNE0
     C*
     C           TNBR      CHAINTRANS2               99
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELTNBR      DBKEY            ***************
     C                     Z-ADD10        DBASE            * DB ERROR 10 *
     C                     EXSR DBERR                      ***************
     C                     END
     X/COPY WNCPYSRC,FF0580X001
      *                                                                   CFF007
     C                     MOVE *BLANKS   RVDAT                           CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C                     Z-ADDVALD      ZDAYNO                          CFF007
     C                     EXSR ZDATE2                                    CFF007
     C                     MOVE ZADATE    RVDAT                           CFF007
     C                     ENDIF                                          CFF007
     C*
     C                     END
     C*
      **     DO WHILE Same change date
      **     AND Transaction number
      **          Perform POCHG-record
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C           TNBR      ANDEQTNBRO
     C*
     C                     MOVE REVI      REVIO
     C*
      **     DO WHILE Same change date
      **     AND Transaction number
      **     AND Reversal indicator
      **          Perform POCHG-record
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C           TNBR      ANDEQTNBRO
     C           REVI      ANDEQREVIO
     C*
     C                     EXSR POCHGR
     C*
     C                     SETOF                     0203
     C***********POCHGK    READEPOCHG5                   51               S01299
      *                                                                   S01299
      **  If the indicator to show end of file on lf-pochg5c and          S01299
      **  lf-pochg5t is 'Y' then perform database error processing.       S01299
      *                                                                   S01299
     C           EOF       IFEQ 'Y'                                       S01299
      *                                                                   S01299
     C                     MOVE 'POCHG'   DBFILE                          S01299
     C                     MOVEL'EOF  '   DBKEY            ***************S01299
     C                     Z-ADD13        DBASE            * DB ERROR 13 *S01299
     C                     EXSR DBERR                      ***************S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  If the variable which indicates the file being processed        S01299
      **  equal to 'C' then read a record from lf-pochg5c.                S01299
      *                                                                   S01299
     C           FILE      IFEQ 'C'                                       S01299
     C*                                                                   S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
      /SPACE 1                                                            S01299
     C                     ELSE                                           S01299
      *                                                                   S01299
      **  Read a record from lf-pochg5t.                                  S01299
      *                                                                   S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
     C*
     C                     END
     C*
      **     IF change date has changed
      **     OR Transaction number has changed
      **     OR Reversal indicator has changed
      **     AND Transaction number is non-zero
      **          Perform Change-of-transaction
     C*
     C           TNBRO     IFNE 0
     C                     EXSR CHGTRN
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
      **     IF Change date has changed
      **          Perform Change-of-date
     C*
     C                     EXSR CHGDTE
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      *                                                                   S01299
      ** S/R    - Select the record from pochg5c and pochg5t with the     S01299
      ** SELECT   lower key value for processing and move the values      S01299
      **          from the record selected into work fields. The work     S01299
      **          fields used were base on the program's layout of        S01299
      **          pochg5 prior to S01299.                                 S01299
     C*                                                                   S01299
      ** CALLED FROM POCHG                                                S01299
     C*                                                                   S01299
      ** CALLS NO OTHER SUBROUTINES                                       S01299
     C*                                                                   S01299
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * S01299
     C*                                                                   S01299
     C           SELECT    BEGSR                                          S01299
      *                                                                   S01299
      **  Define work fields not previously defined                       S01299
      *                                                                   S01299
     C           *LIKE     DEFN RLPLC     RLPL                            S01299
     C           *LIKE     DEFN PCGAD     PCGA                            S01299
     C           *LIKE     DEFN PCGTD     PCGT                            S01299
     C           *LIKE     DEFN POCQD     POCQ                            S01299
      *                                                                   S01299
      **  If not end of file pochg5c and not end of file pochg5t          S01299
      *                                                                   S01299
     C           *IN53     IFEQ '0'                                       S01299
     C           *IN54     ANDEQ'0'                                       S01299
      *                                                                   S01299
      **  If position change date, trade number and reversal indicator    S01299
      **  on pochg5c is less than or equal to same fields on pochg5t      S01299
      *                                                                   S01299
     C           PCHG5C    IFLE PCHG5T                                    S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'C'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'C'       FILE    1                       S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETON                     02                   S01299
     C                     SETOF                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECIC     RECI                            S01299
     C**********           MOVE BRCDC     BRCDPG                    S01299FO0018
     C                     MOVE BRCAC     BRCAPG                          FO0018
     C                     MOVE CBCDC     CBCDPG                          S01299
     C                     MOVE ISTTC     ISTTPG                          S01299
     C                     MOVE YRNOC     YRNOPG                          S01299
     C                     MOVE MTHNC     MTHNPG                          S01299
     C                     MOVE PCALC     PCALPG                          S01299
     C                     MOVE STRPC     STRPPG                          S01299
     C                     MOVE POCDC     POCD                            S01299
     C                     MOVE TNBRC     TNBR                            S01299
     C                     MOVE RLPLC     RLPL                            S01299
     C                     MOVE ISCYC     ISCYPG                          S01299
     C                     MOVE AOSIC     AOSI                            S01299
     C                     MOVE ATCIC     ATCI                            S01299
     C                     MOVE PUPIC     PUPI                            S01299
     C                     MOVE REVIC     REVI                            S01299
      /SPACE 1                                                            S01299
      *                                                                   S01299
      **  ELSE the record from pochg5t has lower key value                S01299
      *                                                                   S01299
     C                     ELSE                                           S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'T'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'T'       FILE                            S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETOF                     02                   S01299
     C                     SETON                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECID     RECI                            S01299
     C**********           MOVE BRCDD     BRCDPG                    S01299FO0018
     C                     MOVE BRCAD     BRCAPG                          FO0018
     C                     MOVE CBCDD     CBCDPG                          S01299
     C                     MOVE ISTTD     ISTTPG                          S01299
     C                     MOVE YRNOD     YRNOPG                          S01299
     C                     MOVE MTHND     MTHNPG                          S01299
     C                     MOVE PCALD     PCALPG                          S01299
     C                     MOVE STRPD     STRPPG                          S01299
     C                     MOVE POCDD     POCD                            S01299
     C                     MOVE TNBRD     TNBR                            S01299
     C                     MOVE PCGTD     PCGT                            S01299
     C                     MOVE POCQD     POCQ                            S01299
     C                     MOVE PCGAD     PCGA                            S01299
     C                     MOVE ISCYD     ISCYPG                          S01299
     C                     MOVE AOSID     AOSI                            S01299
     C                     MOVE ATCID     ATCI                            S01299
     C                     MOVE PUPID     PUPI                            S01299
     C                     MOVE PAYID     PAYI                            S01299
     C                     MOVE REVID     REVI                            S01299
      *                                                                   S01299
     C                     END                                            S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If not end of file pochg5c and end of file pochg5t              S01299
      *                                                                   S01299
     C           *IN53     IFEQ '0'                                       S01299
     C           *IN54     ANDEQ'1'                                       S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'C'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'C'       FILE    1                       S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETON                     02                   S01299
     C                     SETOF                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECIC     RECI                            S01299
     C***********          MOVE BRCDC     BRCDPG                    S01299FO0018
     C                     MOVE BRCAC     BRCAPG                          FO0018
     C                     MOVE CBCDC     CBCDPG                          S01299
     C                     MOVE ISTTC     ISTTPG                          S01299
     C                     MOVE YRNOC     YRNOPG                          S01299
     C                     MOVE MTHNC     MTHNPG                          S01299
     C                     MOVE PCALC     PCALPG                          S01299
     C                     MOVE STRPC     STRPPG                          S01299
     C                     MOVE POCDC     POCD                            S01299
     C                     MOVE TNBRC     TNBR                            S01299
     C                     MOVE RLPLC     RLPL                            S01299
     C                     MOVE ISCYC     ISCYPG                          S01299
     C                     MOVE AOSIC     AOSI                            S01299
     C                     MOVE ATCIC     ATCI                            S01299
     C                     MOVE PUPIC     PUPI                            S01299
     C                     MOVE REVIC     REVI                            S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If not end of file pochg5t and end of file pochg5c              S01299
      *                                                                   S01299
     C           *IN53     IFEQ '1'                                       S01299
     C           *IN54     ANDEQ'0'                                       S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'T'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'T'       FILE                            S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETOF                     02                   S01299
     C                     SETON                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECID     RECI                            S01299
     C**********           MOVE BRCDD     BRCDPG                    S01299FO0018
     C                     MOVE BRCAD     BRCAPG                          FO0018
     C                     MOVE CBCDD     CBCDPG                          S01299
     C                     MOVE ISTTD     ISTTPG                          S01299
     C                     MOVE YRNOD     YRNOPG                          S01299
     C                     MOVE MTHND     MTHNPG                          S01299
     C                     MOVE PCALD     PCALPG                          S01299
     C                     MOVE STRPD     STRPPG                          S01299
     C                     MOVE POCDD     POCD                            S01299
     C                     MOVE TNBRD     TNBR                            S01299
     C                     MOVE PCGTD     PCGT                            S01299
     C                     MOVE POCQD     POCQ                            S01299
     C                     MOVE PCGAD     PCGA                            S01299
     C                     MOVE ISCYD     ISCYPG                          S01299
     C                     MOVE AOSID     AOSI                            S01299
     C                     MOVE ATCID     ATCI                            S01299
     C                     MOVE PUPID     PUPI                            S01299
     C                     MOVE PAYID     PAYI                            S01299
     C                     MOVE REVID     REVI                            S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If end of file pochg5t and end of file pochg5c                  S01299
      *                                                                   S01299
     C           *IN53     IFEQ '1'                                       S01299
     C           *IN54     ANDEQ'1'                                       S01299
      *                                                                   S01299
      **  Set the indicator to show end of file on lf-pochg5c and         S01299
      **  lf-pochg5t to 'Y'.                                              S01299
      *                                                                   S01299
     C                     MOVE 'Y'       EOF                             S01299
      *                                                                   S01299
     C                     END                                            S01299
     C*                                                                   S01299
     C                     ENDSR                                          S01299
     C*                                                                   S01299
     C********************************************************************S01299
      /EJECT                                                              S01299
     C********************************************************************S01299
     C*
      ***S/R*POCHGX*TO*READ*THROUGH*THE POCHG5X*FILE*FOR*A*POSTNC1*DETAIL S01299
      *                                                                   S01299
      ** S/R PCRVAL TO READ THROUGH THE POCHG5R FILE FOR A POSTNC1 DETAIL S01299
     C*
      ** CALLED FROM POSTNR, POSTN1
     C*
      ** CALLS NO OTHER SUBROUTINES
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C***********POCHGX    BEGSR                                          S01299
     C           PCRVAL    BEGSR                                          S01299
     C*
      ** Revaluation records
      *
     C                     Z-ADD0         POCD
     C***********POCHGK    SETLLPOCHG5X                                   S01299
     C***********POCHGK    READEPOCHG5X                  52               S01299
     C           POCHGK    SETLLPOCHG5R                                   S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C*
     C           *IN52     DOWEQ'0'
      *
      **
      ** Add the unrealised profit/loss on this record to the total
      ** instrument unrealised profit /loss
      *
     C                     ADD  ULPL      TIURPL
      *
      **Add the unrealised profit/loss to the total settlement account
      **unrealised profit/loss
      *
     C           ISTI      IFEQ 'N'                                       E22130
     C                     ADD  ULPL      TSURPL
     C                     END                                            E22130
      *
      ** Update POCH5 record
      *
     C                     MOVE 'Y'       ATCI
     C                     EXCPTRPOCHG
     C*
     C                     SETOF                     01
     C***********POCHGK    READEPOCHG5X                  52               S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R POCHGR TO PROCESS A POCHG5 RECORD FOR A TRANSACTION
     C*
      ** CALLED FROM POCHG
     C*
      ** CALLS NO OTHER SUBROUTINES
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POCHGR    BEGSR
     C*
      ** IF POCHGCC record
      **     IF the reversal indicator is on
      **          Reverse the sign of the Realised P/L amount
      **     IF The transaction number is non-zero
      **          Add the saved realised P/L amount to Start total
      **     Otherwise
      **          Add to the change date Realised P/L
      **     Add to the Statement account total
     C*
     C           *IN02     IFEQ '1'
     C*
     C           REVI      IFEQ 1
     C                     Z-SUBRLPL      WRLPL
     C                     ELSE
     C                     Z-ADDRLPL      WRLPL
     C                     END
     C*
     C           TNBR      IFEQ 0
     C*
     C           REVI      IFEQ 1
     C                     ADD  WRLPL     TCDR1
     C                     ELSE
     C                     ADD  WRLPL     TCDR0
     C                     END
     C*
     C                     END
     C*
     C           TNBR      IFNE 0
     C                     ADD  WRLPL     TTRPLS
     C                     END
     C*
     C           ISTI      IFEQ 'N'                                       E22130
     C                     ADD  WRLPL     TSRPL
     C                     END                                            E22130
      *
      ** Update POCHGCC record
     C***********          MOVE 'Y'       ATCI                            S01299
     C                     MOVE 'Y'       ATCIC                           S01299
     C                     EXCPTPOCHGC
     C*
     C                     END
     C*
      ** IF The record is from POCHGTC
      **     IF The reversal indicator is on
      **          Reverse the sign of the Position change quantity
      **          Reverse the sign of the position change amount
      **     IF the position change type is ' '
      **          IF the Payable indicator is '0'
      **               Add the saved position change quantity
      **                to the total transaction number of contracts
      **                at start
      **          Otherwise
      **               Add to the total transaction number of
      **                contracts at end
     C*
     C           *IN03     IFEQ '1'
     C*
     C           REVI      IFEQ 1
     C                     Z-SUBPOCQ      WPOCQ
     C                     Z-SUBPCGA      WPCGA
     C                     ELSE
     C                     Z-ADDPOCQ      WPOCQ
     C                     Z-ADDPCGA      WPCGA
     C                     END
     C*
     C           PCGT      IFEQ *BLANK
     C*
     C           PAYI      IFEQ '0'
     C                     ADD  WPOCQ     TTCTS
     C                     ELSE
     C                     ADD  WPOCQ     TTCTE
     C*
     C                     END
     C*
     C                     END
     C*
      **     IF The position change type is 'A'
      **          IF the payable indicator is '0'
      **               Add the saved position change amount
      **                to the total transaction charge amount
      **                at start
      **          Otherwise
      **               Add to the total transaction charge amount at
      **                end
      **          Add to the total settlement account charge amount
     C*
     C           PCGT      IFEQ 'A'
     C*
     C           PAYI      IFEQ '0'
     C                     ADD  WPCGA     TTCHS
     C                     ELSE
     C                     ADD  WPCGA     TTCHE
     C                     END
     C*
     C           ISTI      IFEQ 'N'                                       E22130
     C                     ADD  WPCGA     TSCHRG
     C                     END                                            E22130
     C*
     C                     END
     C*
      **     IF The position change type is 'B'
      **          IF the payable indicator is '0'
      **               Add the saved position change amount
      **                to the total transaction commission amount
      **                at start
      **          Otherwise
      **               Add the position change amount to the
      **                total transaction commission amount at
      **                end
      **          Add tot he total settlement account commission
      **           amount
     C*
     C           PCGT      IFEQ 'B'
     C*
     C           PAYI      IFEQ '0'
     C                     ADD  WPCGA     TTCOMS
     C                     ELSE
     C                     ADD  WPCGA     TTCOME
     C                     END
     C*
     C           ISTI      IFEQ 'N'                                       E22130
     C                     ADD  WPCGA     TSCOMM
     C                     END                                            E22130
     C*
     C                     END
     C*
      **      IF the position change type is 'C'
      **           IF the payable indicator is '0'
      **                Add the saved position change amount
      **                 to the total transaction realised P/L amount
      **                 at start
      **           Otherwise
      **                Add to the realised P/L amount at end
      **           Add to the total settlement account premium amount
     C*
     C           PCGT      IFEQ 'C'
     C*
     C           PAYI      IFEQ '0'
     C                     ADD  WPCGA     TTRPLS
     C                     ELSE
     C                     ADD  WPCGA     TTRPLE
     C                     END
     C*
     C           ISTI      IFEQ 'N'                                       E22130
     C                     ADD  WPCGA     TSPREM
     C                     END                                            E22130
     C*
     C                     END
      *
      ***Update*POCHG5*record                                             S01299
      *                                                                   S01299
      ** Update POCHG5T record                                            S01299
      *
     C***********          MOVE 'Y'       ATCI                            S01299
     C                     MOVE 'Y'       ATCID                           S01299
     C                     EXCPTPOCHGT
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R CHGTRN PRINT TRANSACTION DETAILS FOR A POCHG5 RECORD
     C*
      ** CALLED FROM POCHG
     C*
      ** CALLS FFPRCS; ZFRPED
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           CHGTRN    BEGSR
     C*
     C                     MOVE *BLANK    RTRTY
     C*
     C           REVIO     IFEQ 1
     C                     MOVE 'REV'     RNAR
     C                     ELSE
     C                     MOVE *BLANK    RNAR
     C                     END
     C*
      ** IF The transaction type is 'P'
      **     IF No broker is involved
      **          Report transaction as 'S'
      **     Otherwise
      **          Report transaction as 'P'
     C*
     C           TRTY      IFEQ 'P'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     MOVE 'S'       RTRTY
     C                     ELSE
     C                     MOVE 'P'       RTRTY
     C                     END
     C*
     C*
     C                     END
     C*
      **IF The transaction type is 'S'
      **     IF no broker is involved
      **          Report transaction as 'P'
      **     Otherwise
      **          Report transaction as 'S'
     C*
     C           TRTY      IFEQ 'S'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     MOVE 'P'       RTRTY
     C                     ELSE
     C                     MOVE 'S'       RTRTY
     C                     END
     C*
     C*
     C                     END
      *
      ** If the report transaction type is 'P', add the total number of
      ** transaction contracts to the net position
      **     Convert contract price to report format using FFPRCS with
      **      instrument details from INTYP
      *
     C           RTRTY     IFEQ 'P'
     C*
     C                     ADD  TTCTS     NETP
     C                     ADD  TTCTE     NETP
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCOPR
     C                     END
      *
      ** If the report transaction type is 'S', sub the total number of
      ** transaction contracts from the net position
      **     Convert contract price to report format using FFPRCS with
      **      instrument details from INTYP
      *
     C           RTRTY     IFEQ 'S'
     C*
     C                     SUB  TTCTS     NETP
     C                     SUB  TTCTE     NETP
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCOPR
     C                     END
     C*
     C*
      ** IF Trasaction type is 'E'
      **     IF no broker is involved
      **     AND The Underlying transaction type is 'S'
      **     OR a broker is involved
      **     AND The Underlying transaction type is 'P'
      **          Add the total number of transaction contracts to the net
      **           position
      **     ENDIF
     C*
     C           TRTY      IFEQ 'E'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C           ULTT      ANDEQ'S'
     C********** BOCO      ORGT 0                                                             CSD027
     C           BOCO      ORNE *BLANKS                                                       CSD027
     C           ULTT      ANDEQ'P'
     C                     ADD  TTCTS     NETP
     C                     ADD  TTCTE     NETP
     C*
      **     IF no broker is involved
      **     AND The Underlying transaction type is 'P'
      **     OR a broker is involved
      **     AND The Underlying transaction type is 'S'
      **         Subtract the total number of transaction contracts from the
      **          net position
     C*
     C                     ELSE
     C                     SUB  TTCTS     NETP
     C                     SUB  TTCTE     NETP
     C                     END
     C*
      **     Report transaction as 'E'
     C*
     C                     MOVE 'E'       RTRTY
     C*
      **          Convert exercise price to report format using FFPRCS with
      **           underlying instrument details from INTYP2
     C*
     C                     Z-ADDCOPR      FFPRIC
     C                     Z-ADDTKDM2     FFTKDM
     C                     Z-ADDMNPF2     FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCOPR
     C*
     C                     END
      ** IF Customer book final closure indicator is 'Y'
      ** and contracts have been closed out
      **     Set closure indicator to 'Y' for report
      ** Otherwise
      **     Set closure indicator to blank
     C*
     C           FCIN      IFEQ 'Y'
     C           TTCTE     ANDNE*ZERO
     C                     MOVE 'Y'       RFCIN
     C                     ELSE
     C                     MOVE *BLANK    RFCIN
     C                     END
     C*
      ** Write two transaction lines - charges & commission and P/L.
      **
     C*
     C                     MOVE *BLANK    RTCTS
     C                     MOVE *BLANK    RTCTE
     C                     MOVE *BLANK    RTRCMS
     C                     MOVE *BLANK    RTRCME
     C                     MOVE *BLANK    RTRCHS
     C                     MOVE *BLANK    RTRCHE
     C                     MOVE *BLANK    RTRPLS
     C                     MOVE *BLANK    RTRPLE
     C*
      ** Amount fields edited with CR
     C*
     C                     MOVE 'A'       ZECODE
     C*
      ** If 'Start' commissions are zero
      **   write 'End' commissions on 1st line
      ** Otherwise
      **   write 'Start' commissions on 1st line
      **   write 'End'   commissions on 2nd line
     C*
     C           TTCOMS    IFEQ 0
     C                     Z-ADDTTCOME    ZFLD15
     C                     ELSE
     C                     Z-ADDTTCOMS    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRCMS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           TTCOMS    IFNE 0
     C                     Z-ADDTTCOME    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRCME
     C                     END
     C*
      ** If 'Start' charges are zero
      **   write 'End' charges on 1st line
      ** Otherwise
      **   write 'Start' charges on 1st line
      **   write 'End'   charges on 2nd line
     C*
     C           TTCHS     IFEQ 0
     C                     Z-ADDTTCHE     ZFLD15
     C                     ELSE
     C                     Z-ADDTTCHS     ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRCHS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           TTCHS     IFNE 0
     C                     Z-ADDTTCHE     ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRCHE
     C                     END
     C*
      ** If 'Start' profit/loss is zero
      **   write 'End' profit/loss on 1st line
      ** Otherwise
      **   write 'Start' profit/loss on 1st line
      **   write 'End'   profit/loss on 2nd line
     C*
      **   Edit with edit code 'J'
     C*
     C                     MOVE 'J'       ZECODE
     C*
     C           TTRPLS    IFEQ 0
     C                     Z-SUBTTRPLE    ZFLD15
     C                     ELSE
     C                     Z-SUBTTRPLS    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRPLS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           TTRPLS    IFNE 0
     C                     Z-SUBTTRPLE    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRPLE
     C                     END
     C*
      ** Contracts fields edited with '-'
     C*
     C                     MOVE 'L'       ZECODE
     C*
      ** If 'Start' number of contracts is zero
      **   write 'End' number of contracts on 1st line
      ** Otherwwise
      **   write 'Start' number of contracts on 1st line
      **   write 'End'   number of contracts on 2nd line
     C*
     C           TTCTS     IFEQ 0
     C                     Z-ADDTTCTE     ZFLD15
     C                     ELSE
     C*
      ** Contracts 'at start' always reported as positive
     C*
     C           TTCTS     IFLT 0
     C                     Z-SUBTTCTS     ZFLD15
     C                     ELSE
     C                     Z-ADDTTCTS     ZFLD15
     C                     END
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADD0         ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCTS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           TTCTS     IFNE 0
     C                     Z-ADDTTCTE     ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADD0         ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCTE
     C                     END
     C*
      ** Transaction number may be negative (for trades at maturity)
     C*
     C           TNBRO     IFGT *ZERO
     C                     MOVELTNBRO     RTNBR
     C                     MOVE '    '    RTNBR
     C                     ELSE
     C                     Z-SUBTNBRO     WTNBR   60
     C                     MOVELWTNBR     RTNBR
     C                     MOVE '-(M)'    RTNBR
     C                     END
     C*
     C           LINE      IFGE 57
     C                     WRITEFMTP101
     C                     WRITEFMTP106
     C                     END
     C*
     C                     WRITEFMTP103
     C*
     C                     Z-ADD0         TTCTS
     C                     Z-ADD0         TTCTE
     C                     Z-ADD0         TTCHS
     C                     Z-ADD0         TTCHE
     C                     Z-ADD0         TTRPLS
     C                     Z-ADD0         TTRPLE
     C                     Z-ADD0         TTCOMS
     C                     Z-ADD0         TTCOME
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R CHGDTE PERFORM CHANGE OF POSITION CHANGE DATE PROCESSING
     C*
      ** CALLED FROM POCHG
     C*
      ** CALLS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           CHGDTE    BEGSR
     C*
      ** Amount fields edited with edit code 'J'
     C*
     C                     MOVE 'J'       ZECODE
     C*
      ** IF total position change date realised P/L is non-zero
      **     Print report line for date totals
     C*
     C           TCDR0     IFNE 0
     C*
     C                     MOVE '   '     CDNAR
     C*
     C                     Z-SUBTCDR0     ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCDR
     C*
     C*
     C           LINE      IFGE 57
     C                     WRITEFMTP101
     C                     WRITEFMTP106
     C                     END
     C*
     C                     WRITEFMTP104
     C                     END
     C*
      ** IF total position change date reversal realised P/L is non-zero
      **     Print report line for date total Reversals
     C*
     C           TCDR1     IFNE 0
     C*
     C                     MOVE 'REV'     CDNAR
     C*
     C                     Z-SUBTCDR1     ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCDR
     C*
     C           LINE      IFGE 57
     C                     WRITEFMTP101
     C                     WRITEFMTP106
     C                     END
     C*
     C                     WRITEFMTP104
     C                     END
     C*
     C                     Z-ADD0         TCDR1
     C                     Z-ADD0         TCDR0
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R TRDSUM TO FORMAT AND PRINT TRADING SUMMARY
     C*
      ** CALLED FROM Main Processing
     C*
      ** CALLS NO OTHER SUBROUTINES
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           TRDSUM    BEGSR
     C*
     C***Set*Brought*forward*account*balance*to*that*of*TSCCY1************S01117
     C***Access*LF/ACCNT**************************************************S01117
     C***********                                                         S01117
     C***********ATID      IFEQ *BLANK                                    S01117
     C***********          SETON                     99                   S01117
     C***********          ELSE                                           S01117
     C***********          MOVE ATID      ATIDX                           S01117
     C***********ATIDK     CHAINACCNT                99                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C************IN99     IFEQ '0'                                       S01117
     C***********RECI      ANDEQ'D'                                       S01117
     C***********                                                         S01117
     C***Set*Carried*Forward*account*balance*to*Current*cleared*balance***S01117
     C***Subtract*from*this*Brought*forward*account*balance,**************S01117
     C****Commissions,*charges,*realised*P/L*and*Unrealised*P/L*totals*andS01117
     C****premiuns*paid*and*received*to***********************************S01117
     C****give*Cash*adjustments*since*last*trading*statement**************S01117
      ** Write account totals to FF0580P1
     C*
     C************LIKE     DEFN BFTB      BFACB                           S01117
     C************LIKE     DEFN BFTB      CFACB                           S01117
     C***********          Z-ADDBFTB      BFACB                           S01117
     C***********          Z-ADDCLBL      CFACB                           S01117
     C************LIKE     DEFN BFTB      CASH                            S01117
     C***********CFACB     SUB  BFTB      CASH                            S01117
     C***********          SUB  TSCOMM    CASH                            S01117
     C***********          SUB  TSCHRG    CASH                            S01117
     C***********          SUB  TSRPL     CASH                            S01117
     C***********          SUB  TSURPL    CASH                            S01117
     C***********          SUB  TSPREM    CASH                            S01117
     C***********                                                         S01117
     C***Amount*fields edited with CR                                     S01117
     C***********                                                         S01117
     C***********          MOVE 'A'       ZECODE                          S01117
     C****NO S/A****       Z-ADDCASH      ZFLD15
     C****REQ'D*****       Z-ADDCDP       ZDECS
     C****NO S/A****       EXSR ZFRPED
     C****REQ'D*****       MOVE ZOUT22    RCADJ
     C***********                                                         S01117
     C***********          MOVE CUSTRA    CUSTRX                          S01117
     C***********          MOVE CURRA     CURRX                           S01117
     C***********          MOVE ACDEA     ACDEX                           S01117
     C***********          MOVE ASEQA     ASEQX                           S01117
     C***********                                                         S01117
     C****NO S/A****       MOVE RTIDX     RATID
     C***********                                                         S01117
     C****NO S/A****       Z-ADDBFACB     ZFLD15
     C****REQ'D*****       Z-ADDCDP       ZDECS
     C****NO S/A****       EXSR ZFRPED
     C****REQ'D*****       MOVE ZOUT22    RBFACB
     C***********          Z-ADDCLBL      BFTB                            S01117
     C***********                                                         S01117
     C****NO S/A****       Z-ADDCFACB     ZFLD15
     C****REQ'D*****       Z-ADDCDP       ZDECS
     C****NO S/A****       EXSR ZFRPED
     C****REQ'D*****       MOVE ZOUT22    RCFACB
     C***********          Z-ADDCLBL      BFTB                            S01117
     C***********                                                         S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD0         BFTB                            S01117
     C****NO S/A****       MOVE MSG,2     RBFACB
     C****REQ'D*****       MOVE MSG,2     RCFACB
     C****NO S/A****       MOVE MSG,2     RCADJ
     C****REQ'D*****       MOVE *BLANK    RATID
     C***********          END                                            S01117
     C*
     C                     Z-ADDTMAR      ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTMAR
     C*
     C                     Z-ADDCLCO      ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RCLCO
     C*
      **  Edit with edit code 'J'
     C                     MOVE 'J'       ZECODE
     C*
     C                     Z-SUBTSCOMM    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTSCOM
     C*
     C                     Z-SUBTSCHRG    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTSCHG
     C*
     C                     Z-SUBTSRPL     ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTSRPL
     C*
     C                     Z-SUBTSURPL    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTSUPL
     C*
      ** Amount fields edited with CR
     C*
     C                     MOVE 'A'       ZECODE
     C*
     C                     Z-ADDTSPREM    ZFLD15
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTSPRE
     C*
     C                     Z-ADDLTDA      ZDAYNO
     C                     EXSR ZDATE2
     C****NO S/A****       MOVE ZADATE    RBFSD
     C*
     C****REQ'D*****       MOVE RUNA      RCFSD
     C*
     C           LINE      IFGE 48
     C                     WRITEFMTP101
     C                     END
     C*
     C                     WRITEFMTP107
     C                     Z-ADD0         NETP
     C                     Z-ADD0         TSCOMM
     C                     Z-ADD0         TSCHRG
     C                     Z-ADD0         TSPREM
     C                     Z-ADD0         TSRPL
     C                     Z-ADD0         TSURPL
     C*
     C                     ENDSR
      /EJECT
     C********************************************************************
     C*
      ** S/R POSTN1 TO ACCESS POCHG5 AND POCHG5X
      **               FOR OTC RECORDS
     C*
      ** CALLED FROM POSTNC
     C*
      ** CALLS POCHGO; PCHGXO
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POSTN1    BEGSR
      *
      ** PROCESS POCHG5-recordsOTC
      *
     C                     EXSR POCHGO
      *
      ** PROCESS POCHG5X-recordsOTC
      *
     C                     EXSR PCHGXO
     C                     ENDSR
      /EJECT
     C********************************************************************
     C*
      ** S/R POCHGO TO READ THROUGH THE POCHG5 FILE FOR A POSTNC1 DETAIL
      **               OTC
     C*
      ** CALLED FROM POSTN1
     C*
      ** CALLS POCHGR; CHGTR1; CHGDT1
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           POCHGO    BEGSR
     C*
      ** Set limits on POCHG5 file for this key
      ** Read POCHG5
      ** AND key is same as limit
     C*
     C                     SETOF                     0203
     C*
     C                     Z-ADD0         POCD
     C                     Z-ADD0         TNBR
     C                     Z-ADD0         TNBRO
     C                     Z-ADD0         REVI
     C                     Z-ADD0         REVIO
     C*
     C***********POCHGK    SETLLPOCHG5                                    S01299
     C***********POCHGK    READEPOCHG5                   51               S01299
     C*
      *                                                                   S01299
      **  Access a position change record from   lf-pochg5c and           S01299
      **     lf-pochg5t for the branch, customer, inst type, year,        S01299
      **  month, put/call, and strike price from lf-postnc1 and           S01299
      **  process the record with the lower key value.                    S01299
      *                                                                   S01299
     C           POCHGK    SETLLPOCHG5C                                   S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
      *                                                                   S01299
     C           POCHGK    SETLLPOCHG5T                                   S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
      *                                                                   S01299
      **  Set the indicator to show end of file on lf-pochg5c and         S01299
      **  lf-pochg5t to 'N'.                                              S01299
      *                                                                   S01299
     C                     MOVE 'N'       EOF     1                       S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
      *                                                                   S01299
      ** DO WHILE not end of file
      ** AND key is same as limit
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C                     Z-ADDPOCD      POCDO
     C*
     C                     Z-ADDPOCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RPOCD
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C*
     C                     Z-ADDTNBR      TNBRO
     C*
      **     IF Transaction number is non-zero
      **          Access TRANS2 for new transaction
      **          IF no record found,
      **          OR record not live
      **               Perform Database-error
     C*
     C           *IN01     IFEQ '0'
     C           TNBR      ANDNE0
     C*
     C           TNBR      CHAINTRANS2               99
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELTNBR      DBKEY            ***************
     C                     Z-ADD11        DBASE            * DB ERROR 11 *
     C                     EXSR DBERR                      ***************
     C                     END
     X/COPY WNCPYSRC,FF0580X002
      *                                                                   CFF007
      ** Format value date from TRANS2 record                             CFF007
      *                                                                   CFF007
     C                     MOVE *BLANKS   RVDAT                           CFF007
     C           CFF007    IFEQ 'Y'                                       CFF007
     C                     Z-ADDVALD      ZDAYNO                          CFF007
     C                     EXSR ZDATE2                                    CFF007
     C                     MOVE ZADATE    RVDAT                           CFF007
     C                     ENDIF                                          CFF007
     C*
     C                     Z-ADDTNBR      TNBRO
      *
      ** Access TRSET1 for account details to be output to CNFRPD record
      *
     C                     MOVE *ZEROS    SETP
     C                     MOVE *BLANKS   SEBR                            S01117
     C                     MOVE *BLANKS   SETA
     C                     MOVE *BLANKS   FACO
     C                     MOVE *BLANKS   CNOS
     C*
     C           TNBR      CHAINTRSETDF              99
     C*
     C           *IN99     IFEQ '0'
     C                     MOVE CSLT      SETP
     C                     MOVE BRSC      SEBR                            S01117
     C                     MOVE CSLA      SETA
     C                     MOVE CFAO      FACO
     C                     MOVE CCPN      CNOS
     C                     END
     C*
     C                     END
     C*
      **     DO WHILE Same change date
      **     AND Transaction number
      **          Perform POCHG-record
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C           TNBR      ANDEQTNBRO
     C*
     C                     MOVE REVI      REVIO
     C*
      **     DO WHILE Same change date
      **     AND Transaction number
      **     AND Reversal indicator
      **          Perform POCHG-record
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCD      ANDEQPOCDO
     C           TNBR      ANDEQTNBRO
     C           REVI      ANDEQREVIO
     C*
     C                     EXSR POCHGR
     C*
     C                     SETOF                     0203
     C***********POCHGK    READEPOCHG5                   51               S01299
      *                                                                   S01299
      **  If the indicator to show end of file on lf-pochg5c and          S01299
      **  lf-pochg5t is 'Y' then perform database error processing.       S01299
      *                                                                   S01299
     C           EOF       IFEQ 'Y'                                       S01299
      *                                                                   S01299
     C                     MOVE 'POCHG'   DBFILE                          S01299
     C                     MOVEL'EOF  '   DBKEY            ***************S01299
     C                     Z-ADD12        DBASE            * DB ERROR 12 *S01299
     C                     EXSR DBERR                      ***************S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  If the variable which indicates the file being processed        S01299
      **  equal to 'C' then read a record from lf-pochg5c.                S01299
      *                                                                   S01299
     C           FILE      IFEQ 'C'                                       S01299
     C*                                                                   S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
      /SPACE 1                                                            S01299
     C                     ELSE                                           S01299
      *                                                                   S01299
      **  Read a record from lf-pochg5t.                                  S01299
      *                                                                   S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
     C*
     C                     END
     C*
      **     IF change date has changed
      **     OR Transaction number has changed
      **     OR Reversal indicator has changed
      **     AND Transaction number is non-zero
      **          Perform Change-of-transaction1
     C*
     C           TNBRO     IFNE 0
     C                     EXSR CHGTR1
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
      **     IF Change date has changed
      **          Perform Change-of-date1
     C*
     C                     EXSR CHGDT1
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R PCHGXO TO READ THROUGH THE POCHG5X FILE FOR A POSTNC1 DETAIL
     C*
      ** CALLED FROM POSTN1
     C*
      ** CALLS CHGDT1
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           PCHGXO    BEGSR
     C*
     C** Revaluation records
     C*
     C***********POCHGK    SETLLPOCHG5X                                   S01299
     C***********POCHGK    READEPOCHG5X                  52               S01299
     C           POCHGK    SETLLPOCHG5R                                   S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C*
     C           *IN52     DOWEQ'0'
      *
      ** Dowhile same date and not eof
      *
     C                     Z-ADDPOCD      POCDO
     C           *IN52     DOWEQ'0'
     C           POCD      ANDEQPOCDO
      *
      **     Add the unrealised profit/loss on this record to the total
      **      position change date unrealised profit /loss
      *
     C                     ADD  ULPL      TPURPL
      *
      **Add the unrealised profit/loss to the total settlement account
      **unrealised profit/loss
      *
     C******************** ADD  ULPL      TSURPL                          E15904
      *
      ** Update POCH5 record
      *
     C                     MOVE 'Y'       ATCI
     C                     EXCPTRPOCHG
     C*
     C                     SETOF                     01
     C***********POCHGK    READEPOCHG5X                  52               S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C*
     C                     END
     C*
     C                     EXSR CHGDT1
     C*
     C                     END
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R CHGTR1 OUTPUT TRANSACTION DETAILS FOR A POCHG5 RECORD OTC
     C*
      ** CALLED FROM POCHGO
     C*
      ** CALLS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           CHGTR1    BEGSR
     C*
      ** IF The transaction type is 'P'
      **     IF No broker is involved
      **          Subtract the total number of transaction contracts
      **          from the net position
      *
     C*
     C           TRTY      IFEQ 'P'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     SUB  TTCTS     NETP
     C                     SUB  TTCTE     NETP
      *
      **     Else add the total number of transaction contracts
      **          to the net position
      *
     C                     ELSE
     C                     ADD  TTCTS     NETP
     C                     ADD  TTCTE     NETP
     C                     END
     C                     END
     C*
     C*
      ** IF The transaction type is 'S'
      **     IF No broker is involved
      **          Add the total number of transaction contracts
      **          to the net position
      *
     C*
     C           TRTY      IFEQ 'S'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C                     ADD  TTCTS     NETP
     C                     ADD  TTCTE     NETP
      *
      **     Else add the total number of transaction contracts
      **          to the net position
      *
     C                     ELSE
     C                     SUB  TTCTS     NETP
     C                     SUB  TTCTE     NETP
     C                     END
     C                     END
     C*
     C*
      ** IF Trasaction type is 'E'
      **     IF no broker is involved
      **     AND The Underlying transaction type is 'S'
      **     OR a broker is involved
      **     AND The Underlying transaction type is 'P'
      **          Add the total number of transaction contracts to the net
      **           position
      **     ENDIF
     C*
     C           TRTY      IFEQ 'E'
     C*
     C********** BOCO      IFEQ 0                                                             CSD027
     C           BOCO      IFEQ *BLANKS                                                       CSD027
     C           ULTT      ANDEQ'S'
     C********** BOCO      ORGT 0                                                             CSD027
     C           BOCO      ORNE *BLANKS                                                       CSD027
     C           ULTT      ANDEQ'P'
     C                     ADD  TTCTS     NETP
     C                     ADD  TTCTE     NETP
     C*
      **     IF no broker is involved
      **     AND The Underlying transaction type is 'P'
      **     OR a broker is involved
      **     AND The Underlying transaction type is 'S'
      **         Subtract the total number of transaction contracts from the
      **          net position
     C*
     C                     ELSE
     C                     SUB  TTCTS     NETP
     C                     SUB  TTCTE     NETP
     C                     END
     C                     END
      *
      ** Output an 'At Start' Confirmations Report file record (for the
      ** transation start totals
      *
     C           *LIKE     DEFN TNBR      TNBR1
     C           *LIKE     DEFN POCD      POCD1
     C           *LIKE     DEFN REVI      REVI1
     C           *LIKE     DEFN PAYI      PAYI1
     C                     MOVE TNBR      TNBR1
     C                     MOVE POCD      POCD1
     C                     MOVE REVI      REVI1
     C                     MOVE PAYI      PAYI1
      *
     C                     MOVE TNBRO     TNBR
     C                     MOVE POCDO     POCD
     C                     MOVE REVIO     REVI
     C*
     C                     MOVE '0'       PAYI
     C                     Z-ADDTTCTS     TOCN
     C*
     C** For 'At Start' confirmations , number of contracts is positive
     C*
     C           TOCN      IFLT *ZERO
     C                     Z-SUBTOCN      TOCN
     C                     END
     C*
     C                     Z-ADDTTCOMS    TOCM
     C                     Z-ADDTTCHS     TOCG
     C                     Z-ADDTTRPLS    TOPR
     C*
     C                     MOVE BRSC      SEBR                            S01117
     C                     MOVE CBID      SBID                            S01117
     C*                                                                   S01117
     C           TOCN      IFNE *ZERO
     C           TOCM      ORNE *ZERO
     C           TOCG      ORNE *ZERO
     C           TOPR      ORNE *ZERO
     C                     WRITECNFRPDF
     C                     END
     C*
     C                     Z-ADD0         TTCTS
     C                     Z-ADD0         TTCOMS
     C                     Z-ADD0         TTCHS
     C                     Z-ADD0         TTRPLS
     C*
      *
      ** Output an 'At End' Confirmations Report file record (for the
      ** transation ending totals)
      *
     C                     MOVE '1'       PAYI
     C                     Z-ADDTTCTE     TOCN
     C*
     C** For 'At End' confirmations , number of contracts is negative
     C*
     C           TOCN      IFGT *ZERO
     C                     Z-SUBTOCN      TOCN
     C                     END
     C*
     C                     Z-ADDTTCOME    TOCM
     C                     Z-ADDTTCHE     TOCG
     C                     Z-ADDTTRPLE    TOPR
     C*                                                                   S01117
     C                     MOVE BRSC      SEBR                            S01117
     C                     MOVE CBID      SBID                            S01117
      *
     C           TOCN      IFNE *ZERO
     C           TOCM      ORNE *ZERO
     C           TOCG      ORNE *ZERO
     C           TOPR      ORNE *ZERO
     C                     WRITECNFRPDF
     C                     END
     C*
     C                     Z-ADD0         TTCTE
     C                     Z-ADD0         TTCOME
     C                     Z-ADD0         TTCHE
     C                     Z-ADD0         TTRPLE
      *
     C                     MOVE TNBR1     TNBR
     C                     MOVE POCD1     POCD
     C                     MOVE REVI1     REVI
     C                     MOVE PAYI1     PAYI
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R CHGDT1 PERFORM CHANGE OF POSITION CHANGE DATE PROCESSING
     C*
      ** CALLED FROM POCHGO
     C*
      ** CALLS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           CHGDT1    BEGSR
     C*
     C                     Z-ADDPOCD      POCD1
     C                     Z-ADDPOCDO     POCD
     C                     MOVE REVI      REVI1
     C                     MOVE PAYI      PAYI1
     C                     MOVE TNBR      TNBR1
     C*
     C                     MOVE SETPTS    SETP
     C                     MOVE SEBRTS    SEBR                            S01117
     C                     MOVE SBIDTS    SBID                            S01117
     C                     MOVE SETATS    SETA
     C                     MOVE FACOTS    FACO
     C                     MOVE CNOSTS    CNOS
     C*
     C*
     C**If the total position change date unrealised profit/loss amount
     C*  is non zero, output a 'Day Total' confirmations report file
      ** record
     C*
     C           TPURPL    IFNE 0
     C                     MOVE '8'       PAYI
     C                     Z-ADD0         TNBR
     C                     Z-ADDTPURPL    TOPR
     C                     WRITECNFRPDF
     C                     Z-ADD0         TPURPL
     C                     END
     C*
     C** If the total position change date realised profit/loss amount 0
     C*  is non zero, output a 'Day Total' confirmations report file
      ** record
     C           TCDR0     IFNE 0
     C                     MOVE '9'       PAYI
     C                     Z-ADD0         REVI
     C                     Z-ADD0         TNBR
     C                     Z-ADDTCDR0     TOPR
     C                     WRITECNFRPDF
     C                     Z-ADD0         TCDR0
     C                     END
     C*
     C** If the total position change date realised profit/loss amount 1
     C*  is non zero, output a 'Day Total' confirmations report file
      ** record
     C           TCDR1     IFNE 0
     C                     MOVE '9'       PAYI
     C                     Z-ADD1         REVI
     C                     Z-ADD0         TNBR
     C                     Z-ADDTCDR1     TOPR
     C                     WRITECNFRPDF
     C                     Z-ADD0         TCDR1
     C                     END
     C*
     C                     Z-ADDPOCD1     POCD
     C                     MOVE REVI1     REVI
     C                     MOVE PAYI1     PAYI
     C                     MOVE TNBR1     TNBR
     C*
     C                     ENDSR
     C*
     C/EJECT
     C********************************************************************
     C*
      ** S/R INIT TO PERFORM FIRST CYCLE ONLY CALCULATIONS
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS DBERR
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           INIT      BEGSR
     C*
     C***********          OPEN FF0580P1                                  S01117
     C                     SETON                     20
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *ZEROS    DBASE
     C                     MOVE *BLANKS   DBPGM                           S01117
     C                     MOVE 'FF0580  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
      ***Access*TABTB10***************************************************S01117
      ** Access RUNDAT                                                    S01117
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C***********                                                         S01117
     C***********          READ TABTB10F                 99               S01117
      *                                                                   S01117
      **   ACCESS BANK DETAILS                                            S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    @DSFDY                          S01117
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                          S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C***********          MOVEL'TABTB10' DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     Z-ADD6         DBASE            * DB ERROR 06 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*                                                                   S01117
     C**   IN THE DATAAREA RUNDAT                                         S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**   SET MULTIBRANCHING INDICATOR                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     60                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   INITIALIZE COUNTER FOR NO. OF CONFIRMATIONS PRINTED            S01117
     C*                                                                   S01117
     C                     Z-ADD0         COUNT   50                      S01117
     C*
      ** Set indicator for date format, from DATF field.
     C*
     C           DATF      COMP 'M'                      98
     C*
      **  Set up array indices for currency
     C*
     C                     Z-ADD151       C1      30
     C                     Z-ADD150       C2      30
     C*
     C                     MOVELMSG,1     CDNAR
     C***********                                                         S01117
     C***********          MOVE '-'       DSH1                            S01117
     C***********          MOVE '-'       DSH2                            S01117
     C***********          MOVE '-'       DSH3                            S01117
     C                     MOVE 'A'       ZECODE
     C*
      ** Define fields for do while key saving
     C*
     C           *LIKE     DEFN ISTT      ISTTO
     C           *LIKE     DEFN YRNO      YRNOO
     C           *LIKE     DEFN MTHN      MTHNO
     C           *LIKE     DEFN PCAL      PCALO
     C           *LIKE     DEFN STRP      STRPO
     C           *LIKE     DEFN POCD      POCDO
     C           *LIKE     DEFN REVI      REVIO
     C*
      ** Define fields for totals
     C*
     C           *LIKE     DEFN LSPO      TTCTS
     C           *LIKE     DEFN LSPO      TTCTE
     C           *LIKE     DEFN PCGA      TSCHRG
     C           *LIKE     DEFN PCGA      TSCOMM
     C           *LIKE     DEFN PCGA      TSPREM
     C           *LIKE     DEFN RLPL      TSRPL
     C           *LIKE     DEFN ULPL      TSURPL
     C           *LIKE     DEFN ULPL      TPURPL
     C           *LIKE     DEFN ULPL      TIURPL
     C           *LIKE     DEFN PCGA      TTCHE
     C           *LIKE     DEFN PCGA      TTCHS
     C           *LIKE     DEFN PCGA      TTCOME
     C           *LIKE     DEFN PCGA      TTCOMS
     C           *LIKE     DEFN RLPL      TTRPLE
     C           *LIKE     DEFN RLPL      TTRPLS
     C           *LIKE     DEFN RLPL      TCDR1
     C           *LIKE     DEFN RLPL      TCDR0
     C           *LIKE     DEFN PCGA      WPCGA
     C           *LIKE     DEFN POCQ      WPOCQ
     C           *LIKE     DEFN RLPL      WRLPL
     C           *LIKE     DEFN LTPO      NETP
     X/COPY WNCPYSRC,FF0580X003
      *                                                                   CFF007
     C                     MOVE 'N'       CFF007  1                       CFF007
     C                     MOVE *OFF      *IN62                           CFF007
     C                     CALL 'AOSARDR0'                                CFF007
     C                     PARM *BLANKS   PRTCD   7                       CFF007
     C                     PARM '*VERIFY' POPTN   7                       CFF007
     C                     PARM 'CFF007'  PSARD   6                       CFF007
     C           SCSARD    PARM SCSARD    @DSFDY                          CFF007
     C           PRTCD     IFEQ *BLANKS                                   CFF007
     C                     MOVE 'Y'       CFF007                          CFF007
     C                     MOVE *ON       *IN62                           CFF007
     C                     ELSE                                           CFF007
     C           PRTCD     IFNE '*NRF   '                                 CFF007
     C           *LOCK     IN   LDA                                       CFF007
     C                     Z-ADD14        DBASE                           CFF007
     C                     MOVEL'CFF007  'DBKEY                           CFF007
     C                     MOVEL'SCSARDPD'DBFILE                          CFF007
     C                     EXSR DBERR                                     CFF007
     C                     ENDIF                                          CFF007
     C                     ENDIF                                          CFF007
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C*
      ** S/R DBERR TO PERFORM DATABASE ERROR EXIT FROM PROGRAM
     C*
      ** CALLED FROM
     C*
      ** CALLS NO OTHER SUBROUTINES
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           DBERR     BEGSR
     C*                                                                   S01117
     C                     OUT  LDA                                       S01117
     C*
      ** Seton U7 U8 LR
      ** Return
     C*
     C           *IN15     IFEQ '1'                                       S01117
     C           LINE      IFGE 57
     C                     WRITEFMTP101
     C                     END
     C*
     C                     WRITEFMTP108
     C                     END                                            S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR
     C*                                                                   S01117
     C                     EXSR WRITAU                                    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT                                                              S01117
     C********************************************************************S01117
      **                                                                  S01117
      ** WRITAU - SUBROUTINE TO OUTPUT AU REPORT                          S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           WRITAU    BEGSR                           ** WRITAU **   S01117
     C*                                                                   S01117
      ** IF first cycle indicator is off                                  S01117
      **     Perform Initial processing                                   S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     EXSR INIT                                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** ENSURE TOTAL SPOOL FILE RECORDED BY RCF                          S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANKS   SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** OUTPUT AUDIT REPORT HEADING                                      S01117
     C*                                                                   S01117
     C                     WRITEFMTAU01                                   S01117
     C*                                                                   S01117
      ** OUTPUT RUN CONTROLS TOTAL TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C                     WRITEFMTAU02                                   S01117
     C*                                                                   S01117
      ** IF NO DETAIL TO REPORT, OUTPUT TO AUDIT REPORT                   S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '0'                                       S01117
     C           *INU7     ANDEQ'0'                                       S01117
     C                     WRITEFMTAU03                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** IF DATABASE ERROR, OUTPUT TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     WRITEFMTAU04                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT
      /COPY ZSRSRC,ZFRPEDZ3
      /COPY ZSRSRC,ZDATE2Z2
      /COPY ZSRSRC,FFPRCSZ4
     O********************************************************************
     O*
     OTSCCYDF E                TSUPD
     O*
      ** Update TSCCY2
     O*
     O                         BFTB
     O                         LTDA
     O                         TLCI
     O*
     O*
     OPOSTNCDFE                POSTN
     O*
      ** Update POSTNC1
     O*
     O                         LTPO
     O                         LTCP
     O                         LTDAPC
     O*
     OPOCHGCCFE                POCHGC
     O*
      ** Updates for pochg file :            Close Outs
     O*
     O**********               ATCI                                       S01299
     O                         ATCIC                                      S01299
     O*
     OPOCHGTCFE                POCHGT
     O*
      **                                     Transactions
     O*
     O*********                ATCI                                       S01299
     O                         ATCID                                      S01299
     O*
     OPOCHGRCFE                RPOCHG
     O*
      **                                     Revaluations
     O*
     O                         ATCI
     O*
     O********************************************************************
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** MSG
REALISED P/L
      N/AVAIL
**  MTH MONTH NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
