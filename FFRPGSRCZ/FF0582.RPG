     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas FF OTC confirmations print at start')
     F********************************************************************
     F*                                                                  *
     F*  Midas FUTURES AND OPTIONS MODULE                                *
     F*                                                                  *
     F*   FF0582  -  OTC CONFIRMATIONS REPORT FILE : AT START            *
     F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. 246526             Date 21Mar07               *
      *  Prev Amend No. 243826A            Date 25Jan07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD053             Date 01Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG6198            Date 04Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 144941             Date 05Apr00               *
      *                 144860             Date 24Mar00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                  CPL002             Date 08MAR99              *
     F*                  109967             Date 10Mar97              *
     F*                  CFF004             Date 18Sep96              *  *
     F*                  099433             Date 23May96              *  *
     F*                  S71062             DATE 11DEC95                 *
     F*                  086389             DATE 18APR95                 *
     F*                  073714             DATE 01MAR95                 *
     F*                  087284             DATE 02JUN95                 *
     F*                  084174             DATE 02MAR95                 *
     F*                  S01455             DATE 05NOV93                 *
     F*                  S01411             DATE 16APR93                 *
     F*                  S01393             DATE 30OCT92                 *
     F*                  FUJI-FF0011        DATE 10AUG92                 *
     F*                  AUS022             DATE 11AUG92                 *
     F*                  HK0000             DATE 07MAY90                 *
     F*                  S01117             DATE 03APR90                 *
     F*                  E18343             DATE 11NOV89                 *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  246526 - Recompiled due to change in FFSETLZ4.               *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade        *
      *         - (Recompile)                                         *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG6198- Cannot save new Details for CUSD (Recompile)        *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFF006 - Fractional Ticks Enhancement.  (Recompiled)         *
     F*   144941 - Premium settlement date incorrect for premium up-
     F*            front = 'N'.
     F*   144860 - Printer overflow error on FF0582P1. Set overflow
     F*            indicator for RPG cycle to use.
     F*   CPL002 - Midas-Plato Interface
     F*            Program tries to access details for Other Currency
     F*            when option is not a FOREX option.
     F*   109967 - Correct error message behaviour on historical text
     F*            enquiry.
     F*   CFF004 - Increase in size of Price Fields,(Recompiled Only)    *
     F*   099433 - Confirmation for non-currency options always printed
     F*            as 'American' style. Should check field AEIN.
     F*   S71062 - FF/PM Interface (Just recompiled)                     *
     F*   086389 - Include receiver settlement details on conf.
     F*   073714  -  OTC ENHANCEMENTS                                    *
     F*   087284 - Use AOCUSTR0 to retrieve address reference B          *
     F*   084174 - Use AOALTNR0 to retrieve alternative addresses        *
     F*   S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                        *
     F*            Recompiled due to changes in PF/TABTB80.              *
     A*   S01411 - RECOMPILED BECAUSE 'ORIGINAL ENTRY DATE' HAS BEEN     *
     A*            ADDED TO TRANSD.                                      *
     F*   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT            *
     F* FUJI-FF0011 - The system does not differentiate between          *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*   AUS022  -  AUSTRALIAN CHANGE : Contract Type (CNTT) added to   *
     F*              PF/INTYPD.  Recompile program only.                 *
     F*   HK0000  -  SHOULD NOT ASSIGN BICN TO FFBRKI                    *
     F*   S01117  -  MULTIBRANCHING                                      *
     F*   E18343  -  PROGRAM RE-COMPILED DUE TO CHANGE IN ZSRSRC MEMBER  *
     F*              ZFRPEDZ3                                            *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F*     IGNDECERR(*YES)                                              *
     F*                                                                  *
     F********************************************************************
     F*
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*CNFRP**IP**E           K        DISK                               073714
     FCNFRP   UP  E           K        DISK                               073714
     F*
     FTABFF   IF  E           K        DISK
     F**ICD*1*****TABTB10F**************************KIGNORE***************S01117
     F            TABTB10F                          KIGNORE               S01117
     F* ICD 2     TABTB11F                          KIGNORE
     F* ICD 3     TABTB20F                          KIGNORE
     F* ICD 5     TABTB40F                          KIGNORE
     F* ICD FO    TABTB80F                          KIGNORE
     F* A/C CDS   TABTE10F                          KIGNORE
     F* CCY 1     TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F* NOSTRO    TABLETLF                          KIGNORE
     F**BRANCH****TABLETRF**************************KIGNORE***************S01117
     F            TABLETRF                          KIGNORE               S01117
     F************TABLET2F                          KIGNORE               086389
     F*
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUM   IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACCNTABR
     F*LINT***IF**E           K        DISK                               084174
     F*********** CLINTCAF                          KIGNORE               084174
     F*********** CLINTCBF                          KIGNORE               084174
     F*********** CLINTC1F                          KIGNORE               084174
     F*                                                                   084174
     FINTYP   IF  E           K        DISK
     FTRANS2  IF  E           K        DISK
     FFOCLT   IF  E           K        DISK
     FSDCUSTL0IF  E           K        DISK                               086389
     F*FF0582P1O**E                    PRINTER                        UC  144860
     FFF0582P1O   E             33     PRINTER                        UC  144860
     F                                              KINFDS SPOOL          S01117
     FFF0582AUO   E                    PRINTER                            S01117
     F                                              KINFDS SPOOLU         S01117
      /SPACE 2
     F********************************************************************
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*             L4   CHANGE OF BRANCH ON CNFRP
     F*             L3   CHANGE OF CUSTOMER/BROKER CODE ON CNFRP
     F*             L2   CHANGE OF CURRENCY ON CNFRP
     F*             L1   CHANGE OF INSTRUMENT TYPE ON CNFRP
     F*
     F*
     F*        15        OPEN OF P1 INDICATOR                             S01117
     F*                                                                   S01117
     F*        20        FIRST CYCLE INDICATOR
     F*
     F*        21        LOKUP operation failed to array containing ccy
     F*                                                                   S01117
     F*        25        0 - AMERICAN STYLE NARRATIVE                     FF0011
     F*                  1 - EUROPEAN STYLE NARRATIVE                     FF0011
     F*                                                                   FF0011
     F*        26        PRINT RECIEVERS SETTLEMENT DETAILS               086389
     F*        27        PRINT RECIEVERS SETTLEMENT DETAILS (TOWN FLD)    086389
     F*                                                                   086389
     F*        30        MULTIBRANCHING INDICATOR                         S01117
     F*
     F*        33        FF0582P1 Print Overflow Indicator                144860
     F*                                                                   144860
     F*     60-62        Conditions output of certain fields when
     F*                  confirmations printed
     F*
     F*     80-89        Reserved for Standard FF Subroutines
     F*
     F*     90-99        Reserved for Standard MIDAS Subroutines
     F*
     F*        99        GENERAL CHAIN/READ FAIL INDICATOR FOR DB ERRORS
     F*
     F*     U7+U8        Database Errors
     F*
     F********************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E********************************************************************
     E                    NAR     1   8 30                                073714
     E                    POWER   1   7  7 3             POWER ARRAY      073714
      /COPY ZSRSRC,ZFRPEDZ1
      /COPY ZSRSRC,ZDATE2Z1
      /COPY ZSRSRC,FFPRCSZ2
     E                    CY        150  3
     E* CURRENCIES
     E                    DP        150  1 0
     E* CURRENCY DECIMAL PLACES
     E                    NM        150 20
     E* CURRENCY NAMES
      /EJECT
     ICNFRPDF
     I*
      ** Level break descriptions for Branch, Customer/broker and Currency
     I*
     I***********                                   BRCD  L4              S01117
     I                                              BRCA  L4              S01117
     I                                              CBCD  L3
     I                                              ISCY  L2
     I                                              ISTT  L1
     ITRANSDF
     I*
      ** Rename of fields on TRANS2
     I*
     I***********   BRCD                            BRCDT                 S01117
     I              BRCA                            BRCDT                 S01117
     I              ISTT                            ISTTT
     I              ISCY                            ISCYT
     I              PCAL                            PCALT
     I              STRP                            STRPT
     IINTYPDF
     I*
      ** Rename of fields on INTYP
     I*
     I              ISCY                            ISCYI
     I*
     IFOCLTDF                                                             S01117
     I*                                                                   S01117
      ** Rename of fields on FOCLT                                        S01117
     I*                                                                   S01117
     I              SETP                            SETPFO                S01117
     I              SETA                            SETAFO                S01117
     I              SEBR                            SEBRFO                S01117
     I              FACO                            FACOFO                086389
     I              CNOS                            CNOSFO                086389
     I*                                                                   S01117
     I** FILE INFORMATION DATA STRUCTURE                                  S01117
     I*                                                                   S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*  LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   S01117
     I** DATA AREA RUNDAT                                                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      **  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      ** EXTERNAL DS FOR BRANCHES DETAILS                                 S01117
     I              A8BICN                          BICN                  S01117
      *                                                                   S01117
     I@DSFDY    E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I*___________________________________________________________________084174
     I* 084174                                                            084174
     I*                                                                   084174
     I***P#CORR    E DSCGCORRPD                                     084174087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     IP#ALTN    E DSSDALTNPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#CUSD    E DSSDCUSTPD                                              087284
     I              QQDFAC                          QQDFC1                                    CGL029
     I*                                                                   087284
     I* Data structure for returned values from AOCUSTR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     I*                                                                   087284
     I* 084174                                                            084174
     I*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~084174
     I**                                                                  S01117
     I*                                                                   087284
     ISDACOD    E DSSDACODPD                                                                  CGL029
     I** External data structure for A/c details                                              CGL029
     I*                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                 087284
     I*                                                                   087284
     I** Second DS for access programs, Long data structure               087284
      /COPY ZSRSRC,FFSETLZ1
      /COPY ZSRSRC,ZFRPEDZ2
      /COPY ZSRSRC,FFSRDSZ1
      /COPY ZSRSRC,FFPRCSZ3
     I*                                                                   086389
     IKCPSH       DS                             12                       086389
     I*    Key for Counterparty Nostro Table file                         086389
     I                                        1   2 KCPSH1                086389
     I                                        5  12 KCPSH2                086389
     I*
     ITBKEY       DS                             12
     I*  DATASTRUCTURE TO ACCESS TABLE FILES
     I                                        1   2 TBK1
     I                                        9  12 TBK2
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     C*
      ** CLINT FILE KEY
     C*
     C************LIKE     DEFN CNUM      CUST                            084174
     C************LIKE     DEFN RCDT      TYPE                            084174
     C           *LIKE     DEFN QOTC      TQOTC
     C*
     C***********CLINTK    KLIST          TYPE                            084174
     C***********          KFLD           CUST                            084174
     C***********          KFLD           TYPE                            084174
      /COPY ZSRSRC,FFSETLZ2
      /EJECT
     C********************************************************************
      **             M A I N   P R O C E S S I N G
     C********************************************************************
     C*
      ** IF first cycle indicator is off
      **     Perform Initial processing
     C*
     C           *IN20     IFEQ '0'
     C                     EXSR INIT
     C                     END
     C*                                                                   S01117
     C**  COUNT NO. OF RECORDS READ FROM CNFRP                            S01117
     C*                                                                   S01117
     C                     ADD  1         COUNT                           S01117
     C*
      ** IF Indicator L4 is on
      *******Access*TABLETR*for*branch************************************S01117
      **     Access SDBRCHPD for branch                                   S01117
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL4     IFEQ '1'
     C                     CLOSEFF0582P1                                  S01117
     C                     OPEN FF0582P1                                  S01117
     C                     SETON                     15                   S01117
     C*                                                                   S01117
     C                     Z-ADD0         PAGE                            S01117
     C*                                                                   S01117
      **   ENSURE REPORT SPOOL FILE RECORDED BY RCF                       S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM BRCA      SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*  GET BRANCH DETAILS                                               S01117
     C*                                                                   S01117
     C***********          MOVE *BLANKS   TBKEY                           S01117
     C***********          MOVE '10'      TBK1                            S01117
     C***********          MOVE BRCD      TBK2                            S01117
     C***********TBKEY     CHAINTABLETRF             99                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                          S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C***********          MOVELTBKEY     DBKEY            ***************S01117
     C                     MOVEL@DSNB     DBKEY            ***************S01117
     C                     Z-ADD1         DBASE            * DB ERROR 01 *
     C                     MOVEL@OPTN     DBOPTN  7                      *S01117
     C                     MOVEL*BLANKS   BRNM   30        *             *S01117
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C                     MOVELA8BRNM    BRNM                            S01117
     C                     END
     C*
      ** IF Indicator L3 is on
      **     Access CLINT for Customer/broker
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL3     IFEQ '1'
     C***********          MOVE CBCD      CUST                            084174
     C*
      ** Access FOCLT for correspondence address
     C           CBCD      CHAINFOCLT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'FOCLT'   DBFILE
     C                     MOVELCBCD      DBKEY            ***************
     C                     Z-ADD2         DBASE            * DB ERROR 02 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
      ***If*correspondence address not blank, access CLINT for            084174
      ***alternate name/address                                           084174
     C***********CORA      IFNE *BLANK                                    084174
     C***********          MOVE CORA      TYPE                            084174
     C********** CLINTK    CHAINCLINT                99                   084174
     C**********           END                                            084174
     C*                                                                   084174
     C* Retrieve correspondent details from CGCORRPD via AOALTNR0:        084174
     C*                                                                   084174
     C                     MOVELCBCD      P#CUST                          084174
     C                     MOVEL*BLANKS   P#CUS1                          087284
     C                     MOVELCBCD      P#CUS1                          087284
      *                                                                   087284
      * If address reference is blank or B use AOCUSTRO else AOALTNR0     087284
      *                                                                   087284
     C           CORA      IFEQ *BLANK                                    087284
     C           CORA      OREQ 'B'                                       087284
     C                     CALL 'AOCUSTR0'             9090               087284
     C                     PARM *BLANKS   P#RTCD  7                       087284
     C                     PARM '*KEY   ' P#OPTN  7                       087284
     C                     PARM           P#CUS1 10                       087284
     C                     PARM *BLANKS   P#KYST  7                       087284
     C           P#CUSD    PARM *BLANKS   DSSDY                           087284
      *                                                                   087284
     C           *IN90     IFEQ '1'                                       087284
     C           *LOCK     IN   LDA                                       087284
     C                     MOVEL'AOCUSTR0'DBFILE           ***************087284
     C                     MOVELP#CUS1    DBKEY            * DB ERROR 13 *087284
     C                     Z-ADD13        DBASE            ***************087284
     C                     OUT  LDA                                       087284
     C                     EXSR DBERR                                     087284
     C                     ELSE                                           087284
     C                     MOVELBBCNA1    CNA1                            087284
     C                     MOVELBBCNA2    CNA2                            087284
     C                     MOVELBBCNA3    CNA3                            087284
     C                     MOVELBBCNA4    CNA4                            087284
     C                     END                                            087284
     C                     ELSE                                           087284
     C*                                                                   084174
     C                     CALL 'AOALTNR0'                                084174
     C                     PARM *BLANKS   P#RTCD  7        B:Return code  084174
     C                     PARM '*KEY   ' P#OPTN  7        I:Option       084174
     C                     PARM           P#CUST  6        I:Customer no. 084174
     C                     PARM CORA      P#ADCD  1        I:Address code 084174
     C***********P#CORR    PARM P#CORR    @DSFDY           O:Format 084174087284
     C           P#ALTN    PARM P#ALTN    @DSFDY           O:Format       087284
     C*                                                                   084174
     C           P#RTCD    IFEQ *BLANKS                                   084174
     C***********          MOVELCDADD1    CNA1                      084174087284
     C***********          MOVELCDADD2    CNA2                      084174087284
     C***********          MOVELCDADD3    CNA3                      084174087284
     C***********          MOVELCDADD4    CNA4                      084174087284
     C                     MOVELBCCNA1    CNA1                            087284
     C                     MOVELBCCNA2    CNA2                            087284
     C                     MOVELBCCNA3    CNA3                            087284
     C                     MOVELBCCNA4    CNA4                            087284
     C                     ENDIF                                          084174
     C                     ENDIF                                          084174
     C*
     C***If*record*not*found*or*correspondence*address*is*blank,          084174
     C***access*CLINT*for*name/addressme/address                          084174
     C********** *IN99     IFEQ '1'                                       084174
     C********** RECI      ORNE 'D'                                       084174
     C********** CORA      OREQ *BLANK                                    084174
     C***********                                                         084174
     C***********          MOVE 'B'       TYPE                            084174
     C********** CLINTK    CHAINCLINT                99                   084174
     C***********                                                         084174
     C********** *IN99     IFEQ '1'                                       084174
     C********** RECI      ORNE 'D'                                       084174
     C********** *LOCK     IN   LDA                                 084174S01117
     C***********          MOVE 'CLINT'   DBFILE                          084174
     C***********          MOVELCBCD      DBKEY            ***************084174
     C***********          Z-ADD3         DBASE            * DB ERROR 03 *084174
     C***********          EXSR DBERR                      ***************084174
     C***********          END                                            084174
     C***********          END                                            084174
     C*
     C**Retrieve*correspondent details from CGCORRPD via AOALTNR0:  084174087284
     C***********                                                   084174087284
     C***********P#RTCD    IFNE *BLANKS                             084174087284
     C***********CORA      OREQ *BLANK                              084174087284
     C***********          MOVELCBCD      P#CUST                    084174087284
     C***********          MOVE 'B'       P#ADCD                    084174087284
     C***********                                                   084174087284
     C***********          CALL 'AOALTNR0'                          084174087284
     C***********          PARM *BLANKS   P#RTCD           B:Return 084174087284
     C***********          PARM '*KEY   ' P#OPTN           I:Option 084174087284
     C***********          PARM           P#CUST           I:Custome084174087284
     C***********          PARM           P#ADCD           I:Address084174087284
     C***********P#CORR    PARM P#CORR    @DSFDY           O:Format 084174087284
     C***********                                                   084174087284
     C***********P#RTCD    IFEQ *BLANKS                             084174087284
     C***********          MOVELCDADD1    CNA1                      084174087284
     C***********          MOVELCDADD2    CNA2                      084174087284
     C***********          MOVELCDADD3    CNA3                      084174087284
     C***********          MOVELCDADD4    CNA4                      084174087284
     C***********          ENDIF                                    084174087284
     C***********          ENDIF                                    084174087284
     C*
     C                     END
     C*
      ** IF Indicator L2 is on
      **     Determine the settlement account
     C*
     C           *INL2     IFEQ '1'
     C*
     C***********          Z-ADDBRCD      FFBRCD                          S01117
     C                     MOVE BRCA      FFBRCA                          S01117
     C**********           Z-ADDCBCD      FFCBCD                                              CSD027
     C                     MOVE CBCD      FFCBCD                                              CSD027
     C                     MOVE 'N'       FFBRKI
     C***********          MOVE BICN      FFBRKI                          HK0000
     C                     Z-ADDSETP      FFSETP
     C*                                                                   S01117
     C           SEBR      IFNE *BLANK                                    S01117
     C                     MOVE SEBR      FFSETB                          S01117
     C                     ELSE                                           S01117
     C                     MOVE SBID      FFSETB                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE SETA      FFSETA
     C                     MOVE ISCY      FFCCY
     C***********                                                         S01117
     C***********MBIN      IFEQ 'Y'                                       S01117
     C***********          Z-ADDNSACS     FFDASQ                          S01117
     C***********          ELSE                                           S01117
     C***********          Z-ADD1         FFDASQ                          S01117
     C***********          END                                            S01117
     C*
     C                     EXSR FFSETL
     C*
      **     Obtain currency decimal places
     C*
     C                     MOVE ISCY      CURRY
     C                     EXSR OBTCR
     C                     MOVE CDP       ICDP
     C*
     C                     END
     C*
      ** IF Indicator L1 is on
      **     Access INTYP for instrument details
      **     IF no record found,
      **     OR record not live
      **          Perform Database error processing
     C*
     C           *INL1     IFEQ '1'
     C           ISTT      CHAININTYP                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELISTT      DBKEY            ***************
     C                     Z-ADD4         DBASE            * DB ERROR 04 *
     C                     EXSR DBERR                      ***************
     C                     END
     C***********                                                         073714
      *******Obtain other currency decimal places if required             073714
     C***********                                                         073714
     C***********OTHC      IFNE *BLANKS                                   073714
     C***********          MOVE OTHC      CURRY                           073714
     C***********          EXSR OBTCR                                     073714
     C***********          MOVE CDP       OCDP                            073714
     C***********          END                                            073714
     C***********                                                  FF0011 073714
      *******If*the instrument is a European style option format   FF0011 073714
      *******narrative.                                            FF0011 073714
     C***********                                                  FF0011 073714
     C***********AEIN      IFEQ 'E'                                FF0011 073714
     C***********                                                  FF0011 073714
      *******use*narrative 'ON'                                    FF0011 073714
     C***********                                                  FF0011 073714
     C***********          SETON                     25            FF0011 073714
     C***********          ELSE                                    FF0011 073714
     C***********                                                  FF0011 073714
      *******use*narrative 'ON or BEFORE'                          FF0011 073714
     C***********                                                  FF0011 073714
     C***********          SETOF                     25            FF0011 073714
     C***********          END                                     FF0011 073714
     C***********                                                  FF0011 073714
     C*                                                                   073714
      **     Obtain delivery currency decimal places                      073714
     C*                                                                   073714
     C           OTHC      IFNE *BLANKS                                   CPL002
     C                     MOVE OTHC      CURRY                           073714
     C                     EXSR OBTCR                                     073714
     C                     MOVE CDP       DCDP                            073714
     C                     ENDIF                                          CPL002
     C*                                                                   073714
      **     Obtain counter currency decimal places                       073714
     C*                                                                   073714
     C           CTCY      IFNE *BLANK                                    073714
     C                     MOVE CTCY      CURRY                           073714
     C                     EXSR OBTCR                                     073714
     C                     MOVE CDP       CCDP                            073714
     C                     END                                            073714
     C*
     C                     END
      *
      ** Access the transaction involved off TRANS2
      *
     C           TNBR      CHAINTRANS2               99
      *
      **     IF no record found,
      **          Perform Database error processing
      *
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELTNBR      DBKEY            ***************
     C                     Z-ADD5         DBASE            * DB ERROR 05 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*                                                                   073714
      ** Transaction number                                               073714
     C*                                                                   073714
     C                     MOVELTNBR      RTNBR                           073714
     C***********                                                         073714
      ***Transaction number may be negative (for trades at maturity)      073714
     C***********                                                         073714
     C***********TNBR      IFGT *ZERO                                     073714
     C***********          MOVELTNBR      RTNBR                           073714
     C***********          MOVE '    '    RTNBR                           073714
     C***********          ELSE                                           073714
     C***********          Z-SUBTNBR      WTNBR   60                      073714
     C***********          MOVELWTNBR     RTNBR                           073714
     C***********          MOVE '-(M)'    RTNBR                           073714
     C***********          END                                            073714
      *
      ***If*the*instrument*processing type is 1 or 3, perform otc-conf-1/3073714
      ***If*the*instrument*processing type is 2, perform otc-conf-2       073714
      ***If*the*instrument*processing type is 4 or 6, perform otc-conf-4/6073714
      ***If*the*instrument processing type is 5, perform otc-conf-5       073714
      ***********                                                         073714
     C***********ISPT      CASEQ1         OTC13                           073714
     C***********ISPT      CASEQ3         OTC13                           073714
     C***********ISPT      CASEQ2         OTC2                            073714
     C*                                                                   073714
     C** Process Trades                                                   073714
     C*                                                                   073714
     C           TRTY      IFEQ 'P'                                       073714
     C           TRTY      OREQ 'S'                                       073714
     C           TNBR      IFGT *ZERO                                     073714
     C*                                                                   073714
     C           ISPT      CASEQ4         OTC46
     C           ISPT      CASEQ6         OTC46
     C           ISPT      CASEQ5         OTC5
     C*
     C                     END
      *                                                                   073714
      ** DELETE RECORD ON CNFRPD                                          073714
      *                                                                   073714
     C                     DELETCNFRPDF                                   073714
     C                     END                                            073714
     C                     END                                            073714
     C*                                                                   S01117
     CLR                   EXSR WRITAU                                    S01117
      /EJECT
     C********************************************************************
      **               INDEX TO SUBROUTINES
     C*************                                                       073714
      ***OTC13*****FORMAT OTC RECORD TYPES 1 OR 3                         073714
     C*************                                                       073714
      ***OTC2******FORMAT OTC RECORD TYPE 2                               073714
     C*
      ** OTC46     FORMAT OTC RECORD TYPES 4 OR 6
     C*
      ** OTC5      FORMAT RECORD TYPE 5
     C*
      ** OBTCR     OBTAIN CURRENCY DECIMAL PLACES
     C*
      ** INIT      PERFORM FIRST CYCLE OPERATIONS ONLY
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C***********                                                         073714
      ***S/R*OTC13 TO FORMAT OTC RECORD TYPES 1 OR 3                      073714
     C***********                                                         073714
      ***CALLED*FROM MAIN PROCESSING                                      073714
     C***********                                                         073714
      ***CALLS**FFSETL, ZDATE2, FFPRCS, ZZFRPED                           073714
     C***********                                                         073714
     C*********** * * * * * * * * * * * * * * * * * * * * * * * * * * * * 073714
     C***********                                                         073714
     C***********OTC13     BEGSR                                          073714
      ***********                                                         073714
      ***Reversal if REVI = 1                                             073714
      ***********                                                         073714
     C***********          MOVE REVI      *IN60                           073714
      ***********                                                         073714
      ***Print*Purchase if transaction type is S                          073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'S'                                       073714
     C***********          MOVE '1'       *IN61                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Print*Sale if transaction type is P                              073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********          MOVE '0'       *IN61                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Format*transaction date                                          073714
      ***********                                                         073714
     C***********          Z-ADDPOCD      ZDAYNO                          073714
     C***********          EXSR ZDATE2                                    073714
     C***********          MOVE ZADATE    RDAT                            073714
      ***********                                                         073714
      ***Format*contract price                                            073714
      ***********                                                         073714
     C***********          Z-ADDCOPR      FFPRIC                          073714
     C***********          Z-ADDTKDM      FFTKDM                          073714
     C***********          Z-ADDMNPF      FFMNPF                          073714
     C***********          EXSR FFPRCS                                    073714
     C***********          MOVE FFSPRC    RCOPR                           073714
      ***********                                                         073714
      ***Format*settlement date                                           073714
      ***********                                                         073714
     C***********          Z-ADDSETD      ZDAYNO                          073714
     C***********          EXSR ZDATE2                                    073714
     C***********          MOVE ZADATE    RSETD                           073714
     C***********          MOVE ZADATE    RSETD1                   FF0011 073714
      ***********                                                         073714
      ***Total*Contingent amount = contingent amount * no. of contracts   073714
      ***********                                                         073714
     C************LIKE     DEFN CTAM      TCTAM                           073714
     C***********          Z-ADD0         TCTAM                           073714
     C***********CTAM      MULT TOCN      TCTAM                           073714
     C***********          Z-ADDTCTAM     ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          MOVE 'J'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCAM                           073714
      ***********                                                         073714
      ***Format*total commission                                          073714
      ***********                                                         073714
     C***********          Z-ADDTOCM      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          MOVE 'A'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCM                           073714
      ***********                                                         073714
      ***Format*total charges                                             073714
      ***********                                                         073714
     C***********          Z-ADDTOCG      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCG                           073714
      ***********                                                         073714
      ***Format*total                                                     073714
      ***********                                                         073714
     C************LIKE     DEFN TOCM      TOTL                            073714
     C***********TOCM      ADD  TOCG      TOTL                            073714
     C***********          Z-ADDTOTL      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOTL                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RISCY                           073714
     C***********                                                         073714
     C***********          WRITEFMTP101                                   073714
     C***********                                                         073714
     C***********          ENDSR                                          073714
     C*/EJECT****                                                         073714
     C********************************************************************073714
     C***********                                                         073714
      ***S/R*OTC2 TO FORMAT OTC RECORD TYPE 2                             073714
     C***********                                                         073714
      ***CALLED*FROM MAIN PROCESSING                                      073714
     C***********                                                         073714
      ***CALLS**FFSETL, ZDATE2, FFPRCS, ZZFRPED                           073714
     C***********                                                         073714
     C*********** * * * * * * * * * * * * * * * * * * * * * * * * * * * * 073714
     C***********                                                         073714
     C***********OTC2      BEGSR                                          073714
      ***********                                                         073714
      ***Reversal if REVI = 1                                             073714
      ***********                                                         073714
     C***********          MOVE REVI      *IN60                           073714
      ***********                                                         073714
      ***Print*Purchase if transaction type is S                          073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'S'                                       073714
     C***********          MOVE '1'       *IN61                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Print*Sale if transaction type is P                              073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********          MOVE '0'       *IN61                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Format*transaction date                                          073714
      ***********                                                         073714
     C***********          Z-ADDPOCD      ZDAYNO                          073714
     C***********          EXSR ZDATE2                                    073714
     C***********          MOVE ZADATE    RDAT                            073714
     C***********                                                         073714
     C***********          MOVE OTHC      ISCYA                           073714
     C***********          MOVE ISCY      RISCY                           073714
      ***********                                                         073714
      ***Total*Contingent amount = contingent amount * no. of contracts   073714
      ***********                                                         073714
     C***********          Z-ADD0         TCTAM                           073714
     C***********CTAM      MULT TOCN      TCTAM                           073714
     C***********          Z-ADDTCTAM     ZFLD15                          073714
     C***********          Z-ADDOCDP      ZDECS                           073714
     C***********          MOVE 'J'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCAM                           073714
      ***********                                                         073714
      ***Total*Contingent amount * contract price * 10pwr quotation       073714
      ***********      convention  *10pwr rate conversion factor          073714
      ***********                                                         073714
     C************LIKE     DEFN RTCB      TCNT                            073714
     C***********TCTAM     MULT COPR      TCNT                            073714
      ***********                                                         073714
     C***********QOTC      IFGT 0                                         073714
     C***********          DO   QOTC                                      073714
     C***********TCNT      MULT 10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********QOTC      IFLT 0                                         073714
     C***********QOTC      MULT -1        TQOTC                           073714
     C***********          DO   TQOTC                                     073714
     C***********TCNT      DIV  10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********ICDP      SUB  OCDP      RCNF    10                      073714
      ***********                                                         073714
     C***********RCNF      IFGT 0                                         073714
     C***********          DO   RCNF                                      073714
     C***********TCNT      MULT 10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********RCNF      IFLT 0                                         073714
     C***********RCNF      MULT -1        RCNF                            073714
     C***********          DO   RCNF                                      073714
     C***********TCNT      DIV  10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********          MOVE TCNT      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCNT                           073714
      ***********                                                         073714
      ***Format*contract price                                            073714
      ***********                                                         073714
     C***********          Z-ADDCOPR      FFPRIC                          073714
     C***********          Z-ADDTKDM      FFTKDM                          073714
     C***********          Z-ADDMNPF      FFMNPF                          073714
     C***********          EXSR FFPRCS                                    073714
     C***********          MOVE FFSPRC    RCOPR                           073714
      ***********                                                         073714
      ***Format*settlement date                                           073714
      ***********                                                         073714
     C***********          Z-ADDSETD      ZDAYNO                          073714
     C***********          EXSR ZDATE2                                    073714
     C***********          MOVE ZADATE    RSETD                           073714
      ***********                                                         073714
      ***Format*total commission                                          073714
      ***********                                                         073714
     C***********          Z-ADDTOCM      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          MOVE 'A'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCM                           073714
      ***********                                                         073714
      ***Format*total charges                                             073714
      ***********                                                         073714
     C***********          Z-ADDTOCG      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCG                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RCCY                            073714
      ***********                                                         073714
      ***Format*total                                                     073714
      ***********                                                         073714
     C***********TOCM      ADD  TOCG      TOTL                            073714
     C***********          Z-ADDTOTL      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOTL                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RCCY1                           073714
     C***********                                                         073714
     C***********          WRITEFMTP102                                   073714
     C***********                                                         073714
     C***********          ENDSR                                          073714
     C*/EJECT****                                                         073714
     C********************************************************************
     C*
      ** S/R OTC46 TO PROCESS OTC RECORD TYPES 4 OR 6
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS  FFSETL, ZDATE2, FFPRCS, ZZFRPED
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           OTC46     BEGSR
      ***********                                                         073714
      ***Reversal if REVI = 1                                             073714
      ***********                                                         073714
     C***********          MOVE REVI      *IN60                           073714
     C***********                                                         073714
      ***Option*exercised if transaction type is E, format accordingly    073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'E'                                       073714
     C***********          MOVE '0'       *IN61                           073714
     C***********                                                         073714
     C***********PCAL      IFEQ 'C'                                       073714
     C***********          MOVE 'SELL'    RNAR5                           073714
     C***********          END                                            073714
     C***********PCAL      IFEQ 'P'                                       073714
     C***********          MOVE 'BUY '    RNAR5                           073714
     C***********          END                                            073714
     C***********ULTT      IFEQ 'S'                                       073714
     C***********          MOVE 'YOU'     RNAR3                           073714
     C***********          MOVE 'YOUR'    RNAR4                           073714
     C***********          END                                            073714
     C***********ULTT      IFEQ 'P'                                       073714
     C***********          MOVE 'WE '     RNAR3                           073714
     C***********          MOVE 'OUR '    RNAR4                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Otherwise option has ben traded                                  073714
      ***********                                                         073714
     C***********          ELSE                                           073714
     C***********          MOVE '1'       *IN61                           073714
     C***********                                                         073714
     C***********PCAL      IFEQ 'C'                                       073714
     C***********          MOVE 'SELL'    RNAR2                           073714
     C***********          END                                            073714
     C***********PCAL      IFEQ 'P'                                       073714
     C***********          MOVE 'BUY '    RNAR2                           073714
     C***********          END                                            073714
     C***********TRTY      IFEQ 'S'                                       073714
     C***********          MOVE 'YOUR'    RNAR1                           073714
     C***********          END                                            073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********          MOVE 'OUR '    RNAR1                           073714
     C***********          END                                            073714
     C***********                                                         073714
     C***********          END                                            073714
     C***********                                                         073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********TRTY      OREQ 'S'                                       073714
     C***********          MOVE '1'       *IN62                           073714
     C***********          ELSE                                           073714
     C***********          MOVE '0'       *IN62                           073714
     C***********          END                                            073714
     C*
      ** Bought From/Sold To                                              073714
     C*                                                                   073714
     C           TRTY      IFEQ 'P'                                       073714
     C                     MOVELNAR,1     RTNRBS                          073714
     C                     ELSE                                           073714
     C                     MOVELNAR,2     RTNRBS                          073714
     C                     END                                            073714
      *
      ** Format transaction date
      *
     C                     Z-ADDPOCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RDAT
      *                                                                   073714
      ** Option type (PUT/CALL)                                           073714
      *                                                                   073714
     C           PCAL      IFEQ 'P'                                       073714
     C                     MOVEL'PUT '    RNOT2                           073714
     C                     ELSE                                           073714
     C                     MOVEL'CALL'    RNOT2                           073714
     C                     END                                            073714
      *                                                                   073714
      ** Delivery Currency                                                073714
      *                                                                   073714
     C                     MOVELOTHC      RDCCY                           073714
      *                                                                   073714
      ** Total Delivery Amount                                            073714
      *                                                                   073714
     C                     Z-ADD0         TCTAM  150                      073714
     C           CTAM      MULT TOCN      TCTAM                           073714
     C                     Z-ADDTCTAM     ZFLD15                          073714
     C                     Z-ADDDCDP      ZDECS                           073714
     C                     MOVE 'J'       ZECODE                          073714
     C                     EXSR ZFRPED                                    073714
     C                     MOVE ZOUT22    RCTAM                           073714
      *                                                                   073714
      ** INSTRUMENT                                                       073714
      *                                                                   073714
     C           CMRF      IFNE *BLANK                                    073714
     C                     MOVEL'of '     RINST                           073714
     C                     MOVE CMRF      RINST                           073714
     C                     ELSE                                           073714
     C                     MOVEL*BLANK    RINST                           073714
     C                     END                                            073714
      *
      ** Format strike price
      *
     C                     Z-ADDSTRP      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RSTRP
     C*                                                                   073714
      ** Style                                                            073714
     C*                                                                   073714
     C***********TRTY      IFEQ 'E'                                 073714099433
     C           AEIN      IFEQ 'E'                                       099433
     C                     MOVELNAR,3     RSTYL                           073714
     C                     ELSE                                           073714
     C                     MOVELNAR,4     RSTYL                           073714
     C                     END                                            073714
      *                                                                   073714
      ** Format expiry date (final transaction date)                      073714
      *                                                                   073714
     C                     Z-ADDFTDT      ZDAYNO                          073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZADATE    RFTDT                           073714
      *                                                                   073714
      ** Format expiry time (final transaction time)                      073714
      *                                                                   073714
     C                     MOVELFTTM      RFTTM1                          073714
     C                     MOVE FTTM      RFTTM2                          073714
      *
      ** Format settlement date
      *
     C                     Z-ADDSETD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RSETD
      ***********                                                         073714
      ***Total*Contingent*amount = contingent amount * no. of contracts   073714
      ***********                                                         073714
     C***********          Z-ADD0         TCTAM                           073714
     C***********CTAM      MULT TOCN      TCTAM                           073714
     C***********          Z-ADDTCTAM     ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          MOVE 'J'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCAM                           073714
      *                                                                   073714
      ** Format contract price                                            073714
      *                                                                   073714
     C                     Z-ADDCOPR      FFPRIC                          073714
     C                     Z-ADDTKDM      FFTKDM                          073714
     C                     Z-ADDMNPF      FFMNPF                          073714
     C                     EXSR FFPRCS                                    073714
     C                     MOVE FFSPRC    RCOPR                           073714
      *                                                                   073714
      ** Format premium currency                                          073714
      *                                                                   073714
     C                     MOVE ISCY      RPRCY                           073714
     C*                                                                   073714
      ** You or We  & Us or You                                           073714
     C*                                                                   073714
     C           TRTY      IFEQ 'P'                                       073714
     C                     MOVELNAR,5     RYOW                            073714
     C                     MOVELNAR,6     RUOY                            073714
     C                     ELSE                                           073714
     C                     MOVELNAR,7     RYOW                            073714
     C                     MOVELNAR,8     RUOY                            073714
     C                     END                                            073714
      *                                                                   073714
      ** Format premium currency                                          073714
      *                                                                   073714
     C                     MOVE ISCY      RPCY2                           073714
      *
      ***Format*total*profit                                              073714
      ** Format total premium                                             073714
      *
     C                     Z-ADDTOPR      ZFLD15
     C                     Z-ADDICDP      ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTOPR
      *                                                                   073714
      ** Format value date                                                073714
      *                                                                   073714
     C* Check premium-up front indicator                                  144941
     C           PUPF      IFEQ 'Y'                                       144941
     C                     Z-ADDVALD      ZDAYNO                          073714
     C                     ELSE                                           144941
     C                     Z-ADDSETD      ZDAYNO                          144941
     C                     ENDIF                                          144941
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZADATE    RVALD                           073714
      *                                                                   086389
      ** Format Receivers settlement details ('At' fields if              086389
      ** applicable)                                                      086389
      *                                                                   086389
     C                     EXSR ATFLDS                                    086389
     C***********                                                         073714
      ***Format*total commission                                          073714
      ***********                                                         073714
     C***********          Z-ADDTOCM      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCM                           073714
      ***********                                                         073714
      ***Format*total charges                                             073714
      ***********                                                         073714
     C***********          Z-ADDTOCG      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCG                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RICY                            073714
      ***********                                                         073714
      ***Format*total                                                     073714
      ***********                                                         073714
     C***********TOCM      ADD  TOCG      TOTL                            073714
     C***********          ADD  TOPR      TOTL                            073714
     C***********          Z-ADDTOTL      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOTL                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RISCY                           073714
     C*
     C                     WRITEFMTP103
     C                     WRITEFMTAT                                     086389
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*
      ** S/R OTC5 TO PROCESS OTC RECORD TYPE 5
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           OTC5      BEGSR
      ***********                                                         073714
      ***Reversal if REVI = 1                                             073714
      ***********                                                         073714
     C***********          MOVE REVI      *IN60                           073714
     C***********                                                         073714
      ***Option*exercised if transaction type is E, format accordingly    073714
      ***********                                                         073714
     C***********TRTY      IFEQ 'E'                                       073714
     C***********          MOVE '0'       *IN61                           073714
     C***********                                                         073714
     C***********PCAL      IFEQ 'P'                                       073714
     C***********          MOVE 'SELL'    RNAR5                           073714
     C***********          END                                            073714
     C***********PCAL      IFEQ 'C'                                       073714
     C***********          MOVE 'BUY '    RNAR5                           073714
     C***********          END                                            073714
     C***********ULTT      IFEQ 'S'                                       073714
     C***********          MOVE 'YOU'     RNAR3                           073714
     C***********          MOVE 'YOUR'    RNAR4                           073714
     C***********          END                                            073714
     C***********ULTT      IFEQ 'P'                                       073714
     C***********          MOVE 'WE '     RNAR3                           073714
     C***********          MOVE 'OUR '    RNAR4                           073714
     C***********          END                                            073714
      ***********                                                         073714
      ***Otherwise option has been traded                                 073714
      ***********                                                         073714
     C***********          ELSE                                           073714
     C***********          MOVE '1'       *IN61                           073714
     C***********                                                         073714
     C***********PCAL      IFEQ 'P'                                       073714
     C***********          MOVE 'SELL'    RNAR2                           073714
     C***********          END                                            073714
     C***********PCAL      IFEQ 'C'                                       073714
     C***********          MOVE 'BUY '    RNAR2                           073714
     C***********          END                                            073714
     C***********TRTY      IFEQ 'S'                                       073714
     C***********          MOVE 'YOUR'    RNAR1                           073714
     C***********          END                                            073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********          MOVE 'OUR '    RNAR1                           073714
     C***********          END                                            073714
     C***********                                                         073714
     C***********          END                                            073714
     C***********                                                         073714
     C***********TRTY      IFEQ 'P'                                       073714
     C***********TRTY      OREQ 'S'                                       073714
     C***********          MOVE '1'       *IN62                           073714
     C***********          ELSE                                           073714
     C***********          MOVE '0'       *IN62                           073714
     C***********          END                                            073714
     C*
      ** Bought From/Sold To                                              073714
     C*                                                                   073714
     C           TRTY      IFEQ 'P'                                       073714
     C                     MOVELNAR,1     RTNRBS                          073714
     C                     ELSE                                           073714
     C                     MOVELNAR,2     RTNRBS                          073714
     C                     END                                            073714
      *
      ** Format transaction date
      *
     C                     Z-ADDPOCD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RDAT
      *                                                                   073714
      ** Option type (XXX PUT/CALL against YYY)                           073714
      *                                                                   073714
     C                     MOVELOTHC      RNOT1                           073714
     C           PCAL      IFEQ 'P'                                       073714
     C                     MOVEL'PUT '    RNOT2                           073714
     C                     ELSE                                           073714
     C                     MOVEL'CALL'    RNOT2                           073714
     C                     END                                            073714
     C                     MOVELCTCY      RNOT3                           073714
      *                                                                   073714
      ** Delivery Currency                                                073714
      *                                                                   073714
     C                     MOVELOTHC      RDCCY                           073714
      *                                                                   073714
      ** Total Delivery Amount                                            073714
      *                                                                   073714
     C                     Z-ADD0         TCTAM                           073714
     C           CTAM      MULT TOCN      TCTAM                           073714
     C                     Z-ADDTCTAM     ZFLD15                          073714
     C                     Z-ADDDCDP      ZDECS                           073714
     C                     MOVE 'J'       ZECODE                          073714
     C                     EXSR ZFRPED                                    073714
     C                     MOVE ZOUT22    RCTAM                           073714
     C***********                                                         073714
      ***Total*Contingent amount = contingent amount * no. of contracts   073714
      ***********                                                         073714
     C***********          Z-ADD0         TCTAM                           073714
     C***********CTAM      MULT TOCN      TCTAM                           073714
      ***********                                                         073714
     C***********          Z-ADDTCTAM     ZFLD15                          073714
     C***********          Z-ADDOCDP      ZDECS                           073714
     C***********          MOVE 'J'       ZECODE                          073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCAM                           073714
     C***********                                                         073714
      ***Total*Contingent amount * strike price * 10pwr quotation         073714
      ******convention * 10pwr rate conversion factor                     073714
      ***********                                                         073714
     C***********TCTAM     MULT STRP      TCNT                            073714
      ***********                                                         073714
     C***********QOTC      IFGT 0                                         073714
     C***********          DO   QOTC                                      073714
     C***********TCNT      MULT 10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********QOTC      IFLT 0                                         073714
     C***********QOTC      MULT -1        TQOTC                           073714
     C***********          DO   TQOTC                                     073714
     C***********TCNT      DIV  10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********ICDP      SUB  OCDP      RCNF                            073714
      ***********                                                         073714
     C***********RCNF      IFGT 0                                         073714
     C***********          DO   RCNF                                      073714
     C***********TCNT      MULT 10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********RCNF      IFLT 0                                         073714
     C***********RCNF      MULT -1        RCNF                            073714
     C***********          DO   RCNF                                      073714
     C***********TCNT      DIV  10        TCNT                            073714
     C***********          END                                            073714
     C***********          END                                            073714
      ***********                                                         073714
     C***********          MOVE TCNT      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTCNT                           073714
     C***********                                                         073714
     C***********          MOVE OTHC      ISCYA                           073714
     C***********          MOVE ISCY      RISCY                           073714
      *
      ** Format strike price
      *
     C                     Z-ADDSTRP      FFPRIC
     C                     Z-ADDTKDM      FFTKDM
     C                     Z-ADDMNPF      FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RSTRP
      *                                                                   073714
      ** Counter Currency                                                 073714
      *                                                                   073714
     C                     MOVELCTCY      RCTCY                           073714
      *                                                                   073714
      ** Total Counter Currency Amount                                    073714
      *                                                                   073714
     C                     Z-ADD0         TCCAM  150                      073714
     C           CCAM      MULT TOCN      TCCAM                           073714
     C                     Z-ADDTCCAM     ZFLD15                          073714
     C                     Z-ADDCCDP      ZDECS                           073714
     C                     MOVE 'J'       ZECODE                          073714
     C                     EXSR ZFRPED                                    073714
     C                     MOVE ZOUT22    RCCAM                           073714
     C*                                                                   073714
      ** Style                                                            073714
     C*                                                                   073714
     C           AEIN      IFEQ 'E'                                       073714
     C                     MOVELNAR,3     RSTYL                           073714
     C                     ELSE                                           073714
     C                     MOVELNAR,4     RSTYL                           073714
     C                     END                                            073714
      *                                                                   073714
      ** Format expiry date (final transaction date)                      073714
      *                                                                   073714
     C                     Z-ADDFTDT      ZDAYNO                          073714
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZADATE    RFTDT                           073714
      *                                                                   073714
      ** Format expiry time (final transaction time)                      073714
      *                                                                   073714
     C                     MOVELFTTM      RFTTM1                          073714
     C                     MOVE FTTM      RFTTM2                          073714
      *
      ** Format settlement date
      *
     C                     Z-ADDSETD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RSETD
      *                                                                   073714
      ** Format contract price                                            073714
      *                                                                   073714
     C           4         ADD  QOTC      Z010    10                      073714
     C           COPR      MULT POWER,Z010FFPRIC                          073714
     C                     Z-ADDTKDM      FFTKDM                          073714
     C                     Z-ADDMNPF      FFMNPF                          073714
     C                     EXSR FFPRCS                                    073714
     C                     MOVE FFSPRC    RCOPR                           073714
      *                                                                   073714
      ** Format premium currency and delivery currency (XXX per YYY)      073714
      *                                                                   073714
     C                     MOVE ISCY      RPRCY                           073714
     C                     MOVE OTHC      RDCY2                           073714
     C*                                                                   073714
      ** You or We  & Us or You                                           073714
     C*                                                                   073714
     C           TRTY      IFEQ 'P'                                       073714
     C                     MOVELNAR,5     RYOW                            073714
     C                     MOVELNAR,6     RUOY                            073714
     C                     ELSE                                           073714
     C                     MOVELNAR,7     RYOW                            073714
     C                     MOVELNAR,8     RUOY                            073714
     C                     END                                            073714
      *                                                                   073714
      ** Format premium currency                                          073714
      *                                                                   073714
     C                     MOVE ISCY      RPCY2                           073714
     C*********************MOVE ZADATE    RSETD1                   FF0011 073714
      *
      ***Format*profit                                                    073714
      ** Format premium                                                   073714
      *
     C                     Z-ADDTOPR      ZFLD15
     C                     Z-ADDICDP      ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTOPR
      *                                                                   073714
      ** Format value date                                                073714
      *                                                                   073714
     C* Check premium-up front indicator                                  144941
     C           PUPF      IFEQ 'Y'                                       144941
     C                     Z-ADDVALD      ZDAYNO                          073714
     C                     ELSE                                           144941
     C                     Z-ADDSETD      ZDAYNO                          144941
     C                     ENDIF                                          144941
     C                     EXSR ZDATE2                                    073714
     C                     MOVE ZADATE    RVALD                           073714
      *                                                                   086389
      ** Format Receivers settlement details ('At' fields if              086389
      ** applicable)                                                      086389
      *                                                                   086389
     C                     EXSR ATFLDS                                    086389
      ***********                                                         073714
      ***Format*commission                                                073714
      ***********                                                         073714
     C***********          Z-ADDTOCM      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCM                           073714
      ***********                                                         073714
      ***Format*charges                                                   073714
      ***********                                                         073714
     C***********          Z-ADDTOCG      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOCG                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RCCY                            073714
      ***********                                                         073714
      ***Format*total                                                     073714
      ***********                                                         073714
     C***********TOCM      ADD  TOCG      TOTL                            073714
     C***********          ADD  TOPR      TOTL                            073714
     C***********          Z-ADDTOTL      ZFLD15                          073714
     C***********          Z-ADDICDP      ZDECS                           073714
     C***********          EXSR ZFRPED                                    073714
     C***********          MOVE ZOUT22    RTOTL                           073714
     C***********                                                         073714
     C***********          MOVE ISCY      RCCY1                           073714
     C*
     C                     WRITEFMTP104
     C                     WRITEFMTAT                                     086389
     C*
     C                     ENDSR
      /EJECT
      /COPY ZSRSRC,FFSETLZ4
      /EJECT
      /COPY ZSRSRC,ZFRPEDZ3
      /EJECT
      /COPY ZSRSRC,ZDATE2Z2
      /EJECT
      /COPY ZSRSRC,FFPRCSZ4
      *                                                                   086389
      /EJECT                                                              086389
      ********************************************************************086389
      *                                                                   086389
      *  S/R ATFLDS - OBTAIN RECEIVERS SETTLEMENT DETAILS.                086389
      *                                                                   086389
      ********************************************************************086389
      *                                                                   086389
     C           ATFLDS    BEGSR                                          086389
      *                                                                   086389
     C           *LIKE     DEFN BBCUST    ATCNUM                          086389
     C                     MOVE *BLANK    ATCNUM                          086389
     C                     MOVE *BLANK    ATNM                            086389
     C                     MOVE *BLANK    ATTN                            086389
      *                                                                   086389
     C                     SELEC                                          086389
     C           TRTY      WHEQ 'S'                        SALE           086389
      * For a sale , If it is a Nostro settlement then obtain receivers   086389
      * setllement details from the Nostro Customer number.               086389
     C           SETP      IFEQ 01                                        086389
     C           SETP      OREQ 02                                        086389
     C           SETP      OREQ 07                                        086389
     C           SETP      OREQ 08                                        086389
     C           SETP      OREQ 12                                        086389
     C                     MOVE ISCY      FFNCCY                          086389
     C                     MOVELSETA      FFNOSN                          086389
     C           FFNKY     CHAINTABLETLF             99                   086389
     C           *IN99     IFEQ '0'                                       086389
     C                     MOVELCNUM      ATCNUM                          086389
     C                     END                                            086389
     C                     END                                            086389
      *                                                                   086389
     C           TRTY      WHEQ 'P'                        PURCHASE       086389
      * For a purchase use the Counterparty Nostro field to get           086389
      * receivers settlement details. This field may contain a            086389
      * customer number or a Counterparty Nostro code.                    086389              CSD027
      **customer*number*or*a*Counterparty*Nostro*code.*If*it*is****       086389              CSD027
      **numeric*then*this*means*it*is*a*customer*number.***********       086389              CSD027
     C           CNOS      IFNE *BLANK                                    086389
     C                     MOVELCNOS      CNOS6   6                       086389
     C***********          TESTN          CNOS6      75                   086389              CSD027
     C************IN75     IFEQ '1'                                       086389              CSD027
     C***********          MOVELCNOS6     ATCNUM                          086389              CSD027
     C***********          ELSE                                           086389              CSD027
     C                     MOVELCNOS      KCPSH2                          086389
     C           KCPSH     CHAINTABLET2F             99                   086389
     C           *IN99     IFEQ '0'                                       086389
     C                     MOVELCPNM      ATNM                            086389
     C                     END                                            086389
     C                     ELSE                                           086389              CSD027
     C                     MOVELCNOS6     ATCNUM                          086389              CSD027
     C**********           END                                            086389              CSD027
     C                     END                                            086389
     C                     ENDSL                                          086389
      *                                                                   086389
      * If a customer number was loaded above then access the customer    086389
      * for the receivers settlement details.                             086389
      *                                                                   086389
     C           ATNM      IFEQ *BLANK                                    086389
     C           ATCNUM    ANDNE*BLANK                                    086389
     C           ATCNUM    CHAINSDCUSTL0             99                   086389
     C           *IN99     IFEQ '0'                                       086389
     C                     MOVELBBCNA1    ATNM                            086389
     C                     MOVELBBCRTN    ATTN                            086389
     C                     END                                            086389
     C                     END                                            086389
      *                                                                   086389
      * IN26 on means that receivers settlement deatils are to be         086389
      * printed                                                           086389
      * IN27 on means that receivers settlement deatils include the       086389
      * town field.                                                       086389
      *                                                                   086389
     C           ATNM      COMP *BLANKS              2626                 086389
     C   26      ATTN      COMP *BLANKS              2727                 086389
      *                                                                   086389
     C                     ENDSR                                          086389
      *                                                                   086389
     C/EJECT                                                              086389
      *                                                                   086389
     C********************************************************************
     C*
      ** S/R OBTCR TO OBTAIN CURRENCY DECIMAL PLACES
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS DBERR
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           OBTCR     BEGSR
     C*
     C           C2        IFLT 1
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELCURRY     DBKEY            ***************
     C                     Z-ADD6         DBASE            * DB ERROR 06 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C           CURRY     LOKUPCY,C2                    21
     C*
     C           *IN21     IFEQ '1'
     C                     Z-ADDDP,C2     CDP
     C                     END
     C*
     C           *IN21     IFEQ '0'
     C                     MOVE *BLANKS   TBKEY
     C                     MOVE '20'      TBK1
     C                     MOVE '1'       TBK2
     C                     MOVELCURRY     TBK2
     C           TBKEY     CHAINTABTG10F             99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVELTBKEY     DBKEY            ***************
     C                     Z-ADD7         DBASE            * DB ERROR 07 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
     C           C1        SUB  1         C1
     C*
      **   MOVE CURRENCY AND NO. OF DECIMAL PLACES INTO ARRAYS
     C*
     C                     MOVE CURRY     CY,C1
     C                     Z-ADDCDP       DP,C1
     C*
     C                     END
     C*
     C                     Z-ADDC1        C2
      *
     C                     ENDSR
      /EJECT
     C********************************************************************
     C*
      ** S/R INIT TO PERFORM FIRST CYCLE ONLY CALCULATIONS
     C*
      ** CALLED FROM MAIN PROCESSING
     C*
      ** CALLS DBERR
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           INIT      BEGSR
     C*
     C***********          OPEN FF0582P1                                  S01117
     C                     SETON                     20
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *ZEROS    DBASE
     C                     MOVE *BLANKS   DBPGM                           S01117
     C                     MOVE 'FF0582  'DBPGM
     C                     OUT  LDA                                       S01117
     C           *LIKE     DEFN CDP       ICDP
     C************LIKE     DEFN CDP       OCDP                            073714
     C           *LIKE     DEFN CDP       DCDP                            073714
     C           *LIKE     DEFN CDP       CCDP                            073714
     C           *LIKE     DEFN ISCY      CURRY
     C*
      ***Access*TABTB10***************************************************S01117
      ** Access SDBANKPD                                                  S01117
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C*
     C***********          READ TABTB10F                 99               S01117
      *                                                                   S01117
      **   ACCESS BANK DETAILS                                            S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    @DSFDY                          S01117
     C*
     C************IN99     IFEQ '1'                                       S01117
     C***********RECI      ORNE 'D'                                       S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C***********          MOVE 'TABLE'   DBFILE                          S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C***********          MOVEL'TABTB10' DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     Z-ADD8         DBASE            * DB ERROR 08 *
     C                     MOVEL@OPTN     DBOPTN  7        *             *S01117
     C                     EXSR DBERR                      ***************
     C                     END
     C*                                                                   S01117
     C**   IN THE DATAAREA RUNDAT                                         S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**   SET MULTIBRANCHING INDICATOR                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     30                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**   INITIALIZE COUNTER FOR NO. OF CONFIRMATIONS PRINTED            S01117
     C*                                                                   S01117
     C                     Z-ADD0         COUNT   50                      S01117
     C*
      ** Set indicator for date format, from DATF field.
     C*
     C           DATF      COMP 'M'                      98
     C*
      ** Access TABTB11
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C*
     C           *LOVAL    SETLLTABTB11F                                  109967
     C                     READ TABTB11F                 99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVEL'TABTB11' DBKEY            ***************
     C                     Z-ADD9         DBASE            * DB ERROR 09 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
      ** Access TABTB20
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C*
     C                     READ TABTB20F                 99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVEL'TABTB20' DBKEY            ***************
     C                     Z-ADD10        DBASE            * DB ERROR 10 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
      ** Access TABTB40
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C*
     C                     READ TABTB40F                 99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVEL'TABTB40' DBKEY            ***************
     C                     Z-ADD11        DBASE            * DB ERROR 11 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
      ** Access TABTB80
      ** IF no record found,
      ** OR record not live
      **     Perform Database-error
     C*
     C                     READ TABTB80F                 99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABLE'   DBFILE
     C                     MOVEL'TABTB80' DBKEY            ***************
     C                     Z-ADD12        DBASE            * DB ERROR 12 *
     C                     EXSR DBERR                      ***************
     C                     END
     C*
      **  Set up array indices for currency
     C*
     C                     Z-ADD151       C1      30
     C                     Z-ADD150       C2      30
      /COPY ZSRSRC,FFSETLZ3
     C                     MOVE '71'      KCPSH1                          086389
     C                     ENDSR
      /EJECT
     C********************************************************************
     C*
      ** S/R DBERR TO PERFORM DATABASE ERROR EXIT FROM PROGRAM
     C*
      ** CALLED FROM
     C*
      ** CALLS NO OTHER SUBROUTINES
     C*
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
     C*
     C           DBERR     BEGSR
     C*                                                                   S01117
     C                     OUT  LDA                                       S01117
     C*
      ** Seton U7 U8 LR
      ** Return
     C*
     C           *IN15     IFEQ '1'                                       S01117
     C                     WRITEFMTP105
     C                     END                                            S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR
     C*                                                                   S01117
     C                     EXSR WRITAU                                    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C********************************************************************
      /EJECT                                                              S01117
     C********************************************************************S01117
      **                                                                  S01117
      ** WRITAU - SUBROUTINE TO OUTPUT AU REPORT                          S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           WRITAU    BEGSR                           ** WRITAU **   S01117
     C*                                                                   S01117
      ** IF first cycle indicator is off                                  S01117
      **     Perform Initial processing                                   S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     EXSR INIT                                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
      ** ENSURE TOTAL SPOOL FILE RECORDED BY RCF                          S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANKS   SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** OUTPUT AUDIT REPORT HEADING                                      S01117
     C*                                                                   S01117
     C                     WRITEFMTAU01                                   S01117
     C*                                                                   S01117
      ** OUTPUT RUN CONTROLS TOTAL TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C                     WRITEFMTAU02                                   S01117
     C*                                                                   S01117
      ** IF NO DETAIL TO REPORT, OUTPUT TO AUDIT REPORT                   S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '0'                                       S01117
     C           *INU7     ANDEQ'0'                                       S01117
     C                     WRITEFMTAU03                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** IF DATABASE ERROR, OUTPUT TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     WRITEFMTAU04                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
** NAR
BOUGHT FROM
  SOLD TO
EUROPEAN
AMERICAN
WE
YOU
YOU
US
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                       073714
0000001                                                                   073714
0000010                                                                   073714
0000100                                                                   073714
0001000                                                                   073714
0010000                                                                   073714
0100000                                                                   073714
1000000                                                                   073714
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
