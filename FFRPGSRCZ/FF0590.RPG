     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FF Telex Report')
     F********************************************************************
     F*                                                                  *
     F*  Midas - Futures and Options Module
     F*                                                                  *
     F*   FF0590  -  TELEX REPORT                                        *
     F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *  Last Amend No. 243826A            Date 25Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFF006             Date 28Nov00               *
      * Midas DBA 3.00 Patch D ---------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 163444             Date 03Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CFF004             Date 18Sep96               *
     F*                  S71062             DATE 19DEC95                 *
     F*                  S01455             DATE 05NOV93                 *
     F*                  S01411             DATE 05MAY93                 *
     F*                  S01393             DATE 30OCT92                 *
     F*                  FUJI-FF0011        DATE 10AUG92                 *
     F*                  AUS022             DATE 07AUG92                 *
     F*                  FO0094             DATE 24APR91                 *
     F*                  FO0071             DATE 15APR91                 *
     F*                  FO0018             DATE 10JAN91                 *
     F*                  S01299             DATE 24AUG90                 *
     F*                  E20526             DATE 03MAY90                 *
     F*                  S01117             DATE 27APR90                 *
     F*                  E18343             DATE 11NOV89                 *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  243826A- Recompiled due to changes in FFPRCSZ2, FFPRCSZ3,    *
      *           FFPRVLZ2 and FFPRVLZ3.                              *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CFF006 - Fractional Ticks Enhancement.  (Recompiled)         *
     F*   163444 - Y2K Sort Order.                                       *
     F*   CFF004 - Increase in size of Price Fields,(Recompiled Only)    *
     F*   S71062 - FF/PM Interface (Just recompiled)                     *
     F*   S01455 - 'FF' ACCOUNT KEY ENHANCEMENTS.                        *
     F*            Recompiled due to changes in file TABFF.              *
     A*   S01411 - RECOMPILED BECAUSE 'ORIGINAL ENTRY DATE' HAS BEEN     *
     A*            ADDED TO TRANSD.                                      *
     F*   S01393  -  RECOMPILED FOR STRATEGIC RISK MANAGEMENT            *
     F* FUJI-FF0011 - The system does not differentiate between          *
     F*               american and european option on exercise           *
     F*               validation and OTC confirmation wording.           *
     F*               *** RECOMPILE ONLY ***                             *
     F*   AUS022  -  AUSTRALIAN CHANGE : Introduction of Processing      *
     F*              Types 7 and 8.                                      *
     F*   FO0094  -  PTF L170382 INSTALLED TO FIX READE ERROR, AND       *
     F*              PROGRAM RECOMPILED WITH IGNDECERR *NO               *
     F*   FO0071  -  PGM RECOMPILED WITH IGNDECERR *YES DUE TO PROBLEMS  *
     F*              WITH READE OP CODE IN OS/400 REL3                   *
     F*   FO0018  -  APPLY MULTIBRANCHING CHANGES (S01117) FULLY.        *
     F*   S01299  -  ALLOW UP TO 32 MARKET CENTRES                       *
     F*   E20526  -  RECOMPILED OVER CHANGED FILE PRICS1                 *
     F*   S01117  -  MULTIBRANCHING                                      *
     F*   E18343  -  PROGRAM RE-COMPILED DUE TO CHANGE IN ZSRSRC MEMBER  *
     F*              ZFRPEDZ3                                            *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*     CREATION REQUIREMENTS                                        *
     F*                                                                  *
     F******IGNDECERR(*NO)************************************************FO0071
     F******IGNDECERR(*YES)*****************************************FO0071FO0094
     F*     IGNDECERR(*NO)                                               *FO0094
     F******OVRDBF*****FILE(POCHG5X)*TOFILE(POCHG5)                      *S01299
     F*                                                                  *
     F********************************************************************
     F*
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
**OVRF***OVRDBF*POCHG5X*POCHG5****                                  : *   S01299
/****F*:*USRPRF(*USER)*CODELIST(*NONE)*IGNDECERR(*NO)***************: *   FO0071
/****F*:*USRPRF(*USER)*CODELIST(*NONE)*IGNDECERR(*YES)**************FO0071FO0094
     F*                                                               *
     F*****************************************************************
     FTSCCY3  UP  E           K        DISK
     F*
     FTABFF   IF  E           K        DISK
     F* ICD 1     TABTB10F                          KIGNORE
     F            TABTB10F                          KIGNORE               S01117
     F            TABTB11F                          KIGNORE
     F            TABTB20F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTB80F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F* CCY 1     TABTG10F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F* BRANCH    TABLETRF                          KIGNORE
     F            TABLETRF                          KIGNORE               S01117
     F            TABLET2F                          KIGNORE
     F*
     F*CCNT***IF* E           K        DISK                               S01117
     F*********** ACCNTAAF                          KIGNORE               S01117
     F*********** ACCNTACF                          KIGNORE               S01117
     FPOSTNC1 UF  E           K        DISK
     FFFPSNCPDIF  E           K        DISK                               163444
     F*POCHG5**UF* E           K        DISK                              S01299
     F**********  POCHGRCF                          KIGNORE               S01299
     F*POCHG5X*UF* E           K        DISK                              S01299
     F**********  POCHGCCF                          KIGNORE               S01299
     F**********  POCHGTCF                          KIGNORE               S01299
     FPOCHG5C UF  E           K        DISK                               S01299
     FPOCHG5T UF  E           K        DISK                               S01299
     FPOCHG5R UF  E           K        DISK                               S01299
     F*                                                                   S01299
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
     FMARKT   IF  E           K        DISK
     FINTYP   IF  E           K        DISK
     FINTYP2  IF  E           K        DISK
     F            INTYPDF                           KRENAMEINTYPDF2
     FPRICS1  IF  E           K        DISK
     FTRANS2  IF  E           K        DISK
     FTRSET1  IF  E           K        DISK
     FCNFRPD  O   E                    DISK
     FFF0590P1O   E                    PRINTER                        UC
     F***********                                   KINFDS PRINT          S01117
     F                                              KINFDS SPOOL          S01117
     FFF0590AUO   E                    PRINTER                            S01117
     F                                              KINFDS SPOOLU         S01117
     F/COPY WNCPYSRC,FF0590F001
     F********************************************************************
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F*             L3   Change of  Branch  on file TSCCY3
     F*             L2   Change of  Customer/broker Code  on TSCCY3
     F*             L1   Change of  Currency  on file TSCCY3
     F*
     F*    01            POCHGRC  record
     F*    02            POCHGCC  record
     F*    03            POCHGTC  record
     F*
     F*        15        OPEN OF P1 INDICATOR                             S01117
     F*                                                                   S01117
     F*        20        First Cycle of program
     F*                                                                   S01117
     F*        30        MULTIBRANCHING INDICATOR                         S01117
     F*
     F*        50        End of file  POSTNC1
     F*********51        End of file  POCHG5                              S01299
     F*********52        End of file  POCHG5X                             S01299
     F*        51        POCHG5C OR POCHG5T END OF FILE                   S01299
     F*        52        POCHG5R END OF FILE                              S01299
     F*        53        POCHG5C END OF FILE                              S01299
     F*        54        POCHG5T END OF FILE                              S01299
     F*
     F*********60********Settlement*account*missing***********************S01117
     F*
     F*     80-89        Reserved for Standard FF Subroutines
     F*
     F*     90-99        Reserved for Standard MIDAS Subroutines
     F*
     F*        98        Numeric Date Format is MMDDYY
     F*        99        Failure of CHAIN or READ operation :  DB-ERROR
     F*
     F*     U7,U8        Database Error
     F********************************************************************
      /EJECT
     E********************************************************************
      /COPY ZSRSRC,FFPRCSZ2
     E* Used in SR FFPRCS
      /COPY ZSRSRC,ZDATE2Z1
     E* Used in SR ZDATE2
      /COPY ZSRSRC,ZFRPEDZ1
     E* Used in SR ZFRPED
     E                    MTH    12  12  3
     E* Month Names
     E                    CPY@    1   1 80
     E********************************************************************
      /EJECT
     I********************************************************************
     ITSCCYDF
     I*
      ** Level break definitions :  Branch, Customer/broker, Currency.
     I*
     I***********                                   BRCD  L3              S01117
     I                                              BRCA  L3              S01117
     I                                              CBCD  L2
     I                                              CCY   L1
     I*
      ** Rename the fields that may be changed to write to file CNFRPD.
     I*
     I              SETP                            TSSETP
     I              SETA                            TSSETA
     I              SEBR                            TSSEBR                S01117
     I              SBID                            TSSBID                S01117
     I              FACO                            TSFACO
     I              CNOS                            TSCNOS
     IPOSTNCDF
     I*
      ** Rename the fields also occurring in file TSCCY3,
      ** excepting Record-identifier.
     I*
     I***********   BRCD                            BRCDPC                S01117
     I              BRCA                            BRCAPC                S01117
     I              CBCD                            CBCDPC
     I              LSDA                            LSDAPC
     I              LTDA                            LTDAPC
     IFFPSNCD0                                                            163444
     I*                                                                   163444
      ** Rename the fields also occurring in file TSCCY3,                 163444
      ** excepting Record-identifier.                                     163444
      *                                                                   163444
     I              BRCA                            BRCAPC                163444
     I              CBCD                            CBCDPC                163444
     I              LSDA                            LSDAPC                163444
     I              LTDA                            LTDAPC                163444
     IPOCHGRCF    01
     I*
      ** Rename the fields also occurring in file TSCCY3 or POSTNC1,
      ** excepting Record-identifier.
     I*
     I***********   BRCD                            BRCDPG                S01117
     I              BRCA                            BRCAPG                S01117
     I              CBCD                            CBCDPG
     I              ISTT                            ISTTPG
     I              YRNO                            YRNOPG
     I              MTHN                            MTHNPG
     I              PCAL                            PCALPG
     I              STRP                            STRPPG
     I              ISCY                            ISCYPG
     I*
      ** Rename fields that might be changed to write to file CNFRPD.
     I*
     I              POCD                            POCDPG
     IPOCHGCCF    02
     I**********                                                          S01299
      ***Rename*the*fields*also*occurring in file TSCCY3 or POSTNC1,      S01299
      ***excepting*Record-identifier.                                     S01299
     I*
     I***********   BRCD                            BRCDPG                S01117
     I***********   BRCA                            BRCAPG          S01117S01299
     I**********    CBCD                            CBCDPG                S01299
     I**********    ISTT                            ISTTPG                S01299
     I**********    YRNO                            YRNOPG                S01299
     I**********    MTHN                            MTHNPG                S01299
     I**********    PCAL                            PCALPG                S01299
     I**********    STRP                            STRPPG                S01299
     I**********    ISCY                            ISCYPG                S01299
     I**********                                                          S01299
      ***Rename*Close-out*number*to Transaction-number because it         S01299
      ***refers*to*a*transaction*number.                                  S01299
      ***Rename*fields*that*might*be*changed to write to file CNFRPD.     S01299
     I**********                                                          S01299
     I**********    CLON                            TNBRPG                S01299
     I**********    POCD                            POCDPG                S01299
     I**********    REVI                            REVIPG                S01299
     I*                                                                   S01299
     I              RECI                            RECIC                 S01299
     I              BRCA                            BRCAC                 S01299
     I              CBCD                            CBCDC                 S01299
     I              ISTT                            ISTTC                 S01299
     I              YRNO                            YRNOC                 S01299
     I              MTHN                            MTHNC                 S01299
     I              PCAL                            PCALC                 S01299
     I              STRP                            STRPC                 S01299
     I              POCD                            POCDC                 S01299
     I*                                                                   S01299
      ** Rename Close out number to transaction number as it refers to oneS01299
     I*                                                                   S01299
     I              CLON                            TNBRC                 S01299
     I*                                                                   S01299
     I              RLPL                            RLPLC                 S01299
     I              ISCY                            ISCYC                 S01299
     I              AOSI                            AOSIC                 S01299
     I              ATCI                            ATCIC                 S01299
     I              PUPI                            PUPIC                 S01299
     I              REVI                            REVIC                 S01299
     IPOCHGTCF    03
     I**********                                                          S01299
      ***Rename*the*fields*also*occurring in file TSCCY3 or POSTNC1,      S01299
      ***excepting*Record-identifier.                                     S01299
     I**********                                                          S01299
     I***********   BRCD                            BRCDPG                S01117
     I***********   BRCA                            BRCAPG          S01117S01299
     I**********    CBCD                            CBCDPG                S01299
     I**********    ISTT                            ISTTPG                S01299
     I**********    YRNO                            YRNOPG                S01299
     I**********    MTHN                            MTHNPG                S01299
     I**********    PCAL                            PCALPG                S01299
     I**********    STRP                            STRPPG                S01299
     I**********    ISCY                            ISCYPG                S01299
     I**********                                                          S01299
      ***Rename*fields that might be changed to write to file CNFRPD.     S01299
     I**********                                                          S01299
     I**********    TNBR                            TNBRPG                S01299
     I**********    POCD                            POCDPG                S01299
     I**********    PAYI                            PAYIPG                S01299
     I**********    REVI                            REVIPG                S01299
     I*                                                                   S01299
     I              RECI                            RECID                 S01299
     I              BRCA                            BRCAD                 S01299
     I              CBCD                            CBCDD                 S01299
     I              ISTT                            ISTTD                 S01299
     I              YRNO                            YRNOD                 S01299
     I              MTHN                            MTHND                 S01299
     I              PCAL                            PCALD                 S01299
     I              STRP                            STRPD                 S01299
     I              POCD                            POCDD                 S01299
     I              TNBR                            TNBRD                 S01299
     I              PCGT                            PCGTD                 S01299
     I              POCQ                            POCQD                 S01299
     I              PCGA                            PCGAD                 S01299
     I              ISCY                            ISCYD                 S01299
     I              AOSI                            AOSID                 S01299
     I              ATCI                            ATCID                 S01299
     I              PUPI                            PUPID                 S01299
     I              PAYI                            PAYID                 S01299
     I              REVI                            REVID                 S01299
     IINTYPDF2
     I*
      ** Rename the fields also occurring in file INTYP,
      ** excepting Record-identifier.
     I*
     I              ISTT                            ISTT2
     I              ISTI                            ISTI2
     I              ISPT                            ISPT2
     I              ISCY                            ISCY2
     I              QOTC                            QOTC2
     I              TKDM                            TKDM2
     I              MNPF                            MNPF2
     I              TKVL                            TKVL2
     I              OTHC                            OTHC2
     I*CCNTABF***                                                         S01117
     I***********                                                         S01117
     I***Rename*the*fields*also*occurring*in*file*TSCCY3,*****************S01117
     I***excepting*Record-identifier.*************************************S01117
     I***********                                                         S01117
     I***********   CCY                             ACCCY                 S01117
     I***********   BRCD                            ACBRCD                S01117
     I***********   NSTD                            ACNSTD                S01117
     ICLINTCBF
     I*
      ** Rename the fields also occurring in file TSCCY3,
      ** excepting Record-identifier.
     I*
     I***********   BRCD                            CLBRCD                S01117
     I              BRCB                            CLBRCB                S01117
     ITRANSDF
     I*
      ** Rename the fields also occurring in file TSCCY3 or POSTNC1,
      ** excepting Record-identifier.
     I*
     I***********   BRCD                            BRCDT                 S01117
     I              BRCA                            BRCAT                 S01117
     I              ISTT                            ISTTT
     I              YRNO                            YRNOT
     I              MTHN                            MTHNT
     I              PCAL                            PCALT
     I              STRP                            STRPT
     I              ISCY                            ISCYT
     IISTTX       DS
     I*  Datastructure  to split Instrument-type into Market and Code
     I                                        1   2 XMRKT
     I                                        3   5 XINST
     ICLINTX      DS
     I*  Datastructure  to put key-fields into database-error message
     I**********                              1   60KCNUM                                     CSD027
     I                                        1   6 KCNUM                                     CSD027
     I                                        7   7 KRCDT
     I*
     I*TIDX****** DS                             18                       S01117
     I***Datastructure**for*Account*Code*in*edited*form*******************S01117
     I***********                             1   6 CUSTRX                S01117
     I***********                             7   7 DSH1                  S01117
     I***********                             8  10 CURRX                 S01117
     I***********                            11  11 DSH2                  S01117
     I***********                            12  15 ACDEX                 S01117
     I***********                            16  16 DSH3                  S01117
     I***********                            17  18 ASEQX                 S01117
     I***********                                                         S01117
     I*TIDX****** DS                                                      S01117
     I***Datastructure**to*split*up*Account*Code**************************S01117
     I***********                             1   60CUSTRA                S01117
     I***********                             7   9 CURRA                 S01117
     I***********                            10  130ACDEA                 S01117
     I***********                            14  150ASEQA                 S01117
     I*
     I** FILE INFORMATION DATA STRUCTURE                                  S01117
     I*RINT*****  DS                                                      S01117
     I*                                                                   S01117
     ISPOOL       DS                                                      S01117
     I                                       83  92 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I*  Datastructure  for line-number on report-page
     I                                    B 367 3680LINE
     ISPOOLU      DS                                                      S01117
     I                                       83  92 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     I*
     I*DA********UDS                            256                       S01117
     ILDA         DS                            256                       S01117
     I*  Local Data Area  for Database Error details
     I** *LOCK IN LDA immediately before and OUT LDA immediately          S01117
     I** after each database error handling.                              S01117
     I***********                           134 138 DBFILE                S01117
     I***********                           139 167 DBKEY                 S01117
     I***********                           168 175 DBPGM                 S01117
     I***********                           176 1770DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     I*                                                                   S01299
     IPCHG4C      DS                                                      S01299
     I*  Data structure to compare position change date,trans. no.        S01299
     I*  and reversal ind on lf-pochg5c                                   S01299
     I                                    P   1   30POCDC                 S01299
     I                                        4   90TNBRC                 S01299
     I                                       10  100REVIC                 S01299
     I*                                                                   S01299
     IPCHG4T      DS                                                      S01299
     I*  Data structure to compare position change date,trans. no.        S01299
     I*  and reversal on ind lf-pochg5t                                   S01299
     I                                    P   1   30POCDD                 S01299
     I                                        4   90TNBRD                 S01299
     I                                       10  100REVID                 S01299
     I*                                                                   S01299
     I*                                                                   S01117
     I** DATA AREA RUNDAT                                                 S01117
     I*                                                                   S01117
     IRUNDT       DS                                                      S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
      *                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
      **  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
      *                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      ** EXTERNAL DS FOR BRANCHES DETAILS                                 S01117
     I              A8BRNM                          BRNM                  S01117
      *                                                                   S01117
     I@DSFDY    E DSDSFDY                                                 S01117
      **  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE              S01117
     I/COPY WNCPYSRC,FF0590I001
     I**                                                                  S01117
      /COPY ZSRSRC,FFSRDSZ1
     I* Used in SR FFPRCS
      /COPY ZSRSRC,FFPRCSZ3
     I* Used in SR FFPRCS
      /COPY ZSRSRC,ZFRPEDZ2
     I* Used in SR ZFRPED
     I********************************************************************
      /EJECT
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL029
     IDSSDY     E DSDSSDY                                                                     CGL029
      *                                                                                       CGL029
     C********************************************************************
     C*
      ** POSTNC1  KEY LIST  (PARTIAL)
     C*
     C           POSTNK    KLIST
     C***********          KFLD           KBRCD                           S01117
     C                     KFLD           KBRCA                           S01117
     C                     KFLD           KCBCD
     C                     KFLD           KISCY
      *                                                                   163444
      ** POSTNC1  KEY LIST  (FULL)                                        163444
      *                                                                   163444
     C           POSTFK    KLIST                                          163444
     C                     KFLD           BRCAPC                          163444
     C                     KFLD           CBCDPC                          163444
     C                     KFLD           ISCY                            163444
     C                     KFLD           ISTT                            163444
     C                     KFLD           YRNO                            163444
     C                     KFLD           MTHN                            163444
     C                     KFLD           PCAL                            163444
     C                     KFLD           STRP                            163444
     C*
      ** POCHG5   KEY LIST  (PARTIAL)
     C*
     C           POCHGK    KLIST
     C***********          KFLD           KBRCD                           S01117
     C                     KFLD           KBRCA                           S01117
     C                     KFLD           KCBCD
     C                     KFLD           KISTT
     C                     KFLD           KYRNO
     C                     KFLD           KMTHN
     C                     KFLD           KPCAL
     C                     KFLD           KSTRP
     C*
      ** PRICS1   KEY LIST
     C*
     C           PRICSK    KLIST
     C                     KFLD           KISTT
     C                     KFLD           KYRNO
     C                     KFLD           KMTHN
     C                     KFLD           KPCAL
     C                     KFLD           KSTRP
     C*
      ** CLINT    KEY LIST
     C*
     C           CLINTK    KLIST
     C                     KFLD           KCNUM
     C                     KFLD           KRCDT
     C***********                                                         S01117
      ***ACCNT****KEY*LIST************************************************S01117
     C***********                                                         S01117
     C***********ATIDK     KLIST                                          S01117
     C***********          KFLD           CUSTRA                          S01117
     C***********          KFLD           CURRA                           S01117
     C***********          KFLD           ACDEA                           S01117
     C***********          KFLD           ASEQA                           S01117
     C*
     C** DEFINE KEY-FIELDS AND OTHER WORK-FIELDS
     C*
     C************LIKE     DEFN BRCD      KBRCD                           S01117
     C           *LIKE     DEFN BRCA      KBRCA                           S01117
     C           *LIKE     DEFN CBCD      KCBCD
     C           *LIKE     DEFN ISCY      KISCY
     C           *LIKE     DEFN ISTT      KISTT
     C           *LIKE     DEFN YRNO      KYRNO
     C           *LIKE     DEFN MTHN      KMTHN
     C           *LIKE     DEFN PCAL      KPCAL
     C           *LIKE     DEFN STRP      KSTRP
     C*
     C           *LIKE     DEFN POCD      WPOCD
     C           *LIKE     DEFN REVI      WREVI
     C           *LIKE     DEFN CDP       WCDPL
     C           *LIKE     DEFN ISTI      WISTI
     C           *LIKE     DEFN ISPT      WISPT
     C           *LIKE     DEFN TKDM      WTKDM
     C           *LIKE     DEFN TKDM      WTKDM2
     C           *LIKE     DEFN MNPF      WMNPF
     C           *LIKE     DEFN MNPF      WMNPF2
     C           *LIKE     DEFN FTRF      WFTRF
     C           *LIKE     DEFN MRKT      WMRKT
     C           *LIKE     DEFN MKTN      WMKTN
     C           *LIKE     DEFN LTPO      WLTPO
     C           *LIKE     DEFN LTCP      WLTCP
     C           *LIKE     DEFN LTDA      WLTDA
     C           *LIKE     DEFN LOPE      WLOPE
     C           *LIKE     DEFN SOPE      WSOPE
     C           *LIKE     DEFN PLEC      WPLEC
     C           *LIKE     DEFN BOCO      WBOCO
     C           *LIKE     DEFN TRTY      WTRTY
     C           *LIKE     DEFN ULTT      WULTT
     C           *LIKE     DEFN COPR      WCOPR
     C           *LIKE     DEFN FCIN      WFCIN
     C           *LIKE     DEFN CSLT      WCSLT
     C           *LIKE     DEFN CSLA      WCSLA
     C           *LIKE     DEFN CFAO      WCFAO
     C           *LIKE     DEFN CCPN      WCCPN
     C           *LIKE     DEFN POCQ      WPOCQ
     C           *LIKE     DEFN PCGA      WPCGA
     C************LIKE     DEFN CLBL      WCLBL                           S01117
     C************LIKE     DEFN BFTB      WBFTB                           S01117
     C************LIKE     DEFN BFTB      WCASHA                          S01117
     C           *LIKE     DEFN RUND      WRUND
     C           *LIKE     DEFN RBFTXT    WBFTXT
     C           *LIKE     DEFN RBFTXT    WCDTXT
     C*
      **   Define fields for totals
     C*
     C           *LIKE     DEFN RLPL      WRLPL
     C           *LIKE     DEFN RLPL      WTRPLS
     C           *LIKE     DEFN RLPL      WTRPLE
     C           *LIKE     DEFN RLPL      WDRPL0
     C           *LIKE     DEFN RLPL      WDRPL1
     C           *LIKE     DEFN RLPL      WSRLPL
     C           *LIKE     DEFN ULPL      WIULPL
     C           *LIKE     DEFN ULPL      WSULPL
     C           *LIKE     DEFN POCQ      WTCONS
     C           *LIKE     DEFN POCQ      WTCONE
     C           *LIKE     DEFN PCGA      WTCOMS
     C           *LIKE     DEFN PCGA      WTCOME
     C           *LIKE     DEFN PCGA      WSCOMM
     C           *LIKE     DEFN PCGA      WTCHAS
     C           *LIKE     DEFN PCGA      WTCHAE
     C           *LIKE     DEFN PCGA      WSCHAR
     C           *LIKE     DEFN PCGA      WSPREM
     C********************************************************************
      /EJECT
     C********************************************************************
      **             M A I N   P R O C E S S I N G
      **
      ** CALLS  S/R  INIT   IPOSNS TRADSY   TFILE  DBERR
     C********************************************************************
     C*                                                                   S01117
     C**   INITIALIZE COUNTER FOR TSCCY3                                  S01117
     C*                                                                   S01117
     C           INZCTR    IFNE 'Y'                                       S01117
     C                     Z-ADD0         COUNT   50                      S01117
     C                     MOVE 'Y'       INZCTR  1                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  COUNT NO. OF RECORDS READ FROM TSCCY3                           S01117
     C*                                                                   S01117
     C                     ADD  1         COUNT                           S01117
     C*
      ** Process only live records on  Settlement Account primary file.
     C*
     C           RECI      CABNE'D'       ENDCYC
     C*
      ** Do  Initial processing on first program-cycle only.
     C*
     C           *IN20     IFEQ '0'
     C                     EXSR INIT
     C                     END
     C*
      ** Set  For-Attention-of  field for report-heading.
     C*
     C                     MOVE *BLANK    RATNTX
     C           FTAO      IFNE *BLANK
     C                     MOVEL'ATTN:'   RATNTX
     C                     MOVE FTAO      RATNTX
     C                     END
     C*
      ** IF indicator L3 is on,
      ** OR BRCA IS NOT EQUAL TO PREVIOUS BRCA,                           S01117
      **   OPEN NEW SPOOL FILE                                            S01117
      *****get*Branch-name*from*Table-file*TABLETR.***********************S01117
      **   get Branch-name from SDBRCHPD.                                 S01117
     C*
     C           *INL3     IFEQ '1'
     C           BRCA      ORNE BRCAO                                     S01117
     C*                                                                   S01117
     C**  WRITE END OF REPORT MESSAGE ON CHANGE OF BRANCH                 S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '1'                                       S01117
     C           LINE      IFGE 58                                        S01117
     C                     WRITEFMTP101                                   S01117
     C                     END                                            S01117
     C                     WRITEFMTP108                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE BRCA      BRCAO   3                       S01117
     C                     CLOSEFF0590P1                                  S01117
     C                     OPEN FF0590P1                                  S01117
     C                     SETON                     15                   S01117
     C*                                                                   S01117
     C*  GET BRANCH DETAILS IF MBIN = 'Y'                                 S01117
     C*                                                                   S01117
     C***********          MOVE BRCD      RBRCD                           S01117
     C                     MOVE BRCA      RBRCA                           S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C***********          MOVE *BLANK    KEY                             S01117
     C***********          MOVEL'10'      KEY                             S01117
     C***********          MOVE BRCD      KEY                             S01117
     C***********          EXSR TFILE                                     S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    @DSFDY                          S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVEL@DSNB     DBKEY            ***************S01117
     C                     Z-ADD8         DBASE            * DB ERROR 08 *S01117
     C                     MOVEL@OPTN     DBOPTN  7        *             *S01117
     C                     MOVEL*BLANKS   RBRNM            *             *S01117
     C                     EXSR DBERR                      ***************S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE BRNM      RBRNM
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      **   ENSURE REPORT SPOOL FILE RECORDED BY RCF                       S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM     ZSNUM   60                      S01117
     C*                                                                   S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM BRCA      SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           ZSNUM                           S01117
     C                     PARM           ZSERR   1                       S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END
     C*
      ** IF indicator L2 is on,
      **   get Customer-name from Customer-file.
      **     IF record not found,
      **     OR record not live :
      **       process Database-error.
     C*
     C           *INL2     IFEQ '1'
     C                     MOVE CBCD      KCNUM
     C                     MOVE 'A'       KRCDT
     C           CLINTK    CHAINCLINT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'CLINT'   DBFILE
     C                     MOVELCLINTX    DBKEY            *************
     C                     Z-ADD1         DBASE            * DB-ERR 01 *
     C                     EXSR DBERR                      *************
     C                     END
     C*
     C                     MOVE CRNM      RCRNM
     C                     MOVE CTWN      RCTWN
     C                     END
     C*
      ** IF indicator L1 is on,
      **   get Currency-data from Table-file TABTG10.
     C*
     C           *INL1     IFEQ '1'
     C                     MOVE *BLANK    KEY
     C                     MOVEL'20'      KEY
     C                     MOVELCCY       WORK4   4
     C                     MOVE WORK4     KEY
     C                     MOVE '1'       KEY
     C                     EXSR TFILE
     C                     MOVE CCNM      RCCNM
     C                     MOVE CDP       WCDPL
     C                     END
     C*
      ** IF indicator L3 is on,                                           S01117
      ** OR BRCA IS NOT EQUAL TO PREVIOUS BRCA,                           S01117
      ** Set  Page-count to zero.
      ** Set  Line-count to zero.                                         S01117
      ** Print  Page-headings.
     C*
     C           *INL3     IFEQ '1'                                       S01117
     C           BRCA      ORNE BRCAO                                     S01117
     C*                                                                   S01117
     C***********          MOVE *ZERO     PAGE                            S01117
     C                     Z-ADD0         PAGE                            S01117
     C                     Z-ADD0         LINE                            S01117
     C                     WRITEFMTP101
     C*                                                                   S01117
     C                     END                                            S01117
     C*
      ** Process  Instrument-positions.
      ** Process  Trading-summary.
     C*
     C                     EXSR IPOSNS
     C                     EXSR TRADSY
     C*
      ** Update  Settlement-account record fields:
      **   Brought-forward Telex/confirmation Balance,
      **   Last Telex/conf Date,
      **   Telex/conf-required indicator.
     C*
     C***********          Z-ADDWCLBL     BFTB                            S01117
     C                     Z-ADDWRUND     LTDA
     C                     MOVE *BLANK    TLCI
     C                     EXCPTTSUPD
     C***********                                                         S01117
      ***Indicate*that*first*program-cycle*is*completed.******************S01117
     C***********                                                         S01117
     C***********          SETON                     20                   S01117
     C***********                                                         S01117
     C           ENDCYC    TAG
     C*                                                                   S01117
     C**  WRITE END OF REPORT MESSAGE FOR THE LAST SPOOL                  S01117
     C*                                                                   S01117
     CLR         *IN15     IFEQ '1'                                       S01117
     CLR         LINE      IFGE 58                                        S01117
     CLR                   WRITEFMTP101                                   S01117
     CLR                   END                                            S01117
     CLR                   WRITEFMTP108                                   S01117
     CLR                   END                                            S01117
     C*                                                                   S01117
     CLR                   EXSR WRITAU                                    S01117
     C*
     C/COPY WNCPYSRC,FF0590C001
     C********************************************************************
      /EJECT
     C********************************************************************
      *                INDEX TO SUBROUTINES
      *
      *  INIT      FIRST-CYCLE-ONLY PROCESSING
      *
      *  IPOSNS    INSTRUMENT POSITIONS
      *
      *  TRADSY    TRADING SUMMARY
      *
      *  IBROFO    INSTRUMENT BROUGHT FORWARD
      *
      *  PCHANS    INSTRUMENT POSITION-CHANGES
      *
      *  ICARFO    INSTRUMENT CARRIED FORWARD
      *
      *  REALAD    ADD A CLOSE-OUT RECORD TO REALIZED PROFIT/LOSS
      *
      *  UNRLAD    ADD A REVALUATION-RECORD TO UNREALIZED PROFIT/LOSS
      *
      *  TRANAD    ADD A TRANSACTION-RECORD TO TRANSACTION-TOTALS
      *                                                                   S01299
      ** SELECT - Select the record from pochg5c and pochg5t with the     S01299
      **          lower key value for processing and move the values      S01299
      **          from the record selected into work fields.              S01299
      *                                                                   S01299
      *
      *  TRANTL    PRINT TRANSACTION-TOTALS (DETAIL-LEVEL OF REPORT)
      *
      *  DTOTAL    PRINT POSITION-CHANGE DATE-TOTALS
      *
      *  TFILE     GET A RECORD FROM TABLE-FILE
      *
      *  DBERR     END PROGRAM WITH DATABASE-ERROR
      *
      *  FFPRCS    CONVERT PRICE-DATA FROM FILE, FOR DISPLAY.
      *
      *  ZDATE2    CONVERT A DAY-NUMBER TO A DATE
      *
      *  ZFRPED    CONVERT A FILE-AMOUNT FOR DISPLAY, GIVEN DECIMALS.
      *
      *  WRITAU    WRITE AUDIT REPORT                                     S01117
      *                                                                   S01117
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R INIT   - FIRST-CYCLE-ONLY PROCESSING
      ** CALLED FROM  MAIN SECTION
      ** CALLS  S/R    TFILE
     C********************************************************************
     C*
     C           INIT      BEGSR
     C*
      ***Open**Print-file.************************************************S01117
      ** Set  Program-name for reporting Database-errors.
     C***********                                                         S01117
     C***********          OPEN FF0590P1                                  S01117
     C*                                                                   S01117
      ** Indicate that first program-cycle is completed.                  S01117
     C*                                                                   S01117
     C                     SETON                     20                   S01117
     C*                                                                   S01117
     C** INITIALISE LDA FIELDS                                            S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE *BLANKS   DBFILE                          S01117
     C                     MOVE *BLANKS   DBKEY                           S01117
     C                     Z-ADD*ZEROS    DBASE                           S01117
     C                     MOVE *BLANKS   DBPGM                           S01117
     C                     MOVE 'FF0590  'DBPGM
     C                     OUT  LDA                                       S01117
     C*
      ***Get**Table-file*TABTB10*data:************************************S01117
      ** GET SDBANKPD AND RUNDAT DATA :                                   S01117
      **   Report-title,  Date-format indicator,
      **   Run-date day-number,
      **   Run-date in alphanumeric DDMMMYY format.
     C***********                                                         S01117
     C***********          MOVE *BLANK    KEY                             S01117
     C***********          MOVEL'01'      KEY                             S01117
     C***********          MOVE '10'      KEY                             S01117
     C***********          EXSR TFILE                                     S01117
     C*                                                                   S01117
     C**   IN THE DATAAREA RUNDAT                                         S01117
     C*                                                                   S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*                                                                   S01117
     C**   SET MULTIBRANCHING INDICATOR                                   S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       S01117
     C                     SETON                     30                   S01117
     C                     END                                            S01117
      *                                                                   S01117
      **   ACCESS BANK DETAILS                                            S01117
      *                                                                   S01117
     C                     CALL 'AOBANKR0'                                S01117
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*FIRST ' @OPTN   7                       S01117
     C           SDBANK    PARM SDBANK    @DSFDY                          S01117
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANK                                    S01117
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVEL'SDBANKPD'DBFILE                          S01117
     C                     MOVEL@OPTN     DBKEY            ***************S01117
     C                     Z-ADD9         DBASE            * DB ERROR 09 *S01117
     C                     MOVEL@OPTN     DBOPTN  7        *             *S01117
     C                     EXSR DBERR                      ***************S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE TITL      RTITL
     C           DATF      COMP 'M'                      98
     C                     MOVE RUND      WRUND
     C                     MOVE RUNA      RRUNA   7
     C***********                                                         S01117
      ***Separators*for*editing*Account-code*in*data-structure.***********S01117
     C***********                                                         S01117
     C***********          MOVE '-'       DSH1                            S01117
     C***********          MOVE '-'       DSH2                            S01117
     C***********          MOVE '-'       DSH3                            S01117
     C*
      ** Texts for Instrument-brought-forward and Instrument-continued.
     C*
     C                     MOVEL'BROUGHT 'WBFTXT
     C                     MOVE 'FWD'     WBFTXT
     C*
     C                     MOVEL'CONTINUE'WCDTXT
     C                     MOVE 'D  '     WCDTXT
     C*
     C/COPY WNCPYSRC,FF0590C002
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R IPOSNS - INSTRUMENT POSITIONS
      ** CALLED FROM  MAIN SECTION
      ** CALLS  S/R  IBROFO PCHANS ICARFO   DBERR
     C********************************************************************
     C*
     C           IPOSNS    BEGSR
     C*
      ** Get first live  Instrument-position record  for key:
      **   Branch,Customer,Currency.
     C*
     C***********          MOVE BRCD      KBRCD                           S01117
     C                     MOVE BRCA      KBRCA                           S01117
     C                     MOVE CBCD      KCBCD
     C                     MOVE CCY       KISCY
     C***********POSTNK    SETLLPOSTNC1                                   163444
     C           POSTNK    SETLLFFPSNCPD                                  163444
     C*
     C           RECI      DOUEQ'D'
     C           *IN50     OREQ '1'
     C***********POSTNK    READEPOSTNC1                  50               163444
     C           POSTNK    READEFFPSNCPD                 50               163444
     C                     END
      *                                                                   163444
      * Get actual record to update                                       163444
      *                                                                   163444
     C           *IN50     IFEQ *OFF                                      163444
     C           POSTFK    CHAINPOSTNC1              32                   163444
     C                     ENDIF                                          163444
     C*
     C           *IN50     IFEQ '0'
     C                     Z-ADDLTPO      WLTPO
     C                     Z-ADDLTCP      WLTCP
     C                     Z-ADDLTDAPC    WLTDA
     C                     Z-ADDLOPE      WLOPE
     C                     Z-ADDSOPE      WSOPE
     C                     END
     C*
      ** DO WHILE not End-of-key :
     C*
     C           *IN50     DOWEQ'0'
     C                     MOVE ISTT      KISTT
     C*
      **   Get  Instrument-details from Instrument-type record.
      **     IF record not found,
      **     OR record not live :
      **       process Database-error.
     C*
     C           KISTT     CHAININTYP                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELKISTT     DBKEY            *************
     C                     Z-ADD2         DBASE            * DB-ERR 02 *
     C                     EXSR DBERR                      *************
     C                     END
     C*
     C                     MOVE ISTI      WISTI
     C                     MOVE ISTN      RISTN
     C                     MOVE ISPT      WISPT
     C                     MOVE TKDM      WTKDM
     C                     MOVE MNPF      WMNPF
     C                     MOVE FTRF      WFTRF
     C*
      **   IF instrument is an "OTC" (Over-the-counter) instrument,
      **     no Market-name is printed;
      **   OTHERWISE  (instrument is a Market-instrument) ,
      **     split instrument-code into market-prefix and instrument.
      **     IF market differs from that of previous market-instrument,
      **       get new Market-name for report from Market-file.
      **         IF record not found,
      **         OR record not live :
      **           process Database-error.
     C*
     C           WISTI     IFEQ 'Y'
     C                     MOVE *BLANK    RMKTN
     C                     ELSE
     C                     MOVE KISTT     ISTTX
     C           XMRKT     IFNE WMRKT
     C           XMRKT     CHAINMARKT                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'MARKT'   DBFILE
     C                     MOVELXMRKT     DBKEY            *************
     C                     Z-ADD3         DBASE            * DB-ERR 03 *
     C                     EXSR DBERR                      *************
     C                     END
     C*
     C                     MOVE MRKT      WMRKT
     C                     MOVE MKTN      WMKTN
     C                     END
     C                     MOVE WMKTN     RMKTN
     C                     END
     C*
      **   IF instrument is an Option  (must be a market-instrument) ,
      **     get price-formatting data of the underlying Future record.
      **       IF record not found,
      **       OR record not live :
      **         process Database-error.
     C*
     C           WISTI     IFEQ 'N'
     C           WISPT     ANDGE4
     C           WISPT     ANDNE7                                         AUS022
     C                     MOVE WFTRF     XINST
     C           ISTTX     CHAININTYP2               99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'INTYP'   DBFILE
     C                     MOVELISTTX     DBKEY            *************
     C                     Z-ADD4         DBASE            * DB-ERR 04 *
     C                     EXSR DBERR                      *************
     C                     END
     C*
     C                     MOVE TKDM2     WTKDM2
     C                     MOVE MNPF2     WMNPF2
     C                     END
     C*
      **   DO WHILE  same  Branch,Customer,Currency,Instrument :
      **     Store fields  Year, Month, Put-call, Strike-price.
     C*
     C           *IN50     DOWEQ'0'
     C           ISTT      ANDEQKISTT
     C*
     C                     Z-ADDYRNO      KYRNO
     C                     Z-ADDMTHN      KMTHN
     C                     MOVE PCAL      KPCAL
     C                     Z-ADDSTRP      KSTRP
     C*
      **     DO WHILE  same  Branch,Customer,Currency,Instrument,
      **                     Year,Month,Put-call,Strike-price :
     C*
     C           *IN50     DOWEQ'0'
     C           ISTT      ANDEQKISTT
     C           YRNO      ANDEQKYRNO
     C           MTHN      ANDEQKMTHN
     C           PCAL      ANDEQKPCAL
     C           STRP      ANDEQKSTRP
     C*
      **       IF  Long-open-position is zero,
      **       AND Short-open-position is zero :
      **         Look for live Position-change records for current key.
     C*
     C                     SETON                     51  52
     C           WLOPE     IFEQ *ZERO
     C           WSOPE     ANDEQ*ZERO
      *                                                                   S01299
      ** Determine if a position change record exists on lf-pochg5c       S01299
      ** lf-pochg5t or lf-pochg5r.                                        S01299
      *                                                                   S01299
     C*
     C********** POCHGK    SETLLPOCHG5                                    S01299
     C********** RECI      DOUEQ'D'                                       S01299
     C********** *IN51     OREQ '1'                                       S01299
     C********** POCHGK    READEPOCHG5                   51               S01299
     C**********           END                                            S01299
     C*                                                                   S01299
     C           POCHGK    SETLLPOCHG5C                                   S01299
     C           RECIC     DOUEQ'D'                                       S01299
     C           *IN51     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5C                  51               S01299
     C                     END                                            S01299
     C*                                                                   S01299
     C           *IN51     IFEQ '1'                                       S01299
     C*                                                                   S01299
     C           POCHGK    SETLLPOCHG5T                                   S01299
     C           RECID     DOUEQ'D'                                       S01299
     C           *IN51     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5T                  51               S01299
     C                     END                                            S01299
     C                     END                                            S01299
     C*                                                                   S01299
     C*
     C********** POCHGK    SETLLPOCHG5X                                   S01299
     C********** RECI      DOUEQ'D'                                       S01299
     C********** *IN52     OREQ '1'                                       S01299
     C********** POCHGK    READEPOCHG5X                  52               S01299
     C**********           END                                            S01299
     C*                                                                   S01299
     C           POCHGK    SETLLPOCHG5R                                   S01299
     C           RECI      DOUEQ'D'                                       S01299
     C           *IN52     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C                     END                                            S01299
     C*
     C                     END
     C*
      **       IF  there are Position-change records with current key,
      **       OR  Long-open-position is not zero,
      **       OR  Short-open-position is not zero :
     C*
     C           *IN51     IFEQ '0'
     C           *IN52     OREQ '0'
     C           WLOPE     ORNE *ZERO
     C           WSOPE     ORNE *ZERO
     C*
      **         Process  Instrument-brought-forward.
      **         Process  Position-changes.
      **         Process  Instrument-carried-forward.
     C*
     C                     EXSR IBROFO
     C                     EXSR PCHANS
     C                     EXSR ICARFO
     C*
      **         Update  Instrument-position record fields:
      **           Last Telex/confirmation Position,
      **           Last Telex/conf Closing-price,
      **           Last Telex/conf Date.
     C*
     C                     Z-ADDWLTPO     LTPO
     C                     Z-ADDWPLEC     LTCP
     C                     Z-ADDWRUND     LTDAPC
     C                     EXCPTPOSTN
     C*
     C                     END
     C*
      **       Get next live  Instrument-position record
      **       with same key.
     C*
     C           RECI      DOUEQ'D'
     C           *IN50     OREQ '1'
     C***********POSTNK    READEPOSTNC1                  50               163444
     C           POSTNK    READEFFPSNCPD                 50               163444
     C                     END
      *                                                                   163444
      * Get actual record to update                                       163444
      *                                                                   163444
     C           *IN50     IFEQ *OFF                                      163444
     C           POSTFK    CHAINPOSTNC1              32                   163444
     C                     ENDIF                                          163444
     C*
     C           *IN50     IFEQ '0'
     C                     Z-ADDLTPO      WLTPO
     C                     Z-ADDLTCP      WLTCP
     C                     Z-ADDLTDAPC    WLTDA
     C                     Z-ADDLOPE      WLOPE
     C                     Z-ADDSOPE      WSOPE
     C                     END
     C*
     C                     END
     C                     END
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R TRADSY - TRADING SUMMARY
      ** CALLED FROM  MAIN SECTION
      ** CALLS  S/R    ZDATE2 ZFRPED
     C********************************************************************
     C*
     C           TRADSY    BEGSR
     C***********                                                         S01117
     C***IF**General-ledger*Account-record*is*found*(and*live)*:**********S01117
     C*****Get**Carried-forward-account-balance**from*GL-account.*********S01117
     C*****Get**Brought-forward-account-balance***************************S01117
     C******and*Settlement-account-identifier**from*Settlement-account.***S01117
     C*****Calculate**Cash-adjustments.***********************************S01117
     C**(Otherwise*set*these*summary-fields*to*blank/zero.)***************S01117
     C***********                                                         S01117
     C***********          MOVE *ZERO     WCLBL                           S01117
     C***********          MOVE *ZERO     WBFTB                           S01117
     C***********          MOVE *ZERO     WCASHA                          S01117
     C****NO S/A****       MOVE *BLANK    RATID
     C***********                                                         S01117
     C***********ATID      IFEQ *BLANK                                    S01117
     C***********          SETON                     60                   S01117
     C***********          ELSE                                           S01117
     C***********          MOVE ATID      ATIDX                           S01117
     C***********ATIDK     CHAINACCNT                60                   S01117
     C***********          END                                            S01117
     C***********                                                         S01117
     C************IN60     IFEQ '0'                                       S01117
     C***********RECI      ANDEQ'D'                                       S01117
     C***********                                                         S01117
     C***********          Z-ADDCLBL      WCLBL                           S01117
     C***********                                                         S01117
     C***********          Z-ADDBFTB      WBFTB                           S01117
     C***********                                                         S01117
     C***********WCLBL     SUB  WBFTB     WCASHA                          S01117
     C***********          SUB  WSCOMM    WCASHA                          S01117
     C***********          SUB  WSCHAR    WCASHA                          S01117
     C***********          SUB  WSRLPL    WCASHA                          S01117
     C***********          SUB  WSULPL    WCASHA                          S01117
     C***********          SUB  WSPREM    WCASHA                          S01117
     C***********                                                         S01117
     C***********          MOVE CUSTRA    CUSTRX                          S01117
     C***********          MOVE CURRA     CURRX                           S01117
     C***********          MOVE ACDEA     ACDEX                           S01117
     C***********          MOVE ASEQA     ASEQX                           S01117
     C****NO S/A****       MOVE RTIDX     RATID
     C***********                                                         S01117
     C***********          END                                            S01117
     C                     Z-ADDWCDPL     ZDECS
     C*
     C****       *IN60     IFEQ '1'
     C****NO S/A****       MOVE *BLANKS   RBFTB
     C****REQ'D*****       MOVEL'N/AVAIL' RBFTB
     C****NO S/A****       ELSE
     C****REQ'D*****       Z-ADDWBFTB     ZFLD15
     C****NO S/A****       MOVE 'A'       ZECODE
     C****REQ'D*****       EXSR ZFRPED
     C****NO S/A****       MOVE ZOUT22    RBFTB
     C****REQ'D*****       END
     C*
     C****       *IN60     IFEQ '1'
     C****NO S/A****       MOVE *BLANKS   RCLBL
     C****REQ'D*****       MOVEL'N/AVAIL' RCLBL
     C****NO S/A****       ELSE
     C****REQ'D*****       Z-ADDWCLBL     ZFLD15
     C****NO S/A****       MOVE 'A'       ZECODE
     C****REQ'D*****       EXSR ZFRPED
     C****NO S/A****       MOVE ZOUT22    RCLBL
     C****REQ'D*****       END
     C*
     C****       *IN60     IFEQ '1'
     C****NO S/A****       MOVE *BLANKS   RCASHA
     C****REQ'D*****       MOVEL'N/AVAIL' RCASHA
     C****NO S/A****       ELSE
     C****REQ'D*****       Z-ADDWCASHA    ZFLD15
     C****NO S/A****       MOVE 'A'       ZECODE
     C****REQ'D*****       EXSR ZFRPED
     C****NO S/A****       MOVE ZOUT22    RCASHA
     C****REQ'D*****       END
     C*
      ** Get  Margin, Client-collateral
      ** from Settlement-account.
     C*
     C                     Z-ADDTMAR      ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTMAR
     C*
     C                     Z-ADDCLCO      ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RCLCO
     C*
      ** Format for report those totals already calculated :
      **   Commission, Charges, Realized P&L, Unrealized P&L, Premiums.
     C*
     C                     Z-ADDWSCOMM    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSCOMM
     C*
     C                     Z-ADDWSCHAR    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSCHAR
     C*
     C                     Z-ADDWSRLPL    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSRLPL
     C*
     C                     Z-ADDWSULPL    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSULPL
     C*
     C                     Z-ADDWSPREM    ZFLD15
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RSPREM
     C*
     C                     MOVE *BLANK    ZECODE
     C*
      ** Get  Brought-forward-date  from Settlement-account.
     C*
     C****NO S/A****       Z-ADDLTDA      ZDAYNO
     C****REQ'D*****       EXSR ZDATE2
     C****NO S/A****       MOVE ZADATE    RLTDA
     C*
      ** Print  Account-summary  and clear accumulators.
     C*
     C           LINE      IFGE 49
     C                     WRITEFMTP101
     C                     END
     C                     WRITEFMTP106
     C*
     C                     MOVE *ZERO     WSCOMM
     C                     MOVE *ZERO     WSCHAR
     C                     MOVE *ZERO     WSRLPL
     C                     MOVE *ZERO     WSULPL
     C                     MOVE *ZERO     WSPREM
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R IBROFO - INSTRUMENT BROUGHT FORWARD
      ** CALLED FROM  S/R  IPOSNS
      ** CALLS  S/R    FFPRCS ZDATE2
     C********************************************************************
     C*
     C           IBROFO    BEGSR
     C*
      ** Format  Brought-forward line.
     C*
      **   Put-call indicator.
     C*
     C                     MOVE KPCAL     RPCAL
     C*
      **   Format  Strike-price :
      **     IF  Instrument is an Option :
      **       IF  Instrument is an OTC-instrument,
      **         format Strike-price using data from Option-record;
      **       OTHERWISE,
      **         format Strike-price using data from underlying Future.
      **    (OTHERWISE, Strike-price is blank.)
     C*
     C                     MOVE *BLANK    RSTRP
     C           WISPT     IFGE 4
     C           WISPT     ANDNE7                                         AUS022
     C                     Z-ADDKSTRP     FFPRIC
     C           WISTI     IFEQ 'Y'
     C                     Z-ADDWTKDM     FFTKDM
     C                     Z-ADDWMNPF     FFMNPF
     C                     ELSE
     C                     Z-ADDWTKDM2    FFTKDM
     C                     Z-ADDWMNPF2    FFMNPF
     C                     END
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RSTRP
     C                     END
     C*
      **   Format  Month-name  and Year-number.
     C*
     C                     MOVE *BLANK    RYRNO
     C                     MOVE *BLANK    RMONTH
     C           WISTI     IFNE 'Y'
     C                     MOVE KYRNO     RYRNO
     C           KMTHN     IFGT *ZERO
     C                     MOVE MTH,KMTHN RMONTH
     C                     END
     C                     END
     C*
      **   IF  Last-telex/conf-position >0,
      **     Set  BF-position  to Last-telex/conf-position
      **     with text 'LNG'.
      **   IF  Last-telex/conf-position <0,
      **     Set  BF-position  to Last-telex/conf-position
      **     with  sign changed  and text 'SHT'.
      **  (IF  Last-telex/conf-position =0, there is no text.)
     C*
     C                     MOVE *ZERO     RLTPO
     C                     MOVE *BLANK    RBFPSN
     C*
     C           WLTPO     IFGT *ZERO
     C                     Z-ADDWLTPO     RLTPO
     C                     MOVE 'LNG'     RBFPSN
     C                     END
     C*
     C           WLTPO     IFLT *ZERO
     C                     Z-SUBWLTPO     RLTPO
     C                     MOVE 'SHT'     RBFPSN
     C                     END
     C*
      **   Format  Closing-price using data from the actual instrument.
     C*
     C           WLTCP     IFEQ 0
     C                     MOVE '0'       RLTCP
     C                     ELSE
     C                     Z-ADDWLTCP     FFPRIC
     C                     Z-ADDWTKDM     FFTKDM
     C                     Z-ADDWMNPF     FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RLTCP
     C                     END
     C*
      **   Brought-forward date.
     C*
     C                     Z-ADDWLTDA     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RBFTDA
     C*
      **   Brought-forward text.
     C*
     C                     MOVE WBFTXT    RBFTXT
     C*
      ** Print  Brought-forward line.
     C*
     C           LINE      IFGE 57
     C                     WRITEFMTP101
     C                     END
     C                     WRITEFMTP102
     C*
      ** Clear those fields not repeated on  Page-overflow.
     C*
     C                     MOVE *BLANK    RBFTDA
     C                     MOVE *BLANK    RBFTXT
     C                     MOVE *ZERO     RLTPO
     C                     MOVE *BLANK    RBFPSN
     C                     MOVE *BLANK    RLTCP
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R PCHANS - INSTRUMENT POSITION-CHANGES
      ** CALLED FROM  S/R  IPOSNS
      ** CALLS  S/R  REALAD UNRLAD TRANAD TRANTL DTOTAL   DBERR  ZDATE2
     C********************************************************************
     C*
     C           PCHANS    BEGSR
     C*
      ***Get*first*live*Posn-change*(Close-out or Tran) record for key:   S01299
      *****Branch*Customer*Instrument*Year*Month,Put-call,Strike-price.   S01299
     C*
      *                                                                   S01299
      **  Access a live position change record from   lf-pochg5c and      S01299
      **     lf-pochg5t for the branch, customer, inst type, year,        S01299
      **  month, put/call, and strike price from lf-postnc1 and           S01299
      **  process the record with the lower key value.                    S01299
      *                                                                   S01299
     C********** POCHGK    SETLLPOCHG5                                    S01299
     C**********                                                          S01299
     C**********           SETOF                     0203                 S01299
     C********** RECI      DOUEQ'D'                                       S01299
     C********** *IN51     OREQ '1'                                       S01299
     C********** POCHGK    READEPOCHG5                   51               S01299
     C**********           END                                            S01299
     C*                                                                   S01299
     C                     SETOF                     0203                 S01299
     C           POCHGK    SETLLPOCHG5C                                   S01299
     C*                                                                   S01299
     C           RECIC     DOUEQ'D'                                       S01299
     C           *IN53     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
     C                     END                                            S01299
     C*                                                                   S01299
     C           POCHGK    SETLLPOCHG5T                                   S01299
     C*                                                                   S01299
     C           RECID     DOUEQ'D'                                       S01299
     C           *IN54     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  Set the indicator to show end of file on lf-pochg5c and         S01299
      **  lf-pochg5t to 'N'.                                              S01299
      *                                                                   S01299
     C                     MOVE 'N'       EOF     1                       S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
     C*
      ** DO WHILE not End-of-key :
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C                     Z-ADDPOCDPG    WPOCD
     C*
      **   Format  Position-change-date  for report.
     C*
     C                     Z-ADDWPOCD     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RPOCD
     C*
      **   DO WHILE  same  key,
      **        AND  same  Position-change-date :
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCDPG    ANDEQWPOCD
     C                     Z-ADDTNBRPG    TNBRO   60
     C*
      **     IF  Transaction-number is not zero :
      **       Get  Transaction-record.
      **         IF record not found,
      **         OR record not live :
      **           process Database-error.
     C*
     C           TNBRO     IFNE *ZERO
     C*
     C           TNBRO     CHAINTRANS2               99
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRANS'   DBFILE
     C                     MOVELTNBRO     DBKEY            *************
     C                     Z-ADD5         DBASE            * DB-ERR 05 *
     C                     EXSR DBERR                      *************
     C                     END
     C**********           Z-ADDBOCO      WBOCO                                               CSD027
     C                     MOVE BOCO      WBOCO                                               CSD027
     C                     MOVE TRTY      WTRTY
     C                     MOVE ULTT      WULTT
     C                     Z-ADDCOPR      WCOPR
     C                     MOVE TNAR      RTNAR
     C                     MOVE FCIN      WFCIN
     C*
      **       Get  Transaction-settlement record.
      **         IF record not found,
      **         OR record not live :
      **           process Database-error.
     C*
     C           TNBRO     CHAINTRSET1               99
     C           *IN99     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TRSET'   DBFILE
     C                     MOVELTNBRO     DBKEY            *************
     C                     Z-ADD6         DBASE            * DB-ERR 06 *
     C                     EXSR DBERR                      *************
     C                     END
     C                     Z-ADDCSLT      WCSLT
     C                     MOVE CSLA      WCSLA
     C                     MOVE CFAO      WCFAO
     C                     MOVE CCPN      WCCPN
     C*
     C                     END
     C*
      **     DO WHILE  same key,
      **          AND  same Change-date,
      **          AND  same Transaction-number :
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCDPG    ANDEQWPOCD
     C           TNBRPG    ANDEQTNBRO
     C                     MOVE REVIPG    WREVI
     C*
      **       DO WHILE  same key,
      **            AND  same Change-date,
      **            AND  same Transaction-number,
      **            AND  same Reversal-indicator,
     C*
     C********** *IN51     DOWEQ'0'                                       S01299
     C           EOF       DOWEQ'N'                                       S01299
     C           POCDPG    ANDEQWPOCD
     C           TNBRPG    ANDEQTNBRO
     C           REVIPG    ANDEQWREVI
     C*
      **         Close-out record :
      **           Update  Position-change (Close-out) record  field:
      **             Appeared-on-Telex/conf-indicator.
      **           Increment  Realized-profit/loss figures.
     C*
     C           *IN02     IFEQ '1'
     C**********           MOVE 'Y'       ATCI                            S01299
     C                     MOVE 'Y'       ATCIC                           S01299
     C                     EXCPTPOCHGC
     C                     EXSR REALAD
     C                     END
     C*
      **         Transaction record :
      **           Update  Position-change (Transaction) record  field:
      **             Appeared-on-Telex/conf-indicator.
      **           Increment  Transaction-totals.
     C*
     C           *IN03     IFEQ '1'
     C**********           MOVE 'Y'       ATCI                            S01299
     C                     MOVE 'Y'       ATCID                           S01299
     C                     EXCPTPOCHGT
     C                     EXSR TRANAD
     C                     END
     C*
      **         Get next live Posn-change (Close-out or Tran) record
      **         with same key.
     C*
     C                     SETOF                     0203
     C********** RECI      DOUEQ'D'                                       S01299
     C********** *IN51     OREQ '1'                                       S01299
     C********** POCHGK    READEPOCHG5                   51               S01299
     C**********           END                                            S01299
      *                                                                   S01299
      **  If the indicator to show end of file on lf-pochg5c and          S01299
      **  lf-pochg5t is 'Y' then perform database error processing.       S01299
      *                                                                   S01299
     C           EOF       IFEQ 'Y'                                       S01299
      *                                                                   S01299
     C                     MOVE 'POCHG'   DBFILE                          S01299
     C                     MOVEL'EOF  '   DBKEY            ***************S01299
     C                     Z-ADD8         DBASE            * DB ERROR 08 *S01299
     C                     EXSR DBERR                      ***************S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  If the variable which indicates the file being processed        S01299
      **  equal to 'C' then read a record from lf-pochg5c.                S01299
      *                                                                   S01299
     C           FILE      IFEQ 'C'                                       S01299
     C*                                                                   S01299
     C           RECIC     DOUEQ'D'                                       S01299
     C           *IN53     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5C                  53               S01299
     C                     END                                            S01299
      /SPACE 1                                                            S01299
     C                     ELSE                                           S01299
      *                                                                   S01299
      **  Read a record from lf-pochg5t.                                  S01299
      *                                                                   S01299
     C           RECID     DOUEQ'D'                                       S01299
     C           *IN54     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5T                  54               S01299
     C                     END                                            S01299
     C                     END                                            S01299
      *                                                                   S01299
      **  Select the record with the lower key value for processing       S01299
      **  and move the values read from the files into work fields.       S01299
      *                                                                   S01299
     C                     EXSR SELECT                                    S01299
     C*
     C                     END
     C*
      **       IF  Transaction-number is not zero,
      **         process  Transaction-totals.
     C*
     C           TNBRO     IFNE *ZERO
     C                     EXSR TRANTL
     C                     END
     C*
     C                     END
     C                     END
     C*
      **   Process  Date-totals.
     C*
     C                     EXSR DTOTAL
     C                     END
     C*
      ** Get first live  Position-change (Revaluation) record  for key:
      **   Branch,Customer,Instrument,Year,Month,Put-call,Strike-price.
     C*
     C********** POCHGK    SETLLPOCHG5X                                   S01299
     C**********                                                          S01299
     C**********           SETOF                     01                   S01299
     C********** RECI      DOUEQ'D'                                       S01299
     C********** *IN52     OREQ '1'                                       S01299
     C********** POCHGK    READEPOCHG5X                  52               S01299
     C**********           END                                            S01299
     C*                                                                   S01299
     C           POCHGK    SETLLPOCHG5R                                   S01299
     C*                                                                   S01299
     C                     SETOF                     01                   S01299
     C           RECI      DOUEQ'D'                                       S01299
     C           *IN52     OREQ '1'                                       S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C                     END                                            S01299
     C*
      ** DO WHILE not End-of-key :
     C*
     C           *IN52     DOWEQ'0'
     C                     Z-ADDPOCDPG    WPOCD
     C*
      **   Update  Position-change (Revaluation) record  field:
      **     Appeared-on-Telex/conf-indicator.
      **   Increment  Unrealized-profit/loss figures.
     C*
     C                     MOVE 'Y'       ATCI
     C                     EXCPTPOCHGR
     C                     EXSR UNRLAD
     C*
      **   Get next live  Position-change (Revaluation) record
      **   with same key.
     C*
     C                     SETOF                     01
     C           RECI      DOUEQ'D'
     C           *IN52     OREQ '1'
     C********** POCHGK    READEPOCHG5X                  52               S01299
     C           POCHGK    READEPOCHG5R                  52               S01299
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      *                                                                   S01299
      ** S/R    - Select the record from pochg5c and pochg5t with the     S01299
      ** SELECT   lower key value for processing and move the values      S01299
      **          from the record selected into work fields. The work     S01299
      **          fields used were base on the program's layout of        S01299
      **          pochg5 prior to S01299.                                 S01299
     C*                                                                   S01299
      ** CALLED FROM POCHG                                                S01299
     C*                                                                   S01299
      ** CALLS NO OTHER SUBROUTINES                                       S01299
     C*                                                                   S01299
     C* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * S01299
     C*                                                                   S01299
     C           SELECT    BEGSR                                          S01299
      *                                                                   S01299
      **  Define work fields not previously defined                       S01299
      *                                                                   S01299
     C           *LIKE     DEFN REVIC     REVIPG                          S01299
     C           *LIKE     DEFN RLPLC     RLPL                            S01299
     C           *LIKE     DEFN PCGAD     PCGA                            S01299
     C           *LIKE     DEFN PCGTD     PCGT                            S01299
     C           *LIKE     DEFN POCQD     POCQ                            S01299
     C           *LIKE     DEFN PAYID     PAYIPG                          S01299
     C           *LIKE     DEFN TNBRD     TNBRPG                          S01299
      *                                                                   S01299
      **  If not end of file pochg5c and not end of file pochg5t          S01299
      *                                                                   S01299
     C           *IN53     IFEQ '0'                                       S01299
     C           *IN54     ANDEQ'0'                                       S01299
      *                                                                   S01299
      **  If position change date, trade number and reversal indicator    S01299
      **  on pochg5c is less than or equal to same fields on pochg5t      S01299
      *                                                                   S01299
     C           PCHG4C    IFLE PCHG4T                                    S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'C'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'C'       FILE    1                       S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETON                     02                   S01299
     C                     SETOF                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECIC     RECI                            S01299
     C**********           MOVE BRCDC     BRCDPG                    S01299FO0018
     C                     MOVE BRCAC     BRCAPG                          FO0018
     C                     MOVE CBCDC     CBCDPG                          S01299
     C                     MOVE ISTTC     ISTTPG                          S01299
     C                     MOVE YRNOC     YRNOPG                          S01299
     C                     MOVE MTHNC     MTHNPG                          S01299
     C                     MOVE PCALC     PCALPG                          S01299
     C                     MOVE STRPC     STRPPG                          S01299
     C                     MOVE POCDC     POCDPG                          S01299
     C                     MOVE TNBRC     TNBRPG                          S01299
     C                     MOVE RLPLC     RLPL                            S01299
     C                     MOVE ISCYC     ISCYPG                          S01299
     C                     MOVE AOSIC     AOSI                            S01299
     C                     MOVE ATCIC     ATCI                            S01299
     C                     MOVE PUPIC     PUPI                            S01299
     C                     MOVE REVIC     REVIPG                          S01299
      /SPACE 1                                                            S01299
      *                                                                   S01299
      **  ELSE the record from pochg5t has lower key value                S01299
      *                                                                   S01299
     C                     ELSE                                           S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'T'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'T'       FILE                            S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETOF                     02                   S01299
     C                     SETON                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECID     RECI                            S01299
     C**********           MOVE BRCDD     BRCDPG                    S01299FO0018
     C                     MOVE BRCAD     BRCAPG                          FO0018
     C                     MOVE CBCDD     CBCDPG                          S01299
     C                     MOVE ISTTD     ISTTPG                          S01299
     C                     MOVE YRNOD     YRNOPG                          S01299
     C                     MOVE MTHND     MTHNPG                          S01299
     C                     MOVE PCALD     PCALPG                          S01299
     C                     MOVE STRPD     STRPPG                          S01299
     C                     MOVE POCDD     POCDPG                          S01299
     C                     MOVE TNBRD     TNBRPG                          S01299
     C                     MOVE PCGTD     PCGT                            S01299
     C                     MOVE POCQD     POCQ                            S01299
     C                     MOVE PCGAD     PCGA                            S01299
     C                     MOVE ISCYD     ISCYPG                          S01299
     C                     MOVE AOSID     AOSI                            S01299
     C                     MOVE ATCID     ATCI                            S01299
     C                     MOVE PUPID     PUPI                            S01299
     C                     MOVE PAYID     PAYIPG                          S01299
     C                     MOVE REVID     REVIPG                          S01299
      *                                                                   S01299
     C                     END                                            S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If not end of file pochg5c and end of file pochg5t              S01299
      *                                                                   S01299
     C           *IN53     IFEQ '0'                                       S01299
     C           *IN54     ANDEQ'1'                                       S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'C'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'C'       FILE    1                       S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETON                     02                   S01299
     C                     SETOF                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECIC     RECI                            S01299
     C**********           MOVE BRCDC     BRCDPG                    S01299FO0018
     C                     MOVE BRCAC     BRCAPG                          FO0018
     C                     MOVE CBCDC     CBCDPG                          S01299
     C                     MOVE ISTTC     ISTTPG                          S01299
     C                     MOVE YRNOC     YRNOPG                          S01299
     C                     MOVE MTHNC     MTHNPG                          S01299
     C                     MOVE PCALC     PCALPG                          S01299
     C                     MOVE STRPC     STRPPG                          S01299
     C                     MOVE POCDC     POCDPG                          S01299
     C                     MOVE TNBRC     TNBRPG                          S01299
     C                     MOVE RLPLC     RLPL                            S01299
     C                     MOVE ISCYC     ISCYPG                          S01299
     C                     MOVE AOSIC     AOSI                            S01299
     C                     MOVE ATCIC     ATCI                            S01299
     C                     MOVE PUPIC     PUPI                            S01299
     C                     MOVE REVIC     REVIPG                          S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If not end of file pochg5t and end of file pochg5c              S01299
      *                                                                   S01299
     C           *IN53     IFEQ '1'                                       S01299
     C           *IN54     ANDEQ'0'                                       S01299
      *                                                                   S01299
      **  Set the variable which indicates the file being processed       S01299
      **  to 'T'                                                          S01299
      *                                                                   S01299
     C                     MOVE 'T'       FILE                            S01299
      *                                                                   S01299
      **  Set the format identification indicator to mimic the            S01299
      **  indicator values when details were read from pochg5             S01299
      *                                                                   S01299
     C                     SETOF                     02                   S01299
     C                     SETON                     03                   S01299
      *                                                                   S01299
      **  Move the details read into work fields                          S01299
      *                                                                   S01299
     C                     MOVE RECID     RECI                            S01299
     C**********           MOVE BRCDD     BRCDPG                    S01299FO0018
     C                     MOVE BRCAD     BRCAPG                          FO0018
     C                     MOVE CBCDD     CBCDPG                          S01299
     C                     MOVE ISTTD     ISTTPG                          S01299
     C                     MOVE YRNOD     YRNOPG                          S01299
     C                     MOVE MTHND     MTHNPG                          S01299
     C                     MOVE PCALD     PCALPG                          S01299
     C                     MOVE STRPD     STRPPG                          S01299
     C                     MOVE POCDD     POCDPG                          S01299
     C                     MOVE TNBRD     TNBRPG                          S01299
     C                     MOVE PCGTD     PCGT                            S01299
     C                     MOVE POCQD     POCQ                            S01299
     C                     MOVE PCGAD     PCGA                            S01299
     C                     MOVE ISCYD     ISCYPG                          S01299
     C                     MOVE AOSID     AOSI                            S01299
     C                     MOVE ATCID     ATCI                            S01299
     C                     MOVE PUPID     PUPI                            S01299
     C                     MOVE PAYID     PAYIPG                          S01299
     C                     MOVE REVID     REVIPG                          S01299
      *                                                                   S01299
     C                     END                                            S01299
      /SPACE 3                                                            S01299
      *                                                                   S01299
      **  If end of file pochg5t and end of file pochg5c                  S01299
      *                                                                   S01299
     C           *IN53     IFEQ '1'                                       S01299
     C           *IN54     ANDEQ'1'                                       S01299
      *                                                                   S01299
      **  Set the indicator to show end of file on lf-pochg5c and         S01299
      **  lf-pochg5t to 'Y'.                                              S01299
      *                                                                   S01299
     C                     MOVE 'Y'       EOF                             S01299
      *                                                                   S01299
     C                     END                                            S01299
     C*                                                                   S01299
     C                     ENDSR                                          S01299
     C*                                                                   S01299
     C********************************************************************S01299
      /EJECT                                                              S01299
     C********************************************************************S01299
      ** S/R ICARFO - INSTRUMENT CARRIED FORWARD
      ** CALLED FROM  S/R  IPOSNS
      ** CALLS  S/R    FFPRCS ZFRPED
     C********************************************************************
     C*
     C           ICARFO    BEGSR
     C*
      ** Format  Carried-forward lines.
     C*
      **   IF  Instrument Unrealized-Profit/Loss  accumulator is zero:
      **     first line is printed blank. (Date is on line 2 only.)
      **   OTHERWISE:
      **     Format  Instrument Unrealized-Profit/Loss  for printing.
      **     (Date is on line 1 only.)
      **     Clear  Instrument Unrealized-Profit/Loss  accumulator.
     C*
     C                     MOVE *BLANK    RRUNA1
     C                     MOVE *BLANK    RRUNA2
     C                     MOVE *BLANK    RUPLTX
     C                     MOVE *BLANK    RIULPL
     C           WIULPL    IFEQ *ZERO
     C                     MOVE RRUNA     RRUNA2
     C                     ELSE
     C*
     C                     MOVE RRUNA     RRUNA1
     C                     MOVEL'UNREALIZ'RUPLTX
     C                     MOVE 'ED P&L'  RUPLTX
     C*
     C                     Z-ADDWIULPL    ZFLD15
     C                     Z-ADDWCDPL     ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RIULPL
     C*
     C                     MOVE *ZERO     WIULPL
     C                     END
     C*
      **   Format  Net-position.
     C*
     C                     MOVE *ZERO     RCFTPO
     C                     MOVE *BLANK    RCFPSN
     C*
     C           WLTPO     IFGT *ZERO
     C                     Z-ADDWLTPO     RCFTPO
     C                     MOVE 'LNG'     RCFPSN
     C                     END
     C*
     C           WLTPO     IFLT *ZERO
     C                     Z-SUBWLTPO     RCFTPO
     C                     MOVE 'SHT'     RCFPSN
     C                     END
     C*
      **   Get  Last End-of-centre Closing-price
      **   from Market-price record.
      **    (IF record not found or not live, set price to zero.)
      **     Format price using data from the actual instrument.
     C*
     C                     MOVE *ZERO     WPLEC
     C           PRICSK    CHAINPRICS1               99
     C           *IN99     IFEQ '0'
     C           RECI      ANDEQ'D'
     C                     Z-ADDPLEC      WPLEC
     C                     END
     C*
     C           WPLEC     IFEQ 0
     C                     MOVE '0'       RPLEC
     C                     ELSE
     C                     Z-ADDWPLEC     FFPRIC
     C                     Z-ADDWTKDM     FFTKDM
     C                     Z-ADDWMNPF     FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RPLEC
     C                     END
     C*
      ** Print  Carried-forward lines.
     C*
     C           LINE      IFGE 56
     C                     WRITEFMTP101
     C                     MOVE WCDTXT    RBFTXT
     C                     WRITEFMTP102
     C                     END
     C                     WRITEFMTP105
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R REALAD - ADD A CLOSE-OUT RECORD TO REALIZED PROFIT/LOSS
      ** CALLED FROM  S/R  PCHANS
      ** CALLS  NO OTHER SUBROUTINES
     C********************************************************************
     C*
     C           REALAD    BEGSR
     C*
      ** IF  Reversal-indicator is on,
      **   Change sign of  Realized-Profit/Loss.
      ** IF  Transaction-number is zero :
      **   IF  Reversal-indicator is on,
      **     add  Realized-P/L  to Change-date Realized-P/L-REV;
      **   OTHERWISE,
      **     add  Realized-P/L  to Change-date Realized-P/L;
      ** OTHERWISE,
      **   add  Realized-P/L  to Transaction Realized-P/L-at-Start.
      ** Add  Realized-P/L  to Settlement Realized-P/L-total.
     C*
     C           WREVI     IFEQ 1
     C                     Z-SUBRLPL      WRLPL
     C                     ELSE
     C                     Z-ADDRLPL      WRLPL
     C                     END
     C*
     C           TNBRO     IFEQ 0
     C*
     C           WREVI     IFEQ 1
     C                     ADD  WRLPL     WDRPL1
     C                     ELSE
     C                     ADD  WRLPL     WDRPL0
     C                     END
     C*
     C                     ELSE
     C                     ADD  WRLPL     WTRPLS
     C                     END
     C*
     C                     ADD  WRLPL     WSRLPL
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R UNRLAD - ADD REVALUATION RECORD TO UNREALIZED PROFIT/LOSS
      ** CALLED FROM  S/R  PCHANS
      ** CALLS  NO OTHER SUBROUTINES
     C********************************************************************
     C*
     C           UNRLAD    BEGSR
     C*
      ** Add  Unrealized-Profit/Loss  to  Instrument Unrealized-P/L,
      **                         and  to  Settlement Unrealized-P/L.
     C*
     C                     ADD  ULPL      WIULPL
     C                     ADD  ULPL      WSULPL
     C*
      ** IF  Settlement-type = 1 :
     C*
     C           TSSETP    IFEQ 1
     C*
      **   Add a record to  Confirmation/Telex Report file
      **   for  Day-total Unrealized Profit/Loss.
      **   (There is only 1 such record per day.)
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCD     BRCD                            S01117
     C                     MOVE KBRCA     BRCA                            S01117
     C                     MOVE KCBCD     CBCD
     C                     MOVE KISCY     ISCY
     C                     MOVE KISTT     ISTT
     C                     Z-ADDKYRNO     YRNO
     C                     Z-ADDKMTHN     MTHN
     C                     MOVE KPCAL     PCAL
     C                     Z-ADDKSTRP     STRP
     C                     Z-ADDWPOCD     POCD
     C                     MOVE '8'       PAYI
     C                     MOVE *ZERO     REVI
     C                     MOVE *ZERO     TNBR
     C                     MOVE *ZERO     TOCN
     C                     MOVE *ZERO     TOCM
     C                     MOVE *ZERO     TOCG
     C*
     C                     Z-ADDULPL      TOPR
     C*
     C                     Z-ADDTSSETP    SETP
     C*
     C***If*settlement*account*blank*default*to*01************************S01117
     C** If settlement account blank default to 00                        S01117
     C*
     C           TSSETA    IFEQ *BLANKS
     C                     MOVE *BLANKS   SETA
     C***********          MOVEL'01'      SETA                            S01117
     C                     MOVEL'00'      SETA                            S01117
     C                     MOVE BRCAPC    SEBR                            S01117
     C                     MOVE BRCAPC    SBID                            S01117
     C                     ELSE
     C                     MOVE TSSETA    SETA
     C                     MOVE TSSEBR    SEBR                            S01117
     C                     MOVE TSSBID    SBID                            S01117
     C                     END
     C*
     C                     MOVE TSFACO    FACO
     C                     MOVE TSCNOS    CNOS
     C*
     C                     WRITECNFRPDF
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R TRANAD - ADD A TRANSACTION-RECORD TO TRANSACTION-TOTALS
      ** CALLED FROM  S/R  PCHANS
      ** CALLS  NO OTHER SUBROUTINES
     C********************************************************************
     C*
     C           TRANAD    BEGSR
     C*
      ** IF  Reversal-indicator is on,
      **   Change sign of  Position-change-quantity,
      **           and of  Position-change-amount.
     C*
     C           WREVI     IFEQ 1
     C                     Z-SUBPOCQ      WPOCQ
     C                     Z-SUBPCGA      WPCGA
     C                     ELSE
     C                     Z-ADDPOCQ      WPOCQ
     C                     Z-ADDPCGA      WPCGA
     C                     END
     C*
      ** IF  Position-change-type is blank (Contracts) :
      **   IF  Payable-indicator is zero,
      **     add  Change-quantity  to Transaction-contracts-at-Start.
      **   OTHERWISE,
      **     add  Change-quantity  to Transaction-contracts-at-End;
     C*
     C           PCGT      IFEQ *BLANK
     C*
     C           PAYIPG    IFEQ '0'
     C                     ADD  WPOCQ     WTCONS
     C                     ELSE
     C                     ADD  WPOCQ     WTCONE
     C                     END
     C*
     C                     END
     C*
      ** IF  Position-change-type is 'A' (Charges) :
      **   IF  Payable-indicator is zero,
      **     add  Change-amount  to Transaction-charges-at-Start.
      **   OTHERWISE,
      **     add  Change-amount  to Transaction-charges-at-End;
      **   Add  Change-amount  to Settlement-charges-total.
     C*
     C           PCGT      IFEQ 'A'
     C*
     C           PAYIPG    IFEQ '0'
     C                     ADD  WPCGA     WTCHAS
     C                     ELSE
     C                     ADD  WPCGA     WTCHAE
     C                     END
     C*
     C                     ADD  WPCGA     WSCHAR
     C                     END
     C*
      ** IF  Position-change-type is 'B' (Commission) :
      **   IF  Payable-indicator is zero,
      **     add  Change-amount  to Transaction-commission-at-Start.
      **   OTHERWISE,
      **     add  Change-amount  to Transaction-commission-at-End;
      **   Add  Change-amount  to Settlement-commission-total.
     C*
     C           PCGT      IFEQ 'B'
     C*
     C           PAYIPG    IFEQ '0'
     C                     ADD  WPCGA     WTCOMS
     C                     ELSE
     C                     ADD  WPCGA     WTCOME
     C                     END
     C*
     C                     ADD  WPCGA     WSCOMM
     C                     END
     C*
      ** IF  Position-change-type is 'C' (Premiums) :
      **   IF  Payable-indicator is zero,
      **     add  Change-amount  to Transaction Realized-P/L-Start.
      **   OTHERWISE,
      **     add  Change-amount  to Transaction Realized-P/L-End;
      **   Add  Change-amount  to Settlement-premium.
     C*
     C           PCGT      IFEQ 'C'
     C*
     C           PAYIPG    IFEQ '0'
     C                     ADD  WPCGA     WTRPLS
     C                     ELSE
     C                     ADD  WPCGA     WTRPLE
     C                     END
     C*
     C                     ADD  WPCGA     WSPREM
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R TRANTL - PRINT TRANSACTION-TOTALS (DETAIL-LEVEL OF REPORT)
      ** CALLED FROM  S/R  PCHANS
      ** CALLS  S/R    FFPRCS ZFRPED
     C********************************************************************
     C*
     C           TRANTL    BEGSR
     C*
     C                     MOVE *BLANK    RTRTY
     C*
      ** IF  Transaction-type is  'P' or 'S' :
     C*
     C           WTRTY     IFEQ 'P'
     C           WTRTY     OREQ 'S'
     C*
      **   IF no broker is involved :
      **     IF  Transaction-type is 'P',
      **       report  Transaction-type as 'S';
      **     OTHERWISE,
      **       report  Transaction-type as 'P';
      **   OTHERWISE,
      **     report  Transaction-type unchanged.
     C*
     C********** WBOCO     IFEQ *ZERO                                                         CSD027
     C           WBOCO     IFEQ *BLANKS                                                       CSD027
     C*
     C           WTRTY     IFEQ 'P'
     C                     MOVE 'S'       RTRTY
     C                     ELSE
     C                     MOVE 'P'       RTRTY
     C                     END
     C*
     C                     ELSE
     C                     MOVE WTRTY     RTRTY
     C                     END
     C*
      **   IF reported Transaction-type is 'P' :
      **     Add  Transaction-contracts-at-Start
      **      and Transaction-contracts-at-End    to Net-position;
      **   IF reported Transaction-type is 'S' :
      **     Subtract  Transaction-contracts-Start
      **          and  Transaction-contracts-End    from Net-position.
     C*
     C           RTRTY     IFEQ 'P'
     C                     ADD  WTCONS    WLTPO
     C                     ADD  WTCONE    WLTPO
     C                     END
     C*
     C           RTRTY     IFEQ 'S'
     C                     SUB  WTCONS    WLTPO
     C                     SUB  WTCONE    WLTPO
     C                     END
     C*
      **   Format  Contract-price for report, using data from the
      **   actual instrument.
     C*
     C                     Z-ADDWCOPR     FFPRIC
     C                     Z-ADDWTKDM     FFTKDM
     C                     Z-ADDWMNPF     FFMNPF
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCOPR
     C*
     C                     END
     C*
      ** IF  Transaction-type is 'E' :
      **   IF  Underlying-transaction-type is  'P' or 'S' :
      **     IF no broker is involved,
      **      AND  Underlying-transaction-type is 'P',
      **     OR broker is involved,
      **      AND  Underlying-transaction-type is 'S' :
      **         Subtract Transaction-contracts-Start
      **              and Transaction-contracts-End  from Net-position.
      **     OTHERWISE :
      **       Add  Transaction-contracts-at-Start
      **        and Transaction-contracts-at-End    to Net-position.
     C*
     C           WTRTY     IFEQ 'E'
     C*
     C           WULTT     IFEQ 'P'
     C           WULTT     OREQ 'S'
     C*
     C********** WBOCO     IFEQ *ZERO                                                         CSD027
     C           WBOCO     IFEQ *BLANKS                                                       CSD027
     C           WULTT     ANDEQ'P'
     C********** WBOCO     ORNE *ZERO                                                         CSD027
     C           WBOCO     ORNE *BLANKS                                                       CSD027
     C           WULTT     ANDEQ'S'
     C                     SUB  WTCONS    WLTPO
     C                     SUB  WTCONE    WLTPO
     C                     ELSE
     C                     ADD  WTCONS    WLTPO
     C                     ADD  WTCONE    WLTPO
     C                     END
     C*
     C                     END
     C*
      **   Report  Transaction-type unchanged.
     C*
     C                     MOVE WTRTY     RTRTY
     C*
      **   IF  Instrument is an "OTC",
      **     Format  Exercise-price for report using data from the     with
      **     actual instrument;                                        with
      **   OTHERWISE,
      **     Format  Exercise-price for report using data from the     with
      **     underlying Future.                                        with
     C*
     C                     Z-ADDWCOPR     FFPRIC
     C           WISTI     IFEQ 'Y'
     C                     Z-ADDWTKDM     FFTKDM
     C                     Z-ADDWMNPF     FFMNPF
     C                     ELSE
     C                     Z-ADDWTKDM2    FFTKDM
     C                     Z-ADDWMNPF2    FFMNPF
     C                     END
     C                     EXSR FFPRCS
     C                     MOVE FFSPRC    RCOPR
     C*
     C                     END
     C*
      ** IF  Final-closure-indicator is 'Y',
      ** and contracts have been closed out
      **   Report  Closure-indicator unchanged;
      ** OTHERWISE,
      **   Report  Closure-indicator as blank.
     C*
     C                     MOVE *BLANK    RFCIN
     C           WFCIN     IFEQ 'Y'
     C           WTCONE    ANDNE*ZERO
     C                     MOVE WFCIN     RFCIN
     C                     END
     C*
      ** Translate  Reversal-indicator  to "REV" or blank.
     C*
     C                     MOVE *BLANK    RREVTX
     C           WREVI     IFEQ 1
     C                     MOVE 'REV'     RREVTX
     C                     END
     C*
      ** Format amount-totals (at-start and at-end).
      **(IF amount-totals are zero, print as blank.)
     C*
     C                     MOVE *BLANK    RTCONS
     C                     MOVE *BLANK    RTCONE
     C                     MOVE *BLANK    RTCOMS
     C                     MOVE *BLANK    RTCOME
     C                     MOVE *BLANK    RTCHAS
     C                     MOVE *BLANK    RTCHAE
     C                     MOVE *BLANK    RTRPLS
     C                     MOVE *BLANK    RTRPLE
     C*
      ** Contracts fields edited with '-'
     C*
     C                     MOVE 'L'       ZECODE
     C*
      ** If 'Start' number of contracts is zero
      **   write 'End' number of contracts on 1st line
      ** Otherwise
      **   write 'Start' number of contracts on 1st line
      **   write 'End'   number of contracts on 2nd line
     C*
     C           WTCONS    IFEQ 0
     C                     Z-ADDWTCONE    ZFLD15
     C                     ELSE
     C*
      ** Contracts 'at start' always reported as positive
     C*
     C           WTCONS    IFLT 0
     C                     Z-SUBWTCONS    ZFLD15
     C                     ELSE
     C                     Z-ADDWTCONS    ZFLD15
     C                     END
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADD0         ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCONS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           WTCONS    IFNE 0
     C                     Z-ADDWTCONE    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADD0         ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCONE
     C                     END
     C*
     C*
      ** Amount fields edited with CR
     C*
     C                     MOVE 'A'       ZECODE
     C*
      ** If 'Start' commissions are zero
      **   write 'End' commissions on 1st line
      ** Otherwise
      **   write 'Start' commissions on 1st line
      **   write 'End'   commissions on 2nd line
     C*
     C           WTCOMS    IFEQ 0
     C                     Z-ADDWTCOME    ZFLD15
     C                     ELSE
     C                     Z-ADDWTCOMS    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCOMS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           WTCOMS    IFNE 0
     C                     Z-ADDWTCOME    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCOME
     C                     END
     C*
      ** If 'Start' charges are zero
      **   write 'End' charges on 1st line
      ** Otherwise
      **   write 'Start' charges on 1st line
      **   write 'End'   charges on 2nd line
     C*
     C           WTCHAS    IFEQ 0
     C                     Z-ADDWTCHAE    ZFLD15
     C                     ELSE
     C                     Z-ADDWTCHAS    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCHAS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           WTCHAS    IFNE 0
     C                     Z-ADDWTCHAE    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTCHAS
     C                     END
     C*
      ** If 'Start' profit/loss is zero
      **   write 'End' profit/loss on 1st line
      ** Otherwise
      **   write 'Start' profit/loss on 1st line
      **   write 'End'   profit/loss on 2nd line
     C*
     C           WTRPLS    IFEQ 0
     C                     Z-ADDWTRPLE    ZFLD15
     C                     ELSE
     C                     Z-ADDWTRPLS    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRPLS
     C                     END
     C*
     C                     Z-ADD*ZERO     ZFLD15
     C*
     C           WTRPLS    IFNE 0
     C                     Z-ADDWTRPLE    ZFLD15
     C                     END
     C*
     C           ZFLD15    IFNE 0
     C                     Z-ADDCDP       ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RTRPLE
     C                     END
     C*
      ** Transaction number may be negative (for trades at maturity)
     C*
     C           TNBRO     IFGT *ZERO
     C                     MOVELTNBRO     RTNBR
     C                     MOVE '    '    RTNBR
     C                     ELSE
     C                     Z-SUBTNBRO     WTNBR   60
     C                     MOVELWTNBR     RTNBR
     C                     MOVE '-(M)'    RTNBR
     C                     END
     C*
      ** Print  Transaction-totals (the detail-level of the report).
     C*
     C           LINE      IFGE 58
     C                     WRITEFMTP101
     C                     MOVE WCDTXT    RBFTXT
     C                     WRITEFMTP102
     C                     END
     C                     WRITEFMTP103
     C/COPY WNCPYSRC,FF0590C003
     C*
      ** IF  Customer Settlement-type = 1 :
     C*
     C           WCSLT     IFEQ 1
     C*
      **   Add a record to  Confirmation/Telex Report file
      **   for  Transaction-start totals.
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCD     BRCD                            S01117
     C                     MOVE KBRCA     BRCA                            S01117
     C                     MOVE KCBCD     CBCD
     C                     MOVE KISCY     ISCY
     C                     MOVE KISTT     ISTT
     C                     Z-ADDKYRNO     YRNO
     C                     Z-ADDKMTHN     MTHN
     C                     MOVE KPCAL     PCAL
     C                     Z-ADDKSTRP     STRP
     C                     Z-ADDWPOCD     POCD
     C*
     C* Transaction settlement details
     C*
     C                     Z-ADDWCSLT     SETP
     C*
     C           WCSLA     IFEQ *BLANKS
     C                     MOVE *BLANKS   SETA
     C***********          MOVEL'01'      SETA                            S01117
     C                     MOVEL'00'      SETA                            S01117
     C*                                                                   S01117
     C                     MOVE BRCAPC    SEBR                            S01117
     C                     MOVE BRCAPC    SBID                            S01117
     C                     ELSE
     C                     MOVE WCSLA     SETA
     C*                                                                   S01117
     C                     MOVE BRSC      SEBR                            S01117
     C                     MOVE CBID      SBID                            S01117
     C                     END
     C*
     C                     MOVE WCFAO     FACO
     C                     MOVE WCCPN     CNOS
     C*
     C                     Z-ADDWREVI     REVI
     C                     Z-ADDTNBRO     TNBR
     C*
     C                     MOVE '0'       PAYI
     C*
     C                     Z-ADDWTCONS    TOCN
     C                     Z-ADDWTCOMS    TOCM
     C                     Z-ADDWTCHAS    TOCG
     C                     Z-ADDWTRPLS    TOPR
     C*
      **   Add a record if any amounts are payable
     C*
     C           TOCM      IFNE *ZERO
     C           TOCG      ORNE *ZERO
     C           TOPR      ORNE *ZERO
     C                     WRITECNFRPDF
     C                     END
     C*
      **   Add a record to  Confirmation/Telex Report file
      **   for  Transaction-end totals.
      **    (Most fields are as set up for start-totals record.)
     C*
     C                     MOVE '1'       PAYI
     C*
     C                     Z-ADDWTCONE    TOCN
     C                     Z-ADDWTCOME    TOCM
     C                     Z-ADDWTCHAE    TOCG
     C                     Z-ADDWTRPLE    TOPR
     C*
      **   Add a record if any amounts are payable
     C*
     C           TOCM      IFNE *ZERO
     C           TOCG      ORNE *ZERO
     C           TOPR      ORNE *ZERO
     C                     WRITECNFRPDF
     C                     END
     C*
     C                     END
     C*
      ** Clear  Transaction-total accumulators.
     C*
     C                     MOVE *ZERO     WTCONS
     C                     MOVE *ZERO     WTCONE
     C                     MOVE *ZERO     WTCOMS
     C                     MOVE *ZERO     WTCOME
     C                     MOVE *ZERO     WTCHAS
     C                     MOVE *ZERO     WTCHAE
     C                     MOVE *ZERO     WTRPLS
     C                     MOVE *ZERO     WTRPLE
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R DTOTAL - PRINT POSITION-CHANGE DATE-TOTALS
      ** CALLED FROM  S/R  PCHANS
      ** CALLS  S/R    ZFRPED
     C********************************************************************
     C*
     C           DTOTAL    BEGSR
     C*
     C                     MOVEL'REALIZED'RRPLTX
     C                     MOVE ' P&L    'RRPLTX
     C*
      ** IF  Change-date Realized-P/L is not zero,
      **   Print  Date-total line on report (leaving space for a
      **   second date-total line on same page).
     C*
     C           WDRPL0    IFNE *ZERO
     C*
     C                     Z-ADDWDRPL0    ZFLD15
     C                     Z-ADDWCDPL     ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RDRLPL
     C*
     C           LINE      IFGE 58
     C                     WRITEFMTP101
     C                     MOVE WCDTXT    RBFTXT
     C                     WRITEFMTP102
     C                     END
     C                     WRITEFMTP104
     C*
     C                     END
     C*
      ** IF  Change-date Realized-P/L-REV is not zero,
      **   Print  Date-total line on report.
     C*
     C           WDRPL1    IFNE *ZERO
     C*
     C                     MOVE 'REV'     RRPLTX
     C*
     C                     Z-ADDWDRPL1    ZFLD15
     C                     Z-ADDWCDPL     ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    RDRLPL
     C*
     C           LINE      IFGE 59
     C                     WRITEFMTP101
     C                     MOVE WCDTXT    RBFTXT
     C                     WRITEFMTP102
     C                     END
     C                     WRITEFMTP104
     C*
     C                     END
     C*
      ** IF  Settlement-type = 1 :
     C*
     C           TSSETP    IFEQ 1
     C*
      **   IF  Change-date Realized-P/L is not zero,
      **     Add a record to  Confirmation/Telex Report file
      **     for  Day-total Realized-Profit/Loss.
     C*
     C           WDRPL0    IFNE *ZERO
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCD     BRCD                            S01117
     C                     MOVE KBRCA     BRCA                            S01117
     C                     MOVE KCBCD     CBCD
     C                     MOVE KISCY     ISCY
     C                     MOVE KISTT     ISTT
     C                     Z-ADDKYRNO     YRNO
     C                     Z-ADDKMTHN     MTHN
     C                     MOVE KPCAL     PCAL
     C                     Z-ADDKSTRP     STRP
     C                     Z-ADDWPOCD     POCD
     C                     MOVE '9'       PAYI
     C*
     C                     MOVE *ZERO     REVI
     C*
     C                     MOVE *ZERO     TNBR
     C                     MOVE *ZERO     TOCN
     C                     MOVE *ZERO     TOCM
     C                     MOVE *ZERO     TOCG
     C*
     C                     Z-ADDWDRPL0    TOPR
     C*
     C                     Z-ADDTSSETP    SETP
     C*
     C           TSSETA    IFEQ *BLANKS
     C                     MOVE *BLANKS   SETA
     C***********          MOVEL'01'      SETA                            S01117
     C                     MOVEL'00'      SETA                            S01117
     C                     MOVE BRCAPC    SEBR                            S01117
     C                     MOVE BRCAPC    SBID                            S01117
     C                     ELSE
     C                     MOVE TSSETA    SETA
     C                     MOVE TSSEBR    SEBR                            S01117
     C                     MOVE TSSBID    SBID                            S01117
     C                     END
     C*
     C                     MOVE TSFACO    FACO
     C                     MOVE TSCNOS    CNOS
     C*
     C                     WRITECNFRPDF
     C*
     C                     END
     C*
      **   IF  Change-date Realized-P/L-REV  is not zero,
      **     Add a record to  Confirmation/Telex Report file
      **     for  Day-total Realized-Profit/Loss-REV.
     C*
     C           WDRPL1    IFNE *ZERO
     C*
     C                     MOVE 'D'       RECI
     C***********          MOVE KBRCD     BRCD                            S01117
     C                     MOVE KBRCA     BRCA                            S01117
     C                     MOVE KCBCD     CBCD
     C                     MOVE KISCY     ISCY
     C                     MOVE KISTT     ISTT
     C                     Z-ADDKYRNO     YRNO
     C                     Z-ADDKMTHN     MTHN
     C                     MOVE KPCAL     PCAL
     C                     Z-ADDKSTRP     STRP
     C                     Z-ADDWPOCD     POCD
     C                     MOVE '9'       PAYI
     C*
     C                     Z-ADD1         REVI
     C*
     C                     MOVE *ZERO     TNBR
     C                     MOVE *ZERO     TOCN
     C                     MOVE *ZERO     TOCM
     C                     MOVE *ZERO     TOCG
     C*
     C                     Z-ADDWDRPL1    TOPR
     C*
     C                     Z-ADDTSSETP    SETP
     C*
     C           TSSETA    IFEQ *BLANKS
     C                     MOVE *BLANKS   SETA
     C***********          MOVEL'01'      SETA                            S01117
     C                     MOVEL'00'      SETA                            S01117
     C                     MOVE BRCAPC    SEBR                            S01117
     C                     MOVE BRCAPC    SBID                            S01117
     C                     ELSE
     C                     MOVE TSSETA    SETA
     C                     MOVE TSSEBR    SEBR                            S01117
     C                     MOVE TSSBID    SBID                            S01117
     C                     END
     C*
     C                     MOVE TSFACO    FACO
     C                     MOVE TSCNOS    CNOS
     C*
     C                     WRITECNFRPDF
     C*
     C                     END
     C*
     C                     END
     C*
      ** Clear  Change-date Realized-P/L  accumulators.
     C*
     C                     MOVE *ZERO     WDRPL0
     C                     MOVE *ZERO     WDRPL1
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R TFILE  - GET A RECORD FROM TABLE-FILE
      ** CALLED FROM  MAIN SECTION,  S/R  INIT
      ** CALLS  S/R    DBERR
     C********************************************************************
     C*
     C           TFILE     BEGSR
     C*
      ** Get a record from (logical) Table-file TABFF.
      **   IF no record found,
      **   OR record not live:
      **     process Database-error.
     C*
     C           KEY       CHAINTABFF                99
     C*
     C           *IN99     IFEQ '1'
     C           RECI      ORNE 'D'
     C           *LOCK     IN   LDA                                       S01117
     C                     MOVE 'TABFF'   DBFILE
     C                     MOVELKEY       DBKEY            *************
     C                     Z-ADD7         DBASE            * DB-ERR 07 *
     C                     EXSR DBERR                      *************
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT
     C********************************************************************
      ** S/R DBERR  - END PROGRAM WITH DATABASE-ERROR
      ** CALLED FROM  MAIN SECTION,  S/R  IPOSNS PCHANS   TFILE
      ** CALLS  NO OTHER SUBROUTINES
     C********************************************************************
     C*
     C           DBERR     BEGSR
     C*                                                                   S01117
     C                     OUT  LDA                                       S01117
     C*
      ** Print DB-Error line on report.
      ** Set on indicators  U7,U8,LR.
      ** Return.
     C*
     C           *IN15     IFEQ '1'                                       S01117
     C           LINE      IFGE 57
     C           LINE      ORLE 1                                         S01117
     C                     WRITEFMTP101
     C                     END
     C                     WRITEFMTP107
     C                     WRITEFMTP108                                   S01117
     C                     END                                            S01117
     C*
     C                     SETON                     U7U8LR
     C*                                                                   S01117
     C                     EXSR WRITAU                                    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
      /EJECT                                                              S01117
     C********************************************************************S01117
      **                                                                  S01117
      ** WRITAU - SUBROUTINE TO OUTPUT AU REPORT                          S01117
      ** CALLS: NOTHING                                                   S01117
      **                                                                  S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           WRITAU    BEGSR                           ** WRITAU **   S01117
     C*                                                                   S01117
      ** IF first cycle indicator is off                                  S01117
      **     Perform Initial processing                                   S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     EXSR INIT                                      S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
      ** ENSURE TOTAL SPOOL FILE RECORDED BY RCF                          S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM *BLANKS   SENTY   3                       S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           ZSNUMU                          S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
      **  ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAM       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C                     SETON                     U7U8                 S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** OUTPUT AUDIT REPORT HEADING                                      S01117
     C*                                                                   S01117
     C                     WRITEFMTAU01                                   S01117
     C*                                                                   S01117
      ** OUTPUT RUN CONTROLS TOTAL TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C                     WRITEFMTAU02                                   S01117
     C*                                                                   S01117
      ** IF NO DETAIL TO REPORT, OUTPUT TO AUDIT REPORT                   S01117
     C*                                                                   S01117
     C           *IN15     IFEQ '0'                                       S01117
     C           *INU7     ANDEQ'0'                                       S01117
     C                     WRITEFMTAU03                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
      ** IF DATABASE ERROR, OUTPUT TO AUDIT REPORT                        S01117
     C*                                                                   S01117
     C           *INU7     IFEQ '1'                                       S01117
     C                     WRITEFMTAU04                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT
     C/COPY ZSRSRC,FFPRCSZ4
     C*         SR FFPRCS
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z2
     C*         SR ZDATE2
      /EJECT
     C/COPY ZSRSRC,ZFRPEDZ3
     C*         SR ZFRPED
      /EJECT
     O********************************************************************
     O*
     OTSCCYDF E                TSUPD
     O*
      ** Update file TSCCY3.
     O*
     O***********              BFTB                                       S01117
     O                         LTDA
     O                         TLCI
     O*
     OPOSTNCDFE                POSTN
     O*
      ** Update file POSTNC1.
     O*
     O                         LTPO
     O                         LTCP
     O                         LTDAPC
     O*
     OPOCHGCCFE                POCHGC
     O*
      ** Update file POCHGCC: Close-outs.
     O*
     O**********               ATCI                                       S01299
     O                         ATCIC                                      S01299
     O*
     OPOCHGTCFE                POCHGT
     O*
      ** Update file POCHGTC: Transactions.
     O*
     O**********               ATCI                                       S01299
     O                         ATCID                                      S01299
     O*
     OPOCHGRCFE                POCHGR
     O*
      ** Update file POCHGRC: Revaluations.
     O*
     O                         ATCI
      /COPY ZSRSRC,ZDATE2Z3
**   MTH  - Month Names
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
