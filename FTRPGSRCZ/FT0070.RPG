     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas FT Cheques for collection maintainance')         *
      *****************************************************************
      *                                                               *
      *  Midas - FUNDS TRANSFER MODULE                                *
      *                                                               *
      *  FT0070 - CHEQUES FOR COLLECTION INPUT                        *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD052101           Date 22Nov19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD039163           Date 08Jun16               *
      *                 MD037669           Date 25May16               *
      *                 AR920572           Date 04Nov14               *
      *                 AR1008672          Date 20Nov12               *
      *                 AR1031132          Date 14Sep12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR804457A          Date 22Sep11               *
      *                 AR804457           Date 01Sep11               *
      *                 AR944056           Date 04Apr12               *
      *                 AR888911           Date 26Jan12               *
      *                 AR940742           Date 26Mar12               *
      *                 AR879983           Date 21Dec11               *
      *                 AR853257           Date 04Nov11               *
      *                 AR820566           Date 25Aug11               *
      *                 CER049             Date 06Dec10               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP205             Date 03Mar10               *
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 BUG10569           Date 15Feb06               *
      *                 159283             Date 06Jun06               *
      *                 CDL049             Date 06Jul06               *
      *                 CSD027A            Date 10May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10569           Date 15Feb06               *
      *                 CER001             Date 25Apr05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3193            Date 02Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 TDA030             Date 17Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 CSD015             Date 14Oct02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 212014             Date 20Nov02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CFT009             Date 30May00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179732             Date 15May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 132123             Date 18Oct98               *
      *                 148229             Date 13Dec98               *
      *                 142243             DATE  8Sep98               *
      *                 141288             DATE  3Sep98               *
      *                 140647             DATE 24Aug98               *
      *                 140646             DATE 25Aug98               *
      *                 CEU006             DATE 08Apr98               *
      *                 112287             DATE 19Feb98               *
      *                 125638             DATE 07JAN98               *
      *                 120827             Date 06Jul97               *
      *                 096486             DATE 02APR97               *
      *                 CAC001             DATE 01FEB96               *
      *                 S01408             DATE 22FEB96               *
      *                 093958             DATE 17JAN96               *
      *                 095270             DATE 23NOV95               *
      *                 084499             DATE 18APR95               *
      *                 074814             DATE 02AUG94               *
      *                 074810             DATE 01AUG94               *
      *                 S01508             DATE 27JUN94               *
      *                 S01499             DATE 06JUN94               *
      *                 S01494             DATE 25MAY94               *
      *                 068347             DATE 18MAR94               *
      *                 063918             DATE 30NOV93               *
      *                 051022             DATE 23FEB93               *
      *                 049860             DATE 22JAN93               *
      *                 059850             DATE 31AUG93               *
      *                 058194             DATE 15JUL93               *
      *                 056823             DATE 17JUN93               *
      *                 S01408             DATE 14JUN93               *
      *                 056031             DATE 28MAY93               *
      *                 047179             DATE 29APR93               *
      *                 042509             DATE 27APR93               *
      *                 052487             DATE 22APR93               *
      *                 S01414             DATE 29MAR93               *
      *                 048377             DATE 22DEC92               *
      *                 052310             DATE 16MAR93               *
      *                 043715             DATE 15SEP92               *
      *                 037405             DATE 23MAR92               *
      *                 050924             DATE 08MAY92               *
      *                 035406             DATE 17OCT91               *
      *                 035398             DATE 04SEP91               *
      *                 E37067             DATE 13MAR92               *
      *                 E37066             DATE 13MAR92               *
      *                 E37065             DATE 13MAR92               *
      *                 E32543             DATE 21NOV91               *
      *                 E30066             DATE 11OCT91               *
      *                 E29970             DATE 02AUG91               *
      *                 E04167             DATE 23JUL91               *
      *                 E25169             DATE 04JUL91               *
      *                 E32880             DATE 04JUN91               *
      *                 E25172             DATE 31MAY91               *
      *                 E25274             DATE 29MAY91               *
      *                 E25159             DATE 23MAY91               *
      *                 E25160             DATE 23MAY91               *
      *                 E32533             DATE 19APR91               *
      *                 E32859             DATE 07MAY91               *
      *                 E29890             DATE 18FEB91               *
      *                 E29887             DATE 17JAN91               *
      *                 E29884             DATE 17JAN91               *
      *                 E29882             DATE 16JAN91               *
      *                 E29881             DATE 10JAN91               *
      *                 S01195             DATE 18OCT90               *
      *                 S01194             DATE 18OCT90               *
      *                 S01117             DATE 18OCT90               *
      *                 E23603             DATE 04OCT90               *
      *                 E21459             DATE 19SEP90               *
      *                 E23540             DATE 06SEP90               *
      *                 E23056             DATE 14AUG90               *
      *                 E23290             DATE 14AUG90               *
      *                 E22952             DATE 01AUG90               *
      *                 E22950             DATE 30JUL90               *
      *                 E21597             DATE 05APR90               *
      *                 S01251             DATE 03FEB90               *
      *                 S01252             DATE 03FEB90               *
      *                 S01241             DATE 08JAN90               *
      *                 S01199             DATE 17/08/89              *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD052101 - Do not override user-input Profit Centre          *
      *  MD046248 - Finastra Rebranding                               *
      *  MD039163 - Unable to insert Cheque to be Collected due to DB *
      *             error 004. Remove DB error process when branch    *
      *             not found in PYCHGDB.                             *
      *  MD037669 - Profit Center for Cheques for collection problem  *
      *  AR920572 - RECI corrupted to Z on cheques for collection     *
      *             files. Moved 'D' to RECI before writing to file   *
      *             to prevent corruption. (Child: AR920573)          *
      *  AR1008672 - Cannot amend settlement and credit value date    *
      *              of authorised Cheque Collection                  *
      *  AR1031132 - Deleted Cheque for collection stuck in           *
      *              Unauthorised Transaction (Child:AR1031134)       *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR804457A - Unable to amend Credit Value Date when debit     *
      *              detail is matured and credit detail is live.     *
      *              (Child: AR804458A)                               *
      *  AR804457 - Allow amend of Credit Value Date on Authorized    *
      *             Transactions. (Child: AR804458)                   *
      *  AR944056 - Cross currency for Cheques for Collections does   *
      *             not convert to the ccy of the debit acct of the   *
      *             customer                                          *
      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
      *             Movements Enquiry is not changing from N to Y     *
      *             (Recompile)                                       *
      *           - Applied for AR944923                              *
      *  AR940742 - Stamp tax does not appear upon input of charges   *
      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
      *  AR853257 - Account Keys for FT were not generated            *
      *             (Recompile)                                       *
      *  AR820566 - Compilation errors during LT build                *
      *  CER049 - Stamp Tax                                           *
      *  CAP205 - Teller Related APIs - Account Balance Check         *
      *  CAP204 - Teller Related APIs - Account Transfer              *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  BUG8992 - Recompile due to changes in FT0070DF               *
      *  159283 - Movement amount of credit account different from    *
      *           the actual credit ccy amount entered. Do not re-    *
      *           compute credit ccy amount to avoid rounding error.  *
      *  CDL049 - Addition of a Reference Rate field                  *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10569 - Book Code selected from Book Details window       *
      *             should be displayed in Cheques for Collection     *
      *  CER001 - LUX Upgrade to MidasPlus                            *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3193 - Set-up parameter before calling AOSPOSU0. Pattern- *
      *            ed from BUG3194.                                   *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  TDA030 - Fix 10-digit full account processing in             *
      *           Collecting bank field.                              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
      *  212014 - Debit Party set to 0000000000 when no RETAIL A/C    *
      *           Numbers used                                        *
      *  CFT009 - Addition of fields for FT fees and charges          *
      *           Recompile                                           *
      *  179732 - Duplicate of 176510                                 *
      *           Incorporation of Profit Centre Default Matrix       *
      *           Improvements. Including fix 171061 - Pass Customer  *
      *           Account Officer To AOPRFMR0 and fix 171062 - Only   *
      *           Default from the matrix when collecting bank        *
      *           has been validated.                                 *
      *           Customer number has also been added to the matrix   *
      *           call.                                               *
      *           Use the Profit Centre defined for the accounts if   *
      *           a Nostro or Retail account                          *
      *  CGL007 - Account Postings Enquiry.                           *
      *  132123 - Prevent the system from accepting blank subtype.    *
      *  148229 - Changes to /COPY FT0010I001 (Recompile only)        *
      *  142243 - Access FT0010 to calculate credit amount and        *
      *           pay delivery amount prior to call to FT0320         *
      *           for charges calculation.                            *
      *  141288 - Move in parameters to screen field even when        *
      *           FT0010 returns an error and highlight correct       *
      *           fields.                                             *
      *  140646 - Change validation of FX/change Commission           *
      *           to account for transition period start date.        *
      *  140647 - Change validation of Pay Delivery Currency          *
      *           to account for transition period start date.        *
      *  CEU006 - EMU FT Payments and Settlement.                     *
      *  112287 - If Rate calculed is LT 1 and rate entered is GT 1   *
      *           or vice versa, do not reverse Mult/Divide ind.      *
      *  125638 - Validation of Central Bank Reference fields needs   *
      *           correcting. If the first field is left blank, the   *
      *           system assumes the number of digits is zero for all *
      *           fields.                                             *
      *  120827 - Profit Centre Accounting defaulting                 *
      *  096486 - Previous Fix (065890).                              *
      *           To enable user to enquire on FT payments for FT     *
      *           postings.                                           *
      *  CAC001 - Profit Centre Accounting Development:               *
      *           If Analytical Accounting is installed and debit/    *
      *           credit currencies are different, an additional win- *
      *           dow will be displayed to enable the input of Margin *
      *           Information for each Credit Party details screen.   *
      *  S01408 - Addition of core hook FT0070CCP1
      *           Addition of core hook FT0070CCP2
      *           Addition of core hook FT0070CCP3
      *           Addition of core hook FT0070CCP4
      *  093958 - Payment input does not check against the payment    *
      *           type sub-type combination table                     *
      * 095270  -  Account movement enquiry does not include Funds    *
      *            Transfer Charges - add processing to output a      *
      *            movement record for FT charges.                    *
      * 084499  -  Access SDRETLPD only if RETAIL switched on.        *
      * 074814  -  Recalculate the charges if tariff has changed      *
      *            and amount has not changed                         *
      *            Fixed during development of S01494                 *
      * 074810  -  After chaining to MUSERDD, check if RECI = 'D'     *
      * S01508  -  BLI Extended Payment Charges                       *
      * S01499  -  BLI VAT Processing.                                *
      *         -  VAT flags should default to the value from FT0005  *
      *            if equal to blank. (TEMP19)                        *
      * S01494  -  BLI Funds Transfer Enhancements.                   *
      *         -  If the customer has changed, use default charges   *
      *            only if amount has not changed. (TEMP07)           *
      * 068347  -  Suppress Account movement duplicates.              *
      * 063918  -  Charges currency incorrectly defaulting to settle  *
      *            ccy on input.                                      *
      * 051022  -  When the screen values are cleared do not move     *
      *            settle ccy into credit ccy - move *blanks instead. *
      * 049860  -  Credit Value Date should not default.              *
      * 059850  -  Calculate PBCQ amount through Credit amount        *
      *            not settle amount. Use AOCCYCV0 to do this.        *
      * 058194  -  Fix window processing for detail screen and        *
      *            add message file                                   *
      * 056823  -  Change processing for cheque credit details :      *
      *            - allow rate to be entered                         *
      *            - either cheque amt OR credit ccy amt to be entered*
      *              and the other to be calculated by the system.    *
      *            - calculation of default rate for base to foreign  *
      *              ccy to use SELL rate not buy.                    *
      * S01408  -  Core hook FT0070CVSF added                         *
      *            Core hook FT0070CSFV added                         *
      *            Core hook FT0070CPG  added                         *
      * 056031  -  Change processing for Shadow Post Update. Call new *
      *            program AOSPOSU0. This now orders the updates in   *
      *            similar way to FX and MM.                          *
      *            Include primary transaction reference              *
      *            Call FT0005 to get FT Control Data                 *
      *            Fix covers errors 041693,045014,031876             *
      * 047179  -  Allows input of a closed account in the charge     *
      *            account field when the value date is greater than  *
      *            the current processing date.                       *
      * 042509  -  If an invalid cheque currency is entered but all   *
      *            other details are correct program will try to find *
      *            number of decimal places in CUDP with blank        *
      *            currency. Check that currency is valid by using    *
      *            indicator 52 as well.                              *
      * 052487  -  FT0070 attempts to update CQCOD before read done.  *
      *            Correct the validation of Cheque Sequence field    *
      *            such that the only valid values are: Blanks Or     *
      *            01 to 50 with no spaces.                           *
      * S01414  -  Book Code and Profit Centre Incorporation.         *
      * 048377  -  Include CL program to check for record locking.    *
      *            (REFER TO ERROR 042167 & 044093)                   *
      * 052310  -  Collecting Bank Validation problem for retail a/c  *
      * 043715  -  Unable to enquire on credits with a higher         *
      *            sequence number than the one that has been deleted.*
      * 037405  -  Include check that the cheque's Credit Party holds *
      *            all numeric digits if a partial account is entered.*
      * 050924  -  Do not lock MMOD for update                        *
      * 035406  -  C A T C H   2 2                                    *
      *            System will not allow amendment/deletion of an     *
      *            unauthorised cheque which was entered prior to     *
      *            today and will not allow COB to run until the      *
      *            unauthorised cheque has been amended/deleted.      *
      * 035398  -  Right align central bank ref field                 *
      * E37067  -  ERRORS IN HOLIDAY PROCESSING                       *
      * E37066  -  CHEQUE AMOUNT CANNOYT BE EQUAL TO ZERO             *
      * E37065  -  VARIOUS ERRORS IN CHARGES DISPLAY/CALCULATION      *
      * S10284  -  DRAFT COVER PROCESSING                             *
      * E32543  -  WARNING MESSAGE DISPLAYED IF DATE IS A HOLIDAY     *
      *            IN LOCAL CURRENCY                                  *
      * E30066  -  HDAF SUBROUTINE CONVERSION OF OEDT WRONG           *
      * E29970  -  CMD 7 PROCESSING FOR SUBFILE ENQUIRY PGMS          *
      * E04167  -  Credit value date is reset to default when in      *
      *            error.                                             *
      * E25169  -  Subroutine CURRY re-written to calculate the BASE  *
      *            CCY EQV of the Credit Amount, rather than act as   *
      *            a random number generator.                         *
      * E32880  -  OUTPUT FULL REF TO RSACMTPD                        *
      * E25172  -  Ignore Rate Override if credit and debit           *
      *            currencies are the same.                           *
      * E25274  -  CALCULATION OF RIGHT HAND CHARGES AMOUNT FOR       *
      *            DEFAULT CHARGES INCORRECT.                         *
      * E25159  -  Divide by zero if override is Y and rate is zero.  *
      *            Database error in file TABLE, key 20       1 at 70 *
      *            when entering second cheque in a sequence after    *
      *            exiting without keying all cheques and then        *
      *            reentering to add more cheque details for the      *
      *            same payment. (Complete E21459)                    *
      *            Complete E25160                                    *
      *            Divide by zero if rate is invalid and override is  *
      *            not Y.                                             *
      * E25160  -  Array index invalid on error 176. Variable not set.*
      * E32533  -  CHARGES NOT CLEARED                                *
      * E32859  -  PAY VALUE DATE NOT BEING REJECTED FOR DATES        *
      *            LESS THAN CURRENT PROCESSING DATE                  *
      * E29890  -  INCORRECT CALCULATION OF CROSS CURRENCY RATES      *
      *            BETWEEN HEADER AND DETAIL CURRENCIES FOR PRONO     *
      *            UPDATES WHEN HEADER IS BASE                        *
      * E29887  -  IF FULL ACCOUNT ENTRY NOT VALID ERROR CODE         *
      *            SHOULD BE 227 NOT 228 WHICH IS REDUNDANT.          *
      * E29884  -  EXTRA PRONO PROCESSING TO TRY UNALLOCATED          *
      *            NOSTRO IF ORIGINAL NOT FOUND                       *
      * E29882  -  INCORRECT SET UP OF DATABASE FIELDS                *
      * E29881  -  INCORRECT ERROR CODE                               *
      * S01195  -  HOLIDAY PROCESSING                                 *
      * S01194  -  REPLACEMENT OF STANDING DATA WITH ACCESS PROGRAMS  *
      * S01117  -  RELEASE 10/MULTIBRANCHING                          *
      * E23603  -  CHEQUE SEQ TOO LARGE BECAUSE FIX FOR E22952 IS     *
      *            ONLY APPROPRIATE FOR INSERTS BUT IS APPLIED        *
      *            REGARDLESS OF ACTION CODE.                         *
      * E21459  -  CHARGES ARE FORMATTED INCORRECTLY.                 *
      * E23540  -  ENQUIRIES WITH A CHEQUE SEQUENCE OF '00' CAUSE THE *
      *            PROGRAM TO CRASH.                                  *
      * E23056  -  CHARGES INPUT ERROR                                *
      * E23290  -  PROGRAM CRASHES WITH DB ERROR WHEN TRYING TO       *
      *            AMEND A CHEQUE FOR COLLECTION (WITH SEQ. NO.)      *
      *            ENTERED.                                           *
      * E22952  -  ON INPUT OF INDIVIDUAL CHEQUES THE SEQUENCE NO.    *
      *            IS NOT DISPLAYED.                                  *
      * E22950  -  VALIDATION ON NOSTROS ONLY CHECKS THE INPUT ON 5   *
      *            CHARS ON A 35 CHAR INPUT.                          *
      * E21597  -  BASE CURRENCY EQUIVALENTS NOT PRODUCED             *
      * S01251  -  SYNON FIELD/PROGRAM NAME CHANGES                   *
      * S01252  -  ADDITIONAL SPARE WINDOW MANAGER PARAMETER          *
      *            BLANK RETURN CODE                                  *
      * S01241 - WINDOW INCORPORATION                                 *
      * S01199 - HELP SYSTEM.                                         *
      *                                                               *
      *                                                               *
      *****************************************************************
      * ID F  C  H  L    FUNCTION OF INDICATORS
      *    01        - INVALID PAY DELIVERY CURRENCY                      CEU006
      *    02        - INVALID NOTIFIED DELIVERY CURRENCY                 CEU006
      *    03        - F3 PRESSED
      *    04        - F10 PRESSED
      *    07        - F7
      *    08        - SWITCHABLE FEATURE S01499 IS SWTICHED ON           S01499
      *    09        - SWITCHABLE FEATURE S01494 IS SWITCHED ON           S01494
      *    12        - F12 PRESSED
      *****13******* - DESCRIPTION SCREEN FIELDS NOT VALID                CEU006
      *    13        - INVALID PAY DELIVERY AMOUNT                        CEU006
      *    14        - F10 ENABLED
      *    15        - USED IN LOOK-UP OF'?'                              S01194
      *    16        - REDISPLAY SCREEN IF '?' HAS BEEN USED              S01194
      *    17        - CHEQUE DETAIL SCREEN                               S01494
      *    18        - USER NOT FOUND                                     S01494
      *    19        - WARNING MESSAGE DATE IS A HOLIDAY                  E32543
      *    20        - MULTI-BRANCHED                                     S01117
      *    21        - ORIGINATING BRANCH USED                            S01117
      *    22        - FIRST TIME THROUGH FOR WARNING ERROR 19            E32543
      *    23        - CREDIT VALUE DATE IS A HOLIDAY                     E32543
      *    24        - F21 IS PRESSED FROM THE ENQUIRY SCREEN             S01494
      *****25******* - RETURN TO HEADER SCREEN FROM CHEQUE DETAIL         CEU006
      *    25        - EMU FEATURE (CEU006) SWITCHED ON                   CEU006
      *    26        - SETTLE VALUE DATE IS A HOLIDAY                     E32543
      *    27        - WARNING MESSAGE DISPLAY INDICATOR                  E32543
      *    28        - PROTECT ORIG BRANCH IF RETURN FROM DETAIL SCN      S01117
      *    29        - COLLECTING BANK SCREEN FIELDS NOT VALID
      *    70        - F7 ENABLED
      *****30******* - DEALING MODULE PRESENT                             058194
      *****31******* - RETAIL MODULE PRESENT                              058194
      *    30        - Used by message subfile                            058194
      *    31        - Putovr and Overlay on message subfile              058194
      *****32******* - WARNING ERROR FOR CREDIT CCY AMT            S10284 056823
      *    32        - FX/CHANGE COMMISSION INVALID                       S01494
      *    33        - CREDIT CURRENCY AMOUNT INVALID                     S10284
      *    34        - WARNING ERROR                                      S10284
      *    36        - V.A.T. AMOUNT INVALID                              S01499
      *    37        - BOOKING BRANCH INVALID                             S01117
      *    38        - ORIGINATING BRANCH INVALID                         S01117
      *****39********- INDICATOR FOR PRONO/MEMO ACCOUNT MOVS ENQUIRY      056031
      *    40        - ACTION CODE INVALID
      *    41        - PAYMENT REFERENCE INVALID
      *    42        - CHEQUE SEQUENCE INVALID
      *    43        - PAYMENT TYPE INVALID
      *    44        - PAYMENT SUB-TYPE INVALID
      *    45        - COLLECTING BANK INVALID
      *    46        - RECEIVERS CORRESPONDENT INVALID
      *    47        - SETTLE CURRENCY INVALID
      *    48        - SETTLE VALUE DATE INVALID
      *    49        - TOTAL CHEQUE AMOUNT INVALID
      *    50        - CREDIT PARTY INVALID
      *    51        - CHEQUE AMOUNT INVALID
      *    52        - CREDIT CURRENCY INVALID
      *    53        - CREDIT VALUE DATE INVALID
      *    54        - RATE INVALID
      *    55        - OVERRIDE INDICATOR INVALID
      *    56        - TRANSFER COMMISION TARIFF INVALID
      *    57        - TRANSFER COMMISION CHARGE INVALID
      *    58        - TELEX CHARGE INVALID
      *    59        - COSTS ABROAD INVALID
      *    60        - COLLECTION CHARGE INVALID
      *    61        - CHARGES TO THE DEBIT OF A/C INVALID
      *    62        - CENTRAL BANK REFERENCE INVALID
      *    63        - CENTRAL BANK REFERENCE 2 INVALID
      *    64        - CENTRAL BANK REFERENCE 3 INVALID
      *    65        - CENTRAL BANK REFERENCE 4 INVALID
      *    66        - CENTRAL BANK REFERENCE 5 INVALID
      *    67        - RECORD UPDATED BY ANOTHER WORKSTATION
      *****68********- ACCOUNT NUMBER NOT A NOSTRO                        056031
      *    68        - Analytical Accounting is on, F19 enabled           CAC001
      *    69        - PROTECT HEADER CURRENCY ON AN AMEND
      *    71        - DETAIL SCREEN
      *    72        - ENQUIRY / DELETE SCREEN
      *    73        - AMEND SCREEN
      *    74        - LOOP CONTROL INDICATOR                             043715
      *    75        - WORK
      *****76********-*WORK********************************************                     AR804457
      *    76        - Credit Value Date                                                    AR804457
      *    78        - DIFFERENCE *NE ZERO SO REVERSE IMAGE
      *****79********-*WORK****************************************052487 CAC001
      *    79        - Call window program manager                        CAC001
      *    80        - WORK
      *    81        - REC. CORRES. IS NOT 2 OR 10 CHARACTERS
      *    82        - RECEIVERS CORRESPONDENT IS A NOSTRO
      *    83        - Book Code field     - error/reverse image          S01414
      *    84        - Profit Centre field - non display/protect          S01414
      *    85        -   "       "     "   - allow input                  S01414
      *    86        -   "       "     "   - error/reverse image          S01414
      *    87        - DELETE SCREEN WITHOUT F10 - FORCE REOUTPUT
      *              - OF SCREEN WITHOUT ERROR CODES
      *****88********- UPDATE OF PROJECTED NOSTROS FILE REQUIRED          CEU006
      *    88        - INVALID NOTIFIED DELIVERY AMOUNT                   CEU006
      *    89        - ERROR ON SCREEN - RI ERROR CODES
      *    91-99     - RESERVED FOR STANDARD ROUTINES
      *****************************************************************
     FFT0070DFCF  E                    WORKSTN
     FCQCOD   UF  E           K        DISK                      A
     F                                              KCOMIT
     FCQCODZZ UF  E                    DISK
     F                                              KCOMIT
     FCQCOCZZ UF  E                    DISK
     F                                              KCOMIT
     FFDDTSTL1IF  E           K        DISK                               093958
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*OLPOS***UF**E           K        DISK                              056031
     F************OLPOSHHF                          KIGNORE               056031
     F************OLPOSOBF                          KIGNORE               056031
     F************                                  KCOMIT                056031
     F*PRONO***UF**E           K        DISK                              056031
     F************PRONOHHF                          KIGNORE               056031
     F************                                  KCOMIT                056031
     F*MEMOS***UF**E                    DISK                              056031
     F************                                  KCOMIT                056031
     FACCNT   IF  E           K        DISK
     F            ACCNTAAF                          KIGNORE
     F            ACCNTACF                          KIGNORE
     FACNUMA  IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACNUMABF
     F*CLINT***IF**E           K        DISK                              S01194
     F************CLINTCAF                          KIGNORE               S01194
     F************CLINTCCF                          KIGNORE               S01194
     F************CLINTC1F                          KIGNORE               S01194
     F*SNAME***IF**E           K        DISK                              S01194
     F************CLINTCBF                          KRENAMESNAMECBF       S01194
     F*TABFP***IF**E           K        DISK                              S01194
     F************TABLETPF                          KIGNORE               S01194
     F************TABLETHF                          KIGNORE               S01194
      *                                                                   S01117
     F*PYCHGDD*IF**E                    DISK                              S01117
     FPYCHGDB IF  E           K        DISK                               S01117
      *                                                                   S01194
     F*FPRTN***IF**E           K        DISK                              S01194
     F************TABLETLF                          KRENAMEFPRTNF         S01194
      *
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     F*RSACMTPDO***E                    DISK         KCOMIT               056031
      *                                                                   S01194
     F*SDMMODPDIF**E                    DISK                       S01241 S01194
     FMUSER   IF  E           K        DISK                               S01494
      *                                                                                       CSD015
      ** Compliance Watch Hit List by Function Type, Identifier, Branch                       CSD015
     FSDCWHTL1IF  E           K        DISK                                                   CSD015
      *                                                                                       CSD015
      ** Cheques to be collected credit details                                               CSD015
     FCQCOCDL1IF  E           K        DISK                                                   CSD015
     F            CQCOCDDF                          KRENAMECQCOCWF                            CSD015
     FCQCOCQL0UF  E           K        DISK                                                   CER049
      ** Stamp Tax Transaction Control Records                                                CER049
     F                                              KCOMIT                                    CER049
     FSDSTMDL0UF  E           K        DISK                      A                            CER049
      ** Stamp Tax Transaction History File                                                   CER049
     F                                              KCOMIT                                    CER049
     F/COPY WNCPYSRC,FT0070F001
      *                                                                                      CDL049
     FSDRRATPDIF  E                    DISK                                                  CDL049
      * Reference Rate Tolerance File                                                        CDL049
      *                                                                                      CDL049
     E                    CPY@    1   1 80
     E/EJECT
     E                    CCYA      150  3  A            * CURRENCY CODES
     E                    CDPA      150  1 0             * CCY DEC. PLACES
     E                    SPTA      150 13 8             * SPOT RATE
     E                    MDA       150  1 0             * MUL/DIV IND.
     E                    ZA1        16  1               ZALIGN SR. ARRAY
     E                    ZA2        16  1               ZALIGN SR. ARRAY
     E                    ERCD       38  4               ERROR CODE OUTPUT
     E                    WA1        15  1               UNEDITED VALUE
     E                    WA2        16  1               EDITED VALUE
     E                    YA3        10  1               REC CORRES ARR
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     E************        PDT         5  5 0A            PRONO DATES      056031
     E************        PNV         5 15 0A            PRONO BALANCES   056031
     E************        PNO         5 15 0A            PRONO BALS(OLD)  056031
     E************        OLD        16  5 0A            OLPOS DATES      056031
     E************        OIN        16 15 0A            OLPOS INCOMING   056031
     E************        OUT        16 15 0A            OLPOS OUTGOING   056031
      *                                                                   056031
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    POWER   1   7  7 3             POWERS TABLE
     E                    POWERS  1   6  7 0             POWERS TABLE
     E                    HCC        25  3               HOLIDAY ARRAY
     E******************* @@      1   4  4 0                       S01284 056823
     E                    C11        11  1                                035398
      *  Error texts                                                      056031
      *                                                                   056031
     E                    ERR@    1   1 80                                056031
      *                                                                   056031
      *  Subroutine stack                                                 056031
      *                                                                   056031
     E                    @STK       20 10                                056031
      *                                                                   058194
      *  Warning check array                                              058194
      *                                                                   058194
     E                    WRN@       40  1                                058194
     E/COPY WNCPYSRC,FTH00229
      *
      ** SAVED VALUE OF OUTPUT DISPLAY CHARGE AMOUNTS(LEFT SIDE)
     E********************SCHG        4 12                                S01494
     E                    SCHG        5 12                                S01494
     E*
     E**********          FLDQ       10  1               FOR TEST FOR ?   S01194              CGL029
     E                    FLDQ       18  1                                                    CGL029
     E*
      ** Arrays used for Midas Compliance Watch                                               CSD015
      ** XML Opening Tags for the Compliance Engine                                           CSD015
     E                    XOT     1   4 27                                                    CSD015
      *                                                                                       CSD015
      ** XML Closing Tags for the Compliance Engine                                           CSD015
     E                    XCT     1   4 28                                                    CSD015
      *                                                                                       CSD015
     E/COPY WNCPYSRC,FT0070E001
      /COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E**********************************************************
      /EJECT
     I*
     I** RENAME CQC FILES LCD TO AVOID CORRUPTION OF DATA
     I**             ALSO BRCA (BOOKING BRANCH)                           S01117
     I*
     ICQCOCDDF
     I              LCD                             CQLCD
     I              BRCA                            BKGBR                 S01117
     I*                                                                   S01414
     I* Rename of CqcoDdd (Header) Book Code & Profit Centre to avoid     S01414
     I* overwriting from CqcoCdd.                                         S01414
     I*                                                                   S01414
     ICQCODDDF
     I              LCD                             CQLCD
     I              BRCA                            BKGBR                 S01117
     I              BOKC                            HBOKC                 S01414
     I              PRFC                            HPRFC                 S01414
     I*                                                                   S01414
     I* Rename of ACCNT/ACNUMA Profit Centre to avoid overwriting         S01414
     I*                                                                   S01414
     IACCNTABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01414
     IACNUMABF                                                            S01414
     I              PRFC                            ACPRFC                S01414
     I*                                                                   S01494
     I** RENAME FIELDS TO PREVENT OVERLAPPING                             S01494
     I*                                                                   S01494
     IMUSERDDF                                                            S01494
     I              RECI                            MRECI                 S01494
     I              DPPT                            MDPPT                 S01494
     I              DBRN                            MDBRN                 S01494
     I              LCD                             MLCD                  S01494
     I              CHTP                            MCHTP                 S01494
     I*                                                                   S01414
      ** Rename of CQCOCDD Details to avoid overwriting                                       CSD015
      *                                                                                       CSD015
     ICQCOCWF                                                                                 CSD015
     I              RECI                            WCRECI                                    CSD015
     I              PREF                            WCPREF                                    CSD015
     I              CQSQ                            WCCQSQ                                    CSD015
     I              CRPT                            WCCRPT                                    CSD015
     I              CRPY                            WCCRPY                                    CSD015
     I              CQAM                            WCCQAM                                    CSD015
     I              CQAMD                           WCCAMD                                    CSD015
     I              CRCY                            WCCRCY                                    CSD015
     I              RATE                            WCRATE                                    CSD015
     I              OVRD                            WCOVRD                                    CSD015
     I              CRVD                            WCCRVD                                    CSD015
     I              CRVDD1                          WCCDD1                                    CSD015
     I              CRVDD2                          WCCDD2                                    CSD015
     I              CRVDD3                          WCCDD3                                    CSD015
     I              NAR1                            WCNAR1                                    CSD015
     I              NAR2                            WCNAR2                                    CSD015
     I              NAR3                            WCNAR3                                    CSD015
     I              NAR4                            WCNAR4                                    CSD015
     I              NAR5                            WCNAR5                                    CSD015
     I              NAR6                            WCNAR6                                    CSD015
     I              DNBC1                           WCDNB1                                    CSD015
     I              DNBC2                           WCDNB2                                    CSD015
     I              DNBC3                           WCDNB3                                    CSD015
     I              DNBC4                           WCDNB4                                    CSD015
     I              DNBC5                           WCDNB5                                    CSD015
     I              TRCT                            WCTRCT                                    CSD015
     I              TRCM                            WCTRCM                                    CSD015
     I              TRCMD                           WCTCMD                                    CSD015
     I              COLL                            WCCOLL                                    CSD015
     I              COLLD                           WCCOLD                                    CSD015
     I              CSTA                            WCCSTA                                    CSD015
     I              CSTAD                           WCCSTD                                    CSD015
     I              TXCH                            WCTXCH                                    CSD015
     I              TXCHD                           WCTXCD                                    CSD015
     I              CDRT                            WCCDRT                                    CSD015
     I              CDRO                            WCCDRO                                    CSD015
     I              LCHT                            WCLCHT                                    CSD015
     I              LCD                             WCLCD                                     CSD015
     I              CHTP                            WCCHTP                                    CSD015
     I              OEDT                            WCOEDT                                    CSD015
     I              OEDTD1                          WCOED1                                    CSD015
     I              OEDTD2                          WCOED2                                    CSD015
     I              OEDTD3                          WCOED3                                    CSD015
     I              IACG                            WCIACG                                    CSD015
     I              CRAG                            WCCRAG                                    CSD015
     I              SACG                            WCSACG                                    CSD015
     I              CRMG                            WCCRMG                                    CSD015
     I              ADIN                            WCADIN                                    CSD015
     I              MDIN                            WCMDIN                                    CSD015
     I              PBCQ                            WCPBCQ                                    CSD015
     I              INUSR1                          WCIUS1                                    CSD015
     I              INUSR2                          WCIUS2                                    CSD015
     I              DUMA1                           WCDUM1                                    CSD015
     I              DUMA2                           WCDUM2                                    CSD015
     I              DUMA3                           WCDUM3                                    CSD015
     I              DUMA4                           WCDUM4                                    CSD015
     I              BRCA                            WCBRCA                                    CSD015
     I              ORBR                            WCORBR                                    CSD015
     I              CRBR                            WCCRBR                                    CSD015
     I              CDBR                            WCCDBR                                    CSD015
     I              CCYAM                           WCYAMT                                    CSD015
     I              BOKC                            WCBOKC                                    CSD015
     I              PRFC                            WCPRFC                                    CSD015
     I              CCVAT1                          WCCVA1                                    CSD015
     I              CCVAT2                          WCCVA2                                    CSD015
     I              CCVAT3                          WCCVA3                                    CSD015
     I              CCVAT4                          WCCVA4                                    CSD015
     I              CCVAT5                          WCCVA5                                    CSD015
     I              CCCHCM                          WCCCHM                                    CSD015
     I              CCDUM5                          WCCDU5                                    CSD015
     I              CCDUM6                          WCCDU6                                    CSD015
     I              CCVATR                          WCCCVR                                    CSD015
     I              FXMP                            WCFXMP                                    CSD015
     I              FXMD                            WCFXMD                                    CSD015
     I              MBSI                            WCMBSI                                    CSD015
     I              MSIG                            WCMSIG                                    CSD015
     I              MAMT                            WCMAMT                                    CSD015
     I              PDCY                            WCPDCY                                    CSD015
     I              PDAM                            WCPDAM                                    CSD015
     I              FXSPDS                          WCFXSP                                    CSD015
     I              TRCMCC                          WCTRMC                                    CSD015
     I              FXCCCC                          WCFXCC                                    CSD015
     I              COCHCD                          WCCOCH                                    CSD015
     I              CABCCD                          WCCABC                                    CSD015
     I              TLXCHD                          WCTLCH                                    CSD015
     I              CCCHRT                          WCCCCR                                    CSD015
     I              CCCHGC                          WCCCCG                                    CSD015
      *                                                                                       CSD015
     I*     DATA AREA DATA STRUCTURE FOR HANDLING DB ERRORS
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     I*PRONOPNF***                                                        056031
     I***           ZZ0078                          ZZZZ78
      /COPY ZSRSRC,ZSEDITZ2
      /EJECT                                                              CEU006
      *                                                                   CEU006
     I/COPY FTCPYSRC,FT0010I001                                           CEU006
      *                                                                   CEU006
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I***
     I******DATA*STRUCTURE*TO*SUB*DIVIDE*TABLE*KEY*FIELD*-*TABTG20*****   S01194
     I************                                                        S01194
     I************DS                                                      S01194
     I************                            1  12 KEY                   S01194
     I************                            1   2 RECTTB                S01194
     I************                            9  11 CCYTB                 S01194
     I************                           12  12 SRECTB                S01194
     I*
     I*     DATA AREA DATA STRUCTURE FOR HANDLING DB ERRORS
     I*
     IDLDA        DS                            256
     I************                          134 138 DBFILE                S01194
     I************                          139 167 DBKEY                 S01194
     I************                          168 175 DBPGM                 S01194
     I************                          176 1770DBASE                 S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I/COPY WNCPYSRC,FT0070I003
     I*
     I*     DATA AREA FOR ORDINARY PAYMENT REF NUMBERING
     I*
     ICQCOLD      DS                              4
     I                                        1   40SEQNO
     I*
     I*     DATA AREA FOR MODULE INDICATORS
     I*
     IMMOD        DS                            256
     I                                        2   2 DLIND
     I                                        3   3 RTIND
     I                                       16  16 REIND
     I*                                                                   S01494
     I** DEFINE FIELDS FOR MESSAGE TRANSLATION                            S01494
     I*                                                                   S01494
     IDSMTR       DS                                                      S01494
     I                                        1 132 #MSDTA                S01494
     I                                       15  30 #MPREF                S01494
     I                                    P   1   20#MPART                S01494
     I                                      133 264 #MSTX1                S01494
     I#MSTX2      DS                                                      S01494
     I                                        1 256 #MSTXA                S01494
     I                                      257 512 #MSTXB                S01494
     I*                                                                   S01499
     I** V.A.T. rate                                                      S01499
     I*                                                                   S01499
     IVATDS       DS                                                      S01499
     I                                        1   3 I#BRCA                S01499
     I                                        4   9 I#CUST                S01499
     I                                    P  10  124O#VATR                S01499
     I*
     I*     DATA AREA TO REDEFINE IPREF FOR INSERTS
     I*
     IIPREF       DS
     I                                        1   1 P
     I                                        2   70PREFDT
     I                                        8  110SQNO
     I                                       12  13 PAYTP
     I                                       14  15 PYSET
     I            DS
     I                                        1   3 SECCY
     I                                        1   3 SECCY1
     I                                        1   3 SECCY2
     I                                        1   3 SECCY3
     I                                        1   3 SECCY4
     I                                        1   3 SECCY5                S01494
     I                                        1   3 SECCY6                S01499
     I            DS
     I                                        1   3 SFCCY
     I                                        1   3 SCCCY1
     I                                        1   3 SCCCY2
     I                                        1   3 SCCCY3
     I                                        1   3 SCCCY4
     I                                        1   3 SCCCY5                S01494
     I                                        1   3 SCCCY6                S01499
     I*
     I*
     I*     DATA AREA FOR PROGRAM STATUS DATA AREA
     I*
     IPSDS       SDS
     I                                        1  10 ##PGM                 058194
     I                                      244 253 WID
     I                                      254 263 USRID
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     I************                                                        056031
     I****DATA*STRUCTURE FOR MEMOS RECORD                                 056031
     I**********************************                                  056031
     I************DS                                                      056031
     I************                            1  150LDBLN                 056031
     I************                            1  150MMLDBL                056031
     I************                           16  300CLBLN                 056031
     I************                           16  300MMCLBL                056031
     I************                        P  37  390MMTNLU                056031
     I*
     I*     DATA AREA TO REDEFINES FIELDS
     I*
     I            DS
     I                                        1 152 ERCD
     I                                        1  76 ERRS1
     I                                       77 152 ERRS2
     I*
     I*     DATA STRUCTURES FOR REDEFINITION OF TABLES
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     I**OLPOS*DATES                                                       056031
     I************DS                                                      056031
     I************                            1  48 ODT                   056031
     I************                        P   1  48 OLD                   056031
     I**OLPOS*INCOMING                                                    056031
     I************DS                                                      056031
     I************                            1 128 OFI                   056031
     I************                        P   1 128 OIN                   056031
     I**OLPOS*OUTGOING                                                    056031
     I************DS                                                      056031
     I************                            1 128 OFO                   056031
     I************                        P   1 128 OUT                   056031
     I**PRONO*DATES                                                       056031
     I************DS                                                      056031
     I************                            1  15 PND                   056031
     I************                        P   1  15 PDT                   056031
     I**PRONO*BALANCE                                                     056031
     I************DS                                                      056031
     I************                            1  40 PNB                   056031
     I************                        P   1  40 PNV                   056031
     I*
     I*     DATA STRUCTURE REDEFINING DATE / TIME FIELDS
     I*
     I            DS
     I                                        1   60LCHT
     I                                        7  110CQLCD
     I                                        1  110DTIME
     I*
     I**    DATA STRUCTURES TO DEFINE DAF DATE FIELDS
     I*
     I            DS
     I                                        1   6 DAFDT1
     I                                        1   2 D1
     I                                        3   4 D2
     I                                        5   6 D3
     I            DS
     I                                        1   2 YR
     I                                        3   4 MO
     I                                        5   6 DA
     I                                        1   6 ODAF3
     I*                                                                   S01117
     I**    DATA STRUCTURE TO SPLIT CREDIT PARTY IF PARTIAL ACCNT         S01117
     I*                                                                   S01117
     I            DS                                                      S01117
     I**********                              1  180CRPY                               CGL029 CSD027
     I                                        1  18 CRPY                                      CSD027
     I**********                              1   60CRPC                              CGL029 CSD027A
     I                                        1   6 CRPC                                     CSD027A
     I                                        7  160CRPA                                      CGL029
     I                                       17  180CRPS                                      CGL029
     I**********                              1  120CRPY                               S01117 CGL029
     I**********                              1   60CRPC                               S01117 CGL029
     I**********                              7  100CRPA                               S01117 CGL029
     I**********                             11  120CRPS                               S01117 CGL029
     I*                                                                   S01117
     I**    DATA STRUCTURE TO SPLIT OLD CREDIT PARTY IF PARTIAL ACCNT     S01117
     I*                                                                   S01117
     I            DS                                                      S01117
     I**********                              1  180OCRPY                              CGL029 CSD027
     I                                        1  18 OCRPY                                     CSD027
     I**********                              1   60OCRPC                             CGL029 CSD027A
     I                                        1   6 OCRPC                                    CSD027A
     I                                        7  160OCRPA                                     CGL029
     I                                       17  180OCRPS                                     CGL029
     I**********                              1  120OCRPY                              S01117 CGL029
     I**********                              1   60OCRPC                              S01117 CGL029
     I**********                              7  100OCRPA                              S01117 CGL029
     I**********                             11  120OCRPS                              S01117 CGL029
     I*                                                                   S01117
     I*
     I*     DATA STRUCTURE FOR CHEQUE KEY FIELDS
     I*
     ICQCHN       DS
     I                                        1  15 PREFK
     I                                       16  170CQSQK
     I*
     I*     DATA STRUCTURE FOR ACCOUNT KEY FIELDS
     I*
     I************DS                                                      S01117
     IACCKY       DS                                                      S01117
     I**********                              1   60CNUMK                                     CSD027
     I                                        1   6 CNUMK                                     CSD027
     I                                        1   6 CNUMKA                S01194
     I                                        7   9 CCYK
     I                                       10  190ACODK                                     CGL029
     I                                       10  19 ACODKA                                    CGL029
     I                                       20  210ACSQK                                     CGL029
     I                                       20  21 ACSQKA                                    CGL029
     I                                       22  24 BRCAK                                     CGL029
     I**********                             10  130ACODK                                     CGL029
     I**********                             10  13 ACODKA                             S01194 CGL029
     I**********                             14  150ACSQK                                     CGL029
     I**********                             14  15 ACSQKA                             S01194 CGL029
     I**********                             16  18 BRCAK                              S01117 CGL029
     I************                            1  15 ACCKY                 S01117
     I            DS
     I* DS TO SET UP ERROR MESSAGE FOR CHAIN FAIL
     I*
     I                                        1  32 ERRMSG
     I                                        1   8 ERMSG1
     I                                        9  16 ERMSG2
     I                                       17  24 ERMSG3
     I                                       25  32 ERMSG4
     I*
     I**    DATA STRUCTURE FOR HEADER COMMITMENT TEXT
     I*
     IHEADR       DS
     I                                        1   50TIMEXH
     I                                        6   7 MOD1
     I                                        8  15 PROG1
     I                                       16  18 WID1
     I                                       19  240TIMEH
     I                                       25  25 ACTDH
     I                                       26  35 USRID1
     I*
     I                                       51  51 SACTD
     I                                       52  66 SPREF
     I                                       67  68 SCQSQ
     I                                       69  70 SPYTP
     I                                       71  72 SPYST
     I                                       73 107 SCBK1
     I                                       78 107 SCBNF                 S01117
     I**             DEFINE BRANCH FOR WHEN COLLECTING BANK IS FULL A/C   S01117
     I**********                             88  90 SCBBR                              S01117 TDA030
     I**********                             91 107 SCBMB                              S01117 TDA030
     I**********                             88 107 SCBNM                              S01117 TDA030
     I                                       94  96 SCBBR                                     TDA030
     I                                       97 107 SCBMB                                     TDA030
     I                                       94 107 SCBNM                                     TDA030
     I                                      108 142 SCBK2
     I                                      143 177 SCBK3
     I                                      178 212 SCBK4
     I                                      213 222 SRCCO
     I                                      223 225 SSMCY
     I                                      226 231 SPYVD
     I                                      232 245 STCQA
     I                                      246 259 STCRE
     I                                      260 273 SDIFF
     I                                      274 275 SHBOKC                S01414
     I                                      276 279 SHPRFC                S01414
     I                                      280 282 SNDCY                 CEU006
     I                                      283 296 SNDAM                 CEU006
     I*
     I**    DATA STRUCTURE FOR DETAIL COMMITMENT TEXT
     I*
     IDETAL       DS
     I                                        1   50TIMEXD
     I                                        6   7 MOD2
     I                                        8  15 PROG2
     I                                       16  18 WID2
     I                                       19  240TIMED
     I                                       25  25 ACTDD
     I                                       26  35 USRID2
     I*
     I**********                             51  62 SCRPA                                     CGL029
     I**********                             62  62 SCRPP                              S01117 CGL029
     I                                       63  76 SCQAM
     I                                       77  79 SCRCY
     I                                       80  85 SCVDA
     I                                       86  99 SRATE
     I                                      100 100 SOVER
     I                                      101 135 SDES1
     I                                      136 170 SDES2
     I                                      171 205 SDES3
     I                                      206 240 SDES4
     I                                      241 275 SDES5
     I                                      276 310 SDES6
     I                                      311 311 STCTF
     I**********                            360 371 SCHDB                                     CGL029
     I**********                            371 371 SCHDBP                             S01117 CGL029
     I                                      372 382 SDBC1
     I                                      383 393 SDBC2
     I                                      394 404 SDBC3
     I                                      405 415 SDBC4
     I                                      416 426 SDBC5
     I                                      427 440 SCCYAM                S10284
     I                                      441 442 SBOKC                 S01414
     I                                      443 446 SPRFC                 S01414
     I                                       51 275 PART1                 S10284
     I**************************************276 440 PART2           S10284S01414
     I                                      276 446 PART2                 S01414
     I                                      447 449 SPDCY                 CEU006
     I                                      450 463 SPDAM                 CEU006
     I                                      464 481 SCRPA                                     CGL029
     I                                      481 481 SCRPP                                     CGL029
     I                                      482 499 SCHDB                                     CGL029
     I                                      499 499 SCHDBP                                    CGL029
     I*
     I*     DATA AREA TO REDEFINE RETAIL NOSTRO FIELD
     I*
     IRTNO        DS
     I**********                              1   60CNUMN                                    CSD027A
     I                                        1   6 CNUMN                                    CSD027A
     I                                        7  160ACODNP                                    CGL029
     I                                       17  180ACSQNP                                    CGL029
     I                                       19  21 BRCANP                                    CGL029
     I                                        1  100ACNON
     I                                        7   9 CCYN
     I                                       10  190ACODN                                     CGL029
     I                                       20  210ACSQN                                     CGL029
     I                                       22  24 BRCAN                                     CGL029
     I**********                              7  100ACODNP                                    CGL029
     I**********                             11  120ACSQNP                                    CGL029
     I**********                             13  15 BRCANP                             S01117 CGL029
     I**********                             10  130ACODN                                     CGL029
     I**********                             14  150ACSQN                                     CGL029
     I**********                             16  18 BRCAN                              S01117 CGL029
     IFNOS        DS
     I                                        1   3 PRCYK
     I                                        4   50NOSK
      *
      ****Data*structure*to*redefine*%*as*rate.****                       S01194
     I************DS                                                      S01194
     I************                        P   1   32PRTDIS                S01194
     I************                        P   1   34RATDIS                S01194
     I/EJECT
     I*
     I*     DATA STRUCTURE REDEFINING ADDRESS  FIELDS
     I*
     I            DS
     I                                        1 210 ADDRSS
     I                                        1  35 ADCHK1
     I                                       36  70 ADCHK2
     I                                       71 105 ADCHK3
     I                                      106 140 ADCHK4
     I                                      141 175 ADCHK5
     I                                      176 210 ADCHK6
      *                                                                   056031
      *  Send message data structure                                      056031
      *                                                                   056031
     IDBDTA       DS                                                      056031
     I                                        1  10 @BPGM                 056031
     I                                       11  20 @BFILE                056031
     I                                       21  50 @BKEY                 056031
     I                                       51  550@BERNB                056031
     I                                       56 135 @BNARR                056031
     I                                      136 145 @BSTK                 056031
     I                                      146 175 @BPREF                056031
      *                                                                   056031
      *  Calling parameter data structure for AOSPOSU0                    056031
      *                                                                   056031
     IC#DTA       DS                            256                       056031
     I                                        1   1 C#ATYP                056031
     I**********                              2  19 C#ACCT                             056031 CGL029
     I                                        2  19 QQACCT                                    CGL029
     I**********                              2   70C#CNU1                            056031 CSD027A
     I                                        2   7 C#CNU1                                   CSD027A
     I                                        8  10 C#CCY1                056031
     I**********                             11  140C#ACO1                             056031 CGL029
     I                                       11  140QQACO1                                    CGL029
     I                                       15  160C#ACS1                056031
     I                                       17  19 C#BRC1                056031
     I                                        2   30C#NOSN                056031
     I                                        2   6 C#NOS                 056031
     I                                        2  110C#ACNO                056031
     I**********                              2   70C#CNUM                            056031 CSD027A
     I                                        2   7 C#CNUM                                   CSD027A
     I**********                              8  110C#ACOD                             056031 CGL029
     I                                        8  110QQACOD                                    CGL029
     I                                       12  130C#ACSQ                056031
     I                                       14  16 C#BRCA                056031
     I                                       24  24 C#IO                  056031
     I                                       25  27 C#CCY                 056031
     I                                       28  29 C#TRYP                056031
     I                                       30  59 C#NARR                056031
     I                                       60  670C#CHQN                056031
     I                                       68  82 C#PREF                056031
     I                                       83  88 C#TRN                 056031
     I                                    P  89  960C#AMT                 056031
     I                                       97  97 C#PRON                056031
     I                                       98  98 C#OLPS                056031
     I                                       99  99 C#MEMS                056031
     I                                      100 100 C#RSAC                056031
     I                                      101 102 C#MOD                 056031
     I                                      103 104 C#OLRC                056031
     I                                      105 105 C#FTOV                056031
     I                                    P 106 1080C#VDAT                056031
     I                                    P 109 1110C#PSTD                056031
     I                                      112 112 C#PSTO                056031
     I                                      113 113 C#RPST                068347
     I                                      114 1160C#RPNB                068347
     I                                      117 117 C#RTYP                068347
     I                                      121 1300C#ACO1                                    CGL029
     I                                      131 1400C#ACOD                                    CGL029
     I                                      141 160 C#OTR1                                    CAP204
     I                                      161 161 C#MTYP                                    CAP205
      *                                                                                       CLE134
      ** Exception Reference Id/Number                                                        CLE134
      *                                                                                       CLE134
     I                                      162 164 C#XRFI                                    CLE134
     I                                      165 1740C#XRFN                                    CLE134
      *                                                                                       CGL029
     I            DS                                                                          CGL029
     I                                        1  24 C#ACCT                                    CGL029
     I**********                              1   60W#CNU1                            CGL029 CSD027A
     I                                        1   6 W#CNU1                                   CSD027A
     I                                        7   9 W#CCY1                                    CGL029
     I                                       10  190W#ACO1                                    CGL029
     I                                       20  210W#ACS1                                    CGL029
     I                                       22  24 W#BRC1                                    CGL029
     I/COPY WNCPYSRC,FT0070I006
      *                                                                   056031
      *  Calling parameter data structure for AOCCYCV0                    056031
      *                                                                   056031
     ID#DTA       DS                            256                       056031
      *                                       From Currency & amount      056031
     I                                        1   3 D#FCCY                056031
     I                                    P   4  110D#FAMT                056031
      *                                       To Currency & amount        056031
     I                                       12  14 D#TCCY                056031
     I                                    P  15  220D#TAMT                056031
      *                                       Rate and multi/div ind.     056031
     I                                       23  23 I#MDIN                056031
     I                                    P  24  368I#RATE                056031
      *                            Output     Rate and multi/div ind.     056031
      *                                       If no in rate               056031
     I                                       37  37 O#MDIN                056031
     I                                    P  38  508O#RATE                056031
      *                                                                   056031
      *  Input parameters data structure from FT0005                      056031
      *                                                                   056031
     IC#CNTL      DS                            256                       056031
     I                                        1   1 C#PDTI                056031
     I                                        2   3 C#CCYI                056031
     I                                        4   4 C#GLUI                056031
     I                                        5   5 C#TPCI                056031
     I                                        6   6 C#VATT                S01499
      *                                                                   056031
     I*                                                                   052310
     I* Named Constant used to determine if a field contains numerics     052310
     I*                                                                   052310
     I              '0123456789'          C         DIGITS                052310
     I*
     I** DATA STRUCTURE (DATA AREA) CONTAINING USER'S DEFAULT BRANCH      S01117
     IZMUSER      DS                             17                       S01117
     I                                       11  13 DBRN                  S01117
     I                                       14  16 DPPT                  S01414
     I*                                                                   S01117
     I** DEFINE BRANCH FOR WHEN COLLECTING BANK IS FULL A/C               S01117
     ICOB1        DS                                                      S01117
     I                                       16  18 COBBR                 S01117
     I*                                                                   S01194
     INOSCHN      DS                                                      S01194
     I                                        1   3 NOSCCY                S01194
     I                                        4   5 NOSNUM                S01194
     I*                                                                   S01508
     IW0DTA       DS                            256                       S01508
     I*                                                                   S01508
     I** Calling parameter data structure for FT0035                      S01508
     I*                                                                   S01508
     I                                        1   1 I#PT1                 S01508
     I                                        2  36 I#PTY1                S01508
     I                                       37  37 I#PT2                 S01508
     I                                       38  72 I#PTY2                S01508
     I                                       73  75 I#CCY                 S01508
     I                                       76  81 O#CUST                S01508
     I*                                                                   S01508
     I** Calling parameter data structure for FT0320                      S01508
     I*                                                                   S01508
     I/COPY WNCPYSRC,FT0070I004
     I*W7DATA*****DS                            310                 S01508CEU006
     IW7DATA      DS                            321                       CEU006
     I/COPY WNCPYSRC,FT0070I005
      *                                                                   S01508
      * Payment type and subtype                                          S01508
     I                                        1   2 W7PYTP                S01508
     I                                        3   4 W7PYST                S01508
      *                                                                   S01508
      * Input currency and charge currency                                S01508
     I                                        5   7 W7ICCY                S01508
     I                                        8  10 W7CCCY                S01508
      *                                                                   S01508
      * Settlement method                                                 S01508
     I                                       11  12 W7STMT                S01508
      *                                                                   S01508
      * Defaults required                                                 S01508
     I                                       13  13 W7DFRQ                S01508
      *                                                                   S01508
      * Charges branch                                                    S01508
     I                                       14  16 W7BRCA                S01508
      *                                                                   S01508
      * Charge currency amount                                            S01508
     I                                       17  290W7CAMT                S01508
      *                                                                   S01508
      * Transfer Commission type                                          S01508
     I                                       30  30 W7TRCT                S01508
      *                                                                   S01508
      * SWIFT priority code                                               S01508
     I                                       31  31 W7SWPC                S01508
      *                                                                   S01508
      * Transfer Commission amount                                        S01508
     I                                       32  420W7TRCD                S01508
     I                                       43  530W7TRCH                S01508
      *                                                                   S01508
      * Telex charge                                                      S01508
     I                                       54  640W7TXCD                S01508
     I                                       65  750W7TXCH                S01508
      *                                                                   S01508
      * Cheque Charge                                                     S01508
     I                                       76  860W7CQCD                S01508
     I                                       87  970W7CQCH                S01508
      *                                                                   S01508
      * Costs Abroad                                                      S01508
     I                                       98 1080W7CSTD                S01508
     I                                      109 1190W7CSTA                S01508
      *                                                                   S01508
      * SWIFT Priority Charge                                             S01508
     I                                      120 1300W7SPCD                S01508
     I                                      131 1410W7SPCH                S01508
      *                                                                   S01508
      * Miscellaneous charge                                              S01508
     I                                      142 1520W7MSCD                S01508
     I                                      153 1630W7MSCH                S01508
      *                                                                   S01508
      * Advice Charge                                                     S01508
     I                                      164 1740W7ADCD                S01508
     I                                      175 1850W7ADCH                S01508
      *                                                                   S01508
      * Telephone Charge                                                  S01508
     I                                      186 1960W7TLCD                S01508
     I                                      197 2070W7TLCH                S01508
      *                                                                   S01508
      * Collection Charge                                                 S01508
     I                                      208 2180W7COLD                S01508
     I                                      219 2290W7COLL                S01508
      *                                                                   S01508
      * Payment amount currency                                           S01508
     I                                      230 232 W7PCCY                S01508
     I*                                                                   S01508
     I** Other currency                                                   S01508
     I                                      233 235 W7OCCY                S01508
     I*                                                                   S01508
     I** FX/Change commission (input ccy)                                 S01508
     I                                      236 2460W7CHCD                S01508
     I*                                                                   S01508
     I** FX/Change commission (charge ccy)                                S01508
     I                                      247 2570W7CHCM                S01508
     I*                                                                   S01508
     I** Our deductions (input ccy)                                       S01508
     I                                      258 2680W7DEDD                S01508
     I*                                                                   S01508
     I** Our deductions (charge ccy)                                      S01508
     I                                      269 2790W7DEDS                S01508
     I*                                                                   S01508
     I** Correspondent charge (input ccy)                                 S01508
     I                                      280 2900W7COCD                S01508
     I*                                                                   S01508
     I** Correspondent charge (charge ccy)                                S01508
     I                                      291 3010W7COCH                S01508
     I*                                                                   S01508
     I** Default type (HDR or DET or " ")                                 S01508
     I                                      302 304 W7DFTT                S01508
     I*                                                                   S01508
     I** Customer to be debited the charge                                S01508
     I                                      305 310 W7CUST                S01508
      *                                                                   CEU006
      ** Settle Value Date                                                CEU006
     I                                      311 3150W7SLDT                CEU006
      *                                                                   CEU006
      ** Pay Value Date                                                   CEU006
     I                                      316 3200W7PVDT                CEU006
      *                                                                   CEU006
      ** Add/Deduct Charges (not used in FT0070)                          CEU006
     I                                      321 321 W7ADDC                CEU006
     I/COPY WNCPYSRC,FT0070I001
     I*                                                                   S01194
     I** HOLIDAY PROCESSING DS                                            S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01194
     I** DATA STRUCTURES USED BY ACCESS PROGRAMS                          S01194
     IDSFDY     E DSDSFDY                                                 S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     ISDGELR    E DSSDGELRPD                                              S01194
     ISDFTFR    E DSSDFTFRPD                                              S01194
     I                                       44  484RATDIS                S01194
     ISDRETL    E DSSDRETLPD                                              S01194
     I              QQACCD                          QQACC1                                    CGL029
     ISDCURR    E DSSDCURRPD                                              S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     ISDNOST    E DSSDNOSTPD                                              S01194
     I              QQACCD                          QQACC2                                    CGL029
     I                                       29  31 NLOC                  S01195
     ISDBRCH    E DSSDBRCHPD                                              S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     ISDDLST    E DSSDDLSTPD                                              S01194
     ISDBOOK    E DSSDBOOKPD                                              S01414
     ISDPRFC    E DSSDPRFCPD                                              S01414
     ISCSARD    E DSSCSARDPD                                              S01494
     I* SAR file details                                                  S01494
     I              LCD                             SCLCD                 S01494
     I*
     I/COPY WNCPYSRC,FTH00230
     ISPARE       DS                            256                       CAC001
      **  Define data structure to pass data to WN0010 and return pgm     CAC001
      *                                                                   CAC001
     I                                        1   1 WACTD                 CAC001
     I                                    P   2   88WRATE                 CAC001
     I                                        9   9 WDPSI                 CAC001
     I                                       10  12 WPUCY                 CAC001
     I                                       13  15 WSLCY                 CAC001
     I                                    P  16  220WPUAM                 CAC001
     I                                    P  23  290WSLAM                 CAC001
     I                                       30  300WMDIN                 CAC001
     I                                    P  31  342WFXMP                 CAC001
     I                                       35  350WFXMD                 CAC001
     I                                       36  36 WMBSI                 CAC001
     I                                       37  37 WMSIG                 CAC001
     I                                    P  38  440WMAMT                 CAC001
     I                                       45  45 WFRC                  CAC001
      *                                                                                       CSD015
      ** Watch List Transaction Details (OPM)                                                 CSD015
     ISDWLTO    E DSSDWLTOPD                                                                  CSD015
      *                                                                                       CSD015
      ** Watch List Checking Details                                                          CSD015
     ISDWLCC    E DSSDWLCCPD                                                                  CSD015
      *                                                                                       CSD015
      ** SD data area                                                                         CSD015
     ISDSTAT    E DSSDSTAT                                                                    CSD015
      *                                                                                       CSD015
      ** 24X7 status data area                                                                CSD015
     ISC24X7    E DSSC24X7                                                                    CSD015
      *                                                                                       CSD015
      ** Compliance Watch Configuration Data File                                             CSD015
     ISDCWCD    E DSSDCWCDPD                                                                  CSD015
      *                                                                                       CSD015
      ** DS for 2nd parameter of Compliance Engine                                            CSD015
     IPSTRNG      DS                           9999                                           CSD015
      *                                                                                       CSD015
     I/COPY WNCPYSRC,FT0070I002
     I/COPY QWINDSRC,FT0070DTA                                            S01241
     I                                        1   2 DSCHGT                                  AR820566
     I                                        3   4 DSNTYP                                  AR820566
     I                                        5  19 DSREFE                                  AR820566
     I                                       20  220DSSEQN                                  AR820566
     I                                       23  52 DSNARR                                  AR820566
     I                                      201 210 U#ORGN                                  AR820566
     I**********                            211 2160U#LNRF                           AR820566 CLE148
     I                                      211 216 U#LNRF                                    CLE148
     I                                      217 222 U#FCNM                                  AR820566
     I                                      223 2250U#FACT                                  AR820566
     I                                      226 2270U#FCNO                                  AR820566
     I                                      228 2290U#FSEQ                                  AR820566
     I                                      230 2340U#ORED                                  AR820566
     I                                      235 2400U#DLNO                                  AR820566
     I                                      241 246 U#TDRF                                  AR820566
     I                                      247 249 U#BRCA                                  AR820566
     I                                      250 255 U#CNUM                                  AR820566
     I                                      256 258 U#CCY                                   AR820566
     I                                      259 2680U#ACOD                                  AR820566
     I                                      269 2700U#ACSQ                                  AR820566
     I                                      271 285 U#PREF                                  AR820566
     I                                      286 2870U#CQSQ                                  AR820566
     I                                      315 3190U#VDAT                                  AR820566
     I                                      322 336 U#AMNT                                  AR820566
     I                                      337 339 U#TCCY                                  AR820566
     I                                      340 340 U#STAX                                  AR820566
     I                                      341 344 U#SCRN                                  AR820566
     I                                      356 358 @@CCY                                   AR820566
     I                                      359 359 @@TYP1                                  AR820566
     I                                      360 383 @@ACC1                                  AR820566
     I                                      384 384 @@TYP2                                  AR820566
     I                                      385 401 @@ACC2                                  AR820566
     IPDATA       DS                           1024                                           CER001
      *                                                                                       CER001
     I                                        1  15 PREF                                      CER001
     I                                       16  170#1CQSQ                                    CER001
     I                                       18  18 CRPT                                      CER001
     I                                       19  300CRPY1                                     CER001
     I                                       31  430CQAM                                      CER001
     I                                       44  46 CRCY                                      CER001
     I                                       47  49 CRBR                                      CER001
     I                                     10151024 #1PGM                                     CER001
     I                                       50  52 BKGBR                                     CER001
     C                     MOVE 'CC'      SPYTP
     C                     MOVE 'CC'      PYTP
     C*
     C*  KEY FOR CHAINING TO LF/CQPAC
     C           CQCHNK    KLIST
     C                     KFLD           PREFK  15
     C                     KFLD           CQSQK   20
     C*                                                                   093958
     C*  KEY FOR CHAINING TO LF/SDDTSTL1                                  093958
     C           @DTSTK    KLIST                                          093958
     C                     KFLD           SPYTP                           093958
     C                     KFLD           SPYST                           093958
      *                                                                   058194
      *  Key for reade to LF/CQCOC                                        058194
     C           CQCKEY    KLIST                                          058194
     C                     KFLD           PREFK  15                       058194
     C*
     C***KEY*FOR*CHAINING*TO*LF/CLINT*****                                S01194
     C***********CLKEY*****KLIST                                          S01194
     C*********************KFLD           CNUMK   60                      S01194
     C*********************KFLD           CLINTA  1                       S01194
     C*
     C*  KEY FOR CHAINING TO LF/ACCNT
     C           ACCCHN    KLIST
     C                     KFLD           CNUMK
     C                     KFLD           CCYK
     C                     KFLD           ACODK
     C                     KFLD           ACSQK
     C                     KFLD           BRCAK                           S01117
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************                                                        056031
     C***KEY*FOR*CHAINING TO LF/OLPOS                                     056031
     C***********OLPO      KLIST                                          056031
     C************         KFLD           OLBR    3                 S01117056031
     C************         KFLD           OLCY    3                       056031
     C************         KFLD           OLNOK   20                      056031
     C************                                                        056031
     C***KEY*FOR*CHAINING TO LF/PRONO                                     056031
     C***********PRON      KLIST                                          056031
     C************         KFLD           PRCYK   3                       056031
     C************         KFLD           NOSK                            056031
      *                                                                                       CSD015
      **   Key List for LF/SDCWHTL1                                                           CSD015
      *                                                                                       CSD015
     C           KCWHTL    KLIST                                                              CSD015
     C                     KFLD           KFUNCC  8                                           CSD015
     C                     KFLD           KIDENT 40                                           CSD015
     C                     KFLD           KBRNCH  3                                           CSD015
     C*
     C*
     C**  PERFORM INITIAL PROCESSING
     C*
     C                     EXSR BEGIN
     C*
     C**  DO LOOP UNTIL F3 IS PRESSED
     C*
     C           *IN03     DOUEQ'1'                        B001
     C           *IN12     OREQ '1'
     C           @PREF     ANDNE*BLANK
     C           *IN07     OREQ '1'
     C/COPY WNCPYSRC,FT0070C083
     C           *IN67     IFEQ '0'                        B002
     C                     SETOF                     89
     C*
     C**  IF NO ERRORS CLEAR FIELDS
     C*
     C                     Z-ADD0         S       20
     C                     MOVE *BLANK    ERCD
     C                     MOVE *BLANK    ERRS1
     C                     MOVE *BLANK    ERRS2
     C                     MOVE *BLANK    SCQSQ
     C                     MOVE *BLANK    SSTAT
     C                     Z-ADD0         CQSQ
     C                     SETOF                     404142
     C                     SETOF                     3728                 S01117
      *
     C           @PREF     IFEQ *BLANK
     C                     MOVE *BLANK    SPREF
     C                     MOVE *BLANK    SACTD
     C                     MOVE *BLANK    SBKGBR                          S01117
     C                     END
     C                     END                             E002
     C/COPY WNCPYSRC,FT0070C084
      *
     C           @SORT     IFNE 'E'
     C           *IN67     OREQ '1'
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
      *
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     WRITE#MSGCTL                                   058194
     C/COPY WNCPYSRC,FT0070C085
      *                                                                   058194
     C                     WRITEFT0070F1
      *
     C************IN11*****DOUEQ'0'                        B002           S01199
      *
     C                     READ FT0070F1                 75
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
     C/COPY WNCPYSRC,FT0070C086
      *                                                                   058194
      * Reset message sent flag                                           058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   058194
     C**                                                                  S01199
     C************IN11*****IFEQ '1'                        B003           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E003           S01199
     C*********************END                             E002
      *
     C           *IN12     IFEQ '1'                        B002
     C                     SETOF                     8967
     C                     END                             E002
      *
     C                     END                             E002
     C*
     C**  VALIDATE INITIAL SCREEN
     C*
     C           *IN03     IFEQ '0'                        B002
     C           *IN12     ANDEQ'0'
     C*
     C************IN07*****ANDEQ'0'                                       S01199
      *
     C           *IN07     CASEQ'0'       INVAL            B003           S01199
      *
     C************IN11*****CASEQ'0'       INVAL            B003           S01199
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C                     END                             E001
      *
     C   03                MOVE '1'       @RETC
     C   KL                MOVE '5'       @RETC                           E29970
     C   07                MOVE '7'       @RETC                           E29970
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
      *
     C                     SETON                     LR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. BEGIN - INITIAL PROCESSING
     C*
     C           BEGIN     BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'BEGIN'   @STK,Q                          056031
      *
      ** Set up constant prefix for reference of inserts.
      *
     C                     MOVE 'P'       P
     C*
     C**  SETUP STANDARD FIELDS FOR ERRORS AND COMIT BOUNDARIES
     C*
     C           *NAMVAR   DEFN CQCOLDA   CQCOLD
     C           *NAMVAR   DEFN           MMOD
     C           *NAMVAR   DEFN LDA       DLDA
     C           *NAMVAR   DEFN           ZMUSER                          S01117
      *
     C                     MOVE 'FT'      MOD1
     C                     MOVE 'FT'      MOD2
     C                     MOVELWID       WID1
     C                     MOVELWID       WID2
     C                     MOVE USRID     USRID1
     C                     MOVE USRID     USRID2
     C                     MOVE 'FT0070'  PROG1
     C                     MOVE 'FT0070'  PROG2
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ 10                       058194
     C                     PARM '*SAME'   FTPGRL  5                       058194
      *                                                                   058194
      * Reset message sent flag                                           058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS  1                       058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C*                                                                   S01494
     C** Retrieve the text for FTM2510 using MEC1150                      S01494
     C*                                                                   S01494
     C                     CALL 'MEC1150'              9090               S01494
     C                     PARM 'FTM2510' #MSGID                          S01494
     C                     PARM 'FTUSRMSG'#MSGF                           S01494
     C                     PARM           #MSDTA                          S01494
     C                     PARM *BLANKS   #MSTX1                          S01494
     C                     PARM *BLANKS   #MSTX2                          S01494
     C*                                                                   S01494
     C                     MOVEL#MSTX1    WM2510 25                       S01494
     C*
     C**  SET MODULE ID INDICATORS
     C*
     C                     IN   MMOD                                      050924
     C********** *LOCK     IN   MMOD                                E109  050924
     C**********           OUT  MMOD                                E109  050924
     C***********DLIND     IFEQ 'Y'                        B001           058194
     C***********          SETON                     30                   058194
     C***********          END                             E001           058194
     C***********                                                         058194
     C***********RTIND     IFEQ 'Y'                        B001           058194
     C***********REIND     OREQ 'Y'                                       058194
     C***********          SETON                     31                   058194
     C***********          END                             E001           058194
     C*
     C**  SETUP STANDARD FIELDS FOR PAYMENT REFERENCE
     C*
     C                     MOVE 'CC'      PAYTP
     C                     MOVE '00'      PYSET
     C*
     C****READ*INSTALLATION*CONTROL*DATA*RECORD*1**************           S01194
     C*********************                                               S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'01'      TBCHN                           S01194
     C*********************MOVE '10'      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTB10F             75                   S01194
     C************IN75*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD1         DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 01 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*
     C**  SET DATE SCREEN FIELD FROM SYSTEM RUN DATE                      S01194
     C*                                                                   S01194
     C                     MOVE BJMRDT    SRUNA                           S01194
     C*                                                                   S01194
     C**  SET DATE FORMAT INDICATOR
     C*
     C***********DATF******IFEQ 'M'                        B001           S01194
     C           BJDFIN    IFEQ 'M'                        B001           S01194
     C                     SETON                     98
     C                     END                             E001
     C*
     C****READ*INSTALLATION*CONTROL*DATA*RECORD*2******                   S01194
     C*********************                                               S01194
     C*********************MOVE '11'      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTB11F             75                   S01194
     C************IN75*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD2         DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 02 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C**
     C**   BUILD UP CURRENCIES/DEC. POSITIONS ARRAYS
     C*****FROM*TABTG20***                                                S01194
     C**   FROM SDCURRPD                                                  S01194
     C*********************MOVEL'20    '  KEY                             S01194
     C*********************MOVE '      '  KEY                             S01194
     C                     Z-ADD1         Z       30
     C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C                     PARM *BLANKS   @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCURR     3535  HILO           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C***********KEY*******SETLLTABFP                                     S01194
     C*
     C           *IN35     DOWEQ'0'                        B001
     C*                                                                   S01194
     C*********************READ TABFP                    35               S01194
     C***********RECI******IFEQ 'D'                        B002           S01194
     C***********RECTTB****IFNE '20'                       B003           S01194
     C*********************SETON                         35               S01194
     C*********************ELSE                            X003           S01194
     C*********************                                               S01194
     C***********SRECTB****IFEQ '1'                        B004           S01194
     C*                                                                   S01194
     C*********************MOVE CCYTB     CCYA,Z                          S01194
     C*********************Z-ADDCDP       CDPA,Z                          S01194
     C                     MOVE A6CYCD    CCYA,Z                          S01194
     C                     Z-ADDA6NBDP    CDPA,Z                          S01194
     C                     MOVE MDIN      MDA,Z
     C                     Z-ADDA6SPRT    SPTA,Z                          S01194
     C*********************Z-ADDSPOT      SPTA,Z                          S01194
     C                     ADD  1         Z
     C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*NEXT'   @OPTN   7                       S01194
     C                     PARM *BLANKS   @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCURR     3535  HILO           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           Z         IFGT 150
     C                     SETON                     35
     C                     END
     C*                                                                   S01194
     C                     END                             E001           S01194
     C*                                                                   S01194
     C*********************END                             E004           S01194
     C*********************END                             E003           S01194
     C*********************                                               S01194
     C*********************END                             E002           S01194
     C*********************END                             E001           S01194
     C*
     C****READ*TABLE*FOR*BASE*CURRENCY**                                  S01194
     C*********************                                               S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELBCCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD3         DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 03 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C**  READ SDCURRPD FOR BASE CURRENCY                                 S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM BJCYCD    @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*
     C**  STORE NO. OF DECIMAL PLACES
     C*
     C                     MOVE A6NBDP    BCDP    10                      S01194
     C*********************MOVE CDP       BCDP    10                      S01194
     C*
     C****READ*TABLE*FOR*LOCAL*CURRENCY**                                 S01194
     C*********************                                               S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELLOCY      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD3         DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 03 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*
     C*   READ SDCURRPD FOR LOCAL CURRENCY                                S01194
     C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM BJLCCY    @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*
     C* SAVE LOCAL CURRENCY DETAILS
     C*
     C*********************Z-ADDCDP       LCDP    10                      S01194
     C                     Z-ADDA6NBDP    LCDP    10                      S01194
     C                     MOVE MDIN      LMDIN   10
     C                     MOVE A6SPRT    LSPOT  138                      S01194
     C*********************MOVE SPOT      LSPOT  138                      S01194
     C*
     C****READ*TABTB20*****                                               S01194
     C*********************                                               S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'01'      TBCHN                           S01194
     C*********************MOVE '20'      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTB20F             75                   S01194
     C************IN75*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD45        DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 45 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*
     C                     CALL 'AOMMODR0'                                084499
     C                     PARM '*DBERR'  @RTCD   7                       084499
     C                     PARM '*FIRST'  @OPTN   7                       084499
     C           SDMMOD    PARM SDMMOD    DSFDY                           084499
      *                                                                   CAC001
      **  If Analytical Accounting is on, enable F19                      CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVE '1'       *IN68                           CAC001
     C                     ENDIF                                          CAC001
     C*
     C*   READ SDRETLPD                                                   S01194
     C** Only if RETAIL switched on.                                      084499
     C*                                                                   S01194
     C           BGRTBN    IFEQ 'Y'                                       084499
     C                     CALL 'AORETLR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C           SDRETL    PARM SDRETL    DSFDY                           S01194
     C                     END                                            084499
     C*
     C**   SETUP THE BACKVALUE LIMIT DATE
     C*
     C           BJRDNB    SUB  BJBVPD    BVLD    50                      S01194
     C***********RUND******SUB  BVLP      BVLD    50                      S01194
     C*
     C****READ*PAYMENT*CHARGES*RECORD********                             S01117
     C*********************                                               S01117
     C***********1*********CHAINPYCHGDD              75                   S01117
     C************IN75*****IFEQ '0'                        B001           S01117
     C***********RECI******ANDNE'D'                                       S01117
     C*********************SETON                     75                   S01117
     C*********************END                             E001           S01117
     C************IN75*****IFEQ '1'                        B001           S01117
     C*********************ROLBK                                          S01117
     C************LOCK*****IN   DLDA                                      S01117
     C*********************MOVE 'FT0070'  DBPGM                           S01117
     C*********************MOVE 'PYCHG'   DBFILE                          S01117
     C*********************Z-ADD4         DBASE            ************   S01117
     C*********************MOVEL'1'       DBKEY            * DBERR 04 *   S01117
     C*********************OUT  DLDA                       ************   S01117
     C*********************SETON                     U7U8LR               S01117
     C*********************DUMP                                           S01117
     C*********************RETRN                                          S01117
     C*********************END                             E001           S01117
     C*********************                                               S01117
     C***Convert*rate*%*discrepancy*to*higher*&*lower*rate*margins.**     S01117
     C***********1*********ADD  RATDIS    UPMARG  74                      S01117
     C***********1*********SUB  RATDIS    LWMARG  74                      S01117
     C**
     C*    SUPPRESS PREVIOUS PAYMENT REF. FIELDS ON FIRST INITIAL SCREEN
     C**
     C                     MOVE '1'       *IN77
     C**
     C*   SETUP YYMMDD EQUIVALENT OF RUND FOR NEW PAYMENT REFERENCES
     C**
     C*********************Z-ADDRUND      ZDAYNO                          S01194
      *
     C                     Z-ADDBJRDNB    ZDAYNO                          S01194
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAFDT1
      *
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE D3        YR
     C                     MOVE D1        MO
     C                     MOVE D2        DA
     C                     ELSE                            X001
     C                     MOVE D3        YR
     C                     MOVE D2        MO
     C                     MOVE D1        DA
     C                     END                             E001
      *
     C                     MOVE ODAF3     PREFDT  60
      *
      * ENTRY PARAMS
      *
     C           *ENTRY    PLIST
     C           SACTD     PARM           @SORT   1
     C           SPREF     PARM           @PREF  15
     C                     PARM           @RETC   1
     C*                                                                   096486
     C**  If program is called by GL4442, then initialise fields.         096486
     C*                                                                   096486
     C                     MOVE *BLANK    @GL442  1                       096486
     C           @RETC     IFEQ 'G'                                       096486
     C                     MOVE 'Y'       @GL442                          096486
     C                     MOVE *BLANK    @RETC                           096486
     C                     END                                            096486
     C/COPY WNCPYSRC,FTH00160
      *                                                                   CGL007
      ** Access SAR details file to determine if CGL007 is installed.     CGL007
      *                                                                   CGL007
     C                     MOVE 'N'       CGL007  1                       CGL007
     C                     CALL 'AOSARDR0'                                CGL007
     C                     PARM *BLANKS   PRTCD   7                       CGL007
     C                     PARM '*VERIFY' POPTN   7                       CGL007
     C                     PARM 'CGL007'  PSARD   6                       CGL007
     C           SCSARD    PARM SCSARD    DSFDY                           CGL007
      *                                                                   CGL007
      ** If CGL007 is ON, set a variable fld. to condition the rest of    CGL007
      ** the processing.                                                  CGL007
      *                                                                   CGL007
     C           PRTCD     IFEQ *BLANKS                                   CGL007
     C                     MOVE 'Y'       CGL007                          CGL007
     C                     MOVE *BLANK    PRGL90  1                       CGL007
      *                                                                   CGL007
      **  If program is called by GL0090, @RETC contains 'Z'              CGL007
      *                                                                   CGL007
     C           @RETC     IFEQ 'Z'                                       CGL007
     C                     MOVE 'Y'       PRGL90                          CGL007
     C                     MOVE *BLANK    @RETC                           CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C                     ELSE                                           CGL007
      *                                                                   CGL007
      ** Else, database error (return code other than *NRF).              CGL007
      *                                                                   CGL007
     C           PRTCD     IFNE '*NRF   '                                 CGL007
     C                     MOVEL'SCSARDPD'W0FILE           ************   CGL007
     C                     MOVEL'*VERIFY' W0KEY            * DBERR 55 *   CGL007
     C                     Z-ADD55        W0ERNB           ************   CGL007
     C                     EXSR SRERR                                     CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           PRGL90    ANDEQ'Y'                                       CGL007
     C                     MOVE *OFF      *IN70                           CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FT0070C026
      *
      * 9 IS PUT INTO @RETC TO DETECT IF IT IS CHANGED BY THE
      * END OF THE PROGRAM
      *
     C                     MOVE '9'       @RETC
      *                                                             S01241S01194
      * SEE IF WINDOW IS REQUIRED                                   S01241S01194
      *                                                             S01241S01194
     C***********1*********SETLLSDMMODPD                            S01241S01194
     C*********************READ SDMMODPD               7575         S01241S01194
     C************IN75*****IFEQ '1'                                 S01241S01194
     C*********************ROLBK                                    S01241S01194
     C************LOCK*****IN   DLDA                                S01241S01194
     C*********************MOVE 'FT0070'  DBPGM                     S01241S01194
     C*********************MOVE 'SDMMOD'  DBFILE                    S01241S01194
     C*********************Z-ADD99        DBASE            *********S01241S01194
     C*********************MOVEL'FRT'     DBKEY            * DBERR 9S01241S01194
     C*********************OUT  DLDA                       *********S01241S01194
     C*********************SETON                     U7U8LR         S01241S01194
     C*********************DUMP                                     S01241S01194
     C*********************RETRN                                    S01241S01194
     C*********************END                                      S01241S01194
     C*
      ** MOVE CODE TO BEFORE ACCESS OF RETAIL ICD FILE                    084499
     C*******              CALL 'AOMMODR0'                         S01194 084499
     C*******              PARM '*DBERR'  @RTCD   7                S01194 084499
     C*******              PARM '*FIRST'  @OPTN   7                S01194 084499
     C*******    SDMMOD    PARM SDMMOD    DSFDY                    S01194 084499
      *                                                                   S01414
      * Move the conditional IF so that AOGELRR0 is always called.        S01414
      *                                                                   S01414
     C***SET*MULTIBRANCH*AND*ORIG.*BRANCH*USED*INDS.**********      S01117S01414
     C***AND*GET*THE*USER'S*DEFAULT*BRANCH*FROM*DTAARA/ZMUSER*      S01117S01414
     C***********BGMBIN    IFEQ 'Y'                                 S01117S01414
     C***********          SETON                     20             S01117S01414
      *                                                                   S01414
      *  Get the User's default Branch/Department from ZMUSER             S01414
      *                                                                   S01414
     C                     IN   ZMUSER                                    S01117
     C*                                                                   S01194
     C** ACCESS SDGELRPD FOR ORIGINATING BRANCH DETAILS                   S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *                                                                   S01414
      * If return code is not blank - process for a database error        S01414
      *                                                                   S01414
     C           @RTCD     IFNE *BLANKS                                   S01414
     C                     MOVEL'SDGELRPD'W0FILE           *************  S01414
     C                     Z-ADD50        W0ERNB           * DBERR 50  *  S01414
     C                     MOVEL@OPTN     W0KEY            *************  S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   CEU006
      ** Access SAR details file to determine if CEU006 is switched ON    CEU006
      *                                                                   CEU006
     C                     CALL 'AOSARDR0'                                CEU006
     C                     PARM *BLANKS   @RTRN   7                       CEU006
     C                     PARM '*VERIFY' @OPTN   7                       CEU006
     C                     PARM 'CEU006'  @SARD   6                       CEU006
     C           SCSARD    PARM SCSARD    DSFDY                           CEU006
      *                                                                   CEU006
      ** If core feature is switched ON, set a variable field to          CEU006
      ** condition the rest of the processing                             CEU006
      *                                                                   CEU006
     C           @RTRN     IFEQ *BLANKS                                   CEU006
     C                     MOVE 'Y'       CEU006  1                       CEU006
     C                     MOVE *ON       *IN25                           CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
      ** else, database error (return code other than *NRF)               CEU006
      *                                                                   CEU006
     C           @RTRN     IFNE '*NRF   '                                 CEU006
     C                     MOVEL'SCSARDPD'W0FILE           ************   CEU006
     C                     MOVEL'*VERIFY' W0KEY            * DBERR 42 *   CEU006
     C                     Z-ADD42        W0ERNB           ************   CEU006
     C                     EXSR SRERR                      *ABORT PGM*    CEU006
     C                     ELSE                                           CEU006
     C                     MOVE 'N'       CEU006                          CEU006
     C                     ENDIF                                          CEU006
     C                     ENDIF                                          CEU006
      *                                                                   S01117
      *  SET MULTIBRANCH AND ORIG. BRANCH USED INDS.                      S01117
      *                                                                   S01117
     C           BGMBIN    IFEQ 'Y'                                       S01117
     C                     SETON                     20                   S01117
      *                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                            EQ         S01117
     C                     SETON                     21                   S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     CALL 'AOFTFRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*FIRST'  @OPTN   7                       S01194
     C           SDFTFR    PARM SDFTFR    DSFDY                           S01194
     C*                                                                   S01194
     C** Convert rate % discrepancy to higher & lower rate margins.       S01117
     C*                                                                   S01194
     C           1         ADD  RATDIS    UPMARG  74                      S01117
     C           1         SUB  RATDIS    LWMARG  74                      S01117
      *                                                                   056031
      * Access FT Control data                                            056031
      *                                                                   056031
     C                     CALL 'FT0005'               9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C           C#CNTL    PARM           O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'FT0005'  W0KEY                           056031
     C                     Z-ADD1         W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
      *                                                                   056031
      * Set up FT override for General Ledger Balances                    056031
      *                                                                   056031
     C           C#GLUI    IFEQ 'I'                                       056031
     C                     MOVEL'Y'       ##FTOV  1                       056031
     C                     ELSE                                           056031
     C                     MOVEL*BLANKS   ##FTOV                          056031
     C                     END                                            056031
     C*
     C           @PREF     COMP *BLANK               70
     C           *IN70     IFEQ '1'                                       096486
     C           @GL442    ANDEQ'Y'                                       096486
     C                     MOVE '0'       *IN70                           096486
     C                     END                                            096486
      *                                                                   CGL007
     C           *IN70     IFEQ *ON                                       CGL007
     C           PRGL90    ANDEQ'Y'                                       CGL007
     C                     MOVE *OFF      *IN70                           CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FT0070C028
      * Check if switchable feature CDL049 is present                     CDL049
     C                     CALL 'AOSARDR0'                                CDL049
     C                     PARM '       ' @RTCD                           CDL049
     C                     PARM '*VERIFY' @OPTN                           CDL049
     C                     PARM 'CDL049'  @SARD                           CDL049
      *                                                                   CDL049
     C           @RTCD     IFNE *BLANK                                    CDL049
     C                     MOVE 'N'       CDL049                          CDL049
     C                     MOVE '1'       *IN80                           CDL049
     C                     ELSE                                           CDL049
     C                     MOVE 'Y'       CDL049  1                       CDL049
     C                     MOVE '0'       *IN80                           CDL049
      *                                                                   CDL049
      * Retrieve Reference Rate Tolerance details                         CDL049
     C           1         SETLLSDRRATPD                                  CDL049
     C                     READ SDRRATPD                 90               CDL049
      *                                                                   CDL049
     C           *IN90     IFEQ '1'                                       CDL049
     C                     MOVE 'SDRRATPD'W0FILE                          CDL049
     C                     MOVEL*BLANKS   DBKEY            ***************CDL049
     C                     Z-ADD800       W0ERNB           * DBERROR 800 *CDL049
     C                     EXSR SRERR                      ***************CDL049
     C                     ENDIF                                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C*                                                                   S01494
     C** Access SAR details file to determine if S01494 is switched ON    S01494
     C*                                                                   S01494
     C                     CALL 'AOSARDR0'                                S01494
     C                     PARM *BLANKS   @RTCD   7                       S01494
     C                     PARM '*VERIFY' @OPTN   7                       S01494
     C                     PARM 'S01494'  @SARD   6                       S01494
     C           SCSARD    PARM SCSARD    DSFDY                           S01494
     C*                                                                   S01494
     C** If core feature is switched ON, set on indicator that will       S01494
     C** condition the rest of the processing                             S01494
     C*                                                                   S01494
     C           @RTCD     IFEQ *BLANKS                                   S01494
     C                     SETON                     09                   S01494
     C                     ELSE                                           S01494
     C*                                                                   S01494
     C** else, database error (return code other than *NRF)               S01494
     C*                                                                   S01494
     C           @RTCD     IFNE '*NRF   '                                 S01494
     C                     MOVEL'SCSARDPD'W0FILE                          S01494
     C                     MOVEL'*CALL'   W0KEY            ***************S01494
     C                     Z-ADD30        W0ERNB           * DB ERROR 30 *S01494
     C                     EXSR SRERR                      ***************S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01499
     C** Access SAR details file to determine if S01499 is switched ON    S01499
     C*                                                                   S01499
     C                     CALL 'AOSARDR0'                                S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*VERIFY' @OPTN   7                       S01499
     C                     PARM 'S01499'  @SARD   6                       S01499
     C           SCSARD    PARM SCSARD    DSFDY                           S01499
     C*                                                                   S01499
     C** If core feature is switched ON, set on indicator w/c will        S01499
     C** condition the rest of the processing                             S01499
     C*                                                                   S01499
     C           @RTCD     IFEQ *BLANKS                                   S01499
     C                     SETON                     08                   S01499
     C                     ELSE                                           S01499
     C*                                                                   S01499
     C** else, database error (return code other than *NRF)               S01499
     C*                                                                   S01499
     C           @RTCD     IFNE '*NRF   '                                 S01499
     C                     MOVEL'SCSARDPD'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD31        W0ERNB           * DB ERROR 31 *S01499
     C                     EXSR SRERR                      ***************S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** Read V.A.T. details if S01499 switched ON                        S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     CALL 'AOVATR0'              9090               S01499
     C                     PARM *BLANKS   @RTCD   7                       S01499
     C                     PARM '*FIRST ' @OPTN   7                       S01499
     C                     PARM           VATDS                           S01499
     C*                                                                   S01499
     C           *IN90     IFEQ '1'                                       S01499
     C           @RTCD     ORNE *BLANKS                                   S01499
     C                     MOVEL'AOVATR0 'W0FILE                          S01499
     C                     MOVEL'*CALL'   W0KEY            ***************S01499
     C                     Z-ADD32        W0ERNB           * DB ERROR 32 *S01499
     C                     EXSR SRERR                      ***************S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C*                                                                   S01508
     C** Access SAR details file to determine if S01508 is switched ON    S01508
     C*                                                                   S01508
     C                     CALL 'AOSARDR0'                                S01508
     C                     PARM *BLANKS   @RTCD   7                       S01508
     C                     PARM '*VERIFY' @OPTN   7                       S01508
     C                     PARM 'S01508'  @SARD   6                       S01508
     C           SCSARD    PARM SCSARD    DSFDY                           S01508
     C                     MOVE 'N'       S01508  1                       S01508
     C*                                                                   S01508
     C** If core feature is switched ON, set on a flag that will          S01508
     C** condition the rest of the processing                             S01508
     C*                                                                   S01508
     C           @RTCD     IFEQ *BLANKS                                   S01508
     C                     MOVE 'Y'       S01508                          S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C** else, database error (return code other than *NRF)               S01508
     C*                                                                   S01508
     C           @RTCD     IFNE '*NRF   '                                 S01508
     C                     MOVEL'SCSARDPD'W0FILE                          S01508
     C                     MOVEL'*CALL'   W0KEY            ***************S01508
     C                     Z-ADD33        W0ERNB           * DB ERROR 33 *S01508
     C                     EXSR SRERR                      ***************S01508
     C                     END                                            S01508
     C                     END                                            S01508
      *                                                                                       CSD015
      ** Define dataara SDSTAT and SC24X7                                                     CSD015
      *                                                                                       CSD015
     C           *NAMVAR   DEFN           SC24X7                                              CSD015
     C           *NAMVAR   DEFN           SDSTAT                                              CSD015
     C                     IN   SDSTAT                                                        CSD015
      *                                                                                       CSD015
      ** Check if 24x7 Midas Availability is installed                                        CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSC011'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SCSARDPD'W0FILE                                              CSD015
     C                     MOVE 'CSC011'  W0KEY                                               CSD015
     C                     Z-ADD60        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSC011  1                                           CSD015
     C                     IN   SC24X7                                                        CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSC011                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if Compliance Watch Enhancement (CSD015) is installed                          CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CSD015'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SCSARDPD'W0FILE                                              CSD015
     C                     MOVE 'CSD015'  W0KEY                                               CSD015
     C                     Z-ADD61        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CSD015  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CSD015                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if function code is being monitored by compliance watch                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C                     CALL 'AOWLCCR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*KEY   ' @OPTN                                               CSD015
     C                     PARM 'CHEQCOLL'PFUNC   8                                           CSD015
     C           SDWLCC    PARM SDWLCC    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank or *NRF, then issue database error                          CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SCWLCCPD'W0FILE                                              CSD015
     C                     MOVE 'CHEQCOLL'W0KEY                                               CSD015
     C                     Z-ADD62        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Access compliance watch configuration                                                CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCWCDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*FIRST ' @OPTN                                               CSD015
     C           SDCWCD    PARM SDCWCD    DSSDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank, then issue database error                                  CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C                     MOVE 'SDCWCDPD'W0FILE                                              CSD015
     C                     MOVE '*FIRST ' W0KEY                                               CSD015
     C                     Z-ADD63        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Check if switchable feature CCF001 is installed                                      CSD015
      *                                                                                       CSD015
     C                     CALL 'AOSARDR0'                                                    CSD015
     C                     PARM *BLANKS   @RTCD                                               CSD015
     C                     PARM '*VERIFY' @OPTN                                               CSD015
     C                     PARM 'CCF001'  @SARD                                               CSD015
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD015
      *                                                                                       CSD015
      ** If return code not blank or *NRF, then issue database error                          CSD015
      *                                                                                       CSD015
     C           @RTCD     IFNE *BLANKS                                                       CSD015
     C           @RTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVE 'SCSARDPD'W0FILE                                              CSD015
     C                     MOVE 'CCF001'  W0KEY                                               CSD015
     C                     Z-ADD64        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     END                                                                CSD015
      *                                                                                       CSD015
     C           @RTCD     IFEQ *BLANKS                                                       CSD015
     C                     MOVE 'Y'       CCF001  1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'N'       CCF001                                              CSD015
     C                     END                                                                CSD015
      *                                                                                       CSD015
      ** Check if Online Printing of Advices (GE7) is on.                                     CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM '*VERIFY' POPTN                                               CRE020
     C                     PARM 'CRE020'  PSARD                                               CRE020
     C           SCSARD    PARM SCSARD    DSFDY                                               CRE020
      *                                                                                       CRE020
      ** Database Error (return code other than *NRF)                                         CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE *BLANKS                                                       CRE020
     C           PRTCD     ANDNE'*NRF   '                                                     CRE020
     C                     MOVEL'SCSARDPD'W0FILE                                              CRE020
     C                     MOVEL'CRE020'  W0KEY                                               CRE020
     C                     Z-ADD66        W0ERNB                                              CRE020
     C                     EXSR SRERR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Access SAR Details to determine if ULX043 is swithed ON                              CER001
      *                                                                                       CER001
     C                     MOVE 'N'       ULX043  1                                           CER001
      *                                                                                       CER001
     C                     CALL 'AOSARDR0'                                                    CER001
     C                     PARM *BLANKS   PRTCD                                               CER001
     C                     PARM '*VERIFY' POPTN                                               CER001
     C                     PARM 'ULX043'  PSARD                                               CER001
     C           SCSARD    PARM SCSARD    DSFDY                                               CER001
      *                                                                                       CER001
      ** Database Error (return code other than *NRF)                                         CER001
      *                                                                                       CER001
     C           PRTCD     IFNE *BLANKS                                                       CER001
     C           PRTCD     ANDNE'*NRF   '                                                     CER001
     C                     MOVEL'SCSARDPD'W0FILE                                              CER001
     C                     MOVEL'ULX043'  W0KEY                                               CER001
     C                     Z-ADD66        W0ERNB                                              CER001
     C                     EXSR SRERR                                                         CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C           PRTCD     IFEQ *BLANKS                                                       CER001
     C                     MOVE 'Y'       ULX043                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CAP205
      ** Determine if SAR CAP205 is installed                                                 CAP205
      *                                                                                       CAP205
     C                     MOVE 'N'       CAP205  1                                           CAP205
      *                                                                                       CAP205
     C                     CALL 'AOSARDR0'                                                    CAP205
     C                     PARM *BLANKS   PRTCD                                               CAP205
     C                     PARM '*VERIFY' POPTN                                               CAP205
     C                     PARM 'CAP205'  PSARD                                               CAP205
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP205
      *                                                                                       CAP205
      ** Database Error (return code other than *NRF)                                         CAP205
      *                                                                                       CAP205
     C           PRTCD     IFNE *BLANKS                                                       CAP205
     C           PRTCD     ANDNE'*NRF   '                                                     CAP205
     C                     MOVEL'SCSARDPD'W0FILE                                              CAP205
     C                     MOVEL'CAP205'  W0KEY                                               CAP205
     C                     Z-ADD67        W0ERNB                                              CAP205
     C                     EXSR SRERR                                                         CAP205
     C                     ENDIF                                                              CAP205
      *                                                                                       CAP205
     C           PRTCD     IFEQ *BLANKS                                                       CAP205
     C                     MOVE 'Y'       CAP205                                              CAP205
     C                     ENDIF                                                              CAP205
      *
      ** Determine if Stamp Tax is switched on.                                               CER049
      *                                                                                       CER049
     C                     MOVE *BLANK    CER049  1                                           CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   PRTCD                                               CER049
     C                     PARM '*VERIFY' POPTN                                               CER049
     C                     PARM 'CER049'  PSARD                                               CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
     C           PRTCD     IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C           PRTCD     IFNE '*NRF   '                                                     CER049
     C                     MOVE '903'     DBASE                                               CER049
     C                     MOVEL'CER049  'DBKEY                                               CER049
     C                     MOVEL'SCSARDPD'DBFILE                                              CER049
     C                     SETON                     U7U8LR                                   CER049
     C                     DUMP                                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C/COPY WNCPYSRC,FT0070C042
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
     C*
     C/COPY WNCPYSRC,FT0070C004
     C                     ENDSR
     C*
     C**  END INITIAL PROCESSING SUBROUTINE
     C*
     C/EJECT
     C*****************************************************************
     C*
     C**  INITIAL SCREEN PROCESSING AND VALIDATION
     C*
     C           INVAL     BEGSR
      *
     C           *IN12     DOUEQ'1'                        B001
     C           *IN03     OREQ '1'
     C           @PREF     ORNE *BLANK
     C           *IN89     ANDEQ'0'
     C           *IN16     ANDEQ'0'                                       S01194
     C           *IN07     OREQ '1'
      *
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     SETOF                     897273
     C                     SETOF                     404142
     C                     SETOF                     16                   S01194
     C/COPY WNCPYSRC,FTH00157
     C                     SETOF                     37                   S01117
     C                     EXSR RESET
     C                     Z-ADD0         CQSQ
     C                     MOVE 'N'       INSDET  1
     C*
     C**  ACTION CODE MANDATORY
     C*
     C           SACTD     IFEQ *BLANK                     B002
     C                     SETON                     4089
     C                     ADD  1         S
     C*********************MOVE ' 083'    ERCD,S                          S01117
     C                     MOVE ' 002'    ERCD,S                          S01117
     C                     ELSE                            X002
     C*
     C**  CHECK IF VALID VALUE
     C*
     C           SACTD     IFNE 'I'                        B003
     C           SACTD     ANDNE'A'
     C           SACTD     ANDNE'D'
     C           SACTD     ANDNE'E'
     C                     SETON                     4089
     C                     ADD  1         S
     C*********************MOVE ' 084'    ERCD,S                          S01117
     C                     MOVE ' 003'    ERCD,S                          S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
      *
      ** IF SINGLE BRANCHED CHECK ACTION/MENU ITEM AUTHOR                 S01117
      *
     C           *IN20     IFEQ '0'                                       S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTU'                                  S01117
     C                     PARM SACTD     ZACTN   1                       S01117
     C                     PARM           ERR     10                      S01117
      *                                                                   S01117
     C           ERR       IFEQ 1                                         S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 302'    ERCD,S                          S01117
     C                     SETON                     4089                 S01117
     C                     END                                            S01117
     C                     END                                            096486
      *                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             E003
     C                     END                             E002
      *
     C           SACTD     IFEQ 'I'                        B002
     C           SACTD     OREQ 'A'
     C           SCQSQ     ANDEQ*BLANKS
     C                     MOVE SACTD     ACT2    1
     C                     ELSE                            X002
     C                     MOVE SACTD     ACT2
     C                     END                             E002
     C*
     C**  SET INDICATORS BY ACTION CODE
     C*
     C           SACTD     IFEQ 'A'                        B002
     C                     SETON                     73
     C/COPY WNCPYSRC,FTH00158
     C                     END                             E002
      *
     C           SACTD     IFEQ 'E'                        B002
     C           SACTD     OREQ 'D'
     C                     SETON                     72
     C/COPY WNCPYSRC,FTH00159
     C                     END                             E002
     C*
     C**  IF INSERT,SINGLE BRANCH AND PREF BLANK DEFAULT BOOKING BR       S01117
     C**  TO SINGLE BRANCH FROM SDBANK                                    S01117
     C**                                                                  S01117
     C           SACTD     IFEQ 'I'                                       S01117
     C           *IN20     ANDEQ'0'                                       S01117
     C           SPREF     ANDEQ*BLANKS                                   S01117
     C                     MOVE BJSBRC    BKGBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C**  CHEQUE SEQUENCE PROHIBITED FOR INSERT
     C*
     C           SACTD     IFEQ 'I'                        B002
      *
     C           SCQSQ     IFNE *BLANK                     B003
     C                     SETON                     8942
     C                     ADD  1         S
     C*********************MOVE ' 216'    ERCD,S                          S01117
     C                     MOVE ' 004'    ERCD,S                          S01117
     C                     END                             E003
     C*
     C**  IF PAYMENT REFERENCE ENTERED FOR INSERT IT MUST REFER
     C**  TO AN EXISTING HEADER FOR WHICH DETAILS ARE TO BE INPUT
     C*
     C           SPREF     IFNE *BLANK                     B003
     C                     MOVE '00'      CQSQK
     C                     MOVELSPREF     PREFK
     C           CQCHNK    CHAINCQCOD                75
      *
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 318'    ERCD,S                          S01117
     C                     MOVE ' 011'    ERCD,S                          S01117
     C                     ELSE                            X004
      *
     C           NCSQ      IFGE 50                         B005
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 334'    ERCD,S                          S01117
     C                     MOVE ' 014'    ERCD,S                          S01117
     C                     ELSE                            X005
      *
     C           RECI      IFNE 'D'                        B006
     C           AUIN      OREQ 'Y'
     C***********OEDT******ORNE BJRDNB                              S01194035406
     C***********OEDT******ORNE RUND                                      S01194
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 342'    ERCD,S                          S01117
     C                     MOVE ' 010'    ERCD,S                          S01117
     C                     ELSE                            X006
     C*                                                                   S01117
     C** VALID RECORD FOUND, SO PERFORM SPF CHECKING IF MULTI-BRANCHED    S01117
      *
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
      *
     C           *IN89     IFEQ '0'                        B007           S01117
     C                     MOVE 'Y'       INSDET  1
     C                     MOVELSMCY      INSMCY  3                       E25159
     C                     END                             E007           S01117
     C*                                                                   S01117
     C                     END                             E006
     C                     END                             E005
     C                     END                             E004
     C*
     C           *IN75     IFEQ '0'                        B004
     C                     EXCPTRCQCOD
     C                     END                             E004
     C*                                                                   S01117
     C**  ELSE PAYMENT REFERENCE NOT ENTERED FOR INSERT                   S01117
     C**  SO PERFORM SPF CHECKING IF MULTI-BRANCHED                       S01117
     C*                                                                   S01117
     C                     ELSE                            X003           S01117
      *
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
     C*
     C                     END                             E003
     C                     END                             E002
     C*
     C*         ******************************************
     C*
     C**  VALIDATION FOR ACTION CODE A OR D
     C*
     C           SACTD     IFEQ 'A'                        B002
     C           SACTD     OREQ 'D'
     C*
     C**  CHEQUE SEQUENCE BLANK - check if Header exists
     C*
     C           SCQSQ     IFEQ *BLANK                     B003
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
     C           CQCHNK    CHAINCQCODDDF             75
      *                                                                                     AR804457
      ** Disallow Delete for Cheques due for Reauthorization                                AR804457
      *                                                                                     AR804457
     C           SACTD     IFEQ 'D'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     4189                                   AR804457
     C                     ADD  1         S                                                 AR804457
     C                     MOVE ' 005'    ERCD,S                                            AR804457
     C                     ENDIF                                                            AR804457
     C*
     C**  CHEQUE HEADER NOT FOUND
     C*
     C           *IN75     IFEQ '1'                        B004
     C           RECI      ORNE 'D'
     C           RECI      ANDNE'M'                                                         AR804457
     C           AUIN      OREQ 'Y'
     C           AUIN      OREQ 'R'                                                         AR804457
     C***********OEDT******ORNE BJRDNB                              S01194035406
     C***********OEDT******ORNE RUND                                      S01194
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 217'    ERCD,S                          S01117
     C                     MOVE ' 005'    ERCD,S                          S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*
     C** VALID RECORD FOUND, SO PERFORM SPF CHECKING IF MULTI-BRANCHED    S01117
     C*
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             E004
     C*
     C* If valid header and Amend - store header values
     C*
     C           *IN89     IFEQ '0'                        B004
     C           SACTD     ANDEQ'A'
     C                     EXSR OLDH
     C                     END                             E004
     C*
     C**  CHEQUE SEQUENCE NON-BLANK
     C*
     C                     ELSE                            X003
      *                                                                   052487
      *  Cheque sequence - must be numeric                                052487
      *                                                                   052487
     C                     MOVE SCQSQ     TST2N                           052487
     C                     MOVELTST2N     TST2A   2                       052487
      *                                                                   052487
      * If fields don't match send msg that fld is not blank or numeric   052487
      *                                                                   052487
     C           TST2A     IFNE SCQSQ                                     052487
     C                     SETON                     4289                 052487
     C                     ADD  1         S                               052487
     C                     MOVE ' 072'    ERCD,S                          052487
     C                     END                                            052487
      *                                                                   052487
      * If no errors so far, determine if valid cheque sequence.          052487
      * Cheque sequence must be between 01 to 50, if so access detail     052487
      * record                                                            052487
      *                                                                   052487
     C           *IN89     IFEQ '0'                                       052487
     C                     MOVE SCQSQ     TST2N   20                      052487
      *                                                                   052487
     C           TST2N     IFGE 1                                         052487
     C           TST2N     ANDLE50                                        052487
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
     C           CQCHNK    CHAINCQCODDDF             75
     C                     MOVELRECI      HDSTAT  1                                        AR1008672
     C           HDSTAT    IFEQ 'M'                                                        AR1008672
     C                     SETON                     79                                    AR1008672
     C                     ELSE                                                            AR1008672
     C                     SETOF                     79                                    AR1008672
     C                     ENDIF                                                           AR1008672
     C*
     C**  CHECK HEADER EXISTS AND IS NON-AUTHORISED
     C*
     C           *IN75     IFEQ '0'                        B004
     C*
     C********** AUIN      IFEQ 'Y'                        B005                             AR804457
     C********** RECI      ORNE 'D'                                                         AR804457
     C********** RECI      IFNE 'D'                                               AR804457 AR1008672
     C********** RECI      ANDNE'M'                                              AR804457A AR1008672
     C**********           SETON                     75                                    AR1008672
     C**********           END                             E005                            AR1008672
      *                                                                                     AR804457
      ** Authorised cheques could not be deleted                                            AR804457
      *                                                                                     AR804457
     C           SACTD     IFEQ 'D'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'D'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     75                                     AR804457
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C*
     C                     EXCPTRCQCOD
     C                     END                             E004
     C*
     C* If header exists, also ensure that cheque detail exists
     C*
     C           *IN75     IFEQ '0'                        B004
     C                     MOVE SCQSQ     CQSQK
     C           CQCHNK    CHAINCQCOCDDF             75
     C                     MOVELRECI      DTSTAT  1                                        AR1008672
     C           CRAG      IFEQ 'Y'                                                        AR1008672
     C                     SETON                     76                                    AR1008672
     C                     ENDIF                                                           AR1008672
     C                     END                             E004
     C*
     C**  VALID CHEQUE DETAIL NOT FOUND
     C*
     C           *IN75     IFEQ '1'                        B004
     C********** RECI      ORNE 'D'                                                        AR1008672
     C           DTSTAT    OREQ 'M'                                                        AR1008672
     C           DTSTAT    OREQ 'C'                                                        AR1031132
     C***********OEDT******ORNE RUND                                      S01194
     C***********OEDT******ORNE BJRDNB                                    035406
     C                     SETON                     414289
     C                     ADD  1         S
     C*********************MOVE ' 218'    ERCD,S                          S01117
     C                     MOVE ' 006'    ERCD,S                          S01117
     C                     END                             E004
     C*                                                                   S01117
     C** VALID RECORD FOUND, SO PERFORM SPF CHECKING IF MULTI-BRANCHED    S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
      *                                                                   052487
      * If Cheque sequence - not between 01 to 50                         052487
      * Send message that field is not blank or valid numeric             052487
      *                                                                   052487
     C                     ELSE                                           052487
      *                                                                   052487
     C                     SETON                     4289                 052487
     C                     ADD  1         S                               052487
     C                     MOVE ' 072'    ERCD,S                          052487
     C                     END                                            052487
      *                                                                   052487
     C                     END                                            052487
     C*                                                                   S01117
     C* If valid cheque detail - store detail values
     C*
     C           *IN89     IFEQ '0'                        B004
     C                     EXSR OLDD
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C*         ******************************************
     C*
     C**  VALIDATION FOR ACTION CODE E
     C*
     C           SACTD     IFEQ 'E'                        B002
     C*
     C**  CHEQUE HEADER - SEQUENCE BLANK
     C*
     C           SCQSQ     IFEQ *BLANK                     B003
     C***********SCQSQ*****OREQ '00'                                E23540052487
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
     C           CQCHNK    CHAINCQCOD                75
     C*
     C**  CHEQUE HEADER NOT FOUND
     C*
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 219'    ERCD,S                          S01117
     C                     MOVE ' 007'    ERCD,S                          S01117
      *                                                                   CGL007
      ** If CGL007 is ON, and is called by GL0090, set return code to 'E'.CGL007
      *                                                                   CGL007
     C           CGL007    IFEQ 'Y'                                       CGL007
     C           PRGL90    ANDEQ'Y'                                       CGL007
     C                     MOVE 'E'       @RETC                           CGL007
     C                     MOVE *ON       *INLR                           CGL007
     C                     RETRN                                          CGL007
     C                     END                                            CGL007
      *                                                                   CGL007
     C/COPY WNCPYSRC,FT0070C027
     C*                                                                   096486
     C           @GL442    IFEQ 'Y'                                       096486
     C                     MOVE 'E'       @RETC                           096486
     C                     SETON                     LR                   096486
     C                     RETRN                                          096486
     C                     END                                            096486
     C*                                                                   S01117
     C                     ELSE                            X004           S01117
     C*                                                                   S01117
     C** VALID RECORD FOUND, SO PERFORM SPF CHECKING IF MULTI-BRANCHED    S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             E004
     C*
     C**  CHEQUE DETAIL - SEQUENCE NON-BLANK
     C*
     C                     ELSE                            X003
      *                                                                   052487
      *  Cheque sequence - must be numeric                                052487
      *                                                                   052487
     C                     MOVE SCQSQ     TST2N                           052487
     C                     MOVELTST2N     TST2A   2                       052487
      *                                                                   052487
      * If fields don't match send msg that fld is not blank or numeric   052487
      *                                                                   052487
     C           TST2A     IFNE SCQSQ                                     052487
     C                     SETON                     4289                 052487
     C                     ADD  1         S                               052487
     C                     MOVE ' 072'    ERCD,S                          052487
     C                     END                                            052487
      *                                                                   052487
      * If no errors so far, determine if valid cheque sequence           052487
      * Cheque sequence - must be between 01 to 50                        052487
      *                                                                   052487
     C           *IN89     IFEQ '0'                                       052487
     C                     MOVE SCQSQ     TST2N   20                      052487
      *                                                                   052487
     C           TST2N     IFGE 1                                         052487
     C           TST2N     ANDLE50                                        052487
     C                     MOVELSPREF     PREFK
     C                     MOVE SCQSQ     CQSQK
     C           CQCHNK    CHAINCQCOD                75
      *
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     414289
     C                     ADD  1         S
     C*********************MOVE ' 220'    ERCD,S                          S01117
     C                     MOVE ' 008'    ERCD,S                          S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** VALID RECORD FOUND, SO PERFORM SPF CHECKING IF MULTI-BRANCHED    S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C                     EXSR SPF                                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                             E004
      *                                                                   052487
      * If Cheque sequence - not between 01 to 50                         052487
      * Send message that field is not blank or valid numeric             052487
      *                                                                   052487
     C                     ELSE                                           052487
      *                                                                   052487
     C                     SETON                     4289                 052487
     C                     ADD  1         S                               052487
     C                     MOVE ' 072'    ERCD,S                          052487
     C                     END                                            052487
      *                                                                   052487
     C                     END                                            052487
      *
     C                     END                             E003
     C                     END                             E002
     C*
     C**  VALIDATION FOR ACTION CODE D
     C*
     C           SACTD     IFEQ 'D'                        B002
     C           SCQSQ     ANDEQ*BLANK
     C           TOTC      ANDNE*ZERO
     C                     SETON                     4189
     C                     ADD  1         S
     C*********************MOVE ' 221'    ERCD,S                          S01117
     C                     MOVE ' 009'    ERCD,S                          S01117
     C                     END                             E002
     C*                                                                   048377
     C* If no errors and action is A, D or I then transaction must not    048377
     C* currently be accessed by another user                             048377
     C*                                                                   048377
     C           *IN89     IFEQ '0'                                       048377
     C*                                                                   048377
     C           SACTD     IFEQ 'A'                                       048377
     C           SACTD     OREQ 'D'                                       048377
     C           SACTD     OREQ 'I'                                       048377
     C           SPREF     ANDNE*BLANKS                                   048377
      *                                                                   048377
      * Call CL program to check for other users                          048377
      *                                                                   048377
     C                     MOVE *BLANKS   @RTCDE  7                       048377
     C                     MOVE 'FT'      @MODLE  2                       048377
     C                     MOVE SPREF     @TREF  15                       048377
     C                     MOVE *BLANKS   @RTINF 80                       048377
     C                     CALL 'AOC8000'                                 048377
     C                     PARM           @RTCDE                          048377
     C                     PARM           @MODLE                          048377
     C                     PARM           @TREF                           048377
     C                     PARM           @RTINF                          048377
      *                                                                   048377
      *  If 'IN USE' then redisplay error message                         048377
      *                                                                   048377
     C           @RTCDE    IFEQ '*IN USE'                                 048377
     C                     ADD  1         S                               048377
     C                     MOVE ' 600'    ERCD,S                          048377
     C                     SETON                     4189                 048377
      *                                                                   048377
     C                     END                                            048377
      *                                                                   048377
     C                     END                                            048377
      *                                                                   048377
     C                     END                                            048377
     C*
     C*         ******************************************
     C*
     C**  ERRORS FOUND RE-OUTPUT INITIAL SCREEN
     C*
     C           *IN89     IFEQ '1'                        B002
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
      *                                                                   048377
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C                     WRITEFT0070F1
      *
     C************IN11*****DOUEQ'0'                        B003           S01199
     C*
     C                     READ FT0070F1                 75
      *
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag                                           058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   058194
     C************IN11*****IFEQ '1'                        B004           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E004           S01199
     C*********************END                             E003           S01199
      *
     C                     END                             E002
     C*
     C**  IF NO ERRORS PROGRESS TO NEXT SCREEN
     C*
     C           *IN89     IFEQ '0'                        B002
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C           *IN07     ANDEQ'0'                                       E29970
     C**
     C*    SUPPRESS PREVIOUS PAYMENT REF. FIELDS ON NEXT INITIAL SCREEN
     C**
     C                     MOVE '1'       *IN77
     C*
     C**  STORE DATE / TIME STAMP AND RELEASE RECORD
     C*
     C           SACTD     IFNE 'I'                        B003
     C                     MOVE DTIME     SDTIM  110
     C                     MOVE RECI      RECIS   1
      *
      * Clear header or detail screen fields
      *
     C           SCQSQ     IFEQ *BLANKS                    B004
     C           SCQSQ     OREQ '00'                                      E23540
     C                     EXSR CLRHED
     C                     EXCPTRCQCOD
     C                     ELSE                            X004
     C                     EXSR CLSCRN
     C                     EXCPTRCQCOC
     C                     END                             E004
      *
     C                     END                             E003
     C*
     C**  FOR CHEQUE ENQUIRY ACCESS HEADER FOR AUTHORIZED INDICATOR
     C*
     C           SACTD     IFEQ 'E'                        B003
     C           SCQSQ     ANDNE*BLANKS
     C*
     C                     MOVE SCQSQ     CQSQSV  2
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
     C           CQCHNK    CHAINCQCOD                75
      *
     C           *IN75     IFEQ '1'                        B004
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE
     C                     Z-ADD5         DBASE            ************
     C                     MOVE CQCHN     DBKEY            * DBERR 05 *
     C                     OUT  DLDA                       ************
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X004
      *
     C                     EXCPTRCQCOD
     C                     MOVE CQSQSV    CQSQ
     C                     MOVE CQSQSV    SCQSQ
     C                     END                             E004
      *
     C                     END                             E003
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
     C*
     C*         ******************************************
      *
     C*
     C**  PROCESS HEADER/CHEQUE SCREENS
     C*
     C           SACTD     IFEQ 'I'                        B003
     C                     EXSR CLRHED
     C                     EXSR CLSCRN
      *
     C           SPREF     IFNE *BLANKS                    B004
     C                     MOVE PREF      IPREF
     C                     END                             E004
      *
     C                     END                             E003
     C*
     C**  PROCESS HEADER IF REQUESTED
     C*
     C           SCQSQ     IFEQ *BLANKS                    B003
     C           INSDET    ANDEQ'N'
     C           SCQSQ     OREQ '00'                                      E23540
     C           INSDET    ANDEQ'N'                                       E23540
      *
     C           AUIN      IFEQ 'Y'                                                         AR804457
     C           AUIN      OREQ 'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C           SACTD     IFNE 'I'                        B004
     C                     EXSR HCONV
     C                     MOVE AUIN      AUINS   1
     C                     EXSR STATUS
     C                     END                             E004
     C*
     C**  PERMIT F10 & O/P RELATED TEXT IFF DELETE REQUESTED
     C*
     C           SACTD     IFEQ 'D'                        B004
     C                     MOVE '1'       *IN14
     C                     ELSE                            X004
     C                     MOVE '0'       *IN14
     C                     END                             E004
      *
     C* SETON INDICATOR 69 TO PROTECT HEADER CURRENCY IF AMEND
     C* AND A CHEQUE DETAIL HAS BEEN ENTERED
      *
     C           SACTD     IFEQ 'A'                        B004
     C           NCSQ      ANDNE0
     C                     SETON                     69
     C                     ELSE                            X004
     C                     SETOF                     69
     C                     END                             E004
      *
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C                     WRITEFT0070F2
      *
     C************IN11*****DOUEQ'0'                        B004           S01199
      *
     C                     READ FT0070F2                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETOF                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     WRITEFT0070F2                                  S01494
     C                     READ FT0070F2                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   058194
     C**                                                                  S01199
     C************IN11*****IFEQ '1'                        B005           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E005           S01199
     C*********************END                             E004           S01199
      *
     C                     EXSR INIT1
      *
     C           @PREF     IFNE *BLANK
     C                     MOVE '1'       *IN12
     C                     MOVE ' '       @RETC
     C                     END
      *
      * If record updated by another workstation goto end of subr.
      *
     C           *IN67     IFEQ '1'                        B004
     C                     GOTO EXINVA
     C                     END                             E004
      *
     C                     ELSE                            X003
     C*
     C**  ELSE PROCESS cheque DETAIL
     C*
     C           SACTD     IFNE 'I'                        B004
     C                     EXSR DCONV
     C                     MOVE AUIN      AUINS
     C                     EXSR STATUS
     C                     END                             E004
     C*
     C**  PERMIT F10 & O/P RELATED TEXT IFF DELETE REQUESTED
     C*
     C           SACTD     IFEQ 'D'                        B004
     C                     MOVE '1'       *IN14
     C                     ELSE                            X004
     C                     MOVE '0'       *IN14
     C                     END                             E004
     C*
     C* STORE VALUES BEFORE DISPLAY
     C*
     C                     MOVE STRCME    SCHG,1
     C                     MOVE STXCHE    SCHG,2
     C                     MOVE SCSTAE    SCHG,3
     C                     MOVE SCOLLE    SCHG,4
     C                     MOVE SCHCME    SCHG,5                          S01494
     C                     MOVE SCQAM     SCQSV  14
     C*
     C**  OUTPUT DEFAULTS TO DETAIL SCREEN FT0070F3
     C*
     C           SACTD     IFEQ 'I'                        B004
     C/COPY WNCPYSRC,FT0070C005
     C*
     C******************** MOVE SSMCY     SCCCY                           E21459
      *
     C           INSDET    IFEQ 'Y'                                       E25159
     C                     MOVELINSMCY    SSMCY                           E25159
     C/COPY WNCPYSRC,FT0070C023
     C                     END                                            E25159
     C***********          MOVE SSMCY     SECCY                     E21459063918
      *                                                                   063918
      * If charge code set to "C" reset entry currency to blank           063918
      *                                                                   063918
     C           BTCHCY    IFEQ 'C'                                       063918
     C                     MOVE *BLANKS   SECCY                           063918
     C                     END                                            063918
     C*
     C           BTCHCY    IFEQ 'B'                        B005           S01194
     C                     MOVE BJCYCD    SECCY                           S01194
     C                     ELSE                            X005           S01194
     C           BTCHCY    IFEQ 'L'                        B006           S01194
     C                     MOVE BJLCCY    SECCY                           S01194
     C                     END                             E006           S01194
     C*                                                                   S01194
     C***********FTCC******IFEQ 'B'                        B005           S01194
     C*********************MOVE BCCY      SECCY                           S01194
     C*********************ELSE                            X005           S01194
     C***********FTCC******IFEQ 'L'                        B006           S01194
     C*********************MOVE LOCY      SECCY                           S01194
     C*********************END                             E006           S01194
     C*
     C                     END                             E005
      *                                                                                     AR940742
     C           BTCHCY    IFEQ 'F'                                                         AR940742
     C                     MOVE FCHCCY    SECCY                                             AR940742
     C                     END                                                              AR940742
     C*
     C                     EXSR PYCHG                                     S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FT0070C036
     C                     MOVE DFTRCT    STCTF
     C***********          MOVE DAFDT1    SCVDA                           049860
     C/COPY WNCPYSRC,FT0070C037
     C*
     C***EXTEND  INSERT CONDITION TO INCLUDE INCREMENTING OF              E23603
     C*** CHEQUE SEQ NUMBER                                               E23603
     C*                                                                   E23603
     C*********************END                             E004           E23603
     C*
     C**  To display the cheque sequence number                           E22952
     C**  Check if an amendment of a cheque.                              E23290
      *
     C***********SACTD     IFNE 'A'                                 E23290E23603
      *
     C                     Z-ADDNCSQ      CQSQ                            E23290
     C           CQSQ      ADD  1         CQSQCS  20                      E22952
     C                     MOVE CQSQCS    SCQSQ                           E22952
     C                     END                                            E23290
      *
      * Display message subfile                                           058194
      *                                                                   058194
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVEL'1'       *IN76                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'0'       *IN76                                               CER049
     C                     ENDIF                                                              CER049
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C058
      *                                                                                     AR804457
     C           SACTD     IFEQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     SETOF                     76                                     AR804457
     C           CRAG      IFEQ 'Y'                                                        AR1008672
     C                     SETON                     76                                    AR1008672
     C                     ENDIF                                                           AR1008672
     C                     ENDIF                                                            AR804457
     C           SACTD     IFEQ 'E'                                                         AR804457
     C                     SETON                     76                                     AR804457
     C                     SETON                     79                                    AR1008672
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C                     WRITEFT0070F3
      *
     C**         *IN11     DOUEQ'0'                        B004           S01199
      *
     C                     READ FT0070F3                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETON                     17                   S01494
     C                     SETON                     76                                     AR804457
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     SETOF                     12                   S01494
     C/COPY WNCPYSRC,FT0070C059
     C                     WRITEFT0070F3                                  S01494
     C                     READ FT0070F3                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *
     C**         *IN11     IFEQ '1'                        B005           S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             E005           S01199
     C**                   END                             E004           S01199
      *
     C                     EXSR DETL1
      *
      * If record updated by another workstation goto end of subr.
      *
     C           *IN67     IFEQ '1'                        B004
     C                     GOTO EXINVA
     C                     END                             E004
     C*
     C**  UPON RETURN FROM PROCESSING DETAIL PROCESS HEADER
     C*
     C********** *IN25*****IFEQ '1'                        B004           CEU006
     C*********************SETOF                     25                   CEU006
     C**  Need an indicator for screen processing                         CEU006
     C           @IN25     IFEQ '1'                        B004           CEU006
     C                     MOVE '0'       @IN25   1                       CEU006
     C*
     C** PROTECT ORIGINATING BRANCH FIELD                                 S01117
     C*
     C                     SETON                     28                   S01117
     C*
     C**  IF PRECEEDING CHEQUE SCREEN WAS A DELETE ENABLE HEADER
     C*
     C           SACTD     IFEQ 'D'                        B005
     C                     SETOF                     7214
     C                     END                             E005
     C*
     C**  REACCESS HEADER TO OBTAIN UP-TO-DATE DETAILS & SETUP SCREEN
     C*
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
      *
     C           SACTD     IFNE 'I'                        B005
     C           CQCHNK    CHAINCQCODDDF             75
      *
     C           *IN75     IFEQ '1'                        B006
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE
     C                     Z-ADD6         DBASE            ************
     C                     MOVE CQCHN     DBKEY            * DBERR 06 *
     C                     OUT  DLDA                       ************
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X006
      *
     C                     EXCPTRCQCOD
     C                     EXSR OLDH
     C                     MOVE DTIME     SDTIM  110
     C                     MOVE RECI      RECIS   1
     C                     END                             E006
      *
     C                     END                             E005
      *
     C                     EXSR HCONV
     C                     EXSR STATUS
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
      *
     C* SETON INDICATOR 69 TO PROTECT HEADER CURRENCY IF AMEND
     C* AND A CHEQUE DETAIL HAS BEEN ENTERED
      *
     C           SACTD     IFEQ 'A'                        B004
     C           NCSQ      ANDNE0
     C                     SETON                     69
     C                     ELSE                            X004
     C                     SETOF                     69
     C                     END                             E004
     C*
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C                     WRITEFT0070F2
      *
     C************IN11*****DOUEQ'0'                        B005           S01199
      *
     C                     READ FT0070F2                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETOF                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     WRITEFT0070F2                                  S01494
     C                     READ FT0070F2                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   058194
     C**                                                                  S01199
     C************IN11*****IFEQ '1'                        B006           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E006           S01199
     C*********************END                             E005           S01199
      *
     C                     EXSR INIT1
      *
     C                     MOVE '1'       *IN12
     C                     MOVE *BLANK    @RETC
     C                     END                             E004
      *
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
      *
     C           EXINVA    ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  FIRST DETAIL SCREEN VALIDATION AND PROCESSING
     C*
     C           INIT1     BEGSR
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0070CPG                                            S01408
     C*                                                                   S01408
      *
      * Do until F12, F3, F10 or F7
      *
     C           *IN12     DOUEQ'1'                        B001
     C           *IN03     OREQ '1'
     C           *IN04     OREQ '1'
     C           *IN07     OREQ '1'                                       E29970
     C                     Z-ADD0         S
     C                     MOVE *BLANKS   ERCD
     C                     SETOF                     8975
     C                     EXSR RESET
     C*
     C**  NO VALIDATION REQUIRED FOR ENQUIRY OR DELETION
     C*
     C           SACTD     IFNE 'E'                        B002
     C           SACTD     ANDNE'D'
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C           *IN07     ANDEQ'0'                                       E29970
     C*
     C**  PAYMENT SUB-TYPE MANDATORY
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASPYST     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C   15                SETON                     16                   S01194
     C*                                                                   S01194
     C                     CALL 'AODLSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SPYST     @DSTC   2                       S01194
     C           SDDLST    PARM SDDLST    DSFDY                           S01194
     C           @RTCD     COMP *BLANKS              7575  HILO           S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ '*NOSEL'                                  S01194
     C                     MOVE *BLANKS   SPYST                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE ASDSTC    SPYST                           S01194
     C                     END                                            S01194
     C*
     C           SPYST     IFEQ *BLANK                     B003
     C                     SETON                     4489
     C                     ADD  1         S
     C*********************MOVE ' 224'    ERCD,S                          S01117
     C                     MOVE ' 016'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*
     C**  CHECK FOR VALID PAYMENT SUB-TYPE
     C*
     C*********************MOVE *BLANKS   TBCHN  12                       S01194
     C*********************MOVEL'42'      TBCHN                           S01194
     C*********************MOVE SPYST     TBCHN                           S01194
     C***********TBCHN*****CHAINTABLET5F             75                   S01194
     C*
     C           *IN75     IFEQ '0'                                       093958
     C*                                                                   093958
     C** Check in Deal type/Sub type file if combination exists           093958
     C*                                                                   093958
     C           @DTSTK    CHAINFDDTSTL1             75                   093958
     C           *IN75     IFEQ '0'                                       093958
     C           RCID11    ANDEQ'*'                                       093958
     C                     SETON                     75                   093958
     C                     END                                            093958
     C                     END                                            093958
     C*                                                                   093958
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     4489
     C                     ADD  1         S
     C*********************MOVE ' 225'    ERCD,S                          S01117
     C                     MOVE ' 017'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE SPYST     PYST
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C**  VALIDATE ORIGINATING BRANCH IF USED                             S01117
     C*                                                                   S01117
     C           BKOBRU    IFEQ 'Y'                        B003           S01117
     C                     MOVEA*BLANKS   FLDQ                            S01117
     C                     MOVEASORBR     FLDQ                            S01117
     C           '?'       LOKUPFLDQ                     15               S01117
     C   15                SETON                     16                   S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01117
     C                     PARM '*KEY'    @OPTN   7                       S01117
     C                     PARM SORBR     @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C** DEFAULT TO BOOKING BRANCH                                        S01117
     C*
     C           @RTCD     IFEQ '*NOSEL'                   B004           S01117
     C           SORBR     OREQ *BLANKS                                   S01117
     C                     MOVE SBKGBR    SORBR                           S01117
     C                     SETON                     16                   S01117
     C                     ELSE                            X004           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                    B005           S01117
     C                     MOVE A8BRCD    SORBR                           S01117
     C                     ELSE                            X005           S01117
     C                     SETON                     3889                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 015'    ERCD,S                          S01117
     C                     END                             E005           S01117
     C*
     C                     END                             E004           S01117
     C*                                                                   S01117
     C** CHECK USER AUTHORITY TO ORIGINATING BRANCH IF REQUIRED           S01117
     C*
     C           BKOBUV    IFEQ 'Y'                        B004           S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM SORBR     @ORBR   3                       S01117
     C                     PARM           ERR     10                      S01117
     C*                                                                   S01117
     C** USER IS NOT AUTHORISED TO ANY ORIGINATING BRANCHES               S01117
     C*
     C           ERR       IFEQ 1                          B005           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '305'     ERCD,S                          S01117
     C                     SETON                     3889                 S01117
     C                     END                             E005           S01117
     C*                                                                   S01117
     C** USER IS NOT AUTHORISED TO THIS ORIGINATING BRANCH                S01117
     C*
     C           ERR       IFEQ 2                          B005           S01117
     C                     ADD  1         S                               S01117
     C                     MOVE '306'     ERCD,S                          S01117
     C                     SETON                     3889                 S01117
     C                     END                             E005           S01117
     C*                                                                   S01117
     C                     END                             E004           S01117
     C*
     C**  IF ORBR USED AND VALID SET UP FILE FIELD                        S01117
     C*
     C           *IN38     IFEQ '0'                                       S01117
     C                     MOVE SORBR     ORBR                            S01117
     C                     END                                            S01117
     C*
     C**  IF NOT USED SINGLE BR OR MBIN DEFAULT TO BOOKING BRANCH         S01117
     C*
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     MOVE BKGBR     ORBR                            S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C**  COLLECTING BANK MANDATORY
     C*
     C                     MOVE *BLANK    COBT
     C                     MOVE *BLANK    ACST1   1                       047179
     C           SCBK1     IFEQ *BLANK                     B003
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 226'    ERCD,S                          S01117
     C                     MOVE ' 019'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*                                                                   S01194
     C** DISALLOW '?' TO AVOID SUBFILE DISPLAYS LATER                     S01194
     C*
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASCBK1     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C           *IN15     IFEQ '1'                                       S01194
     C                     SETON                     4589                 S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 018'    ERCD,S                          S01194
     C                     ELSE                                           S01194
     C*
     C** FORMAT FIRST LINE                                                S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   CHKG   17                       S01117
     C*
     C           *IN20     IFEQ '1'                                       S01117
     C                     MOVELSCBMB     CHKG                            S01117
     C                     ELSE                                           S01117
     C                     MOVELSCBNM     CHKG                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*
     C**  NAME AND ADDRESS ENTERED
     C*
     C           SCBK2     IFNE *BLANK                     B004
     C           SCBK3     ORNE *BLANK
     C           SCBK4     ORNE *BLANK
     C           CHKG      ORNE *BLANK                                    S01117
     C                     MOVE 'A'       COBT
     C*
     C* VALIDATE THE ADDRESS FIELDS
     C*
     C                     SETOF                     919293
     C                     SETOF                     949529
     C*
     C                     MOVE *BLANKS   ADDRSS
     C*
     C                     MOVELSCBK1     ADCHK1
     C                     MOVELSCBK2     ADCHK2
     C                     MOVELSCBK3     ADCHK3
     C                     MOVELSCBK4     ADCHK4
     C                     MOVE *BLANKS   ADCHK5
     C                     MOVE *BLANKS   ADCHK6
     C*
     C                     EXSR ADCHK
     C*
     C** DEPENDING ON THE INDICATORS, HIGHLIGHT THE FIELD IN ERROR
     C** ERROR AND PRODUCE THE ERROR MESSAGE
     C*
     C           *IN91     IFEQ '1'
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 495'    ERCD,S                          S01117
     C                     MOVE ' 026'    ERCD,S                          S01117
     C                     END
     C*
     C           *IN92     IFEQ '1'
     C                     SETON                     452989
     C                     ADD  1         S
     C*********************MOVE ' 494'    ERCD,S                          S01117
     C                     MOVE ' 025'    ERCD,S                          S01117
     C                     END
     C*
     C                     ELSE                            X004
     C*
     C**  VALID FULL ACCOUNT DETAIL
     C*
     C*********************MOVELSCBK1     ACCOHN 15                       S01117
     C*********************MOVE ACCOHN    CHK1    1                       S01117
     C*
     C           *IN20     IFEQ '0'                                       S01117
     C**********           MOVELSCBK1     ACCOHN 15                                    S01117 CGL029
     C                     MOVELSCBK1     ACCOHN 21                                           CGL029
     C                     MOVE ACCOHN    CHK1    1                       S01117
     C                     ELSE                                           S01117
     C**********           MOVELSCBK1     ACCH18 18                                    S01117 CGL029
     C                     MOVELSCBK1     ACCH18 24                                           CGL029
     C                     MOVE ACCH18    CHK1    1                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           CHK1      IFNE *BLANK                     B005
     C*********************MOVE ACCOHN    ACCKY                           S01117
     C*
     C           *IN20     IFEQ '0'                                       S01117
     C                     MOVELACCOHN    ACCKY                           S01117
     C                     MOVELBJSBRC    BRCAK                           S01117
     C                     ELSE                                           S01117
     C                     MOVELACCH18    ACCKY                           S01117
     C                     END                                            S01117
     C*
     C                     EXSR ACCHN
     C*
     C           *IN75     IFEQ '1'                        B006
     C***********          MOVE 'G'       COBT                            179732
     C                     MOVE 'MA'      FULLAC  2                       179732
     C                     MOVE CCYK      CCYWK   3
     C*                                                                   179732
     C           ATYP      IFEQ 'G'                                       179732
     C                     MOVE 'G'       COBT                            179732
     C                     ENDIF                                          179732
     C*                                                                   179732
     C           ATYP      IFEQ 'R'                                       179732
     C           BMRANR    IFEQ 'Y'                        ** B05                             212014
     C                     MOVE 'R'       COBT                            179732
     C                     MOVEL*BLANKS   SCBK1                           179732
     C                     MOVELACNO      SCBK1                           179732
     C                     ELSE                            ** X05                             212014
     C                     MOVE 'G'       COBT                                                212014
     C                     ENDIF                           ** E05                             212014
     C                     ENDIF                                          179732
     C*                                                                   179732
     C           ATYP      IFEQ 'N'                                       179732
     C                     MOVE 'F'       COBT                            179732
     C*                                                                   179732
     C                     CALL 'AONOSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM CNUMKA    @CUST   6                       179732
     C                     PARM CCYK      @CYCD   3                       179732
     C**********           PARM ACODKA    @ACCD   4                                    179732 CGL029
     C                     PARM ACODKA    @ACCD  10                                           CGL029
     C                     PARM ACSQKA    @ACSN   2                       179732
     C                     PARM *BLANKS   @NONB   2                       179732
     C                     PARM BRCAK     @BRCD   3                       179732
     C                     PARM *BLANKS   @CSSN  10                       179732
     C                     PARM *BLANKS   @PNOI   1                       179732
     C           SDNOST    PARM SDNOST    DSSDY                           179732
     C*                                                                   179732
     C           @RTCD     IFEQ *BLANKS                                   179732
     C                     MOVE *BLANKS   SCBK1                           179732
     C                     MOVELA7CYCD    NOSTAC  5                       179732
     C                     MOVE A7NONB    NOSTAC                          179732
     C                     MOVELNOSTAC    SCBK1                           179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
     C*
     C                     ELSE                            X006
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 228'    ERCD,S                          E29887
     C*********************MOVE ' 227'    ERCD,S                    E29887S01117
     C                     MOVE ' 020'    ERCD,S                          S01117
     C                     END                             E006
     C*
     C                     ELSE                            X005
     C*
     C**  VALID RETAIL NUMBER
     C*
      *                                                                   052310
      * If the first 10 characters are numeric and the rest blank then    052310
      * a retail account has been entered.                                052310
      *                                                                   052310
      * Determine the first occurrence of a non-numeric character         052310
      * using DIGITS , a named constant of '0123456789'                   052310
      *                                                                   052310
      * If the 1st alpha is in the 1st 10 characters or after posn 11     052310
      * then it is NOT a retail a/c - no further checks required.         052310
      *                                                                   052310
      * If the first alpha is at posn 11 (the first 10 are all numeric)   052310
      * or if all characters are numeric then perform the check that      052310
      * from 11 onwards all characters are blank.                         052310
      *                                                                   052310
     C           DIGITS    CHECKSCBK1     NO      20     76               052310
      *                                                                   052310
     C           *IN76     IFEQ '1'                        Invalid char   052310
     C           NO        ANDEQ11                                        052310
     C           *IN76     OREQ '0'                        All numeric    052310
     C           ' '       CHECKSCBK1:11                 76               052310
     C                     END                                            052310
      *                                                                   052310
      * If a retail account no. has been entered - chain to ACNUMA        052310
      *                                                                   052310
     C                     MOVE '0'       *IN75                           052310
     C           *IN76     IFEQ '0'                                       052310
     C                     MOVELSCBK1     RETCHN 100
     C                     EXSR RECHN
     C                     END                                            052310
      *
     C           *IN75     IFEQ '1'                        B006
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 024'    ERCD,S                          S01117
     C                     ELSE
     C                     MOVE 'R'       COBT
     C                     MOVE CCY       CCYWK
     C                     END
     C*
     C                     ELSE                            X006
     C*
     C**  VALID CUSTOMER NUMBER
     C**     OR SHORTNAME BY PASSING 1ST 10 CHARS TO ACCESS PROGRAM       S01194
     C*                                                                   S01194
     C*********************MOVELSCBK1     CLICHN  60                      S01194
     C*********************EXSR CLCHN                                     S01194
     C************IN75*****IFEQ '1'                        B007           S01194
     C*********************MOVE 'C'       COBT                            S01194
     C*********************ELSE                            X007           S01194
     C*********************                                               S01194
     C****VALIDATE*AS*A*SHORTNAME**                                       S01194
     C*********************                                               S01194
     C*********************MOVELSCBK1     SNMCHN 10                       S01194
     C*********************EXSR SNCHN                                     S01194
     C*                                                                   S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SCBK1     @KEY1  10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCUST         75    EQ         S01194
     C                     END                                            S01194
     C*
     C           *IN75     IFEQ '1'                        B008
     C                     MOVE 'C'       COBT
     C                     MOVE *BLANKS   SCBK1
     C                     MOVELCNUM      SCBK1
     C                     ELSE                            X008
     C*
     C**  VALID NOSTRO DETAILS
     C*
     C                     MOVELSCBK1     NOSCHN  5
     C                     MOVE SCBK1     CHK30  30                       E22950
     C                     MOVE '0'       *IN75
     C*
     C           CHK30     IFEQ *BLANKS                    B009           E22950
     C                     EXSR NOCHN
     C                     END                             E009           E22950
     C*
     C           *IN75     IFEQ '1'                        B009
     C           SCBNF     ANDEQ*BLANKS                                   S01117
     C                     MOVE 'F'       COBT
     C                     MOVELNOSCHN    CCYWK
     C**
     C*    STORE FIELDS FOR KEY TO ACCNT
     C**
     C**********           Z-ADDCNUM      CNUMSV  60                                          CSD027
     C                     MOVE CNUM      CNUMSV  6                                           CSD027
     C                     MOVE CCYWK     CCYSV   3
     C**********           Z-ADDACOD      ACODSV  40                                          CGL029
     C                     Z-ADDACOD      ACODSV 100                                          CGL029
     C                     Z-ADDACSQ      ACSQSV  20
     C                     MOVE BRCA      BRCASV  3                       S01117
     C*
     C                     ELSE                            X009
     C*
     C**  INVALID COLLECTING BANK
     C*
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 227'    ERCD,S                          S01117
     C                     MOVE ' 020'    ERCD,S                          S01117
     C                     END                             E009
     C*
     C                     END                             E008
     C*
     C                     END                             E007
     C*
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C**  IF COLLECTING BANK IS AN ACCOUNT/NOSTRO MUST BE IN SETTLE
     C**    CURRENCY IF RECEIVERS CORRESPONDENT NOT ENTERED
     C*
     C           *IN45     IFEQ '0'                        B003
     C           SRCCO     ANDEQ*BLANK
     C*
     C           COBT      IFEQ 'G'                        B004
     C           COBT      OREQ 'R'
     C           COBT      OREQ 'F'
     C*
     C           CCYWK     IFNE SSMCY                      B005
     C                     SETON                     4589
     C                     ADD  1         S
     C*********************MOVE ' 339'    ERCD,S                          S01117
     C                     MOVE ' 021'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C*  IF A VALID ACCOUNT HAS BEEN ENTERED STORE THE ACCOUNT TYPE AND
     C*     THE DATE THE ACCOUNT WAS OPENED
     C*
     C           *IN45     IFEQ '0'                        B003
     C*
     C           COBT      IFEQ 'F'                        B004
     C           COBT      OREQ 'R'
     C           COBT      OREQ 'G'
     C*
     C*  FOR A NOSTRO FIRST ACCESS THE ACCNT RECORD
     C*
     C           COBT      IFEQ 'F'                        B005
     C           FULLAC    ANDEQ*BLANKS                                   179732
     C                     EXSR ACHAIN
     C                     END                             E005
     C*
     C                     MOVE ATYP      ATYP1   1
     C                     MOVE ACST      ACST1                           047179
     C                     Z-ADDDACO      DACO1   50
     C*
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C*
     C**  SETUP OUTPUT FIELDS
     C*
     C           *IN45     IFEQ '0'                        B003
     C                     MOVE SCBK1     COB1
     C*                                                                   S01117
     C**  IF SINGLE-BRANCHED AND COLLECTING BANK IS FULL ACCOUNT          S01117
     C**    SET BRANCH (POS 16-18 OF COB1) TO THE SINGLE BRANCH CODE      S01117
     C*
     C           *IN20     IFEQ '0'                                       S01117
     C           COBT      ANDEQ'G'                                       S01117
     C                     MOVE BJSBRC    COBBR                           S01117
     C                     END                                            S01117
     C*
     C                     MOVE SCBK2     COB2
     C                     MOVE SCBK3     COB3
     C                     MOVE SCBK4     COB4
     C                     END                             E003
     C*
     C**  RECEIVERS CORRESPONDENT MANDATORY IF COLLECTING
     C**  BANK DOES NOT CONTAIN ACCOUNT DETAILS
     C*
     C***********          Z-ADD0         RCCO                                                CSD027
     C                     MOVE *BLANKS   RCCO                                                CSD027
     C           COBT      IFEQ 'A'                        B003
     C           COBT      OREQ 'C'
     C           SRCCO     IFEQ *BLANK                     B004
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 229'    ERCD,S                          S01117
     C                     MOVE ' 028'    ERCD,S                          S01117
     C                     END                             E004
     C                     END                             E003
     C*
     C**  IF SOMETHING ENTERED IN RECEIVER'S CORRESPONDENT
     C*
     C                     MOVE *BLANK    RCRT
     C                     MOVE *BLANK    ACST2   1                       047179
     C           SRCCO     IFNE *BLANK                     B003
     C*
     C** THERE MUST BE NO EMBEDDED SPACES IN THE FIELD
     C*
     C                     MOVEL*BLANKS   YA3
     C                     MOVEASRCCO     YA3,1
     C*
      * Save values of indicators                                         CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVEA*IN,80    #IN80   2                       CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     SETOF                     8081
     C                     Z-ADD1         I1
     C*
     C           *IN81     DOUEQ'1'                        B004
     C           I1        ORGT 10
     C*
     C           YA3,I1    IFEQ *BLANKS                    B005
     C                     SETON                     80
     C                     ELSE                            X005
     C*
     C           *IN80     IFEQ '1'                        B006
     C                     SETON                     81
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     ADD  1         I1
     C                     END                             E004
     C*
     C**  CHECK IF 1 CHAR LONG
     C*
     C           *IN81     IFEQ '0'                        B004
     C           YA3,2     ANDEQ*BLANKS
     C                     MOVE '1'       *IN81
     C                     END                             E004
     C*
     C**  CHECK IF 3 TO 9 CHARS LONG
     C*
     C                     MOVE '0'       *IN82
     C           *IN81     IFEQ '0'                        B004
     C           YA3,10    ANDEQ*BLANK
     C                     MOVE '1'       *IN82
     C*
     C           3         DO   9         I1               B005
     C*
     C           YA3,I1    IFNE *BLANK                     B006
     C                     MOVE '1'       *IN81
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C**  IF NOT 2 OR 10 CHARACTERS OR THERE ARE EMBEDDED BLANKS THEN
     C****ERROR*108*AND*DONT*BOTHER*CHECKING*ANYTHING*ELSE*               S01117
     C**  ERROR 027 AND DONT BOTHER CHECKING ANYTHING ELSE                S01117
     C**  ERROR 027 IF '?' ENTERED ALSO                                   S01194
     C*
     C           '?'       LOKUPYA3                      15               S01194
     C*                                                                   S01194
     C           *IN81     IFEQ '1'
     C           *IN15     OREQ '1'                                       S01194
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 108'    ERCD,S                          S01117
     C                     MOVE ' 027'    ERCD,S                          S01117
     C                     GOTO SKPERR
     C                     END
      * Save values of indicators                                         CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVEA#IN80     *IN,80                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C*
     C** INDICATOR 82 ON MEANS IT IS A NOSTRO, ELSE IS A RETAIL
     C*
     C           *IN82     IFEQ '1'                        B004
     C                     MOVELSSMCY     NOSCHN
     C                     MOVELSRCCO     NOSCH   2
     C                     MOVE NOSCH     NOSCHN
     C                     EXSR NOCHN
     C*
     C           *IN75     IFEQ '1'                        B005
     C                     MOVE 'N'       RCRT
     C                     MOVE SRCCO     RCCO
     C**
     C*    STORE FIELDS FOR KEY TO ACCNT
     C**
     C**********           Z-ADDCNUM      CNUMSV  60                                          CSD027
     C                     MOVE CNUM      CNUMSV  6                                           CSD027
     C                     MOVE SSMCY     CCYSV   3
     C**********           Z-ADDACOD      ACODSV  40                                          CGL029
     C                     Z-ADDACOD      ACODSV                                              CGL029
     C                     Z-ADDACSQ      ACSQSV  20
     C                     MOVE BRCA      BRCASV  3                       S01117
     C*
     C                     ELSE                            X005
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 230'    ERCD,S                          S01117
     C                     MOVE ' 029'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C                     ELSE                            X004
     C*
     C**  CHECK FOR VALID RETAIL ACCOUNT NUMBER
     C*
     C                     MOVE SRCCO     RETCHN
     C                     EXSR RECHN
     C*
     C           *IN75     IFEQ '1'                        B005
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 024'    ERCD,S                          S01117
     C                     ELSE
     C*
     C**  CHECK FOR INVALID RETAIL ACCOUNT CURRENCY
     C*
     C           CCY       IFNE SSMCY                      B006
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 232'    ERCD,S                          S01117
     C                     MOVE ' 031'    ERCD,S                          S01117
     C                     ELSE                            X006
     C                     MOVE 'R'       RCRT
     C                     MOVE SRCCO     RCCO
     C                     END                             E006
     C*
     C                     END
     C*
     C**  INVALID RETAIL NUMBER
     C*
     C                     ELSE                            X005
     C                     SETON                     4689
     C                     ADD  1         S
     C*********************MOVE ' 231'    ERCD,S                          S01117
     C                     MOVE ' 030'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C           SKPERR    TAG
     C*
     C*  IF A VALID ACCOUNT HAS BEEN ENTERED STORE THE ACCOUNT TYPE AND
     C*     THE DATE THE ACCOUNT WAS OPENED
     C*
     C           *IN46     IFEQ '0'                        B003
     C*
     C           RCRT      IFEQ 'N'                        B004
     C           RCRT      OREQ 'R'
     C*
     C*  FOR A NOSTRO FIRST ACCESS THE ACCNT RECORD
     C*
     C           RCRT      IFEQ 'N'                        B005
     C                     EXSR ACHAIN
     C                     END                             E005
     C*
     C                     MOVE ATYP      ATYP2   1
     C                     MOVE ACST      ACST2                           047179
     C                     Z-ADDDACO      DACO2   50
     C*
     C                     END                             E004
     C                     END                             E003
     C*
     C*
     C**  SETTLE CURRENCY MANDATORY
     C**  BUT FIRST SET INDICATOR FOR ENTRY OF '?'                        S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASSMCY     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C   15                SETON                     16                   S01194
     C*                                                                   S01194
     C**  CHECK IF SETTLE CURRENCY IS VALID ON SDCURRPD                   S01194
     C*
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SSMCY     @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCURR     7575  HILO           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ '*NOSEL'                                  S01194
     C                     MOVE *BLANKS   SSMCY                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A6CYCD    SSMCY                           S01194
     C                     END                                            S01194
     C*
     C           SSMCY     IFEQ *BLANK                     B003
     C                     SETON                     4789
     C                     ADD  1         S
     C*********************MOVE ' 233'    ERCD,S                          S01117
     C                     MOVE ' 035'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*
     C****CHECK*IF*SETTLE*CURRENCY*IS*VALID*ON*CURRENCIES*TABLE***        S01194
     C*********************                                               S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELSSMCY     SCCY                            S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C*********************SETOF                     75                   S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '0'                        B004           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E004           S01194
     C*
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     4789
     C                     ADD  1         S
     C*********************MOVE ' 047'    ERCD,S                          S01117
     C                     MOVE ' 034'    ERCD,S                          S01117
     C                     ELSE                            X004
      *                                                                   CEU006
      ** Settle currency is valid - save fields to work fields            CEU006
      ** for header screen processing                                     CEU006
     C           *LIKE     DEFN A6INCY    @1INCY                          CEU006
     C           *LIKE     DEFN A6EUER    @1EUER                          CEU006
     C           *LIKE     DEFN A6TPSD    @1TPSD                          CEU006
     C           *LIKE     DEFN A6TPED    @1TPED                          CEU006
     C           *LIKE     DEFN A6NBDP    @1NBDP                          CEU006
     C                     MOVE A6INCY    @1INCY                          CEU006
     C                     Z-ADDA6EUER    @1EUER                          CEU006
     C                     Z-ADDA6TPSD    @1TPSD                          CEU006
     C                     Z-ADDA6TPED    @1TPED                          CEU006
     C                     Z-ADDA6NBDP    @1NBDP                          CEU006
      *                                                                   CEU006
     C                     MOVE SSMCY     SMCY
     C*
     C*********************Z-ADDCDP       PCDP    10                      S01194
     C*********************Z-ADDSPOT      PSPOT  138                      S01194
     C*********************Z-ADDMDIN      PMDIN  1                        S01194
     C*********************MOVE '4'       TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG40F             75                   S01194
     C***********BSSG******IFEQ '+'                        B005           S01194
     C***********SPOT******ADD  BSPR      PBRAT  138                      S01194
     C*********************ELSE                            X005           S01194
     C***********SPOT******SUB  BSPR      PBRAT                           S01194
     C*********************END                             E005           S01194
     C**CHANGE*SPOT*RATE*BY SELL SPREAD                                   S01194
     C***********SSSG******IFEQ '+'                        B005           S01194
     C***********SPOT******ADD  SSPR      PSRAT  138                      S01194
     C*********************ELSE                            X005           S01194
     C***********SPOT******SUB  SSPR      PSRAT                           S01194
     C*********************END                             E005           S01194
     C*********************END                             E004           S01194
     C*********************END                             E003           S01194
     C*
     C*                                                                   S01194
     C                     Z-ADDA6NBDP    PCDP    10                      S01194
     C                     Z-ADDA6SPRT    PSPOT  138                      S01194
     C                     Z-ADDMDIN      PMDIN   10                      S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B005           S01194
     C           A6SPRT    ADD  A6BYSR    PBRAT  138                      S01194
     C                     ELSE                            X005           S01194
     C           A6SPRT    SUB  A6BYSR    PBRAT                           S01194
     C                     END                             E005           S01194
     C*
     C* CHANGE SPOT RATE BY SELL SPREAD                                   S01194
     C*
     C           A6SLSS    IFEQ '+'                        B005           S01194
     C           A6SPRT    ADD  A6SLSR    PSRAT  138                      S01194
     C                     ELSE                            X005           S01194
     C           A6SPRT    SUB  A6SLSR    PSRAT                           S01194
     C                     END                             E005           S01194
     C*
     C                     END                             E004           S01194
     C                     END                             E003           S01194
     C*                                                                   S01194
     C**  SETTLE VALUE DATE MANDATORY
     C*  - AND MUST ALSO BE GREATER OR EQUAL TO CURRENT PROCESSING DATE   E32859
     C*
     C           SPYVD     IFEQ *BLANK                     B003
     C                     SETON                     4889
     C                     ADD  1         S
     C*********************MOVE ' 234'    ERCD,S                          S01117
     C                     MOVE ' 037'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*
     C**  CHECK DATE FORMAT
     C*
     C* CHECK IF DATE IS NUMERIC
     C*
     C                     MOVELSPYVD     DATEL   70
     C                     MOVELDATEL     DATES   6
     C*
     C           SPYVD     IFNE DATES                      B004
     C                     SETON                     99
     C                     ELSE                            X004
     C                     MOVE SPYVD     ZDATE
     C                     EXSR ZDATE1
      *                                                                   E32543
      ** THE SETTLE DATE MUST NOT BE A HOLIDAY IN LOCAL CURRENCY          E32543
      *                                                                   E32543
     C                     MOVE BJLCCY    ZCCY                            E32543
     C                     EXSR ZCHKH                                     E32543
      *                                                                   E32543
      ** if ZIND = 'H' then the date is a holiday                         E32543
      *                                                                   E32543
     C           ZIND      IFEQ 'H'                        B005           E32543
     C*********************SETON                     1926           E32543E37067
     C                     SETON                     192689               E37067
     C                     ADD  1         S                               E32543
     C*********************MOVEA' W11'    ERCD,S                    E32543S01117
     C                     MOVEA' W01'    ERCD,S                          S01117
     C                     ELSE                            X005           E32543
     C                     SETOF                     26                   E32543
     C                     END                             E005           E32543
      *                                                                   E32543
     C                     END                             E004
      *
     C           *IN99     IFEQ '0'                        B004
     C*                                                                   E32859
     C* CHECK IF PAY VALUE DATE IS GREATER OR EQUAL THAN TODAY'S DATE     E32859
     C*                                                                   E32859
     C***********ZDAYNO****IFLT RUND                       ** B04.1 E32859S01194
     C/COPY WNCPYSRC,FT0070C029
     C           ZDAYNO    IFLT BJRDNB                     ** B04.1       S01194
     C           HDSTAT    ANDNE'M'                                                        AR1008672
     C                     ADD  1         S                               E32859
     C*********************MOVE ' 235'    ERCD,S                    E32859S01117
     C                     MOVE ' 038'    ERCD,S                          S01117
     C                     SETON                     4889                 E32859
     C                     ELSE                            ** X04.1       E32859
     C                     Z-ADDZDAYNO    SLDT
     C                     END                             ** E04.1       E32859
     C/COPY WNCPYSRC,FT0070C030
     C*                                                                   E32859
     C                     ELSE                            X004
     C                     SETON                     4889
     C                     ADD  1         S
     C*********************MOVE ' 055'    ERCD,S                          S01117
     C                     MOVE ' 036'    ERCD,S                          S01117
     C                     END                             E004
     C                     END                             E003
      *                                                                   047179
      *  Check if settle date is in the future and if the account is      047179
      *  closing today (if settle date is valid)                          047179
      *                                                                   047179
     C           *IN48     IFEQ '0'                                       047179
      *                                                                   047179
     C           SLDT      IFGT BJRDNB                                    047179
     C           ACST1     ANDEQ'C'                                       047179
     C                     ADD  1         S                               047179
     C                     MOVE ' 601'    ERCD,S                          047179
     C                     SETON                     4589                 047179
     C                     END                                            047179
      *                                                                   047179
     C           SLDT      IFGT BJRDNB                                    047179
     C           ACST2     ANDEQ'C'                                       047179
     C                     ADD  1         S                               047179
     C                     MOVE ' 602'    ERCD,S                          047179
     C                     SETON                     4689                 047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
      *                                                                   CEU006
      ** Validate Notified delivery currency                              CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           *IN47     ANDEQ*OFF                                      CEU006
      *                                                                   CEU006
     C           SNDCY     IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
     C           @1INCY    IFNE 'Y'                                       CEU006
     C           SSMCY     ANDNEBKEURO                                    CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN02                           CEU006
     C                     MOVEL'FTM2589' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD   7                       CEU006
     C                     PARM '*KEY   ' @OPTN   7                       CEU006
     C                     PARM SNDCY     @CURR   3                       CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD43        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      * Currency valid                                                    CEU006
     C           @1INCY    IFEQ 'Y'                                       CEU006
     C           SNDCY     ANDNEBKEURO                                    CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN02                           CEU006
     C                     MOVEL'FTM2590' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
     C           A6INCY    IFNE 'Y'                                       CEU006
     C           SSMCY     ANDEQBKEURO                                    CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN02                           CEU006
     C                     MOVEL'FTM2591' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      ** Validate Notified delivery amount                                CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SNDAM     ANDNE*BLANKS                                   CEU006
     C           SNDCY     ANDEQ*BLANKS                                   CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN88                           CEU006
     C                     MOVE *ON       *IN02                           CEU006
     C                     MOVEL'FTM2592' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      ** Validate settle date against EMU transition period start date    CEU006
      ** (where one or both of Settle and Notified delivery currency      CEU006
      ** are "In" currencies)                                             CEU006
      *                                                                   CEU006
     C           *IN26     IFEQ '0'                                       CEU006
     C           *IN48     ANDEQ'0'                                       CEU006
     C           CEU006    ANDEQ'Y'                                       CEU006
     C           SNDCY     ANDNE*BLANKS                                   CEU006
      *                                                                   CEU006
     C           @1INCY    IFEQ 'Y'                                       CEU006
     C           @1TPSD    ANDGTSLDT                                      CEU006
     C           A6INCY    OREQ 'Y'                                       CEU006
     C           A6TPSD    ANDGTSLDT                                      CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN48                           CEU006
     C                     MOVEL'FTM2593' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
     C*
     C**  IF PARTIES AND DATE ARE VALID SO FAR, FOR RETAIL ACCOUNTS ONLY
     C**  CHECK THAT THE SETTLE VALUE DATE IS NOT BEFORE THE BACK-VALUE
     C**  LIMIT DATE NOR BEFORE THE ACCOUNT WAS OPENED FOR THE
     C**  ACCOUNT THAT MUST BE IN SETTLE CCY
     C*
     C           *IN45     IFEQ '0'                        B003
     C           *IN46     OREQ '0'
     C           *IN48     OREQ '0'
     C*
     C           SRCCO     IFEQ *BLANKS                    B004
     C* USE COLLECTING BANK FIELDS
     C*
     C           ATYP1     IFEQ 'R'                        B005
     C*
     C           SLDT      IFLT BVLD                       B006
     C                     ADD  1         S
     C*********************MOVE ' 369'    ERCD,S                          S01117
     C                     MOVE ' 023'    ERCD,S                          S01117
     C                     SETON                     4589
     C                     ELSE                            X006
     C*
     C           SLDT      IFLT DACO1                      B007
     C                     ADD  1         S
     C*********************MOVE ' 354'    ERCD,S                          S01117
     C                     MOVE ' 022'    ERCD,S                          S01117
     C                     SETON                     4589
     C                     END                             E007
     C*
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     ELSE                            X004
     C*
     C* USE RECEIVER'S CORRESPONDENT FIELDS
     C*
     C           ATYP2     IFEQ 'R'                        B005
     C*
     C           SLDT      IFLT BVLD                       B006
     C                     ADD  1         S
     C*********************MOVE ' 363'    ERCD,S                          S01117
     C                     MOVE ' 033'    ERCD,S                          S01117
     C                     SETON                     4689
     C                     ELSE                            X006
     C*
     C           SLDT      IFLT DACO2                      B007
     C                     ADD  1         S
     C*********************MOVE ' 348'    ERCD,S                          S01117
     C                     MOVE ' 032'    ERCD,S                          S01117
     C                     SETON                     4689
     C                     END                             E007
     C*
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     END                             E004
     C                     END                             E003
     C**
     C/COPY WNCPYSRC,FT0070C031
     C*
     C**  TOTAL CHEQUE AMOUNT MANDATORY
     C*
     C           STCQA     IFEQ *BLANK                     B003
     C                     SETON                     4989
     C                     ADD  1         S
     C*********************MOVE ' 236'    ERCD,S                          S01117
     C                     MOVE ' 039'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*
     C**  VALIDATE TOTAL AMOUNT FOR DECIMAL PLACES
     C*
     C           13        SUB  PCDP      ZADIG
     C                     Z-ADDPCDP      ZADEC
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE STCQA     ZFIELD
     C                     EXSR ZALIGN
     C*
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     4989
     C                     ADD  1         S
     C*********************MOVE ' 237'    ERCD,S                          S01117
     C                     MOVE ' 040'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    TOCL
     C                     END                             E004
     C                     END                             E003
      *                                                                   CEU006
      ** Cross validation of currencies and amounts                       CEU006
      *                                                                   CEU006
     C           *IN47     IFEQ *OFF                                      CEU006
     C           *IN02     ANDEQ*OFF                                      CEU006
      ** All currencies valid                                             CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           13        SUB  PCDP      ZADIG                           CEU006
     C                     Z-ADDA6NBDP    ZADEC                           CEU006
     C                     MOVE *BLANKS   ZFIELD                          CEU006
     C                     MOVE SNDAM     ZFIELD                          CEU006
     C                     EXSR ZALIGN                                    CEU006
      *                                                                   CEU006
     C           *IN99     IFEQ '1'                                       CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN88                           CEU006
     C                     MOVEL'FTM2594' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ELSE                                           CEU006
     C                     MOVE ZFIELD    WNDAM  130                      CEU006
      ** Call FT0010 if Notified delivery amount valid                    CEU006
      ** and Total collection amount valid                                CEU006
      ** and Settle value date valid                                      CEU006
     C           *IN49     IFEQ *OFF                                      CEU006
     C           *IN48     ANDEQ*OFF                                      CEU006
      *                                                                   CEU006
      ** Set paramaters for call to FT0010                                CEU006
      *                                                                   CEU006
     C                     CLEARP#0010                                    CEU006
      *                                                                   CEU006
     C                     MOVEL'FT0070'  P#PMSQ                          CEU006
      *                                                                   CEU006
     C                     MOVE SNDCY     P#NDCY                          CEU006
     C                     Z-ADDWNDAM     P#NDAM                          CEU006
     C                     MOVE SSMCY     P#DBCY                          CEU006
     C                     Z-ADDTOCL      P#DBAM                          CEU006
     C                     Z-ADDSLDT      P#DBDT                          CEU006
     C                     MOVE 'Y'       P#SDIN                          CEU006
     C                     MOVE BTPCRD    P#RTDS                          CEU006
      *                                                                   CEU006
     C                     CALL 'FT0010'                                  CEU006
     C                     PARM           P#0010                          CEU006
      *                                                                   CEU006
     C           P#RTCD    IFNE *BLANK                                    CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD41        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      * Set screen error indicator                                        CEU006
     C           '1'       SCAN P#INDC:1  RESULT  10                      CEU006
      *                                                                   CEU006
     C           RESULT    IFGT 0                                         CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      * Set screen indicators - Notified delivery amount                  CEU006
     C           1         SUBSTP#INDC:1  *IN88                           CEU006
      * Set screen indicator  - Total collection amount                   CEU006
     C           1         SUBSTP#INDC:2  *IN49                           CEU006
      *                                                                   CEU006
     C           *IN89     IFEQ *OFF                                      CEU006
      *                                                                   CEU006
      * Notified delivery amount                                          CEU006
     C           P#NDAM    IFNE 0                                         CEU006
     C                     Z-ADDA6NBDP    PCDP    10                      CEU006
     C           13        SUB  PCDP      WDIG    20                      CEU006
     C                     Z-ADDPCDP      WDEC    10                      CEU006
     C                     MOVE P#NDAM    WFDIN                           CEU006
     C                     EXSR FAMTSR                                    CEU006
     C                     MOVE WFDOUT    SNDAM                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE P#NDCY    NDCY                            CEU006
     C                     Z-ADDP#NDAM    NDAM                            CEU006
      *                                                                   CEU006
      * Total collection amount                                           CEU006
     C           P#DBAM    IFNE 0                                         CEU006
     C                     Z-ADD@1NBDP    PCDP    10                      CEU006
     C           13        SUB  PCDP      WDIG    20                      CEU006
     C                     Z-ADDPCDP      WDEC    10                      CEU006
     C                     MOVE P#DBAM    WFDIN                           CEU006
     C                     EXSR FAMTSR                                    CEU006
     C                     MOVE WFDOUT    STCQA                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   STCQA                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE P#DBCY    SMCY                            CEU006
     C                     Z-ADDP#DBAM    TOCL                            CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   S01414
      ** Check Book Code field for entry of ?                             S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASHBOKC    FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     15               S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN16                           S01414
     C*
     C/COPY WNCPYSRC,FT0070CCP1
     C*
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     CALL 'AOBOOKR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDBOOK    SHBOKC                          S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SHBOKC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Book Code.                                          S01414
      *                                                                   S01414
     C                     MOVELSHBOKC    W#BOKC                          S01414
     C                     EXSR SRBOOK                                    S01414
     C                     MOVELW#BOKC    SHBOKC                          S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN83     IFEQ '0'                                       S01414
     C                     MOVELW#BOKC    HBOKC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Check Profit Centre field for entry of ?                         S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASHPRFC    FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     15               S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN16                           S01414
     C*
     C/COPY WNCPYSRC,FT0070CCP2
     C*
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     CALL 'AOPRFCR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDPRFC    SHPRFC                          S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SHPRFC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Profit Centre if Used.                              S01414
      *                                                                   S01414
     C                     MOVELSHPRFC    W#PRFC                          S01414
     C                     EXSR SRPRFC                                    S01414
     C                     MOVELW#PRFC    SHPRFC                          S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN86     IFEQ '0'                                       S01414
     C                     MOVELW#PRFC    HPRFC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0070CVSF                                           S01408
     C*                                                                   S01408
      *  END of screen validation
      *
     C                     END                             E002
      *                                                                                    AR1031132
      ** Do not redisplay screen in DELETE mode                                            AR1031132
      *                                                                                    AR1031132
     C           SACTD     IFNE 'D'                                                        AR1031132
     C           *IN04     ORNE '1'                                                        AR1031132
     C                     WRITEFT0070F2                                                    BUG10569
     C                     READ FT0070F2                 75                                 BUG10569
     C                     ENDIF                                                           AR1031132
      *                                                                                    AR1031132
     C/COPY WNCPYSRC,FT0070C032
     C*
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
     C*                                                                   E32543
     C           *IN19     IFEQ '1'                                       E32543
     C*                                                                   E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
     C*                                                                   E32543
     C           *IN22     IFEQ '1'                                       E32543
     C           SPYVD     ANDEQSPYVO                                     E32543
     C                     SETOF                     192226               E32543
     C                     SUB  1         S                               E32543
     C*                                                                   E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
     C*                                                                   E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SPYVD     SPYVO   6                       E32543
     C                     END                                            E32543
     C*                                                                   E32543
     C                     END                                            E32543
      *                                                                   E32543
     C           S         IFEQ 0                                         E32543
     C           *IN02     IFEQ *OFF                                      CEU006
     C           *IN88     ANDEQ*OFF                                      CEU006
     C           *IN48     ANDEQ*OFF                                      CEU006
     C                     SETOF                     89                   E32543
     C                     ENDIF                                          CEU006
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C*
     C**  ERROR IF A DELETE SCREEN AND NOT F10 - RE-OUTPUT SCREEN
     C**    BUT WITHOUT ERROR CODES
      *
     C                     SETOF                     87
     C/COPY WNCPYSRC,FT0070C016
      *
     C           SACTD     IFEQ 'D'                        B002
     C           *IN04     ANDEQ'0'
     C                     SETON                     8789
     C                     END                             E002
     C*
     C**  ERRORS FOUND RE-OUTPUT SCREEN
     C*
     C           *IN89     IFEQ '1'                        B002
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C*
     C* If DELETE screen without F10 setof 89
     C*
     C           *IN87     IFEQ '1'                        B003
     C                     SETOF                       89
     C                     END                             E003
     C*
     C* SETON INDICATOR 69 TO PROTECT HEADER CURRENCY IF AMEND
     C* AND A CHEQUE DETAIL HAS BEEN ENTERED
     C*
     C           SACTD     IFEQ 'A'                        B004
     C           NCSQ      ANDNE0
     C                     SETON                     69
     C                     ELSE                            X004
     C                     SETOF                     69
     C                     END                             E004
      *                                                                   058194
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *
     C                     WRITEFT0070F2
      *
     C************IN11*****DOUEQ'0'                        B003           S01199
      *
     C                     READ FT0070F2                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETOF                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     WRITEFT0070F2                                  S01494
     C                     READ FT0070F2                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *
     C************IN11*****IFEQ '1'                        B004           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E004           S01199
     C*********************END                             E003           S01199
      *
     C                     END                             E002
     C*
     C**  IF NO ERRORS PROGRESS TO NEXT SCREEN AND UPDATE RECORDS
     C*
     C           *IN87     IFEQ '0'                        B002
     C           *IN89     IFEQ '0'                        B003
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C           *IN07     ANDEQ'0'                                       E29970
     C                     SETOF                     75
      *
     C           SACTD     IFEQ 'A'                        B004
     C           SACTD     OREQ 'D'
     C                     SETON                     12
     C                     MOVE *BLANK    @RETC
     C                     END                             E004
      *
      * If Insert, Amend or Delete update file
      *
     C           SACTD     IFNE 'E'                        B004
     C                     EXSR UPDAT1
     C                     END                             E004
      *
     C                     EXSR STATUS
     C/COPY WNCPYSRC,FT0070C040
      *
     C           SACTD     IFNE 'A'                        B004
     C           SACTD     ANDNE'D'
     C                     EXSR NXDET
     C                     MOVE PREF      SPREF
      *
     C           SACTD     IFEQ 'E'                        B005
     C                     Z-ADD1         CQSQK
     C*                                                                   043715
     C* IF RECORD WASN'T FOUND LOOK FOR NEXT RECORD                       043715
     C*                                                                   043715
     C                     MOVE '0'       *IN74                           043715
      *
     C           *IN75     DOUEQ'0'                                       043715
     C           *IN74     OREQ '1'                                       043715
     C*                                                                   043715
     C           CQCHNK    CHAINCQCOCDDF             75
      *
     C           *IN75     IFEQ '0'                        B006
     C                     EXCPTRCQCOC
     C                     MOVE RECI      RECIS
     C                     EXSR STATUS
     C                     EXSR DCONV
     C                     ELSE                            X006
     C*                                                                   043715
     C*    IF 50TH RECORD HAS BEEN PROCESSED TERMINATE LOOP               043715
     C*                                                                   043715
     C           CQSQK     IFGE 50                                        043715
     C                     MOVE '1'       *IN74                           043715
     C                     SETON                     12
     C                     MOVE *BLANK    @RETC
     C                     ELSE                                           043715
     C                     ADD  1         CQSQK                           043715
     C                     END                                            043715
     C*                                                                   043715
     C                     END                             E006
      *
     C                     END                                            043715
      *
     C                     END                             E005
      *
     C           *IN75     IFEQ '0'                        B005
     C*
     C**  OUTPUT DEFAULTS TO DETAIL SCREEN FT0070F3
     C*
     C           SACTD     IFEQ 'I'                        B006
     C*
     C******************** MOVE SSMCY     SCCCY                           E21459
     C***********          MOVE SSMCY     SECCY                     E21459063918
      *                                                                   063918
      * If charge code set to "C" reset entry currency to blank           063918
      *                                                                   063918
     C           BTCHCY    IFEQ 'C'                                       063918
     C                     MOVE *BLANKS   SECCY                           063918
     C                     END                                            063918
     C*
     C           BTCHCY    IFEQ 'B'                        B007           S01194
     C                     MOVE BJCYCD    SECCY                           S01194
     C                     ELSE                            X007           S01194
     C*
     C           BTCHCY    IFEQ 'L'                        B008           S01194
     C                     MOVE BJLCCY    SECCY                           S01194
     C                     END                             E008           S01194
     C*                                                                   S01194
     C***********FTCC******IFEQ 'B'                        B007           S01194
     C*********************MOVE BCCY      SECCY                           S01194
     C*********************ELSE                            X007           S01194
     C***********FTCC******IFEQ 'L'                        B008           S01194
     C*********************MOVE LOCY      SECCY                           S01194
     C*********************END                             E008           S01194
     C*
     C                     END                             E007
      *                                                                                     AR940742
     C           BTCHCY    IFEQ 'F'                                                         AR940742
     C                     MOVE FCHCCY    SECCY                                             AR940742
     C                     END                                                              AR940742
     C*
     C                     EXSR PYCHG                                     S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,FT0070C038
     C                     MOVE DFTRCT    STCTF
     C/COPY WNCPYSRC,FT0070C024
     C***********          MOVE DAFDT1    SCVDA                           049860
     C*
     C***EXTEND INSERT IF CONDITION TO INCLUDE CHEQUE SEQ                 E23603
     C***INCREMENTATION                                                   E23603
     C*                                                                   E23603
     C*********************END                             E006           E23603
     C*                                                                   E22952
     C**  To display the cheque sequence number                           E22952
     C*
     C           CQSQ      ADD  1         CQSQCS  20                      E22952
     C                     MOVE CQSQCS    SCQSQ                           E22952
     C                     END                                            E23603
     C*                                                                   E22952
      * Display message subfile                                           058194
      *                                                                   058194
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVEL'1'       *IN76                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'0'       *IN76                                               CER049
     C                     ENDIF                                                              CER049
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C060
      *                                                                                     AR804457
     C           SACTD     IFEQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     SETOF                     76                                     AR804457
     C                     ENDIF                                                            AR804457
     C           SACTD     IFEQ 'E'                                                         AR804457
     C                     SETON                     76                                     AR804457
     C                     SETON                     79                                    AR1008672
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C                     WRITEFT0070F3
     C*
     C************IN11*****DOUEQ'0'                        B006           S01199
     C*
     C                     READ FT0070F3                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETON                     17                   S01494
     C                     SETON                     76                                     AR804457
     C                     SETON                     79                                    AR1008672
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     SETOF                     12                   S01494
     C/COPY WNCPYSRC,FT0070C061
     C                     WRITEFT0070F3                                  S01494
     C                     READ FT0070F3                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C**                                                                  S01199
     C************IN11*****IFEQ '1'                        B007           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E007           S01199
     C*********************END                             E006           S01199
     C***********                                                         058194
     C**IF*ENQUIRE AND WINDOW REQUIRED, PERFORM WINDOW CALL         S01241058194
     C***********                                                         058194
     C***********SACTD     IFEQ 'E'                                 S01241058194
     C***********BGL5ST****IFEQ 'Y'                           S01241S01251058194
     C***********BGWDPR    IFEQ 'Y'                                 S01251058194
     C***********                                                         058194
      *****/copy*to move data into the data structure fields passed S01241058194
      ******as*a*parameter to the window controller                 S01241058194
      */COPY*QWINDSRC,FT0070MOV1                                          058194
      ***********                                                   S01241058194
     C***********          MOVE SACTD     #ACTN   1                 S01241058194
     C***********          MOVE *BLANKS   RTNCDE  7                 S01241058194
     C***********          MOVE *BLANKS   ##CMD   2                 S01241058194
     C***********          MOVEL'FT0070'  ##PGM  10                 S01241058194
     C***********          CALL 'WN0010'                            S01241058194
     C***********          PARM           ##PGM                     S01241058194
     C***********          PARM           ##CMD                     S01241058194
     C***********          PARM           #ACTN                     S01241058194
     C***********          PARM           DATA                      S01241058194
     C*********************PARM           RTNCDE              S01241S01252058194
     C***********          PARM *BLANKS   RTNCDE                    S01252058194
     C***********          PARM           SPARE 256                 S01252058194
     C***********          END                                      S01241058194
     C***********                                                         058194
     C***********          END                                      S01241058194
     C*
     C                     EXSR DETL1
     C*
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
     C*
     C           *IN19     IFEQ '1'                                       E32543
     C*
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
     C*
     C           *IN22     IFEQ '1'                                       E32543
     C           SCVDA     ANDEQSCVDO                                     E32543
     C                     SETOF                     192223               E32543
     C                     SUB  1         S                               E32543
     C*
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
     C*
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C                     MOVE SCVDA     SCVDO   6                       E32543
     C                     END                                            E32543
     C*
     C                     END                                            E32543
     C*
     C           S         IFEQ 0                                         E32543
     C                     SETOF                     89                   E32543
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C*
     C           *IN67     IFEQ '1'                        B006
     C                     GOTO EXINIT
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C**  F3 PRESSED RE-DISPLAY HEADER
     C*
     C********** *IN25*****IFEQ '1'                        B005           CEU006
     C           @IN25     IFEQ '1'                        B005           CEU006
     C**  Need an indicator for screen processing                         CEU006
     C*********************SETOF                     2501                 CEU006
      ** Indicator 01 used for Invalid Pay delivery currency              CEU006
      ** currently not used although set here                             CEU006
     C                     MOVE '0'       @IN25                           CEU006
     C*                                                                   S01117
     C** PROTECT ORIGINATING BRANCH FIELD                                 S01117
     C*
     C                     SETON                     28                   S01117
     C*
     C**  REACCESS HEADER TO OBTAIN UP-TO-DATE DETAILS & SETUP SCREEN
     C*
     C                     MOVELSPREF     PREFK
     C                     MOVE '00'      CQSQK
     C*
     C           SACTD     IFNE 'I'                        B006
     C           CQCHNK    CHAINCQCODDDF             75
     C*
     C           *IN75     IFEQ '1'                        B007
     C                     ROLBK
     C           *LOCK     IN   DLDA                       B007
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE
     C                     Z-ADD7         DBASE            ************
     C                     MOVE CQCHN     DBKEY            * DBERR 07 *
     C                     OUT  DLDA                       ************
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X007
     C                     EXCPTRCQCOD
     C                     MOVE DTIME     SDTIM  110
     C                     MOVE RECI      RECIS   1
     C                     END                             E007
     C*
     C                     END                             E006
     C*
     C                     EXSR HCONV
     C*
     C                     EXSR STATUS
      *                                                                   S01414
      *  Determine attributes for the Profit Centre field                 S01414
      *                                                                   S01414
     C                     EXSR SRPRFA                                    S01414
     C*
     C* SETON INDICATOR 69 TO PROTECT HEADER CURRENCY IF AMEND
     C* AND A CHEQUE DETAIL HAS BEEN ENTERED
     C*
     C           SACTD     IFEQ 'A'                        B004
     C           NCSQ      ANDNE0
     C                     SETON                     69
     C                     ELSE                            X004
     C                     SETOF                     69
     C                     END                             E004
     C*
      * Display message subfile                                           058194
      *                                                                   058194
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C                     WRITEFT0070F2
     C*
     C************IN11*****DOUEQ'0'                        B006           S01199
     C*
     C                     READ FT0070F2                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETOF                     17                   S01494
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     WRITEFT0070F2                                  S01494
     C                     READ FT0070F2                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C*
     C************IN11*****IFEQ '1'                        B007           S01199
     C*********************EXSR HELP                                      S01199
     C*********************END                             E007           S01199
     C*********************END                             E006           S01199
     C*
     C                     END                             E005
     C*
     C                     ELSE                            X004
     C                     SETON                     12
     C                     MOVE *BLANK    @RETC
     C                     END                             E004
     C/COPY WNCPYSRC,FT0070C041
     C*
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C                     SETOF                     87
     C                     END                             E001
     C*
     C           EXINIT    ENDSR
     C*
     C**  END OF CHEQUE HEADER VALIDATION
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**  CHEQUE DETAIL VALIDATION
     C*
     C           DETL1     BEGSR
     C*
      *                                                                   058194
      * Initialise no update indicator, re-display, warning array         058194
      * and warning message sent                                          058194
      *                                                                   058194
     C                     MOVEL*BLANKS   FTNOUP                          058194
     C                     MOVEL*BLANKS   FTRSND                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     MOVEL*BLANKS   WRN@                            058194
     C                     MOVEL*BLANKS   WFRC                            CAC001
      *                                                                   CAC001
      **  Set up margin info work fields                                  CAC001
      *                                                                   CAC001
     C           ACT2      IFEQ 'I'                                       CAC001
     C                     Z-ADD0         WOFXMP  72                      CAC001
     C                     Z-ADD0         WOFXMD  10                      CAC001
     C                     MOVE *BLANKS   WOMBSI  1                       CAC001
     C                     MOVE *BLANKS   WOMSIG  1                       CAC001
     C                     Z-ADD0         WOMAMT 130                      CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADDFXMP      WOFXMP                          CAC001
     C                     Z-ADDFXMD      WOFXMD                          CAC001
     C                     MOVE MBSI      WOMBSI                          CAC001
     C                     MOVE MSIG      WOMSIG                          CAC001
     C                     Z-ADDMAMT      WOMAMT                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   058194
     C           *IN12     DOUEQ'1'                        B001
     C           *IN03     OREQ '1'
     C           *IN04     OREQ '1'
     C           FTNOUP    ANDEQ*BLANKS                                   058194
      *                                                                   058194
      * Initialise no update indicator to allow update                    058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C062
     C                     MOVEL*BLANKS   FTNOUP                          058194
     C/COPY WNCPYSRC,FT0070C048
     C*
     C**  VALIDATION NOT REQUIRED FOR ENQUIRY OR DELETION
     C*
     C           ACT2      IFNE 'E'                        B002
     C           ACT2      ANDNE'D'
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C/COPY WNCPYSRC,FT0070C010
     C*
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     SETOF                     8975
     C                     EXSR RESET
     C*
     C****OBTAIN*DETAILS*OF*SETTLE*CURRENCY*FROM*CURRENCIES*TABLE***      S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELSMCY      SCCY                            S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C*********************SETOF                     75                   S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '0'                        B003           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E003           S01194
     C*                                                                   S01194
     C**  OBTAIN DETAILS OF SETTLE CURRENCY FROM SDCURRPD                 S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SMCY      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCURR     7575  HILO           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           *IN75     IFEQ '1'                        B003
     C                     SETON                     4789
     C                     ADD  1         S
     C*********************MOVE ' 047'    ERCD,S                          S01117
     C                     MOVE ' 034'    ERCD,S                          S01117
     C                     ELSE                            X003
      *                                                                   CEU006
      ** Settle currency details needed for detail screen processing      CEU006
     C                     MOVE A6INCY    @1INCY                          CEU006
     C                     Z-ADDA6EUER    @1EUER                          CEU006
     C                     Z-ADDA6TPSD    @1TPSD                          CEU006
     C                     Z-ADDA6TPED    @1TPED                          CEU006
     C                     Z-ADDA6NBDP    @1NBDP                          CEU006
     C*********************Z-ADDCDP       PCDP    10                      S01194
     C*********************Z-ADDSPOT      PSPOT  138                      S01194
     C                     Z-ADDA6NBDP    PCDP    10                      S01194
     C                     Z-ADDA6SPRT    PSPOT  138                      S01194
     C                     Z-ADDMDIN      PMDIN   10
     C*********************MOVE '4'       TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG40F             75                   S01194
     C***********BSSG******IFEQ '+'                        B004           S01194
     C***********SPOT******ADD  BSPR      PBRAT  138                      S01194
     C*********************ELSE                            X004           S01194
     C***********SPOT******SUB  BSPR      PBRAT                           S01194
     C*********************END                             E004           S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B004           S01194
     C           A6SPRT    ADD  A6BYSR    PBRAT  138                      S01194
     C                     ELSE                            X004           S01194
     C           A6SPRT    SUB  A6BYSR    PBRAT                           S01194
     C                     END                             E004           S01194
     C           PBRAT     MULT 1.1       PBRUP  138
     C           PBRAT     MULT 0.9       PBRDW  138
     C                     END                             E003
     C*
     C**  VALIDATE CREDIT CURRENCY
     C**  BUT FIRST SET INDICATOR FOR ENTRY OF '?'                        S01194
     C*                                                                   S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASCCCY     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C   15                SETON                     16                   S01194
     C*                                                                   S01194
     C**  CHECK IF CREDIT CURRENCY IS VALID ON SDCURRPD                   S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SCCCY     @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVCURR     7575  HILO           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ '*NOSEL'                                  S01194
     C                     MOVE *BLANKS   SCCCY                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C                     MOVE A6CYCD    SCCCY                           S01194
     C                     END                                            S01194
     C*
     C           SCCCY     IFEQ *BLANK                     B003
     C                     SETON                     5289
     C                     ADD  1         S
     C*********************MOVE ' 420'    ERCD,S                          S01117
     C                     MOVE ' 053'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*                                                                   S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELSCCCY     SCCY                            S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C*********************SETOF                     75                   S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '0'                        B004           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E004           S01194
     C*                                                                   S01194
     C           *IN75     IFEQ '1'                        B004
     C                     SETON                     5289
     C                     ADD  1         S
     C*********************MOVE ' 245'    ERCD,S                          S01117
     C                     MOVE ' 052'    ERCD,S                          S01117
     C                     ELSE                            X004
      *                                                                   CAC001
      **  If Analytical Accounting is on, F19 was pressed, and debit &    CAC001
      **  credit currencies are equal, issue error code 620               CAC001
      *                                                                   CAC001
     C           BGN0ST    IFEQ 'Y'                                       CAC001
     C           *INKT     ANDEQ*ON                                       CAC001
     C           SMCY      ANDEQSCCCY                                     CAC001
     C           MBSI      ANDEQ*BLANKS                                   CAC001
     C           MSIG      ANDEQ*BLANKS                                   CAC001
     C                     SETON                     5289                 CAC001
     C                     ADD  1         S                               CAC001
     C                     MOVE ' 620'    ERCD,S                          CAC001
     C                     ELSE                                           CAC001
     C                     MOVE SCCCY     CRCY
     C*                                                                   S01194
     C*********************Z-ADDCDP       CCDP                            S01194
     C*********************Z-ADDCDP       RCDP    10                      S01194
     C*********************Z-ADDSPOT      RSPOT  138                      S01194
     C*********************Z-ADDMDIN      RMDIN   10                      S01194
     C*********************MOVE '4'       TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG40F             75                   S01194
     C***********SSSG******IFEQ '+'                        B005           S01194
     C***********SPOT******ADD  SSPR      RSRAT  138                      S01194
     C*********************ELSE                            X005           S01194
     C***********SPOT******SUB  SSPR      RSRAT                           S01194
     C*********************END                             E005           S01194
     C**CHANGE*SPOT*RATE*BY*BUY*SPREAD*                                   S01194
     C***********BSSG******IFEQ '+'                        B005           S01194
     C***********SPOT******ADD  BSPR      RBRAT  138                      S01194
     C*********************ELSE                            X005           S01194
     C***********SPOT******SUB  BSPR      RBRAT                           S01194
     C*********************END                             E005           S01194
     C*********************END                             E004           S01194
     C*********************END                             E003           S01194
     C*
     C                     Z-ADDA6NBDP    CCDP                            S01194
     C                     Z-ADDA6NBDP    RCDP    10                      S01194
     C                     Z-ADDA6SPRT    RSPOT  138                      S01194
     C                     Z-ADDMDIN      RMDIN   10                      S01194
     C*                                                                   S01194
     C           A6SLSS    IFEQ '+'                        B005           S01194
     C           A6SPRT    ADD  A6SLSR    RSRAT  138                      S01194
     C                     ELSE                            X005           S01194
     C           A6SPRT    SUB  A6SLSR    RSRAT                           S01194
     C                     END                             E005           S01194
     C*                                                                   S01194
     C* CHANGE SPOT RATE BY BUY SPREAD                                    S01194
     C*                                                                   S01194
     C           A6BYSS    IFEQ '+'                        B005           S01194
     C           A6SPRT    ADD  A6BYSR    RBRAT  138                      S01194
     C                     ELSE                            X005           S01194
     C           A6SPRT    SUB  A6BYSR    RBRAT                           S01194
     C                     END                             E005           S01194
     C*                                                                   S01194
     C                     ENDIF                                          CAC001
     C                     END                             E004           S01194
     C                     END                             E003           S01194
      *                                                                   CEU006
      ** Credit currency is valid - save fields to work fields            CEU006
      *                                                                   CEU006
     C           *IN52     IFEQ *OFF                                      CEU006
      *                                                                   CEU006
     C           *LIKE     DEFN A6INCY    @2INCY                          CEU006
     C           *LIKE     DEFN A6EUER    @2EUER                          CEU006
     C           *LIKE     DEFN A6TPSD    @2TPSD                          CEU006
     C           *LIKE     DEFN A6TPED    @2TPED                          CEU006
     C           *LIKE     DEFN A6NBDP    @2NBDP                          CEU006
     C                     MOVE A6INCY    @2INCY                          CEU006
     C                     Z-ADDA6EUER    @2EUER                          CEU006
     C                     Z-ADDA6TPSD    @2TPSD                          CEU006
     C                     Z-ADDA6TPED    @2TPED                          CEU006
     C                     Z-ADDA6NBDP    @2NBDP                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C*                                                                   140647
     C**  CREDIT VALUE DATE MANDATORY                                     140647
     C*                                                                   140647
     C           SCVDA     IFEQ *BLANK                     B003           140647
     C                     SETON                     5389                 140647
     C                     ADD  1         S                               140647
     C                     MOVE ' 056'    ERCD,S                          140647
     C                     ELSE                            X003           140647
     C*                                                                   140647
     C**  CHECK DATE FORMAT                                               140647
     C*                                                                   140647
     C* CHECK IF DATE IS NUMERIC                                          140647
     C*                                                                   140647
     C                     MOVELSCVDA     DATEL                           140647
     C                     MOVELDATEL     DATES                           140647
     C*                                                                   140647
     C           SCVDA     IFNE DATES                      B004           140647
     C                     SETON                     99                   140647
     C                     ELSE                            X004           140647
     C                     MOVE SCVDA     ZDATE                           140647
     C                     EXSR ZDATE1                                    140647
      *                                                                   140647
      ** THE CREDIT VALUE DATE MUST NOT BE A HOLIDAY IN LOCAL CURRENCY    140647
      *                                                                   140647
     C                     MOVE BJLCCY    ZCCY                            140647
     C                     EXSR ZCHKH                                     140647
      *                                                                   140647
      ** if ZIND = 'H' then the date is a holiday                         140647
      *                                                                   140647
     C           ZIND      IFEQ 'H'                                       140647
     C                     SETON                     192389               140647
     C                     ADD  1         S                               140647
     C                     MOVEA' W02'    ERCD,S                          140647
     C                     ELSE                                           140647
     C                     SETOF                     23                   140647
     C                     END                                            140647
      *                                                                   140647
     C                     END                             E004           140647
      *                                                                   140647
     C           *IN99     IFEQ '0'                        B004           140647
     C                     Z-ADDZDAYNO    CRVD                            140647
     C                     ELSE                            X004           140647
     C                     SETON                     5389                 140647
     C                     ADD  1         S                               140647
     C                     MOVE ' 057'    ERCD,S                          140647
     C                     END                             E004           140647
     C*                                                                   140647
     C                     END                             E003           140647
      *                                                                   140647
      ** Validate Pay Delivery currency                                   CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           *IN52     ANDEQ*OFF                                      CEU006
      *                                                                   CEU006
     C           SPDCY     IFNE *BLANKS                                   CEU006
      *                                                                   CEU006
     C           @2INCY    IFNE 'Y'                                       CEU006
     C           SCCCY     ANDNEBKEURO                                    CEU006
     C           @2INCY    OREQ 'Y'                                       140647
     C           CRVD      ANDLT@2TPSD                                    140647
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN01                           CEU006
     C                     MOVEL'FTM2595' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD   7                       CEU006
     C                     PARM '*KEY   ' @OPTN   7                       CEU006
     C                     PARM SPDCY     @CURR   3                       CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD44        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      * Currency valid                                                    CEU006
     C           @2INCY    IFEQ 'Y'                                       CEU006
     C           SPDCY     ANDNEBKEURO                                    CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN01                           CEU006
     C                     MOVEL'FTM2596' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
     C           A6INCY    IFNE 'Y'                                       CEU006
     C           SCCCY     ANDEQBKEURO                                    CEU006
     C           A6INCY    OREQ 'Y'                                       140647
     C           CRVD      ANDLTA6TPSD                                    140647
     C           SCCCY     ANDEQBKEURO                                    140647
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN01                           CEU006
     C                     MOVEL'FTM2597' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      ** Pay delivery currency is valid - save fields to work fields      CEU006
      *                                                                   CEU006
     C           *IN01     IFEQ *OFF                                      CEU006
      *                                                                   CEU006
     C           *LIKE     DEFN A6INCY    @3INCY                          CEU006
     C           *LIKE     DEFN A6EUER    @3EUER                          CEU006
     C           *LIKE     DEFN A6TPSD    @3TPSD                          CEU006
     C           *LIKE     DEFN A6TPED    @3TPED                          CEU006
     C           *LIKE     DEFN A6NBDP    @3NBDP                          CEU006
     C                     MOVE A6INCY    @3INCY                          CEU006
     C                     Z-ADDA6EUER    @3EUER                          CEU006
     C                     Z-ADDA6TPSD    @3TPSD                          CEU006
     C                     Z-ADDA6TPED    @3TPED                          CEU006
     C                     Z-ADDA6NBDP    @3NBDP                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      ** Validate Pay Delivery amount                                     CEU006
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           SPDAM     ANDNE*BLANKS                                   CEU006
     C           SPDCY     ANDEQ*BLANKS                                   CEU006
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN13                           CEU006
     C                     MOVEL'FTM2598' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C/COPY WNCPYSRC,FT0070C006
     C*
     C**  CREDIT PARTY MANDATORY
     C*
     C           SCRPA     IFEQ *BLANK                     B003
     C           SCRBR     ANDEQ*BLANK                                    S01117
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 238'    ERCD,S                          S01117
     C                     MOVE ' 041'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*
     C**  ENTRY OF '?' INVALID                                            S01194
     C*                                                                   S01194
     C                     MOVEL*BLANKS   FLDQ                            S01194
     C                     MOVEASCRPA     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C           *IN15     IFEQ '1'                                       S01194
     C                     SETON                     5089                 S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 043'    ERCD,S                          S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C** IF CREDIT PARTY NOT ENTERED AS A PARTIAL ACCOUNT, MBIN IS ON     S01194
     C** AND THE CREDIT PARTY BRANCH ENTERED THIS IS AN ERROR.            S01194
     C*                                                                   S01194
     C           SCRPP     IFEQ *BLANKS                                   S01194
     C           *IN20     ANDEQ'1'                                       S01194
     C           SCRBR     ANDNE*BLANKS                                   S01194
     C                     SETON                     5089                 S01194
     C                     ADD  1         S                               S01194
     C*********************MOVE ' 054'    ERCD,S                    S01194056823
     C                     MOVE ' 048'    ERCD,S                    S01194056823
     C                     END                                            S01194
     C*                                                                   S01194
     C** IF NO ERRORS SO FAR CARRY ON WITH VALIDATION                     S01194
     C*                                                                   S01194
     C           *IN50     IFEQ '0'                                       S01194
     C*                                                                   S01194
     C**  CHECK IF VALID NOSTRO
     C*
     C                     MOVE *BLANK    CRPT
     C                     MOVE *BLANK    ERRC    1
     C                     MOVELSCRPA     CHK3    3
     C                     MOVE CHK3      CHK1
     C           CHK1      IFEQ *BLANK                     B004
     C*
     C**  VALIDATE NOSTRO CODE
     C*
     C                     MOVELSCCCY     NOSCHN
     C                     MOVELSCRPA     NOSCH
     C                     MOVE NOSCH     NOSCHN
     C                     EXSR NOCHN
     C           *IN75     IFEQ '1'                        B005
     C                     MOVE 'N'       CRPT
     C                     MOVELSCRPA     CRPY
     C                     MOVE *BLANKS   CRBR                            S01117
     C**
     C*    STORE FIELDS FOR KEY TO ACCNT
     C**
     C**********           Z-ADDCNUM      CNUMSV  60                                          CSD027
     C                     MOVE CNUM      CNUMSV  6                                           CSD027
     C                     MOVELSCCCY     CCYSV   3
     C**********           Z-ADDACOD      ACODSV  40                                          CGL029
     C                     Z-ADDACOD      ACODSV                                              CGL029
     C                     Z-ADDACSQ      ACSQSV  20
     C                     MOVELBRCA      BRCASV  3                       S01117
     C*
     C                     ELSE                            X005
     C                     MOVE 'E'       ERRC
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 239'    ERCD,S                          S01117
     C                     MOVE ' 042'    ERCD,S                          S01117
     C                     END                             E005
     C                     END                             E004
     C/COPY WNCPYSRC,FT0070C043
     C*
     C**  CHECK IF RETAIL NUMBER
     C*
     C           CRPT      IFEQ *BLANK                     B004
     C           ERRC      ANDEQ*BLANK
     C                     MOVELSCRPA     CHK11  11
     C                     MOVE CHK11     CHK1
     C           CHK1      IFEQ *BLANK                     B005
     C*
     C**  VALIDATE RETAIL NUMBER
     C*
     C                     MOVELSCRPA     RETCHN
     C                     EXSR RECHN
     C           *IN75     IFEQ '1'                        B006
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 024'    ERCD,S                          S01117
     C                     MOVE 'N'       RAC#N   1
     C*
     C                     ELSE
     C                     MOVE *BLANK    RAC#N   1
     C*
     C           CCY       IFNE SCCCY                      B007
     C                     MOVE 'E'       ERRC
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 241'    ERCD,S                          S01117
     C                     MOVE ' 044'    ERCD,S                          S01117
     C                     ELSE                            X007
     C                     MOVE 'R'       CRPT
     C                     MOVE SCRPA     CRPY
     C                     MOVE *BLANKS   CRBR                            S01117
     C                     END                             E007
     C*
     C                     END                             E006
     C                     END
     C*
     C           *IN75     IFEQ '0'                        B006
     C                     MOVE 'E'       ERRC
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 240'    ERCD,S                          S01117
     C                     MOVE ' 043'    ERCD,S                          S01117
     C                     END                             E006
     C*
     C                     END                             E005
     C                     END                             E004
     C*
     C**  VALIDATE ACCOUNT IDENTIFIER
     C*
     C           CRPT      IFEQ *BLANK                     B004
     C           ERRC      ANDEQ*BLANK
     C           RAC#N     ANDEQ*BLANK
      *
      ***Check*that*the*partial*a/c*identifier*is*all*numeric.*If not*                 037405 CSD027
      ***then*a*partial*account*has*not*been*entered.***************** N               037405 CSD027
      **Do*check*using*DIGITS*,*a*named*constant*of*'0123456789'******                 052310 CSD027
      ****************************************************************                 037405 CSD027
     C********** DIGITS    CHECKSCRPA                    76                            037405 CSD027
     C********** *IN76     IFEQ '1'                                                    037405 CSD027
     C**********           SETON                     5089                              037405 CSD027
     C**********           ADD  1         S                                            037405 CSD027
     C**********           MOVE ' 242'    ERCD,S                                       037405 CSD027
     C**********           ELSE                                                        037405 CSD027
     C*
     C** IF LAST POS IN SCRBK1 IS NOT BLANK I.E PARTIAL ACCNT             S01117
     C** AND MBIN AND BRANCH FIELD BLANK THEN ERROR                       S01117
     C*                                                                   S01117
     C           SCRPP     IFNE *BLANK                                    S01117
     C           *IN20     ANDEQ'1'                                       S01117
     C           SCRBR     ANDEQ*BLANK                                    S01117
     C                     SETON                     5089                 S01117
     C                     ADD  1         S                               S01117
     C*********************MOVE ' 055'    ERCD,S                   S01117 056823
     C                     MOVE ' 049'    ERCD,S                          056823
     C                     ELSE                                           S01117
     C                     MOVELSCRPA     CUSTA   9
     C                     MOVE SCCCY     CUSTA
     C                     MOVE SCRPA     ACCOHN
     C                     MOVELCUSTA     ACCOHN
     C*********************MOVE ACCOHN    ACCKY                           S01117
     C                     MOVELACCOHN    ACCKY                           S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     MOVE BJSBRC    BRCAK                           S01117
     C                     ELSE                                           S01117
     C                     MOVE SCRBR     BRCAK                           S01117
     C                     END                                            S01117
     C*
     C                     EXSR ACCHN
     C*
     C           *IN75     IFEQ '1'                        B005
     C*******************  MOVE 'P'       CRPT                            179732
     C******************   MOVE SCRPA     CRPY                            179732
     C*                                                                   179732
     C                     MOVE 'PA'      PARTAC  2                       179732
     C*                                                                   179732
     C           ATYP      IFEQ 'G'                                       179732
     C                     MOVE 'P'       CRPT
     C                     MOVE SCRPA     CRPY
     C                     ENDIF                                          179732
     C*                                                                   179732
     C           ATYP      IFEQ 'R'                                       179732
     C           BMRANR    IFEQ 'Y'                        ** B05                             212014
     C                     MOVE 'R'       CRPT                            179732
     C                     MOVE *BLANKS   SCRPA                           179732
     C                     MOVE *BLANKS   CRBR                            179732
     C                     MOVELACNO      CRPY                            179732
     C                     MOVELACNO      SCRPA                           179732
     C                     ELSE                            ** X05                             212014
     C                     MOVE 'P'       CRPT                                                212014
     C                     MOVE SCRPA     CRPY                                                212014
     C                     END                             ** E05                             212014
     C                     ENDIF                                          179732
     C*                                                                   179732
     C           ATYP      IFEQ 'N'                                       179732
     C                     MOVE 'N'       CRPT                            179732
     C*                                                                   179732
     C                     MOVE CNUM      @CUST   6                       179732
     C**********           MOVE ACOD      @ACCD   4                                    179732 CGL029
     C                     MOVE ACOD      @ACCD                                               CGL029
     C                     MOVE ACSQ      @ACSN   2                       179732
     C*                                                                   179732
     C                     CALL 'AONOSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM           @CUST   6                       179732
     C                     PARM SCCCY     @CYCD   3                       179732
     C**********           PARM           @ACCD   4                                    179732 CGL029
     C                     PARM           @ACCD                                               CGL029
     C                     PARM           @ACSN   2                       179732
     C                     PARM *BLANKS   @NONB   2                       179732
     C                     PARM BRCAK     @BRCD   3                       179732
     C                     PARM *BLANKS   @CSSN  10                       179732
     C                     PARM *BLANKS   @PNOI   1                       179732
     C           SDNOST    PARM SDNOST    DSSDY                           179732
     C*                                                                   179732
     C           @RTCD     IFEQ *BLANKS                                   179732
     C                     MOVE *BLANKS   SCRPA                           179732
     C                     MOVE *BLANKS   CRBR                            179732
     C                     MOVELA7NONB    SCRPA                           179732
     C                     MOVELSCRPA     CRPY                            179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
     C*
     C           *IN20     IFEQ '0'                                       S01117
     C                     MOVE BJSBRC    CRBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE SCRBR     CRBR                            S01117
     C                     END                                            S01117
     C*
     C                     ELSE                            X005
     C                     SETON                     5089
     C                     ADD  1         S
     C*********************MOVE ' 241'    ERCD,S                          E29881
     C*********************MOVE ' 242'    ERCD,S                    E29881S01117
     C                     MOVE ' 045'    ERCD,S                          S01117
     C                     END                             E005
     C*
     C                     END                                            S01117
     C**********           END                                                         037405 CSD027
     C*
     C                     END                             E004
     C*
     C                     END                             *IN15 END      S01194
     C*
     C                     END                             E003
     C*
     C* IF A VALID NOSTRO A/C HAS BEEN ENTERED ACCESS THE ACCNT RECORD
     C*
     C           *IN50     IFEQ '0'                        B003
     C           CRPT      ANDEQ'N'
     C           PARTAC    ANDNE'PA'                                      179732
     C                     EXSR ACHAIN
     C                     END                             E003
     C/COPY WNCPYSRC,FT0070C001
     C********************                                                056823
     C****CHEQUE*AMOUNT*MANDATORY                                         056823
     C********************                                                056823
     C***********SCQAM**** IFEQ *BLANK                     B003           056823
     C******************** SETON                     5189                 056823
     C******************** ADD  1         S                               056823
     C*********************MOVE ' 243'    ERCD,S                          S01117
     C******************** MOVE ' 050'    ERCD,S                   S01117 056823
     C******************** ELSE                            X003           056823
     C********************                                                056823
     C****VALIDATE*CHEQUE*AMOUNT FOR DECIMAL PLACES using HEADER CCY      056823
     C********************                                                056823
     C***********13******* SUB  PCDP      ZADIG                           056823
     C******************** Z-ADDPCDP      ZADEC                           056823
     C******************** MOVE *BLANKS   ZFIELD                          056823
     C******************** MOVE SCQAM     ZFIELD                          056823
     C******************** EXSR ZALIGN                                    056823
     C************IN99**** IFEQ '1'                        B004           056823
     C******************** SETON                     5189                 056823
     C******************** ADD  1         S                               056823
     C*********************MOVE ' 244'    ERCD,S                          S01117
     C******************** MOVE ' 051'    ERCD,S                   S01117 056823
     C******************** ELSE                            X004           056823
     C******************** MOVE ZFIELD    CQAM                            056823
     C********************                                         E37066 056823
     C**CHECK*FOR*AMOUNT*BEING NON BLANK, BUT ZERO                 E37066 056823
     C********************                                         E37066 056823
     C***********CQAM***** IFEQ *ZEROS                             E37066 056823
     C******************** SETON                     5189          E37066 056823
     C******************** ADD  1         S                        E37066 056823
     C******************** MOVE ' 050'    ERCD,S                   E37066 056823
     C******************** END                                     E37066 056823
     C********************                                         E37066 056823
     C******************** END                             E004           056823
     C******************** END                             E003           056823
     C*
     C****CREDIT*VALUE*DATE*MANDATORY****************                     140647
     C***********                                                         140647
     C***********SCVDA     IFEQ *BLANK                     B003           140647
     C***********          SETON                     5389                 140647
     C***********          ADD  1         S                               140647
     C*********************MOVE ' 246'    ERCD,S                          S01117
     C***********          MOVE ' 056'    ERCD,S                          S01117
     C***********          ELSE                            X003           140647
     C***********                                                         140647
     C****CHECK*DATE FORMAT                                               140647
     C***********                                                         140647
     C**CHECK*IF*DATE IS NUMERIC                                          140647
     C***********                                                         140647
     C***********          MOVELSCVDA     DATEL                           140647
     C***********          MOVELDATEL     DATES                           140647
     C***********                                                         140647
     C***********SCVDA     IFNE DATES                      B004           140647
     C***********          SETON                     99                   140647
     C***********          ELSE                            X004           140647
     C***********          MOVE SCVDA     ZDATE                           140647
     C***********          EXSR ZDATE1                                    140647
      ***********                                                   E32543140647
      ***THE*CREDIT VALUE DATE MUST NOT BE A HOLIDAY IN LOCAL CURRENE32543140647
      ***********                                                   E32543140647
     C***********          MOVE BJLCCY    ZCCY                      E32543140647
     C***********          EXSR ZCHKH                               E32543140647
      ***********                                                   E32543140647
      ***if*ZIND*= 'H' then the date is a holiday                   E32543140647
      ***********                                                   E32543140647
     C***********ZIND      IFEQ 'H'                                 E32543140647
     C*********************SETON                     1923           E32543E37067
     C***********          SETON                     192389         E37067140647
     C***********          ADD  1         S                         E32543140647
     C*********************MOVEA' W10'    ERCD,S                    E32543S01117
     C***********          MOVEA' W02'    ERCD,S                    S01117140647
     C***********          ELSE                                     E32543140647
     C***********          SETOF                     23             E32543140647
     C***********          END                                      E32543140647
      ***********                                                   E32543140647
     C***********          END                             E004           140647
      ***********                                                   E32543140647
     C********** *IN99     IFEQ '0'                        B004           140647
     C***********          Z-ADDZDAYNO    CRVD                            140647
     C***********          ELSE                            X004           140647
     C***********          SETON                     5389                 140647
     C***********          ADD  1         S                               140647
     C*********************MOVE ' 247'    ERCD,S                          S01117
     C***********          MOVE ' 057'    ERCD,S                    S01117140647
     C***********          END                             E004           140647
     C***********                                                         140647
     C***********          END                             E003           140647
      *                                                                   047179
      *  Check if credit value date is in the future and if the           047179
      *  account is closing today                                         047179
      *                                                                   047179
     C           *IN50     IFEQ '0'                        B003           047179
     C           *IN53     ANDEQ'0'                                       047179
      *                                                                   047179
     C           CRVD      IFGT BJRDNB                                    047179
     C           ACST      ANDEQ'C'                                       047179
     C                     ADD  1         S                               047179
     C                     MOVE ' 603'    ERCD,S                          047179
     C                     SETON                     5089                 047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
     C*
     C**  IF CREDIT PARTY & VALUE DATE ARE VALID SO FAR, FOR RETAIL
     C**    ACCOUNTS ONLY, CHECK THAT THE CREDIT VALUE DATE IS NOT BEFORE
     C**    THE BACK-VALUE LIMIT DATE NOR BEFORE THE ACCOUNT WAS OPENED
     C*
     C           *IN50     IFEQ '0'                        B003
     C           *IN53     ANDEQ'0'
     C           ATYP      ANDEQ'R'
     C*
     C           CRVD      IFLT BVLD                       B004
     C                     ADD  1         S
     C*********************MOVE ' 370'    ERCD,S                          S01117
     C                     MOVE ' 047'    ERCD,S                          S01117
     C                     SETON                     5089
     C                     ELSE                            X004
     C           CRVD      IFLT DACO                       B005
     C                     ADD  1         S
     C*********************MOVE ' 355'    ERCD,S                          S01117
     C                     MOVE ' 046'    ERCD,S                          S01117
     C                     SETON                     5089
     C                     END                             E005
     C                     END                             E004
     C*
     C                     END                             E003
     C/COPY WNCPYSRC,FT0070C033
     C*
     C**  VALIDATE OVERRIDE INDICATOR
     C*
     C           SOVER     IFNE 'Y'                        B003
     C           SOVER     ANDNE*BLANK
     C/COPY WNCPYSRC,FT0070C111
     C                     SETON                     5589
     C                     ADD  1         S
     C*********************MOVE ' 049'    ERCD,S                          S01117
     C                     MOVE ' 055'    ERCD,S                          S01117
     C/COPY WNCPYSRC,FT0070C112
      *                                                                   056823
      *  Field cannot be 'Y' if no rate is entered                        056823
      *                                                                   056823
     C                     ELSE                            X003           056823
     C           SOVER     IFEQ 'Y'                                       056823
     C           SRATE     ANDEQ*BLANK                                    056823
     C                     ADD  1         S                               056823
     C                     MOVE '076'     ERCD,S                          056823
     C                     SETON                     55                   056823
     C/COPY WNCPYSRC,FT0070C116
      *                                                                   056823
      * Valid rate override flag                                          056823
      *                                                                   056823
     C                     ELSE                            X003
     C                     MOVE SOVER     OVRD
     C                     END                                            056823
      *                                                                   056823
     C                     END                             E003
     C/COPY WNCPYSRC,FT0070C113
     C*
     C**  NARRATIVE IS NOT VALIDATED
     C*
     C                     MOVE SDES1     NAR1
     C                     MOVE SDES2     NAR2
     C                     MOVE SDES3     NAR3
     C                     MOVE SDES4     NAR4
     C                     MOVE SDES5     NAR5
     C                     MOVE SDES6     NAR6
      *                                                                   056823
      ********************                                         S10284 056823
      ****VALIDATE*CREDIT*CURRENCY AMOUNT IF CCCYAM ENTERED        S10284 056823
      ****AND*CREDIT*CURRENCY IS VALID                             S10284 056823
      ********************                                         S10284 056823
     C************IN52**** IFNE '1'                                S10284 056823
     C************IN51**** ANDNE'1'                                S10284 056823
     C******************** MOVEL'YES'     @DFTRT  3                S10284 056823
     C***********SCCYAM*** IFEQ *BLANKS                            S10284 056823
     C******************** Z-ADD0         CCYAM                    S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
      ****THE*AMOUNT*MUST*HAVE THE CORRECT NUMBER OF DECIMAL PLACESS10284 056823
      ********************                                         S10284 056823
     C******************** Z-ADD1         Z       30        4      S10284 056823
     C***********SCCCY**** LOKUPCCYA,Z                   88 4      S10284 056823
      ********************                                         S10284 056823
     C************IN88**** IFEQ '0'                        B5      S10284 056823
     C************LOCK**** IN   DLDA                        5      S10284 056823
     C******************** MOVE 'FT0070'  DBPGM             5      S10284 056823
     C******************** MOVE 'TABLE'   DBFILE            5      S10284 056823
     C******************** Z-ADD48        DBASE            ********S10284 056823
     C******************** MOVE SCCCY     DBKEY            * DBERR S10284 056823
     C******************** OUT  DLDA                       ********S10284 056823
     C******************** SETON                     U7U8LR 5      S10284 056823
     C******************** DUMP                             5      S10284 056823
      ********************                                         048377 056823
      ***Allocate*dataarea to blanks                               048377 056823
      ********************                                         048377 056823
     C******************** EXSR DALLOC                             048377 056823
     C******************** RETRN                            5      S10284 056823
     C******************** END                             E5      S10284 056823
      ********************                                         S10284 056823
     C******************** Z-ADDCDPA,Z    CDP1    30        4      S10284 056823
     C***********13******* SUB  CDP1      ZADIG             4      S10284 056823
     C******************** Z-ADDCDP1      ZADEC             4      S10284 056823
     C******************** MOVE *BLANKS   ZFIELD            4      S10284 056823
     C******************** MOVELSCCYAM    ZFIELD            4      S10284 056823
     C******************** EXSR ZALIGN                      4      S10284 056823
     C************IN99**** IFEQ '1'                        B5      S10284 056823
     C***********SCCYAM*** OREQ *BLANKS                            S10284 056823
     C******************** MOVE '1'       *IN33             5      S10284 056823
     C******************** MOVE '1'       *IN89             5      S10284 056823
     C******************** ADD  1         S                 5      S10284 056823
     C*********************MOVE ' 261'    ERCD,S            5      S10284 S01117
     C******************** MOVE ' 071'    ERCD,S            5      S01117 056823
     C******************** ELSE                            X5      S10284 056823
     C******************** MOVE ZFIELD    CCYAM             5      S10284 056823
     C***********CCYAM**** IFEQ *ZEROS                     B6      S10284 056823
     C******************** MOVE '1'       *IN33             6      S10284 056823
     C******************** MOVE '1'       *IN89             6      S10284 056823
     C******************** ADD  1         S                 6      S10284 056823
     C*********************MOVE ' 261'    ERCD,S            6      S10284 S01117
     C******************** MOVE ' 071'    ERCD,S            6      S01117 056823
     C******************** ELSE                            E6      S10284 056823
      ********************                                         S10284 056823
      ****CALCULATE*THE*CROSS-RATE TO CONVERT FROM SETTLE CURRENCY S10284 056823
      ****TO*CREDIT*CURRENCY                                       S10284 056823
      ********************                                         S10284 056823
      ***SAVE*SPOT*RATE*AND M/D INDICATOR FOR CREDIT CCY           S10284 056823
      ********************                                         S10284 056823
     C******************** MOVELMDA,Z     @@MDI2  1         4      S10284 056823
     C******************** Z-ADDSPTA,Z    @@RAT2 138        4      S10284 056823
     C******************** Z-ADDCDPA,Z    @@CDP2  30        4      S10284 056823
     C******************** Z-ADD1         Z                 4      S10284 056823
      ********************                                         S10284 056823
      ***OBTAIN*SPOT*RATE*AND M/D INDICATOR FOR SETTLE CCY         S10284 056823
      ********************                                         S10284 056823
     C***********SMCY***** LOKUPCCYA,Z                   88 4      S10284 056823
      ********************                                         S10284 056823
     C************IN88**** IFEQ '0'                        B5      S10284 056823
     C************LOCK**** IN   DLDA                        5      S10284 056823
     C******************** MOVE 'FT0070'  DBPGM             5      S10284 056823
     C******************** MOVE 'TABLE'   DBFILE            5      S10284 056823
     C******************** Z-ADD49        DBASE            ********S10284 056823
     C******************** MOVE SSMCY     DBKEY            * DBERR S10284 056823
     C******************** OUT  DLDA                       ********S10284 056823
     C******************** SETON                     U7U8LR 5      S10284 056823
     C******************** DUMP                             5      S10284 056823
      ********************                                         048377 056823
      ***Allocate*dataarea to blanks                               048377 056823
      ********************                                         048377 056823
     C******************** EXSR DALLOC                             048377 056823
     C******************** RETRN                            5      S10284 056823
     C******************** END                             E5      S10284 056823
     C********************                                         S10284 056823
     C******************** MOVELMDA,Z     @@MDI1  1         4      S10284 056823
     C******************** Z-ADDSPTA,Z    @@RAT1 138        4      S10284 056823
     C******************** Z-ADDCDPA,Z    @@CDP1  30        4      S10284 056823
      ********************                                         S10284 056823
      ***SUBROUTINE*CALCULATES THE CROSS-RATE FROM SETTLE TO CREDITS10284 056823
      ********************                                         S10284 056823
     C******************** EXSR ZA0900                      4      S10284 056823
      ********************                                         S10284 056823
      ****CALCULATE*THE*UPPER MARGIN AND THE LOWER MARGIN          S10284 056823
      ****FOR*THE*CROSS-RATE                                       S10284 056823
      ********************                                         S10284 056823
     C***********@@CSRT*** MULT UPMARG    UPRAT  138H       4      S10284 056823
     C***********@@CSRT*** MULT LWMARG    LWRAT  138H       4      S10284 056823
      ********************                                         S10284 056823
      ****OBTAIN*THE*UPPER AND LOWER BOUNDERIES OF THE             S10284 056823
      ****CREDIT*CURRENCY*AMOUNT                                   S10284 056823
      ***ZA0900*ALWAYS*OUTPUTS A MULT/DIV INDICATOR OF '1' = MULTIPS10284 056823
      ********************                                         S10284 056823
     C***********CQAM***** MULT UPRAT     UCCYAM 130H       4      S10284 056823
     C***********CQAM***** MULT LWRAT     LCCYAM 130H       4      S10284 056823
      ********************                                         S10284 056823
      ****ALLOW*FOR*DECIMAL PLACES OF AMOUNTS TO BE DIFFERENT      S10284 056823
      ********************                                         S10284 056823
     C***********@@CDP1*** SUB  @@CDP2    N                 4      S10284 056823
     C***********N******** ADD  4         N                 4      S10284 056823
     C***********CCYAM**** MULT POWER,N   @@AMT  130H       4      S10284 056823
      ********************                                         S10284 056823
      ****IF*THE*CREDIT*CURRENCY AMOUNT ENTERED IS GREATER THAN THES10284 056823
      ****UPPER*MARGIN*OR*LESS THAN THE LOWER MARGIN, DISPLAY WARNIS10284 056823
      ********************                                         S10284 056823
     C***********@@AMT**** IFGT UCCYAM                     B5      S10284 056823
     C***********@@AMT**** ORLT LCCYAM                      5      S10284 056823
     C******************** SETON                     193289        S10284 056823
     C******************** ADD  1         S                        S10284 056823
     C******************** MOVEA' W03'    ERCD,S                   S10284 056823
     C******************** ELSE                            X005    S10284 056823
     C******************** SETOF                     32            S10284 056823
     C******************** END                             E5      S10284 056823
      ********************                                         S10284 056823
     C***********@DFTRT*** IFEQ 'YES'                              S10284 056823
     C******************** MOVEL'NO '     @DFTRT                   S10284 056823
      ********************                                         S10284 056823
     C***********PCDP***** ADD  1         @PP     10               S10284 056823
     C***********CQAM***** DIV  @@,@PP    @CKAMT 153H              S10284 056823
     C***********CDP1***** ADD  1         @CC     10               S10284 056823
     C***********CCYAM**** DIV  @@,@CC    @CYAMT 153H              S10284 056823
      ********************                                         S10284 056823
     C***********SMDIN**** IFEQ 0                                  S10284 056823
     C***********@CKAMT*** DIV  @CYAMT    @XRA   138H              S10284 056823
     C******************** ELSE                                    S10284 056823
     C***********@CYAMT*** DIV  @CKAMT    @XRA   138H              S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
      ***Set*the*rate*greater than 1 if neither side is base currenS10284 056823
     C***********@XRA***** IFLT 1                                  S10284 056823
     C***********SCCCY**** ANDNEBJCYCD                             S10284 056823
     C***********SMCY***** ANDNEBJCYCD                             S10284 056823
     C***********1******** DIV  @XRA      @XRA      H              S10284 056823
     C***********1******** SUB  SMDIN     SMDIN                    S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
     C******************** MOVEL@@MDI1    @@I1    10               S10284 056823
     C******************** MOVEL@@MDI2    @@I2    10               S10284 056823
      ********************                                         S10284 056823
      ***If*one*currency*is base set the rate so that the muliply  S10284 056823
      ***divide*indicator*is the same as the other currency.       S10284 056823
      ********************                                         S10284 056823
     C***********SCCCY**** IFEQ BJCYCD                             S10284 056823
     C***********SMDIN**** ANDNE@@I2                               S10284 056823
     C***********1******** DIV  @XRA      @XRA      H              S10284 056823
     C***********1******** SUB  SMDIN     SMDIN                    S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
     C***********SMCY***** IFEQ BJCYCD                             S10284 056823
     C***********SMDIN**** ANDNE@@I1                               S10284 056823
     C***********1******** DIV  @XRA      @XRA      H              S10284 056823
     C***********1******** SUB  SMDIN     SMDIN                    S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
     C******************** Z-ADD@XRA      NRATE                    S10284 056823
     C******************** Z-ADDNRATE     RATE                     S10284 056823
      ********************                                         S10284 056823
     C**SET*UP*DISPLAY*RATE FIELD                                  S10284 056823
     C******************** Z-ADD5         WDIG                     S10284 056823
     C******************** Z-ADD8         WDEC                     S10284 056823
     C******************** MOVE NRATE     WFDIN                    S10284 056823
     C******************** EXSR FAMTSR                             S10284 056823
     C******************** MOVE WFDOUT    SRATE                    S10284 056823
     C********************                                         S10284 056823
     C******************** END                                     S10284 056823
      ********************                                         S10284 056823
     C******************** END                             E6      S10284 056823
     C******************** END                             E5      S10284 056823
     C******************** END                             E4      S10284 056823
     C****VALIDATE*RATE***                                                056823
     C********************                                                056823
     C******RATES*PROCESSING ONLY IF CREDIT CURRENCY IS VALID             056823
     C********************                                                056823
     C************IN52**** IFEQ '0'                        B003           056823
     C******************** EXSR RATES                                     056823
     C************IN54**** IFEQ '0'                        B004           056823
     C******************** Z-ADDNRATE     RATE                            056823
     C******************** END                             E004           056823
     C******************** END                             E003           056823
      *                                                                   056823
      *************************                                           056823
      **  VALIDATE AMOUNTS   **                                           056823
      *************************                                           056823
     C/COPY WNCPYSRC,FT0070C013
      *                                                                   056823
      *  If Cheque Amount is entered, validate for decimal places         056823
      *  using the header currency.                                       056823
      *                                                                   056823
     C           SCQAM     IFNE *BLANK                                    056823
     C           SCQAM     ORNE *ZEROS                                    056823
     C           13        SUB  PCDP      ZADIG                           056823
     C                     Z-ADDPCDP      ZADEC                           056823
     C                     MOVE *BLANKS   ZFIELD                          056823
     C                     MOVE SCQAM     ZFIELD                          056823
     C                     EXSR ZALIGN                                    056823
      *                                                                   056823
     C           *IN99     IFEQ '1'                                       056823
     C                     SETON                     5189                 056823
     C                     ADD  1         S                               056823
     C                     MOVE ' 051'    ERCD,S                          056823
     C                     ELSE                                           056823
     C                     MOVE ZFIELD    CQAM                            056823
     C                     END                                            056823
      *                                                                   056823
     C                     ELSE                                           056823
     C                     Z-ADD0         CQAM                            056823
     C                     END                                            056823
     C/COPY WNCPYSRC,FT0070C019
      *                                                                   056823
      *  If Credit CCY is valid and the Credit Ccy Amount is entered,     056823
      *  validate for decimal places using the credit ccy.                056823
      *                                                                   056823
     C           *IN52     IFEQ '0'                                       056823
     C           SCCYAM    ANDNE*BLANKS                                   056823
     C           13        SUB  CCDP      ZADIG                           056823
     C                     Z-ADDCCDP      ZADEC                           056823
     C                     MOVE *BLANKS   ZFIELD                          056823
     C                     MOVE SCCYAM    ZFIELD                          056823
     C                     EXSR ZALIGN                                    056823
      *                                                                   056823
     C           *IN99     IFEQ '1'                                       056823
     C                     SETON                     3389                 056823
     C                     ADD  1         S                               056823
     C                     MOVE ' 071'    ERCD,S                          056823
     C                     ELSE                                           056823
     C                     MOVE ZFIELD    CCYAM                           056823
     C                     END                                            056823
      *                                                                   056823
     C                     ELSE                                           056823
     C                     Z-ADD0         CCYAM                           056823
     C                     END                                            056823
     C/COPY WNCPYSRC,FT0070C020
      *                                                                   056823
      *  If amounts and credit ccy are not in error, then both amount     056823
      *  fields must not be blank                                         056823
      *                                                                   056823
     C           *IN51     IFEQ '0'                                       056823
     C           *IN33     ANDEQ'0'                                       056823
     C           *IN52     ANDEQ'0'                                       056823
      *                                                                   056823
     C           CQAM      IFEQ 0                                         056823
     C           CCYAM     ANDEQ0                                         056823
     C                     ADD  1         S                               056823
     C                     MOVE ' 050'    ERCD,S                          056823
     C                     SETON                     335189               056823
     C                     END                                            056823
      *                                                                   056823
     C                     END                                            056823
      *                                                                   056823
      *************************                                           056823
      **  VALIDATE RATE      **                                           056823
      *************************                                           056823
      *                                                                   CEU006
      * Rate validation now done by FT0010                                CEU006
      **********                                                    056823CEU006
      **Check*rate*only*if*amounts*and*currencies*are*O.K.*(Settle**056823CEU006
      **validated*O.K.*on*header).**********************************056823CEU006
      **********                                                    056823CEU006
     C********** *IN51     IFEQ '0'                        Cheque Am056823CEU006
     C********** *IN33     ANDEQ'0'                        Cr CCy Am056823CEU006
     C********** *IN52     ANDEQ'0'                        Credit Cc056823CEU006
     C/COPY WNCPYSRC,FT0070C014
     C**********           EXSR RATES                               056823CEU006
      **********                                                    056823CEU006
      **If*valid*rate*entered,*determine*if*any*other*errors********056823CEU006
      **********                                                    056823CEU006
     C********** *IN54     IFEQ '0'                                 056823CEU006
     C**********           Z-ADDNRATE     RATE                      056823CEU006
      **********                                                    056823CEU006
      ***Check*if*both*amounts*entered*-*always*invalid*if*first*pas056823CEU006
      ***of*Insert*mode,*otherwise*invalid*only*if*any*of*the*amount056823CEU006
      ***or*rate*or*credit*currency*values*have*been*altered.*******056823CEU006
      **********                                                    056823CEU006
      ***This*check*performed*here*coz*need*a*valid*rate*field.*****056823CEU006
      **********                                                    056823CEU006
      ***The*save*fields*are*initially*cleared*on*an*Insert*or*hold*056823CEU006
      ***file*field*values*on*an*Amend.*****************************056823CEU006
      **********                                                    056823CEU006
     C********** CQAM      IFNE 0                                   056823CEU006
     C********** CCYAM     ANDNE0                                   056823CEU006
      **********                                                    056823CEU006
     C********** SVCQAM    IFNE CQAM                                056823CEU006
     C********** SVCCAM    ORNE CCYAM                               056823CEU006
     C********** SVRATE    ORNE RATE                                056823CEU006
     C********** SVCRCY    ORNE CRCY                                056823CEU006
     C**********           ADD  1         S                         056823CEU006
     C**********           MOVE ' 073'    ERCD,S                    056823CEU006
     C**********           SETON                     335189         056823CEU006
     C**********           END                                      056823CEU006
      **********                                                    056823CEU006
     C**********           END                                      056823CEU006
      **********                                                    056823CEU006
      **The*rate*should*be*altered*if*the*credit*currency*is*changed056823CEU006
      **********                                                    056823CEU006
     C********** SVCRCY    IFNE CRCY                                056823CEU006
     C********** SVRATE    ANDEQRATE                                056823CEU006
     C**********           ADD  1         S                         056823CEU006
     C**********           MOVE ' 077'    ERCD,S                    056823CEU006
     C**********           SETON                     5489           056823CEU006
     C**********           END                                      056823CEU006
      **********                                                    056823CEU006
     C**********           END                                      056823CEU006
      **********                                                    056823CEU006
     C**********           END                                      056823CEU006
      *                                                                   056823
      *************************************                               056823
      **  CALCULATE AMOUNT EQUIVALENTS   **                               056823
      *************************************                               056823
      *                                                                   056823
      * If valid amount/rate/ccy, do final amount/rate processing         056823
      *                                                                   056823
     C           *IN33     IFEQ '0'                        Crd Ccy Amt    056823
     C           *IN51     ANDEQ'0'                        Cheque Amy     056823
     C           *IN52     ANDEQ'0'                        Ccy            056823
     C           *IN54     ANDEQ'0'                        Rate           056823
      *                                                                   056823
      * If cheque amount not entered, set parameters for calculation      056823
      * of cheque amount from credit currency amount                      056823
      *                                                                   056823
     C           CQAM      IFNE 0                                         056823
      *                                                                   056823
     C           SMDIN     IFEQ 0                                         056823
     C                     MOVEL'D'       I#MDIN                          056823
     C                     ELSE                                           056823
     C                     MOVEL'M'       I#MDIN                          056823
     C                     END                                            056823
      *                                                                   056823
     C                     Z-ADDCQAM      D#FAMT                          056823
     C                     MOVELSMCY      D#FCCY                          056823
     C                     MOVELCRCY      D#TCCY                          056823
      *                                                                   056823
      * If credit ccy amt not entered, set parameters for calculation     056823
      * of credit currency amount from cheque amount                      056823
      *                                                                   056823
     C                     ELSE                                           056823
      *                                                                   056823
     C           SMDIN     IFEQ 0                                         056823
     C                     MOVEL'M'       I#MDIN                          056823
     C                     ELSE                                           056823
     C                     MOVEL'D'       I#MDIN                          056823
     C                     END                                            056823
      *                                                                   056823
     C                     Z-ADDCCYAM     D#FAMT                          056823
     C                     MOVELCRCY      D#FCCY                          056823
     C                     MOVELSMCY      D#TCCY                          056823
     C                     END                                            056823
      *                                                                   056823
     C                     Z-ADDRATE      I#RATE                          056823
      *                                                                   056823
      * Calculate amount equivalent                                       056823
      *                                                                   056823
     C                     CALL 'AOCCYCV0'             9090               056823
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056823
     C                     PARM '*F*T*RAT'W0ACT   8                       056823
     C           D#DTA     PARM D#DTA     O#DTA 256                       056823
      *                                                                   056823
     C           *IN90     IFEQ '1'                                       056823
     C           R#RTN     ORNE *BLANKS                                   056823
     C                     MOVEL'*CALL   'W0FILE                          056823
     C                     MOVEL'AOCCYCV0'W0KEY                           056823
     C                     Z-ADD54        W0ERNB                          056823
     C                     MOVELERR@,1    W0NARR                          056823
     C                     EXSR SRERR                                     056823
     C                     END                                            056823
      *                                                                   056823
      * Map returned value to relevant amount field                       056823
      *                                                                   056823
     C********** CQAM      IFEQ 0                                   056823CEU006
     C**********           Z-ADDD#TAMT    CQAM                      056823CEU006
     C**********           ELSE                                     056823CEU006
     C**********           Z-ADDD#TAMT    CCYAM                     056823CEU006
     C**********           END                                      056823CEU006
     C/COPY WNCPYSRC,FT0070C015
      *                                                                   056823
      * Format cheque amount using settle ccy                             056823
      *                                                                   056823
     C           13        SUB  PCDP      WDIG                            056823
     C                     Z-ADDPCDP      WDEC                            056823
     C                     MOVE CQAM      WFDIN                           056823
     C                     EXSR FAMTSR                                    056823
     C                     MOVE WFDOUT    SCQAM                           056823
      *                                                                   056823
      * Format credit ccy equivalent amount using credit ccy              056823
      *                                                                   056823
     C           13        SUB  CCDP      WDIG                            056823
     C                     Z-ADDCCDP      WDEC                            056823
     C                     MOVE CCYAM     WFDIN                           056823
     C                     EXSR FAMTSR                                    056823
     C                     MOVE WFDOUT    SCCYAM                          056823
      *                                                                   CAC001
      **  Save amounts, rate and currency before validation to check if   CAC001
      **  necessary to force display of margin info window                CAC001
      *                                                                   CAC001
     C           *IN79     IFEQ *OFF                                      CAC001
     C/COPY WNCPYSRC,FT0070C049
     C                     Z-ADDSVCQAM    WSCQAM 130                      CAC001
     C                     Z-ADDSVCCAM    WSCYAM 130                      CAC001
     C                     Z-ADDSVRATE    WSRATE 138                      CAC001
     C                     MOVE SVCRCY    WSCRCY  3                       CAC001
     C                     ENDIF                                          CAC001
      *                                                                   056823
      * Save amount, rate, and currency fields in case they are           056823
      * changed within the payment cycle                                  056823
      *                                                                   056823
     C                     Z-ADDCQAM      SVCQAM                          056823
     C                     Z-ADDCCYAM     SVCCAM                          056823
     C                     Z-ADDRATE      SVRATE                          056823
     C                     MOVE CRCY      SVCRCY                          056823
      *                                                                   056823
     C                     END                                            056823
      *                                                                   056823
      *                                                                   142243
      ** Cross validation of currencies/amounts/rates                     142243
      *                                                                   142243
     C           *IN52     IFEQ *OFF                                      142243
     C           *IN01     ANDEQ*OFF                                      142243
      ** All currencies valid                                             142243
      *                                                                   142243
      * Align the Pay Delivery Amount if Pay Delivery Ccy entered.        142243
      *                                                                   142243
     C           SPDCY     IFNE *BLANKS                                   142243
     C           13        SUB  @3NBDP    ZADIG                           142243
     C                     Z-ADD@3NBDP    ZADEC                           142243
     C                     MOVE *BLANKS   ZFIELD                          142243
     C                     MOVE SPDAM     ZFIELD                          142243
     C                     EXSR ZALIGN                                    142243
      *                                                                   142243
     C           *IN99     IFEQ '1'                                       142243
     C                     MOVE *ON       *IN89                           142243
     C                     MOVE *ON       *IN13                           142243
     C                     MOVEL'FTM2600' FTMSID                          142243
     C                     EXSR FTSNMS                                    142243
     C                     ELSE                                           142243
     C                     MOVE ZFIELD    WPDAM  130                      142243
     C                     ENDIF                                          142243
     C                     ELSE                                           142243
     C                     Z-ADD0         WPDAM                           142243
     C                     ENDIF                                          142243
      *                                                                   142243
      ** Call FT0010 if Cheque amount/Credit currency amount and          142243
      ** Pay delivery amount are valid                                    142243
     C           *IN51     IFEQ *OFF                                      142243
     C           *IN33     ANDEQ*OFF                                      142243
     C           *IN13     ANDEQ*OFF                                      142243
      *                                                                   142243
      ** Set paramaters for call to FT0010                                142243
      *                                                                   142243
     C                     CLEARP#0010                                    142243
      *                                                                   142243
     C                     MOVEL'FT0070'  P#PMSQ                          142243
      *                                                                   142243
     C                     MOVE SMCY      P#DBCY                          142243
     C                     Z-ADDCQAM      P#DBAM                          142243
     C                     MOVE SCCCY     P#CRCY                          142243
     C                     Z-ADDCCYAM     P#CRAM                          142243
     C                     MOVE SPDCY     P#PDCY                          142243
     C                     Z-ADDWPDAM     P#PDAM                          142243
     C                     Z-ADDCRVD      P#CRDT                          142243
     C                     Z-ADDSLDT      P#DBDT                          142243
      *                                                                   142243
     C           SRATE     IFEQ *BLANK                                    142243
     C                     Z-ADD0         P#RATE                          142243
     C                     ELSE                                           142243
     C                     MOVE *BLANK    ZFIELD                          142243
     C                     MOVE SRATE     ZFIELD                          142243
     C                     Z-ADD4         ZADIG                           142243
     C                     Z-ADD8         ZADEC                           142243
     C                     EXSR ZALIGN                                    142243
     C                     MOVE ZFIELD    P#RATE                          142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     MOVE SOVER     P#OVRT                          142243
     C                     MOVE 'Y'       P#SDIN                          142243
     C                     MOVE BTPCRD    P#RTDS                          142243
      *                                                                   142243
     C                     CALL 'FT0010'                                  142243
     C                     PARM           P#0010                          142243
      *                                                                   142243
     C           P#RTCD    IFNE *BLANK                                    142243
     C                     MOVEL'AOCURRR0'DBFILE                          142243
     C                     MOVEL'*CALL'   DBKEY                           142243
     C                     Z-ADD45        DBASE                           142243
     C                     EXSR SRERR                                     142243
     C                     ENDIF                                          142243
     C/COPY WNCPYSRC,FT0070C114
      *                                                                   142243
      * Set screen error indicator                                        142243
     C           '1'       SCAN P#INDC:1  RESULT                          142243
      *                                                                   142243
     C           RESULT    IFGT 0                                         142243
     C                     MOVE *ON       *IN89                           142243
     C                     ENDIF                                          142243
      *                                                                   142243
      * Set screen indicators - Cheque amount                             142243
     C           1         SUBSTP#INDC:2  *IN51                           142243
      * Set screen indicator  - Credit currency amount                    142243
     C           1         SUBSTP#INDC:3  *IN33                           142243
      * Set screen indicator  - Pay delivery amount                       142243
     C           1         SUBSTP#INDC:4  *IN13                           142243
      * Set screen indicator  - Rate                                      142243
     C           1         SUBSTP#INDC:5  *IN54                           142243
      *                                                                   142243
      * Cheque amount                                                     142243
     C           P#DBAM    IFNE 0                                         142243
     C                     Z-ADD@1NBDP    PCDP    10                      142243
     C           13        SUB  PCDP      WDIG    20                      142243
     C                     Z-ADDPCDP      WDEC    10                      142243
     C                     MOVE P#DBAM    WFDIN                           142243
     C                     EXSR FAMTSR                                    142243
     C                     MOVE WFDOUT    SCQAM                           142243
     C                     ELSE                                           142243
     C                     MOVE *BLANKS   SCQAM                           142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     MOVE P#DBCY    SMCY                            142243
     C                     Z-ADDP#DBAM    CQAM                            142243
      *                                                                   142243
      * Credit currency amount                                            142243
     C           P#CRAM    IFNE 0                                         142243
     C                     Z-ADD@2NBDP    PCDP    10                      142243
     C           13        SUB  PCDP      WDIG    20                      142243
     C                     Z-ADDPCDP      WDEC    10                      142243
     C                     MOVE P#CRAM    WFDIN                           142243
     C                     EXSR FAMTSR                                    142243
     C                     MOVE WFDOUT    SCCYAM                          142243
     C                     ELSE                                           142243
     C                     MOVE *BLANKS   SCCYAM                          142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     MOVE P#CRCY    SCCCY                           142243
     C                     Z-ADDP#CRAM    CCYAM                           142243
      *                                                                   142243
      * Pay delivery                                                      142243
     C           P#PDAM    IFNE 0                                         142243
     C                     Z-ADD@3NBDP    PCDP    10                      142243
     C           13        SUB  PCDP      WDIG    20                      142243
     C                     Z-ADDPCDP      WDEC    10                      142243
     C                     MOVE P#PDAM    WFDIN                           142243
     C                     EXSR FAMTSR                                    142243
     C                     MOVE WFDOUT    SPDAM                           142243
     C                     ELSE                                           142243
     C                     MOVE *BLANKS   SPDAM                           142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     MOVE P#PDCY    PDCY                            142243
     C                     Z-ADDP#PDAM    PDAM                            142243
      *                                                                   142243
      * Rate                                                              142243
     C           P#RATE    IFNE 0                                         142243
     C                     Z-ADD5         WDIG                            142243
     C                     Z-ADD8         WDEC                            142243
     C                     MOVE P#RATE    WFDIN                           142243
     C                     EXSR FAMTSR                                    142243
     C                     MOVE WFDOUT    SRATE                           142243
     C                     ELSE                                           142243
     C                     MOVE *BLANKS   SRATE                           142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     Z-ADDP#RATE    RATE                            142243
      *                                                                   142243
      * Multiply/Divide indicator                                         142243
     C                     Z-ADDP#MDIN    MDIN                            142243
     C                     Z-ADDP#MDIN    SMDIN                           142243
      *                                                                   142243
     C                     ENDIF                                          142243
      *                                                                   142243
     C                     ENDIF                                          142243
      * Validate reference rate                                           CDL049
     C                     MOVE '0'       *IN81                           CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
      *                                                                   CDL049
     C           S#REFR    IFEQ *BLANKS                                   CDL049
     C                     Z-ADD0         SEREFR 138                      CDL049
     C                     ELSE                                           CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   ZFIELD                          CDL049
     C                     MOVELS#REFR    ZFIELD                          CDL049
     C                     Z-ADD8         ZADEC                           CDL049
     C                     Z-ADD5         ZADIG                           CDL049
     C                     EXSR ZALIGN                                    CDL049
      *                                                                   CDL049
     C           *IN99     IFEQ *ON                                       CDL049
     C                     MOVE '1'       *IN81                           CDL049
     C                     MOVE '1'       *IN89                           CDL049
     C                     MOVEL'FTM1321' ZAMSID                          CDL049
      *                                                                   CDL049
     C           ZAPGMQ    IFEQ *BLANK                                    CDL049
     C                     MOVEL##PGM     ZAPGMQ                          CDL049
     C                     ENDIF                                          CDL049
     C                     MOVEL'FTUSRMSG'ZAMSGF                          CDL049
      *                                                                   CDL049
     C                     CALL 'Y2SNMGC'                                 CDL049
     C                     PARM           ZAPGMQ 10        Program queue  CDL049
     C                     PARM           ZAPGRL  5        Rel queue      CDL049
     C                     PARM           ZAMSID  7        Message Id.    CDL049
     C                     PARM           ZAMSGF 10        Message file.  CDL049
     C                     PARM           ZAMSDA132        Message data.  CDL049
     C                     PARM           ZAMSTP  7        Message type.  CDL049
     C                     ADD  1         S                               CDL049
     C                     MOVE ' 555'    ERCD,S                          CDL049
     C                     Z-ADD0         SWRKRR 138                      CDL049
     C                     ELSE                                           CDL049
      *                                                                   CDL049
     C                     MOVE ZFIELD    SEREFR                          CDL049
      *                                                                   CDL049
     C                     CALL 'ZEDIT'                9090               CDL049
     C                     PARM           ZFIELD 16                       CDL049
     C                     PARM 8         ZADEC   10                      CDL049
     C                     MOVE ZFIELD    S#REFR                          CDL049
      *                                                                   CDL049
     C                     Z-ADD*ZERO     MINRAT 138                      CDL049
     C                     Z-ADD*ZERO     MAXRAT 138                      CDL049
     C                     Z-ADD*ZERO     UETOLR 138                      CDL049
     C                     Z-ADD*ZERO     UERRAT 138                      CDL049
      *                                                                   CDL049
     C           IRATET    DIV  100       UERRAT                          CDL049
     C           P#RATE    MULT UERRAT    UETOLR    H                     CDL049
     C           P#RATE    SUB  UETOLR    MINRAT    H                     CDL049
     C           P#RATE    ADD  UETOLR    MAXRAT    H                     CDL049
      *                                                                   CDL049
     C           SEREFR    IFGT MAXRAT                                    CDL049
     C           SEREFR    ANDNE0                                         CDL049
     C           SEREFR    ORLT MINRAT                                    CDL049
     C           SEREFR    ANDNE0                                         CDL049
      *                                                                   CDL049
      * Make sure warning is displayed at least once                      CDL049
     C           SEREFR    IFNE SWRKRR                                    CDL049
     C                     MOVEL'FTM1320' ZAMSID                          CDL049
      *                                                                   CDL049
     C           ZAPGMQ    IFEQ *BLANK                                    CDL049
     C                     MOVEL##PGM     ZAPGMQ                          CDL049
     C                     ENDIF                                          CDL049
     C                     MOVEL'FTUSRMSG'ZAMSGF                          CDL049
      *                                                                   CDL049
     C                     CALL 'Y2SNMGC'                                 CDL049
     C                     PARM           ZAPGMQ 10        Program queue  CDL049
     C                     PARM           ZAPGRL  5        Rel queue      CDL049
     C                     PARM           ZAMSID  7        Message Id.    CDL049
     C                     PARM           ZAMSGF 10        Message file.  CDL049
     C                     PARM           ZAMSDA132        Message data.  CDL049
     C                     PARM           ZAMSTP  7        Message type.  CDL049
     C                     ADD  1         S                               CDL049
     C                     MOVE 'W10'     ERCD,S                          CDL049
     C                     MOVE '1'       *IN81                           CDL049
     C                     MOVE '1'       *IN89                           CDL049
     C                     ENDIF                                          CDL049
     C                     MOVE SEREFR    SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C********************************************
     C**  VALIDATE CHARGES TO DEBIT OF ACCOUNT  **
     C********************************************
     C*
     C           SCHDB     IFEQ *BLANKS                    B003
     C           SCDBR     ANDEQ*BLANKS                                   S01117
     C                     MOVE *BLANKS   CDRO
     C                     MOVE *BLANKS   CDBR                            S01117
     C                     MOVE *BLANKS   CDRT
     C                     ELSE                            X003
     C*                                                                   S01194
     C** DISALLOW '?' TO AVOID SUBFILE DISPLAYS LATER                     S01194
     C                     MOVEA*BLANKS   FLDQ                            S01194
     C                     MOVEASCHDB     FLDQ                            S01194
     C           '?'       LOKUPFLDQ                     15               S01194
     C           *IN15     IFEQ '1'                                       S01194
     C                     SETON                     6189                 S01194
     C                     ADD  1         S                               S01194
     C                     MOVE ' 065'    ERCD,S                          S01194
     C                     END                                            S01194
     C*                                                                   S01117
     C** IF MBIN ON AND CHARGES NOT ENTERED AS A PARTIAL AND CHARGES      S01117
     C** BRANCH ENTERED,THEN ERROR.                                       S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C           SCHDBP    ANDEQ*BLANKS                                   S01117
     C           SCDBR     ANDNE*BLANKS                                   S01117
     C                     SETON                     6189                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 068'    ERCD,S                          S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** IF NO ERRORS SO FAR CARRY ON WITH VALIDATION.                    S01117
     C*                                                                   S01117
     C           *IN61     IFEQ '0'                                       S01117
     C*
     C**  CHECK IF VALID NOSTRO
     C*
     C                     MOVE *BLANK    CDRT
     C                     MOVE *BLANK    ERRC
     C                     MOVELSCHDB     CHK3    3
     C                     MOVE CHK3      CHK1
     C/COPY WNCPYSRC,FT0070C044
     C           CHK1      IFEQ *BLANK                     B004
     C           SCDBR     ANDEQ*BLANKS                                   S01117
     C*
     C**  VALIDATE NOSTRO CODE
     C*
     C*********************MOVELBCCY      NOSCHN                          S01194
     C                     MOVELBJCYCD    NOSCHN                          S01194
     C                     MOVELSCHDB     NOSCH
     C                     MOVE NOSCH     NOSCHN
     C                     EXSR NOCHN
     C*
     C           *IN75     IFEQ '1'                        B005
     C                     MOVE 'N'       CDRT
     C                     MOVELSCHDB     CDRO
     C                     MOVE *BLANKS   CDBR                            S01117
      *                                                                   047179
      *  Store fields for key to ACCNT                                    047179
      *                                                                   047179
     C**********           Z-ADDCNUM      CNUMSV                                       047179 CSD027
     C                     MOVE CNUM      CNUMSV                                              CSD027
     C                     MOVE BJCYCD    CCYSV                           047179
     C                     Z-ADDACOD      ACODSV                          047179
     C                     Z-ADDACSQ      ACSQSV                          047179
     C*                                                                   047179
     C                     ELSE                            X005
     C                     MOVE 'E'       ERRC
     C                     SETON                     6189
     C                     ADD  1         S
     C*********************MOVE ' 185'    ERCD,S                          S01117
     C                     MOVE ' 064'    ERCD,S                          S01117
     C                     END                             E005
     C                     END                             E004
     C*
     C**  CHECK IF RETAIL NUMBER
     C*
     C           CDRT      IFEQ *BLANK                     B004
     C           ERRC      ANDEQ*BLANK
     C                     MOVELSCHDB     CHK11  11
     C                     MOVE CHK11     CHK1
     C           CHK1      IFEQ *BLANK                     B005
     C           SCDBR     ANDEQ*BLANKS                                   S01117
     C*
     C**  VALIDATE RETAIL NUMBER
     C*
     C                     MOVELSCHDB     RETCHN
     C                     EXSR RECHN
     C           *IN75     IFEQ '1'                        B006
     C*
     C** CHECK TO SEE IF RETAIL ACCOUNT NUMBER IS ALLOWED
     C*
     C***********RACN******IFNE 'Y'                                       S01194
     C           BMRANR    IFNE 'Y'                                       S01194
     C                     SETON                     6189
     C                     ADD  1         S
     C*********************MOVE ' 414'    ERCD,S                          S01117
     C                     MOVE ' 024'    ERCD,S                          S01117
     C                     MOVE 'N'       RA2#N   1
     C*
     C                     ELSE
     C                     MOVE *BLANK    RA2#N   1
     C*
     C***********CCY*******IFNE BCCY                       B007           S01194
     C           CCY       IFNE BJCYCD                     B007           S01194
     C                     MOVE 'E'       ERRC
     C                     SETON                     6189
     C                     ADD  1         S
     C*********************MOVE ' 188'    ERCD,S                          S01117
     C                     MOVE ' 066'    ERCD,S                          S01117
     C                     ELSE                            X007
     C                     MOVE 'R'       CDRT
     C                     MOVE SCHDB     CDRO
     C                     MOVE *BLANKS   CDBR                            S01117
     C                     END                             E007
      *
     C                     END                             E006
     C                     END
      *
     C           *IN75     IFEQ '0'                        B006
     C                     MOVE 'E'       ERRC
     C                     SETON                     6189
     C                     ADD  1         S
     C*********************MOVE ' 187'    ERCD,S                          S01117
     C                     MOVE ' 065'    ERCD,S                          S01117
     C                     END                             E006
      *
     C                     END                             E005
     C                     END                             E004
     C*
     C**  VALIDATE ACCOUNT IDENTIFIER
     C*
     C           CDRT      IFEQ *BLANK                     B004
     C           ERRC      ANDEQ*BLANK
     C           RA2#N     ANDEQ*BLANK
     C*                                                                   S01117
     C** IF MB AND BRANCH FIELD BLANK ERROR                               S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C           SCDBR     ANDEQ*BLANK                                    S01117
     C                     SETON                     6189                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 069'    ERCD,S                          S01117
     C                     ELSE                                           S01117
     C                     MOVELSCHDB     CUSTA   9
     C*********************MOVE BCCY      CUSTA                           S01194
     C                     MOVE BJCYCD    CUSTA                           S01194
     C                     MOVE SCHDB     ACCOHN
     C                     MOVELCUSTA     ACCOHN
     C*********************MOVE ACCOHN    ACCKY                           S01117
     C                     MOVELACCOHN    ACCKY                           S01117
      *
     C           *IN20     IFEQ '0'                                       S01117
     C                     MOVE BJSBRC    BRCAK                           S01117
     C                     ELSE                                           S01117
     C                     MOVE SCDBR     BRCAK                           S01117
     C                     END                                            S01117
      *
     C                     EXSR ACCHN
      *
     C           *IN75     IFEQ '1'                        B005
     C                     MOVE 'P'       CDRT
     C                     MOVE SCHDB     CDRO
      *
     C           *IN20     IFEQ '1'                                       S01117
     C                     MOVE SCDBR     CDBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BJSBRC    CDBR                            S01117
     C                     END                                            S01117
      *
     C                     ELSE                            X005
     C                     SETON                     6189
     C                     ADD  1         S
     C*********************MOVE ' 189'    ERCD,S                          S01117
     C                     MOVE ' 067'    ERCD,S                          S01117
     C                     END                             E005
      *
     C                     END                                            S01117
     C                     END                             E004
     C                     END                             *IN15 END      S01194
      *                                                                   047179
      * If a valid nostro A/C has been entered access the ACCNT record    047179
      *                                                                   047179
     C           *IN61     IFEQ '0'                                       047179
     C           CDRT      ANDEQ'N'                                       047179
     C                     EXSR ACHAIN                                    047179
     C                     END                                            047179
      *                                                                   047179
      *  Check if the credit value date is in the future and if           047179
      *  the account is closing day                                       047179
      *                                                                   047179
     C           *IN61     IFEQ '0'                                       047179
      *                                                                   047179
     C           CRVD      IFGT BJRDNB                                    047179
     C           ACST      ANDEQ'C'                                       047179
     C                     ADD  1         S                               047179
     C                     MOVE ' 604'    ERCD,S                          047179
     C                     SETON                     6189                 047179
     C                     END                                            047179
      *                                                                   047179
     C                     END                                            047179
     C*                                                                   047179
     C                     END                             E003
     C*
     C**  VALIDATE TRANSFER COMMISION TARIFF
     C*
     C           STCTF     IFNE '1'                        B003
     C           STCTF     ANDNE'2'
     C           STCTF     ANDNE'3'
     C           STCTF     ANDNE'4'
     C           STCTF     ANDNE'5'
     C                     SETON                     5689
     C                     ADD  1         S
     C*********************MOVE ' 177'    ERCD,S                          S01117
     C                     MOVE ' 058'    ERCD,S                          S01117
     C                     ELSE                            X003
     C*                                                                   074814
     C** Recalculate transfer commission if tariff has changed            074814
     C** but the transfer commission amount has not                       074814
     C           STCTF     IFNE TRCT                       ** B03         074814
     C           STRCME    ANDEQSCHG,1                                    074814
     C           SCQAM     ORNE SCQSV                                     074814
     C           STRCME    ANDEQSCHG,1                                    074814
     C                     MOVE *BLANK    STRCME                          074814
     C                     END                             **  E03        074814
     C*                                                                   074814
     C** Recalculate FX/Change commission if tariff has changed           074814
     C** but FX/Change commission amount has not                          074814
     C*                                                                   074814
     C           STCTF     IFNE TRCT                                      074814
     C           SCHCME    ANDEQSCHG,5                                    074814
     C           SCQAM     ORNE SCQSV                                     074814
     C           SCHCME    ANDEQSCHG,5                                    074814
     C                     MOVE *BLANK    SCHCME                          074814
     C                     END                                            074814
     C*                                                                   074814
     C                     MOVE STCTF     TRCT
     C                     END                             E003
     C*
     C**   VALIDATE CHARGE AMOUNTS
     C*    -----------------------
     C*
     C* ONLY VALIDATE IF NO PREVIOUS ERROR FOR SCCCY(COULD CAUSE
     C* DATABASE ERROR HERE)
     C*
     C           SCCCY     IFNE *BLANKS                    B003
      *                                                                   042509
      * Check that currency and rate entered is correct.                  042509
      * and that at least one amount has been entered - if no amounts     056823
      * entered then rate is not validated/defaulted so *IN54 not on      056823
      * even if RATE field is 0. This results in divide by zero error.    056823
      *                                                                   042509
     C           *IN52     ANDEQ'0'                        Credit Ccy     042509
     C           *IN54     ANDEQ'0'                        Rate           E25159
     C           *IN33     ANDEQ'0'                        Crd CCy Amt    056823
     C           *IN51     ANDEQ'0'                        Chq Amt        056823
      *                                                                   CEU006
      ** Set paramaters for call to FT0010                                CEU006
      ** This call to FT0010 to establish rate for charges calcs          CEU006
      *                                                                   CEU006
     C                     CLEARP#0010                                    CEU006
      *                                                                   CEU006
     C                     MOVEL'FT0070'  P#PMSQ                          CEU006
      *                                                                   CEU006
     C                     MOVE SMCY      P#FRCY                          CEU006
     C                     Z-ADDCQAM      P#FRAM                          CEU006
     C                     Z-ADDSLDT      P#FRDT                          CEU006
     C                     MOVE CRCY      P#TOCY                          CEU006
     C                     Z-ADDCRVD      P#TODT                          CEU006
      *                                                                   CEU006
     C                     CALL 'FT0010'                                  CEU006
     C                     PARM           P#0010                          CEU006
      *                                                                   CEU006
     C           P#RTCD    IFNE *BLANK                                    CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD49        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      * Rate                                                              CEU006
     C                     Z-ADDP#TOAM    AMOUNT 150H                     CEU006
      *                                                                   CEU006
     C*
     C**READ*TABLE*FILE*FOR*CREDIT*CURRENCY*DETAILS********************   S01194
     C**ACCESS*SDCURRPD*FOR*CREDIT*CURRENCY*DETAILS*****************S01194CEU006
     C**********                                                          CEU006
     C**********           MOVE CRCY      CCYD    3                       CEU006
     C**********           EXSR CUDP                                      CEU006
     C**********           Z-ADDDP        CCDP    10                      CEU006
     C**********           Z-ADDMDIN      CMDIN   10                      CEU006
     C**********           Z-ADDA6SPRT    CSPOT  138                S01194CEU006
     C*********************Z-ADDSPOT      CSPOT  138                      S01194
     C**********                                                          CEU006
     C**READ*TABLE*FILE*FOR*HEADER*CURRENCY*DETAILS********************   S01194
     C**ACCESS*SDCURRPD*FOR*HEADER*CURRENCY*DETAILS*****************S01194CEU006
     C**********           MOVE SMCY      CCYD                            CEU006
     C**********           EXSR CUDP                                      CEU006
     C****CONVERT*RATE*TO*INCLUDE*DIFFERENCE*IN*DECIMAL*PLACES*********   CEU006
     C********** CCDP      SUB  DP        N                               CEU006
     C**********                                                          CEU006
     C**IF*MULTIPLY****************************************************   CEU006
     C**********                                                          CEU006
     C********** SMDIN     IFEQ 1                          B004           CEU006
     C********** N         IFGT 0                          B005           CEU006
     C********** RATE      MULT POWERS,N  IRATE  159                      CEU006
     C**********           ELSE                            X005           CEU006
     C********** N         IFLT 0                          B006           CEU006
     C**********           Z-SUBN         N                               CEU006
     C********** RATE      DIV  POWERS,N  IRATE                           CEU006
     C**********           ELSE                            X006           CEU006
     C**********           Z-ADDRATE      IRATE                           CEU006
     C**********           END                             E006           CEU006
     C**********           END                             E005           CEU006
     C**********           END                             E004           CEU006
     C**********                                                          CEU006
     C**IF*DIVIDE******************************************************   CEU006
     C**********                                                          CEU006
     C********** SMDIN     IFEQ 0                          B004           CEU006
     C********** N         IFGT 0                          B005           CEU006
     C********** RATE      DIV  POWERS,N  IRATE                           CEU006
     C**********           ELSE                            X005           CEU006
     C********** N         IFLT 0                          B006           CEU006
     C**********           Z-SUBN         N                               CEU006
     C********** RATE      MULT POWERS,N  IRATE                           CEU006
     C**********           ELSE                            X006           CEU006
     C**********           Z-ADDRATE      IRATE                           CEU006
     C**********           END                             E006           CEU006
     C**********           END                             E005           CEU006
     C**********           END                             E004           CEU006
     C**********                                                          CEU006
     C********** SMDIN     IFEQ 1                          B004           CEU006
     C********** CQAM      MULT IRATE     AMOUNT 150H                     CEU006
     C**********           ELSE                            X004           CEU006
     C********** CQAM      DIV  IRATE     AMOUNT    H                     CEU006
     C**********           END                             E004           CEU006
     C*
     C* IF CHARGE CODE SET TO "C" ENTRY CURRENCY IS SAME AS CREDIT
     C* CURRENCY
     C***********FTCC******IFEQ 'C'                        B004           S01194
     C***********BTCHCY****IFEQ 'C'                        B004     S01194E37065
     C           SCHDB     IFNE *BLANK                     B004           E37065
     C********** BTCHCY    OREQ 'B'                                                  E37065 AR944056
     C           BTCHCY    IFEQ 'B'                                                         AR944056
     C                     MOVE BJCYCD    SECCY                           E37065
     C                     ELSE                                                             AR944056
     C           BTCHCY    IFEQ 'F'                                                         AR944056
     C                     MOVE FCHCCY    SECCY                                             AR944056
     C                     ENDIF                                                            AR944056
     C                     ENDIF                                                            AR944056
     C                     ELSE                            X004           E37065
     C           BTCHCY    IFEQ 'C'                        B005           E37065
     C                     MOVE SCCCY     SECCY                           E37065
     C                     END                             E005
      *                                                                                     AR940742
     C********** BTCHCY    IFEQ 'F'                                                AR940742 AR944056
     C**********           MOVE FCHCCY    SECCY                                    AR940742 AR944056
     C**********           END                                                     AR940742 AR944056
     C                     END                             E004           E37065
     C*
     C                     MOVE SECCY     CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        A6NBDP                          S01194
     C*********************Z-ADDDP        CDP                             S01194
     C*                                                                   S01508
     C** Calculate default charges if there are no errors                 S01508
     C/COPY WNCPYSRC,FT0070C050
     C*                                                                   S01508
     C           *IN52     IFEQ '0'                                       S01508
     C           *IN54     ANDEQ'0'                                       S01508
     C           *IN38     ANDEQ'0'                                       S01508
     C                     EXSR DFTCHG                                    S01508
     C                     END                                            S01508
     C*
     C* CHARGES ONLY VALIDATED IF THEY HAVE BEEN AMENDED BY USER
     C*
     C*  TRANSFER COMMISSION CHARGE
     C*  --------------------------
     C**   TRANSFER COMMISSION IS OPTIONAL. IF ENTERED MUST NOT HAVE
     C**   DECIMAL PLACES EXCEEDING THOSE OF ENTRY CCY
     C*
     C**  Use the default value of the Transfer Commission if             S01508
     C**  the field is blank                                              S01508
     C*                                                                   S01508
     C           STRCME    IFEQ *BLANKS                                   E23056
      **OR IF CHEQUE AMOUNT CHANGED AND TRANSFER COMMISSION HASN'T
     C*                                                                   S01508
     C           ACT2      OREQ 'A'
     C           SCQAM     ANDNESCQSV
     C           STRCME    ANDEQSCHG,1
     C*                                                                   S01508
     C**  OR the core feature S01508 is installed on AMEND mode           S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed.                                       S01508
     C*                                                                   S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           S01508    ANDEQ'Y'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C           STRCME    ANDEQSCHG,1
     C/COPY WNCPYSRC,FT0070C051
     C*                                                                   S01508
     C**  If the calculated value is 0, initialize the screen             S01508
     C**  field to blanks.                                                S01508
     C*                                                                   S01508
     C           DUMA1     IFNE 0                                         E23056
     C                     Z-ADDA6NBDP    ZDECS                           S01508
     C                     Z-ADDDUMA1     ZFLD15                          S01508
     C                     MOVE ' '       ZECODE                          S01508
     C                     EXSR ZSEDIT                                    S01508
     C                     MOVE ZOUT21    STRCME                          S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   STRCME                          S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*
     C                     Z-ADD0         TRCM                            S01494
     C                     Z-ADD0         SDUMA1                          S01494
     C           STRCME    IFNE *BLANKS                                   E25274
     C***********STRCME****IFNE SCHG,1                                    E25274
     C***********STRCME****ANDNE*BLANKS                                   E25274
     C***********11********SUB  CDP       ZADIG                           S01194
     C*********************Z-ADDCDP       ZADEC                           S01194
     C           11        SUB  A6NBDP    ZADIG                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSTRCME    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         S
     C*********************MOVE '178'     ERCD,S                          S01117
     C                     MOVE '059'     ERCD,S                          S01117
     C                     SETON                     5789
     C                     ELSE
     C*
     C* IF AMOUNT ENTERED,CONVERT TO AMOUNT FOR FILE
     C*
     C                     MOVE STRCME    SAMNT  12
     C                     EXSR CHGLT2
     C                     MOVE SAMNTF    STRCMF
     C                     Z-ADDAMNT      SDUMA1 110
     C                     Z-ADDFAMNT     TRCM
     C*
     C                     END
     C*
     C                     END
     C*
     C**IF*INSERT,AND*AMOUNT*NOT*ENTERED,CALCULATE*DEFAULT*               E23056
     C*
     C***********ACT2      IFEQ 'I'                                       E23056
     C***********STRCME    ANDEQ*BLANKS                                   E23056
     C***********STRCME    IFEQ *BLANKS                            E23056 S01508
      **OR*IF*CHEQUE*AMOUNT*CHANGED*AND*TRANSFER*COMMISSION*HASN'T*****   S01508
     C***********                                                         S01508
     C***********ACT2      OREQ 'A'                                       S01508
     C***********SCQAM     ANDNESCQSV                                     S01508
     C***********STRCME    ANDEQSCHG,1                                    S01508
     C***********          EXSR DFTCHG                                    S01508
     C***********          END                                            S01508
     C***********                                                         S01508
     C**IF*COMMISSION*SET*TO*BLANK*SET*FILE*AMOUNT*TO*ZERO*               E23056
     C***********                                                         E23056
     C***********ACT2      IFEQ 'A'                                       E23056
     C***********STRCME    ANDEQ*BLANKS                                   E23056
     C***********                                                         E23056
     C***********          Z-ADD*ZEROS    TRCM                            E23056
     C***********          Z-ADD*ZEROS    TRCMD                           E23056
     C***********                                                         E23056
     C***********          END                                            E23056
     C*
     C                     Z-ADDTRCM      TTLCHG 130
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF TRANSFER COMMISSION.                        S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI1    IFNE 'Y'                                       S01499
     C           SVATI1    ANDNE'N'                                       S01499
     C           SVATI1    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '081'     ERCD,S                          S01499
     C                     SETON                     0589                 S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI1                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01494
     C** CHANGE COMMISSION CHARGE                                         S01494
     C** --------------------------                                       S01494
     C** IF CHANGE COMMISSION FEATURE IS SWITCHED ON. VALIDATE.           S01494
     C** CHANGE COMMISSION IS OPTIONAL.  IF ENTERED MUST NOT HAVE         S01494
     C** DECIMAL PLACES EXCEEDING THOSE OF ENTRY CCY.  CAN ONLY BE        S01494
     C** INPUT IF THE CREDIT CCY IS DIFFERENT FROM THE SETTLE CCY.        S01494
     C*                                                                   S01494
     C                     Z-ADD0         SDUMA5                          S01494
     C                     Z-ADD0         CCCHCM                          S01494
     C           SMCY      IFNE CRCY                                      S01494
     C*                                                                   S01508
     C**  Use the default value of the FX/Change Commission if            S01508
     C**  the field is blank                                              S01508
     C           SCHCME    IFEQ *BLANKS                                   S01508
      **  or the cheque amount changed and FX/Change Commission hasn't    S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           SCQAM     ANDNESCQSV                                     S01508
     C** TEMP07                                                           S01494
     C           SCHCME    ANDEQSCHG,5                                    S01494
     C*                                                                   S01508
     C**  OR the core feature S01508 is installed                         S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed.                                       S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C** TEMP07                                                           S01494
     C           SCHCME    ANDEQSCHG,5                                    S01494
     C           S01508    ANDEQ'Y'                                       S01508
     C/COPY WNCPYSRC,FT0070C052
     C*                                                                   S01508
     C**  If the calculated value is 0, initialize the screen             S01508
     C**  field to blanks.                                                S01508
     C*                                                                   S01508
     C           CCDUM5    IFNE 0                                         S01494
     C                     Z-ADDA6NBDP    ZDECS                           S01508
     C                     Z-ADDCCDUM5    ZFLD15                          S01508
     C                     MOVE ' '       ZECODE                          S01508
     C                     EXSR ZSEDIT                                    S01508
     C                     MOVE ZOUT21    SCHCME                          S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   SCHCME                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C                     END                                            S01494
     C*
     C           *IN09     IFEQ '1'                                       S01494
     C           SCHCME    IFNE *BLANKS                                   S01494
     C*                                                                   S01494
     C           SMCY      IFEQ CRCY                                      S01494
     C                     ADD  1         S                               S01494
     C                     MOVE '079'     ERCD,S                          S01494
     C                     SETON                     3289                 S01494
     C                     ELSE                                           S01494
     C           11        SUB  A6NBDP    ZADIG                           S01494
     C                     Z-ADDA6NBDP    ZADEC                           S01494
     C                     MOVEL*BLANKS   ZFIELD                          S01494
     C                     MOVELSCHCME    ZFIELD                          S01494
     C                     EXSR ZALIGN                                    S01494
     C           *IN99     IFEQ '1'                                       S01494
     C                     ADD  1         S                               S01494
     C                     MOVE '080'     ERCD,S                          S01494
     C                     SETON                     3289                 S01494
     C                     ELSE                                           S01494
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
     C           *IN32     ANDEQ*OFF                                      CEU006
     C           SCHCME    ANDNE*BLANKS                                   CEU006
      ** Settle in/Pay in                                                 CEU006
     C           @1INCY    IFEQ 'Y'                                       CEU006
     C           SLDT      ANDGE@1TPSD                                    140646
     C           @2INCY    ANDEQ'Y'                                       CEU006
     C           CRVD      ANDGE@2TPSD                                    140646
      ** Settle in/Pay Euro                                               CEU006
     C           @1INCY    OREQ 'Y'                                       CEU006
     C           SLDT      ANDGE@1TPSD                                    140646
     C           SCCCY     ANDEQBKEURO                                    CEU006
      ** Settle Euro/Pay in                                               CEU006
     C           SSMCY     OREQ BKEURO                                    CEU006
     C           @2INCY    ANDEQ'Y'                                       CEU006
     C           CRVD      ANDGE@2TPSD                                    140646
     C                     MOVE *ON       *IN89                           CEU006
     C                     MOVE *ON       *IN32                           CEU006
     C                     MOVEL'FTM2599' FTMSID                          CEU006
     C                     EXSR FTSNMS                                    CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C*                                                                   S01494
     C** IF AMOUNT ENTERED,CONVERT TO AMOUNT FOR FILE                     S01494
     C*                                                                   S01494
     C                     MOVE SCHCME    SAMNT                           S01494
     C                     EXSR CHGLT2                                    S01494
     C                     MOVE SAMNTF    SCHCMF                          S01494
     C                     Z-ADDAMNT      SDUMA5 110                      S01494
     C                     Z-ADDFAMNT     CCCHCM                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C           SCHCME    IFEQ *BLANKS                                   S01494
     C                     MOVE *BLANKS   SCHCMF                          S01494
     C                     Z-ADD*ZEROS    SDUMA5                          S01494
     C                     Z-ADD*ZEROS    CCCHCM                          S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     ADD  CCCHCM    TTLCHG                          S01494
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF CHANGE COMMISSION.                          S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI5    IFNE 'Y'                                       S01499
     C           SVATI5    ANDNE'N'                                       S01499
     C           SVATI5    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '082'     ERCD,S                          S01499
     C                     SETON                     0689                 S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI5    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI5                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C                     END                                            S01494
     C*
     C*  TELEX CHARGE
     C*  ------------
     C*
     C**   TELEX CHARGE IS OPTIONAL BUT IF ENTERED, THE NO. OF
     C**   DECIMAL PLACES EXCEEDING THOSE OF ENTRY CCY
     C*
      *                                                                   E32533
      *  E32533  - Charges not cleared                                    E32533
      *                                                                   E32533
     C                     Z-ADD0         SDUMA2                          E32533
     C                     Z-ADD0         TXCH                            E32533
     C*                                                                   S01508
     C**  Use the default value of the Telex Charge if                    S01508
     C**  the field is blank OR the core feature S01508 is installed      S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed.
     C           S01508    IFEQ 'Y'                                       S01508
     C           STXCHE    IFEQ *BLANKS                                   S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           SCQAM     ANDNESCQSV                                     S01508
     C           STXCHE    ANDEQSCHG,2                                    S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C           STXCHE    ANDEQSCHG,2                                    S01508
     C/COPY WNCPYSRC,FT0070C053
     C*                                                                   S01508
     C**  If the calculated value is 0, initialize the screen             S01508
     C**  field to blanks.                                                S01508
     C*                                                                   S01508
     C           DUMA2     IFNE 0                                         S01508
     C                     Z-ADDA6NBDP    ZDECS                           S01508
     C                     Z-ADDDUMA2     ZFLD15                          S01508
     C                     MOVE ' '       ZECODE                          S01508
     C                     EXSR ZSEDIT                                    S01508
     C                     MOVE ZOUT21    STXCHE                          S01508
     C                     ELSE
     C                     MOVE *BLANKS   STXCHE
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C           STXCHE    IFNE *BLANKS                                   E25274
     C***********STXCHE****IFNE SCHG,2                                    E25274
     C***********STXCHE****ANDNE*BLANKS                                   E25274
     C***********11********SUB  CDP       ZADIG                           S01194
     C*********************Z-ADDCDP       ZADEC                           S01194
     C           11        SUB  A6NBDP    ZADIG                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSTXCHE    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         S
     C*********************MOVE '180'     ERCD,S                          S01117
     C                     MOVE '062'     ERCD,S                          S01117
     C                     SETON                     5889
     C                     ELSE
     C*
     C* IF AMOUNT ENTERED,CONVERT TO AMOUNT FOR FILE
     C*
     C                     MOVE STXCHE    SAMNT
     C                     EXSR CHGLT2
     C                     MOVE SAMNTF    STXCHF
     C                     Z-ADDAMNT      SDUMA2 110
     C                     Z-ADDFAMNT     TXCH
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF TELEX CHARGE SET TO BLANK SET FILE AMOUNT TO ZERO
     C*
     C***********ACT2******IFEQ 'A'                                       E23056
     C***********STXCHE****ANDEQ*BLANKS                                   E23056
     C           STXCHE    IFEQ *BLANKS                                   E23056
     C*
     C                     MOVE *BLANKS   STXCHF                          E23056
     C                     Z-ADD*ZEROS    SDUMA2                          E23056
     C                     Z-ADD*ZEROS    TXCH
     C                     Z-ADD*ZEROS    TXCHD
     C*
     C                     END
     C*
     C                     ADD  TXCH      TTLCHG
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF TELEX CHARGE.                               S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI4    IFNE 'Y'                                       S01499
     C           SVATI4    ANDNE'N'                                       S01499
     C           SVATI4    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '085'     ERCD,S                          S01499
     C                     SETON                     3989                 S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI4                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*
     C*  COSTS ABROAD CHARGE
     C*  -------------------
     C*
     C**   COSTS ABROAD CHARGE IS OPTIONAL BUT IF ENTERED, THE NO. OF
     C**   DECIMAL PLACES EXCEEDING THOSE OF ENTRY CCY
     C*
      *                                                                   E32533
      *  E32533  - Charges not cleared                                    E32533
      *                                                                   E32533
     C                     Z-ADD0         SDUMA3                          E32533
     C                     Z-ADD0         CSTA                            E32533
     C*                                                                   S01508
     C**  Use the default value of the Costs Abroad if                    S01508
     C**  the field is blank OR the core feature S01508 is installed      S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed.
     C           S01508    IFEQ 'Y'                                       S01508
     C           SCSTAE    IFEQ *BLANKS                                   S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           SCQAM     ANDNESCQSV                                     S01508
     C           SCSTAE    ANDEQSCHG,3                                    S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C           SCSTAE    ANDEQSCHG,3                                    S01508
     C/COPY WNCPYSRC,FT0070C054
     C*                                                                   S01508
     C**  If the calculated value is 0, initialize the screen             S01508
     C**  field to blanks.                                                S01508
     C*                                                                   S01508
     C           DUMA3     IFNE 0
     C                     Z-ADDA6NBDP    ZDECS                           S01508
     C                     Z-ADDDUMA3     ZFLD15                          S01508
     C                     MOVE ' '       ZECODE                          S01508
     C                     EXSR ZSEDIT                                    S01508
     C                     MOVE ZOUT21    SCSTAE                          S01508
     C                     ELSE
     C                     MOVE *BLANKS   SCSTAE
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C           SCSTAE    IFNE *BLANKS                                   E25274
     C***********SCSTAE****IFNE SCHG,3                                    E25274
     C***********SCSTAE****ANDNE*BLANKS                                   E25274
     C***********11********SUB  CDP       ZADIG                           S01194
     C*********************Z-ADDCDP       ZADEC                           S01194
     C           11        SUB  A6NBDP    ZADIG                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSCSTAE    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         S
     C*********************MOVE '182'     ERCD,S                          S01117
     C                     MOVE '063'     ERCD,S                          S01117
     C                     SETON                     5989
     C                     ELSE
     C*
     C* IF AMOUNT ENTERED,CONVERT TO AMOUNT FOR FILE
     C*
     C                     MOVE SCSTAE    SAMNT
     C                     EXSR CHGLT2
     C                     MOVE SAMNTF    SCSTAF
     C                     Z-ADDAMNT      SDUMA3 110
     C                     Z-ADDFAMNT     CSTA
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF COSTS ABROAD CHARGE SET TO BLANK SET FILE AMOUNT TO ZERO
     C*
     C***********ACT2******IFEQ 'A'                                       E23056
     C***********SCSTAE****ANDEQ*BLANKS                                   E23056
     C           SCSTAE    IFEQ *BLANKS                                   E23056
     C*
     C                     MOVE *BLANKS   SCSTAF                          E23056
     C                     Z-ADD*ZEROS    SDUMA3                          E23056
     C                     Z-ADD*ZEROS    CSTA
     C                     Z-ADD*ZEROS    CSTAD
     C*
     C                     END
     C*
     C                     ADD  CSTA      TTLCHG
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF COST ABROAD.                                S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI3    IFNE 'Y'                                       S01499
     C           SVATI3    ANDNE'N'                                       S01499
     C           SVATI3    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '084'     ERCD,S                          S01499
     C                     SETON                     1189                 S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI3                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*
     C*  COLLECTION CHARGES
     C*  ------------------
     C*
     C**   COLLECTION CHARGES ARE OPTIONAL BUT IF ENTERED, THE NO. OF
     C**   DECIMAL PLACES EXCEEDING THOSE OF ENTRY CCY
     C*
      *                                                                   E32533
      *  E32533  - Charges not cleared                                    E32533
      *                                                                   E32533
     C                     Z-ADD0         SDUMA4                          E32533
     C                     Z-ADD0         COLL                            E32533
     C*                                                                   S01508
     C**  Use the default value of the Collection Charges if              S01508
     C**  the field is blank OR the core feature S01508 is installed      S01508
     C**  AND either the "charges to the debit of" (if entered) or        S01508
     C**  credit party has changed.
     C           S01508    IFEQ 'Y'                                       S01508
     C           SCOLLE    IFEQ *BLANKS                                   S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           SCQAM     ANDNESCQSV                                     S01508
     C           SCOLLE    ANDEQSCHG,4                                    S01508
     C           ACT2      OREQ 'A'                                       S01508
     C           W0FCUS    ANDNEW0SCUS                                    S01508
     C           SCOLLE    ANDEQSCHG,4                                    S01508
     C/COPY WNCPYSRC,FT0070C055
     C*                                                                   S01508
     C**  If the calculated value is 0, initialize the screen             S01508
     C**  field to blanks.                                                S01508
     C*                                                                   S01508
     C           DUMA4     IFNE 0                                         S01508
     C                     Z-ADDA6NBDP    ZDECS                           S01508
     C                     Z-ADDDUMA4     ZFLD15                          S01508
     C                     MOVE ' '       ZECODE                          S01508
     C                     EXSR ZSEDIT                                    S01508
     C                     MOVE ZOUT21    SCOLLE                          S01508
     C                     ELSE                                           S01508
     C                     MOVE *BLANKS   SCOLLE                          S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C           SCOLLE    IFNE *BLANKS                                   E25274
     C***********SCOLLE****IFNE SCHG,4                                    E25274
     C***********SCOLLE****ANDNE*BLANKS                                   E25274
     C***********11********SUB  CDP       ZADIG                           S01194
     C*********************Z-ADDCDP       ZADEC                           S01194
     C           11        SUB  A6NBDP    ZADIG                           S01194
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSCOLLE    ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     ADD  1         S
     C*********************MOVE '250'     ERCD,S                          S01117
     C                     MOVE '060'     ERCD,S                          S01117
     C                     SETON                     6089
     C                     ELSE
     C*
     C* IF AMOUNT ENTERED,CONVERT TO AMOUNT FOR FILE
     C*
     C                     MOVE SCOLLE    SAMNT
     C                     EXSR CHGLT2
     C                     MOVE SAMNTF    SCOLLF
     C                     Z-ADDAMNT      SDUMA4 110
     C                     Z-ADDFAMNT     COLL
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF COLLECTION CHARGE SET TO BLANK SET FILE AMOUNT TO ZERO
     C*
     C***********ACT2******IFEQ 'A'                                       E23056
     C***********SCOLLE****ANDEQ*BLANKS                                   E23056
     C           SCOLLE    IFEQ *BLANKS                                   E23056
     C*
     C                     MOVE *BLANKS   SCOLLF                          E23056
     C                     Z-ADD*ZEROS    SDUMA4                          E23056
     C                     Z-ADD*ZEROS    COLL
     C                     Z-ADD*ZEROS    COLLD
     C*
     C                     END
     C*
     C                     ADD  COLL      TTLCHG
     C*                                                                   S01499
     C** VALIDATE VAT FLAG OF COLLECTION CHARGE                           S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATI2    IFNE 'Y'                                       S01499
     C           SVATI2    ANDNE'N'                                       S01499
     C           SVATI2    ANDNE' '                                       S01499
     C                     ADD  1         S                               S01499
     C                     MOVE '083'     ERCD,S                          S01499
     C                     SETON                     1089                 S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ ' '                                       S01499
     C                     MOVE C#VATT    SVATI2                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** IF V.A.T. FEATURE IS SWITCHED ON, COMPUTE VAT AMOUNT FOR EACH    S01499
     C** CHARGE.                                                          S01499
     C*                                                                   S01499
     C                     Z-ADD0         CCVATT                          S01499
     C                     Z-ADD0         SDUMA6 110                      S01499
     C/COPY WNCPYSRC,FT0070C117
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     Z-ADD0         #CVATT 110                                          CER049
     C                     Z-ADD0         #SDUMA 110                                          CER049
     C           *IN08     IFEQ '1'                                       S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ 'Y'                                       S01499
     C           TXCH      MULT O#VATR    VAT    110H                     S01499
     C                     ADD  VAT       CCVATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ 'Y'                                       S01499
     C           CSTA      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       CCVATT                          S01499
     C/COPY WNCPYSRC,FT0070C118
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #CVATT                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ 'Y'                                       S01499
     C           COLL      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       CCVATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ 'Y'                                       S01499
     C           TRCM      MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       CCVATT                          S01499
     C/COPY WNCPYSRC,FT0070C119
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #CVATT                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI5    IFEQ 'Y'                                       S01499
     C           *IN09     ANDEQ'1'                                       S01494
     C           CCCHCM    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       CCVATT                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C*                                                                   S01499
     C           SVATI4    IFEQ 'Y'                                       S01499
     C           SDUMA2    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       SDUMA6                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI3    IFEQ 'Y'                                       S01499
     C           SDUMA3    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       SDUMA6                          S01499
     C/COPY WNCPYSRC,FT0070C120
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #SDUMA                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI2    IFEQ 'Y'                                       S01499
     C           SDUMA4    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       SDUMA6                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI1    IFEQ 'Y'                                       S01499
     C           SDUMA1    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       SDUMA6                          S01499
     C/COPY WNCPYSRC,FT0070C121
      *                                                                                       CER049
      ** VAT should not be calculated on the same amount the Stamp tax                        CER049
      ** is, neither should it be calculated on the stamp tax amount                          CER049
      ** Store this amount and subtract from total VAT amount if Stamp Tax                    CER049
      ** is due on this transaction when Stamp tax is calulated.                              CER049
      *                                                                                       CER049
     C                     ADD  VAT       #SDUMA                                              CER049
     C                     END                                            S01499
     C*                                                                   S01499
     C           SVATI5    IFEQ 'Y'                                       S01499
     C           *IN09     ANDEQ'1'                                       S01494
     C           SDUMA5    MULT O#VATR    VAT       H                     S01499
     C                     ADD  VAT       SDUMA6                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     ADD  SDUMA6    TTLCHG                          S01499
     C*                                                                   S01499
     C** FORMAT VAT FIELD FOR POTENTAIL REDISPLAY                         S01499
     C*                                                                   S01499
     C           SDUMA6    IFNE 0                                         S01499
     C                     Z-ADDA6NBDP    ZDECS                           S01499
     C                     MOVE ' '       ZECODE                          S01499
     C                     Z-ADDSDUMA6    ZFLD15                          S01499
     C                     EXSR ZSEDIT                                    S01499
     C                     MOVE ZOUT21    SVATTE                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C           CCVATT    IFNE 0                                         S01499
     C                     Z-ADDFCDP      ZDECS                           S01499
     C                     MOVE ' '       ZECODE                          S01499
     C                     Z-ADDCCVATT    ZFLD15                          S01499
     C                     EXSR ZSEDIT                                    S01499
     C                     MOVE ZOUT21    SVATTF                          S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C                     END                                            S01499
     C*
     C           TTLCHG    IFGT AMOUNT
     C                     ADD  1         S
     C*********************MOVE '418'     ERCD,S                          S01117
     C                     MOVE '061'     ERCD,S                          S01117
     C                     SETON                       89
     C           STRCME    IFNE *BLANKS
     C                     SETON                     57
     C                     END
     C           SCOLLE    IFNE *BLANKS
     C                     SETON                     60
     C                     END
     C           SCSTAE    IFNE *BLANKS
     C                     SETON                     59
     C                     END
     C           STXCHE    IFNE *BLANKS
     C                     SETON                     58
     C                     END
     C           *IN09     IFEQ '1'                                       S01494
     C           SCHCME    ANDNE*BLANKS                                   S01494
     C                     SETON                     32                   S01494
     C                     END                                            S01494
     C           *IN08     IFEQ '1'                                       S01499
     C           SVATTE    ANDNE*BLANKS                                   S01499
     C                     SETON                     36                   S01499
     C                     END                                            S01499
     C                     END
     C*
     C                     END
     C*
     C**  CENTRAL BANK REFERENCE VALIDATION
     C*
     C**  FIRST BANK CODE MANDATORY
     C/COPY WNCPYSRC,FT0070C087
     C*
     C                     Z-ADD0         DNBC1
     C/COPY WNCPYSRC,FT0070C088
     C           SDBC1     IFEQ *BLANKS                    B003
     C                     ELSE                            X003
     C*
     C**  CHECK IF VALID NUMERIC
     C*
     C                     Z-ADD11        ZADIG
     C                     Z-ADD0         ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSDBC1     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     6289
     C                     ADD  1         S
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC1                           035398
     C                     MOVE SDBC1     DNBC1
     C                     END                             E004
     C                     END                             E003
     C*
     C**  CHECK IF BANK CODE 2 IS A VALID NUMERIC
     C/COPY WNCPYSRC,FT0070C089
     C*
     C                     Z-ADD0         DNBC2
     C/COPY WNCPYSRC,FT0070C090
     C           SDBC2     IFNE *BLANKS                    B003
     C                     Z-ADD11        ZADIG                           125638
     C                     Z-ADD0         ZADEC                           125638
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSDBC2     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     6389
     C                     ADD  1         S                               E25160
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC2                           035398
     C                     MOVE SDBC2     DNBC2
     C                     END                             E004
     C                     END                             E003
     C*
     C**  CHECK IF BANK CODE 3 IS A VALID NUMERIC
     C/COPY WNCPYSRC,FT0070C091
     C*
     C                     Z-ADD0         DNBC3
     C/COPY WNCPYSRC,FT0070C092
     C           SDBC3     IFNE *BLANKS                    B003
     C                     Z-ADD11        ZADIG                           125638
     C                     Z-ADD0         ZADEC                           125638
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSDBC3     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     6489
     C                     ADD  1         S                               E25159
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC3                           035398
     C                     MOVE SDBC3     DNBC3
     C                     END                             E004
     C                     END                             E003
     C*
     C**  CHECK IF BANK CODE 4 IS A VALID NUMERIC
     C/COPY WNCPYSRC,FT0070C093
     C*
     C                     Z-ADD0         DNBC4
     C/COPY WNCPYSRC,FT0070C094
     C           SDBC4     IFNE *BLANKS                    B003
     C                     Z-ADD11        ZADIG                           125638
     C                     Z-ADD0         ZADEC                           125638
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSDBC4     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     6589
     C                     ADD  1         S                               E25159
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC4                           035398
     C                     MOVE SDBC4     DNBC4
     C                     END                             E004
     C                     END                             E003
     C*
     C**  CHECK IF BANK CODE 5 IS A VALID NUMERIC
     C/COPY WNCPYSRC,FT0070C095
     C*
     C                     Z-ADD0         DNBC5
     C/COPY WNCPYSRC,FT0070C096
     C           SDBC5     IFNE *BLANKS                    B003
     C                     Z-ADD11        ZADIG                           125638
     C                     Z-ADD0         ZADEC                           125638
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVELSDBC5     ZFIELD
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        B004
     C                     SETON                     6689
     C                     ADD  1         S                               E25159
     C*********************MOVE ' 176'    ERCD,S                          S01117
     C                     MOVE ' 070'    ERCD,S                          S01117
     C                     ELSE                            X004
     C                     MOVE ZFIELD    @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC5                           035398
     C                     MOVE SDBC5     DNBC5
     C                     END                             E004
     C                     END                             E003
      ***********                                                   CEU006142243
      ***Cross*validation of currencies/amounts/rates               CEU006142243
      ***********                                                   CEU006142243
     C************IN52     IFEQ *OFF                                CEU006142243
     C************IN01     ANDEQ*OFF                                CEU006142243
      ***All*currencies valid                                       CEU006142243
      ***********                                                   CEU006142243
      **Align*the Pay Delivery Amount if Pay Delivery Ccy entered.  CEU006142243
      ***********                                                   CEU006142243
     C***********PDCY      IFNE *BLANKS                             CEU006141288
     C***********SPDCY     IFNE *BLANKS                             141288142243
     C***********13        SUB  @3NBDP    ZADIG                     CEU006142243
     C***********          Z-ADD@3NBDP    ZADEC                     CEU006142243
     C***********          MOVE *BLANKS   ZFIELD                    CEU006142243
     C***********          MOVE SPDAM     ZFIELD                    CEU006142243
     C***********          EXSR ZALIGN                              CEU006142243
      ***********                                                   CEU006142243
     C************IN99     IFEQ '1'                                 CEU006142243
     C***********          MOVE *ON       *IN89                     CEU006142243
     C***********          MOVE *ON       *IN13                     CEU006142243
     C***********          MOVEL'FTM2600' FTMSID                    CEU006142243
     C***********          EXSR FTSNMS                              CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE ZFIELD    WPDAM  130                CEU006142243
     C***********          ENDIF                                    CEU006142243
     C***********          ELSE                                     141288142243
     C***********          Z-ADD0         WPDAM                     141288142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
      ***Call*FT0010 if Cheque amount/Credit currency amount and    CEU006142243
      ***Pay*delivery amount are valid                              CEU006142243
     C************IN51     IFEQ *OFF                                CEU006142243
     C************IN33     ANDEQ*OFF                                CEU006142243
     C************IN13     ANDEQ*OFF                                CEU006142243
      ***********                                                   CEU006142243
      ***Set*paramaters for call to FT0010                          CEU006142243
      ***********                                                   CEU006142243
     C***********          CLEARP#0010                              CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVEL'FT0070'  P#PMSQ                    CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVE SMCY      P#DBCY                    CEU006142243
     C***********          Z-ADDCQAM      P#DBAM                    CEU006142243
     C***********          MOVE SCCCY     P#CRCY                    CEU006142243
     C***********          Z-ADDCCYAM     P#CRAM                    CEU006142243
     C***********          MOVE SPDCY     P#PDCY                    CEU006142243
     C***********          Z-ADDWPDAM     P#PDAM                    CEU006142243
     C***********          Z-ADDCRVD      P#CRDT                    CEU006142243
     C***********          Z-ADDSLDT      P#DBDT                    CEU006142243
      ***********                                                   CEU006142243
     C***********SRATE     IFEQ *BLANK                              CEU006142243
     C***********          Z-ADD0         P#RATE                    CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE *BLANK    ZFIELD                    CEU006142243
     C***********          MOVE SRATE     ZFIELD                    CEU006142243
     C***********          Z-ADD4         ZADIG                     CEU006142243
     C***********          Z-ADD8         ZADEC                     CEU006142243
     C***********          EXSR ZALIGN                              CEU006142243
     C***********          MOVE ZFIELD    P#RATE                    CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVE SOVER     P#OVRT                    CEU006142243
     C***********          MOVE 'Y'       P#SDIN                    CEU006142243
     C***********          MOVE BTPCRD    P#RTDS                    CEU006142243
      ***********                                                   CEU006142243
     C***********          CALL 'FT0010'                            CEU006142243
     C***********          PARM           P#0010                    CEU006142243
      ***********                                                   CEU006142243
     C***********P#RTCD    IFNE *BLANK                              CEU006142243
     C***********          MOVEL'AOCURRR0'DBFILE                    CEU006142243
     C***********          MOVEL'*CALL'   DBKEY                     CEU006142243
     C***********          Z-ADD45        DBASE                     CEU006142243
     C***********          EXSR SRERR                               CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
      **Set*screen error indicator                                  CEU006142243
     C***********'1'       SCAN P#INDC:1  RESULT                    CEU006142243
      ***********                                                   CEU006142243
     C***********RESULT    IFGT 0                                   CEU006142243
     C***********          MOVE *ON       *IN89                     CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
      **Set*screen indicators - Cheque amount                       CEU006142243
     C***********1         SUBSTP#INDC:1  *IN51                     CEU006141288
     C***********1         SUBSTP#INDC:2  *IN51                     141288142243
      **Set*screen indicator  - Credit currency amount              CEU006142243
     C***********1         SUBSTP#INDC:2  *IN33                     CEU006141288
     C***********1         SUBSTP#INDC:3  *IN33                     141288142243
      **Set*screen indicator  - Pay delivery amount                 CEU006142243
     C***********1         SUBSTP#INDC:3  *IN13                     CEU006141288
     C***********1         SUBSTP#INDC:4  *IN13                     141288142243
      **Set*screen indicator  - Rate                                CEU006142243
     C***********1         SUBSTP#INDC:5  *IN54                     CEU006142243
      ***********                                                   CEU006142243
     C************IN89     IFEQ *OFF                                CEU006141288
      ***********                                                   CEU006142243
      **Cheque*amount                                               CEU006142243
     C***********P#DBAM    IFNE 0                                   CEU006142243
     C***********          Z-ADD@1NBDP    PCDP    10                CEU006142243
     C***********13        SUB  PCDP      WDIG    20                CEU006142243
     C***********          Z-ADDPCDP      WDEC    10                CEU006142243
     C***********          MOVE P#DBAM    WFDIN                     CEU006142243
     C***********          EXSR FAMTSR                              CEU006142243
     C***********          MOVE WFDOUT    SCQAM                     CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE *BLANKS   SCQAM                     CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVE P#DBCY    SMCY                      CEU006142243
     C***********          Z-ADDP#DBAM    CQAM                      CEU006142243
      ***********                                                   CEU006142243
      **Credit*currency amount                                      CEU006142243
     C***********P#CRAM    IFNE 0                                   CEU006142243
     C***********          Z-ADD@2NBDP    PCDP    10                CEU006142243
     C***********13        SUB  PCDP      WDIG    20                CEU006142243
     C***********          Z-ADDPCDP      WDEC    10                CEU006142243
     C***********          MOVE P#CRAM    WFDIN                     CEU006142243
     C***********          EXSR FAMTSR                              CEU006142243
     C***********          MOVE WFDOUT    SCCYAM                    CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE *BLANKS   SCCYAM                    CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVE P#CRCY    SCCCY                     CEU006142243
     C***********          Z-ADDP#CRAM    CCYAM                     CEU006142243
      ***********                                                   CEU006142243
      **Pay*delivery                                                CEU006142243
     C***********P#PDAM    IFNE 0                                   CEU006142243
     C***********          Z-ADD@3NBDP    PCDP    10                CEU006142243
     C***********13        SUB  PCDP      WDIG    20                CEU006142243
     C***********          Z-ADDPCDP      WDEC    10                CEU006142243
     C***********          MOVE P#PDAM    WFDIN                     CEU006142243
     C***********          EXSR FAMTSR                              CEU006142243
     C***********          MOVE WFDOUT    SPDAM                     CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE *BLANKS   SPDAM                     CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
     C***********          MOVE P#PDCY    PDCY                      CEU006142243
     C***********          Z-ADDP#PDAM    PDAM                      CEU006142243
      ***********                                                   CEU006142243
      **Rate*****                                                   CEU006142243
     C***********P#RATE    IFNE 0                                   CEU006142243
     C***********          Z-ADD5         WDIG                      CEU006142243
     C***********          Z-ADD8         WDEC                      CEU006142243
     C***********          MOVE P#RATE    WFDIN                     CEU006142243
     C***********          EXSR FAMTSR                              CEU006142243
     C***********          MOVE WFDOUT    SRATE                     CEU006142243
     C***********          ELSE                                     CEU006142243
     C***********          MOVE *BLANKS   SRATE                     CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   CEU006142243
     C***********          Z-ADDP#RATE    RATE                      CEU006142243
      ***********                                                   CEU006142243
      **Multiply/Divide indicator                                   CEU006142243
     C***********          Z-ADDP#MDIN    MDIN                      CEU006142243
     C***********          Z-ADDP#MDIN    SMDIN                     CEU006142243
      ***********                                                   CEU006142243
     C***********          ENDIF                                    141288142243
      ***********                                                   CEU006142243
     C***********          ENDIF                                    CEU006142243
      ***********                                                   S01414142243
     C***********          ENDIF                                    CEU006142243
      *                                                                   S01414
      ** Check Book Code field for entry of ?                             S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASBOKC     FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     15               S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN16                           S01414
     C*
     C/COPY WNCPYSRC,FT0070CCP3
     C*
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     CALL 'AOBOOKR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDBOOK    SBOKC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SBOKC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Book Code.                                          S01414
      *                                                                   S01414
     C                     MOVEL*BLANKS   W#BOKC                          179732
     C                     MOVELSBOKC     W#BOKC                          S01414
     C                     EXSR SRBOOK                                    S01414
     C                     MOVELW#BOKC    SBOKC                           S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN83     IFEQ '0'                                       S01414
     C                     MOVELW#BOKC    BOKC                            S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Check Profit Centre field for entry of ?                         S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
     C                     MOVEA*BLANKS   FLDQ                            S01414
     C                     MOVEASPRFC     FLDQ                            S01414
     C           '?'       LOKUPFLDQ                     15               S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     MOVE '1'       *IN16                           S01414
     C*
     C/COPY WNCPYSRC,FT0070CCP4
     C*
     C                     END                                            S01414
      *                                                                   S01414
      ** If ? found, seton redisplay ind and call access program          S01414
      *                                                                   S01414
     C           *IN15     IFEQ '1'                                       S01414
     C                     CALL 'AOPRFCR0'                                S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM '?'       U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      ** If selection made, move value to screen field                    S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ *BLANKS                                   S01414
     C                     MOVELSDPRFC    SPRFC                           S01414
     C                     ELSE                                           S01414
     C                     MOVEL*BLANKS   SPRFC                           S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Validate the Profit Centre if Used.                              S01414
      *                                                                   S01414
     C                     MOVEL*BLANKS   W#PRFC                          179732
     C                     MOVELSPRFC     W#PRFC                          S01414
     C                     EXSR SRPRFC                                    S01414
     C                     MOVELW#PRFC    SPRFC                           S01414
      *                                                                   S01414
      *  If no error move screen field to file field                      S01414
      *                                                                   S01414
     C           *IN86     IFEQ '0'                                       S01414
     C                     MOVELW#PRFC    PRFC                            S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,FT0070CSFV                                           S01408
     C*                                                                   S01408
      *
      *  END of screen validation
      *
     C                     END                             E002
     C/COPY WNCPYSRC,FT0070C034
     C*
     C*
     C* CHECK IF WARNING ERROR (ONLY IF NO SEVERE ERRORS)                 E32543
      *                                                                   E32543
     C           *IN19     IFEQ '1'                                       E32543
      *                                                                   E32543
     C* IF ENTER PRESSED AND FIELDS UNCHANGED ASSUME ACCEPTANCE           E32543
      *                                                                   E32543
     C           *IN22     IFEQ '1'                                       E32543
      *                                                                   E32543
     C********** *IN32**** IFEQ '1'                                E32543 056823
     C********** CCYAM**** ANDEQCCYAO                              E32543 056823
     C******************** SETOF                     32            E32543 056823
     C******************** SUB  1         S                        E32543 056823
     C******************** END                                     E32543 056823
      *                                                                   E32543
     C           *IN23     IFEQ '1'                                       E32543
     C           SCVDA     ANDEQSCVDO                                     E32543
     C                     SETOF                     23                   E32543
     C                     SUB  1         S                               E32543
     C                     END                                            E32543
      *                                                                   E32543
     C***********CCYAM**** IFEQ CCYAO                               E32543056823
     C***********SCVDA**** ANDEQSCVDO                              E32543 056823
     C           SCVDA     IFEQ SCVDO                              E32543 056823
     C                     SETOF                     1922                 E32543
     C                     END                                            E32543
      *                                                                   E32543
     C* ASSUME FIRST DISPLAY OF WARNING ERROR                             E32543
      *                                                                   E32543
     C                     ELSE                                           E32543
     C                     SETON                     22                   E32543
     C******************** MOVE CCYAM     CCYAO  130               E32543 056823
     C                     MOVE SCVDA     SCVDO                           E32543
     C                     END                                            E32543
      *                                                                   E32543
     C                     END                                            E32543
      *                                                                   E32543
      * If no errors setof the general error indicator (it is seton       E32543
      * if a warning error occurs).                                       E32543
      *                                                                   E32543
     C/COPY WNCPYSRC,FT0070C035
     C           S         IFEQ 0                                         E32543
     C           *IN01     IFEQ *OFF                                      CEU006
     C           *IN13     ANDEQ*OFF                                      CEU006
     C           *IN32     ANDEQ*OFF                                      CEU006
     C           *IN54     ANDEQ*OFF                                      CEU006
     C                     SETOF                     89                   E32543
     C                     ENDIF                                          CEU006
     C                     MOVEA*BLANK    ERCD                            E32543
     C                     END                                            E32543
     C*
     C**  ERROR IF A DELETE SCREEN AND NOT F10 - RE-OUTPUT SCREEN
     C**    BUT WITHOUT ERROR CODES
     C*
     C                     SETOF                     87
      *
     C           SACTD     IFEQ 'D'                        B002
     C           *IN04     ANDEQ'0'
     C                     SETON                     8789
     C                     END                             E002
      *                                                                   CAC001
      **  If Analytical Accounting is on and no errors...                 CAC001
      *                                                                   CAC001
     C           *IN89     IFEQ *OFF                                      CAC001
     C           BGWDPR    ANDEQ'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C           SACTD     OREQ 'E'                                       CAC001
     C           BGWDPR    ANDEQ'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C           SACTD     OREQ 'D'                                       CAC001
     C           BGWDPR    ANDEQ'Y'                                       CAC001
     C           BGN0ST    ANDEQ'Y'                                       CAC001
     C                     MOVE 'KT'      KEY                             CAC001
     C                     MOVE SACTD     ACTION                          CAC001
     C                     MOVE SACTD     WACTD                           CAC001
     C                     Z-ADDRATE      WRATE                           CAC001
     C                     MOVE 'P'       WDPSI                           CAC001
     C                     MOVE CRCY      WPUCY                           CAC001
     C                     MOVE SMCY      WSLCY                           CAC001
     C                     Z-ADDCCYAM     WPUAM                           CAC001
     C                     Z-ADDCQAM      WSLAM                           CAC001
     C                     Z-ADDSMDIN     WMDIN                           CAC001
     C                     Z-ADDWOFXMP    WFXMP                           CAC001
     C                     Z-ADDWOFXMD    WFXMD                           CAC001
     C                     MOVE WOMBSI    WMBSI                           CAC001
     C                     MOVE WOMSIG    WMSIG                           CAC001
     C                     Z-ADDWOMAMT    WMAMT                           CAC001
     C                     MOVE '0'       *IN79                           CAC001
      *                                                                   CAC001
      **  If F19 was pressed, call window program manager if enquire or   CAC001
      **  delete, or if not enquire nor delete and DR/CR currencies are   CAC001
      **  different, or not enquire nor delete, DR/CR currencies are      CAC001
      **  the same, and margin information exists                         CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *ON                                       CAC001
     C           ACT2      IFEQ 'E'                                       CAC001
     C           ACT2      OREQ 'D'                                       CAC001
     C           SMCY      ORNE SCCCY                                     CAC001
     C           SMCY      OREQ SCCCY                                     CAC001
     C           WOMBSI    ANDNE*BLANKS                                   CAC001
     C           SMCY      OREQ SCCCY                                     CAC001
     C           WOMSIG    ANDNE*BLANKS                                   CAC001
     C                     MOVE 'N'       WFRC                            CAC001
     C                     MOVE '1'       *IN79                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  If not in enquiry or delete mode, ENTER was pressed, either     CAC001
      **  credit currency, rate, or amounts were changed, and there is    CAC001
      **  a margin info, force a call to the window program               CAC001
      *                                                                   CAC001
     C           ACT2      IFNE 'E'                                       CAC001
     C           ACT2      ANDNE'D'                                       CAC001
      *                                                                   CAC001
     C           *INKT     IFEQ *OFF                                      CAC001
     C           *IN03     ANDEQ*OFF                                      CAC001
     C           *IN04     ANDEQ*OFF                                      CAC001
     C           *IN24     ANDEQ*OFF                                      CAC001
     C           *IN03     OREQ *ON                                       CAC001
     C           *IN89     ANDEQ*OFF                                      CAC001
      *                                                                   CAC001
     C           SVCRCY    IFNE WSCRCY                                    CAC001
     C           SVRATE    ORNE WSRATE                                    CAC001
     C           SVCQAM    ORNE WSCQAM                                    CAC001
     C           SVCCAM    ORNE WSCYAM                                    CAC001
      *                                                                   CAC001
     C           WOMBSI    IFNE *BLANKS                                   CAC001
     C           WOMSIG    ORNE *BLANKS                                   CAC001
     C                     MOVE 'Y'       WFRC                            CAC001
     C                     MOVE '1'       *IN79                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
      **  Call window manager WN0010 for the optional window and re-      CAC001
      **  output screen upon exit from window                             CAC001
      *                                                                   CAC001
     C           *IN79     IFEQ *ON                                       CAC001
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVEL'1'       *IN76                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'0'       *IN76                                               CER049
     C                     ENDIF                                                              CER049
     C                     WRITE#MSGCTL                                   CAC001
     C/COPY WNCPYSRC,FT0070C063
      *                                                                                     AR804457
     C           SACTD     IFEQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     SETOF                     76                                     AR804457
     C                     ENDIF                                                            AR804457
     C           SACTD     IFEQ 'E'                                                         AR804457
     C                     SETON                     76                                     AR804457
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C                     WRITEFT0070F3                                  CAC001
     C                     SETON                     8789                 CAC001
     C                     UNLCKDLDA                                      CAC001
     C                     CALL 'WN0010'                                  CAC001
     C                     PARM 'FT0070  '#PGM   10                       CAC001
     C                     PARM           KEY     2                       CAC001
     C                     PARM           ACTION  1                       CAC001
     C                     PARM           DATA                            CAC001
     C                     PARM *BLANK    #RTRN   7                       CAC001
     C                     PARM           SPARE 256                       CAC001
     C           *LOCK     IN   DLDA                                      CAC001
      *                                                                   CAC001
      **  Check return code                                               CAC001
      *                                                                   CAC001
     C           #RTRN     IFEQ 'Y2U9999'                                 CAC001
     C                     SETON                     03LR  E.O.J RequestedCAC001
     C                     GOTO EXDETL                                    CAC001
     C                     ELSE                                           CAC001
     C           #RTRN     IFNE *BLANK                                    CAC001
     C                     CALL 'SNDERMSG'                                CAC001
     C                     PARM 'FT0070'  ZAPGM  10        Program queue  CAC001
     C                     PARM           ZAPGRL  5        Rel queue      CAC001
     C                     PARM #RTRN     ZAMSID  7        Msg Id.        CAC001
     C                     PARM 'WNMSGF'  ZAMSGF 10        Msg file.      CAC001
     C                     PARM           ZAMSDA132        Message data.  CAC001
     C                     PARM           ZAMSTP  7        Message type.  CAC001
      *                                                                   CAC001
      **  Clear all fields                                                CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    ZAPGM            Program queue  CAC001
     C                     MOVEL*BLANK    ZAPGRL           Rel queue      CAC001
     C                     MOVEL*BLANK    ZAMSID           Message Id.    CAC001
     C                     MOVEL*BLANK    ZAMSGF           Message file.  CAC001
     C                     MOVEL*BLANK    ZAMSDA           Message data.  CAC001
     C                     MOVEL*BLANK    ZAMSTP           Message type.  CAC001
      *                                                                   CAC001
      **  If ENTER pressed from window, update margin info work fields    CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADDWFXMP     WOFXMP                          CAC001
     C                     Z-ADDWFXMD     WOFXMD                          CAC001
     C                     MOVE WMBSI     WOMBSI                          CAC001
     C                     MOVE WMSIG     WOMSIG                          CAC001
     C                     Z-ADDWMAMT     WOMAMT                          CAC001
     C                     MOVE '0'       *IN79                           CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
     C/COPY WNCPYSRC,FT0070C070
      *                                                                   058194
      *  Call windows processing                                          058194
      *                                                                   058194
     C           *IN89     IFEQ '0'                        B002           058194
     C           *IN03     ANDEQ'0'                                       058194
     C           *IN12     ANDEQ'0'                                       058194
     C           FTNOUP    ANDEQ*BLANKS                                   058194
     C                     MOVE CRPY      CRPY1                                               CER001
     C                     MOVE SPREF     PREF                                                CER001
     C                     MOVE SCQSQ     #1CQSQ                                              CER001
     C                     MOVEL'FT0070'  #1PGM     P                                         CER001
     C           ULX043    IFEQ 'Y'                                                           CER001
     C                     CALL 'FT0070A'                                                     CER001
     C                     PARM           SACTD                                               CER001
     C                     PARM           PDATA                                               CER001
     C                     PARM           #RTRN   7                                           CER001
     C                     PARM           SPARE 256                                           CER001
      *                                                                                       CER001
      ** F3 has been pressed                                                                  CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'Y2U9999'                                                     CER001
     C                     MOVE *ON       *INLR                                               CER001
     C                     MOVE '1'       @RETC                                               CER001
      *                                                                                       CER001
      ** Allocate data area to blanks                                                         CER001
      *                                                                                       CER001
     C                     EXSR DALLOC                                                        CER001
     C                     RETRN                                                              CER001
     C                     ELSE                                                               CER001
      *                                                                                       CER001
      ** F12 has been pressed                                                                 CER001
      *                                                                                       CER001
     C           #RTRN     IFEQ 'USR0790'                                                     CER001
     C                     MOVE '1'       *IN12                                               CER001
     C                     MOVEL'Y'       FTNOUP                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
     C                     ENDIF                                                              CER001
      *                                                                                       CER001
     C                     EXSR SRWIND                                    058194
     C                     END                                            058194
      *                                                                   058194
      *  If warning sent with no errors allow update                      058194
      *                                                                   058194
     C           *IN89     IFEQ '0'                                       058194
     C           FTWARN    IFEQ 'Y'                                       058194
     C           FTRSND    ANDEQ*BLANKS                                   058194
     C                     MOVEL'Y'       FTRSND                          058194
     C                     MOVEL'Y'       FTNOUP  1                       058194
     C                     END                                            058194
     C                     ELSE                                           058194
     C                     MOVEL*BLANKS   FTRSND  1                       058194
     C                     END                                            058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C002
     C*
     C**  ERRORS FOUND RE-OUTPUT SCREEN
     C*
     C           *IN89     IFEQ '1'                        B002
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
     C           FTNOUP    OREQ 'Y'                                       058194
     C           *IN03     ANDEQ'0'                                       058194
     C           *IN12     ANDEQ'0'                                       058194
     C*
     C           *IN87     IFEQ '1'                        B003
     C                     SETOF                       89
     C                     END                             E003
     C*
     C**  OUTPUT DEFAULTS TO DETAIL SCREEN FT0070F3
     C*
     C           SACTD     IFEQ 'I'                        B003
     C/COPY WNCPYSRC,FT0070C007
     C*
     C* IF CHARGE CODE SET TO "C" ENTRY CURRENCY SHOULD NOW BE RESET
     C* TO BLANK
     C*
     C***********FTCC******IFEQ 'C'                        B005           S01194
     C           BTCHCY    IFEQ 'C'                        B005           S01194
     C                     MOVE *BLANKS   SECCY
     C                     END                             E005
     C*
     C*********************MOVE DAFDT1    SCVDA                           E04167
     C                     END                             E003
     C*
      *                                                                   058194
     C           SACTD     IFEQ 'D'                                       058194
     C                     MOVEL'Y'       FTNOUP                          058194
     C                     END                                            058194
      *                                                                   058194
      *                                                                   058194
      * Display message subfile                                           058194
      *                                                                   058194
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVEL'1'       *IN76                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'0'       *IN76                                               CER049
     C                     ENDIF                                                              CER049
     C                     MOVEL'1'       *IN31                           058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C064
      *                                                                                     AR804457
     C           SACTD     IFEQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     SETOF                     76                                     AR804457
     C                     ENDIF                                                            AR804457
     C           SACTD     IFEQ 'E'                                                         AR804457
     C                     SETON                     76                                     AR804457
     C                     ENDIF                                                            AR804457
     C                     WRITEFT0070F3
      *
     C**         *IN11     DOUEQ'0'                        B003           S01199
      *
     C                     READ FT0070F3                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETON                     17                   S01494
     C                     SETON                     76                                     AR804457
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     SETOF                     12                   S01494
     C/COPY WNCPYSRC,FT0070C065
     C                     WRITEFT0070F3                                  S01494
     C                     READ FT0070F3                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS  1                       058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C**                                                                  S01199
     C**         *IN11     IFEQ '1'                        B004           S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             E004           S01199
     C**                   END                             E003           S01199
      *
     C                     END                             E002
     C*
     C**  IF NO ERRORS UPDATE RECORD AND PROGRESS TO NEXT SCREEN
     C*
     C           *IN87     IFEQ '0'                        B002
     C           FTNOUP    ANDEQ*BLANKS                                  058194
     C           *IN89     IFEQ '0'                        B003
     C           *IN03     ANDEQ'0'
     C           *IN12     ANDEQ'0'
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ 10                       058194
     C                     PARM '*SAME'   FTPGRL  5                       058194
      *                                                                   058194
     C*
     C** SHOULD RETURN TO MAINTENANCE SCREEN AFTER AMEND/DELETE
     C*
     C           ACT2      IFEQ 'A'                        B004
     C           ACT2      OREQ 'D'
     C                     SETON                     12
     C                     END                             E004
      *
     C                     EXSR NXDET
     C*
     C** If insert/amend/delete - update record
     C*
     C           ACT2      IFNE 'E'                        B004
     C                     EXSR UPDAT2
     C                     END                             E004
     C/COPY WNCPYSRC,FT0070C071
      *
      * If record accessed by another workstation skip out
      *
     C           *IN67     IFEQ '1'                        B004
     C                     GOTO EXDETL
     C                     END                             E004
      *
     C           ACT2      IFEQ 'I'                        B004
     C                     EXSR CLSCRN
      *
     C           NCSQ      IFGE 50                         B005
     C                     SETON                     03
     C                     END                             E005
      *
     C                     ELSE                            X004
     C           ACT2      IFNE 'E'                                       058194
     C                     SETON                     03                   058194
     C                     ELSE                                           058194
     C                     ADD  1         CQSQ
     C                     MOVE CQSQ      SCQSQ
      *
     C           CQSQ      IFLE 50                         B005
     C                     MOVE CQSQ      CQSQK
     C***********CQCHNK    CHAINCQCOD                75                   058194
     C           CQCHNK    SETLLCQCOCDDF                                  058194
     C           CQCKEY    READECQCOCDDF                 75               058194
      *
     C           *IN75     IFEQ '0'                        B006
     C                     EXCPTRCQCOC
     C                     MOVE RECI      RECIS
     C                     EXSR STATUS
     C                     EXSR CLSCRN
     C                     EXSR DCONV
     C                     ELSE                            X006
     C***********                                                   043715058194
     C***********ACT2      IFEQ 'E'                                 043715058194
     C***********          GOTO NXCHQD                              043715058194
     C***********          END                                      043715058194
     C***********                                                   043715058194
     C                     SETON                     03
     C                     END                             E006
      *
     C                     ELSE                            X005
      *
     C           ACT2      IFEQ 'E'                        B006
     C                     MOVE '1'       *IN03
     C                     END                             E006
      *
     C                     END                             E005
     C                     END                                            058194
     C                     END                             E004
     C                     END                             E003
      *
     C           *IN03     IFEQ '0'
     C           *IN12     ANDEQ'0'
     C           *IN89     ANDEQ'0'
     C*
     C**  OUTPUT DEFAULTS TO DETAIL SCREEN FT0070F3
     C*
     C           SACTD     IFEQ 'I'                        B004
     C*
     C* IF CHARGE CODE SET TO "C" ENTRY CURRENCY SHOULD NOW BE RESET
     C* TO BLANK
     C*
     C***********FTCC******IFEQ 'C'                        B005           S01194
     C           BTCHCY    IFEQ 'C'                        B005           S01194
     C                     MOVE *BLANKS   SECCY
     C                     END                             E005
     C/COPY WNCPYSRC,FT0070C039
     C*
     C                     MOVE DFTRCT    STCTF
     C/COPY WNCPYSRC,FT0070C025
     C******************** MOVE SSMCY     SCCCY                           E21459
     C***********          MOVE SSMCY     SECCY                     E21459063918
     C*                                                                   063918
     C           BTCHCY    IFEQ 'B'                                       063918
     C                     MOVE BJCYCD    SECCY                           063918
     C                     ELSE                                           063918
     C           BTCHCY    IFEQ 'L'                                       063918
     C                     MOVE BJLCCY    SECCY                           063918
     C                     END                                            063918
     C                     END                                            063918
      *                                                                                     AR940742
     C           BTCHCY    IFEQ 'F'                                                         AR940742
     C                     MOVE FCHCCY    SECCY                                             AR940742
     C                     END                                                              AR940742
     C*
     C***EXTEND INSERT IF CONDITION TO INCLUDE CHEQUE SEQ INCREMENT       E23603
     C*                                                                   E23603
     C*********************END                             E004           E23603
     C*                                                                   E22952
     C**  To display the cheque sequence number                           E22952
      *
     C           CQSQ      ADD  1         CQSQCS  20                      E22952
     C                     MOVE CQSQCS    SCQSQ                           E22952
     C                     END                                            E23603
     C*                                                                   E22952
      *                                                                   058194
      * Initialise no update indicator, re-display, warning array         058194
      * and warning message sent                                          058194
      *                                                                   058194
     C                     MOVEL*BLANKS   FTNOUP                          058194
     C                     MOVEL*BLANKS   FTRSND                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     MOVEL*BLANKS   WRN@                            058194
     C                     EXSR RESET                                     058194
      *                                                                   058194
      * Display message subfile                                           058194
      *                                                                   058194
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     MOVEL'1'       *IN76                                               CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'0'       *IN76                                               CER049
     C                     ENDIF                                                              CER049
     C                     MOVEL'1'       *IN31                           058194
     C                     MOVEL*BLANKS   FTWARN                          058194
     C                     WRITE#MSGCTL                                   058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C066
      *                                                                                     AR804457
     C           SACTD     IFEQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'Y'                                                         AR804457
     C           SACTD     OREQ 'A'                                                         AR804457
     C           AUIN      ANDEQ'R'                                                         AR804457
     C                     SETON                     72                                     AR804457
     C                     SETOF                     76                                     AR804457
     C                     ENDIF                                                            AR804457
     C           SACTD     IFEQ 'E'                                                         AR804457
     C                     SETON                     76                                     AR804457
     C                     ENDIF                                                            AR804457
      *                                                                                     AR804457
     C                     WRITEFT0070F3
      *
     C**         *IN11     DOUEQ'0'                        B004           S01199
      *
     C                     READ FT0070F3                 75
     C*                                                                   S01494
     C** WINDOW PROCESSING FOR ADDT'L INFO IF F21 IS PRESSED FROM         S01494
     C** THE ENQUIRY SCREEN.                                              S01494
     C*                                                                   S01494
     C           *IN24     DOWEQ'1'                                       S01494
     C           SACTD     ANDEQ'E'                                       S01494
     C                     SETON                     17                   S01494
     C                     SETON                     76                                     AR804457
     C                     EXSR #LADDI                                    S01494
     C           *IN03     IFEQ '0'                                       S01494
     C                     SETOF                     12                   S01494
     C/COPY WNCPYSRC,FT0070C067
     C                     WRITEFT0070F3                                  S01494
     C                     READ FT0070F3                 75               S01494
     C                     ELSE                                           S01494
     C                     SETOF                     24                   S01494
     C                     END                                            S01494
     C                     END                                            S01494
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   058194
      *
     C**         *IN11     IFEQ '1'                        B005           S01199
     C**                   EXSR HELP                                      S01199
     C**                   END                             E005           S01199
     C**                   END                             E004           S01199
      *
     C                     END                             E003
     C*                                                                   043715
     C           NXCHQD    TAG                                            043715
      *                                                                   CAC001
      **  If no errors found, clear out Margin Info details               CAC001
      *                                                                   CAC001
     C           *IN89     IFEQ *OFF                                      CAC001
     C           ACT2      IFEQ 'I'                                       CAC001
     C                     Z-ADD0         WOFXMP                          CAC001
     C                     Z-ADD0         WOFXMD                          CAC001
     C                     MOVE *BLANKS   WOMBSI                          CAC001
     C                     MOVE *BLANKS   WOMSIG                          CAC001
     C                     Z-ADD0         WOMAMT                          CAC001
     C                     ELSE                                           CAC001
     C                     Z-ADDFXMP      WOFXMP                          CAC001
     C                     Z-ADDFXMD      WOFXMD                          CAC001
     C                     MOVE MBSI      WOMBSI                          CAC001
     C                     MOVE MSIG      WOMSIG                          CAC001
     C                     Z-ADDMAMT      WOMAMT                          CAC001
     C                     ENDIF                                          CAC001
     C                     ENDIF                                          CAC001
      *                                                                   CAC001
     C                     END                             E002
      *
     C                     SETOF                     87
      ***********                                                         058194
     C**IF*ENQUIRE, DISPLAY WINDOW DETAILS                          S01241058194
      ***********                                                         058194
     C***********SACTD     IFEQ 'E'                                 S01241058194
     C***********BGL5ST****IFEQ 'Y'                           S01241S01251058194
     C***********BGWDPR    IFEQ 'Y'                                 S01251058194
      ***********                                                         058194
      *****/copy*to move data into the data structure fields passed S01241058194
      ******as*a*parameter to the window controller                 S01241058194
      */COPY*QWINDSRC,FT0070MOV2                                          058194
      ***********                                                   S01241058194
     C***********          MOVE SACTD     #ACTN                     S01241058194
     C***********          MOVE *BLANKS   RTNCDE                    S01241058194
     C***********          MOVE *BLANKS   ##CMD                     S01241058194
     C***********          MOVEL'FT0070'  ##PGM                     S01241058194
     C***********          CALL 'WN0010'                            S01241058194
     C***********          PARM           ##PGM                     S01241058194
     C***********          PARM           ##CMD                     S01241058194
     C***********          PARM           #ACTN                     S01241058194
     C***********          PARM           DATA                      S01241058194
     C*********************PARM           RTNCDE              S01241S01252058194
     C***********          PARM *BLANKS   RTNCDE                    S01252058194
     C***********          PARM           SPARE 256                 S01252058194
     C***********          END                                      S01241058194
      ***********                                                         058194
     C***********          END                                      S01241058194
     C                     END                             E001           058194
     C/COPY WNCPYSRC,FT0070C068
     C*
     C**  IF F3 PRESSED RETURN TO HEADER
     C*
     C           *IN03     IFEQ '1'                        B001
     C                     SETOF                     89
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD0         S
     C                     EXSR RESET
     C                     MOVE '00'      SCQSQ
     C                     Z-ADD0         CQSQ
     C*********************SETON                     25                   CEU006
     C**  Need an indicator for screen processing                         CEU006
     C                     MOVE '1'       @IN25                           CEU006
     C/COPY WNCPYSRC,FT0070C003
      *
     C           ACT2      IFNE 'E'                        B002
     C                     MOVE 'A'       SACTD
     C                     SETOF                     14    EFIX
     C           AUIN      IFEQ ' '                                                         AR804457
     C                     SETOF                     72    EFIX
     C                     ELSE                            X002
     C                     SETON                     72                                     AR804457
     C                     ENDIF                                                            AR804457
     C                     ELSE                                                             AR804457
     C                     MOVE 'E'       SACTD
     C                     END                             E002
      *
     C                     END                             E001
      *
     C           EXDETL    ENDSR
     C/EJECT                                                              S01494
     C*****************************************************************   S01494
     C*                                                               *   S01494
     C*  S/R #LADDI - DISPLAY ADDITIONAL INFO FOR ENQUIRY             *   S01494
     C*                                                               *   S01494
     C*  CALLED FROM  INVAL, INIT1, DETL1                             *   S01494
     C*                                                               *   S01494
     C*****************************************************************   S01494
     C*                                                                   S01494
     C           #LADDI    BEGSR                                          S01494
     C*                                                                   S01494
     C** INITIALIZE SCREEN FIELDS                                         S01494
     C*                                                                   S01494
     C                     MOVE *BLANKS   SUSRP1                          S01494
     C                     MOVE *BLANKS   SUSER1                          S01494
     C                     MOVE *BLANKS   SAUP1                           S01494
     C                     MOVE *BLANKS   SAUT1                           S01494
     C                     MOVE *BLANKS   SAUP2                           S01494
     C                     MOVE *BLANKS   SAUT2                           S01494
     C*                                                                   S01494
     C** RETRIEVE USER PROFILE NAME OF INPUT USER 1.                      S01494
     C*                                                                   S01494
     C                     MOVELINUSR1    SUSRP1                          S01494
     C           INUSR1    IFNE *BLANKS                                   S01494
     C           INUSR1    CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SUSER1                          S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SUSER1                          S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** RETRIEVE USER PROFILE NAME OF AUTHORISING USER 1 AND 2           S01494
     C** FOR CHEQUE HEADER SCREEN.                                        S01494
     C*                                                                   S01494
     C           *IN17     IFNE '1'                                       S01494
     C*                                                                   S01494
     C                     MOVELAUP1      SAUP1                           S01494
     C           AUP1      IFNE *BLANKS                                   S01494
     C           AUP1      CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT1                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT1                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C                     MOVELAUP2      SAUP2                           S01494
     C           AUP2      IFNE *BLANKS                                   S01494
     C           AUP2      CHAINMUSER                18                   S01494
     C           *IN18     IFEQ '1'                                       S01494
     C           *IN18     OREQ '0'                                       074810
     C           MRECI     ANDNE'D'                                       074810
     C                     MOVELWM2510    SAUT2                           S01494
     C                     ELSE                                           S01494
     C                     MOVELUSER1     SAUT2                           S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C                     END                                            S01494
     C*                                                                   S01494
     C** DISPLAY WINDOW.                                                  S01494
     C*                                                                   S01494
     C                     EXFMTFT0070F4                                  S01494
     C*                                                                   S01494
     C                     ENDSR                                          S01494
     C/EJECT
     C*****************************************************************
     C* SUBROUTINE TO DEALLOCATE DATAAREA                                 048377
     C*                                                                   048377
     C           DALLOC    BEGSR                           *** DALLOC ****048377
      *                                                                   048377
      * Call CL program to de-allocate                                    048377
      *                                                                   048377
     C                     MOVE *BLANKS   @RTCDE                          048377
     C                     MOVE 'FT'      @MODLE                          048377
     C                     MOVE *BLANKS   @TREF                           048377
     C                     MOVE *BLANKS   @RTINF                          048377
     C                     CALL 'AOC8000'                                 048377
     C                     PARM           @RTCDE                          048377
     C                     PARM           @MODLE                          048377
     C                     PARM           @TREF                           048377
     C                     PARM           @RTINF                          048377
      *                                                                   048377
     C                     ENDSR                                          048377
     C/EJECT                                                              048377
     C*****************************************************************
     C*                                                                   S01508
     C** DEFAULT CHARGE CALCULATION SUBROUTINE                            S01508
     C**   (CALLED DURING INSERT OR AMEND)                                S01508
     C*                                                                   S01508
     C           DFTCHG    BEGSR                                          S01508
     C*                                                                   S01508
     C**  Set up subroutine stack name                                    S01508
     C*                                                                   S01508
     C                     ADD  1         Q                               S01508
     C                     MOVEL'DFTCHG'  @STK,Q                          S01508
     C*                                                                   S01508
     C**  Customer Number                                                 S01508
     C*                                                                   S01508
     C**  If core feature S01508 is installed, set up parameters for      S01508
     C**  FT0035 to get the customer number for FT0320                    S01508
     C*                                                                   S01508
     C           S01508    IFNE 'Y'                                       S01508
     C                     MOVE *BLANKS   W7CUST                          S01508
     C*                                                                   S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C**  Initialise work fields                                          S01508
     C*                                                                   S01508
     C                     MOVE *BLANKS   I#PT1                           S01508
     C                     MOVE *BLANKS   I#PTY1                          S01508
     C                     MOVE *BLANKS   I#PT2                           S01508
     C                     MOVE *BLANKS   I#PTY2                          S01508
     C                     MOVE *BLANKS   I#CCY                           S01508
     C                     MOVE *BLANKS   W0SCUS  6                       S01508
     C                     MOVE *BLANKS   W0FCUS  6                       S01508
     C*                                                                   S01508
     C**  If "charges to the debit of" is entered                         S01508
     C*                                                                   S01508
     C           SCHDB     IFNE *BLANKS                                   S01508
     C*                                                                   S01508
     C**  Check customer no. of "charges to the debit of"                 S01508
     C**  (screen field value)                                            S01508
     C*                                                                   S01508
     C           CDRT      IFNE *BLANK                                    S01508
     C                     MOVE CDRT      I#PT1                           S01508
     C**********           MOVELCDRO      W0FLD  12                                    S01508 CGL029
     C                     MOVELCDRO      W0FLD  18                                           CGL029
     C           W0FLD     CAT  CDBR      I#PTY1    P                     S01508
     C                     MOVE BJCYCD    I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN   7                       S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG 256                       S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ***************S01508
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 34 *S01508
     C                     Z-ADD34        W0ERNB           ***************S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0SCUS                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C*                                                                   S01508
     C**  Check customer no. of "charges to the debit of"                 S01508
     C**    (file field value)                                            S01508
     C*                                                                   S01508
     C           OCDRT     IFNE *BLANK                                    S01508
     C                     MOVE OCDRT     I#PT1                           S01508
     C                     MOVELOCDRO     W0FLD                           S01508
     C           W0FLD     CAT  OCHBR     I#PTY1    P                     S01508
     C                     MOVE BJCYCD    I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN                           S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG                           S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ***************S01508
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 35 *S01508
     C                     Z-ADD35        W0ERNB           ***************S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0FCUS                          S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     ELSE                                           S01508
     C*                                                                   S01508
     C*                                                                   S01508
     C**  Check customer no. of the "credit party"                        S01508
     C**    (screen field value)                                          S01508
     C*                                                                   S01508
     C           CRPT      IFNE *BLANK                                    S01508
     C                     MOVE CRPT      I#PT1                           S01508
     C                     MOVELCRPY      W0FLD                           S01508
     C           W0FLD     CAT  CRBR      I#PTY1    P                     S01508
     C                     MOVE CRCY      I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN                           S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG                           S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ***************S01508
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 36 *S01508
     C                     Z-ADD36        W0ERNB           ***************S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0SCUS                          S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C*                                                                   S01508
     C**  Check customer no. of the "credit party"                        S01508
     C**    (file field value)                                            S01508
     C*                                                                   S01508
     C           OCRPT     IFNE *BLANK                                    S01508
     C                     MOVE OCRPT     I#PT1                           S01508
     C                     MOVELOCRPY     W0FLD                           S01508
     C           W0FLD     CAT  OCRBR     I#PTY1    P                     S01508
     C                     MOVE OCRCY     I#CCY                           S01508
     C*                                                                   S01508
     C                     CALL 'FT0035'               9090               S01508
     C                     PARM *BLANKS   W0RTN                           S01508
     C                     PARM           W0DTA                           S01508
     C                     PARM           W0MSG                           S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W0RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0035  'W0FILE           ***************S01508
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 37 *S01508
     C                     Z-ADD37        W0ERNB           ***************S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE O#CUST    W0FCUS                          S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     END                                            S01508
     C*                                                                   S01508
     C                     MOVE W0SCUS    W7CUST                          S01508
     C*                                                                   S01508
     C                     END                                            S01508
      *                                                                   S01508
      ** Payment type and subtype                                         S01508
     C                     MOVELPYTP      W7PYTP                          S01508
     C                     MOVELPYST      W7PYST                          S01508
      *                                                                   S01508
      ** Input currency and charge currency                               S01508
     C                     MOVELSECCY     W7ICCY                          S01508
     C*                                                                   S01508
     C           SCHDB     IFNE *BLANKS                                   S01508
     C                     MOVE BJCYCD    W7CCCY                          S01508
     C                     ELSE                                           S01508
     C                     MOVE CRCY      W7CCCY                          S01508
     C                     END                                            S01508
      *                                                                   S01508
      ** Settlement method                                                S01508
     C                     MOVEL'00'      W7STMT                          S01508
      *                                                                   S01508
      ** Defaults required                                                S01508
     C                     MOVEL'Y'       W7DFRQ                          S01508
      *                                                                   S01508
      ** Charges branch                                                   S01508
     C                     MOVELORBR      W7BRCA                          S01508
      *                                                                   S01508
      ** Charge currency amount                                           S01508
     C                     Z-ADDCCYAM     W7CAMT                          S01508
     C                     MOVELCRCY      W7PCCY                          S01508
      *                                                                   S01508
      ** Transfer Commission type                                         S01508
     C                     MOVELTRCT      W7TRCT                          S01508
      *                                                                   S01508
      ** SWIFT priority code                                              S01508
     C                     MOVEL'N'       W7SWPC                          S01508
      *                                                                   S01508
      ** Transfer Commission amount                                       S01508
     C                     Z-ADDDUMA1     W7TRCD                          S01508
     C                     Z-ADDTRCM      W7TRCH                          S01508
      *                                                                   S01508
      ** Collection Charge                                                S01508
     C                     Z-ADDDUMA2     W7COLD                          S01508
     C                     Z-ADDCOLL      W7COLL                          S01508
      *                                                                   S01508
      ** Costs Abroad                                                     S01508
     C                     Z-ADDDUMA3     W7CSTD                          S01508
     C                     Z-ADDCSTA      W7CSTA                          S01508
      *                                                                   S01508
      ** Telex charge                                                     S01508
     C                     Z-ADDDUMA4     W7TXCD                          S01508
     C                     Z-ADDTXCH      W7TXCH                          S01508
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           *IN09     IFEQ '1'                                       S01494
     C                     Z-ADDCCDUM5    W7CHCD                          S01494
     C                     Z-ADDCCCHCM    W7CHCM                          S01494
     C                     END                                            S01494
      *                                                                   S01508
      ** Cheque Charge                                                    S01508
     C                     Z-ADD0         W7CQCD                          S01508
     C                     Z-ADD0         W7CQCH                          S01508
      *                                                                   S01508
      ** SWIFT Priority Charge                                            S01508
     C                     Z-ADD0         W7SPCD                          S01508
     C                     Z-ADD0         W7SPCH                          S01508
      *                                                                   S01508
      ** Miscellaneous charge                                             S01508
     C                     Z-ADD0         W7MSCD                          S01508
     C                     Z-ADD0         W7MSCH                          S01508
      *                                                                   S01508
      ** Advice Charge                                                    S01508
     C                     Z-ADD0         W7ADCD                          S01508
     C                     Z-ADD0         W7ADCH                          S01508
      *                                                                   S01508
      ** Telephone Charge                                                 S01508
     C                     Z-ADD0         W7TLCD                          S01508
     C                     Z-ADD0         W7TLCH                          S01508
      *                                                                   S01508
     C                     MOVEL*BLANKS   W7ACT                           S01508
     C                     MOVEL'CC'      W7ACT                           S01508
     C*                                                                   S01508
     C**  Other currency                                                  S01508
     C                     MOVE SMCY      W7OCCY                          S01508
     C*                                                                   S01508
     C**  Default type                                                    S01508
     C                     MOVE 'DET'     W7DFTT                          S01508
      *                                                                   CEU006
      ** Settle Value Date                                                CEU006
      *                                                                   CEU006
     C                     Z-ADD0         W7SLDT                          CEU006
      *                                                                   CEU006
      ** Credit Value Date                                                CEU006
      *                                                                   CEU006
     C           @1INCY    IFEQ 'Y'                                       142243
     C           SLDT      ANDLT@1TPSD                                    142243
     C           @2INCY    ANDEQ'Y'                                       142243
     C           CRVD      ANDGE@2TPSD                                    142243
     C                     Z-ADDSLDT      W7PVDT                          142243
     C                     ELSE                                           142243
     C                     Z-ADDCRVD      W7PVDT                          CEU006
     C                     ENDIF                                          142243
      *                                                                   CEU006
      ** Add/Deduct Charges                                               CEU006
      *                                                                   CEU006
     C                     MOVE *BLANKS   W7ADDC                          CEU006
     C/COPY WNCPYSRC,FT0070C056
      *                                                                   S01508
      *  Call defaults program                                            S01508
      *                                                                   S01508
     C                     CALL 'FT0320'               9090               S01508
     C                     PARM *BLANKS   W7RTN   7                       S01508
     C                     PARM           W7ACT   8                       S01508
     C                     PARM           W7DATA                          S01508
      *                                                                   S01508
     C           *IN90     IFEQ '1'                                       S01508
     C           W7RTN     ORNE *BLANKS                                   S01508
     C                     MOVEL'FT0320  'W0FILE           ***************S01508
     C                     MOVEL'*CALL   'W0KEY            * DB ERROR 38 *S01508
     C                     Z-ADD38        W0ERNB           ***************S01508
     C                     EXSR SRERR                                     S01508
     C                     END                                            S01508
      *                                                                   S01508
      * Transfer Commission amount                                        S01508
     C                     Z-ADDW7TRCD    DUMA1                           S01508
     C                     Z-ADDW7TRCH    TRCM                            S01508
      *                                                                   S01508
      * Collection Charge                                                 S01508
     C                     Z-ADDW7COLD    DUMA2                           S01508
     C                     Z-ADDW7COLL    COLL                            S01508
      *                                                                   S01508
      * Costs Abroad                                                      S01508
     C                     Z-ADDW7CSTD    DUMA3                           S01508
     C                     Z-ADDW7CSTA    CSTA                            S01508
      *                                                                   S01508
      * Telex charge                                                      S01508
     C                     Z-ADDW7TXCD    DUMA4                           S01508
     C                     Z-ADDW7TXCH    TXCH                            S01508
     C*                                                                   S01494
     C** FX/Change Commission                                             S01494
     C*                                                                   S01494
     C           *IN09     IFEQ '1'                                       S01494
     C                     Z-ADDW7CHCD    CCDUM5                          S01494
     C                     Z-ADDW7CHCM    CCCHCM                          S01494
     C                     END                                            S01494
     C*If FX/change commission has been blanked-out by user do not        142243
     C*default value again.                                               142243
     C           CEU006    IFEQ 'Y'                                       142243
     C           SCCCY     IFNE W#SVCY                                    142243
     C                     Z-ADD0         W#FCYC                          142243
     C                     ENDIF                                          142243
     C           SCHCME    IFEQ *BLANKS                                   142243
     C           W#FCYC    ANDGE1                                         142243
     C           SCCCY     ANDEQW#SVCY                                    142243
     C                     Z-ADD0         CCDUM5                          142243
     C                     Z-ADD0         CCCHCM                          142243
     C                     ENDIF                                          142243
     C*Flag field to indicate that FX/change commission has been defaulted142243
     C                     ADD  1         W#FCYC  20                      142243
     C                     MOVE SCCCY     W#SVCY  3                       142243
     C                     ENDIF                                          142243
     C*                                                                   S01499
     C** Set recalculation flag                                           S01499
     C*                                                                   S01499
     C                     MOVE 'Y'       W0RCAL  1                       S01499
     C*                                                                   S01508
     C**  Unwind subroutine stack name                                    S01508
     C*                                                                   S01508
     C           EXCDFT    TAG                                            S01508
     C                     MOVEA*BLANKS   @STK,Q                          S01508
     C                     SUB  1         Q       50                      S01508
     C*                                                                   S01499
     C                     ENDSR                                          S01508
     C*****************************************************************
     C*****************************************************************   048377
     C** DEFAULT CHARGE CALCULATION SUBROUTINE(CALLED ONLY FOR INSERT)    S01508
     C***********                                                         S01508
     C***********DFTCHG    BEGSR                                          S01508
     C***********                                                         S01508
     C**ONLY*ABLE*TO*CALCULATE*IF*NO*ERROR*PREVIOUSLY******************   S01508
     C***********                                                         S01508
     C************IN52     IFNE '1'                        ** B001        S01508
     C************IN54     ANDNE'1'                                       S01508
     C***********                                                         S01508
     C***ORIG*BRANCH*MUST*BE*VALID*IN*ORDER*TO*GET*PAYMENT*CHARGES*REC*   S01117
     C************IN38     ANDNE'1'                                 S01117S01508
     C***********          EXSR PYCHG                               S01117S01508
     C***********                                                         S01508
     C*********************MOVELCRCY      SCCY    4                       S01194
     C*********************MOVELCRCY      SCCY    3                 S01194E25274
     C***********                                                   E25274S01508
     C***********SCHDB     IFNE *BLANKS                             E25274S01508
     C***********          MOVELBJCYCD    SFCCY                     E25274S01508
     C***********          ELSE                                     E25274S01508
     C***********          MOVELCRCY      SFCCY                           S01508
     C***********          END                                      E25274S01508
     C***********                                                         S01508
     C**READ*TABLE*FILE*FOR*CURRENCY*DETAILS************************S01194S01508
     C**ACCESS*SDCURRPD*FOR*CURRENCY*DETAILS************************S01194S01508
     C***********          MOVE CRCY      CCYD                            S01508
     C***********          EXSR CUDP                                      S01508
     C***********          Z-ADDDP        CCDP    10                      S01508
     C***********          Z-ADDMDIN      CMDIN   10                      S01508
     C***********          Z-ADDA6SPRT    CSPOT  138                S01194S01508
     C*********************Z-ADDSPOT      CSPOT  138                S01194S01508
     C***********                                                         S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*1*OR*2***************************   S01508
     C***********STCTF     IFEQ '1'                        ** B002        S01508
     C***********STCTF     OREQ '2'                                       S01508
     C***********          Z-ADD0         TRCM                            S01508
     C***CHARGE*INPUT*ERROR*****************************************E23056S01508
     C***********          Z-ADD0         SDUMA1                    E23056S01508
     C***********                                                         S01508
     C***********          ELSE                            ** X002        S01508
     C***********                                                         S01508
     C**IF*CHARGE*CURRENCY*IS*NOT*BASE*********************************   S01508
     C***********                                                         S01508
     C***********SFCCY*****IFNE BCCY                       ** B003  S01194S01508
     C***********SFCCY*****IFNE BJCYCD                     ** B003  S01194E37065
     C***********CRCY      IFNE BJCYCD                     ** B003  E37065S01508
     C***********                                                         S01508
     C****CONVERT*CURRENCY*AMOUNT*TO*BASE*CURRENCY*********************   S01508
     C***********BCDP      SUB  CCDP      N       10                      S01508
     C***********                                                         S01508
     C**IF*MULTIPLY*CCY*TO*GET*BASE************************************   S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 1                          ** B004        S01508
     C***********N         IFGT 0                          ** B005        S01508
     C***********CSPOT     MULT POWERS,N  ISPOT  159                      S01508
     C***********          ELSE                            ** X005        S01508
     C***********N         IFLT 0                          ** B006        S01508
     C***********          Z-SUBN         N                               S01508
     C***********CSPOT     DIV  POWERS,N  ISPOT                           S01508
     C***********          ELSE                            ** X006        S01508
     C***********          Z-ADDCSPOT     ISPOT                           S01508
     C***********          END                             ** E006        S01508
     C***********          END                             ** E005        S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C**IF*DIVIDE*CCY*TO*GET*BASE**************************************   S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 0                          ** B004        S01508
     C***********N         IFGT 0                          ** B005        S01508
     C***********CSPOT     DIV  POWERS,N  ISPOT  159                      S01508
     C***********          ELSE                            ** X005        S01508
     C***********N         IFLT 0                          ** B006        S01508
     C***********          Z-SUBN         N                               S01508
     C***********CSPOT     MULT POWERS,N  ISPOT                           S01508
     C***********          ELSE                            ** X006        S01508
     C***********          Z-ADDCSPOT     ISPOT                           S01508
     C***********          END                             ** E006        S01508
     C***********          END                             ** E005        S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C***********                                                         S01508
     C**NOW*USE*RATE*TO*CALCULATE*VALUE*IN*BASE************************   S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 1                          ** B004        S01508
     C***********AMOUNT    MULT ISPOT     BASAMT 150H                     S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 0                          ** B004        S01508
     C***********AMOUNT    DIV  ISPOT     BASAMT    H                     S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C***********          ELSE                            ** X003        S01508
     C***********                                                         S01508
     C**IF*CURRENCY*IS*BASE,TRANSFER*TO*CALCULATION*FIELD**************   S01508
     C***********                                                         S01508
     C***********          Z-ADDAMOUNT    BASAMT                          S01508
     C***********                                                         S01508
     C***********          END                             ** E003        S01508
     C***********                                                         S01508
     C**ZEROISE*RATE*FOR*TARIFF(USED*IF*WITHIN*RANGE,+*NOT*MAX*OR*MIN)*   S01508
     C***********                                                         S01508
     C***********          Z-ADD*ZEROS    TRATE                           S01508
     C***********          Z-ADD*ZEROS    AMNTB  110                      S01508
     C***********                                                         S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*3********************************   S01508
     C***********STCTF     CASEQ'3'       TRF3                            S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*4********************************   S01508
     C***********STCTF     CASEQ'4'       TRF4                            S01508
     C**TRANSFER*COMMISSION*TARIFF*IS*5********************************   S01508
     C***********STCTF     CASEQ'5'       TRF5                            S01508
     C***********          END                                            S01508
     C***********                                                         S01508
     C**IF*AMTB*HELD,USE*SUBROUTINE*TO*CALCULATE*DISPLAY*COMMISSION****   S01508
     C**DEFAULT*VALUES*************************************************   S01508
     C***********                                                         S01508
     C***********AMNTB     IFNE *ZEROS                     B003           S01508
     C***********                                                   E37065S01508
     C**OR*IF*CHARGES*TO*THE*DEBIT*OF*IS*NOT*BLANK,USE*SAME*SUBROUTIE37065S01508
     C***********                                                   E37065S01508
     C***********SCHDB     ORNE *BLANKS                             E37065S01508
     C**IF*BASE,USE*VALUE*CALCULATED*ALREADY*IN*DFTCHG*SUBROUTINE***E37065S01508
     C***********SCHDB     IFNE *BLANK                     B004     E37065S01508
     C***********AMNTB     IFEQ 0                          B005     E37065S01508
     C***********          Z-ADDTRCMB     AMNTB                     E37065S01508
     C***********          Z-ADDTRCMB     AMNT                      E37065S01508
     C***********          ELSE                                     E37065S01508
     C***********          Z-ADDAMNTB     AMNT                      E37065S01508
     C***********          END                             E005     E37065S01508
     C***********          END                             E004     E37065S01508
     C***********                                                   E37065S01508
     C***********          EXSR CHGRT                                     S01508
     C***********          Z-ADDDUMA      SDUMA1                          S01508
     C***********          Z-ADDAMNT      TRCM                            S01508
     C***********          MOVE AMNTD     STRCMF                          S01508
     C***********          MOVE AMNTD2    STRCME                          S01508
     C***********                                                         S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C**IF*TARIFF*RATE*HELD,CAN*USE*FILE*CCY*DIRECT*TO*CALCULATE*CHARGE   S01508
     C***********                                                         S01508
     C***********TRATE     IFNE *ZEROS                     B004           S01508
     C***********AMOUNT    MULT TRATE     TRCM      H                     S01508
     C***********                                                         S01508
     C**CONVERSION*FOR*DISPLAY*****************************************   S01508
     C***********                                                         S01508
     C*********************Z-ADDCDP       ZDECS                     S01194S01508
     C***********          Z-ADDA6NBDP    ZDECS                     S01194S01508
     C***********          MOVE ' '       ZECODE                          S01508
     C***********          Z-ADDTRCM      ZFLD15                          S01508
     C***********          EXSR ZSEDIT                                    S01508
     C***********          MOVE ZOUT21    STRCMF                          S01508
     C***********                                                         S01508
     C**NOW*CALCULATE*LEFT*HAND*SIDE*OF*DISPLAY************************   S01508
     C***********                                                         S01508
     C***********          MOVE STRCMF    AMNTD                           S01508
     C***********          Z-ADDTRCMB     AMNTB                           S01508
     C***********          Z-ADDTRCM      AMNT                            S01508
     C***********          EXSR CHGLT                                     S01508
     C***********          Z-ADDDUMA      SDUMA1                          S01508
     C***********          MOVE AMNTD2    STRCME                          S01508
     C***********                                                         S01508
     C***********          ELSE                            X004           S01508
     C***********                                                         S01508
     C**IF*BOTH*ZERO,THEN*NO*DEFAULT*CHARGE,SO*SET*SCREEN*CURRENCY*****   S01508
     C**VALUE*HERE*****************************************************   S01508
     C***********                                                         S01508
     C***SET*DEFAULT*CHARGE*TO*0************************************E23056S01508
     C***********          Z-ADD0         TRCM                      E23056S01508
     C***********          Z-ADD0         SDUMA1                    E23056S01508
     C***********          MOVE *BLANKS   STRCME                    E23056S01508
     C***********          MOVE *BLANKS   STRCMF                    E23056S01508
     C***********                                                   E23056S01508
     C***********FTCC******IFEQ 'C'                        B005     S01194S01508
     C*********************MOVE SCCCY     SECCY                     S01194S01508
     C*********************ELSE                            X005     S01194S01508
     C***********FTCC******IFEQ 'B'                        B006     S01194S01508
     C*********************MOVE BCCY      SECCY                     S01194S01508
     C*********************ELSE                            X006     S01194S01508
     C*********************MOVE LOCY      SECCY                     S01194S01508
     C*********************END                             E006     S01194S01508
     C***********                                                   S01194S01508
     C***********BTCHCY    IFEQ 'C'                        B005     S01194S01508
     C***********          MOVE SCCCY     SECCY                     S01194S01508
     C***********          ELSE                            X005     S01194S01508
     C***********                                                   S01194S01508
     C***********BTCHCY    IFEQ 'B'                        B006     S01194S01508
     C***********          MOVE BJCYCD    SECCY                     S01194S01508
     C***********          ELSE                            X006     S01194S01508
     C***********          MOVE BJLCCY    SECCY                     S01194S01508
     C***********          END                             E006     S01194S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          END                             E002           S01508
     C***********          END                             E001           S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         S01508
     C***TARIFF*CALCULATION*SUBROUTINE*FOR*DEFAULT*RATE*3*************    S01508
     C***********                                                         S01508
     C***********TRF3      BEGSR                                          S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IS*LESS*THAN*START*OF*RANGE*1***********************    S01508
     C***********BASAMT    IFLT RNS1                       B001           S01508
     C***********          Z-ADD0         TRCM                            S01508
     C***********          Z-ADD0         TRCMB                           S01508
     C***********          ELSE                            X001           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*1******************************************    S01508
     C***********BASAMT    IFLE RNE1                       B002           S01508
     C***********BASAMT    MULT RNR1      TRCMB  110                      S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT RNMN                       B003           S01508
     C***********          Z-ADDRNMN      AMNTB                           S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********RNMX      IFNE *ZEROS                     B004           S01508
     C***********TRCMB     ANDGTRNMX                                      S01508
     C***********          Z-ADDRNMX      AMNTB                           S01508
     C***********          ELSE                            X004           S01508
     C***********          MOVE RNR1      TRATE  138                      S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          ELSE                            X002           S01508
     C***********                                                         S01508
     C**IF*RANGE*2*IS*NOT*ENTERED,SET*COMM*TO*MAX*RANGE*1*IF*ENTERED**    S01508
     C***********RNS2      IFEQ *ZEROS                     B003           S01508
     C***********RNMX      ANDNE*ZEROS                                    S01508
     C***********          Z-ADDRNMX      AMNTB                           S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*2******************************************    S01508
     C***********BASAMT    IFGE RNS2                       B004           S01508
     C***********BASAMT    ANDLERNE2                                      S01508
     C***********BASAMT    MULT RNR2      TRCMB                           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT RNMN2                      B005           S01508
     C***********          Z-ADDRNMN2     AMNTB                           S01508
     C***********          ELSE                            X005           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********RNMX2     IFNE *ZEROS                     B006           S01508
     C***********TRCMB     ANDGTRNMX2                                     S01508
     C***********          Z-ADDRNMX2     AMNTB                           S01508
     C***********          ELSE                            X006           S01508
     C***********          MOVE RNR2      TRATE                           S01508
     C***********          END                             E006           S01508
     C***********          END                             E005           S01508
     C***********          ELSE                            X004           S01508
     C***********                                                         S01508
     C**IF*RANGE*3*IS*NOT*ENTERED,SET*COMM*TO*MAX*RANGE*2*IF*ENTERED**    S01508
     C***********RNS3      IFEQ *ZEROS                     B005           S01508
     C***********RNMX2     ANDNE*ZEROS                                    S01508
     C***********          Z-ADDRNMX2     AMNTB                           S01508
     C***********          ELSE                            X005           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*3******************************************    S01508
     C***********BASAMT    IFGE RNS3                       B006           S01508
     C***********BASAMT    ANDLERNE3                                      S01508
     C***********BASAMT    MULT RNR3      TRCMB                           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT RNMN3                      B007           S01508
     C***********          Z-ADDRNMN3     AMNTB                           S01508
     C***********          ELSE                            X007           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********RNMX3     IFNE *ZEROS                     B008           S01508
     C***********TRCMB     ANDGTRNMX3                                     S01508
     C***********          Z-ADDRNMX3     AMNTB                           S01508
     C***********          ELSE                            X008           S01508
     C***********          MOVE RNR3      TRATE                           S01508
     C***********          END                             E008           S01508
     C***********          END                             E007           S01508
     C***********          ELSE                            X006           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*NOT*IN*RANGES***************************************    S01508
     C***********BASAMT    IFGT RNE3                       B007           S01508
     C***********          Z-ADDRNMX3     AMNTB                           S01508
     C***********          END                             E007           S01508
     C***********          END                             E006           S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          END                             E002           S01508
     C***********          END                             E001           S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         S01508
     C***TARIFF*CALCULATION*SUBROUTINE*FOR*TARIFF*RATE*4**************    S01508
     C***********                                                         S01508
     C***********TRF4******BEGSR**************************************    S01508
     C***********                                                         S01508
     C***********BASAMT    IFLT RRS1                       B001           S01508
     C***********          Z-ADD0         TRCMB                           S01508
     C***********          ELSE                            X001           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*1******************************************    S01508
     C***********BASAMT    IFLE RRE1                       B002           S01508
     C***********BASAMT    MULT RRR1      TRCMB                           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT RRMN                       B003           S01508
     C***********          Z-ADDRRMN      AMNTB                           S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********RRMX      IFNE *ZEROS                     B004           S01508
     C***********TRCMB     ANDGTRRMX                                      S01508
     C***********          Z-ADDRRMX      AMNTB                           S01508
     C***********          ELSE                            X004           S01508
     C***********          MOVE RRR1      TRATE                           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          ELSE                            X002           S01508
     C***********                                                         S01508
     C**IF*RANGE*2*IS*NOT*ENTERED,SET*COMM*TO*MAX*RANGE*1*IF*ENTERED**    S01508
     C***********RRS2      IFEQ *ZEROS                     B003           S01508
     C***********RRMX      ANDNE*ZEROS                                    S01508
     C***********          Z-ADDRRMX      AMNTB                           S01508
     C***********          END                             E003           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IN*RANGE*2******************************************    S01508
     C***********BASAMT    IFGE RRS2                       B003           S01508
     C***********BASAMT    ANDLERRE2                                      S01508
     C***********BASAMT    MULT RRR2      TRCMB                           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT RRMN2                      B004           S01508
     C***********          Z-ADDRRMN2     AMNTB                           S01508
     C***********          ELSE                            X004           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********RRMX2     IFNE *ZEROS                     B005           S01508
     C***********TRCMB     ANDGTRRMX2                                     S01508
     C***********          Z-ADDRRMX2     AMNTB                           S01508
     C***********          ELSE                            X005           S01508
     C***********          MOVE RRR2      TRATE                           S01508
     C***********          END                             E005           S01508
     C***********          END                             E004           S01508
     C***********          ELSE                            X003           S01508
     C***********                                                         S01508
     C**IF*AMOUNT*IS*ABOVE*HIGHEST*RANGE******************************    S01508
     C***********BASAMT    IFGT RRE2                       B004           S01508
     C***********          Z-ADDRRMX2     AMNTB                           S01508
     C***********          END                             E004           S01508
     C***********          END                             E003           S01508
     C***********          END                             E002           S01508
     C***********          END                             E001           S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         S01508
     C***TARIFF*CALCULATION*SUBROUTINE*FOR*TARIFF*RATE*5**************    S01508
     C***********                                                         S01508
     C***********TRF5      BEGSR                                          S01508
     C***********                                                         S01508
     C***********BASAMT    MULT NNRT      TRCMB                           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*LESS*THAN*MINIMUM***************************    S01508
     C***********TRCMB     IFLT NNMN                       B001           S01508
     C***********          Z-ADDNNMN      AMNTB                           S01508
     C***********          ELSE                            X001           S01508
     C***********                                                         S01508
     C***IF*COMMISSION*IS*MORE*THAN*MAXIMUM***************************    S01508
     C***********NNMX      IFNE *ZEROS                     B002           S01508
     C***********TRCMB     ANDGTNNMX                                      S01508
     C***********          Z-ADDNNMX      AMNTB                           S01508
     C***********          ELSE                            X002           S01508
     C***********          MOVE NNRT      TRATE                           S01508
     C***********          END                             E002           S01508
     C***********          END                             E001           S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C********************************************************************
     C/EJECT
     C********************************************************************
     C***********                                                         S01508
     C***CONVERT*BASE*TO*SCREEN*VALUES*FOR*RIGHT*HAND*SIDE*************   S01508
     C***********                                                         S01508
     C***********CHGRT     BEGSR                                          S01508
     C***********                                                         S01508
     C**ONLY*CONVERT*IF*CHARGE*IS*NOT*BASE*****************************   S01508
     C***********                                                         S01508
     C***********SCCY******IFNE BCCY                       ** B001 S01194 S01508
     C***********SCCY******IFNE BJCYCD                     ** B001 S01194 S01508
     C***********SFCCY     IFNE BJCYCD                     ** B001 E25274 S01508
     C***********                                                         S01508
     C****CONVERT*BASE*AMOUNT*TO*FILE*CURRENCY(FOR*RIGHT*SIDE*DISPLAY)*   S01508
     C***********CCDP      SUB  BCDP      N       10                      S01508
     C***********CMDIN     IFEQ 1                          ** B002        S01508
     C***********N         IFGT 0                          ** B003        S01508
     C***********CSPOT     DIV  POWERS,N  ISPOT  159                      S01508
     C***********          ELSE                            ** X003        S01508
     C***********N         IFLT 0                          ** B004        S01508
     C***********          Z-SUBN         N                               S01508
     C***********CSPOT     MULT POWERS,N  ISPOT                           S01508
     C***********          ELSE                                           S01508
     C***********          Z-ADDCSPOT     ISPOT                           S01508
     C***********          END                             ** E004        S01508
     C***********          END                             ** E003        S01508
     C***********          END                             ** E002        S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 0                          ** B002        S01508
     C***********N         IFGT 0                          ** B003        S01508
     C***********CSPOT     MULT POWERS,N  ISPOT  159                      S01508
     C***********          ELSE                            ** X003        S01508
     C***********N         IFLT 0                          ** B004        S01508
     C***********          Z-SUBN         N                               S01508
     C***********CSPOT     DIV  POWERS,N  ISPOT                           S01508
     C***********          ELSE                                           S01508
     C***********          Z-ADDCSPOT     ISPOT                           S01508
     C***********          END                             ** E004        S01508
     C***********          END                             ** E003        S01508
     C***********          END                             ** E002        S01508
     C***********                                                         S01508
     C**NOW*USE*RATE*TO*CALCULATE*VALUE*IN*FILE************************   S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 1                          ** B002        S01508
     C***********AMNTB     DIV  ISPOT     AMNT   110H                     S01508
     C***********          END                             ** E002        S01508
     C***********                                                         S01508
     C***********CMDIN     IFEQ 0                          ** B002        S01508
     C***********AMNTB     MULT ISPOT     AMNT      H                     S01508
     C***********          END                             ** E002        S01508
     C***********                                                  E37065 S01508
     C***********          Z-ADDCCDP      ZDECS                    E37065 S01508
     C***********                                                         S01508
     C***********          ELSE                            ** X001        S01508
     C***********                                                         S01508
     C**IF*FILE*CURRENCY*IS*BASE,MOVE*AMOUNT*ACROSS*BEFORE*CONVERSION**   S01508
     C**FOR*DISPLAY****************************************************   S01508
     C***********                                                         S01508
     C***********          Z-ADDBCDP      ZDECS                    E37065 S01508
     C***********          MOVE AMNTB     AMNT                            S01508
     C***********                                                         S01508
     C***********          END                             ** E001        S01508
     C***********                                                         S01508
     C**CURRENCY*                                                         S01508
     C***********                                                         S01508
     C*********************MOVELSCCY      SFCCY                    E25274 S01508
     C**CONVERSION*FOR*DISPLAY*****************************************   S01508
     C***********                                                         S01508
     C***********          Z-ADDAMNT      ZFLD15                          S01508
     C*********************Z-ADDCCDP      ZDECS                    E37065 S01508
     C***********          MOVE ' '       ZECODE                          S01508
     C***********          EXSR ZSEDIT                                    S01508
     C***********          MOVE ZOUT21    AMNTD  12                       S01508
     C***********                                                         S01508
     C***CALCULATE*DEFAULT*FOR*LEFT*SIDE*******************************   S01508
     C***********                                                         S01508
     C***********          EXSR CHGLT                                     S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C***********                                                         S01508
     C***********                                                         S01508
     C********************************************************************S01508
     C/EJECT
     C********************************************************************
     C***********                                                         S01508
     C***CONVERT*BASE*TO*SCREEN*VALUES*FOR*LEFT*HAND*SIDE**************   S01508
     C***********                                                         S01508
     C***********CHGLT     BEGSR                                          S01508
     C***********                                                         S01508
     C**IF*FTCC*IS*SET*TO*'C'*FOR*CHARGE*CURRENCY**********************   S01194
     C*********************                                               S01194
     C***********FTCC******IFEQ 'C'                        ** B001        S01194
     C*********************                                               S01194
     C**OR,IF*FTCC*IS*SET*TO*'B'*FOR*BASE*CURRENCY,AND*DEFAULT*********   S01194
     C**CHARGE*CCY*IS*BASE*********************************************   S01194
     C*********************                                               S01194
     C***********FTCC******OREQ 'B'                                       S01194
     C***********SFCCY*****ANDEQBCCY                                      S01194
     C*********************                                               S01194
     C**OR,IF*FTCC*IS*SET*TO*'L'*FOR*LOCAL*CURRENCY,AND*LOCAL*IS*THE***   S01194
     C**SAME*CCY*AS*BASE,AND*DEFAULT*CCY*IS*BASE***********************   S01194
     C*********************                                               S01194
     C***********FTCC******OREQ 'L'                                       S01194
     C***********BCCY******ANDEQLOCY                                      S01194
     C***********SFCCY*****ANDEQBCCY                                      S01194
     C*********************                                               S01194
     C**OR,IF*FTCC*IS*SET*TO*'L'*FOR*LOCAL*CURRENCY,AND*DEFAULT*CHARGE*   S01194
     C**CURRENCY*IS*THE*SAME*AS*LOCAL*CCY******************************   S01194
     C*********************                                               S01194
     C***********FTCC******OREQ 'L'                                       S01194
     C***********SFCCY*****ANDEQLOCY                                      S01194
     C***********                                                         S01194
     C***********                                                         S01194
     C***********                                                         S01194
     C**IF*BTCHCY*IS*SET*TO*'C'*FOR*CHARGE*CURRENCY****************S01194 S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    IFEQ 'C'                        ** B001 S01194 S01508
     C***********                                                  S01194 S01508
     C**OR,IF*BTCHCY*IS*SET*TO*'B'*FOR*BASE*CURRENCY,AND*DEFAULT***S01194 S01508
     C**CHARGE*CCY*IS*BASE*****************************************S01194 S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    OREQ 'B'                                S01194 S01508
     C***********SFCCY     ANDEQBJCYCD                             S01194 S01508
     C***********                                                  S01194 S01508
     C**OR,IF*BTCHCY*SET*TO*'L'*FOR*LOCAL*CURRENCY,AND*LOCAL*IS*THES01194 S01508
     C**SAME*CCY*AS*BASE,AND*DEFAULT*CCY*IS*BASE*******************S01194 S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    OREQ 'L'                                S01194 S01508
     C***********BJCYCD    ANDEQBJLCCY                             S01194 S01508
     C***********SFCCY     ANDEQBJCYCD                             S01194 S01508
     C***********                                                  S01194 S01508
     C**OR,IF*BTCHCY*SET*TO*'L'*FOR*LOCAL*CURRENCY,AND*DEFAULT*CHARS01194 S01508
     C**CURRENCY*IS*THE*SAME*AS*LOCAL*CCY**************************S01194 S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    OREQ 'L'                                S01194 S01508
     C***********SFCCY     ANDEQBJLCCY                             S01194 S01508
     C***********                                                  S01194 S01508
     C***********          Z-ADDAMNT      DUMA   110                      S01508
     C***********          MOVE AMNTD     AMNTD2 12                       S01508
     C**CURRENCY*******************************************************   S01508
     C***********          MOVE SFCCY     SECCY                           S01508
     C***********                                                         S01508
     C**IF*NONE*ABOVE*APPLY,INPUT*CAPABLE*CHARGE*FIELD*MAY*BE*BASE*****   S01508
     C**WITH*RIGHT*HAND*SIDE*NOT*BASE*-*HERE*USE*BASE*COMMISSION*******   S01508
     C**CHARGE*ALREADY*CALCULATED**************************************   S01508
     C***********                                                         S01508
     C***********          ELSE                            ** X001        S01508
     C***********BTCHCY    IFEQ 'B'                        ** B002 S01194 S01508
     C***********SFCCY     ANDNEBJCYCD                             S01194 S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    OREQ 'L'                                S01194 S01508
     C***********BJLCCY    ANDEQBJCYCD                             S01194 S01508
     C***********                                                  S01194 S01508
     C***********                                                  S01194 S01508
     C**CURRENCY***************************************************S01194 S01508
     C***********          MOVE BJCYCD    SECCY                    S01194 S01508
     C***********                                                  S01194 S01508
     C***********FTCC******IFEQ 'B'                        ** B002 S01194
     C***********SFCCY*****ANDNEBCCY                               S01194
     C*********************                                        S01194
     C***********FTCC******OREQ 'L'                                S01194
     C***********LOCY******ANDEQBCCY                               S01194
     C*********************                                        S01194
     C**CURRENCY***********                                        S01194
     C*********************MOVE BCCY      SECCY                    S01194
     C***********                                                         S01508
     C**CONVERSION*FOR*DISPLAY*****************************************   S01508
     C***********                                                         S01508
     C***********          Z-ADDAMNTB     DUMA                            S01508
     C***********          Z-ADDAMNTB     ZFLD15                          S01508
     C***********          Z-ADDBCDP      ZDECS                           S01508
     C***********          MOVE ' '       ZECODE                          S01508
     C***********          EXSR ZSEDIT                                    S01508
     C***********          MOVE ZOUT21    AMNTD2                          S01508
     C***********                                                         S01508
     C**IF*NONE*ABOVE*APPLY,INPUT*CAPABLE*CHARGE*FIELD*MAY*BE*LOCAL****   S01508
     C**SO*CALCULATE*CONVERSION*FROM*BASE*TO*LOCAL*********************   S01508
     C***********                                                         S01508
     C***********          ELSE                            ** X002        S01508
     C***********                                                  S01194 S01508
     C***********BTCHCY    IFEQ 'L'                        ** B003 S01194 S01508
     C***********BJLCCY    ANDNEBJCYCD                             S01194 S01508
     C***********                                                         S01508
     C***********FTCC******IFEQ 'L'                        ** B003 S01194 S01508
     C***********LOCY******ANDNEBCCY                               S01194 S01508
     C***********                                                         S01508
     C**D*IS*DIFFERENCE*BETWEEN*DECIMALS*FOR*BASE*AND*DECIMALS*FOR*****   S01508
     C**LOCAL*CURRENCY*-*FOLLOWING*CALCS*FIND*TRUE*RATE(LSPOT)TO*******   S01508
     C**CONVERT*BASE*CURRENCY*TO*LOCAL*********************************   S01508
     C***********                                                         S01508
     C***********LCDP      SUB  BCDP      D       10                      S01508
     C***********LMDIN     IFEQ 1                          ** B004        S01508
     C***********                                                         S01508
     C***********D         IFGT 0                          ** B005        S01508
     C***********LSPOT     DIV  POWERS,D  TSPOT  159                      S01508
     C***********          ELSE                            ** X005        S01508
     C***********                                                         S01508
     C***********D         IFLT 0                          ** B006        S01508
     C***********          Z-SUBD         D                               S01508
     C***********LSPOT     MULT POWERS,D  TSPOT                           S01508
     C***********          ELSE                            ** X006        S01508
     C***********          Z-ADDLSPOT     TSPOT                           S01508
     C***********          END                             ** E006        S01508
     C***********                                                         S01508
     C***********          END                             ** E005        S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C***********LMDIN     IFEQ 0                          ** B004        S01508
     C***********                                                         S01508
     C***********D         IFGT 0                          ** B005        S01508
     C***********LSPOT     MULT POWERS,D  TSPOT                           S01508
     C***********          ELSE                            ** X005        S01508
     C***********                                                         S01508
     C***********D         IFLT 0                          ** B006        S01508
     C***********          Z-SUBD         D                               S01508
     C***********LSPOT     DIV  POWERS,D  TSPOT                           S01508
     C***********          ELSE                            ** X006        S01508
     C***********          Z-ADDLSPOT     TSPOT                           S01508
     C***********          END                             ** E006        S01508
     C***********                                                         S01508
     C***********          END                             ** E005        S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C**NOW*USE*RATE*TO*CALCULATE*DEFAULT*VALUE*IN*LOCAL*CURRENCY******   S01508
     C***********                                                         S01508
     C***********LMDIN     IFEQ 1                          ** B004        S01508
     C***********AMNTB     DIV  TSPOT     AMNTE  110H                     S01508
     C***********          END                             ** E004        S01508
     C***********                                                         S01508
     C***********LMDIN     IFEQ 0                          ** B004        S01508
     C***********AMNTB     MULT TSPOT     AMNTE  110H                     S01508
     C***********          END                             ** E004        S01508
     C**CURRENCY*******************************************************   S01508
     C***********          MOVE BJLCCY    SECCY                    S01194 S01508
     C*********************MOVE LOCY      SECCY                    S01194 S01508
     C***********                                                         S01508
     C**CONVERSION*FOR*DISPLAY*****************************************   S01508
     C***********                                                         S01508
     C***********          Z-ADDAMNTE     DUMA                            S01508
     C***********          Z-ADDAMNTE     ZFLD15                          S01508
     C***********          Z-ADDLCDP      ZDECS                           S01508
     C***********          MOVE ' '       ZECODE                          S01508
     C***********          EXSR ZSEDIT                                    S01508
     C***********          MOVE ZOUT21    AMNTD2                          S01508
     C***********                                                         S01508
     C***********          END                             ** E003        S01508
     C***********                                                         S01508
     C***********          END                             ** E002        S01508
     C***********                                                         S01508
     C***********          END                             ** E001        S01508
     C***********                                                         S01508
     C***********          ENDSR                                          S01508
     C***********                                                         S01508
1    C********************************************************************S01508
     C/EJECT
     C********************************************************************
     C*
     C** CONVERT SCREEN VALUES TO FILE VALUES
     C*
     C           CHGLT2    BEGSR
     C*
      ** DETERMINE CHARGE CURRENCY(MAY HAVE CHANGED IF CDRO CHANGED)
     C*
     C*
     C                     Z-ADD0         AMNT   110H                     S01508
     C*                                                                   S01508
     C           SCHDB     IFNE *BLANKS                    ** B001
     C                     MOVE BJCYCD    FCCY    3                       S01194
     C*********************MOVE BCCY      FCCY    3                       S01194
     C                     ELSE                            ** X001
     C                     MOVE CRCY      FCCY
     C                     END                             ** E001
     C*
     C*  ACCESS FULL CCY DETAILS FOR ENTRY CURRENCY
     C*
     C                     MOVELSECCY     CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        ECDP    10
     C                     Z-ADDMDIN      EMDIN   10
     C                     Z-ADDA6SPRT    ESPOT  138                      S01194
     C*********************Z-ADDSPOT      ESPOT  138                      S01194
     C*
     C* CONVERSION FROM DISPLAY
     C*
     C           11        SUB  ECDP      ZADIG
     C                     Z-ADDECDP      ZADEC
     C                     MOVEL*BLANKS   ZFIELD
     C                     MOVE SAMNT     ZFIELD
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    AMNT
     C*
     C* IF ENTRY CURRENCY = FILE CURRENCY,NO NEED TO DO ANY CONVERSION
     C*
     C           SECCY     IFEQ FCCY                       ** B001
     C                     Z-ADDAMNT      FAMNT
     C                     MOVE ECDP      FCDP
     C                     ELSE                            ** X001
      *                                                                   CEU006
     C           CEU006    IFEQ 'Y'                                       CEU006
      *                                                                   CEU006
     C           *LIKE     DEFN A6INCY    @4INCY                          CEU006
     C           *LIKE     DEFN A6TPSD    @4TPSD                          CEU006
     C           *LIKE     DEFN A6INCY    @5INCY                          CEU006
     C           *LIKE     DEFN A6TPSD    @5TPSD                          CEU006
     C           *LIKE     DEFN A6NBDP    @5NBDP                          CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD   7                       CEU006
     C                     PARM '*KEY   ' @OPTN   7                       CEU006
     C                     PARM SECCY     @CURR   3                       CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD46        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE A6INCY    @4INCY                          CEU006
     C                     Z-ADDA6TPSD    @4TPSD                          CEU006
      *                                                                   CEU006
     C                     CALL 'AOCURRR0'                                CEU006
     C                     PARM *BLANKS   @RTCD   7                       CEU006
     C                     PARM '*KEY   ' @OPTN   7                       CEU006
     C                     PARM FCCY      @CURR   3                       CEU006
     C           SDCURR    PARM SDCURR    DSSDY                           CEU006
      *                                                                   CEU006
     C           @RTCD     IFNE *BLANKS                                   CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD47        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     MOVE A6INCY    @5INCY                          CEU006
     C                     Z-ADDA6TPSD    @5TPSD                          CEU006
     C                     Z-ADDA6NBDP    @5NBDP                          CEU006
      *                                                                   140646
      * Reaccess previous ccy to avoid incorrect A6NBDP.                  140646
     C                     CALL 'AOCURRR0'                                140646
     C                     PARM *BLANKS   @RTCD   7                       140646
     C                     PARM '*KEY   ' @OPTN   7                       140646
     C                     PARM SECCY     @CURR   3                       140646
     C           SDCURR    PARM SDCURR    DSSDY                           140646
      *                                                                   140646
     C           @RTCD     IFNE *BLANKS                                   140646
     C                     MOVEL'AOCURRR0'DBFILE                          140646
     C                     MOVEL'*CALL'   DBKEY                           140646
     C                     Z-ADD46        DBASE                           140646
     C                     EXSR SRERR                                     140646
     C                     ENDIF                                          140646
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C           @4INCY    IFEQ 'Y'                                       CEU006
     C           @5INCY    OREQ 'Y'                                       CEU006
      *                                                                   CEU006
      ** Set paramaters for call to FT0010                                CEU006
      *                                                                   CEU006
     C                     CLEARP#0010                                    CEU006
      *                                                                   CEU006
     C                     MOVEL'FT0070'  P#PMSQ                          CEU006
      *                                                                   CEU006
     C                     MOVE SECCY     P#DBCY                          CEU006
     C                     Z-ADDAMNT      P#DBAM                          CEU006
     C                     Z-ADDCRVD      P#DBDT                          CEU006
     C                     MOVE FCCY      P#CRCY                          CEU006
     C                     Z-ADDCRVD      P#CRDT                          CEU006
      *                                                                   CEU006
     C                     CALL 'FT0010'                                  CEU006
     C                     PARM           P#0010                          CEU006
      *                                                                   CEU006
     C           P#RTCD    IFNE *BLANK                                    CEU006
     C                     MOVEL'AOCURRR0'DBFILE                          CEU006
     C                     MOVEL'*CALL'   DBKEY                           CEU006
     C                     Z-ADD48        DBASE                           CEU006
     C                     EXSR SRERR                                     CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C                     Z-ADDP#CRAM    FAMNT                           CEU006
      *                                                                   CEU006
      ** Conversion for potential re-display                              CEU006
      *                                                                   CEU006
     C                     Z-ADD@5NBDP    ZDECS                           CEU006
     C                     MOVE ' '       ZECODE                          CEU006
     C                     Z-ADDFAMNT     ZFLD15                          CEU006
     C                     EXSR ZSEDIT                                    CEU006
     C                     MOVE ZOUT21    SAMNTF 12                       CEU006
      *                                                                   CEU006
     C                     ELSE                                           CEU006
      *                                                                   CEU006
     C* IF NOT STRAIGHT,THEN CONVERSION NEEDS TO BE DONE.START BY
     C* CONVERSION OF SCREEN(LOCAL OR CHARGE) TO BASE
     C* D IS DIFFERENCE BETWEEN DECIMALS FOR BASE AND DECIMALS FOR
     C* SCREEN CURRENCY - FOLLOWING CALCS FIND TRUE RATE(TSPOT)TO
     C* CONVERT LOCAL OR CHARGE CURRENCY TO BASE
     C*
     C*
     C***********FTCC******IFEQ 'L'                        ** B002        S01194
     C***********FTCC******OREQ 'C'                                       S01194
     C*********************                                               S01194
     C***********SECCY*****IFNE BCCY                       ** B003        S01194
     C*                                                                   S01194
     C           BTCHCY    IFEQ 'L'                        ** B002        S01194
     C           BTCHCY    OREQ 'C'                                       S01194
     C           BTCHCY    OREQ 'F'                                                         AR944056
     C*                                                                   S01194
     C           SECCY     IFNE BJCYCD                     ** B003        S01194
     C*
     C           BCDP      SUB  ECDP      D       10
     C           EMDIN     IFEQ 1                          ** B004
     C           D         IFGT 0                          ** B005
     C           ESPOT     MULT POWERS,D  TSPOT  159
     C                     ELSE                            ** X005
     C           D         IFLT 0                          ** B006
     C                     Z-SUBD         D
     C           ESPOT     DIV  POWERS,D  TSPOT
     C                     ELSE
     C                     Z-ADDESPOT     TSPOT
     C                     END                             ** E006
     C                     END                             ** E005
     C                     END                             ** E004
     C           EMDIN     IFEQ 0                          ** B004
     C           D         IFGT 0                          ** B005
     C           ESPOT     DIV  POWERS,D  TSPOT
     C                     ELSE                            ** X005
     C           D         IFLT 0                          ** B006
     C                     Z-SUBD         D
     C           ESPOT     MULT POWERS,D  TSPOT
     C                     ELSE
     C                     Z-ADDESPOT     TSPOT
     C                     END                             ** E006
     C                     END                             ** E005
     C                     END                             ** E004
     C*
     C* NOW USE RATE TO CALCULATE DEFAULT VALUE IN BASE CCY
     C*
     C           EMDIN     IFEQ 1                          ** B004
     C           AMNT      MULT TSPOT     BAMNT  110H
     C                     END                             ** E004
     C*
     C           EMDIN     IFEQ 0                          ** B004
     C           AMNT      DIV  TSPOT     BAMNT  110H
     C                     END                             ** E004
     C*
     C                     ELSE                            ** X003
     C*
     C* IF BTCHCY LOCAL/CHARGE,BUT ENTRY CCY = BASE  -  STRAIGHT
     C* MOVE ACROSS
     C*
     C                     Z-ADDAMNT      BAMNT
     C*
     C                     END                             ** E003
     C*
     C                     ELSE                            ** X002
     C*
     C* AT THIS POINT,IF ENTRY CURRENCY WAS LOCAL OR CHARGE,HAS BEEN
     C* CONVERTED TO BASE - NOW IF BTCHCY=BASE - CAN MOVE ENTRY AMOUNT
     C* INTO BAMNT TO CONFORM AS ABOVE
     C*
     C***********FTCC******IFEQ 'B'                        ** B003        S01194
     C           BTCHCY    IFEQ 'B'                        ** B003        S01194
     C                     Z-ADDAMNT      BAMNT
     C                     END                             ** E003
     C*
     C                     END                             ** E002
     C*
     C* NOW,CAN MOVE VALUES ACROSS IF FILE CURRENCY IS BASE
     C*
     C***********FCCY******IFEQ BCCY                       ** B002        S01194
     C           FCCY      IFEQ BJCYCD                     ** B002        S01194
     C                     Z-ADDBAMNT     FAMNT
     C*
     C                     ELSE                            ** X002
     C*
     C* IF FILE CCY IS NOT BASE,CONVERT FROM BAMNT TO FILE CCY
     C*
     C*
     C*  ACCESS FULL CCY DETAILS FOR FILE CURRENCY
     C*
     C                     MOVELFCCY      CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        FCDP    10
     C                     Z-ADDMDIN      FMDIN   10
     C                     Z-ADDA6SPRT    FSPOT  138                      S01194
     C*********************Z-ADDSPOT      FSPOT  138                      S01194
     C*
     C* D IS DIFFERENCE BETWEEN DECIMALS FOR BASE AND DECIMALS FOR
     C* FILE CURRENCY - FOLLOWING CALCS FIND TRUE RATE(TSPOT)TO
     C* CONVERT BASE CURRENCY TO FILE
     C*
     C           FCDP      SUB  BCDP      D       10
     C           FMDIN     IFEQ 1                          ** B003
     C           D         IFGT 0                          ** B004
     C           FSPOT     DIV  POWERS,D  TSPOT  159
     C                     ELSE                            ** X004
     C           D         IFLT 0                          ** B005
     C                     Z-SUBD         D
     C           FSPOT     MULT POWERS,D  TSPOT
     C                     ELSE                            ** X005
     C                     Z-ADDFSPOT     TSPOT
     C                     END                             ** E005
     C                     END                             ** E004
     C                     END                             ** E003
     C           FMDIN     IFEQ 0                          ** B003
     C           D         IFGT 0                          ** B004
     C           FSPOT     MULT POWERS,D  TSPOT
     C                     ELSE                            ** X004
     C           D         IFLT 0                          ** B005
     C                     Z-SUBD         D
     C           FSPOT     DIV  POWERS,D  TSPOT
     C                     ELSE                            ** X005
     C                     Z-ADDFSPOT     TSPOT
     C                     END                             ** E005
     C                     END                             ** E004
     C                     END                             ** E003
     C*
     C* NOW USE RATE TO CALCULATE FILE VALUE
     C*
     C           FMDIN     IFEQ 1                          ** B003
     C           BAMNT     DIV  TSPOT     FAMNT  110H
     C                     END                             ** E003
     C*
     C           FMDIN     IFEQ 0                          ** B003
     C           BAMNT     MULT TSPOT     FAMNT  110H
     C                     END                             ** E003
     C*
     C                     END                             ** E002
     C*
     C                     END                             ** E001
      *                                                                   CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
     C*
     C* CONVERSION FOR POTENTIAL REDISPLAY
     C*
     C                     Z-ADDFCDP      ZDECS
     C                     MOVE ' '       ZECODE
     C                     Z-ADDFAMNT     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNTF 12
      *
     C                     ENDSR
     C/EJECT
     C************************************************************
     C* RATES SR.
     C* VALIDATION OF RATE
     C* OPTIONAL DEFAULTS TO CROSS RATE
     C* IF REGULAR PAYMENT NOT PERMITTED
     C*
     C           RATES     BEGSR
      *                                                                   056823
      * Calculate default rate                                            056823
      *                                                                   056823
     C                     EXSR RATDEF
      *                                                                   056823
      * If rate not entered on screen use the default rate, else          056823
      * validate screen rate for valid numeric                            056823
      *                                                                   056823
     C           SRATE     IFEQ *BLANK                     B001
     C                     Z-ADDDRATE     NRATE
     C                     Z-ADDDMDIN     SMDIN
     C                     ELSE                            X001
     C*
     C* CHECK IF VALID NUMERIC
     C*
     C                     MOVE *BLANK    ZFIELD
     C                     MOVE SRATE     ZFIELD
     C                     Z-ADD4         ZADIG
     C                     Z-ADD8         ZADEC
     C                     EXSR ZALIGN
     C  N99                MOVE ZFIELD    @@@@@@ 138                      E25159
     C*
     C           *IN99     IFEQ '1'                        B002
     C           @@@@@@    ORLE 0                                         E25159
     C                     SETON                     5489
     C                     ADD  1         S
     C*********************MOVEA' 048'    ERCD,S                          S01117
     C*********************MOVEA' 054'    ERCD,S                   S01117 056823
     C                     MOVEA' 074'    ERCD,S                          056823
     C                     GOTO ENRTT
      *
      * Valid screen rate entered, determine multiply/divide indicator
      * dependant on default rate and entered rate
      *
     C                     ELSE                            X002
     C                     MOVE ZFIELD    NRATE  138
     C*
     C***********DRATE     IFGT 1                          B003           112287
     C***********NRATE     ANDGT1                                         112287
     C***********DRATE     ORLE 1                                         112287
     C***********NRATE     ANDLE1                                         112287
     C                     Z-ADDDMDIN     SMDIN   10
     C***********          ELSE                            X003           112287
     C***********1         SUB  DMDIN     SMDIN                           112287
     C***********          END                             E003           112287
      *
      * If currency rate not to be overridden OR settle ccy equals
      * credit currency, validate that the rate is within the range
      * calculated by the system.
      *
     C           SOVER     IFNE 'Y'                        B003
     C           SMCY      OREQ CRCY                                      E25172
     C           SOVER     ANDEQ'Y'
     C                     EXSR RATVAL
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C* SET UP DISPLAY RATE FIELD
     C*
     C                     Z-ADD5         WDIG
     C                     Z-ADD8         WDEC
     C                     MOVE NRATE     WFDIN
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    SRATE
     C*
     C           ENRTT     ENDSR
     C************************************************************
     C* END OF RATE VALIDATION
     C************************************************************
     C/EJECT
     C************************************************************
     C* RATDEF SR.
     C* DEFAULT RATE CALCULATION
     C*
     C           RATDEF    BEGSR
     C*
     C* SETUP TO AND FROM RATES
     C*
     C                     MOVE SMCY      FCCY    3
     C                     MOVE CRCY      TCCY    3
     C                     Z-ADDPBRAT     FBRAT  138
     C                     Z-ADDPMDIN     FMDIN   10
     C                     Z-ADDRBRAT     TBRAT  138
     C                     Z-ADDPCDP      FCDP    10
     C                     Z-ADDRSRAT     TSRAT  138
     C                     Z-ADDRMDIN     TMDIN   10
     C                     Z-ADDRCDP      TCDP    10
     C*
     C* IF CURRENCIES EQUAL RATE IS 1.0
     C*
     C           FCCY      IFEQ TCCY                       B001
     C                     Z-ADD1         DRATE  138
     C                     Z-ADD0         DMDIN   10
     C                     ELSE                            X001
     C*
     C* IF FROM CURRENCY IS BASE, RATE IS that of TO CURRENCY
     C*
     C***********FCCY******IFEQ BCCY                       B002           S01194
     C           FCCY      IFEQ BJCYCD                     B002           S01194
     C*********************Z-ADDTBRAT     DRATE                           056823
     C                     Z-ADDTSRAT     DRATE                           056823
     C                     Z-ADDTMDIN     DMDIN
     C           1         SUB  TMDIN     DMDIN
     C                     ELSE                            X002
     C*
     C* IF TO CURRENCY IS BASE, RATE IS that of FROM CURRENCY
     C*
     C***********TCCY******IFEQ BCCY                       B003           S01194
     C           TCCY      IFEQ BJCYCD                     B003           S01194
     C                     Z-ADDFBRAT     DRATE
     C                     Z-ADDFMDIN     DMDIN
     C                     ELSE                            X003
     C*
     C* IF NEITHER CURRENCY IS BASE
     C* IF BOTH DIVIDE CURRENCIES
     C*
     C           FMDIN     IFEQ 0                          B004
     C*
     C           TMDIN     IFEQ 0                          B005
     C*
     C* RATE IS TO SELL RATE DIVIDE BY FROM BUY RATE
     C*
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C*
     C           DRATE     IFLT 1                          B006
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C*
     C                     ELSE                            X005
     C*
     C           FBRAT     MULT TSRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C*
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD1         DMDIN
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     ELSE                            X004
     C*
     C           TMDIN     IFEQ 0                          B005
     C           TSRAT     MULT FBRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C*
     C           DRATE     IFLT 1                          B006
     C           1         DIV  DRATE     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C*
     C                     ELSE                            X005
     C*
     C           FBRAT     DIV  TSRAT     DRATE     H
     C                     Z-ADD1         DMDIN
     C*
     C           DRATE     IFLT 1                          B006
     C           TSRAT     DIV  FBRAT     DRATE     H
     C                     Z-ADD0         DMDIN
     C                     END                             E006
     C*
     C                     END                             E005
     C*
     C                     END                             E004
     C*
     C                     END                             E003
     C*
     C                     END                             E002
     C*
     C                     END                             E001
     C*
     C                     ENDSR
     C************************************************************
     C* END DEFAULT RATE CALCULATION
     C************************************************************
     C/EJECT
     C************************************************************
     C* RATVAL SR.
     C* VALIDATE RATE WHEN ENTERED
     C*
     C           RATVAL    BEGSR
     C*
     C* If settle and credit currency are the same, the rate must be 1
     C*
     C           SMCY      IFEQ CRCY                       B001
     C*
     C           NRATE     IFNE 1                          B002
     C                     SETON                     5489
     C                     ADD  1         S
     C*********************MOVEA' 048'    ERCD,S                          S01117
     C*********************MOVEA' 054'    ERCD,S                    S01117056823
     C                     MOVEA' 078'    ERCD,S                          056823
     C                     END                             E002
      *
     C                     ELSE                            X001
      *
      ** Upper and lower limits are determined by % rate discrepancy
      **     from payment charges file .
      *
     C           DRATE     MULT UPMARG    UPRATE 138H
     C           DRATE     MULT LWMARG    DORATE 138H
      *
     C           NRATE     IFLT DORATE                     B002
     C           NRATE     ORGT UPRATE
      *
      ** Entered rate may be Pay ccy/Receive ccy or vice versa
      **     (whichever is nearer the default rate(DRATE) is assumed)
      *
     C           1         DIV  DRATE     DRATE
     C           DRATE     MULT UPMARG    UPRATE 138H
     C           DRATE     MULT LWMARG    DORATE 138H
      *
     C           NRATE     IFLT DORATE                     B003
     C           NRATE     ORGT UPRATE
     C                     SETON                     5489
     C                     ADD  1         S
     C*********************MOVEA' 048'    ERCD,S                          S01117
     C                     MOVEA' 054'    ERCD,S                          S01117
     C                     END                             E003
      *
     C                     END                             E002
      *
     C                     END                             E001
      *
     C                     ENDSR
     C************************************************************
     C* END OF ENTERED RATE VALIDATION
     C************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C*  ADCHK SUBROUTINE - TO VALIDATE ADDRESS FIELDS
     C*
     C*****************************************************************
     C*
     C           ADCHK     BEGSR
     C*
     C* IF IT IS AN ADDRESS, THERE MUST BE MORE THAN ONE LINE AND
     C* THE FIRST CHARACTER SHOULD BE A '/'
     C* (BUT ONLY DO THE CHECK IF NOT A NARRATIVE. I.E. *IN95 = 0)
     C*
     C           *IN95     IFEQ '0'
     C                     MOVE 'N'       TGFLG   1
     C                     MOVELADCHK1    ADDTG1  1
     C           ADDTG1    IFEQ '/'
     C           ADCHK2    ANDEQ*BLANKS
     C                     MOVE 'Y'       TGFLG
     C                     END
     C           ADDTG1    IFNE '/'
     C           ADCHK5    ANDNE*BLANKS
     C                     MOVE 'Y'       TGFLG
     C                     END
     C           TGFLG     IFEQ 'Y'
     C                     SETON                     91
     C                     END
     C                     END
     C*
     C* THERE SHOULD BE NO EMBEDDED SPACES
     C*
     C           ADCHK1    IFEQ *BLANK
     C           ADCHK2    ANDNE*BLANK
     C*
     C           ADCHK1    OREQ *BLANK
     C           ADCHK3    ANDNE*BLANK
     C*
     C           ADCHK1    OREQ *BLANK
     C           ADCHK4    ANDNE*BLANK
     C*
     C           ADCHK1    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK1    OREQ *BLANK
     C           ADCHK6    ANDNE*BLANK
     C*
     C           ADCHK2    OREQ *BLANK
     C           ADCHK3    ANDNE*BLANK
     C*
     C           ADCHK2    OREQ *BLANK
     C           ADCHK4    ANDNE*BLANK
     C*
     C           ADCHK2    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK2    OREQ *BLANK
     C           ADCHK6    ANDNE*BLANK
     C*
     C           ADCHK3    OREQ *BLANK
     C           ADCHK4    ANDNE*BLANK
     C*
     C           ADCHK3    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK3    OREQ *BLANK
     C           ADCHK6    ANDNE*BLANK
     C*
     C           ADCHK4    OREQ *BLANK
     C           ADCHK5    ANDNE*BLANK
     C*
     C           ADCHK4    OREQ *BLANK
     C           ADCHK6    ANDNE*BLANK
     C*
     C           ADCHK5    OREQ *BLANK
     C           ADCHK6    ANDNE*BLANK
     C*
     C                     SETON                     92
     C*
     C                     END
     C**
     C                     ENDSR
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**  FUNCTION : TO FORMAT A NUMERIC FIELD FROM PF/CQCOCDD TO
     C**             DETAIL SCREEN 2
     C**             IT REMOVES LEADING ZEROES & INSERTS A DECIMAL
     C**             POINT IN THE APPROPRIATE POSITION.
     C*
     C**  CALLS :    NONE
     C*
     C**  CALLED BY: DETL1
     C*
     C*
     C           FAMTSR    BEGSR
     C**
     C                     MOVEAWFDIN     WA1,1
     C*
     C** REPLACE LEADING ZEROES (IF LEFT OF DECIMAL POINT) WITH SPACES
     C*
     C                     SETOF                     34
     C           15        SUB  WDIG      I       30        -START
     C                     SUB  WDEC      I                  POS.
     C*
     C** IF ZERO DECIMAL PLACES, ZERO SUPPRESS ONE EXTRA PLACE
     C*
     C           WDEC      IFEQ 0                          B001
     C                     SUB  1         I
     C                     END                             E001
     C*
     C           14        SUB  WDEC      I1      30
     C*
     C           *IN34     DOUEQ'1'                        B001
     C                     ADD  1         I
     C*    CHECK FOR ARRAY END
     C           I         IFGT 15                         B002
     C                     SETON                     34
     C                     ELSE                            X002
     C*    CHECK FOR NON-ZERO DIGIT
     C           WA1,I     IFNE '0'                        B003
     C           WA1,I     ANDNE' '
     C                     SETON                     34
     C                     ELSE                            X003
     C           I         IFLE I1                         B004
     C                     MOVEL' '       WA1,I
     C                     END                             E004
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*
     C** MOVE TO OUTPUT ARRAY,INSERTING A DECIMAL POINT AS APPROPRIATE
     C** (UNLESS THE INPUT FIELD WAS ALL ZEROES)
     C*
     C**
     C                     MOVEL*BLANKS   WA2
     C**
     C           WDEC      IFEQ *ZERO                      B001
     C                     MOVEAWA1,1     WA2,2
     C                     ELSE                            X001
     C                     MOVEAWA1,1     WA2,1
     C           16        SUB  WDEC      I
     C           I         ADD  1         I1
     C                     MOVEL'.'       WA2,I
     C                     MOVEAWA1,I     WA2,I1
     C                     END                             E001
     C**
     C                     MOVEAWA2,1     WFDOUT 16
     C**
     C           FMEND     ENDSR
     C**
     C/EJECT
     C**
     C*****************************************************************
     C************************************************************
     C**                                                                  S01199
     C**HELP*SR.*                                                         S01199
     C**CALLS*HELP**PROGRAM*                                              S01199
     C*********************                                               S01199
     C***********HELP******BEGSR                                          S01199
     C*********************MOVEAERCD      HERCD 160                       S01199
     C*********************MOVEL'FT0000'  HBPGM   6                       S01199
     C*********************CALL 'MHELP'                                   S01199
     C*********************PARM           HBPGM                           S01199
     C*********************PARM           HERCD                           S01199
     C*********************SETOF                     03                   S01199
     C*********************ENDSR                                          S01199
     C************************************************************        S01199
     C**END*OF*HELP*SUBROUTINE*                                           S01199
     C************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. HCONV TO CONVERT HEADER RECORD TO SCREEN FIELDS
     C*
     C           HCONV     BEGSR
     C*
     C                     MOVE PREF      SPREF
     C                     MOVE CQSQ      SCQSQ
     C                     MOVE PYST      SPYST
     C                     MOVE COB1      SCBK1
     C                     MOVE BKGBR     SBKGBR                          S01117
     C                     MOVE ORBR      SORBR                           S01117
     C*                                                                   S01117
     C**  IF SINGLE-BRANCHED AND COLLECTING BANK IS FULL ACCOUNT          S01117
     C**    BLANK OUT BRANCH                                              S01117
     C           *IN20     IFEQ '0'                                       S01117
     C           COBT      ANDEQ'G'                                       S01117
     C                     MOVE *BLANKS   SCBBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE COB2      SCBK2
     C                     MOVE COB3      SCBK3
     C                     MOVE COB4      SCBK4
     C*
     C                     MOVE *BLANKS   SRCCO
     C           RCRT      IFEQ 'R'                        B001
     C                     MOVE RCCO      SRCCO
     C                     ELSE                            X001
     C           RCRT      IFEQ 'N'                        B002
     C                     MOVELRCCO      RCCS    2
     C                     MOVELRCCS      SRCCO
     C                     END                             E002
     C                     END                             E001
     C*
     C                     MOVE SMCY      SSMCY
     C                     MOVE SLDTD1    SPYVD
     C                     MOVE TOCL      WFDIN
     C                     MOVE SMCY      CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        PCDP    10
     C           13        SUB  PCDP      WDIG    20
     C                     Z-ADDPCDP      WDEC    10
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    STCQA
     C*
     C                     MOVE ' '       DIFFSN
     C           DIFF      IFLT 0                          B001
     C                     Z-SUBDIFF      DIFF
     C                     MOVE '-'       DIFFSN
     C                     END                             E001
     C                     MOVE DIFF      WFDIN  15
     C*
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    SDIFF
     C                     MOVE '0'       *IN78
     C           DIFF      IFNE 0                          B001
     C                     MOVE '1'       *IN78
     C                     END                             E001
     C                     MOVE TOTC      WFDIN
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    STCRE
      *                                                                   CEU006
     C           NDCY      IFNE *BLANKS                                   CEU006
     C                     MOVE NDCY      SNDCY                           CEU006
     C                     MOVE NDAM      WFDIN                           CEU006
     C                     MOVE NDCY      CCYD    3                       CEU006
     C                     EXSR CUDP                                      CEU006
     C                     Z-ADDDP        PCDP    10                      CEU006
     C           13        SUB  PCDP      WDIG    20                      CEU006
     C                     Z-ADDPCDP      WDEC    10                      CEU006
     C                     EXSR FAMTSR                                    CEU006
     C                     MOVE WFDOUT    SNDAM                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SNDCY                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
     C                     ENDIF                                          CEU006
      *                                                                   CEU006
      *                                                                   S01414
     C                     MOVELHBOKC     SHBOKC                          S01414
     C                     MOVELHPRFC     SHPRFC                          S01414
     C*                                                                   S01414
      *                                                                   056823
      * Save amount/ccy/rate fields for checking in detail screen         056823
      * validation                                                        056823
      *                                                                   056823
     C                     Z-ADD0         SVCQAM                          056823
     C                     MOVE *BLANKS   SVRATE                          056823
     C                     MOVE *BLANKS   SVCRCY                          056823
     C                     Z-ADD0         SVCCAM                          056823
      *
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. DCONV TO CONVERT DETAIL RECORD TO SCREEN FIELDS
     C*
     C           DCONV     BEGSR
     C*
     C                     MOVE PREF      SPREF
     C                     MOVE CQSQ      SCQSQ
     C*
     C                     MOVE *BLANKS   SCRPA
     C           CRPT      IFEQ 'N'                        B001
     C                     MOVELCRPY      CRNO    2
     C                     MOVELCRNO      SCRPA
     C                     END                             E001
     C           CRPT      IFEQ 'R'                        B001
     C                     MOVELCRPY      CRRT   10
     C                     MOVELCRRT      SCRPA
     C                     END                             E001
     C/COPY WNCPYSRC,FT0070C045
      * Retrieve Reference Rate                                           CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
      *                                                                   CDL049
     C                     MOVE *BLANKS   ZFIELD                          CDL049
     C                     MOVE CCRRAT    ZFIELD                          CDL049
      *                                                                   CDL049
     C                     CALL 'ZEDIT'                9090               CDL049
     C                     PARM           ZFIELD 16                       CDL049
     C                     PARM 8         ZADEC   10                      CDL049
      *                                                                   CDL049
     C                     MOVE ZFIELD    S#REFR                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C           CRPT      IFEQ 'P'                        B001
     C*                                                                   S01117
     C** SET CREDIT PARTY BRANCH (TO BLANKS IF SINGLE BRANCH)             S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '1'                                       S01117
     C                     MOVE CRBR      SCRBR                           S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   SCRBR                           S01117
     C                     END                                            S01117
     C                     MOVE CRPY      SCRPA                           S01117
     C                     END                             E001
     C*
     C                     MOVE CRCY      SCCCY
     C/COPY WNCPYSRC,FT0070C021
     C                     MOVE CRVDD1    SCVDA
     C/COPY WNCPYSRC,FT0070C022
     C                     MOVE OVRD      SOVER
      *
     C                     MOVE NAR1      SDES1
     C                     MOVE NAR2      SDES2
     C                     MOVE NAR3      SDES3
     C                     MOVE NAR4      SDES4
     C                     MOVE NAR5      SDES5
     C                     MOVE NAR6      SDES6
     C                     MOVE TRCT      STCTF
      *                                                                   S01414
     C                     MOVELBOKC      SBOKC                           S01414
     C                     MOVELPRFC      SPRFC                           S01414
     C*                                                                   S01414
     C*
     C**********           MOVE DNBC1     SDBC1                           035398
     C                     MOVE *BLANKS   SDBC1                           035398
     C                     MOVE *BLANKS   SDBC2
     C                     MOVE *BLANKS   SDBC3
     C                     MOVE *BLANKS   SDBC4
     C                     MOVE *BLANKS   SDBC5
     C/COPY WNCPYSRC,FT0070C097
     C*
     C           DNBC1     IFNE *ZERO                      B001           035398
     C/COPY WNCPYSRC,FT0070C098
     C                     MOVE DNBC1     @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC1                           035398
     C                     END                             E001           035398
     C/COPY WNCPYSRC,FT0070C099
     C           DNBC2     IFNE *ZERO                      B001
     C/COPY WNCPYSRC,FT0070C100
     C**********           MOVE DNBC2     SDBC2                           035398
     C                     MOVE DNBC2     @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC2                           035398
     C                     END                             E001
     C/COPY WNCPYSRC,FT0070C101
     C           DNBC3     IFNE *ZERO                      B001
     C/COPY WNCPYSRC,FT0070C102
     C**********           MOVE DNBC3     SDBC3                           035398
     C                     MOVE DNBC3     @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC3                           035398
     C                     END                             E001
     C/COPY WNCPYSRC,FT0070C103
     C           DNBC4     IFNE *ZERO                      B001
     C/COPY WNCPYSRC,FT0070C104
     C**********           MOVE DNBC4     SDBC4                           035398
     C                     MOVE DNBC4     @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC4                           035398
     C                     END                             E001
     C/COPY WNCPYSRC,FT0070C105
     C           DNBC5     IFNE *ZERO                      B001
     C/COPY WNCPYSRC,FT0070C106
     C**********           MOVE DNBC5     SDBC5                           035398
     C                     MOVE DNBC5     @SNDC                           035398
     C                     EXSR #CBREF                                    035398
     C                     MOVE @SNDC     SDBC5                           035398
     C                     END                             E001
     C*
     C                     MOVE *BLANKS   SCHDB
     C           CDRT      IFEQ 'N'                        B001
     C                     MOVELCDRO      CRNO
     C                     MOVELCRNO      SCHDB
     C                     END                             E001
     C           CDRT      IFEQ 'R'                        B001
     C                     MOVELCDRO      CRRT
     C                     MOVELCRRT      SCHDB
     C                     END                             E001
     C           CDRT      IFEQ 'P'                        B001
     C                     MOVE CDRO      SCHDB
     C*                                                                   S01117
     C** SET CHARGES TO DB OF A/C BRANCH (TO BLANKS IF SINGLE BRANCH)     S01117
     C           *IN20     IFEQ '1'                                       S01117
     C                     MOVE CDBR      SCDBR                           S01117
     C                     ELSE                                           S01117
     C                     MOVE *BLANKS   SCDBR                           S01117
     C                     END                                            S01117
     C                     END                             E001
     C/COPY WNCPYSRC,FT0070C046
     C*
     C                     MOVE SMCY      CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        PCDP
     C           13        SUB  PCDP      WDIG
     C                     Z-ADDPCDP      WDEC
     C                     MOVE CQAM      WFDIN
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    SCQAM
     C*
     C                     Z-ADD5         WDIG
     C                     Z-ADD8         WDEC
     C                     MOVE RATE      WFDIN
     C                     EXSR FAMTSR
     C                     MOVE WFDOUT    SRATE
     C*
     C* CHARGE AMOUNTS ARE NOW CONVERTED FROM FILE(PAY OR SETTLE CCY)
     C* TO OUTPUT SCREEN FIELDS - START WITH RIGHT SIDE FIELDS ON
     C* DISPLAY FILE(PAY/SETTLE/BASE CCY - FILE)
     C*
     C* IF CHARGES TO THE DEBIT OF IS NOT 0 FROM FILE,USE BASE CURRENCY
     C*
     C***********CDRO      IFNE *ZEROS                     ** B001                            CSD027
     C           CDRO      IFNE *BLANKS                    ** B001                            CSD027
     C*********************MOVE BCCY      SFCCY                           S01194
     C                     MOVE BJCYCD    SFCCY                           S01194
     C                     ELSE                            ** X001
     C                     MOVE CRCY      SFCCY
     C                     END                             ** E001
     C*
     C* ACCESS DETAILS OF FILE CHARGE CCY FOR CHARGE CALCULATIONS
     C*
     C                     MOVELSFCCY     CCYD
     C                     EXSR CUDP
     C                     Z-ADDDP        CCDP    10
     C                     Z-ADDMDIN      CMDIN   10
     C                     Z-ADDA6SPRT    CSPOT  138                      S01194
     C*********************Z-ADDSPOT      CSPOT  138                      S01194
     C*
     C                     Z-ADDCCDP      ZDECS
     C                     MOVE ' '       ZECODE
     C*
     C* TRANSFER COMMISSION
     C           TRCM      IFNE *ZEROS                     ** B001
     C                     Z-ADDTRCM      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRCMF
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   STRCMF
     C                     END                             ** E001
     C*                                                                   S01494
     C** FX/CHANGE COMMISSION                                             S01494
     C*                                                                   S01494
     C           *IN09     IFEQ '1'                                       S01494
     C           CCCHCM    IFNE *ZEROS                     ** B001        S01494
     C                     Z-ADDCCCHCM    ZFLD15                          S01494
     C                     EXSR ZSEDIT                                    S01494
     C                     MOVE ZOUT21    SCHCMF                          S01494
     C                     ELSE                            ** X001        S01494
     C                     MOVE *BLANKS   SCHCMF                          S01494
     C                     END                             ** E001        S01494
     C                     END                                            S01494
     C* TELEX CHARGE
     C           TXCH      IFNE *ZEROS                     ** B001
     C                     Z-ADDTXCH      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STXCHF
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   STXCHF
     C                     END                             ** E001
     C* COLLECTION CHARGE
     C           COLL      IFNE *ZEROS                     ** B001
     C                     Z-ADDCOLL      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCOLLF
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   SCOLLF
     C                     END                             ** E001
     C* COSTS ABROAD
     C           CSTA      IFNE *ZEROS                     ** B001
     C                     Z-ADDCSTA      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCSTAF
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   SCSTAF
     C                     END                             ** E001
     C*                                                                   S01499
     C** V.A.T                                                            S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           CCVATT    IFNE *ZEROS                     ** B001        S01499
     C                     Z-ADDCCVATT    ZFLD15                          S01499
     C                     EXSR ZSEDIT                                    S01499
     C                     MOVE ZOUT21    SVATTF                          S01499
     C                     ELSE                            ** X001        S01499
     C                     MOVE *BLANKS   SVATTF                          S01499
     C                     END                             ** E001        S01499
     C                     END                                            S01499
     C*                                                                   E21459
     C** SET UP ENTRY CURRENCY                                            E21459
     C*                                                                   E21459
     C           BTCHCY    IFEQ 'B'                        ** B001        E21459
     C                     MOVE BJCYCD    SECCY                           E21459
     C                     ELSE                            ** X001        E21459
     C           BTCHCY    IFEQ 'L'                        ** B002        E21459
     C                     MOVE BJLCCY    SECCY                           E21459
     C                     ELSE                            ** X002        E21459
     C           BTCHCY    IFEQ 'F'                                                         AR940742
     C                     MOVE FCHCCY    SECCY                                             AR940742
     C                     ELSE                                                             AR940742
     C*********************MOVE CRCY      SECCY                     E21459E37065
     C                     MOVE SFCCY     SECCY                           E37065
     C                     END                                                              AR940742
     C                     END                             ** E002        E21459
     C                     END                             ** E001        E21459
     C*
     C***********FTCC******IFEQ 'C'                        ** B001        S01194
     C           BTCHCY    IFEQ 'C'                        ** B001        S01194
     C           BTCHCY    OREQ 'F'                                                         AR944056
     C*                                                                   E21459
     C** OBTAIN DETAILS OF THE FILE CHARGE CURRENCY CALCULATIONS          E21459
     C*                                                                   E21459
     C                     MOVELSECCY     CCYD                            E21459
     C                     EXSR CUDP                                      E21459
     C                     Z-ADDDP        ZDECS                           E21459
     C**********      ***  MOVE PCDP      ZDECS                           E21459
     C*                                                                   E21459
     C                     ELSE                            ** X001
     C***********FTCC******IFEQ 'L'                        ** B002        S01194
     C           BTCHCY    IFEQ 'L'                        ** B002        S01194
     C                     MOVE LCDP      ZDECS
     C                     ELSE                            ** X002
     C                     MOVE BCDP      ZDECS
     C                     END                             ** E002
     C                     END                             ** E001
     C* TRANSFER COMMISSION
     C           DUMA1     IFNE 0                          ** B001
     C                     Z-ADDDUMA1     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STRCME
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   STRCME
     C                     END                             ** E001
     C*                                                                   S01494
     C** FX/CHANGE COMMISSION                                             S01494
     C*                                                                   S01494
     C           *IN09     IFEQ '1'                                       S01494
     C           CCDUM5    IFNE 0                          ** B001        S01494
     C                     Z-ADDCCDUM5    ZFLD15                          S01494
     C                     EXSR ZSEDIT                                    S01494
     C                     MOVE ZOUT21    SCHCME                          S01494
     C                     ELSE                            ** X001        S01494
     C                     MOVE *BLANKS   SCHCME                          S01494
     C                     END                             ** E001        S01494
     C                     END                                            S01494
     C* TELEX CHARGE
     C           DUMA2     IFNE 0                          ** B001
     C                     Z-ADDDUMA2     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    STXCHE
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   STXCHE
     C                     END                             ** E001
     C* COLLECTION CHARGE
     C           DUMA4     IFNE 0                          ** B001
     C                     Z-ADDDUMA4     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCOLLE
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   SCOLLE
     C                     END                             ** E001
     C* COSTS ABROAD
     C           DUMA3     IFNE 0                          ** B001
     C                     Z-ADDDUMA3     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCSTAE
     C                     ELSE                            ** X001
     C                     MOVE *BLANKS   SCSTAE
     C                     END                             ** E001
     C*                                                                   S01499
     C** V.A.T.                                                           S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C           CCDUM6    IFNE 0                          ** B001        S01499
     C                     Z-ADDCCDUM6    ZFLD15                          S01499
     C                     EXSR ZSEDIT                                    S01499
     C                     MOVE ZOUT21    SVATTE                          S01499
     C                     ELSE                            ** X001        S01499
     C                     MOVE *BLANKS   SVATTE                          S01499
     C                     END                             ** E001        S01499
     C                     END                                            S01499
     C*                                                                   S01499
     C** V.A.T. FLAGS                                                     S01499
     C*                                                                   S01499
     C                     MOVE CCVAT1    SVATI1                          S01499
     C                     MOVE CCVAT2    SVATI2                          S01499
     C                     MOVE CCVAT3    SVATI3                          S01499
     C                     MOVE CCVAT4    SVATI4                          S01499
     C                     MOVE CCVAT5    SVATI5                          S01499
     C** AMENDMENT ERROR                                                  E23056
     C                     Z-ADDDUMA1     SDUMA1                          E23056
     C                     Z-ADDDUMA2     SDUMA2                          E23056
     C                     Z-ADDDUMA3     SDUMA3                          E23056
     C                     Z-ADDDUMA4     SDUMA4                          E23056
     C                     Z-ADDCCDUM5    SDUMA5                          S01494
     C                     Z-ADDCCDUM6    SDUMA6                          S01499
      *                                                                   S10284
      *  DISPLAY CREDIT CURRENCY AMOUNT ON SCREEN IN ENQUIRY/AMEND MODE   S10284
      *                                                                   S10284
     C           CCYAM     IFNE 0                                         S10284
     C                     MOVE SCCCY     CCYD                            S10284
     C                     EXSR CUDP                                      S10284
     C                     Z-ADDDP        PCDP                            S10284
     C           13        SUB  PCDP      WDIG                            S10284
     C                     Z-ADDPCDP      WDEC                            S10284
     C                     Z-ADDCCYAM     WCCYAM 150                      S10284
     C                     MOVE WCCYAM    WFDIN                           S10284
     C                     EXSR FAMTSR                                    S10284
     C                     MOVE WFDOUT    SCCYAM                          S10284
     C                     ELSE                                           S10284
     C                     MOVE *BLANKS   SCCYAM                          S10284
     C                     END                                            S10284
      *                                                                   CEU006
     C                     MOVE PDCY      SPDCY                           CEU006
     C           PDAM      IFNE 0                                         CEU006
     C                     MOVE SPDCY     CCYD                            CEU006
     C                     EXSR CUDP                                      CEU006
     C                     Z-ADDDP        PCDP                            CEU006
     C           13        SUB  PCDP      WDIG                            CEU006
     C                     Z-ADDPCDP      WDEC                            CEU006
     C                     Z-ADDPDAM      WWPDAM 150                      CEU006
     C                     MOVE WWPDAM    WFDIN                           CEU006
     C                     EXSR FAMTSR                                    CEU006
     C                     MOVE WFDOUT    SPDAM                           CEU006
     C                     ELSE                                           CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
     C                     END                                            CEU006
      *                                                                   CEU006
      *                                                                   056823
      * Save amount/ccy/rate fields for checking in detail screen         056823
      * validation                                                        056823
      *                                                                   056823
     C           *LIKE     DEFN CQAM      SVCQAM                          056823
     C           *LIKE     DEFN RATE      SVRATE                          056823
     C           *LIKE     DEFN CRCY      SVCRCY                          056823
     C           *LIKE     DEFN CCYAM     SVCCAM                          056823
      *                                                                   056823
     C                     Z-ADDCQAM      SVCQAM                          056823
     C                     MOVE RATE      SVRATE                          056823
     C                     MOVE CRCY      SVCRCY                          056823
     C                     Z-ADDCCYAM     SVCCAM                          056823
     C*
     C*  SET UP ENTRY CURRENCY
     C*                                                                   S01194
     C********** BTCHCY**  IFEQ 'B'                        ** B001  S01194E21459
     C**********      ***  MOVE BJCYCD    SECCY                     S01194E21459
     C**********      ***  ELSE                            ** X001  S01194E21459
     C********** BTCHCY**  IFEQ 'L'                        ** B002  S01194E21459
     C**********      ***  MOVE BJLCCY    SECCY                     S01194E21459
     C**********      ***  ELSE                            ** X002  S01194E21459
     C**********      ***  MOVE SFCCY     SECCY                     S01194E21459
     C**********      ***  END                             ** E002  S01194E21459
     C**********      ***  END                             ** E001  S01194E21459
     C*
     C***********FTCC******IFEQ 'B'                        ** B001        S01194
     C*********************MOVE BCCY      SECCY                           S01194
     C*********************ELSE                            ** X001        S01194
     C***********FTCC******IFEQ 'L'                        ** B002        S01194
     C*********************MOVE LOCY      SECCY                           S01194
     C*********************ELSE                            ** X002        S01194
     C*********************MOVE SFCCY     SECCY                           S01194
     C*********************END                             ** E002        S01194
     C*********************END                             ** E001        S01194
     C*
     C                     ENDSR
      /EJECT
     C*****************************************************************
     C*
     C**  S.R. UPDAT1 TO UPDATE / OUTPUT HEADER RECORDS
     C*
     C           UPDAT1    BEGSR
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'UPDAT1'  @STK,Q                          056031
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *
     C                     SETOF                     7567
      *
     C           SACTD     IFEQ 'I'                        B001
     C                     Z-ADD0         TOTC
     C                     END                             E001
      *
     C           TOCL      SUB  TOTC      DIFF
      *
     C           SACTD     IFEQ 'I'                        B001
     C*********************Z-ADDRUND      OEDT                            S01194
     C                     Z-ADDBJRDNB    OEDT                            S01194
     C                     END                             E001
      *
     C           SACTD     IFNE 'D'
     C                     EXSR HDAF
     C                     EXSR HSTR
     C                     END
      *
     C                     MOVE SACTD     ACTDH   1
      *
      *          *************************************
     C*
     C**  INSERT PROCESSING
     C*
     C           SACTD     IFEQ 'I'                        B001
     C                     TIME           LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     MOVE 'I'       CHTP
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C/COPY WNCPYSRC,FT0070C017
     C                     EXSR PYREF
     C/COPY WNCPYSRC,FT0070C018
     C                     Z-ADD0         NCSQ
     C                     MOVE *BLANKS   IACG
     C                     MOVE *BLANKS   SACG
     C                     MOVE *BLANKS   DMSG
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C                     MOVE *BLANKS   AUIN
     C                     MOVE *BLANKS   ADIN
     C*
     C* ZEROISE HEADER REVERSED AMOUNT FOR OLPOS
     C*
     C                     Z-ADD0         CQRV
     C                     Z-ADDSLDT      DSLDT   50               E110
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR1 10
      *                                                                                       CSD015
      ** Perform compliance watch processing before writing new record                        CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y' - INSERT HEADER                                                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank                                                                      CSD015
      *                                                                                       CSD015
     C           COB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF   1                                           CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP   6                                           CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD4         WX      20                                          CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent                                                               CSD015
      *                                                                                       CSD015
     C***********RCCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           RCCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2    2                                           CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP   6                                           CSD015
     C                     Z-ADD2         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C*
     C                     MOVE 'D'       RECI                                              AR920572
     C                     WRITECQCODDDF               75
      *                                                                   056031
      *  Generate Shadow Postings for Insert Debit Instructions           056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     Z-ADDTOCL      ##DRAM                          056031
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C                     END                                            056031
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           *IN75     IFEQ '1'                        B002
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     EXSR CLRHED
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
      *                                                                   048377
      * Call CL program to allocate dataarea                              048377
      *                                                                   048377
     C                     MOVE *BLANKS   @RTCDE                          048377
     C                     MOVE 'FT'      @MODLE                          048377
     C                     MOVE PREF      @TREF                           048377
     C                     MOVE *BLANKS   @RTINF                          048377
     C                     CALL 'AOC8000'                                 048377
     C                     PARM           @RTCDE                          048377
     C                     PARM           @MODLE                          048377
     C                     PARM           @TREF                           048377
     C                     PARM           @RTINF                          048377
      *                                                                   048377
     C                     Z-ADD1         NUMU    10
     C*
     C**  UPDATE TRAILER FOR INSERT
     C*
     C                     Z-ADDTOCL      TRLAMT 130
     C                     EXSR TRLDAD
     C                     END                             E002
      *
     C                     END                             E001
      *
      *          *************************************
     C*
     C**  DELETE PROCESSING
     C*
     C           *IN04     IFEQ '1'                        B001
     C           SACTD     ANDEQ'D'
     C           CQCHNK    CHAINCQCODDDF             75
      *                                                                   056031
      *  Generate Shadow Postings for Delete Debit Instructions           056031
      *  (reverse posting)                                                056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     Z-SUBTOCL      ##DRAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVADR  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADDR                                    056031
     C                     END                                            056031
      *
      * Record not found
      *
     C           *IN75     IFEQ '1'                        B002
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE
     C                     Z-ADD8         DBASE            ************
     C                     MOVE CQCHN     DBKEY            * DBERR 08 *
     C                     OUT  DLDA                       ************
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E002
      *
     C           SDTIM     IFNE DTIME                      B002
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C                     EXSR CLRHED
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
     C*
     C**  UPDATE HEADER RECORD AND TRAILER
     C*
     C                     MOVE 'C'       RECI
     C                     TIME           LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     MOVE 'D'       CHTP
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C                     Z-ADDSLDT      DSLDT
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR1 10
     C*
     C                     UPDATCQCODDDF               75
      *                                                                   056031
      *  Update database with changes if record found                     056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     EXSR SRUPD                                     056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B003
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVE 'UPDATE F'ERMSG1           ************
     C                     MOVE 'AILED   'ERMSG2
     C                     MOVELERRMSG    DBKEY
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E003
      *
     C                     END                             E002
      *
     C                     END                             E001
      *
      *          *************************************
     C*
     C**  AMEND PROCESSING
     C*
     C           SACTD     IFEQ 'A'                        B001
      *
     C           CQCHNK    CHAINCQCODDDF             75
      *                                                                   056031
      *  Generate Shadow Postings for Amend Debit Instructions            056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     Z-SUBTOCL      ##DRAM                          056031
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVADR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADDR                                    056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0070C138
      *
     C           *IN75     IFEQ '1'                        B002
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     MOVELCQCHN     DBKEY            ************
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E002
      *
     C           SDTIM     IFNE DTIME                      B002
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C                     EXSR CLRHED
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
     C*
     C* SAVE OLD DETAILS
     C*
     C                     EXSR OLDH
     C*
     C**  UPDATE HEADER RECORD AND TRAILER FOR AMEND
     C*
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C           AUIN      IFEQ 'Y'                                                         AR804457
     C           AUIN      OREQ 'R'                                                         AR804457
     C                     MOVE 'R'       AUIN                                              AR804457
     C                     ELSE                                                             AR804457
     C                     MOVE *BLANKS   AUIN
     C                     ENDIF                                                            AR804457
     C                     TIME           LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     MOVE 'A'       CHTP
     C                     MOVE LCHT      TIMEXH
     C                     Z-ADDLCHT      TIMEH
     C                     EXSR HRSTR
     C                     Z-ADDSLDT      DSLDT                 E110
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR1 10
     C*
      ** Perform compliance watch processing before updating record                           CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y' - AMEND HEADER                                                         CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQCOCDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KCWHTL    CHAINSDCWHTL1             76                                       CSD015
      *                                                                                       CSD015
     C           *IN76     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed Flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck.                                                   CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party                                                                         CSD015
      *                                                                                       CSD015
     C***********CRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           CRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELCRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELCRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives                                                                           CSD015
      *                                                                                       CSD015
     C           NAR1      IFNE *BLANKS                                                       CSD015
     C           NAR2      ORNE *BLANKS                                                       CSD015
     C           NAR3      ORNE *BLANKS                                                       CSD015
     C           NAR4      ORNE *BLANKS                                                       CSD015
     C           NAR5      ORNE *BLANKS                                                       CSD015
     C           NAR6      ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELNAR1      PINP1                                               CSD015
     C                     MOVELNAR2      PINP2                                               CSD015
     C                     MOVELNAR3      PINP3                                               CSD015
     C                     MOVELNAR4      PINP4                                               CSD015
     C                     MOVELNAR5      PINP5                                               CSD015
     C                     MOVELNAR6      PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank                                                                      CSD015
      *                                                                                       CSD015
     C           COB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD4         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent                                                               CSD015
      *                                                                                       CSD015
     C***********RCCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           RCCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     Z-ADD2         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQCOCDL1                                                      CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C           *IN76     DOWEQ*OFF                                                          CSD015
     C           WCCQSQ    ANDNECQSQ                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party from other credit details                                               CSD015
      *                                                                                       CSD015
     C***********WCCRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCCRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCCRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCCRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCCRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCCRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives from other credit details                                                 CSD015
      *                                                                                       CSD015
     C           WCNAR1    IFNE *BLANKS                                                       CSD015
     C           WCNAR2    ORNE *BLANKS                                                       CSD015
     C           WCNAR3    ORNE *BLANKS                                                       CSD015
     C           WCNAR4    ORNE *BLANKS                                                       CSD015
     C           WCNAR5    ORNE *BLANKS                                                       CSD015
     C           WCNAR6    ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELWCNAR1    PINP1                                               CSD015
     C                     MOVELWCNAR2    PINP2                                               CSD015
     C                     MOVELWCNAR3    PINP3                                               CSD015
     C                     MOVELWCNAR4    PINP4                                               CSD015
     C                     MOVELWCNAR5    PINP5                                               CSD015
     C                     MOVELWCNAR6    PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Only check those amended watch list fields                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank                                                                      CSD015
      *                                                                                       CSD015
     C           COB1      IFNE OCOB1                                                         CSD015
     C           COB1      ANDNE*BLANKS                                                       CSD015
     C           COB2      ORNE OCOB2                                                         CSD015
     C           COB2      ANDNE*BLANKS                                                       CSD015
     C           COB3      ORNE OCOB3                                                         CSD015
     C           COB3      ANDNE*BLANKS                                                       CSD015
     C           COB4      ORNE OCOB4                                                         CSD015
     C           COB4      ANDNE*BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD4         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent                                                               CSD015
      *                                                                                       CSD015
     C           RCCO      IFNE ORCCO                                                         CSD015
     C***********RCCO      ANDNE*ZEROS                                                 CSD015 CSD027
     C           RCCO      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     Z-ADD2         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     UPDATCQCODDDF               75
      *                                                                   056031
      *  Generate Shadow Postings for Amend Debit Instructions            056031
      *  (post new value posting)                                         056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     Z-ADDTOCL      ##DRAM                          056031
     C                     EXSR SRADDR                                    056031
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B003
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     MOVE 'UPDATE F'ERMSG1           ************
     C                     MOVE 'AILED   'ERMSG2
     C                     MOVELERRMSG    DBKEY
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E003
      *
      *          *************************************
      *
      *  Update Debit Trailer
      *
     C                     Z-ADD0         NUMU
     C                     Z-ADDOTOCL     TRLAMT
     C                     EXSR TRLDSB
     C                     Z-ADDTOCL      TRLAMT
     C                     EXSR TRLDAD
      *
     C                     END                             E002
     C                     END                             E001
     C*
     C**  UPDATE OTHER FILES
     C*
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C****IF*RETAIL PRESENT                                               056031
     C************                                                        056031
     C************IN31     IFEQ '1'                        B001           056031
     C************         EXSR MEMUP                                     056031
     C************         END                             E001           056031
     C************                                                        056031
     C****IF*DEALING PRESENT                                              056031
     C************                                                        056031
     C************IN30     IFEQ '1'                        B001           056031
     C************         EXSR OLPUP                                     056031
     C************         EXSR PRONUP                                    056031
     C************         END                             E001           056031
     C*
     C           HEADR     COMIT
     C                     MOVE '0'       *IN75                    E109
     C**
     C*    IF AN INSERT PERMIT PREVIOUS PAYMENT REFERENCE FIELDS ON
     C*      NEXT INITIAL SCREEN
     C**
     C           SACTD     IFEQ 'I'                        B001
     C                     MOVE '0'       *IN77
     C                     END                             E001
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *                                                                   056031
      *  Clear stored values                                              056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. UPDAT2 TO UPDATE / OUTPUT DETAIL RECORDS
     C*
     C           UPDAT2    BEGSR
      *                                                                   056031
     C/COPY WNCPYSRC,FT0070C115
      *                                                                                       CER049
      ** If Cheque is liable to Stamp Tax                                                     CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
     C           ACT2      IFEQ 'I'                                                           CER049
     C           ACT2      OREQ 'A'                                                           CER049
      *                                                                                       CER049
      ** Find default stamp Stamp Tax Code                                                    CER049
      *                                                                                       CER049
     C                     MOVE SLDT      U#DATE  50                                          CER049
     C                     MOVE *BLANKS   U#TXTY  1                                           CER049
      *                                                                                       CER049
      ** SD008140 will return the Tax Rate to be used to calculate the                        CER049
      ** Stamp Tax and the Stamp Tax Currency                                                 CER049
      *                                                                                       CER049
     C                     CALL 'SD008140'                                                    CER049
     C                     PARM           U#DATE                                              CER049
     C                     PARM           U#ORGN                                              CER049
     C                     PARM           U#TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY                                              CER049
      *                                                                                       CER049
      ** If there is a default Tax Rate for the module use this,                              CER049
      ** otherwise use the ICD control Tax Rate.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     MOVE U#MCCY    U#SCCY  3                                           CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     MOVE U#CCCY    U#SCCY                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ** Calculate Stamp Tax Rate on Entry CCY amount and File CCY                            CER049
      ** amount using Commission amount.                                                      CER049
      *                                                                                       CER049
     C           SDUMA1    MULT U#TAXR    SDUMA3    H                                         CER049
     C           TRCM      MULT U#TAXR    CSTA      H                                         CER049
      *                                                                                       CER049
      ** Move 'N' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'N'       SVATI3                                              CER049
     C                     MOVE 'N'       SVATI1                                              CER049
      *                                                                                       CER049
      ** Get rid of VAT on Stamp Tax relevant amounts that has been calculated                CER049
      ** earlier in FT0070.                                                                   CER049
      *                                                                                       CER049
     C                     SUB  #SDUMA    SDUMA6                                              CER049
     C                     SUB  #CVATT    CCVATT                                              CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQCOCQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQC'   U#ORGN 10                                           CER049
     C**********           MOVE *BLANKS   U#LNRF  60                                   CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF  6                                           CLE148
     C                     MOVE *BLANKS   U#FCNM  6                                           CER049
     C                     MOVE *BLANKS   U#FACT  30                                          CER049
     C                     MOVE *BLANKS   U#FCNO  20                                          CER049
     C                     MOVE *BLANKS   U#FSEQ  20                                          CER049
     C                     MOVE *BLANKS   U#ORED  50                                          CER049
     C                     MOVE *BLANKS   U#DLNO  60                                          CER049
     C                     MOVE *BLANKS   U#TDRF  6                                           CER049
     C                     MOVE *BLANKS   U#BRCA  3                                           CER049
     C                     MOVE *BLANKS   U#CNUM  6                                           CER049
     C                     MOVE *BLANKS   U#CCY   3                                           CER049
     C                     MOVE *BLANKS   U#ACOD 100                                          CER049
     C                     MOVE *BLANKS   U#ACSQ  20                                          CER049
     C                     MOVE PREF      U#PREF 15                                           CER049
     C                     MOVE SCQSQ     U#CQSQ  20                                          CER049
     C                     MOVE *BLANKS   U#PBRC  3                                           CER049
     C                     MOVE *BLANKS   U#PSSH 10                                           CER049
     C                     MOVE *BLANKS   U#PCPT  6                                           CER049
     C                     MOVE *BLANKS   U#PDUD  50                                          CER049
     C                     MOVE *BLANKS   U#PEVT  2                                           CER049
      *                                                                                       CER049
     C           KLSTAX    KLIST                                                              CER049
     C                     KFLD           U#PREF                                              CER049
     C                     KFLD           U#CQSQ                                              CER049
      *                                                                                       CER049
     C           KLSTXD    KLIST                                                              CER049
     C                     KFLD           U#ORGN                                              CER049
     C                     KFLD           U#TYPE                                              CER049
     C                     KFLD           U#LNRF                                              CER049
     C                     KFLD           U#FCNM                                              CER049
     C                     KFLD           U#FACT                                              CER049
     C                     KFLD           U#FCNO                                              CER049
     C                     KFLD           U#FSEQ                                              CER049
     C                     KFLD           U#ORED                                              CER049
     C                     KFLD           U#DLNO                                              CER049
     C                     KFLD           U#TDRF                                              CER049
     C                     KFLD           U#BRCA                                              CER049
     C                     KFLD           U#CNUM                                              CER049
     C                     KFLD           U#CCY                                               CER049
     C                     KFLD           U#ACOD                                              CER049
     C                     KFLD           U#ACSQ                                              CER049
     C                     KFLD           U#PREF                                              CER049
     C                     KFLD           U#CQSQ                                              CER049
     C                     KFLD           U#PBRC                                              CER049
     C                     KFLD           U#PSSH                                              CER049
     C                     KFLD           U#PCPT                                              CER049
     C                     KFLD           U#PDUD                                              CER049
     C                     KFLD           U#PEVT                                              CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQCOCQL0             80                                       CER049
     C                     MOVE SDUMA3    QCSTAF                                              CER049
     C                     UPDATCQCOCQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'N'                                                           CER049
     C           ACT2      IFEQ 'I'                                                           CER049
     C           ACT2      OREQ 'A'                                                           CER049
      *                                                                                       CER049
     C                     MOVE *ZEROS    SDUMA3                                              CER049
     C                     MOVE *ZEROS    CSTA                                                CER049
      *                                                                                       CER049
      ** Move 'Y' to VAT liable field                                                         CER049
      *                                                                                       CER049
     C                     MOVE 'Y'       SVATI3                                              CER049
     C           SVATI1    IFEQ 'N'                                                           CER049
     C                     SUB  #SDUMA    SDUMA6                                              CER049
     C                     SUB  #CVATT    CCVATT                                              CER049
     C                     END                                                                CER049
      *                                                                                       CER049
      ** Set up fields to CHAIN to CQCOCQL0 and store stamp tax amount                        CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQC'   U#ORGN                                              CER049
     C                     MOVE *BLANKS   U#LNRF                                              CER049
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *BLANKS   U#FACT                                              CER049
     C                     MOVE *BLANKS   U#FCNO                                              CER049
     C                     MOVE *BLANKS   U#FSEQ                                              CER049
     C                     MOVE *BLANKS   U#ORED                                              CER049
     C                     MOVE *BLANKS   U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *BLANKS   U#ACOD                                              CER049
     C                     MOVE *BLANKS   U#ACSQ                                              CER049
     C                     MOVE PREF      U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C                     MOVE *BLANKS   U#PBRC                                              CER049
     C                     MOVE *BLANKS   U#PSSH                                              CER049
     C                     MOVE *BLANKS   U#PCPT                                              CER049
     C                     MOVE *BLANKS   U#PDUD                                              CER049
     C                     MOVE *BLANKS   U#PEVT                                              CER049
      *                                                                                       CER049
     C           KLSTAX    CHAINCQCOCQL0             80                                       CER049
     C                     MOVE *ZEROS    QCSTAF                                              CER049
     C                     UPDATCQCOCQD0                                                      CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#STAX    IFEQ 'Y'                                                           CER049
     C           U#STAX    OREQ 'N'                                                           CER049
      *                                                                                       CER049
     C           KLSTXD    CHAINSDSTMDL0             85                                       CER049
     C           *IN85     IFEQ *OFF                                                          CER049
     C                     MOVEL'CHEQC'   T2KEY                                               CER049
     C                     MOVE QCPREF    T2PREF                                              CER049
     C                     MOVE QCCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QCTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE SMCY      T2ECCY                                              CER049
     C                     MOVE QCSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'A'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
     C                     UPDAT@STMDV0                                                       CER049
     C                     ELSE                                                               CER049
     C                     MOVEL'CHEQC'   T2KEY                                               CER049
     C                     MOVE QCPREF    T2PREF                                              CER049
     C                     MOVE QCCQSQ    T2CQSQ                                              CER049
     C                     MOVE 'T'       T2RCTP                                              CER049
     C                     MOVE QCTAX     T2TCAL                                              CER049
     C                     MOVE U#TAXR    T2TXRT                                              CER049
     C                     MOVE U#SCCY    T2SCCY                                              CER049
     C                     MOVE SMCY      T2ECCY                                              CER049
     C                     MOVE QCSTAF    T2TATC                                              CER049
     C                     MOVE 'Y'       T2STFC                                              CER049
     C                     MOVE 'I'       T2TYLC                                              CER049
     C                     MOVE BJRDNB    T2LCD                                               CER049
     C                     MOVE *BLANKS   T2TYPE                                              CER049
      *                                                                                       CER049
      ** Set debit account                                                                    CER049
      *                                                                                       CER049
     C                     MOVE *BLANKS   T2DBRC                                              CER049
     C                     MOVE *BLANKS   T2DCST                                              CER049
     C                     MOVE *BLANKS   T2DCCY                                              CER049
     C                     MOVE *BLANKS   T2DACD                                              CER049
     C                     MOVE *BLANKS   T2DASQ                                              CER049
     C                     CLEART2TXRB                                                        CER049
     C                     WRITE@STMDV0                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'UPDAT2'  @STK,Q                          056031
      *                                                                   056031
      *  Clear stored posting values                                      056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
      *                                                                   056031
     C                     SETOF                     75
     C                     MOVE SMCY      HDCCY   3
      *
     C           ACT2      IFEQ 'I'                        B001
     C*********************Z-ADDRUND      OEDT                            S01194
     C                     Z-ADDBJRDNB    OEDT                            S01194
     C                     END                             E001
      *
     C           ACT2      IFNE 'D'
     C                     EXSR DDAF
     C                     END
      *
     C/COPY WNCPYSRC,FT0070C072
     C                     EXSR DSTR
     C                     MOVE ACT2      ACTDH
     C                     MOVE SMDIN     MDIN
     C                     MOVE SCQSQ     CQSQ
      *
      *          *************************************
     C*
     C**  INSERT PROCESSING
     C*
     C           ACT2      IFEQ 'I'                        B001
     C                     TIME           LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     EXSR HEDUP
     C                     MOVE 'I'       CHTP
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     MOVE *BLANKS   IACG
     C                     MOVE *BLANKS   CRAG
     C                     MOVE *BLANKS   SACG
     C                     MOVE *BLANKS   CRMG
     C                     MOVE *BLANKS   ADIN
     C                     Z-ADDCRVD      CCRVD   50
     C                     MOVE CRCY      NDTCCY  3
     C                     Z-ADDSDUMA1    DUMA1
     C                     Z-ADDSDUMA2    DUMA2
     C                     Z-ADDSDUMA3    DUMA3
     C                     Z-ADDSDUMA4    DUMA4
     C                     Z-ADDSDUMA5    CCDUM5                          S01494
     C                     Z-ADDSDUMA6    CCDUM6                          S01499
     C*                                                                   S01499
     C                     MOVE SVATI1    CCVAT1                          S01499
     C                     MOVE SVATI2    CCVAT2                          S01499
     C                     MOVE SVATI3    CCVAT3                          S01499
     C                     MOVE SVATI4    CCVAT4                          S01499
     C                     MOVE SVATI5    CCVAT5                          S01499
     C           CCVATT    IFNE 0                                         S01499
     C           CCDUM6    ORNE 0                                         S01499
     C                     Z-ADDO#VATR    CCVATR                          S01499
     C                     ELSE                                           S01499
     C                     Z-ADD0         CCVATR                          S01499
     C                     END                                            S01499
     C/COPY WNCPYSRC,FT0070C009
     C*
     C* RESET MDIN INDICATOR (IS OVERWRITTEN IN HEDUP SRON INSERT)
     C*
     C                     MOVE SMDIN     MDIN
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR2 10
     C*
     C**CALL*WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S     S01241058194
     C**FT0070DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF   S01241058194
     C**CORE*PGM*(FT0070) AND RETURN CODE (7A, BUT BLANK HERE).     S01241058194
     C***********BGL5ST****IFEQ 'Y'                           S01241S01251058194
      ***********                                                         058194
     C***********BGWDPR    IFEQ 'Y'                                 S01251058194
      ***********                                                         058194
      *****/copy*to move data into the data structure fields passed S01241058194
      ******as*a*parameter to the window controller                 S01241058194
      */COPY*QWINDSRC,FT0070MOV3                                          058194
      ***********                                                   S01241058194
     C***********          MOVE SACTD     #ACTN                     S01241058194
     C***********          MOVE *BLANKS   RTNCDE                    S01241058194
     C***********          MOVE *BLANKS   ##CMD                     S01241058194
     C***********          MOVEL'FT0070'  ##PGM                     S01241058194
     C***********          CALL 'WN0010'                            S01241058194
     C***********          PARM           ##PGM                     S01241058194
     C***********          PARM           ##CMD                     S01241058194
     C***********          PARM           #ACTN                     S01241058194
     C***********          PARM           DATA                      S01241058194
     C*********************PARM           RTNCDE              S01241S01252058194
     C***********          PARM *BLANKS   RTNCDE                    S01252058194
     C***********          PARM           SPARE 256                 S01252058194
     C***********          END                                      S01241058194
     C***********                                                   S01241058194
     C***********RTNCDE    IFEQ *BLANKS                             S01241058194
     C***********BGL5ST****ORNE 'Y'                           S01241S01251058194
     C***********BGWDPR    ORNE 'Y'                                 S01251058194
      *                                                                   CAC001
      **  Store margin info work fields to corresponding database flds    CAC001
      *                                                                   CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     Z-ADDWOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
      *                                                                                       CSD015
      ** Perform compliance watch processing before writing new record                        CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y' - INSERT DETAIL                                                        CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQCOCDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KCWHTL    CHAINSDCWHTL1             76                                       CSD015
      *                                                                                       CSD015
     C           *IN76     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck                                                    CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party                                                                         CSD015
      *                                                                                       CSD015
     C***********CRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           CRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELCRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELCRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives                                                                           CSD015
      *                                                                                       CSD015
     C           NAR1      IFNE *BLANKS                                                       CSD015
     C           NAR2      ORNE *BLANKS                                                       CSD015
     C           NAR3      ORNE *BLANKS                                                       CSD015
     C           NAR4      ORNE *BLANKS                                                       CSD015
     C           NAR5      ORNE *BLANKS                                                       CSD015
     C           NAR6      ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELNAR1      PINP1                                               CSD015
     C                     MOVELNAR2      PINP2                                               CSD015
     C                     MOVELNAR3      PINP3                                               CSD015
     C                     MOVELNAR4      PINP4                                               CSD015
     C                     MOVELNAR5      PINP5                                               CSD015
     C                     MOVELNAR6      PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank                                                                      CSD015
      *                                                                                       CSD015
     C           COB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD4         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent                                                               CSD015
      *                                                                                       CSD015
     C***********RCCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           RCCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     Z-ADD2         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQCOCDL1                                                      CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C           *IN76     DOWEQ*OFF                                                          CSD015
     C           WCCQSQ    ANDNECQSQ                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party from other credit details                                               CSD015
      *                                                                                       CSD015
     C***********WCCRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCCRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCCRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCCRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCCRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCCRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Other Narratives                                                                     CSD015
      *                                                                                       CSD015
     C           WCNAR1    IFNE *BLANKS                                                       CSD015
     C           WCNAR2    ORNE *BLANKS                                                       CSD015
     C           WCNAR3    ORNE *BLANKS                                                       CSD015
     C           WCNAR4    ORNE *BLANKS                                                       CSD015
     C           WCNAR5    ORNE *BLANKS                                                       CSD015
     C           WCNAR6    ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELWCNAR1    PINP1                                               CSD015
     C                     MOVELWCNAR2    PINP2                                               CSD015
     C                     MOVELWCNAR3    PINP3                                               CSD015
     C                     MOVELWCNAR4    PINP4                                               CSD015
     C                     MOVELWCNAR5    PINP5                                               CSD015
     C                     MOVELWCNAR6    PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Else only check amended watch list fields                                            CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank (for counter party details only)                                     CSD015
      *                                                                                       CSD015
     C           COB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent (for counter party details only)                              CSD015
      *                                                                                       CSD015
     C           RCCO      IFNE ORCCO                                                         CSD015
     C***********RCCO      ANDNE*ZEROS                                                 CSD015 CSD027
     C           RCCO      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Credit Party (for second parameter)                                                  CSD015
      *                                                                                       CSD015
     C***********CRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           CRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELCRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELCRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives (for second parameter)                                                    CSD015
      *                                                                                       CSD015
     C           NAR1      IFNE *BLANKS                                                       CSD015
     C           NAR2      ORNE *BLANKS                                                       CSD015
     C           NAR3      ORNE *BLANKS                                                       CSD015
     C           NAR4      ORNE *BLANKS                                                       CSD015
     C           NAR5      ORNE *BLANKS                                                       CSD015
     C           NAR6      ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELNAR1      PINP1                                               CSD015
     C                     MOVELNAR2      PINP2                                               CSD015
     C                     MOVELNAR3      PINP3                                               CSD015
     C                     MOVELNAR4      PINP4                                               CSD015
     C                     MOVELNAR5      PINP5                                               CSD015
     C                     MOVELNAR6      PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C*
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     Z-ADDSEREFR    CCRRAT                          CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
     C*                                                                   CDL049
     C                     MOVE 'D'       RECI                                              AR920572
     C                     WRITECQCOCDDF               75
      *                                                                   056031
      * If record found                                                   056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
      ************************************************************ 056031 159283
      **Calculate*Credit*currency*equivalent********************** 056031 159283
      ************************************************************ 056031 159283
     C***********          EXSR SRCREQ                             056031 159283
      *                                                                   056031
      *  Generate Shadow Postings for Insert Credit Instructions          056031
      *                                                                   056031
     C**********           Z-SUBD#TAMT    ##CRAM                                       056031 159283
     C                     Z-SUBCCYAM     ##CRAM                                              159283
     C/COPY WNCPYSRC,FT0070C130
     C                     EXSR SRADCR                                    056031
     C*                                                                   095270
     C* Calculate charge amount (always debit)                            095270
     C*                                                                   095270
     C           TRCM      ADD  COLL      ##CHGS                          095270
     C                     ADD  CSTA      ##CHGS                          095270
     C                     ADD  TXCH      ##CHGS                          095270
     C/COPY WNCPYSRC,FT0070C079
      *                                                                   095270
     C           ##CHGS    IFNE 0                                         095270
     C/COPY WNCPYSRC,FT0070C131
     C                     EXSR SRSCHG                                    095270
     C                     END                                            095270
      *                                                                   056031
      *  Update database with changes                                     056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B002
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     EXSR CLSCRN
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
     C                     Z-ADD1         NUMU    10
     C*
     C**  UPDATE TRAILER FOR INSERT
     C*
     C                     Z-ADDCQAM      TRLAMT 130
     C                     EXSR TRLCAD
     C                     END                             E002
      *
     C***********          END                             E002     S01241058194
      *
     C                     END                             E001
      *
      *          *************************************
     C*
     C**  DELETE PROCESSING
     C*
     C           *IN04     IFEQ '1'                        B001
     C           ACT2      ANDEQ'D'
     C*
     C**  UPDATE HEADER RECORD
     C*
     C                     TIME           LCHT
     C                     Z-ADDLCHT      LCHTXX
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     EXSR HEDUP
      *
     C                     Z-ADDCQSQ      CQSQK
     C           CQCHNK    CHAINCQCOCDDF             75
      *                                                                   056031
      * If record found                                                   056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
      ************************************************************ 056031 159283
      **Calculate*Credit*currency*equivalent********************** 056031 159283
      ************************************************************ 056031 159283
     C***********          EXSR SRCREQ                             056031 159283
      *                                                                   056031
      *  Generate Shadow Postings for Delete Credit Instructions          056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C**********           Z-ADDD#TAMT    ##CRAM                                       056031 159283
     C                     Z-ADDCCYAM     ##CRAM                                              159283
     C/COPY WNCPYSRC,FT0070C132
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACR  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCR                                    056031
     C*                                                                   095270
     C* Calculate charge amount (always debit)                            095270
     C* Posting to reverse the previous posting charges                   095270
     C*                                                                   095270
     C           TRCM      ADD  COLL      ##CHGS                          095270
     C                     ADD  CSTA      ##CHGS                          095270
     C                     ADD  TXCH      ##CHGS                          095270
     C/COPY WNCPYSRC,FT0070C080
     C*                                                                   095270
     C           ##CHGS    IFNE 0                                         095270
     C/COPY WNCPYSRC,FT0070C133
     C                     Z-SUB##CHGS    ##CHGS                          095270
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACH  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRSCHG                                    095270
     C                     END                                            095270
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B002
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD12        DBASE            * DBERR 12 *
     C                     MOVELCQCHN     DBKEY            ************
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E002
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           SDTIM     IFNE DTIME                      B002
     C                     EXSR CLSCRN
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
     C*
     C**  UPDATE RECORD
     C*
     C**CALL*WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S     S01241058194
     C**FT0070DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF   S01241058194
     C**CORE*PGM*(FT0070) AND RETURN CODE (7A, BUT BLANK HERE).     S01241058194
      ***********                                                         058194
     C***********BGL5ST****IFEQ 'Y'                           S01241S01251058194
      ***********                                                         058194
     C***********BGWDPR    IFEQ 'Y'                                 S01251058194
      ***********                                                         058194
      *****/copy*to move data into the data structure fields passed S01241058194
      ******as*a*parameter to the window controller                 S01241058194
      ***********                                                         058194
      */COPY*QWINDSRC,FT0070MOV4                                          058194
      ***********                                                   S01241058194
     C***********          MOVE SACTD     #ACTN                     S01241058194
     C***********          MOVE *BLANKS   RTNCDE                    S01241058194
     C***********          MOVE *BLANKS   ##CMD                     S01241058194
     C***********          MOVEL'FT0070'  ##PGM                     S01241058194
     C***********          CALL 'WN0010'                            S01241058194
     C***********          PARM           ##PGM                     S01241058194
     C***********          PARM           ##CMD                     S01241058194
     C***********          PARM           #ACTN                     S01241058194
     C***********          PARM           DATA                      S01241058194
     C*********************PARM           RTNCDE              S01241S01252058194
     C***********          PARM *BLANKS   RTNCDE                    S01252058194
     C***********          PARM           SPARE 256                 S01252058194
     C***********          END                                      S01241058194
     C***********                                                   S01241058194
     C***********RTNCDE    IFEQ *BLANKS                             S01241058194
     C***********BGL5ST****ORNE 'Y'                           S01241S01251058194
     C***********BGWDPR    ORNE 'Y'                                 S01251058194
     C***********                                                   S01241058194
     C                     Z-ADDLCHTXX    LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     MOVE 'C'       RECI
     C                     MOVE 'D'       CHTP
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     Z-ADDCRVD      CCRVD
     C                     MOVE CRCY      NDTCCY
     C                     Z-ADDSDUMA1    DUMA1
     C                     Z-ADDSDUMA2    DUMA2
     C                     Z-ADDSDUMA3    DUMA3
     C                     Z-ADDSDUMA4    DUMA4
     C                     Z-ADDSDUMA5    CCDUM5                          S01494
     C                     Z-ADDSDUMA6    CCDUM6                          S01499
     C*                                                                   S01499
     C                     MOVE SVATI1    CCVAT1                          S01499
     C                     MOVE SVATI2    CCVAT2                          S01499
     C                     MOVE SVATI3    CCVAT3                          S01499
     C                     MOVE SVATI4    CCVAT4                          S01499
     C                     MOVE SVATI5    CCVAT5                          S01499
     C           CCVATT    IFNE 0                                         S01499
     C           CCDUM6    ORNE 0                                         S01499
     C                     Z-ADDO#VATR    CCVATR                          S01499
     C                     ELSE                                           S01499
     C                     Z-ADD0         CCVATR                          S01499
     C                     END                                            S01499
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR2 10
     C*
     C/COPY WNCPYSRC,FT0070C011
     C                     UPDATCQCOCDDF               75
      *                                                                   056031
      *  Update posting database changes                                  056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
     C                     EXSR SRUPD                                     056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B003
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD13        DBASE            * DBERR 13 *
     C                     MOVE 'UPDATE F'ERMSG1           ************
     C                     MOVE 'AILED   'ERMSG2
     C                     MOVELERRMSG    DBKEY
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E003
      *
     C***********          END                             E002           058194
      *
     C                     END                             E001
      *
     C                     END                                            S01241
      *
      *          *************************************
     C/COPY WNCPYSRC,FT0070C047
     C*
     C**  AMEND PROCESSING
     C*
     C           ACT2      IFEQ 'A'                        B001
     C*
     C**  UPDATE HEADER RECORD
     C*
     C                     TIME           LCHT
     C                     Z-ADDLCHT      LCHTXX  60
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     EXSR HEDUP
     C                     Z-ADDCQSQ      CQSQK
     C           CQCHNK    CHAINCQCOCDDF             75
      *                                                                   056031
      * If record found                                                   056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
      ************************************************************ 056031 159283
      **Calculate*Credit*currency*equivalent********************** 056031 159283
      ************************************************************ 056031 159283
     C***********          EXSR SRCREQ                             056031 159283
      *                                                                   056031
      *  Generate Shadow Postings for Amend Credit Instructions           056031
      *  (reverse original posting)                                       056031
      *                                                                   056031
     C**********           Z-ADDD#TAMT    ##CRAM                                       056031 159283
     C                     Z-ADDCCYAM     ##CRAM                                              159283
     C/COPY WNCPYSRC,FT0070C134
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACR                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRADCR                                    056031
     C*                                                                   095270
     C* Calculate charge amount (always debit)                            095270
     C* Posting to reverse the previous posting charges                   095270
     C*                                                                   095270
     C           TRCM      ADD  COLL      ##CHGS                          095270
     C                     ADD  CSTA      ##CHGS                          095270
     C                     ADD  TXCH      ##CHGS                          095270
     C/COPY WNCPYSRC,FT0070C081
     C*                                                                   095270
     C           ##CHGS    IFNE 0                                         095270
     C/COPY WNCPYSRC,FT0070C135
     C                     Z-SUB##CHGS    ##CHGS                          095270
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVE 'Y'       WRVACH                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     EXSR SRSCHG                                    095270
     C                     END                                            095270
     C/COPY WNCPYSRC,FT0070C139
      *                                                                   056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B002
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD14        DBASE            * DBERR 14 *
     C                     MOVELCQCHN     DBKEY            ************
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E002
     C*
     C**  RECORD UPDATED BY ANOTHER WORKSTATION
     C*
     C           SDTIM     IFNE DTIME                      B002
     C                     EXSR CLSCRN
     C                     SETON                     678912
     C                     MOVE *BLANK    @RETC
     C                     ADD  1         S
     C*********************MOVE ' 068'    ERCD,S                          S01117
     C                     MOVE ' 001'    ERCD,S                          S01117
     C                     ROLBK
     C                     ELSE                            X002
     C*
     C* SAVE OLD DETAILS
     C*
     C                     EXSR OLDD
      *                                                                                       CSD015
      ** Save old narratives to check for change in watch list fields.                        CSD015
      ** Other needed fields have already been saved in SR OLDD above.                        CSD015
      *                                                                                       CSD015
     C                     MOVELNAR1      ONAR1  35                                           CSD015
     C                     MOVELNAR2      ONAR2  35                                           CSD015
     C                     MOVELNAR3      ONAR3  35                                           CSD015
     C                     MOVELNAR4      ONAR4  35                                           CSD015
     C                     MOVELNAR5      ONAR5  35                                           CSD015
     C                     MOVELNAR6      ONAR6  35                                           CSD015
     C*
     C**  UPDATE DETAIL RECORD AND TRAILER FOR AMEND
     C*
     C**CALL*WINDOW PROGRAM USING THE PARAMETERS DEFINED IN D/S     S01241058194
     C**FT0070DTA (/COPY STATEMENT IN 'I' SPEC). ALSO THE NAME OF   S01241058194
     C**CORE*PGM*(FT0070) AND RETURN CODE (7A, BUT BLANK HERE).     S01241058194
      ***********                                                         058194
     C***********BGL5ST****IFEQ 'Y'                           S01241S01251058194
     C***********BGWDPR    IFEQ 'Y'                                 S01251058194
      ***********                                                         058194
      *****/copy*to move data into the data structure fields passed S01241058194
      ******as*a*parameter to the window controller                 S01241058194
      */COPY*QWINDSRC,FT0070MOV5                                          058194
      ***********                                                   S01241058194
     C***********          MOVE SACTD     #ACTN                     S01241058194
     C***********          MOVE *BLANKS   RTNCDE                    S01241058194
     C***********          MOVE *BLANKS   ##CMD                     S01241058194
     C***********          MOVEL'FT0070'  ##PGM                     S01241058194
     C***********          CALL 'WN0010'                            S01241058194
     C***********          PARM           ##PGM                     S01241058194
     C***********          PARM           ##CMD                     S01241058194
     C***********          PARM           #ACTN                     S01241058194
     C***********          PARM           DATA                      S01241058194
     C*********************PARM           RTNCDE              S01241S01252058194
     C***********          PARM *BLANKS   RTNCDE                    S01252058194
     C***********          PARM           SPARE 256                 S01252058194
     C***********          END                                      S01241058194
     C***********                                                   S01241058194
     C***********RTNCDE    IFEQ *BLANKS                             S01241058194
     C***********BGL5ST****ORNE 'Y'                           S01241S01251058194
     C***********BGWDPR    ORNE 'Y'                                 S01251058194
     C                     Z-ADDLCHTXX    LCHT
     C*********************Z-ADDRUND      CQLCD                           S01194
     C                     Z-ADDBJRDNB    CQLCD                           S01194
     C                     MOVE 'A'       CHTP
     C                     MOVE LCHT      TIMEXD
     C                     Z-ADDLCHT      TIMED
     C                     EXSR DRSTR
     C                     Z-ADDCRVD      CCRVD
     C                     MOVE CRCY      NDTCCY
     C                     Z-ADDSDUMA1    DUMA1
     C                     Z-ADDSDUMA2    DUMA2
     C                     Z-ADDSDUMA3    DUMA3
     C                     Z-ADDSDUMA4    DUMA4
     C                     Z-ADDSDUMA5    CCDUM5                          S01494
     C                     Z-ADDSDUMA6    CCDUM6                          S01499
     C*                                                                   S01499
     C                     MOVE SVATI1    CCVAT1                          S01499
     C                     MOVE SVATI2    CCVAT2                          S01499
     C                     MOVE SVATI3    CCVAT3                          S01499
     C                     MOVE SVATI4    CCVAT4                          S01499
     C                     MOVE SVATI5    CCVAT5                          S01499
     C           CCVATT    IFNE 0                                         S01499
     C           CCDUM6    ORNE 0                                         S01499
     C                     Z-ADDO#VATR    CCVATR                          S01499
     C                     ELSE                                           S01499
     C                     Z-ADD0         CCVATR                          S01499
     C                     END                                            S01499
     C*
     C** SET UP VALUE OF INPUT USER FOR LATER AUTHORISATION CHECK
     C*
     C                     MOVE USRID     INUSR2 10
      *                                                                   CAC001
      **  Store margin info work fields to corresponding database flds    CAC001
      *                                                                   CAC001
     C                     Z-ADDWOFXMP    FXMP                            CAC001
     C                     Z-ADDWOFXMD    FXMD                            CAC001
     C                     MOVE WOMBSI    MBSI                            CAC001
     C                     MOVE WOMSIG    MSIG                            CAC001
     C                     Z-ADDWOMAMT    MAMT                            CAC001
     C*
      ** Perform compliance watch processing before updating record                           CSD015
      ** if compliance watch is installed and entry watch list checking                       CSD015
      ** is set to 'Y' - AMEND DETAIL                                                         CSD015
      *                                                                                       CSD015
     C           CSD015    IFEQ 'Y'                                                           CSD015
     C           W1EWLC    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
     C           CSC011    IFNE 'Y'                                                           CSD015
     C           LIBR      OREQ S1MAIN                                                        CSD015
      *                                                                                       CSD015
      ** Determine if transaction has Unconfirmed Flag = 'Y'                                  CSD015
      *                                                                                       CSD015
     C                     MOVEL'CQCOCDD' KFUNCC                                              CSD015
     C                     MOVELPREF      KIDENT                                              CSD015
     C                     MOVELBRCA      KBRNCH                                              CSD015
      *                                                                                       CSD015
     C           KCWHTL    CHAINSDCWHTL1             76                                       CSD015
      *                                                                                       CSD015
     C           *IN76     IFEQ *OFF                                                          CSD015
     C           W3UNCF    ANDEQ'Y'                                                           CSD015
      *                                                                                       CSD015
      ** If transaction has Unconfirmed Flag = 'Y', include                                   CSD015
      ** all watch list fields for recheck                                                    CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party                                                                         CSD015
      *                                                                                       CSD015
     C***********CRPY      IFNE *ZEROS                                                 CSD015 CSD027
     C           CRPY      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELCRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELCRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives                                                                           CSD015
      *                                                                                       CSD015
     C           NAR1      IFNE *BLANKS                                                       CSD015
     C           NAR2      ORNE *BLANKS                                                       CSD015
     C           NAR3      ORNE *BLANKS                                                       CSD015
     C           NAR4      ORNE *BLANKS                                                       CSD015
     C           NAR5      ORNE *BLANKS                                                       CSD015
     C           NAR6      ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELNAR1      PINP1                                               CSD015
     C                     MOVELNAR2      PINP2                                               CSD015
     C                     MOVELNAR3      PINP3                                               CSD015
     C                     MOVELNAR4      PINP4                                               CSD015
     C                     MOVELNAR5      PINP5                                               CSD015
     C                     MOVELNAR6      PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank                                                                      CSD015
      *                                                                                       CSD015
     C           COB1      IFNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     Z-ADD4         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent                                                               CSD015
      *                                                                                       CSD015
     C***********RCCO      IFNE *ZEROS                                                 CSD015 CSD027
     C           RCCO      IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     Z-ADD2         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Include checking of previously inserted detail transactions                          CSD015
      *                                                                                       CSD015
     C           PREF      SETLLCQCOCDL1                                                      CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C           *IN76     DOWEQ*OFF                                                          CSD015
     C           WCCQSQ    ANDNECQSQ                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Credit Party from other credit details                                               CSD015
      *                                                                                       CSD015
     C***********WCCRPY    IFNE *ZEROS                                                 CSD015 CSD027
     C           WCCRPY    IFNE *BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           WCCRPT    IFEQ 'N'                                                           CSD015
     C                     MOVELWCCRPY    FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWCCRPY    PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELWCCRCY    PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narratives from other credit details                                                 CSD015
      *                                                                                       CSD015
     C           WCNAR1    IFNE *BLANKS                                                       CSD015
     C           WCNAR2    ORNE *BLANKS                                                       CSD015
     C           WCNAR3    ORNE *BLANKS                                                       CSD015
     C           WCNAR4    ORNE *BLANKS                                                       CSD015
     C           WCNAR5    ORNE *BLANKS                                                       CSD015
     C           WCNAR6    ORNE *BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELWCNAR1    PINP1                                               CSD015
     C                     MOVELWCNAR2    PINP2                                               CSD015
     C                     MOVELWCNAR3    PINP3                                               CSD015
     C                     MOVELWCNAR4    PINP4                                               CSD015
     C                     MOVELWCNAR5    PINP5                                               CSD015
     C                     MOVELWCNAR6    PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PREF      READECQCOCDL1                 76                                   CSD015
     C                     ENDDO                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
      ** Only check those amended watch list fields                                           CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   POUT1                                               CSD015
     C                     MOVE *BLANKS   POUT2                                               CSD015
     C                     MOVE *BLANKS   PSTRNG                                              CSD015
      *                                                                                       CSD015
      ** Collecting Bank (for counter party details only)                                     CSD015
      *                                                                                       CSD015
     C           COB1      IFNE OCOB1                                                         CSD015
     C           COB1      ANDNE*BLANKS                                                       CSD015
     C           COB2      ORNE OCOB2                                                         CSD015
     C           COB2      ANDNE*BLANKS                                                       CSD015
     C           COB3      ORNE OCOB3                                                         CSD015
     C           COB3      ANDNE*BLANKS                                                       CSD015
     C           COB4      ORNE OCOB4                                                         CSD015
     C           COB4      ANDNE*BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELCOB1      PINP1                                               CSD015
     C                     MOVELCOB2      PINP2                                               CSD015
     C                     MOVELCOB3      PINP3                                               CSD015
     C                     MOVELCOB4      PINP4                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C           POUT2     IFEQ '*FREE'                                                       CSD015
     C           POUT2     OREQ '*CPART'                                                      CSD015
     C                     MOVEL'Y'       WCBFF                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVEL'N'       WCBFF                                               CSD015
     C                     MOVELPOUT2     WCBCP                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Receiver Correspondent (for counter party details only)                              CSD015
      *                                                                                       CSD015
     C           RCCO      IFNE ORCCO                                                         CSD015
     C***********RCCO      ANDNE*ZEROS                                                 CSD015 CSD027
     C           RCCO      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           RCRT      IFEQ 'N'                                                           CSD015
     C                     MOVELRCCO      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELRCCO      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELSMCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     MOVELPOUT2     WRCCP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Narrative (for second parameter)                                                     CSD015
      *                                                                                       CSD015
     C           NAR1      IFNE ONAR1                                                         CSD015
     C           NAR1      ANDNE*BLANKS                                                       CSD015
     C           NAR2      ORNE ONAR2                                                         CSD015
     C           NAR2      ANDNE*BLANKS                                                       CSD015
     C           NAR3      ORNE ONAR3                                                         CSD015
     C           NAR3      ANDNE*BLANKS                                                       CSD015
     C           NAR4      ORNE ONAR4                                                         CSD015
     C           NAR4      ANDNE*BLANKS                                                       CSD015
     C           NAR5      ORNE ONAR5                                                         CSD015
     C           NAR5      ANDNE*BLANKS                                                       CSD015
     C           NAR6      ORNE ONAR6                                                         CSD015
     C           NAR6      ANDNE*BLANKS                                                       CSD015
     C                     EXSR SRCLRP                                                        CSD015
     C                     MOVELNAR1      PINP1                                               CSD015
     C                     MOVELNAR2      PINP2                                               CSD015
     C                     MOVELNAR3      PINP3                                               CSD015
     C                     MOVELNAR4      PINP4                                               CSD015
     C                     MOVELNAR5      PINP5                                               CSD015
     C                     MOVELNAR6      PINP6                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD3         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
      ** Credit Party (for second parameter)                                                  CSD015
      *                                                                                       CSD015
     C           CRPY      IFNE OCRPY                                                         CSD015
     C***********CRPY      ANDNE*ZEROS                                                 CSD015 CSD027
     C           CRPY      ANDNE*BLANKS                                                       CSD027
     C                     EXSR SRCLRP                                                        CSD015
     C           CRPT      IFEQ 'N'                                                           CSD015
     C                     MOVELCRPY      FLD2                                                CSD015
     C                     MOVELFLD2      PINP1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELCRPY      PINP1                                               CSD015
     C                     ENDIF                                                              CSD015
     C                     MOVELCRCY      PCYCD                                               CSD015
     C                     EXSR SRCONV                                                        CSD015
     C                     Z-ADD1         WX                                                  CSD015
     C                     EXSR SRPRM2                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C           PSTRNG    IFNE *BLANKS                                                       CSD015
     C                     EXSR SRPRM1                                                        CSD015
     C                     EXSR SRWTCH                                                        CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C/COPY WNCPYSRC,FT0070C012
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     Z-ADDSEREFR    CCRRAT                          CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C                     UPDATCQCOCDDF               75
      *                                                                   056031
      * If record found                                                   056031
      *                                                                   056031
     C           *IN75     IFEQ '0'                                       056031
      ************************************************************ 056031 159283
      **Calculate*Credit*currency*equivalent********************** 056031 159283
      ************************************************************ 056031 159283
     C***********          EXSR SRCREQ                             056031 159283
      *                                                                   056031
      *  Generate Shadow Postings for Amend Credit Instructions           056031
      *  (post new value)                                                 056031
      *                                                                   056031
     C**********           Z-SUBD#TAMT    ##CRAM                                       056031 159283
     C                     Z-SUBCCYAM     ##CRAM                                              159283
     C/COPY WNCPYSRC,FT0070C136
     C                     EXSR SRADCR                                    056031
     C*                                                                   095270
     C* Calculate charge amount (always debit)                            095270
     C*                                                                   095270
     C           TRCM      ADD  COLL      ##CHGS                          095270
     C                     ADD  CSTA      ##CHGS                          095270
     C                     ADD  TXCH      ##CHGS                          095270
     C/COPY WNCPYSRC,FT0070C082
     C*                                                                   095270
     C           ##CHGS    IFNE 0                                         095270
     C/COPY WNCPYSRC,FT0070C137
     C                     EXSR SRSCHG                                    095270
     C                     END                                            095270
      *                                                                   056031
      *  Update posting database changes                                  056031
      *                                                                   056031
     C                     EXSR SRUPD                                     056031
     C                     END                                            056031
      *                                                                   056031
      *
     C           *IN75     IFEQ '1'                        B003
     C                     ROLBK
      *
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     MOVE 'UPDATE F'ERMSG1           ************
     C                     MOVE 'AILED   'ERMSG2
     C                     MOVELERRMSG    DBKEY
     C                     OUT  DLDA
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *                                                                   048377
      *  Allocate dataarea to blanks                                      048377
      *                                                                   048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E003
      *
      * Update credit trailer
      *
     C                     Z-ADD0         NUMU
     C                     Z-ADDOCQAM     TRLAMT
     C                     EXSR TRLCSB
     C                     Z-ADDCQAM      TRLAMT
     C                     EXSR TRLCAD
     C***********          END                             E002           058194
      *
     C                     END                                            S01241
      *
     C                     END                                            S01241
      *
      *          *************************************
     C*
     C** CONVERT CHEQUE AMOUNTS TO CHEQUE CURRENCIES
      *
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C************         MOVE SMCY      HDCCY   3                       056031
     C************         MOVE OCRCY     DTCCY   3                       056031
     C************         EXSR GETCYA                                    056031
     C***********DRCYDP    SUB  PAYYDP    N                               056031
     C************         ADD  4         N                               056031
     C***********OSMCY*****IFEQ BCCY                                S01194056031
     C***********OSMCY     IFEQ BJCYCD                              S01194056031
     C***********OMDIN     IFEQ 0                          B002           056031
     C***********ORATE     DIV  POWER,N   WK159     H                     056031
     C***********OCQAM     MULT WK159     OCQAM     H                     056031
     C************         ELSE                            X002           056031
     C***********ORATE     MULT POWER,N   WK159     H                     056031
     C***********OCQAM     DIV  WK159     OCQAM     H                     056031
     C************         END                             E002           056031
     C************         ELSE                            X001           056031
     C***********OMDIN     IFEQ 1                          B002           056031
     C***********ORATE     DIV  POWER,N   WK159     H                     056031
     C***********OCQAM     MULT WK159     OCQAM     H                     056031
     C************         ELSE                            X002           056031
     C***********ORATE     MULT POWER,N   WK159     H                     056031
     C***********OCQAM     DIV  WK159     OCQAM     H                     056031
     C************         END                             E002           056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE SMCY      HDCCY   3                       056031
     C************         MOVE CRCY      DTCCY   3                       056031
     C************         EXSR GETCYA                                    056031
     C**IF*DELETE*USE OLD MULTIPLY/DIVIDE INDICATOR                       056031
     C***********ACT2      IFEQ 'D'                        B001           056031
     C************         Z-ADDOMDIN     SMDIN                           056031
     C************         END                             E001           056031
     C***********DRCYDP    SUB  PAYYDP    N       10                      056031
     C************         ADD  4         N                               056031
     C************                                                        056031
     C*********************                                               E29890
     C***********SMCY******IFEQ BCCY                                      E29890
     C***********SMDIN*****IFEQ 0                          B001           E29890
     C***********RATE******DIV  POWER,N   WK159  159H                     E29890
     C***********CQAM******MULT WK159     CQAM      H                     E29890
     C*********************ELSE                            X001           E29890
     C***********RATE******MULT POWER,N   WK159  159H                     E29890
     C***********CQAM******DIV  WK159     CQAM      H                     E29890
     C*********************END                             E001           E29890
     C*********************ELSE                                           E29890
      ************                                                        056031
     C***********SMDIN     IFEQ 1                          B001           056031
     C***********RATE      DIV  POWER,N   WK159  159H                     056031
     C***********CQAM      MULT WK159     CQAM      H                     056031
     C************         ELSE                            X001           056031
     C***********RATE      MULT POWER,N   WK159  159H                     056031
     C***********CQAM      DIV  WK159     CQAM      H                     056031
     C************         END                             E001           056031
      ************                                                        056301
     C*********************END                                            E29890
     C************                                                        056031
     C****UPDATE*OTHER FILES                                              056031
     C************                                                        056031
     C****IF*RETAIL PRESENT                                               056031
     C************                                                        056031
     C************IN31     IFEQ '1'                        B001           056031
     C************         EXSR MEMUP                                     056031
     C************         END                             E001           056031
     C************                                                        056031
     C****IF*DEALING PRESENT                                              056031
     C************                                                        056031
     C************IN30     IFEQ '1'                        B001           056031
     C************         EXSR OLPUP                                     056031
     C************         EXSR PRONUP                                    056031
     C************         END                             E001           056031
     C*
     C**  UPDATE HEADER IF NO ERRORS
     C*
     C*
     C           DETAL     COMIT
      *                                                                   058194
      * Clear message subfile                                             058194
      *                                                                   058194
     C                     CALL 'Y2CLMSC'                                 058194
     C                     PARM ##PGM     FTPGMQ                          058194
     C                     PARM '*SAME'   FTPGRL                          058194
      *                                                                   058194
      * Reset message sent flag and warning flag                          058194
      *                                                                   058194
     C                     MOVEL'N'       FTMSGS                          058194
     C                     MOVEL*BLANKS   FTWARN                          058194
      *Reset indicator to default FX/Change Commission                    142243
     C                     Z-ADD0         W#FCYC                          142243
      *                                                                   056031
      *  Clear stored data                                                056031
      *                                                                   056031
     C                     EXSR SRCLR                                     056031
     C/COPY WNCPYSRC,FT0070C073
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     C                     ENDSR
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRCLR    : Clear all positions in store                      *   056031
      *                                                               *   056031
      *  CALLED BY: UPDAT1 - Update database - Header                 *   056031
      *             UPDAT2 - Update database - Detail                 *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRCLR     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRCLR'   @STK,Q                          056031
      *                                                                   056031
      *  Clear arrays in AOSPOSU0                                         056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*CLEAR  'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD901       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0070C122
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXCLR     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADDR   : Add shadow positions to store for DEBIT postings  *   056031
      *                                                               *   056031
      *  CALLED BY: UPDAT1 - Update database for Header               *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADDR    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRADDR'  @STK,Q                          056031
      *                                                                   056031
      *  Define debit amount                                              056031
      *                                                                   056031
     C           *LIKE     DEFN TOCL      ##DRAM                          056031
      *                                                                   056031
      *  Move fields to C#DTA structure and call AOSPOSU0                 056031
      *                                                                   056031
      *         D E B I T      I N S T R U C T I O N S                    056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C           RCRT      IFNE *BLANKS                                   056031
     C                     MOVELRCRT      C#ATYP                          056031
     C                     MOVELRCCO      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     ELSE                                           056031
     C                     MOVELCOBT      C#ATYP                          056031
     C                     MOVELCOB1      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     END                                            056031
      *                                                                   056031
     C                     Z-ADDSLDT      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDSLDT      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL'I'       C#IO                            056031
     C                     MOVELSMCY      C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELPREF      C#PREF                          056031
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADD0         C#CHQN                                              CRE020
     C           WRVADR    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVADR                                              CRE020
     C                     MOVE '*'       WREVER  1                                           CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     Z-ADD##DRAM    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD10        C#RPNB                          068347
     C                     MOVEL'D'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD902       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0070C123
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRADCR   : Add shadow positions to store for CREDIT postings *   056031
      *                                                               *   056031
      *  CALLED BY: UPDAT2 - Update database for Cheque Details       *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRADCR    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRADCR'  @STK,Q                          056031
      *                                                                   056031
      *  Define Credit amount                                             056031
      *                                                                   056031
     C           *LIKE     DEFN D#TAMT    ##CRAM                          056031
      *                                                                   056031
      *         C R E D I T    I N S T R U C T I O N S                    056031
      *                                                                   056031
     C                     CLEARC#DTA                                     056031
      *                                                                   056031
     C                     MOVELCRPT      C#ATYP                          056031
     C                     MOVELCRPY      C#ACCT                          056031
     C                     EXSR SRACCT                                                        CGL029
     C                     MOVELCRBR      C#BRCA                          056031
     C                     Z-ADDCRVD      C#VDAT                          056031
      *                                                                   056031
      * Set posting date according to FT Control Data                     056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'I'                                       056031
     C                     Z-ADDBJRDNB    C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           C#PDTI    IFEQ 'E'                                       056031
     C                     Z-ADDCRVD      C#PSTD                          056031
     C                     ELSE                                           056031
      *                                                                   056031
     C           SLDT      IFLT CRVD                                      056031
     C                     Z-ADDSLDT      C#PSTD                          056031
     C                     ELSE                                           056031
     C                     Z-ADDCRVD      C#PSTD                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     END                                            056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVEL'O'       C#IO                            056031
     C                     MOVELCRCY      C#CCY                           056031
     C                     MOVELPYTP      C#TRYP                          056031
     C                     MOVELPREF      C#PREF                          056031
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADDCQSQ      C#CHQN                                              CRE020
     C           WRVACR    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVACR                                              CRE020
     C                     MOVE '*'       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     Z-ADD##CRAM    C#AMT                           056031
     C                     MOVEL'FT'      C#MOD                           056031
     C                     MOVEL'01'      C#OLRC                          056031
     C                     MOVEL##FTOV    C#FTOV                          056031
     C                     MOVEL'Y'       C#RPST                          068347
     C                     Z-ADD20        C#RPNB                          068347
     C                     MOVEL'C'       C#RTYP                          068347
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FT0070C140
      *                                                                   056031
      *  Call AOSPOSU0                                                    056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*ADD    'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD903       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0070C124
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRCREQ   : Calculate Credit Currency Equivalent              *   056031
      *                                                               *   056031
      *  CALLED BY: UPDAT2 - Update Cheque Details                    *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRCREQ    BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRCREQ'  @STK,Q                          056031
      *                                                                   056031
     C                     Z-ADDCQAM      D#FAMT                          056031
     C                     MOVELSMCY      D#FCCY                          056031
     C                     MOVELCRCY      D#TCCY                          056031
      *                                                                   056031
      * Set multiply/divide indicator                                     056031
      *                                                                   056031
     C           MDIN      IFEQ 0                                         056031
     C                     MOVEL'D'       I#MDIN                          056031
     C                     ELSE                                           056031
     C                     MOVEL'M'       I#MDIN                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     Z-ADDRATE      I#RATE                          056031
     C                     CALL 'AOCCYCV0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*F*T*RAT'W0ACT   8                       056031
     C           D#DTA     PARM D#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOCCYCV0'W0KEY                           056031
     C                     Z-ADD905       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q       50                      056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRUPD    : Update database with shadow positions             *   056031
      *                                                               *   056031
      *  CALLED BY: UPDAT1 - Update database - debit                  *   056031
      *             UPDAT2 - Update database - credit                 *   056031
      *                                                               *   056031
      *  CALLS    : SRERR - Report errors                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRUPD     BEGSR                                          056031
      *                                                                   056031
      *  Set up subroutine stack name                                     056031
      *                                                                   056031
     C                     ADD  1         Q                               056031
     C                     MOVEL'SRUPD'   @STK,Q                          056031
      *                                                                   056031
      *  Call AOSPOSU0 to update database                                 056031
      *                                                                   056031
     C                     CALL 'AOSPOSU0'             9090               056031
     C           R#RTN     PARM *BLANKS   O#RTN   7                       056031
     C                     PARM '*UPDATE 'W0ACT   8                       056031
     C                     PARM C#DTA     O#DTA 256                       056031
      *                                                                   056031
     C           *IN90     IFEQ '1'                                       056031
     C           R#RTN     ORNE *BLANKS                                   056031
     C                     MOVEL'*CALL   'W0FILE                          056031
     C                     MOVEL'AOSPOSU0'W0KEY                           056031
     C                     Z-ADD904       W0ERNB                          056031
     C                     MOVELERR@,1    W0NARR                          056031
     C                     EXSR SRERR                                     056031
     C                     END                                            056031
     C/COPY WNCPYSRC,FT0070C125
      *                                                                   056031
      *  Unwind subroutine stack name                                     056031
      *                                                                   056031
     C           EXUPD     TAG                                            056031
     C                     MOVEA*BLANKS   @STK,Q                          056031
     C                     SUB  1         Q                               056031
      *                                                                   056031
     CSR                   ENDSR                                          056031
     C/EJECT                                                              056031
      *****************************************************************   056031
      *                                                               *   056031
      *  SRERR    : Report error and close down program               *   056031
      *                                                               *   056031
      *  CALLED BY: SRCLR - Clear arrays                              *   056031
      *             SRUPD - Update Database with shadow positions     *   056031
      *             SRADD - Add shadow positions to store             *   056031
      *             SRCREQ- Calculate Credit Currency Equivalent      *   056031
      *             INITL - Initation subroutine                      *   056031
      *             SRBOOK- Validate Book code field                  *   056031
      *             SRPRFC- Validate Profit Centre field              *   056031
      *                                                               *   056031
      *  CALLS    : *NONE                                             *   056031
      *                                                               *   056031
      *****************************************************************   056031
     CSR         SRERR     BEGSR                                          056031
      *                                                                   056031
      *  Define work variables                                            056031
      *                                                                   056031
     C           *LIKE     DEFN @BKEY     W0KEY                           056031
     C           *LIKE     DEFN @BERNB    W0ERNB                          056031
     C           *LIKE     DEFN @BFILE    W0FILE                          056031
     C           *LIKE     DEFN @BNARR    W0NARR                          056031
      *                                                                   056031
      *  Dump program                                                     056031
      *                                                                   056031
     C                     DUMP                                           056031
     C                     ROLBK                                          056031
      *                                                                   056031
      *  Send message to MOPERQ                                           056031
      *                                                                   056031
     C                     MOVEL*BLANKS   DBDTA                           056031
     C                     MOVEL'FT0070  '@BPGM                           056031
      *                                                                   056031
     C           Q         IFGT 1                                         056031
     C           Q         ANDLT21                                        056031
     C                     MOVEL@STK,Q    @BSTK                           056031
     C                     ELSE                                           056031
     C                     MOVEL'*Nostkin'@BSTK                           056031
     C                     END                                            056031
      *                                                                   056031
     C                     MOVELW0KEY     @BKEY                           056031
     C                     MOVELW0ERNB    @BERNB                          056031
     C                     MOVELW0FILE    @BFILE                          056031
     C                     MOVELPREF      @BPREF                          056031
      *                                                                   056031
     C           W0NARR    IFEQ *BLANKS                                   056031
     C                     MOVELERR@,1    @BNARR                          056031
     C                     ELSE                                           056031
     C                     MOVELW0NARR    @BNARR                          056031
     C                     END                                            056031
      *                                                                   056031
     C                     CALL 'AOCREPT'              9090               056031
     C                     PARM 'MEM5000' #MSGID  7                       056031
     C                     PARM 'MIDAS  ' #MSGF  10                       056031
     C                     PARM *BLANKS   #MSGFL 10                       056031
     C                     PARM DBDTA     #MSGDT256                       056031
     C                     PARM '*PRV'    #MSGR   5                       056031
     C                     PARM '*'       #PRGM  10                       056031
     C                     PARM 'MOPERQ ' #MSGQ  10                       056031
     C                     PARM '*INFO  ' #MSGT   7                       056031
      *                                                                   056031
      *  Close down program                                               056031
      *                                                                   056031
     C           *LOCK     IN   DLDA                                      056031
     C                     MOVE 'FT0070  'DBPGM                           056031
     C                     MOVELW0FILE    DBFILE           ***************056031
     C                     Z-ADDW0ERNB    DBASE            * DB ERROR 86 *056031
     C                     MOVELW0KEY     DBKEY            ***************056031
     C                     OUT  DLDA                                      056031
     C                     SETON                     U7U8LR               056031
      *                                                                   059850
      *  Allocate dataarea to blanks                                      059850
      *                                                                   059850
     C                     EXSR DALLOC                                    059850
      *                                                                   059850
     C                     RETRN                                          056031
     C                     MOVEL*BLANKS   R#RTN   7                       056031
      *                                                                   056031
     CSR         EXERR     ENDSR                                          056031
     C/EJECT                                                              058194
      *****************************************************************   058194
      *                                                               *   058194
      *  SRWIND   : Control Window Processing                         *   058194
      *                                                               *   058194
      *  CALLED BY: DETL1                                             *   058194
      *                                                               *   058194
      *  CALLS    : *NONE                                             *   058194
      *                                                               *   058194
      *****************************************************************   058194
     CSR         SRWIND    BEGSR                                          058194
      *                                                                   058194
      *  Set up subroutine stack name                                     058194
      *                                                                   058194
     C                     ADD  1         Q                               058194
     C                     MOVEL'SRWIND'  @STK,Q                          058194
      *                                                                   058194
      * If window processing call WN0010                                  058194
      *                                                                   058194
     C           BGWDPR    IFEQ 'Y'                                       058194
      *                                                                   058194
      *    /copy to move data into the data structure fields passed       058194
      *     as a parameter to the window controller                       058194
      *                                                                   058194
      /COPY WNCPYSRC,FT0070MOV1                                           058194
      *                                                                                       CER049
      ** Payment reference is passed into Data to be passed into                              CER049
      ** the Stamp Tax screen                                                                 CER049
      *                                                                                       CER049
     C                     MOVEL'CHEQC'   U#ORGN                                              CER049
     C**********           MOVE *ZEROS    U#LNRF                                       CER049 CLE148
     C                     MOVE *BLANKS   U#LNRF                                              CLE148
     C                     MOVE *BLANKS   U#FCNM                                              CER049
     C                     MOVE *ZEROS    U#FACT                                              CER049
     C                     MOVE *ZEROS    U#FCNO                                              CER049
     C                     MOVE *ZEROS    U#FSEQ                                              CER049
     C                     MOVE *ZEROS    U#ORED                                              CER049
     C                     MOVE *ZEROS    U#DLNO                                              CER049
     C                     MOVE *BLANKS   U#TDRF                                              CER049
     C                     MOVE *BLANKS   U#BRCA                                              CER049
     C                     MOVE *BLANKS   U#CNUM                                              CER049
     C                     MOVE *BLANKS   U#CCY                                               CER049
     C                     MOVE *ZEROS    U#ACOD                                              CER049
     C                     MOVE *ZEROS    U#ACSQ                                              CER049
     C                     MOVE SPREF     U#PREF                                              CER049
     C                     MOVE SCQSQ     U#CQSQ                                              CER049
     C**********           MOVE TRCM      U#AMNT                                     CER049 AR944056
     C                     MOVE SDUMA1    U#AMNT                                            AR944056
     C                     MOVE CRCY      U#TCCY                                              CER049
     C                     MOVE SLDT      U#VDAT                                              CER049
      *                                                                                       CER049
      ** Initialise work fields  for account determination                                    CER049
      *                                                                                       CER049
     C                     MOVEL*BLANKS   @@TYP1                                              CER049
     C                     MOVEL*BLANKS   @@ACC1                                              CER049
     C                     MOVEL*BLANKS   @@TYP2                                              CER049
     C                     MOVEL*BLANKS   @@ACC2                                              CER049
     C                     MOVEL*BLANKS   @@CCY                                               CER049
      *                                                                                       CER049
      ** If "charges to the debit of" is entered                                              CER049
      *                                                                                       CER049
     C           SCHDB     IFNE *BLANKS                                                       CER049
     C           CDRT      ANDNE*BLANK                                                        CER049
      *                                                                                       CER049
      ** Check customer no. of "charges to the debit of"                                      CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C                     MOVELCDRT      @@TYP1                                              CER049
     C                     MOVELCDRO      W0FLD                                               CER049
     C           W0FLD     CAT  CDBR      @@ACC1    P                                         CER049
     C                     MOVELBJCYCD    @@CCY                                               CER049
      *                                                                                       CER049
     C                     ELSE                                                               CER049
      *                                                                                       CER049
      ** Check customer no. of the "credit party"                                             CER049
      ** (screen field value)                                                                 CER049
      *                                                                                       CER049
     C           CRPT      IFNE *BLANK                                                        CER049
     C                     MOVELCRPT      @@TYP1                                              CER049
     C                     MOVELCRPY      W0FLD                                               CER049
     C           W0FLD     CAT  CRBR      @@ACC1    P                                         CER049
     C                     MOVELCRCY      @@CCY                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     SELEC                                          058194
     C           SACTD     WHEQ 'E'                                       058194
      /COPY WNCPYSRC,FT0070MOV2                                           058194
     C           SACTD     WHEQ 'I'                                       058194
      /COPY WNCPYSRC,FT0070MOV3                                           058194
     C           SACTD     WHEQ 'D'                                       058194
      /COPY WNCPYSRC,FT0070MOV4                                           058194
     C           SACTD     WHEQ 'A'                                       058194
      /COPY WNCPYSRC,FT0070MOV5                                           058194
     C                     ENDSL                                          058194
      *                                                                   058194
      ** If Stamp Tax is switched on, call the Stamp Tax details screen.                      CER049
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     CALL 'GL008102'                                                    CER049
     C                     PARM SACTD     O#ACTN                                              CER049
     C                     PARM           DATA                                                CER049
     C           R#RTN     PARM *BLANKS   O#RTN                                               CER049
      *                                                                                       CER049
      ** Process return code.                                                                 CER049
      *                                                                                       CER049
     C                     SELEC                                                              CER049
      *                                                                                       CER049
      ** If error                                                                             CER049
      *                                                                                       CER049
     C           R#RTN     WHEQ 'ERROR  '                                                     CER049
     C                     MOVEL'USR0563' FTMSID                                              CER049
     C                     MOVEL'SDUSRMSG'FTMSGF                                              CER049
     C                     EXSR FTSNMS                                                        CER049
     C                     MOVEL'1'       *IN03                                               CER049
      *                                                                                       CER049
      ** If F3 pressed in window screen, exit                                                 CER049
      *                                                                                       CER049
     C           R#RTN     WHEQ 'EXIT   '                                                     CER049
     C                     MOVEL'FTW0001' FTMSID                                              CER049
     C                     MOVEL'FTUSRMSG'FTMSGF                                              CER049
     C                     EXSR FTSNMS                                                        CER049
     C                     MOVEL'1'       *IN03                                               CER049
      *                                                                                       CER049
      ** If F12 pressed, return to main details screen.                                       CER049
      *                                                                                       CER049
     C           R#RTN     WHEQ 'PREV   '                                                     CER049
     C                     MOVEL'FTW0002' FTMSID                                              CER049
     C                     MOVEL'FTUSRMSG'FTMSGF                                              CER049
     C                     EXSR FTSNMS                                                        CER049
      *                                                                                       CER049
     C                     ENDSL                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     CALL 'WN0010'                                  058194
     C/COPY WNCPYSRC,FT0070C074
     C                     PARM 'FT0070'  O#PGM  10                       058194
     C                     PARM *BLANKS   O#CMD   2                       058194
     C                     PARM SACTD     O#ACTN  1                       058194
     C                     PARM           DATA                            058194
     C/COPY WNCPYSRC,FT0070C075
     C           R#RTN     PARM *BLANKS   O#RTN   7                       058194
     C                     PARM           SPARE 256                       058194
      *                                                                   058194
      *   /copy to move data back from the data structure fields passed   058194
      *    as a parameter to the window controller and control user       058194
      *    defined processing.                                            058194
      *                                                                   058194
      /COPY WNCPYSRC,FT0070MOV6                                           058194
      *                                                                   058194
     C/COPY WNCPYSRC,FT0070C057
     C           R#RTN     CABEQ*BLANKS   EXWIND                          058194
      *                                                                   058194
      *  Check return code and send message on action                     058194
      *  - set no update as some action has been specified.               058194
      *                                                                   058194
     C                     MOVEL'Y'       FTNOUP                          058194
     C                     ROLBK                                          058194
      *                                                                   058194
     C                     SELEC                                          058194
      *                                                                   058194
      * *Return code is *User QUIT requested                              058194
      *                                                                   058194
     C           R#RTN     WHEQ 'Y2U9999'                                 058194
     C                     MOVEL'FTW0001' FTMSID                          058194
     C                     MOVEL'FTUSRMSG'FTMSGF                          058194
     C                     EXSR FTSNMS                                    058194
     C                     MOVEL'1'       *IN03                           058194
      *                                                                   058194
      * *Return code is WN Window Error                                   058194
      *                                                                   058194
     C           R#RTN     WHEQ 'USR0563'                                 058194
     C                     MOVEL'USR0563' FTMSID                          058194
     C                     MOVEL'SDUSRMSG'FTMSGF                          058194
     C                     EXSR FTSNMS                                    058194
     C                     MOVEL'1'       *IN03                           058194
      *                                                                   058194
      * *Return code is *DBF update error                                 058194
      *                                                                   058194
     C           R#RTN     WHEQ 'USR0567'                                 058194
     C                     MOVEL'USR0567' FTMSID                          058194
     C                     MOVEL'SDUSRMSG'FTMSGF                          058194
     C                     EXSR FTSNMS                                    058194
     C                     MOVEL'1'       *IN03                           058194
      *                                                                   058194
      * *Return code is *Previous Screen                                  058194
      *                                                                   058194
     C           R#RTN     WHEQ 'USR0790'                                 058194
     C                     MOVEL'FTW0002' FTMSID                          058194
     C                     MOVEL'FTUSRMSG'FTMSGF                          058194
     C                     EXSR FTSNMS                                    058194
     C                     ENDSL                                          058194
      *                                                                   058194
     C                     END                                            058194
      *                                                                   058194
      *  Unwind subroutine stack name                                     058194
      *                                                                   058194
     C           EXWIND    TAG                                            058194
     C                     MOVEA*BLANKS   @STK,Q                          058194
     C                     SUB  1         Q                               058194
      *                                                                   058194
     CSR                   ENDSR                                          058194
     C/EJECT                                                              058194
      *****************************************************************   058194
      *                                                               *   058194
      *  FTSNMS   : Send message to program's message queue           *   058194
      *                                                               *   058194
      *  CALLED BY: ALL OVER                                          *   058194
      *                                                               *   058194
      *  CALLS    : *NONE                                             *   058194
      *                                                               *   058194
      *****************************************************************   058194
     CSR         FTSNMS    BEGSR                                          058194
      *                                                                   058194
      * If no program send to FT0070                                      058194
      *                                                                   058194
     C           FTPGMQ    IFEQ *BLANK                                    058194
     C                     MOVEL##PGM     FTPGMQ                          058194
     C                     END                                            058194
      *                                                                   058194
      * If level to send is blanks default to *SAME                       058194
      *                                                                   058194
     C           FTPGRL    IFEQ *BLANK                                    058194
     C                     MOVEL'*SAME'   FTPGRL                          058194
     C                     END                                            058194
      *                                                                   058194
      * If no message file specified, use default                         058194
      *                                                                   058194
     C           FTMSGF    IFEQ *BLANK                                    058194
     C                     MOVEL'FTUSRMSG'FTMSGF                          058194
     C                     END                                            058194
      *                                                                   058194
     C                     CALL 'AOCREPT'                                 058194
     C                     PARM           FTMSID  7                       058194
     C                     PARM           FTMSGF 10                       058194
     C                     PARM           FTMSFL 10                       058194
     C                     PARM           FTMSDT256                       058194
     C                     PARM           FTPGRL                          058194
     C                     PARM           FTPGMQ                          058194
     C                     PARM           FTMSGQ 10                       058194
     C                     PARM           FTMSGT  7                       058194
      *                                                                   058194
     C                     MOVEL'Y'       FTMSGS  1                       058194
     C                     MOVELFTWARN    FTWARN  1                       058194
      *                                                                   058194
      * Clear all fields for default mechanism next time                  058194
      *                                                                   058194
     C                     MOVEL*BLANK    FTMSID                          058194
     C                     MOVEL*BLANK    FTMSGF                          058194
     C                     MOVEL*BLANK    FTMSFL                          058194
     C                     MOVEL*BLANK    FTMSDT                          058194
     C                     MOVEL*BLANK    FTPGRL                          058194
     C                     MOVEL*BLANK    FTPGMQ                          058194
     C                     MOVEL*BLANK    FTMSGQ                          058194
     C                     MOVEL*BLANK    FTMSGT                          058194
      *================================================================   058194
     CSR         FTEXIT    ENDSR                                          058194
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. TRLDAD TO ADD AMOUNT TO DEBIT TRAILER
     C*
     C           TRLDAD    BEGSR
      *
     C                     SETOF                     75
     C           1         CHAINCQCODZZF             75
     C           *IN75     IFEQ '1'                        B001
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCODZZ' DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     MOVEL'1'       DBKEY            ************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X001
     C*
     C**  UPDATE TRAILER AMOUNTS
     C*
     C           NORE1     ADD  NUMU      NORE1
     C                     MOVE TRLAMT    ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C                     UPDATCQCODZZF               75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. TRLDSB TO SUBTRACT AMOUNT FROM DEBIT TRAILER
     C*
     C           TRLDSB    BEGSR
     C                     SETOF                     75
     C           1         CHAINCQCODZZF             75
     C           *IN75     IFEQ '1'                        B001
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCODZZ' DBFILE           ************
     C                     Z-ADD17        DBASE            * DBERR 17 *
     C                     MOVEL'1'       DBKEY            ************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X001
     C*
     C**  UPDATE TRAILER AMOUNTS
     C*
     C                     MOVE TRLAMT    ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C                     UPDATCQCODZZF               75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. TRLCAD TO ADD AMOUNT TO CREDIT TRAILER
     C*
     C           TRLCAD    BEGSR
     C                     SETOF                     75
     C           1         CHAINCQCOCZZF             75
     C           *IN75     IFEQ '1'                        B001
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOCZZ' DBFILE           ************
     C                     Z-ADD18        DBASE            * DBERR 18 *
     C                     MOVEL'1'       DBKEY            ************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X001
     C*
     C**  UPDATE TRAILER AMOUNTS
     C*
     C           NORE1     ADD  NUMU      NORE1
     C                     MOVE TRLAMT    ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C                     UPDATCQCOCZZF               75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. TRLCSB TO SUBTRACT AMOUNT FROM CREDIT TRAILER
     C*
     C           TRLCSB    BEGSR
     C                     SETOF                     75
     C           1         CHAINCQCOCZZF             75
     C           *IN75     IFEQ '1'                        B001
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOCZZ' DBFILE           ************
     C                     Z-ADD19        DBASE            * DBERR 19 *
     C                     MOVEL'1'       DBKEY            ************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     ELSE                            X001
     C*
     C**  UPDATE TRAILER AMOUNTS
     C*
     C                     MOVE TRLAMT    ZZAMT
     C                     Z-ADDHRWN      ZZTOTI
     C                     Z-ADDHRDC      ZZTOTD
     C                     EXSR GLZSUB
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C                     UPDATCQCOCZZF               75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****SUBROUTINE TO CONTROL UPDATE OF OLPOS                           056031
     C************                                                        056031
     C***********OLPUP     BEGSR                                          056031
     C************                                                        056031
     C***SET*UP*BRANCH KEY FIELD FOR OLPOS CHAIN                    S01117056031
     C************                                                  S01117056031
     C************         MOVE BKGBR     OLBR                      S01117056031
     C************                                                  S01117056031
     C****CHEQUE*HEADER                                                   056031
     C************                                                        056031
     C***********CQSQ      IFEQ 0                          B001           056031
     C************         MOVELSMCY      OLCY                            056031
     C************         MOVE '01'      OLNOK                           056031
     C************         Z-ADDSLDT      OLPDT   50                      056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C***********SACTD     IFEQ 'I'                        B002           056031
     C************         Z-ADDTOCL      OLAMT  130                      056031
     C************         EXSR OLPADD                                    056031
     C************         END                             E002           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C************IN04     IFEQ '1'                        B002           056031
     C***********SACTD     IFEQ 'D'                        B003           056031
     C************         Z-SUBTOCL      OLAMT                           056031
     C************         EXSR OLPADD                                    056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********SACTD     IFEQ 'A'                        B002           056031
     C************         Z-ADDTOCL      OLAMT                           056031
     C************         EXSR OLPADD                                    056031
     C************         MOVELOSMCY     OLCY                            056031
     C************         Z-SUBOTOCL     OLAMT                           056031
     C************         MOVELOSLDT     OLPDT                           056031
     C************         EXSR OLPADD                                    056031
     C************         END                             E002           056031
     C************         ELSE                            X001           056031
     C************                                                        056031
     C****CHEQUE*DETAIL                                                   056031
     C************                                                        056031
     C************         MOVELCRCY      OLCY                            056031
     C************         MOVE '01'      OLNOK                           056031
     C************         Z-ADDCRVD      OLPDT                           056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C***********ACT2      IFEQ 'I'                        B002           056031
     C************         Z-ADDCQAM      OLAMT                           056031
     C************         Z-ADDCRVD      OLPDT                           056031
     C************         EXSR OLPSUB                                    056031
     C************         END                             E002           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C***********ACT2      IFEQ 'D'                        B002           056031
     C************         Z-SUBCQAM      OLAMT                           056031
     C************         Z-ADDCRVD      OLPDT                           056031
     C************         EXSR OLPSUB                                    056031
     C************         END                             E002           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********ACT2      IFEQ 'A'                        B002           056031
     C************         Z-ADDCQAM      OLAMT                           056031
     C************         Z-ADDCRVD      OLPDT                           056031
     C************         EXSR OLPSUB                                    056031
     C************         MOVELOCRCY     OLCY                            056031
     C************         Z-ADDOCQAM     OLAMT                           056031
     C************         Z-ADDOCRVD     OLPDT                           056031
     C************         EXSR OLPADD                                    056031
     C************         END                             E002           056031
     C************LOCK     IN   DLDA                                      056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****SUBROUTINE TO CONTROL UPDATE OF PRONO                           056031
     C************                                                        056031
     C***********PRONUP    BEGSR                                          056031
     C************         SETOF                     75                   056031
     C************                                                        056031
     C****CHEQUE*HEADER                                                   056031
     C************                                                        056031
     C***********CQSQ      IFEQ 0                          B001           056031
     C************         Z-ADDSLDT      PRODT   50                      056031
     C************                                                        056031
     C****CHECK*FOR RECEIVERS CORRESPONDENT EQUAL TO NOSTRO               056031
     C************                                                        056031
     C***********RCRT      IFNE *BLANK                                    056031
     C***********RCRT      IFEQ 'N'                        B002           056031
     C************         MOVELRCCO      NOSK                            056031
     C************         MOVE SMCY      PRCYK                           056031
     C************         SETON                     68                   056031
     C************         ELSE                            X002           056031
     C**CHECK*FOR*POSSIBLE ACCOUNT NUMBER NOSTROS                         056031
     C************         MOVE RCRT      NTYPE   1                       056031
     C************         MOVELRCCO      RTNO                            056031
     C************         MOVE SMCY      NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                                            056031
     C************         ELSE                                           056031
     C************                                                        056031
     C****CHECK*FOR COLLECTING BANK EQUAL TO NOSTRO                       056031
     C************                                                        056031
     C***********COBT      IFEQ 'F'                        B003           056031
     C************         MOVELCOB1      FNOS                            056031
     C************         SETON                     68                   056031
     C************         ELSE                            X003           056031
     C************         MOVE COBT      NTYPE   1                       056031
     C************         MOVELCOB1      RTNO                            056031
     C************         MOVE SMCY      NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C**N68*******         SETON                     75                   056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C************IN75     IFEQ '0'                        B002           056031
     C***********SACTD     IFEQ 'I'                        B003           056031
     C************         Z-ADDTOCL      PRAMT  130                      056031
     C************         EXSR PROADD                                    056031
     C************         END                             E003           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C************IN04     IFEQ '1'                        B003           056031
     C***********SACTD     IFEQ 'D'                        B004           056031
     C************         Z-ADDTOCL      PRAMT                           056031
     C************         EXSR PROSUB                                    056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********SACTD     IFEQ 'A'                        B003           056031
     C************         Z-ADDTOCL      PRAMT                           056031
     C************         EXSR PROADD                                    056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C***********SACTD     IFEQ 'A'                        B002           056031
     C************         SETOF                     75                   056031
     C***********ORCRT     IFNE *BLANK                                    056031
     C***********ORCRT     IFEQ 'N'                        B002           056031
     C************         MOVELORCCO     NOSK                            056031
     C************         MOVE OSMCY     PRCYK                           056031
     C************         SETON                     68                   056031
     C************         ELSE                            X002           056031
     C**CHECK*FOR*POSSIBLE ACCOUNT NUMBER NOSTROS                         056031
     C************         MOVE ORCRT     NTYPE   1                       056031
     C************         MOVELORCCO     RTNO                            056031
     C************         MOVE OSMCY     NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                                            056031
     C************         ELSE                                           056031
     C************                                                        056031
     C****CHECK*FOR COLLECTING BANK EQUAL TO NOSTRO                       056031
     C************                                                        056031
     C***********OCOBT     IFEQ 'F'                        B003           056031
     C************         MOVELOCOB1     FNOS                            056031
     C************         SETON                     68                   056031
     C************         ELSE                            X003           056031
     C************         MOVE OCOBT     NTYPE   1                       056031
     C************         MOVELOCOB1     RTNO                            056031
     C************         MOVE OSMCY     NCCY    3                       056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVELNOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C**N68*******         SETON                     75                   056031
     C************                                                        056031
     C***REMOVE*OLD DETAILS FROM PRONO                                    056031
     C************                                                        056031
     C************IN75     IFEQ '0'                        B003           056031
     C************         Z-ADDOSLDT     PRODT   50                      056031
     C************         Z-ADDOTOCL     PRAMT                           056031
     C************         EXSR PROSUB                                    056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************         ELSE                            X001           056031
     C************                                                        056031
     C****CHEQUE*DETAIL                                                   056031
     C************                                                        056031
     C************         Z-ADDCRVD      PRODT                           056031
     C***********CRPT      IFEQ 'N'                        B002           056031
     C************         MOVELCRPY      NOSK                            056031
     C************         MOVE CRCY      PRCYK                           056031
     C************         SETON                     68                   056031
     C************         ELSE                                           056031
     C**CHECK*FOR*OTHER POSSIBLE NOSTRO NUMBERS                           056031
     C************                                                        056031
     C************         MOVE CRPT      NTYPE                           056031
     C************         MOVELCRPY      RTNO                            056031
     C************         MOVE CRCY      NCCY                            056031
     C************         MOVE CRBR      BRCANP                    S01117056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVE NOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                                            056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C***68******ACT2      IFEQ 'I'                        B003           056031
     C************         Z-ADDCQAM      PRAMT                           056031
     C************         EXSR PROSUB                                    056031
     C************         END                             E003           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C************IN04     IFEQ '1'                        B003           056031
     C***68******ACT2      IFEQ 'D'                        B004           056031
     C************         Z-ADDCQAM      PRAMT                           056031
     C************         EXSR PROADD                                    056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********ACT2      IFEQ 'A'                        B003           056031
     C************         Z-ADDCQAM      PRAMT                           056031
     C***68*******         EXSR PROSUB                                    056031
     C***********OCRPT     IFEQ 'N'                        B004           056031
     C************         MOVELOCRPY     NOSK                            056031
     C************         MOVE OCRCY     PRCYK                           056031
     C************         SETON                     68                   056031
     C************         ELSE                                           056031
     C**CHECK*FOR*OTHER POSSIBLE NOSTRO NUMBERS                           056031
     C************                                                        056031
     C************         MOVE OCRPT     NTYPE                           056031
     C************         MOVELOCRPY     RTNO                            056031
     C************         MOVE OCRCY     NCCY                            056031
     C************         MOVE OCRBR     BRCANP                    S01117056031
     C************         EXSR NOSTRO                                    056031
     C************         MOVE NOSN      NOSK                            056031
     C************         MOVE CCY       PRCYK                           056031
     C************         END                                            056031
     C************         Z-ADDOCQAM     PRAMT                           056031
     C************         Z-ADDOCRVD     PRODT                           056031
     C***68*******         EXSR PROADD                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****SUBROUTINE TO CONTROL UPDATE  OF SHADOW BALANCES FILE           056031
     C************                                                        056031
     C****CHEQUE*HEADER                                                   056031
     C************                                                        056031
     C***********MEMUP     BEGSR                                          056031
     C************         SETOF                     758839               056031
     C************         MOVE *BLANKS   ZLOC                      S01195056031
     C************         MOVE *BLANKS   NOWRK                     S01195056031
     C***********CQSQ      IFEQ 0                          B001           056031
     C***********RCCO      IFNE 0                          B002           056031
     C***********RCRT      IFEQ 'N'                        B003           056031
     C************                                                        056031
     C****OBTAIN*RECEIVERS CORRESPONDENT DETAILS - NOSTRO                 056031
     C************                                                        056031
     C*********************MOVELSMCY      PRO     5                       S01194
     C*********************MOVELRCCO      WORK02  2                       S01194
     C*********************MOVE WORK02    PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B004           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E004           S01194
     C************IN75*****IFEQ '1'                        B004           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD20        DBASE            * DBERR 20 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X004           S01194
     C************                                                  S01194056031
     C************         MOVELSMCY      NOSCCY                   S01194 056031
     C************         MOVELRCCO      NOSNUM                   S01194 056031
     C************         EXSR AONOS1                             S01194 056031
     C************                                                 S01194 056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE SMCY      CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                    S01117 056031
     C************         MOVE NLOC      ZLOC                     S01195 056031
     C************         MOVE 'N'       NOWRK   1                S01195 056031
     C*********************END                             E004           S01194
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B004           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E004           056031
     C************IN75     IFEQ '1'                        B004           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD21        DBASE            * DBERR 21 *   056031
     C************         MOVELACCKY     DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
      ***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E004           056031
     C************                                                        056031
     C***********ATYP      IFEQ 'R'                        B004           056031
     C************         SETON                     88                   056031
     C************         SETON                     39                   056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************                                                        056031
     C****OBTAIN*RECEIVERS CORRESPONDENT DETAILS - RETAIL NUMBER          056031
     C************                                                        056031
     C***********RCRT      IFEQ 'R'                        B003           056031
     C************         MOVELRCCO      RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C************IN75     IFEQ '0'                        B004           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         ELSE                            X004           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E004           056031
     C************IN75     IFEQ '1'                        B004           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD22        DBASE            * DBERR 22 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C***********RCCO      IFEQ *ZERO                      B002           056031
     C************                                                        056031
     C****OBTAIN*COLLECTING BANK DETAILS - FULL NOSTRO                    056031
     C************                                                        056031
     C***********COBT      IFEQ 'F'                        B003           056031
     C*********************MOVELCOB1      PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B004           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E004           S01194
     C************IN75*****IFEQ '1'                        B004           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD23        DBASE            * DBERR 23 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X004           S01194
     C************                                                  S01194056031
     C************         MOVELCOB1      NOSCHN                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************                                                  S01194056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE SMCY      CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C************         SETON                     39                   056031
     C*********************END                             E004     S01194056031
     C************         ELSE                            X003           056031
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********COBT      IFEQ 'G'                        B004           056031
     C************         MOVELCOB1      ACCKY                           056031
     C************         ELSE                            X004           056031
     C************         GOTO R1TAG                                     056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************                                                        056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B004           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E004           056031
     C************IN75     IFEQ '1'                        B004           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD24        DBASE            * DBERR 24 *   056031
     C*********************MOVELTBCHN     DBKEY            ************   E29882
     C************         MOVELACCKY     DBKEY        *********   E29882 056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E004           056031
     C***********ATYP      IFEQ 'R'                        B004           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                            S01194  056031
     C************                                                S01195  056031
     C************         EXSR LOCAT                             S01195  056031
     C************                                                S01195  056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E004           056031
     C************                                                        056031
     C****OBTAIN*COLLECTING BANK DETAILS - RETAIL NUMBER                  056031
     C************                                                        056031
     C***********R1TAG     TAG                                            056031
     C***********COBT      IFEQ 'R'                        B003           056031
     C************         SETON                     88                   056031
     C************         MOVELCOB1      RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C**N75******RECI      COMP 'D'                  7575           047179056031
     C************IN75     IFEQ '1'                        B004           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD25        DBASE            * DBERR 25 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C************                                                  048377056031
     C***Allocate*dataarea to blanks                                048377056031
     C************                                                  048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E004           056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C****MEMOS*FILE UPDATES                                              056031
     C************                                                        056031
     C************         MOVE '0'       *IN36                   E110    056031
     C***********DSLDT*****IFLT DNWD                       B003   E110    S01194
     C***********DSLDT     IFLT BJDNWD                     B003 E110S01194056031
     C************         MOVE '1'       *IN36                   E110    056031
     C************         END                             E003   E110    056031
     C************                                                        056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C***********SACTD     IFEQ 'I'                        B003           056031
     C************         Z-ADDTOCL      MEMAMT 130                      056031
     C************         Z-ADDDSLDT     VUDT                            056031
     C***88*******         EXSR MEMADD                                    056031
     C************         END                             E003           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C************IN04     IFEQ '1'                        B003           056031
     C***********SACTD     IFEQ 'D'                        B004           056031
     C************         Z-ADDTOCL      MEMAMT                          056031
     C************         Z-ADDDSLDT     VUDT                            056031
     C***88*******         EXSR MEMSUB                                    056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********SACTD     IFEQ 'A'                        B003           056031
     C************         Z-ADDTOCL      MEMAMT                          056031
     C************         Z-ADDDSLDT     VUDT                            056031
     C***88*******         EXSR MEMADD                                    056031
     C************                                                        056031
     C****OBTAIN*OLD DETAILS TO REVERSE ON AMEND                          056031
     C************                                                        056031
     C************         SETOF                     7588                 056031
     C***********ORCCO     IFNE *ZERO                      B004           056031
     C***********ORCRT     IFEQ 'N'                        B005           056031
     C************                                                        056031
     C****OBTAIN*RECEIVERS CORRESPONDENT DETAILS - NOSTRO                 056031
     C************                                                        056031
     C*********************MOVELOSMCY     PRO                             S01194
     C*********************MOVELORCCO     WORK02                          S01194
     C*********************MOVE WORK02    PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B006           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E006           S01194
     C************IN75*****IFEQ '1'                        B006           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD26        DBASE            * DBERR 26 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X006           S01194
     C************                                                  S01194056031
     C************         MOVELOSMCY     NOSCCY                    S01194056031
     C************         MOVELORCCO     NOSNUM                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************                                                  S01194056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE OSMCY     CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C*********************END                             E006           S01194
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B006           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E006           056031
     C************IN75     IFEQ '1'                        B006           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD27        DBASE            * DBERR 27 *   056031
     C************         MOVELACCKY     DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E006           056031
     C***********ATYP      IFEQ 'R'                        B006           056031
     C************         SETON                     88                   056031
     C************         SETON                     39                   056031
     C************         END                             E006           056031
     C************         END                             E005           056031
     C************                                                        056031
     C****OBTAIN*RECEIVERS CORRESPONDENT DETAILS - RETAIL NUMBER          056031
     C************                                                        056031
     C***********ORCRT     IFEQ 'R'                        B005           056031
     C************         MOVELORCCO     RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C************IN75     IFEQ '0'                        B006           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         ELSE                            X006           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************                                                        056031
     C************         END                             E006           056031
     C************IN75     IFEQ '1'                        B006           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD28        DBASE            * DBERR 28 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E006           056031
     C************         END                             E005           056031
     C************         END                             E004           056031
     C***********ORCCO     IFEQ *ZERO                      B004           056031
     C************                                                        056031
     C****OBTAIN*COLLECTING BANK DETAILS - FULL NOSTRO                    056031
     C************                                                        056031
     C***********OCOBT     IFEQ 'F'                        B005           056031
     C*********************MOVELOCOB1     PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B006           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E006           S01194
     C************IN75*****IFEQ '1'                        B006           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD29        DBASE            * DBERR 29 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X006           S01194
     C************                                                  S01194056031
     C************         MOVELOCOB1     NOSCHN                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************                                                  S01194056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE OSMCY     CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C************         SETON                     39                   056031
     C*********************END                             E006           S01194
     C************         ELSE                            X005           056031
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********OCOBT     IFEQ 'G'                        B006           056031
     C************         MOVELOCOB1     ACCKY                           056031
     C************         ELSE                            X006           056031
     C************         GOTO R2TAG                                     056031
     C************                                                        056031
     C************         END                             E006           056031
     C************         END                             E005           056031
     C************                                                        056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B006           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E006           056031
     C************IN75     IFEQ '1'                        B006           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD30        DBASE            * DBERR 30 *   056031
     C*********************MOVELTBCHN     DBKEY            ************   E29882
     C************         MOVELACCKY     DBKEY     ************   E29882 056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E006           056031
     C***********ATYP      IFEQ 'R'                        B006           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E006           056031
     C************                                                        056031
     C****OBTAIN*COLLECTING BANK DETAILS - RETAIL NUMBER                  056031
     C************                                                        056031
     C***********R2TAG     TAG                                            056031
     C***********OCOBT     IFEQ 'R'                        B005           056031
     C************         SETON                     88                   056031
     C************         MOVELOCOB1     RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C**N75******RECI      COMP 'D'                  7575           047179056031
     C************IN75     IFEQ '1'                        B006           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD31        DBASE            * DBERR 31 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E006           056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E005           056031
     C************         END                             E004           056031
     C************IN88     IFEQ '1'                        B005           056031
     C************         MOVE '0'       *IN36                           056031
     C***********OSLDT*****IFLT DNWD                                      S01194
     C***********OSLDT     IFLT BJDNWD                              S01194056031
     C************         MOVE '1'       *IN36                           056031
     C************         END                                            056031
     C************         Z-ADDOCQAM     MEMAMT                          056031
     C************         Z-ADDOTOCL     MEMAMT                      1   056031
     C************         Z-ADDDSLDT     VUDT                            056031
     C************                                                        056031
     C************         EXSR MEMSUB                                    056031
     C************         END                             E005           056031
     C************         END                             E003           056031
     C************         END                             E001           056031
     C***********CQSQ      IFNE 0                          B001           056031
     C************                                                        056031
     C****CHEQUE*DETAIL                                                   056031
     C************                                                        056031
     C****OBTAIN*DETAILS FOR CREDIT PARTY - NOSTRO                        056031
     C************                                                        056031
     C************         SETOF                     7588                 056031
     C***********CRPT      IFEQ 'N'                        B002           056031
     C*********************MOVELCRCY      PRO                             S01194
     C*********************MOVELCRPY      WORK02                          S01194
     C*********************MOVE WORK02    PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B003           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E003           S01194
     C************IN75*****IFEQ '1'                        B003           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD32        DBASE            * DBERR 32 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X003           S01194
     C************                                                  S01194056031
     C************         MOVELCRCY      NOSCCY                    S01194056031
     C************         MOVELCRPY      NOSNUM                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************                                                  S01194056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE CRCY      CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C************         SETON                     39                   056031
     C*********************END                             E003           S01194
     C************         END                             E002           056031
     C************                                                        056031
     C****OBTAIN*ACCOUNT DETAILS                                          056031
     C************                                                        056031
     C***********CRPT      IFEQ 'P'                        B002           056031
     C*********************MOVELCRPY      ACCKY                           S01117
     C*********************MOVE CRPY      CUSTA                           S01117
     C*********************MOVELCRCY      CUSTA                           S01117
     C*********************MOVE CUSTA     ACCKY                           S01117
     C************         MOVE CRCY      CCYK                      S01117056031
     C************         MOVE CRPC      CNUMK                     S01117056031
     C************         MOVE CRPA      ACODK                     S01117056031
     C************         MOVE CRPS      ACSQK                     S01117056031
     C************         MOVE CRBR      BRCAK                     S01117056031
     C************         END                             E002           056031
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********CRPT      IFEQ 'N'                        B002           056031
     C***********CRPT      OREQ 'P'                                       056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B003           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E003           056031
     C************IN75     IFEQ '1'                        B003           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD33        DBASE            * DBERR 33 *   056031
     C************         MOVELACCKY     DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         ELSE                            X003           056031
     C***********ATYP      IFEQ 'R'                        B004           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C***********CRPT      IFEQ 'P'                        B005           056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         ELSE                            X005           056031
     C************         SETON                     39                   056031
     C************         END                             E005           056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C****RETAIL*NUMBER                                                   056031
     C************                                                        056031
     C***********CRPT      IFEQ 'R'                        B002           056031
     C************         MOVELCRPY      RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C************IN75     IFEQ '0'                        B003           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E003           056031
     C************IN75     IFEQ '1'                        B003           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD34        DBASE            * DBERR 34 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         ELSE                            X003           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C************         MOVE CNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         MOVE ACOD      ACODK                           056031
     C************         MOVE ACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C****MEMOS*UPDATES                                                   056031
     C************                                                        056031
     C************                                                        056031
     C************         MOVE '0'       *IN36                           056031
     C***********CCRVD*****IFLT DNWD                                      S01194
     C***********CCRVD     IFLT BJDNWD                              S01194056031
     C************         MOVE '1'       *IN36                           056031
     C************         END                                            056031
     C************                                                        056031
     C************                                                        056031
     C****INSERT*PROCESSING                                               056031
     C************                                                        056031
     C***********ACT2      IFEQ 'I'                        B002           056031
     C************         Z-ADDCQAM      MEMAMT                          056031
     C************         Z-ADDCCRVD     VUDT                            056031
     C***88*******         EXSR MEMSUB                                    056031
     C************         END                             E001           056031
     C************                                                        056031
     C****DELETE*PROCESSING                                               056031
     C************                                                        056031
     C************IN04     IFEQ '1'                        B001           056031
     C***********ACT2      IFEQ 'D'                        B002           056031
     C************         Z-ADDCQAM      MEMAMT                          056031
     C************         Z-ADDCCRVD     VUDT                            056031
     C***88*******         EXSR MEMADD                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C****AMEND*PROCESSING                                                056031
     C************                                                        056031
     C***********ACT2      IFEQ 'A'                        B001           056031
     C************         Z-ADDCQAM      MEMAMT                          056031
     C************         Z-ADDCCRVD     VUDT                            056031
     C***88*******         EXSR MEMSUB                                    056031
     C************                                                        056031
     C****OBTAIN*FORMER DETAILS AND REVERSE OUT                           056031
     C************                                                        056031
     C************                                                        056031
     C****OBTAIN*DETAILS FOR CREDIT PARTY - NOSTRO                        056031
     C************                                                        056031
     C************         SETOF                     7588                 056031
     C***********OCRPT     IFEQ 'N'                        B002           056031
     C*********************MOVELOCRCY     PRO                             S01194
     C*********************MOVELOCRPY     WORK02                          S01194
     C*********************MOVE WORK02    PRO                             S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE PRO       TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             75                   S01194
     C************IN75*****IFEQ '0'                        B003           S01194
     C***********RECI******ANDNE'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E003           S01194
     C************IN75*****IFEQ '1'                        B003           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD35        DBASE            * DBERR 35 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************ELSE                            X003           S01194
     C************                                                  S01194056031
     C************         MOVELOCRCY     NOSCCY                    S01194056031
     C************         MOVELOCRPY     NOSNUM                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************                                                  S01194056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE OCRCY     CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************         MOVE 'N'       NOWRK                     S01195056031
     C************         SETON                     39                   056031
     C*********************END                             E003           S01194
     C************         END                             E002           056031
     C************                                                        056031
     C****OBTAIN*ACCOUNT DETAILS                                          056031
     C************                                                        056031
     C***********OCRPT     IFEQ 'P'                        B002           056031
     C*********************MOVELOCRPY     ACCKY                           S01117
     C*********************MOVE OCRPY     CUSTA                           S01117
     C*********************MOVELOCRCY     CUSTA                           S01117
     C*********************MOVE CUSTA     ACCKY                           S01117
     C************         MOVE OCRCY     CCYK                      S01117056031
     C************         MOVE OCRPC     CNUMK                     S01117056031
     C************         MOVE OCRPA     ACODK                     S01117056031
     C************         MOVE OCRPS     ACSQK                     S01117056031
     C************         MOVE OCRBR     BRCAK                     S01117056031
     C************         END                             E002           056031
     C************                                                        056031
     C****CHAIN*TO ACCOUNTS FILE                                          056031
     C************                                                        056031
     C***********OCRPT     IFEQ 'N'                        B002           056031
     C***********OCRPT     OREQ 'P'                                       056031
     C***********ACCCHN    CHAINACCNT                75                   056031
     C************IN75     IFEQ '0'                        B003           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E003           056031
     C************IN75     IFEQ '1'                        B003           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACCNT'   DBFILE           ************   056031
     C************         Z-ADD36        DBASE            * DBERR 36 *   056031
     C************         MOVELACCKY     DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         ELSE                            X003           056031
     C***********ATYP      IFEQ 'R'                        B004           056031
     C************         SETON                     88                   056031
     C************                                                        056031
     C****SETON*INDICATOR IF RETAIL IS NOSTRO,TO BLOCK PRODUCTION         056031
     C****OF*ACCOUNT MOVEMENT RECORD FOR RETAIL SIDE                      056031
     C************                                                        056031
     C***********OCRPT     IFEQ 'P'                                       056031
     C***********ACCCHN****CHAINFPRTNF               76    B006           S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C************                                                  S01195056031
     C************         EXSR LOCAT                               S01195056031
     C************                                                  S01195056031
     C**N76*******         SETON                     39                   056031
     C************         ELSE                            X006           056031
     C************         SETON                     39                   056031
     C************         END                             E006           056031
     C************         END                             E004           056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C****RETAIL*NUMBER                                                   056031
     C************                                                        056031
     C***********OCRPT     IFEQ 'R'                        B002           056031
     C************         MOVELOCRPY     RETCHN                          056031
     C***********RETCHN    CHAINACNUMA               75                   056031
     C************IN75     IFEQ '0'                        B003           056031
     C***********RECI      ANDNE'D'                                       056031
     C************         SETON                     75                   056031
     C************         END                             E003           056031
     C************IN75     IFEQ '1'                        B003           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD37        DBASE            * DBERR 37 *   056031
     C************         MOVELRETCHN    DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         ELSE                            X003           056031
     C************         SETON                     88                   056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************IN88     IFEQ '1'                        B001           056031
     C************                                                        056031
     C************         MOVE '0'       *IN36            B002           056031
     C***********OCRVD*****IFLT DNWD                                      S01194
     C***********OCRVD     IFLT BJDNWD                              S01194056031
     C************         MOVE '1'       *IN36                           056031
     C************         END                             E002           056031
     C***********ACT2      IFEQ 'A'                        B002           056031
     C************         Z-ADDOCQAM     MEMAMT                          056031
     C************         Z-ADDOCRVD     VUDT                            056031
     C************                                                  S01195056031
     C************IN39     IFEQ '0'                                 S01195056031
     C************         MOVE BJSLCD    ZLOC                      S01195056031
     C************         MOVE 'S'       NOWRK                     S01195056031
     C************         END                                      S01195056031
     C************                                                  S01195056031
     C************         EXSR MEMADD                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         END                             E001           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
      ************                                                        056031
      ************  Remove PRONO OLPOS and MEMOS                          056031
      ************                                                        056031
     C*****************************************************************   056031
     C************                                                  S01195056031
     C****LOCAT-*SUB-ROUTINE TO SET UP THE LOCATION FOR A PARTY     S01195056031
     C***********DEPENDANT ON BEING A NOSTRO, FOR HOLIDAYS PROCES   S01195056031
     C************                                                  S01195056031
     C***********LOCAT     BEGSR                                    S01195056031
     C************                                                  S01195056031
     C***IF*PARTY*NOSTRO USE NOSTRO LOCATION CODE.                  S01195056031
     C************                                                  S01195056031
     C************IN76     IFEQ '0'                                 S01195056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C**************       MOVE 'N'       NOWRK                     S01195056031
     C************                                                  S01195056031
     C************         ELSE                                     S01195056031
     C************                                                  S01195056031
     C*PARTY*IS*NON-NOSTRO USE SYSTEM LOCATION CODE                 S01195056031
     C************                                                  S01195056031
     C************         MOVE BJSLCD    ZLOC                      S01195056031
     C************         MOVE 'S'       NOWRK                     S01195056031
     C************         END                                      S01195056031
     C************                                                  S01195056031
     C************         ENDSR                                    S01195056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****OLPADD*- S.R. TO ADD AMOUNT TO INCOMING TOTAL ON OLPOS          056031
     C************                                                        056031
     C***********OLPADD    BEGSR                                          056031
     C************         SETOF                     7576                 056031
     C************                                                        056031
     C****CHECK*THAT OLPOS RECORD EXISTS                                  056031
     C************                                                        056031
     C***********OLPO      CHAINOLPOS                75                   056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C**IF*DATE*LESS THAN FIRST DATE RELEASE AND IGNORE                   056031
     C***********OLPDT     IFLT OLD,1                      B002           056031
     C************         EXCPTROLPOS                                    056031
     C************         ELSE                            X002           056031
     C************         TIME           TIM     60                      056031
     C************         MOVE TIM       TNLU                            056031
     C************                                                        056031
     C****IF*DATE*IS GREATER THAN FINAL OLPOS DATE UPDATE LAST AMT.       056031
     C************                                                        056031
     C***********OLPDT     IFGT OLD,16                     B002           056031
     C************         ADD  OLAMT     OIN,16                          056031
     C************         UPDATOLPOSOAF                                  056031
     C************         ELSE                            X002           056031
     C************                                                        056031
     C****UPDATE*RELEVANT AMOUNT FOR OTHER DATES                          056031
     C************                                                        056031
     C************         Z-ADD1         K       20                      056031
     C***********OLPDT     LOKUPOLD,K                  7576               056031
     C************IN75     IFEQ '1'                        B003           056031
     C************IN76     OREQ '1'                                       056031
     C************         ADD  OLAMT     OIN,K                           056031
     C************         UPDATOLPOSOAF                                  056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****OLPSUB*- S.R. TO ADD AMOUNTS TO OUTGOING TOTAL ON OLPOS         056031
     C************                                                        056031
     C***********OLPSUB    BEGSR                                          056031
     C************         SETOF                     7576                 056031
     C************                                                        056031
     C****CHECK*THAT OLPOS RECORD EXISTS                                  056031
     C************                                                        056031
     C***********OLPO      CHAINOLPOS                75                   056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C**IF*DATE*LESS THAN FIRST DATE RELEASE AND IGNORE                   056031
     C***********OLPDT     IFLT OLD,1                      B002           056031
     C************         EXCPTROLPOS                                    056031
     C************         ELSE                            X002           056031
     C************         TIME           TIM     60                      056031
     C************         MOVE TIM       TNLU                            056031
     C************                                                        056031
     C****IF*DATE*IS GREATER THAN FINAL OLPOS DATE UPDATE LAST AMT.       056031
     C************                                                        056031
     C***********OLPDT     IFGT OLD,16                     B002           056031
     C************         ADD  OLAMT     OUT,16                          056031
     C************         UPDATOLPOSOAF                                  056031
     C************         ELSE                            X002           056031
     C************                                                        056031
     C****UPDATE*RELEVANT AMOUNT FOR OTHER DATES                          056031
     C************                                                        056031
     C************         Z-ADD1         K       20                      056031
     C***********OLPDT     LOKUPOLD,K                  7576               056031
     C************IN75     IFEQ '1'                        B003           056031
     C************IN76     OREQ '1'                                       056031
     C************         ADD  OLAMT     OUT,K                           056031
     C************         UPDATOLPOSOAF                                  056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****S.R.*PROADD TO UPDATE PROJECTED NOSTRO BALANCES FILE            056031
     C************                                                        056031
     C***********PROADD    BEGSR                                          056031
     C************                                                        056031
     C****CHECK*IF PRONO RECORD EXISTS                                    056031
     C************                                                        056031
     C************         SETOF                     7576                 056031
     C************                                                  E29884056031
     C**STORE**ORIGINAL NOSTRO NUMBER                               E29884056031
     C************                                                  E29884056031
     C************         Z-ADDNOSK      NOSOR   20                E29884056031
     C***********PRON      CHAINPRONO                75                   056031
     C************                                                  E29884056031
     C**IF*PRONO*RECORD NOT FOUND TRY UNALLOCATED NOSTRO            E29884056031
     C************                                                  E29884056031
     C************IN75     IFEQ '1'                                 E29884056031
     C***********RECI      ORNE 'D'                                 E29884056031
     C************         Z-ADD0         NOSK                      E29884056031
     C***********PRON      CHAINPRONO                75             E29884056031
     C************         END                                      E29884056031
     C************                                                  E29884056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C************                                                        056031
     C****CHECK*FOR DATE BEING GREATER THAN LAST PRONO DATE               056031
     C************                                                        056031
     C***********PRODT     IFLE PDT,5                      B002           056031
     C************                                                        056031
     C****UPDATE*RELEVANT PRONO AMOUNTS                                   056031
     C************                                                        056031
     C************         Z-ADD1         L       10                      056031
     C***********PRODT     LOKUPPDT,L                  7576               056031
     C************IN75     IFEQ '1'                        B003           056031
     C************IN76     OREQ '1'                                       056031
     C************         Z-ADDPNV       PNO                             056031
     C***********L         DOUEQ6                          B004           056031
     C************         ADD  PRAMT     PNV,L                           056031
     C************         ADD  1         L                               056031
     C************         END                             E004           056031
     C************         UPDATPRONOPNF                                  056031
     C************         Z-ADDPRODT     VUDT                            056031
     C************         Z-ADDPRAMT     MVAM                            056031
     C************         SETON                     39                   056031
     C***RE-INSTATE ORIGINAL NOSTRO NO. IF UNALLOCATED NOSTRO NO    E29884056031
     C************         Z-ADDNOSOR     NOSN                      E29884056031
     C************         EXSR AMOVTS                                    056031
     C************         END                             E003           056031
     C************         ELSE                            X002           056031
     C**NOT*UPDATE SO RELEASE                                             056031
     C************         EXCPTRPRONO                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT                                                              056031
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****S.R.*PROSUB TO UPDATE PROJECTED NOSTRO BALANCES FILE            056031
     C************                                                        056031
     C***********PROSUB    BEGSR                                          056031
     C************                                                        056031
     C****CHECK*IF PRONO RECORD EXISTS                                    056031
     C************                                                        056031
     C************         SETOF                     7576                 056031
     C************                                                  E29884056031
     C**STORE**ORIGINAL NOSTRO NUMBER                               E29884056031
     C************                                                  E29884056031
     C************         Z-ADDNOSK      NOSOR   20                E29884056031
     C***********PRON      CHAINPRONO                75                   056031
     C************                                                  E29884056031
     C**IF*PRONO*RECORD NOT FOUND TRY UNALLOCATED NOSTRO            E29884056031
     C************                                                  E29884056031
     C************IN75     IFEQ '1'                                 E29884056031
     C***********RECI      ORNE 'D'                                 E29884056031
     C************         Z-ADD0         NOSK                      E29884056031
     C***********PRON      CHAINPRONO                75             E29884056031
     C************         END                                      E29884056031
     C************                                                  E29884056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C************                                                        056031
     C****CHECK*FOR DATE BEING GREATER THAN LAST PRONO DATE               056031
     C************                                                        056031
     C***********PRODT     IFLE PDT,5                      B002           056031
     C************                                                        056031
     C****UPDATE*RELEVANT PRONO AMOUNTS                                   056031
     C************                                                        056031
     C************         Z-ADD1         L                               056031
     C***********PRODT     LOKUPPDT,L                  7576               056031
     C************IN75     IFEQ '1'                        B003           056031
     C************IN76     OREQ '1'                                       056031
     C************         Z-ADDPNV       PNO                             056031
     C***********L         DOUEQ6                          B004           056031
     C************         SUB  PRAMT     PNV,L                           056031
     C************         ADD  1         L                               056031
     C************         END                             E004           056031
     C************         UPDATPRONOPNF                                  056031
     C************         Z-ADDPRODT     VUDT                            056031
     C************         Z-ADDPRAMT     MVAM                            056031
     C************         SETON                     39                   056031
     C***RE-INSTATE ORIGINAL NOSTRO NO. IF UNALLOCATED NOSTRO NO US  E2988056031
     C************         Z-ADDNOSOR     NOSN                       E2988056031
     C************         EXSR AMOVTS                                    056031
     C************         END                             E003           056031
     C************         ELSE                            X002           056031
     C**NOT*UPDATE SO RELEASE                                             056031
     C************         EXCPTRPRONO                                    056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****S.R.*MEMSUB TO SUBTRACT AMOUNTS FROM SHADOW BALANCES            056031
     C************                                                        056031
     C***********MEMSUB    BEGSR                                          056031
     C***********RRNM      CHAINMEMOS                75                   056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C************         MOVE MMLDBL    LDBLWK 150                      056031
     C************         SUB  MEMAMT    MMLDBL                          056031
     C************IN36     IFEQ '1'                        B002   E110    056031
     C************         SUB  MEMAMT    MMCLBL                          056031
     C************         END                             E002   E110    056031
     C************         UPDATMEMOSMDF                                  056031
     C************                                                        056031
     C***IF*TYPE*ENTERED NOT A NOSTRO,OR A NOSTRO BUT DEALING MODULE      056031
     C***NOT*PRESENT                                                      056031
     C************IN39     IFEQ '0'                        B002           056031
     C************IN39     OREQ '1'                                       056031
     C************IN30     ANDEQ'0'                                       056031
     C************         SETOF                     39                   056031
     C************         Z-ADDMEMAMT    MVAM                            056031
     C************         EXSR AMOVTS                                    056031
     C************         END                             E002           056031
     C************         ELSE                            X001           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'MEMOS'   DBFILE           ************   056031
     C************         Z-ADD38        DBASE            * DBERR 38 *   056031
     C************         MOVELRRNM      DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C************                                                        056031
     C*****************************************************************   056031
     C************                                                        056031
     C****S.R.*MEMADD TO ADD AMOUNTS TO SHADOW BALANCES                   056031
     C************                                                        056031
     C***********MEMADD    BEGSR                                          056031
     C***********RRNM      CHAINMEMOS                75                   056031
     C************IN75     IFEQ '0'                        B001           056031
     C***********RECI      ANDEQ'D'                                       056031
     C************         MOVE MMLDBL    LDBLWK 150                      056031
     C************         ADD  MEMAMT    MMLDBL                          056031
     C************IN36     IFEQ '1'                        B002   E110    056031
     C************         ADD  MEMAMT    MMCLBL                          056031
     C************         END                             E002   E110    056031
     C************         UPDATMEMOSMDF                                  056031
     C************                                                        056031
     C***IF*TYPE*ENTERED NOT A NOSTRO,OR A NOSTRO BUT DEALING MODULE      056031
     C***NOT*PRESENT                                                      056031
     C************IN39     IFEQ '0'                        B002           056031
     C************IN39     OREQ '1'                                       056031
     C************IN30     ANDEQ'0'                                       056031
     C************         SETOF                     39                   056031
     C************         Z-ADDMEMAMT    MVAM                            056031
     C************         EXSR AMOVTS                                    056031
     C************         END                             E002           056031
     C************         ELSE                            X001           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'MEMOS'   DBFILE           ************   056031
     C************         Z-ADD39        DBASE            * DBERR 39 *   056031
     C************         MOVELRRNM      DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C************************************************************        056031
     C**AMOVT*SUBROUTINE - TO WRITE TO ACCOUNT MOVEMENTS FILE             056031
     C************************************************************        056031
     C************                                                        056031
     C***********AMOVTS    BEGSR                                          056031
     C************                                                        056031
     C***IF*PRONO*RECORD PROCESSED                                        056031
     C************                                                        056031
     C************IN39     IFEQ '1'                        B001           056031
     C************                                                        056031
     C***ACCESS*FULL A/C DETAILS                                          056031
     C************                                                  S01194056031
     C************         MOVELCCY       NOSCCY                    S01194056031
     C************         MOVE NOSN      NOSNUM                    S01194056031
     C************         EXSR AONOS1                              S01194056031
     C************         MOVE NLOC      ZLOC                      S01195056031
     C************                                                  S01194056031
     C*********************MOVE *BLANK    KEY                             S01194
     C*********************MOVEL'70'      KEY                             S01194
     C*********************MOVELCCY       NOSWRK  5                       S01194
     C*********************MOVE NOSN      NOSWRK                          S01194
     C*********************MOVE NOSWRK    KEY                             S01194
     C***********KEY*******CHAINTABLETLF             75                   S01194
     C**N75******RECI******COMP 'D'                  7575                 S01194
     C*********************                                               S01194
     C************IN75*****IFEQ '1'                                       S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070  'DBPGM                           S01194
     C*********************MOVE 'TABLETL' DBFILE           ***************S01194
     C*********************Z-ADD33        DBASE            * DB ERROR 33 *S01194
     C*********************MOVELKEY       DBKEY            *********** ***S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E002           S01194
     C************                                                        056031
     C************         XFOOTPNO       TOT1   150                      056031
     C************         XFOOTPNV       TOT2   150                      056031
     C**IF*NOSTRO*BALANCES INCREASED                                      056031
     C***********TOT1      IFLT TOT2                       B002           056031
     C************         MOVE '0'       DORC                            056031
     C************         ELSE                            X002           056031
     C**IF*NOSTRO*BALANCES DECREASED                                      056031
     C***********TOT1      IFGT TOT2                       B003           056031
     C************         MOVE '1'       DORC                            056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************                                                        056031
     C***IF*MEMO*RECORD PROCESSED                                         056031
     C************                                                        056031
     C************         ELSE                            X001           056031
     C**IF*LEDGER*BALANCE INCREASED                                       056031
     C***********LDBLWK    IFLT MMLDBL                     B002           056031
     C************         MOVE '0'       DORC                            056031
     C************         ELSE                            X002           056031
     C**IF*LEDGER*BALANCE DECREASED                                       056031
     C***********LDBLWK    IFGT MMLDBL                     B003           056031
     C************         MOVE '1'       DORC                            056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************                                                        056031
     C************         MOVE VUDT      PTDT                            056031
     C**SETUP*VALUE DATE OF ENTRY                                         056031
     C************IN94*****DOUNE'1'                        B001           S01194
     C*********************SETOF                       9394               S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'22    '  TBCHN                           S01194
     C*********************MOVELPTDT      ZWRK6   6                       S01194
     C*********************MOVE 1         ZWRK6                           S01194
     C*********************MOVE ZWRK6     TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETJF             93                   S01194
     C**N93******RECI******COMP '*'                      93               S01194
     C************IN93*****IFEQ '0'                        B002           S01194
     C*********************MOVEAHCCY      HCC                             S01194
     C***********CCY*******LOKUPHCC,1                    94               S01194
     C************IN94*****IFEQ '1'                        B003           S01194
     C************                                                  S01195056031
     C***IF*THE*PARTY INVOLVED IS A NOSTRO (EITHER DIRECTLY ENTERE  S01195056031
     C***OR*BACKGROUND) USE RELEVANT CCY AND NOSTRO LOCATION ELSE   S01195056031
     C***USE*SYSTEM LOCATION AND LOCAL CURRENCY.                    S01195056031
     C************                                                  S01195056031
     C***********NOWRK     IFEQ 'N'                                 S01195056031
     C************IN39     OREQ '1'                                 S01195056031
     C************         MOVE CCY       ZCCY                      S01195056031
     C************         ELSE                                     S01195056031
     C************         MOVE BJLCCY    ZCCY                      S01195056031
     C************         END                                      S01195056031
     C************                                                  S01195056031
     C***********ZIND      DOUNE'H'                                 S01195056031
     C************         MOVE PTDT      ZDAYNO                    S01195056031
     C************         EXSR ZCHKH                               S01195056031
     C***********ZIND      IFEQ 'H'                                 S01195056031
     C************         SUB  1         PTDT                            056031
     C*********************END                             E003           S01195
     C************         END                             E002           056031
     C************         END                             E001           056031
     C************         Z-ADDCNUM      CUSN                            056031
     C************         MOVE CCY       CCYD                            056031
     C************         Z-ADDACOD      ACDE                            056031
     C************         Z-ADDACSQ      ASNC                            056031
     C************         MOVE PYTP      TRYP                            056031
     C************         MOVE PREF      TNMR                            056031
     C************         MOVE PREF      FUND                      E32880056031
     C************                                                        056031
     C**AS*DORC*CONTROLS DEBIT/CREDIT,ENTRY MUST ALWAYS BE                056031
     C**INHERENTLY POSITIVE                                               056031
     C************                                                        056031
     C***********MVAM      IFLT *ZERO                                     056031
     C************         Z-SUBMVAM      MVAM                            056031
     C************         END                                            056031
     C**WRITE*DETAILS TO FILE                                             056031
     C************         WRITERSACMTPO                                  056031
     C************         SETOF                     399394               056031
     C************                                                        056031
     C************         ENDSR                                          056031
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. OLDD TO STORE OLD DETAIL RECORD VALUES
     C*
     C           OLDD      BEGSR
     C                     MOVE CRPT      OCRPT   1
     C**********           Z-ADDCRPY      OCRPY  120                                          CGL029
     C**********           Z-ADDCRPY      OCRPY                                        CGL029 CSD027
     C                     MOVE CRPY      OCRPY                                               CSD027
     C                     MOVE CRBR      OCRBR   3                       S01117
     C                     Z-ADDCQAM      OCQAM  130
     C                     MOVE CRCY      OCRCY   3
     C                     Z-ADDRATE      ORATE  138
     C                     MOVE OVRD      OOVRD   1
     C                     Z-ADDCRVD      OCRVD   50
     C                     MOVE TRCT      OTRCT   1
     C                     Z-ADDMDIN      OMDIN   10
     C                     MOVE CDRT      OCDRT   1
     C**********           Z-ADDCDRO      OCDRO  120                                          CGL029
     C***********          Z-ADDCDRO      OCDRO  180                                   CGL029 CSD027
     C                     MOVE CDRO      OCDRO  18                                           CSD027
     C                     MOVE CDBR      OCHBR   3                       S01117
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. OLDH TO STORE OLD HEADER RECORD VALUES
     C*
     C           OLDH      BEGSR
     C                     MOVE COBT      OCOBT   1
     C                     MOVE COB1      OCOB1  35
     C                     MOVE COB2      OCOB2  35
     C                     MOVE COB3      OCOB3  35
     C                     MOVE COB4      OCOB4  35
     C                     MOVE RCRT      ORCRT   1
     C***********          Z-ADDRCCO      ORCCO  100                                          CSD027
     C                     MOVE RCCO      ORCCO  10                                           CSD027
     C                     Z-ADDTOCL      OTOCL  130
     C                     Z-ADDTOTC      OTOTC  130
     C                     Z-ADDDIFF      ODIFF  130
     C                     MOVE SMCY      OSMCY   3
     C                     Z-ADDSLDT      OSLDT   50
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. CUDP TO OBTAIN CURRENCY DECIMAL PLACES AND SPOT RATES
     C*
     C           CUDP      BEGSR
     C*********************MOVELCCYD      SCCY    4                       S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C***********RECI******ORNE 'D'                                       S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVE 'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE           ************   S01194
     C*********************Z-ADD40        DBASE            * DBERR 40 *   S01194
     C*********************MOVELTBCHN     DBKEY            ************   S01194
     C*********************OUT  DLDA                                      S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM CCYD      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*
     C*********************Z-ADDCDP       DP      10                      S01194
     C                     Z-ADDA6NBDP    DP      10                      S01194
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. HEDUP TO UPDATE HEADER WITH CHEQUE DETAILS
     C*
     C           HEDUP     BEGSR
     C                     Z-ADDCQSQ      CQSQS   20
     C                     MOVE PREF      PREFK
     C                     MOVE '00'      CQSQK
     C           CQCHNK    CHAINCQCODDDF             75
     C           *IN75     IFEQ '1'                        B001
     C                     ROLBK
     C           *LOCK     IN   DLDA
     C                     MOVE 'FT0070'  DBPGM
     C                     MOVE 'CQCOD'   DBFILE           ************
     C                     Z-ADD41        DBASE            * DBERR 41 *
     C                     MOVELCQCHN     DBKEY            ************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E001
     C*
     C** RESET AUTH. USERS/INDICATOR IN CASE PARTIAL AUTH. HAS OCCURED
     C*
     C                     MOVE *BLANKS   AUP1
     C                     MOVE *BLANKS   AUP2
     C           AUIN      IFEQ 'Y'                                                         AR804457
     C           AUIN      OREQ 'R'                                                         AR804457
     C                     MOVE 'R'       AUIN                                              AR804457
     C                     ELSE                                                             AR804457
     C                     MOVE *BLANKS   AUIN
     C                     ENDIF                                                            AR804457
     C*
     C**  INSERT PROCESSING
     C*
     C           ACT2      IFEQ 'I'                        B001
     C           TOTC      ADD  CQAM      TOTC
     C           TOCL      SUB  TOTC      DIFF
     C*
     C****OBTAIN*DETAILS*OF*SETTLE*CURRENCY*FROM*CURRENCIES*TABLE***      S01194
     C**  OBTAIN DETAILS OF SETTLE CURRENCY FROM SDCURRPD                 S01194
     C*                                                                   S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELSMCY      SCCY                            S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C*********************SETOF                     75                   S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SMCY      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*                                                                   S01194
     C*********************Z-ADDCDP       PCDP    10                      S01194
     C*********************Z-ADDSPOT      PSPOT  138                      S01194
     C                     Z-ADDA6NBDP    PCDP    10                      S01194
     C                     Z-ADDA6SPRT    PSPOT  138                      S01194
     C                     Z-ADDMDIN      PMDIN   10
     C                     EXSR HDAF
     C                     ADD  1         NCSQ
     C                     UPDATCQCODDDF
     C                     Z-ADDNCSQ      CQSQ
     C                     END                             E001
     C*
     C**  DELETE PROCESSING
     C*
     C           *IN04     IFEQ '1'                        B001
     C           TOTC      SUB  CQAM      TOTC
     C           TOCL      SUB  TOTC      DIFF
     C*
     C****OBTAIN*DETAILS*OF*SETTLE*CURRENCY*FROM*CURRENCIES*TABLE******   S01194
     C**  OBTAIN DETAILS OF SETTLE CURRENCY FROM SDCURRPD                 S01194
     C*                                                                   S01194
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVELSMCY      SCCY                            S01194
     C*********************MOVE '1'       SCCY                            S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C*********************SETOF                     75                   S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C*                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR'  @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM SMCY      @CCY    3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C                     EXSR MVCURR                                    S01194
     C*                                                                   S01194
     C*********************Z-ADDCDP       PCDP    10                      S01194
     C*********************Z-ADDSPOT      PSPOT  138                      S01194
     C                     Z-ADDA6NBDP    PCDP    10                      S01194
     C                     Z-ADDA6SPRT    PSPOT  138                      S01194
     C                     Z-ADDMDIN      PMDIN   10
     C                     EXSR HDAF
     C                     UPDATCQCODDDF               75
     C                     Z-ADDCQSQS     CQSQ
     C                     END                             E001
     C*
     C**  AMEND PROCESSING
     C*
     C           ACT2      IFEQ 'A'                        B001
     C           TOTC      SUB  OCQAM     TOTC
     C           TOTC      ADD  CQAM      TOTC
     C           TOCL      SUB  TOTC      DIFF
     C/COPY WNCPYSRC,FT0070C069
     C                     EXSR HDAF
     C                     UPDATCQCODDDF
     C                     Z-ADDCQSQS     CQSQ
     C                     END                             E001
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. DDAF TO ASSIGN VALUES TO DAF FIELDS FOR DETAIL RECORD
     C*
     C           DDAF      BEGSR
     C*
     C**  CREDIT VALUE DATE
     C*
     C                     MOVE CRVD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAFDT1
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE D3        YR
     C                     MOVE D1        MO
     C                     MOVE D2        DA
     C                     ELSE                            X001
     C                     MOVE D3        YR
     C                     MOVE D2        MO
     C                     MOVE D1        DA
     C                     END                             E001
     C                     MOVE ZDATE     CRVDD1
     C           CRVD      IFLE 10227                      B001
     C                     Z-ADD19        CRVDD2
     C                     ELSE                            X001
     C                     Z-ADD20        CRVDD2
     C                     END                             E001
     C                     MOVE ODAF3     CRVDD3
     C*
     C**  ORIGINAL ENTRY DATE
     C*
     C                     MOVE OEDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAFDT1
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE D3        YR
     C                     MOVE D1        MO
     C                     MOVE D2        DA
     C                     ELSE                            X001
     C                     MOVE D3        YR
     C                     MOVE D2        MO
     C                     MOVE D1        DA
     C                     END                             E001
     C                     MOVE ZDATE     OEDTD1
     C           OEDT      IFLE 10227                      B001
     C                     Z-ADD19        OEDTD2
     C                     ELSE                            X001
     C                     Z-ADD20        OEDTD2
     C                     END                             E001
     C                     MOVE ODAF3     OEDTD3
     C*
     C**  AMOUNTS PROCESSING
     C*
     C/COPY WNCPYSRC,FT0070C076
     C* CALCULATE PAY CURRENCY EQUIVALENT
     C*
     C                     MOVE SMCY      CURR1   3
     C                     MOVE CRCY      CURR2   3
     C                     Z-ADDCQAM      CQAMNT 130
     C                     Z-ADDSMDIN     MDINN   10
     C                     EXSR CURRY
     C/COPY WNCPYSRC,FT0070C077
     C**  CHEQUE AMOUNT IS IN HEADER CCY
     C*
     C           PCDP      IFEQ 0                          B001
     C                     Z-ADDCQAM      CQAMD
     C                     END                             E001
     C           PCDP      IFEQ 1                          B001
     C           CQAM      DIV  10        CQAMD
     C                     END                             E001
     C           PCDP      IFEQ 2                          B001
     C           CQAM      DIV  100       CQAMD
     C                     END                             E001
     C           PCDP      IFEQ 3                          B001
     C           CQAM      DIV  1000      CQAMD
     C                     END                             E001
     C*
     C**  CHARGES ARE IN CHARGE CCY - CHQ CCY OR BASE CCY
     C*
     C***********CDRO      IFEQ 0                          B001                               CSD027
     C           CDRO      IFEQ *BLANKS                    B001                               CSD027
     C                     Z-ADDCCDP      CDPWK   10
     C                     ELSE                            X001
     C                     Z-ADDBCDP      CDPWK
     C                     END                             E001
     C*
     C                     Z-ADDTRCM      TRCMD
     C                     Z-ADDCOLL      COLLD
     C                     Z-ADDCSTA      CSTAD
     C                     Z-ADDTXCH      TXCHD
     C                     DO   CDPWK
     C                     DIV  10        TRCMD
     C                     DIV  10        COLLD
     C                     DIV  10        CSTAD
     C                     DIV  10        TXCHD
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C************************************************************     ***
     C* CURRY SR.
     C* TO CALCULATE CROSS CALCULATION AND BASE EQUIV OF SAME
     C************************************************************     ***
     C*
     C***********CURRY     BEGSR                                          E25169
     C***********                                                         E25169
     C***********          Z-ADD1         Z       30                      E25169
     C***********CURR1     LOKUPCCYA,Z                   88               E25169
     C***********                                                         E25169
     C************IN88     IFEQ '0'                        B001           E25169
     C************LOCK     IN   DLDA                                      E25169
     C***********          MOVE 'FT0070'  DBPGM            ***************E25169
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 11 *E25169
     C***********          Z-ADD11        DBASE            ***************E25169
     C***********          MOVE CURR1     DBKEY                           E25169
     C***********          OUT  DLDA                                      E25169
     C***********          SETON                     U7U8LR               E25169
     C***********          DUMP                                           E25169
     C***********          RETRN                                          E25169
     C***********          END                             E001           E25169
     C***********          Z-ADDCDPA,Z    CDP1    30                      E25169
     C***********                                                         E25169
     C***********          Z-ADD1         Z       30                      E25169
     C***********CURR2     LOKUPCCYA,Z                   88               E25169
     C***********                                                         E25169
     C************IN88     IFEQ '0'                        B001           E25169
     C************LOCK     IN   DLDA                                      E25169
     C***********          MOVE 'FT0070'  DBPGM            ***************E25169
     C***********          MOVE 'TABLE'   DBFILE           * DB ERROR 12 *E25169
     C***********          Z-ADD12        DBASE            ***************E25169
     C***********          MOVE CURR1     DBKEY                           E25169
     C***********          OUT  DLDA                                      E25169
     C***********          SETON                     U7U8LR               E25169
     C***********          DUMP                                           E25169
     C***********          RETRN                                          E25169
     C***********          END                             E001           E25169
     C***********          Z-ADDCDPA,Z    CDP2    30                      E25169
     C***********          Z-ADDSPTA,Z    SPOT2  138                      E25169
     C***********          Z-ADDMDA,Z     MDIN2  138                      E25169
     C***********CDP1      SUB  CDP2      N       10                      E25169
     C***********N         ADD  4         N                               E25169
     C***********CURR1*****IFEQ BCCY                       B001     S01194E25169
     C***********CURR1*****IFEQ BJCYCD                              S01194E25169
     C***********MDINN     IFEQ 0                          B002           E25169
     C***********RATE      DIV  POWER,N   WK159  159H                     E25169
     C***********CQAMNT    MULT WK159     AMTC   130H                     E25169
     C***********          ELSE                            X002           E25169
     C***********RATE      MULT POWER,N   WK159  159H                     E25169
     C***********CQAMNT    DIV  WK159     AMTC      H                     E25169
     C***********          END                             E002           E25169
     C***********          ELSE                            X001           E25169
     C***********MDINN     IFEQ 1                          B002           E25169
     C***********RATE      DIV  POWER,N   WK159  159H                     E25169
     C***********CQAMNT    MULT WK159     AMTC      H                     E25169
     C***********          ELSE                            X002           E25169
     C***********RATE      MULT POWER,N   WK159  159H                     E25169
     C***********CQAMNT    DIV  WK159     AMTC      H                     E25169
     C***********          END                             E002           E25169
     C***********          END                             E001           E25169
     C****CONVERT RECEIVE CURRENCY AMOUNT TO BASE CURRENCY                E25169
     C***********CDP2      SUB  BCDP      N       10                      E25169
     C***********N         ADD  4         N                               E25169
     C***********                                                         E25169
     C***********MDIN2     IFEQ 1                          B001           E25169
     C***********SPOT2     DIV  POWER,N   WK159  159H                     E25169
     C***********AMTC      MULT WK159     RBCQ   130H               E21597E25169
     C***********AMTC      MULT WK159     PBCQ      H               E21597E25169
     C***********          ELSE                            X001           E25169
     C***********SPOT2     MULT POWER,N   WK159     H                     E25169
     C***********AMTC      DIV  WK159     RBCQ      H               E21597E25169
     C***********AMTC      DIV  WK159     PBCQ      H               E21597E25169
     C***********          END                             E001           E25169
     C***********                                                         E25169
     C***********          ENDSR                                          E25169
     C*
     C           CURRY     BEGSR                                          E25169
      *                                                                   059850
      *  Set up subroutine stack name                                     059850
      *                                                                   059850
     C                     ADD  1         Q                               059850
     C                     MOVEL'CURRY '  @STK,Q                          059850
      *                                                                   E25169
      ** Is the base amount already available, if yes then use it.        E25169
     C           CURR1     IFEQ BJCYCD                     Settle is base E25169
     C                     Z-ADDCQAM      PBCQ                            E25169
     C                     GOTO TIKKA                                     E25169
     C                     END                                            E25169
      *                                                                   E25169
     C***********CURR2     IFEQ BJCYCD                     CR Pty isE25169048377
     C***********          Z-ADDCCYAM     PBCQ                      E25169048377
     C***********          GOTO TIKKA                               E25169048377
     C***********          END                                      E25169048377
      ************                                                        059850
      ************                                                  E25169059850
      ***Base*is*not involved, so calc Base Equiv from Credit CurrenE25169059850
      ***Amount*at SPOT.                                            E25169059850
     C************         Z-ADD1         Z       30                E25169059850
     C***********CURR1     LOKUPCCYA,Z                   88         E25169059850
     C************                                                  E25169059850
     C************IN88     IFEQ '0'                        B001     E25169059850
     C************LOCK     IN   DLDA                                E25169059850
     C************         MOVE 'FT0070'  DBPGM            *********E25169059850
     C************         MOVE 'SDCURRPD'DBFILE           * DB ERROE25169059850
     C************         Z-ADD11        DBASE            *********E25169059850
     C************         MOVE CURR2     DBKEY                     E25169059850
     C************         OUT  DLDA                                E25169059850
     C************         SETON                     U7U8LR         E25169059850
     C************         DUMP                                     E25169059850
      ***Allocate*dataarea to blanks                                048377059850
     C************         EXSR DALLOC                              048377059850
     C************         RETRN                                    E25169059850
     C************         END                                      E25169059850
      ************                                                  E25169059850
     C***********MDA,Z     IFEQ 0                                   E25169059850
     C***********CQAMNT    DIV  SPTA,Z    PBCQ      H               E25169059850
     C************         ELSE                                     E25169059850
     C***********CQAMNT    MULT SPTA,Z    PBCQ      H               E25169059850
     C************         END                                      E25169059850
      *                                                                   059850
      * Use CCYAM if credit currency is base as always calculated         059850
      *                                                                   059850
     C           CURR2     IFEQ BJCYCD                     CR Currency    059850
     C                     Z-ADDCCYAM     PBCQ                            059850
     C                     GOTO TIKKA                                     059850
     C                     END                                            059850
      *                                                                   059850
      * Calculate Base currency equivalent from Credit Amount             059850
      *                                                                   059850
     C                     CLEARD#DTA                                     059850
     C                     Z-ADDCCYAM     D#FAMT           CR Amount      059850
     C                     MOVELCRCY      D#FCCY           CR Currency    059850
     C                     MOVELBJCYCD    D#TCCY           Base Ccy       059850
      *                                                                   059850
      * Calculate amount equivalent                                       059850
      *                                                                   059850
     C                     CALL 'AOCCYCV0'             9090               059850
     C           R#RTN     PARM *BLANKS   O#RTN                           059850
     C                     PARM '*F*T*SPT'W0ACT                           059850
     C           D#DTA     PARM D#DTA     O#DTA                           059850
      *                                                                   059850
     C           *IN90     IFEQ '1'                                       059850
     C           R#RTN     ORNE *BLANKS                                   059850
     C                     MOVEL'*CALL   'W0FILE                          059850
     C                     MOVEL'AOCCYCV0'W0KEY                           059850
     C                     Z-ADD11        W0ERNB                          059850
     C                     MOVELERR@,1    W0NARR                          059850
     C                     EXSR SRERR                                     059850
     C                     END                                            059850
      *                                                                   059850
      * Map returned value to Pay Base Currency Equivalent Amount         059850
      *                                                                   059850
     C                     Z-ADDD#TAMT    PBCQ                            059850
     C*                                                                   E25169
     C           TIKKA     TAG                                            E25169
     C/COPY WNCPYSRC,FT0070C078
      *                                                                   059850
      *  Unwind subroutine stack name                                     059850
      *                                                                   059850
     C                     MOVEA*BLANKS   @STK,Q                          059850
     C                     SUB  1         Q                               059850
      *                                                                   059850
     C                     ENDSR                                          E25169
     C************************************************************
     C* END OF CURRENCY SUBROUTINE
     C************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. HDAF TO ASSIGN VALUES TO DAF FIELDS FOR HEADER RECORD
     C*
     C           HDAF      BEGSR
     C*
     C**  SETTLE VALUE DATE
     C*
     C                     MOVE SLDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAFDT1
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE D3        YR
     C                     MOVE D1        MO
     C                     MOVE D2        DA
     C                     ELSE                            X001
     C                     MOVE D3        YR
     C                     MOVE D2        MO
     C                     MOVE D1        DA
     C                     END                             E001
     C                     MOVE ZDATE     SLDTD1
     C           SLDT      IFLE 10227                      B001
     C                     Z-ADD19        SLDTD2
     C                     ELSE                            X001
     C                     Z-ADD20        SLDTD2
     C                     END                             E001
     C                     MOVE ODAF3     SLDTD3
     C*
     C**  ORIGINAL ENTRY DATE
     C*
     C                     MOVE OEDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DAFDT1
     C           *IN98     IFEQ '1'                        B001
     C                     MOVE D3        YR
     C                     MOVE D1        MO
     C                     MOVE D2        DA
     C                     ELSE                            X001
     C                     MOVE D3        YR
     C                     MOVE D2        MO
     C                     MOVE D1        DA
     C                     END                             E001
     C                     MOVE ZDATE     OEDTD1
     C***********OEDT******IFLE 102227                     B001           E30066
     C           OEDT      IFLE 10227                      B001           E33006
     C                     Z-ADD19        OEDTD2
     C                     ELSE                            X001
     C                     Z-ADD20        OEDTD2
     C                     END                             E001
     C                     MOVE ODAF3     OEDTD3
     C*
     C**  AMOUNTS PROCESSING
     C*
     C* CALCULATE BASE CURRENCY EQUIV
     C           PCDP      SUB  BCDP      N       10
     C                     ADD  4         N
     C           PMDIN     IFEQ 0                          B001
     C           PSPOT     MULT POWER,N   WK159     H
     C           TOCL      DIV  WK159     SBCQ      H
     C                     ELSE                            X001
     C           PSPOT     DIV  POWER,N   WK159  159H
     C           TOCL      MULT WK159     SBCQ      H
     C                     END                             E001
     C           PCDP      IFEQ 0                          B001
     C                     Z-ADDTOCL      TOCLD
     C                     Z-ADDTOTC      TOTCD
     C                     Z-ADDDIFF      DIFFD
     C                     END                             E001
     C           PCDP      IFEQ 1                          B001
     C           TOCL      DIV  10        TOCLD
     C           TOTC      DIV  10        TOTCD
     C           DIFF      DIV  10        DIFFD
     C                     END                             E001
     C           PCDP      IFEQ 2                          B001
     C           TOCL      DIV  100       TOCLD
     C           TOTC      DIV  100       TOTCD
     C           DIFF      DIV  100       DIFFD
     C                     END                             E001
     C           PCDP      IFEQ 3                          B001
     C           TOCL      DIV  1000      TOCLD
     C           TOTC      DIV  1000      TOTCD
     C           DIFF      DIV  1000      DIFFD
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*
     C*  SR ACHAIN TO ACCESS THE ACCNT RECORD FOR A NOSTRO
     C*
     C*
     C           ACHAIN    BEGSR
     C*
     C**********           Z-ADDCNUMSV    CNUMK                                               CSD027
     C                     MOVE CNUMSV    CNUMK                                               CSD027
     C                     MOVE CCYSV     CCYK
     C                     Z-ADDACODSV    ACODK
     C                     Z-ADDACSQSV    ACSQK
     C                     MOVE BRCASV    BRCAK                           S01117
     C                     EXSR ACCHN
     C*
     C           *IN75     IFNE '1'                        B001
     C           *LOCK     IN   DLDA
     C                     MOVEL'FT0070'  DBPGM
     C                     MOVEL'ACCNT'   DBFILE           ***************
     C                     Z-ADD42        DBASE            * DB ERROR 42 *
     C                     MOVELACCKY     DBKEY            ***************
     C                     OUT  DLDA
     C                     SETON                     U7U8LR
     C                     DUMP
      *  Allocate dataarea to blanks                                      048377
     C                     EXSR DALLOC                                    048377
     C                     RETRN
     C                     END                             E001
     C*
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. ACCHN TO ACCESS ACCOUNT RECORD
     C*
     C           ACCHN     BEGSR
     C                     SETOF                     7576
     C           ACCCHN    CHAINACCNTABF             76
     C           *IN76     IFEQ '0'                        B001
     C           RECI      ANDEQ'D'
     C                     SETON                     75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C****S.R.*NOCHN*TO*ACCESS*TABLES*NOSTRO*RECORD********************   S01194
     C**  S.R. NOCHN TO ACCESS SDNOSTPD (NO DB ERROR HANDLING)            S01194
     C*
     C           NOCHN     BEGSR
     C*********************SETOF                     7576                 S01194
     C*********************MOVE *BLANKS   TBCHN                           S01194
     C*********************MOVEL'70'      TBCHN                           S01194
     C*********************MOVE NOSCHN    TBCHN                           S01194
     C***********TBCHN*****CHAINTABLETLF             76                   S01194
     C************IN76*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDEQ'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C*                                                                   S01194
     C                     CALL 'AONOSTR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY'    @OPTN   7                       S01194
     C                     PARM *BLANKS   @CUST   6                       S01194
     C                     PARM NOSCCY    @CYCD   3                       S01194
     C**********           PARM *BLANKS   @ACCD   4                                    S01194 CGL029
     C                     PARM *BLANKS   @ACCD                                               CGL029
     C                     PARM *BLANKS   @ACSN   2                       S01194
     C                     PARM NOSNUM    @NONB   2                       S01194
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   @CSSN  10                       S01194
     C                     PARM *BLANKS   @PNOI   1                       S01194
     C           SDNOST    PARM SDNOST    DSSDY                           S01194
     C           @RTCD     CASEQ*BLANKS   MVNOS1         75    EQ         S01194
     C                     END                                            S01194
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************   S01194
     C*********************                                               S01194
     C****S.R.*SNCHN*TO*ACCESS*SHORTNAME*RECORD****                       S01194
     C*********************                                               S01194
     C***********SNCHN*****BEGSR                                          S01194
     C*********************SETOF                     7576                 S01194
     C***********SNMCHN****CHAINSNAME                76                   S01194
     C************IN76*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDEQ'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C*********************ENDSR                                          S01194
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. RECHN TO ACCESS RETAIL A/C NUMBERS RECORD
     C*
     C           RECHN     BEGSR
     C                     SETOF                     7576
     C           RETCHN    CHAINACNUMA               76
     C           *IN76     IFEQ '0'                        B001
     C           RECI      ANDEQ'D'
     C                     SETON                     75
     C                     END                             E001
     C                     ENDSR
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C************************************************************        056031
     C**NOSTRO*SR.                                                        056031
     C**CHECKS*FOR ACCOUNT ENTRIES BEING NOSTROS                          056031
     C************                                                        056031
     C***********NOSTRO    BEGSR                                          056031
     C************                                                        056031
     C************         SETOF                     68                   056031
     C**IF*TYPE*NOT R,P OR G IGNORE                                       056031
     C***********NTYPE     IFEQ 'R'                        B001           056031
     C***********NTYPE     OREQ 'P'                                       056031
     C***********NTYPE     OREQ 'G'                                       056031
     C**IF*RETAIL*NUMBER READ ACNUMA TO GET ACCOUNT DETAILS               056031
     C***********NTYPE     IFEQ 'R'                        B002           056031
     C************         Z-ADDACNON     ACNO                            056031
     C***********ACNO      CHAINACNUMA               88                   056031
     C**N88******RECI      COMP 'D'                  8888                 056031
     C***88*******         DO                              B003           056031
     C************         ROLBK                                          056031
     C************LOCK     IN   DLDA                                      056031
     C************         MOVE 'FT0070'  DBPGM                           056031
     C************         MOVE 'ACNUM'   DBFILE           ************   056031
     C************         Z-ADD44        DBASE            * DBERR 44 *   056031
     C************         MOVELACNO      DBKEY            ************   056031
     C************         OUT  DLDA                                      056031
     C************         SETON                     U7U8LR               056031
     C************         DUMP                                           056031
     C***Allocate*dataarea to blanks                                048377056031
     C************         EXSR DALLOC                              048377056031
     C************         RETRN                                          056031
     C************         END                             E003           056031
     C************         END                             E002           056031
     C**IF*PARTIAL ACCOUNT FORMAT ACCOUNT NUMBER                          056031
     C***********NTYPE     IFEQ 'P'                        B002           056031
     C************         Z-ADDCNUMN     CNUM                            056031
     C************         MOVE NCCY      CCY                             056031
     C************         Z-ADDACODNP    ACOD                            056031
     C************         Z-ADDACSQNP    ACSQ                            056031
     C************         MOVE BRCANP    BRCA                      S01117056031
     C************         END                             E002           056031
     C**IF*FULL*ACCOUNT FORMAT ACCOUNT NUMBER                             056031
     C***********NTYPE     IFEQ 'G'                        B002           056031
     C************         Z-ADDCNUMN     CNUM                            056031
     C************         MOVE CCYN      CCY                             056031
     C************         Z-ADDACODN     ACOD                            056031
     C************         Z-ADDACSQN     ACSQ                            056031
     C************         MOVE BRCAN     BRCA                      S01117056031
     C************         END                             E002           056031
     C************         Z-ADDCNUM      CNUMK                           056031
     C************         MOVE CCY       CCYK                            056031
     C************         Z-ADDACOD      ACODK                           056031
     C************         Z-ADDACSQ      ACSQK                           056031
     C************         MOVE BRCA      BRCAK                     S01117056031
     C************                                                  S01194056031
     C**READ*TABLETL*TO*SEE*IF*A*NOSTRO********************************   S01194
     C***********ACCCHN****CHAINFPRTNF               76                   S01194
     C**N76******RECI******COMP 'D'                  7676                 S01194
     C************         EXSR AONOS2                              S01194056031
     C**N76*******         SETON                     68                   056031
     C************         END                             E001           056031
     C************         ENDSR                                          056031
     C************************************************************        056031
     C**END*OF*NOSTRO SUBROUTINE                                          056031
     C************************************************************        056031
     C/EJECT
     C*****************************************************************   S01194
     C*********************                                               S01194
     C****S.R.*CLCHN*TO*ACCESS*CLIENT*RECORD***                           S01194
     C*********************                                               S01194
     C***********CLCHN*****BEGSR                                          S01194
     C*********************SETOF                     7576                 S01194
     C*********************MOVE 'A'       CLINTA                          S01194
     C*********************MOVELCLICHN    CNUMK                           S01194
     C***********CLKEY*****CHAINCLINT                76                   S01194
     C************IN76*****IFEQ '0'                        B001           S01194
     C***********RECI******ANDEQ'D'                                       S01194
     C*********************SETON                     75                   S01194
     C*********************END                             E001           S01194
     C*********************ENDSR                                          S01194
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C***********************************************************   S01194056031
     C************                                                  S01194056031
     C****S.R.*AONOS1 TO ACCESS SDNOSTPD (WITH DB ERROR HANDLING)   S01194056031
     C*********ACCESS BY CURRENCY/NOSTRO NUMBER                     S01194056031
     C************                                                  S01194056031
     C***********AONOS1    BEGSR                                    S01194056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM '*DBERR'  @RTCD   7                 S01194056031
     C************         PARM '*KEY'    @OPTN   7                 S01194056031
     C************         PARM *BLANKS   @CUST   6                 S01194056031
     C************         PARM NOSCCY    @CYCD   3                 S01194056031
     C************         PARM *BLANKS   @ACCD   4                 S01194056031
     C************         PARM *BLANKS   @ACSN   2                 S01194056031
     C************         PARM NOSNUM    @NONB   2                 S01194056031
     C************         PARM *BLANKS   @BRCD   3                 S01194056031
     C************         PARM *BLANKS   @CSSN  10                 S01194056031
     C************         PARM *BLANKS   @PNOI   1                 S01194056031
     C***********SDNOST    PARM SDNOST    DSSDY                     S01194056031
     C************         EXSR MVNOS1                              S01194056031
     C************                                                  S01194056031
     C************         ENDSR                                    S01194056031
     C*/EJECT                                                             056031
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C************************************************************* S01194056031
     C************                                                  S01194056031
     C****S.R.*AONOS2 TO ACCESS SDNOSTPD (WITHOUT DB ERROR HANDLING S01194056031
     C*********ACCESS BY CUSTOMER/CURRENCY/ACCOUNT CODE/SEQUENCE/BRCS01194056031
     C************                                                  S01194056031
     C***********AONOS2    BEGSR                                    S01194056031
     C************                                                  S01194056031
     C************         CALL 'AONOSTR0'                          S01194056031
     C************         PARM *BLANKS   @RTCD   7                 S01194056031
     C************         PARM '*KEY'    @OPTN   7                 S01194056031
     C************         PARM CNUMKA    @CUST   6                 S01194056031
     C************         PARM CCYK      @CYCD   3                 S01194056031
     C************         PARM ACODKA    @ACCD   4                 S01194056031
     C************         PARM ACSQKA    @ACSN   2                 S01194056031
     C************         PARM *BLANKS   @NONB   2                 S01194056031
     C************         PARM BRCAK     @BRCD   3                 S01194056031
     C************         PARM *BLANKS   @CSSN  10                 S01194056031
     C************         PARM *BLANKS   @PNOI   1                 S01194056031
     C***********SDNOST    PARM SDNOST    DSSDY                     S01194056031
     C************                                                  S01194056031
     C***********@RTCD     CASEQ*BLANKS   MVNOS2     7676  HILO1    S01194056031
     C************         END                                      S01194056031
     C************                                                  S01194056031
     C************         ENDSR                                    S01194056031
     C/EJECT
     C*****************************************************************   S01194
     C*                                                                   S01194
     C**  SUBROUTINE TO MOVE SYNON FIELDS TO OLD EQUIVALENT               S01194
     C**       WHEN RECORD RETRIEVED WITH ACCESS PROGRAM                  S01194
     C*                                                                   S01194
     C           MVCURR    BEGSR                                          S01194
     C*          ~~~~~~                                                   S01194
     C           A6MDIN    IFEQ 'M'                                       S01194
     C                     Z-ADD1         MDIN                            S01194
     C                     ELSE                                           S01194
     C                     Z-ADD0         MDIN                            S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C/EJECT                                                              S01194
     C*****************************************************************   S01194
     C*                                                                   S01194
     C**  SUBROUTINE TO MOVE SYNON FIELDS TO OLD EQUIVALENT               S01194
     C**       WHEN RECORD RETRIEVED WITH ACCESS PROGRAM                  S01194
     C*                                                                   S01194
     C           MVNOS1    BEGSR                                          S01194
     C*          ~~~~~~                                                   S01194
     C                     MOVE A7ACCD    ACOD                            S01194
     C                     MOVE A7ACSN    ACSQ                            S01194
     C                     MOVE A7CUST    CNUM                            S01194
     C                     MOVE A7BRCD    BRCA                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C/EJECT                                                              S01194
     C*****************************************************************   S01194
     C*                                                                   S01194
     C**  SUBROUTINE TO MOVE SYNON FIELDS TO OLD EQUIVALENT               S01194
     C**       WHEN RECORD RETRIEVED WITH ACCESS PROGRAM                  S01194
     C*                                                                   S01194
     C           MVNOS2    BEGSR                                          S01194
     C*          ~~~~~~                                                   S01194
     C           *LIKE     DEFN A7NOSN    CSNM                            056031
     C           *LIKE     DEFN A7NONB    NOSN                            056031
     C*                                                                   056031
     C                     MOVE A7ACCD    ACOD                            S01194
     C                     MOVE A7ACSN    ACSQ                            S01194
     C                     MOVE A7CYCD    CCY                             S01194
     C                     MOVE A7CUST    CNUM                            S01194
     C                     MOVE A7NOSN    CSNM                            S01194
     C                     MOVE A7NONB    NOSN                            S01194
     C                     MOVE A7BRCD    BRCA                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C*                                                                   S01194
     C/EJECT                                                              S01194
     C*****************************************************************   S01194
     C*                                                                   S01194
     C**  SUBROUTINE TO MOVE SYNON FIELDS TO OLD EQUIVALENT               S01194
     C**       WHEN RECORD RETRIEVED WITH ACCESS PROGRAM                  S01194
     C*                                                                   S01194
     C           MVCUST    BEGSR                                          S01194
     C*          ~~~~~~                                                   S01194
     C                     MOVE BBCUST    CNUM                            S01194
     C                     MOVE BBCSID    CSID   12                       S01194
     C                     MOVE BBCSSN    CSNM                            S01194
     C*                                                                   S01194
     C                     ENDSR                                          S01194
     C/EJECT
     C*****************************************************************   S01117
     C*                                                                   S01117
     C**  SUBROUTINE TO HANDLE SPF AUTHORITY VALIDATION FOR THE           S01117
     C**  INITIAL SCREEN (FT0070F1), FOR MULTI-BRANCHED ENVIROMENT        S01117
     C**  IT CHECKS AUTHORITY TO :-                                       S01117
     C**      1) BOOKING BRANCH WHETHER ENTERED OR FROM EXISTING RECORD   S01117
     C**  AND 2) ORIGINATING BRANCH WHEN FROM AN EXISTING RECORD          S01117
     C*                                                                   S01117
     C           SPF       BEGSR                                          S01117
     C*          ~~~                                                      S01117
     C** ONLY ALLOW ENTRY OF BOOKING BRANCH IF INSERTING HEADER           S01117
     C**  I.E. ACTION = I AND PAYMENT REF = BLANK                         S01117
     C*                                                                   S01117
     C           SACTD     IFNE 'I'                        B001           S01117
     C           SPREF     ORNE *BLANKS                                   S01117
     C*                                                                   S01117
     C           SBKGBR    IFNE *BLANKS                    B002           S01117
     C                     SETON                     3789                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 013'    ERCD,S                          S01117
     C*                                                                   S01117
     C** ELSE SET BOOKING BRANCH FROM FILE FOR AUTHORITY CHECK LATER      S01117
     C*                                                                   S01117
     C                     ELSE                            X002           S01117
     C                     MOVE BKGBR     @BOBR   3                       S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C** VALIDATE BOOKING BRANCH ENTRY IF INSERTING HEADER                S01117
     C*                                                                   S01117
     C           SACTD     IFEQ 'I'                        B001           S01117
     C           SPREF     ANDEQ*BLANKS                                   S01117
     C*                                                                   S01117
     C** CHECK FOR ?                                                      S01117
     C                     MOVEA*BLANKS   FLDQ                            S01117
     C                     MOVEASBKGBR    FLDQ                            S01117
     C           '?'       LOKUPFLDQ                     15               S01117
     C   15                SETON                         16               S01117
     C*                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM SBKGBR    @BRCD   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFEQ '*NOSEL'                   B002           S01117
     C           SBKGBR    OREQ *BLANKS                                   S01117
     C                     MOVE DBRN      SBKGBR                          S01117
     C                     MOVE DBRN      @BOBR                           S01117
     C                     SETON                     16                   S01117
     C                     ELSE                            X002           S01117
     C*                                                                   S01117
     C           @RTCD     IFEQ *BLANKS                    B003           S01117
     C                     MOVE A8BRCD    SBKGBR                          S01117
     C                     MOVE A8BRCD    @BOBR                           S01117
     C                     ELSE                            X003           S01117
     C                     SETON                     3789                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 012'    ERCD,S                          S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C** NO ERROR SO FAR                                                  S01117
     C*                                                                   S01117
     C           *IN89     IFEQ '0'                        B001           S01117
     C           @GL442    IFNE 'Y'                                       096486
     C                     CALL 'ZVACTBU'                                 S01117
     C                     PARM SACTD     @ACTN   1                       S01117
     C                     PARM @BOBR     @BRCD   3                       S01117
     C                     PARM           ERR     10                      S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          B002           S01117
     C                     SETON                     3789                 S01117
     C                     MOVE @BOBR     SBKGBR                          S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 303'    ERCD,S                          S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          B002           S01117
     C                     SETON                     3789                 S01117
     C                     MOVE @BOBR     SBKGBR                          S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 304'    ERCD,S                          S01117
     C                     END                             E002           S01117
     C                     END                                            096486
     C*                                                                   S01117
     C** IF BOOKING BRANCH VALID AND USER AUTHORISED MOVE TO FILE FIELD   S01117
     C*                                                                   S01117
     C           *IN37     IFEQ '0'                                       S01117
     C           *IN89     ANDEQ'0'                                       S01117
     C                     MOVE @BOBR     BKGBR                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C** IF ORIGINATING BRANCH VALIDATION REQUIRED                        S01117
     C**    AND NOT INSERTING HEADER                                      S01117
     C*                                                                   S01117
     C           BKOBUV    IFEQ 'Y'                        B002           S01117
     C           SPREF     ANDNE*BLANKS                                   S01117
     C*                                                                   S01117
     C                     CALL 'ZVOBU'                                   S01117
     C                     PARM ORBR      @BRCD   3                       S01117
     C                     PARM           ERR                             S01117
     C*                                                                   S01117
     C           ERR       IFEQ 1                          B003           S01117
     C                     SETON                     4189                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 305'    ERCD,S                          S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C           ERR       IFEQ 2                          B003           S01117
     C                     SETON                     4189                 S01117
     C                     ADD  1         S                               S01117
     C                     MOVE ' 306'    ERCD,S                          S01117
     C                     END                             E003           S01117
     C*                                                                   S01117
     C                     END                             E002           S01117
     C*                                                                   S01117
     C                     END                             E001           S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C/EJECT
     C*****************************************************************   S01117
     C**                                                                  S01117
     C**  FUNCTION:  TO ACCESS PYCHGDB FILE                               S01117
     C**                                                                  S01117
     C**  CALLS:     NONE                                                 S01117
     C**                                                                  S01117
     C**                                                                  S01117
     C           PYCHG     BEGSR                                          S01117
     C*          ~~~~~                                                    S01117
     C** IF SINGLE BRANCHED USE SINGLE BRANCH CODE                        S01117
     C*                                                                   S01117
     C           *IN20     IFEQ '0'                                       S01117
     C                     MOVE BJSBRC    PYBR    3                       S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** ELSE MULTIBRANCHED                                               S01117
     C** TAKE ORIGINATING BRANCH IF USED, OTHERWISE TAKE BOOKING BRANCH   S01117
     C*                                                                   S01117
     C           *IN21     IFEQ '1'                                       S01117
     C                     MOVE ORBR      PYBR                            S01117
     C                     ELSE                                           S01117
     C                     MOVE BKGBR     PYBR                            S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C           PYBR      CHAINPYCHGDB              75    Get defaults.  S01117
     C********** *IN75     IFEQ '1'                        B001                      S01117 MD039163
     C**********           ROLBK                                                     S01117 MD039163
     C********** *LOCK     IN   DLDA                                                 S01117 MD039163
     C**********           MOVEL'FT0070'  DBPGM                                      S01117 MD039163
     C**********           MOVEL'PYCHGDB' DBFILE                                     S01117 MD039163
     C**********           Z-ADD4         DBASE            ************              S01117 MD039163
     C**********           MOVELPYBR      DBKEY            * DBERR 04 *              S01117 MD039163
     C**********           OUT  DLDA                       ************              S01117 MD039163
     C**********           SETON                     U7U8LR                          S01117 MD039163
     C**********           DUMP                                                      S01117 MD039163
      **********                                                                     048377 MD039163
      ***Allocate*dataarea*to*blanks***********************************              048377 MD039163
      **********                                                                     048377 MD039163
     C**********           EXSR DALLOC                                               048377 MD039163
     C**********           RETRN                                                     S01117 MD039163
     C**********           END                             E001                      S01117 MD039163
     C*
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C/EJECT                                                              S01117
     C*****************************************************************
     C*
     C**  S.R. CLSCRN TO CLEAR CHEQUE DETAIL SCREEN
     C*
     C           CLSCRN    BEGSR
     C                     MOVE *BLANKS   SCRPA
     C                     MOVE *BLANKS   SCRBR                           S01117
     C                     MOVE *BLANKS   SCQAM
     C***********          MOVE SSMCY     SCCCY                           051022
     C                     MOVE *BLANKS   SCCCY                           051022
     C***********          MOVE DAFDT1    SCVDA                           049860
     C                     MOVE *BLANKS   SCVDA                           049860
     C                     MOVE *BLANKS   SRATE
     C                     MOVE *BLANKS   SOVER
     C                     MOVE *BLANKS   SDES1
     C                     MOVE *BLANKS   SDES2
     C                     MOVE *BLANKS   SDES3
     C                     MOVE *BLANKS   SDES4
     C                     MOVE *BLANKS   SDES5
     C                     MOVE *BLANKS   SDES6
     C                     MOVE *BLANKS   SCOLLE
     C                     MOVE *BLANKS   STXCHE
     C                     MOVE *BLANKS   STRCME
     C                     MOVE *BLANKS   SCHCME                          S01494
     C                     MOVE *BLANKS   SVATTE                          S01499
     C                     MOVE *BLANKS   SCSTAE
     C                     MOVE *BLANKS   SCOLLF
     C                     MOVE *BLANKS   STXCHF
     C                     MOVE *BLANKS   STRCMF
     C                     MOVE *BLANKS   SCHCMF                          S01494
     C                     MOVE *BLANKS   SVATTF                          S01499
     C                     MOVE *BLANKS   SCSTAF
     C                     MOVE *BLANKS   SCHDB
     C                     MOVE *BLANKS   SCDBR                           S01117
     C                     MOVE *ZEROS    SDUMA1
     C                     MOVE *ZEROS    SDUMA2
     C                     MOVE *ZEROS    SDUMA3
     C                     MOVE *ZEROS    SDUMA4
     C                     MOVE *ZEROS    SDUMA5                          S01494
     C                     MOVE *ZEROS    SDUMA6                          S01499
     C                     MOVE *BLANKS   SDBC1
     C                     MOVE *BLANKS   SDBC2
     C                     MOVE *BLANKS   SDBC3
     C                     MOVE *BLANKS   SDBC4
     C                     MOVE *BLANKS   SDBC5
     C                     MOVE *BLANKS   SCCYAM                          S10284
     C                     MOVE *BLANKS   SBOKC                           S01414
     C                     MOVE *BLANKS   SPRFC                           S01414
      *                                                                   CEU006
     C                     MOVE *BLANKS   SPDCY                           CEU006
     C                     MOVE *BLANKS   SPDAM                           CEU006
      *                                                                   CEU006
     C*                                                                   S01499
     C** DEFAULT VAT FLAG FOR INSERT                                      S01499
     C*                                                                   S01499
     C           *IN08     IFEQ '1'                                       S01499
     C                     MOVE C#VATT    SVATI1                          S01499
     C                     MOVE C#VATT    SVATI2                          S01499
     C                     MOVE C#VATT    SVATI3                          S01499
     C                     MOVE C#VATT    SVATI4                          S01499
     C           *IN09     IFEQ '1'                                       S01499
     C                     MOVE C#VATT    SVATI5                          S01499
     C                     END                                            S01499
     C                     END                                            S01499
      * Clear fields                                                      CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVE *BLANKS   S#REFR                          CDL049
     C                     Z-ADD0         SEREFR                          CDL049
     C                     Z-ADD0         SWRKRR                          CDL049
     C                     ENDIF                                          CDL049
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. CLRHED TO CLEAR CHEQUE HEADER SCREEN
     C*
     C           CLRHED    BEGSR
     C                     MOVE 'CC'      SPYTP
     C                     MOVE *BLANKS   SORBR                           S01117
     C                     MOVE *BLANKS   SPYST
     C                     MOVE *BLANKS   SCBK1
     C                     MOVE *BLANKS   SCBK2
     C                     MOVE *BLANKS   SCBK3
     C                     MOVE *BLANKS   SCBK4
     C                     MOVE *BLANKS   SRCCO
     C                     MOVE *BLANKS   SSMCY
     C                     MOVE *BLANKS   SPYVD
     C                     MOVE *BLANKS   STCQA
     C                     MOVE *BLANKS   STCRE
     C                     MOVE *BLANKS   SDIFF
     C                     MOVE *BLANKS   SHBOKC                          S01414
     C                     MOVE *BLANKS   SHPRFC                          S01414
      *                                                                   CEU006
     C                     MOVE *BLANKS   SNDCY                           CEU006
     C                     MOVE *BLANKS   SNDAM                           CEU006
      *                                                                   CEU006
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. STATUS TO ALLOCATE RECORD STATUS TO SCREEN
     C*
     C           STATUS    BEGSR
     C**********           MOVE *BLANKS   SSTAT  10                                         AR804457
     C                     MOVE *BLANKS   SSTAT  12                                         AR804457
     C           RECIS     IFEQ 'M'                        B001
     C                     MOVEL'MATURED' SSTAT
     C                     ELSE                            X001
     C           RECIS     IFEQ 'C'                        B002
     C                     MOVEL'DELETED' SSTAT
     C                     ELSE                            X002
     C           AUINS     IFEQ 'Y'                        B003
     C                     MOVEL'AUTHORIS'SSTAT
     C**********           MOVE 'ED'      SSTAT                                             AR804457
     C                     MOVE 'ED  '    SSTAT                                             AR804457
     C                     ELSE                                                             AR804457
     C           AUINS     IFEQ 'R'                                                         AR804457
     C                     MOVEL'REAUTHOR'SSTAT                                             AR804457
     C                     MOVE 'ISE '    SSTAT                                             AR804457
     C                     ENDIF                                                            AR804457
     C                     END                             E003
     C                     END                             E002
     C                     END                             E001
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. PYREF TO ASSIGN PAYMENT REFERENCE TO RECORD
     C*
     C           PYREF     BEGSR
     C           *LOCK     IN   CQCOLD
     C                     Z-ADDSEQNO     SQNO
     C                     MOVE IPREF     PREF
     C                     ADD  1         SEQNO
     C                     OUT  CQCOLD
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. NXDET TO ASSIGN NEXT SEQUENCE FOR CHEQUE INSERT
     C*
     C           NXDET     BEGSR
     C*
     C           ACT2      IFEQ 'I'                        B001
     C                     ADD  1         NCSQ
     C                     END                             E001
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. RESET TO SETOF SCREEN ERROR INDICATORS
     C*
     C           RESET     BEGSR
     C*
     C                     MOVE *ZEROS    ISET   27
     C                     MOVEAISET      *IN,40
     C                     MOVE '0'       *IN33            NEW ERROR CODE S10284
     C*********************MOVE '0'       *IN32      NEW ERROR CODE S10284056823
     C*********************SETOF                     1329                 S01117
      ** Indicator 13 used for Invalid Pay delivery value                 CEU006
     C*********************SETOF                     132938               CEU006
     C                     SETOF                       2938               CEU006
      *                                                                   S01414
     C                     MOVE '0'       *IN83                           S01414
     C                     MOVE '0'       *IN86                           S01414
      *                                                                   S01414
     C                     MOVE '0'       *IN32                           S01494
     C                     MOVE '0'       *IN36                           S01499
     C                     MOVE '0'       *IN39                           S01499
     C                     MOVEA'00'      *IN,05                          S01499
     C                     MOVEA'00'      *IN,10                          S01499
      *                                                                   132123
      ** Reset Warning Indicator.                                         132123
      *                                                                   132123
     C                     MOVE '0'       *IN19                           132123
      *                                                                   CEU006
      ** Notified delivery currency and amount                            CEU006
     C                     MOVE *OFF      *IN02                           CEU006
     C                     MOVE *OFF      *IN88                           CEU006
      ** Pay delivery currency and amount                                 CEU006
     C                     MOVE *OFF      *IN01                           CEU006
     C                     MOVE *OFF      *IN13                           CEU006
      *                                                                   CEU006
      * Reset indicator                                                   CDL049
     C           CDL049    IFEQ 'Y'                                       CDL049
     C                     MOVE '0'       *IN81                           CDL049
     C                     ENDIF                                          CDL049
      *                                                                   CDL049
     C*
     C           SACTD     IFEQ 'I'                        B001
     C                     MOVE '0'       *IN78
     C                     END                             E001
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*
     C**  S.R. HSTR TO STORE VALUES OF HEADER
     C*
     C           HSTR      BEGSR
     C*
     C                     MOVE PYST      PYSTS   2
     C                     MOVE RCRT      RCRTS   1
     C***********          Z-ADDRCCO      RCCOS  100                                          CSD027
     C                     MOVE RCCO      RCCOS  10                                           CSD027
     C                     MOVE COBT      COBTS   1
     C                     MOVE COB1      COBS1  35
     C                     MOVE COB2      COBS2  35
     C                     MOVE COB3      COBS3  35
     C                     MOVE COB4      COBS4  35
     C*
     C                     Z-ADDTOCL      TOCLS  130
     C                     Z-ADDTOCLD     TOCLDS 152
     C                     Z-ADDSBCQ      SBCQS  130
     C                     Z-ADDTOTC      TOTCS  130
     C                     Z-ADDTOTCD     TOTCDS 152
     C                     Z-ADDDIFF      DIFFS  130
     C                     Z-ADDDIFFD     DIFFDS 152
     C                     MOVE SMCY      SMCYS   3
      *                                                                   S01414
     C                     MOVELHBOKC     BOKCHS  2                       S01414
     C                     MOVELHPRFC     PRFCHS  4                       S01414
     C*
     C                     Z-ADDSLDT      SLDTS   50
     C                     Z-ADDSLDTD1    SLDT1S  60
     C                     Z-ADDSLDTD2    SLDT2S  20
     C                     Z-ADDSLDTD3    SLDT3S  60
      *                                                                   CEU006
     C                     MOVE NDCY      NDCYS   3                       CEU006
     C                     Z-ADDNDAM      NDAMS  130                      CEU006
      *                                                                   CEU006
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. HRSTR TO RESTORE VALUES OF HEADER
     C*
     C           HRSTR     BEGSR
     C*
     C                     MOVE PYSTS     PYST
     C                     MOVE COBTS     COBT
     C                     MOVE COBS1     COB1
     C                     MOVE COBS2     COB2
     C                     MOVE COBS3     COB3
     C                     MOVE COBS4     COB4
     C                     MOVE RCRTS     RCRT
     C***********          Z-ADDRCCOS     RCCO                                                CSD027
     C                     MOVE RCCOS     RCCO                                                CSD027
     C*
     C                     Z-ADDTOCLS     TOCL
     C                     Z-ADDTOCLDS    TOCLD
     C                     Z-ADDSBCQS     SBCQ
     C                     Z-ADDTOTCS     TOTC
     C                     Z-ADDTOTCDS    TOTCD
     C                     Z-ADDDIFFS     DIFF
     C                     Z-ADDDIFFDS    DIFFD
     C                     MOVE SMCYS     SMCY
      *                                                                   S01414
     C                     MOVELBOKCHS    HBOKC                           S01414
     C                     MOVELPRFCHS    HPRFC                           S01414
      *                                                                   S01414
     C*
     C                     Z-ADDSLDTS     SLDT
     C                     Z-ADDSLDT1S    SLDTD1
     C                     Z-ADDSLDT2S    SLDTD2
     C                     Z-ADDSLDT3S    SLDTD3
      *                                                                   CEU006
     C                     MOVE NDCYS     NDCY                            CEU006
     C                     Z-ADDNDAMS     NDAM                            CEU006
      *                                                                   CEU006
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C*
     C**  S.R. DSTR TO STORE DETAIL VALUES FOR UPDATE
     C*
     C           DSTR      BEGSR
     C*
     C                     MOVE CRPT      CRPTS   1
     C**********           Z-ADDCRPY      CRPYS  120                                          CGL029
     C***********          Z-ADDCRPY      CRPYS  180                                   CGL029 CSD027
     C                     MOVE CRPY      CRPYS  18                                           CSD027
     C                     MOVE CRBR      CRBRS   3                       S01117
     C                     Z-ADDCQAM      CQAMS  130
     C                     Z-ADDCQAMD     CQAMDS 152
     C                     Z-ADDPBCQ      PBCQS  130
     C                     MOVE CRCY      CRCYS   3
     C                     Z-ADDRATE      RATST  138
     C                     MOVE OVRD      OVRDS   1
     C*
     C                     Z-ADDCRVD      CRVDS   50
     C                     Z-ADDCRVDD1    CRVD1S  60
     C                     Z-ADDCRVDD2    CRVD2S  20
     C                     Z-ADDCRVDD3    CRVD3S  60
      *                                                                   S01414
     C                     MOVELBOKC      BOKCS   2                       S01414
     C                     MOVELPRFC      PRFCS   4                       S01414
      *                                                                   S01414
     C                     MOVE NAR1      NARS1  35
     C                     MOVE NAR2      NARS2  35
     C                     MOVE NAR3      NARS3  35
     C                     MOVE NAR4      NARS4  35
     C                     MOVE NAR5      NARS5  35
     C                     MOVE NAR6      NARS6  35
     C/COPY WNCPYSRC,FT0070C107
     C                     Z-ADDDNBC1     DNBCS1 110
     C                     Z-ADDDNBC2     DNBCS2 110
     C                     Z-ADDDNBC3     DNBCS3 110
     C                     Z-ADDDNBC4     DNBCS4 110
     C                     Z-ADDDNBC5     DNBCS5 110
     C/COPY WNCPYSRC,FT0070C108
     C*
     C                     MOVE TRCT      TRCTS   1
     C                     Z-ADDTRCM      TRCMS  110
     C                     Z-ADDTRCMD     TRCMDS 152
     C                     Z-ADDCOLL      CLCHS  110
     C                     Z-ADDCOLLD     CLCHDS 152
     C                     Z-ADDCSTA      CSTAS  110
     C                     Z-ADDCSTAD     CSTADS 152
     C                     Z-ADDTXCH      TXCHS  110
     C                     Z-ADDTXCHD     TXCHDS 152
     C                     Z-ADDCCCHCM    CHCMS  110                      S01494
     C                     Z-ADDCCVATT    VATTS  110                      S01499
     C                     MOVE CDRT      CDRTS   1
     C**********           Z-ADDCDRO      CDROS  120                                          CGL029
     C***********          Z-ADDCDRO      CDROS  180                                   CGL029 CSD027
     C                     MOVE CDRO      CDROS  18                                           CSD027
     C                     MOVE CDBR      CDBRS   3                       S01117
     C                     MOVE MDIN      MDINS   1
      *                                                                   S10284
     C                     Z-ADDCCYAM     CCYAMS 130                      S10284
      *                                                                   CEU006
     C                     MOVE PDCY      PDCYS   3                       CEU006
     C                     Z-ADDPDAM      PDAMS  130                      CEU006
      *                                                                   CEU006
      *                                                                   S10284
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C*
     C**  S.R. DRSTR TO RESTORE DETAIL VALUES
     C*
     C           DRSTR     BEGSR
     C*
     C                     MOVE CRPTS     CRPT
     C***********          Z-ADDCRPYS     CRPY                                                CSD027
     C                     MOVE CRPYS     CRPY                                                CSD027
     C                     MOVE CRBRS     CRBR                            S01117
     C                     Z-ADDCQAMS     CQAM
     C                     Z-ADDCQAMDS    CQAMD
     C                     Z-ADDPBCQS     PBCQ
     C                     MOVE CRCYS     CRCY
     C                     Z-ADDRATST     RATE
     C                     MOVE OVRDS     OVRD
     C*
     C                     Z-ADDCRVDS     CRVD
     C                     Z-ADDCRVD1S    CRVDD1
     C                     Z-ADDCRVD2S    CRVDD2
     C                     Z-ADDCRVD3S    CRVDD3
      *                                                                   S01414
     C                     MOVELBOKCS     BOKC                            S01414
     C                     MOVELPRFCS     PRFC                            S01414
      *                                                                   S01414
     C                     MOVE NARS1     NAR1
     C                     MOVE NARS2     NAR2
     C                     MOVE NARS3     NAR3
     C                     MOVE NARS4     NAR4
     C                     MOVE NARS5     NAR5
     C                     MOVE NARS6     NAR6
     C/COPY WNCPYSRC,FT0070C109
     C                     Z-ADDDNBCS1    DNBC1
     C                     Z-ADDDNBCS2    DNBC2
     C                     Z-ADDDNBCS3    DNBC3
     C                     Z-ADDDNBCS4    DNBC4
     C                     Z-ADDDNBCS5    DNBC5
     C/COPY WNCPYSRC,FT0070C110
     C*
     C                     MOVE TRCTS     TRCT
     C                     Z-ADDTRCMS     TRCM
     C                     Z-ADDTRCMDS    TRCMD
     C                     Z-ADDCLCHS     COLL
     C                     Z-ADDCLCHDS    COLLD
     C                     Z-ADDCSTAS     CSTA
     C                     Z-ADDCSTADS    CSTAD
     C                     Z-ADDTXCHS     TXCH
     C                     Z-ADDTXCHDS    TXCHD
     C                     Z-ADDCHCMS     CCCHCM                          S01494
     C                     Z-ADDVATTS     CCVATT                          S01499
     C                     MOVE CDRTS     CDRT
     C**********           Z-ADDCDROS     CDRO                                                CSD027
     C                     MOVE CDROS     CDRO                                                CSD027
     C                     MOVE CDBRS     CDBR                            S01117
     C                     MOVE SMDIN     MDIN
      *                                                                   S10284
     C                     Z-ADDCCYAMS    CCYAM                           S10284
      *                                                                   CEU006
     C                     MOVE PDCYS     PDCY                            CEU006
     C                     Z-ADDPDAMS     PDAM                            CEU006
      *                                                                   CEU006
      *                                                                   S10284
     C                     ENDSR
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C********************************************************************056031
     C************                                                        056031
     C*****GETCYA*- SR TO GET CCY DETAILS FOR PAY & SETTLE CURRENCIES  S  056031
     C************                                                        056031
     C***********GETCYA    BEGSR                                          056031
     C************                                                        056031
     C************                                                        056031
     C*****IF*NEEDED OBTAIN AND STORE DETAILS FOR PAY CCY                 056031
     C************                                                        056031
     C************                                                        056031
     C*********************MOVELDTCCY     SCCY                            S01194
     C************         MOVELDTCCY     SCCY    3                 S01194056031
     C*********************MOVE '1'       SCCY                            S01194
     C************         EXSR CCYCHN                                    056031
     C************                                                        056031
     C*********************Z-ADDSPOT      PAYYSP 138                      S01194
     C************         Z-ADDA6SPRT    PAYYSP 138                S01194056031
     C************         Z-ADDMDIN      PAYYMD  10                      056031
     C************         Z-ADDA6NBDP    PAYYDP  10                S01194056031
     C*********************Z-ADDCDP       PAYYDP  10                      S01194
     C************                                                        056031
     C************                                                        056031
     C*****IF*NEEDED OBTAIN AND STORE DETAILS FOR DEBIT CCY               056031
     C************                                                        056031
     C************                                                        056031
     C************         MOVELHDCCY     SCCY                            056031
     C*********************MOVE '1'       SCCY                            S01194
     C************         EXSR CCYCHN                                    056031
     C************                                                        056031
     C*********************Z-ADDSPOT      DRCYSP 138                      S01194
     C************         Z-ADDA6SPRT    DRCYSP 138                S01194056031
     C************         Z-ADDMDIN      DRCYMD  10                      056031
     C************         Z-ADDA6NBDP    DRCYDP  10                S01194056031
     C*********************Z-ADDCDP       DRCYDP  10                      S01194
     C************                                                        056031
     C************         ENDSR                                          056031
     C/EJECT
     C************                                                        056031
     C************  Remove PRONO, OLPOS and MEMOS                         056031
     C************                                                        056031
     C********************************************************************
     C************                                                        056031
     C*****SUB-ROUTINE TO CHAIN TO CURRENCIES TABLE                       056031
     C************                                                        056031
     C***********CCYCHN    BEGSR                                          056031
     C************                                                        056031
     C*********************MOVE *BLANK    TBCHN                           S01194
     C*********************MOVEL'20'      TBCHN                           S01194
     C*********************MOVE SCCY      TBCHN                           S01194
     C***********TBCHN*****CHAINTABTG10F             75                   S01194
     C**N75******RECI******COMP 'D'                  7575                 S01194
     C************IN75*****IFEQ '1'                        B001           S01194
     C*********************ROLBK                                          S01194
     C************LOCK*****IN   DLDA                                      S01194
     C*********************MOVEL'FT0070'  DBPGM                           S01194
     C*********************MOVE 'TABLE'   DBFILE                          S01194
     C*********************Z-ADD25        DBASE            ************   S01194
     C*********************MOVELTBCHN     DBKEY            * DBERR 25 *   S01194
     C*********************OUT  DLDA                       ************   S01194
     C*********************SETON                     U7U8LR               S01194
     C*********************DUMP                                           S01194
     C*********************RETRN                                          S01194
     C*********************END                             E001           S01194
     C************                                                  S01194056031
     C************         CALL 'AOCURRR0'                          S01194056031
     C************         PARM '*DBERR'  @RTCD   7                 S01194056031
     C************         PARM '*KEY'    @OPTN   7                 S01194056031
     C************         PARM SCCY      @CCY    3                 S01194056031
     C***********SDCURR    PARM SDCURR    DSSDY                     S01194056031
     C************         EXSR MVCURR                              S01194056031
     C************                                                  S01194056031
     C************         ENDSR                                          056031
     C/EJECT
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFA   : Determine if Profit Centres are Used              *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : *NONE                                             *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFA    BEGSR                                          S01414
      *                                                                   S01414
      *  Check if Profit Centres are used and set screen attributes       S01414
      *                                                                   S01414
     C           BKPRCU    IFEQ 'Y'                                       S01414
      *                                                                   S01414
      *  If Profit Centres are used determine if field is amendable.      S01414
      *                                                                   S01414
      *  If Insert it is always amendable. If Amend it is only            S01414
      *  amendable if the Profit Centres Amendable flag is set to 'Y'.    S01414
      *  If Enquire or Delete it is not amendable.                        S01414
      *                                                                   S01414
     C           SACTD     IFEQ 'I'                                       S01414
     C           SACTD     OREQ 'A'                                       S01414
     C           BKPRCA    ANDEQ'Y'                                       S01414
     C                     MOVEA'010'     *IN,84           Amendable      S01414
     C                     ELSE                                           S01414
     C                     MOVEA'000'     *IN,84           Protect        S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  If Profit Centres NOT Used - non display field                   S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVEA'100'     *IN,84           Non-display    S01414
     C                     END                                            S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRBOOK   : Validate Book Code                                *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : AOBOOKR0                                          *   S01414
      *             FTSNMS                                            *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRBOOK    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         Q                               S01414
     C                     MOVEL'SRBOOK'  @STK,Q                          S01414
     C           *LIKE     DEFN BOKC      W#BOKC                          S01414
      *                                                                   S01414
      *  Book Code must be entered                                        S01414
     C/COPY WNCPYSRC,FT0070C127
      *                                                                   S01414
     C           W#BOKC    IFEQ *BLANKS                                   S01414
     C                     MOVE '1'       *IN83                           S01414
     C                     MOVE '1'       *IN89            General err.   S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 400'    ERCD,S                          S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Access the Book Code file for validation                         S01414
      *                                                                   S01414
     C           W#BOKC    IFNE *BLANKS                                   S01414
      *                                                                   S01414
     C                     CALL 'AOBOOKR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY   ' U#OPTN  7                       S01414
     C                     PARM W#BOKC    U#BOKC  2                       S01414
     C           SDBOOK    PARM SDBOOK    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOBOOKR' W0KEY            * DBERR 51 *   S01414
     C                     Z-ADD51        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * else map the book code from the data structure to screen field    S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN83                           S01414
     C                     MOVE '1'       *IN89            General err.   S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 400'    ERCD,S                          S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELBDBKCD    W#BOKC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXBOOK    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,Q                          S01414
     C                     SUB  1         Q       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
      *                                                                   S01414
     C/EJECT                                                              S01414
      *****************************************************************   S01414
      *                                                               *   S01414
      *  SRPRFC   : Validation Of Profit Centre                       *   S01414
      *                                                               *   S01414
      *  CALLED BY:                                                   *   S01414
      *                                                               *   S01414
      *  CALLS    : FTSNMS                                            *   S01414
      *             AOPRFMR0                                          *   S01414
      *             AOPRFCR0                                          *   S01414
      *                                                               *   S01414
      *****************************************************************   S01414
     CSR         SRPRFC    BEGSR                                          S01414
      *                                                                   S01414
      *  Set up subroutine stack name                                     S01414
      *                                                                   S01414
     C                     ADD  1         Q                               S01414
     C                     MOVEL'SRPRFC'  @STK,Q                          S01414
      *                                                                   S01414
     C           *LIKE     DEFN PRFC      W#PRFC                          S01414
      *                                                                   S01414
      *  Profit Centre is Optional input.                                 S01414
     C/COPY WNCPYSRC,FT0070C128
      **********                                                                   MD037669 MD052101
      ***Move*user-input field value of Profit Centre                              MD037669 MD052101
      **********                                                                   MD037669 MD052101
     C**********           MOVELSHPRFC    W#PRFC                                   MD037669 MD052101
      *                                                                   S01414
      *  If the profit centre field is blank set to a default only if     S01414
      *  the Profit Centre Defaults Used flag is set to 'Y'.              S01414
      *  This could only happen on an Insert.                             S01414
      *  Do not default if an error was found in Collecting Bank,         179732
      *  Credit party or Book code                                        179732
      *                                                                   S01414
      *  If a nostro account or a retail account                          179732
     C           SACTD     IFEQ 'I'                                                         MD037669
     C           W#PRFC    ANDEQ*BLANKS                                                     MD037669
      *                                                                                     MD037669
     C           BKPCDU    IFEQ 'Y'                                                         MD037669
     C           *IN45     ANDNE'1'                                                         MD037669
     C           *IN46     ANDNE'1'                                                         MD037669
     C           *IN50     ANDNE'1'                                                         MD037669
     C           *IN83     ANDNE'1'                                                         MD037669
      *                                                                                     MD037669
     C           COBT      IFEQ 'R'                                       179732
     C           *IN50     ANDEQ'0'                                       179732
     C           CRPT      ANDEQ*BLANKS                                   179732
     C           COBT      OREQ 'F'                                       179732
     C           *IN50     ANDEQ'0'                                       179732
     C           CRPT      ANDEQ*BLANKS                                   179732
     C           CRPT      OREQ 'R'                                       179732
     C           CRPT      OREQ 'N'                                       179732
     C                     MOVE ACPRFC    W#PRFC                          179732
     C                     ENDIF                                          179732
     C                     ENDIF                                                            MD037669
     C                     ENDIF                                                            MD037669
      *                                                                                     MD037669
      *  If Account is valid                                              179732
     C           RECI      IFEQ 'D'                                       179732
      *                                                                   179732
      *  If action is Insert or amend                                     179732
     C           SACTD     IFEQ 'I'                                       S01414
     C           W#PRFC    ANDEQ*BLANKS                                   S01414
     C           BKPCDU    ANDEQ'Y'                                       S01414
     C           *IN45     ANDNE'1'                                       179732
     C           *IN46     ANDNE'1'                                       179732
     C           *IN50     ANDNE'1'                                       179732
     C           *IN83     ANDNE'1'                                       179732
      *                                                                   S01414
     C           SACTD     OREQ 'A'                                       179732
     C           W#PRFC    ANDEQ*BLANKS                                   179732
     C           BKPCDU    ANDEQ'Y'                                       179732
     C           *IN45     ANDNE'1'                                       179732
     C           *IN46     ANDNE'1'                                       179732
     C           *IN50     ANDNE'1'                                       179732
     C           *IN83     ANDNE'1'                                       179732
      *                                                                   S01414
      *  Determine parameters to be passed                                S01414
      *                                                                   S01414
      ***For*Nostro*Transfers*the*Customer*and*Account*officer*willS01414 179732
      ***be*blank.*************************************************S01414 179732
      *                                                                   179732
      * IF a Nostro moves blanks into Account officer and Cust No.        179732
      * Else get the account officer and Cust No.                         179732
     C           COBT      IFEQ 'F'                                       179732
     C           CRPT      ANDEQ*BLANKS                                   179732
     C           CRPT      OREQ 'N'                                       179732
     C                     MOVEL*BLANKS   CUST    6        Customer       S01414
     C                     MOVEL*BLANKS   ACOF    2        Account OfficerS01414
      *                                                                   179732
     C                     ELSE                                           179732
      *                                                                   179732
     C           CRPT      IFEQ *BLANKS                                   179732
     C           COBT      ANDNE*BLANKS                                   179732
     C                     MOVELSCBK1     #CNUM   6        Customer       179732
     C                     ELSE                                           179732
      *                                                                   179732
     C           CRPT      IFNE *BLANKS                                   179732
     C                     MOVELSCRPA     #CNUM   6        Customer       179732
     C                     ENDIF                                          179732
     C                     ENDIF                                          179732
      *                                                                   179732
     C                     CALL 'AOCUSTR0'                                179732
     C                     PARM *BLANKS   @RTCD   7                       179732
     C                     PARM '*KEY'    @OPTN   7                       179732
     C                     PARM #CNUM     @KEY1  10                       179732
     C                     PARM *BLANKS   @KYST   7                       179732
     C           SDCUST    PARM SDCUST    DSSDY                           179732
      *                                                                   179732
     C                     MOVEL#CNUM     CUST    6        Customer       179732
     C                     MOVELBBACOC    ACOF    2        Account Officer179732
     C                     ENDIF                                          179732
     C                     MOVEL'CC'      TRTP    5        Transaction TypS01414
      *                                                                   S01414
      *  Get default profit centre                                        S01414
      *                                                                   S01414
     C                     CALL 'AOPRFMR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7        Return Code    S01414
     C                     PARM W#BOKC    U#BOKC  2        Book Code      S01414
     C                     PARM TRTP      U#TRTP  5        Transaction TypS01414
     C                     PARM PYST      U#SUTP  2        Sub Type       S01414
     C                     PARM BKGBR     U#BRAN  3        Booking Brch   S01414
     C                     PARM DPPT      U#DEPT  3        Department CodeS01414
     C                     PARM USRID     U#USER 10        User           S01414
     C                     PARM ACOF      U#ACOF  2        Account OfficerS01414
     C                     PARM CUST      U#CUST  6        Customer NumberS01414
     C           W#PRFC    PARM *BLANKS   U#PRFC  4        Profit Centre  S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFMR' W0KEY            * DBERR 52 *   S01414
     C                     Z-ADD52        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      * If no error then the screen field is filled by passed parameter   S01414
      *                                                                   S01414
     C           U#RTCD    IFEQ '2'                                       S01414
     C                     MOVE '1'       *IN86                           S01414
     C                     MOVE '1'       *IN89            General err.   S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 410'    ERCD,S                          S01414
     C                     GOTO EXPRFC                                    S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
      *                                                                   S01414
      *  Validate Profit Centre                                           S01414
      *                                                                   S01414
     C           SACTD     IFEQ 'I'                                       S01414
     C           W#PRFC    ANDNE*BLANKS                                   S01414
     C           SACTD     OREQ 'A'                                       S01414
     C           W#PRFC    ANDNE*BLANKS                                   S01414
     C           SACTD     OREQ 'I'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
     C           SACTD     OREQ 'A'                                       120827
     C           BGN0ST    ANDEQ'Y'                                       120827
      *                                                                   S01414
     C                     CALL 'AOPRFCR0'             90                 S01414
     C                     PARM *BLANKS   U#RTCD  7                       S01414
     C                     PARM '*KEY'    U#OPTN  7                       S01414
     C                     PARM W#PRFC    U#PRFC  4                       S01414
     C           SDPRFC    PARM SDPRFC    DSFDY                           S01414
      *                                                                   S01414
      *  If error on CALL - process as database error                     S01414
      *                                                                   S01414
     C           *IN90     IFEQ '1'                                       S01414
     C                     MOVEL'*CALL  ' W0FILE           ************   S01414
     C                     MOVEL'AOPRFCR' W0KEY            * DBERR 53 *   S01414
     C                     Z-ADD53        W0ERNB           ************   S01414
     C                     EXSR SRERR                                     S01414
     C                     END                                            S01414
      *                                                                   S01414
      * If return code is not blank - process for an error                S01414
      *                                                                   S01414
     C           U#RTCD    IFNE *BLANKS                                   S01414
     C                     MOVE '1'       *IN86                           S01414
     C                     MOVE '1'       *IN89            General err.   S01414
     C                     ADD  1         S                               S01414
     C                     MOVEL' 410'    ERCD,S                          S01414
      *                                                                   S01414
     C                     ELSE                                           S01414
     C                     MOVELDSPCCD    W#PRFC                          S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            S01414
      *                                                                   S01414
     C                     END                                            179732
      *                                                                   S01414
      *  Unwind subroutine stack name                                     S01414
      *                                                                   S01414
     C           EXPRFC    TAG                                            S01414
     C                     MOVEA*BLANKS   @STK,Q                          S01414
     C                     SUB  1         Q       50                      S01414
      *                                                                   S01414
     CSR                   ENDSR                                          S01414
     C*
     C/EJECT                                                              095270
     C*****************************************************************   095270
     C*                                                               *   095270
     C*  SRSCHG   : Reverse charges from database                     *   095270
     C*                                                               *   095270
     C*  CALLED BY: UPDAT1 - Update header record                     *   095270
     C*                                                               *   095270
     C*****************************************************************   095270
     CSR         SRSCHG    BEGSR                                          095270
     C*                                                                   095270
     C*  Move fields to C#DTA structure and call AOSPOSU0                 095270
     C*                                                                   095270
     C                     CLEARC#DTA                                     095270
     C*                                                                   095270
     C*  If Charges to debit of accnt is non-blank debit to this accnt    095270
     C*                                                                   095270
     C                     SELEC                                          095270
     C           CDRT      WHNE *BLANKS                                   095270
     C                     MOVELCDRT      C#ATYP                          095270
     C                     MOVELCDRO      C#ACCT                          095270
     C                     EXSR SRACCT                                                        CGL029
     C                     MOVELCDBR      C#BRCA                          095270
     C                     MOVELBJCYCD    C#CCY                           095270
     C*                                                                   095270
     C                     OTHER                                          095270
     C*                                                                   095270
     C*  If Charges to debit of accnt is blank, use credit party detls    095270
     C*                                                                   095270
     C                     MOVELCRPT      C#ATYP                          095270
     C                     MOVELCRPY      C#ACCT                          095270
     C                     EXSR SRACCT                                                        CGL029
     C                     MOVELCRBR      C#BRCA                          095270
     C                     MOVELCRCY      C#CCY                           095270
     C                     END                                            095270
     C*                                                                   095270
     C* Set posting date according to FT Control Data                     095270
     C*                                                                   095270
     C           C#PDTI    IFEQ 'I'                                       095270
     C                     Z-ADDBJRDNB    C#PSTD                          095270
     C                     ELSE                                           095270
     C           C#PDTI    IFEQ 'E'                                       095270
     C                     Z-ADDCRVD      C#PSTD                          095270
     C                     ELSE                                           095270
     C           SLDT      IFLT CRVD                                      095270
     C                     Z-ADDSLDT      C#PSTD                          095270
     C                     ELSE                                           095270
     C                     Z-ADDCRVD      C#PSTD                          095270
     C                     END                                            095270
     C                     END                                            095270
     C                     END                                            095270
     C*                                                                   095270
     C                     Z-ADDCRVD      C#VDAT                          095270
     C                     MOVEL'I'       C#IO                            095270
     C                     MOVELPYTP      C#TRYP                          095270
     C                     MOVELPREF      C#PREF                          095270
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C                     MOVELPREF      C#NARR                                              CRE020
     C                     Z-ADDCQSQ      C#CHQN                                              CRE020
     C           WRVACH    IFEQ 'Y'                                                           CRE020
     C                     MOVE ' '       WRVACH                                              CRE020
     C                     MOVE '*'       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
     C                     MOVE WREVER    C#NARR                                              CRE020
     C                     MOVE ' '       WREVER                                              CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     MOVEL'FT'      C#MOD                           095270
     C                     MOVEL'01'      C#OLRC                          095270
     C                     MOVEL##FTOV    C#FTOV                          095270
     C           *LIKE     DEFN C#AMT     ##CHGS                          095270
     C                     Z-ADD##CHGS    C#AMT                           095270
     C           CAP205    IFEQ 'Y'                                                           CAP205
     C                     MOVEL'F'       C#MTYP                                              CAP205
     C                     ENDIF                                                              CAP205
     C/COPY WNCPYSRC,FT0070C129
     C*                                                                   095270
     C*  Call AOSPOSU0                                                    095270
     C*                                                                   095270
     C                     CALL 'AOSPOSU0'             9090               095270
     C           R#RTN     PARM *BLANKS   O#RTN   7                       095270
     C                     PARM '*ADD    'W0ACT   8                       095270
     C                     PARM C#DTA     O#DTA 256                       095270
     C*                                                                   095270
     C           *IN90     IFEQ '1'                                       095270
     C           R#RTN     ORNE *BLANKS                                   095270
     C                     MOVEL'*CALL   'W0FILE                          095270
     C                     MOVEL'AOSPOSU0'W0KEY                           095270
     C                     Z-ADD13        W0ERNB                          095270
     C                     MOVELERR@,1    W0NARR                          095270
     C                     EXSR SRERR                                     095270
     C                     END                                            095270
     C/COPY WNCPYSRC,FT0070C126
     C*                                                                   095270
     CSR                   ENDSR                                          095270
     C/EJECT
     C*****************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           *** ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
     C**
     C**
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO                              B001
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END                             E001
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO                              B001
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END                             E001
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY                         B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6                          B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C   97N93             DO   3                          B001
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END                             E001
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
     C/EJECT
     C************************************************************
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50   99
     C   99                GOTO ZDEND2
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    COMP ZYDY,ZWRK2             90
     C  N90      ZWRK2     ADD  1         ZWRK2
     C  N90                GOTO ZDTAG1
     C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C                     SETOF                     9293
     C   91      ZDAYN1    COMP 59                     9293
     C   91N92   ZDAYN1    SUB  1         ZDAYN1
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    COMP ZMDY,ZWRK2             94
     C  N94      ZWRK2     ADD  1         ZWRK2
     C  N94                GOTO ZDTAG2
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C   93      ZDAY      ADD  1         ZDAY
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C           ZDAY      COMP 10                     95
     C                     MOVELZDAY      ZWRK5   5
     C   95                MOVEL' '       ZWRK5
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C************************************************************
     C/EJECT
     C*****************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZSUB    BEGSR                           *** GLZSUB ****
     C*
     C                     Z-SUBZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZBEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZBEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     C           GLZADD    BEGSR                           *** GLZADD ****
     C*
     C                     Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     C   91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     C                     Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     C                     MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     C                     EXSR GLZSUM
     C           ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     C           GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     C                     Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     C                     Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     C                     SETOF                     919293
     C                     SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     C   93                Z-ADDZZAMTI    ZZTOTI
     C   93                Z-ADDZZAMTD    ZZTOTD
     C   93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     C           ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
     C                     ENDSR                             ** ENDSR **
     C********************************************************************
      /EJECT
     C********************************************************************056823
     C**CALLED*BY*:**DETL1                                     *    S10284056823
     C*******************                                      *    S10284056823
     C**CALLS*:**********                                      *    S10284056823
     C*******************                                      *    S10284056823
     C**INPUT**:*@@MDI1**FIRST MULTIPLY/DIVIDE INDICATOR       *    S10284056823
     C***********@@MDI2**SECOND MULTIPLY/DIVIDE INDICATOR      *    S10284056823
     C***********@@RAT1**FIRST RATE (SIZE : 13,8)              *    S10284056823
     C***********@@RAT2**SECOND RATE (SIZE : 13,8)             *    S10284056823
     C*******************                                      *    S10284056823
     C**OUTPUT*:*@@CSRT**CROSS RATE  (SIZE : 13,8)             *    S10284056823
     C***********@@FCMD**FIRST CCY MULTIPLY/DIVIDE INDICATOR   *    S10284056823
     C*******************                                      *    S10284056823
     C**USES*:***********                                      *    S10284056823
     C*******************                                      *    S10284056823
     C*******************                                      *    S10284056823
     C**********************************************************    S10284056823
     C*******************                                          S10284 056823
     C***********ZA0900**  BEGSR                                   S10284 056823
     C*******************                                          S10284 056823
     C***********@@RAT1**  IFEQ *ZERO                      B1      S10284 056823
     C*******************  Z-ADD1         @@RAT1           *1      S10284 056823
     C*******************  END                             E1      S10284 056823
     C*******************                                          S10284 056823
     C***********@@RAT2**  IFEQ *ZERO                      B1      S10284 056823
     C*******************  Z-ADD1         @@RAT2           *1      S10284 056823
     C*******************  END                             E1      S10284 056823
     C*******************                                          S10284 056823
     C****IF*THE*FIRST*RATE M/D INDICATOR IS '1' MULTIPLY,         S10284 056823
     C***************ELSE DIVIDE                                   S10284 056823
     C*******************                                          S10284 056823
     C***********@@MDI1**  IFEQ '1'                        B1      S10284 056823
     C*******************  Z-ADD@@RAT1    @@CSRT 138       *1      S10284 056823
     C*******************  ELSE                            X1      S10284 056823
     C***********1*******  DIV  @@RAT1    @@CSRT    H      *1      S10284 056823
     C*******************  END                             E1      S10284 056823
     C*******************                                          S10284 056823
     C****IF*THE*SECOND*RATE M/D INDICATOR IS '0' MULTIPLY,        S10284 056823
     C***************ELSE DIVIDE                                   S10284 056823
     C*******************                                          S10284 056823
     C***********@@MDI2**  IFEQ '0'                        B1      S10284 056823
     C***********@@CSRT**  MULT @@RAT2    @@CSRT           *1      S10284 056823
     C*******************  ELSE                            X1      S10284 056823
     C***********@@CSRT**  DIV  @@RAT2    @@CSRT    H      *1      S10284 056823
     C*******************  END                             E1      S10284 056823
     C*******************                                          S10284 056823
     C*******************                                          S10284 056823
     C****SET*FIRST*CCY*MULTIPLY/DIVIDE *IN TO MULTIPLY            S10284 056823
     C*******************  MOVE '1'       @@FCMD  1                S10284 056823
     C*******************                                          S10284 056823
     C***********ZA0909**  ENDSR                    **ZA0909 TAG** S10284 056823
     C*****************************************************************   S10284
     C*****************************************************************   S10284
      /EJECT                                                              035398
      *   Subroutine to zero suppress the central bank ref field          035398
      *                                                                   035398
     C           #CBREF    BEGSR                                          035398
      *                                                                   035398
     C           *LIKE     DEFN SDBC1     @SNDC                           035398
     C                     MOVEA@SNDC     C11                             035398
     C                     Z-ADD1         @V      20                      035398
      *                                                                   035398
     C           @V        DOUGE12                         *** B01        035398
      *                                                                   035398
     C           C11,@V    IFEQ '0'                        *** B02        035398
     C                     MOVEA' '       C11,@V                          035398
     C                     ADD  1         @V                              035398
     C                     ELSE                            *** X02        035398
     C                     Z-ADD12        @V                              035398
     C                     END                             *** E02        035398
     C                     END                             *** E01        035398
      *                                                                   035398
     C                     MOVEAC11       @SNDC                           035398
      *                                                                   035398
     C                     ENDSR                                          035398
      *                                                                   035398
     C********************************************************************035398
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRPRM1    BEGSR                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   SDWLTO                                              CSD015
      *                                                                                       CSD015
      ** Setup Counterparty Details                                                           CSD015
      *                                                                                       CSD015
     C                     EXSR SRCPTP                                                        CSD015
      *                                                                                       CSD015
      ** Setup 1st parameter for compliance engine program                                    CSD015
      *                                                                                       CSD015
     C                     MOVEL'FTCHQC'  W4ITEM                                              CSD015
     C                     MOVELPREF      W4IDEN                                              CSD015
     C                     MOVELBRCA      W4BRCH                                              CSD015
     C                     MOVEL'CQCOCDD' W4FUNT                                              CSD015
     C                     MOVELPKEY1     W4CNUM                                              CSD015
     C                     MOVELWCTYP     W4CTYP                                              CSD015
     C                     MOVELWRNRT     W4CUST                                              CSD015
     C                     Z-ADD0         W4DDAT                                              CSD015
     C                     Z-ADD0         W4VDAT                                              CSD015
     C                     Z-ADD0         W4MDAT                                              CSD015
     C                     MOVELCRCY      W4DEN1                                              CSD015
     C                     MOVELPDCY      W4DEN2                                              CSD015
     C                     Z-ADDCCYAM     W4AMT1                                              CSD015
     C                     Z-ADDPDAM      W4AMT2                                              CSD015
      *                                                                                       CSD015
      ** Set W4SYSM to main system if 24X7 enhancement is                                     CSD015
      ** installed, else set to prefix from SDSTAT                                            CSD015
      *                                                                                       CSD015
     C           CSC011    IFEQ 'Y'                                                           CSD015
     C                     MOVELS1MAIN    W4SYSM                                              CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELLIBR      W4SYSM                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRWTCH    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Send transaction details to Compliance Watch                                         CSD015
      *                                                                                       CSD015
     C                     CALL 'SDWLCLOP'                                                    CSD015
     C                     PARM           SDWLTO                                              CSD015
     C                     PARM           PSTRNG                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCONV    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Convert Watch Fields to Customer Name and Address                                    CSD015
      *                                                                                       CSD015
     C                     CALL 'SDCWLFMT'                                                    CSD015
     C                     PARM           PRTCD                                               CSD015
     C                     PARM           PINP1  35                                           CSD015
     C                     PARM           PINP2  35                                           CSD015
     C                     PARM           PINP3  35                                           CSD015
     C                     PARM           PINP4  35                                           CSD015
     C                     PARM           PINP5  35                                           CSD015
     C                     PARM           PINP6  35                                           CSD015
     C                     PARM           PCYCD   3                                           CSD015
     C                     PARM           POUT1 216                                           CSD015
     C                     PARM           POUT2   6                                           CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRPRM2    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Format Watch Fields in XML Format for 2nd parameter                                  CSD015
      *                                                                                       CSD015
     C           POUT1     IFNE *BLANKS                                                       CSD015
     C                     CAT  XOT,WX:0  PSTRNG                                              CSD015
     C                     CAT  POUT1:0   PSTRNG                                              CSD015
     C                     CAT  XCT,WX:0  PSTRNG                                              CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCLRP    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Reset parameters for SDCWLFMT                                                        CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PINP1                                               CSD015
     C                     MOVE *BLANKS   PINP2                                               CSD015
     C                     MOVE *BLANKS   PINP3                                               CSD015
     C                     MOVE *BLANKS   PINP4                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PINP5                                               CSD015
     C                     MOVE *BLANKS   PCYCD                                               CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      ********************************************************************                    CSD015
      /EJECT                                                                                  CSD015
      ********************************************************************                    CSD015
      *                                                                                       CSD015
     C           SRCPTP    BEGSR                                                              CSD015
      *                                                                                       CSD015
      ** Determine Counterparty type                                                          CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   PKEY1                                               CSD015
      *                                                                                       CSD015
      ** If Collecting Bank is not free text, use it as counterparty                          CSD015
      ** else use sender's correspondent.                                                     CSD015
      *                                                                                       CSD015
     C           WCBFF     IFEQ 'N'                                                           CSD015
     C                     MOVELWCBCP     PKEY1                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVELWRCCP     PKEY1                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     CALL 'AOCUSTR0'                                                    CSD015
     C                     PARM *BLANK    PRTCD                                               CSD015
     C                     PARM '*KEY   ' POPTN                                               CSD015
     C                     PARM           PKEY1  10                                           CSD015
     C                     PARM *BLANKS   PKYST   7                                           CSD015
     C           SDCUST    PARM SDCUST    DSSDY                                               CSD015
      *                                                                                       CSD015
     C           PRTCD     IFNE *BLANKS                                                       CSD015
     C           PRTCD     ANDNE'*NRF   '                                                     CSD015
     C                     MOVEL'SDCUSTPD'W0FILE                                              CSD015
     C                     MOVELPKEY1     W0KEY                                               CSD015
     C                     Z-ADD65        W0ERNB                                              CSD015
     C                     EXSR SRERR                                                         CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     MOVE *BLANKS   WCTYP   1                                           CSD015
     C                     MOVE *BLANKS   WCRNM  20                                           CSD015
     C                     MOVE *BLANKS   WRNRT  30                                           CSD015
      *                                                                                       CSD015
     C           PRTCD     IFEQ *BLANKS                                                       CSD015
      *                                                                                       CSD015
     C                     MOVELBBCRNM    WCRNM                                               CSD015
     C           BBCRNM    CAT  BBCRTN    WRNRT                                               CSD015
      *                                                                                       CSD015
     C           CCF001    IFEQ 'Y'                                                           CSD015
      *                                                                                       CSD015
     C           BBCRPC    IFEQ 'Y'                                                           CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ELSE                                                               CSD015
      *                                                                                       CSD015
     C           BBLICD    IFNE *BLANKS                                                       CSD015
     C           BBLICD    ANDNEW1IND1                                                        CSD015
     C           BBLICD    ANDNEW1IND2                                                        CSD015
     C           BBLICD    ANDNEW1IND3                                                        CSD015
     C           BBLICD    ANDNEW1IND4                                                        CSD015
     C           BBLICD    ANDNEW1IND5                                                        CSD015
     C                     MOVE 'C'       WCTYP                                               CSD015
     C                     ELSE                                                               CSD015
     C                     MOVE 'I'       WCTYP                                               CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDIF                                                              CSD015
      *                                                                                       CSD015
     C                     ENDSR                                                              CSD015
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
      *****************************************************************                       CGL029
      *                                                               *                       CGL029
      *  SRACCT - Moves relevant account data.                        *                       CGL029
      *                                                               *                       CGL029
      *****************************************************************                       CGL029
     C           SRACCT    BEGSR                                                              CGL029
      *                                                                                       CGL029
     C                     MOVE W#CNU1    C#CNU1                                              CGL029
     C                     MOVE W#CCY1    C#CCY1                                              CGL029
     C                     MOVE W#ACO1    C#ACO1                                              CGL029
     C                     MOVE W#ACS1    C#ACS1                                              CGL029
     C                     MOVE W#BRC1    C#BRC1                                              CGL029
      *                                                                                      BUG3193
     C           C#ATYP    IFEQ 'R'                                                          BUG3193
     C                     MOVELC#ACCT    C#ACNO                                             BUG3193
     C                     ENDIF                                                             BUG3193
      *                                                                                       CGL029
     C                     ENDSR                                                              CGL029
      *****************************************************************                       CGL029
      /EJECT                                                                                  CGL029
     C*****************************************************************                       CSD015
      /EJECT
     C/COPY WNCPYSRC,FT0070C008
      /COPY ZSRSRC,ZSEDITZ3
     C** NEW HOLIDAY PROCESSING C-SPECS                                   S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C*                                                                   S01195
     C********************************************************************
      /EJECT
     OCQCODDDFE                RCQCOD
     OCQCOCDDFE                RCQCOC
     O************                                                        056031
     O************  Remove PRONO OLPOS and MEMOS                          056031
     O************                                                        056031
     O*PRONOPNFE***                RPRONO                                 056031
     O*OLPOSOAFE***                ROLPOS                                 056031
     O/COPY WNCPYSRC,FT0070O001
     O**   @@    Scaling Exponents  (COMPILE TIME ARRAY REMOVED)          056823
     O*0001                                                               056823
     O*0010                                                               056823
     O*0100                                                               056823
     O*1000                                                               056823
**  CPY@
(c) Finastra International Limited 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   POWER - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS(CHARGES)
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  POWERS - ARRAY OF POWERS OF 10 FOR CURRENCY CONVERSIONS(CHEQUES)
0000010
0000100
0001000
0010000
0100000
1000000
**  Error text                                                            056031
Error occurred on call to program - see dumps for further details
** XOT - Array for watch list fields' Opening XML Tags                                        CSD015
<Credit Party>                                                                                CSD015
<Receiver Correspondent>                                                                      CSD015
<Narrative>                                                                                   CSD015
<Collecting Bank>                                                                             CSD015
** XCT - Array for watch list fields' Closing XML Tags                                        CSD015
</Credit Party>                                                                               CSD015
</Receiver Correspondent>                                                                     CSD015
</Narrative>                                                                                  CSD015
</Collecting Bank>                                                                            CSD015
